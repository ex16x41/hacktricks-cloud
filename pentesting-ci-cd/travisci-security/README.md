# TravisCI Security

{% hint style="success" %}
Aprenda e pratique Hacking AWS:<img src="../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">\
Aprenda e pratique Hacking GCP: <img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Confira os [**planos de assinatura**](https://github.com/sponsors/carlospolop)!
* **Junte-se ao** üí¨ [**grupo do Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga**-nos no **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe truques de hacking enviando PRs para o** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) reposit√≥rios do github.

</details>
{% endhint %}

## O que √© TravisCI

**Travis CI** √© um servi√ßo de **integra√ß√£o cont√≠nua** **hospedado** ou **local** usado para construir e testar projetos de software hospedados em v√°rias **plataformas git diferentes**.

{% content-ref url="basic-travisci-information.md" %}
[basic-travisci-information.md](basic-travisci-information.md)
{% endcontent-ref %}

## Ataques

### Gatilhos

Para lan√ßar um ataque, voc√™ primeiro precisa saber como acionar uma constru√ß√£o. Por padr√£o, o TravisCI **acionar√° uma constru√ß√£o em pushes e pull requests**:

![](<../../.gitbook/assets/image (145).png>)

#### Cron Jobs

Se voc√™ tiver acesso √† aplica√ß√£o web, pode **configurar crons para executar a constru√ß√£o**, isso pode ser √∫til para persist√™ncia ou para acionar uma constru√ß√£o:

![](<../../.gitbook/assets/image (243).png>)

{% hint style="info" %}
Parece que n√£o √© poss√≠vel configurar crons dentro do `.travis.yml` de acordo com [isso](https://github.com/travis-ci/travis-ci/issues/9162).
{% endhint %}

### PR de Terceiros

O TravisCI, por padr√£o, desabilita o compartilhamento de vari√°veis de ambiente com PRs provenientes de terceiros, mas algu√©m pode habilit√°-lo e ent√£o voc√™ poderia criar PRs para o reposit√≥rio e exfiltrar os segredos:

![](<../../.gitbook/assets/image (208).png>)

### Dumping Secrets

Como explicado na p√°gina de [**informa√ß√µes b√°sicas**](basic-travisci-information.md), existem 2 tipos de segredos. **Segredos de Vari√°veis de Ambiente** (que est√£o listados na p√°gina web) e **segredos criptografados personalizados**, que s√£o armazenados dentro do arquivo `.travis.yml` como base64 (note que ambos, quando armazenados criptografados, acabar√£o como vari√°veis de ambiente nas m√°quinas finais).

* Para **enumerar segredos** configurados como **Vari√°veis de Ambiente**, v√° para as **configura√ß√µes** do **projeto** e verifique a lista. No entanto, note que todas as vari√°veis de ambiente do projeto definidas aqui aparecer√£o ao acionar uma constru√ß√£o.
* Para enumerar os **segredos criptografados personalizados**, o melhor que voc√™ pode fazer √© **verificar o arquivo `.travis.yml`**.
* Para **enumerar arquivos criptografados**, voc√™ pode verificar por **arquivos `.enc`** no reposit√≥rio, por linhas semelhantes a `openssl aes-256-cbc -K $encrypted_355e94ba1091_key -iv $encrypted_355e94ba1091_iv -in super_secret.txt.enc -out super_secret.txt -d` no arquivo de configura√ß√£o, ou por **iv e chaves criptografadas** nas **Vari√°veis de Ambiente** como:

![](<../../.gitbook/assets/image (81).png>)

### TODO:

* Exemplo de constru√ß√£o com shell reverso rodando em Windows/Mac/Linux
* Exemplo de constru√ß√£o vazando a env codificada em base64 nos logs

### TravisCI Enterprise

Se um atacante acabar em um ambiente que usa **TravisCI enterprise** (mais informa√ß√µes sobre o que √© isso na [**informa√ß√£o b√°sica**](basic-travisci-information.md#travisci-enterprise)), ele poder√° **acionar constru√ß√µes no Worker.** Isso significa que um atacante poder√° se mover lateralmente para aquele servidor do qual ele poderia ser capaz de:

* escapar para o host?
* comprometer kubernetes?
* comprometer outras m√°quinas rodando na mesma rede?
* comprometer novas credenciais de nuvem?

## Refer√™ncias

* [https://docs.travis-ci.com/user/encrypting-files/](https://docs.travis-ci.com/user/encrypting-files/)
* [https://docs.travis-ci.com/user/best-practices-security](https://docs.travis-ci.com/user/best-practices-security)

{% hint style="success" %}
Aprenda e pratique Hacking AWS:<img src="../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">\
Aprenda e pratique Hacking GCP: <img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Confira os [**planos de assinatura**](https://github.com/sponsors/carlospolop)!
* **Junte-se ao** üí¨ [**grupo do Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga**-nos no **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe truques de hacking enviando PRs para o** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) reposit√≥rios do github.

</details>
{% endhint %}
