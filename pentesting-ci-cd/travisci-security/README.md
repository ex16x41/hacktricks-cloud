# TravisCI Security

{% hint style="success" %}
AWSハッキングを学び、実践する：<img src="../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
GCPハッキングを学び、実践する：<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricksをサポートする</summary>

* [**サブスクリプションプラン**](https://github.com/sponsors/carlospolop)を確認してください！
* **💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)または[**Telegramグループ**](https://t.me/peass)に参加するか、**Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**をフォローしてください。**
* **[**HackTricks**](https://github.com/carlospolop/hacktricks)および[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)のGitHubリポジトリにPRを送信してハッキングトリックを共有してください。**

</details>
{% endhint %}

## TravisCIとは

**Travis CI**は、**ホスティング**または**オンプレミス**の**継続的インテグレーション**サービスで、複数の**異なるgitプラットフォーム**にホストされているソフトウェアプロジェクトをビルドおよびテストするために使用されます。

{% content-ref url="basic-travisci-information.md" %}
[basic-travisci-information.md](basic-travisci-information.md)
{% endcontent-ref %}

## 攻撃

### トリガー

攻撃を開始するには、まずビルドをトリガーする方法を知る必要があります。デフォルトでは、TravisCIは**プッシュとプルリクエストでビルドをトリガーします**：

![](<../../.gitbook/assets/image (145).png>)

#### Cronジョブ

Webアプリケーションにアクセスできる場合、**ビルドを実行するためのcronを設定できます**。これは持続性やビルドをトリガーするのに役立ちます：

![](<../../.gitbook/assets/image (243).png>)

{% hint style="info" %}
[こちら](https://github.com/travis-ci/travis-ci/issues/9162)によると、`.travis.yml`内でcronを設定することはできないようです。
{% endhint %}

### サードパーティPR

TravisCIはデフォルトでサードパーティからのPRと環境変数の共有を無効にしていますが、誰かがそれを有効にすると、リポジトリにPRを作成して秘密を抽出できる可能性があります：

![](<../../.gitbook/assets/image (208).png>)

### 秘密のダンプ

[**基本情報**](basic-travisci-information.md)ページで説明されているように、秘密には2種類あります。**環境変数の秘密**（Webページにリストされています）と、**カスタム暗号化された秘密**で、これは`.travis.yml`ファイル内にbase64として保存されています（両方とも暗号化されて保存されると、最終的なマシンの環境変数として表示されます）。

* **環境変数として設定された秘密を列挙するには、**プロジェクトの**設定**に移動し、リストを確認します。ただし、ここで設定されたすべてのプロジェクト環境変数は、ビルドをトリガーすると表示されます。
* **カスタム暗号化された秘密を列挙するには、**最善の方法は**`.travis.yml`ファイルを確認することです**。
* **暗号化されたファイルを列挙するには、**リポジトリ内の**`.enc`ファイル**を確認するか、設定ファイル内の`openssl aes-256-cbc -K $encrypted_355e94ba1091_key -iv $encrypted_355e94ba1091_iv -in super_secret.txt.enc -out super_secret.txt -d`に似た行を探すか、次のような**環境変数内の暗号化されたivとキー**を探します：

![](<../../.gitbook/assets/image (81).png>)

### TODO:

* Windows/Mac/Linuxでリバースシェルを実行する例ビルド
* ログに環境変数のbase64エンコードを漏洩させる例ビルド

### TravisCIエンタープライズ

攻撃者が**TravisCIエンタープライズ**を使用している環境に入った場合（これが何であるかの詳細は[**基本情報**](basic-travisci-information.md#travisci-enterprise)にあります）、彼は**Workerでビルドをトリガーすることができます**。これは、攻撃者がそのサーバーに横移動できることを意味し、そこから次のことができる可能性があります：

* ホストに脱出する？
* Kubernetesを侵害する？
* 同じネットワーク内の他のマシンを侵害する？
* 新しいクラウド資格情報を侵害する？

## 参考文献

* [https://docs.travis-ci.com/user/encrypting-files/](https://docs.travis-ci.com/user/encrypting-files/)
* [https://docs.travis-ci.com/user/best-practices-security](https://docs.travis-ci.com/user/best-practices-security)

{% hint style="success" %}
AWSハッキングを学び、実践する：<img src="../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
GCPハッキングを学び、実践する：<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricksをサポートする</summary>

* [**サブスクリプションプラン**](https://github.com/sponsors/carlospolop)を確認してください！
* **💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)または[**Telegramグループ**](https://t.me/peass)に参加するか、**Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**をフォローしてください。**
* **[**HackTricks**](https://github.com/carlospolop/hacktricks)および[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)のGitHubリポジトリにPRを送信してハッキングトリックを共有してください。**

</details>
{% endhint %}
