# TravisCI Security

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** 💬 [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## What is TravisCI

**Travis CI**は、**ホスティング**または**オンプレミス**の**継続的インテグレーション**サービスで、複数の**異なるgitプラットフォーム**にホストされているソフトウェアプロジェクトをビルドおよびテストするために使用されます。

{% content-ref url="basic-travisci-information.md" %}
[basic-travisci-information.md](basic-travisci-information.md)
{% endcontent-ref %}

## Attacks

### Triggers

攻撃を開始するには、まずビルドをトリガーする方法を知る必要があります。デフォルトでは、TravisCIは**プッシュとプルリクエストでビルドをトリガーします**：

![](<../../.gitbook/assets/image (145).png>)

#### Cron Jobs

ウェブアプリケーションにアクセスできる場合、**ビルドを実行するためのcronを設定できます**。これは持続性のためやビルドをトリガーするために役立ちます：

![](<../../.gitbook/assets/image (243).png>)

{% hint style="info" %}
[こちら](https://github.com/travis-ci/travis-ci/issues/9162)によると、`.travis.yml`内でcronを設定することはできないようです。
{% endhint %}

### Third Party PR

TravisCIはデフォルトで、第三者からのPRと環境変数を共有することを無効にしていますが、誰かがそれを有効にすると、リポジトリにPRを作成して秘密を抽出することができます：

![](<../../.gitbook/assets/image (208).png>)

### Dumping Secrets

[**基本情報**](basic-travisci-information.md)ページで説明されているように、秘密には2種類あります。**環境変数の秘密**（ウェブページにリストされています）と、**カスタム暗号化された秘密**で、これは`.travis.yml`ファイル内にbase64として保存されています（両方とも暗号化されて保存されると、最終的なマシンの環境変数として表示されます）。

* **環境変数**として設定された**秘密を列挙する**には、**プロジェクトの設定**に移動し、リストを確認します。ただし、ここで設定されたすべてのプロジェクト環境変数は、ビルドをトリガーすると表示されます。
* **カスタム暗号化された秘密**を列挙するには、最善の方法は**`.travis.yml`ファイルを確認する**ことです。
* **暗号化されたファイル**を列挙するには、リポジトリ内の**`.enc`ファイル**を確認するか、設定ファイル内の`openssl aes-256-cbc -K $encrypted_355e94ba1091_key -iv $encrypted_355e94ba1091_iv -in super_secret.txt.enc -out super_secret.txt -d`に似た行を探すか、次のような**環境変数**内の**暗号化されたivとキー**を探します：

![](<../../.gitbook/assets/image (81).png>)

### TODO:

* Windows/Mac/Linuxで実行されるリバースシェルを持つビルドの例
* ログにbase64エンコードされたenvを漏洩させるビルドの例

### TravisCI Enterprise

攻撃者が**TravisCIエンタープライズ**を使用している環境に入った場合（これが何であるかの詳細は[**基本情報**](basic-travisci-information.md#travisci-enterprise)にあります）、彼は**Workerでビルドをトリガーする**ことができます。これは、攻撃者がそのサーバーに横移動できることを意味し、そこから次のことができる可能性があります：

* ホストに逃げる？
* Kubernetesを侵害する？
* 同じネットワーク内の他のマシンを侵害する？
* 新しいクラウド資格情報を侵害する？

## References

* [https://docs.travis-ci.com/user/encrypting-files/](https://docs.travis-ci.com/user/encrypting-files/)
* [https://docs.travis-ci.com/user/best-practices-security](https://docs.travis-ci.com/user/best-practices-security)

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** 💬 [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
