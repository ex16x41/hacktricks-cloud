# Gitea Security

{% hint style="success" %}
NauÄite i veÅ¾bajte AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
NauÄite i veÅ¾bajte GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>PodrÅ¾ite HackTricks</summary>

* Pogledajte [**planove pretplate**](https://github.com/sponsors/carlospolop)!
* **PridruÅ¾ite se** ğŸ’¬ [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili **pratite** nas na **Twitteru** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Delite hacking trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
{% endhint %}

## Å ta je Gitea

**Gitea** je **self-hosted community managed lightweight code hosting** reÅ¡enje napisano u Go.

![](<../../.gitbook/assets/image (160).png>)

### Osnovne Informacije

{% content-ref url="basic-gitea-information.md" %}
[basic-gitea-information.md](basic-gitea-information.md)
{% endcontent-ref %}

## Lab

Da biste pokrenuli Gitea instancu lokalno, moÅ¾ete jednostavno pokrenuti docker container:
```bash
docker run -p 3000:3000 gitea/gitea
```
PoveÅ¾ite se na port 3000 da biste pristupili veb stranici.

TakoÄ‘e moÅ¾ete pokrenuti sa kubernetes:
```
helm repo add gitea-charts https://dl.gitea.io/charts/
helm install gitea gitea-charts/gitea
```
## Neautentifikovano Enumerisanje

* Javni repozitorijumi: [http://localhost:3000/explore/repos](http://localhost:3000/explore/repos)
* Registrovani korisnici: [http://localhost:3000/explore/users](http://localhost:3000/explore/users)
* Registrovane organizacije: [http://localhost:3000/explore/organizations](http://localhost:3000/explore/organizations)

Napomena da **Gitea po defaultu omoguÄ‡ava novim korisnicima da se registruju**. Ovo neÄ‡e dati posebno interesantan pristup novim korisnicima nad repozitorijumima drugih organizacija/korisnika, ali **ulogovani korisnik** moÅ¾e biti u moguÄ‡nosti da **vizualizuje viÅ¡e repozitorijuma ili organizacija**.

## Interna Eksploatacija

Za ovaj scenario pretpostavljamo da ste dobili neki pristup github nalogu.

### Sa KorisniÄkim Kredencijalima/Web KolaÄiÄ‡em

Ako nekako veÄ‡ imate kredencijale za korisnika unutar organizacije (ili ste ukrali sesijski kolaÄiÄ‡) moÅ¾ete se **samo prijaviti** i proveriti koje **dozvole imate** nad kojim **repozitorijumima**, u **kojim timovima** ste, **listati druge korisnike**, i **kako su repozitorijumi zaÅ¡tiÄ‡eni.**

Napomena da se moÅ¾e koristiti **2FA** tako da Ä‡ete moÄ‡i pristupiti ovim informacijama samo ako moÅ¾ete **proÄ‡i tu proveru**.

{% hint style="info" %}
Napomena da ako **uspeÅ¡no ukradete `i_like_gitea` kolaÄiÄ‡** (trenutno konfigurisan sa SameSite: Lax) moÅ¾ete **potpuno imitirati korisnika** bez potrebe za kredencijalima ili 2FA.
{% endhint %}

### Sa KorisniÄkim SSH KljuÄem

Gitea omoguÄ‡ava **korisnicima** da postave **SSH kljuÄeve** koji Ä‡e se koristiti kao **metod autentifikacije za deploy koda** u njihovo ime (2FA se ne primenjuje).

Sa ovim kljuÄem moÅ¾ete vrÅ¡iti **promene u repozitorijumima gde korisnik ima neke privilegije**, meÄ‘utim ne moÅ¾ete ga koristiti za pristup gitea api-ju za enumerisanje okruÅ¾enja. Ipak, moÅ¾ete **enumerisati lokalna podeÅ¡avanja** da biste dobili informacije o repozitorijumima i korisniku kojem imate pristup:
```bash
# Go to the the repository folder
# Get repo config and current user name and email
git config --list
```
Ako je korisnik konfigurisao svoje korisniÄko ime kao svoje gitea korisniÄko ime, moÅ¾ete pristupiti **javnim kljuÄevima koje je postavio** na svom nalogu na _https://github.com/\<gitea\_username>.keys_, moÅ¾ete ovo proveriti da potvrdite da privatni kljuÄ koji ste pronaÅ¡li moÅ¾e biti koriÅ¡Ä‡en.

**SSH kljuÄevi** takoÄ‘e mogu biti postavljeni u repozitorijume kao **deploy keys**. Svako ko ima pristup ovom kljuÄu moÄ‡i Ä‡e da **pokrene projekte iz repozitorijuma**. ObiÄno na serveru sa razliÄitim deploy keys lokalni fajl **`~/.ssh/config`** Ä‡e vam dati informacije o tome koji kljuÄ je povezan.

#### GPG Keys

Kao Å¡to je objaÅ¡njeno [**ovde**](https://github.com/carlospolop/hacktricks-cloud/blob/master/pentesting-ci-cd/gitea-security/broken-reference/README.md) ponekad je potrebno potpisati commit-ove ili moÅ¾ete biti otkriveni.

Proverite lokalno da li trenutni korisnik ima neki kljuÄ sa:
```shell
gpg --list-secret-keys --keyid-format=long
```
### Sa korisniÄkim tokenom

Za uvod o [**korisniÄkim tokenima pogledajte osnovne informacije**](basic-gitea-information.md#personal-access-tokens).

KorisniÄki token moÅ¾e se koristiti **umesto lozinke** za **autentifikaciju** na Gitea server [**preko API-ja**](https://try.gitea.io/api/swagger#/). ImaÄ‡e **potpun pristup** korisniku.

### Sa Oauth aplikacijom

Za uvod o [**Gitea Oauth aplikacijama pogledajte osnovne informacije**](./#with-oauth-application).

NapadaÄ moÅ¾e kreirati **zlonamernu Oauth aplikaciju** kako bi pristupio privilegovanim podacima/akcijama korisnika koji ih prihvate, verovatno kao deo phishing kampanje.

Kao Å¡to je objaÅ¡njeno u osnovnim informacijama, aplikacija Ä‡e imati **potpun pristup korisniÄkom nalogu**.

### ZaobilaÅ¾enje zaÅ¡tite grana

Na Github-u imamo **github actions** koji po defaultu dobijaju **token sa pravom pisanja** nad repo-om koji se moÅ¾e koristiti za **zaobilaÅ¾enje zaÅ¡tite grana**. U ovom sluÄaju to **ne postoji**, pa su zaobilaÅ¾enja ograniÄenija. Ali hajde da pogledamo Å¡ta se moÅ¾e uraditi:

* **OmoguÄ‡i Push**: Ako bilo ko sa pravom pisanja moÅ¾e da push-uje na granu, samo push-ujte na nju.
* **Whitelist ograniÄenog Push-a**: Na isti naÄin, ako ste deo ove liste, push-ujte na granu.
* **OmoguÄ‡i Merge Whitelist**: Ako postoji merge whitelist, morate biti unutar nje.
* **Zahtevaj odobrenja veÄ‡a od 0**: Onda... morate kompromitovati drugog korisnika.
* **OgraniÄi odobrenja na whitelistovane**: Ako samo whitelistovani korisnici mogu odobriti... morate kompromitovati drugog korisnika koji je na toj listi.
* **Odbaci zastarela odobrenja**: Ako odobrenja nisu uklonjena sa novim commit-ovima, moÅ¾ete preuzeti veÄ‡ odobren PR da ubacite svoj kod i spojite PR.

Napomena da **ako ste org/repo admin** moÅ¾ete zaobiÄ‡i zaÅ¡tite.

### Enumeracija Webhook-ova

**Webhook-ovi** mogu **slati specifiÄne gitea informacije na neka mesta**. MoÅ¾da Ä‡ete moÄ‡i da **iskoristite tu komunikaciju**.\
MeÄ‘utim, obiÄno je postavljen **tajni kljuÄ** koji **ne moÅ¾ete preuzeti** u **webhook-u** koji Ä‡e **spreÄiti** spoljne korisnike koji znaju URL webhook-a, ali ne i tajni kljuÄ, da **iskoriste taj webhook**.\
Ali u nekim sluÄajevima, ljudi umesto da postave **tajni kljuÄ** na svoje mesto, oni ga **postavljaju u URL** kao parametar, pa **proveravanje URL-ova** moÅ¾e vam omoguÄ‡iti da **pronaÄ‘ete tajne kljuÄeve** i druga mesta koja moÅ¾ete dalje iskoristiti.

Webhook-ovi mogu biti postavljeni na **repo i na org nivou**.

## Post Eksploatacija

### Unutar servera

Ako ste nekako uspeli da uÄ‘ete u server na kojem radi gitea, trebali biste potraÅ¾iti gitea konfiguracioni fajl. Po defaultu se nalazi u `/data/gitea/conf/app.ini`

U ovom fajlu moÅ¾ete pronaÄ‡i **kljuÄeve** i **lozinke**.

U gitea putanji (po defaultu: /data/gitea) moÅ¾ete pronaÄ‡i i zanimljive informacije kao Å¡to su:

* **sqlite** DB: Ako gitea ne koristi eksterni db, koristiÄ‡e sqlite db
* **sesije** unutar foldera sesija: Pokretanjem `cat sessions/*/*/*` moÅ¾ete videti korisniÄka imena prijavljenih korisnika (gitea moÅ¾e takoÄ‘e Äuvati sesije unutar DB-a).
* **jwt privatni kljuÄ** unutar jwt foldera
* ViÅ¡e **osetljivih informacija** moÅ¾e se pronaÄ‡i u ovom folderu

Ako ste unutar servera, moÅ¾ete takoÄ‘e **koristiti `gitea` binarni fajl** za pristup/modifikaciju informacija:

* `gitea dump` Ä‡e dump-ovati gitea i generisati .zip fajl
* `gitea generate secret INTERNAL_TOKEN/JWT_SECRET/SECRET_KEY/LFS_JWT_SECRET` Ä‡e generisati token navedenog tipa (perzistencija)
* `gitea admin user change-password --username admin --password newpassword` Promeni lozinku
* `gitea admin user create --username newuser --password superpassword --email user@user.user --admin --access-token` Kreiraj novog admin korisnika i dobij pristupni token

{% hint style="success" %}
NauÄite i veÅ¾bajte AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
NauÄite i veÅ¾bajte GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>PodrÅ¾ite HackTricks</summary>

* Pogledajte [**planove pretplate**](https://github.com/sponsors/carlospolop)!
* **PridruÅ¾ite se** ğŸ’¬ [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili **pratite** nas na **Twitter-u** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Delite hakovanje trikove podnoÅ¡enjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
{% endhint %}
