# Gitea Sicherheit

{% hint style="success" %}
Lerne & √ºbe AWS Hacking:<img src="../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Lerne & √ºbe GCP Hacking: <img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Unterst√ºtze HackTricks</summary>

* √úberpr√ºfe die [**Abonnementpl√§ne**](https://github.com/sponsors/carlospolop)!
* **Tritt der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folge** uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teile Hacking-Tricks, indem du PRs zu den** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repos einreichst.

</details>
{% endhint %}

## Was ist Gitea

**Gitea** ist eine **selbstgehostete, von der Community verwaltete, leichte Code-Hosting**-L√∂sung, die in Go geschrieben ist.

![](<../../.gitbook/assets/image (160).png>)

### Grundinformationen

{% content-ref url="basic-gitea-information.md" %}
[basic-gitea-information.md](basic-gitea-information.md)
{% endcontent-ref %}

## Labor

Um eine Gitea-Instanz lokal auszuf√ºhren, kannst du einfach einen Docker-Container starten:
```bash
docker run -p 3000:3000 gitea/gitea
```
Verbinden Sie sich mit Port 3000, um auf die Webseite zuzugreifen.

Sie k√∂nnen es auch mit Kubernetes ausf√ºhren:
```
helm repo add gitea-charts https://dl.gitea.io/charts/
helm install gitea gitea-charts/gitea
```
## Unauthenticated Enumeration

* √ñffentliche Repos: [http://localhost:3000/explore/repos](http://localhost:3000/explore/repos)
* Registrierte Benutzer: [http://localhost:3000/explore/users](http://localhost:3000/explore/users)
* Registrierte Organisationen: [http://localhost:3000/explore/organizations](http://localhost:3000/explore/organizations)

Beachten Sie, dass **Gitea standardm√§√üig neuen Benutzern die Registrierung erlaubt**. Dies wird den neuen Benutzern keinen besonders interessanten Zugriff auf die Repos anderer Organisationen/Benutzer geben, aber ein **eingeloggter Benutzer** k√∂nnte in der Lage sein, **mehr Repos oder Organisationen zu visualisieren**.

## Internal Exploitation

F√ºr dieses Szenario nehmen wir an, dass Sie Zugriff auf ein GitHub-Konto erhalten haben.

### Mit Benutzeranmeldeinformationen/Web-Cookie

Wenn Sie irgendwie bereits Anmeldeinformationen f√ºr einen Benutzer innerhalb einer Organisation haben (oder Sie einen Sitzungscookie gestohlen haben), k√∂nnen Sie **einfach einloggen** und √ºberpr√ºfen, √ºber welche **Berechtigungen Sie verf√ºgen** f√ºr welche **Repos,** in **welchen Teams** Sie sind, **andere Benutzer auflisten** und **wie die Repos gesch√ºtzt sind.**

Beachten Sie, dass **2FA verwendet werden kann**, sodass Sie diese Informationen nur abrufen k√∂nnen, wenn Sie auch **diesen Check bestehen**.

{% hint style="info" %}
Beachten Sie, dass wenn Sie **es schaffen, den `i_like_gitea` Cookie zu stehlen** (der derzeit mit SameSite: Lax konfiguriert ist), k√∂nnen Sie **den Benutzer vollst√§ndig impersonifizieren**, ohne Anmeldeinformationen oder 2FA zu ben√∂tigen.
{% endhint %}

### Mit Benutzer-SSH-Schl√ºssel

Gitea erlaubt **Benutzern**, **SSH-Schl√ºssel** festzulegen, die als **Authentifizierungsmethode zum Bereitstellen von Code** in ihrem Namen verwendet werden (es wird keine 2FA angewendet).

Mit diesem Schl√ºssel k√∂nnen Sie **√Ñnderungen in Repositories vornehmen, in denen der Benutzer einige Berechtigungen hat**, jedoch k√∂nnen Sie ihn nicht verwenden, um auf die Gitea-API zuzugreifen, um die Umgebung aufzulisten. Sie k√∂nnen jedoch **lokale Einstellungen auflisten**, um Informationen √ºber die Repos und Benutzer zu erhalten, auf die Sie Zugriff haben:
```bash
# Go to the the repository folder
# Get repo config and current user name and email
git config --list
```
Wenn der Benutzer seinen Benutzernamen als seinen gitea Benutzernamen konfiguriert hat, k√∂nnen Sie auf die **√∂ffentlichen Schl√ºssel, die er in seinem Konto festgelegt hat**, unter _https://github.com/\<gitea\_username>.keys_ zugreifen. Sie k√∂nnten dies √ºberpr√ºfen, um zu best√§tigen, dass der private Schl√ºssel, den Sie gefunden haben, verwendet werden kann.

**SSH-Schl√ºssel** k√∂nnen auch in Repositories als **Deploy-Schl√ºssel** festgelegt werden. Jeder, der Zugriff auf diesen Schl√ºssel hat, kann **Projekte aus einem Repository starten**. In einem Server mit verschiedenen Deploy-Schl√ºsseln gibt die lokale Datei **`~/.ssh/config`** Informationen dar√ºber, welcher Schl√ºssel zugeordnet ist.

#### GPG-Schl√ºssel

Wie [**hier**](https://github.com/carlospolop/hacktricks-cloud/blob/master/pentesting-ci-cd/gitea-security/broken-reference/README.md) erkl√§rt, ist es manchmal notwendig, die Commits zu signieren, oder Sie k√∂nnten entdeckt werden.

√úberpr√ºfen Sie lokal, ob der aktuelle Benutzer einen Schl√ºssel hat mit:
```shell
gpg --list-secret-keys --keyid-format=long
```
### Mit Benutzer-Token

F√ºr eine Einf√ºhrung zu [**Benutzer-Token siehe die grundlegenden Informationen**](basic-gitea-information.md#personal-access-tokens).

Ein Benutzer-Token kann **anstatt eines Passworts** verwendet werden, um sich **gegen√ºber dem Gitea-Server** [**√ºber die API**](https://try.gitea.io/api/swagger#/) zu **authentifizieren**. Es hat **vollst√§ndigen Zugriff** auf den Benutzer.

### Mit Oauth-Anwendung

F√ºr eine Einf√ºhrung zu [**Gitea Oauth-Anwendungen siehe die grundlegenden Informationen**](./#with-oauth-application).

Ein Angreifer k√∂nnte eine **b√∂sartige Oauth-Anwendung** erstellen, um auf privilegierte Daten/Aktionen der Benutzer zuzugreifen, die sie wahrscheinlich als Teil einer Phishing-Kampagne akzeptieren.

Wie in den grundlegenden Informationen erkl√§rt, hat die Anwendung **vollen Zugriff auf das Benutzerkonto**.

### Umgehung des Branch-Schutzes

In Github haben wir **github actions**, die standardm√§√üig ein **Token mit Schreibzugriff** auf das Repo erhalten, das verwendet werden kann, um **Branch-Schutzma√ünahmen zu umgehen**. In diesem Fall **existiert das nicht**, sodass die Umgehungen eingeschr√§nkter sind. Aber schauen wir uns an, was getan werden kann:

* **Push aktivieren**: Wenn jemand mit Schreibzugriff auf den Branch pushen kann, dann einfach darauf pushen.
* **Whitelist f√ºr eingeschr√§nkten Push**: Auf die gleiche Weise, wenn du Teil dieser Liste bist, push auf den Branch.
* **Merge-Whitelist aktivieren**: Wenn es eine Merge-Whitelist gibt, musst du darin sein.
* **Genehmigungen m√ºssen gr√∂√üer als 0 sein**: Dann... musst du einen anderen Benutzer kompromittieren.
* **Genehmigungen auf Whitelist beschr√§nken**: Wenn nur Benutzer auf der Whitelist genehmigen k√∂nnen... musst du einen anderen Benutzer kompromittieren, der in dieser Liste ist.
* **Veraltete Genehmigungen zur√ºckweisen**: Wenn Genehmigungen nicht mit neuen Commits entfernt werden, k√∂nntest du einen bereits genehmigten PR hijacken, um deinen Code einzuf√ºgen und den PR zu mergen.

Beachte, dass **wenn du ein Org/Repo-Admin bist**, du die Schutzma√ünahmen umgehen kannst.

### Webhooks auflisten

**Webhooks** sind in der Lage, **spezifische Gitea-Informationen an bestimmte Orte zu senden**. Du k√∂nntest in der Lage sein, **diese Kommunikation auszunutzen**.\
Allerdings wird normalerweise ein **Geheimnis**, das du **nicht abrufen kannst**, im **Webhook** festgelegt, das **verhindert**, dass externe Benutzer, die die URL des Webhooks, aber nicht das Geheimnis kennen, **diesen Webhook ausnutzen**.\
In einigen F√§llen setzen Leute anstelle des Setzens des **Geheimnisses** an seinem Platz, es **als Parameter in die URL**, sodass **das √úberpr√ºfen der URLs** dir erm√∂glichen k√∂nnte, **Geheimnisse** und andere Orte zu finden, die du weiter ausnutzen k√∂nntest.

Webhooks k√∂nnen auf **Repo- und Org-Ebene** festgelegt werden.

## Nach der Ausnutzung

### Innerhalb des Servers

Wenn du es irgendwie geschafft hast, in den Server, auf dem Gitea l√§uft, zu gelangen, solltest du nach der Gitea-Konfigurationsdatei suchen. Standardm√§√üig befindet sie sich in `/data/gitea/conf/app.ini`.

In dieser Datei kannst du **Schl√ºssel** und **Passw√∂rter** finden.

Im Gitea-Pfad (standardm√§√üig: /data/gitea) kannst du auch interessante Informationen finden wie:

* Die **sqlite** DB: Wenn Gitea keine externe DB verwendet, wird es eine sqlite DB verwenden.
* Die **Sitzungen** im Sitzungsordner: Mit `cat sessions/*/*/*` kannst du die Benutzernamen der angemeldeten Benutzer sehen (Gitea k√∂nnte auch die Sitzungen in der DB speichern).
* Der **jwt private key** im jwt-Ordner.
* Weitere **sensible Informationen** k√∂nnten in diesem Ordner gefunden werden.

Wenn du im Server bist, kannst du auch **die `gitea`-Binary** verwenden, um Informationen zuzugreifen/zu √§ndern:

* `gitea dump` wird Gitea dumpen und eine .zip-Datei generieren.
* `gitea generate secret INTERNAL_TOKEN/JWT_SECRET/SECRET_KEY/LFS_JWT_SECRET` wird ein Token des angegebenen Typs (Persistenz) generieren.
* `gitea admin user change-password --username admin --password newpassword` √Ñndere das Passwort.
* `gitea admin user create --username newuser --password superpassword --email user@user.user --admin --access-token` Erstelle einen neuen Admin-Benutzer und erhalte ein Zugriffstoken.

{% hint style="success" %}
Lerne & √ºbe AWS Hacking:<img src="../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Lerne & √ºbe GCP Hacking: <img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Unterst√ºtze HackTricks</summary>

* √úberpr√ºfe die [**Abonnementpl√§ne**](https://github.com/sponsors/carlospolop)!
* **Tritt der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folge** uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teile Hacking-Tricks, indem du PRs zu den** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repos einreichst.

</details>
{% endhint %}
