# Gitea Security

{% hint style="success" %}
AWS Hacking Ã¶ÄŸrenin ve pratik yapÄ±n:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCP Hacking Ã¶ÄŸrenin ve pratik yapÄ±n: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**abonelik planlarÄ±nÄ±**](https://github.com/sponsors/carlospolop) kontrol edin!
* **ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n ya da **Twitter'da** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**'Ä± takip edin.**
* **HackTricks** ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na PR gÃ¶ndererek hacking ipuÃ§larÄ±nÄ± paylaÅŸÄ±n.

</details>
{% endhint %}

## Gitea Nedir

**Gitea**, Go ile yazÄ±lmÄ±ÅŸ **topluluk tarafÄ±ndan yÃ¶netilen hafif bir kod barÄ±ndÄ±rma** Ã§Ã¶zÃ¼mÃ¼dÃ¼r.

![](<../../.gitbook/assets/image (160).png>)

### Temel Bilgiler

{% content-ref url="basic-gitea-information.md" %}
[basic-gitea-information.md](basic-gitea-information.md)
{% endcontent-ref %}

## Lab

Yerel olarak bir Gitea Ã¶rneÄŸi Ã§alÄ±ÅŸtÄ±rmak iÃ§in sadece bir docker konteyneri Ã§alÄ±ÅŸtÄ±rabilirsiniz:
```bash
docker run -p 3000:3000 gitea/gitea
```
Port 3000'e baÄŸlanarak web sayfasÄ±na eriÅŸebilirsiniz.

AyrÄ±ca bunu kubernetes ile de Ã§alÄ±ÅŸtÄ±rabilirsiniz:
```
helm repo add gitea-charts https://dl.gitea.io/charts/
helm install gitea gitea-charts/gitea
```
## Kimlik DoÄŸrulamasÄ± Olmadan NumaralandÄ±rma

* Public repos: [http://localhost:3000/explore/repos](http://localhost:3000/explore/repos)
* Registered users: [http://localhost:3000/explore/users](http://localhost:3000/explore/users)
* Registered Organizations: [http://localhost:3000/explore/organizations](http://localhost:3000/explore/organizations)

**Gitea'nÄ±n varsayÄ±lan olarak yeni kullanÄ±cÄ±larÄ±n kayÄ±t olmasÄ±na izin verdiÄŸini** unutmayÄ±n. Bu, yeni kullanÄ±cÄ±lara diÄŸer organizasyonlar/kullanÄ±cÄ±lar Ã¼zerindeki repolara Ã¶zel bir eriÅŸim saÄŸlamaz, ancak **giriÅŸ yapmÄ±ÅŸ bir kullanÄ±cÄ±** **daha fazla repo veya organizasyonu** gÃ¶rebilir.

## Dahili SÃ¶mÃ¼rÃ¼

Bu senaryoda bir github hesabÄ±na bir ÅŸekilde eriÅŸim saÄŸladÄ±ÄŸÄ±nÄ±zÄ± varsayacaÄŸÄ±z.

### KullanÄ±cÄ± Kimlik Bilgileri/Web Ã‡erezi ile

Bir organizasyon iÃ§indeki bir kullanÄ±cÄ± iÃ§in kimlik bilgilerine (veya bir oturum Ã§erezini Ã§aldÄ±ysanÄ±z) sahipseniz, **sadece giriÅŸ yapabilir** ve **hangi izinlere sahip olduÄŸunuzu**, **hangi repolarda**, **hangi takÄ±mlarda** olduÄŸunuzu, **diÄŸer kullanÄ±cÄ±larÄ± listeleyebilir** ve **repolar nasÄ±l korunuyor** kontrol edebilirsiniz.

**2FA kullanÄ±labilir** olduÄŸunu unutmayÄ±n, bu nedenle bu bilgilere yalnÄ±zca bu kontrolÃ¼ de geÃ§ebilirseniz eriÅŸebilirsiniz.

{% hint style="info" %}
**`i_like_gitea` Ã§erezini Ã§almayÄ± baÅŸarÄ±rsanÄ±z** (ÅŸu anda SameSite: Lax ile yapÄ±landÄ±rÄ±lmÄ±ÅŸ) **kullanÄ±cÄ±yÄ± tamamen taklit edebilir** ve kimlik bilgilerine veya 2FA'ya ihtiyaÃ§ duymadan giriÅŸ yapabilirsiniz.
{% endhint %}

### KullanÄ±cÄ± SSH AnahtarÄ± ile

Gitea, **kullanÄ±cÄ±larÄ±n** **SSH anahtarlarÄ±** ayarlamasÄ±na izin verir, bu anahtarlar **kod daÄŸÄ±tÄ±mÄ± iÃ§in kimlik doÄŸrulama yÃ¶ntemi** olarak kullanÄ±lÄ±r (2FA uygulanmaz).

Bu anahtar ile **kullanÄ±cÄ±nÄ±n bazÄ± ayrÄ±calÄ±klara sahip olduÄŸu repolarda deÄŸiÅŸiklikler yapabilirsiniz**, ancak gitea api'ye eriÅŸmek iÃ§in kullanamazsÄ±nÄ±z. Ancak, **eriÅŸiminiz olan repolar ve kullanÄ±cÄ± hakkÄ±nda bilgi almak iÃ§in yerel ayarlarÄ± numaralandÄ±rabilirsiniz**:
```bash
# Go to the the repository folder
# Get repo config and current user name and email
git config --list
```
EÄŸer kullanÄ±cÄ±, kullanÄ±cÄ± adÄ±nÄ± gitea kullanÄ±cÄ± adÄ± olarak yapÄ±landÄ±rdÄ±ysa, hesabÄ±nda ayarladÄ±ÄŸÄ± **aÃ§Ä±k anahtarlara** _https://github.com/\<gitea\_username>.keys_ adresinden eriÅŸebilirsiniz, bulduÄŸunuz Ã¶zel anahtarÄ±n kullanÄ±labilir olduÄŸunu doÄŸrulamak iÃ§in bunu kontrol edebilirsiniz.

**SSH anahtarlarÄ±** ayrÄ±ca depolarda **deploy keys** olarak da ayarlanabilir. Bu anahtara eriÅŸimi olan herkes bir depodan **projeleri baÅŸlatabilir**. Genellikle farklÄ± deploy keys olan bir sunucuda yerel dosya **`~/.ssh/config`** size hangi anahtarÄ±n ilgili olduÄŸu hakkÄ±nda bilgi verecektir.

#### GPG Keys

[**Burada**](https://github.com/carlospolop/hacktricks-cloud/blob/master/pentesting-ci-cd/gitea-security/broken-reference/README.md) aÃ§Ä±klandÄ±ÄŸÄ± gibi bazen commit'leri imzalamak gerekebilir veya keÅŸfedilebilirsiniz.

Mevcut kullanÄ±cÄ±nÄ±n herhangi bir anahtarÄ± olup olmadÄ±ÄŸÄ±nÄ± yerel olarak kontrol edin:
```shell
gpg --list-secret-keys --keyid-format=long
```
### KullanÄ±cÄ± Tokeni ile

[**KullanÄ±cÄ± Tokenleri hakkÄ±nda temel bilgileri**](basic-gitea-information.md#personal-access-tokens) inceleyin.

Bir kullanÄ±cÄ± tokeni, Gitea sunucusuna [**API Ã¼zerinden**](https://try.gitea.io/api/swagger#/) **kimlik doÄŸrulama** yapmak iÃ§in **ÅŸifre yerine** kullanÄ±labilir. Bu, kullanÄ±cÄ± Ã¼zerinde **tam eriÅŸim** saÄŸlar.

### Oauth UygulamasÄ± ile

[**Gitea Oauth UygulamalarÄ± hakkÄ±nda temel bilgileri**](./#with-oauth-application) inceleyin.

Bir saldÄ±rgan, kullanÄ±cÄ±larÄ±n kabul ettiÄŸi **kÃ¶tÃ¼ niyetli bir Oauth UygulamasÄ±** oluÅŸturabilir ve bu uygulama muhtemelen bir phishing kampanyasÄ±nÄ±n parÃ§asÄ± olarak ayrÄ±calÄ±klÄ± verilere/eylemlere eriÅŸebilir.

Temel bilgilerde aÃ§Ä±klandÄ±ÄŸÄ± gibi, uygulama **kullanÄ±cÄ± hesabÄ± Ã¼zerinde tam eriÅŸime** sahip olacaktÄ±r.

### Branch Koruma Atlatma

Github'da, varsayÄ±lan olarak repo Ã¼zerinde **yazma eriÅŸimi olan bir token** alan **github actions** vardÄ±r ve bu, **branch korumalarÄ±nÄ± atlatmak** iÃ§in kullanÄ±labilir. Bu durumda bu **mevcut deÄŸil**, bu yÃ¼zden atlatmalar daha sÄ±nÄ±rlÄ±dÄ±r. Ama neler yapÄ±labileceÄŸine bir gÃ¶z atalÄ±m:

* **Push EtkinleÅŸtir**: Yazma eriÅŸimi olan biri branch'e push yapabiliyorsa, sadece push yapÄ±n.
* **Whitelist KÄ±sÄ±tlÄ± Push**: AynÄ± ÅŸekilde, bu listenin bir parÃ§asÄ±ysanÄ±z branch'e push yapÄ±n.
* **Merge Whitelist EtkinleÅŸtir**: Bir merge whitelist varsa, iÃ§inde olmanÄ±z gerekir.
* **Onay gereksinimi 0'dan bÃ¼yÃ¼kse**: O zaman... baÅŸka bir kullanÄ±cÄ±yÄ± ele geÃ§irmeniz gerekir.
* **OnaylarÄ± whitelist ile kÄ±sÄ±tla**: Sadece whitelist kullanÄ±cÄ±larÄ± onaylayabiliyorsa... bu listenin iÃ§inde olan baÅŸka bir kullanÄ±cÄ±yÄ± ele geÃ§irmeniz gerekir.
* **Eski onaylarÄ± reddet**: Onaylar yeni commitlerle kaldÄ±rÄ±lmÄ±yorsa, zaten onaylanmÄ±ÅŸ bir PR'Ä± ele geÃ§irip kodunuzu enjekte edebilir ve PR'Ä± birleÅŸtirebilirsiniz.

**EÄŸer bir org/repo yÃ¶neticisiyseniz** korumalarÄ± atlatabileceÄŸinizi unutmayÄ±n.

### WebhooklarÄ± NumaralandÄ±rma

**Webhooklar**, **belirli gitea bilgilerini bazÄ± yerlere gÃ¶nderebilir**. Bu iletiÅŸimi **istismar edebilirsiniz**.\
Ancak, genellikle **geri alÄ±namayan bir gizli anahtar** webhookta ayarlanÄ±r ve bu, URL'yi bilen ancak gizli anahtarÄ± bilmeyen dÄ±ÅŸ kullanÄ±cÄ±larÄ±n **webhooku istismar etmesini** engeller.\
Ama bazÄ± durumlarda, insanlar **gizli anahtarÄ±** yerine **URL'ye** bir parametre olarak ayarlarlar, bu yÃ¼zden **URL'leri kontrol etmek** size **gizli anahtarlarÄ±** ve daha fazla istismar edebileceÄŸiniz yerleri bulmanÄ±zÄ± saÄŸlayabilir.

Webhooklar **repo ve org seviyesinde** ayarlanabilir.

## Ä°stismar SonrasÄ±

### Sunucunun Ä°Ã§inde

EÄŸer bir ÅŸekilde gitea'nÄ±n Ã§alÄ±ÅŸtÄ±ÄŸÄ± sunucunun iÃ§ine girmeyi baÅŸardÄ±ysanÄ±z, gitea yapÄ±landÄ±rma dosyasÄ±nÄ± aramalÄ±sÄ±nÄ±z. VarsayÄ±lan olarak `/data/gitea/conf/app.ini` konumundadÄ±r.

Bu dosyada **anahtarlar** ve **ÅŸifreler** bulabilirsiniz.

Gitea yolunda (varsayÄ±lan: /data/gitea) ayrÄ±ca ilginÃ§ bilgiler bulabilirsiniz, Ã¶rneÄŸin:

* **sqlite** DB: EÄŸer gitea harici bir db kullanmÄ±yorsa, bir sqlite db kullanacaktÄ±r.
* Oturum klasÃ¶rÃ¼nÃ¼n iÃ§indeki **oturumlar**: `cat sessions/*/*/*` komutunu Ã§alÄ±ÅŸtÄ±rarak oturum aÃ§mÄ±ÅŸ kullanÄ±cÄ±larÄ±n kullanÄ±cÄ± adlarÄ±nÄ± gÃ¶rebilirsiniz (gitea oturumlarÄ± DB iÃ§inde de saklayabilir).
* jwt klasÃ¶rÃ¼nÃ¼n iÃ§indeki **jwt Ã¶zel anahtarÄ±**
* Bu klasÃ¶rde daha fazla **hassas bilgi** bulunabilir.

Sunucunun iÃ§indeyseniz, ayrÄ±ca **`gitea` binary'sini** kullanarak bilgiye eriÅŸebilir/deÄŸiÅŸtirebilirsiniz:

* `gitea dump` gitea'yÄ± dÃ¶ker ve bir .zip dosyasÄ± oluÅŸturur.
* `gitea generate secret INTERNAL_TOKEN/JWT_SECRET/SECRET_KEY/LFS_JWT_SECRET` belirtilen tÃ¼rde bir token oluÅŸturur (kalÄ±cÄ±lÄ±k).
* `gitea admin user change-password --username admin --password newpassword` Åifreyi deÄŸiÅŸtirir.
* `gitea admin user create --username newuser --password superpassword --email user@user.user --admin --access-token` Yeni bir admin kullanÄ±cÄ± oluÅŸturur ve bir eriÅŸim tokeni alÄ±r.

{% hint style="success" %}
AWS Hacking Ã¶ÄŸrenin ve pratik yapÄ±n:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCP Hacking Ã¶ÄŸrenin ve pratik yapÄ±n: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**Abonelik planlarÄ±nÄ±**](https://github.com/sponsors/carlospolop) kontrol edin!
* **ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n ya da **Twitter'da** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**'Ä± takip edin.**
* **HackTricks'e PR gÃ¶ndererek hacking ipuÃ§larÄ±nÄ± paylaÅŸÄ±n** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na.

</details>
{% endhint %}
