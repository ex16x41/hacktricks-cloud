# Gitea Security

{% hint style="success" %}
å­¦ä¹ å’Œç»ƒä¹  AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
å­¦ä¹ å’Œç»ƒä¹  GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>æ”¯æŒ HackTricks</summary>

* æŸ¥çœ‹ [**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**telegram ç¾¤ç»„**](https://t.me/peass) æˆ– **å…³æ³¨** æˆ‘ä»¬çš„ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **é€šè¿‡æäº¤ PRs åˆ†äº«é»‘å®¢æŠ€å·§åˆ°** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ä»“åº“ã€‚

</details>
{% endhint %}

## ä»€ä¹ˆæ˜¯ Gitea

**Gitea** æ˜¯ä¸€ä¸ªç”¨ Go ç¼–å†™çš„ **è‡ªæ‰˜ç®¡ç¤¾åŒºç®¡ç†çš„è½»é‡çº§ä»£ç æ‰˜ç®¡** è§£å†³æ–¹æ¡ˆã€‚

![](<../../.gitbook/assets/image (160).png>)

### åŸºæœ¬ä¿¡æ¯

{% content-ref url="basic-gitea-information.md" %}
[basic-gitea-information.md](basic-gitea-information.md)
{% endcontent-ref %}

## å®éªŒå®¤

è¦åœ¨æœ¬åœ°è¿è¡Œ Gitea å®ä¾‹ï¼Œä½ å¯ä»¥è¿è¡Œä¸€ä¸ª docker å®¹å™¨ï¼š
```bash
docker run -p 3000:3000 gitea/gitea
```
è¿æ¥åˆ°ç«¯å£3000ä»¥è®¿é—®ç½‘é¡µã€‚

ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨kubernetesè¿è¡Œå®ƒï¼š
```
helm repo add gitea-charts https://dl.gitea.io/charts/
helm install gitea gitea-charts/gitea
```
## æœªè®¤è¯æšä¸¾

* å…¬å…±ä»“åº“: [http://localhost:3000/explore/repos](http://localhost:3000/explore/repos)
* æ³¨å†Œç”¨æˆ·: [http://localhost:3000/explore/users](http://localhost:3000/explore/users)
* æ³¨å†Œç»„ç»‡: [http://localhost:3000/explore/organizations](http://localhost:3000/explore/organizations)

è¯·æ³¨æ„ï¼Œ**é»˜è®¤æƒ…å†µä¸‹ Gitea å…è®¸æ–°ç”¨æˆ·æ³¨å†Œ**ã€‚è¿™ä¸ä¼šç»™æ–°ç”¨æˆ·åœ¨å…¶ä»–ç»„ç»‡/ç”¨æˆ·ä»“åº“ä¸Šç‰¹åˆ«æœ‰è¶£çš„è®¿é—®æƒé™ï¼Œä½†**ç™»å½•ç”¨æˆ·**å¯èƒ½èƒ½å¤Ÿ**æŸ¥çœ‹æ›´å¤šçš„ä»“åº“æˆ–ç»„ç»‡**ã€‚

## å†…éƒ¨åˆ©ç”¨

åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å‡è®¾ä½ å·²ç»è·å¾—äº†ä¸€äº›githubè´¦æˆ·çš„è®¿é—®æƒé™ã€‚

### ä½¿ç”¨ç”¨æˆ·å‡­è¯/ç½‘é¡µCookie

å¦‚æœä½ å·²ç»æ‹¥æœ‰æŸä¸ªç»„ç»‡å†…ç”¨æˆ·çš„å‡­è¯ï¼ˆæˆ–ä½ çªƒå–äº†ä¼šè¯cookieï¼‰ï¼Œä½ å¯ä»¥**ç›´æ¥ç™»å½•**å¹¶æ£€æŸ¥ä½ å¯¹å“ªäº›**ä»“åº“**æœ‰**å“ªäº›æƒé™**ï¼Œä½ åœ¨å“ªäº›**å›¢é˜Ÿ**ä¸­ï¼Œ**åˆ—å‡ºå…¶ä»–ç”¨æˆ·**ï¼Œä»¥åŠ**ä»“åº“æ˜¯å¦‚ä½•ä¿æŠ¤çš„**ã€‚

è¯·æ³¨æ„ï¼Œ**å¯èƒ½ä¼šä½¿ç”¨2FA**ï¼Œæ‰€ä»¥ä½ åªæœ‰åœ¨èƒ½å¤Ÿ**é€šè¿‡è¯¥æ£€æŸ¥**çš„æƒ…å†µä¸‹æ‰èƒ½è®¿é—®è¿™äº›ä¿¡æ¯ã€‚

{% hint style="info" %}
è¯·æ³¨æ„ï¼Œå¦‚æœä½ **è®¾æ³•çªƒå–äº† `i_like_gitea` cookie**ï¼ˆå½“å‰é…ç½®ä¸ºSameSite: Laxï¼‰ï¼Œä½ å¯ä»¥**å®Œå…¨å†’å……è¯¥ç”¨æˆ·**ï¼Œæ— éœ€å‡­è¯æˆ–2FAã€‚
{% endhint %}

### ä½¿ç”¨ç”¨æˆ·SSHå¯†é’¥

Giteaå…è®¸**ç”¨æˆ·**è®¾ç½®**SSHå¯†é’¥**ï¼Œè¿™äº›å¯†é’¥å°†ç”¨ä½œ**ä»£è¡¨ç”¨æˆ·éƒ¨ç½²ä»£ç çš„è®¤è¯æ–¹æ³•**ï¼ˆä¸é€‚ç”¨2FAï¼‰ã€‚

ä½¿ç”¨æ­¤å¯†é’¥ï¼Œä½ å¯ä»¥åœ¨**ç”¨æˆ·æœ‰æŸäº›æƒé™çš„ä»“åº“ä¸­è¿›è¡Œæ›´æ”¹**ï¼Œä½†ä¸èƒ½ç”¨å®ƒè®¿é—®gitea apiæ¥æšä¸¾ç¯å¢ƒã€‚ç„¶è€Œï¼Œä½ å¯ä»¥**æšä¸¾æœ¬åœ°è®¾ç½®**ä»¥è·å–ä½ æœ‰è®¿é—®æƒé™çš„ä»“åº“å’Œç”¨æˆ·çš„ä¿¡æ¯ï¼š
```bash
# Go to the the repository folder
# Get repo config and current user name and email
git config --list
```
å¦‚æœç”¨æˆ·å°†å…¶ç”¨æˆ·åé…ç½®ä¸ºä»–çš„ gitea ç”¨æˆ·åï¼Œæ‚¨å¯ä»¥è®¿é—®ä»–è´¦æˆ·ä¸­è®¾ç½®çš„**å…¬é’¥**ï¼Œç½‘å€ä¸º _https://github.com/\<gitea\_username>.keys_ï¼Œæ‚¨å¯ä»¥æ£€æŸ¥æ­¤é¡¹ä»¥ç¡®è®¤æ‚¨æ‰¾åˆ°çš„ç§é’¥æ˜¯å¦å¯ä»¥ä½¿ç”¨ã€‚

**SSH keys** ä¹Ÿå¯ä»¥åœ¨ä»“åº“ä¸­è®¾ç½®ä¸º**éƒ¨ç½²å¯†é’¥**ã€‚ä»»ä½•æ‹¥æœ‰æ­¤å¯†é’¥çš„äººéƒ½å¯ä»¥**ä»ä»“åº“å¯åŠ¨é¡¹ç›®**ã€‚é€šå¸¸åœ¨å…·æœ‰ä¸åŒéƒ¨ç½²å¯†é’¥çš„æœåŠ¡å™¨ä¸­ï¼Œæœ¬åœ°æ–‡ä»¶ **`~/.ssh/config`** å°†ä¸ºæ‚¨æä¾›æœ‰å…³å¯†é’¥ç›¸å…³çš„ä¿¡æ¯ã€‚

#### GPG Keys

å¦‚[**æ­¤å¤„**](https://github.com/carlospolop/hacktricks-cloud/blob/master/pentesting-ci-cd/gitea-security/broken-reference/README.md)æ‰€è¿°ï¼Œæœ‰æ—¶éœ€è¦å¯¹æäº¤è¿›è¡Œç­¾åï¼Œå¦åˆ™æ‚¨å¯èƒ½ä¼šè¢«å‘ç°ã€‚

åœ¨æœ¬åœ°æ£€æŸ¥å½“å‰ç”¨æˆ·æ˜¯å¦æœ‰ä»»ä½•å¯†é’¥ï¼š
```shell
gpg --list-secret-keys --keyid-format=long
```
### ä½¿ç”¨ç”¨æˆ·ä»¤ç‰Œ

å…³äº[**ç”¨æˆ·ä»¤ç‰Œçš„ä»‹ç»ï¼Œè¯·æŸ¥çœ‹åŸºæœ¬ä¿¡æ¯**](basic-gitea-information.md#personal-access-tokens)ã€‚

ç”¨æˆ·ä»¤ç‰Œå¯ä»¥**ä»£æ›¿å¯†ç **æ¥**è®¤è¯**GiteaæœåŠ¡å™¨[**é€šè¿‡API**](https://try.gitea.io/api/swagger#/)ï¼Œå®ƒå°†æ‹¥æœ‰**å¯¹ç”¨æˆ·çš„å®Œå…¨è®¿é—®æƒé™**ã€‚

### ä½¿ç”¨Oauthåº”ç”¨ç¨‹åº

å…³äº[**Gitea Oauthåº”ç”¨ç¨‹åºçš„ä»‹ç»ï¼Œè¯·æŸ¥çœ‹åŸºæœ¬ä¿¡æ¯**](./#with-oauth-application)ã€‚

æ”»å‡»è€…å¯èƒ½ä¼šåˆ›å»ºä¸€ä¸ª**æ¶æ„çš„Oauthåº”ç”¨ç¨‹åº**æ¥è®¿é—®æ¥å—å®ƒä»¬çš„ç”¨æˆ·çš„ç‰¹æƒæ•°æ®/æ“ä½œï¼Œå¯èƒ½æ˜¯é’“é±¼æ´»åŠ¨çš„ä¸€éƒ¨åˆ†ã€‚

å¦‚åŸºæœ¬ä¿¡æ¯ä¸­æ‰€è¿°ï¼Œåº”ç”¨ç¨‹åºå°†æ‹¥æœ‰**å¯¹ç”¨æˆ·è´¦æˆ·çš„å®Œå…¨è®¿é—®æƒé™**ã€‚

### åˆ†æ”¯ä¿æŠ¤ç»•è¿‡

åœ¨Githubä¸­ï¼Œæˆ‘ä»¬æœ‰**github actions**ï¼Œé»˜è®¤æƒ…å†µä¸‹ä¼šè·å¾—**å…·æœ‰å†™è®¿é—®æƒé™çš„ä»¤ç‰Œ**ï¼Œå¯ä»¥ç”¨æ¥**ç»•è¿‡åˆ†æ”¯ä¿æŠ¤**ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè¿™ç§åŠŸèƒ½**ä¸å­˜åœ¨**ï¼Œæ‰€ä»¥ç»•è¿‡çš„æ–¹å¼æ›´æœ‰é™ã€‚ä½†è®©æˆ‘ä»¬çœ‹çœ‹å¯ä»¥åšäº›ä»€ä¹ˆï¼š

* **å¯ç”¨æ¨é€**ï¼šå¦‚æœä»»ä½•å…·æœ‰å†™è®¿é—®æƒé™çš„äººå¯ä»¥æ¨é€åˆ°åˆ†æ”¯ï¼Œåªéœ€æ¨é€å³å¯ã€‚
* **ç™½åå•é™åˆ¶æ¨é€**ï¼šåŒæ ·ï¼Œå¦‚æœä½ åœ¨è¿™ä¸ªåˆ—è¡¨ä¸­ï¼Œæ¨é€åˆ°åˆ†æ”¯ã€‚
* **å¯ç”¨åˆå¹¶ç™½åå•**ï¼šå¦‚æœæœ‰åˆå¹¶ç™½åå•ï¼Œä½ éœ€è¦åœ¨å…¶ä¸­ã€‚
* **éœ€è¦çš„æ‰¹å‡†æ•°å¤§äº0**ï¼šé‚£ä¹ˆ...ä½ éœ€è¦å¦¥åå¦ä¸€ä¸ªç”¨æˆ·ã€‚
* **å°†æ‰¹å‡†é™åˆ¶ä¸ºç™½åå•ç”¨æˆ·**ï¼šå¦‚æœåªæœ‰ç™½åå•ç”¨æˆ·å¯ä»¥æ‰¹å‡†...ä½ éœ€è¦å¦¥ååœ¨è¯¥åˆ—è¡¨ä¸­çš„å¦ä¸€ä¸ªç”¨æˆ·ã€‚
* **å–æ¶ˆè¿‡æ—¶çš„æ‰¹å‡†**ï¼šå¦‚æœæ‰¹å‡†ä¸ä¼šå› æ–°æäº¤è€Œè¢«ç§»é™¤ï¼Œä½ å¯ä»¥åŠ«æŒå·²æ‰¹å‡†çš„PRæ¥æ³¨å…¥ä½ çš„ä»£ç å¹¶åˆå¹¶PRã€‚

è¯·æ³¨æ„ï¼Œ**å¦‚æœä½ æ˜¯ç»„ç»‡/ä»“åº“ç®¡ç†å‘˜**ï¼Œä½ å¯ä»¥ç»•è¿‡è¿™äº›ä¿æŠ¤ã€‚

### æšä¸¾Webhooks

**Webhooks**èƒ½å¤Ÿ**å°†ç‰¹å®šçš„giteaä¿¡æ¯å‘é€åˆ°æŸäº›åœ°æ–¹**ã€‚ä½ å¯èƒ½èƒ½å¤Ÿ**åˆ©ç”¨è¿™ç§é€šä¿¡**ã€‚\
ç„¶è€Œï¼Œé€šå¸¸åœ¨**webhook**ä¸­è®¾ç½®äº†ä¸€ä¸ª**æ— æ³•æ£€ç´¢çš„å¯†é’¥**ï¼Œè¿™å°†**é˜²æ­¢**çŸ¥é“webhook URLä½†ä¸çŸ¥é“å¯†é’¥çš„å¤–éƒ¨ç”¨æˆ·**åˆ©ç”¨è¯¥webhook**ã€‚\
ä½†åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œäººä»¬æ²¡æœ‰å°†**å¯†é’¥**è®¾ç½®åœ¨å…¶ä½ç½®ï¼Œè€Œæ˜¯å°†å…¶**ä½œä¸ºå‚æ•°è®¾ç½®åœ¨URLä¸­**ï¼Œå› æ­¤**æ£€æŸ¥URL**å¯èƒ½ä¼šè®©ä½ **æ‰¾åˆ°å¯†é’¥**å’Œå…¶ä»–ä½ å¯ä»¥è¿›ä¸€æ­¥åˆ©ç”¨çš„åœ°æ–¹ã€‚

Webhookså¯ä»¥åœ¨**ä»“åº“å’Œç»„ç»‡çº§åˆ«**è®¾ç½®ã€‚

## åæœŸåˆ©ç”¨

### åœ¨æœåŠ¡å™¨å†…éƒ¨

å¦‚æœä½ è®¾æ³•è¿›å…¥è¿è¡Œgiteaçš„æœåŠ¡å™¨ï¼Œä½ åº”è¯¥æœç´¢giteaé…ç½®æ–‡ä»¶ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå®ƒä½äº`/data/gitea/conf/app.ini`

åœ¨è¿™ä¸ªæ–‡ä»¶ä¸­ä½ å¯ä»¥æ‰¾åˆ°**å¯†é’¥**å’Œ**å¯†ç **ã€‚

åœ¨giteaè·¯å¾„ï¼ˆé»˜è®¤ï¼š/data/giteaï¼‰ä¸­ï¼Œä½ è¿˜å¯ä»¥æ‰¾åˆ°æœ‰è¶£çš„ä¿¡æ¯ï¼Œä¾‹å¦‚ï¼š

* **sqlite**æ•°æ®åº“ï¼šå¦‚æœgiteaæ²¡æœ‰ä½¿ç”¨å¤–éƒ¨æ•°æ®åº“ï¼Œå®ƒå°†ä½¿ç”¨sqliteæ•°æ®åº“ã€‚
* ä¼šè¯æ–‡ä»¶å¤¹ä¸­çš„**ä¼šè¯**ï¼šè¿è¡Œ`cat sessions/*/*/*`ä½ å¯ä»¥çœ‹åˆ°å·²ç™»å½•ç”¨æˆ·çš„ç”¨æˆ·åï¼ˆgiteaä¹Ÿå¯èƒ½å°†ä¼šè¯ä¿å­˜åœ¨æ•°æ®åº“ä¸­ï¼‰ã€‚
* jwtæ–‡ä»¶å¤¹ä¸­çš„**jwtç§é’¥**ã€‚
* åœ¨è¿™ä¸ªæ–‡ä»¶å¤¹ä¸­å¯èƒ½ä¼šæ‰¾åˆ°æ›´å¤š**æ•æ„Ÿä¿¡æ¯**ã€‚

å¦‚æœä½ åœ¨æœåŠ¡å™¨å†…éƒ¨ï¼Œä½ è¿˜å¯ä»¥**ä½¿ç”¨`gitea`äºŒè¿›åˆ¶æ–‡ä»¶**æ¥è®¿é—®/ä¿®æ”¹ä¿¡æ¯ï¼š

* `gitea dump`å°†è½¬å‚¨giteaå¹¶ç”Ÿæˆä¸€ä¸ª.zipæ–‡ä»¶ã€‚
* `gitea generate secret INTERNAL_TOKEN/JWT_SECRET/SECRET_KEY/LFS_JWT_SECRET`å°†ç”ŸæˆæŒ‡å®šç±»å‹çš„ä»¤ç‰Œï¼ˆæŒä¹…æ€§ï¼‰ã€‚
* `gitea admin user change-password --username admin --password newpassword`æ›´æ”¹å¯†ç ã€‚
* `gitea admin user create --username newuser --password superpassword --email user@user.user --admin --access-token`åˆ›å»ºæ–°ç®¡ç†å‘˜ç”¨æˆ·å¹¶è·å–è®¿é—®ä»¤ç‰Œã€‚

{% hint style="success" %}
å­¦ä¹ å’Œå®è·µAWS Hackingï¼š<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
å­¦ä¹ å’Œå®è·µGCP Hackingï¼š<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>æ”¯æŒHackTricks</summary>

* æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**telegramç¾¤ç»„**](https://t.me/peass) æˆ– **å…³æ³¨**æˆ‘ä»¬åœ¨**Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**ã€‚**
* **é€šè¿‡æäº¤PRåˆ°** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **githubä»“åº“æ¥åˆ†äº«é»‘å®¢æŠ€å·§**ã€‚

</details>
{% endhint %}
