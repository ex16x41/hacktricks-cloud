# GH Actions - Cache Poisoning

{% hint style="success" %}
Ucz si i wicz Hacking AWS:<img src="../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">\
Ucz si i wicz Hacking GCP: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Wsparcie dla HackTricks</summary>

* Sprawd藕 [**plany subskrypcyjne**](https://github.com/sponsors/carlospolop)!
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegram**](https://t.me/peass) lub **led藕** nas na **Twitterze**  [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podziel si sztuczkami hackingowymi, przesyajc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repozytori贸w github.

</details>
{% endhint %}

Aby uzyska wicej szczeg贸贸w, sprawd藕 oryginalny post [https://scribesecurity.com/blog/github-cache-poisoning/](https://scribesecurity.com/blog/github-cache-poisoning/)

## Cache Poisoning

Akcja Git [**action/cache**](https://github.com/actions/cache) wprowadza mechanizm pamici podrcznej w procesie Continuous Integration (CI), obejmujcy dwa kluczowe etapy:

1. **Run Action**: Ten etap polega na wyszukiwaniu i pobieraniu danych z pamici podrcznej podczas uruchamiania CI. Wyszukiwanie wykorzystuje unikalny klucz pamici podrcznej, co prowadzi do dw贸ch wynik贸w:
* **Cache-hit**: 呕dane dane znajduj si w pamici podrcznej i s pobierane do natychmiastowego u偶ycia.
* **Cache-miss**: Nie znaleziono pasujcych danych w pamici podrcznej, co skutkuje wie偶ym pobraniem wymaganych plik贸w i katalog贸w, podobnie jak w przypadku pierwszego 偶dania.
2. **Post Workflow Action**: Ten etap jest powicony pamici podrcznej danych po zakoczeniu workflow CI. W szczeg贸lnoci, jeli wystpi cache-miss podczas akcji uruchamiania, bie偶cy stan okrelonych katalog贸w jest zapisywany w pamici podrcznej przy u偶yciu podanego klucza. Proces ten jest zautomatyzowany i nie wymaga jawnego wywoania.

#### rodki bezpieczestwa: Izolacja pamici podrcznej i ograniczenia dostpu

Aby utrzyma bezpieczestwo i zapewni izolacj pamici podrcznej, wprowadza si ograniczenia dostpu, tworzc logiczne oddzielenie midzy r贸偶nymi gaziami. Na przykad, pami podrczna utworzona dla gazi **Feature-A** (z baz w gazi g贸wnej) bdzie niedostpna dla 偶dania pull dla gazi **Feature-B** (r贸wnie偶 opartej na gazi g贸wnej).

Akcja pamici podrcznej przestrzega okrelonego porzdku wyszukiwania:

* Najpierw szuka trafie w pamici podrcznej w tej samej gazi, co uruchomienie workflow.
* Jeli to si nie powiedzie, rozszerza wyszukiwanie na ga藕 nadrzdn i inne gazie upstream.

Co wa偶ne, dostp do pamici podrcznej jest ograniczony do gazi, obejmujc wszystkie workflow i uruchomienia danej gazi. Dodatkowo, GitHub wprowadza polityk tylko do odczytu dla wpis贸w pamici podrcznej po ich utworzeniu, zabraniajc jakichkolwiek modyfikacji.

#### Rzeczywiste implikacje: Atak na workflow z niskimi uprawnieniami do wysokich uprawnie

Ilustrujcy scenariusz CI pokazuje, jak atakujcy mo偶e wykorzysta zatrucie pamici podrcznej do eskalacji uprawnie z workflow o niskich uprawnieniach do workflow o wysokich uprawnieniach:

* Workflow **Unit-test**, odpowiedzialny za uruchamianie test贸w jednostkowych i narzdzi do pokrycia kodu, zakada u偶ycie skompromitowanego lub podatnego narzdzia. Ten workflow wykorzystuje akcj Git **action/cache**, co sprawia, 偶e pami podrczna jest dostpna dla ka偶dego workflow.
* Workflow **Release**, odpowiedzialny za budowanie i wydawanie artefaktu aplikacji, optymalizuje swoje operacje, pamitajc zale偶noci Golang.

W tym scenariuszu workflow test贸w jednostkowych wprowadza zoliwy wpis do pamici podrcznej, zastpujc legaln bibliotek logowania Golang (\`go
