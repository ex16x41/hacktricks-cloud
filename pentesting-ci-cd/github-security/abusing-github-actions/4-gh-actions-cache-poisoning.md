# GH Actions - Cache Poisoning

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** 💬 [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

For further details check the original post [https://scribesecurity.com/blog/github-cache-poisoning/](https://scribesecurity.com/blog/github-cache-poisoning/)

## Cache Poisoning

Git akcija [**action/cache**](https://github.com/actions/cache) uvodi mehanizam keširanja u procesu Kontinuirane Integracije (CI), obuhvatajući dve ključne faze:

1. **Pokreni Akciju**: Ova faza uključuje pretraživanje i preuzimanje keširanih podataka tokom CI izvršenja. Pretraga koristi jedinstveni keš ključ, dajući dva ishoda:
* **Keš-hit**: Traženi podaci su pronađeni u kešu i stoga su preuzeti za trenutnu upotrebu.
* **Keš-miss**: Nema podataka koji odgovaraju u kešu, što dovodi do novog preuzimanja potrebnih datoteka i direktorijuma, slično kao kod prvog zahteva.
2. **Post Workflow Akcija**: Ova faza je posvećena keširanju podataka nakon CI radnog toka. Konkretno, ako dođe do keš-miss tokom pokretanja akcije, trenutna stanja određenih direktorijuma se keširaju koristeći dati ključ. Ovaj proces je automatizovan i ne zahteva eksplicitno pozivanje.

#### Bezbednosne Mere: Izolacija Keša i Ograničenja Pristupa

Da bi se održala bezbednost i osigurala izolacija keša, primenjuju se ograničenja pristupa, stvarajući logičku separaciju između različitih grana. Na primer, keš kreiran za granu **Feature-A** (sa osnovom u glavnoj grani) biće nedostupan za pull request za granu **Feature-B** (takođe zasnovanu na glavnoj grani).

Akcija keša se pridržava specifičnog reda pretrage:

* Prvo traži keš hitove unutar iste grane kao što je radni tok.
* Ako nije uspešna, proširuje pretragu na roditeljsku granu i druge uzvodne grane.

Važno je napomenuti da je pristup kešu ograničen na granu, protežući se kroz sve radne tokove i izvršenja određene grane. Pored toga, GitHub primenjuje politiku samo za čitanje za unose u keš nakon što su kreirani, zabranjujući bilo kakve izmene.

#### Real-World Implication: Od Napada na Radni Tok sa Niskim Dozvolama do Visokih Dozvola

Ilustrativni CI scenario pokazuje kako napadač može iskoristiti trovanje keša da bi eskalirao privilegije sa radnog toka sa niskim dozvolama na radni tok sa visokim dozvolama:

* **Unit-test** radni tok, odgovoran za pokretanje unit testova i alata za pokrivenost koda, pretpostavlja se da koristi kompromitovani ili ranjiv alat. Ovaj radni tok koristi **action/cache** Git akciju, čineći keš dostupnim bilo kojem radnom toku.
* **Release** radni tok, zadužen za izgradnju i objavljivanje artefakta aplikacije, optimizuje svoje operacije keširanjem Golang zavisnosti.

U ovom scenariju, unit-test radni tok uvodi zlonamerni unos u keš zamenjujući legitimnu Golang biblioteku za logovanje (\`go
