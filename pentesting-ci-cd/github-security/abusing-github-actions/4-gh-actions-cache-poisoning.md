# GH Actions - Cache Poisoning

{% hint style="success" %}
Apprenez et pratiquez le hacking AWS :<img src="../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">\
Apprenez et pratiquez le hacking GCP : <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Consultez les [**plans d'abonnement**](https://github.com/sponsors/carlospolop) !
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez-nous sur** **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Partagez des astuces de hacking en soumettant des PR aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) d√©p√¥ts github.

</details>
{% endhint %}

Pour plus de d√©tails, consultez le post original [https://scribesecurity.com/blog/github-cache-poisoning/](https://scribesecurity.com/blog/github-cache-poisoning/)

## Cache Poisoning

L'action Git [**action/cache**](https://github.com/actions/cache) introduit un m√©canisme de mise en cache dans le processus d'Int√©gration Continue (CI), englobant deux √©tapes critiques :

1. **Ex√©cuter l'action** : Cette √©tape consiste √† rechercher et √† r√©cup√©rer des donn√©es mises en cache pendant l'ex√©cution de la CI. La recherche utilise une cl√© de cache unique, produisant deux r√©sultats :
* **Cache-hit** : Les donn√©es demand√©es sont trouv√©es dans le cache et sont donc r√©cup√©r√©es pour une utilisation imm√©diate.
* **Cache-miss** : Aucune donn√©e correspondante n'est trouv√©e dans le cache, ce qui entra√Æne un t√©l√©chargement frais des fichiers et r√©pertoires requis, semblable √† une demande initiale.
2. **Action Post Workflow** : Cette √©tape est d√©di√©e √† la mise en cache des donn√©es apr√®s le workflow CI. Plus pr√©cis√©ment, si un cache-miss se produit pendant l'action d'ex√©cution, l'√©tat actuel des r√©pertoires sp√©cifi√©s est mis en cache en utilisant la cl√© fournie. Ce processus est automatis√© et ne n√©cessite pas d'invocation explicite.

#### Mesures de s√©curit√© : Isolation du cache et restrictions d'acc√®s

Pour maintenir la s√©curit√© et garantir l'isolation du cache, des restrictions d'acc√®s sont appliqu√©es, cr√©ant une s√©paration logique entre les diff√©rentes branches. Par exemple, un cache cr√©√© pour la branche **Feature-A** (avec sa base dans la branche principale) sera inaccessible √† une demande de tirage pour la branche **Feature-B** (√©galement bas√©e dans la branche principale).

L'action de cache suit un ordre de recherche sp√©cifique :

* Elle cherche d'abord des cache hits dans la m√™me branche que l'ex√©cution du workflow.
* Si cela √©choue, elle √©tend la recherche √† la branche parente et aux autres branches en amont.

Il est important de noter que l'acc√®s au cache est limit√© √† la branche, s'√©tendant √† tous les workflows et ex√©cutions d'une branche sp√©cifique. De plus, GitHub impose une politique de lecture seule pour les entr√©es de cache une fois cr√©√©es, interdisant toute modification.

#### Implication dans le monde r√©el : D'une attaque de workflow √† faible permission √† une attaque de workflow √† haute permission

Un sc√©nario CI illustratif d√©montre comment un attaquant pourrait exploiter le cache poisoning pour √©lever ses privil√®ges d'un workflow √† faible permission √† un workflow √† haute permission :

* Le workflow **Unit-test**, responsable de l'ex√©cution des tests unitaires et des outils de couverture de code, est suppos√© utiliser un outil compromis ou vuln√©rable. Ce workflow utilise l'action Git **action/cache**, rendant le cache accessible √† tout workflow.
* Le workflow **Release**, charg√© de construire et de publier l'artefact de l'application, optimise ses op√©rations en mettant en cache les d√©pendances Golang.

Dans ce sc√©nario, le workflow de test unitaire introduit une entr√©e de cache malveillante en substituant une biblioth√®que de journalisation Golang l√©gitime (\`go
