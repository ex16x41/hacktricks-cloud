# Gh Actions - Context Script Injections

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## åŸºæœ¬æƒ…å ±

GitHub Actionãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚’å®Ÿè¡Œã™ã‚‹ã«ã¯ã€ã‚·ã‚¹ãƒ†ãƒ å†…ã§ç‰¹å®šã®ãƒˆãƒªã‚¬ãƒ¼ï¼ˆã‚¤ãƒ™ãƒ³ãƒˆï¼‰ãŒç™ºç”Ÿã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ã“ã‚Œã‚‰ã®ãƒˆãƒªã‚¬ãƒ¼ã®ã„ãã¤ã‹ã¯ã€GitHubä¸Šã®ä»»æ„ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã‚ˆã£ã¦é–‹å§‹ã§ãã€ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ãŒä½¿ç”¨ã™ã‚‹ç‰¹å®šã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’åˆ¶å¾¡ã§ãã¾ã™ã€‚ã“ã‚Œã‚‰ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¯[**ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ**](https://docs.github.com/en/actions/reference/context-and-expression-syntax-for-github-actions#github-context)ã¨å‘¼ã°ã‚Œã¾ã™ã€‚ã“ã‚Œã‚‰ã®å€¤ãŒãƒ¦ãƒ¼ã‚¶ãƒ¼åˆ¶å¾¡ã®å…¥åŠ›ã‚’é©åˆ‡ã«ã‚µãƒ‹ã‚¿ã‚¤ã‚ºã›ãšã«ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³å†…ã§ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œã«åˆ©ç”¨ã•ã‚Œã‚‹å ´åˆã€**ä»»æ„ã®ã‚³ãƒ¼ãƒ‰å®Ÿè¡Œ**ã«ã¤ãªãŒã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚

ä¾‹ãˆã°ã€ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒä½œæˆã•ã‚ŒãŸã¨ãã«ãƒˆãƒªã‚¬ãƒ¼ã•ã‚Œã‚‹GitHub Actionã‚’æƒ³åƒã—ã¦ãã ã•ã„ã€‚ã“ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã«ã¯ã€ãƒ–ãƒ©ãƒ³ãƒåã‚’ä½¿ç”¨ã—ã€`echo`ã‚³ãƒãƒ³ãƒ‰ã§ãƒ­ã‚°ã‚’è¨˜éŒ²ã™ã‚‹Bashã‚³ãƒãƒ³ãƒ‰ãŒå«ã¾ã‚Œã¦ã„ã¾ã™ã€‚ã“ã®å ´åˆã€ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ä½œæˆã™ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ãƒ–ãƒ©ãƒ³ãƒåã‚’åˆ¶å¾¡ã§ãã€æ‚ªæ„ã®ã‚ã‚‹ãƒ–ãƒ©ãƒ³ãƒåã‚’ä½œæˆã—ã¦`echo`ã‚³ãƒãƒ³ãƒ‰ã®ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚’é€ƒã‚Œã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ã“ã®æ“ä½œã«ã‚ˆã‚Šã€Bashã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ã‚’ä»‹ã—ã¦**ä»»æ„ã®ã‚³ãƒ¼ãƒ‰å®Ÿè¡Œ**ãŒç™ºç”Ÿã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚

ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒåˆ¶å¾¡ã§ãã‚‹ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã®ãƒªã‚¹ãƒˆã¯ä»¥ä¸‹ã®é€šã‚Šã§ã™ã€‚ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ãŒã“ã‚Œã‚‰ã‚’å®‰å…¨ã§ãªã„æ–¹æ³•ã§ä½¿ç”¨ã™ã‚‹å ´åˆã€GitHubä¸Šã®ä»»æ„ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã“ã®è„†å¼±æ€§ã‚’æ‚ªç”¨ã—ã¦ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³å†…ã§ã‚³ãƒ¼ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ã“ã®ãƒªã‚¹ãƒˆã¯ã€ã‚ªãƒ¼ãƒ—ãƒ³ã‚½ãƒ¼ã‚¹ã®GitHub Actionsè„†å¼±æ€§ã‚¹ã‚­ãƒ£ãƒŠãƒ¼ã§ã‚ã‚‹[**Raven**](https://github.com/CycodeLabs/raven)ã‹ã‚‰æ´¾ç”Ÿã—ã¦ã„ã¾ã™ï¼š

* `github.event.issue.title`
* `github.event.issue.body`
* `github.event.pull_request.title`
* `github.event.pull_request.body`
* `github.event.comment.body`
* `github.event.review.body`
* `github.event.review_comment.body`
* `github.event.pages.*.page_name`
* `github.event.commits.*.message`
* `github.event.head_commit.message`
* `github.event.head_commit.author.email`
* `github.event.head_commit.author.name`
* `github.event.commits.*.author.email`
* `github.event.commits.*.author.name`
* `github.event.pull_request.head.ref`
* `github.event.pull_request.head.label`
* `github.event.pull_request.head.repo.default_branch`
* `github.head_ref`


### ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³æ”»æ’ƒã®ä¾‹ <a href="#example-of-a-script-injection-attack" id="example-of-a-script-injection-attack"></a>

ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³æ”»æ’ƒã¯ã€ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ã‚¹ã‚¯ãƒªãƒ—ãƒˆå†…ã§ç›´æ¥ç™ºç”Ÿã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚ä»¥ä¸‹ã®ä¾‹ã§ã¯ã€ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãŒ**ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ã‚¿ã‚¤ãƒˆãƒ«ã®æœ‰åŠ¹æ€§ã‚’ãƒ†ã‚¹ãƒˆã™ã‚‹ãŸã‚ã®å¼ã‚’ä½¿ç”¨ã—ã¦ã„ã¾ã™ãŒã€ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ã®ãƒªã‚¹ã‚¯ã‚‚è¿½åŠ ã—ã¦ã„ã¾ã™ï¼š**
```yaml
- name: Check PR title
run: |
title="${{ github.event.pull_request.title }}"
if [[ $title =~ ^octocat ]]; then
echo "PR title starts with 'octocat'"
exit 0
else
echo "PR title did not start with 'octocat'"
exit 1
fi
```
Before the shell script is run, the expressions inside `${{ }}` are **è©•ä¾¡ã•ã‚Œ** and then substituted with the resulting values, which can make it **ã‚·ã‚§ãƒ«ã‚³ãƒãƒ³ãƒ‰ã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ã«å¯¾ã—ã¦è„†å¼±**.

To inject commands into this workflow, the attacker could create a pull request with a title of **`a"; ls $GITHUB_WORKSPACE"`**

In this example, the **`"`** character is used to interrupt the `title=`**`"${{ github.event.pull_request.title }}"`** statement, allowing the `ls` command to be executed on the runner.

### Github Actions Scanning Tools
- [Raven](https://github.com/CycodeLabs/raven) - [Release blog](https://cycode.com/blog/introducing-raven/)
- [Gato](https://github.com/praetorian-inc/gato)
- [Gato-X](https://github.com/AdnaneKhan/Gato-X)
- [PurplePanda](https://github.com/carlospolop/PurplePanda)

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
