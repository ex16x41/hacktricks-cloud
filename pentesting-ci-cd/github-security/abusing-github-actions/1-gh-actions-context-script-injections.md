# Gh Actions - Context Script Injections

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** 💬 [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Basic Information

Για να εκτελέσετε μια pipeline GitHub Action, πρέπει να συμβεί μια συγκεκριμένη ενεργοποίηση (γεγονός) στο σύστημα. Ορισμένες από αυτές τις ενεργοποιήσεις μπορούν να ξεκινήσουν από οποιονδήποτε χρήστη στο GitHub, επιτρέποντάς τους να ελέγχουν ορισμένες παραμέτρους που θα χρησιμοποιήσει η pipeline. Αυτές οι παράμετροι αναφέρονται ως [**contexts**](https://docs.github.com/en/actions/reference/context-and-expression-syntax-for-github-actions#github-context). Στην περίπτωση που αυτές οι τιμές χρησιμοποιούνται για εκτέλεση εντολών στην pipeline χωρίς κατάλληλο καθαρισμό της εισόδου που ελέγχεται από τον χρήστη, μπορεί να οδηγήσει σε **arbitrary code execution**.

Για παράδειγμα, φανταστείτε μια GitHub Action που ενεργοποιείται όταν δημιουργείται ένα pull request. Αυτή η ενέργεια περιλαμβάνει μια εντολή Bash που χρησιμοποιεί το όνομα του κλάδου και το καταγράφει με την εντολή `echo`. Σε αυτή την περίπτωση, ο χρήστης που δημιουργεί το pull request έχει έλεγχο πάνω στο όνομα του κλάδου και μπορεί να δημιουργήσει ένα κακόβουλο όνομα κλάδου για να ξεφύγει από το πλαίσιο της εντολής `echo`. Αυτή η χειραγώγηση θα μπορούσε να έχει ως αποτέλεσμα **arbitrary code execution** μέσω Bash Injection.

Ακολουθεί μια λίστα με τα contexts που μπορεί να ελέγξει ένας χρήστης. Εάν μια pipeline τα χρησιμοποιεί ανασφαλώς, οποιοσδήποτε χρήστης στο GitHub θα μπορούσε να εκμεταλλευτεί αυτή την ευπάθεια για να εκτελέσει κώδικα μέσα στην pipeline. Αυτή η λίστα προέρχεται από το [**Raven**](https://github.com/CycodeLabs/raven), έναν ανοιχτού κώδικα σαρωτή ευπαθειών GitHub Actions:

* `github.event.issue.title`
* `github.event.issue.body`
* `github.event.pull_request.title`
* `github.event.pull_request.body`
* `github.event.comment.body`
* `github.event.review.body`
* `github.event.review_comment.body`
* `github.event.pages.*.page_name`
* `github.event.commits.*.message`
* `github.event.head_commit.message`
* `github.event.head_commit.author.email`
* `github.event.head_commit.author.name`
* `github.event.commits.*.author.email`
* `github.event.commits.*.author.name`
* `github.event.pull_request.head.ref`
* `github.event.pull_request.head.label`
* `github.event.pull_request.head.repo.default_branch`
* `github.head_ref`


### Example of a script injection attack <a href="#example-of-a-script-injection-attack" id="example-of-a-script-injection-attack"></a>

Μια επίθεση script injection μπορεί να συμβεί άμεσα μέσα σε ένα inline script της ροής εργασίας. Στο παρακάτω παράδειγμα, μια ενέργεια χρησιμοποιεί μια **έκφραση για να ελέγξει την εγκυρότητα ενός τίτλου pull request**, αλλά προσθέτει επίσης τον κίνδυνο script injection:
```yaml
- name: Check PR title
run: |
title="${{ github.event.pull_request.title }}"
if [[ $title =~ ^octocat ]]; then
echo "PR title starts with 'octocat'"
exit 0
else
echo "PR title did not start with 'octocat'"
exit 1
fi
```
Πριν εκτελεστεί το shell script, οι εκφράσεις μέσα στο `${{ }}` **αξιολογούνται** και στη συνέχεια αντικαθίστανται με τις προκύπτουσες τιμές, γεγονός που μπορεί να το **καταστήσει ευάλωτο σε επιθέσεις ενέσεων εντολών shell**.

Για να εισάγει εντολές σε αυτή τη ροή εργασίας, ο επιτιθέμενος θα μπορούσε να δημιουργήσει ένα pull request με τίτλο **`a"; ls $GITHUB_WORKSPACE"`**

Σε αυτό το παράδειγμα, ο χαρακτήρας **`"`** χρησιμοποιείται για να διακόψει τη δήλωση `title=`**`"${{ github.event.pull_request.title }}"`**, επιτρέποντας την εκτέλεση της εντολής `ls` στον runner.

### Github Actions Scanning Tools
- [Raven](https://github.com/CycodeLabs/raven) - [Release blog](https://cycode.com/blog/introducing-raven/)
- [Gato](https://github.com/praetorian-inc/gato)
- [Gato-X](https://github.com/AdnaneKhan/Gato-X)
- [PurplePanda](https://github.com/carlospolop/PurplePanda)

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** 💬 [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
