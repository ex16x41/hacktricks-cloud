# Gh Actions - Context Script Injections

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** 💬 [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Basic Information

GitHub Action 파이프라인을 실행하려면 시스템에서 특정 트리거(이벤트)가 발생해야 합니다. 이러한 트리거 중 일부는 GitHub의 모든 사용자가 시작할 수 있으며, 이를 통해 파이프라인이 사용할 특정 매개변수를 제어할 수 있습니다. 이러한 매개변수는 [**contexts**](https://docs.github.com/en/actions/reference/context-and-expression-syntax-for-github-actions#github-context)라고 합니다. 이러한 값이 사용자 제어 입력의 적절한 정화 없이 파이프라인에서 명령 실행에 사용될 경우, **임의 코드 실행**으로 이어질 수 있습니다.

예를 들어, 풀 리퀘스트가 생성될 때 트리거되는 GitHub Action을 상상해 보십시오. 이 액션은 브랜치 이름을 사용하고 `echo` 명령으로 로그를 남기는 Bash 명령을 포함합니다. 이 경우, 풀 리퀘스트를 생성하는 사용자는 브랜치 이름을 제어할 수 있으며, 악의적인 브랜치 이름을 만들어 `echo` 명령의 컨텍스트를 탈출할 수 있습니다. 이러한 조작은 Bash Injection을 통해 **임의 코드 실행**을 초래할 수 있습니다.

사용자가 제어할 수 있는 컨텍스트 목록은 다음과 같습니다. 파이프라인이 이를 안전하지 않게 사용할 경우, GitHub의 모든 사용자가 이 취약점을 악용하여 파이프라인 내에서 코드를 실행할 수 있습니다. 이 목록은 오픈 소스 GitHub Actions 취약점 스캐너인 [**Raven**](https://github.com/CycodeLabs/raven)에서 파생되었습니다:

* `github.event.issue.title`
* `github.event.issue.body`
* `github.event.pull_request.title`
* `github.event.pull_request.body`
* `github.event.comment.body`
* `github.event.review.body`
* `github.event.review_comment.body`
* `github.event.pages.*.page_name`
* `github.event.commits.*.message`
* `github.event.head_commit.message`
* `github.event.head_commit.author.email`
* `github.event.head_commit.author.name`
* `github.event.commits.*.author.email`
* `github.event.commits.*.author.name`
* `github.event.pull_request.head.ref`
* `github.event.pull_request.head.label`
* `github.event.pull_request.head.repo.default_branch`
* `github.head_ref`


### Example of a script injection attack <a href="#example-of-a-script-injection-attack" id="example-of-a-script-injection-attack"></a>

스크립트 주입 공격은 워크플로의 인라인 스크립트 내에서 직접 발생할 수 있습니다. 다음 예제에서 액션은 **풀 리퀘스트 제목의 유효성을 테스트하기 위해 표현식을 사용하지만, 스크립트 주입의 위험도 추가합니다:**
```yaml
- name: Check PR title
run: |
title="${{ github.event.pull_request.title }}"
if [[ $title =~ ^octocat ]]; then
echo "PR title starts with 'octocat'"
exit 0
else
echo "PR title did not start with 'octocat'"
exit 1
fi
```
Before the shell script is run, the expressions inside `${{ }}` are **evaluated** and then substituted with the resulting values, which can make it **vulnerable to shell command injection**.

이 워크플로에 명령을 주입하기 위해 공격자는 **`a"; ls $GITHUB_WORKSPACE"`**라는 제목의 풀 리퀘스트를 생성할 수 있습니다.

이 예제에서 **`"`** 문자는 `title=`**`"${{ github.event.pull_request.title }}"`** 문장을 중단시키는 데 사용되어 `ls` 명령이 러너에서 실행될 수 있게 합니다.

### Github Actions Scanning Tools
- [Raven](https://github.com/CycodeLabs/raven) - [Release blog](https://cycode.com/blog/introducing-raven/)
- [Gato](https://github.com/praetorian-inc/gato)
- [Gato-X](https://github.com/AdnaneKhan/Gato-X)
- [PurplePanda](https://github.com/carlospolop/PurplePanda)

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** 💬 [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
