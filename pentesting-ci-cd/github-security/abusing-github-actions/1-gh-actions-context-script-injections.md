# Gh Actions - Inyecciones de Script en Contexto

{% hint style="success" %}
Aprende y practica Hacking en AWS:<img src="../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">\
Aprende y practica Hacking en GCP: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Apoya a HackTricks</summary>

* Revisa los [**planes de suscripción**](https://github.com/sponsors/carlospolop)!
* **Únete al** 💬 [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **síguenos** en **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Comparte trucos de hacking enviando PRs a los** [**repositorios de HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
{% endhint %}

## Información Básica

Para ejecutar un pipeline de GitHub Action, debe ocurrir un desencadenador específico (evento) en el sistema. Algunos de estos desencadenadores pueden ser iniciados por cualquier usuario en GitHub, permitiéndoles controlar ciertos parámetros que el pipeline utilizará. Estos parámetros se conocen como [**contextos**](https://docs.github.com/en/actions/reference/context-and-expression-syntax-for-github-actions#github-context). En el caso de que estos valores se utilicen para la ejecución de comandos en el pipeline sin la debida sanitización de la entrada controlada por el usuario, puede llevar a **ejecución de código arbitrario**.

Por ejemplo, imagina una GitHub Action que se activa cuando se crea una solicitud de extracción. Esta acción incluye un comando Bash que utiliza el nombre de la rama y lo registra con el comando `echo`. En este caso, el usuario que crea la solicitud de extracción tiene control sobre el nombre de la rama y puede crear un nombre de rama malicioso para escapar del contexto del comando `echo`. Esta manipulación podría resultar en **ejecución de código arbitrario** a través de Inyección Bash.

Aquí hay una lista de contextos que un usuario podría controlar. Si un pipeline los utiliza de manera insegura, cualquier usuario en GitHub podría explotar esta vulnerabilidad para ejecutar código dentro del pipeline. Esta lista se deriva de [**Raven**](https://github.com/CycodeLabs/raven), un escáner de vulnerabilidades de GitHub Actions de código abierto:

* `github.event.issue.title`
* `github.event.issue.body`
* `github.event.pull_request.title`
* `github.event.pull_request.body`
* `github.event.comment.body`
* `github.event.review.body`
* `github.event.review_comment.body`
* `github.event.pages.*.page_name`
* `github.event.commits.*.message`
* `github.event.head_commit.message`
* `github.event.head_commit.author.email`
* `github.event.head_commit.author.name`
* `github.event.commits.*.author.email`
* `github.event.commits.*.author.name`
* `github.event.pull_request.head.ref`
* `github.event.pull_request.head.label`
* `github.event.pull_request.head.repo.default_branch`
* `github.head_ref`


### Ejemplo de un ataque de inyección de script <a href="#example-of-a-script-injection-attack" id="example-of-a-script-injection-attack"></a>

Un ataque de inyección de script puede ocurrir directamente dentro del script en línea de un flujo de trabajo. En el siguiente ejemplo, una acción utiliza una **expresión para probar la validez del título de una solicitud de extracción**, pero también añade el riesgo de inyección de script:
```yaml
- name: Check PR title
run: |
title="${{ github.event.pull_request.title }}"
if [[ $title =~ ^octocat ]]; then
echo "PR title starts with 'octocat'"
exit 0
else
echo "PR title did not start with 'octocat'"
exit 1
fi
```
Antes de que se ejecute el script de shell, las expresiones dentro de `${{ }}` son **evaluadas** y luego sustituidas por los valores resultantes, lo que puede hacer que sea **vulnerable a la inyección de comandos de shell**.

Para inyectar comandos en este flujo de trabajo, el atacante podría crear una solicitud de extracción con un título de **`a"; ls $GITHUB_WORKSPACE"`**.

En este ejemplo, el carácter **`"`** se utiliza para interrumpir la declaración `title=`**`"${{ github.event.pull_request.title }}"`**, permitiendo que se ejecute el comando `ls` en el runner.

### Herramientas de Escaneo de Github Actions
- [Raven](https://github.com/CycodeLabs/raven) - [Blog de lanzamiento](https://cycode.com/blog/introducing-raven/)
- [Gato](https://github.com/praetorian-inc/gato)
- [Gato-X](https://github.com/AdnaneKhan/Gato-X)
- [PurplePanda](https://github.com/carlospolop/PurplePanda)

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** 💬 [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
