# Gh Actions - Contesto Iniezioni di Script

{% hint style="success" %}
Impara e pratica AWS Hacking:<img src="../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">\
Impara e pratica GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Supporta HackTricks</summary>

* Controlla i [**piani di abbonamento**](https://github.com/sponsors/carlospolop)!
* **Unisciti al** üí¨ [**gruppo Discord**](https://discord.gg/hRep4RUj7f) o al [**gruppo telegram**](https://t.me/peass) o **seguici** su **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Condividi trucchi di hacking inviando PR ai** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repos di github.

</details>
{% endhint %}

## Informazioni di Base

Per eseguire una pipeline di GitHub Action, deve verificarsi un trigger specifico (evento) nel sistema. Alcuni di questi trigger possono essere avviati da qualsiasi utente su GitHub, consentendo loro di controllare determinati parametri che la pipeline utilizzer√†. Questi parametri sono noti come [**contesti**](https://docs.github.com/en/actions/reference/context-and-expression-syntax-for-github-actions#github-context). Nel caso in cui questi valori vengano utilizzati per l'esecuzione di comandi nella pipeline senza una corretta sanitizzazione dell'input controllato dall'utente, potrebbe portare a **esecuzione di codice arbitrario**.

Ad esempio, immagina una GitHub Action che viene attivata quando viene creata una pull request. Questa azione include un comando Bash che utilizza il nome del branch e lo registra con il comando `echo`. In questo caso, l'utente che crea la pull request ha il controllo sul nome del branch e pu√≤ creare un nome di branch malevolo per sfuggire al contesto del comando `echo`. Questa manipolazione potrebbe risultare in **esecuzione di codice arbitrario** tramite Bash Injection.

Ecco un elenco di contesti che un utente potrebbe controllare. Se una pipeline li utilizza in modo insicuro, qualsiasi utente su GitHub potrebbe sfruttare questa vulnerabilit√† per eseguire codice all'interno della pipeline. Questo elenco √® derivato da [**Raven**](https://github.com/CycodeLabs/raven), uno scanner di vulnerabilit√† GitHub Actions open-source:

* `github.event.issue.title`
* `github.event.issue.body`
* `github.event.pull_request.title`
* `github.event.pull_request.body`
* `github.event.comment.body`
* `github.event.review.body`
* `github.event.review_comment.body`
* `github.event.pages.*.page_name`
* `github.event.commits.*.message`
* `github.event.head_commit.message`
* `github.event.head_commit.author.email`
* `github.event.head_commit.author.name`
* `github.event.commits.*.author.email`
* `github.event.commits.*.author.name`
* `github.event.pull_request.head.ref`
* `github.event.pull_request.head.label`
* `github.event.pull_request.head.repo.default_branch`
* `github.head_ref`


### Esempio di attacco di iniezione di script <a href="#example-of-a-script-injection-attack" id="example-of-a-script-injection-attack"></a>

Un attacco di iniezione di script pu√≤ verificarsi direttamente all'interno dello script inline di un workflow. Nel seguente esempio, un'azione utilizza un **espressione per testare la validit√† del titolo di una pull request**, ma aggiunge anche il rischio di iniezione di script:
```yaml
- name: Check PR title
run: |
title="${{ github.event.pull_request.title }}"
if [[ $title =~ ^octocat ]]; then
echo "PR title starts with 'octocat'"
exit 0
else
echo "PR title did not start with 'octocat'"
exit 1
fi
```
Prima che lo script shell venga eseguito, le espressioni all'interno di `${{ }}` vengono **valutate** e poi sostituite con i valori risultanti, il che pu√≤ renderlo **vulnerabile all'iniezione di comandi shell**.

Per iniettare comandi in questo flusso di lavoro, l'attaccante potrebbe creare una pull request con un titolo di **`a"; ls $GITHUB_WORKSPACE"`**

In questo esempio, il carattere **`"`** viene utilizzato per interrompere l'istruzione `title=`**`"${{ github.event.pull_request.title }}"`**, consentendo l'esecuzione del comando `ls` sul runner.

### Strumenti di scansione delle Github Actions
- [Raven](https://github.com/CycodeLabs/raven) - [Blog di rilascio](https://cycode.com/blog/introducing-raven/)
- [Gato](https://github.com/praetorian-inc/gato)
- [Gato-X](https://github.com/AdnaneKhan/Gato-X)
- [PurplePanda](https://github.com/carlospolop/PurplePanda)

{% hint style="success" %}
Impara e pratica l'Hacking AWS:<img src="../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">\
Impara e pratica l'Hacking GCP: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Supporta HackTricks</summary>

* Controlla i [**piani di abbonamento**](https://github.com/sponsors/carlospolop)!
* **Unisciti al** üí¨ [**gruppo Discord**](https://discord.gg/hRep4RUj7f) o al [**gruppo telegram**](https://t.me/peass) o **seguici** su **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Condividi trucchi di hacking inviando PR ai** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repos di github.

</details>
{% endhint %}
