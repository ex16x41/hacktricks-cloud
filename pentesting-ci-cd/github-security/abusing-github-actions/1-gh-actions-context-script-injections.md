# Gh Actions - Context Script Injections

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Basic Information

Da bi se pokrenuo GitHub Action pipeline, mora se dogoditi odreÄ‘eni okidaÄ (dogaÄ‘aj) u sistemu. Neki od ovih okidaÄa mogu biti inicirani od strane bilo kog korisnika na GitHub-u, omoguÄ‡avajuÄ‡i im da kontroliÅ¡u odreÄ‘ene parametre koje Ä‡e pipeline koristiti. Ovi parametri se nazivaju [**contexts**](https://docs.github.com/en/actions/reference/context-and-expression-syntax-for-github-actions#github-context). U sluÄaju da se ove vrednosti koriste za izvrÅ¡avanje komandi u pipeline-u bez pravilnog sanitizovanja korisniÄki kontrolisanog unosa, to moÅ¾e dovesti do **arbitrary code execution**.

Na primer, zamislite GitHub Action koji se pokreÄ‡e kada se kreira pull request. Ova akcija ukljuÄuje Bash komandu koja koristi ime grane i beleÅ¾i ga sa `echo` komandom. U ovom sluÄaju, korisnik koji kreira pull request ima kontrolu nad imenom grane i moÅ¾e kreirati zloÄ‡udno ime grane kako bi pobegao iz konteksta `echo` komande. Ova manipulacija moÅ¾e rezultirati **arbitrary code execution** putem Bash Injection.

Evo liste konteksta koje korisnik moÅ¾e kontrolisati. Ako pipeline koristi ove kontekste nesigurno, bilo koji korisnik na GitHub-u moÅ¾e iskoristiti ovu ranjivost da pokrene kod unutar pipeline-a. Ova lista je preuzeta iz [**Raven**](https://github.com/CycodeLabs/raven), skener ranjivosti za GitHub Actions:

* `github.event.issue.title`
* `github.event.issue.body`
* `github.event.pull_request.title`
* `github.event.pull_request.body`
* `github.event.comment.body`
* `github.event.review.body`
* `github.event.review_comment.body`
* `github.event.pages.*.page_name`
* `github.event.commits.*.message`
* `github.event.head_commit.message`
* `github.event.head_commit.author.email`
* `github.event.head_commit.author.name`
* `github.event.commits.*.author.email`
* `github.event.commits.*.author.name`
* `github.event.pull_request.head.ref`
* `github.event.pull_request.head.label`
* `github.event.pull_request.head.repo.default_branch`
* `github.head_ref`


### Example of a script injection attack <a href="#example-of-a-script-injection-attack" id="example-of-a-script-injection-attack"></a>

Napad injekcijom skripte moÅ¾e se dogoditi direktno unutar inline skripte radnog toka. U sledeÄ‡em primeru, akcija koristi **expression da testira validnost naslova pull request-a**, ali takoÄ‘e dodaje rizik od injekcije skripte:
```yaml
- name: Check PR title
run: |
title="${{ github.event.pull_request.title }}"
if [[ $title =~ ^octocat ]]; then
echo "PR title starts with 'octocat'"
exit 0
else
echo "PR title did not start with 'octocat'"
exit 1
fi
```
Pre nego Å¡to se skripta izvrÅ¡i, izrazi unutar `${{ }}` se **evaluiraju** i zatim zamenjuju rezultantnim vrednostima, Å¡to moÅ¾e uÄiniti da bude **ranjiva na injekciju shell komandi**.

Da bi injektovao komande u ovaj radni tok, napadaÄ bi mogao da kreira pull request sa naslovom **`a"; ls $GITHUB_WORKSPACE"`**

U ovom primeru, **`"`** karakter se koristi da prekine `title=`**`"${{ github.event.pull_request.title }}"`** izjavu, omoguÄ‡avajuÄ‡i izvrÅ¡avanje `ls` komande na runner-u.

### Github Actions Skeneri
- [Raven](https://github.com/CycodeLabs/raven) - [Blog o izdanju](https://cycode.com/blog/introducing-raven/)
- [Gato](https://github.com/praetorian-inc/gato)
- [Gato-X](https://github.com/AdnaneKhan/Gato-X)
- [PurplePanda](https://github.com/carlospolop/PurplePanda)

{% hint style="success" %}
UÄite i veÅ¾bajte AWS Hacking:<img src="../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">\
UÄite i veÅ¾bajte GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>PodrÅ¾ite HackTricks</summary>

* Proverite [**planove pretplate**](https://github.com/sponsors/carlospolop)!
* **PridruÅ¾ite se** ğŸ’¬ [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili **pratite** nas na **Twitter-u** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podelite hakerske trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
{% endhint %}
