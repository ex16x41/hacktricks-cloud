# Gh Actions - Inyecciones de Script en Contexto

{% hint style="success" %}
Aprende y practica Hacking en AWS:<img src="../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">\
Aprende y practica Hacking en GCP: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Apoya a HackTricks</summary>

* Revisa los [**planes de suscripci贸n**](https://github.com/sponsors/carlospolop)!
* **nete al**  [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s铆guenos** en **Twitter**  [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Comparte trucos de hacking enviando PRs a los** [**repositorios de HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
{% endhint %}

## Informaci贸n B谩sica

Para ejecutar un pipeline de GitHub Action, debe ocurrir un desencadenador espec铆fico (evento) en el sistema. Algunos de estos desencadenadores pueden ser iniciados por cualquier usuario en GitHub, permiti茅ndoles controlar ciertos par谩metros que el pipeline utilizar谩. Estos par谩metros se conocen como [**contextos**](https://docs.github.com/en/actions/reference/context-and-expression-syntax-for-github-actions#github-context). En el caso de que estos valores se utilicen para la ejecuci贸n de comandos en el pipeline sin la debida sanitizaci贸n de la entrada controlada por el usuario, puede llevar a **ejecuci贸n de c贸digo arbitrario**.

Por ejemplo, imagina una GitHub Action que se activa cuando se crea una solicitud de extracci贸n. Esta acci贸n incluye un comando Bash que utiliza el nombre de la rama y lo registra con el comando `echo`. En este caso, el usuario que crea la solicitud de extracci贸n tiene control sobre el nombre de la rama y puede crear un nombre de rama malicioso para escapar del contexto del comando `echo`. Esta manipulaci贸n podr铆a resultar en **ejecuci贸n de c贸digo arbitrario** a trav茅s de Inyecci贸n Bash.

Aqu铆 hay una lista de contextos que un usuario podr铆a controlar. Si un pipeline los utiliza de manera insegura, cualquier usuario en GitHub podr铆a explotar esta vulnerabilidad para ejecutar c贸digo dentro del pipeline. Esta lista se deriva de [**Raven**](https://github.com/CycodeLabs/raven), un esc谩ner de vulnerabilidades de GitHub Actions de c贸digo abierto:

* `github.event.issue.title`
* `github.event.issue.body`
* `github.event.pull_request.title`
* `github.event.pull_request.body`
* `github.event.comment.body`
* `github.event.review.body`
* `github.event.review_comment.body`
* `github.event.pages.*.page_name`
* `github.event.commits.*.message`
* `github.event.head_commit.message`
* `github.event.head_commit.author.email`
* `github.event.head_commit.author.name`
* `github.event.commits.*.author.email`
* `github.event.commits.*.author.name`
* `github.event.pull_request.head.ref`
* `github.event.pull_request.head.label`
* `github.event.pull_request.head.repo.default_branch`
* `github.head_ref`


### Ejemplo de un ataque de inyecci贸n de script <a href="#example-of-a-script-injection-attack" id="example-of-a-script-injection-attack"></a>

Un ataque de inyecci贸n de script puede ocurrir directamente dentro del script en l铆nea de un flujo de trabajo. En el siguiente ejemplo, una acci贸n utiliza una **expresi贸n para probar la validez del t铆tulo de una solicitud de extracci贸n**, pero tambi茅n a帽ade el riesgo de inyecci贸n de script:
```yaml
- name: Check PR title
run: |
title="${{ github.event.pull_request.title }}"
if [[ $title =~ ^octocat ]]; then
echo "PR title starts with 'octocat'"
exit 0
else
echo "PR title did not start with 'octocat'"
exit 1
fi
```
Antes de que se ejecute el script de shell, las expresiones dentro de `${{ }}` son **evaluadas** y luego sustituidas por los valores resultantes, lo que puede hacer que sea **vulnerable a la inyecci贸n de comandos de shell**.

Para inyectar comandos en este flujo de trabajo, el atacante podr铆a crear una solicitud de extracci贸n con un t铆tulo de **`a"; ls $GITHUB_WORKSPACE"`**.

En este ejemplo, el car谩cter **`"`** se utiliza para interrumpir la declaraci贸n `title=`**`"${{ github.event.pull_request.title }}"`**, permitiendo que se ejecute el comando `ls` en el runner.

### Herramientas de Escaneo de Github Actions
- [Raven](https://github.com/CycodeLabs/raven) - [Blog de lanzamiento](https://cycode.com/blog/introducing-raven/)
- [Gato](https://github.com/praetorian-inc/gato)
- [Gato-X](https://github.com/AdnaneKhan/Gato-X)
- [PurplePanda](https://github.com/carlospolop/PurplePanda)

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the**  [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter**  [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
