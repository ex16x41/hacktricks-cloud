# Github Güvenliği

{% hint style="success" %}
AWS Hacking öğrenin ve pratik yapın:<img src="../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks Eğitim AWS Kırmızı Takım Uzmanı (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
GCP Hacking öğrenin ve pratik yapın: <img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Eğitim GCP Kırmızı Takım Uzmanı (GRTE)**<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**abonelik planlarını**](https://github.com/sponsors/carlospolop) kontrol edin!
* **💬 [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katılın ya da **Twitter'da** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**'i takip edin.**
* **Hacking ipuçlarını paylaşmak için** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna PR gönderin.

</details>
{% endhint %}

## Github Nedir

(From [here](https://kinsta.com/knowledgebase/what-is-github/)) Yüksek seviyede, **GitHub, geliştiricilerin kodlarını depolamalarına ve yönetmelerine, ayrıca kodlarındaki değişiklikleri takip etmelerine ve kontrol etmelerine yardımcı olan bir web sitesi ve bulut tabanlı hizmettir**.

### Temel Bilgiler

{% content-ref url="basic-github-information.md" %}
[basic-github-information.md](basic-github-information.md)
{% endcontent-ref %}

## Harici Keşif

Github depoları kamu, özel ve dahili olarak yapılandırılabilir.

* **Özel** demek, **sadece** **kuruluş** üyelerinin erişebileceği anlamına gelir.
* **Dahili** demek, **sadece** **şirket** (bir şirketin birden fazla kuruluşu olabilir) üyelerinin erişebileceği anlamına gelir.
* **Kamu** demek, **tüm internet** erişebilecek demektir.

**Hedef almak istediğiniz kullanıcı, depo veya kuruluşu biliyorsanız**, **github dorks** kullanarak hassas bilgileri bulabilir veya **her depoda hassas bilgi sızıntılarını** arayabilirsiniz.

### Github Dorks

Github, **bir kullanıcı, bir depo veya bir kuruluş belirterek bir şey aramanıza** olanak tanır. Bu nedenle, hassas bilgilere yakın görünecek bir dizi dize ile hedefinizdeki potansiyel hassas bilgileri kolayca **arama yapabilirsiniz**.

Araçlar (her araç kendi dork listesine sahiptir):

* [https://github.com/obheda12/GitDorker](https://github.com/obheda12/GitDorker) ([Dork listesi](https://github.com/obheda12/GitDorker/tree/master/Dorks))
* [https://github.com/techgaun/github-dorks](https://github.com/techgaun/github-dorks) ([Dork listesi](https://github.com/techgaun/github-dorks/blob/master/github-dorks.txt))
* [https://github.com/hisxo/gitGraber](https://github.com/hisxo/gitGraber) ([Dork listesi](https://github.com/hisxo/gitGraber/tree/master/wordlists))

### Github Sızıntıları

Lütfen, github dorklarının sızıntıları aramak için de kullanıldığını unutmayın. Bu bölüm, **her depoyu indirip içlerinde hassas bilgileri arayan** araçlara adanmıştır (belirli bir commit derinliğini kontrol etme dahil).

Araçlar (her araç kendi regex listesine sahiptir):

* [https://github.com/zricethezav/gitleaks](https://github.com/zricethezav/gitleaks)
* [https://github.com/trufflesecurity/truffleHog](https://github.com/trufflesecurity/truffleHog)
* [https://github.com/eth0izzle/shhgit](https://github.com/eth0izzle/shhgit)
* [https://github.com/michenriksen/gitrob](https://github.com/michenriksen/gitrob)
* [https://github.com/anshumanbh/git-all-secrets](https://github.com/anshumanbh/git-all-secrets)
* [https://github.com/kootenpv/gittyleaks](https://github.com/kootenpv/gittyleaks)
* [https://github.com/awslabs/git-secrets](https://github.com/awslabs/git-secrets)

{% hint style="warning" %}
Bir depoda sızıntı ararken ve `git log -p` gibi bir şey çalıştırırken, **diğer commit'leri içeren diğer dallar** olabileceğini unutmayın!
{% endhint %}

### Harici Forklar

**Pull request'leri kötüye kullanarak depoları tehlikeye atmak** mümkündür. Bir deponun savunmasız olup olmadığını bilmek için çoğunlukla Github Actions yaml yapılandırmalarını okumanız gerekir. [**Aşağıda daha fazla bilgi**](./#execution-from-a-external-fork).

### Silinmiş/Dahili Forklarda Github Sızıntıları

Silinmiş veya dahili olsa bile, github depolarının forklarından hassas veriler elde etmek mümkün olabilir. Bunu burada kontrol edin:

{% content-ref url="accessible-deleted-data-in-github.md" %}
[accessible-deleted-data-in-github.md](accessible-deleted-data-in-github.md)
{% endcontent-ref %}

## Kuruluş Güçlendirme

### Üye Ayrıcalıkları

Kuruluşun **üye** ayrıcıları olarak atanabilecek bazı **varsayılan ayrıcalıklar** vardır. Bunlar `https://github.com/organizations/<org_name>/settings/member_privileges` sayfasından veya [**Kuruluşlar API'si**](https://docs.github.com/en/rest/orgs/orgs) üzerinden kontrol edilebilir.

* **Temel izinler**: Üyeler, kuruluş depoları üzerinde Hiç/Yazma/Yönetici izinlerine sahip olacaktır. Tavsiye edilen **Hiç** veya **Okuma**'dır.
* **Depo fork'lama**: Gerekli değilse, üyelerin kuruluş depolarını fork'lamalarına **izin vermemek** daha iyidir.
* **Sayfa oluşturma**: Gerekli değilse, üyelerin kuruluş depolarından sayfa yayınlamalarına **izin vermemek** daha iyidir. Gerekliyse, kamu veya özel sayfalar oluşturulmasına izin verebilirsiniz.
* **Entegrasyon erişim talepleri**: Bu etkinleştirildiğinde, dış işbirlikçileri bu kuruluşa ve kaynaklarına erişim talep edebilecektir. Genellikle gereklidir, ancak gerek yoksa, devre dışı bırakmak daha iyidir.
* _Bu bilgiyi API yanıtında bulamadım, bulursanız paylaşın_
* **Depo görünürlüğü değişikliği**: Etkinleştirildiğinde, **depo** için **yönetici** izinlerine sahip **üyeler**, **görünürlüğünü değiştirme** yetkisine sahip olacaktır. Devre dışı bırakıldığında, yalnızca kuruluş sahipleri depo görünürlüklerini değiştirebilir. Eğer insanların şeyleri **kamuya açık** yapmasını istemiyorsanız, bunun **devre dışı** olduğundan emin olun.
* _Bu bilgiyi API yanıtında bulamadım, bulursanız paylaşın_
* **Depo silme ve transfer**: Etkinleştirildiğinde, depo için **yönetici** izinlerine sahip üyeler, kamu ve özel **depoları** **silme** veya **transfer etme** yetkisine sahip olacaktır.
* _Bu bilgiyi API yanıtında bulamadım, bulursanız paylaşın_
* **Üyelerin ekip oluşturmasına izin verme**: Etkinleştirildiğinde, kuruluşun herhangi bir **üyesi** yeni **ekipler** oluşturabilecektir. Devre dışı bırakıldığında, yalnızca kuruluş sahipleri yeni ekipler oluşturabilir. Bunun devre dışı bırakılması daha iyidir.
* _Bu bilgiyi API yanıtında bulamadım, bulursanız paylaşın_
* **Bu sayfada daha fazla şey yapılandırılabilir**, ancak önceki olanlar daha çok güvenlikle ilgilidir.

### Eylem Ayarları

Eylemler için birkaç güvenlikle ilgili ayar, `https://github.com/organizations/<org_name>/settings/actions` sayfasından yapılandırılabilir.

{% hint style="info" %}
Tüm bu yapılandırmaların her depoda bağımsız olarak da ayarlanabileceğini unutmayın
{% endhint %}

* **Github eylem politikaları**: Hangi depoların iş akışlarını çalıştırabileceğini ve hangi iş akışlarının izin verileceğini belirtmenize olanak tanır. **Hangi depoların** izin verileceğini belirtmek ve tüm eylemlerin çalıştırılmasına izin vermemek tavsiye edilir.
* [**API-1**](https://docs.github.com/en/rest/actions/permissions#get-allowed-actions-and-reusable-workflows-for-an-organization)**,** [**API-2**](https://docs.github.com/en/rest/actions/permissions#list-selected-repositories-enabled-for-github-actions-in-an-organization)
* **Dış işbirlikçilerden fork pull request iş akışları**: Tüm dış işbirlikçileri için **onay gerektirmesi** tavsiye edilir.
* _Bu bilgiyle ilgili bir API bulamadım, bulursanız paylaşın_
* **Fork pull request'lerden iş akışlarını çalıştırma**: **Pull request'lerden iş akışlarını çalıştırmak** kesinlikle **tavsiye edilmez**, çünkü fork kaynağının bakımcıları, kaynak deposunda okuma izinlerine sahip token'ları kullanma yetkisi alacaktır.
* _Bu bilgiyle ilgili bir API bulamadım, bulursanız paylaşın_
* **İş akışı izinleri**: **Sadece okuma depo izinleri** vermek kesinlikle tavsiye edilir. GITHUB\_TOKEN'in kötüye kullanılmasını önlemek için yazma ve pull request oluşturma/onaylama izinleri vermek tavsiye edilmez.
* [**API**](https://docs.github.com/en/rest/actions/permissions#get-default-workflow-permissions-for-an-organization)

### Entegrasyonlar

_Bu bilgiye erişmek için API uç noktasını biliyorsanız bana bildirin!_

* **Üçüncü taraf uygulama erişim politikası**: Her uygulamanın erişimini kısıtlamak ve yalnızca gerekli olanlara izin vermek tavsiye edilir (gözden geçirdikten sonra).
* **Yüklenmiş GitHub Uygulamaları**: Yalnızca gerekli olanların (gözden geçirdikten sonra) izin verilmesi tavsiye edilir.

## Kimlik Bilgilerini Kötüye Kullanarak Keşif ve Saldırılar

Bu senaryo için, bir github hesabına erişim sağladığınızı varsayacağız.

### Kullanıcı Kimlik Bilgileri ile

Bir şekilde bir kuruluş içindeki bir kullanıcı için kimlik bilgilerine sahipseniz, **sadece giriş yapabilir** ve hangi **şirket ve kuruluş rollerine sahip olduğunuzu** kontrol edebilirsiniz. Eğer sıradan bir üye iseniz, sıradan üyelerin hangi **izinlere sahip olduğunu**, hangi **gruplarda** olduğunuzu, hangi **izinlere sahip olduğunuzu** ve **depoların nasıl korunduğunu** kontrol edin.

**2FA'nın kullanılabileceğini** unutmayın, bu nedenle bu bilgilere yalnızca **o kontrolü geçebiliyorsanız** erişebilirsiniz.

{% hint style="info" %}
Eğer **`user_session` çerezini çalmayı başarırsanız** (şu anda SameSite: Lax ile yapılandırılmıştır), kimlik bilgilerine veya 2FA'ya ihtiyaç duymadan **kullanıcıyı tamamen taklit edebilirsiniz**.
{% endhint %}

Faydalı olabileceği için [**dal koruma atlamaları**](./#branch-protection-bypass) hakkında aşağıdaki bölümü kontrol edin.

### Kullanıcı SSH Anahtarı ile

Github, **kullanıcıların** kendi adlarına kod dağıtmak için **kimlik doğrulama yöntemi** olarak kullanılacak **SSH anahtarları** ayarlamalarına olanak tanır (2FA uygulanmaz).

Bu anahtar ile, kullanıcının bazı ayrıcalıklara sahip olduğu **depolar üzerinde değişiklikler** yapabilirsiniz, ancak bunu github api'sine erişmek için kullanamazsınız. Ancak, erişiminiz olan depolar ve kullanıcı hakkında bilgi almak için **yerel ayarları listeleyebilirsiniz**:
```bash
# Go to the the repository folder
# Get repo config and current user name and email
git config --list
```
Eğer kullanıcı adını github kullanıcı adı olarak yapılandırmışsa, hesabında ayarladığı **açık anahtarları** _https://github.com/\<github\_username>.keys_ adresinden erişebilirsiniz, bulduğunuz özel anahtarın kullanılabilir olduğunu doğrulamak için bunu kontrol edebilirsiniz.

**SSH anahtarları** ayrıca **dağıtım anahtarları** olarak depolarda ayarlanabilir. Bu anahtara erişimi olan herkes **bir depodan projeleri başlatabilecektir**. Genellikle farklı dağıtım anahtarlarına sahip bir sunucuda, yerel dosya **`~/.ssh/config`** hangi anahtarın ilgili olduğuna dair bilgi verecektir.

#### GPG Anahtarları

Açıklandığı gibi [**burada**](https://github.com/carlospolop/hacktricks-cloud/blob/master/pentesting-ci-cd/github-security/broken-reference/README.md) bazen taahhütleri imzalamak gerekebilir yoksa keşfedilirsiniz.

Mevcut kullanıcının herhangi bir anahtara sahip olup olmadığını yerel olarak kontrol edin:
```shell
gpg --list-secret-keys --keyid-format=long
```
### Kullanıcı Tokeni ile

[**Kullanıcı Tokenleri hakkında temel bilgileri kontrol edin**](basic-github-information.md#personal-access-tokens) için bir giriş.

Bir kullanıcı tokeni, Git üzerinden HTTPS için **şifre yerine** kullanılabilir veya [**API'ye Temel Kimlik Doğrulaması ile kimlik doğrulamak için**](https://docs.github.com/v3/auth/#basic-authentication) kullanılabilir. Ekli olan ayrıcalıklara bağlı olarak farklı eylemler gerçekleştirebilirsiniz.

Bir Kullanıcı tokeni şöyle görünür: `ghp_EfHnQFcFHX6fGIu5mpduvRiYR584kK0dX123`

### Oauth Uygulaması ile

[**Github Oauth Uygulamaları hakkında temel bilgileri kontrol edin**](basic-github-information.md#oauth-applications) için bir giriş.

Bir saldırgan, kullanıcıların muhtemelen bir kimlik avı kampanyasının parçası olarak kabul ettiği ayrıcalıklı verilere/eylemlere erişmek için **kötü niyetli bir Oauth Uygulaması** oluşturabilir.

Bir Oauth uygulamasının talep edebileceği [kapsamlar](https://docs.github.com/en/developers/apps/building-oauth-apps/scopes-for-oauth-apps) bunlardır. Her zaman kabul etmeden önce talep edilen kapsamları kontrol etmelisiniz.

Ayrıca, temel bilgilerin açıklandığı gibi, **organizasyonlar üçüncü taraf uygulamalara** organizasyonla ilgili bilgilere/repos/eylemlere erişim verebilir veya reddedebilir.

### Github Uygulaması ile

[**Github Uygulamaları hakkında temel bilgileri kontrol edin**](basic-github-information.md#github-applications) için bir giriş.

Bir saldırgan, kullanıcıların muhtemelen bir kimlik avı kampanyasının parçası olarak kabul ettiği ayrıcalıklı verilere/eylemlere erişmek için **kötü niyetli bir Github Uygulaması** oluşturabilir.

Ayrıca, temel bilgilerin açıklandığı gibi, **organizasyonlar üçüncü taraf uygulamalara** organizasyonla ilgili bilgilere/repos/eylemlere erişim verebilir veya reddedebilir.

## Github Eylemini Ele Geçirme ve Kötüye Kullanma

Bir Github Eylemini ele geçirmek ve kötüye kullanmak için birkaç teknik vardır, burada kontrol edin:

{% content-ref url="abusing-github-actions/" %}
[abusing-github-actions](abusing-github-actions/)
{% endcontent-ref %}

## Dal Koruma Atlatma

* **Onay sayısını gerektir**: Birkaç hesabı ele geçirdiyseniz, diğer hesaplardan PR'lerinizi kabul edebilirsiniz. PR'yi oluşturduğunuz hesaba sahipseniz, kendi PR'nizi kabul edemezsiniz. Ancak, repo içinde bir **Github Eylemi** ortamına erişiminiz varsa, **GITHUB\_TOKEN** kullanarak **PR'nizi onaylayabilir** ve bu şekilde 1 onay alabilirsiniz.
* _Bu ve Kod Sahipleri kısıtlaması için not: genellikle bir kullanıcı kendi PR'lerini onaylayamaz, ancak eğer onaylayabiliyorsanız, PR'lerinizi kabul etmek için bunu kötüye kullanabilirsiniz._
* **Yeni commitler gönderildiğinde onayları iptal et**: Bu ayarlanmadıysa, geçerli kod gönderebilir, birinin onaylamasını bekleyebilir ve kötü niyetli kod ekleyip korunan dal ile birleştirebilirsiniz.
* **Kod Sahiplerinden inceleme gerektir**: Bu etkinleştirildiyse ve bir Kod Sahibiyseniz, **bir Github Eylemi PR'nizi oluşturabilir ve ardından kendiniz onaylayabilirsiniz**.
* Bir **CODEOWNER dosyası yanlış yapılandırıldığında** Github şikayet etmez ama kullanmaz. Bu nedenle, yanlış yapılandırıldığında **Kod Sahipleri koruması uygulanmaz.**
* **Belirtilen aktörlerin pull request gereksinimlerini atlamasına izin ver**: Eğer bu aktörlerden biriyseniz, pull request korumalarını atlayabilirsiniz.
* **Yönetici dahil et**: Bu ayarlanmadıysa ve repo yöneticisiyseniz, bu dal korumalarını atlayabilirsiniz.
* **PR Ele Geçirme**: Başka birinin PR'sini **kötü niyetli kod ekleyerek değiştirebilir, sonuçta oluşan PR'yi kendiniz onaylayabilir ve her şeyi birleştirebilirsiniz.**
* **Dal Koruma Kaldırma**: Eğer bir **repo yöneticisiyseniz korumaları devre dışı bırakabilir**, PR'nizi birleştirebilir ve korumaları geri ayarlayabilirsiniz.
* **Push korumalarını atlama**: Eğer bir repo **sadece belirli kullanıcıların** dallarda push (kod birleştirme) göndermesine izin veriyorsa (dal koruması tüm dalları koruyor olabilir ve joker karakter `*` kullanıyor olabilir).
* Eğer **repo üzerinde yazma erişiminiz varsa ama dal koruması nedeniyle kod göndermeye izin verilmiyorsa**, yine de **yeni bir dal oluşturabilir** ve içinde **kod gönderildiğinde tetiklenen bir github eylemi oluşturabilirsiniz**. **Dal koruması dal oluşturulana kadar koruma sağlamayacağından**, bu dal üzerindeki ilk kod gönderimi **github eylemini çalıştıracaktır**.

## Ortam Koruma Atlatma

[**Github Ortamı hakkında temel bilgileri kontrol edin**](basic-github-information.md#git-environments) için bir giriş.

Bir ortam **tüm dallardan erişilebiliyorsa**, **korunmuyor** demektir ve ortam içindeki gizli bilgilere kolayca erişebilirsiniz. Tüm dalların **korunduğu** reposlar bulabileceğinizi unutmayın (isimlerini belirterek veya `*` kullanarak) bu senaryoda, **kod gönderebileceğiniz bir dal bulun** ve yeni bir github eylemi oluşturarak gizli bilgileri **sızdırabilirsiniz** (veya birini değiştirebilirsiniz).

Tüm dalların **korunduğu** (joker karakter `*` ile) bir kenar durumu bulabileceğinizi unutmayın, **dallara kimin kod gönderebileceği** belirtilmiştir (_bunu dal korumasında belirtebilirsiniz_) ve **kullanıcınıza izin verilmemiştir**. Yine de özel bir github eylemi çalıştırabilirsiniz çünkü bir dal oluşturabilir ve kendisi üzerinde push tetikleyicisini kullanabilirsiniz. **Dal koruması yeni bir dalda push'a izin verir, bu nedenle github eylemi tetiklenecektir.**
```yaml
push: # Run it when a push is made to a branch
branches:
- current_branch_name #Use '**' to run when a push is made to any branch
```
Not edin ki **dal oluşturulduktan sonra** **dal koruması yeni dala uygulanacak** ve bunu değiştiremeyeceksiniz, ancak o zamana kadar sırları zaten ele geçirmiş olacaksınız.

## Süreklilik

* **Kullanıcı token'ı** oluştur
* **Sırların** içinden **github token'larını** çal
* **İş akışı sonuçlarının** ve **dalların** **silinmesi**
* Tüm org'a **daha fazla izin ver**
* Bilgileri dışarı aktarmak için **webhook'lar** oluştur
* **Dış işbirlikçileri** davet et
* **SIEM** tarafından kullanılan **webhook'ları** **kaldır**
* **Arka kapı** ile **Github Action** oluştur/değiştir
* **Sır** değeri değişikliği yoluyla **komut enjeksiyonu** için **savunmasız Github Action** bul

### Sahte Taahhütler - Repo taahhütleri aracılığıyla arka kapı

Github'da **bir fork'tan bir repo için PR oluşturmak** mümkündür. PR **kabul edilse bile**, orijinal repoda bir **taahhüt** kimliği, kodun fork versiyonu için oluşturulacaktır. Bu nedenle, bir saldırgan **görünüşte meşru bir repodan, repo sahibinin oluşturmadığı belirli bir taahhütü kullanmak için sabitleyebilir**.

[**bu**](https://github.com/actions/checkout/commit/c7d749a2d57b4b375d1ebcd17cfbfb60c676f18e) gibi:
```yaml
name: example
on: [push]
jobs:
commit:
runs-on: ubuntu-latest
steps:
- uses: actions/checkout@c7d749a2d57b4b375d1ebcd17cfbfb60c676f18e
- shell: bash
run: |
echo 'hello world!'
```
Daha fazla bilgi için [https://www.chainguard.dev/unchained/what-the-fork-imposter-commits-in-github-actions-and-ci-cd](https://www.chainguard.dev/unchained/what-the-fork-imposter-commits-in-github-actions-and-ci-cd) adresini kontrol edin.

{% hint style="success" %}
AWS Hacking öğrenin ve pratik yapın:<img src="../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
GCP Hacking öğrenin ve pratik yapın: <img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**abonelik planlarını**](https://github.com/sponsors/carlospolop) kontrol edin!
* **💬 [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katılın ya da **Twitter'da** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks_live)** bizi takip edin.**
* **Hacking ipuçlarını paylaşmak için** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna PR gönderin.

</details>
{% endhint %}
