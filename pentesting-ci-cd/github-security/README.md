# Github Security

{% hint style="success" %}
U캜ite i ve쬭ajte AWS Hacking:<img src="../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/image (1).png" alt="" data-size="line">\
U캜ite i ve쬭ajte GCP Hacking: <img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Podr코ka HackTricks</summary>

* Proverite [**planove pretplate**](https://github.com/sponsors/carlospolop)!
* **Pridru쬴te se** 游눫 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili **pratite** nas na **Twitteru** 游냕 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podelite hakerske trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
{% endhint %}

## 맚a je Github

(Preuzeto [ovde](https://kinsta.com/knowledgebase/what-is-github/)) Na visokom nivou, **GitHub je veb sajt i usluga zasnovana na oblaku koja poma쬰 programerima da 캜uvaju i upravljaju svojim kodom, kao i da prate i kontroli코u promene u svom kodu**.

### Osnovne informacije

{% content-ref url="basic-github-information.md" %}
[basic-github-information.md](basic-github-information.md)
{% endcontent-ref %}

## Spoljna rekognosciranja

Github repozitorijumi mogu biti konfigurisani kao javni, privatni i interni.

* **Privatni** zna캜i da 캖e **samo** ljudi iz **organizacije** mo캖i da im pristupe
* **Interni** zna캜i da 캖e **samo** ljudi iz **preduze캖a** (preduze캖e mo쬰 imati nekoliko organizacija) mo캖i da mu pristupe
* **Javni** zna캜i da 캖e **svi na internetu** mo캖i da mu pristupe.

U slu캜aju da znate **korisnika, repozitorijum ili organizaciju koju 쬰lite da ciljate**, mo쬰te koristiti **github dorks** da prona캠ete osetljive informacije ili pretra쬿jete **curenje osetljivih informacija** **u svakom repozitorijumu**.

### Github Dorks

Github omogu캖ava da **pretra쬿jete ne코to specificiraju캖i kao opseg korisnika, repozitorijuma ili organizacije**. Stoga, sa listom stringova koji 캖e se pojaviti blizu osetljivih informacija, mo쬰te lako **pretra쬴ti potencijalne osetljive informacije u va코em cilju**.

Alati (svaki alat sadr쬴 svoju listu dorks):

* [https://github.com/obheda12/GitDorker](https://github.com/obheda12/GitDorker) ([Lista Dorks](https://github.com/obheda12/GitDorker/tree/master/Dorks))
* [https://github.com/techgaun/github-dorks](https://github.com/techgaun/github-dorks) ([Lista Dorks](https://github.com/techgaun/github-dorks/blob/master/github-dorks.txt))
* [https://github.com/hisxo/gitGraber](https://github.com/hisxo/gitGraber) ([Lista Dorks](https://github.com/hisxo/gitGraber/tree/master/wordlists))

### Github Curenja

Molimo vas, imajte na umu da su github dorks tako캠e namenjeni pretra쬴vanju curenja koriste캖i opcije pretrage na github-u. Ova sekcija je posve캖ena onim alatima koji 캖e **preuzeti svaki repozitorijum i pretra쬴ti osetljive informacije u njima** (캜ak proveravaju캖i odre캠enu dubinu commit-a).

Alati (svaki alat sadr쬴 svoju listu regex-a):

* [https://github.com/zricethezav/gitleaks](https://github.com/zricethezav/gitleaks)
* [https://github.com/trufflesecurity/truffleHog](https://github.com/trufflesecurity/truffleHog)
* [https://github.com/eth0izzle/shhgit](https://github.com/eth0izzle/shhgit)
* [https://github.com/michenriksen/gitrob](https://github.com/michenriksen/gitrob)
* [https://github.com/anshumanbh/git-all-secrets](https://github.com/anshumanbh/git-all-secrets)
* [https://github.com/kootenpv/gittyleaks](https://github.com/kootenpv/gittyleaks)
* [https://github.com/awslabs/git-secrets](https://github.com/awslabs/git-secrets)

{% hint style="warning" %}
Kada tra쬴te curenja u repozitorijumu i pokrenete ne코to poput `git log -p`, ne zaboravite da mogu postojati **druge grane sa drugim commit-ima** koji sadr쬰 tajne!
{% endhint %}

### Spoljni forkovi

Mogu캖e je **kompromitovati repozitorijume zloupotrebom pull zahteva**. Da biste znali da li je repozitorijum ranjiv, uglavnom treba da pro캜itate Github Actions yaml konfiguracije. [**Vi코e informacija o ovome u nastavku**](./#execution-from-a-external-fork).

### Github Curenja u obrisanim/internim forkovima

캛ak i ako su obrisani ili interni, mo쬰 biti mogu캖e dobiti osetljive podatke iz forkova github repozitorijuma. Proverite ovde:

{% content-ref url="accessible-deleted-data-in-github.md" %}
[accessible-deleted-data-in-github.md](accessible-deleted-data-in-github.md)
{% endcontent-ref %}

## Oja캜avanje organizacije

### Privilegije 캜lanova

Postoje neka **podrazumevana prava** koja se mogu dodeliti **캜lanovima** organizacije. Ova prava se mogu kontrolisati sa stranice `https://github.com/organizations/<org_name>/settings/member_privileges` ili iz [**Organizations API**](https://docs.github.com/en/rest/orgs/orgs).

* **Osnovne dozvole**: 캛lanovi 캖e imati dozvolu None/Read/write/Admin za repozitorijume organizacije. Preporu캜uje se **None** ili **Read**.
* **Forkovanje repozitorijuma**: Ako nije neophodno, bolje je **ne dozvoliti** 캜lanovima da fork-uju repozitorijume organizacije.
* **Kreiranje stranica**: Ako nije neophodno, bolje je **ne dozvoliti** 캜lanovima da objavljuju stranice iz repozitorijuma organizacije. Ako je neophodno, mo쬰te dozvoliti kreiranje javnih ili privatnih stranica.
* **Zahtevi za pristup integracijama**: Sa ovim omogu캖eno, spoljnim saradnicima 캖e biti omogu캖eno da zatra쬰 pristup za GitHub ili OAuth aplikacije da pristupe ovoj organizaciji i njenim resursima. Obi캜no je potrebno, ali ako nije, bolje je onemogu캖iti to.
* _Nisam mogao prona캖i ovu informaciju u odgovoru API-ja, podelite ako mo쬰te_
* **Promena vidljivosti repozitorijuma**: Ako je omogu캖eno, **캜lanovi** sa **admin** dozvolama za **repozitorijum** 캖e mo캖i da **promene njegovu vidljivost**. Ako je onemogu캖eno, samo vlasnici organizacije mogu menjati vidljivosti repozitorijuma. Ako ne 쬰lite da ljudi u캜ine stvari **javnim**, uverite se da je ovo **onemogu캖eno**.
* _Nisam mogao prona캖i ovu informaciju u odgovoru API-ja, podelite ako mo쬰te_
* **Brisanje i prebacivanje repozitorijuma**: Ako je omogu캖eno, 캜lanovi sa **admin** dozvolama za repozitorijum 캖e mo캖i da **obri코u** ili **prebace** javne i privatne **repozitorijume.**
* _Nisam mogao prona캖i ovu informaciju u odgovoru API-ja, podelite ako mo쬰te_
* **Dozvoliti 캜lanovima da kreiraju timove**: Ako je omogu캖eno, svaki **캜lan** organizacije 캖e mo캖i da **kreira** nove **timove**. Ako je onemogu캖eno, samo vlasnici organizacije mogu kreirati nove timove. Bolje je da ovo bude onemogu캖eno.
* _Nisam mogao prona캖i ovu informaciju u odgovoru API-ja, podelite ako mo쬰te_
* **Jo코 stvari se mogu konfigurisati** na ovoj stranici, ali prethodne su one koje su vi코e vezane za bezbednost.

### Pode코avanja akcija

Nekoliko pode코avanja vezanih za bezbednost mo쬰 se konfigurisati za akcije sa stranice `https://github.com/organizations/<org_name>/settings/actions`.

{% hint style="info" %}
Imajte na umu da se sve ove konfiguracije tako캠e mogu postaviti na svakom repozitorijumu nezavisno
{% endhint %}

* **Github akcije politike**: Omogu캖ava vam da navedete koji repozitorijumi mogu pokretati radne tokove i koji radni tokovi bi trebali biti dozvoljeni. Preporu캜uje se da **specificirate koji repozitorijumi** bi trebali biti dozvoljeni i ne dozvoliti svim akcijama da se pokre캖u.
* [**API-1**](https://docs.github.com/en/rest/actions/permissions#get-allowed-actions-and-reusable-workflows-for-an-organization)**,** [**API-2**](https://docs.github.com/en/rest/actions/permissions#list-selected-repositories-enabled-for-github-actions-in-an-organization)
* **Fork pull request radni tokovi od spoljnjih saradnika**: Preporu캜uje se da **zahtevate odobrenje za sve** spoljne saradnike.
* _Nisam mogao prona캖i API sa ovom informacijom, podelite ako mo쬰te_
* **Pokretanje radnih tokova iz fork pull zahteva**: Veoma je **nepreporu캜ljivo pokretati radne tokove iz pull zahteva** jer 캖e odr쬬vaoci fork porekla dobiti mogu캖nost kori코캖enja tokena sa dozvolama za 캜itanje na izvorni repozitorijum.
* _Nisam mogao prona캖i API sa ovom informacijom, podelite ako mo쬰te_
* **Dozvole radnog toka**: Veoma se preporu캜uje da **samo date dozvole za 캜itanje repozitorijuma**. Ne preporu캜uje se davanje dozvola za pisanje i kreiranje/odobravanje pull zahteva kako bi se izbegla zloupotreba GITHUB\_TOKEN-a datog za pokretanje radnih tokova.
* [**API**](https://docs.github.com/en/rest/actions/permissions#get-default-workflow-permissions-for-an-organization)

### Integracije

_Javite mi ako znate API krajnju ta캜ku za pristup ovim informacijama!_

* **Politika pristupa aplikacijama tre캖ih strana**: Preporu캜uje se ograni캜iti pristup svakoj aplikaciji i dozvoliti samo potrebne (nakon pregleda).
* **Instalirane GitHub aplikacije**: Preporu캜uje se dozvoliti samo potrebne (nakon pregleda).

## Rekognosciranje i napadi zloupotrebom kredencijala

Za ovaj scenario pretpostavi캖emo da ste dobili neki pristup github nalogu.

### Sa korisni캜kim kredencijalima

Ako nekako ve캖 imate kredencijale za korisnika unutar organizacije, mo쬰te **samo da se prijavite** i proverite koje **uloge preduze캖a i organizacije imate**, ako ste obi캜an 캜lan, proverite koje **dozvole imaju obi캜ni 캜lanovi**, u kojim **grupama** ste, koje **dozvole imate** nad kojim **repozitorijumima,** i **kako su repozitorijumi za코ti캖eni.**

Imajte na umu da se **2FA mo쬰 koristiti** tako da 캖ete mo캖i da pristupite ovim informacijama samo ako tako캠e mo쬰te **pro캖i tu proveru**.

{% hint style="info" %}
Imajte na umu da ako **uspete da ukradete `user_session` kola캜i캖** (trenutno konfigurisano sa SameSite: Lax) mo쬰te **potpuno imitirati korisnika** bez potrebe za kredencijalima ili 2FA.
{% endhint %}

Proverite odeljak ispod o [**zaobila쬰nju za코tite grana**](./#branch-protection-bypass) u slu캜aju da je korisno.

### Sa korisni캜kim SSH klju캜em

Github omogu캖ava **korisnicima** da postave **SSH klju캜eve** koji 캖e se koristiti kao **metoda autentifikacije za implementaciju koda** u njihovo ime (2FA se ne primenjuje).

Sa ovim klju캜em mo쬰te izvr코iti **promene u repozitorijumima gde korisnik ima neke privilegije**, me캠utim ne mo쬰te ga koristiti za pristup github API-ju da enumeri코ete okru쬰nje. Me캠utim, mo쬰te **enumerisati lokalne postavke** da dobijete informacije o repozitorijumima i korisniku kojem imate pristup:
```bash
# Go to the the repository folder
# Get repo config and current user name and email
git config --list
```
Ako je korisnik konfigurisao svoje korisni캜ko ime kao svoje github korisni캜ko ime, mo쬰te pristupiti **javnim klju캜evima koje je postavio** na svom nalogu na _https://github.com/\<github\_username>.keys_, mo쬰te proveriti ovo da potvrdite da li se privatni klju캜 koji ste prona코li mo쬰 koristiti.

**SSH klju캜evi** se tako캠e mogu postaviti u repozitorijume kao **deploy klju캜evi**. Svako ko ima pristup ovom klju캜u mo캖i 캖e da **pokrene projekte iz repozitorijuma**. Obi캜no na serveru sa razli캜itim deploy klju캜evima lokalna datoteka **`~/.ssh/config`** 캖e vam dati informacije o tome kojem klju캜u se odnosi.

#### GPG Klju캜evi

Kao 코to je obja코njeno [**ovde**](https://github.com/carlospolop/hacktricks-cloud/blob/master/pentesting-ci-cd/github-security/broken-reference/README.md), ponekad je potrebno potpisati commit-e ili biste mogli biti otkriveni.

Proverite lokalno da li trenutni korisnik ima neki klju캜 sa:
```shell
gpg --list-secret-keys --keyid-format=long
```
### Sa korisni캜kim tokenom

Za uvod o [**korisni캜kim tokenima proverite osnovne informacije**](basic-github-information.md#personal-access-tokens).

Korisni캜ki token mo쬰 biti kori코캖en **umesto lozinke** za Git preko HTTPS-a, ili mo쬰 biti kori코캖en za [**autentifikaciju na API preko osnovne autentifikacije**](https://docs.github.com/v3/auth/#basic-authentication). U zavisnosti od privilegija koje su mu dodeljene, mo쬯a 캖ete mo캖i da izvr코ite razli캜ite radnje.

Korisni캜ki token izgleda ovako: `ghp_EfHnQFcFHX6fGIu5mpduvRiYR584kK0dX123`

### Sa Oauth aplikacijom

Za uvod o [**Github Oauth aplikacijama proverite osnovne informacije**](basic-github-information.md#oauth-applications).

Napada캜 mo쬰 kreirati **malicious Oauth aplikaciju** da bi pristupio privilegovanim podacima/radnjama korisnika koji je prihvataju, verovatno kao deo phishing kampanje.

Ovo su [opsegovi koje Oauth aplikacija mo쬰 zatra쬴ti](https://docs.github.com/en/developers/apps/building-oauth-apps/scopes-for-oauth-apps). Uvek treba proveriti opsegove koji se tra쬰 pre nego 코to ih prihvatite.

Pored toga, kao 코to je obja코njeno u osnovnim informacijama, **organizacije mogu dati/oduzeti pristup aplikacijama tre캖ih strana** informacijama/repozitorijumima/radnjama vezanim za organizaciju.

### Sa Github aplikacijom

Za uvod o [**Github aplikacijama proverite osnovne informacije**](basic-github-information.md#github-applications).

Napada캜 mo쬰 kreirati **malicious Github aplikaciju** da bi pristupio privilegovanim podacima/radnjama korisnika koji je prihvataju, verovatno kao deo phishing kampanje.

Pored toga, kao 코to je obja코njeno u osnovnim informacijama, **organizacije mogu dati/oduzeti pristup aplikacijama tre캖ih strana** informacijama/repozitorijumima/radnjama vezanim za organizaciju.

## Kompromitovanje i zloupotreba Github akcije

Postoji nekoliko tehnika za kompromitovanje i zloupotrebu Github akcije, proverite ih ovde:

{% content-ref url="abusing-github-actions/" %}
[abusing-github-actions](abusing-github-actions/)
{% endcontent-ref %}

## Zaobila쬰nje za코tite grana

* **Zahtevajte odre캠eni broj odobrenja**: Ako ste kompromitovali nekoliko naloga, mo쬰te jednostavno prihvatiti svoje PR-ove iz drugih naloga. Ako imate samo nalog sa kojeg ste kreirali PR, ne mo쬰te prihvatiti svoj PR. Me캠utim, ako imate pristup **Github Action** okru쬰nju unutar repozitorijuma, koriste캖i **GITHUB\_TOKEN** mo쬯a 캖ete mo캖i da **odobrite svoj PR** i dobijete 1 odobrenje na ovaj na캜in.
* _Napomena za ovo i za ograni캜enje vlasnika koda da obi캜no korisnik ne캖e mo캖i da odobri svoje PR-ove, ali ako mo쬰te, mo쬰te to zloupotrebiti da prihvatite svoje PR-ove._
* **Odbacite odobrenja kada su novi commit-ovi poslati**: Ako ovo nije postavljeno, mo쬰te poslati legitimni kod, 캜ekati da ga neko odobri, a zatim staviti maliciozni kod i spojiti ga u za코ti캖enu granu.
* **Zahtevajte preglede od vlasnika koda**: Ako je ovo aktivirano i vi ste vlasnik koda, mogli biste napraviti **Github Action da kreira va코 PR i zatim ga sami odobrite**.
* Kada je **CODEOWNER datoteka pogre코no konfigurisana**, Github se ne 쬬li, ali je ne koristi. Stoga, ako je pogre코no konfigurisana, **za코tita vlasnika koda se ne primenjuje.**
* **Dozvolite odre캠enim akterima da zaobi캠u zahteve za povla캜enje**: Ako ste jedan od ovih aktera, mo쬰te zaobi캖i za코titu zahteva za povla캜enje.
* **Uklju캜ite administratore**: Ako ovo nije postavljeno i vi ste administrator repozitorijuma, mo쬰te zaobi캖i ovu za코titu grana.
* **PR otmica**: Mo쬰te biti u mogu캖nosti da **modifikujete PR nekog drugog** dodaju캖i maliciozni kod, odobravaju캖i rezultantni PR sami i spajaju캖i sve.
* **Uklanjanje za코tite grana**: Ako ste **administrator repozitorijuma, mo쬰te onemogu캖iti za코tite**, spojiti svoj PR i ponovo postaviti za코tite.
* **Zaobila쬰nje za코tita za slanje**: Ako repozitorijum **samo dozvoljava odre캠enim korisnicima** da 코alju push (spajaju kod) u granama (za코tita grane mo쬰 코tititi sve grane specificiraju캖i d쬺ker `*`).
* Ako imate **pristup za pisanje u repozitorijumu, ali vam nije dozvoljeno da 코aljete kod** zbog za코tite grane, jo코 uvek mo쬰te **napraviti novu granu** i unutar nje kreirati **github akciju koja se aktivira kada se kod po코alje**. Kako **za코tita grane ne캖e 코tititi granu dok ne bude kreirana**, ovo prvo slanje koda u granu 캖e **izvr코iti github akciju**.

## Zaobila쬰nje za코tita okru쬰nja

Za uvod o [**Github okru쬰nju proverite osnovne informacije**](basic-github-information.md#git-environments).

U slu캜aju da okru쬰nje mo쬰 biti **pristupano sa svih grana**, **nije za코ti캖eno** i mo쬰te lako pristupiti tajnama unutar okru쬰nja. Imajte na umu da mo쬰te nai캖i na repozitorijume gde su **sve grane za코ti캖ene** (specifikovanjem njihovih imena ili kori코캖enjem `*`), u tom scenariju, **prona캠ite granu u kojoj mo쬰te poslati kod** i mo쬰te **izvu캖i** tajne kreiranjem nove github akcije (ili modifikovanjem jedne).

Napomena, mo쬰te nai캖i na ivicu slu캜aja gde su **sve grane za코ti캖ene** (putem d쬺kera `*`) i specificirano je **ko mo쬰 slati kod u grane** (_to mo쬰te specificirati u za코titi grane_) i **va코em korisniku nije dozvoljeno**. I dalje mo쬰te pokrenuti prilago캠enu github akciju jer mo쬰te kreirati granu i koristiti okida캜 za slanje preko nje same. **Za코tita grane dozvoljava slanje u novu granu, tako da 캖e github akcija biti aktivirana**.
```yaml
push: # Run it when a push is made to a branch
branches:
- current_branch_name #Use '**' to run when a push is made to any branch
```
Napomena da 캖e se **nakon kreiranja** grane **za코tita grane primeniti na novu granu** i ne캖ete mo캖i da je izmenite, ali do tada 캖ete ve캖 izvu캖i tajne.

## Persistencija

* Generi코ite **korisni캜ki token**
* Uk眠들te **github tokene** iz **tajni**
* **Brisanje** rezultata **workflow-a** i **grana**
* Dajte **vi코e dozvola celoj organizaciji**
* Kreirajte **webhook-ove** za eksfiltraciju informacija
* Pozovite **spolja코nje saradnike**
* **Uklonite** **webhook-ove** koje koristi **SIEM**
* Kreirajte/izmenite **Github Action** sa **bekdoor-om**
* Prona캠ite **ranjivu Github Action za injekciju komandi** putem **modifikacije** vrednosti **tajne**

### Impostor Commit-ovi - Bekdoor putem repo commit-ova

U Github-u je mogu캖e **napraviti PR za repo iz forka**. 캛ak i ako PR nije **prihva캖en**, **commit** id unutar originalnog repoa 캖e biti kreiran za fork verziju koda. Stoga, napada캜 **mo쬰 da se oslanja na kori코캖enje specifi캜nog commit-a iz naizgled legitimnog repoa koji nije kreirao vlasnik repoa**.

Kao [**ovaj**](https://github.com/actions/checkout/commit/c7d749a2d57b4b375d1ebcd17cfbfb60c676f18e):
```yaml
name: example
on: [push]
jobs:
commit:
runs-on: ubuntu-latest
steps:
- uses: actions/checkout@c7d749a2d57b4b375d1ebcd17cfbfb60c676f18e
- shell: bash
run: |
echo 'hello world!'
```
Za vi코e informacija proverite [https://www.chainguard.dev/unchained/what-the-fork-imposter-commits-in-github-actions-and-ci-cd](https://www.chainguard.dev/unchained/what-the-fork-imposter-commits-in-github-actions-and-ci-cd)

{% hint style="success" %}
U캜ite i ve쬭ajte AWS Hacking:<img src="../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/image (1).png" alt="" data-size="line">\
U캜ite i ve쬭ajte GCP Hacking: <img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Podr쬴te HackTricks</summary>

* Proverite [**planove pretplate**](https://github.com/sponsors/carlospolop)!
* **Pridru쬴te se** 游눫 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili **pratite** nas na **Twitteru** 游냕 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podelite hakerske trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
{% endhint %}
