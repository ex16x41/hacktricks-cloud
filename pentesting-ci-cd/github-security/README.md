# S√©curit√© Github

{% hint style="success" %}
Apprenez et pratiquez le hacking AWS :<img src="../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Apprenez et pratiquez le hacking GCP : <img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Soutenir HackTricks</summary>

* V√©rifiez les [**plans d'abonnement**](https://github.com/sponsors/carlospolop) !
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez-nous sur** **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Partagez des astuces de hacking en soumettant des PR au** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) d√©p√¥ts github.

</details>
{% endhint %}

## Qu'est-ce que Github

(De [ici](https://kinsta.com/knowledgebase/what-is-github/)) √Ä un niveau √©lev√©, **GitHub est un site web et un service bas√© sur le cloud qui aide les d√©veloppeurs √† stocker et g√©rer leur code, ainsi qu'√† suivre et contr√¥ler les modifications apport√©es √† leur code**.

### Informations de base

{% content-ref url="basic-github-information.md" %}
[basic-github-information.md](basic-github-information.md)
{% endcontent-ref %}

## Reconnaissance externe

Les d√©p√¥ts Github peuvent √™tre configur√©s comme publics, priv√©s et internes.

* **Priv√©** signifie que **seules** les personnes de l'**organisation** pourront y acc√©der.
* **Interne** signifie que **seules** les personnes de l'**entreprise** (une entreprise peut avoir plusieurs organisations) pourront y acc√©der.
* **Public** signifie que **tout internet** pourra y acc√©der.

Dans le cas o√π vous connaissez le **utilisateur, le d√©p√¥t ou l'organisation que vous souhaitez cibler**, vous pouvez utiliser des **github dorks** pour trouver des informations sensibles ou rechercher des **fuites d'informations sensibles** **dans chaque d√©p√¥t**.

### Github Dorks

Github permet de **rechercher quelque chose en sp√©cifiant comme port√©e un utilisateur, un d√©p√¥t ou une organisation**. Par cons√©quent, avec une liste de cha√Ænes qui vont appara√Ætre pr√®s d'informations sensibles, vous pouvez facilement **rechercher des informations sensibles potentielles dans votre cible**.

Outils (chaque outil contient sa liste de dorks) :

* [https://github.com/obheda12/GitDorker](https://github.com/obheda12/GitDorker) ([Liste de Dorks](https://github.com/obheda12/GitDorker/tree/master/Dorks))
* [https://github.com/techgaun/github-dorks](https://github.com/techgaun/github-dorks) ([Liste de Dorks](https://github.com/techgaun/github-dorks/blob/master/github-dorks.txt))
* [https://github.com/hisxo/gitGraber](https://github.com/hisxo/gitGraber) ([Liste de Dorks](https://github.com/hisxo/gitGraber/tree/master/wordlists))

### Fuites Github

Veuillez noter que les github dorks sont √©galement destin√©s √† rechercher des fuites en utilisant les options de recherche github. Cette section est d√©di√©e √† ces outils qui vont **t√©l√©charger chaque d√©p√¥t et rechercher des informations sensibles dans ceux-ci** (m√™me en v√©rifiant une certaine profondeur des commits).

Outils (chaque outil contient sa liste de regex) :

* [https://github.com/zricethezav/gitleaks](https://github.com/zricethezav/gitleaks)
* [https://github.com/trufflesecurity/truffleHog](https://github.com/trufflesecurity/truffleHog)
* [https://github.com/eth0izzle/shhgit](https://github.com/eth0izzle/shhgit)
* [https://github.com/michenriksen/gitrob](https://github.com/michenriksen/gitrob)
* [https://github.com/anshumanbh/git-all-secrets](https://github.com/anshumanbh/git-all-secrets)
* [https://github.com/kootenpv/gittyleaks](https://github.com/kootenpv/gittyleaks)
* [https://github.com/awslabs/git-secrets](https://github.com/awslabs/git-secrets)

{% hint style="warning" %}
Lorsque vous recherchez des fuites dans un d√©p√¥t et ex√©cutez quelque chose comme `git log -p`, n'oubliez pas qu'il pourrait y avoir **d'autres branches avec d'autres commits** contenant des secrets !
{% endhint %}

### Forks externes

Il est possible de **compromettre des d√©p√¥ts en abusant des demandes de tirage**. Pour savoir si un d√©p√¥t est vuln√©rable, vous devez principalement lire les configurations yaml des Github Actions. [**Plus d'infos √† ce sujet ci-dessous**](./#execution-from-a-external-fork).

### Fuites Github dans des forks supprim√©s/internes

M√™me si supprim√© ou interne, il pourrait √™tre possible d'obtenir des donn√©es sensibles √† partir de forks de d√©p√¥ts github. V√©rifiez ici :

{% content-ref url="accessible-deleted-data-in-github.md" %}
[accessible-deleted-data-in-github.md](accessible-deleted-data-in-github.md)
{% endcontent-ref %}

## Renforcement de l'organisation

### Privil√®ges des membres

Il existe certains **privil√®ges par d√©faut** qui peuvent √™tre attribu√©s aux **membres** de l'organisation. Ceux-ci peuvent √™tre contr√¥l√©s depuis la page `https://github.com/organizations/<org_name>/settings/member_privileges` ou depuis l'[**API des organisations**](https://docs.github.com/en/rest/orgs/orgs).

* **Permissions de base** : Les membres auront la permission Aucune/Lire/√©crire/Admin sur les d√©p√¥ts de l'organisation. Il est recommand√© de choisir **Aucune** ou **Lire**.
* **Forking de d√©p√¥t** : Si ce n'est pas n√©cessaire, il est pr√©f√©rable de **ne pas autoriser** les membres √† forker les d√©p√¥ts de l'organisation.
* **Cr√©ation de pages** : Si ce n'est pas n√©cessaire, il est pr√©f√©rable de **ne pas autoriser** les membres √† publier des pages √† partir des d√©p√¥ts de l'organisation. Si n√©cessaire, vous pouvez autoriser la cr√©ation de pages publiques ou priv√©es.
* **Demandes d'acc√®s √† l'int√©gration** : Avec cela activ√©, les collaborateurs externes pourront demander l'acc√®s aux applications GitHub ou OAuth pour acc√©der √† cette organisation et √† ses ressources. C'est g√©n√©ralement n√©cessaire, mais si ce n'est pas le cas, il est pr√©f√©rable de le d√©sactiver.
* _Je n'ai pas trouv√© cette info dans la r√©ponse des API, partagez si vous le faites_
* **Changement de visibilit√© du d√©p√¥t** : Si activ√©, les **membres** avec des permissions **admin** pour le **d√©p√¥t** pourront **changer sa visibilit√©**. Si d√©sactiv√©, seuls les propri√©taires de l'organisation peuvent changer les visibilit√©s des d√©p√¥ts. Si vous **ne** voulez pas que les gens rendent les choses **publiques**, assurez-vous que cela est **d√©sactiv√©**.
* _Je n'ai pas trouv√© cette info dans la r√©ponse des API, partagez si vous le faites_
* **Suppression et transfert de d√©p√¥t** : Si activ√©, les membres avec des permissions **admin** pour le d√©p√¥t pourront **supprimer** ou **transf√©rer** des **d√©p√¥ts** publics et priv√©s.
* _Je n'ai pas trouv√© cette info dans la r√©ponse des API, partagez si vous le faites_
* **Autoriser les membres √† cr√©er des √©quipes** : Si activ√©, tout **membre** de l'organisation pourra **cr√©er** de nouvelles **√©quipes**. Si d√©sactiv√©, seuls les propri√©taires de l'organisation peuvent cr√©er de nouvelles √©quipes. Il est pr√©f√©rable d'avoir cela d√©sactiv√©.
* _Je n'ai pas trouv√© cette info dans la r√©ponse des API, partagez si vous le faites_
* **D'autres choses peuvent √™tre configur√©es** sur cette page, mais les pr√©c√©dentes sont celles qui sont les plus li√©es √† la s√©curit√©.

### Param√®tres des Actions

Plusieurs param√®tres li√©s √† la s√©curit√© peuvent √™tre configur√©s pour les actions depuis la page `https://github.com/organizations/<org_name>/settings/actions`.

{% hint style="info" %}
Notez que toutes ces configurations peuvent √©galement √™tre d√©finies sur chaque d√©p√¥t ind√©pendamment.
{% endhint %}

* **Politiques des actions Github** : Cela vous permet d'indiquer quels d√©p√¥ts peuvent ex√©cuter des workflows et quels workflows doivent √™tre autoris√©s. Il est recommand√© de **sp√©cifier quels d√©p√¥ts** doivent √™tre autoris√©s et de ne pas permettre √† toutes les actions de s'ex√©cuter.
* [**API-1**](https://docs.github.com/en/rest/actions/permissions#get-allowed-actions-and-reusable-workflows-for-an-organization)**,** [**API-2**](https://docs.github.com/en/rest/actions/permissions#list-selected-repositories-enabled-for-github-actions-in-an-organization)
* **Workflows de demandes de tirage de forks de collaborateurs externes** : Il est recommand√© de **demander une approbation pour tous** les collaborateurs externes.
* _Je n'ai pas trouv√© d'API avec cette info, partagez si vous le faites_
* **Ex√©cuter des workflows √† partir de demandes de tirage de forks** : Il est fortement **d√©conseill√© d'ex√©cuter des workflows √† partir de demandes de tirage** car les mainteneurs de l'origine du fork auront la possibilit√© d'utiliser des jetons avec des permissions de lecture sur le d√©p√¥t source.
* _Je n'ai pas trouv√© d'API avec cette info, partagez si vous le faites_
* **Permissions des workflows** : Il est fortement recommand√© de **donner uniquement des permissions de lecture sur le d√©p√¥t**. Il est d√©conseill√© de donner des permissions d'√©criture et de cr√©ation/d'approbation de demandes de tirage pour √©viter l'abus du GITHUB\_TOKEN donn√© aux workflows en cours d'ex√©cution.
* [**API**](https://docs.github.com/en/rest/actions/permissions#get-default-workflow-permissions-for-an-organization)

### Int√©grations

_Faites-moi savoir si vous connaissez le point de terminaison de l'API pour acc√©der √† cette info !_

* **Politique d'acc√®s aux applications tierces** : Il est recommand√© de restreindre l'acc√®s √† chaque application et de n'autoriser que celles n√©cessaires (apr√®s les avoir examin√©es).
* **Applications GitHub install√©es** : Il est recommand√© de n'autoriser que celles n√©cessaires (apr√®s les avoir examin√©es).

## Reconnaissance et attaques abusant des identifiants

Pour ce sc√©nario, nous allons supposer que vous avez obtenu un acc√®s √† un compte github.

### Avec les identifiants utilisateur

Si vous avez d'une mani√®re ou d'une autre d√©j√† des identifiants pour un utilisateur au sein d'une organisation, vous pouvez **vous connecter** et v√©rifier quels **r√¥les d'entreprise et d'organisation vous avez**, si vous √™tes un membre ordinaire, v√©rifiez quels **permissions ont les membres ordinaires**, dans quels **groupes** vous √™tes, quelles **permissions vous avez** sur quels **d√©p√¥ts**, et **comment les d√©p√¥ts sont prot√©g√©s**.

Notez que **2FA peut √™tre utilis√©**, donc vous ne pourrez acc√©der √† ces informations que si vous pouvez √©galement **passer ce contr√¥le**.

{% hint style="info" %}
Notez que si vous **parvenez √† voler le cookie `user_session`** (actuellement configur√© avec SameSite: Lax), vous pouvez **compl√®tement usurper l'identit√© de l'utilisateur** sans avoir besoin d'identifiants ou de 2FA.
{% endhint %}

V√©rifiez la section ci-dessous sur les [**contournements de protection des branches**](./#branch-protection-bypass) au cas o√π cela serait utile.

### Avec la cl√© SSH de l'utilisateur

Github permet aux **utilisateurs** de d√©finir des **cl√©s SSH** qui seront utilis√©es comme **m√©thode d'authentification pour d√©ployer du code** en leur nom (aucune 2FA n'est appliqu√©e).

Avec cette cl√©, vous pouvez effectuer des **modifications dans les d√©p√¥ts o√π l'utilisateur a des privil√®ges**, cependant, vous ne pouvez pas l'utiliser pour acc√©der √† l'API github pour √©num√©rer l'environnement. Cependant, vous pouvez **√©num√©rer les param√®tres locaux** pour obtenir des informations sur les d√©p√¥ts et l'utilisateur auquel vous avez acc√®s :
```bash
# Go to the the repository folder
# Get repo config and current user name and email
git config --list
```
Si l'utilisateur a configur√© son nom d'utilisateur comme son nom d'utilisateur github, vous pouvez acc√©der aux **cl√©s publiques qu'il a d√©finies** dans son compte √† _https://github.com/\<github\_username>.keys_, vous pouvez v√©rifier cela pour confirmer que la cl√© priv√©e que vous avez trouv√©e peut √™tre utilis√©e.

Les **cl√©s SSH** peuvent √©galement √™tre d√©finies dans les d√©p√¥ts en tant que **cl√©s de d√©ploiement**. Quiconque ayant acc√®s √† cette cl√© pourra **lancer des projets √† partir d'un d√©p√¥t**. En g√©n√©ral, sur un serveur avec diff√©rentes cl√©s de d√©ploiement, le fichier local **`~/.ssh/config`** vous donnera des informations sur la cl√© √† laquelle il est li√©.

#### Cl√©s GPG

Comme expliqu√© [**ici**](https://github.com/carlospolop/hacktricks-cloud/blob/master/pentesting-ci-cd/github-security/broken-reference/README.md), il est parfois n√©cessaire de signer les commits ou vous pourriez √™tre d√©couvert.

V√©rifiez localement si l'utilisateur actuel a une cl√© avec :
```shell
gpg --list-secret-keys --keyid-format=long
```
### Avec le jeton utilisateur

Pour une introduction sur [**les jetons utilisateur, consultez les informations de base**](basic-github-information.md#personal-access-tokens).

Un jeton utilisateur peut √™tre utilis√© **au lieu d'un mot de passe** pour Git via HTTPS, ou peut √™tre utilis√© pour [**s'authentifier √† l'API via l'authentification de base**](https://docs.github.com/v3/auth/#basic-authentication). Selon les privil√®ges qui y sont attach√©s, vous pourriez √™tre en mesure d'effectuer diff√©rentes actions.

Un jeton utilisateur ressemble √† ceci : `ghp_EfHnQFcFHX6fGIu5mpduvRiYR584kK0dX123`

### Avec l'application Oauth

Pour une introduction sur [**les applications Oauth de Github, consultez les informations de base**](basic-github-information.md#oauth-applications).

Un attaquant pourrait cr√©er une **application Oauth malveillante** pour acc√©der aux donn√©es/actions privil√©gi√©es des utilisateurs qui les acceptent probablement dans le cadre d'une campagne de phishing.

Voici les [port√©es qu'une application Oauth peut demander](https://docs.github.com/en/developers/apps/building-oauth-apps/scopes-for-oauth-apps). Un utilisateur doit toujours v√©rifier les port√©es demand√©es avant de les accepter.

De plus, comme expliqu√© dans les informations de base, **les organisations peuvent donner/refuser l'acc√®s aux applications tierces** aux informations/repos/actions li√©es √† l'organisation.

### Avec l'application Github

Pour une introduction sur [**les applications Github, consultez les informations de base**](basic-github-information.md#github-applications).

Un attaquant pourrait cr√©er une **application Github malveillante** pour acc√©der aux donn√©es/actions privil√©gi√©es des utilisateurs qui les acceptent probablement dans le cadre d'une campagne de phishing.

De plus, comme expliqu√© dans les informations de base, **les organisations peuvent donner/refuser l'acc√®s aux applications tierces** aux informations/repos/actions li√©es √† l'organisation.

## Compromettre et abuser de l'action Github

Il existe plusieurs techniques pour compromettre et abuser d'une action Github, consultez-les ici :

{% content-ref url="abusing-github-actions/" %}
[abusing-github-actions](abusing-github-actions/)
{% endcontent-ref %}

## Contournement de la protection des branches

* **Exiger un nombre d'approbations** : Si vous avez compromis plusieurs comptes, vous pourriez simplement accepter vos PRs d'autres comptes. Si vous n'avez que le compte √† partir duquel vous avez cr√©√© la PR, vous ne pouvez pas accepter votre propre PR. Cependant, si vous avez acc√®s √† un **environnement d'action Github** √† l'int√©rieur du d√©p√¥t, en utilisant le **GITHUB\_TOKEN**, vous pourriez √™tre en mesure d'**approuver votre PR** et obtenir 1 approbation de cette mani√®re.
* _Remarque pour cela et pour la restriction des propri√©taires de code que g√©n√©ralement un utilisateur ne pourra pas approuver ses propres PRs, mais si vous le pouvez, vous pouvez en abuser pour accepter vos PRs._
* **Rejeter les approbations lorsque de nouveaux commits sont pouss√©s** : Si cela n'est pas d√©fini, vous pouvez soumettre du code l√©gitime, attendre qu'il soit approuv√©, puis mettre du code malveillant et le fusionner dans la branche prot√©g√©e.
* **Exiger des revues des propri√©taires de code** : Si cela est activ√© et que vous √™tes un propri√©taire de code, vous pourriez faire en sorte qu'une **action Github cr√©e votre PR et ensuite l'approuver vous-m√™me**.
* Lorsqu'un **fichier CODEOWNER est mal configur√©**, Github ne se plaint pas mais ne l'utilise pas. Par cons√©quent, s'il est mal configur√©, **la protection des propri√©taires de code n'est pas appliqu√©e.**
* **Autoriser des acteurs sp√©cifi√©s √† contourner les exigences de demande de tirage** : Si vous √™tes l'un de ces acteurs, vous pouvez contourner les protections de demande de tirage.
* **Inclure les administrateurs** : Si cela n'est pas d√©fini et que vous √™tes administrateur du d√©p√¥t, vous pouvez contourner ces protections de branche.
* **D√©tournement de PR** : Vous pourriez √™tre en mesure de **modifier la PR de quelqu'un d'autre** en ajoutant du code malveillant, en approuvant la PR r√©sultante vous-m√™me et en fusionnant le tout.
* **Suppression des protections de branche** : Si vous √™tes un **administrateur du d√©p√¥t, vous pouvez d√©sactiver les protections**, fusionner votre PR et r√©tablir les protections.
* **Contourner les protections de pouss√©e** : Si un d√©p√¥t **n'autorise que certains utilisateurs** √† envoyer des pouss√©es (fusionner du code) dans des branches (la protection de branche pourrait prot√©ger toutes les branches en sp√©cifiant le caract√®re g√©n√©rique `*`).
* Si vous avez **un acc√®s en √©criture sur le d√©p√¥t mais que vous n'√™tes pas autoris√© √† pousser du code** en raison de la protection de branche, vous pouvez toujours **cr√©er une nouvelle branche** et √† l'int√©rieur, cr√©er une **action github qui est d√©clench√©e lorsque du code est pouss√©**. Comme la **protection de branche ne prot√©gera pas la branche tant qu'elle n'est pas cr√©√©e**, ce premier envoi de code vers la branche **ex√©cutera l'action github**.

## Contournement des protections des environnements

Pour une introduction sur [**l'environnement Github, consultez les informations de base**](basic-github-information.md#git-environments).

Dans le cas o√π un environnement peut √™tre **accessible depuis toutes les branches**, il **n'est pas prot√©g√©** et vous pouvez facilement acc√©der aux secrets √† l'int√©rieur de l'environnement. Notez que vous pourriez trouver des d√©p√¥ts o√π **toutes les branches sont prot√©g√©es** (en sp√©cifiant leurs noms ou en utilisant `*`), dans ce sc√©nario, **trouvez une branche o√π vous pouvez pousser du code** et vous pouvez **exfiltrer** les secrets en cr√©ant une nouvelle action github (ou en en modifiant une).

Notez que vous pourriez trouver le cas limite o√π **toutes les branches sont prot√©g√©es** (via le caract√®re g√©n√©rique `*`), il est sp√©cifi√© **qui peut pousser du code vers les branches** (_vous pouvez sp√©cifier cela dans la protection de branche_) et **votre utilisateur n'est pas autoris√©**. Vous pouvez toujours ex√©cuter une action github personnalis√©e car vous pouvez cr√©er une branche et utiliser le d√©clencheur de pouss√©e sur elle-m√™me. La **protection de branche permet la pouss√©e vers une nouvelle branche, donc l'action github sera d√©clench√©e**.
```yaml
push: # Run it when a push is made to a branch
branches:
- current_branch_name #Use '**' to run when a push is made to any branch
```
Notez que **apr√®s la cr√©ation** de la branche, la **protection de la branche s'appliquera √† la nouvelle branche** et vous ne pourrez pas la modifier, mais √† ce moment-l√†, vous aurez d√©j√† extrait les secrets.

## Persistance

* G√©n√©rer **un jeton utilisateur**
* Voler **des jetons github** √† partir des **secrets**
* **Suppression** des **r√©sultats** et des **branches** de workflow
* Donner **plus de permissions √† toute l'organisation**
* Cr√©er des **webhooks** pour exfiltrer des informations
* Inviter **des collaborateurs externes**
* **Supprimer** les **webhooks** utilis√©s par le **SIEM**
* Cr√©er/modifier **Github Action** avec une **porte d√©rob√©e**
* Trouver **Github Action vuln√©rable √† l'injection de commandes** via la modification de la valeur **secret**

### Commits d'imposteur - Porte d√©rob√©e via des commits de repo

Dans Github, il est possible de **cr√©er une PR pour un repo √† partir d'un fork**. M√™me si la PR n'est **pas accept√©e**, un **commit** id √† l'int√©rieur du repo original va √™tre cr√©√© pour la version fork du code. Par cons√©quent, un attaquant **pourrait √©pingler √† utiliser un commit sp√©cifique d'un repo apparemment l√©gitime qui n'a pas √©t√© cr√©√© par le propri√©taire du repo**.

Comme [**ceci**](https://github.com/actions/checkout/commit/c7d749a2d57b4b375d1ebcd17cfbfb60c676f18e):
```yaml
name: example
on: [push]
jobs:
commit:
runs-on: ubuntu-latest
steps:
- uses: actions/checkout@c7d749a2d57b4b375d1ebcd17cfbfb60c676f18e
- shell: bash
run: |
echo 'hello world!'
```
Pour plus d'informations, consultez [https://www.chainguard.dev/unchained/what-the-fork-imposter-commits-in-github-actions-and-ci-cd](https://www.chainguard.dev/unchained/what-the-fork-imposter-commits-in-github-actions-and-ci-cd)

{% hint style="success" %}
Apprenez et pratiquez le hacking AWS :<img src="../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Formation Expert Red Team AWS (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Apprenez et pratiquez le hacking GCP : <img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Formation Expert Red Team GCP (GRTE)**<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Soutenir HackTricks</summary>

* Consultez les [**plans d'abonnement**](https://github.com/sponsors/carlospolop) !
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez-nous sur** **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Partagez des astuces de hacking en soumettant des PRs aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) d√©p√¥ts github.

</details>
{% endhint %}
