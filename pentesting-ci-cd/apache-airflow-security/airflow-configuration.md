# Konfiguracija Airflow-a

{% hint style="success" %}
UÄite i veÅ¾bajte AWS Hacking:<img src="../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
UÄite i veÅ¾bajte GCP Hacking: <img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>PodrÅ¡ka HackTricks</summary>

* Proverite [**planove pretplate**](https://github.com/sponsors/carlospolop)!
* **PridruÅ¾ite se** ğŸ’¬ [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili **pratite** nas na **Twitteru** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Podelite hakerske trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
{% endhint %}

## Konfiguracioni Fajl

**Apache Airflow** generiÅ¡e **config fajl** na svim airflow maÅ¡inama pod nazivom **`airflow.cfg`** u home direktorijumu korisnika airflow. Ovaj config fajl sadrÅ¾i informacije o konfiguraciji i **moÅ¾e sadrÅ¾ati zanimljive i osetljive informacije.**

**Postoje dva naÄina da se pristupi ovom fajlu: kompromitovanjem neke airflow maÅ¡ine ili pristupanjem web konzoli.**

Napomena da **vrednosti unutar config fajla** **moÅ¾da nisu one koje se koriste**, jer ih moÅ¾ete prepisati postavljanjem env varijabli kao Å¡to je `AIRFLOW__WEBSERVER__EXPOSE_CONFIG: 'true'`.

Ako imate pristup **config fajlu na web serveru**, moÅ¾ete proveriti **pravu aktivnu konfiguraciju** na istoj stranici na kojoj se config prikazuje.\
Ako imate **pristup nekoj maÅ¡ini unutar airflow okruÅ¾enja**, proverite **okruÅ¾enje**.

Neke zanimljive vrednosti za proveru prilikom Äitanja config fajla:

### \[api]

* **`access_control_allow_headers`**: Ovo oznaÄava **dozvoljene** **zaglavlja** za **CORS**
* **`access_control_allow_methods`**: Ovo oznaÄava **dozvoljene metode** za **CORS**
* **`access_control_allow_origins`**: Ovo oznaÄava **dozvoljene izvore** za **CORS**
* **`auth_backend`**: [**Prema dokumentaciji**](https://airflow.apache.org/docs/apache-airflow/stable/security/api.html) nekoliko opcija moÅ¾e biti na snazi za konfiguraciju ko moÅ¾e pristupiti API-ju:
* `airflow.api.auth.backend.deny_all`: **Podrazumevano niko** ne moÅ¾e pristupiti API-ju
* `airflow.api.auth.backend.default`: **Svi mogu** pristupiti bez autentifikacije
* `airflow.api.auth.backend.kerberos_auth`: Za konfiguraciju **kerberos autentifikacije**
* `airflow.api.auth.backend.basic_auth`: Za **osnovnu autentifikaciju**
* `airflow.composer.api.backend.composer_auth`: Koristi autentifikaciju kompozitora (GCP) (iz [**ovde**](https://cloud.google.com/composer/docs/access-airflow-api)).
* `composer_auth_user_registration_role`: Ovo oznaÄava **ulogu** koju Ä‡e **korisnik kompozitora** dobiti unutar **airflow** (**Op** podrazumevano).
* TakoÄ‘e moÅ¾ete **napraviti svoju metodu autentifikacije** pomoÄ‡u Pythona.
* **`google_key_path`:** Putanja do **GCP servisnog naloga**

### **\[atlas]**

* **`password`**: Atlas lozinka
* **`username`**: Atlas korisniÄko ime

### \[celery]

* **`flower_basic_auth`** : Akreditivi (_user1:password1,user2:password2_)
* **`result_backend`**: Postgres url koji moÅ¾e sadrÅ¾ati **akreditive**.
* **`ssl_cacert`**: Putanja do cacert
* **`ssl_cert`**: Putanja do certifikata
* **`ssl_key`**: Putanja do kljuÄa

### \[core]

* **`dag_discovery_safe_mode`**: OmoguÄ‡eno podrazumevano. Kada se otkrivaju DAG-ovi, ignoriÅ¡u se svi fajlovi koji ne sadrÅ¾e stringove `DAG` i `airflow`.
* **`fernet_key`**: KljuÄ za Äuvanje enkriptovanih varijabli (simetriÄan)
* **`hide_sensitive_var_conn_fields`**: OmoguÄ‡eno podrazumevano, skriva osetljive informacije o konekcijama.
* **`security`**: Koji sigurnosni modul koristiti (na primer kerberos)

### \[dask]

* **`tls_ca`**: Putanja do ca
* **`tls_cert`**: Putanja do certifikata
* **`tls_key`**: Putanja do tls kljuÄa

### \[kerberos]

* **`ccache`**: Putanja do ccache fajla
* **`forwardable`**: OmoguÄ‡eno podrazumevano

### \[logging]

* **`google_key_path`**: Putanja do GCP JSON akredita.

### \[secrets]

* **`backend`**: Puno ime klase backend-a za tajne koje treba omoguÄ‡iti
* **`backend_kwargs`**: Parametar backend\_kwargs se uÄitava u reÄnik i prosleÄ‘uje **init** klasi backend-a za tajne.

### \[smtp]

* **`smtp_password`**: SMTP lozinka
* **`smtp_user`**: SMTP korisnik

### \[webserver]

* **`cookie_samesite`**: Podrazumevano je **Lax**, tako da je veÄ‡ najslabija moguÄ‡a vrednost
* **`cookie_secure`**: Postavi **sigurnu oznaku** na sesijskom kolaÄiÄ‡u
* **`expose_config`**: Podrazumevano je False, ako je taÄno, **config** se moÅ¾e **proÄitati** iz web **konzole**
* **`expose_stacktrace`**: Podrazumevano je True, prikazaÄ‡e **python tracebacks** (potencijalno korisno za napadaÄa)
* **`secret_key`**: Ovo je **kljuÄ koji koristi flask za potpisivanje kolaÄiÄ‡a** (ako imate ovo moÅ¾ete **imitirati bilo kog korisnika u Airflow-u**)
* **`web_server_ssl_cert`**: **Putanja** do **SSL** **certifikata**
* **`web_server_ssl_key`**: **Putanja** do **SSL** **kljuÄa**
* **`x_frame_enabled`**: Podrazumevano je **True**, tako da podrazumevano clickjacking nije moguÄ‡

### Web Autentifikacija

Podrazumevano je **web autentifikacija** specificirana u fajlu **`webserver_config.py`** i konfiguriÅ¡e se kao
```bash
AUTH_TYPE = AUTH_DB
```
Å to znaÄi da se **autentifikacija proverava u odnosu na bazu podataka**. MeÄ‘utim, druge konfiguracije su moguÄ‡e kao Å¡to su
```bash
AUTH_TYPE = AUTH_OAUTH
```
Da se **autentifikacija prepusti uslugama treÄ‡ih strana**.

MeÄ‘utim, postoji i opcija da se **omoguÄ‡i pristup anonimnim korisnicima**, postavljanjem sledeÄ‡eg parametra na **Å¾eljenu ulogu**:
```bash
AUTH_ROLE_PUBLIC = 'Admin'
```
{% hint style="success" %}
UÄite i veÅ¾bajte AWS Hacking:<img src="../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
UÄite i veÅ¾bajte GCP Hacking: <img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>PodrÅ¾ite HackTricks</summary>

* Proverite [**planove pretplate**](https://github.com/sponsors/carlospolop)!
* **PridruÅ¾ite se** ğŸ’¬ [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili **pratite** nas na **Twitteru** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Podelite hakerske trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
{% endhint %}
