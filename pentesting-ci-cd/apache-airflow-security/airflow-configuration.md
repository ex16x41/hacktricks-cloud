# Configura√ß√£o do Airflow

{% hint style="success" %}
Aprenda e pratique Hacking AWS:<img src="../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">\
Aprenda e pratique Hacking GCP: <img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Suporte ao HackTricks</summary>

* Confira os [**planos de assinatura**](https://github.com/sponsors/carlospolop)!
* **Junte-se ao** üí¨ [**grupo do Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga**-nos no **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe truques de hacking enviando PRs para os reposit√≥rios do** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
{% endhint %}

## Arquivo de Configura√ß√£o

**Apache Airflow** gera um **arquivo de configura√ß√£o** em todas as m√°quinas do airflow chamado **`airflow.cfg`** na pasta inicial do usu√°rio airflow. Este arquivo de configura√ß√£o cont√©m informa√ß√µes de configura√ß√£o e **pode conter informa√ß√µes interessantes e sens√≠veis.**

**Existem duas maneiras de acessar este arquivo: Comprometendo alguma m√°quina do airflow ou acessando o console web.**

Observe que os **valores dentro do arquivo de configura√ß√£o** **podem n√£o ser os utilizados**, pois voc√™ pode sobrescrev√™-los definindo vari√°veis de ambiente como `AIRFLOW__WEBSERVER__EXPOSE_CONFIG: 'true'`.

Se voc√™ tiver acesso ao **arquivo de configura√ß√£o no servidor web**, pode verificar a **configura√ß√£o real em execu√ß√£o** na mesma p√°gina em que a configura√ß√£o √© exibida.\
Se voc√™ tiver **acesso a alguma m√°quina dentro do ambiente do airflow**, verifique o **ambiente**.

Alguns valores interessantes para verificar ao ler o arquivo de configura√ß√£o:

### \[api]

* **`access_control_allow_headers`**: Isso indica os **cabe√ßalhos permitidos** para **CORS**
* **`access_control_allow_methods`**: Isso indica os **m√©todos permitidos** para **CORS**
* **`access_control_allow_origins`**: Isso indica as **origens permitidas** para **CORS**
* **`auth_backend`**: [**De acordo com a documenta√ß√£o**](https://airflow.apache.org/docs/apache-airflow/stable/security/api.html) algumas op√ß√µes podem ser configuradas para definir quem pode acessar a API:
* `airflow.api.auth.backend.deny_all`: **Por padr√£o, ningu√©m** pode acessar a API
* `airflow.api.auth.backend.default`: **Todos podem** acess√°-la sem autentica√ß√£o
* `airflow.api.auth.backend.kerberos_auth`: Para configurar **autentica√ß√£o kerberos**
* `airflow.api.auth.backend.basic_auth`: Para **autentica√ß√£o b√°sica**
* `airflow.composer.api.backend.composer_auth`: Usa autentica√ß√£o de compositores (GCP) (de [**aqui**](https://cloud.google.com/composer/docs/access-airflow-api)).
* `composer_auth_user_registration_role`: Isso indica a **fun√ß√£o** que o **usu√°rio compositor** ter√° dentro do **airflow** (**Op** por padr√£o).
* Voc√™ tamb√©m pode **criar seu pr√≥prio m√©todo de autentica√ß√£o** com python.
* **`google_key_path`:** Caminho para a **chave da conta de servi√ßo GCP**

### **\[atlas]**

* **`password`**: Senha do Atlas
* **`username`**: Nome de usu√°rio do Atlas

### \[celery]

* **`flower_basic_auth`** : Credenciais (_user1:password1,user2:password2_)
* **`result_backend`**: URL do Postgres que pode conter **credenciais**.
* **`ssl_cacert`**: Caminho para o cacert
* **`ssl_cert`**: Caminho para o cert
* **`ssl_key`**: Caminho para a chave

### \[core]

* **`dag_discovery_safe_mode`**: Habilitado por padr√£o. Ao descobrir DAGs, ignore quaisquer arquivos que n√£o contenham as strings `DAG` e `airflow`.
* **`fernet_key`**: Chave para armazenar vari√°veis criptografadas (sim√©trica)
* **`hide_sensitive_var_conn_fields`**: Habilitado por padr√£o, oculta informa√ß√µes sens√≠veis de conex√µes.
* **`security`**: Qual m√≥dulo de seguran√ßa usar (por exemplo, kerberos)

### \[dask]

* **`tls_ca`**: Caminho para ca
* **`tls_cert`**: Caminho para o cert
* **`tls_key`**: Caminho para a chave tls

### \[kerberos]

* **`ccache`**: Caminho para o arquivo ccache
* **`forwardable`**: Habilitado por padr√£o

### \[logging]

* **`google_key_path`**: Caminho para as credenciais JSON do GCP.

### \[secrets]

* **`backend`**: Nome completo da classe do backend de segredos a ser habilitado
* **`backend_kwargs`**: O par√¢metro backend\_kwargs √© carregado em um dicion√°rio e passado para **init** da classe do backend de segredos.

### \[smtp]

* **`smtp_password`**: Senha SMTP
* **`smtp_user`**: Usu√°rio SMTP

### \[webserver]

* **`cookie_samesite`**: Por padr√£o √© **Lax**, ent√£o j√° √© o valor mais fraco poss√≠vel
* **`cookie_secure`**: Define a **flag segura** no cookie de sess√£o
* **`expose_config`**: Por padr√£o √© Falso, se verdadeiro, a **configura√ß√£o** pode ser **lida** do **console** web
* **`expose_stacktrace`**: Por padr√£o √© Verdadeiro, mostrar√° **tracebacks python** (potencialmente √∫til para um atacante)
* **`secret_key`**: Esta √© a **chave usada pelo flask para assinar os cookies** (se voc√™ tiver isso, pode **impersonar qualquer usu√°rio no Airflow**)
* **`web_server_ssl_cert`**: **Caminho** para o **certificado** **SSL**
* **`web_server_ssl_key`**: **Caminho** para a **Chave** **SSL**
* **`x_frame_enabled`**: O padr√£o √© **Verdadeiro**, ent√£o por padr√£o o clickjacking n√£o √© poss√≠vel

### Autentica√ß√£o Web

Por padr√£o, a **autentica√ß√£o web** √© especificada no arquivo **`webserver_config.py`** e √© configurada como
```bash
AUTH_TYPE = AUTH_DB
```
O que significa que a **autentica√ß√£o √© verificada contra o banco de dados**. No entanto, outras configura√ß√µes s√£o poss√≠veis, como
```bash
AUTH_TYPE = AUTH_OAUTH
```
Para deixar a **autentica√ß√£o para servi√ßos de terceiros**.

No entanto, tamb√©m h√° uma op√ß√£o para **permitir acesso a usu√°rios an√¥nimos**, definindo o seguinte par√¢metro para o **papel desejado**:
```bash
AUTH_ROLE_PUBLIC = 'Admin'
```
{% hint style="success" %}
Aprenda e pratique Hacking AWS:<img src="../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">\
Aprenda e pratique Hacking GCP: <img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Suporte ao HackTricks</summary>

* Confira os [**planos de assinatura**](https://github.com/sponsors/carlospolop)!
* **Junte-se ao** üí¨ [**grupo do Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga**-nos no **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe truques de hacking enviando PRs para o** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) reposit√≥rios do github.

</details>
{% endhint %}
