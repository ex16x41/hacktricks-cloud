# Airflow Configuration

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Configuration File

**Apache Airflow** ã¯ã€ã‚¨ã‚¢ãƒ•ãƒ­ãƒ¼ ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ›ãƒ¼ãƒ ã« **`airflow.cfg`** ã¨ã„ã† **config file** ã‚’ç”Ÿæˆã—ã¾ã™ã€‚ã“ã® config file ã«ã¯è¨­å®šæƒ…å ±ãŒå«ã¾ã‚Œã¦ãŠã‚Šã€**èˆˆå‘³æ·±ãã€æ©Ÿå¯†æ€§ã®é«˜ã„æƒ…å ±ãŒå«ã¾ã‚Œã¦ã„ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚**

**ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹æ–¹æ³•ã¯2ã¤ã‚ã‚Šã¾ã™: ã‚¨ã‚¢ãƒ•ãƒ­ãƒ¼ ãƒã‚·ãƒ³ã‚’ä¾µå®³ã™ã‚‹ã‹ã€ã‚¦ã‚§ãƒ–ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã“ã¨ã§ã™ã€‚**

**config file å†…ã®å€¤** ã¯ **ä½¿ç”¨ã•ã‚Œã¦ã„ã‚‹ã‚‚ã®ã§ã¯ãªã„å¯èƒ½æ€§ãŒã‚ã‚‹ã“ã¨ã«æ³¨æ„ã—ã¦ãã ã•ã„ã€‚ç’°å¢ƒå¤‰æ•°ã‚’è¨­å®šã™ã‚‹ã“ã¨ã§ä¸Šæ›¸ãã§ãã¾ã™ã€‚ä¾‹: `AIRFLOW__WEBSERVER__EXPOSE_CONFIG: 'true'`ã€‚

**ã‚¦ã‚§ãƒ–ã‚µãƒ¼ãƒãƒ¼ã® config file ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹å ´åˆ**ã€åŒã˜ãƒšãƒ¼ã‚¸ã§è¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹ **å®Ÿéš›ã®å®Ÿè¡Œè¨­å®š** ã‚’ç¢ºèªã§ãã¾ã™ã€‚\
**ã‚¨ã‚¢ãƒ•ãƒ­ãƒ¼ç’°å¢ƒå†…ã®ãƒã‚·ãƒ³ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹å ´åˆ**ã€**ç’°å¢ƒ**ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚

config file ã‚’èª­ã‚€éš›ã«ç¢ºèªã™ã¹ãèˆˆå‘³æ·±ã„å€¤:

### \[api]

* **`access_control_allow_headers`**: ã“ã‚Œã¯ **CORS** ã®ãŸã‚ã® **è¨±å¯ã•ã‚ŒãŸ** **ãƒ˜ãƒƒãƒ€ãƒ¼** ã‚’ç¤ºã—ã¾ã™
* **`access_control_allow_methods`**: ã“ã‚Œã¯ **CORS** ã®ãŸã‚ã® **è¨±å¯ã•ã‚ŒãŸãƒ¡ã‚½ãƒƒãƒ‰** ã‚’ç¤ºã—ã¾ã™
* **`access_control_allow_origins`**: ã“ã‚Œã¯ **CORS** ã®ãŸã‚ã® **è¨±å¯ã•ã‚ŒãŸã‚ªãƒªã‚¸ãƒ³** ã‚’ç¤ºã—ã¾ã™
* **`auth_backend`**: [**ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«ã‚ˆã‚‹ã¨**](https://airflow.apache.org/docs/apache-airflow/stable/security/api.html) API ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’è¨­å®šã™ã‚‹ãŸã‚ã®ã„ãã¤ã‹ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ãŒã‚ã‚Šã¾ã™:
* `airflow.api.auth.backend.deny_all`: **ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯èª°ã‚‚** API ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã›ã‚“
* `airflow.api.auth.backend.default`: **èª°ã§ã‚‚** èªè¨¼ãªã—ã§ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã™
* `airflow.api.auth.backend.kerberos_auth`: **kerberos èªè¨¼** ã‚’è¨­å®šã™ã‚‹ãŸã‚
* `airflow.api.auth.backend.basic_auth`: **åŸºæœ¬èªè¨¼** ã®ãŸã‚
* `airflow.composer.api.backend.composer_auth`: ä½œæ›²å®¶ã®èªè¨¼ã‚’ä½¿ç”¨ã—ã¾ã™ (GCP) ([**ã“ã¡ã‚‰**](https://cloud.google.com/composer/docs/access-airflow-api)ã‹ã‚‰)ã€‚
* `composer_auth_user_registration_role`: ã“ã‚Œã¯ **airflow** å†…ã§ **composer user** ãŒå–å¾—ã™ã‚‹ **å½¹å‰²** ã‚’ç¤ºã—ã¾ã™ (**Op** ãŒãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ)ã€‚
* Python ã§ **ç‹¬è‡ªã®èªè¨¼** ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä½œæˆã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ã€‚
* **`google_key_path`:** GCP ã‚µãƒ¼ãƒ“ã‚¹ ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ ã‚­ãƒ¼ã¸ã®ãƒ‘ã‚¹

### **\[atlas]**

* **`password`**: Atlas ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰
* **`username`**: Atlas ãƒ¦ãƒ¼ã‚¶ãƒ¼å

### \[celery]

* **`flower_basic_auth`** : èªè¨¼æƒ…å ± (_user1:password1,user2:password2_)
* **`result_backend`**: **credentials** ã‚’å«ã‚€å¯èƒ½æ€§ã®ã‚ã‚‹ Postgres URLã€‚
* **`ssl_cacert`**: cacert ã¸ã®ãƒ‘ã‚¹
* **`ssl_cert`**: è¨¼æ˜æ›¸ã¸ã®ãƒ‘ã‚¹
* **`ssl_key`**: ã‚­ãƒ¼ã¸ã®ãƒ‘ã‚¹

### \[core]

* **`dag_discovery_safe_mode`**: ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§æœ‰åŠ¹ã€‚DAG ã‚’ç™ºè¦‹ã™ã‚‹éš›ã€`DAG` ã¨ `airflow` ã®æ–‡å­—åˆ—ã‚’å«ã¾ãªã„ãƒ•ã‚¡ã‚¤ãƒ«ã¯ç„¡è¦–ã•ã‚Œã¾ã™ã€‚
* **`fernet_key`**: æš—å·åŒ–ã•ã‚ŒãŸå¤‰æ•°ã‚’ä¿å­˜ã™ã‚‹ãŸã‚ã®ã‚­ãƒ¼ (å¯¾ç§°)
* **`hide_sensitive_var_conn_fields`**: ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§æœ‰åŠ¹ã€æ¥ç¶šã®æ©Ÿå¯†æƒ…å ±ã‚’éš ã—ã¾ã™ã€‚
* **`security`**: ä½¿ç”¨ã™ã‚‹ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ« (ä¾‹: kerberos)

### \[dask]

* **`tls_ca`**: ca ã¸ã®ãƒ‘ã‚¹
* **`tls_cert`**: è¨¼æ˜æ›¸ã¸ã®ãƒ‘ã‚¹
* **`tls_key`**: tls ã‚­ãƒ¼ã¸ã®ãƒ‘ã‚¹

### \[kerberos]

* **`ccache`**: ccache ãƒ•ã‚¡ã‚¤ãƒ«ã¸ã®ãƒ‘ã‚¹
* **`forwardable`**: ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§æœ‰åŠ¹

### \[logging]

* **`google_key_path`**: GCP JSON èªè¨¼æƒ…å ±ã¸ã®ãƒ‘ã‚¹ã€‚

### \[secrets]

* **`backend`**: æœ‰åŠ¹ã«ã™ã‚‹ãŸã‚ã®ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®å®Œå…¨ã‚¯ãƒ©ã‚¹å
* **`backend_kwargs`**: backend\_kwargs ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¯è¾æ›¸ã«èª­ã¿è¾¼ã¾ã‚Œã€ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚¯ãƒ©ã‚¹ã® **init** ã«æ¸¡ã•ã‚Œã¾ã™ã€‚

### \[smtp]

* **`smtp_password`**: SMTP ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰
* **`smtp_user`**: SMTP ãƒ¦ãƒ¼ã‚¶ãƒ¼

### \[webserver]

* **`cookie_samesite`**: ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯ **Lax** ã§ã€ã™ã§ã«æœ€ã‚‚å¼±ã„å€¤ã§ã™
* **`cookie_secure`**: ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚¯ãƒƒã‚­ãƒ¼ã« **secure flag** ã‚’è¨­å®šã—ã¾ã™
* **`expose_config`**: ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯ False ã§ã€true ã®å ´åˆã€**config** ã¯ã‚¦ã‚§ãƒ– **console** ã‹ã‚‰ **èª­ã¿å–ã‚‹** ã“ã¨ãŒã§ãã¾ã™
* **`expose_stacktrace`**: ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯ True ã§ã€**python tracebacks** ã‚’è¡¨ç¤ºã—ã¾ã™ (æ”»æ’ƒè€…ã«ã¨ã£ã¦æ½œåœ¨çš„ã«æœ‰ç”¨)
* **`secret_key`**: ã“ã‚Œã¯ **flask ãŒã‚¯ãƒƒã‚­ãƒ¼ã«ç½²åã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã™ã‚‹ã‚­ãƒ¼** ã§ã™ (ã“ã‚Œã‚’æŒã£ã¦ã„ã‚‹ã¨ **Airflow ã®ä»»æ„ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ãªã‚Šã™ã¾ã™ã“ã¨ãŒã§ãã¾ã™**)
* **`web_server_ssl_cert`**: **SSL** **cert** ã¸ã® **ãƒ‘ã‚¹**
* **`web_server_ssl_key`**: **SSL** **Key** ã¸ã® **ãƒ‘ã‚¹**
* **`x_frame_enabled`**: ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯ **True** ã§ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯ã‚¯ãƒªãƒƒã‚¯ã‚¸ãƒ£ãƒƒã‚­ãƒ³ã‚°ã¯ä¸å¯èƒ½ã§ã™

### Web Authentication

ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯ **web authentication** ã¯ **`webserver_config.py`** ãƒ•ã‚¡ã‚¤ãƒ«ã«æŒ‡å®šã•ã‚Œã€æ¬¡ã®ã‚ˆã†ã«æ§‹æˆã•ã‚Œã¦ã„ã¾ã™
```bash
AUTH_TYPE = AUTH_DB
```
ã¤ã¾ã‚Šã€**èªè¨¼ã¯ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«å¯¾ã—ã¦ãƒã‚§ãƒƒã‚¯ã•ã‚Œã¾ã™**ã€‚ãŸã ã—ã€ä»–ã®è¨­å®šã‚‚å¯èƒ½ã§ã™ã€‚
```bash
AUTH_TYPE = AUTH_OAUTH
```
**ç¬¬ä¸‰è€…ã‚µãƒ¼ãƒ“ã‚¹ã«èªè¨¼ã‚’å§”ã­ã‚‹**ãŸã‚ã«ã€‚

ãŸã ã—ã€**åŒ¿åãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’è¨±å¯ã™ã‚‹**ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚‚ã‚ã‚Šã€æ¬¡ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’**å¸Œæœ›ã™ã‚‹ãƒ­ãƒ¼ãƒ«**ã«è¨­å®šã—ã¾ã™ï¼š
```bash
AUTH_ROLE_PUBLIC = 'Admin'
```
{% hint style="success" %}
AWSãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã³ã€å®Ÿè·µã™ã‚‹ï¼š<img src="../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/image (1).png" alt="" data-size="line">\
GCPãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã³ã€å®Ÿè·µã™ã‚‹ï¼š<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricksã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹</summary>

* [**ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³**](https://github.com/sponsors/carlospolop)ã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼
* **ğŸ’¬ [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã¾ãŸã¯[**Telegramã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«å‚åŠ ã™ã‚‹ã‹ã€**Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**ã‚’ãƒ•ã‚©ãƒ­ãƒ¼ã—ã¦ãã ã•ã„ã€‚**
* **ãƒãƒƒã‚­ãƒ³ã‚°ã®ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã™ã‚‹ã«ã¯ã€[**HackTricks**](https://github.com/carlospolop/hacktricks)ãŠã‚ˆã³[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)ã®GitHubãƒªãƒã‚¸ãƒˆãƒªã«PRã‚’æå‡ºã—ã¦ãã ã•ã„ã€‚**

</details>
{% endhint %}
