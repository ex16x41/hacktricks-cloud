# Airflow Configuration

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Configuration File

**Apache Airflow** åœ¨æ‰€æœ‰ airflow æœºå™¨ä¸Šç”Ÿæˆä¸€ä¸ªåä¸º **`airflow.cfg`** çš„ **é…ç½®æ–‡ä»¶**ï¼Œè¯¥æ–‡ä»¶ä½äº airflow ç”¨æˆ·çš„ä¸»ç›®å½•ä¸­ã€‚æ­¤é…ç½®æ–‡ä»¶åŒ…å«é…ç½®ä¿¡æ¯ï¼Œå¹¶ä¸” **å¯èƒ½åŒ…å«æœ‰è¶£å’Œæ•æ„Ÿçš„ä¿¡æ¯ã€‚**

**è®¿é—®æ­¤æ–‡ä»¶æœ‰ä¸¤ç§æ–¹å¼ï¼šé€šè¿‡æ”»é™·æŸä¸ª airflow æœºå™¨ï¼Œæˆ–è®¿é—®ç½‘é¡µæ§åˆ¶å°ã€‚**

è¯·æ³¨æ„ï¼Œ**é…ç½®æ–‡ä»¶ä¸­çš„å€¼** **å¯èƒ½ä¸æ˜¯å®é™…ä½¿ç”¨çš„å€¼**ï¼Œå› ä¸ºæ‚¨å¯ä»¥é€šè¿‡è®¾ç½®ç¯å¢ƒå˜é‡ï¼ˆå¦‚ `AIRFLOW__WEBSERVER__EXPOSE_CONFIG: 'true'`ï¼‰æ¥è¦†ç›–å®ƒä»¬ã€‚

å¦‚æœæ‚¨å¯ä»¥è®¿é—® **ç½‘é¡µæœåŠ¡å™¨ä¸­çš„é…ç½®æ–‡ä»¶**ï¼Œæ‚¨å¯ä»¥åœ¨åŒä¸€é¡µé¢ä¸Šæ£€æŸ¥ **å®é™…è¿è¡Œçš„é…ç½®**ã€‚\
å¦‚æœæ‚¨æœ‰ **è®¿é—® airflow ç¯å¢ƒä¸­æŸå°æœºå™¨çš„æƒé™**ï¼Œè¯·æ£€æŸ¥ **ç¯å¢ƒ**ã€‚

åœ¨é˜…è¯»é…ç½®æ–‡ä»¶æ—¶ï¼Œä¸€äº›æœ‰è¶£çš„å€¼ï¼š

### \[api]

* **`access_control_allow_headers`**: è¿™è¡¨ç¤º **CORS** çš„ **å…è®¸** **å¤´éƒ¨**
* **`access_control_allow_methods`**: è¿™è¡¨ç¤º **CORS** çš„ **å…è®¸æ–¹æ³•**
* **`access_control_allow_origins`**: è¿™è¡¨ç¤º **CORS** çš„ **å…è®¸æ¥æº**
* **`auth_backend`**: [**æ ¹æ®æ–‡æ¡£**](https://airflow.apache.org/docs/apache-airflow/stable/security/api.html)ï¼Œå¯ä»¥é…ç½®ä¸€äº›é€‰é¡¹æ¥å†³å®šè°å¯ä»¥è®¿é—® APIï¼š
* `airflow.api.auth.backend.deny_all`: **é»˜è®¤æƒ…å†µä¸‹ï¼Œæ²¡äºº** å¯ä»¥è®¿é—® API
* `airflow.api.auth.backend.default`: **æ¯ä¸ªäººéƒ½å¯ä»¥** æ— éœ€èº«ä»½éªŒè¯è®¿é—®
* `airflow.api.auth.backend.kerberos_auth`: é…ç½® **kerberos èº«ä»½éªŒè¯**
* `airflow.api.auth.backend.basic_auth`: ç”¨äº **åŸºæœ¬èº«ä»½éªŒè¯**
* `airflow.composer.api.backend.composer_auth`: ä½¿ç”¨ composers èº«ä»½éªŒè¯ (GCP) (æ¥è‡ª [**è¿™é‡Œ**](https://cloud.google.com/composer/docs/access-airflow-api))ã€‚
* `composer_auth_user_registration_role`: è¿™è¡¨ç¤º **composer ç”¨æˆ·** åœ¨ **airflow** ä¸­å°†è·å¾—çš„ **è§’è‰²**ï¼ˆé»˜è®¤æ˜¯ **Op**ï¼‰ã€‚
* æ‚¨è¿˜å¯ä»¥ä½¿ç”¨ Python **åˆ›å»ºè‡ªå·±çš„èº«ä»½éªŒè¯** æ–¹æ³•ã€‚
* **`google_key_path`:** GCP æœåŠ¡è´¦æˆ·å¯†é’¥çš„è·¯å¾„

### **\[atlas]**

* **`password`**: Atlas å¯†ç 
* **`username`**: Atlas ç”¨æˆ·å

### \[celery]

* **`flower_basic_auth`** : å‡­æ® (_user1:password1,user2:password2_)
* **`result_backend`**: å¯èƒ½åŒ…å« **å‡­æ®** çš„ Postgres URLã€‚
* **`ssl_cacert`**: cacert çš„è·¯å¾„
* **`ssl_cert`**: è¯ä¹¦çš„è·¯å¾„
* **`ssl_key`**: å¯†é’¥çš„è·¯å¾„

### \[core]

* **`dag_discovery_safe_mode`**: é»˜è®¤å¯ç”¨ã€‚åœ¨å‘ç° DAG æ—¶ï¼Œå¿½ç•¥ä»»ä½•ä¸åŒ…å«å­—ç¬¦ä¸² `DAG` å’Œ `airflow` çš„æ–‡ä»¶ã€‚
* **`fernet_key`**: ç”¨äºå­˜å‚¨åŠ å¯†å˜é‡çš„å¯†é’¥ï¼ˆå¯¹ç§°ï¼‰
* **`hide_sensitive_var_conn_fields`**: é»˜è®¤å¯ç”¨ï¼Œéšè—è¿æ¥çš„æ•æ„Ÿä¿¡æ¯ã€‚
* **`security`**: ä½¿ç”¨å“ªä¸ªå®‰å…¨æ¨¡å—ï¼ˆä¾‹å¦‚ kerberosï¼‰

### \[dask]

* **`tls_ca`**: ca çš„è·¯å¾„
* **`tls_cert`**: è¯ä¹¦çš„è·¯å¾„
* **`tls_key`**: tls å¯†é’¥çš„è·¯å¾„

### \[kerberos]

* **`ccache`**: ccache æ–‡ä»¶çš„è·¯å¾„
* **`forwardable`**: é»˜è®¤å¯ç”¨

### \[logging]

* **`google_key_path`**: GCP JSON å‡­æ®çš„è·¯å¾„ã€‚

### \[secrets]

* **`backend`**: è¦å¯ç”¨çš„ç§˜å¯†åç«¯çš„å®Œæ•´ç±»å
* **`backend_kwargs`**: backend\_kwargs å‚æ•°è¢«åŠ è½½åˆ°å­—å…¸ä¸­å¹¶ä¼ é€’ç»™ç§˜å¯†åç«¯ç±»çš„ **init**ã€‚

### \[smtp]

* **`smtp_password`**: SMTP å¯†ç 
* **`smtp_user`**: SMTP ç”¨æˆ·

### \[webserver]

* **`cookie_samesite`**: é»˜è®¤æ˜¯ **Lax**ï¼Œå› æ­¤å®ƒå·²ç»æ˜¯å¯èƒ½çš„æœ€å¼±å€¼
* **`cookie_secure`**: åœ¨ä¼šè¯ cookie ä¸Šè®¾ç½® **å®‰å…¨æ ‡å¿—**
* **`expose_config`**: é»˜è®¤æ˜¯ Falseï¼Œå¦‚æœä¸º trueï¼Œ**é…ç½®** å¯ä»¥ä»ç½‘é¡µ **æ§åˆ¶å°** **è¯»å–**
* **`expose_stacktrace`**: é»˜è®¤æ˜¯ Trueï¼Œå®ƒå°†æ˜¾ç¤º **python å›æº¯**ï¼ˆå¯¹æ”»å‡»è€…å¯èƒ½æœ‰ç”¨ï¼‰
* **`secret_key`**: è¿™æ˜¯ **flask ç”¨äºç­¾å cookie çš„å¯†é’¥**ï¼ˆå¦‚æœæ‚¨æ‹¥æœ‰æ­¤å¯†é’¥ï¼Œæ‚¨å¯ä»¥ **å†’å…… Airflow ä¸­çš„ä»»ä½•ç”¨æˆ·**ï¼‰
* **`web_server_ssl_cert`**: **SSL** **è¯ä¹¦** çš„ **è·¯å¾„**
* **`web_server_ssl_key`**: **SSL** **å¯†é’¥** çš„ **è·¯å¾„**
* **`x_frame_enabled`**: é»˜è®¤æ˜¯ **True**ï¼Œå› æ­¤é»˜è®¤æƒ…å†µä¸‹ä¸å¯èƒ½è¿›è¡Œç‚¹å‡»åŠ«æŒ

### Web Authentication

é»˜è®¤æƒ…å†µä¸‹ï¼Œ**web èº«ä»½éªŒè¯** åœ¨æ–‡ä»¶ **`webserver_config.py`** ä¸­æŒ‡å®šå¹¶é…ç½®ä¸º
```bash
AUTH_TYPE = AUTH_DB
```
è¿™æ„å‘³ç€**èº«ä»½éªŒè¯æ˜¯é’ˆå¯¹æ•°æ®åº“è¿›è¡Œæ£€æŸ¥çš„**ã€‚ç„¶è€Œï¼Œè¿˜æœ‰å…¶ä»–é…ç½®æ˜¯å¯èƒ½çš„ï¼Œä¾‹å¦‚
```bash
AUTH_TYPE = AUTH_OAUTH
```
å°†**èº«ä»½éªŒè¯å§”æ‰˜ç»™ç¬¬ä¸‰æ–¹æœåŠ¡**ã€‚

ç„¶è€Œï¼Œè¿˜æœ‰ä¸€ä¸ªé€‰é¡¹å¯ä»¥**å…è®¸åŒ¿åç”¨æˆ·è®¿é—®**ï¼Œå°†ä»¥ä¸‹å‚æ•°è®¾ç½®ä¸º**æ‰€éœ€è§’è‰²**ï¼š
```bash
AUTH_ROLE_PUBLIC = 'Admin'
```
{% hint style="success" %}
å­¦ä¹ ä¸å®è·µ AWS é»‘å®¢æŠ€æœ¯ï¼š<img src="../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">[**HackTricks åŸ¹è®­ AWS çº¢é˜Ÿä¸“å®¶ (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">\
å­¦ä¹ ä¸å®è·µ GCP é»‘å®¢æŠ€æœ¯ï¼š<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks åŸ¹è®­ GCP çº¢é˜Ÿä¸“å®¶ (GRTE)**<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>æ”¯æŒ HackTricks</summary>

* æŸ¥çœ‹ [**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**Telegram ç¾¤ç»„**](https://t.me/peass) æˆ– **å…³æ³¨** æˆ‘ä»¬çš„ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub ä»“åº“æäº¤ PR æ¥åˆ†äº«é»‘å®¢æŠ€å·§ã€‚

</details>
{% endhint %}
