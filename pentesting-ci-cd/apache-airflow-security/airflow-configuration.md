# Configuration Airflow

{% hint style="success" %}
Apprenez et pratiquez le hacking AWS :<img src="../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks Formation AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
Apprenez et pratiquez le hacking GCP : <img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Formation GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Soutenir HackTricks</summary>

* V√©rifiez les [**plans d'abonnement**](https://github.com/sponsors/carlospolop) !
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez-nous sur** **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Partagez des astuces de hacking en soumettant des PR au** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) d√©p√¥ts github.

</details>
{% endhint %}

## Fichier de Configuration

**Apache Airflow** g√©n√®re un **fichier de configuration** sur toutes les machines airflow appel√© **`airflow.cfg`** dans le r√©pertoire personnel de l'utilisateur airflow. Ce fichier de configuration contient des informations de configuration et **peut contenir des informations int√©ressantes et sensibles.**

**Il existe deux fa√ßons d'acc√©der √† ce fichier : en compromettant une machine airflow ou en acc√©dant √† la console web.**

Notez que les **valeurs √† l'int√©rieur du fichier de configuration** **peuvent ne pas √™tre celles utilis√©es**, car vous pouvez les √©craser en d√©finissant des variables d'environnement telles que `AIRFLOW__WEBSERVER__EXPOSE_CONFIG: 'true'`.

Si vous avez acc√®s au **fichier de configuration sur le serveur web**, vous pouvez v√©rifier la **vraie configuration en cours d'ex√©cution** sur la m√™me page o√π la configuration est affich√©e.\
Si vous avez **acc√®s √† une machine √† l'int√©rieur de l'environnement airflow**, v√©rifiez l'**environnement**.

Voici quelques valeurs int√©ressantes √† v√©rifier lors de la lecture du fichier de configuration :

### \[api]

* **`access_control_allow_headers`** : Cela indique les **en-t√™tes** **autoris√©s** pour **CORS**
* **`access_control_allow_methods`** : Cela indique les **m√©thodes autoris√©es** pour **CORS**
* **`access_control_allow_origins`** : Cela indique les **origines autoris√©es** pour **CORS**
* **`auth_backend`** : [**Selon la documentation**](https://airflow.apache.org/docs/apache-airflow/stable/security/api.html), plusieurs options peuvent √™tre mises en place pour configurer qui peut acc√©der √† l'API :
* `airflow.api.auth.backend.deny_all` : **Par d√©faut, personne** ne peut acc√©der √† l'API
* `airflow.api.auth.backend.default` : **Tout le monde peut** y acc√©der sans authentification
* `airflow.api.auth.backend.kerberos_auth` : Pour configurer **l'authentification kerberos**
* `airflow.api.auth.backend.basic_auth` : Pour **l'authentification de base**
* `airflow.composer.api.backend.composer_auth` : Utilise l'authentification des compositeurs (GCP) (depuis [**ici**](https://cloud.google.com/composer/docs/access-airflow-api)).
* `composer_auth_user_registration_role` : Cela indique le **r√¥le** que l'**utilisateur compositeur** obtiendra √† l'int√©rieur d'**airflow** (**Op** par d√©faut).
* Vous pouvez √©galement **cr√©er votre propre m√©thode d'authentification** avec python.
* **`google_key_path` :** Chemin vers la **cl√© de compte de service GCP**

### **\[atlas]**

* **`password`** : Mot de passe Atlas
* **`username`** : Nom d'utilisateur Atlas

### \[celery]

* **`flower_basic_auth`** : Identifiants (_user1:password1,user2:password2_)
* **`result_backend`** : URL Postgres qui peut contenir des **identifiants**.
* **`ssl_cacert`** : Chemin vers le cacert
* **`ssl_cert`** : Chemin vers le cert
* **`ssl_key`** : Chemin vers la cl√©

### \[core]

* **`dag_discovery_safe_mode`** : Activ√© par d√©faut. Lors de la d√©couverte des DAGs, ignorez tous les fichiers qui ne contiennent pas les cha√Ænes `DAG` et `airflow`.
* **`fernet_key`** : Cl√© pour stocker des variables chiffr√©es (sym√©trique)
* **`hide_sensitive_var_conn_fields`** : Activ√© par d√©faut, masque les informations sensibles des connexions.
* **`security`** : Quel module de s√©curit√© utiliser (par exemple kerberos)

### \[dask]

* **`tls_ca`** : Chemin vers ca
* **`tls_cert`** : Chemin vers le cert
* **`tls_key`** : Chemin vers la cl√© tls

### \[kerberos]

* **`ccache`** : Chemin vers le fichier ccache
* **`forwardable`** : Activ√© par d√©faut

### \[logging]

* **`google_key_path`** : Chemin vers les identifiants JSON GCP.

### \[secrets]

* **`backend`** : Nom complet de la classe du backend des secrets √† activer
* **`backend_kwargs`** : Le param√®tre backend\_kwargs est charg√© dans un dictionnaire et pass√© √† **init** de la classe du backend des secrets.

### \[smtp]

* **`smtp_password`** : Mot de passe SMTP
* **`smtp_user`** : Utilisateur SMTP

### \[webserver]

* **`cookie_samesite`** : Par d√©faut, c'est **Lax**, donc c'est d√©j√† la valeur la plus faible possible
* **`cookie_secure`** : D√©finir le **drapeau s√©curis√©** sur le cookie de session
* **`expose_config`** : Par d√©faut, c'est Faux, si vrai, la **configuration** peut √™tre **lue** depuis la **console** web
* **`expose_stacktrace`** : Par d√©faut, c'est Vrai, cela affichera les **tracebacks python** (potentiellement utiles pour un attaquant)
* **`secret_key`** : C'est la **cl√© utilis√©e par flask pour signer les cookies** (si vous avez cela, vous pouvez **usurper l'identit√© de n'importe quel utilisateur dans Airflow**)
* **`web_server_ssl_cert`** : **Chemin** vers le **certificat** **SSL**
* **`web_server_ssl_key`** : **Chemin** vers la **cl√©** **SSL**
* **`x_frame_enabled`** : Par d√©faut, c'est **Vrai**, donc par d√©faut le clickjacking n'est pas possible

### Authentification Web

Par d√©faut, **l'authentification web** est sp√©cifi√©e dans le fichier **`webserver_config.py`** et est configur√©e comme
```bash
AUTH_TYPE = AUTH_DB
```
Ce qui signifie que **l'authentification est v√©rifi√©e par rapport √† la base de donn√©es**. Cependant, d'autres configurations sont possibles comme
```bash
AUTH_TYPE = AUTH_OAUTH
```
Pour laisser l'**authentification aux services tiers**.

Cependant, il existe √©galement une option pour **permettre l'acc√®s aux utilisateurs anonymes**, en d√©finissant le param√®tre suivant au **r√¥le souhait√©** :
```bash
AUTH_ROLE_PUBLIC = 'Admin'
```
{% hint style="success" %}
Apprenez et pratiquez le hacking AWS :<img src="../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks Formation Expert Red Team AWS (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
Apprenez et pratiquez le hacking GCP : <img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Formation Expert Red Team GCP (GRTE)**<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Soutenir HackTricks</summary>

* Consultez les [**plans d'abonnement**](https://github.com/sponsors/carlospolop)!
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez** nous sur **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Partagez des astuces de hacking en soumettant des PRs aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) d√©p√¥ts github.

</details>
{% endhint %}
