# Airflow Configuration

{% hint style="success" %}
å­¦ä¹ å’Œå®è·µ AWS é»‘å®¢æŠ€æœ¯ï¼š<img src="../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks åŸ¹è®­ AWS çº¢é˜Ÿä¸“å®¶ (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/image (1).png" alt="" data-size="line">\
å­¦ä¹ å’Œå®è·µ GCP é»‘å®¢æŠ€æœ¯ï¼š<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks åŸ¹è®­ GCP çº¢é˜Ÿä¸“å®¶ (GRTE)**<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>æ”¯æŒ HackTricks</summary>

* æŸ¥çœ‹ [**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**Telegram ç¾¤ç»„**](https://t.me/peass) æˆ– **åœ¨ Twitter ä¸Šå…³æ³¨** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub ä»“åº“æäº¤ PR åˆ†äº«é»‘å®¢æŠ€å·§ã€‚

</details>
{% endhint %}

## Configuration File

**Apache Airflow** åœ¨æ‰€æœ‰ Airflow æœºå™¨ä¸Šç”Ÿæˆä¸€ä¸ª **config file**ï¼Œç§°ä¸º **`airflow.cfg`**ï¼Œä½äº Airflow ç”¨æˆ·çš„ä¸»ç›®å½•ä¸­ã€‚æ­¤é…ç½®æ–‡ä»¶åŒ…å«é…ç½®ä¿¡æ¯ï¼Œå¹¶ä¸” **å¯èƒ½åŒ…å«æœ‰è¶£å’Œæ•æ„Ÿçš„ä¿¡æ¯ã€‚**

**è®¿é—®æ­¤æ–‡ä»¶æœ‰ä¸¤ç§æ–¹å¼ï¼šé€šè¿‡æ”»é™·æŸä¸ª Airflow æœºå™¨ï¼Œæˆ–è®¿é—® Web æ§åˆ¶å°ã€‚**

è¯·æ³¨æ„ï¼Œ**é…ç½®æ–‡ä»¶ä¸­çš„å€¼** **å¯èƒ½ä¸æ˜¯å®é™…ä½¿ç”¨çš„å€¼**ï¼Œå› ä¸ºæ‚¨å¯ä»¥é€šè¿‡è®¾ç½®ç¯å¢ƒå˜é‡ï¼ˆå¦‚ `AIRFLOW__WEBSERVER__EXPOSE_CONFIG: 'true'`ï¼‰æ¥è¦†ç›–å®ƒä»¬ã€‚

å¦‚æœæ‚¨å¯ä»¥è®¿é—® **Web æœåŠ¡å™¨ä¸­çš„é…ç½®æ–‡ä»¶**ï¼Œå¯ä»¥åœ¨åŒä¸€é¡µé¢ä¸Šæ£€æŸ¥ **å®é™…è¿è¡Œçš„é…ç½®**ã€‚\
å¦‚æœæ‚¨å¯ä»¥è®¿é—® **Airflow ç¯å¢ƒä¸­çš„æŸå°æœºå™¨**ï¼Œè¯·æ£€æŸ¥ **ç¯å¢ƒ**ã€‚

è¯»å–é…ç½®æ–‡ä»¶æ—¶è¦æ£€æŸ¥çš„ä¸€äº›æœ‰è¶£å€¼ï¼š

### \[api]

* **`access_control_allow_headers`**ï¼šè¿™è¡¨ç¤º **CORS** çš„ **å…è®¸** **å¤´éƒ¨**
* **`access_control_allow_methods`**ï¼šè¿™è¡¨ç¤º **CORS** çš„ **å…è®¸æ–¹æ³•**
* **`access_control_allow_origins`**ï¼šè¿™è¡¨ç¤º **CORS** çš„ **å…è®¸æ¥æº**
* **`auth_backend`**ï¼š[**æ ¹æ®æ–‡æ¡£**](https://airflow.apache.org/docs/apache-airflow/stable/security/api.html)ï¼Œå¯ä»¥é…ç½®ä¸€äº›é€‰é¡¹æ¥å†³å®šè°å¯ä»¥è®¿é—® APIï¼š
* `airflow.api.auth.backend.deny_all`ï¼š**é»˜è®¤æƒ…å†µä¸‹ï¼Œæ²¡äºº**å¯ä»¥è®¿é—® API
* `airflow.api.auth.backend.default`ï¼š**æ¯ä¸ªäººéƒ½å¯ä»¥**åœ¨æ²¡æœ‰èº«ä»½éªŒè¯çš„æƒ…å†µä¸‹è®¿é—®
* `airflow.api.auth.backend.kerberos_auth`ï¼šé…ç½® **kerberos èº«ä»½éªŒè¯**
* `airflow.api.auth.backend.basic_auth`ï¼šç”¨äº **åŸºæœ¬èº«ä»½éªŒè¯**
* `airflow.composer.api.backend.composer_auth`ï¼šä½¿ç”¨ Composer èº«ä»½éªŒè¯ï¼ˆGCPï¼‰ï¼ˆæ¥è‡ª [**è¿™é‡Œ**](https://cloud.google.com/composer/docs/access-airflow-api)ï¼‰ã€‚
* `composer_auth_user_registration_role`ï¼šè¿™è¡¨ç¤º **Composer ç”¨æˆ·** åœ¨ **Airflow** ä¸­å°†è·å¾—çš„ **è§’è‰²**ï¼ˆé»˜è®¤æ˜¯ **Op**ï¼‰ã€‚
* æ‚¨è¿˜å¯ä»¥ä½¿ç”¨ Python **åˆ›å»ºè‡ªå·±çš„èº«ä»½éªŒè¯** æ–¹æ³•ã€‚
* **`google_key_path`**ï¼šæŒ‡å‘ **GCP æœåŠ¡è´¦æˆ·å¯†é’¥** çš„è·¯å¾„

### **\[atlas]**

* **`password`**ï¼šAtlas å¯†ç 
* **`username`**ï¼šAtlas ç”¨æˆ·å

### \[celery]

* **`flower_basic_auth`**ï¼šå‡­æ®ï¼ˆ_user1:password1,user2:password2_ï¼‰
* **`result_backend`**ï¼šå¯èƒ½åŒ…å« **å‡­æ®** çš„ Postgres URLã€‚
* **`ssl_cacert`**ï¼šcacert çš„è·¯å¾„
* **`ssl_cert`**ï¼šè¯ä¹¦çš„è·¯å¾„
* **`ssl_key`**ï¼šå¯†é’¥çš„è·¯å¾„

### \[core]

* **`dag_discovery_safe_mode`**ï¼šé»˜è®¤å¯ç”¨ã€‚åœ¨å‘ç° DAG æ—¶ï¼Œå¿½ç•¥ä»»ä½•ä¸åŒ…å«å­—ç¬¦ä¸² `DAG` å’Œ `airflow` çš„æ–‡ä»¶ã€‚
* **`fernet_key`**ï¼šç”¨äºå­˜å‚¨åŠ å¯†å˜é‡çš„å¯†é’¥ï¼ˆå¯¹ç§°ï¼‰
* **`hide_sensitive_var_conn_fields`**ï¼šé»˜è®¤å¯ç”¨ï¼Œéšè—è¿æ¥çš„æ•æ„Ÿä¿¡æ¯ã€‚
* **`security`**ï¼šä½¿ç”¨å“ªä¸ªå®‰å…¨æ¨¡å—ï¼ˆä¾‹å¦‚ kerberosï¼‰

### \[dask]

* **`tls_ca`**ï¼šca çš„è·¯å¾„
* **`tls_cert`**ï¼šè¯ä¹¦çš„è·¯å¾„
* **`tls_key`**ï¼štls å¯†é’¥çš„è·¯å¾„

### \[kerberos]

* **`ccache`**ï¼šccache æ–‡ä»¶çš„è·¯å¾„
* **`forwardable`**ï¼šé»˜è®¤å¯ç”¨

### \[logging]

* **`google_key_path`**ï¼šæŒ‡å‘ GCP JSON å‡­æ®çš„è·¯å¾„ã€‚

### \[secrets]

* **`backend`**ï¼šè¦å¯ç”¨çš„ç§˜å¯†åç«¯çš„å®Œæ•´ç±»å
* **`backend_kwargs`**ï¼šbackend\_kwargs å‚æ•°è¢«åŠ è½½åˆ°å­—å…¸ä¸­å¹¶ä¼ é€’ç»™ç§˜å¯†åç«¯ç±»çš„ **init**ã€‚

### \[smtp]

* **`smtp_password`**ï¼šSMTP å¯†ç 
* **`smtp_user`**ï¼šSMTP ç”¨æˆ·

### \[webserver]

* **`cookie_samesite`**ï¼šé»˜è®¤æ˜¯ **Lax**ï¼Œå› æ­¤å®ƒå·²ç»æ˜¯æœ€å¼±çš„å¯èƒ½å€¼
* **`cookie_secure`**ï¼šåœ¨ä¼šè¯ cookie ä¸Šè®¾ç½® **secure flag**
* **`expose_config`**ï¼šé»˜è®¤æ˜¯ Falseï¼Œå¦‚æœä¸º trueï¼Œ**é…ç½®**å¯ä»¥ä» Web **æ§åˆ¶å°** **è¯»å–**
* **`expose_stacktrace`**ï¼šé»˜è®¤æ˜¯ Trueï¼Œå®ƒå°†æ˜¾ç¤º **python tracebacks**ï¼ˆå¯¹æ”»å‡»è€…å¯èƒ½æœ‰ç”¨ï¼‰
* **`secret_key`**ï¼šè¿™æ˜¯ **flask ç”¨äºç­¾å cookie çš„å¯†é’¥**ï¼ˆå¦‚æœæ‚¨æ‹¥æœ‰æ­¤å¯†é’¥ï¼Œå¯ä»¥ **å†’å…… Airflow ä¸­çš„ä»»ä½•ç”¨æˆ·**ï¼‰
* **`web_server_ssl_cert`**ï¼šæŒ‡å‘ **SSL** **è¯ä¹¦** çš„ **è·¯å¾„**
* **`web_server_ssl_key`**ï¼šæŒ‡å‘ **SSL** **å¯†é’¥** çš„ **è·¯å¾„**
* **`x_frame_enabled`**ï¼šé»˜è®¤æ˜¯ **True**ï¼Œå› æ­¤é»˜è®¤æƒ…å†µä¸‹ä¸å¯èƒ½å‘ç”Ÿç‚¹å‡»åŠ«æŒ

### Web Authentication

é»˜è®¤æƒ…å†µä¸‹ï¼Œ**Web èº«ä»½éªŒè¯** åœ¨æ–‡ä»¶ **`webserver_config.py`** ä¸­æŒ‡å®šï¼Œå¹¶é…ç½®ä¸º
```bash
AUTH_TYPE = AUTH_DB
```
è¿™æ„å‘³ç€**èº«ä»½éªŒè¯æ˜¯é’ˆå¯¹æ•°æ®åº“è¿›è¡Œæ£€æŸ¥çš„**ã€‚ç„¶è€Œï¼Œè¿˜æœ‰å…¶ä»–é…ç½®æ˜¯å¯èƒ½çš„ï¼Œä¾‹å¦‚
```bash
AUTH_TYPE = AUTH_OAUTH
```
å°†**èº«ä»½éªŒè¯å§”æ‰˜ç»™ç¬¬ä¸‰æ–¹æœåŠ¡**ã€‚

ç„¶è€Œï¼Œè¿˜æœ‰ä¸€ä¸ªé€‰é¡¹å¯ä»¥**å…è®¸åŒ¿åç”¨æˆ·è®¿é—®**ï¼Œå°†ä»¥ä¸‹å‚æ•°è®¾ç½®ä¸º**æ‰€éœ€è§’è‰²**ï¼š
```bash
AUTH_ROLE_PUBLIC = 'Admin'
```
{% hint style="success" %}
å­¦ä¹ ä¸å®è·µ AWS é»‘å®¢æŠ€æœ¯ï¼š<img src="../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks åŸ¹è®­ AWS çº¢é˜Ÿä¸“å®¶ (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/image (1).png" alt="" data-size="line">\
å­¦ä¹ ä¸å®è·µ GCP é»‘å®¢æŠ€æœ¯ï¼š<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks åŸ¹è®­ GCP çº¢é˜Ÿä¸“å®¶ (GRTE)**<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>æ”¯æŒ HackTricks</summary>

* æŸ¥çœ‹ [**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**Telegram ç¾¤ç»„**](https://t.me/peass) æˆ– **å…³æ³¨** æˆ‘ä»¬çš„ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub ä»“åº“æäº¤ PR æ¥åˆ†äº«é»‘å®¢æŠ€å·§ã€‚

</details>
{% endhint %}
