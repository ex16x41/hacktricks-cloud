# Airflow-Konfiguration

{% hint style="success" %}
Lerne & √ºbe AWS Hacking:<img src="../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
Lerne & √ºbe GCP Hacking: <img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Unterst√ºtze HackTricks</summary>

* √úberpr√ºfe die [**Abonnementpl√§ne**](https://github.com/sponsors/carlospolop)!
* **Tritt der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folge** uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Teile Hacking-Tricks, indem du PRs zu den** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repos einreichst.

</details>
{% endhint %}

## Konfigurationsdatei

**Apache Airflow** generiert eine **Konfigurationsdatei** auf allen Airflow-Maschinen namens **`airflow.cfg`** im Home-Verzeichnis des Airflow-Benutzers. Diese Konfigurationsdatei enth√§lt Konfigurationsinformationen und **kann interessante und sensible Informationen enthalten.**

**Es gibt zwei M√∂glichkeiten, auf diese Datei zuzugreifen: Indem man eine Airflow-Maschine kompromittiert oder auf die Webkonsole zugreift.**

Beachte, dass die **Werte in der Konfigurationsdatei** **nicht die verwendeten sein m√ºssen**, da du sie √ºberschreiben kannst, indem du Umgebungsvariablen wie `AIRFLOW__WEBSERVER__EXPOSE_CONFIG: 'true'` setzt.

Wenn du Zugriff auf die **Konfigurationsdatei im Webserver** hast, kannst du die **tats√§chliche laufende Konfiguration** auf derselben Seite √ºberpr√ºfen, auf der die Konfiguration angezeigt wird.\
Wenn du **Zugriff auf eine Maschine innerhalb der Airflow-Umgebung** hast, √ºberpr√ºfe die **Umgebung**.

Einige interessante Werte, die du beim Lesen der Konfigurationsdatei √ºberpr√ºfen solltest:

### \[api]

* **`access_control_allow_headers`**: Dies gibt die **erlaubten** **Header** f√ºr **CORS** an.
* **`access_control_allow_methods`**: Dies gibt die **erlaubten Methoden** f√ºr **CORS** an.
* **`access_control_allow_origins`**: Dies gibt die **erlaubten Urspr√ºnge** f√ºr **CORS** an.
* **`auth_backend`**: [**Laut den Dokumenten**](https://airflow.apache.org/docs/apache-airflow/stable/security/api.html) k√∂nnen einige Optionen vorhanden sein, um zu konfigurieren, wer auf die API zugreifen kann:
* `airflow.api.auth.backend.deny_all`: **Standardm√§√üig kann niemand** auf die API zugreifen.
* `airflow.api.auth.backend.default`: **Jeder kann** ohne Authentifizierung darauf zugreifen.
* `airflow.api.auth.backend.kerberos_auth`: Um **Kerberos-Authentifizierung** zu konfigurieren.
* `airflow.api.auth.backend.basic_auth`: F√ºr **Basis-Authentifizierung**.
* `airflow.composer.api.backend.composer_auth`: Verwendet die Authentifizierung von Composern (GCP) (von [**hier**](https://cloud.google.com/composer/docs/access-airflow-api)).
* `composer_auth_user_registration_role`: Dies gibt die **Rolle** an, die der **Composer-Benutzer** innerhalb von **Airflow** erh√§lt (**Op** standardm√§√üig).
* Du kannst auch **deine eigene Authentifizierung**smethode mit Python erstellen.
* **`google_key_path`:** Pfad zum **GCP-Dienstkonto-Schl√ºssel**.

### **\[atlas]**

* **`password`**: Atlas-Passwort.
* **`username`**: Atlas-Benutzername.

### \[celery]

* **`flower_basic_auth`** : Anmeldeinformationen (_user1:password1,user2:password2_).
* **`result_backend`**: Postgres-URL, die **Anmeldeinformationen** enthalten kann.
* **`ssl_cacert`**: Pfad zum cacert.
* **`ssl_cert`**: Pfad zum Zertifikat.
* **`ssl_key`**: Pfad zum Schl√ºssel.

### \[core]

* **`dag_discovery_safe_mode`**: Standardm√§√üig aktiviert. Beim Entdecken von DAGs werden alle Dateien ignoriert, die nicht die Zeichenfolgen `DAG` und `airflow` enthalten.
* **`fernet_key`**: Schl√ºssel zum Speichern verschl√ºsselter Variablen (symmetrisch).
* **`hide_sensitive_var_conn_fields`**: Standardm√§√üig aktiviert, verbirgt sensible Informationen zu Verbindungen.
* **`security`**: Welches Sicherheitsmodul verwendet werden soll (zum Beispiel Kerberos).

### \[dask]

* **`tls_ca`**: Pfad zur CA.
* **`tls_cert`**: Pfad zum Zertifikat.
* **`tls_key`**: Pfad zum TLS-Schl√ºssel.

### \[kerberos]

* **`ccache`**: Pfad zur ccache-Datei.
* **`forwardable`**: Standardm√§√üig aktiviert.

### \[logging]

* **`google_key_path`**: Pfad zu GCP JSON-Anmeldeinformationen.

### \[secrets]

* **`backend`**: Vollst√§ndiger Klassenname des Secrets-Backends, das aktiviert werden soll.
* **`backend_kwargs`**: Der backend_kwargs-Parameter wird in ein W√∂rterbuch geladen und an **init** der Secrets-Backend-Klasse √ºbergeben.

### \[smtp]

* **`smtp_password`**: SMTP-Passwort.
* **`smtp_user`**: SMTP-Benutzer.

### \[webserver]

* **`cookie_samesite`**: Standardm√§√üig ist es **Lax**, also ist es bereits der schw√§chste m√∂gliche Wert.
* **`cookie_secure`**: Setze das **sichere Flag** f√ºr das Sitzungscookie.
* **`expose_config`**: Standardm√§√üig ist es falsch, wenn es wahr ist, kann die **Konfiguration** von der Web-**Konsole** **gelesen** werden.
* **`expose_stacktrace`**: Standardm√§√üig ist es wahr, es zeigt **Python-Tracebacks** an (potenziell n√ºtzlich f√ºr einen Angreifer).
* **`secret_key`**: Dies ist der **Schl√ºssel, der von Flask verwendet wird, um die Cookies zu signieren** (wenn du dies hast, kannst du **jeden Benutzer in Airflow impersonieren**).
* **`web_server_ssl_cert`**: **Pfad** zum **SSL**-**Zertifikat**.
* **`web_server_ssl_key`**: **Pfad** zum **SSL**-**Schl√ºssel**.
* **`x_frame_enabled`**: Standard ist **wahr**, sodass standardm√§√üig Clickjacking nicht m√∂glich ist.

### Web-Authentifizierung

Standardm√§√üig ist die **Web-Authentifizierung** in der Datei **`webserver_config.py`** angegeben und konfiguriert als
```bash
AUTH_TYPE = AUTH_DB
```
Was bedeutet, dass die **Authentifizierung gegen die Datenbank √ºberpr√ºft wird**. Andere Konfigurationen sind jedoch m√∂glich, wie
```bash
AUTH_TYPE = AUTH_OAUTH
```
Um die **Authentifizierung an Drittanbieterdienste** zu √ºbergeben.

Es gibt jedoch auch eine Option, um **anonymen Benutzern den Zugriff zu erlauben**, indem der folgende Parameter auf die **gew√ºnschte Rolle** gesetzt wird:
```bash
AUTH_ROLE_PUBLIC = 'Admin'
```
{% hint style="success" %}
Lernen & √ºben Sie AWS Hacking:<img src="../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
Lernen & √ºben Sie GCP Hacking: <img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Unterst√ºtzen Sie HackTricks</summary>

* √úberpr√ºfen Sie die [**Abonnementpl√§ne**](https://github.com/sponsors/carlospolop)!
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Teilen Sie Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repos senden.

</details>
{% endhint %}
