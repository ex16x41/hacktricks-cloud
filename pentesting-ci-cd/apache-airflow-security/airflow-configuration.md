# Konfiguracja Airflow

{% hint style="success" %}
Ucz siÄ™ i Ä‡wicz Hacking AWS:<img src="../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Ucz siÄ™ i Ä‡wicz Hacking GCP: <img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Wsparcie dla HackTricks</summary>

* SprawdÅº [**plany subskrypcyjne**](https://github.com/sponsors/carlospolop)!
* **DoÅ‚Ä…cz do** ğŸ’¬ [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegram**](https://t.me/peass) lub **Å›ledÅº** nas na **Twitterze** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podziel siÄ™ trikami hackingowymi, przesyÅ‚ajÄ…c PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repozytoriÃ³w github.

</details>
{% endhint %}

## Plik konfiguracyjny

**Apache Airflow** generuje **plik konfiguracyjny** na wszystkich maszynach airflow o nazwie **`airflow.cfg`** w katalogu domowym uÅ¼ytkownika airflow. Ten plik konfiguracyjny zawiera informacje konfiguracyjne i **moÅ¼e zawieraÄ‡ interesujÄ…ce i wraÅ¼liwe informacje.**

**SÄ… dwa sposoby na dostÄ™p do tego pliku: Poprzez skompromitowanie maszyny airflow lub dostÄ™p do konsoli internetowej.**

ZauwaÅ¼, Å¼e **wartoÅ›ci w pliku konfiguracyjnym** **mogÄ… nie byÄ‡ tymi uÅ¼ywanymi**, poniewaÅ¼ moÅ¼esz je nadpisaÄ‡, ustawiajÄ…c zmienne Å›rodowiskowe, takie jak `AIRFLOW__WEBSERVER__EXPOSE_CONFIG: 'true'`.

JeÅ›li masz dostÄ™p do **pliku konfiguracyjnego na serwerze webowym**, moÅ¼esz sprawdziÄ‡ **rzeczywistÄ… dziaÅ‚ajÄ…cÄ… konfiguracjÄ™** na tej samej stronie, na ktÃ³rej wyÅ›wietlany jest plik konfiguracyjny.\
JeÅ›li masz **dostÄ™p do jakiejÅ› maszyny w Å›rodowisku airflow**, sprawdÅº **Å›rodowisko**.

NiektÃ³re interesujÄ…ce wartoÅ›ci do sprawdzenia podczas przeglÄ…dania pliku konfiguracyjnego:

### \[api]

* **`access_control_allow_headers`**: To wskazuje na **dozwolone** **nagÅ‚Ã³wki** dla **CORS**
* **`access_control_allow_methods`**: To wskazuje na **dozwolone metody** dla **CORS**
* **`access_control_allow_origins`**: To wskazuje na **dozwolone ÅºrÃ³dÅ‚a** dla **CORS**
* **`auth_backend`**: [**Zgodnie z dokumentacjÄ…**](https://airflow.apache.org/docs/apache-airflow/stable/security/api.html) kilka opcji moÅ¼e byÄ‡ uÅ¼ytych do skonfigurowania, kto moÅ¼e uzyskaÄ‡ dostÄ™p do API:
* `airflow.api.auth.backend.deny_all`: **DomyÅ›lnie nikt** nie moÅ¼e uzyskaÄ‡ dostÄ™pu do API
* `airflow.api.auth.backend.default`: **KaÅ¼dy moÅ¼e** uzyskaÄ‡ do niego dostÄ™p bez uwierzytelnienia
* `airflow.api.auth.backend.kerberos_auth`: Aby skonfigurowaÄ‡ **uwierzytelnianie kerberos**
* `airflow.api.auth.backend.basic_auth`: Dla **podstawowego uwierzytelniania**
* `airflow.composer.api.backend.composer_auth`: UÅ¼ywa uwierzytelniania kompozytora (GCP) (z [**tutaj**](https://cloud.google.com/composer/docs/access-airflow-api)).
* `composer_auth_user_registration_role`: To wskazuje na **rolÄ™**, jakÄ… **uÅ¼ytkownik kompozytora** otrzyma w **airflow** (**Op** domyÅ›lnie).
* MoÅ¼esz rÃ³wnieÅ¼ **stworzyÄ‡ wÅ‚asnÄ… metodÄ™ uwierzytelniania** w pythonie.
* **`google_key_path`:** ÅšcieÅ¼ka do **klucza konta usÅ‚ugi GCP**

### **\[atlas]**

* **`password`**: HasÅ‚o Atlas
* **`username`**: Nazwa uÅ¼ytkownika Atlas

### \[celery]

* **`flower_basic_auth`** : PoÅ›wiadczenia (_user1:password1,user2:password2_)
* **`result_backend`**: URL Postgres, ktÃ³ry moÅ¼e zawieraÄ‡ **poÅ›wiadczenia**.
* **`ssl_cacert`**: ÅšcieÅ¼ka do cacert
* **`ssl_cert`**: ÅšcieÅ¼ka do certyfikatu
* **`ssl_key`**: ÅšcieÅ¼ka do klucza

### \[core]

* **`dag_discovery_safe_mode`**: WÅ‚Ä…czone domyÅ›lnie. Podczas odkrywania DAG-Ã³w, ignoruj wszelkie pliki, ktÃ³re nie zawierajÄ… ciÄ…gÃ³w `DAG` i `airflow`.
* **`fernet_key`**: Klucz do przechowywania zaszyfrowanych zmiennych (symetryczny)
* **`hide_sensitive_var_conn_fields`**: WÅ‚Ä…czone domyÅ›lnie, ukrywa wraÅ¼liwe informacje o poÅ‚Ä…czeniach.
* **`security`**: Jaki moduÅ‚ zabezpieczeÅ„ uÅ¼yÄ‡ (na przykÅ‚ad kerberos)

### \[dask]

* **`tls_ca`**: ÅšcieÅ¼ka do ca
* **`tls_cert`**: ÅšcieÅ¼ka do certyfikatu
* **`tls_key`**: ÅšcieÅ¼ka do klucza tls

### \[kerberos]

* **`ccache`**: ÅšcieÅ¼ka do pliku ccache
* **`forwardable`**: WÅ‚Ä…czone domyÅ›lnie

### \[logging]

* **`google_key_path`**: ÅšcieÅ¼ka do poÅ›wiadczeÅ„ JSON GCP.

### \[secrets]

* **`backend`**: PeÅ‚na nazwa klasy backendu sekretÃ³w do wÅ‚Ä…czenia
* **`backend_kwargs`**: Parametr backend\_kwargs jest Å‚adowany do sÅ‚ownika i przekazywany do **init** klasy backendu sekretÃ³w.

### \[smtp]

* **`smtp_password`**: HasÅ‚o SMTP
* **`smtp_user`**: UÅ¼ytkownik SMTP

### \[webserver]

* **`cookie_samesite`**: DomyÅ›lnie to **Lax**, wiÄ™c to juÅ¼ najsÅ‚absza moÅ¼liwa wartoÅ›Ä‡
* **`cookie_secure`**: Ustaw **flaga zabezpieczeÅ„** na ciasteczku sesyjnym
* **`expose_config`**: DomyÅ›lnie jest False, jeÅ›li prawda, **konfiguracja** moÅ¼e byÄ‡ **odczytana** z konsoli **internetowej**
* **`expose_stacktrace`**: DomyÅ›lnie jest True, wyÅ›wietli **Å›lad stosu Pythona** (potencjalnie przydatne dla atakujÄ…cego)
* **`secret_key`**: To jest **klucz uÅ¼ywany przez flask do podpisywania ciasteczek** (jeÅ›li to masz, moÅ¼esz **podszyÄ‡ siÄ™ pod dowolnego uÅ¼ytkownika w Airflow**)
* **`web_server_ssl_cert`**: **ÅšcieÅ¼ka** do **certyfikatu SSL**
* **`web_server_ssl_key`**: **ÅšcieÅ¼ka** do **klucza SSL**
* **`x_frame_enabled`**: DomyÅ›lnie jest **True**, wiÄ™c domyÅ›lnie clickjacking nie jest moÅ¼liwy

### Uwierzytelnianie w sieci

DomyÅ›lnie **uwierzytelnianie w sieci** jest okreÅ›lone w pliku **`webserver_config.py`** i jest skonfigurowane jako
```bash
AUTH_TYPE = AUTH_DB
```
Co oznacza, Å¼e **uwierzytelnianie jest sprawdzane w bazie danych**. Jednak moÅ¼liwe sÄ… inne konfiguracje, takie jak
```bash
AUTH_TYPE = AUTH_OAUTH
```
Aby pozostawiÄ‡ **uwierzytelnianie zewnÄ™trznym usÅ‚ugom**.

Jednak istnieje rÃ³wnieÅ¼ opcja **zezwolenia anonimowym uÅ¼ytkownikom na dostÄ™p**, ustawiajÄ…c nastÄ™pujÄ…cy parametr na **poÅ¼Ä…danÄ… rolÄ™**:
```bash
AUTH_ROLE_PUBLIC = 'Admin'
```
{% hint style="success" %}
Ucz siÄ™ i Ä‡wicz Hacking AWS:<img src="../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Ucz siÄ™ i Ä‡wicz Hacking GCP: <img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Wsparcie dla HackTricks</summary>

* SprawdÅº [**plany subskrypcyjne**](https://github.com/sponsors/carlospolop)!
* **DoÅ‚Ä…cz do** ğŸ’¬ [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegram**](https://t.me/peass) lub **Å›ledÅº** nas na **Twitterze** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Dziel siÄ™ trikami hackingowymi, przesyÅ‚ajÄ…c PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repozytoriÃ³w github.

</details>
{% endhint %}
