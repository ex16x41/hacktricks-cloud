# Usalama wa Cloudflare

{% hint style="success" %}
Jifunze na fanya mazoezi ya AWS Hacking:<img src="../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Jifunze na fanya mazoezi ya GCP Hacking: <img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Angalia [**mpango wa usajili**](https://github.com/sponsors/carlospolop)!
* **Jiunge na** üí¨ [**kikundi cha Discord**](https://discord.gg/hRep4RUj7f) au [**kikundi cha telegram**](https://t.me/peass) au **fuata** sisi kwenye **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Shiriki mbinu za udukuzi kwa kuwasilisha PRs kwa** [**HackTricks**](https://github.com/carlospolop/hacktricks) na [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

Katika akaunti ya Cloudflare kuna **mipangilio na huduma za jumla** ambazo zinaweza kuwekewa mipangilio. Katika ukurasa huu tutachambua **mipangilio inayohusiana na usalama ya kila sehemu:**

<figure><img src="../../.gitbook/assets/image (117).png" alt=""><figcaption></figcaption></figure>

## Tovuti

Kagua kila moja kwa:

{% content-ref url="cloudflare-domains.md" %}
[cloudflare-domains.md](cloudflare-domains.md)
{% endcontent-ref %}

### Usajili wa Kikoa

* [ ] Katika **`Transfer Domains`** hakikisha kuwa haiwezekani kuhamasisha kikoa chochote.

Kagua kila moja kwa:

{% content-ref url="cloudflare-domains.md" %}
[cloudflare-domains.md](cloudflare-domains.md)
{% endcontent-ref %}

## Uchambuzi

_Sikuweza kupata chochote cha kukagua kwa ajili ya ukaguzi wa usalama wa mipangilio._

## Kurasa

Katika kila ukurasa wa Cloudflare:

* [ ] Kagua kwa **taarifa nyeti** katika **`Build log`**.
* [ ] Kagua kwa **taarifa nyeti** katika **Github repository** iliyotengwa kwa kurasa.
* [ ] Kagua kwa uwezekano wa kuathiriwa kwa github repo kupitia **workflow command injection** au `pull_request_target` kuathiriwa. Maelezo zaidi katika [**Github Security page**](../github-security/).
* [ ] Kagua kwa **kazi zenye udhaifu** katika saraka ya `/fuctions` (ikiwa zipo), kagua **redirects** katika faili ya `_redirects` (ikiwa zipo) na **vichwa vilivyowekwa vibaya** katika faili ya `_headers` (ikiwa zipo).
* [ ] Kagua kwa **udhaifu** katika **ukurasa wa wavuti** kupitia **blackbox** au **whitebox** ikiwa unaweza **kufikia msimbo**
* [ ] Katika maelezo ya kila ukurasa `/<page_id>/pages/view/blocklist/settings/functions`. Kagua kwa **taarifa nyeti** katika **`Environment variables`**.
* [ ] Katika ukurasa wa maelezo angalia pia **amri ya kujenga** na **saraka ya mzizi** kwa **uwezekano wa kuingiza** ili kuathiri ukurasa.

## **Wafanyakazi**

Katika kila mfanyakazi wa Cloudflare kagua:

* [ ] Vichocheo: Nini kinachofanya mfanyakazi akasirike? Je, **mtumiaji anaweza kutuma data** ambayo itatumika na mfanyakazi?
* [ ] Katika **`Settings`**, kagua kwa **`Variables`** zinazokuwa na **taarifa nyeti**
* [ ] Kagua **msimbo wa mfanyakazi** na tafuta **udhaifu** (hasa katika maeneo ambapo mtumiaji anaweza kudhibiti ingizo)
* Kagua kwa SSRFs zinazorejesha ukurasa ulioonyeshwa ambao unaweza kudhibiti
* Kagua XSSs zinazotekeleza JS ndani ya picha ya svg
* Inawezekana kwamba mfanyakazi anashirikiana na huduma nyingine za ndani. Kwa mfano, mfanyakazi anaweza kuingiliana na R2 bucket inayohifadhi taarifa ndani yake iliyopatikana kutoka kwa ingizo. Katika kesi hiyo, itahitajika kukagua ni uwezo gani mfanyakazi ana juu ya R2 bucket na jinsi gani inaweza kutumika vibaya kutokana na ingizo la mtumiaji.

{% hint style="warning" %}
Kumbuka kuwa kwa kawaida **Mfanyakazi anapewa URL** kama `<worker-name>.<account>.workers.dev`. Mtumiaji anaweza kuipatia **subdomain** lakini unaweza kila wakati kuipata kwa hiyo **URL ya asili** ikiwa unajua.
{% endhint %}

## R2

Katika kila R2 bucket kagua:

* [ ] Weka **Sera ya CORS**.

## Mstream

TODO

## Picha

TODO

## Kituo cha Usalama

* [ ] Ikiwezekana, fanya **`Security Insights`** **skani** na **`Infrastructure`** **skani**, kwani zitatoa **maelezo** ya kuvutia kuhusu **usalama**.
* [ ] Angalia tu **taarifa hii** kwa ajili ya mipangilio mibaya ya usalama na taarifa za kuvutia

## Turnstile

TODO

## **Zero Trust**

{% content-ref url="cloudflare-zero-trust-network.md" %}
[cloudflare-zero-trust-network.md](cloudflare-zero-trust-network.md)
{% endcontent-ref %}

## Mwelekeo wa Wingi

{% hint style="info" %}
Kinyume na [Mwelekeo wa Kijivu](https://developers.cloudflare.com/rules/url-forwarding/dynamic-redirects/), [**Mwelekeo wa Wingi**](https://developers.cloudflare.com/rules/url-forwarding/bulk-redirects/) kimsingi ni statiki ‚Äî hazisaidii **operesheni zozote za kubadilisha mfuatano** au maelezo ya kawaida. Hata hivyo, unaweza kuweka vigezo vya mwelekeo wa URL vinavyoathiri tabia yao ya ulinganifu wa URL na tabia yao ya wakati wa kukimbia.
{% endhint %}

* [ ] Kagua kwamba **mifano** na **mahitaji** ya mwelekeo **yanamaanisha**.
* [ ] Kagua pia kwa **nukta za siri za siri** ambazo zina taarifa za kuvutia.

## Arifa

* [ ] Kagua **arifa.** Arifa hizi zinapendekezwa kwa usalama:
* `Usage Based Billing`
* `HTTP DDoS Attack Alert`
* `Layer 3/4 DDoS Attack Alert`
* `Advanced HTTP DDoS Attack Alert`
* `Advanced Layer 3/4 DDoS Attack Alert`
* `Flow-based Monitoring: Volumetric Attack`
* `Route Leak Detection Alert`
* `Access mTLS Certificate Expiration Alert`
* `SSL for SaaS Custom Hostnames Alert`
* `Universal SSL Alert`
* `Script Monitor New Code Change Detection Alert`
* `Script Monitor New Domain Alert`
* `Script Monitor New Malicious Domain Alert`
* `Script Monitor New Malicious Script Alert`
* `Script Monitor New Malicious URL Alert`
* `Script Monitor New Scripts Alert`
* `Script Monitor New Script Exceeds Max URL Length Alert`
* `Advanced Security Events Alert`
* `Security Events Alert`
* [ ] Kagua zote **maeneo**, kwani kunaweza kuwa na **taarifa nyeti** (uthibitisho wa http wa msingi) katika urls za webhook. Hakikisha pia urls za webhook zinatumia **HTTPS**
* [ ] Kama ukaguzi wa ziada, unaweza kujaribu **kujifanya kuwa arifa ya cloudflare** kwa mtu wa tatu, labda unaweza kwa namna fulani **kuingiza kitu hatari**

## Simamia Akaunti

* [ ] Inawezekana kuona **nambari 4 za mwisho za kadi ya mkopo**, **muda wa kumalizika** na **anwani ya bili** katika **`Billing` -> `Payment info`**.
* [ ] Inawezekana kuona **aina ya mpango** inayotumika katika akaunti katika **`Billing` -> `Subscriptions`**.
* [ ] Katika **`Members`** inawezekana kuona wanachama wote wa akaunti na **jukumu** lao. Kumbuka kuwa ikiwa aina ya mpango si Enterprise, kuna majukumu 2 tu: Msimamizi na Msimamizi Mkuu. Lakini ikiwa **mpango unaotumika ni Enterprise**, [**majukumu zaidi**](https://developers.cloudflare.com/fundamentals/account-and-billing/account-setup/account-roles/) yanaweza kutumika kufuata kanuni ya chini ya kibali.
* Kwa hivyo, kila wakati inapowezekana ni **pendekezo** kutumia **mpango wa Enterprise**.
* [ ] Katika Wanachama inawezekana kukagua ni **wanachama** gani wana **2FA iliyoanzishwa**. **Kila** mtumiaji anapaswa kuwa nayo iliyoanzishwa.

{% hint style="info" %}
Kumbuka kuwa kwa bahati mbaya jukumu **`Msimamizi`** halitoi ruhusa za kusimamia uanachama (**haiwezi kuongeza ruhusa au kuwaleta** wanachama wapya)
{% endhint %}

## Utafiti wa DDoS

[Angalia sehemu hii](cloudflare-domains.md#cloudflare-ddos-protection).

{% hint style="success" %}
Jifunze na fanya mazoezi ya AWS Hacking:<img src="../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Jifunze na fanya mazoezi ya GCP Hacking: <img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Angalia [**mpango wa usajili**](https://github.com/sponsors/carlospolop)!
* **Jiunge na** üí¨ [**kikundi cha Discord**](https://discord.gg/hRep4RUj7f) au [**kikundi cha telegram**](https://t.me/peass) au **fuata** sisi kwenye **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Shiriki mbinu za udukuzi kwa kuwasilisha PRs kwa** [**HackTricks**](https://github.com/carlospolop/hacktricks) na [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
