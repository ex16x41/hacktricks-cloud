# Cloudflare Security

{% hint style="success" %}
Impara e pratica AWS Hacking:<img src="../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Impara e pratica GCP Hacking: <img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Supporta HackTricks</summary>

* Controlla i [**piani di abbonamento**](https://github.com/sponsors/carlospolop)!
* **Unisciti al** üí¨ [**gruppo Discord**](https://discord.gg/hRep4RUj7f) o al [**gruppo telegram**](https://t.me/peass) o **seguici** su **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Condividi trucchi di hacking inviando PR ai** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repos su github.

</details>
{% endhint %}

In un account Cloudflare ci sono alcune **impostazioni generali e servizi** che possono essere configurati. In questa pagina andremo a **analizzare le impostazioni relative alla sicurezza di ciascuna sezione:**

<figure><img src="../../.gitbook/assets/image (117).png" alt=""><figcaption></figcaption></figure>

## Siti Web

Esamina ciascuno con:

{% content-ref url="cloudflare-domains.md" %}
[cloudflare-domains.md](cloudflare-domains.md)
{% endcontent-ref %}

### Registrazione del Dominio

* [ ] In **`Transfer Domains`** controlla che non sia possibile trasferire alcun dominio.

Esamina ciascuno con:

{% content-ref url="cloudflare-domains.md" %}
[cloudflare-domains.md](cloudflare-domains.md)
{% endcontent-ref %}

## Analisi

_Non sono riuscito a trovare nulla da controllare per una revisione della sicurezza della configurazione._

## Pagine

Su ciascuna pagina di Cloudflare:

* [ ] Controlla per **informazioni sensibili** nel **`Build log`**.
* [ ] Controlla per **informazioni sensibili** nel **repository Github** assegnato alle pagine.
* [ ] Controlla per potenziale compromissione del repository github tramite **workflow command injection** o compromissione di `pull_request_target`. Maggiori informazioni nella [**pagina di Sicurezza di Github**](../github-security/).
* [ ] Controlla per **funzioni vulnerabili** nella directory `/fuctions` (se presenti), controlla i **redirect** nel file `_redirects` (se presenti) e **header mal configurati** nel file `_headers` (se presenti).
* [ ] Controlla per **vulnerabilit√†** nella **pagina web** tramite **blackbox** o **whitebox** se puoi **accedere al codice**.
* [ ] Nei dettagli di ciascuna pagina `/<page_id>/pages/view/blocklist/settings/functions`. Controlla per **informazioni sensibili** nelle **`Environment variables`**.
* [ ] Nella pagina dei dettagli controlla anche il **build command** e la **root directory** per **potenziali iniezioni** per compromettere la pagina.

## **Workers**

Su ciascun worker di Cloudflare controlla:

* [ ] I trigger: Cosa fa scattare il worker? Un **utente pu√≤ inviare dati** che saranno **utilizzati** dal worker?
* [ ] Nelle **`Settings`**, controlla per **`Variables`** contenenti **informazioni sensibili**.
* [ ] Controlla il **codice del worker** e cerca **vulnerabilit√†** (soprattutto nei luoghi in cui l'utente pu√≤ gestire l'input).
* Controlla per SSRF che restituiscono la pagina indicata che puoi controllare.
* Controlla XSS che eseguono JS all'interno di un'immagine svg.
* √à possibile che il worker interagisca con altri servizi interni. Ad esempio, un worker pu√≤ interagire con un bucket R2 che memorizza informazioni ottenute dall'input. In tal caso, sarebbe necessario controllare quali capacit√† ha il worker sul bucket R2 e come potrebbe essere abusato dall'input dell'utente.

{% hint style="warning" %}
Nota che per impostazione predefinita a un **Worker viene assegnato un URL** come `<worker-name>.<account>.workers.dev`. L'utente pu√≤ impostarlo su un **sottodominio**, ma puoi sempre accedervi con quell'**URL originale** se lo conosci.
{% endhint %}

## R2

Su ciascun bucket R2 controlla:

* [ ] Configura **CORS Policy**.

## Stream

TODO

## Immagini

TODO

## Centro Sicurezza

* [ ] Se possibile, esegui una **scansione di `Security Insights`** e una **scansione di `Infrastructure`**, poich√© evidenzieranno informazioni interessanti dal punto di vista **della sicurezza**.
* [ ] Controlla solo **queste informazioni** per configurazioni di sicurezza errate e informazioni interessanti.

## Turnstile

TODO

## **Zero Trust**

{% content-ref url="cloudflare-zero-trust-network.md" %}
[cloudflare-zero-trust-network.md](cloudflare-zero-trust-network.md)
{% endcontent-ref %}

## Redirects di Massa

{% hint style="info" %}
A differenza dei [Redirects Dinamici](https://developers.cloudflare.com/rules/url-forwarding/dynamic-redirects/), i [**Redirects di Massa**](https://developers.cloudflare.com/rules/url-forwarding/bulk-redirects/) sono essenzialmente statici ‚Äî non supportano alcuna operazione di sostituzione di stringhe o espressioni regolari. Tuttavia, puoi configurare i parametri di reindirizzamento URL che influenzano il loro comportamento di corrispondenza URL e il loro comportamento di runtime.
{% endhint %}

* [ ] Controlla che le **espressioni** e i **requisiti** per i redirect **abbiano senso**.
* [ ] Controlla anche per **endpoint nascosti sensibili** che contengono informazioni interessanti.

## Notifiche

* [ ] Controlla le **notifiche.** Queste notifiche sono raccomandate per la sicurezza:
* `Usage Based Billing`
* `HTTP DDoS Attack Alert`
* `Layer 3/4 DDoS Attack Alert`
* `Advanced HTTP DDoS Attack Alert`
* `Advanced Layer 3/4 DDoS Attack Alert`
* `Flow-based Monitoring: Volumetric Attack`
* `Route Leak Detection Alert`
* `Access mTLS Certificate Expiration Alert`
* `SSL for SaaS Custom Hostnames Alert`
* `Universal SSL Alert`
* `Script Monitor New Code Change Detection Alert`
* `Script Monitor New Domain Alert`
* `Script Monitor New Malicious Domain Alert`
* `Script Monitor New Malicious Script Alert`
* `Script Monitor New Malicious URL Alert`
* `Script Monitor New Scripts Alert`
* `Script Monitor New Script Exceeds Max URL Length Alert`
* `Advanced Security Events Alert`
* `Security Events Alert`
* [ ] Controlla tutte le **destinazioni**, poich√© potrebbero esserci **informazioni sensibili** (autenticazione http di base) negli URL dei webhook. Assicurati anche che gli URL dei webhook utilizzino **HTTPS**.
* [ ] Come controllo extra, potresti provare a **impersonare una notifica di cloudflare** a una terza parte, forse puoi in qualche modo **iniettare qualcosa di pericoloso**.

## Gestisci Account

* [ ] √à possibile vedere le **ultime 4 cifre della carta di credito**, il **tempo di scadenza** e l'**indirizzo di fatturazione** in **`Billing` -> `Payment info`**.
* [ ] √à possibile vedere il **tipo di piano** utilizzato nell'account in **`Billing` -> `Subscriptions`**.
* [ ] In **`Members`** √® possibile vedere tutti i membri dell'account e il loro **ruolo**. Nota che se il tipo di piano non √® Enterprise, esistono solo 2 ruoli: Amministratore e Super Amministratore. Ma se il **piano utilizzato √® Enterprise**, [**pi√π ruoli**](https://developers.cloudflare.com/fundamentals/account-and-billing/account-setup/account-roles/) possono essere utilizzati per seguire il principio del minimo privilegio.
* Pertanto, ogni volta che √® possibile √® **raccomandato** utilizzare il **piano Enterprise**.
* [ ] In Members √® possibile controllare quali **membri** hanno **2FA abilitato**. **Ogni** utente dovrebbe averlo abilitato.

{% hint style="info" %}
Nota che fortunatamente il ruolo **`Administrator`** non d√† permessi per gestire le iscrizioni (**non pu√≤ elevare privilegi o invitare** nuovi membri).
{% endhint %}

## Indagine DDoS

[Controlla questa parte](cloudflare-domains.md#cloudflare-ddos-protection).

{% hint style="success" %}
Impara e pratica AWS Hacking:<img src="../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Impara e pratica GCP Hacking: <img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Supporta HackTricks</summary>

* Controlla i [**piani di abbonamento**](https://github.com/sponsors/carlospolop)!
* **Unisciti al** üí¨ [**gruppo Discord**](https://discord.gg/hRep4RUj7f) o al [**gruppo telegram**](https://t.me/peass) o **seguici** su **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Condividi trucchi di hacking inviando PR ai** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repos su github.

</details>
{% endhint %}
