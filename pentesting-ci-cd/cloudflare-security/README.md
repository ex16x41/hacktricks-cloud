# Cloudflare-Sicherheit

{% hint style="success" %}
Lernen & √ºben Sie AWS-Hacking:<img src="../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">\
Lernen & √ºben Sie GCP-Hacking: <img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Unterst√ºtzen Sie HackTricks</summary>

* √úberpr√ºfen Sie die [**Abonnementpl√§ne**](https://github.com/sponsors/carlospolop)!
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teilen Sie Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repos senden.

</details>
{% endhint %}

In einem Cloudflare-Konto gibt es einige **allgemeine Einstellungen und Dienste**, die konfiguriert werden k√∂nnen. Auf dieser Seite werden wir die **sicherheitsrelevanten Einstellungen jeder Sektion analysieren:**

<figure><img src="../../.gitbook/assets/image (117).png" alt=""><figcaption></figcaption></figure>

## Websites

√úberpr√ºfen Sie jede mit:

{% content-ref url="cloudflare-domains.md" %}
[cloudflare-domains.md](cloudflare-domains.md)
{% endcontent-ref %}

### Domainregistrierung

* [ ] In **`Transfer Domains`** √ºberpr√ºfen, dass es nicht m√∂glich ist, eine Domain zu √ºbertragen.

√úberpr√ºfen Sie jede mit:

{% content-ref url="cloudflare-domains.md" %}
[cloudflare-domains.md](cloudflare-domains.md)
{% endcontent-ref %}

## Analytik

_Ich konnte nichts finden, um eine Sicherheits√ºberpr√ºfung der Konfiguration durchzuf√ºhren._

## Seiten

Auf jeder Cloudflare-Seite:

* [ ] √úberpr√ºfen Sie auf **sensible Informationen** im **`Build log`**.
* [ ] √úberpr√ºfen Sie auf **sensible Informationen** im **Github-Repository**, das den Seiten zugewiesen ist.
* [ ] √úberpr√ºfen Sie auf potenzielle Kompromittierungen des Github-Repos durch **Workflow-Befehlsinjektion** oder `pull_request_target`-Kompromittierung. Weitere Informationen auf der [**Github-Sicherheitsseite**](../github-security/).
* [ ] √úberpr√ºfen Sie auf **anf√§llige Funktionen** im Verzeichnis `/fuctions` (falls vorhanden), √ºberpr√ºfen Sie die **Weiterleitungen** in der Datei `_redirects` (falls vorhanden) und **falsch konfigurierte Header** in der Datei `_headers` (falls vorhanden).
* [ ] √úberpr√ºfen Sie auf **Schwachstellen** in der **Webseite** √ºber **Blackbox** oder **Whitebox**, wenn Sie **auf den Code zugreifen k√∂nnen**.
* [ ] In den Details jeder Seite `/<page_id>/pages/view/blocklist/settings/functions`. √úberpr√ºfen Sie auf **sensible Informationen** in den **`Umgebungsvariablen`**.
* [ ] √úberpr√ºfen Sie auch den **Build-Befehl** und das **Stammverzeichnis** auf **potenzielle Injektionen**, um die Seite zu kompromittieren.

## **Workers**

√úberpr√ºfen Sie bei jedem Cloudflare-Worker:

* [ ] Die Trigger: Was l√∂st den Worker aus? Kann ein **Benutzer Daten senden**, die vom Worker **verwendet** werden?
* [ ] In den **`Einstellungen`** √ºberpr√ºfen, ob **`Variablen`** sensible Informationen enthalten.
* [ ] √úberpr√ºfen Sie den **Code des Workers** und suchen Sie nach **Schwachstellen** (insbesondere an Stellen, an denen der Benutzer die Eingabe verwalten kann).
* √úberpr√ºfen Sie auf SSRFs, die die angegebene Seite zur√ºckgeben, die Sie kontrollieren k√∂nnen.
* √úberpr√ºfen Sie XSS, die JS innerhalb eines SVG-Bildes ausf√ºhren.
* Es ist m√∂glich, dass der Worker mit anderen internen Diensten interagiert. Zum Beispiel kann ein Worker mit einem R2-Bucket interagieren, der Informationen speichert, die aus der Eingabe stammen. In diesem Fall w√§re es notwendig zu √ºberpr√ºfen, welche M√∂glichkeiten der Worker √ºber den R2-Bucket hat und wie dies aus der Benutzereingabe missbraucht werden k√∂nnte.

{% hint style="warning" %}
Beachten Sie, dass einem **Worker standardm√§√üig eine URL** wie `<worker-name>.<account>.workers.dev` zugewiesen wird. Der Benutzer kann sie auf eine **Subdomain** setzen, aber Sie k√∂nnen immer mit dieser **urspr√ºnglichen URL** darauf zugreifen, wenn Sie sie kennen.
{% endhint %}

## R2

√úberpr√ºfen Sie bei jedem R2-Bucket:

* [ ] **CORS-Richtlinie** konfigurieren.

## Stream

TODO

## Bilder

TODO

## Sicherheitszentrum

* [ ] Wenn m√∂glich, f√ºhren Sie einen **`Security Insights`**-Scan und einen **`Infrastructure`**-Scan durch, da sie interessante Informationen **sicherheitsrelevant** hervorheben.
* [ ] √úberpr√ºfen Sie einfach diese Informationen auf Sicherheitsfehlkonfigurationen und interessante Infos.

## Turnstile

TODO

## **Zero Trust**

{% content-ref url="cloudflare-zero-trust-network.md" %}
[cloudflare-zero-trust-network.md](cloudflare-zero-trust-network.md)
{% endcontent-ref %}

## Bulk-Weiterleitungen

{% hint style="info" %}
Im Gegensatz zu [Dynamischen Weiterleitungen](https://developers.cloudflare.com/rules/url-forwarding/dynamic-redirects/) sind [**Bulk-Weiterleitungen**](https://developers.cloudflare.com/rules/url-forwarding/bulk-redirects/) im Wesentlichen statisch ‚Äî sie unterst√ºtzen **keine String-Ersetzungs**-Operationen oder regul√§ren Ausdr√ºcke. Sie k√∂nnen jedoch URL-Weiterleitungsparameter konfigurieren, die ihr URL-Matching-Verhalten und ihr Laufzeitverhalten beeinflussen.
{% endhint %}

* [ ] √úberpr√ºfen Sie, dass die **Ausdr√ºcke** und **Anforderungen** f√ºr Weiterleitungen **Sinn machen**.
* [ ] √úberpr√ºfen Sie auch auf **sensible versteckte Endpunkte**, die interessante Informationen enthalten.

## Benachrichtigungen

* [ ] √úberpr√ºfen Sie die **Benachrichtigungen.** Diese Benachrichtigungen werden f√ºr die Sicherheit empfohlen:
* `Nutzungsbasierte Abrechnung`
* `HTTP DDoS-Angriffsbenachrichtigung`
* `Layer 3/4 DDoS-Angriffsbenachrichtigung`
* `Erweiterte HTTP DDoS-Angriffsbenachrichtigung`
* `Erweiterte Layer 3/4 DDoS-Angriffsbenachrichtigung`
* `Flow-basiertes Monitoring: Volumetrischer Angriff`
* `Route Leak Detection Alert`
* `Zugriff mTLS-Zertifikat-Ablaufbenachrichtigung`
* `SSL f√ºr SaaS-Custom-Hostnamen-Benachrichtigung`
* `Universelle SSL-Benachrichtigung`
* `Script Monitor Neue Code√§nderungserkennung Benachrichtigung`
* `Script Monitor Neue Domain-Benachrichtigung`
* `Script Monitor Neue b√∂sartige Domain-Benachrichtigung`
* `Script Monitor Neue b√∂sartige Skript-Benachrichtigung`
* `Script Monitor Neue b√∂sartige URL-Benachrichtigung`
* `Script Monitor Neue Skripte-Benachrichtigung`
* `Script Monitor Neues Skript √ºberschreitet maximale URL-L√§ngenbenachrichtigung`
* `Erweiterte Sicherheitsereignisbenachrichtigung`
* `Sicherheitsereignisbenachrichtigung`
* [ ] √úberpr√ºfen Sie alle **Ziele**, da es in Webhook-URLs **sensible Informationen** (Basis-HTTP-Auth) geben k√∂nnte. Stellen Sie auch sicher, dass Webhook-URLs **HTTPS** verwenden.
* [ ] Als zus√§tzliche √úberpr√ºfung k√∂nnten Sie versuchen, eine **Cloudflare-Benachrichtigung** an eine dritte Partei zu **imitieren**, vielleicht k√∂nnen Sie irgendwie **etwas Gef√§hrliches injizieren**.

## Konto verwalten

* [ ] Es ist m√∂glich, die **letzten 4 Ziffern der Kreditkarte**, die **Ablauf**-Zeit und die **Rechnungsadresse** in **`Billing` -> `Payment info`** zu sehen.
* [ ] Es ist m√∂glich, den **Plan-Typ** im Konto in **`Billing` -> `Subscriptions`** zu sehen.
* [ ] In **`Members`** ist es m√∂glich, alle Mitglieder des Kontos und ihre **Rolle** zu sehen. Beachten Sie, dass, wenn der Plan-Typ nicht Enterprise ist, nur 2 Rollen existieren: Administrator und Superadministrator. Wenn der verwendete **Plan Enterprise** ist, k√∂nnen [**weitere Rollen**](https://developers.cloudflare.com/fundamentals/account-and-billing/account-setup/account-roles/) verwendet werden, um das Prinzip der minimalen Berechtigung zu befolgen.
* Daher wird empfohlen, wann immer m√∂glich den **Enterprise-Plan** zu verwenden.
* [ ] In Members ist es m√∂glich zu √ºberpr√ºfen, welche **Mitglieder** **2FA aktiviert** haben. **Jeder** Benutzer sollte es aktiviert haben.

{% hint style="info" %}
Beachten Sie, dass gl√ºcklicherweise die Rolle **`Administrator`** keine Berechtigungen zur Verwaltung von Mitgliedschaften gibt (**kann keine Berechtigungen erh√∂hen oder neue Mitglieder einladen**).
{% endhint %}

## DDoS-Untersuchung

[√úberpr√ºfen Sie diesen Teil](cloudflare-domains.md#cloudflare-ddos-protection).

{% hint style="success" %}
Lernen & √ºben Sie AWS-Hacking:<img src="../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">\
Lernen & √ºben Sie GCP-Hacking: <img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Unterst√ºtzen Sie HackTricks</summary>

* √úberpr√ºfen Sie die [**Abonnementpl√§ne**](https://github.com/sponsors/carlospolop)!
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teilen Sie Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repos senden.

</details>
{% endhint %}
