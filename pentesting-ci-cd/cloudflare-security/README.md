# Seguridad de Cloudflare

{% hint style="success" %}
Aprende y practica Hacking en AWS:<img src="../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">\
Aprende y practica Hacking en GCP: <img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Apoya a HackTricks</summary>

* Revisa los [**planes de suscripci√≥n**](https://github.com/sponsors/carlospolop)!
* **√önete al** üí¨ [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s√≠guenos** en **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Comparte trucos de hacking enviando PRs a los** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repos de github.

</details>
{% endhint %}

En una cuenta de Cloudflare hay algunas **configuraciones y servicios generales** que se pueden configurar. En esta p√°gina vamos a **analizar las configuraciones relacionadas con la seguridad de cada secci√≥n:**

<figure><img src="../../.gitbook/assets/image (117).png" alt=""><figcaption></figcaption></figure>

## Sitios web

Revisa cada uno con:

{% content-ref url="cloudflare-domains.md" %}
[cloudflare-domains.md](cloudflare-domains.md)
{% endcontent-ref %}

### Registro de Dominio

* [ ] En **`Transferir Dominios`** verifica que no sea posible transferir ning√∫n dominio.

Revisa cada uno con:

{% content-ref url="cloudflare-domains.md" %}
[cloudflare-domains.md](cloudflare-domains.md)
{% endcontent-ref %}

## Anal√≠tica

_No pude encontrar nada para revisar la seguridad de la configuraci√≥n._

## P√°ginas

En cada p√°gina de Cloudflare:

* [ ] Verifica si hay **informaci√≥n sensible** en el **`Registro de construcci√≥n`**.
* [ ] Verifica si hay **informaci√≥n sensible** en el **repositorio de Github** asignado a las p√°ginas.
* [ ] Verifica posibles compromisos del repositorio de github a trav√©s de **inyecci√≥n de comandos de flujo de trabajo** o compromiso de `pull_request_target`. M√°s informaci√≥n en la [**p√°gina de Seguridad de Github**](../github-security/).
* [ ] Verifica si hay **funciones vulnerables** en el directorio `/fuctions` (si hay), verifica los **redireccionamientos** en el archivo `_redirects` (si hay) y los **encabezados mal configurados** en el archivo `_headers` (si hay).
* [ ] Verifica si hay **vulnerabilidades** en la **p√°gina web** a trav√©s de **blackbox** o **whitebox** si puedes **acceder al c√≥digo**.
* [ ] En los detalles de cada p√°gina `/<page_id>/pages/view/blocklist/settings/functions`. Verifica si hay **informaci√≥n sensible** en las **`Variables de entorno`**.
* [ ] En la p√°gina de detalles verifica tambi√©n el **comando de construcci√≥n** y el **directorio ra√≠z** para **posibles inyecciones** que comprometan la p√°gina.

## **Workers**

En cada worker de Cloudflare verifica:

* [ ] Los disparadores: ¬øQu√© hace que el worker se active? ¬øPuede un **usuario enviar datos** que ser√°n **usados** por el worker?
* [ ] En los **`Ajustes`**, verifica si hay **`Variables`** que contengan **informaci√≥n sensible**.
* [ ] Verifica el **c√≥digo del worker** y busca **vulnerabilidades** (especialmente en lugares donde el usuario puede gestionar la entrada).
* Verifica SSRFs que devuelvan la p√°gina indicada que puedes controlar.
* Verifica XSSs ejecutando JS dentro de una imagen svg.
* Es posible que el worker interact√∫e con otros servicios internos. Por ejemplo, un worker puede interactuar con un bucket R2 almacenando informaci√≥n en √©l obtenida de la entrada. En ese caso, ser√≠a necesario verificar qu√© capacidades tiene el worker sobre el bucket R2 y c√≥mo podr√≠a ser abusado desde la entrada del usuario.

{% hint style="warning" %}
Ten en cuenta que por defecto a un **Worker se le da una URL** como `<worker-name>.<account>.workers.dev`. El usuario puede configurarlo a un **subdominio** pero siempre puedes acceder a √©l con esa **URL original** si la conoces.
{% endhint %}

## R2

En cada bucket R2 verifica:

* [ ] Configura la **Pol√≠tica de CORS**.

## Stream

TODO

## Im√°genes

TODO

## Centro de Seguridad

* [ ] Si es posible, ejecuta un **escaneo de `Insights de Seguridad`** y un **escaneo de `Infraestructura`**, ya que **destacar√°n** informaci√≥n interesante **en t√©rminos de seguridad**.
* [ ] Solo **verifica esta informaci√≥n** para configuraciones de seguridad incorrectas e informaci√≥n interesante.

## Turnstile

TODO

## **Zero Trust**

{% content-ref url="cloudflare-zero-trust-network.md" %}
[cloudflare-zero-trust-network.md](cloudflare-zero-trust-network.md)
{% endcontent-ref %}

## Redireccionamientos Masivos

{% hint style="info" %}
A diferencia de [Redireccionamientos Din√°micos](https://developers.cloudflare.com/rules/url-forwarding/dynamic-redirects/), [**Redireccionamientos Masivos**](https://developers.cloudflare.com/rules/url-forwarding/bulk-redirects/) son esencialmente est√°ticos ‚Äî no **soportan ninguna operaci√≥n de reemplazo de cadenas** o expresiones regulares. Sin embargo, puedes configurar par√°metros de redireccionamiento de URL que afectan su comportamiento de coincidencia de URL y su comportamiento en tiempo de ejecuci√≥n.
{% endhint %}

* [ ] Verifica que las **expresiones** y **requisitos** para los redireccionamientos **tengan sentido**.
* [ ] Verifica tambi√©n si hay **puntos finales ocultos sensibles** que contengan informaci√≥n interesante.

## Notificaciones

* [ ] Verifica las **notificaciones.** Estas notificaciones son recomendadas para seguridad:
* `Facturaci√≥n Basada en Uso`
* `Alerta de Ataque DDoS HTTP`
* `Alerta de Ataque DDoS Capa 3/4`
* `Alerta de Ataque DDoS HTTP Avanzado`
* `Alerta de Ataque DDoS Capa 3/4 Avanzado`
* `Monitoreo Basado en Flujo: Ataque Volum√©trico`
* `Alerta de Detecci√≥n de Fugas de Ruta`
* `Alerta de Expiraci√≥n de Certificado mTLS de Acceso`
* `Alerta de SSL para Nombres de Host Personalizados de SaaS`
* `Alerta de SSL Universal`
* `Alerta de Detecci√≥n de Nuevos Cambios de C√≥digo en el Monitor de Scripts`
* `Alerta de Nuevo Dominio en el Monitor de Scripts`
* `Alerta de Nuevo Dominio Malicioso en el Monitor de Scripts`
* `Alerta de Nuevo Script Malicioso en el Monitor de Scripts`
* `Alerta de Nueva URL Maliciosa en el Monitor de Scripts`
* `Alerta de Nuevos Scripts en el Monitor de Scripts`
* `Alerta de Nuevo Script Excede la Longitud M√°xima de URL en el Monitor de Scripts`
* `Alerta de Eventos de Seguridad Avanzados`
* `Alerta de Eventos de Seguridad`
* [ ] Verifica todos los **destinos**, ya que podr√≠a haber **informaci√≥n sensible** (autenticaci√≥n http b√°sica) en las URLs de webhook. Aseg√∫rate tambi√©n de que las URLs de webhook usen **HTTPS**.
* [ ] Como verificaci√≥n adicional, podr√≠as intentar **suplantar una notificaci√≥n de cloudflare** a un tercero, tal vez puedas **inyectar algo peligroso** de alguna manera.

## Gestionar Cuenta

* [ ] Es posible ver los **√∫ltimos 4 d√≠gitos de la tarjeta de cr√©dito**, el **tiempo de expiraci√≥n** y la **direcci√≥n de facturaci√≥n** en **`Facturaci√≥n` -> `Informaci√≥n de pago`**.
* [ ] Es posible ver el **tipo de plan** utilizado en la cuenta en **`Facturaci√≥n` -> `Suscripciones`**.
* [ ] En **`Miembros`** es posible ver todos los miembros de la cuenta y su **rol**. Ten en cuenta que si el tipo de plan no es Enterprise, solo existen 2 roles: Administrador y Super Administrador. Pero si el **plan utilizado es Enterprise**, se pueden usar [**m√°s roles**](https://developers.cloudflare.com/fundamentals/account-and-billing/account-setup/account-roles/) para seguir el principio de menor privilegio.
* Por lo tanto, siempre que sea posible, se **recomienda** utilizar el **plan Enterprise**.
* [ ] En Miembros es posible verificar qu√© **miembros** tienen **2FA habilitado**. **Cada** usuario deber√≠a tenerlo habilitado.

{% hint style="info" %}
Ten en cuenta que afortunadamente el rol **`Administrador`** no otorga permisos para gestionar membres√≠as (**no puede escalar privilegios ni invitar** nuevos miembros).
{% endhint %}

## Investigaci√≥n de DDoS

[Revisa esta parte](cloudflare-domains.md#cloudflare-ddos-protection).

{% hint style="success" %}
Aprende y practica Hacking en AWS:<img src="../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">\
Aprende y practica Hacking en GCP: <img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Apoya a HackTricks</summary>

* Revisa los [**planes de suscripci√≥n**](https://github.com/sponsors/carlospolop)!
* **√önete al** üí¨ [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s√≠guenos** en **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Comparte trucos de hacking enviando PRs a los** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repos de github.

</details>
{% endhint %}
