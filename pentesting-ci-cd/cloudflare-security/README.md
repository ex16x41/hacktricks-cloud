# Cloudflare Sekuriteit

{% hint style="success" %}
Leer & oefen AWS Hacking:<img src="../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks Opleiding AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
Leer & oefen GCP Hacking: <img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Opleiding GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Ondersteun HackTricks</summary>

* Kyk na die [**subskripsie planne**](https://github.com/sponsors/carlospolop)!
* **Sluit aan by die** 💬 [**Discord groep**](https://discord.gg/hRep4RUj7f) of die [**telegram groep**](https://t.me/peass) of **volg** ons op **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Deel hacking truuks deur PRs in te dien na die** [**HackTricks**](https://github.com/carlospolop/hacktricks) en [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

In 'n Cloudflare rekening is daar 'n paar **generiese instellings en dienste** wat gekonfigureer kan word. Op hierdie bladsy gaan ons die **veiligheid verwante instellings van elke afdeling analiseer:**

<figure><img src="../../.gitbook/assets/image (117).png" alt=""><figcaption></figcaption></figure>

## Webwerwe

Herbekyk elkeen met:

{% content-ref url="cloudflare-domains.md" %}
[cloudflare-domains.md](cloudflare-domains.md)
{% endcontent-ref %}

### Domein Registrasie

* [ ] In **`Transfer Domains`** kyk dat dit nie moontlik is om enige domein oor te dra nie.

Herbekyk elkeen met:

{% content-ref url="cloudflare-domains.md" %}
[cloudflare-domains.md](cloudflare-domains.md)
{% endcontent-ref %}

## Analise

_Ek kon niks vind om vir 'n konfigurasie sekuriteits hersiening na te kyk nie._

## Bladsye

Op elke Cloudflare se bladsy:

* [ ] Kyk vir **sensitiewe inligting** in die **`Build log`**.
* [ ] Kyk vir **sensitiewe inligting** in die **Github repository** wat aan die bladsye toegeken is.
* [ ] Kyk vir potensiële github repo kompromie via **workflow command injection** of `pull_request_target` kompromie. Meer inligting in die [**Github Sekuriteit bladsy**](../github-security/).
* [ ] Kyk vir **kwesbare funksies** in die `/fuctions` gids (indien enige), kyk die **redirects** in die `_redirects` lêer (indien enige) en **misgeconfigureerde headers** in die `_headers` lêer (indien enige).
* [ ] Kyk vir **kwesbaarhede** in die **web bladsy** via **blackbox** of **whitebox** as jy die **kode** kan **toegang**.
* [ ] In die besonderhede van elke bladsy `/<page_id>/pages/view/blocklist/settings/functions`. Kyk vir **sensitiewe inligting** in die **`Environment variables`**.
* [ ] In die besonderhede bladsy kyk ook die **build command** en **root directory** vir **potensiële inspuitings** om die bladsy te kompromitteer.

## **Workers**

Op elke Cloudflare se werker kyk:

* [ ] Die triggers: Wat maak die werker aktiveer? Kan 'n **gebruiker data stuur** wat deur die werker **gebruik** sal word?
* [ ] In die **`Settings`**, kyk vir **`Variables`** wat **sensitiewe inligting** bevat.
* [ ] Kyk die **kode van die werker** en soek vir **kwesbaarhede** (veral in plekke waar die gebruiker die invoer kan bestuur).
* Kyk vir SSRFs wat die aangeduide bladsy teruggee wat jy kan beheer.
* Kyk XSSs wat JS binne 'n svg beeld uitvoer.
* Dit is moontlik dat die werker met ander interne dienste interaksie het. Byvoorbeeld, 'n werker kan met 'n R2 emmer interaksie hê wat inligting daarin stoor wat van die invoer verkry is. In daardie geval sal dit nodig wees om te kyk watter vermoëns die werker oor die R2 emmer het en hoe dit misbruik kan word vanaf die gebruiker se invoer.

{% hint style="warning" %}
Let daarop dat 'n **Werker standaard 'n URL gegee word** soos `<worker-name>.<account>.workers.dev`. Die gebruiker kan dit na 'n **subdomein** stel, maar jy kan dit altyd met daardie **oorspronklike URL** benader as jy dit weet.
{% endhint %}

## R2

Op elke R2 emmer kyk:

* [ ] Konfigureer **CORS Beleid**.

## Stroom

TODO

## Beelde

TODO

## Sekuriteit Sentrum

* [ ] As moontlik, voer 'n **`Security Insights`** **skandering** en 'n **`Infrastructure`** **skandering** uit, aangesien dit **interessante inligting** **veiligheid** wys.
* [ ] Kyk net na **hierdie inligting** vir sekuriteits misconfigurasies en interessante inligting.

## Turnstile

TODO

## **Zero Trust**

{% content-ref url="cloudflare-zero-trust-network.md" %}
[cloudflare-zero-trust-network.md](cloudflare-zero-trust-network.md)
{% endcontent-ref %}

## Mass Redirects

{% hint style="info" %}
Verskil van [Dinamiese Redirects](https://developers.cloudflare.com/rules/url-forwarding/dynamic-redirects/), [**Mass Redirects**](https://developers.cloudflare.com/rules/url-forwarding/bulk-redirects/) is in wese staties — hulle ondersteun **nie enige string vervangings** operasies of gereelde uitdrukkings nie. Jy kan egter URL herdirection parameters konfigureer wat hul URL ooreenkoms gedrag en hul runtime gedrag beïnvloed.
{% endhint %}

* [ ] Kyk dat die **uitdrukkings** en **vereistes** vir redirects **sinvol** is.
* [ ] Kyk ook vir **sensitiewe verborge eindpunte** wat jy interessante inligting bevat.

## Kennisgewings

* [ ] Kyk die **kennisgewings.** Hierdie kennisgewings word aanbeveel vir sekuriteit:
* `Usage Based Billing`
* `HTTP DDoS Attack Alert`
* `Layer 3/4 DDoS Attack Alert`
* `Advanced HTTP DDoS Attack Alert`
* `Advanced Layer 3/4 DDoS Attack Alert`
* `Flow-based Monitoring: Volumetric Attack`
* `Route Leak Detection Alert`
* `Access mTLS Certificate Expiration Alert`
* `SSL for SaaS Custom Hostnames Alert`
* `Universal SSL Alert`
* `Script Monitor New Code Change Detection Alert`
* `Script Monitor New Domain Alert`
* `Script Monitor New Malicious Domain Alert`
* `Script Monitor New Malicious Script Alert`
* `Script Monitor New Malicious URL Alert`
* `Script Monitor New Scripts Alert`
* `Script Monitor New Script Exceeds Max URL Length Alert`
* `Advanced Security Events Alert`
* `Security Events Alert`
* [ ] Kyk al die **bestemmings**, aangesien daar **sensitiewe inligting** (basiese http auth) in webhook urls kan wees. Maak ook seker dat webhook urls **HTTPS** gebruik.
* [ ] As ekstra kontrole, kan jy probeer om 'n **cloudflare kennisgewing** na 'n derde party te **verpersoonlik**, miskien kan jy op een of ander manier **iets gevaarliks inspuit**.

## Bestuur Rekening

* [ ] Dit is moontlik om die **laaste 4 syfers van die kredietkaart**, **verval** tyd en **faktuur adres** in **`Billing` -> `Payment info`** te sien.
* [ ] Dit is moontlik om die **plan tipe** wat in die rekening gebruik word in **`Billing` -> `Subscriptions`** te sien.
* [ ] In **`Members`** is dit moontlik om al die lede van die rekening en hul **rol** te sien. Let daarop dat as die plan tipe nie Enterprise is nie, slegs 2 rolle bestaan: Administrateur en Super Administrateur. Maar as die gebruikte **plan Enterprise** is, kan [**meer rolle**](https://developers.cloudflare.com/fundamentals/account-and-billing/account-setup/account-roles/) gebruik word om die minste voorregte beginsel te volg.
* Daarom, wanneer moontlik, word dit **aanbeveel** om die **Enterprise plan** te gebruik.
* [ ] In Lede is dit moontlik om te kyk watter **lede** **2FA geaktiveer** het. **Elke** gebruiker moet dit geaktiveer hê.

{% hint style="info" %}
Let daarop dat gelukkig die rol **`Administrator`** nie toestemming gee om lidmaatskappe te bestuur nie (**kan nie voorregte verhoog of** nuwe lede nooi nie).
{% endhint %}

## DDoS Ondersoek

[Kyk hierdie deel](cloudflare-domains.md#cloudflare-ddos-protection).

{% hint style="success" %}
Leer & oefen AWS Hacking:<img src="../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks Opleiding AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
Leer & oefen GCP Hacking: <img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Opleiding GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Ondersteun HackTricks</summary>

* Kyk na die [**subskripsie planne**](https://github.com/sponsors/carlospolop)!
* **Sluit aan by die** 💬 [**Discord groep**](https://discord.gg/hRep4RUj7f) of die [**telegram groep**](https://t.me/peass) of **volg** ons op **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Deel hacking truuks deur PRs in te dien na die** [**HackTricks**](https://github.com/carlospolop/hacktricks) en [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
