# Cloudflare Security

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

U Cloudflare nalogu postoje neka **opÅ¡ta podeÅ¡avanja i usluge** koje se mogu konfigurisati. Na ovoj stranici Ä‡emo **analizirati podeÅ¡avanja vezana za sigurnost svake sekcije:**

<figure><img src="../../.gitbook/assets/image (117).png" alt=""><figcaption></figcaption></figure>

## Websites

Pregledajte svaku sa:

{% content-ref url="cloudflare-domains.md" %}
[cloudflare-domains.md](cloudflare-domains.md)
{% endcontent-ref %}

### Domain Registration

* [ ] U **`Transfer Domains`** proverite da nije moguÄ‡e preneti nijedan domen.

Pregledajte svaku sa:

{% content-ref url="cloudflare-domains.md" %}
[cloudflare-domains.md](cloudflare-domains.md)
{% endcontent-ref %}

## Analytics

_Nisam mogao pronaÄ‡i niÅ¡ta za proveru bezbednosti konfiguracije._

## Pages

Na svakoj Cloudflare stranici:

* [ ] Proverite za **osetljive informacije** u **`Build log`**.
* [ ] Proverite za **osetljive informacije** u **Github repozitorijumu** dodeljenom stranicama.
* [ ] Proverite za potencijalno kompromitovanje github repozitorijuma putem **workflow command injection** ili `pull_request_target` kompromitovanja. ViÅ¡e informacija na [**Github Security page**](../github-security/).
* [ ] Proverite za **ranjive funkcije** u direktorijumu `/fuctions` (ako ih ima), proverite **preusmeravanja** u datoteci `_redirects` (ako ih ima) i **pogreÅ¡no konfigurisane zaglavlja** u datoteci `_headers` (ako ih ima).
* [ ] Proverite za **ranjivosti** na **web stranici** putem **blackbox** ili **whitebox** ako moÅ¾ete **pristupiti kodu**.
* [ ] U detaljima svake stranice `/<page_id>/pages/view/blocklist/settings/functions`. Proverite za **osetljive informacije** u **`Environment variables`**.
* [ ] U detaljima stranice proverite takoÄ‘e **build command** i **root directory** za **potencijalne injekcije** koje bi mogle kompromitovati stranicu.

## **Workers**

Na svakom Cloudflare radniku proverite:

* [ ] OkidaÄe: Å ta pokreÄ‡e radnika? MoÅ¾e li **korisnik poslati podatke** koji Ä‡e biti **koriÅ¡Ä‡eni** od strane radnika?
* [ ] U **`Settings`**, proverite za **`Variables`** koje sadrÅ¾e **osetljive informacije**.
* [ ] Proverite **kod radnika** i traÅ¾ite **ranjivosti** (posebno na mestima gde korisnik moÅ¾e upravljati unosom).
* Proverite za SSRFs koji vraÄ‡aju oznaÄenu stranicu koju moÅ¾ete kontrolisati.
* Proverite XSS koji izvrÅ¡avaju JS unutar svg slike.
* MoguÄ‡e je da radnik komunicira sa drugim internim uslugama. Na primer, radnik moÅ¾e komunicirati sa R2 bucket-om koji Äuva informacije dobijene iz unosa. U tom sluÄaju, potrebno je proveriti koje moguÄ‡nosti radnik ima nad R2 bucket-om i kako bi to moglo biti zloupotrebljeno iz korisniÄkog unosa.

{% hint style="warning" %}
Napomena da po defaultu **Worker dobija URL** kao Å¡to je `<worker-name>.<account>.workers.dev`. Korisnik moÅ¾e postaviti na **subdomen** ali uvek moÅ¾ete pristupiti sa tim **originalnim URL-om** ako ga znate.
{% endhint %}

## R2

Na svakom R2 bucket-u proverite:

* [ ] KonfiguriÅ¡ite **CORS Policy**.

## Stream

TODO

## Images

TODO

## Security Center

* [ ] Ako je moguÄ‡e, pokrenite **`Security Insights`** **skaniranje** i **`Infrastructure`** **skaniranje**, jer Ä‡e **istaknuti** zanimljive informacije **u vezi sa sigurnoÅ¡Ä‡u**.
* [ ] Samo **proverite ove informacije** za bezbednosne pogreÅ¡ne konfiguracije i zanimljive informacije.

## Turnstile

TODO

## **Zero Trust**

{% content-ref url="cloudflare-zero-trust-network.md" %}
[cloudflare-zero-trust-network.md](cloudflare-zero-trust-network.md)
{% endcontent-ref %}

## Bulk Redirects

{% hint style="info" %}
Za razliku od [Dynamic Redirects](https://developers.cloudflare.com/rules/url-forwarding/dynamic-redirects/), [**Bulk Redirects**](https://developers.cloudflare.com/rules/url-forwarding/bulk-redirects/) su suÅ¡tinski statiÄni â€” ne podrÅ¾avaju **nikakve operacije zamene stringova** ili regularne izraze. MeÄ‘utim, moÅ¾ete konfigurisati parametre URL preusmeravanja koji utiÄu na njihovo ponaÅ¡anje u vezi sa usklaÄ‘ivanjem URL-a i njihovim ponaÅ¡anjem tokom izvrÅ¡avanja.
{% endhint %}

* [ ] Proverite da **izrazi** i **zahtevi** za preusmeravanja **ima smisla**.
* [ ] Proverite takoÄ‘e za **osetljive skrivene krajnje taÄke** koje sadrÅ¾e zanimljive informacije.

## Notifications

* [ ] Proverite **obaveÅ¡tenja.** Ova obaveÅ¡tenja se preporuÄuju za sigurnost:
* `Usage Based Billing`
* `HTTP DDoS Attack Alert`
* `Layer 3/4 DDoS Attack Alert`
* `Advanced HTTP DDoS Attack Alert`
* `Advanced Layer 3/4 DDoS Attack Alert`
* `Flow-based Monitoring: Volumetric Attack`
* `Route Leak Detection Alert`
* `Access mTLS Certificate Expiration Alert`
* `SSL for SaaS Custom Hostnames Alert`
* `Universal SSL Alert`
* `Script Monitor New Code Change Detection Alert`
* `Script Monitor New Domain Alert`
* `Script Monitor New Malicious Domain Alert`
* `Script Monitor New Malicious Script Alert`
* `Script Monitor New Malicious URL Alert`
* `Script Monitor New Scripts Alert`
* `Script Monitor New Script Exceeds Max URL Length Alert`
* `Advanced Security Events Alert`
* `Security Events Alert`
* [ ] Proverite sve **odrediÅ¡ne taÄke**, jer moÅ¾e biti **osetljivih informacija** (osnovna http autentifikacija) u webhook URL-ovima. TakoÄ‘e se pobrinite da webhook URL-ovi koriste **HTTPS**.
* [ ] Kao dodatnu proveru, mogli biste pokuÅ¡ati da **imitirate Cloudflare obaveÅ¡tenje** treÄ‡oj strani, moÅ¾da moÅ¾ete nekako **ubaciti neÅ¡to opasno**.

## Manage Account

* [ ] MoguÄ‡e je videti **poslednje 4 cifre kreditne kartice**, **datum isteka** i **adresu za naplatu** u **`Billing` -> `Payment info`**.
* [ ] MoguÄ‡e je videti **tip plana** koji se koristi u nalogu u **`Billing` -> `Subscriptions`**.
* [ ] U **`Members`** moguÄ‡e je videti sve Älanove naloga i njihovu **ulogu**. Napomena da ako tip plana nije Enterprise, postoje samo 2 uloge: Administrator i Super Administrator. Ali ako je koriÅ¡Ä‡en **plan Enterprise**, [**viÅ¡e uloga**](https://developers.cloudflare.com/fundamentals/account-and-billing/account-setup/account-roles/) moÅ¾e se koristiti da se prati princip minimalnih privilegija.
* Stoga, kada god je to moguÄ‡e, **preporuÄuje se** koriÅ¡Ä‡enje **Enterprise plana**.
* [ ] U Älanovima je moguÄ‡e proveriti koji **Älanovi** imaju **2FA omoguÄ‡eno**. **Svaki** korisnik bi trebao imati omoguÄ‡eno.

{% hint style="info" %}
Napomena da sreÄ‡om uloga **`Administrator`** ne daje dozvole za upravljanje Älanstvima (**ne moÅ¾e poveÄ‡ati privilegije ili pozvati** nove Älanove).
{% endhint %}

## DDoS Investigation

[Check this part](cloudflare-domains.md#cloudflare-ddos-protection).

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
