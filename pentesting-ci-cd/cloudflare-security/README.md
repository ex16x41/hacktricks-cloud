# Cloudflare Security

{% hint style="success" %}
Μάθετε & εξασκηθείτε στο AWS Hacking:<img src="../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">\
Μάθετε & εξασκηθείτε στο GCP Hacking: <img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Ελέγξτε τα [**σχέδια συνδρομής**](https://github.com/sponsors/carlospolop)!
* **Εγγραφείτε στην** 💬 [**ομάδα Discord**](https://discord.gg/hRep4RUj7f) ή στην [**ομάδα telegram**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Μοιραστείτε κόλπα hacking υποβάλλοντας PRs στα** [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

Σε έναν λογαριασμό Cloudflare υπάρχουν κάποιες **γενικές ρυθμίσεις και υπηρεσίες** που μπορούν να ρυθμιστούν. Σε αυτή τη σελίδα θα **αναλύσουμε τις ρυθμίσεις που σχετίζονται με την ασφάλεια κάθε ενότητας:**

<figure><img src="../../.gitbook/assets/image (117).png" alt=""><figcaption></figcaption></figure>

## Websites

Ελέγξτε κάθε ένα με:

{% content-ref url="cloudflare-domains.md" %}
[cloudflare-domains.md](cloudflare-domains.md)
{% endcontent-ref %}

### Domain Registration

* [ ] Στο **`Transfer Domains`** ελέγξτε ότι δεν είναι δυνατή η μεταφορά οποιουδήποτε τομέα.

Ελέγξτε κάθε ένα με:

{% content-ref url="cloudflare-domains.md" %}
[cloudflare-domains.md](cloudflare-domains.md)
{% endcontent-ref %}

## Analytics

_Δεν μπόρεσα να βρω τίποτα για να ελέγξω για ανασκόπηση ασφάλειας ρυθμίσεων._

## Pages

Σε κάθε σελίδα του Cloudflare:

* [ ] Ελέγξτε για **ευαίσθητες πληροφορίες** στο **`Build log`**.
* [ ] Ελέγξτε για **ευαίσθητες πληροφορίες** στο **Github repository** που έχει ανατεθεί στις σελίδες.
* [ ] Ελέγξτε για πιθανή παραβίαση του github repo μέσω **workflow command injection** ή παραβίαση `pull_request_target`. Περισσότερες πληροφορίες στη [**σελίδα ασφάλειας Github**](../github-security/).
* [ ] Ελέγξτε για **ευάλωτες λειτουργίες** στον φάκελο `/fuctions` (αν υπάρχουν), ελέγξτε τις **ανακατευθύνσεις** στο αρχείο `_redirects` (αν υπάρχουν) και **κακώς ρυθμισμένα headers** στο αρχείο `_headers` (αν υπάρχουν).
* [ ] Ελέγξτε για **ευπάθειες** στη **σελίδα** μέσω **blackbox** ή **whitebox** αν μπορείτε να **έχετε πρόσβαση στον κώδικα**.
* [ ] Στις λεπτομέρειες κάθε σελίδας `/<page_id>/pages/view/blocklist/settings/functions`. Ελέγξτε για **ευαίσθητες πληροφορίες** στις **`Environment variables`**.
* [ ] Στη σελίδα λεπτομερειών ελέγξτε επίσης την **εντολή build** και τον **ριζικό φάκελο** για **πιθανές εισβολές** που θα μπορούσαν να παραβιάσουν τη σελίδα.

## **Workers**

Σε κάθε worker του Cloudflare ελέγξτε:

* [ ] Τα triggers: Τι προκαλεί την ενεργοποίηση του worker; Μπορεί ένας **χρήστης να στείλει δεδομένα** που θα **χρησιμοποιηθούν** από τον worker;
* [ ] Στις **`Settings`**, ελέγξτε για **`Variables`** που περιέχουν **ευαίσθητες πληροφορίες**.
* [ ] Ελέγξτε τον **κώδικα του worker** και αναζητήστε **ευπάθειες** (ιδιαίτερα σε μέρη όπου ο χρήστης μπορεί να διαχειριστεί την είσοδο).
* Ελέγξτε για SSRFs που επιστρέφουν τη δηλωμένη σελίδα που μπορείτε να ελέγξετε.
* Ελέγξτε XSSs που εκτελούν JS μέσα σε μια εικόνα svg.
* Είναι πιθανό ο worker να αλληλεπιδρά με άλλες εσωτερικές υπηρεσίες. Για παράδειγμα, ένας worker μπορεί να αλληλεπιδρά με έναν R2 bucket που αποθηκεύει πληροφορίες που αποκτήθηκαν από την είσοδο. Σε αυτή την περίπτωση, θα ήταν απαραίτητο να ελέγξετε ποιες δυνατότητες έχει ο worker πάνω στον R2 bucket και πώς θα μπορούσε να καταχραστεί από την είσοδο του χρήστη.

{% hint style="warning" %}
Σημειώστε ότι από προεπιλογή ένας **Worker έχει μια διεύθυνση URL** όπως `<worker-name>.<account>.workers.dev`. Ο χρήστης μπορεί να το ρυθμίσει σε **subdomain** αλλά μπορείτε πάντα να έχετε πρόσβαση σε αυτό με αυτή τη **πρωτότυπη διεύθυνση URL** αν το γνωρίζετε.
{% endhint %}

## R2

Σε κάθε R2 bucket ελέγξτε:

* [ ] Ρυθμίστε την **CORS Policy**.

## Stream

TODO

## Images

TODO

## Security Center

* [ ] Αν είναι δυνατόν, εκτελέστε μια **σάρωση `Security Insights`** και μια **σάρωση `Infrastructure`**, καθώς θα **αναδείξουν** ενδιαφέρουσες πληροφορίες **σχετικά με την ασφάλεια**.
* [ ] Απλώς **ελέγξτε αυτές τις πληροφορίες** για κακώς ρυθμισμένες ρυθμίσεις ασφάλειας και ενδιαφέρουσες πληροφορίες.

## Turnstile

TODO

## **Zero Trust**

{% content-ref url="cloudflare-zero-trust-network.md" %}
[cloudflare-zero-trust-network.md](cloudflare-zero-trust-network.md)
{% endcontent-ref %}

## Bulk Redirects

{% hint style="info" %}
Σε αντίθεση με [Dynamic Redirects](https://developers.cloudflare.com/rules/url-forwarding/dynamic-redirects/), [**Bulk Redirects**](https://developers.cloudflare.com/rules/url-forwarding/bulk-redirects/) είναι ουσιαστικά στατικές — δεν υποστηρίζουν καμία λειτουργία αντικατάστασης συμβολοσειρών ή κανονικές εκφράσεις. Ωστόσο, μπορείτε να ρυθμίσετε παραμέτρους ανακατεύθυνσης URL που επηρεάζουν τη συμπεριφορά αντιστοίχισης URL και τη συμπεριφορά εκτέλεσης τους.
{% endhint %}

* [ ] Ελέγξτε ότι οι **εκφράσεις** και οι **απαιτήσεις** για τις ανακατευθύνσεις **έχουν νόημα**.
* [ ] Ελέγξτε επίσης για **ευαίσθητους κρυφούς προορισμούς** που περιέχουν ενδιαφέρουσες πληροφορίες.

## Notifications

* [ ] Ελέγξτε τις **ειδοποιήσεις.** Αυτές οι ειδοποιήσεις συνιστώνται για την ασφάλεια:
* `Usage Based Billing`
* `HTTP DDoS Attack Alert`
* `Layer 3/4 DDoS Attack Alert`
* `Advanced HTTP DDoS Attack Alert`
* `Advanced Layer 3/4 DDoS Attack Alert`
* `Flow-based Monitoring: Volumetric Attack`
* `Route Leak Detection Alert`
* `Access mTLS Certificate Expiration Alert`
* `SSL for SaaS Custom Hostnames Alert`
* `Universal SSL Alert`
* `Script Monitor New Code Change Detection Alert`
* `Script Monitor New Domain Alert`
* `Script Monitor New Malicious Domain Alert`
* `Script Monitor New Malicious Script Alert`
* `Script Monitor New Malicious URL Alert`
* `Script Monitor New Scripts Alert`
* `Script Monitor New Script Exceeds Max URL Length Alert`
* `Advanced Security Events Alert`
* `Security Events Alert`
* [ ] Ελέγξτε όλους τους **προορισμούς**, καθώς μπορεί να υπάρχουν **ευαίσθητες πληροφορίες** (basic http auth) σε webhook urls. Βεβαιωθείτε επίσης ότι οι webhook urls χρησιμοποιούν **HTTPS**.
* [ ] Ως επιπλέον έλεγχος, μπορείτε να προσπαθήσετε να **παριστάνετε μια ειδοποίηση cloudflare** σε τρίτο μέρος, ίσως μπορείτε κάπως να **εισάγετε κάτι επικίνδυνο**.

## Manage Account

* [ ] Είναι δυνατόν να δείτε τα **τελευταία 4 ψηφία της πιστωτικής κάρτας**, τον **χρόνο λήξης** και τη **διεύθυνση χρέωσης** στο **`Billing` -> `Payment info`**.
* [ ] Είναι δυνατόν να δείτε τον **τύπο σχεδίου** που χρησιμοποιείται στον λογαριασμό στο **`Billing` -> `Subscriptions`**.
* [ ] Στο **`Members`** είναι δυνατόν να δείτε όλα τα μέλη του λογαριασμού και τον **ρόλο** τους. Σημειώστε ότι αν ο τύπος σχεδίου δεν είναι Enterprise, υπάρχουν μόνο 2 ρόλοι: Διαχειριστής και Υπερδιαχειριστής. Αλλά αν το χρησιμοποιούμενο **σχέδιο είναι Enterprise**, [**περισσότεροι ρόλοι**](https://developers.cloudflare.com/fundamentals/account-and-billing/account-setup/account-roles/) μπορούν να χρησιμοποιηθούν για να ακολουθήσουν την αρχή της ελάχιστης προνομίας.
* Επομένως, όποτε είναι δυνατόν, συνιστάται να χρησιμοποιείτε το **Enterprise plan**.
* [ ] Στα μέλη είναι δυνατόν να ελέγξετε ποια **μέλη** έχουν **2FA ενεργοποιημένο**. **Κάθε** χρήστης θα πρέπει να το έχει ενεργοποιημένο.

{% hint style="info" %}
Σημειώστε ότι ευτυχώς ο ρόλος **`Administrator`** δεν δίνει δικαιώματα για τη διαχείριση μελών (**δεν μπορεί να αναβαθμίσει προνόμια ή να προσκαλέσει** νέα μέλη).
{% endhint %}

## DDoS Investigation

[Ελέγξτε αυτό το μέρος](cloudflare-domains.md#cloudflare-ddos-protection).

{% hint style="success" %}
Μάθετε & εξασκηθείτε στο AWS Hacking:<img src="../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">\
Μάθετε & εξασκηθείτε στο GCP Hacking: <img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Ελέγξτε τα [**σχέδια συνδρομής**](https://github.com/sponsors/carlospolop)!
* **Εγγραφείτε στην** 💬 [**ομάδα Discord**](https://discord.gg/hRep4RUj7f) ή στην [**ομάδα telegram**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Μοιραστείτε κόλπα hacking υποβάλλοντας PRs στα** [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
