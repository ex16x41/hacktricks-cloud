# Cloudflare Security

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* SprawdÅº [**plany subskrypcji**](https://github.com/sponsors/carlospolop)!
* **DoÅ‚Ä…cz do** ğŸ’¬ [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegram**](https://t.me/peass) lub **Å›ledÅº** nas na **Twitterze** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podziel siÄ™ trikami hakerskimi, przesyÅ‚ajÄ…c PR do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repozytoriÃ³w na githubie.

</details>
{% endhint %}

W koncie Cloudflare istniejÄ… pewne **ogÃ³lne ustawienia i usÅ‚ugi**, ktÃ³re moÅ¼na skonfigurowaÄ‡. Na tej stronie bÄ™dziemy **analizowaÄ‡ ustawienia zwiÄ…zane z bezpieczeÅ„stwem w kaÅ¼dej sekcji:**

<figure><img src="../../.gitbook/assets/image (117).png" alt=""><figcaption></figcaption></figure>

## Websites

Przejrzyj kaÅ¼dy z:

{% content-ref url="cloudflare-domains.md" %}
[cloudflare-domains.md](cloudflare-domains.md)
{% endcontent-ref %}

### Domain Registration

* [ ] W **`Transfer Domains`** sprawdÅº, czy nie jest moÅ¼liwe przeniesienie Å¼adnej domeny.

Przejrzyj kaÅ¼dy z:

{% content-ref url="cloudflare-domains.md" %}
[cloudflare-domains.md](cloudflare-domains.md)
{% endcontent-ref %}

## Analytics

_Nie znalazÅ‚em niczego do sprawdzenia pod kÄ…tem przeglÄ…du bezpieczeÅ„stwa konfiguracji._

## Pages

Na kaÅ¼dej stronie Cloudflare:

* [ ] SprawdÅº **wraÅ¼liwe informacje** w **`Build log`**.
* [ ] SprawdÅº **wraÅ¼liwe informacje** w **repozytorium Github** przypisanym do stron.
* [ ] SprawdÅº potencjalne przejÄ™cie repozytorium github poprzez **workflow command injection** lub kompromitacjÄ™ `pull_request_target`. WiÄ™cej informacji na [**stronie bezpieczeÅ„stwa Github**](../github-security/).
* [ ] SprawdÅº **podatne funkcje** w katalogu `/fuctions` (jeÅ›li istniejÄ…), sprawdÅº **przekierowania** w pliku `_redirects` (jeÅ›li istniejÄ…) i **nieprawidÅ‚owo skonfigurowane nagÅ‚Ã³wki** w pliku `_headers` (jeÅ›li istniejÄ…).
* [ ] SprawdÅº **podatnoÅ›ci** na **stronie internetowej** poprzez **blackbox** lub **whitebox**, jeÅ›li masz **dostÄ™p do kodu**.
* [ ] W szczegÃ³Å‚ach kaÅ¼dej strony `/<page_id>/pages/view/blocklist/settings/functions`. SprawdÅº **wraÅ¼liwe informacje** w **`Environment variables`**.
* [ ] W szczegÃ³Å‚ach strony sprawdÅº rÃ³wnieÅ¼ **komendÄ™ build** i **katalog gÅ‚Ã³wny** pod kÄ…tem **potencjalnych wstrzykniÄ™Ä‡** w celu przejÄ™cia strony.

## **Workers**

Na kaÅ¼dym workerze Cloudflare sprawdÅº:

* [ ] Triggery: Co powoduje uruchomienie workera? Czy **uÅ¼ytkownik moÅ¼e wysÅ‚aÄ‡ dane**, ktÃ³re bÄ™dÄ… **uÅ¼ywane** przez workera?
* [ ] W **`Settings`**, sprawdÅº **`Variables`** zawierajÄ…ce **wraÅ¼liwe informacje**
* [ ] SprawdÅº **kod workera** i poszukaj **podatnoÅ›ci** (szczegÃ³lnie w miejscach, gdzie uÅ¼ytkownik moÅ¼e zarzÄ…dzaÄ‡ wejÅ›ciem)
* SprawdÅº SSRFs zwracajÄ…ce wskazanÄ… stronÄ™, ktÃ³rÄ… moÅ¼esz kontrolowaÄ‡
* SprawdÅº XSSs wykonujÄ…ce JS wewnÄ…trz obrazu svg
* MoÅ¼liwe, Å¼e worker wspÃ³Å‚pracuje z innymi wewnÄ™trznymi usÅ‚ugami. Na przykÅ‚ad, worker moÅ¼e wspÃ³Å‚pracowaÄ‡ z R2 bucket, przechowujÄ…c w nim informacje uzyskane z wejÅ›cia. W takim przypadku konieczne bÄ™dzie sprawdzenie, jakie moÅ¼liwoÅ›ci ma worker w stosunku do R2 bucket i jak moÅ¼na je wykorzystaÄ‡ z wejÅ›cia uÅ¼ytkownika.

{% hint style="warning" %}
ZauwaÅ¼, Å¼e domyÅ›lnie **Worker otrzymuje URL** taki jak `<worker-name>.<account>.workers.dev`. UÅ¼ytkownik moÅ¼e ustawiÄ‡ go na **subdomenÄ™**, ale zawsze moÅ¼esz uzyskaÄ‡ do niego dostÄ™p za pomocÄ… tego **oryginalnego URL**, jeÅ›li go znasz.
{% endhint %}

## R2

Na kaÅ¼dym R2 bucket sprawdÅº:

* [ ] Skonfiguruj **CORS Policy**.

## Stream

TODO

## Images

TODO

## Security Center

* [ ] JeÅ›li to moÅ¼liwe, uruchom **`Security Insights`** **scan** i **`Infrastructure`** **scan**, poniewaÅ¼ **podkreÅ›lÄ…** one interesujÄ…ce informacje **zwiÄ…zane z bezpieczeÅ„stwem**.
* [ ] Po prostu **sprawdÅº te informacje** pod kÄ…tem nieprawidÅ‚owych konfiguracji bezpieczeÅ„stwa i interesujÄ…cych informacji

## Turnstile

TODO

## **Zero Trust**

{% content-ref url="cloudflare-zero-trust-network.md" %}
[cloudflare-zero-trust-network.md](cloudflare-zero-trust-network.md)
{% endcontent-ref %}

## Bulk Redirects

{% hint style="info" %}
W przeciwieÅ„stwie do [Dynamic Redirects](https://developers.cloudflare.com/rules/url-forwarding/dynamic-redirects/), [**Bulk Redirects**](https://developers.cloudflare.com/rules/url-forwarding/bulk-redirects/) sÄ… zasadniczo statyczne â€” nie obsÅ‚ugujÄ… **Å¼adnych operacji zamiany ciÄ…gÃ³w** ani wyraÅ¼eÅ„ regularnych. MoÅ¼esz jednak skonfigurowaÄ‡ parametry przekierowania URL, ktÃ³re wpÅ‚ywajÄ… na ich zachowanie podczas dopasowywania URL i ich zachowanie w czasie wykonywania.
{% endhint %}

* [ ] SprawdÅº, czy **wyraÅ¼enia** i **wymagania** dotyczÄ…ce przekierowaÅ„ **majÄ… sens**.
* [ ] SprawdÅº rÃ³wnieÅ¼ **wraÅ¼liwe ukryte punkty koÅ„cowe**, ktÃ³re zawierajÄ… interesujÄ…ce informacje.

## Notifications

* [ ] SprawdÅº **powiadomienia**. Te powiadomienia sÄ… zalecane dla bezpieczeÅ„stwa:
* `Usage Based Billing`
* `HTTP DDoS Attack Alert`
* `Layer 3/4 DDoS Attack Alert`
* `Advanced HTTP DDoS Attack Alert`
* `Advanced Layer 3/4 DDoS Attack Alert`
* `Flow-based Monitoring: Volumetric Attack`
* `Route Leak Detection Alert`
* `Access mTLS Certificate Expiration Alert`
* `SSL for SaaS Custom Hostnames Alert`
* `Universal SSL Alert`
* `Script Monitor New Code Change Detection Alert`
* `Script Monitor New Domain Alert`
* `Script Monitor New Malicious Domain Alert`
* `Script Monitor New Malicious Script Alert`
* `Script Monitor New Malicious URL Alert`
* `Script Monitor New Scripts Alert`
* `Script Monitor New Script Exceeds Max URL Length Alert`
* `Advanced Security Events Alert`
* `Security Events Alert`
* [ ] SprawdÅº wszystkie **destynacje**, poniewaÅ¼ mogÄ… tam byÄ‡ **wraÅ¼liwe informacje** (podstawowe uwierzytelnianie http) w URL webhookÃ³w. Upewnij siÄ™ rÃ³wnieÅ¼, Å¼e URL webhookÃ³w uÅ¼ywajÄ… **HTTPS**
* [ ] Jako dodatkowe sprawdzenie, moÅ¼esz sprÃ³bowaÄ‡ **podszyÄ‡ siÄ™ pod powiadomienie cloudflare** do strony trzeciej, moÅ¼e uda ci siÄ™ jakoÅ› **wstrzyknÄ…Ä‡ coÅ› niebezpiecznego**

## Manage Account

* [ ] MoÅ¼na zobaczyÄ‡ **ostatnie 4 cyfry karty kredytowej**, **czas wygaÅ›niÄ™cia** i **adres rozliczeniowy** w **`Billing` -> `Payment info`**.
* [ ] MoÅ¼na zobaczyÄ‡ **typ planu** uÅ¼ywany na koncie w **`Billing` -> `Subscriptions`**.
* [ ] W **`Members`** moÅ¼na zobaczyÄ‡ wszystkich czÅ‚onkÃ³w konta i ich **rolÄ™**. ZauwaÅ¼, Å¼e jeÅ›li typ planu nie jest Enterprise, istniejÄ… tylko 2 role: Administrator i Super Administrator. Ale jeÅ›li uÅ¼ywany **plan to Enterprise**, [**wiÄ™cej rÃ³l**](https://developers.cloudflare.com/fundamentals/account-and-billing/account-setup/account-roles/) moÅ¼e byÄ‡ uÅ¼ywanych zgodnie z zasadÄ… najmniejszych uprawnieÅ„.
* Dlatego, jeÅ›li to moÅ¼liwe, **zaleca siÄ™** uÅ¼ywanie **planu Enterprise**.
* [ ] W Members moÅ¼na sprawdziÄ‡, ktÃ³rzy **czÅ‚onkowie** majÄ… **wÅ‚Ä…czone 2FA**. **KaÅ¼dy** uÅ¼ytkownik powinien mieÄ‡ to wÅ‚Ä…czone.

{% hint style="info" %}
ZauwaÅ¼, Å¼e na szczÄ™Å›cie rola **`Administrator`** nie daje uprawnieÅ„ do zarzÄ…dzania czÅ‚onkostwami (**nie moÅ¼e eskalowaÄ‡ uprawnieÅ„ ani zapraszaÄ‡** nowych czÅ‚onkÃ³w)
{% endhint %}

## DDoS Investigation

[SprawdÅº tÄ™ czÄ™Å›Ä‡](cloudflare-domains.md#cloudflare-ddos-protection).

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* SprawdÅº [**plany subskrypcji**](https://github.com/sponsors/carlospolop)!
* **DoÅ‚Ä…cz do** ğŸ’¬ [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegram**](https://t.me/peass) lub **Å›ledÅº** nas na **Twitterze** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podziel siÄ™ trikami hakerskimi, przesyÅ‚ajÄ…c PR do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repozytoriÃ³w na githubie.

</details>
{% endhint %}
