# Cloudflare Security

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** 💬 [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

Cloudflareアカウントには、設定できるいくつかの**一般設定とサービス**があります。このページでは、各セクションの**セキュリティ関連設定を分析**します：

<figure><img src="../../.gitbook/assets/image (117).png" alt=""><figcaption></figcaption></figure>

## Websites

各項目を確認してください：

{% content-ref url="cloudflare-domains.md" %}
[cloudflare-domains.md](cloudflare-domains.md)
{% endcontent-ref %}

### Domain Registration

* [ ] **`Transfer Domains`**で、ドメインを転送できないことを確認します。

各項目を確認してください：

{% content-ref url="cloudflare-domains.md" %}
[cloudflare-domains.md](cloudflare-domains.md)
{% endcontent-ref %}

## Analytics

_設定のセキュリティレビューのために確認できるものは見つかりませんでした。_

## Pages

各Cloudflareのページで：

* [ ] **`Build log`**に**機密情報**がないか確認します。
* [ ] ページに割り当てられた**Githubリポジトリ**に**機密情報**がないか確認します。
* [ ] **workflow command injection**や`pull_request_target`の侵害による潜在的なgithubリポジトリの侵害を確認します。詳細は[**Github Security page**](../github-security/)を参照してください。
* [ ] `/fuctions`ディレクトリ内の**脆弱な関数**を確認し（あれば）、`_redirects`ファイル内の**リダイレクト**（あれば）と`_headers`ファイル内の**誤設定されたヘッダー**（あれば）を確認します。
* [ ] **コードにアクセスできる**場合、**blackbox**または**whitebox**を通じて**ウェブページ**の**脆弱性**を確認します。
* [ ] 各ページの詳細`/<page_id>/pages/view/blocklist/settings/functions`で、**`Environment variables`**に**機密情報**がないか確認します。
* [ ] 詳細ページで**ビルドコマンド**と**ルートディレクトリ**を確認し、ページを侵害するための**潜在的なインジェクション**がないか確認します。

## **Workers**

各Cloudflareのワーカーで確認します：

* [ ] トリガー：ワーカーをトリガーするのは何ですか？**ユーザーがデータを送信**でき、それがワーカーによって**使用される**可能性はありますか？
* [ ] **`Settings`**で、**機密情報**を含む**`Variables`**を確認します。
* [ ] **ワーカーのコード**を確認し、**脆弱性**を探します（特にユーザーが入力を管理できる場所で）。
* 指定されたページを返すSSRFを確認します。
* svg画像内でJSを実行するXSSを確認します。
* ワーカーが他の内部サービスと相互作用する可能性があります。たとえば、ワーカーは入力から取得した情報を格納するR2バケットと相互作用する場合があります。その場合、ワーカーがR2バケットに対してどのような権限を持ち、ユーザー入力からどのように悪用される可能性があるかを確認する必要があります。

{% hint style="warning" %}
デフォルトでは、**ワーカーにはURL**が与えられます。例：`<worker-name>.<account>.workers.dev`。ユーザーは**サブドメイン**に設定できますが、知っていればその**元のURL**で常にアクセスできます。
{% endhint %}

## R2

各R2バケットで確認します：

* [ ] **CORSポリシー**を設定します。

## Stream

TODO

## Images

TODO

## Security Center

* [ ] 可能であれば、**`Security Insights`**スキャンと**`Infrastructure`**スキャンを実行してください。これにより、**セキュリティ**に関する興味深い情報が**強調表示**されます。
* [ ] セキュリティの誤設定や興味深い情報について、**この情報**を確認してください。

## Turnstile

TODO

## **Zero Trust**

{% content-ref url="cloudflare-zero-trust-network.md" %}
[cloudflare-zero-trust-network.md](cloudflare-zero-trust-network.md)
{% endcontent-ref %}

## Bulk Redirects

{% hint style="info" %}
[Dynamic Redirects](https://developers.cloudflare.com/rules/url-forwarding/dynamic-redirects/)とは異なり、[**Bulk Redirects**](https://developers.cloudflare.com/rules/url-forwarding/bulk-redirects/)は本質的に静的です — 文字列置換操作や正規表現をサポートしていません。ただし、URLの一致動作や実行時動作に影響を与えるURLリダイレクトパラメータを設定できます。
{% endhint %}

* [ ] **リダイレクトのための**表現と**要件**が**意味をなす**ことを確認します。
* [ ] **興味深い情報**を含む**機密の隠れたエンドポイント**も確認します。

## Notifications

* [ ] **通知**を確認します。これらの通知はセキュリティのために推奨されます：
* `Usage Based Billing`
* `HTTP DDoS Attack Alert`
* `Layer 3/4 DDoS Attack Alert`
* `Advanced HTTP DDoS Attack Alert`
* `Advanced Layer 3/4 DDoS Attack Alert`
* `Flow-based Monitoring: Volumetric Attack`
* `Route Leak Detection Alert`
* `Access mTLS Certificate Expiration Alert`
* `SSL for SaaS Custom Hostnames Alert`
* `Universal SSL Alert`
* `Script Monitor New Code Change Detection Alert`
* `Script Monitor New Domain Alert`
* `Script Monitor New Malicious Domain Alert`
* `Script Monitor New Malicious Script Alert`
* `Script Monitor New Malicious URL Alert`
* `Script Monitor New Scripts Alert`
* `Script Monitor New Script Exceeds Max URL Length Alert`
* `Advanced Security Events Alert`
* `Security Events Alert`
* [ ] すべての**宛先**を確認します。Webhook URLに**機密情報**（基本的なhttp認証）が含まれている可能性があります。また、Webhook URLが**HTTPS**を使用していることを確認してください。
* [ ] 追加の確認として、**Cloudflare通知を第三者に偽装**してみることができます。もしかしたら、何か危険なものを**注入**できるかもしれません。

## Manage Account

* [ ] **`Billing` -> `Payment info`**で、**クレジットカードの最後の4桁**、**有効期限**、および**請求先住所**を見ることができます。
* [ ] **`Billing` -> `Subscriptions`**で、アカウントで使用されている**プランタイプ**を見ることができます。
* [ ] **`Members`**で、アカウントのすべてのメンバーとその**役割**を見ることができます。プランタイプがEnterpriseでない場合、2つの役割（AdministratorとSuper Administrator）しか存在しません。しかし、使用されている**プランがEnterprise**の場合、[**より多くの役割**](https://developers.cloudflare.com/fundamentals/account-and-billing/account-setup/account-roles/)が使用でき、最小権限の原則に従うことができます。
* したがって、可能な限り**Enterpriseプラン**を使用することが**推奨**されます。
* [ ] メンバーで**2FAが有効**になっている**メンバー**を確認できます。**すべての**ユーザーは有効にするべきです。

{% hint style="info" %}
幸いなことに、役割**`Administrator`**はメンバーシップを管理する権限を与えません（**権限を昇格させたり、新しいメンバーを招待したりできません**）。
{% endhint %}

## DDoS Investigation

[この部分を確認してください](cloudflare-domains.md#cloudflare-ddos-protection)。

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** 💬 [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
