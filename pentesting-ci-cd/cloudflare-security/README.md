# Cloudflare Security

{% hint style="success" %}
Ucz siÄ™ i Ä‡wicz Hacking AWS:<img src="../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Ucz siÄ™ i Ä‡wicz Hacking GCP: <img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Wsparcie HackTricks</summary>

* SprawdÅº [**plany subskrypcyjne**](https://github.com/sponsors/carlospolop)!
* **DoÅ‚Ä…cz do** ğŸ’¬ [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegram**](https://t.me/peass) lub **Å›ledÅº** nas na **Twitterze** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podziel siÄ™ sztuczkami hackingowymi, przesyÅ‚ajÄ…c PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repozytoriÃ³w github.

</details>
{% endhint %}

W koncie Cloudflare znajdujÄ… siÄ™ **ogÃ³lne ustawienia i usÅ‚ugi**, ktÃ³re moÅ¼na skonfigurowaÄ‡. Na tej stronie zamierzamy **analizowaÄ‡ ustawienia zwiÄ…zane z bezpieczeÅ„stwem w kaÅ¼dej sekcji:**

<figure><img src="../../.gitbook/assets/image (117).png" alt=""><figcaption></figcaption></figure>

## Strony internetowe

Przejrzyj kaÅ¼dÄ… z:

{% content-ref url="cloudflare-domains.md" %}
[cloudflare-domains.md](cloudflare-domains.md)
{% endcontent-ref %}

### Rejestracja domeny

* [ ] W **`Transfer Domains`** sprawdÅº, czy nie moÅ¼na przenieÅ›Ä‡ Å¼adnej domeny.

Przejrzyj kaÅ¼dÄ… z:

{% content-ref url="cloudflare-domains.md" %}
[cloudflare-domains.md](cloudflare-domains.md)
{% endcontent-ref %}

## Analiza

_Nie mogÅ‚em znaleÅºÄ‡ nic do sprawdzenia w przeglÄ…dzie bezpieczeÅ„stwa konfiguracji._

## Strony

Na kaÅ¼dej stronie Cloudflare:

* [ ] SprawdÅº **wraÅ¼liwe informacje** w **`Build log`**.
* [ ] SprawdÅº **wraÅ¼liwe informacje** w **repozytorium Github** przypisanym do stron.
* [ ] SprawdÅº potencjalne naruszenie repozytorium github za pomocÄ… **wstrzykiwania poleceÅ„ workflow** lub kompromitacji `pull_request_target`. WiÄ™cej informacji na stronie [**Github Security**](../github-security/).
* [ ] SprawdÅº **vulnerable functions** w katalogu `/fuctions` (jeÅ›li istnieje), sprawdÅº **przekierowania** w pliku `_redirects` (jeÅ›li istnieje) oraz **bÅ‚Ä™dnie skonfigurowane nagÅ‚Ã³wki** w pliku `_headers` (jeÅ›li istnieje).
* [ ] SprawdÅº **vulnerabilities** w **stronie internetowej** za pomocÄ… **blackbox** lub **whitebox**, jeÅ›li moÅ¼esz **uzyskaÄ‡ dostÄ™p do kodu**.
* [ ] W szczegÃ³Å‚ach kaÅ¼dej strony `/<page_id>/pages/view/blocklist/settings/functions`. SprawdÅº **wraÅ¼liwe informacje** w **`Environment variables`**.
* [ ] W szczegÃ³Å‚ach strony sprawdÅº rÃ³wnieÅ¼ **komendÄ™ budowania** i **katalog gÅ‚Ã³wny** pod kÄ…tem **potencjalnych wstrzykniÄ™Ä‡**, ktÃ³re mogÄ… skompromitowaÄ‡ stronÄ™.

## **Workers**

Na kaÅ¼dym workerze Cloudflare sprawdÅº:

* [ ] Wyzwalacze: Co powoduje wyzwolenie workera? Czy **uÅ¼ytkownik moÅ¼e wysÅ‚aÄ‡ dane**, ktÃ³re bÄ™dÄ… **uÅ¼ywane** przez workera?
* [ ] W **`Settings`**, sprawdÅº **`Variables`** zawierajÄ…ce **wraÅ¼liwe informacje**.
* [ ] SprawdÅº **kod workera** i poszukaj **vulnerabilities** (szczegÃ³lnie w miejscach, gdzie uÅ¼ytkownik moÅ¼e zarzÄ…dzaÄ‡ danymi wejÅ›ciowymi).
* SprawdÅº SSRFs zwracajÄ…cych wskazanÄ… stronÄ™, ktÃ³rÄ… moÅ¼esz kontrolowaÄ‡.
* SprawdÅº XSSy wykonujÄ…ce JS wewnÄ…trz obrazu svg.
* MoÅ¼liwe, Å¼e worker wchodzi w interakcjÄ™ z innymi wewnÄ™trznymi usÅ‚ugami. Na przykÅ‚ad, worker moÅ¼e wchodziÄ‡ w interakcjÄ™ z bucketem R2 przechowujÄ…cym informacje uzyskane z danych wejÅ›ciowych. W takim przypadku konieczne byÅ‚oby sprawdzenie, jakie moÅ¼liwoÅ›ci ma worker nad bucketem R2 i jak moÅ¼na je wykorzystaÄ‡ z danych wejÅ›ciowych uÅ¼ytkownika.

{% hint style="warning" %}
ZauwaÅ¼, Å¼e domyÅ›lnie **Worker ma przypisany URL** taki jak `<worker-name>.<account>.workers.dev`. UÅ¼ytkownik moÅ¼e ustawiÄ‡ go na **subdomenÄ™**, ale zawsze moÅ¼esz uzyskaÄ‡ do niego dostÄ™p za pomocÄ… tego **oryginalnego URL**, jeÅ›li go znasz.
{% endhint %}

## R2

Na kaÅ¼dym buckecie R2 sprawdÅº:

* [ ] Skonfiguruj **CORS Policy**.

## Stream

TODO

## Obrazy

TODO

## Centrum bezpieczeÅ„stwa

* [ ] JeÅ›li to moÅ¼liwe, uruchom skanowanie **`Security Insights`** i skanowanie **`Infrastructure`**, poniewaÅ¼ bÄ™dÄ… **podkreÅ›laÄ‡** interesujÄ…ce informacje **z punktu widzenia bezpieczeÅ„stwa**.
* [ ] Po prostu **sprawdÅº te informacje** pod kÄ…tem bÅ‚Ä™dnych konfiguracji bezpieczeÅ„stwa i interesujÄ…cych informacji.

## Turnstile

TODO

## **Zero Trust**

{% content-ref url="cloudflare-zero-trust-network.md" %}
[cloudflare-zero-trust-network.md](cloudflare-zero-trust-network.md)
{% endcontent-ref %}

## Masowe przekierowania

{% hint style="info" %}
W przeciwieÅ„stwie do [Dynamicznych PrzekierowaÅ„](https://developers.cloudflare.com/rules/url-forwarding/dynamic-redirects/), [**Masowe Przekierowania**](https://developers.cloudflare.com/rules/url-forwarding/bulk-redirects/) sÄ… zasadniczo statyczne â€” nie obsÅ‚ugujÄ… Å¼adnych operacji zastÄ™powania ciÄ…gÃ³w ani wyraÅ¼eÅ„ regularnych. MoÅ¼esz jednak skonfigurowaÄ‡ parametry przekierowania URL, ktÃ³re wpÅ‚ywajÄ… na ich zachowanie w zakresie dopasowywania URL i ich zachowanie w czasie wykonywania.
{% endhint %}

* [ ] SprawdÅº, czy **wyraÅ¼enia** i **wymagania** dla przekierowaÅ„ **majÄ… sens**.
* [ ] SprawdÅº rÃ³wnieÅ¼ **wraÅ¼liwe ukryte punkty koÅ„cowe**, ktÃ³re zawierajÄ… interesujÄ…ce informacje.

## Powiadomienia

* [ ] SprawdÅº **powiadomienia**. Te powiadomienia sÄ… zalecane dla bezpieczeÅ„stwa:
* `Usage Based Billing`
* `HTTP DDoS Attack Alert`
* `Layer 3/4 DDoS Attack Alert`
* `Advanced HTTP DDoS Attack Alert`
* `Advanced Layer 3/4 DDoS Attack Alert`
* `Flow-based Monitoring: Volumetric Attack`
* `Route Leak Detection Alert`
* `Access mTLS Certificate Expiration Alert`
* `SSL for SaaS Custom Hostnames Alert`
* `Universal SSL Alert`
* `Script Monitor New Code Change Detection Alert`
* `Script Monitor New Domain Alert`
* `Script Monitor New Malicious Domain Alert`
* `Script Monitor New Malicious Script Alert`
* `Script Monitor New Malicious URL Alert`
* `Script Monitor New Scripts Alert`
* `Script Monitor New Script Exceeds Max URL Length Alert`
* `Advanced Security Events Alert`
* `Security Events Alert`
* [ ] SprawdÅº wszystkie **destynacje**, poniewaÅ¼ mogÄ… zawieraÄ‡ **wraÅ¼liwe informacje** (podstawowa autoryzacja http) w adresach URL webhookÃ³w. Upewnij siÄ™ rÃ³wnieÅ¼, Å¼e adresy URL webhookÃ³w uÅ¼ywajÄ… **HTTPS**.
* [ ] Jako dodatkowe sprawdzenie, moÅ¼esz sprÃ³bowaÄ‡ **podszyÄ‡ siÄ™ pod powiadomienie cloudflare** do osoby trzeciej, moÅ¼e w jakiÅ› sposÃ³b **wstrzykniesz coÅ› niebezpiecznego**.

## ZarzÄ…dzaj kontem

* [ ] MoÅ¼liwe jest zobaczenie **ostatnich 4 cyfr karty kredytowej**, **daty waÅ¼noÅ›ci** i **adresu rozliczeniowego** w **`Billing` -> `Payment info`**.
* [ ] MoÅ¼liwe jest zobaczenie **rodzaju planu** uÅ¼ywanego w koncie w **`Billing` -> `Subscriptions`**.
* [ ] W **`Members`** moÅ¼na zobaczyÄ‡ wszystkich czÅ‚onkÃ³w konta i ich **rolÄ™**. ZauwaÅ¼, Å¼e jeÅ›li rodzaj planu nie jest Enterprise, istniejÄ… tylko 2 role: Administrator i Super Administrator. Ale jeÅ›li uÅ¼ywany **plan to Enterprise**, [**wiÄ™cej rÃ³l**](https://developers.cloudflare.com/fundamentals/account-and-billing/account-setup/account-roles/) moÅ¼e byÄ‡ uÅ¼ywanych w celu przestrzegania zasady najmniejszych uprawnieÅ„.
* Dlatego, gdy tylko to moÅ¼liwe, **zaleca siÄ™** korzystanie z **planu Enterprise**.
* [ ] W czÅ‚onkach moÅ¼na sprawdziÄ‡, ktÃ³rzy **czÅ‚onkowie** majÄ… **wÅ‚Ä…czonÄ… 2FA**. **KaÅ¼dy** uÅ¼ytkownik powinien to mieÄ‡ wÅ‚Ä…czone.

{% hint style="info" %}
ZauwaÅ¼, Å¼e na szczÄ™Å›cie rola **`Administrator`** nie daje uprawnieÅ„ do zarzÄ…dzania czÅ‚onkostwem (**nie moÅ¼e podnieÅ›Ä‡ uprawnieÅ„ ani zapraszaÄ‡** nowych czÅ‚onkÃ³w).
{% endhint %}

## Dochodzenie w sprawie DDoS

[SprawdÅº tÄ™ czÄ™Å›Ä‡](cloudflare-domains.md#cloudflare-ddos-protection).

{% hint style="success" %}
Ucz siÄ™ i Ä‡wicz Hacking AWS:<img src="../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Ucz siÄ™ i Ä‡wicz Hacking GCP: <img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Wsparcie HackTricks</summary>

* SprawdÅº [**plany subskrypcyjne**](https://github.com/sponsors/carlospolop)!
* **DoÅ‚Ä…cz do** ğŸ’¬ [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegram**](https://t.me/peass) lub **Å›ledÅº** nas na **Twitterze** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podziel siÄ™ sztuczkami hackingowymi, przesyÅ‚ajÄ…c PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repozytoriÃ³w github.

</details>
{% endhint %}
