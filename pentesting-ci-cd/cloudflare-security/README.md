# Cloudflare Security

{% hint style="success" %}
å­¦ä¹ å’Œå®è·µ AWS é»‘å®¢æŠ€æœ¯ï¼š<img src="../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks åŸ¹è®­ AWS çº¢é˜Ÿä¸“å®¶ (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/image (1).png" alt="" data-size="line">\
å­¦ä¹ å’Œå®è·µ GCP é»‘å®¢æŠ€æœ¯ï¼š<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks åŸ¹è®­ GCP çº¢é˜Ÿä¸“å®¶ (GRTE)**<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>æ”¯æŒ HackTricks</summary>

* æŸ¥çœ‹ [**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**ç”µæŠ¥ç¾¤ç»„**](https://t.me/peass) æˆ– **å…³æ³¨** æˆ‘ä»¬çš„ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ä»“åº“æäº¤ PR åˆ†äº«é»‘å®¢æŠ€å·§ã€‚

</details>
{% endhint %}

åœ¨ Cloudflare è´¦æˆ·ä¸­ï¼Œæœ‰ä¸€äº› **å¸¸è§„è®¾ç½®å’ŒæœåŠ¡** å¯ä»¥è¿›è¡Œé…ç½®ã€‚åœ¨æ­¤é¡µé¢ä¸­ï¼Œæˆ‘ä»¬å°† **åˆ†ææ¯ä¸ªéƒ¨åˆ†çš„å®‰å…¨ç›¸å…³è®¾ç½®ï¼š**

<figure><img src="../../.gitbook/assets/image (117).png" alt=""><figcaption></figcaption></figure>

## ç½‘ç«™

é€ä¸€æ£€æŸ¥ï¼š

{% content-ref url="cloudflare-domains.md" %}
[cloudflare-domains.md](cloudflare-domains.md)
{% endcontent-ref %}

### åŸŸåæ³¨å†Œ

* [ ] åœ¨ **`è½¬ç§»åŸŸå`** ä¸­æ£€æŸ¥æ˜¯å¦æ— æ³•è½¬ç§»ä»»ä½•åŸŸåã€‚

é€ä¸€æ£€æŸ¥ï¼š

{% content-ref url="cloudflare-domains.md" %}
[cloudflare-domains.md](cloudflare-domains.md)
{% endcontent-ref %}

## åˆ†æ

_æˆ‘æ‰¾ä¸åˆ°ä»»ä½•å¯ä»¥æ£€æŸ¥é…ç½®å®‰å…¨å®¡æŸ¥çš„å†…å®¹ã€‚_

## é¡µé¢

åœ¨æ¯ä¸ª Cloudflare é¡µé¢ä¸Šï¼š

* [ ] æ£€æŸ¥ **`æ„å»ºæ—¥å¿—`** ä¸­çš„ **æ•æ„Ÿä¿¡æ¯**ã€‚
* [ ] æ£€æŸ¥åˆ†é…ç»™é¡µé¢çš„ **Github ä»“åº“** ä¸­çš„ **æ•æ„Ÿä¿¡æ¯**ã€‚
* [ ] æ£€æŸ¥é€šè¿‡ **å·¥ä½œæµå‘½ä»¤æ³¨å…¥** æˆ– `pull_request_target` å¯èƒ½å¯¼è‡´çš„ GitHub ä»“åº“æ³„éœ²ã€‚æ›´å¤šä¿¡æ¯è¯·å‚è§ [**Github å®‰å…¨é¡µé¢**](../github-security/)ã€‚
* [ ] æ£€æŸ¥ `/fuctions` ç›®å½•ä¸­çš„ **è„†å¼±å‡½æ•°**ï¼ˆå¦‚æœæœ‰ï¼‰ï¼Œæ£€æŸ¥ `_redirects` æ–‡ä»¶ä¸­çš„ **é‡å®šå‘**ï¼ˆå¦‚æœæœ‰ï¼‰å’Œ `_headers` æ–‡ä»¶ä¸­çš„ **é”™è¯¯é…ç½®çš„å¤´éƒ¨**ï¼ˆå¦‚æœæœ‰ï¼‰ã€‚
* [ ] é€šè¿‡ **é»‘ç®±** æˆ– **ç™½ç®±** æ£€æŸ¥ **ç½‘é¡µ** ä¸­çš„ **æ¼æ´**ï¼Œå¦‚æœæ‚¨å¯ä»¥ **è®¿é—®ä»£ç **ã€‚
* [ ] åœ¨æ¯ä¸ªé¡µé¢çš„è¯¦ç»†ä¿¡æ¯ `/<page_id>/pages/view/blocklist/settings/functions` ä¸­æ£€æŸ¥ **ç¯å¢ƒå˜é‡** ä¸­çš„ **æ•æ„Ÿä¿¡æ¯**ã€‚
* [ ] åœ¨è¯¦ç»†ä¿¡æ¯é¡µé¢ä¸­ï¼Œè¿˜è¦æ£€æŸ¥ **æ„å»ºå‘½ä»¤** å’Œ **æ ¹ç›®å½•** ä»¥æŸ¥æ‰¾ **æ½œåœ¨æ³¨å…¥** ä»¥å±å®³é¡µé¢ã€‚

## **Workers**

åœ¨æ¯ä¸ª Cloudflare çš„ worker ä¸Šæ£€æŸ¥ï¼š

* [ ] è§¦å‘å™¨ï¼šæ˜¯ä»€ä¹ˆä½¿ worker è§¦å‘ï¼Ÿç”¨æˆ·æ˜¯å¦å¯ä»¥å‘é€å°†è¢« worker **ä½¿ç”¨** çš„æ•°æ®ï¼Ÿ
* [ ] åœ¨ **`è®¾ç½®`** ä¸­ï¼Œæ£€æŸ¥åŒ…å« **æ•æ„Ÿä¿¡æ¯** çš„ **`å˜é‡`**ã€‚
* [ ] æ£€æŸ¥ **worker çš„ä»£ç ** å¹¶æœç´¢ **æ¼æ´**ï¼ˆç‰¹åˆ«æ˜¯åœ¨ç”¨æˆ·å¯ä»¥ç®¡ç†è¾“å…¥çš„åœ°æ–¹ï¼‰ã€‚
* æ£€æŸ¥ SSRFs è¿”å›æ‚¨å¯ä»¥æ§åˆ¶çš„æŒ‡å®šé¡µé¢ã€‚
* æ£€æŸ¥ XSS åœ¨ svg å›¾åƒå†…æ‰§è¡Œ JSã€‚
* worker å¯èƒ½ä¸å…¶ä»–å†…éƒ¨æœåŠ¡äº¤äº’ã€‚ä¾‹å¦‚ï¼Œworker å¯èƒ½ä¸å­˜å‚¨ä»è¾“å…¥ä¸­è·å¾—çš„ä¿¡æ¯çš„ R2 å­˜å‚¨æ¡¶äº¤äº’ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œéœ€è¦æ£€æŸ¥ worker å¯¹ R2 å­˜å‚¨æ¡¶çš„èƒ½åŠ›ä»¥åŠå¦‚ä½•å¯èƒ½è¢«ç”¨æˆ·è¾“å…¥æ»¥ç”¨ã€‚

{% hint style="warning" %}
è¯·æ³¨æ„ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œ**Worker è¢«èµ‹äºˆä¸€ä¸ª URL**ï¼Œä¾‹å¦‚ `<worker-name>.<account>.workers.dev`ã€‚ç”¨æˆ·å¯ä»¥å°†å…¶è®¾ç½®ä¸º **å­åŸŸå**ï¼Œä½†å¦‚æœæ‚¨çŸ¥é“è¯¥ **åŸå§‹ URL**ï¼Œæ‚¨å§‹ç»ˆå¯ä»¥è®¿é—®å®ƒã€‚
{% endhint %}

## R2

åœ¨æ¯ä¸ª R2 å­˜å‚¨æ¡¶ä¸Šæ£€æŸ¥ï¼š

* [ ] é…ç½® **CORS ç­–ç•¥**ã€‚

## æµ

TODO

## å›¾åƒ

TODO

## å®‰å…¨ä¸­å¿ƒ

* [ ] å¦‚æœå¯èƒ½ï¼Œè¿è¡Œ **`å®‰å…¨æ´å¯Ÿ`** **æ‰«æ** å’Œ **`åŸºç¡€è®¾æ–½`** **æ‰«æ**ï¼Œå› ä¸ºå®ƒä»¬å°† **çªå‡º** æœ‰è¶£çš„ä¿¡æ¯ **å®‰å…¨** æ–¹é¢ã€‚
* [ ] ä»…æ£€æŸ¥æ­¤ä¿¡æ¯ä»¥æŸ¥æ‰¾å®‰å…¨é”™è¯¯é…ç½®å’Œæœ‰è¶£çš„ä¿¡æ¯ã€‚

## Turnstile

TODO

## **é›¶ä¿¡ä»»**

{% content-ref url="cloudflare-zero-trust-network.md" %}
[cloudflare-zero-trust-network.md](cloudflare-zero-trust-network.md)
{% endcontent-ref %}

## æ‰¹é‡é‡å®šå‘

{% hint style="info" %}
ä¸ [åŠ¨æ€é‡å®šå‘](https://developers.cloudflare.com/rules/url-forwarding/dynamic-redirects/) ä¸åŒï¼Œ[**æ‰¹é‡é‡å®šå‘**](https://developers.cloudflare.com/rules/url-forwarding/bulk-redirects/) æœ¬è´¨ä¸Šæ˜¯é™æ€çš„â€”â€”å®ƒä»¬ä¸æ”¯æŒä»»ä½•å­—ç¬¦ä¸²æ›¿æ¢æ“ä½œæˆ–æ­£åˆ™è¡¨è¾¾å¼ã€‚ä½†æ˜¯ï¼Œæ‚¨å¯ä»¥é…ç½®å½±å“å…¶ URL åŒ¹é…è¡Œä¸ºå’Œè¿è¡Œæ—¶è¡Œä¸ºçš„ URL é‡å®šå‘å‚æ•°ã€‚
{% endhint %}

* [ ] æ£€æŸ¥ **é‡å®šå‘çš„è¡¨è¾¾å¼** å’Œ **è¦æ±‚** æ˜¯å¦ **åˆç†**ã€‚
* [ ] è¿˜è¦æ£€æŸ¥ **æ•æ„Ÿéšè—ç«¯ç‚¹**ï¼Œå…¶ä¸­å¯èƒ½åŒ…å«æœ‰è¶£çš„ä¿¡æ¯ã€‚

## é€šçŸ¥

* [ ] æ£€æŸ¥ **é€šçŸ¥**ã€‚è¿™äº›é€šçŸ¥å»ºè®®ç”¨äºå®‰å…¨ï¼š
* `åŸºäºä½¿ç”¨çš„è®¡è´¹`
* `HTTP DDoS æ”»å‡»è­¦æŠ¥`
* `ç¬¬ 3/4 å±‚ DDoS æ”»å‡»è­¦æŠ¥`
* `é«˜çº§ HTTP DDoS æ”»å‡»è­¦æŠ¥`
* `é«˜çº§ç¬¬ 3/4 å±‚ DDoS æ”»å‡»è­¦æŠ¥`
* `åŸºäºæµé‡çš„ç›‘æ§ï¼šä½“ç§¯æ”»å‡»`
* `è·¯ç”±æ³„æ¼æ£€æµ‹è­¦æŠ¥`
* `è®¿é—® mTLS è¯ä¹¦åˆ°æœŸè­¦æŠ¥`
* `SaaS è‡ªå®šä¹‰ä¸»æœºåçš„ SSL è­¦æŠ¥`
* `é€šç”¨ SSL è­¦æŠ¥`
* `è„šæœ¬ç›‘æ§æ–°ä»£ç æ›´æ”¹æ£€æµ‹è­¦æŠ¥`
* `è„šæœ¬ç›‘æ§æ–°åŸŸåè­¦æŠ¥`
* `è„šæœ¬ç›‘æ§æ–°æ¶æ„åŸŸåè­¦æŠ¥`
* `è„šæœ¬ç›‘æ§æ–°æ¶æ„è„šæœ¬è­¦æŠ¥`
* `è„šæœ¬ç›‘æ§æ–°æ¶æ„ URL è­¦æŠ¥`
* `è„šæœ¬ç›‘æ§æ–°è„šæœ¬è­¦æŠ¥`
* `è„šæœ¬ç›‘æ§æ–°è„šæœ¬è¶…å‡ºæœ€å¤§ URL é•¿åº¦è­¦æŠ¥`
* `é«˜çº§å®‰å…¨äº‹ä»¶è­¦æŠ¥`
* `å®‰å…¨äº‹ä»¶è­¦æŠ¥`
* [ ] æ£€æŸ¥æ‰€æœ‰ **ç›®çš„åœ°**ï¼Œå› ä¸º webhook URL ä¸­å¯èƒ½å­˜åœ¨ **æ•æ„Ÿä¿¡æ¯**ï¼ˆåŸºæœ¬ http èº«ä»½éªŒè¯ï¼‰ã€‚ç¡®ä¿ webhook URL ä½¿ç”¨ **HTTPS**ã€‚
* [ ] ä½œä¸ºé¢å¤–æ£€æŸ¥ï¼Œæ‚¨å¯ä»¥å°è¯• **å†’å…… Cloudflare é€šçŸ¥** ç»™ç¬¬ä¸‰æ–¹ï¼Œä¹Ÿè®¸æ‚¨å¯ä»¥ä»¥æŸç§æ–¹å¼ **æ³¨å…¥ä¸€äº›å±é™©çš„ä¸œè¥¿**ã€‚

## ç®¡ç†è´¦æˆ·

* [ ] å¯ä»¥åœ¨ **`è®¡è´¹` -> `æ”¯ä»˜ä¿¡æ¯`** ä¸­æŸ¥çœ‹ **ä¿¡ç”¨å¡çš„æœ€å 4 ä½æ•°å­—**ã€**åˆ°æœŸ** æ—¶é—´å’Œ **è´¦å•åœ°å€**ã€‚
* [ ] å¯ä»¥åœ¨ **`è®¡è´¹` -> `è®¢é˜…`** ä¸­æŸ¥çœ‹è´¦æˆ·ä¸­ä½¿ç”¨çš„ **è®¡åˆ’ç±»å‹**ã€‚
* [ ] åœ¨ **`æˆå‘˜`** ä¸­ï¼Œå¯ä»¥æŸ¥çœ‹è´¦æˆ·çš„æ‰€æœ‰æˆå‘˜åŠå…¶ **è§’è‰²**ã€‚è¯·æ³¨æ„ï¼Œå¦‚æœè®¡åˆ’ç±»å‹ä¸æ˜¯ä¼ä¸šç‰ˆï¼Œåˆ™ä»…å­˜åœ¨ 2 ä¸ªè§’è‰²ï¼šç®¡ç†å‘˜å’Œè¶…çº§ç®¡ç†å‘˜ã€‚ä½†å¦‚æœä½¿ç”¨çš„ **è®¡åˆ’æ˜¯ä¼ä¸šç‰ˆ**ï¼Œåˆ™å¯ä»¥ä½¿ç”¨ [**æ›´å¤šè§’è‰²**](https://developers.cloudflare.com/fundamentals/account-and-billing/account-setup/account-roles/) æ¥éµå¾ªæœ€å°æƒé™åŸåˆ™ã€‚
* å› æ­¤ï¼Œå°½å¯èƒ½ **å»ºè®®** ä½¿ç”¨ **ä¼ä¸šè®¡åˆ’**ã€‚
* [ ] åœ¨æˆå‘˜ä¸­ï¼Œå¯ä»¥æ£€æŸ¥å“ªäº› **æˆå‘˜** å¯ç”¨äº† **2FA**ã€‚**æ¯ä¸ª** ç”¨æˆ·éƒ½åº”è¯¥å¯ç”¨å®ƒã€‚

{% hint style="info" %}
è¯·æ³¨æ„ï¼Œå¹¸è¿çš„æ˜¯ï¼Œè§’è‰² **`ç®¡ç†å‘˜`** ä¸æˆäºˆç®¡ç†æˆå‘˜èµ„æ ¼çš„æƒé™ï¼ˆ**æ— æ³•æå‡æƒé™æˆ–é‚€è¯·** æ–°æˆå‘˜ï¼‰ã€‚
{% endhint %}

## DDoS è°ƒæŸ¥

[æ£€æŸ¥æ­¤éƒ¨åˆ†](cloudflare-domains.md#cloudflare-ddos-protection)ã€‚

{% hint style="success" %}
å­¦ä¹ å’Œå®è·µ AWS é»‘å®¢æŠ€æœ¯ï¼š<img src="../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks åŸ¹è®­ AWS çº¢é˜Ÿä¸“å®¶ (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/image (1).png" alt="" data-size="line">\
å­¦ä¹ å’Œå®è·µ GCP é»‘å®¢æŠ€æœ¯ï¼š<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks åŸ¹è®­ GCP çº¢é˜Ÿä¸“å®¶ (GRTE)**<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>æ”¯æŒ HackTricks</summary>

* æŸ¥çœ‹ [**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**ç”µæŠ¥ç¾¤ç»„**](https://t.me/peass) æˆ– **å…³æ³¨** æˆ‘ä»¬çš„ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ä»“åº“æäº¤ PR åˆ†äº«é»‘å®¢æŠ€å·§ã€‚

</details>
{% endhint %}
