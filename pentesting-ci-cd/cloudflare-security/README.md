# Cloudflare-Sicherheit

{% hint style="success" %}
Lerne & √ºbe AWS-Hacking:<img src="../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Lerne & √ºbe GCP-Hacking: <img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Unterst√ºtze HackTricks</summary>

* √úberpr√ºfe die [**Abonnementpl√§ne**](https://github.com/sponsors/carlospolop)!
* **Tritt der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folge** uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teile Hacking-Tricks, indem du PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repos einreichst.

</details>
{% endhint %}

In einem Cloudflare-Konto gibt es einige **allgemeine Einstellungen und Dienste**, die konfiguriert werden k√∂nnen. Auf dieser Seite werden wir die **sicherheitsrelevanten Einstellungen jeder Sektion analysieren:**

<figure><img src="../../.gitbook/assets/image (117).png" alt=""><figcaption></figcaption></figure>

## Websites

√úberpr√ºfe jede mit:

{% content-ref url="cloudflare-domains.md" %}
[cloudflare-domains.md](cloudflare-domains.md)
{% endcontent-ref %}

### Domainregistrierung

* [ ] In **`Transfer Domains`** √ºberpr√ºfen, dass es nicht m√∂glich ist, eine Domain zu √ºbertragen.

√úberpr√ºfe jede mit:

{% content-ref url="cloudflare-domains.md" %}
[cloudflare-domains.md](cloudflare-domains.md)
{% endcontent-ref %}

## Analytik

_Ich konnte nichts finden, um eine Sicherheits√ºberpr√ºfung der Konfiguration durchzuf√ºhren._

## Seiten

Auf jeder Cloudflare-Seite:

* [ ] √úberpr√ºfe auf **sensible Informationen** im **`Build log`**.
* [ ] √úberpr√ºfe auf **sensible Informationen** im **Github-Repository**, das den Seiten zugewiesen ist.
* [ ] √úberpr√ºfe auf potenzielle Kompromittierungen des Github-Repos durch **Workflow-Befehlsinjektion** oder `pull_request_target`-Kompromittierung. Weitere Informationen auf der [**Github-Sicherheitsseite**](../github-security/).
* [ ] √úberpr√ºfe auf **anf√§llige Funktionen** im Verzeichnis `/fuctions` (falls vorhanden), √ºberpr√ºfe die **Weiterleitungen** in der Datei `_redirects` (falls vorhanden) und **falsch konfigurierte Header** in der Datei `_headers` (falls vorhanden).
* [ ] √úberpr√ºfe auf **Schwachstellen** in der **Webseite** √ºber **Blackbox** oder **Whitebox**, wenn du **auf den Code zugreifen** kannst.
* [ ] In den Details jeder Seite `/<page_id>/pages/view/blocklist/settings/functions`. √úberpr√ºfe auf **sensible Informationen** in den **`Umgebungsvariablen`**.
* [ ] √úberpr√ºfe auch den **Build-Befehl** und das **Stammverzeichnis** auf **potenzielle Injektionen**, um die Seite zu kompromittieren.

## **Workers**

√úberpr√ºfe bei jedem Cloudflare-Worker:

* [ ] Die Trigger: Was l√∂st den Worker aus? Kann ein **Benutzer Daten senden**, die vom Worker **verwendet** werden?
* [ ] In den **`Einstellungen`** nach **`Variablen`** suchen, die **sensible Informationen** enthalten.
* [ ] √úberpr√ºfe den **Code des Workers** und suche nach **Schwachstellen** (insbesondere an Stellen, an denen der Benutzer die Eingabe verwalten kann).
* √úberpr√ºfe auf SSRFs, die die angegebene Seite zur√ºckgeben, die du kontrollieren kannst.
* √úberpr√ºfe XSS, die JS innerhalb eines SVG-Bildes ausf√ºhren.
* Es ist m√∂glich, dass der Worker mit anderen internen Diensten interagiert. Zum Beispiel kann ein Worker mit einem R2-Bucket interagieren, der Informationen speichert, die aus der Eingabe stammen. In diesem Fall w√§re es notwendig zu √ºberpr√ºfen, welche M√∂glichkeiten der Worker √ºber den R2-Bucket hat und wie dies aus der Benutzereingabe missbraucht werden k√∂nnte.

{% hint style="warning" %}
Beachte, dass standardm√§√üig ein **Worker eine URL** wie `<worker-name>.<account>.workers.dev` erh√§lt. Der Benutzer kann sie auf eine **Subdomain** setzen, aber du kannst immer mit dieser **urspr√ºnglichen URL** darauf zugreifen, wenn du sie kennst.
{% endhint %}

## R2

√úberpr√ºfe bei jedem R2-Bucket:

* [ ] Konfiguriere die **CORS-Richtlinie**.

## Stream

TODO

## Bilder

TODO

## Sicherheitszentrum

* [ ] Wenn m√∂glich, f√ºhre einen **`Security Insights`**-Scan und einen **`Infrastructure`**-Scan durch, da sie interessante Informationen **sicherheitsrelevant** hervorheben werden.
* [ ] √úberpr√ºfe diese Informationen auf Sicherheitsfehlkonfigurationen und interessante Infos.

## Turnstile

TODO

## **Zero Trust**

{% content-ref url="cloudflare-zero-trust-network.md" %}
[cloudflare-zero-trust-network.md](cloudflare-zero-trust-network.md)
{% endcontent-ref %}

## Bulk-Weiterleitungen

{% hint style="info" %}
Im Gegensatz zu [Dynamischen Weiterleitungen](https://developers.cloudflare.com/rules/url-forwarding/dynamic-redirects/) sind [**Bulk-Weiterleitungen**](https://developers.cloudflare.com/rules/url-forwarding/bulk-redirects/) im Wesentlichen statisch ‚Äî sie unterst√ºtzen **keine String-Ersetzungs**-Operationen oder regul√§ren Ausdr√ºcke. Du kannst jedoch URL-Weiterleitungsparameter konfigurieren, die ihr URL-Matching-Verhalten und ihr Laufzeitverhalten beeinflussen.
{% endhint %}

* [ ] √úberpr√ºfe, dass die **Ausdr√ºcke** und **Anforderungen** f√ºr Weiterleitungen **Sinn machen**.
* [ ] √úberpr√ºfe auch auf **sensible versteckte Endpunkte**, die interessante Informationen enthalten.

## Benachrichtigungen

* [ ] √úberpr√ºfe die **Benachrichtigungen.** Diese Benachrichtigungen werden f√ºr die Sicherheit empfohlen:
* `Nutzungsbasierte Abrechnung`
* `HTTP DDoS-Angriffsbenachrichtigung`
* `Layer 3/4 DDoS-Angriffsbenachrichtigung`
* `Erweiterte HTTP DDoS-Angriffsbenachrichtigung`
* `Erweiterte Layer 3/4 DDoS-Angriffsbenachrichtigung`
* `Flow-basiertes Monitoring: Volumetrischer Angriff`
* `Route Leak Detection Alert`
* `Zugriff mTLS-Zertifikat-Ablaufbenachrichtigung`
* `SSL f√ºr SaaS-Custom-Hostnamen-Benachrichtigung`
* `Universelle SSL-Benachrichtigung`
* `Script Monitor Neue Code√§nderungsbenachrichtigung`
* `Script Monitor Neue Domainbenachrichtigung`
* `Script Monitor Neue b√∂sartige Domainbenachrichtigung`
* `Script Monitor Neue b√∂sartige Skriptbenachrichtigung`
* `Script Monitor Neue b√∂sartige URL-Benachrichtigung`
* `Script Monitor Neue Skriptbenachrichtigung`
* `Script Monitor Neues Skript √ºberschreitet maximale URL-L√§ngenbenachrichtigung`
* `Erweiterte Sicherheitsereignisbenachrichtigung`
* `Sicherheitsereignisbenachrichtigung`
* [ ] √úberpr√ºfe alle **Ziele**, da es **sensible Informationen** (Basis-HTTP-Auth) in Webhook-URLs geben k√∂nnte. Stelle auch sicher, dass Webhook-URLs **HTTPS** verwenden.
* [ ] Als zus√§tzliche √úberpr√ºfung k√∂nntest du versuchen, eine **Cloudflare-Benachrichtigung** an eine dritte Partei zu **imitieren**, vielleicht kannst du irgendwie **etwas Gef√§hrliches injizieren**.

## Konto verwalten

* [ ] Es ist m√∂glich, die **letzten 4 Ziffern der Kreditkarte**, die **Ablauf**-Zeit und die **Rechnungsadresse** in **`Billing` -> `Payment info`** zu sehen.
* [ ] Es ist m√∂glich, den **Plan-Typ** im Konto in **`Billing` -> `Subscriptions`** zu sehen.
* [ ] In **`Members`** ist es m√∂glich, alle Mitglieder des Kontos und ihre **Rolle** zu sehen. Beachte, dass, wenn der Plan-Typ nicht Enterprise ist, nur 2 Rollen existieren: Administrator und Superadministrator. Wenn der verwendete **Plan Enterprise** ist, k√∂nnen [**weitere Rollen**](https://developers.cloudflare.com/fundamentals/account-and-billing/account-setup/account-roles/) verwendet werden, um das Prinzip der minimalen Berechtigung zu befolgen.
* Daher wird empfohlen, wann immer m√∂glich den **Enterprise-Plan** zu verwenden.
* [ ] In den Mitgliedern ist es m√∂glich zu √ºberpr√ºfen, welche **Mitglieder** **2FA aktiviert** haben. **Jeder** Benutzer sollte es aktiviert haben.

{% hint style="info" %}
Beachte, dass gl√ºcklicherweise die Rolle **`Administrator`** keine Berechtigungen zur Verwaltung von Mitgliedschaften gibt (**kann keine Privilegien erh√∂hen oder** neue Mitglieder einladen).
{% endhint %}

## DDoS-Untersuchung

[√úberpr√ºfe diesen Teil](cloudflare-domains.md#cloudflare-ddos-protection).

{% hint style="success" %}
Lerne & √ºbe AWS-Hacking:<img src="../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Lerne & √ºbe GCP-Hacking: <img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Unterst√ºtze HackTricks</summary>

* √úberpr√ºfe die [**Abonnementpl√§ne**](https://github.com/sponsors/carlospolop)!
* **Tritt der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folge** uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teile Hacking-Tricks, indem du PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repos einreichst.

</details>
{% endhint %}
