# Dominios de Cloudflare

{% hint style="success" %}
Aprende y practica Hacking en AWS:<img src="../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Aprende y practica Hacking en GCP: <img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Apoya a HackTricks</summary>

* Revisa los [**planes de suscripci√≥n**](https://github.com/sponsors/carlospolop)!
* **√önete al** üí¨ [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s√≠guenos** en **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Comparte trucos de hacking enviando PRs a los** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repos de github.

</details>
{% endhint %}

En cada TLD configurado en Cloudflare hay algunas **configuraciones y servicios generales** que se pueden configurar. En esta p√°gina vamos a **analizar las configuraciones relacionadas con la seguridad de cada secci√≥n:**

<figure><img src="../../.gitbook/assets/image (101).png" alt=""><figcaption></figcaption></figure>

### Resumen

* [ ] Obt√©n una idea de **cu√°nto** se est√°n **usando** los servicios de la cuenta
* [ ] Encuentra tambi√©n el **ID de zona** y el **ID de cuenta**

### Anal√≠tica

* [ ] En **`Seguridad`** verifica si hay alguna **Limitaci√≥n de tasa**

### DNS

* [ ] Verifica datos **interesantes** (¬øsensibles?) en los **registros** de DNS
* [ ] Verifica **subdominios** que podr√≠an contener **informaci√≥n sensible** solo bas√°ndote en el **nombre** (como admin173865324.domin.com)
* [ ] Verifica p√°ginas web que **no est√°n** **protegidas**
* [ ] Verifica **p√°ginas web protegidas** que pueden ser **accedidas directamente** por CNAME o direcci√≥n IP
* [ ] Verifica que **DNSSEC** est√© **habilitado**
* [ ] Verifica que **CNAME Flattening** est√© **usado** en **todos los CNAMEs**
* Esto podr√≠a ser √∫til para **ocultar vulnerabilidades de toma de subdominio** y mejorar los tiempos de carga
* [ ] Verifica que los dominios [**no sean vulnerables a suplantaci√≥n**](https://book.hacktricks.xyz/network-services-pentesting/pentesting-smtp#mail-spoofing)

### **Email**

TODO

### Spectrum

TODO

### SSL/TLS

#### **Resumen**

* [ ] La **encriptaci√≥n SSL/TLS** debe ser **Completa** o **Completa (Estricto)**. Cualquier otra enviar√° **tr√°fico en texto claro** en alg√∫n momento.
* [ ] El **Recomendador de SSL/TLS** debe estar habilitado

#### Certificados de Edge

* [ ] **Siempre usar HTTPS** debe estar **habilitado**
* [ ] **HTTP Strict Transport Security (HSTS)** debe estar **habilitado**
* [ ] **La versi√≥n m√≠nima de TLS debe ser 1.2**
* [ ] **TLS 1.3 debe estar habilitado**
* [ ] **Reescrituras autom√°ticas de HTTPS** deben estar **habilitadas**
* [ ] **Monitoreo de Transparencia de Certificados** debe estar **habilitado**

### **Seguridad**

* [ ] En la secci√≥n **`WAF`** es interesante verificar que se **utilizan reglas de Firewall** y **limitaci√≥n de tasa** para prevenir abusos.
* La acci√≥n **`Bypass`** **desactivar√° las** caracter√≠sticas de seguridad de Cloudflare para una solicitud. No deber√≠a ser utilizada.
* [ ] En la secci√≥n **`Page Shield`** se recomienda verificar que est√© **habilitado** si se utiliza alguna p√°gina
* [ ] En la secci√≥n **`API Shield`** se recomienda verificar que est√© **habilitado** si alguna API est√° expuesta en Cloudflare
* [ ] En la secci√≥n **`DDoS`** se recomienda habilitar las **protecciones DDoS**
* [ ] En la secci√≥n **`Configuraciones`**:
* [ ] Verifica que el **`Nivel de Seguridad`** sea **medio** o mayor
* [ ] Verifica que el **`Tiempo de Desaf√≠o`** sea de 1 hora como m√°ximo
* [ ] Verifica que la **`Verificaci√≥n de Integridad del Navegador`** est√© **habilitada**
* [ ] Verifica que el **`Soporte de Privacy Pass`** est√© **habilitado**

#### **Protecci√≥n DDoS de CloudFlare**

* Si puedes, habilita **Modo de Lucha contra Bots** o **Modo de Lucha contra Super Bots**. Si est√°s protegiendo alguna API accesada program√°ticamente (desde una p√°gina de frontend JS, por ejemplo). Puede que no puedas habilitar esto sin romper ese acceso.
* En **WAF**: Puedes crear **l√≠mites de tasa por ruta de URL** o para **bots verificados** (reglas de limitaci√≥n de tasa), o **bloquear acceso** basado en IP, Cookie, referidor...). As√≠ que podr√≠as bloquear solicitudes que no provengan de una p√°gina web o que no tengan una cookie.
* Si el ataque es de un **bot verificado**, al menos **agrega un l√≠mite de tasa** a los bots.
* Si el ataque es a una **ruta espec√≠fica**, como mecanismo de prevenci√≥n, agrega un **l√≠mite de tasa** en esta ruta.
* Tambi√©n puedes **blanquear** direcciones IP, rangos de IP, pa√≠ses o ASN desde las **Herramientas** en WAF.
* Verifica si las **Reglas Administradas** tambi√©n podr√≠an ayudar a prevenir explotaciones de vulnerabilidades.
* En la secci√≥n **Herramientas** puedes **bloquear o dar un desaf√≠o a IPs** y **agentes de usuario** espec√≠ficos.
* En DDoS podr√≠as **sobrescribir algunas reglas para hacerlas m√°s restrictivas**.
* **Configuraciones**: Establece el **Nivel de Seguridad** en **Alto** y en **Bajo Ataque** si est√°s Bajo Ataque y que la **Verificaci√≥n de Integridad del Navegador est√© habilitada**.
* En Dominios de Cloudflare -> Anal√≠tica -> Seguridad -> Verifica si la **limitaci√≥n de tasa** est√° habilitada
* En Dominios de Cloudflare -> Seguridad -> Eventos -> Verifica si hay **Eventos maliciosos detectados**

### Acceso

{% content-ref url="cloudflare-zero-trust-network.md" %}
[cloudflare-zero-trust-network.md](cloudflare-zero-trust-network.md)
{% endcontent-ref %}

### Velocidad

_No pude encontrar ninguna opci√≥n relacionada con la seguridad_

### Cach√©

* [ ] En la secci√≥n **`Configuraci√≥n`** considera habilitar la **Herramienta de Escaneo de CSAM**

### **Rutas de Workers**

_Ya deber√≠as haber revisado_ [_cloudflare workers_](./#workers)

### Reglas

TODO

### Red

* [ ] Si **`HTTP/2`** est√° **habilitado**, **`HTTP/2 a Origen`** debe estar **habilitado**
* [ ] **`HTTP/3 (con QUIC)`** debe estar **habilitado**
* [ ] Si la **privacidad** de tus **usuarios** es importante, aseg√∫rate de que **`Onion Routing`** est√© **habilitado**

### **Tr√°fico**

TODO

### P√°ginas Personalizadas

* [ ] Es opcional configurar p√°ginas personalizadas cuando se activa un error relacionado con la seguridad (como un bloqueo, limitaci√≥n de tasa o estoy en modo de ataque)

### Aplicaciones

TODO

### Scrape Shield

* [ ] Verifica que la **Ofuscaci√≥n de Direcciones de Email** est√© **habilitada**
* [ ] Verifica que los **Excluidos del lado del servidor** est√©n **habilitados**

### **Zaraz**

TODO

### **Web3**

TODO

{% hint style="success" %}
Aprende y practica Hacking en AWS:<img src="../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Aprende y practica Hacking en GCP: <img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Apoya a HackTricks</summary>

* Revisa los [**planes de suscripci√≥n**](https://github.com/sponsors/carlospolop)!
* **√önete al** üí¨ [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s√≠guenos** en **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Comparte trucos de hacking enviando PRs a los** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repos de github.

</details>
{% endhint %}
