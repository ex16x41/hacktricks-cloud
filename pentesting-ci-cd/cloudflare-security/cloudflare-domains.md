# Cloudflare Domains

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

In ogni TLD configurato in Cloudflare ci sono alcune **impostazioni generali e servizi** che possono essere configurati. In questa pagina andremo a **analizzare le impostazioni relative alla sicurezza di ciascuna sezione:**

<figure><img src="../../.gitbook/assets/image (101).png" alt=""><figcaption></figcaption></figure>

### Overview

* [ ] Fai un'idea di **quanto** sono **utilizzati** i servizi dell'account
* [ ] Trova anche il **zone ID** e il **account ID**

### Analytics

* [ ] In **`Security`** controlla se ci sono **Rate limiting**

### DNS

* [ ] Controlla i dati **interessanti** (sensibili?) nei **record DNS**
* [ ] Controlla i **sottodomini** che potrebbero contenere **info sensibili** solo in base al **nome** (come admin173865324.domin.com)
* [ ] Controlla le pagine web che **non sono** **proxied**
* [ ] Controlla le **pagine web proxificate** che possono essere **accessibili direttamente** tramite CNAME o indirizzo IP
* [ ] Controlla che **DNSSEC** sia **abilitato**
* [ ] Controlla che **CNAME Flattening** sia **utilizzato** in **tutti i CNAME**
* Questo potrebbe essere utile per **nascondere le vulnerabilit√† di takeover dei sottodomini** e migliorare i tempi di caricamento
* [ ] Controlla che i domini [**non siano vulnerabili a spoofing**](https://book.hacktricks.xyz/network-services-pentesting/pentesting-smtp#mail-spoofing)

### **Email**

TODO

### Spectrum

TODO

### SSL/TLS

#### **Overview**

* [ ] La **cifratura SSL/TLS** dovrebbe essere **Full** o **Full (Strict)**. Qualsiasi altra opzione invier√† **traffico in chiaro** a un certo punto.
* [ ] Il **SSL/TLS Recommender** dovrebbe essere abilitato

#### Edge Certificates

* [ ] **Always Use HTTPS** dovrebbe essere **abilitato**
* [ ] **HTTP Strict Transport Security (HSTS)** dovrebbe essere **abilitato**
* [ ] **Minimum TLS Version should be 1.2**
* [ ] **TLS 1.3 should be enabled**
* [ ] **Automatic HTTPS Rewrites** dovrebbe essere **abilitato**
* [ ] **Certificate Transparency Monitoring** dovrebbe essere **abilitato**

### **Security**

* [ ] Nella sezione **`WAF`** √® interessante controllare che le **regole del Firewall** e del **rate limiting siano utilizzate** per prevenire abusi.
* L'azione **`Bypass`** disabiliter√† le funzionalit√† di sicurezza di Cloudflare per una richiesta. Non dovrebbe essere utilizzata.
* [ ] Nella sezione **`Page Shield`** √® consigliato controllare che sia **abilitato** se viene utilizzata una pagina
* [ ] Nella sezione **`API Shield`** √® consigliato controllare che sia **abilitato** se qualche API √® esposta in Cloudflare
* [ ] Nella sezione **`DDoS`** √® consigliato abilitare le **protezioni DDoS**
* [ ] Nella sezione **`Settings`**:
* [ ] Controlla che il **`Security Level`** sia **medium** o superiore
* [ ] Controlla che il **`Challenge Passage`** sia di massimo 1 ora
* [ ] Controlla che il **`Browser Integrity Check`** sia **abilitato**
* [ ] Controlla che il **`Privacy Pass Support`** sia **abilitato**

#### **CloudFlare DDoS Protection**

* Se puoi, abilita **Bot Fight Mode** o **Super Bot Fight Mode**. Se stai proteggendo qualche API accessibile programmaticamente (da una pagina front end JS, ad esempio). Potresti non essere in grado di abilitare questo senza interrompere quell'accesso.
* In **WAF**: Puoi creare **limiti di rate per percorso URL** o per **bot verificati** (regole di rate limiting), o per **bloccare l'accesso** in base a IP, Cookie, referrer...). Quindi potresti bloccare richieste che non provengono da una pagina web o non hanno un cookie.
* Se l'attacco proviene da un **bot verificato**, almeno **aggiungi un limite di rate** ai bot.
* Se l'attacco √® a un **percorso specifico**, come meccanismo di prevenzione, aggiungi un **limite di rate** in questo percorso.
* Puoi anche **whitelistare** indirizzi IP, intervalli IP, paesi o ASN dagli **Strumenti** in WAF.
* Controlla se le **regole gestite** potrebbero anche aiutare a prevenire sfruttamenti di vulnerabilit√†.
* Nella sezione **Strumenti** puoi **bloccare o dare una sfida a IP specifici** e **user agents.**
* In DDoS potresti **sovrascrivere alcune regole per renderle pi√π restrittive**.
* **Impostazioni**: Imposta il **Security Level** su **High** e su **Under Attack** se sei sotto attacco e che il **Browser Integrity Check √® abilitato**.
* In Cloudflare Domains -> Analytics -> Security -> Controlla se il **rate limit** √® abilitato
* In Cloudflare Domains -> Security -> Events -> Controlla per **Eventi malevoli rilevati**

### Access

{% content-ref url="cloudflare-zero-trust-network.md" %}
[cloudflare-zero-trust-network.md](cloudflare-zero-trust-network.md)
{% endcontent-ref %}

### Speed

_Non sono riuscito a trovare alcuna opzione relativa alla sicurezza_

### Caching

* [ ] Nella sezione **`Configuration`** considera di abilitare il **CSAM Scanning Tool**

### **Workers Routes**

_Dovresti aver gi√† controllato_ [_cloudflare workers_](./#workers)

### Rules

TODO

### Network

* [ ] Se **`HTTP/2`** √® **abilitato**, **`HTTP/2 to Origin`** dovrebbe essere **abilitato**
* [ ] **`HTTP/3 (with QUIC)`** dovrebbe essere **abilitato**
* [ ] Se la **privacy** dei tuoi **utenti** √® importante, assicurati che **`Onion Routing`** sia **abilitato**

### **Traffic**

TODO

### Custom Pages

* [ ] √à facoltativo configurare pagine personalizzate quando viene attivato un errore relativo alla sicurezza (come un blocco, rate limiting o sono in modalit√† sotto attacco)

### Apps

TODO

### Scrape Shield

* [ ] Controlla che l'**Email Address Obfuscation** sia **abilitata**
* [ ] Controlla che il **Server-side Excludes** sia **abilitato**

### **Zaraz**

TODO

### **Web3**

TODO

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
