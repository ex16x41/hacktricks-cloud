# åŸºæœ¬çš„ Jenkins ä¿¡æ¯

{% hint style="success" %}
å­¦ä¹ å’Œå®è·µ AWS é»‘å®¢æŠ€æœ¯ï¼š<img src="../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">[**HackTricks åŸ¹è®­ AWS çº¢é˜Ÿä¸“å®¶ (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">\
å­¦ä¹ å’Œå®è·µ GCP é»‘å®¢æŠ€æœ¯ï¼š<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks åŸ¹è®­ GCP çº¢é˜Ÿä¸“å®¶ (GRTE)**<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>æ”¯æŒ HackTricks</summary>

* æŸ¥çœ‹ [**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**Telegram ç¾¤ç»„**](https://t.me/peass) æˆ– **åœ¨ Twitter ä¸Šå…³æ³¨** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub ä»“åº“æäº¤ PR æ¥åˆ†äº«é»‘å®¢æŠ€å·§ã€‚

</details>
{% endhint %}

## è®¿é—®

### ç”¨æˆ·å + å¯†ç 

åœ¨ Jenkins ä¸­ç™»å½•çš„æœ€å¸¸è§æ–¹å¼æ˜¯ä½¿ç”¨ç”¨æˆ·åæˆ–å¯†ç ã€‚

### Cookie

å¦‚æœ **æˆæƒçš„ Cookie è¢«ç›—**ï¼Œå®ƒå¯ä»¥ç”¨æ¥è®¿é—®ç”¨æˆ·çš„ä¼šè¯ã€‚è¿™ä¸ª Cookie é€šå¸¸è¢«ç§°ä¸º `JSESSIONID.*`ã€‚ï¼ˆç”¨æˆ·å¯ä»¥ç»ˆæ­¢æ‰€æœ‰ä¼šè¯ï¼Œä½†ä»–éœ€è¦å…ˆå‘ç° Cookie è¢«ç›—ï¼‰ã€‚

### SSO/æ’ä»¶

Jenkins å¯ä»¥é€šè¿‡æ’ä»¶é…ç½®ä¸º **é€šè¿‡ç¬¬ä¸‰æ–¹ SSO è®¿é—®**ã€‚

### ä»¤ç‰Œ

**ç”¨æˆ·å¯ä»¥ç”Ÿæˆä»¤ç‰Œ**ï¼Œä»¥ä¾¿é€šè¿‡ CLI æˆ– REST API è®©åº”ç”¨ç¨‹åºå†’å……ä»–ä»¬ã€‚

### SSH å¯†é’¥

æ­¤ç»„ä»¶ä¸º Jenkins æä¾›å†…ç½®çš„ SSH æœåŠ¡å™¨ã€‚å®ƒæ˜¯ [Jenkins CLI](https://www.jenkins.io/doc/book/managing/cli/) çš„æ›¿ä»£æ¥å£ï¼Œå¯ä»¥ä½¿ç”¨ä»»ä½• SSH å®¢æˆ·ç«¯ä»¥è¿™ç§æ–¹å¼è°ƒç”¨å‘½ä»¤ã€‚ï¼ˆæ¥è‡ª [docs](https://plugins.jenkins.io/sshd/)ï¼‰

## æˆæƒ

åœ¨ `/configureSecurity` ä¸­ï¼Œå¯ä»¥ **é…ç½® Jenkins çš„æˆæƒæ–¹æ³•**ã€‚æœ‰å‡ ç§é€‰é¡¹ï¼š

* **ä»»ä½•äººéƒ½å¯ä»¥åšä»»ä½•äº‹**ï¼šç”šè‡³åŒ¿åè®¿é—®ä¹Ÿå¯ä»¥ç®¡ç†æœåŠ¡å™¨ã€‚
* **é—ç•™æ¨¡å¼**ï¼šä¸ Jenkins <1.164 ç›¸åŒã€‚å¦‚æœä½ æ‹¥æœ‰ **"admin" è§’è‰²**ï¼Œä½ å°†è·å¾— **å¯¹ç³»ç»Ÿçš„å®Œå…¨æ§åˆ¶**ï¼Œå¦åˆ™ï¼ˆåŒ…æ‹¬ **åŒ¿å** ç”¨æˆ·ï¼‰ä½ å°†åªæœ‰ **è¯»å–** æƒé™ã€‚
* **ç™»å½•ç”¨æˆ·å¯ä»¥åšä»»ä½•äº‹**ï¼šåœ¨æ­¤æ¨¡å¼ä¸‹ï¼Œæ¯ä¸ª **ç™»å½•ç”¨æˆ·è·å¾—å¯¹ Jenkins çš„å®Œå…¨æ§åˆ¶**ã€‚å”¯ä¸€æ²¡æœ‰å®Œå…¨æ§åˆ¶çš„ç”¨æˆ·æ˜¯ **åŒ¿åç”¨æˆ·**ï¼Œä»–ä»¬åªæœ‰ **è¯»å–æƒé™**ã€‚
* **åŸºäºçŸ©é˜µçš„å®‰å…¨æ€§**ï¼šä½ å¯ä»¥åœ¨è¡¨ä¸­é…ç½® **è°å¯ä»¥åšä»€ä¹ˆ**ã€‚æ¯ä¸ª **åˆ—** ä»£è¡¨ä¸€ä¸ª **æƒé™**ã€‚æ¯ä¸ª **è¡Œ** ä»£è¡¨ä¸€ä¸ª **ç”¨æˆ·æˆ–ç»„/è§’è‰²**ã€‚è¿™åŒ…æ‹¬ä¸€ä¸ªç‰¹æ®Šç”¨æˆ· '**anonymous**'ï¼Œä»£è¡¨ **æœªè®¤è¯ç”¨æˆ·**ï¼Œä»¥åŠ '**authenticated**'ï¼Œä»£è¡¨ **æ‰€æœ‰å·²è®¤è¯ç”¨æˆ·**ã€‚

![](<../../.gitbook/assets/image (149).png>)

* **åŸºäºé¡¹ç›®çš„çŸ©é˜µæˆæƒç­–ç•¥ï¼š** æ­¤æ¨¡å¼æ˜¯å¯¹ "**åŸºäºçŸ©é˜µçš„å®‰å…¨æ€§**" çš„ **æ‰©å±•**ï¼Œå…è®¸ä¸ºæ¯ä¸ªé¡¹ç›®å•ç‹¬ **å®šä¹‰é¢å¤–çš„ ACL çŸ©é˜µ**ã€‚
* **åŸºäºè§’è‰²çš„ç­–ç•¥ï¼š** å…è®¸ä½¿ç”¨ **åŸºäºè§’è‰²çš„ç­–ç•¥** å®šä¹‰æˆæƒã€‚åœ¨ `/role-strategy` ä¸­ç®¡ç†è§’è‰²ã€‚

## **å®‰å…¨é¢†åŸŸ**

åœ¨ `/configureSecurity` ä¸­ï¼Œå¯ä»¥ **é…ç½®å®‰å…¨é¢†åŸŸ**ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒJenkins åŒ…å«å¯¹å‡ ç§ä¸åŒå®‰å…¨é¢†åŸŸçš„æ”¯æŒï¼š

* **å§”æ‰˜ç»™ Servlet å®¹å™¨**ï¼šç”¨äº **å§”æ‰˜è®¤è¯ç»™è¿è¡Œ Jenkins æ§åˆ¶å™¨çš„ Servlet å®¹å™¨**ï¼Œä¾‹å¦‚ [Jetty](https://www.eclipse.org/jetty/)ã€‚
* **Jenkins è‡ªå·±çš„ç”¨æˆ·æ•°æ®åº“ï¼š** ä½¿ç”¨ **Jenkins è‡ªå¸¦çš„ç”¨æˆ·æ•°æ®å­˜å‚¨** è¿›è¡Œè®¤è¯ï¼Œè€Œä¸æ˜¯å§”æ‰˜ç»™å¤–éƒ¨ç³»ç»Ÿã€‚é»˜è®¤å¯ç”¨ã€‚
* **LDAP**ï¼šå°†æ‰€æœ‰è®¤è¯å§”æ‰˜ç»™é…ç½®çš„ LDAP æœåŠ¡å™¨ï¼ŒåŒ…æ‹¬ç”¨æˆ·å’Œç»„ã€‚
* **Unix ç”¨æˆ·/ç»„æ•°æ®åº“**ï¼š**å°†è®¤è¯å§”æ‰˜ç»™åº•å±‚ Unix** æ“ä½œç³»ç»Ÿçº§ç”¨æˆ·æ•°æ®åº“ã€‚æ­¤æ¨¡å¼è¿˜å…è®¸é‡ç”¨ Unix ç»„è¿›è¡Œæˆæƒã€‚

æ’ä»¶å¯ä»¥æä¾›é¢å¤–çš„å®‰å…¨é¢†åŸŸï¼Œè¿™å¯èƒ½å¯¹å°† Jenkins çº³å…¥ç°æœ‰èº«ä»½ç³»ç»Ÿæœ‰ç”¨ï¼Œä¾‹å¦‚ï¼š

* [Active Directory](https://plugins.jenkins.io/active-directory)
* [GitHub è®¤è¯](https://plugins.jenkins.io/github-oauth)
* [Atlassian Crowd 2](https://plugins.jenkins.io/crowd2)

## Jenkins èŠ‚ç‚¹ã€ä»£ç†å’Œæ‰§è¡Œå™¨

æ¥è‡ª [docs](https://www.jenkins.io/doc/book/managing/nodes/) çš„å®šä¹‰ï¼š

**èŠ‚ç‚¹** æ˜¯ **æ„å»ºä»£ç†è¿è¡Œçš„æœºå™¨**ã€‚Jenkins ç›‘æ§æ¯ä¸ªé™„åŠ èŠ‚ç‚¹çš„ç£ç›˜ç©ºé—´ã€å¯ç”¨ä¸´æ—¶ç©ºé—´ã€å¯ç”¨äº¤æ¢ç©ºé—´ã€æ—¶é’Ÿæ—¶é—´/åŒæ­¥å’Œå“åº”æ—¶é—´ã€‚å¦‚æœè¿™äº›å€¼ä¸­çš„ä»»ä½•ä¸€ä¸ªè¶…å‡ºé…ç½®çš„é˜ˆå€¼ï¼ŒèŠ‚ç‚¹å°†è¢«ä¸‹çº¿ã€‚

**ä»£ç†** **ç®¡ç†** ä»£è¡¨ Jenkins æ§åˆ¶å™¨çš„ **ä»»åŠ¡æ‰§è¡Œ**ï¼Œé€šè¿‡ **ä½¿ç”¨æ‰§è¡Œå™¨**ã€‚ä»£ç†å¯ä»¥ä½¿ç”¨ä»»ä½•æ”¯æŒ Java çš„æ“ä½œç³»ç»Ÿã€‚æ„å»ºå’Œæµ‹è¯•æ‰€éœ€çš„å·¥å…·å®‰è£…åœ¨ä»£ç†è¿è¡Œçš„èŠ‚ç‚¹ä¸Šï¼›å®ƒä»¬å¯ä»¥ **ç›´æ¥å®‰è£…æˆ–åœ¨å®¹å™¨ä¸­å®‰è£…**ï¼ˆDocker æˆ– Kubernetesï¼‰ã€‚æ¯ä¸ª **ä»£ç†å®é™…ä¸Šæ˜¯ä¸»æœºä¸Šçš„ä¸€ä¸ªè¿›ç¨‹ï¼Œå…·æœ‰è‡ªå·±çš„ PID**ã€‚

**æ‰§è¡Œå™¨** æ˜¯ **ä»»åŠ¡æ‰§è¡Œçš„æ’æ§½**ï¼›å®é™…ä¸Šï¼Œå®ƒæ˜¯ **ä»£ç†ä¸­çš„ä¸€ä¸ªçº¿ç¨‹**ã€‚èŠ‚ç‚¹ä¸Šçš„ **æ‰§è¡Œå™¨æ•°é‡** å®šä¹‰äº†å¯ä»¥åœ¨è¯¥èŠ‚ç‚¹ä¸ŠåŒæ—¶æ‰§è¡Œçš„ **å¹¶å‘ä»»åŠ¡** æ•°é‡ã€‚æ¢å¥è¯è¯´ï¼Œè¿™å†³å®šäº†å¯ä»¥åœ¨è¯¥èŠ‚ç‚¹ä¸ŠåŒæ—¶æ‰§è¡Œçš„ **å¹¶å‘ Pipeline `stages`** æ•°é‡ã€‚

## Jenkins ç§˜å¯†

### ç§˜å¯†å’Œå‡­è¯çš„åŠ å¯†

æ¥è‡ª [docs](https://www.jenkins.io/doc/developer/security/secrets/#encryption-of-secrets-and-credentials) çš„å®šä¹‰ï¼šJenkins ä½¿ç”¨ **AES åŠ å¯†å’Œä¿æŠ¤ç§˜å¯†**ã€å‡­è¯åŠå…¶å„è‡ªçš„åŠ å¯†å¯†é’¥ã€‚è¿™äº›åŠ å¯†å¯†é’¥å­˜å‚¨åœ¨ `$JENKINS_HOME/secrets/` ä¸­ï¼Œä»¥åŠç”¨äºä¿æŠ¤è¿™äº›å¯†é’¥çš„ä¸»å¯†é’¥ã€‚æ­¤ç›®å½•åº”é…ç½®ä¸ºä»…å…è®¸è¿è¡Œ Jenkins æ§åˆ¶å™¨çš„æ“ä½œç³»ç»Ÿç”¨æˆ·å…·æœ‰è¯»å–å’Œå†™å…¥è¯¥ç›®å½•çš„æƒé™ï¼ˆå³ï¼Œ`chmod` å€¼ä¸º `0700` æˆ–ä½¿ç”¨é€‚å½“çš„æ–‡ä»¶å±æ€§ï¼‰ã€‚**ä¸»å¯†é’¥**ï¼ˆæœ‰æ—¶åœ¨å¯†ç å­¦æœ¯è¯­ä¸­ç§°ä¸º "å¯†é’¥åŠ å¯†å¯†é’¥"ï¼‰æ˜¯ **ä»¥æœªåŠ å¯†å½¢å¼å­˜å‚¨** åœ¨ Jenkins æ§åˆ¶å™¨æ–‡ä»¶ç³»ç»Ÿä¸­çš„ **`$JENKINS_HOME/secrets/master.key`**ï¼Œè¿™å¹¶ä¸èƒ½ä¿æŠ¤ç›´æ¥è®¿é—®è¯¥æ–‡ä»¶çš„æ”»å‡»è€…ã€‚å¤§å¤šæ•°ç”¨æˆ·å’Œå¼€å‘äººå‘˜å°†é€šè¿‡ [Secret](https://javadoc.jenkins.io/byShortName/Secret) API é—´æ¥ä½¿ç”¨è¿™äº›åŠ å¯†å¯†é’¥ï¼Œä»¥åŠ å¯†é€šç”¨ç§˜å¯†æ•°æ®ï¼Œæˆ–é€šè¿‡å‡­è¯ APIã€‚å¯¹äºå¯¹å¯†ç å­¦æ„Ÿå…´è¶£çš„äººï¼ŒJenkins åœ¨å¯†ç å—é“¾ (CBC) æ¨¡å¼ä¸‹ä½¿ç”¨ AESï¼Œå¸¦æœ‰ PKCS#5 å¡«å……å’Œéšæœº IV æ¥åŠ å¯†å­˜å‚¨åœ¨ `$JENKINS_HOME/secrets/` ä¸­çš„ [CryptoConfidentialKey](https://javadoc.jenkins.io/byShortName/CryptoConfidentialKey) å®ä¾‹ï¼Œæ–‡ä»¶åå¯¹åº”äºå®ƒä»¬çš„ `CryptoConfidentialKey` idã€‚å¸¸è§çš„å¯†é’¥ id åŒ…æ‹¬ï¼š

* `hudson.util.Secret`ï¼šç”¨äºé€šç”¨ç§˜å¯†ï¼›
* `com.cloudbees.plugins.credentials.SecretBytes.KEY`ï¼šç”¨äºæŸäº›å‡­è¯ç±»å‹ï¼›
* `jenkins.model.Jenkins.crumbSalt`ï¼šç”± [CSRF ä¿æŠ¤æœºåˆ¶](https://www.jenkins.io/doc/book/managing/security/#cross-site-request-forgery) ä½¿ç”¨ï¼›ä»¥åŠ

### å‡­è¯è®¿é—®

å‡­è¯å¯ä»¥ **ä½œç”¨äºå…¨å±€æä¾›è€…** (`/credentials/`)ï¼Œä»»ä½•é…ç½®çš„é¡¹ç›®éƒ½å¯ä»¥è®¿é—®ï¼Œæˆ–è€…å¯ä»¥ä½œç”¨äº **ç‰¹å®šé¡¹ç›®** (`/job/<project-name>/configure`)ï¼Œå› æ­¤ä»…å¯ä»ç‰¹å®šé¡¹ç›®è®¿é—®ã€‚

æ ¹æ® [**æ–‡æ¡£**](https://www.jenkins.io/blog/2019/02/21/credentials-masking/)ï¼šåœ¨ä½œç”¨åŸŸå†…çš„å‡­è¯å¯ä»¥æ— é™åˆ¶åœ°æä¾›ç»™ç®¡é“ã€‚ä¸ºäº† **é˜²æ­¢åœ¨æ„å»ºæ—¥å¿—ä¸­æ„å¤–æš´éœ²**ï¼Œå‡­è¯åœ¨å¸¸è§„è¾“å‡ºä¸­è¢« **å±è”½**ï¼Œå› æ­¤ `env`ï¼ˆLinuxï¼‰æˆ– `set`ï¼ˆWindowsï¼‰çš„è°ƒç”¨ï¼Œæˆ–æ‰“å°å…¶ç¯å¢ƒæˆ–å‚æ•°çš„ç¨‹åºå°† **ä¸ä¼šåœ¨æ„å»ºæ—¥å¿—ä¸­å‘æœ¬ä¸åº”æœ‰æƒè®¿é—®å‡­è¯çš„ç”¨æˆ·æ­ç¤ºå®ƒä»¬**ã€‚

**è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæ”»å‡»è€…éœ€è¦ï¼Œä¾‹å¦‚ï¼Œå°†å‡­è¯è¿›è¡Œ base64 ç¼–ç ä»¥æå–å‡­è¯ã€‚**

## å‚è€ƒ

* [https://www.jenkins.io/doc/book/security/managing-security/](https://www.jenkins.io/doc/book/security/managing-security/)
* [https://www.jenkins.io/doc/book/managing/nodes/](https://www.jenkins.io/doc/book/managing/nodes/)
* [https://www.jenkins.io/doc/developer/security/secrets/](https://www.jenkins.io/doc/developer/security/secrets/)
* [https://www.jenkins.io/blog/2019/02/21/credentials-masking/](https://www.jenkins.io/blog/2019/02/21/credentials-masking/)
* [https://www.jenkins.io/doc/book/managing/security/#cross-site-request-forgery](https://www.jenkins.io/doc/book/managing/security/#cross-site-request-forgery)
* [https://www.jenkins.io/doc/developer/security/secrets/#encryption-of-secrets-and-credentials](https://www.jenkins.io/doc/developer/security/secrets/#encryption-of-secrets-and-credentials)
* [https://www.jenkins.io/doc/book/managing/nodes/](https://www.jenkins.io/doc/book/managing/nodes/)

{% hint style="success" %}
å­¦ä¹ å’Œå®è·µ AWS é»‘å®¢æŠ€æœ¯ï¼š<img src="../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">[**HackTricks åŸ¹è®­ AWS çº¢é˜Ÿä¸“å®¶ (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">\
å­¦ä¹ å’Œå®è·µ GCP é»‘å®¢æŠ€æœ¯ï¼š<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks åŸ¹è®­ GCP çº¢é˜Ÿä¸“å®¶ (GRTE)**<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>æ”¯æŒ HackTricks</summary>

* æŸ¥çœ‹ [**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**Telegram ç¾¤ç»„**](https://t.me/peass) æˆ– **åœ¨ Twitter ä¸Šå…³æ³¨** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub ä»“åº“æäº¤ PR æ¥åˆ†äº«é»‘å®¢æŠ€å·§ã€‚

</details>
{% endhint %}
