# Podstawowe informacje o Jenkins

{% hint style="success" %}
Naucz si i wicz AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Naucz si i wicz GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Wspieraj HackTricks</summary>

* Sprawd藕 [**plany subskrypcji**](https://github.com/sponsors/carlospolop)!
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegram**](https://t.me/peass) lub **led藕** nas na **Twitterze**  [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Dziel si trikami hakerskimi, przesyajc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repozytori贸w na GitHubie.

</details>
{% endhint %}

## Dostp

### Nazwa u偶ytkownika + Haso

Najczstszym sposobem logowania si do Jenkins jest u偶ycie nazwy u偶ytkownika i hasa.

### Cookie

Jeli **autoryzowany cookie zostanie skradziony**, mo偶e by u偶yty do uzyskania dostpu do sesji u偶ytkownika. Cookie zazwyczaj nazywa si `JSESSIONID.*`. (U偶ytkownik mo偶e zakoczy wszystkie swoje sesje, ale najpierw musi dowiedzie si, 偶e cookie zostao skradzione).

### SSO/Plugins

Jenkins mo偶e by skonfigurowany za pomoc wtyczek, aby by **dostpny przez zewntrzne SSO**.

### Tokeny

**U偶ytkownicy mog generowa tokeny**, aby umo偶liwi aplikacjom podszywanie si pod nich za pomoc CLI lub REST API.

### Klucze SSH

Ten komponent zapewnia wbudowany serwer SSH dla Jenkins. Jest to alternatywny interfejs dla [Jenkins CLI](https://www.jenkins.io/doc/book/managing/cli/), a polecenia mog by wywoywane w ten spos贸b za pomoc dowolnego klienta SSH. (Z [dokumentacji](https://plugins.jenkins.io/sshd/))

## Autoryzacja

W `/configureSecurity` mo偶na **skonfigurowa metod autoryzacji Jenkins**. Istnieje kilka opcji:

* **Ka偶dy mo偶e robi wszystko**: Nawet anonimowy dostp mo偶e administrowa serwerem.
* **Tryb legacy**: Taki sam jak Jenkins <1.164. Jeli masz **rol "admin"**, otrzymasz **pen kontrol** nad systemem, a **w przeciwnym razie** (w tym **anonimowi** u偶ytkownicy) bdziesz mia **dostp tylko do odczytu**.
* **Zalogowani u偶ytkownicy mog robi wszystko**: W tym trybie ka偶dy **zalogowany u偶ytkownik ma pen kontrol** nad Jenkins. Jedynym u偶ytkownikiem, kt贸ry nie bdzie mia penej kontroli, jest **u偶ytkownik anonimowy**, kt贸ry ma tylko **dostp do odczytu**.
* **Bezpieczestwo oparte na macierzy**: Mo偶esz skonfigurowa **kto mo偶e robi co** w tabeli. Ka偶da **kolumna** reprezentuje **uprawnienie**. Ka偶dy **wiersz** **reprezentuje** **u偶ytkownika lub grup/rol**. Obejmuje to specjalnego u偶ytkownika '**anonimowy**', kt贸ry reprezentuje **niezalogowanych u偶ytkownik贸w**, oraz '**zalogowany**', kt贸ry reprezentuje **wszystkich zalogowanych u偶ytkownik贸w**.

![](<../../.gitbook/assets/image (149).png>)

* **Strategia autoryzacji oparta na macierzy projekt贸w:** Ten tryb jest **rozszerzeniem** "**Bezpieczestwa opartego na macierzy**", kt贸re pozwala na dodatkow macierz ACL **zdefiniowan dla ka偶dego projektu osobno.**
* **Strategia oparta na rolach:** Umo偶liwia definiowanie autoryzacji za pomoc **strategii opartej na rolach**. Zarzdzaj rolami w `/role-strategy`.

## **Realm bezpieczestwa**

W `/configureSecurity` mo偶na **skonfigurowa realm bezpieczestwa.** Domylnie Jenkins obsuguje kilka r贸偶nych realm贸w bezpieczestwa:

* **Delegowanie do kontenera servlet贸w**: Do **delegowania uwierzytelniania do kontenera servlet贸w uruchamiajcego kontroler Jenkins**, takiego jak [Jetty](https://www.eclipse.org/jetty/).
* **Wasna baza danych u偶ytkownik贸w Jenkins:** U偶yj **wbudowanego magazynu danych u偶ytkownik贸w Jenkins** do uwierzytelniania zamiast delegowania do zewntrznego systemu. Jest to domylnie wczone.
* **LDAP**: Delegowanie caego uwierzytelniania do skonfigurowanego serwera LDAP, w tym zar贸wno u偶ytkownik贸w, jak i grup.
* **Baza danych u偶ytkownik贸w/grup Unix**: **Deleguje uwierzytelnianie do bazowego systemu operacyjnego Unix** na kontrolerze Jenkins. Ten tryb pozwala r贸wnie偶 na ponowne u偶ycie grup Unix do autoryzacji.

Wtyczki mog dostarcza dodatkowe realmy bezpieczestwa, kt贸re mog by przydatne do wczenia Jenkins do istniejcych system贸w to偶samoci, takich jak:

* [Active Directory](https://plugins.jenkins.io/active-directory)
* [GitHub Authentication](https://plugins.jenkins.io/github-oauth)
* [Atlassian Crowd 2](https://plugins.jenkins.io/crowd2)

## Wzy Jenkins, Agenci i Wykonawcy

Definicje z [dokumentacji](https://www.jenkins.io/doc/book/managing/nodes/):

**Wzy** to **maszyny**, na kt贸rych **dziaaj agenci budowy**. Jenkins monitoruje ka偶dy podczony wze pod ktem miejsca na dysku, wolnej przestrzeni tymczasowej, wolnej pamici wymiany, czasu zegara/synchronizacji i czasu odpowiedzi. Wze jest wyczany, jeli kt贸rykolwiek z tych parametr贸w przekroczy skonfigurowany pr贸g.

**Agenci** **zarzdzaj** **wykonywaniem zada** w imieniu kontrolera Jenkins, **u偶ywajc wykonawc贸w**. Agent mo偶e u偶ywa dowolnego systemu operacyjnego, kt贸ry obsuguje Jav. Narzdzia wymagane do budowy i test贸w s instalowane na w藕le, na kt贸rym dziaa agent; mog **by instalowane bezporednio lub w kontenerze** (Docker lub Kubernetes). Ka偶dy **agent jest w istocie procesem z wasnym PID** na maszynie hosta.

**Wykonawca** to **slot do wykonywania zada**; w istocie jest to **wtek w agencie**. **Liczba wykonawc贸w** na w藕le definiuje liczb **jednoczesnych zada**, kt贸re mog by wykonywane na tym w藕le w danym momencie. Innymi sowy, okrela to **liczb jednoczesnych `etap贸w` Pipeline**, kt贸re mog by wykonywane na tym w藕le w danym momencie.

## Sekrety Jenkins

### Szyfrowanie sekret贸w i powiadcze

Definicja z [dokumentacji](https://www.jenkins.io/doc/developer/security/secrets/#encryption-of-secrets-and-credentials): Jenkins u偶ywa **AES do szyfrowania i ochrony sekret贸w**, powiadcze i ich odpowiednich kluczy szyfrowania. Te klucze szyfrowania s przechowywane w `$JENKINS_HOME/secrets/` wraz z kluczem g贸wnym u偶ywanym do ochrony tych kluczy. Ten katalog powinien by skonfigurowany tak, aby tylko u偶ytkownik systemu operacyjnego, na kt贸rym dziaa kontroler Jenkins, mia dostp do odczytu i zapisu do tego katalogu (tj. warto `chmod` `0700` lub u偶ycie odpowiednich atrybut贸w plik贸w). **Klucz g贸wny** (czasami nazywany "kluczem szyfrowania kluczy" w 偶argonie kryptograficznym) jest **przechowywany \_niezaszyfrowany\_** na systemie plik贸w kontrolera Jenkins w **`$JENKINS_HOME/secrets/master.key`**, co nie chroni przed atakujcymi z bezporednim dostpem do tego pliku. Wikszo u偶ytkownik贸w i deweloper贸w bdzie u偶ywa tych kluczy szyfrowania porednio za pomoc API [Secret](https://javadoc.jenkins.io/byShortName/Secret) do szyfrowania og贸lnych danych tajnych lub za pomoc API powiadcze. Dla ciekawych kryptografii, Jenkins u偶ywa AES w trybie acuchowym blok贸w szyfrowania (CBC) z paddingiem PKCS#5 i losowymi IV do szyfrowania instancji [CryptoConfidentialKey](https://javadoc.jenkins.io/byShortName/CryptoConfidentialKey), kt贸re s przechowywane w `$JENKINS_HOME/secrets/` z nazw pliku odpowiadajc ich identyfikatorowi `CryptoConfidentialKey`. Typowe identyfikatory kluczy obejmuj:

* `hudson.util.Secret`: u偶ywany do og贸lnych sekret贸w;
* `com.cloudbees.plugins.credentials.SecretBytes.KEY`: u偶ywany do niekt贸rych typ贸w powiadcze;
* `jenkins.model.Jenkins.crumbSalt`: u偶ywany przez [mechanizm ochrony CSRF](https://www.jenkins.io/doc/book/managing/security/#cross-site-request-forgery); oraz

### Dostp do powiadcze

Powiadczenia mog by **zakresowane do globalnych dostawc贸w** (`/credentials/`), kt贸re mog by dostpne przez ka偶dy skonfigurowany projekt, lub mog by zakresowane do **konkretnych projekt贸w** (`/job/<project-name>/configure`) i w zwizku z tym dostpne tylko z konkretnego projektu.

Wedug [**dokumentacji**](https://www.jenkins.io/blog/2019/02/21/credentials-masking/): Powiadczenia, kt贸re s w zakresie, s udostpniane pipeline bez ogranicze. Aby **zapobiec przypadkowemu ujawnieniu w logu budowy**, powiadczenia s **maskowane** w regularnym wyjciu, wic wywoanie `env` (Linux) lub `set` (Windows), lub programy drukujce swoje rodowisko lub parametry **nie ujawni ich w logu budowy** u偶ytkownikom, kt贸rzy w przeciwnym razie nie mieliby dostpu do powiadcze.

**Dlatego, aby wyeksfiltrowa powiadczenia, atakujcy musi na przykad zakodowa je w base64.**

## Referencje

* [https://www.jenkins.io/doc/book/security/managing-security/](https://www.jenkins.io/doc/book/security/managing-security/)
* [https://www.jenkins.io/doc/book/managing/nodes/](https://www.jenkins.io/doc/book/managing/nodes/)
* [https://www.jenkins.io/doc/developer/security/secrets/](https://www.jenkins.io/doc/developer/security/secrets/)
* [https://www.jenkins.io/blog/2019/02/21/credentials-masking/](https://www.jenkins.io/blog/2019/02/21/credentials-masking/)
* [https://www.jenkins.io/doc/book/managing/security/#cross-site-request-forgery](https://www.jenkins.io/doc/book/managing/security/#cross-site-request-forgery)
* [https://www.jenkins.io/doc/developer/security/secrets/#encryption-of-secrets-and-credentials](https://www.jenkins.io/doc/developer/security/secrets/#encryption-of-secrets-and-credentials)
* [https://www.jenkins.io/doc/book/managing/nodes/](https://www.jenkins.io/doc/book/managing/nodes/)

{% hint style="success" %}
Naucz si i wicz AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Naucz si i wicz GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Wspieraj HackTricks</summary>

* Sprawd藕 [**plany subskrypcji**](https://github.com/sponsors/carlospolop)!
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegram**](https://t.me/peass) lub **led藕** nas na **Twitterze**  [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Dziel si trikami hakerskimi, przesyajc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repozytori贸w na GitHubie.

</details>
{% endhint %}
