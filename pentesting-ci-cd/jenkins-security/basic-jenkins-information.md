# Informa√ß√µes B√°sicas do Jenkins

{% hint style="success" %}
Aprenda e pratique Hacking AWS:<img src="../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Aprenda e pratique Hacking GCP: <img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Confira os [**planos de assinatura**](https://github.com/sponsors/carlospolop)!
* **Junte-se ao** üí¨ [**grupo do Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga**-nos no **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe truques de hacking enviando PRs para os reposit√≥rios do** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
{% endhint %}

## Acesso

### Nome de Usu√°rio + Senha

A maneira mais comum de fazer login no Jenkins √© com um nome de usu√°rio ou uma senha.

### Cookie

Se um **cookie autorizado for roubado**, ele pode ser usado para acessar a sess√£o do usu√°rio. O cookie geralmente √© chamado de `JSESSIONID.*`. (Um usu√°rio pode encerrar todas as suas sess√µes, mas precisaria descobrir primeiro que um cookie foi roubado).

### SSO/Plugins

O Jenkins pode ser configurado usando plugins para ser **acess√≠vel via SSO de terceiros**.

### Tokens

**Os usu√°rios podem gerar tokens** para dar acesso a aplicativos para se passar por eles via CLI ou REST API.

### Chaves SSH

Este componente fornece um servidor SSH embutido para o Jenkins. √â uma interface alternativa para o [Jenkins CLI](https://www.jenkins.io/doc/book/managing/cli/), e os comandos podem ser invocados dessa forma usando qualquer cliente SSH. (Das [docs](https://plugins.jenkins.io/sshd/))

## Autoriza√ß√£o

Em `/configureSecurity` √© poss√≠vel **configurar o m√©todo de autoriza√ß√£o do Jenkins**. Existem v√°rias op√ß√µes:

* **Qualquer um pode fazer qualquer coisa**: At√© o acesso an√¥nimo pode administrar o servidor.
* **Modo legado**: Mesmo que o Jenkins <1.164. Se voc√™ tiver o **papel "admin"**, ter√° **controle total** sobre o sistema, e **caso contr√°rio** (incluindo usu√°rios **an√¥nimos**) voc√™ ter√° acesso **somente leitura**.
* **Usu√°rios logados podem fazer qualquer coisa**: Neste modo, cada **usu√°rio logado tem controle total** do Jenkins. O √∫nico usu√°rio que n√£o ter√° controle total √© o **usu√°rio an√¥nimo**, que s√≥ ter√° **acesso de leitura**.
* **Seguran√ßa baseada em matriz**: Voc√™ pode configurar **quem pode fazer o qu√™** em uma tabela. Cada **coluna** representa uma **permiss√£o**. Cada **linha** **representa** um **usu√°rio ou um grupo/papel.** Isso inclui um usu√°rio especial '**an√¥nimo**', que representa **usu√°rios n√£o autenticados**, bem como '**autenticado**', que representa **todos os usu√°rios autenticados**.

![](<../../.gitbook/assets/image (149).png>)

* **Estrat√©gia de Autoriza√ß√£o Baseada em Projeto:** Este modo √© uma **extens√£o** da "**seguran√ßa baseada em matriz**" que permite que uma matriz ACL adicional seja **definida para cada projeto separadamente.**
* **Estrat√©gia Baseada em Pap√©is:** Permite definir autoriza√ß√µes usando uma **estrat√©gia baseada em pap√©is**. Gerencie os pap√©is em `/role-strategy`.

## **Reino de Seguran√ßa**

Em `/configureSecurity` √© poss√≠vel **configurar o reino de seguran√ßa.** Por padr√£o, o Jenkins inclui suporte para alguns Reinos de Seguran√ßa diferentes:

* **Delegar para o cont√™iner de servlet**: Para **delegar a autentica√ß√£o a um cont√™iner de servlet executando o controlador Jenkins**, como [Jetty](https://www.eclipse.org/jetty/).
* **Banco de dados de usu√°rios pr√≥prio do Jenkins:** Use **o pr√≥prio armazenamento de dados de usu√°rios embutido do Jenkins** para autentica√ß√£o em vez de delegar a um sistema externo. Isso √© habilitado por padr√£o.
* **LDAP**: Delegar toda a autentica√ß√£o a um servidor LDAP configurado, incluindo usu√°rios e grupos.
* **Banco de dados de usu√°rios/grupos Unix**: **Delegar a autentica√ß√£o ao banco de dados de usu√°rios do sistema operacional Unix** subjacente no controlador Jenkins. Este modo tamb√©m permitir√° a reutiliza√ß√£o de grupos Unix para autoriza√ß√£o.

Plugins podem fornecer reinos de seguran√ßa adicionais que podem ser √∫teis para incorporar o Jenkins em sistemas de identidade existentes, como:

* [Active Directory](https://plugins.jenkins.io/active-directory)
* [Autentica√ß√£o GitHub](https://plugins.jenkins.io/github-oauth)
* [Atlassian Crowd 2](https://plugins.jenkins.io/crowd2)

## N√≥s, Agentes e Executores do Jenkins

Defini√ß√µes das [docs](https://www.jenkins.io/doc/book/managing/nodes/):

**N√≥s** s√£o as **m√°quinas** nas quais os **agentes de constru√ß√£o** s√£o executados. O Jenkins monitora cada n√≥ conectado em rela√ß√£o ao espa√ßo em disco, espa√ßo tempor√°rio livre, swap livre, tempo/sincroniza√ß√£o do rel√≥gio e tempo de resposta. Um n√≥ √© desconectado se qualquer um desses valores ultrapassar o limite configurado.

**Agentes** **gerenciam** a **execu√ß√£o de tarefas** em nome do controlador Jenkins usando **executores**. Um agente pode usar qualquer sistema operacional que suporte Java. Ferramentas necess√°rias para constru√ß√µes e testes s√£o instaladas no n√≥ onde o agente √© executado; elas podem **ser instaladas diretamente ou em um cont√™iner** (Docker ou Kubernetes). Cada **agente √© efetivamente um processo com seu pr√≥prio PID** na m√°quina host.

Um **executor** √© um **slot para execu√ß√£o de tarefas**; efetivamente, √© **uma thread no agente**. O **n√∫mero de executores** em um n√≥ define o n√∫mero de **tarefas concorrentes** que podem ser executadas nesse n√≥ ao mesmo tempo. Em outras palavras, isso determina o **n√∫mero de `stages` de Pipeline concorrentes** que podem ser executados nesse n√≥ ao mesmo tempo.

## Segredos do Jenkins

### Criptografia de Segredos e Credenciais

Defini√ß√£o das [docs](https://www.jenkins.io/doc/developer/security/secrets/#encryption-of-secrets-and-credentials): O Jenkins usa **AES para criptografar e proteger segredos**, credenciais e suas respectivas chaves de criptografia. Essas chaves de criptografia s√£o armazenadas em `$JENKINS_HOME/secrets/` junto com a chave mestre usada para proteger essas chaves. Este diret√≥rio deve ser configurado para que apenas o usu√°rio do sistema operacional sob o qual o controlador Jenkins est√° sendo executado tenha acesso de leitura e grava√ß√£o a este diret√≥rio (ou seja, um valor `chmod` de `0700` ou usando atributos de arquivo apropriados). A **chave mestre** (√†s vezes referida como "chave de criptografia" em jarg√£o criptogr√°fico) √© **armazenada \_n√£o criptografada\_** no sistema de arquivos do controlador Jenkins em **`$JENKINS_HOME/secrets/master.key`**, o que n√£o protege contra atacantes com acesso direto a esse arquivo. A maioria dos usu√°rios e desenvolvedores usar√° essas chaves de criptografia indiretamente, seja atrav√©s da API [Secret](https://javadoc.jenkins.io/byShortName/Secret) para criptografar dados secretos gen√©ricos ou atrav√©s da API de credenciais. Para os curiosos sobre criptografia, o Jenkins usa AES no modo de encadeamento de bloco de cifra (CBC) com preenchimento PKCS#5 e IVs aleat√≥rios para criptografar inst√¢ncias de [CryptoConfidentialKey](https://javadoc.jenkins.io/byShortName/CryptoConfidentialKey) que s√£o armazenadas em `$JENKINS_HOME/secrets/` com um nome de arquivo correspondente ao seu id de `CryptoConfidentialKey`. IDs de chave comuns incluem:

* `hudson.util.Secret`: usado para segredos gen√©ricos;
* `com.cloudbees.plugins.credentials.SecretBytes.KEY`: usado para alguns tipos de credenciais;
* `jenkins.model.Jenkins.crumbSalt`: usado pelo [mecanismo de prote√ß√£o CSRF](https://www.jenkins.io/doc/book/managing/security/#cross-site-request-forgery); e

### Acesso a Credenciais

As credenciais podem ser **escopadas para provedores globais** (`/credentials/`) que podem ser acessados por qualquer projeto configurado, ou podem ser escopadas para **projetos espec√≠ficos** (`/job/<project-name>/configure`) e, portanto, acess√≠veis apenas a partir do projeto espec√≠fico.

De acordo com [**as docs**](https://www.jenkins.io/blog/2019/02/21/credentials-masking/): As credenciais que est√£o em escopo s√£o disponibilizadas para o pipeline sem limita√ß√µes. Para **evitar exposi√ß√£o acidental no log de constru√ß√£o**, as credenciais s√£o **mascaradas** da sa√≠da regular, de modo que uma invoca√ß√£o de `env` (Linux) ou `set` (Windows), ou programas que imprimem seu ambiente ou par√¢metros **n√£o as revelariam no log de constru√ß√£o** para usu√°rios que n√£o teriam acesso √†s credenciais.

**√â por isso que, para exfiltrar as credenciais, um atacante precisa, por exemplo, codific√°-las em base64.**

## Refer√™ncias

* [https://www.jenkins.io/doc/book/security/managing-security/](https://www.jenkins.io/doc/book/security/managing-security/)
* [https://www.jenkins.io/doc/book/managing/nodes/](https://www.jenkins.io/doc/book/managing/nodes/)
* [https://www.jenkins.io/doc/developer/security/secrets/](https://www.jenkins.io/doc/developer/security/secrets/)
* [https://www.jenkins.io/blog/2019/02/21/credentials-masking/](https://www.jenkins.io/blog/2019/02/21/credentials-masking/)
* [https://www.jenkins.io/doc/book/managing/security/#cross-site-request-forgery](https://www.jenkins.io/doc/book/managing/security/#cross-site-request-forgery)
* [https://www.jenkins.io/doc/developer/security/secrets/#encryption-of-secrets-and-credentials](https://www.jenkins.io/doc/developer/security/secrets/#encryption-of-secrets-and-credentials)
* [https://www.jenkins.io/doc/book/managing/nodes/](https://www.jenkins.io/doc/book/managing/nodes/)

{% hint style="success" %}
Aprenda e pratique Hacking AWS:<img src="../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Aprenda e pratique Hacking GCP: <img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Confira os [**planos de assinatura**](https://github.com/sponsors/carlospolop)!
* **Junte-se ao** üí¨ [**grupo do Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga**-nos no **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe truques de hacking enviando PRs para os reposit√≥rios do** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
{% endhint %}
