# Osnovne informacije o Jenkins-u

{% hint style="success" %}
U캜ite i ve쬭ajte AWS Hacking:<img src="../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/image (1).png" alt="" data-size="line">\
U캜ite i ve쬭ajte GCP Hacking: <img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Podr코ka HackTricks-u</summary>

* Proverite [**planove pretplate**](https://github.com/sponsors/carlospolop)!
* **Pridru쬴te se** 游눫 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili **pratite** nas na **Twitter-u** 游냕 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podelite hakerske trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
{% endhint %}

## Pristup

### Korisni캜ko ime + Lozinka

Naj캜e코캖i na캜in prijavljivanja u Jenkins je putem korisni캜kog imena ili lozinke.

### Kola캜i캖

Ako se **autorizovani kola캜i캖 ukrade**, mo쬰 se koristiti za pristup sesiji korisnika. Kola캜i캖 se obi캜no naziva `JSESSIONID.*`. (Korisnik mo쬰 prekinuti sve svoje sesije, ali prvo mora da sazna da je kola캜i캖 ukraden).

### SSO/Pluginovi

Jenkins se mo쬰 konfigurisati pomo캖u pluginova da bude **dostupan putem SSO tre캖e strane**.

### Tokeni

**Korisnici mogu generisati tokene** kako bi omogu캖ili pristup aplikacijama da ih imituju putem CLI ili REST API.

### SSH Klju캜evi

Ova komponenta pru쬬 ugra캠eni SSH server za Jenkins. To je alternativno su캜elje za [Jenkins CLI](https://www.jenkins.io/doc/book/managing/cli/), a komande se mogu pozivati na ovaj na캜in koriste캖i bilo koji SSH klijent. (Iz [dokumentacije](https://plugins.jenkins.io/sshd/))

## Autorizacija

U `/configureSecurity` mogu캖e je **konfigurisati metodu autorizacije Jenkins-a**. Postoji nekoliko opcija:

* **Svako mo쬰 raditi 코ta 쬰li**: 캛ak i anonimni pristup mo쬰 administrirati server.
* **Legacy mode**: Isto kao Jenkins <1.164. Ako imate **"admin" ulogu**, dobi캖ete **potpunu kontrolu** nad sistemom, a **ina캜e** (uklju캜uju캖i **anonimne** korisnike) ima캖ete **pristup za 캜itanje**.
* **Prijavljeni korisnici mogu raditi 코ta 쬰le**: U ovom re쬴mu, svaki **prijavljeni korisnik dobija potpunu kontrolu** nad Jenkins-om. Jedini korisnik koji ne캖e imati potpunu kontrolu je **anonimni korisnik**, koji dobija samo **pristup za 캜itanje**.
* **Matrix-based security**: Mo쬰te konfigurisati **ko mo쬰 raditi 코ta** u tabeli. Svaki **stubac** predstavlja **dozvolu**. Svaki **red** **predstavlja** **korisnika ili grupu/ulogu.** Ovo uklju캜uje posebnog korisnika '**anonimni**', koji predstavlja **neautentifikovane korisnike**, kao i '**autentifikovani**', koji predstavlja **sve autentifikovane korisnike**.

![](<../../.gitbook/assets/image (149).png>)

* **Strategija autorizacije zasnovana na projektima:** Ovaj re쬴m je **pro코irenje** na "**Matrix-based security**" koje omogu캖ava dodatnu ACL matricu da bude **definisana za svaki projekat posebno.**
* **Strategija zasnovana na rolama:** Omogu캖ava definisanje autorizacija koriste캖i **strategiju zasnovanu na rolama**. Upravljajte rolama u `/role-strategy`.

## **Sigurnosni domen**

U `/configureSecurity` mogu캖e je **konfigurisati sigurnosni domen.** Po defaultu, Jenkins uklju캜uje podr코ku za nekoliko razli캜itih sigurnosnih domena:

* **Delegirati servlet kontejneru**: Za **delegiranje autentifikacije servlet kontejneru koji pokre캖e Jenkins kontroler**, kao 코to je [Jetty](https://www.eclipse.org/jetty/).
* **Jenkins-ova vlastita baza korisnika:** Koristite **Jenkins-ovu ugra캠enu bazu podataka korisnika** za autentifikaciju umesto delegiranja na eksterni sistem. Ovo je omogu캖eno po defaultu.
* **LDAP**: Delegirati svu autentifikaciju na konfigurisan LDAP server, uklju캜uju캖i i korisnike i grupe.
* **Unix baza korisnika/grupa**: **Delegira autentifikaciju na osnovnu Unix** OS nivo bazu korisnika na Jenkins kontroleru. Ovaj re쬴m 캖e tako캠e omogu캖iti ponovnu upotrebu Unix grupa za autorizaciju.

Pluginovi mogu pru쬴ti dodatne sigurnosne domene koji mogu biti korisni za uklju캜ivanje Jenkins-a u postoje캖e identitetske sisteme, kao 코to su:

* [Active Directory](https://plugins.jenkins.io/active-directory)
* [GitHub Authentication](https://plugins.jenkins.io/github-oauth)
* [Atlassian Crowd 2](https://plugins.jenkins.io/crowd2)

## Jenkins 캛vorovi, Agenti i Izvr코ioci

Definicije iz [dokumentacije](https://www.jenkins.io/doc/book/managing/nodes/):

**캛vorovi** su **ma코ine** na kojima se **agenti za izgradnju pokre캖u**. Jenkins prati svaki priklju캜eni 캜vor za slobodan prostor na disku, slobodan temp prostor, slobodan swap, vreme/sinkronizaciju sata i vreme odgovora. 캛vor se uzima offline ako bilo koja od ovih vrednosti pre캠e konfigurisani prag.

**Agenti** **upravljaju** **izvr코enjem zadataka** u ime Jenkins kontrolera koriste캖i **izvr코ioce**. Agent mo쬰 koristiti bilo koji operativni sistem koji podr쬬va Java. Alati potrebni za izgradnje i testove su instalirani na 캜voru na kojem agent radi; mogu se **instalirati direktno ili u kontejneru** (Docker ili Kubernetes). Svaki **agent je zapravo proces sa svojim PID-om** na host ma코ini.

**Izvr코ilac** je **slot za izvr코enje zadataka**; zapravo, to je **nit u agentu**. **Broj izvr코ilaca** na 캜voru defini코e broj **paralelnih zadataka** koji se mogu izvr코iti na tom 캜voru u jednom trenutku. Drugim re캜ima, ovo odre캠uje **broj paralelnih Pipeline `stages`** koji mogu izvr코iti na tom 캜voru u jednom trenutku.

## Jenkins Tajne

### Enkripcija Tajni i Akreditiva

Definicija iz [dokumentacije](https://www.jenkins.io/doc/developer/security/secrets/#encryption-of-secrets-and-credentials): Jenkins koristi **AES za enkripciju i za코titu tajni**, akreditiva i njihovih odgovaraju캖ih klju캜eva za enkripciju. Ovi klju캜evi za enkripciju se 캜uvaju u `$JENKINS_HOME/secrets/` zajedno sa glavnim klju캜em koji se koristi za za코titu navedenih klju캜eva. Ovaj direktorijum treba konfigurisati tako da samo operativni sistem korisnik pod kojim se Jenkins kontroler pokre캖e ima pristup za 캜itanje i pisanje u ovaj direktorijum (tj. `chmod` vrednost `0700` ili kori코캖enje odgovaraju캖ih atributa datoteka). **Glavni klju캜** (ponekad nazvan "klju캜 za enkripciju" u kripto쬬rgonu) je **pohranjen \_nekriptovan**\_ na datote캜nom sistemu Jenkins kontrolera u **`$JENKINS_HOME/secrets/master.key`** 코to ne 코titi od napada캜a sa direktnim pristupom toj datoteci. Ve캖ina korisnika i programera 캖e koristiti ove klju캜eve za enkripciju indirektno putem [Secret](https://javadoc.jenkins.io/byShortName/Secret) API za enkripciju generi캜kih tajnih podataka ili putem API za akreditive. Za kriptozainteresovane, Jenkins koristi AES u re쬴mu blokovne enkripcije (CBC) sa PKCS#5 punjenjem i nasumi캜nim IV-ima za enkripciju instanci [CryptoConfidentialKey](https://javadoc.jenkins.io/byShortName/CryptoConfidentialKey) koje se 캜uvaju u `$JENKINS_HOME/secrets/` sa imenom datoteke koje odgovara njihovom `CryptoConfidentialKey` id. Uobi캜ajeni id-ovi klju캜eva uklju캜uju:

* `hudson.util.Secret`: kori코캖en za generi캜ke tajne;
* `com.cloudbees.plugins.credentials.SecretBytes.KEY`: kori코캖en za neke tipove akreditiva;
* `jenkins.model.Jenkins.crumbSalt`: kori코캖en od strane [CSRF za코titnog mehanizma](https://www.jenkins.io/doc/book/managing/security/#cross-site-request-forgery); i

### Pristup Akreditivima

Akreditivi mogu biti **ograni캜eni na globalne provajdere** (`/credentials/`) kojima mo쬰 pristupiti bilo koji konfigurisan projekat, ili mogu biti ograni캜eni na **specifi캜ne projekte** (`/job/<project-name>/configure`) i stoga dostupni samo iz specifi캜nog projekta.

Prema [**dokumentaciji**](https://www.jenkins.io/blog/2019/02/21/credentials-masking/): Akreditivi koji su u opsegu su dostupni za pipeline bez ograni캜enja. Da bi se **spre캜ilo slu캜ajno izlaganje u logu izgradnje**, akreditivi su **maskirani** iz redovnog izlaza, tako da poziv `env` (Linux) ili `set` (Windows), ili programi koji 코tampaju svoje okru쬰nje ili parametre ne bi **otkrili njih u logu izgradnje** korisnicima koji ina캜e ne bi imali pristup akreditivima.

**Zato napada캜 treba, na primer, da ih base64 kodira kako bi ih eksfiltrirao.**

## Reference

* [https://www.jenkins.io/doc/book/security/managing-security/](https://www.jenkins.io/doc/book/security/managing-security/)
* [https://www.jenkins.io/doc/book/managing/nodes/](https://www.jenkins.io/doc/book/managing/nodes/)
* [https://www.jenkins.io/doc/developer/security/secrets/](https://www.jenkins.io/doc/developer/security/secrets/)
* [https://www.jenkins.io/blog/2019/02/21/credentials-masking/](https://www.jenkins.io/blog/2019/02/21/credentials-masking/)
* [https://www.jenkins.io/doc/book/managing/security/#cross-site-request-forgery](https://www.jenkins.io/doc/book/managing/security/#cross-site-request-forgery)
* [https://www.jenkins.io/doc/developer/security/secrets/#encryption-of-secrets-and-credentials](https://www.jenkins.io/doc/developer/security/secrets/#encryption-of-secrets-and-credentials)
* [https://www.jenkins.io/doc/book/managing/nodes/](https://www.jenkins.io/doc/book/managing/nodes/)

{% hint style="success" %}
U캜ite i ve쬭ajte AWS Hacking:<img src="../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/image (1).png" alt="" data-size="line">\
U캜ite i ve쬭ajte GCP Hacking: <img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Podr코ka HackTricks-u</summary>

* Proverite [**planove pretplate**](https://github.com/sponsors/carlospolop)!
* **Pridru쬴te se** 游눫 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili **pratite** nas na **Twitter-u** 游냕 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podelite hakerske trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
{% endhint %}
