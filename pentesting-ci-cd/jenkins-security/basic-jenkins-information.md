# Podstawowe informacje o Jenkinsie

{% hint style="success" %}
Ucz si i wicz Hacking AWS:<img src="../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Ucz si i wicz Hacking GCP: <img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Wsparcie dla HackTricks</summary>

* Sprawd藕 [**plany subskrypcyjne**](https://github.com/sponsors/carlospolop)!
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegram**](https://t.me/peass) lub **led藕** nas na **Twitterze**  [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podziel si sztuczkami hackingowymi, przesyajc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repozytori贸w github.

</details>
{% endhint %}

## Dostp

### Nazwa u偶ytkownika + Haso

Najczstszy spos贸b logowania do Jenkins to u偶ycie nazwy u偶ytkownika lub hasa.

### Cookie

Jeli **autoryzowane cookie zostanie skradzione**, mo偶e by u偶yte do uzyskania dostpu do sesji u偶ytkownika. Cookie zazwyczaj nazywa si `JSESSIONID.*`. (U偶ytkownik mo偶e zakoczy wszystkie swoje sesje, ale najpierw musi si dowiedzie, 偶e cookie zostao skradzione).

### SSO/Wtyczki

Jenkins mo偶e by skonfigurowany za pomoc wtyczek, aby by **dostpnym przez SSO stron trzecich**.

### Tokeny

**U偶ytkownicy mog generowa tokeny**, aby da dostp do aplikacji, aby je imitowa za pomoc CLI lub REST API.

### Klucze SSH

Ten komponent zapewnia wbudowany serwer SSH dla Jenkins. Jest to alternatywne interfejs dla [Jenkins CLI](https://www.jenkins.io/doc/book/managing/cli/), a polecenia mog by wywoywane w ten spos贸b za pomoc dowolnego klienta SSH. (Z [dokumentacji](https://plugins.jenkins.io/sshd/))

## Autoryzacja

W `/configureSecurity` mo偶na **skonfigurowa metod autoryzacji Jenkins**. Istnieje kilka opcji:

* **Ka偶dy mo偶e robi cokolwiek**: Nawet dostp anonimowy mo偶e administrowa serwerem.
* **Tryb dziedziczony**: Tak samo jak Jenkins <1.164. Jeli masz **rol "admin"**, otrzymasz **pen kontrol** nad systemem, a **w przeciwnym razie** (w tym **u偶ytkownicy anonimowi**) bdziesz mia **dostp do odczytu**.
* **Zalogowani u偶ytkownicy mog robi cokolwiek**: W tym trybie ka偶dy **zalogowany u偶ytkownik ma pen kontrol** nad Jenkins. Jedynym u偶ytkownikiem, kt贸ry nie bdzie mia penej kontroli, jest **u偶ytkownik anonimowy**, kt贸ry ma tylko **dostp do odczytu**.
* **Bezpieczestwo oparte na macierzy**: Mo偶esz skonfigurowa **kto mo偶e robi co** w tabeli. Ka偶da **kolumna** reprezentuje **uprawnienie**. Ka偶dy **wiersz** **reprezentuje** **u偶ytkownika lub grup/rol.** Obejmuje to specjalnego u偶ytkownika '**anonimowy**', kt贸ry reprezentuje **u偶ytkownik贸w nieautoryzowanych**, a tak偶e '**autoryzowany**', kt贸ry reprezentuje **wszystkich u偶ytkownik贸w autoryzowanych**.

![](<../../.gitbook/assets/image (149).png>)

* **Strategia autoryzacji oparta na projektach:** Ten tryb jest **rozszerzeniem** do "**Bezpieczestwa opartego na macierzy**", kt贸re pozwala na **definiowanie dodatkowej macierzy ACL dla ka偶dego projektu osobno.**
* **Strategia oparta na rolach:** Umo偶liwia definiowanie autoryzacji za pomoc **strategii opartej na rolach**. Zarzdzaj rolami w `/role-strategy`.

## **Kr贸lestwo bezpieczestwa**

W `/configureSecurity` mo偶na **skonfigurowa kr贸lestwo bezpieczestwa.** Domylnie Jenkins zawiera wsparcie dla kilku r贸偶nych Kr贸lestw Bezpieczestwa:

* **Delegowanie do kontenera servlet贸w**: Do **delegowania autoryzacji do kontenera servlet贸w uruchamiajcego kontroler Jenkins**, takiego jak [Jetty](https://www.eclipse.org/jetty/).
* **Wasna baza danych u偶ytkownik贸w Jenkins:** U偶yj **wbudowanej bazy danych u偶ytkownik贸w Jenkins** do autoryzacji zamiast delegowa do zewntrznego systemu. Jest to wczone domylnie.
* **LDAP**: Deleguj ca autoryzacj do skonfigurowanego serwera LDAP, w tym zar贸wno u偶ytkownik贸w, jak i grupy.
* **Baza danych u偶ytkownik贸w/grup Unix**: **Deleguje autoryzacj do podstawowej bazy danych u偶ytkownik贸w Unix** na kontrolerze Jenkins. Ten tryb pozwoli r贸wnie偶 na ponowne wykorzystanie grup Unix do autoryzacji.

Wtyczki mog zapewni dodatkowe kr贸lestwa bezpieczestwa, kt贸re mog by przydatne do wczenia Jenkins w istniejce systemy to偶samoci, takie jak:

* [Active Directory](https://plugins.jenkins.io/active-directory)
* [GitHub Authentication](https://plugins.jenkins.io/github-oauth)
* [Atlassian Crowd 2](https://plugins.jenkins.io/crowd2)

## Wzy, agenci i wykonawcy Jenkins

Definicje z [dokumentacji](https://www.jenkins.io/doc/book/managing/nodes/):

**Wzy** to **maszyny**, na kt贸rych dziaaj **agenci budowy**. Jenkins monitoruje ka偶dy podczony wze pod ktem miejsca na dysku, wolnego miejsca tymczasowego, wolnej pamici swap, czasu zegara/synchronizacji i czasu odpowiedzi. Wze jest wyczany, jeli jakakolwiek z tych wartoci przekroczy skonfigurowany pr贸g.

**Agenci** **zarzdzaj** **wykonywaniem zada** w imieniu kontrolera Jenkins, **u偶ywajc wykonawc贸w**. Agent mo偶e u偶ywa dowolnego systemu operacyjnego, kt贸ry obsuguje Jav. Narzdzia wymagane do budowy i test贸w s instalowane na w藕le, na kt贸rym dziaa agent; mog by **zainstalowane bezporednio lub w kontenerze** (Docker lub Kubernetes). Ka偶dy **agent jest w rzeczywistoci procesem z wasnym PID** na maszynie gospodarza.

**Wykonawca** to **slot do wykonywania zada**; w rzeczywistoci jest to **wtek w agencie**. **Liczba wykonawc贸w** na w藕le definiuje liczb **r贸wnolegych zada**, kt贸re mog by wykonywane na tym w藕le w danym czasie. Innymi sowy, okrela to **liczb r贸wnolegych `stages` Pipeline**, kt贸re mog by wykonywane na tym w藕le w danym czasie.

## Sekrety Jenkins

### Szyfrowanie sekret贸w i powiadcze

Definicja z [dokumentacji](https://www.jenkins.io/doc/developer/security/secrets/#encryption-of-secrets-and-credentials): Jenkins u偶ywa **AES do szyfrowania i ochrony sekret贸w**, powiadcze i ich odpowiednich kluczy szyfrujcych. Te klucze szyfrujce s przechowywane w `$JENKINS_HOME/secrets/` wraz z kluczem g贸wnym u偶ywanym do ochrony tych kluczy. Ten katalog powinien by skonfigurowany tak, aby tylko u偶ytkownik systemu operacyjnego, na kt贸rym dziaa kontroler Jenkins, mia dostp do odczytu i zapisu do tego katalogu (tj. warto `chmod` wynoszca `0700` lub u偶ywajc odpowiednich atrybut贸w plik贸w). **Klucz g贸wny** (czasami nazywany "kluczem szyfrujcym" w kryptografii) jest **przechowywany \_nieszyfrowany**\_ w systemie plik贸w kontrolera Jenkins w **`$JENKINS_HOME/secrets/master.key`**, co nie chroni przed atakujcymi majcymi bezporedni dostp do tego pliku. Wikszo u偶ytkownik贸w i deweloper贸w bdzie u偶ywa tych kluczy szyfrujcych porednio za pomoc API [Secret](https://javadoc.jenkins.io/byShortName/Secret) do szyfrowania og贸lnych danych sekret贸w lub przez API powiadcze. Dla ciekawskich kryptograficznie, Jenkins u偶ywa AES w trybie acucha blok贸w szyfrujcych (CBC) z wypenieniem PKCS#5 i losowymi IV do szyfrowania instancji [CryptoConfidentialKey](https://javadoc.jenkins.io/byShortName/CryptoConfidentialKey), kt贸re s przechowywane w `$JENKINS_HOME/secrets/` z nazw pliku odpowiadajc ich identyfikatorowi `CryptoConfidentialKey`. Powszechne identyfikatory kluczy obejmuj:

* `hudson.util.Secret`: u偶ywany do og贸lnych sekret贸w;
* `com.cloudbees.plugins.credentials.SecretBytes.KEY`: u偶ywany dla niekt贸rych typ贸w powiadcze;
* `jenkins.model.Jenkins.crumbSalt`: u偶ywany przez [mechanizm ochrony CSRF](https://www.jenkins.io/doc/book/managing/security/#cross-site-request-forgery); oraz

### Dostp do powiadcze

Powiadczenia mog by **ograniczone do globalnych dostawc贸w** (`/credentials/`), kt贸re mog by dostpne przez dowolny skonfigurowany projekt, lub mog by ograniczone do **konkretnych projekt贸w** (`/job/<project-name>/configure`), a zatem dostpne tylko z konkretnego projektu.

Zgodnie z [**dokumentacj**](https://www.jenkins.io/blog/2019/02/21/credentials-masking/): Powiadczenia, kt贸re s w zakresie, s udostpniane potokowi bez ogranicze. Aby **zapobiec przypadkowemu ujawnieniu w logu budowy**, powiadczenia s **ukryte** przed regularnym wyjciem, wic wywoanie `env` (Linux) lub `set` (Windows), lub programy drukujce swoje rodowisko lub parametry **nie ujawni ich w logu budowy** u偶ytkownikom, kt贸rzy w przeciwnym razie nie mieliby dostpu do powiadcze.

**Dlatego, aby wyeksportowa powiadczenia, atakujcy musi na przykad zakodowa je w base64.**

## Odnoniki

* [https://www.jenkins.io/doc/book/security/managing-security/](https://www.jenkins.io/doc/book/security/managing-security/)
* [https://www.jenkins.io/doc/book/managing/nodes/](https://www.jenkins.io/doc/book/managing/nodes/)
* [https://www.jenkins.io/doc/developer/security/secrets/](https://www.jenkins.io/doc/developer/security/secrets/)
* [https://www.jenkins.io/blog/2019/02/21/credentials-masking/](https://www.jenkins.io/blog/2019/02/21/credentials-masking/)
* [https://www.jenkins.io/doc/book/managing/security/#cross-site-request-forgery](https://www.jenkins.io/doc/book/managing/security/#cross-site-request-forgery)
* [https://www.jenkins.io/doc/developer/security/secrets/#encryption-of-secrets-and-credentials](https://www.jenkins.io/doc/developer/security/secrets/#encryption-of-secrets-and-credentials)
* [https://www.jenkins.io/doc/book/managing/nodes/](https://www.jenkins.io/doc/book/managing/nodes/)

{% hint style="success" %}
Ucz si i wicz Hacking AWS:<img src="../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Ucz si i wicz Hacking GCP: <img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Wsparcie dla HackTricks</summary>

* Sprawd藕 [**plany subskrypcyjne**](https://github.com/sponsors/carlospolop)!
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegram**](https://t.me/peass) lub **led藕** nas na **Twitterze**  [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podziel si sztuczkami hackingowymi, przesyajc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repozytori贸w github.

</details>
{% endhint %}
