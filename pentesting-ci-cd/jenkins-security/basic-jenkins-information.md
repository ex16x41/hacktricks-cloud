# Grundlegende Jenkins-Informationen

{% hint style="success" %}
Lernen & √ºben Sie AWS Hacking:<img src="../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Lernen & √ºben Sie GCP Hacking: <img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Unterst√ºtzen Sie HackTricks</summary>

* √úberpr√ºfen Sie die [**Abonnementpl√§ne**](https://github.com/sponsors/carlospolop)!
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teilen Sie Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repos senden.

</details>
{% endhint %}

## Zugriff

### Benutzername + Passwort

Der h√§ufigste Weg, sich bei Jenkins anzumelden, ist mit einem Benutzernamen oder einem Passwort.

### Cookie

Wenn ein **autorisierter Cookie gestohlen wird**, kann er verwendet werden, um auf die Sitzung des Benutzers zuzugreifen. Der Cookie wird normalerweise `JSESSIONID.*` genannt. (Ein Benutzer kann alle seine Sitzungen beenden, aber er m√ºsste zuerst herausfinden, dass ein Cookie gestohlen wurde).

### SSO/Plugins

Jenkins kann mit Plugins konfiguriert werden, um **√ºber ein Drittanbieter-SSO zug√§nglich zu sein**.

### Tokens

**Benutzer k√∂nnen Tokens generieren**, um Anwendungen den Zugriff zu gew√§hren, um sie √ºber CLI oder REST API zu impersonifizieren.

### SSH-Schl√ºssel

Diese Komponente bietet einen integrierten SSH-Server f√ºr Jenkins. Es ist eine alternative Schnittstelle f√ºr die [Jenkins CLI](https://www.jenkins.io/doc/book/managing/cli/), und Befehle k√∂nnen auf diese Weise mit jedem SSH-Client aufgerufen werden. (Aus den [Docs](https://plugins.jenkins.io/sshd/))

## Autorisierung

In `/configureSecurity` ist es m√∂glich, die **Autorisierungsmethode von Jenkins zu konfigurieren**. Es gibt mehrere Optionen:

* **Jeder kann alles tun**: Sogar anonymer Zugriff kann den Server verwalten.
* **Legacy-Modus**: Gleich wie Jenkins <1.164. Wenn Sie die **"Admin"-Rolle** haben, erhalten Sie **vollst√§ndige Kontrolle** √ºber das System, und **ansonsten** (einschlie√ülich **anonymer** Benutzer) haben Sie **Lesezugriff**.
* **Eingeloggte Benutzer k√∂nnen alles tun**: In diesem Modus erh√§lt jeder **eingeloggte Benutzer vollst√§ndige Kontrolle** √ºber Jenkins. Der einzige Benutzer, der keine vollst√§ndige Kontrolle hat, ist der **anonyme Benutzer**, der nur **Lesezugriff** erh√§lt.
* **Matrix-basierte Sicherheit**: Sie k√∂nnen konfigurieren, **wer was tun kann** in einer Tabelle. Jede **Spalte** repr√§sentiert eine **Berechtigung**. Jede **Zeile** **repr√§sentiert** einen **Benutzer oder eine Gruppe/Rolle.** Dies umfasst einen speziellen Benutzer '**anonym**', der **nicht authentifizierte Benutzer** repr√§sentiert, sowie '**authentifiziert**', der **alle authentifizierten Benutzer** repr√§sentiert.

![](<../../.gitbook/assets/image (149).png>)

* **Projektbasierte Matrix-Autorisierungsstrategie:** Dieser Modus ist eine **Erweiterung** der "**Matrix-basierten Sicherheit**", die es erm√∂glicht, zus√§tzliche ACL-Matrizen **f√ºr jedes Projekt separat zu definieren.**
* **Rollenbasierte Strategie:** Erm√∂glicht die Definition von Berechtigungen mit einer **rollenbasierten Strategie**. Verwalten Sie die Rollen in `/role-strategy`.

## **Sicherheitsbereich**

In `/configureSecurity` ist es m√∂glich, den **Sicherheitsbereich zu konfigurieren.** Standardm√§√üig unterst√ºtzt Jenkins einige verschiedene Sicherheitsbereiche:

* **An Servlet-Container delegieren**: F√ºr **die Authentifizierung an einen Servlet-Container, der den Jenkins-Controller ausf√ºhrt**, wie [Jetty](https://www.eclipse.org/jetty/).
* **Jenkins eigene Benutzerdatenbank:** Verwenden Sie **Jenkins eigene integrierte Benutzerdatenbank** zur Authentifizierung, anstatt an ein externes System zu delegieren. Dies ist standardm√§√üig aktiviert.
* **LDAP**: Delegieren Sie die gesamte Authentifizierung an einen konfigurierten LDAP-Server, einschlie√ülich sowohl Benutzer als auch Gruppen.
* **Unix-Benutzer-/Gruppendatenbank**: **Delegiert die Authentifizierung an die zugrunde liegende Unix**-OS-Benutzerdatenbank auf dem Jenkins-Controller. Dieser Modus erm√∂glicht auch die Wiederverwendung von Unix-Gruppen f√ºr die Autorisierung.

Plugins k√∂nnen zus√§tzliche Sicherheitsbereiche bereitstellen, die n√ºtzlich sein k√∂nnen, um Jenkins in bestehende Identit√§tssysteme zu integrieren, wie zum Beispiel:

* [Active Directory](https://plugins.jenkins.io/active-directory)
* [GitHub-Authentifizierung](https://plugins.jenkins.io/github-oauth)
* [Atlassian Crowd 2](https://plugins.jenkins.io/crowd2)

## Jenkins-Knoten, -Agenten & -Executoren

Definitionen aus den [Docs](https://www.jenkins.io/doc/book/managing/nodes/):

**Knoten** sind die **Maschinen**, auf denen die Build-**Agenten laufen**. Jenkins √ºberwacht jeden angeschlossenen Knoten auf Speicherplatz, freien tempor√§ren Speicher, freien Swap, Uhrzeit/Synchronisation und Reaktionszeit. Ein Knoten wird offline genommen, wenn einer dieser Werte au√üerhalb des konfigurierten Schwellenwerts liegt.

**Agenten** **verwalten** die **Aufgabenausf√ºhrung** im Auftrag des Jenkins-Controllers, indem sie **Executoren** verwenden. Ein Agent kann jedes Betriebssystem verwenden, das Java unterst√ºtzt. Werkzeuge, die f√ºr Builds und Tests erforderlich sind, werden auf dem Knoten installiert, auf dem der Agent l√§uft; sie k√∂nnen **direkt oder in einem Container** (Docker oder Kubernetes) installiert werden. Jeder **Agent ist effektiv ein Prozess mit seiner eigenen PID** auf der Hostmaschine.

Ein **Executor** ist ein **Slot f√ºr die Ausf√ºhrung von Aufgaben**; effektiv ist es **ein Thread im Agenten**. Die **Anzahl der Executor** auf einem Knoten definiert die Anzahl der **gleichzeitigen Aufgaben**, die zu einem Zeitpunkt auf diesem Knoten ausgef√ºhrt werden k√∂nnen. Mit anderen Worten, dies bestimmt die **Anzahl der gleichzeitigen Pipeline `Stufen`**, die zu einem Zeitpunkt auf diesem Knoten ausgef√ºhrt werden k√∂nnen.

## Jenkins-Geheimnisse

### Verschl√ºsselung von Geheimnissen und Anmeldeinformationen

Definition aus den [Docs](https://www.jenkins.io/doc/developer/security/secrets/#encryption-of-secrets-and-credentials): Jenkins verwendet **AES zur Verschl√ºsselung und zum Schutz von Geheimnissen**, Anmeldeinformationen und deren jeweiligen Verschl√ºsselungsschl√ºsseln. Diese Verschl√ºsselungsschl√ºssel werden in `$JENKINS_HOME/secrets/` zusammen mit dem Master-Schl√ºssel gespeichert, der zum Schutz dieser Schl√ºssel verwendet wird. Dieses Verzeichnis sollte so konfiguriert werden, dass nur der Betriebssystembenutzer, unter dem der Jenkins-Controller l√§uft, Lese- und Schreibzugriff auf dieses Verzeichnis hat (d.h. ein `chmod`-Wert von `0700` oder unter Verwendung geeigneter Dateiattribute). Der **Master-Schl√ºssel** (manchmal in der Kryptografie als "Key Encryption Key" bezeichnet) wird **_unverschl√ºsselt_** auf dem Dateisystem des Jenkins-Controllers in **`$JENKINS_HOME/secrets/master.key`** gespeichert, was nicht vor Angreifern sch√ºtzt, die direkten Zugriff auf diese Datei haben. Die meisten Benutzer und Entwickler verwenden diese Verschl√ºsselungsschl√ºssel indirekt √ºber entweder die [Secret](https://javadoc.jenkins.io/byShortName/Secret) API zur Verschl√ºsselung generischer geheimer Daten oder √ºber die Anmeldeinformations-API. F√ºr die kryptografisch Interessierten verwendet Jenkins AES im Cipher Block Chaining (CBC)-Modus mit PKCS#5-Padding und zuf√§lligen IVs, um Instanzen von [CryptoConfidentialKey](https://javadoc.jenkins.io/byShortName/CryptoConfidentialKey) zu verschl√ºsseln, die in `$JENKINS_HOME/secrets/` mit einem Dateinamen gespeichert werden, der ihrer `CryptoConfidentialKey`-ID entspricht. H√§ufige Schl√ºssel-IDs umfassen:

* `hudson.util.Secret`: verwendet f√ºr generische Geheimnisse;
* `com.cloudbees.plugins.credentials.SecretBytes.KEY`: verwendet f√ºr einige Anmeldeinformationstypen;
* `jenkins.model.Jenkins.crumbSalt`: verwendet vom [CSRF-Schutzmechanismus](https://www.jenkins.io/doc/book/managing/security/#cross-site-request-forgery); und

### Zugriff auf Anmeldeinformationen

Anmeldeinformationen k√∂nnen **globalen Anbietern** (`/credentials/`) zugewiesen werden, auf die von jedem konfigurierten Projekt zugegriffen werden kann, oder sie k√∂nnen auf **spezifische Projekte** (`/job/<project-name>/configure`) beschr√§nkt werden und sind daher nur von dem spezifischen Projekt aus zug√§nglich.

Laut [**den Docs**](https://www.jenkins.io/blog/2019/02/21/credentials-masking/): Anmeldeinformationen, die im Geltungsbereich sind, stehen der Pipeline ohne Einschr√§nkungen zur Verf√ºgung. Um **versehentliche Offenlegung im Build-Protokoll** zu verhindern, werden Anmeldeinformationen **maskiert** und sind nicht in der regul√§ren Ausgabe sichtbar, sodass ein Aufruf von `env` (Linux) oder `set` (Windows) oder Programme, die ihre Umgebung oder Parameter drucken, **sie im Build-Protokoll nicht offenbaren** k√∂nnen, an Benutzer, die sonst keinen Zugriff auf die Anmeldeinformationen h√§tten.

**Deshalb muss ein Angreifer, um die Anmeldeinformationen zu exfiltrieren, sie beispielsweise base64 kodieren.**

## Referenzen

* [https://www.jenkins.io/doc/book/security/managing-security/](https://www.jenkins.io/doc/book/security/managing-security/)
* [https://www.jenkins.io/doc/book/managing/nodes/](https://www.jenkins.io/doc/book/managing/nodes/)
* [https://www.jenkins.io/doc/developer/security/secrets/](https://www.jenkins.io/doc/developer/security/secrets/)
* [https://www.jenkins.io/blog/2019/02/21/credentials-masking/](https://www.jenkins.io/blog/2019/02/21/credentials-masking/)
* [https://www.jenkins.io/doc/book/managing/security/#cross-site-request-forgery](https://www.jenkins.io/doc/book/managing/security/#cross-site-request-forgery)
* [https://www.jenkins.io/doc/developer/security/secrets/#encryption-of-secrets-and-credentials](https://www.jenkins.io/doc/developer/security/secrets/#encryption-of-secrets-and-credentials)
* [https://www.jenkins.io/doc/book/managing/nodes/](https://www.jenkins.io/doc/book/managing/nodes/)

{% hint style="success" %}
Lernen & √ºben Sie AWS Hacking:<img src="../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Lernen & √ºben Sie GCP Hacking: <img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Unterst√ºtzen Sie HackTricks</summary>

* √úberpr√ºfen Sie die [**Abonnementpl√§ne**](https://github.com/sponsors/carlospolop)!
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teilen Sie Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repos senden.

</details>
{% endhint %}
