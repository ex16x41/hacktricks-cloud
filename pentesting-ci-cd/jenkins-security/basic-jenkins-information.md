# Jenkins åŸºæœ¬ä¿¡æ¯

{% hint style="success" %}
å­¦ä¹ å’Œç»ƒä¹  AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
å­¦ä¹ å’Œç»ƒä¹  GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>æ”¯æŒ HackTricks</summary>

* æŸ¥çœ‹ [**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**telegram ç¾¤ç»„**](https://t.me/peass) æˆ– **å…³æ³¨** æˆ‘ä»¬çš„ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **é€šè¿‡æäº¤ PRs åˆ†äº«é»‘å®¢æŠ€å·§åˆ°** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ä»“åº“ã€‚

</details>
{% endhint %}

## è®¿é—®

### ç”¨æˆ·å + å¯†ç 

åœ¨ Jenkins ä¸­æœ€å¸¸è§çš„ç™»å½•æ–¹å¼æ˜¯ä½¿ç”¨ç”¨æˆ·åæˆ–å¯†ç 

### Cookie

å¦‚æœ**æˆæƒçš„ cookie è¢«ç›—**ï¼Œå®ƒå¯ä»¥ç”¨æ¥è®¿é—®ç”¨æˆ·çš„ä¼šè¯ã€‚è¿™ä¸ª cookie é€šå¸¸å«åš `JSESSIONID.*`ã€‚ï¼ˆç”¨æˆ·å¯ä»¥ç»ˆæ­¢ä»–æ‰€æœ‰çš„ä¼šè¯ï¼Œä½†ä»–éœ€è¦å…ˆå‘ç° cookie è¢«ç›—ï¼‰ã€‚

### SSO/æ’ä»¶

Jenkins å¯ä»¥é€šè¿‡æ’ä»¶é…ç½®ä¸º**é€šè¿‡ç¬¬ä¸‰æ–¹ SSO è®¿é—®**ã€‚

### ä»¤ç‰Œ

**ç”¨æˆ·å¯ä»¥ç”Ÿæˆä»¤ç‰Œ**ï¼Œä»¥ä¾¿é€šè¿‡ CLI æˆ– REST API æ¨¡æ‹Ÿä»–ä»¬çš„åº”ç”¨ç¨‹åºè®¿é—®ã€‚

### SSH å¯†é’¥

æ­¤ç»„ä»¶ä¸º Jenkins æä¾›äº†å†…ç½®çš„ SSH æœåŠ¡å™¨ã€‚è¿™æ˜¯ [Jenkins CLI](https://www.jenkins.io/doc/book/managing/cli/) çš„æ›¿ä»£æ¥å£ï¼Œå¯ä»¥ä½¿ç”¨ä»»ä½• SSH å®¢æˆ·ç«¯ä»¥è¿™ç§æ–¹å¼è°ƒç”¨å‘½ä»¤ã€‚ï¼ˆæ¥è‡ª [æ–‡æ¡£](https://plugins.jenkins.io/sshd/)ï¼‰

## æˆæƒ

åœ¨ `/configureSecurity` ä¸­å¯ä»¥**é…ç½® Jenkins çš„æˆæƒæ–¹æ³•**ã€‚æœ‰å‡ ç§é€‰é¡¹ï¼š

* **ä»»ä½•äººéƒ½å¯ä»¥åšä»»ä½•äº‹**ï¼šå³ä½¿æ˜¯åŒ¿åè®¿é—®ä¹Ÿå¯ä»¥ç®¡ç†æœåŠ¡å™¨
* **ä¼ ç»Ÿæ¨¡å¼**ï¼šä¸ Jenkins <1.164 ç›¸åŒã€‚å¦‚æœä½ æœ‰**"admin" è§’è‰²**ï¼Œä½ å°†è¢«æˆäºˆ**å®Œå…¨æ§åˆ¶**ç³»ç»Ÿçš„æƒé™ï¼Œå¦åˆ™ï¼ˆåŒ…æ‹¬**åŒ¿å**ç”¨æˆ·ï¼‰ä½ å°†æœ‰**è¯»å–**æƒé™ã€‚
* **ç™»å½•ç”¨æˆ·å¯ä»¥åšä»»ä½•äº‹**ï¼šåœ¨è¿™ç§æ¨¡å¼ä¸‹ï¼Œæ¯ä¸ª**ç™»å½•ç”¨æˆ·éƒ½å¯ä»¥å®Œå…¨æ§åˆ¶** Jenkinsã€‚å”¯ä¸€æ²¡æœ‰å®Œå…¨æ§åˆ¶æƒé™çš„æ˜¯**åŒ¿åç”¨æˆ·**ï¼Œä»–åªæœ‰**è¯»å–æƒé™**ã€‚
* **åŸºäºçŸ©é˜µçš„å®‰å…¨æ€§**ï¼šä½ å¯ä»¥åœ¨è¡¨æ ¼ä¸­é…ç½®**è°å¯ä»¥åšä»€ä¹ˆ**ã€‚æ¯ä¸ª**åˆ—**ä»£è¡¨ä¸€ä¸ª**æƒé™**ã€‚æ¯ä¸ª**è¡Œ**ä»£è¡¨ä¸€ä¸ª**ç”¨æˆ·æˆ–ç»„/è§’è‰²**ã€‚è¿™åŒ…æ‹¬ä¸€ä¸ªç‰¹æ®Šç”¨æˆ· '**anonymous**'ï¼Œä»£è¡¨**æœªè®¤è¯ç”¨æˆ·**ï¼Œä»¥åŠ '**authenticated**'ï¼Œä»£è¡¨**æ‰€æœ‰è®¤è¯ç”¨æˆ·**ã€‚

![](<../../.gitbook/assets/image (149).png>)

* **åŸºäºé¡¹ç›®çš„çŸ©é˜µæˆæƒç­–ç•¥**ï¼šè¿™ç§æ¨¡å¼æ˜¯**"åŸºäºçŸ©é˜µçš„å®‰å…¨æ€§"**çš„æ‰©å±•ï¼Œå…è®¸ä¸ºæ¯ä¸ªé¡¹ç›®å•ç‹¬å®šä¹‰é¢å¤–çš„ ACL çŸ©é˜µã€‚
* **åŸºäºè§’è‰²çš„ç­–ç•¥**ï¼šå¯ç”¨ä½¿ç”¨**åŸºäºè§’è‰²çš„ç­–ç•¥**å®šä¹‰æˆæƒã€‚åœ¨ `/role-strategy` ä¸­ç®¡ç†è§’è‰²ã€‚

## **å®‰å…¨é¢†åŸŸ**

åœ¨ `/configureSecurity` ä¸­å¯ä»¥**é…ç½®å®‰å…¨é¢†åŸŸ**ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒJenkins æ”¯æŒå‡ ç§ä¸åŒçš„å®‰å…¨é¢†åŸŸï¼š

* **å§”æ‰˜ç»™ servlet å®¹å™¨**ï¼šç”¨äº**å°†è®¤è¯å§”æ‰˜ç»™è¿è¡Œ Jenkins æ§åˆ¶å™¨çš„ servlet å®¹å™¨**ï¼Œå¦‚ [Jetty](https://www.eclipse.org/jetty/)ã€‚
* **Jenkins è‡ªå·±çš„ç”¨æˆ·æ•°æ®åº“**ï¼šä½¿ç”¨**Jenkins è‡ªå·±å†…ç½®çš„ç”¨æˆ·æ•°æ®å­˜å‚¨**è¿›è¡Œè®¤è¯ï¼Œè€Œä¸æ˜¯å§”æ‰˜ç»™å¤–éƒ¨ç³»ç»Ÿã€‚è¿™æ˜¯é»˜è®¤å¯ç”¨çš„ã€‚
* **LDAP**ï¼šå°†æ‰€æœ‰è®¤è¯å§”æ‰˜ç»™é…ç½®çš„ LDAP æœåŠ¡å™¨ï¼ŒåŒ…æ‹¬ç”¨æˆ·å’Œç»„ã€‚
* **Unix ç”¨æˆ·/ç»„æ•°æ®åº“**ï¼š**å°†è®¤è¯å§”æ‰˜ç»™ Jenkins æ§åˆ¶å™¨ä¸Šçš„åº•å±‚ Unix** æ“ä½œç³»ç»Ÿçº§ç”¨æˆ·æ•°æ®åº“ã€‚è¿™ç§æ¨¡å¼è¿˜å…è®¸é‡ç”¨ Unix ç»„è¿›è¡Œæˆæƒã€‚

æ’ä»¶å¯ä»¥æä¾›é¢å¤–çš„å®‰å…¨é¢†åŸŸï¼Œè¿™å¯èƒ½å¯¹å°† Jenkins é›†æˆåˆ°ç°æœ‰èº«ä»½ç³»ç»Ÿä¸­æœ‰ç”¨ï¼Œä¾‹å¦‚ï¼š

* [Active Directory](https://plugins.jenkins.io/active-directory)
* [GitHub Authentication](https://plugins.jenkins.io/github-oauth)
* [Atlassian Crowd 2](https://plugins.jenkins.io/crowd2)

## Jenkins èŠ‚ç‚¹ã€ä»£ç†å’Œæ‰§è¡Œå™¨

æ¥è‡ª [æ–‡æ¡£](https://www.jenkins.io/doc/book/managing/nodes/) çš„å®šä¹‰ï¼š

**èŠ‚ç‚¹**æ˜¯è¿è¡Œæ„å»º**ä»£ç†**çš„**æœºå™¨**ã€‚Jenkins ç›‘æ§æ¯ä¸ªé™„åŠ èŠ‚ç‚¹çš„ç£ç›˜ç©ºé—´ã€ä¸´æ—¶ç©ºé—´ã€äº¤æ¢ç©ºé—´ã€æ—¶é’Ÿæ—¶é—´/åŒæ­¥å’Œå“åº”æ—¶é—´ã€‚å¦‚æœè¿™äº›å€¼ä¸­çš„ä»»ä½•ä¸€ä¸ªè¶…å‡ºé…ç½®çš„é˜ˆå€¼ï¼ŒèŠ‚ç‚¹å°†è¢«ä¸‹çº¿ã€‚

**ä»£ç†**é€šè¿‡**ä½¿ç”¨æ‰§è¡Œå™¨**æ¥**ç®¡ç†ä»»åŠ¡æ‰§è¡Œ**ï¼Œä»£è¡¨ Jenkins æ§åˆ¶å™¨ã€‚ä»£ç†å¯ä»¥ä½¿ç”¨ä»»ä½•æ”¯æŒ Java çš„æ“ä½œç³»ç»Ÿã€‚æ„å»ºå’Œæµ‹è¯•æ‰€éœ€çš„å·¥å…·å®‰è£…åœ¨ä»£ç†è¿è¡Œçš„èŠ‚ç‚¹ä¸Šï¼›å®ƒä»¬å¯ä»¥**ç›´æ¥å®‰è£…æˆ–åœ¨å®¹å™¨ä¸­å®‰è£…**ï¼ˆDocker æˆ– Kubernetesï¼‰ã€‚æ¯ä¸ª**ä»£ç†å®é™…ä¸Šæ˜¯ä¸»æœºä¸Šçš„ä¸€ä¸ªè¿›ç¨‹ï¼Œå…·æœ‰è‡ªå·±çš„ PID**ã€‚

**æ‰§è¡Œå™¨**æ˜¯**ä»»åŠ¡æ‰§è¡Œçš„æ’æ§½**ï¼›å®é™…ä¸Šï¼Œå®ƒæ˜¯**ä»£ç†ä¸­çš„ä¸€ä¸ªçº¿ç¨‹**ã€‚èŠ‚ç‚¹ä¸Šçš„**æ‰§è¡Œå™¨æ•°é‡**å®šä¹‰äº†è¯¥èŠ‚ç‚¹ä¸€æ¬¡å¯ä»¥æ‰§è¡Œçš„**å¹¶å‘ä»»åŠ¡**æ•°é‡ã€‚æ¢å¥è¯è¯´ï¼Œè¿™å†³å®šäº†è¯¥èŠ‚ç‚¹ä¸€æ¬¡å¯ä»¥æ‰§è¡Œçš„**å¹¶å‘ Pipeline `stages`** çš„æ•°é‡ã€‚

## Jenkins ç§˜å¯†

### ç§˜å¯†å’Œå‡­è¯çš„åŠ å¯†

æ¥è‡ª [æ–‡æ¡£](https://www.jenkins.io/doc/developer/security/secrets/#encryption-of-secrets-and-credentials) çš„å®šä¹‰ï¼šJenkins ä½¿ç”¨ **AES åŠ å¯†å’Œä¿æŠ¤ç§˜å¯†**ã€å‡­è¯åŠå…¶å„è‡ªçš„åŠ å¯†å¯†é’¥ã€‚è¿™äº›åŠ å¯†å¯†é’¥å­˜å‚¨åœ¨ `$JENKINS_HOME/secrets/` ä¸­ï¼Œä»¥åŠç”¨äºä¿æŠ¤è¿™äº›å¯†é’¥çš„ä¸»å¯†é’¥ã€‚åº”é…ç½®æ­¤ç›®å½•ï¼Œä½¿å¾—åªæœ‰è¿è¡Œ Jenkins æ§åˆ¶å™¨çš„æ“ä½œç³»ç»Ÿç”¨æˆ·å¯¹è¯¥ç›®å½•å…·æœ‰è¯»å†™æƒé™ï¼ˆå³ `chmod` å€¼ä¸º `0700` æˆ–ä½¿ç”¨é€‚å½“çš„æ–‡ä»¶å±æ€§ï¼‰ã€‚**ä¸»å¯†é’¥**ï¼ˆæœ‰æ—¶åœ¨åŠ å¯†æœ¯è¯­ä¸­ç§°ä¸ºâ€œå¯†é’¥åŠ å¯†å¯†é’¥â€ï¼‰**æœªåŠ å¯†åœ°å­˜å‚¨**åœ¨ Jenkins æ§åˆ¶å™¨æ–‡ä»¶ç³»ç»Ÿä¸­çš„ **`$JENKINS_HOME/secrets/master.key`** ä¸­ï¼Œè¿™ä¸èƒ½é˜²æ­¢ç›´æ¥è®¿é—®è¯¥æ–‡ä»¶çš„æ”»å‡»è€…ã€‚å¤§å¤šæ•°ç”¨æˆ·å’Œå¼€å‘äººå‘˜å°†é€šè¿‡ [Secret](https://javadoc.jenkins.io/byShortName/Secret) API é—´æ¥ä½¿ç”¨è¿™äº›åŠ å¯†å¯†é’¥æ¥åŠ å¯†é€šç”¨ç§˜å¯†æ•°æ®ï¼Œæˆ–é€šè¿‡å‡­è¯ API ä½¿ç”¨è¿™äº›å¯†é’¥ã€‚å¯¹äºåŠ å¯†çˆ±å¥½è€…ï¼ŒJenkins ä½¿ç”¨ AES çš„å¯†ç å—é“¾æ¥ï¼ˆCBCï¼‰æ¨¡å¼ï¼Œå¸¦æœ‰ PKCS#5 å¡«å……å’Œéšæœº IVs æ¥åŠ å¯† [CryptoConfidentialKey](https://javadoc.jenkins.io/byShortName/CryptoConfidentialKey) çš„å®ä¾‹ï¼Œè¿™äº›å®ä¾‹å­˜å‚¨åœ¨ `$JENKINS_HOME/secrets/` ä¸­ï¼Œæ–‡ä»¶åå¯¹åº”äºå…¶ `CryptoConfidentialKey` idã€‚å¸¸è§çš„å¯†é’¥ id åŒ…æ‹¬ï¼š

* `hudson.util.Secret`ï¼šç”¨äºé€šç”¨ç§˜å¯†ï¼›
* `com.cloudbees.plugins.credentials.SecretBytes.KEY`ï¼šç”¨äºæŸäº›å‡­è¯ç±»å‹ï¼›
* `jenkins.model.Jenkins.crumbSalt`ï¼šç”¨äº [CSRF ä¿æŠ¤æœºåˆ¶](https://www.jenkins.io/doc/book/managing/security/#cross-site-request-forgery)ï¼›å’Œ

### å‡­è¯è®¿é—®

å‡­è¯å¯ä»¥**èŒƒå›´é™å®šä¸ºå…¨å±€æä¾›è€…**ï¼ˆ`/credentials/`ï¼‰ï¼Œå¯ä»¥è¢«ä»»ä½•é…ç½®çš„é¡¹ç›®è®¿é—®ï¼Œæˆ–è€…èŒƒå›´é™å®šä¸º**ç‰¹å®šé¡¹ç›®**ï¼ˆ`/job/<project-name>/configure`ï¼‰ï¼Œå› æ­¤åªèƒ½ä»ç‰¹å®šé¡¹ç›®è®¿é—®ã€‚

æ ¹æ® [**æ–‡æ¡£**](https://www.jenkins.io/blog/2019/02/21/credentials-masking/)ï¼šèŒƒå›´å†…çš„å‡­è¯å¯ä»¥æ— é™åˆ¶åœ°æä¾›ç»™ pipelineã€‚ä¸ºäº†**é˜²æ­¢åœ¨æ„å»ºæ—¥å¿—ä¸­æ„å¤–æš´éœ²**ï¼Œå‡­è¯ä»å¸¸è§„è¾“å‡ºä¸­**å±è”½**ï¼Œå› æ­¤è°ƒç”¨ `env`ï¼ˆLinuxï¼‰æˆ– `set`ï¼ˆWindowsï¼‰ï¼Œæˆ–æ‰“å°å…¶ç¯å¢ƒæˆ–å‚æ•°çš„ç¨‹åº**ä¸ä¼šåœ¨æ„å»ºæ—¥å¿—ä¸­å‘æ²¡æœ‰è®¿é—®å‡­è¯æƒé™çš„ç”¨æˆ·é€éœ²å®ƒä»¬**ã€‚

**è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæ”»å‡»è€…éœ€è¦ä¾‹å¦‚ base64 ç¼–ç æ¥å¤–ä¼ å‡­è¯ã€‚**

## å‚è€ƒèµ„æ–™

* [https://www.jenkins.io/doc/book/security/managing-security/](https://www.jenkins.io/doc/book/security/managing-security/)
* [https://www.jenkins.io/doc/book/managing/nodes/](https://www.jenkins.io/doc/book/managing/nodes/)
* [https://www.jenkins.io/doc/developer/security/secrets/](https://www.jenkins.io/doc/developer/security/secrets/)
* [https://www.jenkins.io/blog/2019/02/21/credentials-masking/](https://www.jenkins.io/blog/2019/02/21/credentials-masking/)
* [https://www.jenkins.io/doc/book/managing/security/#cross-site-request-forgery](https://www.jenkins.io/doc/book/managing/security/#cross-site-request-forgery)
* [https://www.jenkins.io/doc/developer/security/secrets/#encryption-of-secrets-and-credentials](https://www.jenkins.io/doc/developer/security/secrets/#encryption-of-secrets-and-credentials)
* [https://www.jenkins.io/doc/book/managing/nodes/](https://www.jenkins.io/doc/book/managing/nodes/)

{% hint style="success" %}
å­¦ä¹ å’Œç»ƒä¹  AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
å­¦ä¹ å’Œç»ƒä¹  GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>æ”¯æŒ HackTricks</summary>

* æŸ¥çœ‹ [**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**telegram ç¾¤ç»„**](https://t.me/peass) æˆ– **å…³æ³¨** æˆ‘ä»¬çš„ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **é€šè¿‡æäº¤ PRs åˆ†äº«é»‘å®¢æŠ€å·§åˆ°** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ä»“åº“ã€‚

</details>
{% endhint %}
