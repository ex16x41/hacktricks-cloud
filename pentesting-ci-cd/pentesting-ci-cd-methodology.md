# Pentesting CI/CD Methodolojisi

{% hint style="success" %}
AWS Hacking Ã¶ÄŸrenin ve pratik yapÄ±n:<img src="../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks EÄŸitim AWS KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ± (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../.gitbook/assets/image (1).png" alt="" data-size="line">\
GCP Hacking Ã¶ÄŸrenin ve pratik yapÄ±n: <img src="../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks EÄŸitim GCP KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ± (GRTE)**<img src="../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**abonelik planlarÄ±nÄ±**](https://github.com/sponsors/carlospolop) kontrol edin!
* **ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n ya da **Twitter'da** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** bizi takip edin.**
* **Hacking ipuÃ§larÄ±nÄ± paylaÅŸmak iÃ§in** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna PR gÃ¶nderin.

</details>
{% endhint %}

<figure><img src="../.gitbook/assets/CLOUD-logo-letters.svg" alt=""><figcaption></figcaption></figure>

## VCS

VCS, **Versiyon Kontrol Sistemi** anlamÄ±na gelir, bu sistemler geliÅŸtiricilerin **kaynak kodlarÄ±nÄ± yÃ¶netmelerine** olanak tanÄ±r. En yaygÄ±n olanÄ± **git**'tir ve genellikle ÅŸirketlerin aÅŸaÄŸÄ±daki **platformlardan** birinde kullandÄ±ÄŸÄ±nÄ± gÃ¶receksiniz:

* Github
* Gitlab
* Bitbucket
* Gitea
* Bulut saÄŸlayÄ±cÄ±larÄ± (kendi VCS platformlarÄ±nÄ± sunarlar)

## Pipeline'lar

Pipeline'lar, geliÅŸtiricilerin belirli eylemler gerÃ§ekleÅŸtiÄŸinde (bir push, bir PR, cron...) kodun **Ã§alÄ±ÅŸtÄ±rÄ±lmasÄ±nÄ± otomatikleÅŸtirmelerine** olanak tanÄ±r: Bu, geliÅŸtirmeden Ã¼retime kadar tÃ¼m adÄ±mlarÄ± otomatikleÅŸtirmek iÃ§in son derece faydalÄ±dÄ±r.

Ancak, bu sistemlerin **bir yerde Ã§alÄ±ÅŸtÄ±rÄ±lmasÄ±** gerekir ve genellikle **kod daÄŸÄ±tmak iÃ§in ayrÄ±calÄ±klÄ± kimlik bilgileri** ile Ã§alÄ±ÅŸtÄ±rÄ±lÄ±r.

## VCS Pentesting Metodolojisi

{% hint style="info" %}
BazÄ± VCS platformlarÄ± bu bÃ¶lÃ¼m iÃ§in pipeline oluÅŸturulmasÄ±na izin verse de, yalnÄ±zca kaynak kodunun kontrolÃ¼ne yÃ¶nelik potansiyel saldÄ±rÄ±larÄ± analiz edeceÄŸiz.
{% endhint %}

Projenizin kaynak kodunu iÃ§eren platformlar hassas bilgiler iÃ§erir ve insanlar bu platformda verilen izinlerle Ã§ok dikkatli olmalÄ±dÄ±r. SaldÄ±rganlarÄ±n istismar edebileceÄŸi bazÄ± yaygÄ±n sorunlar ÅŸunlardÄ±r:

* **SÄ±zÄ±ntÄ±lar**: Kodunuzda commitlerde sÄ±zÄ±ntÄ±lar varsa ve saldÄ±rgan repo'ya eriÅŸebiliyorsa (Ã§Ã¼nkÃ¼ kamuya aÃ§Ä±k veya eriÅŸimi var), sÄ±zÄ±ntÄ±larÄ± keÅŸfedebilir.
* **EriÅŸim**: EÄŸer bir saldÄ±rgan **VCS platformunda bir hesaba eriÅŸim saÄŸlayabiliyorsa**, **daha fazla gÃ¶rÃ¼nÃ¼rlÃ¼k ve izin** kazanabilir.
* **KayÄ±t**: BazÄ± platformlar yalnÄ±zca dÄ±ÅŸ kullanÄ±cÄ±larÄ±n hesap oluÅŸturmasÄ±na izin verir.
* **SSO**: BazÄ± platformlar kullanÄ±cÄ±larÄ±n kayÄ±t olmasÄ±na izin vermez, ancak geÃ§erli bir SSO ile eriÅŸim saÄŸlar (bu nedenle bir saldÄ±rgan Ã¶rneÄŸin github hesabÄ±nÄ± kullanarak girebilir).
* **Kimlik Bilgileri**: KullanÄ±cÄ± adÄ±+Åifre, kiÅŸisel tokenlar, ssh anahtarlarÄ±, Oauth tokenlarÄ±, Ã§erezler... bir kullanÄ±cÄ±nÄ±n bir repo'ya eriÅŸmek iÃ§in Ã§alabileceÄŸi Ã§eÅŸitli token tÃ¼rleri vardÄ±r.
* **Webhooks**: VCS platformlarÄ± webhook oluÅŸturulmasÄ±na izin verir. EÄŸer **gÃ¶rÃ¼nmeyen gizli anahtarlarla korunmuyorlarsa**, bir **saldÄ±rgan bunlarÄ± istismar edebilir**.
* EÄŸer gizli bir anahtar yoksa, saldÄ±rgan Ã¼Ã§Ã¼ncÃ¼ taraf platformun webhook'unu istismar edebilir.
* EÄŸer gizli anahtar URL'de ise, aynÄ± ÅŸey olur ve saldÄ±rgan da gizli anahtara sahip olur.
* **Kodun tehlikeye atÄ±lmasÄ±:** EÄŸer kÃ¶tÃ¼ niyetli bir aktÃ¶r repo'lar Ã¼zerinde bir tÃ¼r **yazma** eriÅŸimine sahipse, **kÃ¶tÃ¼ niyetli kod enjekte etmeye** Ã§alÄ±ÅŸabilir. BaÅŸarÄ±lÄ± olmak iÃ§in **dal korumalarÄ±nÄ± aÅŸmasÄ±** gerekebilir. Bu eylemler farklÄ± hedeflerle gerÃ§ekleÅŸtirilebilir:
* Ana dalÄ± tehlikeye atmak, **Ã¼retimi tehlikeye atmak**.
* Ana dalÄ± (veya diÄŸer dallarÄ±) tehlikeye atmak, **geliÅŸtirici makinelerini tehlikeye atmak** (Ã§Ã¼nkÃ¼ genellikle test, terraform veya diÄŸer ÅŸeyleri makinelerinde repo iÃ§inde Ã§alÄ±ÅŸtÄ±rÄ±rlar).
* **Pipeline'Ä± tehlikeye atmak** (bir sonraki bÃ¶lÃ¼me bakÄ±n)

## Pipeline'lar Pentesting Metodolojisi

Bir pipeline'Ä± tanÄ±mlamanÄ±n en yaygÄ±n yolu, pipeline'Ä±n inÅŸa edildiÄŸi **repo'da barÄ±ndÄ±rÄ±lan bir CI yapÄ±landÄ±rma dosyasÄ±** kullanmaktÄ±r. Bu dosya, yÃ¼rÃ¼tÃ¼len iÅŸlerin sÄ±rasÄ±nÄ±, akÄ±ÅŸÄ± etkileyen koÅŸullarÄ± ve yapÄ± ortamÄ± ayarlarÄ±nÄ± tanÄ±mlar.\
Bu dosyalar genellikle tutarlÄ± bir isim ve formata sahiptir, Ã¶rneÄŸin â€” Jenkinsfile (Jenkins), .gitlab-ci.yml (GitLab), .circleci/config.yml (CircleCI) ve .github/workflows altÄ±nda bulunan GitHub Actions YAML dosyalarÄ±. TetiklendiÄŸinde, pipeline iÅŸi **seÃ§ilen kaynaktan kodu Ã§eker** (Ã¶rneÄŸin commit / dal) ve **CI yapÄ±landÄ±rma dosyasÄ±nda belirtilen komutlarÄ±** o kod Ã¼zerinde Ã§alÄ±ÅŸtÄ±rÄ±r.

Bu nedenle, saldÄ±rganÄ±n nihai hedefi, bir ÅŸekilde **bu yapÄ±landÄ±rma dosyalarÄ±nÄ±** veya **Ã§alÄ±ÅŸtÄ±rdÄ±klarÄ± komutlarÄ± tehlikeye atmaktÄ±r**.

### PPE - Zehirli Pipeline YÃ¼rÃ¼tmesi

Zehirli Pipeline YÃ¼rÃ¼tmesi (PPE) yolu, bir SCM reposundaki izinleri istismar ederek bir CI pipeline'Ä±nÄ± manipÃ¼le eder ve zararlÄ± komutlar Ã§alÄ±ÅŸtÄ±rÄ±r. Gerekli izinlere sahip kullanÄ±cÄ±lar, CI yapÄ±landÄ±rma dosyalarÄ±nÄ± veya pipeline iÅŸi tarafÄ±ndan kullanÄ±lan diÄŸer dosyalarÄ± kÃ¶tÃ¼ niyetli komutlar eklemek iÃ§in deÄŸiÅŸtirebilir. Bu, CI pipeline'Ä±nÄ± "zehirler" ve bu kÃ¶tÃ¼ niyetli komutlarÄ±n yÃ¼rÃ¼tÃ¼lmesine yol aÃ§ar.

KÃ¶tÃ¼ niyetli bir aktÃ¶rÃ¼n PPE saldÄ±rÄ±sÄ±nÄ± baÅŸarÄ±lÄ± bir ÅŸekilde gerÃ§ekleÅŸtirebilmesi iÃ§in:

* **VCS platformuna yazma eriÅŸimine sahip olmasÄ±** gerekir, Ã§Ã¼nkÃ¼ genellikle pipeline'lar bir push veya pull request gerÃ§ekleÅŸtirildiÄŸinde tetiklenir. (EriÅŸim elde etme yollarÄ±nÄ±n Ã¶zeti iÃ§in VCS pentesting metodolojisine bakÄ±n).
* Bazen bir **dÄ±ÅŸ PR'nin "yazma eriÅŸimi" olarak sayÄ±ldÄ±ÄŸÄ±nÄ±** unutmayÄ±n.
* Yazma izinlerine sahip olsa bile, **CI yapÄ±landÄ±rma dosyasÄ±nÄ± veya yapÄ±landÄ±rmanÄ±n dayandÄ±ÄŸÄ± diÄŸer dosyalarÄ± deÄŸiÅŸtirebileceÄŸinden emin olmasÄ±** gerekir.
* Bunun iÃ§in, **dal korumalarÄ±nÄ± aÅŸabilmesi** gerekebilir.

ÃœÃ§ PPE Ã§eÅŸidi vardÄ±r:

* **D-PPE**: **DoÄŸrudan PPE** saldÄ±rÄ±sÄ±, aktÃ¶rÃ¼n **yÃ¼rÃ¼tÃ¼lecek CI yapÄ±landÄ±rma** dosyasÄ±nÄ± deÄŸiÅŸtirdiÄŸi durumdur.
* **I-DDE**: **DolaylÄ± PPE** saldÄ±rÄ±sÄ±, aktÃ¶rÃ¼n **yÃ¼rÃ¼tÃ¼lecek CI yapÄ±landÄ±rma dosyasÄ±nÄ±n** dayandÄ±ÄŸÄ± bir **dosyayÄ±** deÄŸiÅŸtirdiÄŸi durumdur (Ã¶rneÄŸin bir make dosyasÄ± veya terraform yapÄ±landÄ±rmasÄ±).
* **Halka AÃ§Ä±k PPE veya 3PE**: BazÄ± durumlarda, pipeline'lar **repo'da yazma eriÅŸimi olmayan kullanÄ±cÄ±lar tarafÄ±ndan tetiklenebilir** (ve bu kullanÄ±cÄ±lar org'un bir parÃ§asÄ± bile olmayabilir) Ã§Ã¼nkÃ¼ PR gÃ¶nderebilirler.
* **3PE Komut Enjeksiyonu**: Genellikle, CI/CD pipeline'larÄ± **PR hakkÄ±nda bilgi iÃ§eren ortam deÄŸiÅŸkenleri** ayarlayacaktÄ±r. EÄŸer bu deÄŸer bir saldÄ±rgan tarafÄ±ndan kontrol edilebiliyorsa (Ã¶rneÄŸin PR'nin baÅŸlÄ±ÄŸÄ± gibi) ve **tehlikeli bir yerde** (Ã¶rneÄŸin **sh komutlarÄ±** Ã§alÄ±ÅŸtÄ±rmak gibi) kullanÄ±lÄ±yorsa, bir saldÄ±rgan **orada komut enjekte edebilir**.

### Ä°stismar FaydalarÄ±

Bir pipeline'Ä± zehirlemenin 3 Ã§eÅŸidini bildiÄŸimizde, baÅŸarÄ±lÄ± bir istismar sonrasÄ±nda bir saldÄ±rganÄ±n elde edebileceÄŸi ÅŸeylere bakalÄ±m:

* **Gizli Bilgiler**: Daha Ã¶nce belirtildiÄŸi gibi, pipeline'lar iÅŸlerini yÃ¼rÃ¼tmek iÃ§in **ayrÄ±calÄ±klara** ihtiyaÃ§ duyar (kod almak, inÅŸa etmek, daÄŸÄ±tmak...) ve bu ayrÄ±calÄ±klar genellikle **gizli bilgilerle** verilir. Bu gizli bilgiler genellikle **ortam deÄŸiÅŸkenleri veya sistem iÃ§indeki dosyalar** aracÄ±lÄ±ÄŸÄ±yla eriÅŸilebilir. Bu nedenle, bir saldÄ±rgan her zaman mÃ¼mkÃ¼n olduÄŸunca Ã§ok gizli bilgi sÄ±zdÄ±rmaya Ã§alÄ±ÅŸacaktÄ±r.
* Pipeline platformuna baÄŸlÄ± olarak, saldÄ±rgan **gizli bilgileri yapÄ±landÄ±rmada belirtmek zorunda kalabilir**. Bu, saldÄ±rgan CI yapÄ±landÄ±rma pipeline'Ä±nÄ± deÄŸiÅŸtiremiyorsa (**I-PPE** Ã¶rneÄŸin), yalnÄ±zca o pipeline'Ä±n sahip olduÄŸu gizli bilgileri sÄ±zdÄ±rabileceÄŸi anlamÄ±na gelir.
* **Hesaplama**: Kod bir yerde Ã§alÄ±ÅŸtÄ±rÄ±lÄ±r, nerede Ã§alÄ±ÅŸtÄ±rÄ±ldÄ±ÄŸÄ±na baÄŸlÄ± olarak bir saldÄ±rgan daha ileriye geÃ§ebilir.
* **Yerel**: EÄŸer pipeline'lar yerel olarak Ã§alÄ±ÅŸtÄ±rÄ±lÄ±yorsa, bir saldÄ±rgan **daha fazla kaynaÄŸa eriÅŸimle iÃ§ aÄŸa** girebilir.
* **Bulut**: SaldÄ±rgan **buluttaki diÄŸer makinelere** eriÅŸebilir ama aynÄ± zamanda **IAM rolleri/hizmet hesaplarÄ±** **tokenlarÄ±nÄ±** sÄ±zdÄ±rarak **bulut iÃ§inde daha fazla eriÅŸim** elde edebilir.
* **Platform makineleri**: Bazen iÅŸler **pipeline platform makineleri** iÃ§inde Ã§alÄ±ÅŸtÄ±rÄ±lÄ±r, bu makineler genellikle **daha fazla eriÅŸim** olmadan bir bulut iÃ§indedir.
* **SeÃ§in:** Bazen **pipeline platformu birkaÃ§ makineyi yapÄ±landÄ±rmÄ±ÅŸ olacaktÄ±r** ve eÄŸer **CI yapÄ±landÄ±rma dosyasÄ±nÄ± deÄŸiÅŸtirebilirseniz**, kÃ¶tÃ¼ niyetli kodu nerede Ã§alÄ±ÅŸtÄ±rmak istediÄŸinizi **belirtebilirsiniz**. Bu durumda, bir saldÄ±rgan muhtemelen her olasÄ± makinede bir ters shell Ã§alÄ±ÅŸtÄ±rarak daha fazla istismar etmeye Ã§alÄ±ÅŸacaktÄ±r.
* **Ãœretimi tehlikeye atmak**: EÄŸer pipeline iÃ§indeyseniz ve nihai versiyon buradan inÅŸa edilip daÄŸÄ±tÄ±lÄ±yorsa, **Ã¼retimde Ã§alÄ±ÅŸacak kodu tehlikeye atabilirsiniz**.

## Daha Fazla Ä°lgili Bilgi

### AraÃ§lar & CIS Benchmark

* [**Chain-bench**](https://github.com/aquasecurity/chain-bench), yeni bir [**CIS YazÄ±lÄ±m Tedarik Zinciri benchmark'Ä±na**](https://github.com/aquasecurity/chain-bench/blob/main/docs/CIS-Software-Supply-Chain-Security-Guide-v1.0.pdf) dayalÄ± olarak yazÄ±lÄ±m tedarik zinciri yÄ±ÄŸÄ±nÄ±nÄ±zÄ± gÃ¼venlik uyumluluÄŸu iÃ§in denetlemek Ã¼zere aÃ§Ä±k kaynak bir araÃ§tÄ±r. Denetim, kod zamanÄ±ndan daÄŸÄ±tÄ±m zamanÄ±na kadar riskleri ortaya Ã§Ä±karabileceÄŸi tÃ¼m SDLC sÃ¼recine odaklanÄ±r.

### En Ä°yi 10 CI/CD GÃ¼venlik Riski

Cider'a gÃ¶re en iyi 10 CI/CD riski hakkÄ±nda bu ilginÃ§ makaleyi kontrol edin: [**https://www.cidersecurity.io/top-10-cicd-security-risks/**](https://www.cidersecurity.io/top-10-cicd-security-risks/)

### Laboratuvarlar

* Yerel olarak Ã§alÄ±ÅŸtÄ±rabileceÄŸiniz her platformda, test etmek iÃ§in istediÄŸiniz gibi yapÄ±landÄ±rabileceÄŸiniz ÅŸekilde yerel olarak nasÄ±l baÅŸlatÄ±lacaÄŸÄ±nÄ± bulacaksÄ±nÄ±z.
* Gitea + Jenkins laboratuvarÄ±: [https://github.com/cider-security-research/cicd-goat](https://github.com/cider-security-research/cicd-goat)

### Otomatik AraÃ§lar

* [**Checkov**](https://github.com/bridgecrewio/checkov): **Checkov**, altyapÄ± olarak kod iÃ§in statik kod analizi aracÄ±dÄ±r.

## Referanslar

* [https://www.cidersecurity.io/blog/research/ppe-poisoned-pipeline-execution/?utm\_source=github\&utm\_medium=github\_page\&utm\_campaign=ci%2fcd%20goat\_060422](https://www.cidersecurity.io/blog/research/ppe-poisoned-pipeline-execution/?utm\_source=github\&utm\_medium=github\_page\&utm\_campaign=ci%2fcd%20goat\_060422)

{% hint style="success" %}
AWS Hacking Ã¶ÄŸrenin ve pratik yapÄ±n:<img src="../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks EÄŸitim AWS KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ± (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../.gitbook/assets/image (1).png" alt="" data-size="line">\
GCP Hacking Ã¶ÄŸrenin ve pratik yapÄ±n: <img src="../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks EÄŸitim GCP KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ± (GRTE)**<img src="../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**abonelik planlarÄ±nÄ±**](https://github.com/sponsors/carlospolop) kontrol edin!
* **ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n ya da **Twitter'da** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** bizi takip edin.**
* **Hacking ipuÃ§larÄ±nÄ± paylaÅŸmak iÃ§in** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna PR gÃ¶nderin.

</details>
{% endhint %}
