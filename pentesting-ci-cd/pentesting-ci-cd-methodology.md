# Pentesting CI/CD Methodolojisi

{% hint style="success" %}
AWS Hacking Ã¶ÄŸrenin ve pratik yapÄ±n:<img src="../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks EÄŸitim AWS KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ± (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
GCP Hacking Ã¶ÄŸrenin ve pratik yapÄ±n: <img src="../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks EÄŸitim GCP KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ± (GRTE)**<img src="../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**abonelik planlarÄ±nÄ±**](https://github.com/sponsors/carlospolop) kontrol edin!
* **ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n ya da **Twitter**'da **bizi takip edin** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Hacking ipuÃ§larÄ±nÄ± paylaÅŸmak iÃ§in** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna PR gÃ¶nderin.

</details>
{% endhint %}

<figure><img src="../.gitbook/assets/CLOUD-logo-letters.svg" alt=""><figcaption></figcaption></figure>

## VCS

VCS, **Versiyon Kontrol Sistemi** anlamÄ±na gelir, bu sistemler geliÅŸtiricilerin **kaynak kodlarÄ±nÄ± yÃ¶netmelerine** olanak tanÄ±r. En yaygÄ±n olanÄ± **git**'tir ve genellikle ÅŸirketlerin aÅŸaÄŸÄ±daki **platformlardan** birinde kullandÄ±ÄŸÄ±nÄ± gÃ¶receksiniz:

* Github
* Gitlab
* Bitbucket
* Gitea
* Bulut saÄŸlayÄ±cÄ±larÄ± (kendi VCS platformlarÄ±nÄ± sunarlar)

## CI/CD Boru HatlarÄ±

CI/CD boru hatlarÄ±, geliÅŸtiricilerin Ã§eÅŸitli amaÃ§lar iÃ§in **kodun yÃ¼rÃ¼tÃ¼lmesini otomatikleÅŸtirmelerine** olanak tanÄ±r; bunlar arasÄ±nda uygulamalarÄ± oluÅŸturma, test etme ve daÄŸÄ±tma yer alÄ±r. Bu otomatik iÅŸ akÄ±ÅŸlarÄ±, **belirli eylemler** (Ã¶rneÄŸin, kod itmeleri, pull request'ler veya planlanmÄ±ÅŸ gÃ¶revler) tarafÄ±ndan **tetiklenir**. GeliÅŸtirme sÃ¼recini Ã¼retime taÅŸÄ±mak iÃ§in faydalÄ±dÄ±rlar.

Ancak, bu sistemlerin **bir yerde yÃ¼rÃ¼tÃ¼lmesi** gerekir ve genellikle **kod daÄŸÄ±tmak veya hassas bilgilere eriÅŸmek iÃ§in ayrÄ±calÄ±klÄ± kimlik bilgileri** ile Ã§alÄ±ÅŸÄ±r.

## VCS Pentesting Metodolojisi

{% hint style="info" %}
BazÄ± VCS platformlarÄ± bu bÃ¶lÃ¼m iÃ§in boru hatlarÄ± oluÅŸturulmasÄ±na izin verse de, yalnÄ±zca kaynak kodunun kontrolÃ¼ne yÃ¶nelik potansiyel saldÄ±rÄ±larÄ± analiz edeceÄŸiz.
{% endhint %}

Projenizin kaynak kodunu iÃ§eren platformlar hassas bilgiler iÃ§erir ve insanlar bu platformda verilen izinlerle Ã§ok dikkatli olmalÄ±dÄ±r. SaldÄ±rganlarÄ±n istismar edebileceÄŸi bazÄ± yaygÄ±n sorunlar ÅŸunlardÄ±r:

* **SÄ±zÄ±ntÄ±lar**: Kodunuzda commit'lerde sÄ±zÄ±ntÄ±lar varsa ve saldÄ±rgan repo'ya eriÅŸebiliyorsa (Ã§Ã¼nkÃ¼ kamuya aÃ§Ä±ktÄ±r veya eriÅŸimi vardÄ±r), sÄ±zÄ±ntÄ±larÄ± keÅŸfedebilir.
* **EriÅŸim**: EÄŸer bir saldÄ±rgan **VCS platformunda bir hesaba eriÅŸim saÄŸlayabiliyorsa**, **daha fazla gÃ¶rÃ¼nÃ¼rlÃ¼k ve izin** kazanabilir.
* **KayÄ±t**: BazÄ± platformlar yalnÄ±zca dÄ±ÅŸ kullanÄ±cÄ±larÄ±n hesap oluÅŸturmasÄ±na izin verir.
* **SSO**: BazÄ± platformlar kullanÄ±cÄ±larÄ±n kayÄ±t olmasÄ±na izin vermez, ancak geÃ§erli bir SSO ile eriÅŸim saÄŸlar (bu nedenle bir saldÄ±rgan Ã¶rneÄŸin github hesabÄ±nÄ± kullanarak girebilir).
* **Kimlik Bilgileri**: KullanÄ±cÄ± adÄ±+Åifre, kiÅŸisel token'lar, ssh anahtarlarÄ±, Oauth token'larÄ±, Ã§erezler... bir kullanÄ±cÄ±nÄ±n bir repo'ya eriÅŸmek iÃ§in Ã§alabileceÄŸi Ã§eÅŸitli token tÃ¼rleri vardÄ±r.
* **Webhooks**: VCS platformlarÄ± webhook'lar oluÅŸturulmasÄ±na izin verir. EÄŸer bunlar **gÃ¶rÃ¼nmeyen gizli anahtarlarla korunmuyorsa**, bir **saldÄ±rgan bunlarÄ± istismar edebilir**.
* EÄŸer hiÃ§bir gizli anahtar yoksa, saldÄ±rgan Ã¼Ã§Ã¼ncÃ¼ taraf platformun webhook'unu istismar edebilir.
* EÄŸer gizli anahtar URL'de ise, aynÄ± ÅŸey olur ve saldÄ±rgan gizli anahtara da sahip olur.
* **Kodun tehlikeye atÄ±lmasÄ±:** EÄŸer kÃ¶tÃ¼ niyetli bir aktÃ¶r repo'lar Ã¼zerinde bir tÃ¼r **yazma** eriÅŸimine sahipse, **kÃ¶tÃ¼ niyetli kod enjekte etmeye** Ã§alÄ±ÅŸabilir. BaÅŸarÄ±lÄ± olmak iÃ§in **dal korumalarÄ±nÄ± aÅŸmasÄ±** gerekebilir. Bu eylemler farklÄ± hedeflerle gerÃ§ekleÅŸtirilebilir:
* Ana dalÄ± tehlikeye atarak **Ã¼retimi tehlikeye atmak**.
* Ana dalÄ± (veya diÄŸer dallarÄ±) tehlikeye atarak **geliÅŸtirici makinelerini tehlikeye atmak** (Ã§Ã¼nkÃ¼ genellikle test, terraform veya diÄŸer ÅŸeyleri kendi makinelerinde repo iÃ§inde Ã§alÄ±ÅŸtÄ±rÄ±rlar).
* **Boru hattÄ±nÄ± tehlikeye atmak** (bir sonraki bÃ¶lÃ¼me bakÄ±n).

## Boru HatlarÄ± Pentesting Metodolojisi

Bir boru hattÄ±nÄ± tanÄ±mlamanÄ±n en yaygÄ±n yolu, boru hattÄ±nÄ±n inÅŸa edildiÄŸi **repo'da barÄ±ndÄ±rÄ±lan bir CI yapÄ±landÄ±rma dosyasÄ±** kullanmaktÄ±r. Bu dosya, yÃ¼rÃ¼tÃ¼len iÅŸlerin sÄ±rasÄ±nÄ±, akÄ±ÅŸÄ± etkileyen koÅŸullarÄ± ve yapÄ± ortamÄ± ayarlarÄ±nÄ± tanÄ±mlar.\
Bu dosyalar genellikle tutarlÄ± bir isim ve formata sahiptir, Ã¶rneÄŸin â€” Jenkinsfile (Jenkins), .gitlab-ci.yml (GitLab), .circleci/config.yml (CircleCI) ve .github/workflows altÄ±nda bulunan GitHub Actions YAML dosyalarÄ±. TetiklendiÄŸinde, boru hattÄ± iÅŸi **seÃ§ilen kaynaktan kodu Ã§eker** (Ã¶rneÄŸin, commit / dal) ve **CI yapÄ±landÄ±rma dosyasÄ±nda belirtilen komutlarÄ±** o kod Ã¼zerinde Ã§alÄ±ÅŸtÄ±rÄ±r.

Bu nedenle, saldÄ±rganÄ±n nihai hedefi, bir ÅŸekilde **bu yapÄ±landÄ±rma dosyalarÄ±nÄ±** veya **yÃ¼rÃ¼ttÃ¼kleri komutlarÄ± tehlikeye atmaktÄ±r**.

### PPE - Zehirli Boru HattÄ± YÃ¼rÃ¼tmesi

Zehirli Boru HattÄ± YÃ¼rÃ¼tmesi (PPE) yolu, bir SCM reposundaki izinleri istismar ederek bir CI boru hattÄ±nÄ± manipÃ¼le etmek ve zararlÄ± komutlar yÃ¼rÃ¼tmek iÃ§in kullanÄ±lÄ±r. Gerekli izinlere sahip kullanÄ±cÄ±lar, CI yapÄ±landÄ±rma dosyalarÄ±nÄ± veya boru hattÄ± iÅŸinde kullanÄ±lan diÄŸer dosyalarÄ± kÃ¶tÃ¼ niyetli komutlar eklemek iÃ§in deÄŸiÅŸtirebilir. Bu, CI boru hattÄ±nÄ± "zehirler" ve bu kÃ¶tÃ¼ niyetli komutlarÄ±n yÃ¼rÃ¼tÃ¼lmesine yol aÃ§ar.

KÃ¶tÃ¼ niyetli bir aktÃ¶rÃ¼n PPE saldÄ±rÄ±sÄ±nÄ± baÅŸarÄ±lÄ± bir ÅŸekilde gerÃ§ekleÅŸtirebilmesi iÃ§in:

* **VCS platformuna yazma eriÅŸimine sahip olmasÄ±** gerekir, Ã§Ã¼nkÃ¼ genellikle boru hatlarÄ± bir itme veya pull request gerÃ§ekleÅŸtirildiÄŸinde tetiklenir. (EriÅŸim elde etme yollarÄ±nÄ±n Ã¶zeti iÃ§in VCS pentesting metodolojisine bakÄ±n).
* Bazen bir **dÄ±ÅŸ PR'nin "yazma eriÅŸimi" olarak sayÄ±ldÄ±ÄŸÄ±nÄ±** unutmayÄ±n.
* Yazma izinlerine sahip olsa bile, **CI yapÄ±landÄ±rma dosyasÄ±nÄ± veya yapÄ±landÄ±rmanÄ±n dayandÄ±ÄŸÄ± diÄŸer dosyalarÄ± deÄŸiÅŸtirebileceÄŸinden emin olmasÄ±** gerekir.
* Bunun iÃ§in **dal korumalarÄ±nÄ± aÅŸabilmesi** gerekebilir.

ÃœÃ§ PPE Ã§eÅŸidi vardÄ±r:

* **D-PPE**: **DoÄŸrudan PPE** saldÄ±rÄ±sÄ±, aktÃ¶rÃ¼n **yÃ¼rÃ¼tÃ¼lecek CI yapÄ±landÄ±rma** dosyasÄ±nÄ± deÄŸiÅŸtirdiÄŸi durumdur.
* **I-DDE**: **DolaylÄ± PPE** saldÄ±rÄ±sÄ±, aktÃ¶rÃ¼n **yÃ¼rÃ¼tÃ¼lecek CI yapÄ±landÄ±rma dosyasÄ±nÄ±n** dayandÄ±ÄŸÄ± bir **dosyayÄ±** deÄŸiÅŸtirdiÄŸi durumdur (Ã¶rneÄŸin bir make dosyasÄ± veya terraform yapÄ±landÄ±rmasÄ±).
* **Halka AÃ§Ä±k PPE veya 3PE**: BazÄ± durumlarda, boru hatlarÄ± **repo'da yazma eriÅŸimi olmayan kullanÄ±cÄ±lar tarafÄ±ndan tetiklenebilir** (ve bu kullanÄ±cÄ±lar belki de organizasyonun bir parÃ§asÄ± bile olmayabilir) Ã§Ã¼nkÃ¼ PR gÃ¶nderebilirler.
* **3PE Komut Enjeksiyonu**: Genellikle, CI/CD boru hatlarÄ± **PR hakkÄ±nda bilgi iÃ§eren ortam deÄŸiÅŸkenleri** ayarlayacaktÄ±r. EÄŸer bu deÄŸer bir saldÄ±rgan tarafÄ±ndan kontrol edilebiliyorsa (Ã¶rneÄŸin PR'nin baÅŸlÄ±ÄŸÄ± gibi) ve **tehlikeli bir yerde** (Ã¶rneÄŸin **sh komutlarÄ±** yÃ¼rÃ¼tmek gibi) **kullanÄ±lÄ±yorsa**, bir saldÄ±rgan **orada komut enjekte edebilir**.

### Ä°stismar FaydalarÄ±

Bir boru hattÄ±nÄ± zehirlemenin Ã¼Ã§ Ã§eÅŸidini bildiÄŸimizde, baÅŸarÄ±lÄ± bir istismar sonrasÄ±nda bir saldÄ±rganÄ±n elde edebileceÄŸi ÅŸeylere bakalÄ±m:

* **Gizli Bilgiler**: Daha Ã¶nce belirtildiÄŸi gibi, boru hatlarÄ± iÅŸlerinin (kod alma, oluÅŸturma, daÄŸÄ±tma...) gerÃ§ekleÅŸtirilmesi iÃ§in **ayrÄ±calÄ±klara** ihtiyaÃ§ duyar ve bu ayrÄ±calÄ±klar genellikle **gizli bilgilerle** verilir. Bu gizli bilgiler genellikle **ortam deÄŸiÅŸkenleri veya sistem iÃ§indeki dosyalar** aracÄ±lÄ±ÄŸÄ±yla eriÅŸilebilir. Bu nedenle, bir saldÄ±rgan her zaman mÃ¼mkÃ¼n olduÄŸunca Ã§ok gizli bilgi sÄ±zdÄ±rmaya Ã§alÄ±ÅŸacaktÄ±r.
* Boru hattÄ± platformuna baÄŸlÄ± olarak, saldÄ±rgan **gizli bilgileri yapÄ±landÄ±rmada belirtmek zorunda kalabilir**. Bu, eÄŸer saldÄ±rgan CI yapÄ±landÄ±rma boru hattÄ±nÄ± deÄŸiÅŸtiremiyorsa (**I-PPE** Ã¶rneÄŸin), yalnÄ±zca o boru hattÄ±nÄ±n sahip olduÄŸu gizli bilgileri **sÄ±zdÄ±rabileceÄŸi** anlamÄ±na gelir.
* **Hesaplama**: Kod bir yerde yÃ¼rÃ¼tÃ¼lÃ¼r, nerede yÃ¼rÃ¼tÃ¼ldÃ¼ÄŸÃ¼ne baÄŸlÄ± olarak bir saldÄ±rgan daha ileriye geÃ§ebilir.
* **Yerel**: EÄŸer boru hatlarÄ± yerel olarak yÃ¼rÃ¼tÃ¼lÃ¼yorsa, bir saldÄ±rgan **daha fazla kaynaÄŸa eriÅŸimle iÃ§ aÄŸa** girebilir.
* **Bulut**: SaldÄ±rgan **buluttaki diÄŸer makinelere** eriÅŸebilir ama aynÄ± zamanda **IAM rolleri/hizmet hesaplarÄ±** **token'larÄ±nÄ±** sÄ±zdÄ±rarak **bulut iÃ§inde daha fazla eriÅŸim** elde edebilir.
* **Platform makinesi**: Bazen iÅŸler **boru hattÄ± platform makineleri** iÃ§inde yÃ¼rÃ¼tÃ¼lÃ¼r, bu makineler genellikle **daha fazla eriÅŸim** olmadan bir bulut iÃ§indedir.
* **SeÃ§in:** Bazen **boru hattÄ± platformu birkaÃ§ makineyi yapÄ±landÄ±rmÄ±ÅŸ olacaktÄ±r** ve eÄŸer **CI yapÄ±landÄ±rma dosyasÄ±nÄ± deÄŸiÅŸtirebilirseniz**, kÃ¶tÃ¼ niyetli kodu nerede Ã§alÄ±ÅŸtÄ±rmak istediÄŸinizi **belirtebilirsiniz**. Bu durumda, bir saldÄ±rgan muhtemelen her olasÄ± makinede bir ters shell Ã§alÄ±ÅŸtÄ±rarak daha fazla istismar etmeye Ã§alÄ±ÅŸacaktÄ±r.
* **Ãœretimi tehlikeye atmak**: EÄŸer boru hattÄ± iÃ§indeyseniz ve nihai versiyon buradan oluÅŸturulup daÄŸÄ±tÄ±lÄ±yorsa, **Ã¼retimde Ã§alÄ±ÅŸacak kodu tehlikeye atabilirsiniz**.

## Daha Fazla Ä°lgili Bilgi

### AraÃ§lar & CIS Benchmark

* [**Chain-bench**](https://github.com/aquasecurity/chain-bench), yeni bir [**CIS YazÄ±lÄ±m Tedarik Zinciri benchmark**](https://github.com/aquasecurity/chain-bench/blob/main/docs/CIS-Software-Supply-Chain-Security-Guide-v1.0.pdf) temelinde gÃ¼venlik uyumluluÄŸu iÃ§in yazÄ±lÄ±m tedarik zinciri yÄ±ÄŸÄ±nÄ±nÄ±zÄ± denetlemek iÃ§in aÃ§Ä±k kaynak bir araÃ§tÄ±r. Denetim, kod zamanÄ±ndan daÄŸÄ±tÄ±m zamanÄ±na kadar riskleri ortaya Ã§Ä±karabileceÄŸi tÃ¼m SDLC sÃ¼recine odaklanÄ±r.

### En Ä°yi 10 CI/CD GÃ¼venlik Riski

Cider'a gÃ¶re en iyi 10 CI/CD riskine dair bu ilginÃ§ makaleyi kontrol edin: [**https://www.cidersecurity.io/top-10-cicd-security-risks/**](https://www.cidersecurity.io/top-10-cicd-security-risks/)

### Laboratuvarlar

* Yerel olarak Ã§alÄ±ÅŸtÄ±rabileceÄŸiniz her platformda, test etmek iÃ§in istediÄŸiniz gibi yapÄ±landÄ±rabileceÄŸiniz ÅŸekilde nasÄ±l baÅŸlatÄ±lacaÄŸÄ±nÄ± bulacaksÄ±nÄ±z.
* Gitea + Jenkins laboratuvarÄ±: [https://github.com/cider-security-research/cicd-goat](https://github.com/cider-security-research/cicd-goat)

### Otomatik AraÃ§lar

* [**Checkov**](https://github.com/bridgecrewio/checkov): **Checkov**, altyapÄ± olarak kod iÃ§in statik kod analizi aracÄ±dÄ±r.

## Referanslar

* [https://www.cidersecurity.io/blog/research/ppe-poisoned-pipeline-execution/?utm\_source=github\&utm\_medium=github\_page\&utm\_campaign=ci%2fcd%20goat\_060422](https://www.cidersecurity.io/blog/research/ppe-poisoned-pipeline-execution/?utm_source=github\&utm_medium=github_page\&utm_campaign=ci%2fcd%20goat_060422)

{% hint style="success" %}
AWS Hacking Ã¶ÄŸrenin ve pratik yapÄ±n:<img src="../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks EÄŸitim AWS KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ± (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
GCP Hacking Ã¶ÄŸrenin ve pratik yapÄ±n: <img src="../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks EÄŸitim GCP KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ± (GRTE)**<img src="../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**abonelik planlarÄ±nÄ±**](https://github.com/sponsors/carlospolop) kontrol edin!
* **ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n ya da **Twitter**'da **bizi takip edin** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Hacking ipuÃ§larÄ±nÄ± paylaÅŸmak iÃ§in** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna PR gÃ¶nderin.

</details>
{% endhint %}
