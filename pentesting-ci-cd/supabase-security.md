# Supabase Security

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../.gitbook/assets/image (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegram**](https://t.me/peass) lub **led藕** nas na **Twitterze**  [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podziel si trikami hackingowymi, przesyajc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repozytori贸w github.

</details>
{% endhint %}

## Basic Information

Zgodnie z ich [**stron docelow**](https://supabase.com/): Supabase to otwarto藕r贸dowa alternatywa dla Firebase. Rozpocznij sw贸j projekt z baz danych Postgres, uwierzytelnianiem, natychmiastowymi API, funkcjami Edge, subskrypcjami w czasie rzeczywistym, przechowywaniem i osadzeniami wektorowymi.

### Subdomain

Zasadniczo, gdy projekt jest tworzony, u偶ytkownik otrzymuje subdomen supabase.co, tak jak: **`jnanozjdybtpqgcwhdiz.supabase.co`**

## **Database configuration**

{% hint style="success" %}
**Te dane mo偶na uzyska z linku takiego jak `https://supabase.com/dashboard/project/<project-id>/settings/database`**
{% endhint %}

Ta **baza danych** bdzie wdro偶ona w jakim regionie AWS, a aby si z ni poczy, mo偶na to zrobi, czc si z: `postgres://postgres.jnanozjdybtpqgcwhdiz:[YOUR-PASSWORD]@aws-0-us-west-1.pooler.supabase.com:5432/postgres` (zostao to utworzone w us-west-1).\
Haso to **haso, kt贸re u偶ytkownik wprowadzi** wczeniej.

Dlatego, poniewa偶 subdomena jest znana i jest u偶ywana jako nazwa u偶ytkownika, a regiony AWS s ograniczone, mo偶e by mo偶liwe, aby spr贸bowa **brute force hasa**.

Ta sekcja zawiera r贸wnie偶 opcje do:

* Zresetowania hasa bazy danych
* Skonfigurowania puli pocze
* Skonfigurowania SSL: Odrzu poczenia w formacie tekstowym (domylnie s wczone)
* Skonfigurowania rozmiaru dysku
* Zastosowania ogranicze i zakaz贸w sieciowych

## API Configuration

{% hint style="success" %}
**Te dane mo偶na uzyska z linku takiego jak `https://supabase.com/dashboard/project/<project-id>/settings/api`**
{% endhint %}

URL do uzyskania dostpu do API supabase w Twoim projekcie bdzie wyglda tak: `https://jnanozjdybtpqgcwhdiz.supabase.co`.

### anon api keys

Wygeneruje r贸wnie偶 **anon API key** (`role: "anon"`), taki jak: `eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpuYW5vemRyb2J0cHFnY3doZGl6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3MTQ5OTI3MTksImV4cCI6MjAzMDU2ODcxOX0.sRN0iMGM5J741pXav7UxeChyqBE9_Z-T0tLA9Zehvqk`, kt贸ry aplikacja bdzie musiaa u偶y, aby skontaktowa si z kluczem API ujawnionym w naszym przykadzie w

Mo偶na znale藕 API REST do kontaktu z tym API w [**dokumentacji**](https://supabase.com/docs/reference/self-hosting-auth/returns-the-configuration-settings-for-the-gotrue-server), ale najbardziej interesujce punkty kocowe to:

<details>

<summary>Signup (/auth/v1/signup)</summary>
```
POST /auth/v1/signup HTTP/2
Host: id.io.net
Content-Length: 90
X-Client-Info: supabase-js-web/2.39.2
Sec-Ch-Ua: "Not-A.Brand";v="99", "Chromium";v="124"
Sec-Ch-Ua-Mobile: ?0
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpuYW5vemRyb2J0cHFnY3doZGl6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3MTQ5OTI3MTksImV4cCI6MjAzMDU2ODcxOX0.sRN0iMGM5J741pXav7UxeChyqBE9_Z-T0tLA9Zehvqk
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/124.0.6367.60 Safari/537.36
Content-Type: application/json;charset=UTF-8
Apikey: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpuYW5vemRyb2J0cHFnY3doZGl6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3MTQ5OTI3MTksImV4cCI6MjAzMDU2ODcxOX0.sRN0iMGM5J741pXav7UxeChyqBE9_Z-T0tLA9Zehvqk
Sec-Ch-Ua-Platform: "macOS"
Accept: */*
Origin: https://cloud.io.net
Sec-Fetch-Site: same-site
Sec-Fetch-Mode: cors
Sec-Fetch-Dest: empty
Referer: https://cloud.io.net/
Accept-Encoding: gzip, deflate, br
Accept-Language: en-GB,en-US;q=0.9,en;q=0.8
Priority: u=1, i

{"email":"test@exmaple.com","password":"SomeCOmplexPwd239."}
```
</details>

<details>

<summary>Logowanie (/auth/v1/token?grant_type=password)</summary>
```
POST /auth/v1/token?grant_type=password HTTP/2
Host: hypzbtgspjkludjcnjxl.supabase.co
Content-Length: 80
X-Client-Info: supabase-js-web/2.39.2
Sec-Ch-Ua: "Not-A.Brand";v="99", "Chromium";v="124"
Sec-Ch-Ua-Mobile: ?0
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpuYW5vemRyb2J0cHFnY3doZGl6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3MTQ5OTI3MTksImV4cCI6MjAzMDU2ODcxOX0.sRN0iMGM5J741pXav7UxeChyqBE9_Z-T0tLA9Zehvqk
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/124.0.6367.60 Safari/537.36
Content-Type: application/json;charset=UTF-8
Apikey: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpuYW5vemRyb2J0cHFnY3doZGl6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3MTQ5OTI3MTksImV4cCI6MjAzMDU2ODcxOX0.sRN0iMGM5J741pXav7UxeChyqBE9_Z-T0tLA9Zehvqk
Sec-Ch-Ua-Platform: "macOS"
Accept: */*
Origin: https://cloud.io.net
Sec-Fetch-Site: same-site
Sec-Fetch-Mode: cors
Sec-Fetch-Dest: empty
Referer: https://cloud.io.net/
Accept-Encoding: gzip, deflate, br
Accept-Language: en-GB,en-US;q=0.9,en;q=0.8
Priority: u=1, i

{"email":"test@exmaple.com","password":"SomeCOmplexPwd239."}
```
</details>

Wic, za ka偶dym razem, gdy odkryjesz klienta u偶ywajcego supabase z subdomen, kt贸r mu przyznano (mo偶liwe, 偶e subdomena firmy ma CNAME nad ich subdomen supabase), mo偶esz spr贸bowa **utworzy nowe konto na platformie za pomoc API supabase**.

### klucze API secret / service\_role

Klucz API secret r贸wnie偶 zostanie wygenerowany z **`role: "service_role"`**. Ten klucz API powinien by tajny, poniewa偶 bdzie m贸g obej **Row Level Security**.

Klucz API wyglda tak: `eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpuYW5vemRyb2J0cHFnY3doZGl6Iiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTcxNDk5MjcxOSwiZXhwIjoyMDMwNTY4NzE5fQ.0a8fHGp3N_GiPq0y0dwfs06ywd-zhTwsm486Tha7354`

### JWT Secret

**JWT Secret** r贸wnie偶 zostanie wygenerowany, aby aplikacja moga **tworzy i podpisywa niestandardowe tokeny JWT**.

## Uwierzytelnianie

### Rejestracje

{% hint style="success" %}
Domylnie supabase pozwoli **nowym u偶ytkownikom na tworzenie kont** w Twoim projekcie, korzystajc z wczeniej wspomnianych punkt贸w kocowych API.
{% endhint %}

Jednak te nowe konta, domylnie, **bd musiay zweryfikowa sw贸j adres e-mail**, aby m贸c zalogowa si na konto. Mo偶liwe jest wczenie **"Zezw贸l na anonimowe logowanie"**, aby umo偶liwi ludziom logowanie si bez weryfikacji adresu e-mail. Mo偶e to da dostp do **nieoczekiwanych danych** (otrzymuj role `public` i `authenticated`).\
To bardzo zy pomys, poniewa偶 supabase pobiera opaty za aktywnego u偶ytkownika, wic ludzie mog tworzy u偶ytkownik贸w i logowa si, a supabase bdzie pobiera opaty za tych:

<figure><img src="../.gitbook/assets/image (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

### Hasa i sesje

Mo偶liwe jest okrelenie minimalnej dugoci hasa (domylnie), wymaga (brak domylnie) i zabronienie u偶ywania wyciekych hase.\
Zaleca si **poprawienie wymaga, poniewa偶 domylne s sabe**.

* Sesje u偶ytkownik贸w: Mo偶liwe jest skonfigurowanie, jak dziaaj sesje u偶ytkownik贸w (czasy oczekiwania, 1 sesja na u偶ytkownika...)
* Ochrona przed botami i nadu偶yciami: Mo偶liwe jest wczenie Captcha.

### Ustawienia SMTP

Mo偶liwe jest ustawienie SMTP do wysyania e-maili.

### Ustawienia zaawansowane

* Ustaw czas wyganicia dla token贸w dostpu (3600 domylnie)
* Ustaw wykrywanie i uniewa偶nianie potencjalnie skompromitowanych token贸w odwie偶ania oraz czas oczekiwania
* MFA: Wska藕, ile czynnik贸w MFA mo偶e by zarejestrowanych jednoczenie na u偶ytkownika (10 domylnie)
* Maksymalna liczba bezporednich pocze z baz danych: Maksymalna liczba pocze u偶ywanych do uwierzytelniania (10 domylnie)
* Maksymalny czas trwania 偶dania: Maksymalny czas, jaki mo偶e trwa 偶danie uwierzytelnienia (10s domylnie)

## Przechowywanie

{% hint style="success" %}
Supabase pozwala **przechowywa pliki** i udostpnia je za porednictwem URL (u偶ywa koszyk贸w S3).
{% endhint %}

* Ustaw limit rozmiaru pliku do przesania (domylnie 50MB)
* Poczenie S3 jest podawane za pomoc URL, takiego jak: `https://jnanozjdybtpqgcwhdiz.supabase.co/storage/v1/s3`
* Mo偶liwe jest **za偶danie klucza dostpu S3**, kt贸ry skada si z `access key ID` (np. `a37d96544d82ba90057e0e06131d0a7b`) i `secret access key` (np. `58420818223133077c2cec6712a4f909aec93b4daeedae205aa8e30d5a860628`)

## Funkcje Edge

Mo偶liwe jest r贸wnie偶 **przechowywanie sekret贸w** w supabase, kt贸re bd **dostpne przez funkcje edge** (mog by tworzone i usuwane z sieci, ale nie mo偶na uzyska dostpu do ich wartoci bezporednio).

{% hint style="success" %}
Ucz si i wicz Hacking AWS:<img src="../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../.gitbook/assets/image (1).png" alt="" data-size="line">\
Ucz si i wicz Hacking GCP: <img src="../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Wsparcie HackTricks</summary>

* Sprawd藕 [**plany subskrypcyjne**](https://github.com/sponsors/carlospolop)!
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegram**](https://t.me/peass) lub **led藕** nas na **Twitterze**  [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podziel si sztuczkami hackingowymi, przesyajc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repozytori贸w github.

</details>
{% endhint %}
