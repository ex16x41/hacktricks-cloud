# Supabase Security

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../.gitbook/assets/image (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** 游눫 [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** 游냕 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Informaci칩n B치sica

Seg칰n su [**p치gina de inicio**](https://supabase.com/): Supabase es una alternativa de c칩digo abierto a Firebase. Comienza tu proyecto con una base de datos Postgres, Autenticaci칩n, APIs instant치neas, Funciones Edge, suscripciones en tiempo real, Almacenamiento y embeddings vectoriales.

### Subdominio

B치sicamente, cuando se crea un proyecto, el usuario recibir치 un subdominio supabase.co como: **`jnanozjdybtpqgcwhdiz.supabase.co`**

## **Configuraci칩n de la base de datos**

{% hint style="success" %}
**Estos datos se pueden acceder desde un enlace como `https://supabase.com/dashboard/project/<project-id>/settings/database`**
{% endhint %}

Esta **base de datos** se desplegar치 en alguna regi칩n de AWS, y para conectarse a ella ser칤a posible hacerlo conect치ndose a: `postgres://postgres.jnanozjdybtpqgcwhdiz:[YOUR-PASSWORD]@aws-0-us-west-1.pooler.supabase.com:5432/postgres` (esto fue creado en us-west-1).\
La contrase침a es una **contrase침a que el usuario puso** previamente.

Por lo tanto, dado que el subdominio es conocido y se usa como nombre de usuario y las regiones de AWS son limitadas, podr칤a ser posible intentar **fuerza bruta la contrase침a**.

Esta secci칩n tambi칠n contiene opciones para:

* Restablecer la contrase침a de la base de datos
* Configurar el agrupamiento de conexiones
* Configurar SSL: Rechazar conexiones en texto plano (por defecto est치n habilitadas)
* Configurar el tama침o del disco
* Aplicar restricciones y prohibiciones de red

## Configuraci칩n de la API

{% hint style="success" %}
**Estos datos se pueden acceder desde un enlace como `https://supabase.com/dashboard/project/<project-id>/settings/api`**
{% endhint %}

La URL para acceder a la API de supabase en tu proyecto ser치 como: `https://jnanozjdybtpqgcwhdiz.supabase.co`.

### claves api anon

Tambi칠n generar치 una **clave API anon** (`role: "anon"`), como: `eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpuYW5vemRyb2J0cHFnY3doZGl6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3MTQ5OTI3MTksImV4cCI6MjAzMDU2ODcxOX0.sRN0iMGM5J741pXav7UxeChyqBE9_Z-T0tLA9Zehvqk` que la aplicaci칩n necesitar치 usar para contactar la clave API expuesta en nuestro ejemplo en

Es posible encontrar la API REST para contactar esta API en la [**docs**](https://supabase.com/docs/reference/self-hosting-auth/returns-the-configuration-settings-for-the-gotrue-server), pero los endpoints m치s interesantes ser칤an:

<details>

<summary>Signup (/auth/v1/signup)</summary>
```
POST /auth/v1/signup HTTP/2
Host: id.io.net
Content-Length: 90
X-Client-Info: supabase-js-web/2.39.2
Sec-Ch-Ua: "Not-A.Brand";v="99", "Chromium";v="124"
Sec-Ch-Ua-Mobile: ?0
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpuYW5vemRyb2J0cHFnY3doZGl6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3MTQ5OTI3MTksImV4cCI6MjAzMDU2ODcxOX0.sRN0iMGM5J741pXav7UxeChyqBE9_Z-T0tLA9Zehvqk
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/124.0.6367.60 Safari/537.36
Content-Type: application/json;charset=UTF-8
Apikey: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpuYW5vemRyb2J0cHFnY3doZGl6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3MTQ5OTI3MTksImV4cCI6MjAzMDU2ODcxOX0.sRN0iMGM5J741pXav7UxeChyqBE9_Z-T0tLA9Zehvqk
Sec-Ch-Ua-Platform: "macOS"
Accept: */*
Origin: https://cloud.io.net
Sec-Fetch-Site: same-site
Sec-Fetch-Mode: cors
Sec-Fetch-Dest: empty
Referer: https://cloud.io.net/
Accept-Encoding: gzip, deflate, br
Accept-Language: en-GB,en-US;q=0.9,en;q=0.8
Priority: u=1, i

{"email":"test@exmaple.com","password":"SomeCOmplexPwd239."}
```
</details>

<details>

<summary>Iniciar sesi칩n (/auth/v1/token?grant_type=password)</summary>
```
POST /auth/v1/token?grant_type=password HTTP/2
Host: hypzbtgspjkludjcnjxl.supabase.co
Content-Length: 80
X-Client-Info: supabase-js-web/2.39.2
Sec-Ch-Ua: "Not-A.Brand";v="99", "Chromium";v="124"
Sec-Ch-Ua-Mobile: ?0
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpuYW5vemRyb2J0cHFnY3doZGl6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3MTQ5OTI3MTksImV4cCI6MjAzMDU2ODcxOX0.sRN0iMGM5J741pXav7UxeChyqBE9_Z-T0tLA9Zehvqk
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/124.0.6367.60 Safari/537.36
Content-Type: application/json;charset=UTF-8
Apikey: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpuYW5vemRyb2J0cHFnY3doZGl6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3MTQ5OTI3MTksImV4cCI6MjAzMDU2ODcxOX0.sRN0iMGM5J741pXav7UxeChyqBE9_Z-T0tLA9Zehvqk
Sec-Ch-Ua-Platform: "macOS"
Accept: */*
Origin: https://cloud.io.net
Sec-Fetch-Site: same-site
Sec-Fetch-Mode: cors
Sec-Fetch-Dest: empty
Referer: https://cloud.io.net/
Accept-Encoding: gzip, deflate, br
Accept-Language: en-GB,en-US;q=0.9,en;q=0.8
Priority: u=1, i

{"email":"test@exmaple.com","password":"SomeCOmplexPwd239."}
```
</details>

Entonces, cada vez que descubras un cliente que utiliza supabase con el subdominio que se le otorg칩 (es posible que un subdominio de la empresa tenga un CNAME sobre su subdominio de supabase), podr칤as intentar **crear una nueva cuenta en la plataforma utilizando la API de supabase**.

### claves api secretas / service\_role

Una clave API secreta tambi칠n se generar치 con **`role: "service_role"`**. Esta clave API debe ser secreta porque podr치 eludir **Row Level Security**.

La clave API se ve as칤: `eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpuYW5vemRyb2J0cHFnY3doZGl6Iiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTcxNDk5MjcxOSwiZXhwIjoyMDMwNTY4NzE5fQ.0a8fHGp3N_GiPq0y0dwfs06ywd-zhTwsm486Tha7354`

### Secreto JWT

Un **secreto JWT** tambi칠n se generar치 para que la aplicaci칩n pueda **crear y firmar tokens JWT personalizados**.

## Autenticaci칩n

### Registros

{% hint style="success" %}
Por **defecto**, supabase permitir치 **que nuevos usuarios creen cuentas** en tu proyecto utilizando los endpoints de API mencionados anteriormente.
{% endhint %}

Sin embargo, estas nuevas cuentas, por defecto, **necesitar치n validar su direcci칩n de correo electr칩nico** para poder iniciar sesi칩n en la cuenta. Es posible habilitar **"Permitir inicios de sesi칩n an칩nimos"** para permitir que las personas inicien sesi칩n sin verificar su direcci칩n de correo electr칩nico. Esto podr칤a otorgar acceso a **datos inesperados** (obtienen los roles `public` y `authenticated`).\
Esta es una muy mala idea porque supabase cobra por usuario activo, por lo que las personas podr칤an crear usuarios e iniciar sesi칩n y supabase cobrar치 por esos:

<figure><img src="../.gitbook/assets/image (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

### Contrase침as y sesiones

Es posible indicar la longitud m칤nima de la contrase침a (por defecto), requisitos (no por defecto) y deshabilitar el uso de contrase침as filtradas.\
Se recomienda **mejorar los requisitos ya que los predeterminados son d칠biles**.

* Sesiones de usuario: Es posible configurar c칩mo funcionan las sesiones de usuario (tiempos de espera, 1 sesi칩n por usuario...)
* Protecci칩n contra bots y abusos: Es posible habilitar Captcha.

### Configuraciones SMTP

Es posible establecer un SMTP para enviar correos electr칩nicos.

### Configuraciones avanzadas

* Establecer tiempo de expiraci칩n para tokens de acceso (3600 por defecto)
* Establecer para detectar y revocar tokens de actualizaci칩n potencialmente comprometidos y tiempo de espera
* MFA: Indicar cu치ntos factores MFA pueden ser inscritos a la vez por usuario (10 por defecto)
* M치x. Conexiones directas a la base de datos: N칰mero m치ximo de conexiones utilizadas para autenticaci칩n (10 por defecto)
* Duraci칩n m치xima de la solicitud: Tiempo m치ximo permitido para que dure una solicitud de autenticaci칩n (10s por defecto)

## Almacenamiento

{% hint style="success" %}
Supabase permite **almacenar archivos** y hacerlos accesibles a trav칠s de una URL (utiliza buckets S3).
{% endhint %}

* Establecer el l칤mite de tama침o de archivo de carga (el predeterminado es 50MB)
* La conexi칩n S3 se proporciona con una URL como: `https://jnanozjdybtpqgcwhdiz.supabase.co/storage/v1/s3`
* Es posible **solicitar una clave de acceso S3** que se forma por un `access key ID` (por ejemplo, `a37d96544d82ba90057e0e06131d0a7b`) y una `secret access key` (por ejemplo, `58420818223133077c2cec6712a4f909aec93b4daeedae205aa8e30d5a860628`)

## Funciones Edge

Es posible **almacenar secretos** en supabase tambi칠n, que ser치n **accesibles por funciones edge** (se pueden crear y eliminar desde la web, pero no es posible acceder a su valor directamente).

{% hint style="success" %}
Aprende y practica Hacking en AWS:<img src="../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../.gitbook/assets/image (1).png" alt="" data-size="line">\
Aprende y practica Hacking en GCP: <img src="../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Apoya a HackTricks</summary>

* Revisa los [**planes de suscripci칩n**](https://github.com/sponsors/carlospolop)!
* **칔nete al** 游눫 [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s칤guenos** en **Twitter** 游냕 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Comparte trucos de hacking enviando PRs a los** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repositorios de github.

</details>
{% endhint %}
