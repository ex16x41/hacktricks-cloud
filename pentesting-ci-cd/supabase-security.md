# S√©curit√© de Supabase

{% hint style="success" %}
Apprenez et pratiquez le hacking AWS :<img src="../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../.gitbook/assets/image (1).png" alt="" data-size="line">\
Apprenez et pratiquez le hacking GCP : <img src="../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Soutenir HackTricks</summary>

* V√©rifiez les [**plans d'abonnement**](https://github.com/sponsors/carlospolop) !
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez-nous sur** **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Partagez des astuces de hacking en soumettant des PRs aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) d√©p√¥ts github.

</details>
{% endhint %}

## Informations de base

Selon leur [**page d'accueil**](https://supabase.com/) : Supabase est une alternative open source √† Firebase. Commencez votre projet avec une base de donn√©es Postgres, Authentification, APIs instantan√©es, Fonctions Edge, abonnements en temps r√©el, Stockage et embeddings vectoriels.

### Sous-domaine

En gros, lorsqu'un projet est cr√©√©, l'utilisateur recevra un sous-domaine supabase.co comme : **`jnanozjdybtpqgcwhdiz.supabase.co`**

## **Configuration de la base de donn√©es**

{% hint style="success" %}
**Ces donn√©es peuvent √™tre accessibles via un lien comme `https://supabase.com/dashboard/project/<project-id>/settings/database`**
{% endhint %}

Cette **base de donn√©es** sera d√©ploy√©e dans une r√©gion AWS, et pour s'y connecter, il serait possible de le faire en se connectant √† : `postgres://postgres.jnanozjdybtpqgcwhdiz:[YOUR-PASSWORD]@aws-0-us-west-1.pooler.supabase.com:5432/postgres` (cela a √©t√© cr√©√© dans us-west-1).\
Le mot de passe est un **mot de passe que l'utilisateur a saisi** pr√©c√©demment.

Par cons√©quent, comme le sous-domaine est connu et qu'il est utilis√© comme nom d'utilisateur et que les r√©gions AWS sont limit√©es, il pourrait √™tre possible d'essayer de **forcer le mot de passe**.

Cette section contient √©galement des options pour :

* R√©initialiser le mot de passe de la base de donn√©es
* Configurer le pooling de connexions
* Configurer SSL : Rejeter les connexions en texte clair (par d√©faut, elles sont activ√©es)
* Configurer la taille du disque
* Appliquer des restrictions et des interdictions r√©seau

## Configuration de l'API

{% hint style="success" %}
**Ces donn√©es peuvent √™tre accessibles via un lien comme `https://supabase.com/dashboard/project/<project-id>/settings/api`**
{% endhint %}

L'URL pour acc√©der √† l'API supabase dans votre projet sera comme : `https://jnanozjdybtpqgcwhdiz.supabase.co`.

### cl√©s API anon

Elle g√©n√©rera √©galement une **cl√© API anon** (`role: "anon"`), comme : `eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpuYW5vemRyb2J0cHFnY3doZGl6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3MTQ5OTI3MTksImV4cCI6MjAzMDU2ODcxOX0.sRN0iMGM5J741pXav7UxeChyqBE9_Z-T0tLA9Zehvqk` que l'application devra utiliser pour contacter la cl√© API expos√©e dans notre exemple dans

Il est possible de trouver l'API REST pour contacter cette API dans les [**docs**](https://supabase.com/docs/reference/self-hosting-auth/returns-the-configuration-settings-for-the-gotrue-server), mais les points de terminaison les plus int√©ressants seraient :

<details>

<summary>Inscription (/auth/v1/signup)</summary>
```
POST /auth/v1/signup HTTP/2
Host: id.io.net
Content-Length: 90
X-Client-Info: supabase-js-web/2.39.2
Sec-Ch-Ua: "Not-A.Brand";v="99", "Chromium";v="124"
Sec-Ch-Ua-Mobile: ?0
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpuYW5vemRyb2J0cHFnY3doZGl6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3MTQ5OTI3MTksImV4cCI6MjAzMDU2ODcxOX0.sRN0iMGM5J741pXav7UxeChyqBE9_Z-T0tLA9Zehvqk
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/124.0.6367.60 Safari/537.36
Content-Type: application/json;charset=UTF-8
Apikey: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpuYW5vemRyb2J0cHFnY3doZGl6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3MTQ5OTI3MTksImV4cCI6MjAzMDU2ODcxOX0.sRN0iMGM5J741pXav7UxeChyqBE9_Z-T0tLA9Zehvqk
Sec-Ch-Ua-Platform: "macOS"
Accept: */*
Origin: https://cloud.io.net
Sec-Fetch-Site: same-site
Sec-Fetch-Mode: cors
Sec-Fetch-Dest: empty
Referer: https://cloud.io.net/
Accept-Encoding: gzip, deflate, br
Accept-Language: en-GB,en-US;q=0.9,en;q=0.8
Priority: u=1, i

{"email":"test@exmaple.com","password":"SomeCOmplexPwd239."}
```
</details>

<details>

<summary>Connexion (/auth/v1/token?grant_type=password)</summary>
```
POST /auth/v1/token?grant_type=password HTTP/2
Host: hypzbtgspjkludjcnjxl.supabase.co
Content-Length: 80
X-Client-Info: supabase-js-web/2.39.2
Sec-Ch-Ua: "Not-A.Brand";v="99", "Chromium";v="124"
Sec-Ch-Ua-Mobile: ?0
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpuYW5vemRyb2J0cHFnY3doZGl6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3MTQ5OTI3MTksImV4cCI6MjAzMDU2ODcxOX0.sRN0iMGM5J741pXav7UxeChyqBE9_Z-T0tLA9Zehvqk
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/124.0.6367.60 Safari/537.36
Content-Type: application/json;charset=UTF-8
Apikey: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpuYW5vemRyb2J0cHFnY3doZGl6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3MTQ5OTI3MTksImV4cCI6MjAzMDU2ODcxOX0.sRN0iMGM5J741pXav7UxeChyqBE9_Z-T0tLA9Zehvqk
Sec-Ch-Ua-Platform: "macOS"
Accept: */*
Origin: https://cloud.io.net
Sec-Fetch-Site: same-site
Sec-Fetch-Mode: cors
Sec-Fetch-Dest: empty
Referer: https://cloud.io.net/
Accept-Encoding: gzip, deflate, br
Accept-Language: en-GB,en-US;q=0.9,en;q=0.8
Priority: u=1, i

{"email":"test@exmaple.com","password":"SomeCOmplexPwd239."}
```
</details>

Donc, chaque fois que vous d√©couvrez un client utilisant supabase avec le sous-domaine qui lui a √©t√© accord√© (il est possible qu'un sous-domaine de l'entreprise ait un CNAME sur leur sous-domaine supabase), vous pourriez essayer de **cr√©er un nouveau compte sur la plateforme en utilisant l'API supabase**.

### cl√©s API secret / service\_role

Une cl√© API secr√®te sera √©galement g√©n√©r√©e avec **`role: "service_role"`**. Cette cl√© API doit rester secr√®te car elle pourra contourner **Row Level Security**.

La cl√© API ressemble √† ceci : `eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpuYW5vemRyb2J0cHFnY3doZGl6Iiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTcxNDk5MjcxOSwiZXhwIjoyMDMwNTY4NzE5fQ.0a8fHGp3N_GiPq0y0dwfs06ywd-zhTwsm486Tha7354`

### JWT Secret

Un **JWT Secret** sera √©galement g√©n√©r√© afin que l'application puisse **cr√©er et signer des jetons JWT personnalis√©s**.

## Authentification

### Inscription

{% hint style="success" %}
Par **d√©faut**, supabase permettra **aux nouveaux utilisateurs de cr√©er des comptes** sur votre projet en utilisant les points de terminaison API mentionn√©s pr√©c√©demment.
{% endhint %}

Cependant, ces nouveaux comptes, par d√©faut, **devront valider leur adresse e-mail** pour pouvoir se connecter au compte. Il est possible d'activer **"Autoriser les connexions anonymes"** pour permettre aux personnes de se connecter sans v√©rifier leur adresse e-mail. Cela pourrait donner acc√®s √† **des donn√©es inattendues** (ils obtiennent les r√¥les `public` et `authenticated`).\
C'est une tr√®s mauvaise id√©e car supabase facture par utilisateur actif, donc les gens pourraient cr√©er des utilisateurs et se connecter et supabase facturera pour ceux-ci :

<figure><img src="../.gitbook/assets/image (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

### Mots de passe & sessions

Il est possible d'indiquer la longueur minimale des mots de passe (par d√©faut), les exigences (aucune par d√©faut) et d'interdire l'utilisation de mots de passe compromis.\
Il est recommand√© d'**am√©liorer les exigences car celles par d√©faut sont faibles**.

* Sessions utilisateur : Il est possible de configurer le fonctionnement des sessions utilisateur (d√©lai, 1 session par utilisateur...)
* Protection contre les bots et les abus : Il est possible d'activer le Captcha.

### Param√®tres SMTP

Il est possible de d√©finir un SMTP pour envoyer des e-mails.

### Param√®tres avanc√©s

* D√©finir le temps d'expiration des jetons d'acc√®s (3600 par d√©faut)
* D√©tecter et r√©voquer les jetons de rafra√Æchissement potentiellement compromis et le d√©lai d'attente
* MFA : Indiquer combien de facteurs MFA peuvent √™tre enregistr√©s √† la fois par utilisateur (10 par d√©faut)
* Max Connections Directes √† la Base de Donn√©es : Nombre maximum de connexions utilis√©es pour l'authentification (10 par d√©faut)
* Dur√©e Maximale de la Demande : Temps maximum autoris√© pour qu'une demande d'authentification dure (10s par d√©faut)

## Stockage

{% hint style="success" %}
Supabase permet **de stocker des fichiers** et de les rendre accessibles via une URL (il utilise des buckets S3).
{% endhint %}

* D√©finir la limite de taille de fichier √† t√©l√©charger (la valeur par d√©faut est 50 Mo)
* La connexion S3 est donn√©e avec une URL comme : `https://jnanozjdybtpqgcwhdiz.supabase.co/storage/v1/s3`
* Il est possible de **demander une cl√© d'acc√®s S3** qui est form√©e par un `access key ID` (par exemple, `a37d96544d82ba90057e0e06131d0a7b`) et une `secret access key` (par exemple, `58420818223133077c2cec6712a4f909aec93b4daeedae205aa8e30d5a860628`)

## Fonctions Edge

Il est possible de **stocker des secrets** dans supabase √©galement, qui seront **accessibles par des fonctions edge** (elles peuvent √™tre cr√©√©es et supprim√©es depuis le web, mais il n'est pas possible d'acc√©der directement √† leur valeur).

{% hint style="success" %}
Apprenez et pratiquez le Hacking AWS :<img src="../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../.gitbook/assets/image (1).png" alt="" data-size="line">\
Apprenez et pratiquez le Hacking GCP : <img src="../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Consultez les [**plans d'abonnement**](https://github.com/sponsors/carlospolop)!
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez-nous** sur **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Partagez des astuces de hacking en soumettant des PR aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) d√©p√¥ts github.

</details>
{% endhint %}
