# Supabase Security

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../.gitbook/assets/image (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../.gitbook/assets/image (1) (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Basic Information

De acordo com sua [**p√°gina de destino**](https://supabase.com/): Supabase √© uma alternativa de c√≥digo aberto ao Firebase. Comece seu projeto com um banco de dados Postgres, Autentica√ß√£o, APIs instant√¢neas, Fun√ß√µes Edge, assinaturas em tempo real, Armazenamento e embeddings vetoriais.

### Subdom√≠nio

Basicamente, quando um projeto √© criado, o usu√°rio receber√° um subdom√≠nio supabase.co como: **`jnanozjdybtpqgcwhdiz.supabase.co`**

## **Configura√ß√£o do banco de dados**

{% hint style="success" %}
**Esses dados podem ser acessados a partir de um link como `https://supabase.com/dashboard/project/<project-id>/settings/database`**
{% endhint %}

Este **banco de dados** ser√° implantado em alguma regi√£o da AWS, e para se conectar a ele, seria poss√≠vel fazer isso conectando-se a: `postgres://postgres.jnanozjdybtpqgcwhdiz:[YOUR-PASSWORD]@aws-0-us-west-1.pooler.supabase.com:5432/postgres` (isso foi criado em us-west-1).\
A senha √© uma **senha que o usu√°rio colocou** anteriormente.

Portanto, como o subdom√≠nio √© conhecido e √© usado como nome de usu√°rio e as regi√µes da AWS s√£o limitadas, pode ser poss√≠vel tentar **for√ßar a senha**.

Esta se√ß√£o tamb√©m cont√©m op√ß√µes para:

* Redefinir a senha do banco de dados
* Configurar o pool de conex√µes
* Configurar SSL: Rejeitar conex√µes em texto simples (por padr√£o, elas est√£o habilitadas)
* Configurar o tamanho do disco
* Aplicar restri√ß√µes e proibi√ß√µes de rede

## Configura√ß√£o da API

{% hint style="success" %}
**Esses dados podem ser acessados a partir de um link como `https://supabase.com/dashboard/project/<project-id>/settings/api`**
{% endhint %}

A URL para acessar a API supabase em seu projeto ser√° como: `https://jnanozjdybtpqgcwhdiz.supabase.co`.

### chaves da API anon

Ele tamb√©m gerar√° uma **chave da API anon** (`role: "anon"`), como: `eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpuYW5vemRyb2J0cHFnY3doZGl6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3MTQ5OTI3MTksImV4cCI6MjAzMDU2ODcxOX0.sRN0iMGM5J741pXav7UxeChyqBE9_Z-T0tLA9Zehvqk` que a aplica√ß√£o precisar√° usar para contatar a chave da API exposta em nosso exemplo em

√â poss√≠vel encontrar a API REST para contatar esta API na [**docs**](https://supabase.com/docs/reference/self-hosting-auth/returns-the-configuration-settings-for-the-gotrue-server), mas os endpoints mais interessantes seriam:

<details>

<summary>Signup (/auth/v1/signup)</summary>
```
POST /auth/v1/signup HTTP/2
Host: id.io.net
Content-Length: 90
X-Client-Info: supabase-js-web/2.39.2
Sec-Ch-Ua: "Not-A.Brand";v="99", "Chromium";v="124"
Sec-Ch-Ua-Mobile: ?0
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpuYW5vemRyb2J0cHFnY3doZGl6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3MTQ5OTI3MTksImV4cCI6MjAzMDU2ODcxOX0.sRN0iMGM5J741pXav7UxeChyqBE9_Z-T0tLA9Zehvqk
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/124.0.6367.60 Safari/537.36
Content-Type: application/json;charset=UTF-8
Apikey: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpuYW5vemRyb2J0cHFnY3doZGl6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3MTQ5OTI3MTksImV4cCI6MjAzMDU2ODcxOX0.sRN0iMGM5J741pXav7UxeChyqBE9_Z-T0tLA9Zehvqk
Sec-Ch-Ua-Platform: "macOS"
Accept: */*
Origin: https://cloud.io.net
Sec-Fetch-Site: same-site
Sec-Fetch-Mode: cors
Sec-Fetch-Dest: empty
Referer: https://cloud.io.net/
Accept-Encoding: gzip, deflate, br
Accept-Language: en-GB,en-US;q=0.9,en;q=0.8
Priority: u=1, i

{"email":"test@exmaple.com","password":"SomeCOmplexPwd239."}
```
</details>

<details>

<summary>Login (/auth/v1/token?grant_type=password)</summary>
```
POST /auth/v1/token?grant_type=password HTTP/2
Host: hypzbtgspjkludjcnjxl.supabase.co
Content-Length: 80
X-Client-Info: supabase-js-web/2.39.2
Sec-Ch-Ua: "Not-A.Brand";v="99", "Chromium";v="124"
Sec-Ch-Ua-Mobile: ?0
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpuYW5vemRyb2J0cHFnY3doZGl6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3MTQ5OTI3MTksImV4cCI6MjAzMDU2ODcxOX0.sRN0iMGM5J741pXav7UxeChyqBE9_Z-T0tLA9Zehvqk
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/124.0.6367.60 Safari/537.36
Content-Type: application/json;charset=UTF-8
Apikey: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpuYW5vemRyb2J0cHFnY3doZGl6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3MTQ5OTI3MTksImV4cCI6MjAzMDU2ODcxOX0.sRN0iMGM5J741pXav7UxeChyqBE9_Z-T0tLA9Zehvqk
Sec-Ch-Ua-Platform: "macOS"
Accept: */*
Origin: https://cloud.io.net
Sec-Fetch-Site: same-site
Sec-Fetch-Mode: cors
Sec-Fetch-Dest: empty
Referer: https://cloud.io.net/
Accept-Encoding: gzip, deflate, br
Accept-Language: en-GB,en-US;q=0.9,en;q=0.8
Priority: u=1, i

{"email":"test@exmaple.com","password":"SomeCOmplexPwd239."}
```
</details>

Ent√£o, sempre que voc√™ descobrir um cliente usando supabase com o subdom√≠nio que lhe foi concedido (√© poss√≠vel que um subdom√≠nio da empresa tenha um CNAME sobre seu subdom√≠nio supabase), voc√™ pode tentar **criar uma nova conta na plataforma usando a API supabase**.

### chaves de api secret / service\_role

Uma chave de API secreta tamb√©m ser√° gerada com **`role: "service_role"`**. Esta chave de API deve ser secreta porque ser√° capaz de contornar **Row Level Security**.

A chave de API se parece com isso: `eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpuYW5vemRyb2J0cHFnY3doZGl6Iiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTcxNDk5MjcxOSwiZXhwIjoyMDMwNTY4NzE5fQ.0a8fHGp3N_GiPq0y0dwfs06ywd-zhTwsm486Tha7354`

### JWT Secret

Um **JWT Secret** tamb√©m ser√° gerado para que a aplica√ß√£o possa **criar e assinar tokens JWT personalizados**.

## Autentica√ß√£o

### Inscri√ß√µes

{% hint style="success" %}
Por **padr√£o**, o supabase permitir√° que **novos usu√°rios criem contas** em seu projeto usando os endpoints de API mencionados anteriormente.
{% endhint %}

No entanto, essas novas contas, por padr√£o, **precisar√£o validar seu endere√ßo de e-mail** para poder fazer login na conta. √â poss√≠vel habilitar **"Permitir logins an√¥nimos"** para permitir que as pessoas fa√ßam login sem verificar seu endere√ßo de e-mail. Isso pode conceder acesso a **dados inesperados** (eles recebem os pap√©is `public` e `authenticated`).\
Isso √© uma ideia muito ruim porque o supabase cobra por usu√°rio ativo, ent√£o as pessoas poderiam criar usu√°rios e fazer login e o supabase cobraria por isso:

<figure><img src="../.gitbook/assets/image (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

### Senhas e sess√µes

√â poss√≠vel indicar o comprimento m√≠nimo da senha (por padr√£o), requisitos (nenhum por padr√£o) e proibir o uso de senhas vazadas.\
√â recomendado **melhorar os requisitos, pois os padr√µes s√£o fracos**.

* Sess√µes de Usu√°rio: √â poss√≠vel configurar como as sess√µes de usu√°rio funcionam (timeouts, 1 sess√£o por usu√°rio...)
* Prote√ß√£o contra Bots e Abusos: √â poss√≠vel habilitar Captcha.

### Configura√ß√µes SMTP

√â poss√≠vel definir um SMTP para enviar e-mails.

### Configura√ß√µes Avan√ßadas

* Definir tempo de expira√ß√£o para tokens de acesso (3600 por padr√£o)
* Definir para detectar e revogar tokens de atualiza√ß√£o potencialmente comprometidos e timeout
* MFA: Indicar quantos fatores MFA podem ser registrados de uma vez por usu√°rio (10 por padr√£o)
* M√°ximo de Conex√µes Diretas ao Banco de Dados: N√∫mero m√°ximo de conex√µes usadas para autentica√ß√£o (10 por padr√£o)
* Dura√ß√£o M√°xima da Solicita√ß√£o: Tempo m√°ximo permitido para uma solicita√ß√£o de autentica√ß√£o durar (10s por padr√£o)

## Armazenamento

{% hint style="success" %}
O Supabase permite **armazenar arquivos** e torn√°-los acess√≠veis por meio de uma URL (usa buckets S3).
{% endhint %}

* Definir o limite de tamanho do arquivo de upload (o padr√£o √© 50MB)
* A conex√£o S3 √© dada com uma URL como: `https://jnanozjdybtpqgcwhdiz.supabase.co/storage/v1/s3`
* √â poss√≠vel **solicitar uma chave de acesso S3** que √© formada por um `access key ID` (por exemplo, `a37d96544d82ba90057e0e06131d0a7b`) e uma `secret access key` (por exemplo, `58420818223133077c2cec6712a4f909aec93b4daeedae205aa8e30d5a860628`)

## Fun√ß√µes Edge

√â poss√≠vel **armazenar segredos** no supabase tamb√©m, que ser√£o **acess√≠veis por fun√ß√µes edge** (podem ser criadas e exclu√≠das pela web, mas n√£o √© poss√≠vel acessar seu valor diretamente).

{% hint style="success" %}
Aprenda e pratique Hacking AWS:<img src="../.gitbook/assets/image (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../.gitbook/assets/image (1) (1).png" alt="" data-size="line">\
Aprenda e pratique Hacking GCP: <img src="../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Confira os [**planos de assinatura**](https://github.com/sponsors/carlospolop)!
* **Junte-se ao** üí¨ [**grupo do Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga**-nos no **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe truques de hacking enviando PRs para o** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) reposit√≥rios do github.

</details>
{% endhint %}
