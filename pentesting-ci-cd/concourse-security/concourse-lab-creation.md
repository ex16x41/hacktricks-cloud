# Concourse Lab Creation

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ЁЯТм [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ЁЯРж [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Testing Environment

### Running Concourse

#### With Docker-Compose

рдпрд╣ docker-compose рдлрд╝рд╛рдЗрд▓ concourse рдХреЗ рд╕рд╛рде рдХреБрдЫ рдкрд░реАрдХреНрд╖рдг рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╕реНрдерд╛рдкрдирд╛ рдХреЛ рд╕рд░рд▓ рдмрдирд╛рддреА рд╣реИ:
```bash
wget https://raw.githubusercontent.com/starkandwayne/concourse-tutorial/master/docker-compose.yml
docker-compose up -d
```
рдЖрдк рдЕрдкрдиреЗ OS рдХреЗ рд▓рд┐рдП рдХрдорд╛рдВрдб рд▓рд╛рдЗрди `fly` рдХреЛ рд╡реЗрдм рд╕реЗ `127.0.0.1:8080` рдкрд░ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

#### Kubernetes рдХреЗ рд╕рд╛рде (рдЕрдиреБрд╢рдВрд╕рд┐рдд)

рдЖрдк рдЖрд╕рд╛рдиреА рд╕реЗ **Kubernetes** рдореЗрдВ **minikube** (рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ concourse рдХреЛ рддреИрдирд╛рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдЬрд┐рд╕рдореЗрдВ helm-chart рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ: [**concourse-chart**](https://github.com/concourse/concourse-chart).
```bash
brew install helm
helm repo add concourse https://concourse-charts.storage.googleapis.com/
helm install concourse-release concourse/concourse
# concourse-release will be the prefix name for the concourse elements in k8s
# After the installation you will find the indications to connect to it in the console

# If you need to delete it
helm delete concourse-release
```
рдХреЙрдирдХреЛрд░реНрд╕ рд╡рд╛рддрд╛рд╡рд░рдг рдмрдирд╛рдиреЗ рдХреЗ рдмрд╛рдж, рдЖрдк рдПрдХ рдЧреБрдкреНрдд рдХреБрдВрдЬреА рдЙрддреНрдкрдиреНрди рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдХреЙрдирдХреЛрд░реНрд╕ рд╡реЗрдм рдореЗрдВ рдЪрд▓ рд░рд╣реЗ SA рдХреЛ K8s рдЧреБрдкреНрдд рдХреБрдВрдЬрд┐рдпреЛрдВ рддрдХ рдкрд╣реБрдБрдЪ рдкреНрд░рджрд╛рди рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```yaml
echo 'apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
name: read-secrets
rules:
- apiGroups: [""]
resources: ["secrets"]
verbs: ["get"]

---

apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
name: read-secrets-concourse
roleRef:
apiGroup: rbac.authorization.k8s.io
kind: ClusterRole
name: read-secrets
subjects:
- kind: ServiceAccount
name: concourse-release-web
namespace: default

---

apiVersion: v1
kind: Secret
metadata:
name: super
namespace: concourse-release-main
type: Opaque
data:
secret: MWYyZDFlMmU2N2Rm

' | kubectl apply -f -
```
### рдкрд╛рдЗрдкрд▓рд╛рдЗрди рдмрдирд╛рдПрдВ

рдПрдХ рдкрд╛рдЗрдкрд▓рд╛рдЗрди [Jobs](https://concourse-ci.org/jobs.html) рдХреА рдПрдХ рд╕реВрдЪреА рд╕реЗ рдмрдиреА рд╣реЛрддреА рд╣реИ рдЬрд┐рд╕рдореЗрдВ [Steps](https://concourse-ci.org/steps.html) рдХреА рдПрдХ рдХреНрд░рдордмрджреНрдз рд╕реВрдЪреА рд╣реЛрддреА рд╣реИред

### Steps

рдХрдИ рд╡рд┐рднрд┐рдиреНрди рдкреНрд░рдХрд╛рд░ рдХреЗ рд╕реНрдЯреЗрдкреНрд╕ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ:

* **the** [**`task` step**](https://concourse-ci.org/task-step.html) **рдПрдХ** [**task**](https://concourse-ci.org/tasks.html) **рдЪрд▓рд╛рддрд╛ рд╣реИ**
* [`get` step](https://concourse-ci.org/get-step.html) рдПрдХ [resource](https://concourse-ci.org/resources.html) рд▓рд╛рддрд╛ рд╣реИ
* [`put` step](https://concourse-ci.org/put-step.html) рдПрдХ [resource](https://concourse-ci.org/resources.html) рдХреЛ рдЕрдкрдбреЗрдЯ рдХрд░рддрд╛ рд╣реИ
* [`set_pipeline` step](https://concourse-ci.org/set-pipeline-step.html) рдПрдХ [pipeline](https://concourse-ci.org/pipelines.html) рдХреЛ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░рддрд╛ рд╣реИ
* [`load_var` step](https://concourse-ci.org/load-var-step.html) рдПрдХ рдорд╛рди рдХреЛ [local var](https://concourse-ci.org/vars.html#local-vars) рдореЗрдВ рд▓реЛрдб рдХрд░рддрд╛ рд╣реИ
* [`in_parallel` step](https://concourse-ci.org/in-parallel-step.html) рд╕реНрдЯреЗрдкреНрд╕ рдХреЛ рд╕рдорд╛рдирд╛рдВрддрд░ рдореЗрдВ рдЪрд▓рд╛рддрд╛ рд╣реИ
* [`do` step](https://concourse-ci.org/do-step.html) рд╕реНрдЯреЗрдкреНрд╕ рдХреЛ рдЕрдиреБрдХреНрд░рдо рдореЗрдВ рдЪрд▓рд╛рддрд╛ рд╣реИ
* [`across` step modifier](https://concourse-ci.org/across-step.html#schema.across) рдПрдХ рд╕реНрдЯреЗрдк рдХреЛ рдХрдИ рдмрд╛рд░ рдЪрд▓рд╛рддрд╛ рд╣реИ; рдкреНрд░рддреНрдпреЗрдХ рд╕рдВрдпреЛрдЬрди рдХреЗ рд▓рд┐рдП рдПрдХ рдмрд╛рд░ рд╡реИрд░рд┐рдПрдмрд▓ рдорд╛рдиреЛрдВ рдХрд╛
* [`try` step](https://concourse-ci.org/try-step.html) рдПрдХ рд╕реНрдЯреЗрдк рдХреЛ рдЪрд▓рд╛рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░рддрд╛ рд╣реИ рдФрд░ рд╕рдлрд▓ рд╣реЛрддрд╛ рд╣реИ рднрд▓реЗ рд╣реА рд╕реНрдЯреЗрдк рд╡рд┐рдлрд▓ рд╣реЛ рдЬрд╛рдП

рд╣рд░ [step](https://concourse-ci.org/steps.html) рдПрдХ [job plan](https://concourse-ci.org/jobs.html#schema.job.plan) рдореЗрдВ рдЕрдкрдиреЗ **рд╕реНрд╡рдпрдВ рдХреЗ рдХрдВрдЯреЗрдирд░** рдореЗрдВ рдЪрд▓рддрд╛ рд╣реИред рдЖрдк рдХрдВрдЯреЗрдирд░ рдХреЗ рдЕрдВрджрд░ рдХреБрдЫ рднреА рдЪрд▓рд╛рдиреЗ рдХреЗ рд▓рд┐рдП рд╕реНрд╡рддрдВрддреНрд░ рд╣реИрдВ _(рдпрд╛рдиреА, рдореЗрд░реЗ рдкрд░реАрдХреНрд╖рдг рдЪрд▓рд╛рдПрдВ, рдпрд╣ рдмреИрд╢ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдЪрд▓рд╛рдПрдВ, рдпрд╣ рдЫрд╡рд┐ рдмрдирд╛рдПрдВ, рдЖрджрд┐)_ред рдЗрд╕рд▓рд┐рдП рдпрджрд┐ рдЖрдкрдХреЗ рдкрд╛рд╕ рдкрд╛рдВрдЪ рд╕реНрдЯреЗрдкреНрд╕ рдХреЗ рд╕рд╛рде рдПрдХ рдЬреЙрдм рд╣реИ, рддреЛ Concourse рдкрд╛рдВрдЪ рдХрдВрдЯреЗрдирд░ рдмрдирд╛рдПрдЧрд╛, рдкреНрд░рддреНрдпреЗрдХ рд╕реНрдЯреЗрдк рдХреЗ рд▓рд┐рдП рдПрдХред

рдЗрд╕рд▓рд┐рдП, рдпрд╣ рд╕рдВрдХреЗрдд рджреЗрдирд╛ рд╕рдВрднрд╡ рд╣реИ рдХрд┐ рдкреНрд░рддреНрдпреЗрдХ рд╕реНрдЯреЗрдк рдХреЛ рдХрд┐рд╕ рдкреНрд░рдХрд╛рд░ рдХреЗ рдХрдВрдЯреЗрдирд░ рдореЗрдВ рдЪрд▓рд╛рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред

### рд╕рд░рд▓ рдкрд╛рдЗрдкрд▓рд╛рдЗрди рдЙрджрд╛рд╣рд░рдг
```yaml
jobs:
- name: simple
plan:
- task: simple-task
privileged: true
config:
# Tells Concourse which type of worker this task should run on
platform: linux
image_resource:
type: registry-image
source:
repository: busybox # images are pulled from docker hub by default
run:
path: sh
args:
- -cx
- |
sleep 1000
echo "$SUPER_SECRET"
params:
SUPER_SECRET: ((super.secret))
```

```bash
fly -t tutorial set-pipeline -p pipe-name -c hello-world.yml
# pipelines are paused when first created
fly -t tutorial unpause-pipeline -p pipe-name
# trigger the job and watch it run to completion
fly -t tutorial trigger-job --job pipe-name/simple --watch
# From another console
fly -t tutorial intercept --job pipe-name/simple
```
Check **127.0.0.1:8080** to see the pipeline flow.

### Bash script with output/input pipeline

рдпрд╣ рд╕рдВрднрд╡ рд╣реИ рдХрд┐ **рдПрдХ рдХрд╛рд░реНрдп рдХреЗ рдкрд░рд┐рдгрд╛рдореЛрдВ рдХреЛ рдПрдХ рдлрд╝рд╛рдЗрд▓ рдореЗрдВ рд╕рд╣реЗрдЬреЗрдВ** рдФрд░ рдпрд╣ рд╕рдВрдХреЗрдд рджреЗрдВ рдХрд┐ рдпрд╣ рдПрдХ рдЖрдЙрдЯрдкреБрдЯ рд╣реИ рдФрд░ рдлрд┐рд░ рдЕрдЧрд▓реЗ рдХрд╛рд░реНрдп рдХреЗ рдЗрдирдкреБрдЯ рдХреЛ рдкрд┐рдЫрд▓реЗ рдХрд╛рд░реНрдп рдХреЗ рдЖрдЙрдЯрдкреБрдЯ рдХреЗ рд░реВрдк рдореЗрдВ рд╕рдВрдХреЗрдд рджреЗрдВред рдЬреЛ concourse рдХрд░рддрд╛ рд╣реИ рд╡рд╣ рд╣реИ **рдкрд┐рдЫрд▓реЗ рдХрд╛рд░реНрдп рдХреЗ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдХреЛ рдирдП рдХрд╛рд░реНрдп рдореЗрдВ рдорд╛рдЙрдВрдЯ рдХрд░рдирд╛ рдЬрд╣рд╛рдБ рдЖрдк рдкрд┐рдЫрд▓реЗ рдХрд╛рд░реНрдп рджреНрд╡рд╛рд░рд╛ рдмрдирд╛рдП рдЧрдП рдлрд╝рд╛рдЗрд▓реЛрдВ рддрдХ рдкрд╣реБрдБрдЪ рд╕рдХрддреЗ рд╣реИрдВ**ред

### Triggers

рдЖрдкрдХреЛ рд╣рд░ рдмрд╛рд░ рдЙрдиреНрд╣реЗрдВ рдЪрд▓рд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдореИрдиреНрдпреБрдЕрд▓ рд░реВрдк рд╕реЗ рдиреМрдХрд░рд┐рдпреЛрдВ рдХреЛ рдЯреНрд░рд┐рдЧрд░ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реИ, рдЖрдк рдЙрдиреНрд╣реЗрдВ рд╣рд░ рдмрд╛рд░ рдЪрд▓рд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдкреНрд░реЛрдЧреНрд░рд╛рдо рднреА рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:

* рдХреБрдЫ рд╕рдордп рдмреАрддрддрд╛ рд╣реИ: [Time resource](https://github.com/concourse/time-resource/)
* рдореБрдЦреНрдп рд╢рд╛рдЦрд╛ рдореЗрдВ рдирдП рдХрдорд┐рдЯ рдкрд░: [Git resource](https://github.com/concourse/git-resource)
* рдирдП PR's: [Github-PR resource](https://github.com/telia-oss/github-pr-resource)
* рдЕрдкрдиреЗ рдРрдк рдХреА рдирд╡реАрдирддрдо рдЫрд╡рд┐ рд▓рд╛рдирд╛ рдпрд╛ рдкреБрд╢ рдХрд░рдирд╛: [Registry-image resource](https://github.com/concourse/registry-image-resource/)

рдПрдХ YAML рдкрд╛рдЗрдкрд▓рд╛рдЗрди рдЙрджрд╛рд╣рд░рдг рджреЗрдЦреЗрдВ рдЬреЛ рдорд╛рд╕реНрдЯрд░ рдореЗрдВ рдирдП рдХрдорд┐рдЯ рдкрд░ рдЯреНрд░рд┐рдЧрд░ рд╣реЛрддрд╛ рд╣реИ [https://concourse-ci.org/tutorial-resources.html](https://concourse-ci.org/tutorial-resources.html)

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ЁЯТм [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ЁЯРж [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
