# Concourse Lab Creation

{% hint style="success" %}
Lernen & √ºben Sie AWS Hacking:<img src="../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Lernen & √ºben Sie GCP Hacking: <img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* √úberpr√ºfen Sie die [**Abonnementpl√§ne**](https://github.com/sponsors/carlospolop)!
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teilen Sie Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repos senden.

</details>
{% endhint %}

## Testumgebung

### Concourse ausf√ºhren

#### Mit Docker-Compose

Diese Docker-Compose-Datei vereinfacht die Installation, um einige Tests mit Concourse durchzuf√ºhren:
```bash
wget https://raw.githubusercontent.com/starkandwayne/concourse-tutorial/master/docker-compose.yml
docker-compose up -d
```
Sie k√∂nnen die Befehlszeile `fly` f√ºr Ihr Betriebssystem von der Website unter `127.0.0.1:8080` herunterladen.

#### Mit Kubernetes (Empfohlen)

Sie k√∂nnen Concourse einfach in **Kubernetes** (zum Beispiel in **minikube**) mit dem Helm-Chart bereitstellen: [**concourse-chart**](https://github.com/concourse/concourse-chart).
```bash
brew install helm
helm repo add concourse https://concourse-charts.storage.googleapis.com/
helm install concourse-release concourse/concourse
# concourse-release will be the prefix name for the concourse elements in k8s
# After the installation you will find the indications to connect to it in the console

# If you need to delete it
helm delete concourse-release
```
Nachdem Sie die Concourse-Umgebung erstellt haben, k√∂nnen Sie ein Geheimnis generieren und dem SA, der in Concourse Web ausgef√ºhrt wird, Zugriff auf K8s-Geheimnisse gew√§hren:
```yaml
echo 'apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
name: read-secrets
rules:
- apiGroups: [""]
resources: ["secrets"]
verbs: ["get"]

---

apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
name: read-secrets-concourse
roleRef:
apiGroup: rbac.authorization.k8s.io
kind: ClusterRole
name: read-secrets
subjects:
- kind: ServiceAccount
name: concourse-release-web
namespace: default

---

apiVersion: v1
kind: Secret
metadata:
name: super
namespace: concourse-release-main
type: Opaque
data:
secret: MWYyZDFlMmU2N2Rm

' | kubectl apply -f -
```
### Pipeline erstellen

Eine Pipeline besteht aus einer Liste von [Jobs](https://concourse-ci.org/jobs.html), die eine geordnete Liste von [Steps](https://concourse-ci.org/steps.html) enth√§lt.

### Schritte

Es k√∂nnen mehrere verschiedene Arten von Schritten verwendet werden:

* **der** [**`task` Schritt**](https://concourse-ci.org/task-step.html) **f√ºhrt eine** [**Aufgabe**](https://concourse-ci.org/tasks.html) **aus**
* der [`get` Schritt](https://concourse-ci.org/get-step.html) ruft eine [Ressource](https://concourse-ci.org/resources.html) ab
* der [`put` Schritt](https://concourse-ci.org/put-step.html) aktualisiert eine [Ressource](https://concourse-ci.org/resources.html)
* der [`set_pipeline` Schritt](https://concourse-ci.org/set-pipeline-step.html) konfiguriert eine [Pipeline](https://concourse-ci.org/pipelines.html)
* der [`load_var` Schritt](https://concourse-ci.org/load-var-step.html) l√§dt einen Wert in eine [lokale Variable](https://concourse-ci.org/vars.html#local-vars)
* der [`in_parallel` Schritt](https://concourse-ci.org/in-parallel-step.html) f√ºhrt Schritte parallel aus
* der [`do` Schritt](https://concourse-ci.org/do-step.html) f√ºhrt Schritte sequenziell aus
* der [`across` Schrittmodifikator](https://concourse-ci.org/across-step.html#schema.across) f√ºhrt einen Schritt mehrfach aus; einmal f√ºr jede Kombination von Variablenwerten
* der [`try` Schritt](https://concourse-ci.org/try-step.html) versucht, einen Schritt auszuf√ºhren und hat Erfolg, selbst wenn der Schritt fehlschl√§gt

Jeder [Schritt](https://concourse-ci.org/steps.html) in einem [Job-Plan](https://concourse-ci.org/jobs.html#schema.job.plan) wird in seinem **eigenen Container** ausgef√ºhrt. Sie k√∂nnen alles, was Sie m√∂chten, im Container ausf√ºhren _(d.h. meine Tests ausf√ºhren, dieses Bash-Skript ausf√ºhren, dieses Image erstellen usw.)_. Wenn Sie also einen Job mit f√ºnf Schritten haben, erstellt Concourse f√ºnf Container, einen f√ºr jeden Schritt.

Daher ist es m√∂glich, den Typ des Containers anzugeben, in dem jeder Schritt ausgef√ºhrt werden muss.

### Einfaches Pipeline-Beispiel
```yaml
jobs:
- name: simple
plan:
- task: simple-task
privileged: true
config:
# Tells Concourse which type of worker this task should run on
platform: linux
image_resource:
type: registry-image
source:
repository: busybox # images are pulled from docker hub by default
run:
path: sh
args:
- -cx
- |
sleep 1000
echo "$SUPER_SECRET"
params:
SUPER_SECRET: ((super.secret))
```

```bash
fly -t tutorial set-pipeline -p pipe-name -c hello-world.yml
# pipelines are paused when first created
fly -t tutorial unpause-pipeline -p pipe-name
# trigger the job and watch it run to completion
fly -t tutorial trigger-job --job pipe-name/simple --watch
# From another console
fly -t tutorial intercept --job pipe-name/simple
```
√úberpr√ºfen Sie **127.0.0.1:8080**, um den Pipeline-Fluss zu sehen.

### Bash-Skript mit Ausgabe/Eingabe-Pipeline

Es ist m√∂glich, **die Ergebnisse einer Aufgabe in einer Datei zu speichern** und anzugeben, dass es sich um eine Ausgabe handelt, und dann die Eingabe der n√§chsten Aufgabe als die Ausgabe der vorherigen Aufgabe anzugeben. Was Concourse tut, ist, **das Verzeichnis der vorherigen Aufgabe in der neuen Aufgabe zu mounten, wo Sie auf die von der vorherigen Aufgabe erstellten Dateien zugreifen k√∂nnen**.

### Trigger

Sie m√ºssen die Jobs nicht jedes Mal manuell ausl√∂sen, wenn Sie sie ausf√ºhren m√∂chten, Sie k√∂nnen sie auch so programmieren, dass sie jedes Mal ausgef√ºhrt werden:

* Es vergeht etwas Zeit: [Time resource](https://github.com/concourse/time-resource/)
* Bei neuen Commits zum Hauptbranch: [Git resource](https://github.com/concourse/git-resource)
* Neue PRs: [Github-PR resource](https://github.com/telia-oss/github-pr-resource)
* Holen Sie sich oder pushen Sie das neueste Bild Ihrer App: [Registry-image resource](https://github.com/concourse/registry-image-resource/)

√úberpr√ºfen Sie ein YAML-Pipeline-Beispiel, das bei neuen Commits auf master in [https://concourse-ci.org/tutorial-resources.html](https://concourse-ci.org/tutorial-resources.html) ausgel√∂st wird.

{% hint style="success" %}
Lernen & √ºben Sie AWS Hacking:<img src="../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Lernen & √ºben Sie GCP Hacking: <img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Unterst√ºtzen Sie HackTricks</summary>

* √úberpr√ºfen Sie die [**Abonnementpl√§ne**](https://github.com/sponsors/carlospolop)!
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teilen Sie Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repos senden.

</details>
{% endhint %}
