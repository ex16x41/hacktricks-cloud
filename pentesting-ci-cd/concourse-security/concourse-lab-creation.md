# Concourse Lab Creation

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Testing Environment

### Running Concourse

#### With Docker-Compose

ì´ docker-compose íŒŒì¼ì€ concourseë¡œ ëª‡ ê°€ì§€ í…ŒìŠ¤íŠ¸ë¥¼ ìˆ˜í–‰í•˜ê¸° ìœ„í•œ ì„¤ì¹˜ë¥¼ ê°„ì†Œí™”í•©ë‹ˆë‹¤:
```bash
wget https://raw.githubusercontent.com/starkandwayne/concourse-tutorial/master/docker-compose.yml
docker-compose up -d
```
`127.0.0.1:8080`ì—ì„œ ê·€í•˜ì˜ OSì— ë§ëŠ” ëª…ë ¹ì¤„ `fly`ë¥¼ ë‹¤ìš´ë¡œë“œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

#### Kubernetesë¥¼ ì‚¬ìš©í•˜ì—¬ (ê¶Œì¥)

í—¬ë¦„ ì°¨íŠ¸ë¥¼ ì‚¬ìš©í•˜ì—¬ **Kubernetes**(ì˜ˆ: **minikube**)ì— concourseë¥¼ ì‰½ê²Œ ë°°í¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤: [**concourse-chart**](https://github.com/concourse/concourse-chart).
```bash
brew install helm
helm repo add concourse https://concourse-charts.storage.googleapis.com/
helm install concourse-release concourse/concourse
# concourse-release will be the prefix name for the concourse elements in k8s
# After the installation you will find the indications to connect to it in the console

# If you need to delete it
helm delete concourse-release
```
concourse í™˜ê²½ì„ ìƒì„±í•œ í›„, ë¹„ë°€ì„ ìƒì„±í•˜ê³  concourse ì›¹ì—ì„œ ì‹¤í–‰ ì¤‘ì¸ SAì— K8s ë¹„ë°€ì— ì ‘ê·¼í•  ìˆ˜ ìˆëŠ” ê¶Œí•œì„ ë¶€ì—¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```yaml
echo 'apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
name: read-secrets
rules:
- apiGroups: [""]
resources: ["secrets"]
verbs: ["get"]

---

apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
name: read-secrets-concourse
roleRef:
apiGroup: rbac.authorization.k8s.io
kind: ClusterRole
name: read-secrets
subjects:
- kind: ServiceAccount
name: concourse-release-web
namespace: default

---

apiVersion: v1
kind: Secret
metadata:
name: super
namespace: concourse-release-main
type: Opaque
data:
secret: MWYyZDFlMmU2N2Rm

' | kubectl apply -f -
```
### íŒŒì´í”„ë¼ì¸ ìƒì„±

íŒŒì´í”„ë¼ì¸ì€ [ì‘ì—…](https://concourse-ci.org/jobs.html)ì˜ ëª©ë¡ìœ¼ë¡œ êµ¬ì„±ë˜ë©°, ì—¬ê¸°ì—ëŠ” [ë‹¨ê³„](https://concourse-ci.org/steps.html)ì˜ ì •ë ¬ëœ ëª©ë¡ì´ í¬í•¨ë©ë‹ˆë‹¤.

### ë‹¨ê³„

ì—¬ëŸ¬ ê°€ì§€ ìœ í˜•ì˜ ë‹¨ê³„ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

* **the** [**`task` ë‹¨ê³„**](https://concourse-ci.org/task-step.html) **ëŠ”** [**ì‘ì—…**](https://concourse-ci.org/tasks.html)ì„ ì‹¤í–‰í•©ë‹ˆë‹¤.
* [`get` ë‹¨ê³„](https://concourse-ci.org/get-step.html)ëŠ” [ë¦¬ì†ŒìŠ¤](https://concourse-ci.org/resources.html)ë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤.
* [`put` ë‹¨ê³„](https://concourse-ci.org/put-step.html)ëŠ” [ë¦¬ì†ŒìŠ¤](https://concourse-ci.org/resources.html)ë¥¼ ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤.
* [`set_pipeline` ë‹¨ê³„](https://concourse-ci.org/set-pipeline-step.html)ëŠ” [íŒŒì´í”„ë¼ì¸](https://concourse-ci.org/pipelines.html)ì„ êµ¬ì„±í•©ë‹ˆë‹¤.
* [`load_var` ë‹¨ê³„](https://concourse-ci.org/load-var-step.html)ëŠ” ê°’ì„ [ë¡œì»¬ ë³€ìˆ˜](https://concourse-ci.org/vars.html#local-vars)ì— ë¡œë“œí•©ë‹ˆë‹¤.
* [`in_parallel` ë‹¨ê³„](https://concourse-ci.org/in-parallel-step.html)ëŠ” ë‹¨ê³„ë¥¼ ë³‘ë ¬ë¡œ ì‹¤í–‰í•©ë‹ˆë‹¤.
* [`do` ë‹¨ê³„](https://concourse-ci.org/do-step.html)ëŠ” ë‹¨ê³„ë¥¼ ìˆœì°¨ì ìœ¼ë¡œ ì‹¤í–‰í•©ë‹ˆë‹¤.
* [`across` ë‹¨ê³„ ìˆ˜ì •ì](https://concourse-ci.org/across-step.html#schema.across)ëŠ” ë‹¨ê³„ë¥¼ ì—¬ëŸ¬ ë²ˆ ì‹¤í–‰í•©ë‹ˆë‹¤; ë³€ìˆ˜ ê°’ì˜ ì¡°í•©ë§ˆë‹¤ í•œ ë²ˆì”© ì‹¤í–‰í•©ë‹ˆë‹¤.
* [`try` ë‹¨ê³„](https://concourse-ci.org/try-step.html)ëŠ” ë‹¨ê³„ë¥¼ ì‹¤í–‰í•˜ë ¤ê³  ì‹œë„í•˜ë©°, ë‹¨ê³„ê°€ ì‹¤íŒ¨í•˜ë”ë¼ë„ ì„±ê³µí•©ë‹ˆë‹¤.

ê° [ë‹¨ê³„](https://concourse-ci.org/steps.html)ëŠ” [ì‘ì—… ê³„íš](https://concourse-ci.org/jobs.html#schema.job.plan)ì—ì„œ **ìì‹ ì˜ ì»¨í…Œì´ë„ˆ**ì—ì„œ ì‹¤í–‰ë©ë‹ˆë‹¤. ì»¨í…Œì´ë„ˆ ë‚´ì—ì„œ ì›í•˜ëŠ” ëª¨ë“  ê²ƒì„ ì‹¤í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤ _(ì˜ˆ: ë‚´ í…ŒìŠ¤íŠ¸ ì‹¤í–‰, ì´ bash ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰, ì´ ì´ë¯¸ì§€ ë¹Œë“œ ë“±)_. ë”°ë¼ì„œ ë‹¤ì„¯ ê°œì˜ ë‹¨ê³„ê°€ ìˆëŠ” ì‘ì—…ì´ ìˆë‹¤ë©´ ConcourseëŠ” ê° ë‹¨ê³„ë§ˆë‹¤ í•˜ë‚˜ì”© ë‹¤ì„¯ ê°œì˜ ì»¨í…Œì´ë„ˆë¥¼ ìƒì„±í•©ë‹ˆë‹¤.

ë”°ë¼ì„œ ê° ë‹¨ê³„ê°€ ì‹¤í–‰ë˜ëŠ” ì»¨í…Œì´ë„ˆì˜ ìœ í˜•ì„ ì§€ì •í•˜ëŠ” ê²ƒì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.

### ê°„ë‹¨í•œ íŒŒì´í”„ë¼ì¸ ì˜ˆì œ
```yaml
jobs:
- name: simple
plan:
- task: simple-task
privileged: true
config:
# Tells Concourse which type of worker this task should run on
platform: linux
image_resource:
type: registry-image
source:
repository: busybox # images are pulled from docker hub by default
run:
path: sh
args:
- -cx
- |
sleep 1000
echo "$SUPER_SECRET"
params:
SUPER_SECRET: ((super.secret))
```

```bash
fly -t tutorial set-pipeline -p pipe-name -c hello-world.yml
# pipelines are paused when first created
fly -t tutorial unpause-pipeline -p pipe-name
# trigger the job and watch it run to completion
fly -t tutorial trigger-job --job pipe-name/simple --watch
# From another console
fly -t tutorial intercept --job pipe-name/simple
```
**127.0.0.1:8080**ì— ì ‘ì†í•˜ì—¬ íŒŒì´í”„ë¼ì¸ íë¦„ì„ í™•ì¸í•˜ì„¸ìš”.

### ì¶œë ¥/ì…ë ¥ íŒŒì´í”„ë¼ì¸ì´ ìˆëŠ” Bash ìŠ¤í¬ë¦½íŠ¸

**í•˜ë‚˜ì˜ ì‘ì—… ê²°ê³¼ë¥¼ íŒŒì¼ì— ì €ì¥**í•˜ê³  ì´ë¥¼ ì¶œë ¥ìœ¼ë¡œ í‘œì‹œí•œ ë‹¤ìŒ, ë‹¤ìŒ ì‘ì—…ì˜ ì…ë ¥ì„ ì´ì „ ì‘ì—…ì˜ ì¶œë ¥ìœ¼ë¡œ í‘œì‹œí•˜ëŠ” ê²ƒì´ ê°€ëŠ¥í•©ë‹ˆë‹¤. concourseê°€ í•˜ëŠ” ì¼ì€ **ì´ì „ ì‘ì—…ì˜ ë””ë ‰í† ë¦¬ë¥¼ ìƒˆë¡œìš´ ì‘ì—…ì— ë§ˆìš´íŠ¸í•˜ì—¬ ì´ì „ ì‘ì—…ì—ì„œ ìƒì„±ëœ íŒŒì¼ì— ì ‘ê·¼í•  ìˆ˜ ìˆë„ë¡ í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤.**

### íŠ¸ë¦¬ê±°

ì‘ì—…ì„ ì‹¤í–‰í•  ë•Œë§ˆë‹¤ ìˆ˜ë™ìœ¼ë¡œ íŠ¸ë¦¬ê±°í•  í•„ìš”ê°€ ì—†ìœ¼ë©°, ë‹¤ìŒê³¼ ê°™ì´ ë§¤ë²ˆ ì‹¤í–‰ë˜ë„ë¡ í”„ë¡œê·¸ë˜ë°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

* ì‹œê°„ì´ ê²½ê³¼í•¨: [Time resource](https://github.com/concourse/time-resource/)
* ë©”ì¸ ë¸Œëœì¹˜ì— ìƒˆë¡œìš´ ì»¤ë°‹ì´ ìˆì„ ë•Œ: [Git resource](https://github.com/concourse/git-resource)
* ìƒˆë¡œìš´ PR: [Github-PR resource](https://github.com/telia-oss/github-pr-resource)
* ì•±ì˜ ìµœì‹  ì´ë¯¸ì§€ë¥¼ ê°€ì ¸ì˜¤ê±°ë‚˜ í‘¸ì‹œ: [Registry-image resource](https://github.com/concourse/registry-image-resource/)

[https://concourse-ci.org/tutorial-resources.html](https://concourse-ci.org/tutorial-resources.html)ì—ì„œ ë§ˆìŠ¤í„°ì— ìƒˆë¡œìš´ ì»¤ë°‹ì´ ìˆì„ ë•Œ íŠ¸ë¦¬ê±°ë˜ëŠ” YAML íŒŒì´í”„ë¼ì¸ ì˜ˆì œë¥¼ í™•ì¸í•˜ì„¸ìš”.

{% hint style="success" %}
AWS í•´í‚¹ ë°°ìš°ê¸° ë° ì—°ìŠµí•˜ê¸°:<img src="../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
GCP í•´í‚¹ ë°°ìš°ê¸° ë° ì—°ìŠµí•˜ê¸°: <img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks ì§€ì›í•˜ê¸°</summary>

* [**êµ¬ë… ê³„íš**](https://github.com/sponsors/carlospolop) í™•ì¸í•˜ê¸°!
* **ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— ì°¸ì—¬í•˜ê±°ë‚˜ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**ë¥¼ íŒ”ë¡œìš°í•˜ì„¸ìš”.**
* **[**HackTricks**](https://github.com/carlospolop/hacktricks) ë° [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ë¦¬í¬ì§€í† ë¦¬ì— PRì„ ì œì¶œí•˜ì—¬ í•´í‚¹ íŒì„ ê³µìœ í•˜ì„¸ìš”.**

</details>
{% endhint %}
