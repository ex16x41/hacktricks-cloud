# Concourse Lab Creation

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## ãƒ†ã‚¹ãƒˆç’°å¢ƒ

### Concourseã®å®Ÿè¡Œ

#### Docker-Composeã‚’ä½¿ç”¨ã—ã¦

ã“ã®docker-composeãƒ•ã‚¡ã‚¤ãƒ«ã¯ã€concourseã§ã„ãã¤ã‹ã®ãƒ†ã‚¹ãƒˆã‚’è¡Œã†ãŸã‚ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã‚’ç°¡ç´ åŒ–ã—ã¾ã™ï¼š
```bash
wget https://raw.githubusercontent.com/starkandwayne/concourse-tutorial/master/docker-compose.yml
docker-compose up -d
```
ã‚ãªãŸã®OSç”¨ã®ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³`fly`ã¯ã€ã‚¦ã‚§ãƒ–ã‹ã‚‰`127.0.0.1:8080`ã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã§ãã¾ã™ã€‚

#### Kubernetesã‚’ä½¿ç”¨ã—ã¦ï¼ˆæ¨å¥¨ï¼‰

**Kubernetes**ï¼ˆä¾‹ãˆã°**minikube**ï¼‰ã«ç°¡å˜ã«concourseã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹ã«ã¯ã€helm-chartã‚’ä½¿ç”¨ã—ã¾ã™: [**concourse-chart**](https://github.com/concourse/concourse-chart)ã€‚
```bash
brew install helm
helm repo add concourse https://concourse-charts.storage.googleapis.com/
helm install concourse-release concourse/concourse
# concourse-release will be the prefix name for the concourse elements in k8s
# After the installation you will find the indications to connect to it in the console

# If you need to delete it
helm delete concourse-release
```
concourse envã‚’ç”Ÿæˆã—ãŸå¾Œã€ç§˜å¯†ã‚’ç”Ÿæˆã—ã€concourse webã§å®Ÿè¡Œã•ã‚Œã¦ã„ã‚‹SAã«K8sã®ç§˜å¯†ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹æ¨©é™ã‚’ä¸ãˆã‚‹ã“ã¨ãŒã§ãã¾ã™:
```yaml
echo 'apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
name: read-secrets
rules:
- apiGroups: [""]
resources: ["secrets"]
verbs: ["get"]

---

apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
name: read-secrets-concourse
roleRef:
apiGroup: rbac.authorization.k8s.io
kind: ClusterRole
name: read-secrets
subjects:
- kind: ServiceAccount
name: concourse-release-web
namespace: default

---

apiVersion: v1
kind: Secret
metadata:
name: super
namespace: concourse-release-main
type: Opaque
data:
secret: MWYyZDFlMmU2N2Rm

' | kubectl apply -f -
```
### ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã®ä½œæˆ

ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã¯ã€[ã‚¸ãƒ§ãƒ–](https://concourse-ci.org/jobs.html)ã®ãƒªã‚¹ãƒˆã§æ§‹æˆã•ã‚Œã¦ãŠã‚Šã€é †åºä»˜ãã®[ã‚¹ãƒ†ãƒƒãƒ—](https://concourse-ci.org/steps.html)ã®ãƒªã‚¹ãƒˆã‚’å«ã¿ã¾ã™ã€‚

### ã‚¹ãƒ†ãƒƒãƒ—

ã„ãã¤ã‹ã®ç•°ãªã‚‹ã‚¿ã‚¤ãƒ—ã®ã‚¹ãƒ†ãƒƒãƒ—ã‚’ä½¿ç”¨ã§ãã¾ã™ï¼š

* **the** [**`task` ã‚¹ãƒ†ãƒƒãƒ—**](https://concourse-ci.org/task-step.html) **ã¯** [**ã‚¿ã‚¹ã‚¯**](https://concourse-ci.org/tasks.html) **ã‚’å®Ÿè¡Œã—ã¾ã™**
* [`get` ã‚¹ãƒ†ãƒƒãƒ—](https://concourse-ci.org/get-step.html) ã¯ [ãƒªã‚½ãƒ¼ã‚¹](https://concourse-ci.org/resources.html) ã‚’å–å¾—ã—ã¾ã™
* [`put` ã‚¹ãƒ†ãƒƒãƒ—](https://concourse-ci.org/put-step.html) ã¯ [ãƒªã‚½ãƒ¼ã‚¹](https://concourse-ci.org/resources.html) ã‚’æ›´æ–°ã—ã¾ã™
* [`set_pipeline` ã‚¹ãƒ†ãƒƒãƒ—](https://concourse-ci.org/set-pipeline-step.html) ã¯ [ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³](https://concourse-ci.org/pipelines.html) ã‚’æ§‹æˆã—ã¾ã™
* [`load_var` ã‚¹ãƒ†ãƒƒãƒ—](https://concourse-ci.org/load-var-step.html) ã¯å€¤ã‚’ [ãƒ­ãƒ¼ã‚«ãƒ«å¤‰æ•°](https://concourse-ci.org/vars.html#local-vars) ã«ãƒ­ãƒ¼ãƒ‰ã—ã¾ã™
* [`in_parallel` ã‚¹ãƒ†ãƒƒãƒ—](https://concourse-ci.org/in-parallel-step.html) ã¯ã‚¹ãƒ†ãƒƒãƒ—ã‚’ä¸¦è¡Œã—ã¦å®Ÿè¡Œã—ã¾ã™
* [`do` ã‚¹ãƒ†ãƒƒãƒ—](https://concourse-ci.org/do-step.html) ã¯ã‚¹ãƒ†ãƒƒãƒ—ã‚’é †ç•ªã«å®Ÿè¡Œã—ã¾ã™
* [`across` ã‚¹ãƒ†ãƒƒãƒ—ä¿®é£¾å­](https://concourse-ci.org/across-step.html#schema.across) ã¯ã‚¹ãƒ†ãƒƒãƒ—ã‚’è¤‡æ•°å›å®Ÿè¡Œã—ã¾ã™ï¼›å¤‰æ•°ã®å€¤ã®çµ„ã¿åˆã‚ã›ã”ã¨ã«1å›
* [`try` ã‚¹ãƒ†ãƒƒãƒ—](https://concourse-ci.org/try-step.html) ã¯ã‚¹ãƒ†ãƒƒãƒ—ã‚’å®Ÿè¡Œã—ã‚ˆã†ã¨ã—ã€ã‚¹ãƒ†ãƒƒãƒ—ãŒå¤±æ•—ã—ã¦ã‚‚æˆåŠŸã—ã¾ã™

[ã‚¸ãƒ§ãƒ–ãƒ—ãƒ©ãƒ³](https://concourse-ci.org/jobs.html#schema.job.plan)å†…ã®å„[ã‚¹ãƒ†ãƒƒãƒ—](https://concourse-ci.org/steps.html)ã¯ã€**ç‹¬è‡ªã®ã‚³ãƒ³ãƒ†ãƒŠ**å†…ã§å®Ÿè¡Œã•ã‚Œã¾ã™ã€‚ã‚³ãƒ³ãƒ†ãƒŠå†…ã§ä½•ã§ã‚‚å®Ÿè¡Œã§ãã¾ã™ _(ã¤ã¾ã‚Šã€ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã™ã‚‹ã€bashã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å®Ÿè¡Œã™ã‚‹ã€ã“ã®ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ãƒ“ãƒ«ãƒ‰ã™ã‚‹ãªã©)ã€‚_ ã—ãŸãŒã£ã¦ã€5ã¤ã®ã‚¹ãƒ†ãƒƒãƒ—ã‚’æŒã¤ã‚¸ãƒ§ãƒ–ãŒã‚ã‚‹å ´åˆã€Concourseã¯å„ã‚¹ãƒ†ãƒƒãƒ—ã®ãŸã‚ã«5ã¤ã®ã‚³ãƒ³ãƒ†ãƒŠã‚’ä½œæˆã—ã¾ã™ã€‚

ã—ãŸãŒã£ã¦ã€å„ã‚¹ãƒ†ãƒƒãƒ—ãŒå®Ÿè¡Œã•ã‚Œã‚‹å¿…è¦ã®ã‚ã‚‹ã‚³ãƒ³ãƒ†ãƒŠã®ã‚¿ã‚¤ãƒ—ã‚’æŒ‡å®šã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚

### ã‚·ãƒ³ãƒ—ãƒ«ãªãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã®ä¾‹
```yaml
jobs:
- name: simple
plan:
- task: simple-task
privileged: true
config:
# Tells Concourse which type of worker this task should run on
platform: linux
image_resource:
type: registry-image
source:
repository: busybox # images are pulled from docker hub by default
run:
path: sh
args:
- -cx
- |
sleep 1000
echo "$SUPER_SECRET"
params:
SUPER_SECRET: ((super.secret))
```

```bash
fly -t tutorial set-pipeline -p pipe-name -c hello-world.yml
# pipelines are paused when first created
fly -t tutorial unpause-pipeline -p pipe-name
# trigger the job and watch it run to completion
fly -t tutorial trigger-job --job pipe-name/simple --watch
# From another console
fly -t tutorial intercept --job pipe-name/simple
```
**127.0.0.1:8080** ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã®ãƒ•ãƒ­ãƒ¼ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚

### å‡ºåŠ›/å…¥åŠ›ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚’æŒã¤Bashã‚¹ã‚¯ãƒªãƒ—ãƒˆ

**1ã¤ã®ã‚¿ã‚¹ã‚¯ã®çµæœã‚’ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜**ã—ã€ãã‚Œã‚’å‡ºåŠ›ã¨ã—ã¦ç¤ºã—ã€æ¬¡ã®ã‚¿ã‚¹ã‚¯ã®å…¥åŠ›ã‚’å‰ã®ã‚¿ã‚¹ã‚¯ã®å‡ºåŠ›ã¨ã—ã¦ç¤ºã™ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚ConcourseãŒè¡Œã†ã“ã¨ã¯ã€**å‰ã®ã‚¿ã‚¹ã‚¯ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’æ–°ã—ã„ã‚¿ã‚¹ã‚¯ã«ãƒã‚¦ãƒ³ãƒˆã—ã€å‰ã®ã‚¿ã‚¹ã‚¯ã«ã‚ˆã£ã¦ä½œæˆã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ã“ã¨ã§ã™**ã€‚

### ãƒˆãƒªã‚¬ãƒ¼

ã‚¸ãƒ§ãƒ–ã‚’æ‰‹å‹•ã§æ¯å›ãƒˆãƒªã‚¬ãƒ¼ã™ã‚‹å¿…è¦ã¯ãªãã€æ¯å›å®Ÿè¡Œã•ã‚Œã‚‹ã‚ˆã†ã«ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ï¼š

* æ™‚é–“ãŒçµŒéã—ãŸã¨ã: [Time resource](https://github.com/concourse/time-resource/)
* ãƒ¡ã‚¤ãƒ³ãƒ–ãƒ©ãƒ³ãƒã¸ã®æ–°ã—ã„ã‚³ãƒŸãƒƒãƒˆæ™‚: [Git resource](https://github.com/concourse/git-resource)
* æ–°ã—ã„PR: [Github-PR resource](https://github.com/telia-oss/github-pr-resource)
* ã‚¢ãƒ—ãƒªã®æœ€æ–°ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’å–å¾—ã¾ãŸã¯ãƒ—ãƒƒã‚·ãƒ¥: [Registry-image resource](https://github.com/concourse/registry-image-resource/)

[https://concourse-ci.org/tutorial-resources.html](https://concourse-ci.org/tutorial-resources.html) ã§ãƒã‚¹ã‚¿ãƒ¼ã¸ã®æ–°ã—ã„ã‚³ãƒŸãƒƒãƒˆã§ãƒˆãƒªã‚¬ãƒ¼ã•ã‚Œã‚‹YAMLãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã®ä¾‹ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚

{% hint style="success" %}
AWSãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã³ã€ç·´ç¿’ã™ã‚‹:<img src="../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/image (1).png" alt="" data-size="line">\
GCPãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã³ã€ç·´ç¿’ã™ã‚‹: <img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricksã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹</summary>

* [**ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³**](https://github.com/sponsors/carlospolop)ã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼
* **ğŸ’¬ [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã¾ãŸã¯[**ãƒ†ãƒ¬ã‚°ãƒ©ãƒ ã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«å‚åŠ ã™ã‚‹ã‹ã€**Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**ã‚’ãƒ•ã‚©ãƒ­ãƒ¼ã—ã¦ãã ã•ã„ã€‚**
* **[**HackTricks**](https://github.com/carlospolop/hacktricks)ãŠã‚ˆã³[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)ã®githubãƒªãƒã‚¸ãƒˆãƒªã«PRã‚’æå‡ºã—ã¦ãƒãƒƒã‚­ãƒ³ã‚°ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã—ã¦ãã ã•ã„ã€‚**

</details>
{% endhint %}
