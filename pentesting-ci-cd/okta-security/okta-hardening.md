# Okta Hardening

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the**  [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter**  [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Directory

### People

Z perspektywy atakujcego jest to bardzo interesujce, poniewa偶 bdziesz m贸g zobaczy **wszystkich zarejestrowanych u偶ytkownik贸w**, ich **adresy email**, **grupy**, do kt贸rych nale偶, **profile**, a nawet **urzdzenia** (telefony kom贸rkowe wraz z ich systemami operacyjnymi).

Dla przegldu whitebox sprawd藕, czy nie ma kilku "**Pending user action**" i "**Password reset**".

### Groups

Tutaj znajdziesz wszystkie utworzone grupy w Okta. Jest to interesujce, aby zrozumie r贸偶ne grupy (zestaw **uprawnie**), kt贸re mog by przyznane **u偶ytkownikom**.\
Mo偶na zobaczy **osoby wchodzce w skad grup** i **aplikacje przypisane** do ka偶dej grupy.

Oczywicie, ka偶da grupa z nazw **admin** jest interesujca, szczeg贸lnie grupa **Global Administrators**, sprawd藕 czonk贸w, aby dowiedzie si, kto ma najwy偶sze uprawnienia.

Z perspektywy whitebox, **nie powinno by wicej ni偶 5 globalnych administrator贸w** (lepiej, jeli jest tylko 2 lub 3).

### Devices

Znajd藕 tutaj **list wszystkich urzdze** wszystkich u偶ytkownik贸w. Mo偶esz r贸wnie偶 zobaczy, czy s **aktywnie zarzdzane**, czy nie.

### Profile Editor

Tutaj mo偶na obserwowa, jak kluczowe informacje, takie jak imiona, nazwiska, adresy email, nazwy u偶ytkownik贸w... s udostpniane midzy Okta a innymi aplikacjami. Jest to interesujce, poniewa偶 jeli u偶ytkownik mo偶e **zmodyfikowa w Okta pole** (takie jak jego imi lub email), kt贸re jest nastpnie u偶ywane przez **zewntrzn aplikacj** do **identyfikacji** u偶ytkownika, osoba wewntrzna mo偶e pr贸bowa **przej inne konta**.

Ponadto, w profilu **`User (default)`** z Okta mo偶na zobaczy **kt贸re pola** ma ka偶dy **u偶ytkownik** i kt贸re s **zapisywalne** przez u偶ytkownik贸w. Jeli nie mo偶esz zobaczy panelu administracyjnego, po prostu przejd藕 do **aktualizacji swojego profilu** i zobaczysz, kt贸re pola mo偶esz zaktualizowa (zauwa偶, 偶e aby zaktualizowa adres email, bdziesz musia go zweryfikowa).

### Directory Integrations

Katalogi pozwalaj na importowanie os贸b z istniejcych 藕r贸de. Przypuszczam, 偶e tutaj zobaczysz u偶ytkownik贸w importowanych z innych katalog贸w.

Nie widziaem tego, ale przypuszczam, 偶e jest to interesujce, aby dowiedzie si **innych katalog贸w, kt贸re Okta u偶ywa do importowania u偶ytkownik贸w**, wic jeli **skompromitujesz ten katalog**, mo偶esz ustawi wartoci atrybut贸w w u偶ytkownikach utworzonych w Okta i **mo偶e skompromitowa rodowisko Okta**.

### Profile Sources

殴r贸do profilu to **aplikacja, kt贸ra dziaa jako 藕r贸do prawdy** dla atrybut贸w profilu u偶ytkownika. U偶ytkownik mo偶e by 藕r贸dem tylko jednej aplikacji lub katalogu na raz.

Nie widziaem tego, wic ka偶da informacja na temat bezpieczestwa i hackingu dotyczca tej opcji jest mile widziana.

## Customizations

### Brands

Sprawd藕 w zakadce **Domains** tej sekcji adresy email u偶ywane do wysyania emaili oraz niestandardow domen wewntrz Okta firmy (kt贸r prawdopodobnie ju偶 znasz).

Ponadto, w zakadce **Setting**, jeli jeste administratorem, mo偶esz "**Use a custom sign-out page**" i ustawi niestandardowy URL.

### SMS

Nic interesujcego tutaj.

### End-User Dashboard

Tutaj mo偶esz znale藕 skonfigurowane aplikacje, ale szczeg贸y tych zobaczymy p贸藕niej w innej sekcji.

### Other

Interesujce ustawienia, ale nic super interesujcego z punktu widzenia bezpieczestwa.

## Applications

### Applications

Tutaj mo偶esz znale藕 wszystkie **skonfigurowane aplikacje** i ich szczeg贸y: Kto ma do nich dostp, jak s skonfigurowane (SAML, OpenID), URL do logowania, mapowania midzy Okta a aplikacj...

W zakadce **`Sign On`** znajduje si r贸wnie偶 pole o nazwie **`Password reveal`**, kt贸re pozwala u偶ytkownikowi **ujawni swoje haso** podczas sprawdzania ustawie aplikacji. Aby sprawdzi ustawienia aplikacji z Panelu U偶ytkownika, kliknij 3 kropki:

<figure><img src="../../.gitbook/assets/image (283).png" alt=""><figcaption></figcaption></figure>

I mo偶esz zobaczy wicej szczeg贸贸w na temat aplikacji (jak funkcja ujawniania hasa, jeli jest wczona):

<figure><img src="../../.gitbook/assets/image (220).png" alt=""><figcaption></figcaption></figure>

## Identity Governance

### Access Certifications

U偶yj Access Certifications, aby tworzy kampanie audytowe do okresowego przegldu dostpu u偶ytkownik贸w do zasob贸w i automatycznego zatwierdzania lub odwoywania dostpu, gdy jest to wymagane.

Nie widziaem tego u偶ywanego, ale przypuszczam, 偶e z defensywnego punktu widzenia jest to fajna funkcja.

## Security

### General

* **Security notification emails**: Wszystkie powinny by wczone.
* **CAPTCHA integration**: Zaleca si ustawienie przynajmniej niewidocznego reCaptcha
* **Organization Security**: Wszystko mo偶e by wczone, a emaile aktywacyjne nie powinny trwa dugo (7 dni jest ok)
* **User enumeration prevention**: Oba powinny by wczone
* Zauwa偶, 偶e User Enumeration Prevention nie dziaa, jeli kt贸rakolwiek z poni偶szych warunk贸w jest dozwolona (Zobacz [User management](https://help.okta.com/oie/en-us/Content/Topics/users-groups-profiles/usgp-main.htm) po wicej informacji):
* Self-Service Registration
* JIT flows with email authentication
* **Okta ThreatInsight settings**: Loguj i egzekwuj bezpieczestwo w oparciu o poziom zagro偶enia

### HealthInsight

Tutaj mo偶na znale藕 poprawnie i **niebezpiecznie** skonfigurowane **ustawienia**.

### Authenticators

Tutaj mo偶esz znale藕 wszystkie metody uwierzytelniania, kt贸re u偶ytkownik mo偶e u偶ywa: Haso, telefon, email, kod, WebAuthn... Klikajc w uwierzytelnianie hasem, mo偶esz zobaczy **polityk hase**. Sprawd藕, czy jest silna.

W zakadce **Enrollment** mo偶esz zobaczy, kt贸re s wymagane lub opcjonalne:

<figure><img src="../../.gitbook/assets/image (143).png" alt=""><figcaption></figcaption></figure>

Zaleca si wyczenie telefonu. Najsilniejsze s prawdopodobnie kombinacja hasa, emaila i WebAuthn.

### Authentication policies

Ka偶da aplikacja ma polityk uwierzytelniania. Polityka uwierzytelniania weryfikuje, czy u偶ytkownicy pr贸bujcy zalogowa si do aplikacji speniaj okrelone warunki i egzekwuje wymagania dotyczce czynnik贸w na podstawie tych warunk贸w.

Tutaj mo偶esz znale藕 **wymagania dotyczce dostpu do ka偶dej aplikacji**. Zaleca si 偶danie przynajmniej hasa i innej metody dla ka偶dej aplikacji. Ale jeli jako atakujcy znajdziesz co sabszego, mo偶esz spr贸bowa to zaatakowa.

### Global Session Policy

Tutaj mo偶esz znale藕 polityki sesji przypisane do r贸偶nych grup. Na przykad:

<figure><img src="../../.gitbook/assets/image (245).png" alt=""><figcaption></figcaption></figure>

Zaleca si 偶danie MFA, ograniczenie czasu trwania sesji do kilku godzin, nie przechowywanie ciasteczek sesji w rozszerzeniach przegldarki i ograniczenie lokalizacji oraz dostawcy to偶samoci (jeli to mo偶liwe). Na przykad, jeli ka偶dy u偶ytkownik powinien logowa si z okrelonego kraju, mo偶esz zezwoli tylko na t lokalizacj.

### Identity Providers

Identity Providers (IdPs) to usugi, kt贸re **zarzdzaj kontami u偶ytkownik贸w**. Dodanie IdPs w Okta umo偶liwia u偶ytkownikom kocowym **samodzieln rejestracj** w twoich niestandardowych aplikacjach poprzez najpierw uwierzytelnienie si za pomoc konta spoecznociowego lub karty inteligentnej.

Na stronie Identity Providers mo偶esz doda logowania spoecznociowe (IdPs) i skonfigurowa Okta jako dostawc usug (SP) poprzez dodanie przychodzcego SAML. Po dodaniu IdPs, mo偶esz ustawi zasady routingu, aby skierowa u偶ytkownik贸w do IdP na podstawie kontekstu, takiego jak lokalizacja u偶ytkownika, urzdzenie lub domena email.

**Jeli jakikolwiek dostawca to偶samoci jest skonfigurowany**, z punktu widzenia atakujcego i obrocy sprawd藕 t konfiguracj i **czy 藕r贸do jest naprawd godne zaufania**, poniewa偶 atakujcy, kt贸ry skompromituje to 藕r贸do, mo偶e r贸wnie偶 uzyska dostp do rodowiska Okta.

### Delegated Authentication

Delegated authentication pozwala u偶ytkownikom logowa si do Okta, wprowadzajc dane uwierzytelniajce do **Active Directory (AD) lub serwera LDAP** swojej organizacji.

Ponownie, sprawd藕 to, poniewa偶 atakujcy, kt贸ry skompromituje AD organizacji, mo偶e by w stanie przeskoczy do Okta dziki temu ustawieniu.

### Network

Strefa sieciowa to konfigurowalna granica, kt贸rej mo偶esz u偶y do **przyznawania lub ograniczania dostpu do komputer贸w i urzdze** w twojej organizacji na podstawie **adresu IP**, kt贸ry 偶da dostpu. Mo偶esz zdefiniowa stref sieciow, okrelajc jeden lub wicej indywidualnych adres贸w IP, zakresy adres贸w IP lub lokalizacje geograficzne.

Po zdefiniowaniu jednej lub wicej stref sieciowych, mo偶esz **u偶ywa ich w Global Session Policies**, **politykach uwierzytelniania**, powiadomieniach VPN i **zasadach routingu**.

Z perspektywy atakujcego interesujce jest wiedzie, kt贸re IP s dozwolone (i sprawdzi, czy jakie **IP s bardziej uprzywilejowane** ni偶 inne). Z perspektywy atakujcego, jeli u偶ytkownicy powinni uzyskiwa dostp z okrelonego adresu IP lub regionu, sprawd藕, czy ta funkcja jest u偶ywana prawidowo.

### Device Integrations

* **Endpoint Management**: Zarzdzanie punktami kocowymi to warunek, kt贸ry mo偶na zastosowa w polityce uwierzytelniania, aby zapewni, 偶e zarzdzane urzdzenia maj dostp do aplikacji.
* Nie widziaem tego jeszcze u偶ywanego. TODO
* **Notification services**: Nie widziaem tego jeszcze u偶ywanego. TODO

### API

Mo偶esz tworzy tokeny API Okta na tej stronie i zobaczy te, kt贸re zostay **utworzone**, ich **uprawnienia**, **czas wyganicia** i **URL pochodzenia**. Zauwa偶, 偶e tokeny API s generowane z uprawnieniami u偶ytkownika, kt贸ry utworzy token i s wa偶ne tylko wtedy, gdy **u偶ytkownik**, kt贸ry je utworzy, jest **aktywny**.

**Trusted Origins** przyznaj dostp do stron internetowych, kt贸re kontrolujesz i kt贸rym ufasz, aby uzyska dostp do twojej organizacji Okta przez API Okta.

Nie powinno by du偶o token贸w API, poniewa偶 jeli s, atakujcy mo偶e pr贸bowa uzyska do nich dostp i je wykorzysta.

## Workflow

### Automations

Automations pozwalaj na tworzenie zautomatyzowanych dziaa, kt贸re uruchamiaj si na podstawie zestawu warunk贸w wyzwalajcych, kt贸re wystpuj podczas cyklu 偶ycia u偶ytkownik贸w kocowych.

Na przykad warunkiem mo偶e by "User inactivity in Okta" lub "User password expiration in Okta", a dziaaniem mo偶e by "Send email to the user" lub "Change user lifecycle state in Okta".

## Reports

### Reports

Pobierz logi. S **wysyane** na **adres email** bie偶cego konta.

### System Log

Tutaj mo偶esz znale藕 **logi dziaa wykonywanych przez u偶ytkownik贸w** z wieloma szczeg贸ami, takimi jak logowanie do Okta lub do aplikacji przez Okta.

### Import Monitoring

To mo偶e **importowa logi z innych platform** uzyskiwanych przez Okta.

### Rate limits

Sprawd藕 osignite limity API.

## Settings

### Account

Tutaj mo偶esz znale藕 **og贸lne informacje** o rodowisku Okta, takie jak nazwa firmy, adres, **kontakt email do rozlicze**, **kontakt email do spraw technicznych** oraz kto powinien otrzymywa aktualizacje Okta i jakie rodzaje aktualizacji Okta.

### Downloads

Tutaj mo偶esz pobra agent贸w Okta do synchronizacji Okta z innymi technologiami.

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the**  [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter**  [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
