# Okta Hardening

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Directory

### People

Du point de vue d'un attaquant, c'est super int√©ressant car vous pourrez voir **tous les utilisateurs enregistr√©s**, leurs **adresses email**, les **groupes** auxquels ils appartiennent, les **profils** et m√™me les **appareils** (mobiles avec leurs syst√®mes d'exploitation).

Pour une revue en bo√Æte blanche, v√©rifiez qu'il n'y a pas plusieurs "**Action utilisateur en attente**" et "**R√©initialisation de mot de passe**".

### Groups

C'est ici que vous trouvez tous les groupes cr√©√©s dans Okta. Il est int√©ressant de comprendre les diff√©rents groupes (ensemble de **permissions**) qui pourraient √™tre accord√©s aux **utilisateurs**.\
Il est possible de voir les **personnes incluses dans les groupes** et les **applications assign√©es** √† chaque groupe.

Bien s√ªr, tout groupe avec le nom **admin** est int√©ressant, en particulier le groupe **Administrateurs globaux**, v√©rifiez les membres pour savoir qui sont les membres les plus privil√©gi√©s.

Dans une revue en bo√Æte blanche, il **ne devrait pas y avoir plus de 5 administrateurs globaux** (mieux s'il n'y en a que 2 ou 3).

### Devices

Trouvez ici une **liste de tous les appareils** de tous les utilisateurs. Vous pouvez √©galement voir s'il est **activement g√©r√©** ou non.

### Profile Editor

Ici, il est possible d'observer comment des informations cl√©s telles que les pr√©noms, noms, emails, noms d'utilisateur... sont partag√©es entre Okta et d'autres applications. C'est int√©ressant car si un utilisateur peut **modifier dans Okta un champ** (comme son nom ou son email) qui est ensuite utilis√© par une **application externe** pour **identifier** l'utilisateur, un initi√© pourrait essayer de **prendre le contr√¥le d'autres comptes**.

De plus, dans le profil **`User (default)`** d'Okta, vous pouvez voir **quels champs** chaque **utilisateur** a et lesquels sont **modifiables** par les utilisateurs. Si vous ne pouvez pas voir le panneau d'administration, allez simplement √† **mettre √† jour vos informations de profil** et vous verrez quels champs vous pouvez mettre √† jour (notez que pour mettre √† jour une adresse email, vous devrez la v√©rifier).

### Directory Integrations

Les annuaires vous permettent d'importer des personnes √† partir de sources existantes. Je suppose qu'ici vous verrez les utilisateurs import√©s d'autres annuaires.

Je ne l'ai pas vu, mais je suppose que c'est int√©ressant de d√©couvrir **d'autres annuaires qu'Okta utilise pour importer des utilisateurs** afin que si vous **compromettez cet annuaire**, vous puissiez d√©finir certaines valeurs d'attributs dans les utilisateurs cr√©√©s dans Okta et **peut-√™tre compromettre l'environnement Okta**.

### Profile Sources

Une source de profil est une **application qui agit comme une source de v√©rit√©** pour les attributs de profil utilisateur. Un utilisateur ne peut √™tre source que par une seule application ou annuaire √† la fois.

Je ne l'ai pas vu, donc toute information sur la s√©curit√© et le hacking concernant cette option est appr√©ci√©e.

## Customizations

### Brands

V√©rifiez dans l'onglet **Domains** de cette section les adresses email utilis√©es pour envoyer des emails et le domaine personnalis√© √† l'int√©rieur d'Okta de l'entreprise (que vous connaissez probablement d√©j√†).

De plus, dans l'onglet **Setting**, si vous √™tes administrateur, vous pouvez "**Utiliser une page de d√©connexion personnalis√©e**" et d√©finir une URL personnalis√©e.

### SMS

Rien d'int√©ressant ici.

### End-User Dashboard

Vous pouvez trouver ici des applications configur√©es, mais nous verrons les d√©tails de celles-ci plus tard dans une autre section.

### Other

Param√®tre int√©ressant, mais rien de super int√©ressant du point de vue de la s√©curit√©.

## Applications

### Applications

Ici, vous pouvez trouver toutes les **applications configur√©es** et leurs d√©tails : Qui y a acc√®s, comment elles sont configur√©es (SAML, OpenID), URL de connexion, les mappages entre Okta et l'application...

Dans l'onglet **`Sign On`**, il y a aussi un champ appel√© **`Password reveal`** qui permettrait √† un utilisateur de **r√©v√©ler son mot de passe** en v√©rifiant les param√®tres de l'application. Pour v√©rifier les param√®tres d'une application depuis le panneau utilisateur, cliquez sur les 3 points :

<figure><img src="../../.gitbook/assets/image (283).png" alt=""><figcaption></figcaption></figure>

Et vous pourriez voir quelques d√©tails suppl√©mentaires sur l'application (comme la fonction de r√©v√©lation de mot de passe, si elle est activ√©e) :

<figure><img src="../../.gitbook/assets/image (220).png" alt=""><figcaption></figcaption></figure>

## Identity Governance

### Access Certifications

Utilisez les certifications d'acc√®s pour cr√©er des campagnes d'audit afin de revoir p√©riodiquement l'acc√®s de vos utilisateurs aux ressources et d'approuver ou de r√©voquer l'acc√®s automatiquement lorsque cela est n√©cessaire.

Je ne l'ai pas vu utilis√©, mais je suppose que d'un point de vue d√©fensif, c'est une belle fonctionnalit√©.

## Security

### General

* **Emails de notification de s√©curit√©** : Tous devraient √™tre activ√©s.
* **Int√©gration CAPTCHA** : Il est recommand√© de d√©finir au moins le reCaptcha invisible.
* **S√©curit√© de l'organisation** : Tout peut √™tre activ√© et les emails d'activation ne devraient pas durer longtemps (7 jours c'est bien).
* **Pr√©vention de l'√©num√©ration des utilisateurs** : Les deux devraient √™tre activ√©s.
* Notez que la pr√©vention de l'√©num√©ration des utilisateurs n'est pas efficace si l'une des conditions suivantes est autoris√©e (voir [Gestion des utilisateurs](https://help.okta.com/oie/en-us/Content/Topics/users-groups-profiles/usgp-main.htm) pour plus d'informations) :
* Inscription en libre-service
* Flux JIT avec authentification par email
* **Param√®tres Okta ThreatInsight** : Journaliser et appliquer la s√©curit√© en fonction du niveau de menace.

### HealthInsight

Ici, il est possible de trouver des **param√®tres** configur√©s correctement et **dangereux**.

### Authenticators

Ici, vous pouvez trouver toutes les m√©thodes d'authentification qu'un utilisateur pourrait utiliser : Mot de passe, t√©l√©phone, email, code, WebAuthn... En cliquant sur l'authentificateur de mot de passe, vous pouvez voir la **politique de mot de passe**. V√©rifiez qu'elle est forte.

Dans l'onglet **Enrollment**, vous pouvez voir comment ceux qui sont requis ou optionnels :

<figure><img src="../../.gitbook/assets/image (143).png" alt=""><figcaption></figcaption></figure>

Il est recommand√© de d√©sactiver le t√©l√©phone. Les plus forts sont probablement une combinaison de mot de passe, email et WebAuthn.

### Authentication policies

Chaque application a une politique d'authentification. La politique d'authentification v√©rifie que les utilisateurs qui essaient de se connecter √† l'application r√©pondent √† des conditions sp√©cifiques, et elle applique des exigences de facteur en fonction de ces conditions.

Ici, vous pouvez trouver les **exigences pour acc√©der √† chaque application**. Il est recommand√© de demander au moins un mot de passe et une autre m√©thode pour chaque application. Mais si en tant qu'attaquant vous trouvez quelque chose de plus faible, vous pourriez √™tre en mesure de l'attaquer.

### Global Session Policy

Ici, vous pouvez trouver les politiques de session assign√©es √† diff√©rents groupes. Par exemple :

<figure><img src="../../.gitbook/assets/image (245).png" alt=""><figcaption></figcaption></figure>

Il est recommand√© de demander MFA, de limiter la dur√©e de vie de la session √† quelques heures, de ne pas persister les cookies de session √† travers les extensions de navigateur et de limiter l'emplacement et le fournisseur d'identit√© (si cela est possible). Par exemple, si chaque utilisateur doit se connecter depuis un pays, vous pourriez uniquement autoriser cet emplacement.

### Identity Providers

Les fournisseurs d'identit√© (IdP) sont des services qui **g√®rent les comptes utilisateurs**. Ajouter des IdP dans Okta permet √† vos utilisateurs finaux de **s'inscrire eux-m√™mes** √† vos applications personnalis√©es en s'authentifiant d'abord avec un compte social ou une carte intelligente.

Sur la page des fournisseurs d'identit√©, vous pouvez ajouter des connexions sociales (IdP) et configurer Okta en tant que fournisseur de services (SP) en ajoutant SAML entrant. Apr√®s avoir ajout√© des IdP, vous pouvez configurer des r√®gles de routage pour diriger les utilisateurs vers un IdP en fonction du contexte, tel que l'emplacement de l'utilisateur, l'appareil ou le domaine email.

**Si un fournisseur d'identit√© est configur√©**, du point de vue d'un attaquant et d'un d√©fenseur, v√©rifiez cette configuration et **si la source est vraiment fiable**, car un attaquant qui la compromettrait pourrait √©galement acc√©der √† l'environnement Okta.

### Delegated Authentication

L'authentification d√©l√©gu√©e permet aux utilisateurs de se connecter √† Okta en saisissant des identifiants pour le **Active Directory (AD) ou LDAP** de leur organisation.

Encore une fois, v√©rifiez cela, car un attaquant compromettant l'AD d'une organisation pourrait √™tre en mesure de pivoter vers Okta gr√¢ce √† ce param√®tre.

### Network

Une zone r√©seau est une limite configurable que vous pouvez utiliser pour **accorder ou restreindre l'acc√®s aux ordinateurs et appareils** de votre organisation en fonction de l'**adresse IP** qui demande l'acc√®s. Vous pouvez d√©finir une zone r√©seau en sp√©cifiant une ou plusieurs adresses IP individuelles, des plages d'adresses IP ou des emplacements g√©ographiques.

Apr√®s avoir d√©fini une ou plusieurs zones r√©seau, vous pouvez **les utiliser dans les politiques de session globales**, **les politiques d'authentification**, les notifications VPN et **les r√®gles de routage**.

Du point de vue d'un attaquant, il est int√©ressant de savoir quelles IP sont autoris√©es (et de v√©rifier si certaines **IP sont plus privil√©gi√©es** que d'autres). Du point de vue d'un attaquant, si les utilisateurs doivent acc√©der depuis une adresse IP ou une r√©gion sp√©cifique, v√©rifiez que cette fonctionnalit√© est utilis√©e correctement.

### Device Integrations

* **Gestion des points de terminaison** : La gestion des points de terminaison est une condition qui peut √™tre appliqu√©e dans une politique d'authentification pour garantir que les appareils g√©r√©s ont acc√®s √† une application.
* Je ne l'ai pas encore vu utilis√©. TODO
* **Services de notification** : Je ne l'ai pas encore vu utilis√©. TODO

### API

Vous pouvez cr√©er des jetons API Okta sur cette page, et voir ceux qui ont √©t√© **cr√©√©s**, leurs **privil√®ges**, le temps d'**expiration** et les **URLs d'origine**. Notez qu'un jeton API est g√©n√©r√© avec les permissions de l'utilisateur qui a cr√©√© le jeton et n'est valide que si l'**utilisateur** qui les a cr√©√©s est **actif**.

Les **Origines de confiance** accordent l'acc√®s aux sites Web que vous contr√¥lez et en qui vous avez confiance pour acc√©der √† votre organisation Okta via l'API Okta.

Il ne devrait pas y avoir beaucoup de jetons API, car s'il y en a, un attaquant pourrait essayer d'y acc√©der et de les utiliser.

## Workflow

### Automations

Les automatisations vous permettent de cr√©er des actions automatis√©es qui s'ex√©cutent en fonction d'un ensemble de conditions de d√©clenchement qui se produisent pendant le cycle de vie des utilisateurs finaux.

Par exemple, une condition pourrait √™tre "Inactivit√© de l'utilisateur dans Okta" ou "Expiration du mot de passe de l'utilisateur dans Okta" et l'action pourrait √™tre "Envoyer un email √† l'utilisateur" ou "Changer l'√©tat du cycle de vie de l'utilisateur dans Okta".

## Reports

### Reports

T√©l√©chargez les journaux. Ils sont **envoy√©s** √† l'**adresse email** du compte actuel.

### System Log

Ici, vous pouvez trouver les **journaux des actions effectu√©es par les utilisateurs** avec beaucoup de d√©tails comme la connexion dans Okta ou dans des applications via Okta.

### Import Monitoring

Cela peut **importer des journaux des autres plateformes** accessibles avec Okta.

### Rate limits

V√©rifiez les limites de taux API atteintes.

## Settings

### Account

Ici, vous pouvez trouver des **informations g√©n√©riques** sur l'environnement Okta, telles que le nom de l'entreprise, l'adresse, le **contact de facturation par email**, le **contact technique par email** et aussi qui devrait recevoir les mises √† jour d'Okta et quel type de mises √† jour d'Okta.

### Downloads

Ici, vous pouvez t√©l√©charger des agents Okta pour synchroniser Okta avec d'autres technologies.

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
