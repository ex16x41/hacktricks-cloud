# Okta Hardening

{% hint style="success" %}
Lernen & √ºben Sie AWS Hacking:<img src="../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Lernen & √ºben Sie GCP Hacking: <img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* √úberpr√ºfen Sie die [**Abonnementpl√§ne**](https://github.com/sponsors/carlospolop)!
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teilen Sie Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repos senden.

</details>
{% endhint %}

## Verzeichnis

### Personen

Aus der Perspektive eines Angreifers ist dies sehr interessant, da Sie **alle registrierten Benutzer**, deren **E-Mail**-Adressen, die **Gruppen**, zu denen sie geh√∂ren, **Profile** und sogar **Ger√§te** (Mobilger√§te zusammen mit ihren Betriebssystemen) sehen k√∂nnen.

F√ºr eine Whitebox-√úberpr√ºfung √ºberpr√ºfen Sie, ob es mehrere "**Ausstehende Benutzeraktionen**" und "**Passwort zur√ºcksetzen**" gibt.

### Gruppen

Hier finden Sie alle in Okta erstellten Gruppen. Es ist interessant, die verschiedenen Gruppen (Satz von **Berechtigungen**), die Benutzern gew√§hrt werden k√∂nnten, zu verstehen.\
Es ist m√∂glich, die **Personen in Gruppen** und die **Apps**, die jeder Gruppe zugewiesen sind, zu sehen.

Nat√ºrlich ist jede Gruppe mit dem Namen **admin** interessant, insbesondere die Gruppe **Global Administrators**. √úberpr√ºfen Sie die Mitglieder, um herauszufinden, wer die privilegiertesten Mitglieder sind.

Bei einer Whitebox-√úberpr√ºfung **sollten nicht mehr als 5 globale Administratoren** vorhanden sein (besser, wenn es nur 2 oder 3 sind).

### Ger√§te

Hier finden Sie eine **Liste aller Ger√§te** aller Benutzer. Sie k√∂nnen auch sehen, ob es **aktiv verwaltet** wird oder nicht.

### Profil-Editor

Hier ist es m√∂glich zu beobachten, wie wichtige Informationen wie Vornamen, Nachnamen, E-Mails, Benutzernamen... zwischen Okta und anderen Anwendungen geteilt werden. Dies ist interessant, da ein Benutzer, wenn er ein Feld in Okta **√§ndern kann** (wie seinen Namen oder seine E-Mail), das dann von einer **externen Anwendung** zur **Identifizierung** des Benutzers verwendet wird, versuchen k√∂nnte, **andere Konten zu √ºbernehmen**.

Dar√ºber hinaus k√∂nnen Sie im Profil **`User (default)`** von Okta sehen, **welche Felder** jeder **Benutzer** hat und welche **schreibbar** sind. Wenn Sie das Admin-Panel nicht sehen k√∂nnen, gehen Sie einfach zu **aktualisieren Sie Ihre Profil**-Informationen, und Sie werden sehen, welche Felder Sie aktualisieren k√∂nnen (beachten Sie, dass Sie eine E-Mail-Adresse verifizieren m√ºssen, um sie zu aktualisieren).

### Verzeichnis-Integrationen

Verzeichnisse erm√∂glichen es Ihnen, Personen aus bestehenden Quellen zu importieren. Ich nehme an, hier sehen Sie die Benutzer, die aus anderen Verzeichnissen importiert wurden.

Ich habe es nicht gesehen, aber ich nehme an, dass es interessant ist, **andere Verzeichnisse zu finden, die Okta verwendet, um Benutzer zu importieren**, sodass Sie, wenn Sie **dieses Verzeichnis kompromittieren**, einige Attributwerte in den in Okta erstellten Benutzern festlegen und **vielleicht die Okta-Umgebung kompromittieren** k√∂nnten.

### Profilquellen

Eine Profilquelle ist eine **Anwendung, die als Quelle der Wahrheit** f√ºr Benutzerprofilattribute fungiert. Ein Benutzer kann nur von einer einzigen Anwendung oder einem Verzeichnis gleichzeitig bezogen werden.

Ich habe es nicht gesehen, daher sind alle Informationen √ºber Sicherheit und Hacking in Bezug auf diese Option willkommen.

## Anpassungen

### Marken

√úberpr√ºfen Sie im Tab **Domains** dieses Abschnitts die E-Mail-Adressen, die zum Versenden von E-Mails verwendet werden, und die benutzerdefinierte Domain innerhalb von Okta des Unternehmens (die Sie wahrscheinlich bereits kennen).

Dar√ºber hinaus k√∂nnen Sie im Tab **Einstellungen**, wenn Sie Administrator sind, "**Eine benutzerdefinierte Abmeldeseite verwenden**" und eine benutzerdefinierte URL festlegen.

### SMS

Hier gibt es nichts Interessantes.

### Endbenutzer-Dashboard

Hier finden Sie konfigurierte Anwendungen, aber wir werden die Details sp√§ter in einem anderen Abschnitt sehen.

### Andere

Interessante Einstellung, aber nichts super Interessantes aus Sicht der Sicherheit.

## Anwendungen

### Anwendungen

Hier finden Sie alle **konfigurierten Anwendungen** und deren Details: Wer Zugriff auf sie hat, wie sie konfiguriert sind (SAML, OpenID), URL zum Anmelden, die Zuordnungen zwischen Okta und der Anwendung...

Im Tab **`Sign On`** gibt es auch ein Feld namens **`Password reveal`**, das es einem Benutzer erm√∂glichen w√ºrde, sein **Passwort** beim √úberpr√ºfen der Anwendungseinstellungen **offen zu legen**. Um die Einstellungen einer Anwendung vom Benutzerpanel aus zu √ºberpr√ºfen, klicken Sie auf die 3 Punkte:

<figure><img src="../../.gitbook/assets/image (283).png" alt=""><figcaption></figcaption></figure>

Und Sie k√∂nnten einige weitere Details zur App sehen (wie die Passwort-Offenlegungsfunktion, wenn sie aktiviert ist):

<figure><img src="../../.gitbook/assets/image (220).png" alt=""><figcaption></figcaption></figure>

## Identit√§tsgovernance

### Zugriffszertifizierungen

Verwenden Sie Zugriffszertifizierungen, um Auditkampagnen zu erstellen, um den Zugriff Ihrer Benutzer auf Ressourcen regelm√§√üig zu √ºberpr√ºfen und den Zugriff automatisch zu genehmigen oder zu widerrufen, wenn dies erforderlich ist.

Ich habe es nicht gesehen, aber ich nehme an, dass es aus defensiver Sicht eine nette Funktion ist.

## Sicherheit

### Allgemein

* **Sicherheitsbenachrichtigungs-E-Mails**: Alle sollten aktiviert sein.
* **CAPTCHA-Integration**: Es wird empfohlen, mindestens das unsichtbare reCaptcha einzustellen.
* **Organisationssicherheit**: Alles kann aktiviert werden, und Aktivierungs-E-Mails sollten nicht lange dauern (7 Tage sind in Ordnung).
* **Verhinderung der Benutzerenumeration**: Beide sollten aktiviert sein.
* Beachten Sie, dass die Verhinderung der Benutzerenumeration nicht wirksam wird, wenn eine der folgenden Bedingungen erlaubt ist (siehe [Benutzerverwaltung](https://help.okta.com/oie/en-us/Content/Topics/users-groups-profiles/usgp-main.htm) f√ºr weitere Informationen):
* Selbstregistrierung
* JIT-Workflows mit E-Mail-Authentifizierung
* **Okta ThreatInsight-Einstellungen**: Protokollieren und Durchsetzen von Sicherheit basierend auf dem Bedrohungsniveau.

### HealthInsight

Hier ist es m√∂glich, korrekt und **gef√§hrlich** konfigurierte **Einstellungen** zu finden.

### Authentifizierer

Hier finden Sie alle Authentifizierungsmethoden, die ein Benutzer verwenden k√∂nnte: Passwort, Telefon, E-Mail, Code, WebAuthn... Wenn Sie auf den Passwort-Authentifizierer klicken, k√∂nnen Sie die **Passwortrichtlinie** sehen. √úberpr√ºfen Sie, ob sie stark ist.

Im Tab **Enrollment** k√∂nnen Sie sehen, welche erforderlich oder optional sind:

<figure><img src="../../.gitbook/assets/image (143).png" alt=""><figcaption></figcaption></figure>

Es wird empfohlen, das Telefon zu deaktivieren. Die st√§rksten sind wahrscheinlich eine Kombination aus Passwort, E-Mail und WebAuthn.

### Authentifizierungsrichtlinien

Jede App hat eine Authentifizierungsrichtlinie. Die Authentifizierungsrichtlinie √ºberpr√ºft, ob Benutzer, die versuchen, sich bei der App anzumelden, bestimmte Bedingungen erf√ºllen, und sie setzt die Faktoranforderungen basierend auf diesen Bedingungen durch.

Hier finden Sie die **Anforderungen f√ºr den Zugriff auf jede Anwendung**. Es wird empfohlen, mindestens ein Passwort und eine andere Methode f√ºr jede Anwendung anzufordern. Aber wenn Sie als Angreifer etwas Schw√§cheres finden, k√∂nnten Sie es angreifen.

### Globale Sitzungsrichtlinie

Hier finden Sie die Sitzungsrichtlinien, die verschiedenen Gruppen zugewiesen sind. Zum Beispiel:

<figure><img src="../../.gitbook/assets/image (245).png" alt=""><figcaption></figcaption></figure>

Es wird empfohlen, MFA anzufordern, die Sitzungsdauer auf einige Stunden zu beschr√§nken, Sitzungs-Cookies nicht √ºber Browsererweiterungen hinweg zu speichern und den Standort und den Identit√§tsanbieter (wenn dies m√∂glich ist) zu beschr√§nken. Wenn jeder Benutzer beispielsweise aus einem bestimmten Land anmelden sollte, k√∂nnten Sie nur diesen Standort zulassen.

### Identit√§tsanbieter

Identit√§tsanbieter (IdPs) sind Dienste, die **Benutzerkonten verwalten**. Das Hinzuf√ºgen von IdPs in Okta erm√∂glicht es Ihren Endbenutzern, sich mit Ihren benutzerdefinierten Anwendungen selbst zu registrieren, indem sie sich zuerst mit einem sozialen Konto oder einer Smartcard authentifizieren.

Auf der Seite der Identit√§tsanbieter k√∂nnen Sie soziale Logins (IdPs) hinzuf√ºgen und Okta als Dienstanbieter (SP) konfigurieren, indem Sie eingehendes SAML hinzuf√ºgen. Nachdem Sie IdPs hinzugef√ºgt haben, k√∂nnen Sie Routingregeln einrichten, um Benutzer basierend auf dem Kontext, wie dem Standort des Benutzers, dem Ger√§t oder der E-Mail-Domain, an einen IdP weiterzuleiten.

**Wenn ein Identit√§tsanbieter konfiguriert ist**, √ºberpr√ºfen Sie aus der Perspektive eines Angreifers und Verteidigers diese Konfiguration und **ob die Quelle wirklich vertrauensw√ºrdig ist**, da ein Angreifer, der sie kompromittiert, auch Zugriff auf die Okta-Umgebung erhalten k√∂nnte.

### Delegierte Authentifizierung

Die delegierte Authentifizierung erm√∂glicht es Benutzern, sich bei Okta anzumelden, indem sie Anmeldeinformationen f√ºr den **Active Directory (AD) oder LDAP**-Server ihrer Organisation eingeben.

√úberpr√ºfen Sie dies erneut, da ein Angreifer, der das AD einer Organisation kompromittiert, m√∂glicherweise in der Lage ist, zu Okta zu pivotieren, dank dieser Einstellung.

### Netzwerk

Eine Netzwerkzone ist eine konfigurierbare Grenze, die Sie verwenden k√∂nnen, um **Zugriff auf Computer und Ger√§te** in Ihrer Organisation basierend auf der **IP-Adresse**, die Zugriff anfordert, zu gew√§hren oder einzuschr√§nken. Sie k√∂nnen eine Netzwerkzone definieren, indem Sie eine oder mehrere einzelne IP-Adressen, IP-Adressbereiche oder geografische Standorte angeben.

Nachdem Sie eine oder mehrere Netzwerkzonen definiert haben, k√∂nnen Sie **sie in globalen Sitzungsrichtlinien**, **Authentifizierungsrichtlinien**, VPN-Benachrichtigungen und **Routingregeln** verwenden.

Aus der Perspektive eines Angreifers ist es interessant zu wissen, welche IPs erlaubt sind (und zu √ºberpr√ºfen, ob einige **IPs privilegierter** sind als andere). Aus der Perspektive eines Angreifers, wenn die Benutzer von einer bestimmten IP-Adresse oder Region aus zugreifen sollten, √ºberpr√ºfen Sie, ob diese Funktion ordnungsgem√§√ü verwendet wird.

### Ger√§teintegrationen

* **Endpoint-Management**: Endpoint-Management ist eine Bedingung, die in einer Authentifizierungsrichtlinie angewendet werden kann, um sicherzustellen, dass verwaltete Ger√§te Zugriff auf eine Anwendung haben.
* Ich habe dies noch nicht gesehen. TODO
* **Benachrichtigungsdienste**: Ich habe dies noch nicht gesehen. TODO

### API

Sie k√∂nnen auf dieser Seite Okta-API-Token erstellen und die **erstellten** Token, deren **Berechtigungen**, **Ablauf**-Zeit und **Ursprungs-URLs** sehen. Beachten Sie, dass API-Token mit den Berechtigungen des Benutzers generiert werden, der das Token erstellt hat, und nur g√ºltig sind, wenn der **Benutzer**, der sie erstellt hat, **aktiv** ist.

Die **Vertrauensw√ºrdigen Urspr√ºnge** gew√§hren Zugriff auf Websites, die Sie kontrollieren und denen Sie vertrauen, um auf Ihre Okta-Org √ºber die Okta-API zuzugreifen.

Es sollten nicht viele API-Token vorhanden sein, da ein Angreifer, wenn es viele gibt, versuchen k√∂nnte, auf sie zuzugreifen und sie zu verwenden.

## Workflow

### Automatisierungen

Automatisierungen erm√∂glichen es Ihnen, automatisierte Aktionen zu erstellen, die basierend auf einer Reihe von Ausl√∂sebedingungen ausgef√ºhrt werden, die w√§hrend des Lebenszyklus der Endbenutzer auftreten.

Ein Beispiel f√ºr eine Bedingung k√∂nnte "Benutzerinaktivit√§t in Okta" oder "Ablauf des Benutzerpassworts in Okta" sein, und die Aktion k√∂nnte "E-Mail an den Benutzer senden" oder "√Ñndern des Benutzerlebenszyklusstatus in Okta" sein.

## Berichte

### Berichte

Laden Sie Protokolle herunter. Sie werden an die **E-Mail-Adresse** des aktuellen Kontos **gesendet**.

### Systemprotokoll

Hier finden Sie die **Protokolle der von Benutzern durchgef√ºhrten Aktionen** mit vielen Details wie Anmeldungen in Okta oder in Anwendungen √ºber Okta.

### Import√ºberwachung

Dies kann **Protokolle von anderen Plattformen importieren**, die mit Okta zugegriffen werden.

### Ratenlimits

√úberpr√ºfen Sie die erreichten API-Ratenlimits.

## Einstellungen

### Konto

Hier finden Sie **allgemeine Informationen** √ºber die Okta-Umgebung, wie den Firmennamen, die Adresse, **E-Mail-Rechnungsadresse**, **E-Mail-technischer Kontakt** und auch, wer Okta-Updates erhalten sollte und welche Art von Okta-Updates.

### Downloads

Hier k√∂nnen Sie Okta-Agenten herunterladen, um Okta mit anderen Technologien zu synchronisieren.

{% hint style="success" %}
Lernen & √ºben Sie AWS Hacking:<img src="../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Lernen & √ºben Sie GCP Hacking: <img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* √úberpr√ºfen Sie die [**Abonnementpl√§ne**](https://github.com/sponsors/carlospolop)!
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teilen Sie Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repos senden.

</details>
{% endhint %}
