# Okta Hardening

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Directory

### People

Iz perspektive napadaÄa, ovo je veoma zanimljivo jer Ä‡ete moÄ‡i da vidite **sve registrovane korisnike**, njihove **email** adrese, **grupe** kojima pripadaju, **profile** i Äak **ureÄ‘aje** (mobilne telefone zajedno sa njihovim operativnim sistemima).

Za pregled u beloj kutiji proverite da nema viÅ¡e od nekoliko "**Pending user action**" i "**Password reset**".

### Groups

Ovde moÅ¾ete pronaÄ‡i sve kreirane grupe u Okta. Zanimljivo je razumeti razliÄite grupe (set **dozvola**) koje mogu biti dodeljene **korisnicima**.\
MoguÄ‡e je videti **ljude ukljuÄene u grupe** i **aplikacije dodeljene** svakoj grupi.

Naravno, svaka grupa sa imenom **admin** je zanimljiva, posebno grupa **Global Administrators**, proverite Älanove da saznate ko su najprivilegovaniji Älanovi.

Iz pregleda u beloj kutiji, ne **bi trebalo da bude viÅ¡e od 5 globalnih admina** (bolje je ako ih ima samo 2 ili 3).

### Devices

Ovde pronaÄ‘ite **listu svih ureÄ‘aja** svih korisnika. TakoÄ‘e moÅ¾ete videti da li se aktivno **upravljaju** ili ne.

### Profile Editor

Ovde je moguÄ‡e posmatrati kako se kljuÄne informacije kao Å¡to su imena, prezimena, email adrese, korisniÄka imena... dele izmeÄ‘u Okta i drugih aplikacija. Ovo je zanimljivo jer ako korisnik moÅ¾e **modifikovati u Okta polje** (kao Å¡to je njegovo ime ili email) koje se zatim koristi od strane **spoljne aplikacije** za **identifikaciju** korisnika, insajder bi mogao pokuÅ¡ati da **preuzme druge naloge**.

Å taviÅ¡e, u profilu **`User (default)`** iz Okta moÅ¾ete videti **koja polja** svaki **korisnik** ima i koja su **pisiva** od strane korisnika. Ako ne moÅ¾ete videti admin panel, jednostavno idite na **aÅ¾uriranje informacija o profilu** i videÄ‡ete koja polja moÅ¾ete aÅ¾urirati (napomena: da biste aÅ¾urirali email adresu, moraÄ‡ete da je verifikujete).

### Directory Integrations

Direktorijumi vam omoguÄ‡avaju da uvezete ljude iz postojeÄ‡ih izvora. Pretpostavljam da Ä‡ete ovde videti korisnike uvezene iz drugih direktorijuma.

Nisam to video, ali pretpostavljam da je zanimljivo otkriti **druge direktorijume koje Okta koristi za uvoz korisnika** tako da ako **kompromitujete taj direktorijum** mogli biste postaviti neke vrednosti atributa u korisnicima kreiranim u Okta i **moÅ¾da kompromitovati Okta okruÅ¾enje**.

### Profile Sources

Izvor profila je **aplikacija koja deluje kao izvor istine** za atribute korisniÄkog profila. Korisnik moÅ¾e biti izvor samo iz jedne aplikacije ili direktorijuma u isto vreme.

Nisam to video, tako da su sve informacije o bezbednosti i hakovanju u vezi sa ovom opcijom dobrodoÅ¡le.

## Customizations

### Brands

Proverite u **Domains** tabu ovog odeljka email adrese koriÅ¡Ä‡ene za slanje emailova i prilagoÄ‘eni domen unutar Okta kompanije (Å¡to verovatno veÄ‡ znate).

Å taviÅ¡e, u **Setting** tabu, ako ste admin, moÅ¾ete "**Koristiti prilagoÄ‘enu stranicu za odjavu**" i postaviti prilagoÄ‘eni URL.

### SMS

Ovde nema niÅ¡ta zanimljivo.

### End-User Dashboard

Ovde moÅ¾ete pronaÄ‡i aplikacije koje su konfigurirane, ali Ä‡emo videti detalje o njima kasnije u drugom odeljku.

### Other

Zanimljivo podeÅ¡avanje, ali niÅ¡ta super zanimljivo iz perspektive bezbednosti.

## Applications

### Applications

Ovde moÅ¾ete pronaÄ‡i sve **konfigurisane aplikacije** i njihove detalje: Ko ima pristup njima, kako je konfigurisano (SAML, OpenID), URL za prijavu, mapiranja izmeÄ‘u Okta i aplikacije...

U **`Sign On`** tabu takoÄ‘e postoji polje pod nazivom **`Password reveal`** koje bi omoguÄ‡ilo korisniku da **otkrije svoju lozinku** prilikom provere podeÅ¡avanja aplikacije. Da biste proverili podeÅ¡avanja aplikacije iz korisniÄkog panela, kliknite na 3 taÄke:

<figure><img src="../../.gitbook/assets/image (283).png" alt=""><figcaption></figcaption></figure>

I mogli biste videti joÅ¡ neke detalje o aplikaciji (kao Å¡to je funkcija otkrivanja lozinke, ako je omoguÄ‡ena):

<figure><img src="../../.gitbook/assets/image (220).png" alt=""><figcaption></figcaption></figure>

## Identity Governance

### Access Certifications

Koristite Access Certifications za kreiranje revizorskih kampanja kako biste periodiÄno pregledali pristup vaÅ¡ih korisnika resursima i automatski odobrili ili opozvali pristup kada je to potrebno.

Nisam to video koriÅ¡Ä‡eno, ali pretpostavljam da je iz odbrambene taÄke glediÅ¡ta to lepa funkcija.

## Security

### General

* **Email obaveÅ¡tenja o bezbednosti**: Sva bi trebala biti omoguÄ‡ena.
* **CAPTCHA integracija**: PreporuÄuje se postavljanje barem nevidljivog reCaptche
* **Bezbednost organizacije**: Sve moÅ¾e biti omoguÄ‡eno i aktivacione email poruke ne bi trebale dugo trajati (7 dana je u redu)
* **Prevencija enumeracije korisnika**: Obe bi trebale biti omoguÄ‡ene
* Imajte na umu da Prevencija enumeracije korisnika ne stupa na snagu ako su dozvoljeni bilo koji od sledeÄ‡ih uslova (Pogledajte [User management](https://help.okta.com/oie/en-us/Content/Topics/users-groups-profiles/usgp-main.htm) za viÅ¡e informacija):
* Samostalna registracija
* JIT tokovi sa email autentifikacijom
* **Okta ThreatInsight podeÅ¡avanja**: ZabeleÅ¾ite i primenite bezbednost na osnovu nivoa pretnje

### HealthInsight

Ovde je moguÄ‡e pronaÄ‡i ispravno i **opasno** konfigurisane **postavke**.

### Authenticators

Ovde moÅ¾ete pronaÄ‡i sve metode autentifikacije koje korisnik moÅ¾e koristiti: Lozinka, telefon, email, kod, WebAuthn... Klikom na autentifikator lozinke moÅ¾ete videti **politiku lozinke**. Proverite da li je jaka.

U **Enrollment** tabu moÅ¾ete videti kako su one koje su obavezne ili opcione:

<figure><img src="../../.gitbook/assets/image (143).png" alt=""><figcaption></figcaption></figure>

PreporuÄuje se onemoguÄ‡avanje telefona. NajjaÄe su verovatno kombinacija lozinke, emaila i WebAuthn.

### Authentication policies

Svaka aplikacija ima politiku autentifikacije. Politika autentifikacije proverava da li korisnici koji pokuÅ¡avaju da se prijave u aplikaciju ispunjavaju odreÄ‘ene uslove, i primenjuje zahteve faktora na osnovu tih uslova.

Ovde moÅ¾ete pronaÄ‡i **zahteve za pristup svakoj aplikaciji**. PreporuÄuje se da se zahteva barem lozinka i joÅ¡ jedna metoda za svaku aplikaciju. Ali ako kao napadaÄ pronaÄ‘ete neÅ¡to slabije, moÅ¾da Ä‡ete moÄ‡i da napadnete to.

### Global Session Policy

Ovde moÅ¾ete pronaÄ‡i politike sesije dodeljene razliÄitim grupama. Na primer:

<figure><img src="../../.gitbook/assets/image (245).png" alt=""><figcaption></figcaption></figure>

PreporuÄuje se da se zahteva MFA, ograniÄi trajanje sesije na nekoliko sati, ne Äuvajte kolaÄiÄ‡e sesije preko ekstenzija pretraÅ¾ivaÄa i ograniÄite lokaciju i provajdera identiteta (ako je to moguÄ‡e). Na primer, ako svaki korisnik treba da se prijavi iz odreÄ‘ene zemlje, mogli biste dozvoliti samo tu lokaciju.

### Identity Providers

Provajderi identiteta (IdP) su usluge koje **upravljaju korisniÄkim nalozima**. Dodavanje IdP-a u Okta omoguÄ‡ava vaÅ¡im krajnjim korisnicima da se **samo registruju** sa vaÅ¡im prilagoÄ‘enim aplikacijama prvo autentifikovanjem sa druÅ¡tvenim nalogom ili pametnom karticom.

Na stranici Provajdera identiteta moÅ¾ete dodati druÅ¡tvene prijave (IdP) i konfigurisati Okta kao provajdera usluga (SP) dodavanjem ulaznog SAML-a. Nakon Å¡to dodate IdP, moÅ¾ete postaviti pravila usmeravanja da usmerite korisnike ka IdP-u na osnovu konteksta, kao Å¡to su lokacija korisnika, ureÄ‘aj ili email domena.

**Ako je bilo koji provajder identiteta konfiguran** iz perspektive napadaÄa i branioca proverite tu konfiguraciju i **da li je izvor zaista pouzdan** jer bi napadaÄ koji ga kompromituje mogao takoÄ‘e dobiti pristup Okta okruÅ¾enju.

### Delegated Authentication

Delegirana autentifikacija omoguÄ‡ava korisnicima da se prijave u Okta unosom kredencijala za **Active Directory (AD) ili LDAP** server njihove organizacije.

Ponovo, proverite ovo, jer bi napadaÄ koji kompromituje AD organizacije mogao biti u moguÄ‡nosti da se preusmeri na Okta zahvaljujuÄ‡i ovom podeÅ¡avanju.

### Network

MreÅ¾na zona je konfigurisiva granica koju moÅ¾ete koristiti da **dodelite ili ograniÄite pristup raÄunarima i ureÄ‘ajima** u vaÅ¡oj organizaciji na osnovu **IP adrese** koja traÅ¾i pristup. MoÅ¾ete definisati mreÅ¾nu zonu tako Å¡to Ä‡ete odrediti jednu ili viÅ¡e pojedinaÄnih IP adresa, opsega IP adresa ili geografskih lokacija.

Nakon Å¡to definiÅ¡ete jednu ili viÅ¡e mreÅ¾nih zona, moÅ¾ete **koristiti ih u Global Session Policies**, **politike autentifikacije**, VPN obaveÅ¡tenja i **pravila usmeravanja**.

Iz perspektive napadaÄa zanimljivo je znati koje IP adrese su dozvoljene (i proveriti da li su neke **IP adrese privilegovanije** od drugih). Iz perspektive napadaÄa, ako korisnici treba da pristupaju iz odreÄ‘ene IP adrese ili regiona, proverite da li se ova funkcija pravilno koristi.

### Device Integrations

* **Endpoint Management**: Upravljanje krajnjim taÄkama je uslov koji se moÅ¾e primeniti u politici autentifikacije kako bi se osiguralo da upravljani ureÄ‘aji imaju pristup aplikaciji.
* Nisam to joÅ¡ video. TODO
* **Notification services**: Nisam to joÅ¡ video. TODO

### API

MoÅ¾ete kreirati Okta API tokene na ovoj stranici, i videti one koji su **kreirani**, njihove **privilegije**, **vreme isteka** i **Izvorne URL adrese**. Imajte na umu da se API tokeni generiÅ¡u sa dozvolama korisnika koji je kreirao token i vaÅ¾e samo ako je **korisnik** koji ih je kreirao **aktivan**.

**Pouzdani izvori** omoguÄ‡avaju pristup veb sajtovima koje kontroliÅ¡ete i kojima verujete da pristupite vaÅ¡em Okta okruÅ¾enju putem Okta API-ja.

Ne bi trebalo da bude puno API tokena, jer ako ih ima, napadaÄ bi mogao pokuÅ¡ati da im pristupi i koristi ih.

## Workflow

### Automations

Automatizacije vam omoguÄ‡avaju da kreirate automatske akcije koje se pokreÄ‡u na osnovu skupa uslova okidaÄa koji se javljaju tokom Å¾ivotnog ciklusa krajnjih korisnika.

Na primer, uslov bi mogao biti "Neaktivnost korisnika u Okta" ili "Isticanje lozinke korisnika u Okta" i akcija bi mogla biti "PoÅ¡aljite email korisniku" ili "Promenite stanje Å¾ivotnog ciklusa korisnika u Okta".

## Reports

### Reports

Preuzmite logove. Oni se **Å¡alju** na **email adresu** trenutnog naloga.

### System Log

Ovde moÅ¾ete pronaÄ‡i **logove akcija koje su izvrÅ¡ili korisnici** sa puno detalja kao Å¡to su prijava u Okta ili u aplikacije putem Okta.

### Import Monitoring

Ovo moÅ¾e **uvoziti logove iz drugih platformi** kojima se pristupa putem Okta.

### Rate limits

Proverite dostignute API limite.

## Settings

### Account

Ovde moÅ¾ete pronaÄ‡i **opÅ¡te informacije** o Okta okruÅ¾enju, kao Å¡to su ime kompanije, adresa, **email kontakt za fakturiranje**, **email kontakt za tehniÄku podrÅ¡ku** i takoÄ‘e ko bi trebao da prima Okta aÅ¾uriranja i koje vrste Okta aÅ¾uriranja.

### Downloads

Ovde moÅ¾ete preuzeti Okta agente za sinhronizaciju Okta sa drugim tehnologijama.

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
