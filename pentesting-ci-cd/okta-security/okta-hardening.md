# Okta Hardening

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the**  [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter**  [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Directory

### People

Z perspektywy atakujcego, to jest bardzo interesujce, poniewa偶 bdziesz m贸g zobaczy **wszystkich zarejestrowanych u偶ytkownik贸w**, ich **adresy e-mail**, **grupy**, do kt贸rych nale偶, **profile** i nawet **urzdzenia** (telefony wraz z ich systemami operacyjnymi).

Dla przegldu whitebox sprawd藕, czy nie ma kilku "**Oczekujcych dziaa u偶ytkownika**" i "**Resetowania hasa**".

### Groups

Tutaj znajdziesz wszystkie utworzone grupy w Okta. Interesujce jest zrozumienie r贸偶nych grup (zestaw **uprawnie**), kt贸re mog by przyznane **u偶ytkownikom**.\
Mo偶liwe jest zobaczenie **os贸b w grupach** oraz **aplikacji przypisanych** do ka偶dej grupy.

Oczywicie, ka偶da grupa o nazwie **admin** jest interesujca, szczeg贸lnie grupa **Global Administrators**, sprawd藕 czonk贸w, aby dowiedzie si, kto jest najbardziej uprzywilejowany.

Z przegldu whitebox, nie **powinno by wicej ni偶 5 globalnych administrator贸w** (lepiej, jeli jest tylko 2 lub 3).

### Devices

Znajd藕 tutaj **list wszystkich urzdze** wszystkich u偶ytkownik贸w. Mo偶esz r贸wnie偶 zobaczy, czy jest **aktywnie zarzdzane**, czy nie.

### Profile Editor

Tutaj mo偶na zaobserwowa, jak kluczowe informacje, takie jak imiona, nazwiska, e-maile, nazwy u偶ytkownik贸w... s udostpniane midzy Okta a innymi aplikacjami. To jest interesujce, poniewa偶 jeli u偶ytkownik mo偶e **zmodyfikowa w Okta pole** (takie jak jego imi lub e-mail), kt贸re nastpnie jest u偶ywane przez **zewntrzn aplikacj** do **identyfikacji** u偶ytkownika, insider m贸gby spr贸bowa **przej inne konta**.

Ponadto, w profilu **`User (default)`** z Okta mo偶esz zobaczy **kt贸re pola** ka偶dy **u偶ytkownik** ma i kt贸re z nich s **edytowalne** przez u偶ytkownik贸w. Jeli nie mo偶esz zobaczy panelu administracyjnego, po prostu przejd藕 do **aktualizacji informacji o swoim profilu** i zobaczysz, kt贸re pola mo偶esz zaktualizowa (zauwa偶, 偶e aby zaktualizowa adres e-mail, musisz go zweryfikowa).

### Directory Integrations

Katalogi pozwalaj na importowanie os贸b z istniejcych 藕r贸de. Przypuszczam, 偶e tutaj zobaczysz u偶ytkownik贸w importowanych z innych katalog贸w.

Nie widziaem tego, ale przypuszczam, 偶e to jest interesujce, aby dowiedzie si o **innych katalogach, kt贸re Okta u偶ywa do importowania u偶ytkownik贸w**, wic jeli **skomprymujesz ten katalog**, m贸gby ustawi niekt贸re wartoci atrybut贸w w u偶ytkownikach utworzonych w Okta i **mo偶e skompromitowa rodowisko Okta**.

### Profile Sources

殴r贸do profilu to **aplikacja, kt贸ra dziaa jako 藕r贸do prawdy** dla atrybut贸w profilu u偶ytkownika. U偶ytkownik mo偶e by 藕r贸dowany tylko przez jedn aplikacj lub katalog w danym czasie.

Nie widziaem tego, wic wszelkie informacje o bezpieczestwie i hackingu dotyczce tej opcji s mile widziane.

## Customizations

### Brands

Sprawd藕 w zakadce **Domains** tej sekcji adresy e-mail u偶ywane do wysyania e-maili oraz niestandardow domen w Okta firmy (kt贸r prawdopodobnie ju偶 znasz).

Ponadto, w zakadce **Setting**, jeli jeste administratorem, mo偶esz "**U偶y niestandardowej strony wylogowania**" i ustawi niestandardowy adres URL.

### SMS

Nic interesujcego tutaj.

### End-User Dashboard

Mo偶esz tutaj znale藕 skonfigurowane aplikacje, ale szczeg贸y tych aplikacji zobaczymy p贸藕niej w innej sekcji.

### Other

Interesujce ustawienie, ale nic super interesujcego z punktu widzenia bezpieczestwa.

## Applications

### Applications

Tutaj mo偶esz znale藕 wszystkie **skonfigurowane aplikacje** i ich szczeg贸y: Kto ma do nich dostp, jak s skonfigurowane (SAML, OpenID), adres URL do logowania, mapowania midzy Okta a aplikacj...

W zakadce **`Sign On`** znajduje si r贸wnie偶 pole o nazwie **`Password reveal`**, kt贸re pozwala u偶ytkownikowi **ujawni swoje haso** podczas sprawdzania ustawie aplikacji. Aby sprawdzi ustawienia aplikacji z panelu u偶ytkownika, kliknij 3 kropki:

<figure><img src="../../.gitbook/assets/image (283).png" alt=""><figcaption></figcaption></figure>

I mo偶esz zobaczy wicej szczeg贸贸w o aplikacji (jak funkcja ujawniania hasa, jeli jest wczona):

<figure><img src="../../.gitbook/assets/image (220).png" alt=""><figcaption></figcaption></figure>

## Identity Governance

### Access Certifications

U偶yj certyfikacji dostpu, aby tworzy kampanie audytowe w celu okresowego przegldu dostpu u偶ytkownik贸w do zasob贸w i automatycznego zatwierdzania lub odbierania dostpu, gdy jest to wymagane.

Nie widziaem tego u偶ywanego, ale przypuszczam, 偶e z defensywnego punktu widzenia to adna funkcja.

## Security

### General

* **E-maile powiadomie o bezpieczestwie**: Wszystkie powinny by wczone.
* **Integracja CAPTCHA**: Zaleca si ustawienie przynajmniej niewidocznego reCaptcha
* **Bezpieczestwo organizacji**: Wszystko mo偶e by wczone, a e-maile aktywacyjne nie powinny trwa dugo (7 dni jest w porzdku)
* **Zapobieganie enumeracji u偶ytkownik贸w**: Oba powinny by wczone
* Zauwa偶, 偶e zapobieganie enumeracji u偶ytkownik贸w nie ma zastosowania, jeli kt贸rakolwiek z poni偶szych warunk贸w jest dozwolona (zobacz [Zarzdzanie u偶ytkownikami](https://help.okta.com/oie/en-us/Content/Topics/users-groups-profiles/usgp-main.htm) po wicej informacji):
* Rejestracja samoobsugowa
* Przepywy JIT z uwierzytelnianiem e-mailowym
* **Ustawienia Okta ThreatInsight**: Rejestruj i egzekwuj bezpieczestwo w oparciu o poziom zagro偶enia

### HealthInsight

Tutaj mo偶na znale藕 poprawnie i **niebezpiecznie** skonfigurowane **ustawienia**.

### Authenticators

Tutaj mo偶esz znale藕 wszystkie metody uwierzytelniania, kt贸re u偶ytkownik m贸gby u偶y: Haso, telefon, e-mail, kod, WebAuthn... Klikajc w uwierzytelnianie hasem, mo偶esz zobaczy **polityk hase**. Sprawd藕, czy jest silna.

W zakadce **Enrollment** mo偶esz zobaczy, kt贸re z nich s wymagane lub opcjonalne:

<figure><img src="../../.gitbook/assets/image (143).png" alt=""><figcaption></figcaption></figure>

Zaleca si wyczenie telefonu. Najsilniejsze s prawdopodobnie kombinacje hasa, e-maila i WebAuthn.

### Authentication policies

Ka偶da aplikacja ma polityk uwierzytelniania. Polityka uwierzytelniania weryfikuje, 偶e u偶ytkownicy, kt贸rzy pr贸buj zalogowa si do aplikacji, speniaj okrelone warunki, i egzekwuje wymagania dotyczce czynnik贸w w oparciu o te warunki.

Tutaj mo偶esz znale藕 **wymagania dostpu do ka偶dej aplikacji**. Zaleca si 偶danie przynajmniej hasa i innej metody dla ka偶dej aplikacji. Ale jeli jako atakujcy znajdziesz co sabszego, mo偶esz by w stanie to zaatakowa.

### Global Session Policy

Tutaj mo偶esz znale藕 polityki sesji przypisane do r贸偶nych grup. Na przykad:

<figure><img src="../../.gitbook/assets/image (245).png" alt=""><figcaption></figcaption></figure>

Zaleca si 偶danie MFA, ograniczenie czasu trwania sesji do kilku godzin, nie utrzymywanie ciasteczek sesyjnych w rozszerzeniach przegldarki oraz ograniczenie lokalizacji i dostawcy to偶samoci (jeli to mo偶liwe). Na przykad, jeli ka偶dy u偶ytkownik powinien logowa si z danego kraju, mo偶esz zezwoli tylko na t lokalizacj.

### Identity Providers

Dostawcy to偶samoci (IdP) to usugi, kt贸re **zarzdzaj kontami u偶ytkownik贸w**. Dodanie IdP w Okta umo偶liwia Twoim u偶ytkownikom **samo-rejestracj** w Twoich niestandardowych aplikacjach, najpierw uwierzytelniajc si za pomoc konta spoecznociowego lub karty inteligentnej.

Na stronie dostawc贸w to偶samoci mo偶esz doda loginy spoecznociowe (IdP) i skonfigurowa Okta jako dostawc usug (SP) poprzez dodanie SAML przychodzcego. Po dodaniu IdP mo偶esz ustawi zasady routingu, aby kierowa u偶ytkownik贸w do IdP w oparciu o kontekst, taki jak lokalizacja u偶ytkownika, urzdzenie lub domena e-mailowa.

**Jeli jakikolwiek dostawca to偶samoci jest skonfigurowany**, z perspektywy atakujcego i obrocy sprawd藕 t konfiguracj i **czy 藕r贸do jest naprawd godne zaufania**, poniewa偶 atakujcy, kt贸ry je skompromituje, m贸gby r贸wnie偶 uzyska dostp do rodowiska Okta.

### Delegated Authentication

Uwierzytelnianie delegowane pozwala u偶ytkownikom logowa si do Okta, wprowadzajc dane uwierzytelniajce dla serwera **Active Directory (AD) lub LDAP** swojej organizacji.

Ponownie, sprawd藕 to, poniewa偶 atakujcy, kt贸ry skompromituje AD organizacji, m贸gby by w stanie przej do Okta dziki temu ustawieniu.

### Network

Strefa sieciowa to konfigurowalna granica, kt贸r mo偶esz u偶y do **przyznawania lub ograniczania dostpu do komputer贸w i urzdze** w Twojej organizacji w oparciu o **adres IP**, kt贸ry 偶da dostpu. Mo偶esz zdefiniowa stref sieciow, okrelajc jeden lub wicej indywidualnych adres贸w IP, zakresy adres贸w IP lub lokalizacje geograficzne.

Po zdefiniowaniu jednej lub wicej stref sieciowych mo偶esz **u偶y ich w globalnych politykach sesji**, **politykach uwierzytelniania**, powiadomieniach VPN i **zasadach routingu**.

Z perspektywy atakujcego interesujce jest wiedzie, kt贸re IP s dozwolone (i sprawdzi, czy jakie **IP s bardziej uprzywilejowane** ni偶 inne). Z perspektywy atakujcego, jeli u偶ytkownicy powinni uzyskiwa dostp z konkretnego adresu IP lub regionu, sprawd藕, czy ta funkcja jest u偶ywana prawidowo.

### Device Integrations

* **Zarzdzanie punktami kocowymi**: Zarzdzanie punktami kocowymi to warunek, kt贸ry mo偶na zastosowa w polityce uwierzytelniania, aby zapewni, 偶e zarzdzane urzdzenia maj dostp do aplikacji.
* Nie widziaem tego jeszcze u偶ywanego. TODO
* **Usugi powiadomie**: Nie widziaem tego jeszcze u偶ywanego. TODO

### API

Mo偶esz tworzy tokeny API Okta na tej stronie i zobaczy te, kt贸re zostay **utworzone**, ich **uprawnienia**, czas **wyganicia** i **adresy URL 藕r贸dowe**. Zauwa偶, 偶e tokeny API s generowane z uprawnieniami u偶ytkownika, kt贸ry utworzy token i s wa偶ne tylko wtedy, gdy **u偶ytkownik**, kt贸ry je utworzy, jest **aktywny**.

**Zaufane 藕r贸da** przyznaj dostp do witryn, kt贸re kontrolujesz i ufasz, aby uzyska dostp do swojej organizacji Okta za porednictwem API Okta.

Nie powinno by zbyt wielu token贸w API, poniewa偶 jeli ich jest du偶o, atakujcy m贸gby spr贸bowa uzyska do nich dostp i je wykorzysta.

## Workflow

### Automations

Automatyzacje pozwalaj na tworzenie automatycznych dziaa, kt贸re s uruchamiane na podstawie zestawu warunk贸w wyzwalajcych, kt贸re wystpuj w trakcie cyklu 偶ycia u偶ytkownik贸w kocowych.

Na przykad warunkiem mo偶e by "Nieaktywno u偶ytkownika w Okta" lub "Wygasanie hasa u偶ytkownika w Okta", a dziaaniem mo偶e by "Wylij e-mail do u偶ytkownika" lub "Zmie stan cyklu 偶ycia u偶ytkownika w Okta".

## Reports

### Reports

Pobierz logi. S **wysyane** na **adres e-mail** bie偶cego konta.

### System Log

Tutaj mo偶esz znale藕 **logi dziaa wykonywanych przez u偶ytkownik贸w** z wieloma szczeg贸ami, takimi jak logowanie do Okta lub aplikacji przez Okta.

### Import Monitoring

To mo偶e **importowa logi z innych platform** uzyskanych za pomoc Okta.

### Rate limits

Sprawd藕 osignite limity szybkoci API.

## Settings

### Account

Tutaj mo偶esz znale藕 **og贸lne informacje** o rodowisku Okta, takie jak nazwa firmy, adres, **kontakt e-mail do rozlicze**, **kontakt e-mail do spraw technicznych** oraz kto powinien otrzymywa aktualizacje Okta i jakie rodzaje aktualizacji Okta.

### Downloads

Tutaj mo偶esz pobra agent贸w Okta, aby zsynchronizowa Okta z innymi technologiami.

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the**  [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter**  [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
