# Okta Hardening

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Directory

### People

Sa perspektive napadaÄa, ovo je veoma interesantno jer moÅ¾ete videti **sve registrovane korisnike**, njihove **email** adrese, **grupe** kojima pripadaju, **profile** pa Äak i **ureÄ‘aje** (mobilne telefone zajedno sa njihovim operativnim sistemima).

Za whitebox pregled proverite da nema nekoliko "**Pending user action**" i "**Password reset**".

### Groups

Ovde moÅ¾ete pronaÄ‡i sve kreirane grupe u Okta. Interesantno je razumeti razliÄite grupe (set **dozvola**) koje mogu biti dodeljene **korisnicima**.\
MoguÄ‡e je videti **ljude ukljuÄene u grupe** i **aplikacije dodeljene** svakoj grupi.

Naravno, svaka grupa sa imenom **admin** je interesantna, posebno grupa **Global Administrators,** proverite Älanove da biste saznali ko su najprivilegovaniji Älanovi.

Za whitebox pregled, ne bi trebalo da bude viÅ¡e od 5 globalnih admina (bolje ako ih ima samo 2 ili 3).

### Devices

Ovde pronaÄ‘ite **listu svih ureÄ‘aja** svih korisnika. TakoÄ‘e moÅ¾ete videti da li se **aktivno upravlja** ili ne.

### Profile Editor

Ovde je moguÄ‡e posmatrati kako se kljuÄne informacije kao Å¡to su imena, prezimena, emailovi, korisniÄka imena... dele izmeÄ‘u Okta i drugih aplikacija. Ovo je interesantno jer ako korisnik moÅ¾e **modifikovati polje u Okta** (kao Å¡to je njegovo ime ili email) koje se zatim koristi od strane **eksterne aplikacije** za **identifikaciju** korisnika, insajder bi mogao pokuÅ¡ati da **preuzme druge naloge**.

Å taviÅ¡e, u profilu **`User (default)`** iz Okta moÅ¾ete videti **koja polja** svaki **korisnik** ima i koja su **pisljiva** od strane korisnika. Ako ne moÅ¾ete videti admin panel, samo idite na **aÅ¾uriranje vaÅ¡eg profila** i videÄ‡ete koja polja moÅ¾ete aÅ¾urirati (imajte na umu da za aÅ¾uriranje email adrese morate je verifikovati).

### Directory Integrations

Direktorijumi vam omoguÄ‡avaju da uvezete ljude iz postojeÄ‡ih izvora. Pretpostavljam da ovde moÅ¾ete videti korisnike uvezene iz drugih direktorijuma.

Nisam to video, ali pretpostavljam da je interesantno saznati **druge direktorijume koje Okta koristi za uvoz korisnika** pa ako **kompromitujete taj direktorijum** mogli biste postaviti vrednosti atributa u korisnicima kreiranim u Okta i **moÅ¾da kompromitovati Okta okruÅ¾enje**.

### Profile Sources

Izvor profila je **aplikacija koja deluje kao izvor istine** za atribute korisniÄkog profila. Korisnik moÅ¾e biti izvor samo jedne aplikacije ili direktorijuma u jednom trenutku.

Nisam to video, pa su sve informacije o sigurnosti i hakovanju u vezi sa ovom opcijom dobrodoÅ¡le.

## Customizations

### Brands

Proverite u kartici **Domains** ovog odeljka email adrese koje se koriste za slanje emailova i prilagoÄ‘eni domen unutar Okta kompanije (koji verovatno veÄ‡ znate).

Å taviÅ¡e, u kartici **Setting**, ako ste admin, moÅ¾ete "**Use a custom sign-out page**" i postaviti prilagoÄ‘eni URL.

### SMS

NiÅ¡ta interesantno ovde.

### End-User Dashboard

Ovde moÅ¾ete pronaÄ‡i konfigurirane aplikacije, ali detalje Ä‡emo videti kasnije u drugom odeljku.

### Other

Interesantna postavka, ali niÅ¡ta super interesantno sa sigurnosne taÄke glediÅ¡ta.

## Applications

### Applications

Ovde moÅ¾ete pronaÄ‡i sve **konfigurisane aplikacije** i njihove detalje: Ko ima pristup njima, kako je konfigurisano (SAML, OPenID), URL za prijavu, mapiranja izmeÄ‘u Okta i aplikacije...

U kartici **`Sign On`** postoji i polje pod nazivom **`Password reveal`** koje bi omoguÄ‡ilo korisniku da **otkrije svoju lozinku** kada proverava postavke aplikacije. Da biste proverili postavke aplikacije iz korisniÄkog panela, kliknite na 3 taÄke:

<figure><img src="../../.gitbook/assets/image (283).png" alt=""><figcaption></figcaption></figure>

I mogli biste videti joÅ¡ neke detalje o aplikaciji (kao Å¡to je funkcija otkrivanja lozinke, ako je omoguÄ‡ena):

<figure><img src="../../.gitbook/assets/image (220).png" alt=""><figcaption></figcaption></figure>

## Identity Governance

### Access Certifications

Koristite Access Certifications za kreiranje kampanja za reviziju kako biste periodiÄno pregledali pristup korisnika resursima i automatski odobrili ili opozvali pristup kada je to potrebno.

Nisam video da se koristi, ali pretpostavljam da je sa defanzivne taÄke glediÅ¡ta to lepa funkcija.

## Security

### General

* **Security notification emails**: Sve bi trebalo da budu omoguÄ‡ene.
* **CAPTCHA integration**: PreporuÄuje se postavljanje barem nevidljivog reCaptcha
* **Organization Security**: Sve moÅ¾e biti omoguÄ‡eno i emailovi za aktivaciju ne bi trebalo da traju dugo (7 dana je ok)
* **User enumeration prevention**: Obe bi trebalo da budu omoguÄ‡ene
* Imajte na umu da User Enumeration Prevention ne stupa na snagu ako je bilo koji od sledeÄ‡ih uslova dozvoljen (Pogledajte [User management](https://help.okta.com/oie/en-us/Content/Topics/users-groups-profiles/usgp-main.htm) za viÅ¡e informacija):
* Self-Service Registration
* JIT flows with email authentication
* **Okta ThreatInsight settings**: BeleÅ¾i i sprovodi sigurnost na osnovu nivoa pretnje

### HealthInsight

Ovde je moguÄ‡e pronaÄ‡i pravilno i **opasno** konfigurisane **postavke**.

### Authenticators

Ovde moÅ¾ete pronaÄ‡i sve metode autentifikacije koje korisnik moÅ¾e koristiti: Lozinka, telefon, email, kod, WebAuthn... Klikom na autentifikator lozinke moÅ¾ete videti **politiku lozinki**. Proverite da li je jaka.

U kartici **Enrollment** moÅ¾ete videti koje su obavezne ili opcionalne:

<figure><img src="../../.gitbook/assets/image (143).png" alt=""><figcaption></figcaption></figure>

PreporuÄuje se onemoguÄ‡avanje telefona. NajjaÄe su verovatno kombinacija lozinke, emaila i WebAuthn.

### Authentication policies

Svaka aplikacija ima politiku autentifikacije. Politika autentifikacije proverava da li korisnici koji pokuÅ¡avaju da se prijave u aplikaciju ispunjavaju odreÄ‘ene uslove i sprovodi zahteve za faktore na osnovu tih uslova.

Ovde moÅ¾ete pronaÄ‡i **zahteve za pristup svakoj aplikaciji**. PreporuÄuje se zahtevati barem lozinku i joÅ¡ jednu metodu za svaku aplikaciju. Ali ako kao napadaÄ pronaÄ‘ete neÅ¡to slabije, mogli biste to napasti.

### Global Session Policy

Ovde moÅ¾ete pronaÄ‡i politike sesija dodeljene razliÄitim grupama. Na primer:

<figure><img src="../../.gitbook/assets/image (245).png" alt=""><figcaption></figcaption></figure>

PreporuÄuje se zahtevati MFA, ograniÄiti trajanje sesije na nekoliko sati, ne Äuvati kolaÄiÄ‡e sesije preko ekstenzija pretraÅ¾ivaÄa i ograniÄiti lokaciju i Identity Provider (ako je to moguÄ‡e). Na primer, ako bi svaki korisnik trebalo da se prijavi iz odreÄ‘ene zemlje, mogli biste dozvoliti samo tu lokaciju.

### Identity Providers

Identity Providers (IdPs) su usluge koje **upravljaju korisniÄkim nalozima**. Dodavanje IdPs u Okta omoguÄ‡ava vaÅ¡im krajnjim korisnicima da se **sami registruju** sa vaÅ¡im prilagoÄ‘enim aplikacijama prvo se autentifikujuÄ‡i sa druÅ¡tvenim nalogom ili pametnom karticom.

Na stranici Identity Providers, moÅ¾ete dodati druÅ¡tvene prijave (IdPs) i konfigurisati Okta kao pruÅ¾aoca usluga (SP) dodavanjem dolaznog SAML-a. Nakon Å¡to dodate IdPs, moÅ¾ete postaviti pravila usmeravanja da usmerite korisnike na IdP na osnovu konteksta, kao Å¡to su lokacija korisnika, ureÄ‘aj ili email domen.

**Ako je bilo koji identity provider konfigurisano** sa perspektive napadaÄa i branioca proverite tu konfiguraciju i **da li je izvor zaista pouzdan** jer napadaÄ koji ga kompromituje mogao bi takoÄ‘e dobiti pristup Okta okruÅ¾enju.

### Delegated Authentication

Delegated authentication omoguÄ‡ava korisnicima da se prijave u Okta unosom kredencijala za **Active Directory (AD) ili LDAP** server svoje organizacije.

Opet, ponovo proverite ovo, jer napadaÄ koji kompromituje AD organizacije mogao bi zahvaljujuÄ‡i ovoj postavci pivotirati na Okta.

### Network

MreÅ¾na zona je konfigurisana granica koju moÅ¾ete koristiti za **dodeljivanje ili ograniÄavanje pristupa raÄunarima i ureÄ‘ajima** u vaÅ¡oj organizaciji na osnovu **IP adrese** koja zahteva pristup. MoÅ¾ete definisati mreÅ¾nu zonu specificiranjem jedne ili viÅ¡e pojedinaÄnih IP adresa, opsega IP adresa ili geografskih lokacija.

Nakon Å¡to definiÅ¡ete jednu ili viÅ¡e mreÅ¾nih zona, moÅ¾ete ih **koristiti u Global Session Policies**, **authentication policies**, VPN obaveÅ¡tenjima i **pravilima usmeravanja**.

Sa perspektive napadaÄa interesantno je znati koje IP adrese su dozvoljene (i proveriti da li su neke **IP adrese privilegovanije** od drugih). Sa perspektive napadaÄa, ako bi korisnici trebalo da pristupaju sa odreÄ‘ene IP adrese ili regiona, proverite da li se ova funkcija pravilno koristi.

### Device Integrations

* **Endpoint Management**: Upravljanje krajnjim taÄkama je uslov koji se moÅ¾e primeniti u politici autentifikacije kako bi se osiguralo da upravljani ureÄ‘aji imaju pristup aplikaciji.
* Nisam video da se ovo koristi. TODO
* **Notification services**: Nisam video da se ovo koristi. TODO

### API

MoÅ¾ete kreirati Okta API tokene na ovoj stranici i videti one koji su **kreirani**, njihove **privilegije**, **vreme isteka** i **Origin URLs**. Imajte na umu da se API tokeni generiÅ¡u sa dozvolama korisnika koji je kreirao token i vaÅ¾e samo ako je **korisnik** koji ih je kreirao **aktivan**.

**Trusted Origins** omoguÄ‡avaju pristup web sajtovima koje kontroliÅ¡ete i kojima verujete da pristupe vaÅ¡oj Okta organizaciji putem Okta API-ja.

Ne bi trebalo da bude mnogo API tokena, jer ako ih ima, napadaÄ bi mogao pokuÅ¡ati da im pristupi i koristi ih.

## Workflow

### Automations

Automations vam omoguÄ‡avaju da kreirate automatizovane akcije koje se pokreÄ‡u na osnovu skupa uslova okidaÄa koji se javljaju tokom Å¾ivotnog ciklusa krajnjih korisnika.

Na primer, uslov moÅ¾e biti "User inactivity in Okta" ili "User password expiration in Okta" a akcija moÅ¾e biti "Send email to the user" ili "Change user lifecycle state in Okta".

## Reports

### Reports

Preuzmite logove. Oni se **Å¡alju** na **email adresu** trenutnog naloga.

### System Log

Ovde moÅ¾ete pronaÄ‡i **logove akcija koje su izvrÅ¡ili korisnici** sa puno detalja kao Å¡to su prijava u Okta ili u aplikacije putem Okta.

### Import Monitoring

Ovo moÅ¾e **uvoziti logove sa drugih platformi** kojima se pristupa putem Okta.

### Rate limits

Proverite dostignute API rate limits.

## Settings

### Account

Ovde moÅ¾ete pronaÄ‡i **generiÄke informacije** o Okta okruÅ¾enju, kao Å¡to su ime kompanije, adresa, **email za naplatu**, **email za tehniÄki kontakt** i takoÄ‘e ko bi trebalo da prima Okta aÅ¾uriranja i koja vrsta Okta aÅ¾uriranja.

### Downloads

Ovde moÅ¾ete preuzeti Okta agente za sinhronizaciju Okta sa drugim tehnologijama.

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
