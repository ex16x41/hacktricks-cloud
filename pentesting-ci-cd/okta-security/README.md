# Okta Security

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Basic Information

[Okta, Inc.](https://www.okta.com/) je prepoznata u sektoru upravljanja identitetom i pristupom zbog svojih reÅ¡enja zasnovanih na oblaku. Ova reÅ¡enja su dizajnirana da pojednostave i osiguraju autentifikaciju korisnika kroz razliÄite moderne aplikacije. Ona su namenjena ne samo kompanijama koje Å¾ele da zaÅ¡tite svoje osetljive podatke, veÄ‡ i programerima zainteresovanim za integraciju kontrola identiteta u aplikacije, veb usluge i ureÄ‘aje.

Glavna ponuda Okta je **Okta Identity Cloud**. Ova platforma obuhvata paket proizvoda, ukljuÄujuÄ‡i, ali ne ograniÄavajuÄ‡i se na:

* **Single Sign-On (SSO)**: Pojednostavljuje pristup korisnika omoguÄ‡avajuÄ‡i jedan set prijavnih podataka za viÅ¡e aplikacija.
* **Multi-Factor Authentication (MFA)**: PoveÄ‡ava sigurnost zahtevajuÄ‡i viÅ¡e oblika verifikacije.
* **Lifecycle Management**: Automatizuje procese kreiranja, aÅ¾uriranja i deaktivacije korisniÄkih naloga.
* **Universal Directory**: OmoguÄ‡ava centralizovano upravljanje korisnicima, grupama i ureÄ‘ajima.
* **API Access Management**: Osigurava i upravlja pristupom API-ima.

Ove usluge zajedniÄki imaju za cilj jaÄanje zaÅ¡tite podataka i pojednostavljenje pristupa korisnicima, poboljÅ¡avajuÄ‡i i sigurnost i pogodnost. Svestranost Okta reÅ¡enja Äini ih popularnim izborom u razliÄitim industrijama, korisnim za velike preduzeÄ‡a, male kompanije i pojedinaÄne programere. Na poslednjem aÅ¾uriranju u septembru 2021. godine, Okta je priznata kao istaknuta entitet u oblasti upravljanja identitetom i pristupom (IAM).

{% hint style="danger" %}
Glavni cilj Okta je da konfiguriÅ¡e pristup razliÄitim korisnicima i grupama za spoljne aplikacije. Ako uspete da **kompromitujete administratorske privilegije u Okta** okruÅ¾enju, verovatno Ä‡ete moÄ‡i da **kompromitujete sve druge platforme koje kompanija koristi**.
{% endhint %}

{% hint style="success" %}
Da biste izvrÅ¡ili bezbednosni pregled Okta okruÅ¾enja, trebali biste zatraÅ¾iti **administratorski pristup samo za Äitanje**.
{% endhint %}

### Summary

Postoje **korisnici** (koji mogu biti **smeÅ¡teni u Okta,** prijavljeni iz konfigurisanih **provajdera identiteta** ili autentifikovani putem **Active Directory** ili LDAP).\
Ovi korisnici mogu biti unutar **grupa**.\
TakoÄ‘e postoje **autentifikatori**: razliÄite opcije za autentifikaciju kao Å¡to su lozinka, i nekoliko 2FA kao Å¡to su WebAuthn, email, telefon, okta verify (mogu biti omoguÄ‡eni ili onemoguÄ‡eni)...

Zatim, postoje **aplikacije** sinhronizovane sa Okta. Svaka aplikacija Ä‡e imati neku **mapu sa Okta** za deljenje informacija (kao Å¡to su email adrese, imena...). Å taviÅ¡e, svaka aplikacija mora biti unutar **Politike autentifikacije**, koja oznaÄava **potrebne autentifikatore** za korisnika da **pristupi** aplikaciji.

{% hint style="danger" %}
NajmoÄ‡nija uloga je **Super Administrator**.

Ako napadaÄ kompromituje Okta sa administratorskim pristupom, sve **aplikacije koje veruju Okta** Ä‡e verovatno biti **kompromitovane**.
{% endhint %}

## Attacks

### Locating Okta Portal

ObiÄno Ä‡e portal kompanije biti lociran na **companyname.okta.com**. Ako nije, pokuÅ¡ajte jednostavne **varijacije** od **companyname.** Ako ne moÅ¾ete da ga pronaÄ‘ete, takoÄ‘e je moguÄ‡e da organizacija ima **CNAME** zapis kao **`okta.companyname.com`** koji upuÄ‡uje na **Okta portal**.

### Login in Okta via Kerberos

Ako je **`companyname.kerberos.okta.com`** aktivan, **Kerberos se koristi za pristup Okta**, obiÄno zaobiÄ‡i **MFA** za **Windows** korisnike. Da biste pronaÅ¡li Kerberos-autentifikovane Okta korisnike u AD, pokrenite **`getST.py`** sa **odgovarajuÄ‡im parametrima**. Nakon dobijanja **AD korisniÄkog tiketa**, **ubacite** ga u kontrolisani host koristeÄ‡i alate kao Å¡to su Rubeus ili Mimikatz, osiguravajuÄ‡i da je **`clientname.kerberos.okta.com` u "Intranet" zoni Internet opcija**. Pristup odreÄ‘enom URL-u trebao bi da vrati JSON "OK" odgovor, Å¡to ukazuje na prihvatanje Kerberos tiketa, i omoguÄ‡ava pristup Okta kontrolnoj tabli.

Kompromitovanje **Okta servisnog naloga sa delegacijom SPN omoguÄ‡ava Silver Ticket napad.** MeÄ‘utim, koriÅ¡Ä‡enje **AES** za enkripciju tiketa zahteva posedovanje AES kljuÄa ili plaintext lozinke. Koristite **`ticketer.py` da generiÅ¡ete tiket za Å¾rtvovanog korisnika** i isporuÄite ga putem pregledaÄa za autentifikaciju sa Okta.

**Proverite napad u** [**https://trustedsec.com/blog/okta-for-red-teamers**](https://trustedsec.com/blog/okta-for-red-teamers)**.**

### Hijacking Okta AD Agent

Ova tehnika ukljuÄuje **pristupanje Okta AD Agent-u na serveru**, koji **sinhronizuje korisnike i upravlja autentifikacijom**. IstraÅ¾ivanjem i dekripcijom konfiguracija u **`OktaAgentService.exe.config`**, posebno AgentToken koristeÄ‡i **DPAPI**, napadaÄ moÅ¾e potencijalno **presresti i manipulisati podacima o autentifikaciji**. Ovo omoguÄ‡ava ne samo **praÄ‡enje** i **hvatanje korisniÄkih podataka** u plaintext-u tokom Okta procesa autentifikacije, veÄ‡ i **odgovaranje na pokuÅ¡aje autentifikacije**, Äime se omoguÄ‡ava neovlaÅ¡Ä‡en pristup ili pruÅ¾anje univerzalne autentifikacije kroz Okta (sliÄno 'skeleton key').

**Proverite napad u** [**https://trustedsec.com/blog/okta-for-red-teamers**](https://trustedsec.com/blog/okta-for-red-teamers)**.**

### Hijacking AD As an Admin

Ova tehnika ukljuÄuje otmicu Okta AD Agent-a prvo dobijanjem OAuth koda, a zatim zahtevom za API token. Token je povezan sa AD domenom, a **konektor je imenovan da uspostavi laÅ¾ni AD agent**. Inicijalizacija omoguÄ‡ava agentu da **obraÄ‘uje pokuÅ¡aje autentifikacije**, hvatajuÄ‡i kredencijale putem Okta API-ja. Alati za automatizaciju su dostupni za pojednostavljenje ovog procesa, nudeÄ‡i besprekornu metodu za presretanje i rukovanje podacima o autentifikaciji unutar Okta okruÅ¾enja.

**Proverite napad u** [**https://trustedsec.com/blog/okta-for-red-teamers**](https://trustedsec.com/blog/okta-for-red-teamers)**.**

### Okta Fake SAML Provider

**Proverite napad u** [**https://trustedsec.com/blog/okta-for-red-teamers**](https://trustedsec.com/blog/okta-for-red-teamers)**.**

Tehnika ukljuÄuje **implementaciju laÅ¾nog SAML provajdera**. Integracijom spoljnog provajdera identiteta (IdP) unutar Okta okvira koristeÄ‡i privilegovani nalog, napadaÄi mogu **kontrolisati IdP, odobravajuÄ‡i bilo koji zahtev za autentifikaciju po Å¾elji**. Proces podrazumeva postavljanje SAML 2.0 IdP u Okta, manipulaciju IdP Single Sign-On URL-om za preusmeravanje putem lokalnog hosts fajla, generisanje samopotpisanog sertifikata i konfiguraciju Okta postavki da se podudaraju sa korisniÄkim imenom ili email-om. UspeÅ¡no izvrÅ¡avanje ovih koraka omoguÄ‡ava autentifikaciju kao bilo koji Okta korisnik, zaobilazeÄ‡i potrebu za pojedinaÄnim korisniÄkim podacima, znaÄajno poveÄ‡avajuÄ‡i kontrolu pristupa na potencijalno neprimetan naÄin.

### Phishing Okta Portal with Evilgnix

U [**ovom blog postu**](https://medium.com/nickvangilder/okta-for-red-teamers-perimeter-edition-c60cb8d53f23) objaÅ¡njeno je kako pripremiti phishing kampanju protiv Okta portala.

### Colleague Impersonation Attack

**atributi koje svaki korisnik moÅ¾e imati i modifikovati** (kao Å¡to su email ili ime) mogu se konfigurisati u Okta. Ako je **aplikacija** **verujuÄ‡a** kao ID **atributu** koji korisnik moÅ¾e **modifikovati**, moÄ‡i Ä‡e da **imituje druge korisnike na toj platformi**.

Stoga, ako aplikacija veruje polju **`userName`**, verovatno neÄ‡ete moÄ‡i da ga promenite (jer obiÄno ne moÅ¾ete promeniti to polje), ali ako veruje na primer **`primaryEmail`** moÅ¾da Ä‡ete moÄ‡i da **promenite na email adresu kolege** i imitirati ga (trebaÄ‡e vam pristup email-u i da prihvatite promenu).

Napomena da ova imitacija zavisi od toga kako je svaka aplikacija konfigurisana. Samo one koje veruju polju koje ste modifikovali i prihvataju aÅ¾uriranja Ä‡e biti kompromitovane.\
Stoga, aplikacija treba da ima ovo polje omoguÄ‡eno ako postoji:

<figure><img src="../../.gitbook/assets/image (175).png" alt=""><figcaption></figcaption></figure>

TakoÄ‘e sam video druge aplikacije koje su bile ranjive, ali nisu imale to polje u Okta postavkama (na kraju, razliÄite aplikacije su konfigurisane razliÄito).

Najbolji naÄin da saznate da li moÅ¾ete imitirati nekoga na svakoj aplikaciji bio bi da probate!

## Evading behavioural detection policies <a href="#id-9fde" id="id-9fde"></a>

Policije detekcije ponaÅ¡anja u Okta mogu biti nepoznate dok se ne susretnete s njima, ali **zaobilaÅ¾enje** njih moÅ¾e se postiÄ‡i **usmeravanjem direktno na Okta aplikacije**, izbegavajuÄ‡i glavnu Okta kontrolnu tablu. Sa **Okta pristupnim tokenom**, ponovo upotrebite token na **URL-u specifiÄnom za aplikaciju Okta** umesto na glavnoj stranici za prijavu.

KljuÄne preporuke ukljuÄuju:

* **Izbegavajte koriÅ¡Ä‡enje** popularnih anonimnih proksija i VPN usluga prilikom ponovnog koriÅ¡Ä‡enja uhvaÄ‡enih pristupnih tokena.
* Osigurajte **dosledne korisniÄke agente** izmeÄ‘u klijenta i ponovo koriÅ¡Ä‡enih pristupnih tokena.
* **Izbegavajte ponovo koriÅ¡Ä‡enje** tokena od razliÄitih korisnika sa iste IP adrese.
* Budite oprezni prilikom ponovnog koriÅ¡Ä‡enja tokena protiv Okta kontrolne table.
* Ako ste svesni IP adresa kompanije Å¾rtve, **ograniÄite saobraÄ‡aj** na te IP adrese ili njihov opseg, blokirajuÄ‡i sav ostali saobraÄ‡aj.

## Okta Hardening

Okta ima mnogo moguÄ‡ih konfiguracija, na ovoj stranici Ä‡ete pronaÄ‡i kako da ih pregledate kako bi bile Å¡to sigurnije:

{% content-ref url="okta-hardening.md" %}
[okta-hardening.md](okta-hardening.md)
{% endcontent-ref %}

## References

* [https://trustedsec.com/blog/okta-for-red-teamers](https://trustedsec.com/blog/okta-for-red-teamers)
* [https://medium.com/nickvangilder/okta-for-red-teamers-perimeter-edition-c60cb8d53f23](https://medium.com/nickvangilder/okta-for-red-teamers-perimeter-edition-c60cb8d53f23)

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
