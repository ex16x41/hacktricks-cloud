# Okta GÃ¼venliÄŸi

{% hint style="success" %}
AWS Hacking Ã¶ÄŸrenin ve pratik yapÄ±n:<img src="../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks EÄŸitim AWS KÄ±rmÄ±zÄ± Ekip UzmanÄ± (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/image (1).png" alt="" data-size="line">\
GCP Hacking Ã¶ÄŸrenin ve pratik yapÄ±n: <img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks EÄŸitim GCP KÄ±rmÄ±zÄ± Ekip UzmanÄ± (GRTE)**<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**abonelik planlarÄ±nÄ±**](https://github.com/sponsors/carlospolop) kontrol edin!
* **ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n ya da **Twitter'da** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** bizi takip edin.**
* **Hacking ipuÃ§larÄ±nÄ± paylaÅŸmak iÃ§in** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna PR gÃ¶nderin.

</details>
{% endhint %}

## Temel Bilgiler

[Okta, Inc.](https://www.okta.com/) kimlik ve eriÅŸim yÃ¶netimi sektÃ¶rÃ¼nde bulut tabanlÄ± yazÄ±lÄ±m Ã§Ã¶zÃ¼mleri ile tanÄ±nmaktadÄ±r. Bu Ã§Ã¶zÃ¼mler, Ã§eÅŸitli modern uygulamalar arasÄ±nda kullanÄ±cÄ± kimlik doÄŸrulamasÄ±nÄ± kolaylaÅŸtÄ±rmak ve gÃ¼vence altÄ±na almak iÃ§in tasarlanmÄ±ÅŸtÄ±r. Hassas verilerini korumak isteyen ÅŸirketlere ve uygulamalara, web hizmetlerine ve cihazlara kimlik kontrollerini entegre etmekle ilgilenen geliÅŸtiricilere hitap etmektedir.

Okta'nÄ±n amiral gemisi Ã¼rÃ¼nÃ¼ **Okta Kimlik Bulutu**dur. Bu platform, aÅŸaÄŸÄ±dakiler de dahil olmak Ã¼zere bir dizi Ã¼rÃ¼nÃ¼ kapsamaktadÄ±r:

* **Tek Oturum AÃ§ma (SSO)**: Birden fazla uygulama arasÄ±nda tek bir oturum aÃ§ma kimlik bilgisi seti ile kullanÄ±cÄ± eriÅŸimini basitleÅŸtirir.
* **Ã‡ok FaktÃ¶rlÃ¼ Kimlik DoÄŸrulama (MFA)**: Birden fazla doÄŸrulama biÃ§imi gerektirerek gÃ¼venliÄŸi artÄ±rÄ±r.
* **YaÅŸam DÃ¶ngÃ¼sÃ¼ YÃ¶netimi**: KullanÄ±cÄ± hesaplarÄ±nÄ±n oluÅŸturulmasÄ±, gÃ¼ncellenmesi ve devre dÄ±ÅŸÄ± bÄ±rakÄ±lmasÄ± sÃ¼reÃ§lerini otomatikleÅŸtirir.
* **Evrensel Dizin**: KullanÄ±cÄ±larÄ±n, gruplarÄ±n ve cihazlarÄ±n merkezi yÃ¶netimini saÄŸlar.
* **API EriÅŸim YÃ¶netimi**: API'lere eriÅŸimi gÃ¼vence altÄ±na alÄ±r ve yÃ¶netir.

Bu hizmetler, veri korumasÄ±nÄ± gÃ¼Ã§lendirmeyi ve kullanÄ±cÄ± eriÅŸimini kolaylaÅŸtÄ±rmayÄ± amaÃ§lamaktadÄ±r, bÃ¶ylece hem gÃ¼venliÄŸi hem de rahatlÄ±ÄŸÄ± artÄ±rmaktadÄ±r. Okta'nÄ±n Ã§Ã¶zÃ¼mlerinin Ã§ok yÃ¶nlÃ¼lÃ¼ÄŸÃ¼, onlarÄ± Ã§eÅŸitli endÃ¼strilerde popÃ¼ler bir seÃ§im haline getirmekte, bÃ¼yÃ¼k iÅŸletmelere, kÃ¼Ã§Ã¼k ÅŸirketlere ve bireysel geliÅŸtiricilere fayda saÄŸlamaktadÄ±r. EylÃ¼l 2021'deki son gÃ¼ncelleme itibarÄ±yla, Okta Kimlik ve EriÅŸim YÃ¶netimi (IAM) alanÄ±nda Ã¶nde gelen bir varlÄ±k olarak kabul edilmektedir.

{% hint style="danger" %}
Okta'nÄ±n ana hedefi, farklÄ± kullanÄ±cÄ±lar ve gruplar iÃ§in dÄ±ÅŸ uygulamalara eriÅŸimi yapÄ±landÄ±rmaktÄ±r. EÄŸer bir **Okta** ortamÄ±nda yÃ¶netici ayrÄ±calÄ±klarÄ±nÄ± **ele geÃ§irirseniz**, ÅŸirketin kullandÄ±ÄŸÄ± diÄŸer tÃ¼m platformlarÄ± **ele geÃ§irme** olasÄ±lÄ±ÄŸÄ±nÄ±z oldukÃ§a yÃ¼ksektir.
{% endhint %}

{% hint style="success" %}
Bir Okta ortamÄ±nÄ±n gÃ¼venlik incelemesini gerÃ§ekleÅŸtirmek iÃ§in **yÃ¶netici yalnÄ±zca okuma eriÅŸimi** talep etmelisiniz.
{% endhint %}

### Ã–zet

**KullanÄ±cÄ±lar** vardÄ±r (bunlar **Okta'da saklanabilir,** yapÄ±landÄ±rÄ±lmÄ±ÅŸ **Kimlik SaÄŸlayÄ±cÄ±larÄ±ndan** oturum aÃ§abilir veya **Active Directory** veya LDAP aracÄ±lÄ±ÄŸÄ±yla kimlik doÄŸrulamasÄ± yapÄ±labilir).\
Bu kullanÄ±cÄ±lar **gruplar** iÃ§inde olabilir.\
AyrÄ±ca **kimlik doÄŸrulayÄ±cÄ±lar** vardÄ±r: ÅŸifre gibi kimlik doÄŸrulama iÃ§in farklÄ± seÃ§enekler ve WebAuthn, e-posta, telefon, okta doÄŸrulama gibi Ã§eÅŸitli 2FA (bunlar etkinleÅŸtirilebilir veya devre dÄ±ÅŸÄ± bÄ±rakÄ±labilir)...

Daha sonra, Okta ile senkronize edilmiÅŸ **uygulamalar** vardÄ±r. Her uygulama, bilgi paylaÅŸmak iÃ§in Okta ile bazÄ± **eÅŸleÅŸtirmelere** sahip olacaktÄ±r (Ã¶rneÄŸin e-posta adresleri, adlar...). AyrÄ±ca, her uygulama bir **Kimlik DoÄŸrulama PolitikasÄ±** iÃ§inde olmalÄ±dÄ±r; bu, bir kullanÄ±cÄ±nÄ±n uygulamaya **eriÅŸmesi** iÃ§in gereken **kimlik doÄŸrulayÄ±cÄ±larÄ±** belirtir.

{% hint style="danger" %}
En gÃ¼Ã§lÃ¼ rol **SÃ¼per YÃ¶netici**dir.

EÄŸer bir saldÄ±rgan Okta'yÄ± YÃ¶netici eriÅŸimi ile ele geÃ§irirse, **Okta'ya gÃ¼venen tÃ¼m uygulamalar** bÃ¼yÃ¼k olasÄ±lÄ±kla **ele geÃ§irilmiÅŸ** olacaktÄ±r.
{% endhint %}

## SaldÄ±rÄ±lar

### Okta PortalÄ±nÄ± Bulma

Genellikle bir ÅŸirketin portalÄ± **companyname.okta.com** adresinde bulunur. EÄŸer bulamazsanÄ±z, **companyname.** iÃ§in basit **varyasyonlar** deneyin. EÄŸer bulamazsanÄ±z, organizasyonun **Okta portalÄ±na** iÅŸaret eden **CNAME** kaydÄ± gibi **`okta.companyname.com`** olabileceÄŸini de gÃ¶z Ã¶nÃ¼nde bulundurun.

### Kerberos ile Okta'ya GiriÅŸ

EÄŸer **`companyname.kerberos.okta.com`** aktifse, **Kerberos Okta eriÅŸimi iÃ§in kullanÄ±lÄ±r**, genellikle **Windows** kullanÄ±cÄ±larÄ± iÃ§in **MFA**'yÄ± atlayarak. AD'de Kerberos ile kimlik doÄŸrulamasÄ± yapÄ±lmÄ±ÅŸ Okta kullanÄ±cÄ±larÄ±nÄ± bulmak iÃ§in **`getST.py`** komutunu **uygun parametrelerle** Ã§alÄ±ÅŸtÄ±rÄ±n. Bir **AD kullanÄ±cÄ± bileti** elde ettikten sonra, bunu Rubeus veya Mimikatz gibi araÃ§lar kullanarak kontrol edilen bir hosta **enjekte** edin, **`clientname.kerberos.okta.com`'un Internet SeÃ§enekleri "Ä°ntranet" alanÄ±nda** olduÄŸundan emin olun. Belirli bir URL'ye eriÅŸmek, Kerberos biletinin kabul edildiÄŸini gÃ¶steren bir JSON "OK" yanÄ±tÄ± dÃ¶ndÃ¼rmeli ve Okta kontrol paneline eriÅŸim saÄŸlamalÄ±dÄ±r.

**Okta hizmet hesabÄ±nÄ± delegasyon SPN ile ele geÃ§irmek, bir Silver Ticket saldÄ±rÄ±sÄ±nÄ± mÃ¼mkÃ¼n kÄ±lar.** Ancak, Okta'nÄ±n bilet ÅŸifrelemesi iÃ§in **AES** kullanmasÄ±, AES anahtarÄ±na veya dÃ¼z metin ÅŸifreye sahip olmayÄ± gerektirir. **`ticketer.py`** kullanarak kurban kullanÄ±cÄ± iÃ§in bir bilet oluÅŸturun ve bunu Okta ile kimlik doÄŸrulamak iÃ§in tarayÄ±cÄ± aracÄ±lÄ±ÄŸÄ±yla iletin.

**SaldÄ±rÄ±yÄ± kontrol edin** [**https://trustedsec.com/blog/okta-for-red-teamers**](https://trustedsec.com/blog/okta-for-red-teamers)**.**

### Okta AD AjanÄ±nÄ± Ele GeÃ§irme

Bu teknik, **kullanÄ±cÄ±larÄ± senkronize eden ve kimlik doÄŸrulamasÄ±nÄ± yÃ¶neten bir sunucudaki Okta AD AjanÄ±na eriÅŸmeyi** iÃ§erir. **`OktaAgentService.exe.config`** iÃ§indeki yapÄ±landÄ±rmalarÄ± inceleyerek ve ÅŸifrelerini Ã§Ã¶zerek, Ã¶zellikle **DPAPI** kullanarak, bir saldÄ±rgan **kimlik doÄŸrulama verilerini** potansiyel olarak **yakalamak ve manipÃ¼le etmek** iÃ§in fÄ±rsat bulabilir. Bu, yalnÄ±zca Okta kimlik doÄŸrulama sÃ¼recinde kullanÄ±cÄ± kimlik bilgilerini dÃ¼z metin olarak **izleme** ve **yakalama** saÄŸlamakla kalmaz, aynÄ± zamanda kimlik doÄŸrulama giriÅŸimlerine **yanÄ±t verme** yeteneÄŸi de saÄŸlar; bÃ¶ylece yetkisiz eriÅŸim saÄŸlanabilir veya Okta aracÄ±lÄ±ÄŸÄ±yla evrensel kimlik doÄŸrulama saÄŸlanabilir (bir 'skeleton key' gibi).

**SaldÄ±rÄ±yÄ± kontrol edin** [**https://trustedsec.com/blog/okta-for-red-teamers**](https://trustedsec.com/blog/okta-for-red-teamers)**.**

### YÃ¶netici Olarak AD'yi Ele GeÃ§irme

Bu teknik, Ã¶nce bir OAuth Kodu elde ederek ardÄ±ndan bir API tokenÄ± talep ederek bir Okta AD AjanÄ±nÄ± ele geÃ§irmeyi iÃ§erir. Token, bir AD alanÄ± ile iliÅŸkilidir ve **sahte bir AD ajanÄ± oluÅŸturmak iÃ§in bir baÄŸlantÄ± adÄ± verilir**. BaÅŸlatma, ajanÄ±n **kimlik doÄŸrulama giriÅŸimlerini iÅŸlemesine** olanak tanÄ±r ve Okta API'si aracÄ±lÄ±ÄŸÄ±yla kimlik bilgilerini yakalar. Bu sÃ¼reci kolaylaÅŸtÄ±rmak iÃ§in otomasyon araÃ§larÄ± mevcuttur ve Okta ortamÄ±nda kimlik doÄŸrulama verilerini yakalamak ve iÅŸlemek iÃ§in sorunsuz bir yÃ¶ntem sunar.

**SaldÄ±rÄ±yÄ± kontrol edin** [**https://trustedsec.com/blog/okta-for-red-teamers**](https://trustedsec.com/blog/okta-for-red-teamers)**.**

### Okta Sahte SAML SaÄŸlayÄ±cÄ±sÄ±

**SaldÄ±rÄ±yÄ± kontrol edin** [**https://trustedsec.com/blog/okta-for-red-teamers**](https://trustedsec.com/blog/okta-for-red-teamers)**.**

Bu teknik, **sahte bir SAML saÄŸlayÄ±cÄ±sÄ± daÄŸÄ±tmayÄ±** iÃ§erir. Okta'nÄ±n Ã§erÃ§evesine ayrÄ± bir Kimlik SaÄŸlayÄ±cÄ±sÄ± (IdP) entegre ederek, saldÄ±rganlar **IdP'yi kontrol edebilir ve istedikleri zaman herhangi bir kimlik doÄŸrulama talebini onaylayabilir**. SÃ¼reÃ§, Okta'da bir SAML 2.0 IdP kurmayÄ±, yerel hosts dosyasÄ± aracÄ±lÄ±ÄŸÄ±yla yÃ¶nlendirme iÃ§in IdP Tek Oturum AÃ§ma URL'sini manipÃ¼le etmeyi, kendinden imzalÄ± bir sertifika oluÅŸturmayÄ± ve Okta ayarlarÄ±nÄ± kullanÄ±cÄ± adÄ± veya e-posta ile eÅŸleÅŸecek ÅŸekilde yapÄ±landÄ±rmayÄ± iÃ§erir. Bu adÄ±mlarÄ± baÅŸarÄ±yla uygulamak, herhangi bir Okta kullanÄ±cÄ±sÄ± olarak kimlik doÄŸrulama saÄŸlamaya olanak tanÄ±r; bu, bireysel kullanÄ±cÄ± kimlik bilgilerine ihtiyaÃ§ duymadan eriÅŸim kontrolÃ¼nÃ¼ Ã¶nemli Ã¶lÃ§Ã¼de artÄ±rÄ±r.

### Evilgnix ile Okta PortalÄ±nÄ± Phishing

[**bu blog yazÄ±sÄ±nda**](https://medium.com/nickvangilder/okta-for-red-teamers-perimeter-edition-c60cb8d53f23) bir Okta portalÄ±na karÅŸÄ± bir phishing kampanyasÄ± hazÄ±rlamanÄ±n nasÄ±l yapÄ±lacaÄŸÄ± aÃ§Ä±klanmaktadÄ±r.

### MeslektaÅŸ Taklit SaldÄ±rÄ±sÄ±

Her kullanÄ±cÄ±nÄ±n sahip olabileceÄŸi ve deÄŸiÅŸtirebileceÄŸi **Ã¶zellikler** (Ã¶rneÄŸin e-posta veya ad) Okta'da yapÄ±landÄ±rÄ±labilir. EÄŸer bir **uygulama**, bir kullanÄ±cÄ±nÄ±n **deÄŸiÅŸtirebileceÄŸi** bir **Ã¶zelliÄŸi** ID olarak **gÃ¼veniyorsa**, o kullanÄ±cÄ± bu platformda **diÄŸer kullanÄ±cÄ±larÄ± taklit edebilir**.

Bu nedenle, eÄŸer uygulama **`userName`** alanÄ±na gÃ¼veniyorsa, muhtemelen bunu deÄŸiÅŸtiremeyeceksiniz (Ã§Ã¼nkÃ¼ genellikle bu alanÄ± deÄŸiÅŸtiremezsiniz), ancak eÄŸer Ã¶rneÄŸin **`primaryEmail`** alanÄ±na gÃ¼veniyorsa, bunu **bir meslektaÅŸÄ±n e-posta adresine** deÄŸiÅŸtirebilir ve taklit edebilirsiniz (deÄŸiÅŸikliÄŸi kabul etmek iÃ§in e-postaya eriÅŸiminiz olmasÄ± gerekecek).

Bu taklit iÅŸleminin, her uygulamanÄ±n nasÄ±l yapÄ±landÄ±rÄ±ldÄ±ÄŸÄ±na baÄŸlÄ± olduÄŸunu unutmayÄ±n. Sadece deÄŸiÅŸtirdiÄŸiniz alana gÃ¼venen ve gÃ¼ncellemeleri kabul edenler tehlikeye girecektir.\
Bu nedenle, uygulamanÄ±n bu alanÄ± etkinleÅŸtirmiÅŸ olmasÄ± gerekir:

<figure><img src="../../.gitbook/assets/image (175).png" alt=""><figcaption></figcaption></figure>

AyrÄ±ca, Okta ayarlarÄ±nda bu alanÄ± bulundurmayan ancak savunmasÄ±z olan diÄŸer uygulamalarÄ± da gÃ¶rdÃ¼m (sonuÃ§ta farklÄ± uygulamalar farklÄ± ÅŸekilde yapÄ±landÄ±rÄ±lmÄ±ÅŸtÄ±r).

Her uygulamada birini taklit edip edemeyeceÄŸinizi Ã¶ÄŸrenmenin en iyi yolu, bunu denemektir!

## DavranÄ±ÅŸsal tespit politikalarÄ±nÄ± atlatma <a href="#id-9fde" id="id-9fde"></a>

Okta'daki davranÄ±ÅŸsal tespit politikalarÄ±, karÅŸÄ±laÅŸÄ±lana kadar bilinmeyebilir, ancak bunlarÄ± **doÄŸrudan Okta uygulamalarÄ±nÄ± hedef alarak** atlatmak mÃ¼mkÃ¼ndÃ¼r; bÃ¶ylece ana Okta kontrol panelinden kaÃ§Ä±nÄ±lÄ±r. Bir **Okta eriÅŸim tokenÄ±** ile, tokenÄ± ana giriÅŸ sayfasÄ± yerine **uygulama Ã¶zel Okta URL'sinde** yeniden oynatÄ±n.

Anahtar Ã¶neriler ÅŸunlardÄ±r:

* Yakalanan eriÅŸim tokenlarÄ±nÄ± yeniden oynatÄ±rken popÃ¼ler anonimleÅŸtirici proxy ve VPN hizmetlerini **kullanmaktan kaÃ§Ä±nÄ±n**.
* Ä°stemci ile yeniden oynatÄ±lan eriÅŸim tokenlarÄ± arasÄ±nda **tutarlÄ± kullanÄ±cÄ± ajanÄ± dizgeleri** olduÄŸundan emin olun.
* AynÄ± IP adresinden farklÄ± kullanÄ±cÄ±lardan tokenlarÄ± **yeniden oynatmamaya** dikkat edin.
* Okta kontrol paneline karÅŸÄ± tokenlarÄ± yeniden oynatÄ±rken dikkatli olun.
* Kurban ÅŸirketin IP adreslerini biliyorsanÄ±z, **trafik kÄ±sÄ±tlamasÄ±** yaparak yalnÄ±zca bu IP'lere veya aralÄ±ÄŸÄ±na izin verin, diÄŸer tÃ¼m trafiÄŸi engelleyin.

## Okta GÃ¼Ã§lendirme

Okta'nÄ±n birÃ§ok olasÄ± yapÄ±landÄ±rmasÄ± vardÄ±r, bu sayfada bunlarÄ± mÃ¼mkÃ¼n olduÄŸunca gÃ¼venli hale getirmek iÃ§in nasÄ±l gÃ¶zden geÃ§ireceÄŸinizi bulacaksÄ±nÄ±z:

{% content-ref url="okta-hardening.md" %}
[okta-hardening.md](okta-hardening.md)
{% endcontent-ref %}

## Referanslar

* [https://trustedsec.com/blog/okta-for-red-teamers](https://trustedsec.com/blog/okta-for-red-teamers)
* [https://medium.com/nickvangilder/okta-for-red-teamers-perimeter-edition-c60cb8d53f23](https://medium.com/nickvangilder/okta-for-red-teamers-perimeter-edition-c60cb8d53f23)

{% hint style="success" %}
AWS Hacking Ã¶ÄŸrenin ve pratik yapÄ±n:<img src="../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks EÄŸitim AWS KÄ±rmÄ±zÄ± Ekip UzmanÄ± (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/image (1).png" alt="" data-size="line">\
GCP Hacking Ã¶ÄŸrenin ve pratik yapÄ±n: <img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks EÄŸitim GCP KÄ±rmÄ±zÄ± Ekip UzmanÄ± (GRTE)**<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**abonelik planlarÄ±nÄ±**](https://github.com/sponsors/carlospolop) kontrol edin!
* **ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n ya da **Twitter'da** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** bizi takip edin.**
* **Hacking ipuÃ§larÄ±nÄ± paylaÅŸmak iÃ§in** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna PR gÃ¶nderin.

</details>
{% endhint %}
