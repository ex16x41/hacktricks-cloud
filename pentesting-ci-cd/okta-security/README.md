# Okta Security

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Temel Bilgiler

[Okta, Inc.](https://www.okta.com/), kimlik ve eriÅŸim yÃ¶netimi sektÃ¶rÃ¼nde bulut tabanlÄ± yazÄ±lÄ±m Ã§Ã¶zÃ¼mleri ile tanÄ±nÄ±r. Bu Ã§Ã¶zÃ¼mler, Ã§eÅŸitli modern uygulamalarda kullanÄ±cÄ± kimlik doÄŸrulamasÄ±nÄ± kolaylaÅŸtÄ±rmak ve gÃ¼vence altÄ±na almak iÃ§in tasarlanmÄ±ÅŸtÄ±r. Hem hassas verilerini korumak isteyen ÅŸirketlere hem de uygulamalara, web hizmetlerine ve cihazlara kimlik kontrolleri entegre etmek isteyen geliÅŸtiricilere hitap eder.

Okta'nÄ±n amiral gemisi Ã¼rÃ¼nÃ¼ **Okta Identity Cloud**'dur. Bu platform, aÅŸaÄŸÄ±dakiler de dahil olmak Ã¼zere bir dizi Ã¼rÃ¼nÃ¼ kapsar:

* **Single Sign-On (SSO)**: Birden fazla uygulama iÃ§in tek bir giriÅŸ kimlik bilgisi seti kullanarak kullanÄ±cÄ± eriÅŸimini basitleÅŸtirir.
* **Multi-Factor Authentication (MFA)**: Birden fazla doÄŸrulama biÃ§imi gerektirerek gÃ¼venliÄŸi artÄ±rÄ±r.
* **Lifecycle Management**: KullanÄ±cÄ± hesabÄ± oluÅŸturma, gÃ¼ncelleme ve devre dÄ±ÅŸÄ± bÄ±rakma sÃ¼reÃ§lerini otomatikleÅŸtirir.
* **Universal Directory**: KullanÄ±cÄ±larÄ±n, gruplarÄ±n ve cihazlarÄ±n merkezi yÃ¶netimini saÄŸlar.
* **API Access Management**: API'lere eriÅŸimi gÃ¼vence altÄ±na alÄ±r ve yÃ¶netir.

Bu hizmetler, veri korumasÄ±nÄ± gÃ¼Ã§lendirmeyi ve kullanÄ±cÄ± eriÅŸimini kolaylaÅŸtÄ±rmayÄ± amaÃ§lar, hem gÃ¼venliÄŸi hem de kullanÄ±m kolaylÄ±ÄŸÄ±nÄ± artÄ±rÄ±r. Okta'nÄ±n Ã§Ã¶zÃ¼mlerinin Ã§ok yÃ¶nlÃ¼lÃ¼ÄŸÃ¼, bÃ¼yÃ¼k iÅŸletmeler, kÃ¼Ã§Ã¼k ÅŸirketler ve bireysel geliÅŸtiriciler iÃ§in popÃ¼ler bir seÃ§im haline getirir. EylÃ¼l 2021 itibarÄ±yla Okta, Kimlik ve EriÅŸim YÃ¶netimi (IAM) alanÄ±nda Ã¶nde gelen bir varlÄ±k olarak kabul edilmektedir.

{% hint style="danger" %}
Okta'nÄ±n ana hedefi, farklÄ± kullanÄ±cÄ±lar ve gruplar iÃ§in dÄ±ÅŸ uygulamalara eriÅŸimi yapÄ±landÄ±rmaktÄ±r. EÄŸer bir Okta ortamÄ±nda **yÃ¶netici ayrÄ±calÄ±klarÄ±nÄ± ele geÃ§irmeyi baÅŸarÄ±rsanÄ±z**, bÃ¼yÃ¼k olasÄ±lÄ±kla **ÅŸirketin kullandÄ±ÄŸÄ± diÄŸer tÃ¼m platformlarÄ± da ele geÃ§irebilirsiniz**.
{% endhint %}

{% hint style="success" %}
Bir Okta ortamÄ±nÄ±n gÃ¼venlik incelemesini yapmak iÃ§in **yÃ¶netici salt okunur eriÅŸimi** istemelisiniz.
{% endhint %}

### Ã–zet

**KullanÄ±cÄ±lar** vardÄ±r (bu kullanÄ±cÄ±lar **Okta'da saklanabilir**, yapÄ±landÄ±rÄ±lmÄ±ÅŸ **Identity Providers**'dan giriÅŸ yapabilir veya **Active Directory** veya LDAP Ã¼zerinden kimlik doÄŸrulamasÄ± yapabilir).\
Bu kullanÄ±cÄ±lar **gruplar** iÃ§inde olabilir.\
AyrÄ±ca **doÄŸrulayÄ±cÄ±lar** vardÄ±r: ÅŸifre gibi farklÄ± kimlik doÄŸrulama seÃ§enekleri ve WebAuthn, e-posta, telefon, okta verify gibi Ã§eÅŸitli 2FA'lar (etkinleÅŸtirilebilir veya devre dÄ±ÅŸÄ± bÄ±rakÄ±labilir)...

Daha sonra, Okta ile senkronize edilmiÅŸ **uygulamalar** vardÄ±r. Her uygulama, bilgi paylaÅŸÄ±mÄ± iÃ§in Okta ile bazÄ± **eÅŸlemelere** sahip olacaktÄ±r (Ã¶rneÄŸin e-posta adresleri, adlar...). AyrÄ±ca, her uygulama bir **Kimlik DoÄŸrulama PolitikasÄ±** iÃ§inde olmalÄ±dÄ±r, bu politika bir kullanÄ±cÄ±nÄ±n uygulamaya **eriÅŸmesi** iÃ§in gerekli **doÄŸrulayÄ±cÄ±larÄ±** belirtir.

{% hint style="danger" %}
En gÃ¼Ã§lÃ¼ rol **SÃ¼per YÃ¶netici**'dir.

Bir saldÄ±rgan, YÃ¶netici eriÅŸimi ile Okta'yÄ± ele geÃ§irirse, **Okta'ya gÃ¼venen tÃ¼m uygulamalar** bÃ¼yÃ¼k olasÄ±lÄ±kla **ele geÃ§irilmiÅŸ** olacaktÄ±r.
{% endhint %}

## SaldÄ±rÄ±lar

### Okta PortalÄ±nÄ± Bulma

Genellikle bir ÅŸirketin portalÄ± **companyname.okta.com** adresinde bulunur. EÄŸer deÄŸilse, **companyname**'in basit **varyasyonlarÄ±nÄ±** deneyin. BulamazsanÄ±z, organizasyonun **Okta portalÄ±na** iÅŸaret eden bir **CNAME** kaydÄ± (Ã¶rneÄŸin **`okta.companyname.com`**) olmasÄ± da mÃ¼mkÃ¼ndÃ¼r.

### Kerberos ile Okta'ya GiriÅŸ Yapma

EÄŸer **`companyname.kerberos.okta.com`** aktifse, **Kerberos Okta eriÅŸimi iÃ§in kullanÄ±lÄ±r**, genellikle **Windows** kullanÄ±cÄ±larÄ± iÃ§in **MFA**'yÄ± atlar. AD'de Kerberos ile kimlik doÄŸrulanan Okta kullanÄ±cÄ±larÄ±nÄ± bulmak iÃ§in **`getST.py`**'yi uygun parametrelerle Ã§alÄ±ÅŸtÄ±rÄ±n. Bir **AD kullanÄ±cÄ± bileti** elde ettikten sonra, Rubeus veya Mimikatz gibi araÃ§larÄ± kullanarak bunu kontrol edilen bir ana bilgisayara **enjeksiyon** yapÄ±n, **`clientname.kerberos.okta.com`'un Internet SeÃ§enekleri "Intranet" bÃ¶lgesinde olduÄŸundan emin olun**. Belirli bir URL'ye eriÅŸmek, Kerberos biletinin kabul edildiÄŸini belirten bir JSON "OK" yanÄ±tÄ± dÃ¶ndÃ¼rmeli ve Okta panosuna eriÅŸim saÄŸlamalÄ±dÄ±r.

**Delegasyon SPN ile Okta hizmet hesabÄ±nÄ± ele geÃ§irmek, Silver Ticket saldÄ±rÄ±sÄ±nÄ± mÃ¼mkÃ¼n kÄ±lar.** Ancak, Okta'nÄ±n bilet ÅŸifrelemesi iÃ§in **AES** kullanmasÄ±, AES anahtarÄ±na veya dÃ¼z metin parolasÄ±na sahip olmayÄ± gerektirir. **`ticketer.py`'yi kullanarak kurban kullanÄ±cÄ± iÃ§in bir bilet oluÅŸturun** ve bunu tarayÄ±cÄ± aracÄ±lÄ±ÄŸÄ±yla Okta ile kimlik doÄŸrulamak iÃ§in teslim edin.

**SaldÄ±rÄ±yÄ± kontrol edin** [**https://trustedsec.com/blog/okta-for-red-teamers**](https://trustedsec.com/blog/okta-for-red-teamers)**.**

### Okta AD Agent'Ä±nÄ± Ele GeÃ§irme

Bu teknik, **bir sunucudaki Okta AD Agent'Ä±na eriÅŸmeyi** iÃ§erir, bu **kullanÄ±cÄ±larÄ± senkronize eder ve kimlik doÄŸrulamasÄ±nÄ± yÃ¶netir**. **`OktaAgentService.exe.config`** iÃ§indeki yapÄ±landÄ±rmalarÄ± inceleyerek ve ÅŸifrelerini Ã§Ã¶zerek, Ã¶zellikle **DPAPI** kullanarak AgentToken'Ä±, bir saldÄ±rgan potansiyel olarak **kimlik doÄŸrulama verilerini kesebilir ve manipÃ¼le edebilir**. Bu, yalnÄ±zca **Okta kimlik doÄŸrulama sÃ¼recinde kullanÄ±cÄ± kimlik bilgilerini dÃ¼z metin olarak izlemeyi ve yakalamayÄ±** deÄŸil, aynÄ± zamanda **kimlik doÄŸrulama giriÅŸimlerine yanÄ±t vermeyi** de saÄŸlar, bÃ¶ylece yetkisiz eriÅŸim veya Okta aracÄ±lÄ±ÄŸÄ±yla evrensel kimlik doÄŸrulama (bir 'iskelet anahtarÄ±' gibi) saÄŸlar.

**SaldÄ±rÄ±yÄ± kontrol edin** [**https://trustedsec.com/blog/okta-for-red-teamers**](https://trustedsec.com/blog/okta-for-red-teamers)**.**

### Bir YÃ¶netici Olarak AD'yi Ele GeÃ§irme

Bu teknik, bir OAuth Kodu elde ederek ve ardÄ±ndan bir API belirteci isteyerek bir Okta AD Agent'Ä±nÄ± ele geÃ§irmeyi iÃ§erir. BelirteÃ§ bir AD etki alanÄ± ile iliÅŸkilidir ve **sahte bir AD agent'Ä± kurmak iÃ§in bir baÄŸlayÄ±cÄ± adlandÄ±rÄ±lÄ±r**. BaÅŸlatma, agent'Ä±n **kimlik doÄŸrulama giriÅŸimlerini iÅŸlemesine** izin verir, Okta API'si aracÄ±lÄ±ÄŸÄ±yla kimlik bilgilerini yakalar. Otomasyon araÃ§larÄ±, bu sÃ¼reci kolaylaÅŸtÄ±rmak iÃ§in mevcuttur, Okta ortamÄ±nda kimlik doÄŸrulama verilerini kesmek ve iÅŸlemek iÃ§in sorunsuz bir yÃ¶ntem sunar.

**SaldÄ±rÄ±yÄ± kontrol edin** [**https://trustedsec.com/blog/okta-for-red-teamers**](https://trustedsec.com/blog/okta-for-red-teamers)**.**

### Okta Sahte SAML SaÄŸlayÄ±cÄ±sÄ±

**SaldÄ±rÄ±yÄ± kontrol edin** [**https://trustedsec.com/blog/okta-for-red-teamers**](https://trustedsec.com/blog/okta-for-red-teamers)**.**

Bu teknik, **sahte bir SAML saÄŸlayÄ±cÄ±sÄ± daÄŸÄ±tmayÄ±** iÃ§erir. Okta'nÄ±n Ã§erÃ§evesine ayrÄ±calÄ±klÄ± bir hesap kullanarak harici bir Kimlik SaÄŸlayÄ±cÄ± (IdP) entegre ederek, saldÄ±rganlar **IdP'yi kontrol edebilir ve herhangi bir kimlik doÄŸrulama isteÄŸini onaylayabilir**. SÃ¼reÃ§, Okta'da bir SAML 2.0 IdP kurmayÄ±, yerel hosts dosyasÄ± aracÄ±lÄ±ÄŸÄ±yla yÃ¶nlendirme iÃ§in IdP Tek Oturum AÃ§ma URL'sini manipÃ¼le etmeyi, kendi kendine imzalÄ± bir sertifika oluÅŸturmayÄ± ve Okta ayarlarÄ±nÄ± kullanÄ±cÄ± adÄ± veya e-posta ile eÅŸleÅŸecek ÅŸekilde yapÄ±landÄ±rmayÄ± iÃ§erir. Bu adÄ±mlarÄ± baÅŸarÄ±yla uygulamak, bireysel kullanÄ±cÄ± kimlik bilgilerine ihtiyaÃ§ duymadan herhangi bir Okta kullanÄ±cÄ±sÄ± olarak kimlik doÄŸrulama saÄŸlar, bu da potansiyel olarak fark edilmeden eriÅŸim kontrolÃ¼nÃ¼ Ã¶nemli Ã¶lÃ§Ã¼de artÄ±rÄ±r.

### Evilgnix ile Okta PortalÄ±nÄ± Phishing Yapma

[**Bu blog yazÄ±sÄ±nda**](https://medium.com/nickvangilder/okta-for-red-teamers-perimeter-edition-c60cb8d53f23) bir Okta portalÄ±na karÅŸÄ± bir phishing kampanyasÄ±nÄ±n nasÄ±l hazÄ±rlanacaÄŸÄ± aÃ§Ä±klanmÄ±ÅŸtÄ±r.

### MeslektaÅŸ Taklit SaldÄ±rÄ±sÄ±

Her kullanÄ±cÄ±nÄ±n sahip olabileceÄŸi ve deÄŸiÅŸtirebileceÄŸi **Ã¶zellikler** (Ã¶rneÄŸin e-posta veya ad) Okta'da yapÄ±landÄ±rÄ±labilir. EÄŸer bir **uygulama**, kullanÄ±cÄ± tarafÄ±ndan **deÄŸiÅŸtirilebilecek** bir **Ã¶zelliÄŸe** kimlik olarak **gÃ¼veniyorsa**, kullanÄ±cÄ± o platformda **diÄŸer kullanÄ±cÄ±larÄ± taklit edebilir**.

Bu nedenle, uygulama **`userName`** alanÄ±na gÃ¼veniyorsa, muhtemelen bunu deÄŸiÅŸtiremeyeceksiniz (Ã§Ã¼nkÃ¼ genellikle bu alanÄ± deÄŸiÅŸtiremezsiniz), ancak Ã¶rneÄŸin **`primaryEmail`** alanÄ±na gÃ¼veniyorsa, bunu **bir meslektaÅŸÄ±nÄ±zÄ±n e-posta adresine** deÄŸiÅŸtirebilir ve onu taklit edebilirsiniz (e-postaya eriÅŸiminiz olmasÄ± ve deÄŸiÅŸikliÄŸi kabul etmeniz gerekecektir).

Bu taklit, her uygulamanÄ±n nasÄ±l yapÄ±landÄ±rÄ±ldÄ±ÄŸÄ±na baÄŸlÄ±dÄ±r. YalnÄ±zca deÄŸiÅŸtirdiÄŸiniz alana gÃ¼venen ve gÃ¼ncellemeleri kabul edenler ele geÃ§irilecektir.\
Bu nedenle, uygulama bu alanÄ± etkinleÅŸtirmiÅŸ olmalÄ±dÄ±r:

<figure><img src="../../.gitbook/assets/image (175).png" alt=""><figcaption></figcaption></figure>

AyrÄ±ca, Okta ayarlarÄ±nda bu alana sahip olmayan ancak yine de savunmasÄ±z olan diÄŸer uygulamalarÄ± da gÃ¶rdÃ¼m (sonuÃ§ta farklÄ± uygulamalar farklÄ± ÅŸekilde yapÄ±landÄ±rÄ±lmÄ±ÅŸtÄ±r).

Her uygulamada birini taklit edip edemeyeceÄŸinizi Ã¶ÄŸrenmenin en iyi yolu denemektir!

## DavranÄ±ÅŸsal Tespit PolitikalarÄ±ndan KaÃ§Ä±nma <a href="#id-9fde" id="id-9fde"></a>

Okta'daki davranÄ±ÅŸsal tespit politikalarÄ± karÅŸÄ±laÅŸÄ±lana kadar bilinmeyebilir, ancak **bunlardan kaÃ§Ä±nmak**, **Okta uygulamalarÄ±nÄ± doÄŸrudan hedef alarak**, ana Okta panosundan kaÃ§Ä±narak baÅŸarÄ±labilir. Bir **Okta eriÅŸim belirteci** ile, belirteci **uygulamaya Ã¶zgÃ¼ Okta URL'sinde** ana giriÅŸ sayfasÄ± yerine yeniden oynatÄ±n.

Anahtar Ã¶neriler ÅŸunlardÄ±r:

* **Yakalanan eriÅŸim belirteÃ§lerini yeniden oynatÄ±rken** popÃ¼ler anonimleÅŸtirici proxy'ler ve VPN hizmetlerini kullanmaktan kaÃ§Ä±nÄ±n.
* **Ä°stemci ve yeniden oynatÄ±lan eriÅŸim belirteÃ§leri arasÄ±nda** tutarlÄ± kullanÄ±cÄ± aracÄ±sÄ± dizeleri saÄŸlayÄ±n.
* **AynÄ± IP adresinden farklÄ± kullanÄ±cÄ±larÄ±n** belirteÃ§lerini yeniden oynatmaktan kaÃ§Ä±nÄ±n.
* Okta panosuna karÅŸÄ± belirteÃ§leri yeniden oynatÄ±rken dikkatli olun.
* Kurban ÅŸirketin IP adreslerini biliyorsanÄ±z, **trafiÄŸi bu IP'lere veya aralÄ±klarÄ±na sÄ±nÄ±rlayÄ±n**, diÄŸer tÃ¼m trafiÄŸi engelleyin.

## Okta GÃ¼Ã§lendirme

Okta'nÄ±n birÃ§ok olasÄ± yapÄ±landÄ±rmasÄ± vardÄ±r, bu sayfada bunlarÄ± nasÄ±l gÃ¶zden geÃ§ireceÄŸinizi ve mÃ¼mkÃ¼n olduÄŸunca gÃ¼venli hale getireceÄŸinizi bulacaksÄ±nÄ±z:

{% content-ref url="okta-hardening.md" %}
[okta-hardening.md](okta-hardening.md)
{% endcontent-ref %}

## Referanslar

* [https://trustedsec.com/blog/okta-for-red-teamers](https://trustedsec.com/blog/okta-for-red-teamers)
* [https://medium.com/nickvangilder/okta-for-red-teamers-perimeter-edition-c60cb8d53f23](https://medium.com/nickvangilder/okta-for-red-teamers-perimeter-edition-c60cb8d53f23)

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
