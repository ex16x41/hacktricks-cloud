# Ansible Tower / AWX / Automation controller Sicherheit

{% hint style="success" %}
Lernen & √ºben Sie AWS Hacking:<img src="../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../.gitbook/assets/image (1).png" alt="" data-size="line">\
Lernen & √ºben Sie GCP Hacking: <img src="../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Unterst√ºtzen Sie HackTricks</summary>

* √úberpr√ºfen Sie die [**Abonnementpl√§ne**](https://github.com/sponsors/carlospolop)!
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teilen Sie Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repos senden.

</details>
{% endhint %}

## Grundinformationen

**Ansible Tower** oder seine Open-Source-Version [**AWX**](https://github.com/ansible/awx) ist auch bekannt als **Ansible-Benutzeroberfl√§che, Dashboard und REST-API**. Mit **rollenbasiertem Zugriffskontrolle**, Jobplanung und grafischer Inventarverwaltung k√∂nnen Sie Ihre Ansible-Infrastruktur √ºber eine moderne Benutzeroberfl√§che verwalten. Die REST-API und die Befehlszeilenschnittstelle von Tower machen es einfach, sie in aktuelle Tools und Workflows zu integrieren.

**Automation Controller ist eine neuere** Version von Ansible Tower mit mehr Funktionen.

### Unterschiede

Laut [**diesem**](https://blog.devops.dev/ansible-tower-vs-awx-under-the-hood-65cfec78db00) sind die Hauptunterschiede zwischen Ansible Tower und AWX die erhaltene Unterst√ºtzung, und Ansible Tower hat zus√§tzliche Funktionen wie rollenbasierte Zugriffskontrolle, Unterst√ºtzung f√ºr benutzerdefinierte APIs und benutzerdefinierte Workflows.

### Tech-Stack

* **Weboberfl√§che**: Dies ist die grafische Oberfl√§che, √ºber die Benutzer Inventare, Anmeldeinformationen, Vorlagen und Jobs verwalten k√∂nnen. Sie ist so gestaltet, dass sie intuitiv ist und Visualisierungen bietet, um den Zustand und die Ergebnisse Ihrer Automatisierungsjobs zu verstehen.
* **REST-API**: Alles, was Sie in der Weboberfl√§che tun k√∂nnen, k√∂nnen Sie auch √ºber die REST-API tun. Das bedeutet, dass Sie AWX/Tower mit anderen Systemen integrieren oder Aktionen skripten k√∂nnen, die Sie normalerweise in der Benutzeroberfl√§che ausf√ºhren w√ºrden.
* **Datenbank**: AWX/Tower verwendet eine Datenbank (typischerweise PostgreSQL), um seine Konfiguration, Jobresultate und andere notwendige Betriebsdaten zu speichern.
* **RabbitMQ**: Dies ist das Messaging-System, das von AWX/Tower verwendet wird, um zwischen den verschiedenen Komponenten zu kommunizieren, insbesondere zwischen dem Webdienst und den Aufgabenl√§ufern.
* **Redis**: Redis dient als Cache und Backend f√ºr die Aufgabenwarteschlange.

### Logische Komponenten

* **Inventare**: Ein Inventar ist eine **Sammlung von Hosts (oder Knoten)**, gegen die **Jobs** (Ansible-Playbooks) **ausgef√ºhrt** werden k√∂nnen. AWX/Tower erm√∂glicht es Ihnen, Ihre Inventare zu definieren und zu gruppieren und unterst√ºtzt auch dynamische Inventare, die **Hostlisten aus anderen Systemen** wie AWS, Azure usw. abrufen k√∂nnen.
* **Projekte**: Ein Projekt ist im Wesentlichen eine **Sammlung von Ansible-Playbooks**, die aus einem **Versionskontrollsystem** (wie Git) stammen, um die neuesten Playbooks bei Bedarf abzurufen.
* **Vorlagen**: Jobvorlagen definieren, **wie ein bestimmtes Playbook ausgef√ºhrt wird**, indem sie das **Inventar**, die **Anmeldeinformationen** und andere **Parameter** f√ºr den Job angeben.
* **Anmeldeinformationen**: AWX/Tower bietet eine sichere M√∂glichkeit, **Geheimnisse wie SSH-Schl√ºssel, Passw√∂rter und API-Tokens zu verwalten und zu speichern**. Diese Anmeldeinformationen k√∂nnen mit Jobvorlagen verkn√ºpft werden, sodass Playbooks beim Ausf√ºhren den erforderlichen Zugriff haben.
* **Aufgaben-Engine**: Hier passiert die Magie. Die Aufgaben-Engine basiert auf Ansible und ist verantwortlich f√ºr das **Ausf√ºhren der Playbooks**. Jobs werden an die Aufgaben-Engine √ºbergeben, die dann die Ansible-Playbooks gegen das festgelegte Inventar mit den angegebenen Anmeldeinformationen ausf√ºhrt.
* **Planer und R√ºckrufe**: Dies sind erweiterte Funktionen in AWX/Tower, die es erm√∂glichen, **Jobs zu planen**, die zu bestimmten Zeiten ausgef√ºhrt oder durch externe Ereignisse ausgel√∂st werden.
* **Benachrichtigungen**: AWX/Tower kann Benachrichtigungen basierend auf dem Erfolg oder Misserfolg von Jobs senden. Es unterst√ºtzt verschiedene Arten von Benachrichtigungen wie E-Mails, Slack-Nachrichten, Webhooks usw.
* **Ansible-Playbooks**: Ansible-Playbooks sind Konfigurations-, Bereitstellungs- und Orchestrierungstools. Sie beschreiben den gew√ºnschten Zustand von Systemen auf automatisierte, wiederholbare Weise. In YAML geschrieben, verwenden Playbooks Ansible's deklarative Automatisierungssprache, um Konfigurationen, Aufgaben und Schritte zu beschreiben, die ausgef√ºhrt werden m√ºssen.

### Jobausf√ºhrungsfluss

1. **Benutzerinteraktion**: Ein Benutzer kann mit AWX/Tower entweder √ºber die **Weboberfl√§che** oder die **REST-API** interagieren. Diese bieten Front-End-Zugriff auf alle von AWX/Tower angebotenen Funktionen.
2. **Jobinitiierung**:
* Der Benutzer initiiert √ºber die Weboberfl√§che oder API einen Job basierend auf einer **Jobvorlage**.
* Die Jobvorlage enth√§lt Verweise auf das **Inventar**, das **Projekt** (das das Playbook enth√§lt) und die **Anmeldeinformationen**.
* Bei der Jobinitiierung wird eine Anfrage an das AWX/Tower-Backend gesendet, um den Job zur Ausf√ºhrung in die Warteschlange zu stellen.
3. **Jobwarteschlange**:
* **RabbitMQ** verwaltet die Nachrichten√ºbertragung zwischen der Webkomponente und den Aufgabenl√§ufern. Sobald ein Job initiiert wird, wird eine Nachricht an die Aufgaben-Engine √ºber RabbitMQ gesendet.
* **Redis** fungiert als Backend f√ºr die Aufgabenwarteschlange und verwaltet die in der Warteschlange stehenden Jobs, die auf die Ausf√ºhrung warten.
4. **Jobausf√ºhrung**:
* Die **Aufgaben-Engine** nimmt den in der Warteschlange stehenden Job auf. Sie ruft die erforderlichen Informationen aus der **Datenbank** √ºber das mit dem Job verbundene Playbook, Inventar und die Anmeldeinformationen ab.
* Mit dem abgerufenen Ansible-Playbook aus dem zugeh√∂rigen **Projekt** f√ºhrt die Aufgaben-Engine das Playbook gegen die angegebenen **Inventar**-Knoten mit den bereitgestellten **Anmeldeinformationen** aus.
* W√§hrend das Playbook ausgef√ºhrt wird, werden die Ausf√ºhrungsprotokolle (Logs, Fakten usw.) erfasst und in der **Datenbank** gespeichert.
5. **Jobergebnisse**:
* Sobald das Playbook die Ausf√ºhrung abgeschlossen hat, werden die Ergebnisse (Erfolg, Misserfolg, Protokolle) in der **Datenbank** gespeichert.
* Benutzer k√∂nnen die Ergebnisse dann √ºber die Weboberfl√§che einsehen oder sie √ºber die REST-API abfragen.
* Basierend auf den Jobergebnissen k√∂nnen **Benachrichtigungen** gesendet werden, um Benutzer oder externe Systeme √ºber den Status des Jobs zu informieren. Benachrichtigungen k√∂nnen E-Mails, Slack-Nachrichten, Webhooks usw. sein.
6. **Integration mit externen Systemen**:
* **Inventare** k√∂nnen dynamisch aus externen Systemen bezogen werden, sodass AWX/Tower Hosts aus Quellen wie AWS, Azure, VMware und mehr abrufen kann.
* **Projekte** (Playbooks) k√∂nnen aus Versionskontrollsystemen abgerufen werden, um sicherzustellen, dass w√§hrend der Jobausf√ºhrung aktuelle Playbooks verwendet werden.
* **Planer und R√ºckrufe** k√∂nnen verwendet werden, um mit anderen Systemen oder Tools zu integrieren, sodass AWX/Tower auf externe Ausl√∂ser reagiert oder Jobs zu festgelegten Zeiten ausf√ºhrt.

### AWX-Laborerstellung f√ºr Tests

[**Den Dokumenten folgen**](https://github.com/ansible/awx/blob/devel/tools/docker-compose/README.md) ist es m√∂glich, docker-compose zu verwenden, um AWX auszuf√ºhren:

{% code overflow="wrap" %}
```bash
git clone -b x.y.z https://github.com/ansible/awx.git # Get in x.y.z the latest release version

cd awx

# Build
make docker-compose-build

# Run
make docker-compose

# Or to create a more complex env
MAIN_NODE_TYPE=control EXECUTION_NODE_COUNT=2 COMPOSE_TAG=devel make docker-compose

# Clean and build the UI
docker exec tools_awx_1 make clean-ui ui-devel

# Once migrations are completed and the UI is built, you can begin using AWX. The UI can be reached in your browser at https://localhost:8043/#/home, and the API can be found at https://localhost:8043/api/v2.

# Create an admin user
docker exec -ti tools_awx_1 awx-manage createsuperuser

# Load demo data
docker exec tools_awx_1 awx-manage create_preload_data
```
{% endcode %}

## RBAC

### Unterst√ºtzte Rollen

Die privilegierteste Rolle wird als **Systemadministrator** bezeichnet. Jeder mit dieser Rolle kann **alles √§ndern**.

F√ºr eine **White-Box-Sicherheits**-√úberpr√ºfung ben√∂tigen Sie die **Systemauditorrolle**, die es erm√∂glicht, **alle Systemdaten anzuzeigen**, aber keine √Ñnderungen vorzunehmen. Eine andere Option w√§re, die **Organisationsauditorrolle** zu erhalten, aber es w√§re besser, die andere zu bekommen.

<details>

<summary>Erweitern Sie dies, um eine detaillierte Beschreibung der verf√ºgbaren Rollen zu erhalten</summary>

1. **Systemadministrator**:
* Dies ist die Superuser-Rolle mit Berechtigungen zum Zugriff auf und zur √Ñnderung aller Ressourcen im System.
* Sie k√∂nnen alle Organisationen, Teams, Projekte, Inventare, Jobvorlagen usw. verwalten.
2. **Systemauditor**:
* Benutzer mit dieser Rolle k√∂nnen alle Systemdaten anzeigen, aber keine √Ñnderungen vornehmen.
* Diese Rolle ist f√ºr Compliance und Aufsicht konzipiert.
3. **Organisationsrollen**:
* **Admin**: Vollst√§ndige Kontrolle √ºber die Ressourcen der Organisation.
* **Auditor**: Nur Lesezugriff auf die Ressourcen der Organisation.
* **Mitglied**: Grundlegende Mitgliedschaft in einer Organisation ohne spezifische Berechtigungen.
* **Ausf√ºhren**: Kann Jobvorlagen innerhalb der Organisation ausf√ºhren.
* **Lesen**: Kann die Ressourcen der Organisation anzeigen.
4. **Projektrollen**:
* **Admin**: Kann das Projekt verwalten und √§ndern.
* **Verwenden**: Kann das Projekt in einer Jobvorlage verwenden.
* **Aktualisieren**: Kann das Projekt mit SCM (Source Control) aktualisieren.
5. **Inventarrollen**:
* **Admin**: Kann das Inventar verwalten und √§ndern.
* **Ad Hoc**: Kann Ad-hoc-Befehle im Inventar ausf√ºhren.
* **Aktualisieren**: Kann die Inventarquelle aktualisieren.
* **Verwenden**: Kann das Inventar in einer Jobvorlage verwenden.
* **Lesen**: Nur Lesezugriff.
6. **Jobvorlagenrollen**:
* **Admin**: Kann die Jobvorlage verwalten und √§ndern.
* **Ausf√ºhren**: Kann den Job ausf√ºhren.
* **Lesen**: Nur Lesezugriff.
7. **Berechtigungsrollen**:
* **Admin**: Kann die Berechtigungen verwalten und √§ndern.
* **Verwenden**: Kann die Berechtigungen in Jobvorlagen oder anderen relevanten Ressourcen verwenden.
* **Lesen**: Nur Lesezugriff.
8. **Teamrollen**:
* **Mitglied**: Teil des Teams, aber ohne spezifische Berechtigungen.
* **Admin**: Kann die Mitglieder des Teams und die zugeh√∂rigen Ressourcen verwalten.
9. **Workflow-Rollen**:
* **Admin**: Kann den Workflow verwalten und √§ndern.
* **Ausf√ºhren**: Kann den Workflow ausf√ºhren.
* **Lesen**: Nur Lesezugriff.

</details>

{% hint style="success" %}
Lernen & √ºben Sie AWS Hacking:<img src="../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../.gitbook/assets/image (1).png" alt="" data-size="line">\
Lernen & √ºben Sie GCP Hacking: <img src="../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Unterst√ºtzen Sie HackTricks</summary>

* √úberpr√ºfen Sie die [**Abonnementpl√§ne**](https://github.com/sponsors/carlospolop)!
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teilen Sie Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repos senden.

</details>
{% endhint %}
