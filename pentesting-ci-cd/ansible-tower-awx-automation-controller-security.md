# Ansible Tower / AWX / Automation controller Security

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../.gitbook/assets/image (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Basic Information

**Ansible Tower** ou sa version open source [**AWX**](https://github.com/ansible/awx) est √©galement connu comme **l'interface utilisateur d'Ansible, le tableau de bord et l'API REST**. Avec **le contr√¥le d'acc√®s bas√© sur les r√¥les**, la planification des t√¢ches et la gestion graphique des inventaires, vous pouvez g√©rer votre infrastructure Ansible depuis une interface moderne. L'API REST de Tower et l'interface en ligne de commande facilitent son int√©gration dans les outils et flux de travail actuels.

**Automation Controller est une version** plus r√©cente d'Ansible Tower avec plus de capacit√©s.

### Differences

Selon [**ceci**](https://blog.devops.dev/ansible-tower-vs-awx-under-the-hood-65cfec78db00), les principales diff√©rences entre Ansible Tower et AWX sont le support re√ßu et Ansible Tower a des fonctionnalit√©s suppl√©mentaires telles que le contr√¥le d'acc√®s bas√© sur les r√¥les, le support pour les API personnalis√©es et les flux de travail d√©finis par l'utilisateur.

### Tech Stack

* **Web Interface** : C'est l'interface graphique o√π les utilisateurs peuvent g√©rer les inventaires, les identifiants, les mod√®les et les t√¢ches. Elle est con√ßue pour √™tre intuitive et fournit des visualisations pour aider √† comprendre l'√©tat et les r√©sultats de vos t√¢ches d'automatisation.
* **REST API** : Tout ce que vous pouvez faire dans l'interface web, vous pouvez √©galement le faire via l'API REST. Cela signifie que vous pouvez int√©grer AWX/Tower avec d'autres syst√®mes ou script des actions que vous effectueriez normalement dans l'interface.
* **Database** : AWX/Tower utilise une base de donn√©es (g√©n√©ralement PostgreSQL) pour stocker sa configuration, les r√©sultats des t√¢ches et d'autres donn√©es op√©rationnelles n√©cessaires.
* **RabbitMQ** : C'est le syst√®me de messagerie utilis√© par AWX/Tower pour communiquer entre les diff√©rents composants, en particulier entre le service web et les ex√©cuteurs de t√¢ches.
* **Redis** : Redis sert de cache et de backend pour la file d'attente des t√¢ches.

### Logical Components

* **Inventories** : Un inventaire est une **collection d'h√¥tes (ou n≈ìuds)** contre lesquels des **t√¢ches** (playbooks Ansible) peuvent √™tre **ex√©cut√©es**. AWX/Tower vous permet de d√©finir et de regrouper vos inventaires et prend √©galement en charge les inventaires dynamiques qui peuvent **r√©cup√©rer des listes d'h√¥tes √† partir d'autres syst√®mes** comme AWS, Azure, etc.
* **Projects** : Un projet est essentiellement une **collection de playbooks Ansible** provenant d'un **syst√®me de contr√¥le de version** (comme Git) pour tirer les derniers playbooks lorsque n√©cessaire.
* **Templates** : Les mod√®les de t√¢ches d√©finissent **comment un playbook particulier sera ex√©cut√©**, sp√©cifiant l'**inventaire**, les **identifiants** et d'autres **param√®tres** pour la t√¢che.
* **Credentials** : AWX/Tower fournit un moyen s√©curis√© de **g√©rer et de stocker des secrets, tels que des cl√©s SSH, des mots de passe et des jetons API**. Ces identifiants peuvent √™tre associ√©s √† des mod√®les de t√¢ches afin que les playbooks aient l'acc√®s n√©cessaire lorsqu'ils s'ex√©cutent.
* **Task Engine** : C'est l√† que la magie op√®re. Le moteur de t√¢ches est construit sur Ansible et est responsable de **l'ex√©cution des playbooks**. Les t√¢ches sont envoy√©es au moteur de t√¢ches, qui ex√©cute ensuite les playbooks Ansible contre l'inventaire d√©sign√© en utilisant les identifiants sp√©cifi√©s.
* **Schedulers and Callbacks** : Ce sont des fonctionnalit√©s avanc√©es dans AWX/Tower qui permettent aux **t√¢ches d'√™tre planifi√©es** pour s'ex√©cuter √† des moments sp√©cifiques ou d√©clench√©es par des √©v√©nements externes.
* **Notifications** : AWX/Tower peut envoyer des notifications en fonction du succ√®s ou de l'√©chec des t√¢ches. Il prend en charge divers moyens de notifications tels que les e-mails, les messages Slack, les webhooks, etc.
* **Ansible Playbooks** : Les playbooks Ansible sont des outils de configuration, de d√©ploiement et d'orchestration. Ils d√©crivent l'√©tat souhait√© des syst√®mes de mani√®re automatis√©e et r√©p√©table. √âcrits en YAML, les playbooks utilisent le langage d'automatisation d√©claratif d'Ansible pour d√©crire les configurations, les t√¢ches et les √©tapes qui doivent √™tre ex√©cut√©es.

### Job Execution Flow

1. **User Interaction** : Un utilisateur peut interagir avec AWX/Tower soit via l'**interface Web** soit via l'**API REST**. Celles-ci fournissent un acc√®s frontal √† toutes les fonctionnalit√©s offertes par AWX/Tower.
2. **Job Initiation** :
* L'utilisateur, via l'interface Web ou l'API, initie une t√¢che bas√©e sur un **mod√®le de t√¢che**.
* Le mod√®le de t√¢che inclut des r√©f√©rences √† l'**inventaire**, au **projet** (contenant le playbook) et aux **identifiants**.
* Lors de l'initiation de la t√¢che, une demande est envoy√©e au backend d'AWX/Tower pour mettre la t√¢che en file d'attente pour ex√©cution.
3. **Job Queuing** :
* **RabbitMQ** g√®re la messagerie entre le composant web et les ex√©cuteurs de t√¢ches. Une fois qu'une t√¢che est initi√©e, un message est envoy√© au moteur de t√¢ches en utilisant RabbitMQ.
* **Redis** agit comme le backend pour la file d'attente des t√¢ches, g√©rant les t√¢ches en attente d'ex√©cution.
4. **Job Execution** :
* Le **moteur de t√¢ches** prend la t√¢che en file d'attente. Il r√©cup√®re les informations n√©cessaires √† partir de la **base de donn√©es** concernant le playbook associ√© √† la t√¢che, l'inventaire et les identifiants.
* En utilisant le playbook Ansible r√©cup√©r√© du **projet** associ√©, le moteur de t√¢ches ex√©cute le playbook contre les n≈ìuds de l'**inventaire** sp√©cifi√© en utilisant les **identifiants** fournis.
* Au fur et √† mesure que le playbook s'ex√©cute, sa sortie d'ex√©cution (journaux, faits, etc.) est captur√©e et stock√©e dans la **base de donn√©es**.
5. **Job Results** :
* Une fois que le playbook a termin√© son ex√©cution, les r√©sultats (succ√®s, √©chec, journaux) sont enregistr√©s dans la **base de donn√©es**.
* Les utilisateurs peuvent ensuite consulter les r√©sultats via l'interface Web ou les interroger via l'API REST.
* En fonction des r√©sultats des t√¢ches, des **notifications** peuvent √™tre envoy√©es pour informer les utilisateurs ou les syst√®mes externes de l'√©tat de la t√¢che. Les notifications peuvent √™tre des e-mails, des messages Slack, des webhooks, etc.
6. **External Systems Integration** :
* Les **inventaires** peuvent √™tre r√©cup√©r√©s dynamiquement √† partir de syst√®mes externes, permettant √† AWX/Tower de tirer des h√¥tes de sources comme AWS, Azure, VMware, et plus encore.
* Les **projets** (playbooks) peuvent √™tre r√©cup√©r√©s √† partir de syst√®mes de contr√¥le de version, garantissant l'utilisation de playbooks √† jour lors de l'ex√©cution des t√¢ches.
* Les **planificateurs et rappels** peuvent √™tre utilis√©s pour s'int√©grer √† d'autres syst√®mes ou outils, permettant √† AWX/Tower de r√©agir √† des d√©clencheurs externes ou d'ex√©cuter des t√¢ches √† des moments pr√©d√©termin√©s.

### AWX lab creation for testing

[**Following the docs**](https://github.com/ansible/awx/blob/devel/tools/docker-compose/README.md) il est possible d'utiliser docker-compose pour ex√©cuter AWX :

{% code overflow="wrap" %}
```bash
git clone -b x.y.z https://github.com/ansible/awx.git # Get in x.y.z the latest release version

cd awx

# Build
make docker-compose-build

# Run
make docker-compose

# Or to create a more complex env
MAIN_NODE_TYPE=control EXECUTION_NODE_COUNT=2 COMPOSE_TAG=devel make docker-compose

# Clean and build the UI
docker exec tools_awx_1 make clean-ui ui-devel

# Once migrations are completed and the UI is built, you can begin using AWX. The UI can be reached in your browser at https://localhost:8043/#/home, and the API can be found at https://localhost:8043/api/v2.

# Create an admin user
docker exec -ti tools_awx_1 awx-manage createsuperuser

# Load demo data
docker exec tools_awx_1 awx-manage create_preload_data
```
{% endcode %}

## RBAC

### R√¥les pris en charge

Le r√¥le le plus privil√©gi√© s'appelle **Administrateur Syst√®me**. Quiconque a ce r√¥le peut **modifier n'importe quoi**.

D'un examen de **s√©curit√© en bo√Æte blanche**, vous auriez besoin du **r√¥le d'Auditeur Syst√®me**, qui permet de **voir toutes les donn√©es du syst√®me** mais ne peut apporter aucune modification. Une autre option serait d'obtenir le **r√¥le d'Auditeur d'Organisation**, mais il serait pr√©f√©rable d'obtenir l'autre.

<details>

<summary>D√©veloppez ceci pour obtenir une description d√©taill√©e des r√¥les disponibles</summary>

1. **Administrateur Syst√®me**:
* C'est le r√¥le de superutilisateur avec des permissions pour acc√©der et modifier n'importe quelle ressource dans le syst√®me.
* Ils peuvent g√©rer toutes les organisations, √©quipes, projets, inventaires, mod√®les de travail, etc.
2. **Auditeur Syst√®me**:
* Les utilisateurs avec ce r√¥le peuvent voir toutes les donn√©es du syst√®me mais ne peuvent apporter aucune modification.
* Ce r√¥le est con√ßu pour la conformit√© et la supervision.
3. **R√¥les d'Organisation**:
* **Admin**: Contr√¥le total sur les ressources de l'organisation.
* **Auditeur**: Acc√®s en lecture seule aux ressources de l'organisation.
* **Membre**: Adh√©sion de base √† une organisation sans permissions sp√©cifiques.
* **Ex√©cuter**: Peut ex√©cuter des mod√®les de travail au sein de l'organisation.
* **Lire**: Peut voir les ressources de l'organisation.
4. **R√¥les de Projet**:
* **Admin**: Peut g√©rer et modifier le projet.
* **Utiliser**: Peut utiliser le projet dans un mod√®le de travail.
* **Mettre √† jour**: Peut mettre √† jour le projet en utilisant SCM (contr√¥le de version).
5. **R√¥les d'Inventaire**:
* **Admin**: Peut g√©rer et modifier l'inventaire.
* **Ad Hoc**: Peut ex√©cuter des commandes ad hoc sur l'inventaire.
* **Mettre √† jour**: Peut mettre √† jour la source de l'inventaire.
* **Utiliser**: Peut utiliser l'inventaire dans un mod√®le de travail.
* **Lire**: Acc√®s en lecture seule.
6. **R√¥les de Mod√®le de Travail**:
* **Admin**: Peut g√©rer et modifier le mod√®le de travail.
* **Ex√©cuter**: Peut ex√©cuter le travail.
* **Lire**: Acc√®s en lecture seule.
7. **R√¥les de Credential**:
* **Admin**: Peut g√©rer et modifier les identifiants.
* **Utiliser**: Peut utiliser les identifiants dans des mod√®les de travail ou d'autres ressources pertinentes.
* **Lire**: Acc√®s en lecture seule.
8. **R√¥les d'√âquipe**:
* **Membre**: Partie de l'√©quipe mais sans permissions sp√©cifiques.
* **Admin**: Peut g√©rer les membres de l'√©quipe et les ressources associ√©es.
9. **R√¥les de Workflow**:
* **Admin**: Peut g√©rer et modifier le workflow.
* **Ex√©cuter**: Peut ex√©cuter le workflow.
* **Lire**: Acc√®s en lecture seule.

</details>

{% hint style="success" %}
Apprenez et pratiquez le Hacking AWS:<img src="../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Formation AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../.gitbook/assets/image (1).png" alt="" data-size="line">\
Apprenez et pratiquez le Hacking GCP: <img src="../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Formation GCP Red Team Expert (GRTE)**<img src="../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Soutenir HackTricks</summary>

* Consultez les [**plans d'abonnement**](https://github.com/sponsors/carlospolop)!
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez-nous sur** **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Partagez des astuces de hacking en soumettant des PRs aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) d√©p√¥ts github.

</details>
{% endhint %}
