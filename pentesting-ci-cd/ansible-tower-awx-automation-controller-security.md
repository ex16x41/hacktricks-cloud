# Ansible Tower / AWX / Automation controller Security

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../.gitbook/assets/image (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../.gitbook/assets/image (1) (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** 游눫 [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** 游냕 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Basic Information

**Ansible Tower** ili njegova open-source verzija [**AWX**](https://github.com/ansible/awx) je tako캠e poznata kao **Ansible-ov korisni캜ki interfejs, kontrolna tabla i REST API**. Sa **kontrolom pristupa zasnovanom na rolama**, zakazivanjem poslova i grafi캜kim upravljanjem inventarom, mo쬰te upravljati svojom Ansible infrastrukturom iz modernog UI-a. Tower-ov REST API i komandna linija olak코avaju integraciju u trenutne alate i radne tokove.

**Automation Controller je novija** verzija Ansible Tower-a sa vi코e mogu캖nosti.

### Differences

Prema [**ovome**](https://blog.devops.dev/ansible-tower-vs-awx-under-the-hood-65cfec78db00), glavne razlike izme캠u Ansible Tower-a i AWX-a su podr코ka koja se dobija, a Ansible Tower ima dodatne funkcije kao 코to su kontrola pristupa zasnovana na rolama, podr코ka za prilago캠ene API-je i korisni캜ki definisani radni tokovi.

### Tech Stack

* **Web Interface**: Ovo je grafi캜ki interfejs gde korisnici mogu upravljati inventarima, akreditivima, 코ablonima i poslovima. Dizajniran je da bude intuitivan i pru쬬 vizualizacije koje poma쬿 u razumevanju stanja i rezultata va코ih automatizovanih poslova.
* **REST API**: Sve 코to mo쬰te da uradite u web interfejsu, mo쬰te tako캠e uraditi putem REST API-ja. To zna캜i da mo쬰te integrisati AWX/Tower sa drugim sistemima ili skriptovati radnje koje biste obi캜no izvodili u interfejsu.
* **Database**: AWX/Tower koristi bazu podataka (obi캜no PostgreSQL) za 캜uvanje svoje konfiguracije, rezultata poslova i drugih neophodnih operativnih podataka.
* **RabbitMQ**: Ovo je sistem za razmenu poruka koji koristi AWX/Tower za komunikaciju izme캠u razli캜itih komponenti, posebno izme캠u web servisa i izvr코itelja zadataka.
* **Redis**: Redis slu쬴 kao ke코 i pozadinski sistem za red zadataka.

### Logical Components

* **Inventories**: Inventar je **kolekcija hostova (ili 캜vorova)** protiv kojih se **poslovi** (Ansible playbooks) mogu **izvr코avati**. AWX/Tower vam omogu캖ava da defini코ete i grupi코ete svoje inventare i tako캠e podr쬬va dinami캜ke inventare koji mogu **pribaviti liste hostova iz drugih sistema** kao 코to su AWS, Azure, itd.
* **Projects**: Projekat je u su코tini **kolekcija Ansible playbook-a** preuzetih iz **sistema za kontrolu verzija** (kao 코to je Git) kako bi se povukli najnoviji playbook-ovi kada je to potrebno.
* **Templates**: 마bloni poslova defini코u **kako 캖e se odre캠eni playbook izvr코iti**, specificiraju캖i **inventar**, **akreditive** i druge **parametre** za posao.
* **Credentials**: AWX/Tower pru쬬 siguran na캜in za **upravljanje i 캜uvanje tajni, kao 코to su SSH klju캜evi, lozinke i API tokeni**. Ovi akreditivi mogu biti povezani sa 코ablonima poslova kako bi playbook-ovi imali neophodan pristup kada se izvr코avaju.
* **Task Engine**: Ovo je mesto gde se de코ava magija. Task engine je izgra캠en na Ansible-u i odgovoran je za **izvr코avanje playbook-ova**. Poslovi se 코alju task engine-u, koji zatim izvr코ava Ansible playbook-ove protiv odre캠enog inventara koriste캖i specificirane akreditive.
* **Schedulers and Callbacks**: Ovo su napredne funkcije u AWX/Tower-u koje omogu캖avaju **zakazivanje poslova** da se izvr코avaju u odre캠enim vremenima ili da budu pokrenuti spoljnim doga캠ajima.
* **Notifications**: AWX/Tower mo쬰 slati obave코tenja na osnovu uspeha ili neuspeha poslova. Podr쬬va razli캜ite na캜ine obave코tavanja kao 코to su e-mailovi, Slack poruke, webhooks, itd.
* **Ansible Playbooks**: Ansible playbook-ovi su alati za konfiguraciju, implementaciju i orkestraciju. Oni opisuju 쬰ljeno stanje sistema na automatizovan i ponovljiv na캜in. Napisani u YAML-u, playbook-ovi koriste Ansible-ov deklarativni jezik automatizacije za opisivanje konfiguracija, zadataka i koraka koji treba da se izvr코e.

### Job Execution Flow

1. **User Interaction**: Korisnik mo쬰 interagovati sa AWX/Tower-om ili putem **Web Interface** ili **REST API**. Ovi pru쬬ju front-end pristup svim funkcionalnostima koje nudi AWX/Tower.
2. **Job Initiation**:
* Korisnik, putem Web Interface-a ili API-ja, pokre캖e posao na osnovu **Job Template**.
* Job Template uklju캜uje reference na **Inventory**, **Project** (koji sadr쬴 playbook) i **Credentials**.
* Po pokretanju posla, zahtev se 코alje AWX/Tower pozadini da se posao stavi u red za izvr코enje.
3. **Job Queuing**:
* **RabbitMQ** upravlja razmenom poruka izme캠u web komponente i izvr코itelja zadataka. Kada se posao pokrene, poruka se 코alje task engine-u koriste캖i RabbitMQ.
* **Redis** deluje kao pozadinski sistem za red zadataka, upravljaju캖i redom poslova koji 캜ekaju na izvr코enje.
4. **Job Execution**:
* **Task Engine** preuzima posao iz reda. Preuzima potrebne informacije iz **Database** o povezanom playbook-u, inventaru i akreditivima.
* Koriste캖i preuzeti Ansible playbook iz povezanog **Project**, Task Engine izvr코ava playbook protiv specificiranih **Inventory** 캜vorova koriste캖i pru쬰ne **Credentials**.
* Dok se playbook izvr코ava, njegov izlaz (logovi, 캜injenice, itd.) se bele쬴 i 캜uva u **Database**.
5. **Job Results**:
* Kada se playbook zavr코i, rezultati (uspeh, neuspeh, logovi) se 캜uvaju u **Database**.
* Korisnici mogu pregledati rezultate putem Web Interface-a ili ih upititi putem REST API-ja.
* Na osnovu ishoda posla, **Notifications** se mogu slati kako bi obavestili korisnike ili spoljne sisteme o statusu posla. Obave코tenja mogu biti e-mailovi, Slack poruke, webhooks, itd.
6. **External Systems Integration**:
* **Inventories** se mogu dinami캜ki preuzimati iz spoljnjih sistema, omogu캖avaju캖i AWX/Tower-u da povu캜e hostove iz izvora kao 코to su AWS, Azure, VMware i drugi.
* **Projects** (playbook-ovi) mogu se preuzeti iz sistema za kontrolu verzija, osiguravaju캖i kori코캖enje a쬿riranih playbook-ova tokom izvr코enja posla.
* **Schedulers and Callbacks** mogu se koristiti za integraciju sa drugim sistemima ili alatima, omogu캖avaju캖i AWX/Tower-u da reaguje na spoljne okida캜e ili izvr코ava poslove u unapred odre캠enim vremenima.

### AWX lab creation for testing

[**Following the docs**](https://github.com/ansible/awx/blob/devel/tools/docker-compose/README.md) mogu캖e je koristiti docker-compose za pokretanje AWX:

{% code overflow="wrap" %}
```bash
git clone -b x.y.z https://github.com/ansible/awx.git # Get in x.y.z the latest release version

cd awx

# Build
make docker-compose-build

# Run
make docker-compose

# Or to create a more complex env
MAIN_NODE_TYPE=control EXECUTION_NODE_COUNT=2 COMPOSE_TAG=devel make docker-compose

# Clean and build the UI
docker exec tools_awx_1 make clean-ui ui-devel

# Once migrations are completed and the UI is built, you can begin using AWX. The UI can be reached in your browser at https://localhost:8043/#/home, and the API can be found at https://localhost:8043/api/v2.

# Create an admin user
docker exec -ti tools_awx_1 awx-manage createsuperuser

# Load demo data
docker exec tools_awx_1 awx-manage create_preload_data
```
{% endcode %}

## RBAC

### Podr쬬ne uloge

Najprivilegovanija uloga se zove **Sistem Administrator**. Svako ko ima ovu ulogu mo쬰 **modifikovati bilo 코ta**.

Iz **bele kutije bezbednosti**, potrebna vam je **uloga Sistem Revizora**, koja omogu캖ava **pregled svih podataka sistema** ali ne mo쬰 da vr코i nikakve izmene. Druga opcija bi bila da dobijete **ulogu Revizora Organizacije**, ali bi bilo bolje da dobijete onu prvu.

<details>

<summary>Pro코irite ovo da dobijete detaljan opis dostupnih uloga</summary>

1. **Sistem Administrator**:
* Ovo je superkorisni캜ka uloga sa dozvolama za pristup i modifikaciju bilo kog resursa u sistemu.
* Mogu upravljati svim organizacijama, timovima, projektima, inventarima, 코ablonima poslova, itd.
2. **Sistem Revizor**:
* Korisnici sa ovom ulogom mogu da vide sve podatke sistema, ali ne mogu da vr코e nikakve izmene.
* Ova uloga je dizajnirana za uskla캠enost i nadzor.
3. **Uloge Organizacije**:
* **Admin**: Potpuna kontrola nad resursima organizacije.
* **Revizor**: Pristup samo za pregled resursa organizacije.
* **캛lan**: Osnovno 캜lanstvo u organizaciji bez specifi캜nih dozvola.
* **Izvr코i**: Mo쬰 pokretati 코ablone poslova unutar organizacije.
* **캛itaj**: Mo쬰 pregledati resurse organizacije.
4. **Uloge Projekta**:
* **Admin**: Mo쬰 upravljati i modifikovati projekat.
* **Koristi**: Mo쬰 koristiti projekat u 코ablonu posla.
* **A쬿riraj**: Mo쬰 a쬿rirati projekat koriste캖i SCM (kontrola verzija).
5. **Uloge Inventara**:
* **Admin**: Mo쬰 upravljati i modifikovati inventar.
* **Ad Hoc**: Mo쬰 izvr코avati ad hoc komande na inventaru.
* **A쬿riraj**: Mo쬰 a쬿rirati izvor inventara.
* **Koristi**: Mo쬰 koristiti inventar u 코ablonu posla.
* **캛itaj**: Pristup samo za pregled.
6. **Uloge 마blona Posla**:
* **Admin**: Mo쬰 upravljati i modifikovati 코ablon posla.
* **Izvr코i**: Mo쬰 pokrenuti posao.
* **캛itaj**: Pristup samo za pregled.
7. **Uloge Akreditiva**:
* **Admin**: Mo쬰 upravljati i modifikovati akreditive.
* **Koristi**: Mo쬰 koristiti akreditive u 코ablonima poslova ili drugim relevantnim resursima.
* **캛itaj**: Pristup samo za pregled.
8. **Uloge Tima**:
* **캛lan**: Deo tima, ali bez specifi캜nih dozvola.
* **Admin**: Mo쬰 upravljati 캜lanovima tima i povezanim resursima.
9. **Uloge Radnog Tok**:
* **Admin**: Mo쬰 upravljati i modifikovati radni tok.
* **Izvr코i**: Mo쬰 pokrenuti radni tok.
* **캛itaj**: Pristup samo za pregled.

</details>

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../.gitbook/assets/image (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../.gitbook/assets/image (1) (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** 游눫 [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** 游냕 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
