# Ansible Tower / AWX / Automation controller Security

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../.gitbook/assets/image (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../.gitbook/assets/image (1) (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the**  [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter**  [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Basic Information

**Ansible Tower** lub jego wersja open source [**AWX**](https://github.com/ansible/awx) jest znany jako **interfejs u偶ytkownika Ansible, pulpit nawigacyjny i REST API**. Dziki **kontroli dostpu opartej na rolach**, harmonogramowaniu zada i graficznemu zarzdzaniu inwentarzem, mo偶esz zarzdza swoj infrastruktur Ansible z nowoczesnego interfejsu. REST API Towera i interfejs wiersza polece uatwiaj integracj z obecnymi narzdziami i przepywami pracy.

**Automation Controller to nowsza** wersja Ansible Tower z wikszymi mo偶liwociami.

### Differences

Zgodnie z [**tym**](https://blog.devops.dev/ansible-tower-vs-awx-under-the-hood-65cfec78db00), g贸wne r贸偶nice midzy Ansible Tower a AWX to otrzymywane wsparcie, a Ansible Tower ma dodatkowe funkcje, takie jak kontrola dostpu oparta na rolach, wsparcie dla niestandardowych API i zdefiniowane przez u偶ytkownika przepywy pracy.

### Tech Stack

* **Web Interface**: To graficzny interfejs, w kt贸rym u偶ytkownicy mog zarzdza inwentarzami, powiadczeniami, szablonami i zadaniami. Zosta zaprojektowany tak, aby by intuicyjny i zapewnia wizualizacje, kt贸re pomagaj w zrozumieniu stanu i wynik贸w twoich zada automatyzacji.
* **REST API**: Wszystko, co mo偶esz zrobi w interfejsie webowym, mo偶esz r贸wnie偶 zrobi za pomoc REST API. Oznacza to, 偶e mo偶esz zintegrowa AWX/Tower z innymi systemami lub skryptowa dziaania, kt贸re zazwyczaj wykonujesz w interfejsie.
* **Database**: AWX/Tower u偶ywa bazy danych (zazwyczaj PostgreSQL) do przechowywania swojej konfiguracji, wynik贸w zada i innych niezbdnych danych operacyjnych.
* **RabbitMQ**: To system komunikacji u偶ywany przez AWX/Tower do komunikacji midzy r贸偶nymi komponentami, szczeg贸lnie midzy usug webow a wykonawcami zada.
* **Redis**: Redis su偶y jako pami podrczna i zaplecze dla kolejki zada.

### Logical Components

* **Inventories**: Inwentarz to **zbi贸r host贸w (lub wz贸w)**, na kt贸rych mog by **uruchamiane zadania** (playbooki Ansible). AWX/Tower pozwala na definiowanie i grupowanie inwentarzy oraz wspiera dynamiczne inwentarze, kt贸re mog **pobiera listy host贸w z innych system贸w** takich jak AWS, Azure itp.
* **Projects**: Projekt to zasadniczo **zbi贸r playbook贸w Ansible** pochodzcych z **systemu kontroli wersji** (takiego jak Git), aby pobiera najnowsze playbooki w razie potrzeby.
* **Templates**: Szablony zada definiuj **jak dany playbook bdzie uruchamiany**, okrelajc **inwentarz**, **powiadczenia** i inne **parametry** dla zadania.
* **Credentials**: AWX/Tower zapewnia bezpieczny spos贸b **zarzdzania i przechowywania sekret贸w, takich jak klucze SSH, hasa i tokeny API**. Te powiadczenia mog by powizane z szablonami zada, aby playbooki miay niezbdny dostp podczas uruchamiania.
* **Task Engine**: To tutaj dzieje si magia. Silnik zada oparty jest na Ansible i odpowiada za **uruchamianie playbook贸w**. Zadania s przekazywane do silnika zada, kt贸ry nastpnie uruchamia playbooki Ansible na wyznaczonym inwentarzu, u偶ywajc okrelonych powiadcze.
* **Schedulers and Callbacks**: To zaawansowane funkcje w AWX/Tower, kt贸re pozwalaj na **harmonogramowanie zada** do uruchamiania w okrelonych czasach lub wyzwalane przez zdarzenia zewntrzne.
* **Notifications**: AWX/Tower mo偶e wysya powiadomienia w zale偶noci od sukcesu lub niepowodzenia zada. Obsuguje r贸偶ne formy powiadomie, takie jak e-maile, wiadomoci Slack, webhooki itp.
* **Ansible Playbooks**: Playbooki Ansible to narzdzia do konfiguracji, wdra偶ania i orkiestracji. Opisuj po偶dany stan system贸w w spos贸b zautomatyzowany i powtarzalny. Napisane w YAML, playbooki u偶ywaj deklaratywnego jzyka automatyzacji Ansible do opisywania konfiguracji, zada i krok贸w, kt贸re musz by wykonane.

### Job Execution Flow

1. **User Interaction**: U偶ytkownik mo偶e interagowa z AWX/Tower za porednictwem **Web Interface** lub **REST API**. Te zapewniaj dostp front-end do wszystkich funkcji oferowanych przez AWX/Tower.
2. **Job Initiation**:
* U偶ytkownik, za porednictwem interfejsu webowego lub API, inicjuje zadanie na podstawie **Job Template**.
* Szablon zadania zawiera odniesienia do **Inwentarza**, **Projektu** (zawierajcego playbook) i **Powiadcze**.
* Po inicjacji zadania, 偶danie jest wysyane do backendu AWX/Tower, aby umieci zadanie w kolejce do wykonania.
3. **Job Queuing**:
* **RabbitMQ** obsuguje komunikacj midzy komponentem webowym a wykonawcami zada. Gdy zadanie jest inicjowane, wiadomo jest wysyana do silnika zada za pomoc RabbitMQ.
* **Redis** dziaa jako zaplecze dla kolejki zada, zarzdzajc zadaniami w kolejce oczekujcymi na wykonanie.
4. **Job Execution**:
* **Task Engine** odbiera zadanie z kolejki. Pobiera niezbdne informacje z **Database** o powizanym playbooku, inwentarzu i powiadczeniach.
* U偶ywajc pobranego playbooka Ansible z powizanego **Projektu**, silnik zada uruchamia playbook na wyznaczonych wzach **Inwentarza** przy u偶yciu podanych **Powiadcze**.
* W miar uruchamiania playbooka, jego wyniki wykonania (logi, fakty itp.) s rejestrowane i przechowywane w **Database**.
5. **Job Results**:
* Po zakoczeniu uruchamiania playbooka, wyniki (sukces, niepowodzenie, logi) s zapisywane w **Database**.
* U偶ytkownicy mog nastpnie przeglda wyniki za porednictwem interfejsu webowego lub zapyta je za pomoc REST API.
* W zale偶noci od wynik贸w zada, **Notifications** mog by wysyane, aby informowa u偶ytkownik贸w lub zewntrzne systemy o statusie zadania. Powiadomienia mog by e-mailami, wiadomociami Slack, webhookami itp.
6. **External Systems Integration**:
* **Inventories** mog by dynamicznie pozyskiwane z zewntrznych system贸w, co pozwala AWX/Tower na pobieranie host贸w z takich 藕r贸de jak AWS, Azure, VMware i inne.
* **Projects** (playbooki) mog by pobierane z system贸w kontroli wersji, zapewniajc u偶ycie aktualnych playbook贸w podczas wykonywania zada.
* **Schedulers and Callbacks** mog by u偶ywane do integracji z innymi systemami lub narzdziami, co sprawia, 偶e AWX/Tower reaguje na zewntrzne wyzwalacze lub uruchamia zadania w ustalonych czasach.

### AWX lab creation for testing

[**Following the docs**](https://github.com/ansible/awx/blob/devel/tools/docker-compose/README.md) mo偶na u偶y docker-compose do uruchomienia AWX:

{% code overflow="wrap" %}
```bash
git clone -b x.y.z https://github.com/ansible/awx.git # Get in x.y.z the latest release version

cd awx

# Build
make docker-compose-build

# Run
make docker-compose

# Or to create a more complex env
MAIN_NODE_TYPE=control EXECUTION_NODE_COUNT=2 COMPOSE_TAG=devel make docker-compose

# Clean and build the UI
docker exec tools_awx_1 make clean-ui ui-devel

# Once migrations are completed and the UI is built, you can begin using AWX. The UI can be reached in your browser at https://localhost:8043/#/home, and the API can be found at https://localhost:8043/api/v2.

# Create an admin user
docker exec -ti tools_awx_1 awx-manage createsuperuser

# Load demo data
docker exec tools_awx_1 awx-manage create_preload_data
```
{% endcode %}

## RBAC

### Obsugiwane role

Najbardziej uprzywilejowan rol jest **Administrator Systemu**. Ka偶dy, kto ma t rol, mo偶e **modyfikowa wszystko**.

Z perspektywy **przegldu bezpieczestwa biaej skrzynki**, potrzebujesz roli **Audytora Systemu**, kt贸ra pozwala na **przegldanie wszystkich danych systemowych**, ale nie mo偶e wprowadza 偶adnych zmian. Inn opcj byoby uzyskanie roli **Audytora Organizacji**, ale lepiej byoby uzyska t drug.

<details>

<summary>Rozwi, aby uzyska szczeg贸owy opis dostpnych r贸l</summary>

1. **Administrator Systemu**:
* To rola superu偶ytkownika z uprawnieniami do dostpu i modyfikacji ka偶dego zasobu w systemie.
* Mo偶e zarzdza wszystkimi organizacjami, zespoami, projektami, inwentarzami, szablonami zada itp.
2. **Audytor Systemu**:
* U偶ytkownicy z t rol mog przeglda wszystkie dane systemowe, ale nie mog wprowadza 偶adnych zmian.
* Ta rola jest zaprojektowana dla zgodnoci i nadzoru.
3. **Role Organizacji**:
* **Admin**: Pena kontrola nad zasobami organizacji.
* **Audytor**: Tylko dostp do przegldania zasob贸w organizacji.
* **Czonek**: Podstawowe czonkostwo w organizacji bez 偶adnych specyficznych uprawnie.
* **Wykonaj**: Mo偶e uruchamia szablony zada w organizacji.
* **Przeczytaj**: Mo偶e przeglda zasoby organizacji.
4. **Role Projekt贸w**:
* **Admin**: Mo偶e zarzdza i modyfikowa projekt.
* **U偶yj**: Mo偶e u偶ywa projektu w szablonie zada.
* **Aktualizuj**: Mo偶e aktualizowa projekt za pomoc SCM (kontrola wersji).
5. **Role Inwentarza**:
* **Admin**: Mo偶e zarzdza i modyfikowa inwentarz.
* **Ad Hoc**: Mo偶e uruchamia polecenia ad hoc na inwentarzu.
* **Aktualizuj**: Mo偶e aktualizowa 藕r贸do inwentarza.
* **U偶yj**: Mo偶e u偶ywa inwentarza w szablonie zada.
* **Przeczytaj**: Tylko dostp do przegldania.
6. **Role Szablon贸w Zada**:
* **Admin**: Mo偶e zarzdza i modyfikowa szablon zada.
* **Wykonaj**: Mo偶e uruchomi zadanie.
* **Przeczytaj**: Tylko dostp do przegldania.
7. **Role Powiadcze**:
* **Admin**: Mo偶e zarzdza i modyfikowa powiadczenia.
* **U偶yj**: Mo偶e u偶ywa powiadcze w szablonach zada lub innych odpowiednich zasobach.
* **Przeczytaj**: Tylko dostp do przegldania.
8. **Role Zespo贸w**:
* **Czonek**: Cz zespou, ale bez 偶adnych specyficznych uprawnie.
* **Admin**: Mo偶e zarzdza czonkami zespou i powizanymi zasobami.
9. **Role Przepywu Pracy**:
* **Admin**: Mo偶e zarzdza i modyfikowa przepyw pracy.
* **Wykonaj**: Mo偶e uruchomi przepyw pracy.
* **Przeczytaj**: Tylko dostp do przegldania.

</details>

{% hint style="success" %}
Ucz si i wicz Hacking AWS:<img src="../.gitbook/assets/image (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../.gitbook/assets/image (1) (1).png" alt="" data-size="line">\
Ucz si i wicz Hacking GCP: <img src="../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Wsparcie HackTricks</summary>

* Sprawd藕 [**plany subskrypcyjne**](https://github.com/sponsors/carlospolop)!
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegram**](https://t.me/peass) lub **led藕** nas na **Twitterze**  [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podziel si trikami hackingowymi, przesyajc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repozytori贸w github.

</details>
{% endhint %}
