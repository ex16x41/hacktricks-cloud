# Kubernetesã®ãƒãƒ¼ãƒ‰ãƒ‹ãƒ³ã‚°

{% hint style="success" %}
AWSãƒãƒƒã‚­ãƒ³ã‚°ã®å­¦ç¿’ã¨ç·´ç¿’:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCPãƒãƒƒã‚­ãƒ³ã‚°ã®å­¦ç¿’ã¨ç·´ç¿’: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricksã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹</summary>

* [**ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³**](https://github.com/sponsors/carlospolop)ã‚’ãƒã‚§ãƒƒã‚¯ï¼
* ğŸ’¬ [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã«å‚åŠ ã™ã‚‹ã‹ã€[**telegramã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«å‚åŠ ã™ã‚‹ã‹ã€**Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**ã‚’ãƒ•ã‚©ãƒ­ãƒ¼**ã—ã¦ãã ã•ã„ã€‚
* **HackTricks**ã¨[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)ã®GitHubãƒªãƒã‚¸ãƒˆãƒªã«PRã‚’æå‡ºã—ã¦ãƒãƒƒã‚­ãƒ³ã‚°ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã—ã¦ãã ã•ã„ã€‚

</details>
{% endhint %}

## ã‚¯ãƒ©ã‚¹ã‚¿ã‚’åˆ†æã™ã‚‹ãŸã‚ã®ãƒ„ãƒ¼ãƒ«

### [**Kubescape**](https://github.com/armosec/kubescape)

[**Kubescape**](https://github.com/armosec/kubescape)ã¯ã€K8sã®ã‚ªãƒ¼ãƒ—ãƒ³ã‚½ãƒ¼ã‚¹ãƒ„ãƒ¼ãƒ«ã§ã€ãƒªã‚¹ã‚¯åˆ†æã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚³ãƒ³ãƒ—ãƒ©ã‚¤ã‚¢ãƒ³ã‚¹ã€RBACãƒ“ã‚¸ãƒ¥ã‚¢ãƒ©ã‚¤ã‚¶ãƒ¼ã€ãŠã‚ˆã³ã‚¤ãƒ¡ãƒ¼ã‚¸ã®è„†å¼±æ€§ã‚¹ã‚­ãƒ£ãƒ³ã‚’æä¾›ã™ã‚‹ãƒãƒ«ãƒã‚¯ãƒ©ã‚¦ãƒ‰K8sã‚·ãƒ³ã‚°ãƒ«ãƒšã‚¤ãƒ³ã‚ªãƒ–ã‚°ãƒ©ã‚¹ã§ã™ã€‚Kubescapeã¯ã€K8sã‚¯ãƒ©ã‚¹ã‚¿ã€YAMLãƒ•ã‚¡ã‚¤ãƒ«ã€HELMãƒãƒ£ãƒ¼ãƒˆã‚’ã‚¹ã‚­ãƒ£ãƒ³ã—ã€è¤‡æ•°ã®ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ï¼ˆ[NSA-CISA](https://www.armosec.io/blog/kubernetes-hardening-guidance-summary-by-armo)ã€[MITRE ATT\&CKÂ®](https://www.microsoft.com/security/blog/2021/03/23/secure-containerized-environments-with-updated-threat-matrix-for-kubernetes/)ãªã©ï¼‰ã«å¾“ã£ã¦ãƒŸã‚¹æ§‹æˆã‚’æ¤œå‡ºã—ã€ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã®è„†å¼±æ€§ã‚„RBACï¼ˆãƒ­ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡ï¼‰ã®é•åã‚’CI/CDãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã®åˆæœŸæ®µéšã§è¨ˆç®—ã—ã€ãƒªã‚¹ã‚¯ã‚¹ã‚³ã‚¢ã‚’å³åº§ã«è¡¨ç¤ºã—ã€æ™‚é–“ã®çµŒéã¨ã¨ã‚‚ã«ãƒªã‚¹ã‚¯ãƒˆãƒ¬ãƒ³ãƒ‰ã‚’è¡¨ç¤ºã—ã¾ã™ã€‚
```bash
kubescape scan --verbose
```
### [**Kube-bench**](https://github.com/aquasecurity/kube-bench)

ãƒ„ãƒ¼ãƒ«[**kube-bench**](https://github.com/aquasecurity/kube-bench)ã¯ã€[**CIS Kubernetes Benchmark**](https://www.cisecurity.org/benchmark/kubernetes/)ã§æ–‡æ›¸åŒ–ã•ã‚ŒãŸãƒã‚§ãƒƒã‚¯ã‚’å®Ÿè¡Œã—ã¦ã€KubernetesãŒã‚»ã‚­ãƒ¥ã‚¢ã«å±•é–‹ã•ã‚Œã¦ã„ã‚‹ã‹ã©ã†ã‹ã‚’ç¢ºèªã™ã‚‹ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚\
æ¬¡ã®æ–¹æ³•ã§å®Ÿè¡Œã§ãã¾ã™ï¼š

* ãƒ›ã‚¹ãƒˆã¨PIDãƒãƒ¼ãƒ ã‚¹ãƒšãƒ¼ã‚¹ã‚’å…±æœ‰ã™ã‚‹ã‚³ãƒ³ãƒ†ãƒŠå†…ã‹ã‚‰kube-benchã‚’å®Ÿè¡Œã™ã‚‹
* ãƒ›ã‚¹ãƒˆã«kube-benchã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ã‚³ãƒ³ãƒ†ãƒŠã‚’å®Ÿè¡Œã—ã€ãã®å¾Œãƒ›ã‚¹ãƒˆã§kube-benchã‚’ç›´æ¥å®Ÿè¡Œã™ã‚‹
* [ãƒªãƒªãƒ¼ã‚¹ãƒšãƒ¼ã‚¸](https://github.com/aquasecurity/kube-bench/releases)ã‹ã‚‰æœ€æ–°ã®ãƒã‚¤ãƒŠãƒªã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹
* ã‚½ãƒ¼ã‚¹ã‹ã‚‰ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã™ã‚‹ã€‚

### [**Kubeaudit**](https://github.com/Shopify/kubeaudit)

ãƒ„ãƒ¼ãƒ«[**kubeaudit**](https://github.com/Shopify/kubeaudit)ã¯ã€ã•ã¾ã–ã¾ãªã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä¸Šã®æ‡¸å¿µäº‹é …ã«å¯¾ã—ã¦**Kubernetesã‚¯ãƒ©ã‚¹ã‚¿**ã‚’ç›£æŸ»ã™ã‚‹ãŸã‚ã®ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ãƒ„ãƒ¼ãƒ«ãŠã‚ˆã³Goãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã§ã™ã€‚

Kubeauditã¯ã€ã‚¯ãƒ©ã‚¹ã‚¿å†…ã®ã‚³ãƒ³ãƒ†ãƒŠã§å®Ÿè¡Œã•ã‚Œã¦ã„ã‚‹ã‹ã©ã†ã‹ã‚’æ¤œå‡ºã§ãã¾ã™ã€‚ãã®å ´åˆã€ãã®ã‚¯ãƒ©ã‚¹ã‚¿å†…ã®ã™ã¹ã¦ã®Kubernetesãƒªã‚½ãƒ¼ã‚¹ã‚’ç›£æŸ»ã—ã‚ˆã†ã¨ã—ã¾ã™ã€‚
```
kubeaudit all
```
ã“ã®ãƒ„ãƒ¼ãƒ«ã«ã¯ã€æ¤œå‡ºã•ã‚ŒãŸå•é¡Œã‚’**è‡ªå‹•çš„ã«ä¿®æ­£ã™ã‚‹**ãŸã‚ã®å¼•æ•° `autofix` ã‚‚ã‚ã‚Šã¾ã™ã€‚

### [**Kube-hunter**](https://github.com/aquasecurity/kube-hunter)

ãƒ„ãƒ¼ãƒ« [**kube-hunter**](https://github.com/aquasecurity/kube-hunter) ã¯ã€Kubernetes ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼å†…ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä¸Šã®è„†å¼±æ€§ã‚’æ¢ã—ã¾ã™ã€‚ã“ã®ãƒ„ãƒ¼ãƒ«ã¯ã€Kubernetes ç’°å¢ƒã«ãŠã‘ã‚‹ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å•é¡Œã®èªè­˜ã¨å¯è¦–æ€§ã‚’é«˜ã‚ã‚‹ãŸã‚ã«é–‹ç™ºã•ã‚Œã¾ã—ãŸã€‚
```bash
kube-hunter --remote some.node.com
```
### [**Kubei**](https://github.com/Erezf-p/kubei)

[**Kubei**](https://github.com/Erezf-p/kubei)ã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒkubernetesã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã®æ­£ç¢ºã§å³åº§ã®ãƒªã‚¹ã‚¯è©•ä¾¡ã‚’è¡Œã†ã“ã¨ã‚’å¯èƒ½ã«ã™ã‚‹è„†å¼±æ€§ã‚¹ã‚­ãƒ£ãƒ³ãŠã‚ˆã³CIS Dockerãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚Kubeiã¯ã€Kubernetesã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã§ä½¿ç”¨ã•ã‚Œã¦ã„ã‚‹ã™ã¹ã¦ã®ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ã‚¹ã‚­ãƒ£ãƒ³ã—ã¾ã™ã€‚ã“ã‚Œã«ã¯ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒãƒƒãƒ‰ãŠã‚ˆã³ã‚·ã‚¹ãƒ†ãƒ ãƒãƒƒãƒ‰ã®ã‚¤ãƒ¡ãƒ¼ã‚¸ãŒå«ã¾ã‚Œã¾ã™ã€‚

### [**KubiScan**](https://github.com/cyberark/KubiScan)

[**KubiScan**](https://github.com/cyberark/KubiScan)ã¯ã€Kubernetesã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã‚’ã‚¹ã‚­ãƒ£ãƒ³ã—ã¦ã€Kubernetesã®ãƒ­ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡ï¼ˆRBACï¼‰èªå¯ãƒ¢ãƒ‡ãƒ«ã§ã®ãƒªã‚¹ã‚¯ã®ã‚ã‚‹æ¨©é™ã‚’æ¤œå‡ºã™ã‚‹ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚

### [Managed Kubernetes Auditing Toolkit](https://github.com/DataDog/managed-kubernetes-auditing-toolkit)

[**Mkat**](https://github.com/DataDog/managed-kubernetes-auditing-toolkit)ã¯ã€ä»–ã®ç¨®é¡ã®é«˜ãƒªã‚¹ã‚¯ãƒã‚§ãƒƒã‚¯ã‚’ãƒ†ã‚¹ãƒˆã™ã‚‹ãŸã‚ã«æ§‹ç¯‰ã•ã‚ŒãŸãƒ„ãƒ¼ãƒ«ã§ã™ã€‚ä¸»ã«3ã¤ã®ç•°ãªã‚‹ãƒ¢ãƒ¼ãƒ‰ãŒã‚ã‚Šã¾ã™ï¼š

* **`find-role-relationships`**: AWSãƒ­ãƒ¼ãƒ«ãŒã©ã®ãƒãƒƒãƒ‰ã§å®Ÿè¡Œã•ã‚Œã¦ã„ã‚‹ã‹ã‚’è¦‹ã¤ã‘ã¾ã™
* **`find-secrets`**: ãƒãƒƒãƒ‰ã€ConfigMapsã€Secretsãªã©ã®K8sãƒªã‚½ãƒ¼ã‚¹å†…ã®ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚’ç‰¹å®šã—ã‚ˆã†ã¨ã—ã¾ã™ã€‚
* **`test-imds-access`**: ãƒãƒƒãƒ‰ã‚’å®Ÿè¡Œã—ã€ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿v1ãŠã‚ˆã³v2ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã‚ˆã†ã¨ã—ã¾ã™ã€‚è­¦å‘Šï¼šã“ã‚Œã«ã‚ˆã‚Šã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼å†…ã§ãƒãƒƒãƒ‰ãŒå®Ÿè¡Œã•ã‚Œã‚‹ãŸã‚ã€ã“ã‚Œã‚’è¡Œã„ãŸããªã„å ´åˆãŒã‚ã‚‹ãŸã‚ã€éå¸¸ã«æ³¨æ„ã—ã¦ãã ã•ã„ï¼

## **IaCã‚³ãƒ¼ãƒ‰ã®ç›£æŸ»**

### [**Popeye**](https://github.com/derailed/popeye)

[**Popeye**](https://github.com/derailed/popeye)ã¯ã€ãƒ©ã‚¤ãƒ–Kubernetesã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã‚’ã‚¹ã‚­ãƒ£ãƒ³ã—ã€**ãƒ‡ãƒ—ãƒ­ã‚¤ã•ã‚ŒãŸãƒªã‚½ãƒ¼ã‚¹ã¨æ§‹æˆã«é–¢ã™ã‚‹æ½œåœ¨çš„ãªå•é¡Œã‚’å ±å‘Š**ã™ã‚‹ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ã§ã™ã€‚ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã‚’ã‚¹ã‚­ãƒ£ãƒ³ã™ã‚‹ã“ã¨ã§ã€ãƒŸã‚¹æ§‹æˆã‚’æ¤œå‡ºã—ã€ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ãŒé©ç”¨ã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã€å°†æ¥ã®å•é¡Œã‚’é˜²ãã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€é‡ç”Ÿã®Kubernetesã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã‚’æ“ä½œã™ã‚‹éš›ã«ç›´é¢ã™ã‚‹èªçŸ¥è² è·ã‚’è»½æ¸›ã™ã‚‹ã“ã¨ã‚’ç›®æŒ‡ã—ã¦ã„ã¾ã™ã€‚ã•ã‚‰ã«ã€ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ãŒãƒ¡ãƒˆãƒªãƒƒã‚¯ã‚µãƒ¼ãƒãƒ¼ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹å ´åˆã€æ½œåœ¨çš„ãªãƒªã‚½ãƒ¼ã‚¹ã®éå‰°/ä¸è¶³å‰²ã‚Šå½“ã¦ã‚’å ±å‘Šã—ã€ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ãŒå®¹é‡ä¸è¶³ã«ãªã‚‹ã¨è­¦å‘Šã‚’è©¦ã¿ã¾ã™ã€‚

### [**KICS**](https://github.com/Checkmarx/kics)

[**KICS**](https://github.com/Checkmarx/kics)ã¯ã€æ¬¡ã®**ã‚¤ãƒ³ãƒ•ãƒ©ã‚¹ãƒˆãƒ©ã‚¯ãƒãƒ£ã‚³ãƒ¼ãƒ‰ã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³**ã§**ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è„†å¼±æ€§**ã€ã‚³ãƒ³ãƒ—ãƒ©ã‚¤ã‚¢ãƒ³ã‚¹ã®å•é¡Œã€ãŠã‚ˆã³ã‚¤ãƒ³ãƒ•ãƒ©ã‚¹ãƒˆãƒ©ã‚¯ãƒãƒ£ã®ãƒŸã‚¹æ§‹æˆã‚’æ¤œå‡ºã—ã¾ã™ï¼šTerraformã€Kubernetesã€Dockerã€AWS CloudFormationã€Ansibleã€Helmã€Microsoft ARMã€ãŠã‚ˆã³OpenAPI 3.0ã®ä»•æ§˜

### [**Checkov**](https://github.com/bridgecrewio/checkov)

[**Checkov**](https://github.com/bridgecrewio/checkov)ã¯ã€ã‚¤ãƒ³ãƒ•ãƒ©ã‚¹ãƒˆãƒ©ã‚¯ãƒãƒ£ã‚³ãƒ¼ãƒ‰ç”¨ã®é™çš„ã‚³ãƒ¼ãƒ‰è§£æãƒ„ãƒ¼ãƒ«ã§ã™ã€‚

[Terraform](https://terraform.io)ã€Terraform planã€[Cloudformation](https://aws.amazon.com/cloudformation/)ã€[AWS SAM](https://aws.amazon.com/serverless/sam/)ã€[Kubernetes](https://kubernetes.io)ã€[Dockerfile](https://www.docker.com)ã€[Serverless](https://www.serverless.com)ã€ã¾ãŸã¯[ARM Templates](https://docs.microsoft.com/en-us/azure/azure-resource-manager/templates/overview)ã‚’ä½¿ç”¨ã—ã¦ãƒ—ãƒ­ãƒ“ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°ã•ã‚ŒãŸã‚¯ãƒ©ã‚¦ãƒ‰ã‚¤ãƒ³ãƒ•ãƒ©ã‚¹ãƒˆãƒ©ã‚¯ãƒãƒ£ã‚’ã‚¹ã‚­ãƒ£ãƒ³ã—ã€ã‚°ãƒ©ãƒ•ãƒ™ãƒ¼ã‚¹ã®ã‚¹ã‚­ãƒ£ãƒ³ã‚’ä½¿ç”¨ã—ã¦ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãŠã‚ˆã³ã‚³ãƒ³ãƒ—ãƒ©ã‚¤ã‚¢ãƒ³ã‚¹ã®ãƒŸã‚¹æ§‹æˆã‚’æ¤œå‡ºã—ã¾ã™ã€‚

### [**Kube-score**](https://github.com/zegl/kube-score)

[**kube-score**](https://github.com/zegl/kube-score)ã¯ã€Kubernetesã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆå®šç¾©ã®é™çš„ã‚³ãƒ¼ãƒ‰è§£æã‚’å®Ÿè¡Œã™ã‚‹ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚

ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ–¹æ³•ï¼š

| ãƒ‡ã‚£ã‚¹ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³                               | ã‚³ãƒãƒ³ãƒ‰/ãƒªãƒ³ã‚¯                                                                          |
| --------------------------------------------------- | --------------------------------------------------------------------------------------- |
| macOSã€Linuxã€Windowsç”¨ã®äº‹å‰ãƒ“ãƒ«ãƒ‰ãƒã‚¤ãƒŠãƒª           | [GitHubãƒªãƒªãƒ¼ã‚¹](https://github.com/zegl/kube-score/releases)                          |
| Docker                                              | `docker pull zegl/kube-score` ([Docker Hub)](https://hub.docker.com/r/zegl/kube-score/) |
| Homebrewï¼ˆmacOSãŠã‚ˆã³Linuxï¼‰                         | `brew install kube-score`                                                               |
| [Krew](https://krew.sigs.k8s.io/)ï¼ˆmacOSãŠã‚ˆã³Linuxï¼‰ | `kubectl krew install score`                                                            |

## ãƒ’ãƒ³ãƒˆ

### Kubernetes PodSecurityContextã¨SecurityContext

**PodSecurityContext**ã§ãƒãƒƒãƒ‰ã®**ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ**ã‚’æ§‹æˆã—ã€**SecurityContext**ã§å®Ÿè¡Œã•ã‚Œã‚‹**ã‚³ãƒ³ãƒ†ãƒŠ**ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚’æ§‹æˆã§ãã¾ã™ã€‚è©³ç´°ã«ã¤ã„ã¦ã¯ã€æ¬¡ã‚’å‚ç…§ã—ã¦ãã ã•ã„ï¼š

{% content-ref url="kubernetes-securitycontext-s.md" %}
[kubernetes-securitycontext-s.md](kubernetes-securitycontext-s.md)
{% endcontent-ref %}

### Kubernetes APIã®ãƒãƒ¼ãƒ‰ãƒ‹ãƒ³ã‚°

**Kubernetes Api Serverã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’ä¿è­·ã™ã‚‹ã“ã¨ã¯éå¸¸ã«é‡è¦**ã§ã™ã€‚ååˆ†ãªæ¨©é™ã‚’æŒã¤æ‚ªæ„ã®ã‚ã‚‹ã‚¢ã‚¯ã‚¿ãƒ¼ãŒãã‚Œã‚’æ‚ªç”¨ã—ã€ç’°å¢ƒã‚’å¤šãã®æ–¹æ³•ã§æå‚·ã•ã›ã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ãŸã‚ã§ã™ã€‚\
**ã‚¢ã‚¯ã‚»ã‚¹**ï¼ˆAPI Serverã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã®**ãƒ›ãƒ¯ã‚¤ãƒˆãƒªã‚¹ãƒˆ**åŒ–ã¨ä»–ã®æ¥ç¶šã‚’æ‹’å¦ã™ã‚‹ï¼‰ã¨[**èªè¨¼**](https://kubernetes.io/docs/reference/command-line-tools-reference/kubelet-authentication-authorization/)ï¼ˆ**æœ€å°ç‰¹æ¨©**ã®åŸå‰‡ã«å¾“ã†ï¼‰ã‚’ç¢ºä¿ã™ã‚‹ã“ã¨ãŒé‡è¦ã§ã™ã€‚ãã—ã¦ã€**æ±ºã—ã¦** **åŒ¿å** **ãƒªã‚¯ã‚¨ã‚¹ãƒˆ**ã‚’**è¨±å¯**ã—ãªã„ã“ã¨ãŒé‡è¦ã§ã™ã€‚

**ä¸€èˆ¬çš„ãªãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ—ãƒ­ã‚»ã‚¹ï¼š**\
ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¾ãŸã¯K8s ServiceAccount â€“> èªè¨¼ â€“> èªå¯ â€“> ã‚¢ãƒ‰ãƒŸãƒƒã‚·ãƒ§ãƒ³ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã€‚

**ãƒ’ãƒ³ãƒˆ**ï¼š

* ãƒãƒ¼ãƒˆã‚’é–‰ã˜ã‚‹ã€‚
* åŒ¿åã‚¢ã‚¯ã‚»ã‚¹ã‚’é¿ã‘ã‚‹ã€‚
* NodeRestrictionï¼›ç‰¹å®šã®ãƒãƒ¼ãƒ‰ã‹ã‚‰APIã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’æ‹’å¦ã™ã‚‹ã€‚
* [https://kubernetes.io/docs/reference/access-authn-authz/admission-controllers/#noderestriction](https://kubernetes.io/docs/reference/access-authn-authz/admission-controllers/#noderestriction)
* ã“ã‚Œã¯ã€kubeletsãŒãƒãƒ¼ãƒ‰ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ãƒ¯ãƒ¼ã‚¯ãƒ­ãƒ¼ãƒ‰åˆ†é›¢ã®ç›®çš„ã§ãƒ©ãƒ™ãƒ«ä»˜ã‘ã™ã‚‹ãŸã‚ã«äºˆç´„ã•ã‚ŒãŸãƒ©ãƒ™ãƒ«æ¥é ­è¾ã§ã‚ã‚‹node-restriction.kubernetes.io/æ¥é ­è¾ã®ãƒ©ãƒ™ãƒ«ã‚’è¿½åŠ /å‰Šé™¤/æ›´æ–°ã™ã‚‹ã“ã¨ã‚’è¨±å¯ã—ã¾ã›ã‚“ã€‚
* ã¾ãŸã€kubeletsãŒã“ã‚Œã‚‰ã®ãƒ©ãƒ™ãƒ«ã¨ãƒ©ãƒ™ãƒ«æ¥é ­è¾ã‚’è¿½åŠ /å‰Šé™¤/æ›´æ–°ã§ãã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚
* ãƒ©ãƒ™ãƒ«ã‚’ä½¿ç”¨ã—ã¦ã‚»ã‚­ãƒ¥ã‚¢ãªãƒ¯ãƒ¼ã‚¯ãƒ­ãƒ¼ãƒ‰åˆ†é›¢ã‚’ç¢ºä¿ã—ã¾ã™ã€‚
* ç‰¹å®šã®ãƒãƒƒãƒ‰ãŒAPIã‚¢ã‚¯ã‚»ã‚¹ã‚’æ‹’å¦ã—ã¾ã™ã€‚
* ApiServerã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã¸ã®éœ²å‡ºã‚’é¿ã‘ã‚‹ã€‚
* ä¸æ­£ãªã‚¢ã‚¯ã‚»ã‚¹RBACã‚’é¿ã‘ã‚‹ã€‚
* ãƒ•ã‚¡ã‚¤ã‚¢ã‚¦ã‚©ãƒ¼ãƒ«ã¨IPãƒ›ãƒ¯ã‚¤ãƒˆãƒªã‚¹ãƒˆã‚’ä½¿ç”¨ã—ãŸApiServerãƒãƒ¼ãƒˆã®ä¿è­·ã€‚
```yaml
apiVersion: v1
kind: Pod
metadata:
name: security-context-demo
spec:
securityContext:
runAsUser: 1000
runAsGroup: 3000
fsGroup: 2000
volumes:
- name: sec-ctx-vol
emptyDir: {}
containers:
- name: sec-ctx-demo
image: busybox
command: [ "sh", "-c", "sleep 1h" ]
securityContext:
runAsNonRoot: true
volumeMounts:
- name: sec-ctx-vol
mountPath: /data/demo
securityContext:
allowPrivilegeEscalation: true
```
* [https://kubernetes.io/docs/tasks/configure-pod-container/security-context/](https://kubernetes.io/docs/tasks/configure-pod-container/security-context/)
* [https://kubernetes.io/docs/concepts/policy/pod-security-policy/](https://kubernetes.io/docs/concepts/policy/pod-security-policy/)

### ä¸€èˆ¬çš„ãªãƒãƒ¼ãƒ‰ãƒ‹ãƒ³ã‚°

å¿…è¦ã«å¿œã˜ã¦Kubernetesç’°å¢ƒã‚’ä»¥ä¸‹ã®ã‚ˆã†ã«é »ç¹ã«æ›´æ–°ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ï¼š

* ä¾å­˜é–¢ä¿‚ã‚’æœ€æ–°ã®çŠ¶æ…‹ã«ä¿ã¤ã€‚
* ãƒã‚°ã¨ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ‘ãƒƒãƒã‚’é©ç”¨ã™ã‚‹ã€‚

[**ãƒªãƒªãƒ¼ã‚¹ã‚µã‚¤ã‚¯ãƒ«**](https://kubernetes.io/docs/setup/release/version-skew-policy/): 3ãƒ¶æœˆã”ã¨ã«æ–°ã—ã„ãƒã‚¤ãƒŠãƒ¼ãƒªãƒªãƒ¼ã‚¹ãŒã‚ã‚Šã¾ã™ -- 1.20.3 = 1(ãƒ¡ã‚¸ãƒ£ãƒ¼).20(ãƒã‚¤ãƒŠãƒ¼).3(ãƒ‘ãƒƒãƒ)

**Kubernetesã‚¯ãƒ©ã‚¹ã‚¿ã‚’ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã™ã‚‹æœ€è‰¯ã®æ–¹æ³•ã¯ï¼ˆ**[**ã“ã¡ã‚‰**](https://kubernetes.io/docs/tasks/administer-cluster/cluster-upgrade/)**ï¼‰:**

* ã“ã®ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ã«å¾“ã£ã¦ãƒã‚¹ã‚¿ãƒ¼ãƒãƒ¼ãƒ‰ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã™ã‚‹ï¼š
* etcdï¼ˆã™ã¹ã¦ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ï¼‰ã€‚
* kube-apiserverï¼ˆã™ã¹ã¦ã®ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãƒ—ãƒ¬ãƒ¼ãƒ³ãƒ›ã‚¹ãƒˆï¼‰ã€‚
* kube-controller-managerã€‚
* kube-schedulerã€‚
* ã‚¯ãƒ©ã‚¦ãƒ‰ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ãƒãƒãƒ¼ã‚¸ãƒ£ï¼ˆä½¿ç”¨ã—ã¦ã„ã‚‹å ´åˆï¼‰ã€‚
* kube-proxyã€kubeletãªã©ã®ãƒ¯ãƒ¼ã‚«ãƒ¼ãƒãƒ¼ãƒ‰ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã™ã‚‹ã€‚

{% hint style="success" %}
AWSãƒãƒƒã‚­ãƒ³ã‚°ã®å­¦ç¿’ã¨å®Ÿè·µ:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCPãƒãƒƒã‚­ãƒ³ã‚°ã®å­¦ç¿’ã¨å®Ÿè·µ: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricksã®ã‚µãƒãƒ¼ãƒˆ</summary>

* [**ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³**](https://github.com/sponsors/carlospolop)ã‚’ãƒã‚§ãƒƒã‚¯ï¼
* ğŸ’¬ [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã«å‚åŠ ã™ã‚‹ã‹ã€[**telegramã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«å‚åŠ ã™ã‚‹ã‹ã€**Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**ã‚’ãƒ•ã‚©ãƒ­ãƒ¼ã™ã‚‹ã€‚**
* **HackTricks**ã¨**HackTricks Cloud**ã®githubãƒªãƒã‚¸ãƒˆãƒªã«PRã‚’æå‡ºã—ã¦ãƒãƒƒã‚­ãƒ³ã‚°ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã™ã‚‹ã€‚

</details>
{% endhint %}
