# Kubernetes Hardening

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## –Ü–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∏ –¥–ª—è –∞–Ω–∞–ª—ñ–∑—É –∫–ª–∞—Å—Ç–µ—Ä–∞

### [**Kubescape**](https://github.com/armosec/kubescape)

[**Kubescape**](https://github.com/armosec/kubescape) ‚Äî —Ü–µ –≤—ñ–¥–∫—Ä–∏—Ç–∏–π —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç K8s, —â–æ –Ω–∞–¥–∞—î —î–¥–∏–Ω—É –ø–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –¥–ª—è –±–∞–≥–∞—Ç–æ—Ö–º–∞—Ä–Ω–æ–≥–æ K8s, –≤–∫–ª—é—á–∞—é—á–∏ –∞–Ω–∞–ª—ñ–∑ —Ä–∏–∑–∏–∫—ñ–≤, –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω—ñ—Å—Ç—å –±–µ–∑–ø–µ–∫–∏, –≤—ñ–∑—É–∞–ª—ñ–∑–∞—Ü—ñ—é RBAC —Ç–∞ —Å–∫–∞–Ω—É–≤–∞–Ω–Ω—è –≤—Ä–∞–∑–ª–∏–≤–æ—Å—Ç–µ–π –∑–æ–±—Ä–∞–∂–µ–Ω—å. Kubescape —Å–∫–∞–Ω—É—î –∫–ª–∞—Å—Ç–µ—Ä–∏ K8s, —Ñ–∞–π–ª–∏ YAML —Ç–∞ HELM-—á–∞—Ä—Ç–∏, –≤–∏—è–≤–ª—è—é—á–∏ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ñ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–æ –¥–æ –∫—ñ–ª—å–∫–æ—Ö —Ñ—Ä–µ–π–º–≤–æ—Ä–∫—ñ–≤ (—Ç–∞–∫–∏—Ö —è–∫ [NSA-CISA](https://www.armosec.io/blog/kubernetes-hardening-guidance-summary-by-armo), [MITRE ATT\&CK¬Æ](https://www.microsoft.com/security/blog/2021/03/23/secure-containerized-environments-with-updated-threat-matrix-for-kubernetes/)), –≤—Ä–∞–∑–ª–∏–≤–æ—Å—Ç—ñ –ø—Ä–æ–≥—Ä–∞–º–Ω–æ–≥–æ –∑–∞–±–µ–∑–ø–µ—á–µ–Ω–Ω—è —Ç–∞ –ø–æ—Ä—É—à–µ–Ω–Ω—è RBAC (–∫–æ–Ω—Ç—Ä–æ–ª—å –¥–æ—Å—Ç—É–ø—É –Ω–∞ –æ—Å–Ω–æ–≤—ñ —Ä–æ–ª–µ–π) –Ω–∞ —Ä–∞–Ω–Ω—ñ—Ö –µ—Ç–∞–ø–∞—Ö CI/CD, –º–∏—Ç—Ç—î–≤–æ —Ä–æ–∑—Ä–∞—Ö–æ–≤—É—î —Ä–∏–∑–∏–∫–æ–≤–∏–π –±–∞–ª —ñ –ø–æ–∫–∞–∑—É—î —Ç–µ–Ω–¥–µ–Ω—Ü—ñ—ó —Ä–∏–∑–∏–∫—É –∑ —á–∞—Å–æ–º.
```bash
kubescape scan --verbose
```
### [**Kube-bench**](https://github.com/aquasecurity/kube-bench)

–Ü–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç [**kube-bench**](https://github.com/aquasecurity/kube-bench) - —Ü–µ —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç, —è–∫–∏–π –ø–µ—Ä–µ–≤—ñ—Ä—è—î, —á–∏ –±–µ–∑–ø–µ—á–Ω–æ —Ä–æ–∑–≥–æ—Ä–Ω—É—Ç–æ Kubernetes, –≤–∏–∫–æ–Ω—É—é—á–∏ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏, –∑–∞–¥–æ–∫—É–º–µ–Ω—Ç–æ–≤–∞–Ω—ñ –≤ [**CIS Kubernetes Benchmark**](https://www.cisecurity.org/benchmark/kubernetes/).\
–í–∏ –º–æ–∂–µ—Ç–µ –≤–∏–±—Ä–∞—Ç–∏:

* –∑–∞–ø—É—Å—Ç–∏—Ç–∏ kube-bench –∑—Å–µ—Ä–µ–¥–∏–Ω–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ (–¥—ñ–ª—è—á–∏ –ø—Ä–æ—Å—Ç—ñ—Ä PID –∑ —Ö–æ—Å—Ç–æ–º)
* –∑–∞–ø—É—Å—Ç–∏—Ç–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä, —è–∫–∏–π –≤—Å—Ç–∞–Ω–æ–≤–ª—é—î kube-bench –Ω–∞ —Ö–æ—Å—Ç, –∞ –ø–æ—Ç—ñ–º –∑–∞–ø—É—Å—Ç–∏—Ç–∏ kube-bench –±–µ–∑–ø–æ—Å–µ—Ä–µ–¥–Ω—å–æ –Ω–∞ —Ö–æ—Å—Ç—ñ
* –≤—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ –æ—Å—Ç–∞–Ω–Ω—ñ –±—ñ–Ω–∞—Ä–Ω—ñ —Ñ–∞–π–ª–∏ –∑ [Releases page](https://github.com/aquasecurity/kube-bench/releases),
* —Å–∫–æ–º–ø—ñ–ª—é–≤–∞—Ç–∏ –π–æ–≥–æ –∑ –≤–∏—Ö–æ–¥—É.

### [**Kubeaudit**](https://github.com/Shopify/kubeaudit)

–Ü–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç [**kubeaudit**](https://github.com/Shopify/kubeaudit) - —Ü–µ —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –∫–æ–º–∞–Ω–¥–Ω–æ–≥–æ —Ä—è–¥–∫–∞ —Ç–∞ –ø–∞–∫–µ—Ç Go –¥–ª—è **–∞—É–¥–∏—Ç—É –∫–ª–∞—Å—Ç–µ—Ä—ñ–≤ Kubernetes** –∑ —Ä—ñ–∑–Ω–∏—Ö –ø–∏—Ç–∞–Ω—å –±–µ–∑–ø–µ–∫–∏.

Kubeaudit –º–æ–∂–µ –≤–∏—è–≤–∏—Ç–∏, —á–∏ –ø—Ä–∞—Ü—é—î –≤—ñ–Ω —É –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ñ –≤ –∫–ª–∞—Å—Ç–µ—Ä—ñ. –Ø–∫—â–æ —Ç–∞–∫, –≤—ñ–Ω —Å–ø—Ä–æ–±—É—î –ø—Ä–æ–≤–µ—Å—Ç–∏ –∞—É–¥–∏—Ç —É—Å—ñ—Ö —Ä–µ—Å—É—Ä—Å—ñ–≤ Kubernetes —É —Ü—å–æ–º—É –∫–ª–∞—Å—Ç–µ—Ä—ñ:
```
kubeaudit all
```
–¶–µ–π —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç —Ç–∞–∫–æ–∂ –º–∞—î –∞—Ä–≥—É–º–µ–Ω—Ç `autofix`, —â–æ–± **–∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤–∏–ø—Ä–∞–≤–ª—è—Ç–∏ –≤–∏—è–≤–ª–µ–Ω—ñ –ø—Ä–æ–±–ª–µ–º–∏.**

### [**Kube-hunter**](https://github.com/aquasecurity/kube-hunter)

–Ü–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç [**kube-hunter**](https://github.com/aquasecurity/kube-hunter) —à—É–∫–∞—î –≤—Ä–∞–∑–ª–∏–≤–æ—Å—Ç—ñ –≤ –±–µ–∑–ø–µ—Ü—ñ –≤ –∫–ª–∞—Å—Ç–µ—Ä–∞—Ö Kubernetes. –Ü–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –±—É–≤ —Ä–æ–∑—Ä–æ–±–ª–µ–Ω–∏–π –¥–ª—è –ø—ñ–¥–≤–∏—â–µ–Ω–Ω—è –æ–±—ñ–∑–Ω–∞–Ω–æ—Å—Ç—ñ —Ç–∞ –≤–∏–¥–∏–º–æ—Å—Ç—ñ –ø—Ä–æ–±–ª–µ–º –±–µ–∑–ø–µ–∫–∏ –≤ —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞—Ö Kubernetes.
```bash
kube-hunter --remote some.node.com
```
### [**Kubei**](https://github.com/Erezf-p/kubei)

[**Kubei**](https://github.com/Erezf-p/kubei) - —Ü–µ —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è —Å–∫–∞–Ω—É–≤–∞–Ω–Ω—è –≤—Ä–∞–∑–ª–∏–≤–æ—Å—Ç–µ–π —Ç–∞ CIS Docker benchmark, —è–∫–∏–π –¥–æ–∑–≤–æ–ª—è—î –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞–º –æ—Ç—Ä–∏–º–∞—Ç–∏ —Ç–æ—á–Ω—É —Ç–∞ –Ω–µ–≥–∞–π–Ω—É –æ—Ü—ñ–Ω–∫—É —Ä–∏–∑–∏–∫—É —ó—Ö–Ω—ñ—Ö –∫–ª–∞—Å—Ç–µ—Ä—ñ–≤ kubernetes. Kubei —Å–∫–∞–Ω—É—î –≤—Å—ñ –æ–±—Ä–∞–∑–∏, —è–∫—ñ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å—Å—è –≤ –∫–ª–∞—Å—Ç–µ—Ä—ñ Kubernetes, –≤–∫–ª—é—á–∞—é—á–∏ –æ–±—Ä–∞–∑–∏ –¥–æ–¥–∞—Ç–∫—ñ–≤ —Ç–∞ —Å–∏—Å—Ç–µ–º–Ω–∏—Ö –ø–æ–¥—ñ–≤.

### [**KubiScan**](https://github.com/cyberark/KubiScan)

[**KubiScan**](https://github.com/cyberark/KubiScan) - —Ü–µ —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è —Å–∫–∞–Ω—É–≤–∞–Ω–Ω—è –∫–ª–∞—Å—Ç–µ—Ä–∞ Kubernetes –Ω–∞ –Ω–∞—è–≤–Ω—ñ—Å—Ç—å —Ä–∏–∑–∏–∫–æ–≤–∞–Ω–∏—Ö –¥–æ–∑–≤–æ–ª—ñ–≤ —É –º–æ–¥–µ–ª—ñ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó –Ω–∞ –æ—Å–Ω–æ–≤—ñ —Ä–æ–ª–µ–π (RBAC) Kubernetes.

### [Managed Kubernetes Auditing Toolkit](https://github.com/DataDog/managed-kubernetes-auditing-toolkit)

[**Mkat**](https://github.com/DataDog/managed-kubernetes-auditing-toolkit) - —Ü–µ —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç, —Å—Ç–≤–æ—Ä–µ–Ω–∏–π –¥–ª—è —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è —ñ–Ω—à–∏—Ö —Ç–∏–ø—ñ–≤ –ø–µ—Ä–µ–≤—ñ—Ä–æ–∫ –≤–∏—Å–æ–∫–æ–≥–æ —Ä–∏–∑–∏–∫—É –≤ –ø–æ—Ä—ñ–≤–Ω—è–Ω–Ω—ñ –∑ —ñ–Ω—à–∏–º–∏ —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º–∏. –í—ñ–Ω –º–∞—î 3 —Ä—ñ–∑–Ω—ñ —Ä–µ–∂–∏–º–∏:

* **`find-role-relationships`**: –Ø–∫–∏–π –∑–Ω–∞–π–¥–µ, —è–∫—ñ —Ä–æ–ª—ñ AWS –ø—Ä–∞—Ü—é—é—Ç—å –≤ —è–∫–∏—Ö –ø–æ–¥–∞—Ö
* **`find-secrets`**: –Ø–∫–∏–π –Ω–∞–º–∞–≥–∞—î—Ç—å—Å—è –≤–∏—è–≤–∏—Ç–∏ —Å–µ–∫—Ä–µ—Ç–∏ –≤ —Ä–µ—Å—É—Ä—Å–∞—Ö K8s, —Ç–∞–∫–∏—Ö —è–∫ Pods, ConfigMaps —Ç–∞ Secrets.
* **`test-imds-access`**: –Ø–∫–∏–π —Å–ø—Ä–æ–±—É—î –∑–∞–ø—É—Å—Ç–∏—Ç–∏ –ø–æ–¥–∏ —Ç–∞ —Å–ø—Ä–æ–±—É—î –æ—Ç—Ä–∏–º–∞—Ç–∏ –¥–æ—Å—Ç—É–ø –¥–æ –º–µ—Ç–∞–¥–∞–Ω–∏—Ö v1 —Ç–∞ v2. –£–í–ê–ì–ê: –¶–µ –∑–∞–ø—É—Å—Ç–∏—Ç—å –ø–æ–¥ —É –∫–ª–∞—Å—Ç–µ—Ä—ñ, –±—É–¥—å—Ç–µ –¥—É–∂–µ –æ–±–µ—Ä–µ–∂–Ω—ñ, –æ—Å–∫—ñ–ª—å–∫–∏ –≤–∏, –º–æ–∂–ª–∏–≤–æ, –Ω–µ —Ö–æ—á–µ—Ç–µ —Ü—å–æ–≥–æ —Ä–æ–±–∏—Ç–∏!

## **–ê—É–¥–∏—Ç IaC –∫–æ–¥—É**

### [**Popeye**](https://github.com/derailed/popeye)

[**Popeye**](https://github.com/derailed/popeye) - —Ü–µ —É—Ç–∏–ª—ñ—Ç–∞, —è–∫–∞ —Å–∫–∞–Ω—É—î –∂–∏–≤–∏–π –∫–ª–∞—Å—Ç–µ—Ä Kubernetes —Ç–∞ **–ø–æ–≤—ñ–¥–æ–º–ª—è—î –ø—Ä–æ –ø–æ—Ç–µ–Ω—Ü—ñ–π–Ω—ñ –ø—Ä–æ–±–ª–µ–º–∏ –∑ —Ä–æ–∑–≥–æ—Ä–Ω—É—Ç–∏–º–∏ —Ä–µ—Å—É—Ä—Å–∞–º–∏ —Ç–∞ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è–º–∏**. –í–æ–Ω–∞ –æ—á–∏—â–∞—î –≤–∞—à –∫–ª–∞—Å—Ç–µ—Ä –Ω–∞ –æ—Å–Ω–æ–≤—ñ —Ç–æ–≥–æ, —â–æ —Ä–æ–∑–≥–æ—Ä–Ω—É—Ç–æ, –∞ –Ω–µ –Ω–∞ –æ—Å–Ω–æ–≤—ñ —Ç–æ–≥–æ, —â–æ –∑–Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è –Ω–∞ –¥–∏—Å–∫—É. –°–∫–∞–Ω—É—é—á–∏ –≤–∞—à –∫–ª–∞—Å—Ç–µ—Ä, –≤–æ–Ω–∞ –≤–∏—è–≤–ª—è—î –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ñ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó —Ç–∞ –¥–æ–ø–æ–º–∞–≥–∞—î –≤–∞–º –∑–∞–±–µ–∑–ø–µ—á–∏—Ç–∏ –¥–æ—Ç—Ä–∏–º–∞–Ω–Ω—è –Ω–∞–π–∫—Ä–∞—â–∏—Ö –ø—Ä–∞–∫—Ç–∏–∫, –∑–∞–ø–æ–±—ñ–≥–∞—é—á–∏ –º–∞–π–±—É—Ç–Ω—ñ–º –ø—Ä–æ–±–ª–µ–º–∞–º. –í–æ–Ω–∞ —Å–ø—Ä—è–º–æ–≤–∞–Ω–∞ –Ω–∞ –∑–º–µ–Ω—à–µ–Ω–Ω—è –∫–æ–≥–Ω—ñ—Ç–∏–≤–Ω–æ–≥–æ –Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è, –∑ —è–∫–∏–º —Å—Ç–∏–∫–∞—é—Ç—å—Å—è –ø—Ä–∏ —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—ñ –∫–ª–∞—Å—Ç–µ—Ä–æ–º Kubernetes —É —Ä–µ–∞–ª—å–Ω–∏—Ö —É–º–æ–≤–∞—Ö. –ö—Ä—ñ–º —Ç–æ–≥–æ, —è–∫—â–æ –≤–∞—à –∫–ª–∞—Å—Ç–µ—Ä –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î metric-server, –≤—ñ–Ω –ø–æ–≤—ñ–¥–æ–º–ª—è—î –ø—Ä–æ –ø–æ—Ç–µ–Ω—Ü—ñ–π–Ω—ñ –Ω–∞–¥–º—ñ—Ä–Ω—ñ/–Ω–µ–¥–æ—Å—Ç–∞—Ç–Ω—ñ –≤–∏–¥—ñ–ª–µ–Ω–Ω—è —Ä–µ—Å—É—Ä—Å—ñ–≤ —ñ –Ω–∞–º–∞–≥–∞—î—Ç—å—Å—è –ø–æ–ø–µ—Ä–µ–¥–∏—Ç–∏ –≤–∞—Å, —è–∫—â–æ –≤–∞—à –∫–ª–∞—Å—Ç–µ—Ä –≤–∏—á–µ—Ä–ø–∞—î –ø–æ—Ç—É–∂–Ω–æ—Å—Ç—ñ.

### [**KICS**](https://github.com/Checkmarx/kics)

[**KICS**](https://github.com/Checkmarx/kics) –∑–Ω–∞—Ö–æ–¥–∏—Ç—å **–≤—Ä–∞–∑–ª–∏–≤–æ—Å—Ç—ñ –±–µ–∑–ø–µ–∫–∏**, –ø—Ä–æ–±–ª–µ–º–∏ –∑ –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω—ñ—Å—Ç—é —Ç–∞ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ñ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó —ñ–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∏ –≤ –Ω–∞—Å—Ç—É–ø–Ω–∏—Ö **—Ä—ñ—à–µ–Ω–Ω—è—Ö –Ü–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∏ —è–∫ –ö–æ–¥**: Terraform, Kubernetes, Docker, AWS CloudFormation, Ansible, Helm, Microsoft ARM —Ç–∞ —Å–ø–µ—Ü–∏—Ñ—ñ–∫–∞—Ü—ñ—ó OpenAPI 3.0.

### [**Checkov**](https://github.com/bridgecrewio/checkov)

[**Checkov**](https://github.com/bridgecrewio/checkov) - —Ü–µ —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç —Å—Ç–∞—Ç–∏—á–Ω–æ–≥–æ –∞–Ω–∞–ª—ñ–∑—É –∫–æ–¥—É –¥–ª—è —ñ–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∏ —è–∫ –∫–æ–¥—É.

–í—ñ–Ω —Å–∫–∞–Ω—É—î —Ö–º–∞—Ä–Ω—É —ñ–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—É, —â–æ –Ω–∞–¥–∞—î—Ç—å—Å—è –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é [Terraform](https://terraform.io), –ø–ª–∞–Ω—É Terraform, [Cloudformation](https://aws.amazon.com/cloudformation/), [AWS SAM](https://aws.amazon.com/serverless/sam/), [Kubernetes](https://kubernetes.io), [Dockerfile](https://www.docker.com), [Serverless](https://www.serverless.com) –∞–±–æ [ARM Templates](https://docs.microsoft.com/en-us/azure/azure-resource-manager/templates/overview) —Ç–∞ –≤–∏—è–≤–ª—è—î –ø—Ä–æ–±–ª–µ–º–∏ –∑ –±–µ–∑–ø–µ–∫–æ—é —Ç–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω—ñ—Å—Ç—é, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ –≥—Ä–∞—Ñ–æ–≤–µ —Å–∫–∞–Ω—É–≤–∞–Ω–Ω—è.

### [**Kube-score**](https://github.com/zegl/kube-score)

[**kube-score**](https://github.com/zegl/kube-score) - —Ü–µ —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç, —è–∫–∏–π –≤–∏–∫–æ–Ω—É—î —Å—Ç–∞—Ç–∏—á–Ω–∏–π –∞–Ω–∞–ª—ñ–∑ –∫–æ–¥—É –≤–∞—à–∏—Ö –≤–∏–∑–Ω–∞—á–µ–Ω—å –æ–±'—î–∫—Ç—ñ–≤ Kubernetes.

–©–æ–± –≤—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏:

| –î–∏—Å—Ç—Ä–∏–±—É—Ü—ñ—è                                        | –ö–æ–º–∞–Ω–¥–∞ / –ü–æ—Å–∏–ª–∞–Ω–Ω—è                                                                          |
| --------------------------------------------------- | --------------------------------------------------------------------------------------- |
| –ü–æ–ø–µ—Ä–µ–¥–Ω—å–æ –∑—ñ–±—Ä–∞–Ω—ñ –±—ñ–Ω–∞—Ä–Ω—ñ —Ñ–∞–π–ª–∏ –¥–ª—è macOS, Linux —Ç–∞ Windows    | [–í–∏–ø—É—Å–∫–∏ GitHub](https://github.com/zegl/kube-score/releases)                          |
| Docker                                              | `docker pull zegl/kube-score` ([Docker Hub)](https://hub.docker.com/r/zegl/kube-score/) |
| Homebrew (macOS —Ç–∞ Linux)                          | `brew install kube-score`                                                               |
| [Krew](https://krew.sigs.k8s.io/) (macOS —Ç–∞ Linux) | `kubectl krew install score`                                                            |

## –ü–æ—Ä–∞–¥–∏

### Kubernetes PodSecurityContext —Ç–∞ SecurityContext

–í–∏ –º–æ–∂–µ—Ç–µ –Ω–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ **–∫–æ–Ω—Ç–µ–∫—Å—Ç –±–µ–∑–ø–µ–∫–∏ –ø–æ–¥—ñ–≤** (–∑ _PodSecurityContext_) —Ç–∞ **–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ñ–≤**, —è–∫—ñ –±—É–¥—É—Ç—å –∑–∞–ø—É—â–µ–Ω—ñ (–∑ _SecurityContext_). –î–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –¥–æ–¥–∞—Ç–∫–æ–≤–æ—ó —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó —á–∏—Ç–∞–π—Ç–µ:

{% content-ref url="kubernetes-securitycontext-s.md" %}
[kubernetes-securitycontext-s.md](kubernetes-securitycontext-s.md)
{% endcontent-ref %}

### –£—Å–∫–ª–∞–¥–Ω–µ–Ω–Ω—è API Kubernetes

–î—É–∂–µ –≤–∞–∂–ª–∏–≤–æ **–∑–∞—Ö–∏—Å—Ç–∏—Ç–∏ –¥–æ—Å—Ç—É–ø –¥–æ Kubernetes Api Server**, –æ—Å–∫—ñ–ª—å–∫–∏ –∑–ª–æ–≤–º–∏—Å–Ω–∏–∫ –∑ –¥–æ—Å—Ç–∞—Ç–Ω—ñ–º–∏ –ø—Ä–∏–≤—ñ–ª–µ—è–º–∏ –º–æ–∂–µ –∑–ª–æ–≤–∂–∏–≤–∞—Ç–∏ –Ω–∏–º —ñ –∑–∞–≤–¥–∞—Ç–∏ —à–∫–æ–¥–∏ —Å–µ—Ä–µ–¥–æ–≤–∏—â—É.\
–í–∞–∂–ª–∏–≤–æ –∑–∞–±–µ–∑–ø–µ—á–∏—Ç–∏ —è–∫ **–¥–æ—Å—Ç—É–ø** (**–±—ñ–ª—ñ —Å–ø–∏—Å–∫–∏** –¥–∂–µ—Ä–µ–ª –¥–ª—è –¥–æ—Å—Ç—É–ø—É –¥–æ API Server —Ç–∞ –∑–∞–±–æ—Ä–æ–Ω–∏—Ç–∏ –±—É–¥—å-—è–∫–µ —ñ–Ω—à–µ –∑'—î–¥–Ω–∞–Ω–Ω—è), —Ç–∞–∫ —ñ [**–∞–≤—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—é**](https://kubernetes.io/docs/reference/command-line-tools-reference/kubelet-authentication-authorization/) (–¥–æ—Ç—Ä–∏–º—É—é—á–∏—Å—å –ø—Ä–∏–Ω—Ü–∏–ø—É **–Ω–∞–π–º–µ–Ω—à–∏—Ö** **–ø—Ä–∏–≤—ñ–ª–µ—ó–≤**). –Ü, –±–µ–∑—É–º–æ–≤–Ω–æ, **–Ω—ñ–∫–æ–ª–∏** **–Ω–µ –¥–æ–∑–≤–æ–ª—è–π—Ç–µ** **–∞–Ω–æ–Ω—ñ–º–Ω—ñ** **–∑–∞–ø–∏—Ç–∏**.

**–ó–∞–≥–∞–ª—å–Ω–∏–π –ø—Ä–æ—Ü–µ—Å –∑–∞–ø–∏—Ç—É:**\
–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –∞–±–æ K8s ServiceAccount ‚Äì> –ê–≤—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—è ‚Äì> –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—è ‚Äì> –ö–æ–Ω—Ç—Ä–æ–ª—å –¥–æ—Å—Ç—É–ø—É.

**–ü–æ—Ä–∞–¥–∏**:

* –ó–∞–∫—Ä–∏–π—Ç–µ –ø–æ—Ä—Ç–∏.
* –£–Ω–∏–∫–∞–π—Ç–µ –∞–Ω–æ–Ω—ñ–º–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø—É.
* NodeRestriction; –ù–µ–º–∞—î –¥–æ—Å—Ç—É–ø—É –∑ –ø–µ–≤–Ω–∏—Ö –≤—É–∑–ª—ñ–≤ –¥–æ API.
* [https://kubernetes.io/docs/reference/access-authn-authz/admission-controllers/#noderestriction](https://kubernetes.io/docs/reference/access-authn-authz/admission-controllers/#noderestriction)
* –í –æ—Å–Ω–æ–≤–Ω–æ–º—É –∑–∞–±–æ—Ä–æ–Ω—è—î kubelet –¥–æ–¥–∞–≤–∞—Ç–∏/–≤–∏–¥–∞–ª—è—Ç–∏/–æ–Ω–æ–≤–ª—é–≤–∞—Ç–∏ –º—ñ—Ç–∫–∏ –∑ –ø—Ä–µ—Ñ—ñ–∫—Å–æ–º node-restriction.kubernetes.io/. –¶–µ–π –ø—Ä–µ—Ñ—ñ–∫—Å –º—ñ—Ç–∫–∏ –∑–∞—Ä–µ–∑–µ—Ä–≤–æ–≤–∞–Ω–∏–π –¥–ª—è –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä—ñ–≤, —â–æ–± –º—ñ—Ç–∏—Ç–∏ —Å–≤–æ—ó –æ–±'—î–∫—Ç–∏ Node –¥–ª—è —Ü—ñ–ª–µ–π —ñ–∑–æ–ª—è—Ü—ñ—ó –Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è, —ñ kubelet –Ω–µ –±—É–¥–µ –¥–æ–∑–≤–æ–ª–µ–Ω–æ –∑–º—ñ–Ω—é–≤–∞—Ç–∏ –º—ñ—Ç–∫–∏ –∑ —Ü–∏–º –ø—Ä–µ—Ñ—ñ–∫—Å–æ–º.
* –ê —Ç–∞–∫–æ–∂ –¥–æ–∑–≤–æ–ª—è—î kubelet –¥–æ–¥–∞–≤–∞—Ç–∏/–≤–∏–¥–∞–ª—è—Ç–∏/–æ–Ω–æ–≤–ª—é–≤–∞—Ç–∏ —Ü—ñ –º—ñ—Ç–∫–∏ —Ç–∞ –ø—Ä–µ—Ñ—ñ–∫—Å–∏ –º—ñ—Ç–æ–∫.
* –ó–∞–±–µ–∑–ø–µ—á—Ç–µ –∑ –º—ñ—Ç–∫–∞–º–∏ –±–µ–∑–ø–µ—á–Ω—É —ñ–∑–æ–ª—è—Ü—ñ—é –Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è.
* –£–Ω–∏–∫–∞–π—Ç–µ –¥–æ—Å—Ç—É–ø—É –¥–æ API –¥–ª—è –ø–µ–≤–Ω–∏—Ö –ø–æ–¥—ñ–≤.
* –£–Ω–∏–∫–∞–π—Ç–µ –µ–∫—Å–ø–æ–∑–∏—Ü—ñ—ó ApiServer –≤ –Ü–Ω—Ç–µ—Ä–Ω–µ—Ç—ñ.
* –£–Ω–∏–∫–∞–π—Ç–µ –Ω–µ—Å–∞–Ω–∫—Ü—ñ–æ–Ω–æ–≤–∞–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø—É RBAC.
* –ü–æ—Ä—Ç ApiServer –∑ –±—Ä–∞–Ω–¥–º–∞—É–µ—Ä–æ–º —Ç–∞ –±—ñ–ª–∏–º —Å–ø–∏—Å–∫–æ–º IP.

### –£—Å–∫–ª–∞–¥–Ω–µ–Ω–Ω—è SecurityContext

–ó–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á root –±—É–¥–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏—Å—è, –∫–æ–ª–∏ –ø–æ–¥ –∑–∞–ø—É—Å–∫–∞—î—Ç—å—Å—è, —è–∫—â–æ –Ω–µ –≤–∫–∞–∑–∞–Ω–æ —ñ–Ω—à–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞. –í–∏ –º–æ–∂–µ—Ç–µ –∑–∞–ø—É—Å—Ç–∏—Ç–∏ —Å–≤—ñ–π –¥–æ–¥–∞—Ç–æ–∫ —É –±—ñ–ª—å—à –±–µ–∑–ø–µ—á–Ω–æ–º—É –∫–æ–Ω—Ç–µ–∫—Å—Ç—ñ, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ —à–∞–±–ª–æ–Ω, –ø–æ–¥—ñ–±–Ω–∏–π –¥–æ –Ω–∞—Å—Ç—É–ø–Ω–æ–≥–æ:
```yaml
apiVersion: v1
kind: Pod
metadata:
name: security-context-demo
spec:
securityContext:
runAsUser: 1000
runAsGroup: 3000
fsGroup: 2000
volumes:
- name: sec-ctx-vol
emptyDir: {}
containers:
- name: sec-ctx-demo
image: busybox
command: [ "sh", "-c", "sleep 1h" ]
securityContext:
runAsNonRoot: true
volumeMounts:
- name: sec-ctx-vol
mountPath: /data/demo
securityContext:
allowPrivilegeEscalation: true
```
* [https://kubernetes.io/docs/tasks/configure-pod-container/security-context/](https://kubernetes.io/docs/tasks/configure-pod-container/security-context/)
* [https://kubernetes.io/docs/concepts/policy/pod-security-policy/](https://kubernetes.io/docs/concepts/policy/pod-security-policy/)

### –ó–∞–≥–∞–ª—å–Ω–µ –∑–º—ñ—Ü–Ω–µ–Ω–Ω—è

–í–∞–º —Å–ª—ñ–¥ –æ–Ω–æ–≤–ª—é–≤–∞—Ç–∏ —Å–≤–æ—î —Å–µ—Ä–µ–¥–æ–≤–∏—â–µ Kubernetes —Ç–∞–∫ —á–∞—Å—Ç–æ, —è–∫ —Ü–µ –Ω–µ–æ–±—Ö—ñ–¥–Ω–æ, —â–æ–± –º–∞—Ç–∏:

* –ê–∫—Ç—É–∞–ª—å–Ω—ñ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ.
* –í–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è –ø–æ–º–∏–ª–æ–∫ —ñ –±–µ–∑–ø–µ–∫–∏.

[**–¶–∏–∫–ª–∏ –≤–∏–ø—É—Å–∫—É**](https://kubernetes.io/docs/setup/release/version-skew-policy/): –ö–æ–∂–Ω—ñ 3 –º—ñ—Å—è—Ü—ñ –≤–∏—Ö–æ–¥–∏—Ç—å –Ω–æ–≤–∏–π –Ω–µ–∑–Ω–∞—á–Ω–∏–π —Ä–µ–ª—ñ–∑ -- 1.20.3 = 1(–û—Å–Ω–æ–≤–Ω–∏–π).20(–ù–µ–∑–Ω–∞—á–Ω–∏–π).3(–ø–∞—Ç—á)

**–ù–∞–π–∫—Ä–∞—â–∏–π —Å–ø–æ—Å—ñ–± –æ–Ω–æ–≤–∏—Ç–∏ –∫–ª–∞—Å—Ç–µ—Ä Kubernetes —Ü–µ (–∑** [**—Ç—É—Ç**](https://kubernetes.io/docs/tasks/administer-cluster/cluster-upgrade/)**):**

* –û–Ω–æ–≤—ñ—Ç—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∏ Master Node, –¥–æ—Ç—Ä–∏–º—É—é—á–∏—Å—å —Ü—ñ—î—ó –ø–æ—Å–ª—ñ–¥–æ–≤–Ω–æ—Å—Ç—ñ:
* etcd (–≤—Å—ñ –µ–∫–∑–µ–º–ø–ª—è—Ä–∏).
* kube-apiserver (–≤—Å—ñ —Ö–æ—Å—Ç–∏ –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω–æ—ó –ø–ª–æ—â–∏–Ω–∏).
* kube-controller-manager.
* kube-scheduler.
* cloud controller manager, —è–∫—â–æ –≤–∏ –π–æ–≥–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç–µ.
* –û–Ω–æ–≤—ñ—Ç—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∏ Worker Node, —Ç–∞–∫—ñ —è–∫ kube-proxy, kubelet.

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
