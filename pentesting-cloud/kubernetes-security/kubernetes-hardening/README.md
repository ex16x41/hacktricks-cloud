# Kubernetes SÄ±kÄ±laÅŸtÄ±rma

<details>

<summary><strong>SÄ±fÄ±rdan kahraman olmaya kadar AWS hackleme Ã¶ÄŸrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong> ile!</strong></summary>

HackTricks'Ä± desteklemenin diÄŸer yollarÄ±:

* **Åirketinizi HackTricks'te reklamÄ±nÄ± gÃ¶rmek istiyorsanÄ±z** veya **HackTricks'i PDF olarak indirmek istiyorsanÄ±z** [**ABONELÄ°K PLANLARI**](https://github.com/sponsors/carlospolop)'na gÃ¶z atÄ±n!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* [**PEASS Ailesi'ni**](https://opensea.io/collection/the-peass-family) keÅŸfedin, Ã¶zel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuz
* **KatÄ±lÄ±n** ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) veya **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm)'i **takip edin**.
* **Hacking pÃ¼f noktalarÄ±nÄ±zÄ± paylaÅŸarak PR gÃ¶ndererek** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na katkÄ±da bulunun.

</details>

## KÃ¼me analiz etmek iÃ§in AraÃ§lar

### [**Kubescape**](https://github.com/armosec/kubescape)

[**Kubescape**](https://github.com/armosec/kubescape), Ã§oklu bulut K8s tek pencere sunan, risk analizi, gÃ¼venlik uyumluluÄŸu, RBAC gÃ¶rselleÅŸtirici ve gÃ¶rÃ¼ntÃ¼ gÃ¼venlik aÃ§Ä±klarÄ± taramasÄ± saÄŸlayan aÃ§Ä±k kaynaklÄ± bir K8s aracÄ±dÄ±r. Kubescape, K8s kÃ¼melerini, YAML dosyalarÄ±nÄ± ve HELM grafiklerini tarar, [NSA-CISA](https://www.armosec.io/blog/kubernetes-hardening-guidance-summary-by-armo) gibi Ã§eÅŸitli Ã§erÃ§evelere gÃ¶re yanlÄ±ÅŸ yapÄ±landÄ±rmalarÄ±, yazÄ±lÄ±m gÃ¼venlik aÃ§Ä±klarÄ±nÄ± ve RBAC (rol-tabanlÄ±-eriÅŸim-kontrol) ihlallerini tespit eder, CI/CD boru hattÄ±nÄ±n erken aÅŸamalarÄ±nda risk puanÄ±nÄ± anÄ±nda hesaplar ve zaman iÃ§inde risk eÄŸilimlerini gÃ¶sterir.
```bash
kubescape scan --verbose
```
### [**Kube-bench**](https://github.com/aquasecurity/kube-bench)

[**Kube-bench**](https://github.com/aquasecurity/kube-bench) aracÄ±, [**CIS Kubernetes Benchmark**](https://www.cisecurity.org/benchmark/kubernetes/) belgelerinde belirtilen denetimleri Ã§alÄ±ÅŸtÄ±rarak Kubernetes'in gÃ¼venli bir ÅŸekilde daÄŸÄ±tÄ±lÄ±p daÄŸÄ±tÄ±lmadÄ±ÄŸÄ±nÄ± kontrol eden bir araÃ§tÄ±r.\
ÅunlarÄ± seÃ§ebilirsiniz:

* bir konteyner iÃ§inden kube-bench'i Ã§alÄ±ÅŸtÄ±rÄ±n (ana makineyle PID ad alanÄ±nÄ± paylaÅŸarak)
* ana makineye kube-bench'i yÃ¼kleyen bir konteyner Ã§alÄ±ÅŸtÄ±rÄ±n ve ardÄ±ndan kube-bench'i doÄŸrudan ana makinede Ã§alÄ±ÅŸtÄ±rÄ±n
* [YayÄ±nlar sayfasÄ±ndan](https://github.com/aquasecurity/kube-bench/releases) en son ikili dosyalarÄ± yÃ¼kleyin,
* kaynaktan derleyin.

### [**Kubeaudit**](https://github.com/Shopify/kubeaudit)

[**Kubeaudit**](https://github.com/Shopify/kubeaudit) aracÄ±, Ã§eÅŸitli farklÄ± gÃ¼venlik endiÅŸeleri iÃ§in **Kubernetes kÃ¼melerini denetlemek** iÃ§in bir komut satÄ±rÄ± aracÄ± ve bir Go paketidir.

Kubeaudit, bir kÃ¼medeki bir konteyner iÃ§inde Ã§alÄ±ÅŸtÄ±rÄ±lÄ±p Ã§alÄ±ÅŸtÄ±rÄ±lmadÄ±ÄŸÄ±nÄ± algÄ±layabilir. EÄŸer Ã¶yleyse, o kÃ¼medeki tÃ¼m Kubernetes kaynaklarÄ±nÄ± denetlemeye Ã§alÄ±ÅŸacaktÄ±r:
```
kubeaudit all
```
Bu aracÄ±n ayrÄ±ca tespit edilen sorunlarÄ± **otomatik olarak dÃ¼zeltmek** iÃ§in `autofix` argÃ¼manÄ± bulunmaktadÄ±r.

### [**Kube-hunter**](https://github.com/aquasecurity/kube-hunter)

[**Kube-hunter**](https://github.com/aquasecurity/kube-hunter) aracÄ±, Kubernetes kÃ¼melerindeki gÃ¼venlik zayÄ±flÄ±klarÄ±nÄ± arar. AracÄ±n amacÄ±, Kubernetes ortamlarÄ±ndaki gÃ¼venlik sorunlarÄ±na yÃ¶nelik farkÄ±ndalÄ±ÄŸÄ± ve gÃ¶rÃ¼nÃ¼rlÃ¼ÄŸÃ¼ artÄ±rmaktÄ±r.
```bash
kube-hunter --remote some.node.com
```
### [**Kubei**](https://github.com/Erezf-p/kubei)

[**Kubei**](https://github.com/Erezf-p/kubei), kubernetes kÃ¼melerinin doÄŸru ve hÄ±zlÄ± bir risk deÄŸerlendirmesi almasÄ±nÄ± saÄŸlayan bir zafiyet tarama ve CIS Docker benchmark aracÄ±dÄ±r. Kubei, bir Kubernetes kÃ¼mesinde kullanÄ±lan tÃ¼m gÃ¶rÃ¼ntÃ¼leri tarar, uygulama pod'larÄ±nÄ±n ve sistem pod'larÄ±nÄ±n gÃ¶rÃ¼ntÃ¼lerini iÃ§erir.

### [**KubiScan**](https://github.com/cyberark/KubiScan)

[**KubiScan**](https://github.com/cyberark/KubiScan), Kubernetes kÃ¼mesini tarayan ve Kubernetes'in Rol tabanlÄ± eriÅŸim kontrolÃ¼ (RBAC) yetkilendirme modelinde riskli izinleri taramak iÃ§in bir araÃ§tÄ±r.

### [YÃ¶netilen Kubernetes Denetim AracÄ± Kiti](https://github.com/DataDog/managed-kubernetes-auditing-toolkit)

[**Mkat**](https://github.com/DataDog/managed-kubernetes-auditing-toolkit), diÄŸer araÃ§larla karÅŸÄ±laÅŸtÄ±rÄ±ldÄ±ÄŸÄ±nda yÃ¼ksek riskli kontrolleri test etmek iÃ§in oluÅŸturulmuÅŸ bir araÃ§tÄ±r. Genellikle 3 farklÄ± modu vardÄ±r:

* **`find-role-relationships`**: Hangi AWS rollerinin hangi pod'larda Ã§alÄ±ÅŸtÄ±ÄŸÄ±nÄ± bulur
* **`find-secrets`**: Pod'lar, ConfigMaps ve Secrets gibi K8s kaynaklarÄ±nda gizli bilgileri tanÄ±mlamaya Ã§alÄ±ÅŸÄ±r.
* **`test-imds-access`**: Pod'larÄ± Ã§alÄ±ÅŸtÄ±rmaya ve metadata v1 ve v2'ye eriÅŸmeye Ã§alÄ±ÅŸÄ±r. UYARI: Bu, bir pod'u kÃ¼mede Ã§alÄ±ÅŸtÄ±racaktÄ±r, bunu yapmak istemeyebilirsiniz, Ã§ok dikkatli olun!

## **IaC Kodunu Denetleme**

### [**Popeye**](https://github.com/derailed/popeye)

[**Popeye**](https://github.com/derailed/popeye), canlÄ± Kubernetes kÃ¼mesini tarayan ve **daÄŸÄ±tÄ±lan kaynaklar ve yapÄ±landÄ±rmalarla ilgili potansiyel sorunlarÄ± raporlayan** bir yardÄ±mcÄ± programdÄ±r. KÃ¼menizi tarayarak, yanlÄ±ÅŸ yapÄ±landÄ±rmalarÄ± tespit eder ve en iyi uygulamalarÄ±n yerinde olduÄŸundan emin olmanÄ±za yardÄ±mcÄ± olarak gelecekteki baÅŸ aÄŸrÄ±larÄ±nÄ± Ã¶nler. VahÅŸi doÄŸada bir Kubernetes kÃ¼mesini iÅŸletirken karÅŸÄ±laÅŸÄ±lan biliÅŸsel yÃ¼kÃ¼ azaltmayÄ± amaÃ§lar. AyrÄ±ca, kÃ¼meniz bir metrik sunucusu kullanÄ±yorsa, potansiyel kaynak aÅŸÄ±rÄ±/eksik tahsislerini raporlar ve kÃ¼menizin kapasitesinin tÃ¼kendiÄŸinde sizi uyarÄ±r.

### [**KICS**](https://github.com/Checkmarx/kics)

[**KICS**](https://github.com/Checkmarx/kics), aÅŸaÄŸÄ±daki **AltyapÄ± olarak Kod Ã§Ã¶zÃ¼mlerinde** gÃ¼venlik zafiyetlerini, uyumluluk sorunlarÄ±nÄ± ve altyapÄ± yan yapÄ±landÄ±rmalarÄ±nÄ± bulur: Terraform, Kubernetes, Docker, AWS CloudFormation, Ansible, Helm, Microsoft ARM ve OpenAPI 3.0 Ã¶zellikleri

### [**Checkov**](https://github.com/bridgecrewio/checkov)

[**Checkov**](https://github.com/bridgecrewio/checkov), altyapÄ± olarak kod iÃ§in bir statik kod analiz aracÄ±dÄ±r.

[Terraform](https://terraform.io), Terraform plan, [Cloudformation](https://aws.amazon.com/cloudformation/), [AWS SAM](https://aws.amazon.com/serverless/sam/), [Kubernetes](https://kubernetes.io), [Dockerfile](https://www.docker.com), [Serverless](https://www.serverless.com) veya [ARM ÅablonlarÄ±](https://docs.microsoft.com/en-us/azure/azure-resource-manager/templates/overview) kullanÄ±larak saÄŸlanan bulut altyapÄ±sÄ±nÄ± grafik tabanlÄ± tarama kullanarak gÃ¼venlik ve uyumluluk yan yapÄ±landÄ±rmalarÄ±nÄ± tespit eder.

### [**Kube-score**](https://github.com/zegl/kube-score)

[**kube-score**](https://github.com/zegl/kube-score), Kubernetes nesne tanÄ±mlamalarÄ±nÄ± statik kod analizi yapabilen bir araÃ§tÄ±r.

Kurulum iÃ§in:

| DaÄŸÄ±tÄ±m                                             | Komut / BaÄŸlantÄ±                                                                        |
| --------------------------------------------------- | --------------------------------------------------------------------------------------- |
| macOS, Linux ve Windows iÃ§in derlenmiÅŸ ikili dosyalar | [GitHub sÃ¼rÃ¼mleri](https://github.com/zegl/kube-score/releases)                          |
| Docker                                              | `docker pull zegl/kube-score` ([Docker Hub)](https://hub.docker.com/r/zegl/kube-score/) |
| Homebrew (macOS ve Linux)                          | `brew install kube-score`                                                               |
| [Krew](https://krew.sigs.k8s.io/) (macOS ve Linux) | `kubectl krew install score`                                                            |

## Ä°puÃ§larÄ±

### Kubernetes PodSecurityContext ve SecurityContext

**Pod'larÄ±n gÃ¼venlik baÄŸlamÄ±nÄ±** (_PodSecurityContext_ ile) ve Ã§alÄ±ÅŸtÄ±rÄ±lacak olan **konteynerlerin** (_SecurityContext_ ile) gÃ¼venlik baÄŸlamÄ±nÄ± yapÄ±landÄ±rabilirsiniz. Daha fazla bilgi iÃ§in okuyun:

{% content-ref url="kubernetes-securitycontext-s.md" %}
[kubernetes-securitycontext-s.md](kubernetes-securitycontext-s.md)
{% endcontent-ref %}

### Kubernetes API SÄ±kÄ±laÅŸtÄ±rma

**Kubernetes Api Sunucusuna eriÅŸimi korumak** Ã§ok Ã¶nemlidir, Ã§Ã¼nkÃ¼ yeterli ayrÄ±calÄ±klara sahip kÃ¶tÃ¼ niyetli bir aktÃ¶r, Ã§evreye birÃ§ok ÅŸekilde zarar verebilir.\
**EriÅŸimi** (**API Sunucusuna eriÅŸim iÃ§in whitelist** kÃ¶kenler ve diÄŸer baÄŸlantÄ±larÄ± reddetme) ve [**kimlik doÄŸrulama**](https://kubernetes.io/docs/reference/command-line-tools-reference/kubelet-authentication-authorization/) (en az ayrÄ±calÄ±k ilkesini takip etme) gÃ¼vence altÄ±na almak Ã¶nemlidir. Ve kesinlikle **anonim isteklere asla izin vermemek** Ã¶nemlidir.

**Ortak Ä°stek SÃ¼reci:**\
KullanÄ±cÄ± veya K8s Hizmet HesabÄ± â€“> Kimlik DoÄŸrulama â€“> Yetkilendirme â€“> Kabul KontrolÃ¼.

**Ä°puÃ§larÄ±**:

* PortlarÄ± kapatÄ±n.
* Anonim eriÅŸimden kaÃ§Ä±nÄ±n.
* NodeRestriction; API'ye belirli dÃ¼ÄŸÃ¼mlerden eriÅŸimi engelleme.
* [https://kubernetes.io/docs/reference/access-authn-authz/admission-controllers/#noderestriction](https://kubernetes.io/docs/reference/access-authn-authz/admission-controllers/#noderestriction)
* Temelde kubeletlerin, bu etiketleri ve etiket Ã¶neklerini eklemesine/Ã§Ä±karmasÄ±na/ gÃ¼ncellemesine izin vermez. Bu etiket Ã¶neki, yÃ¶neticilerin iÅŸ yÃ¼kÃ¼ izolasyonu amaÃ§larÄ± iÃ§in Node nesnelerine etiket eklemeleri iÃ§indir ve kubeletler bu Ã¶nekle etiketleri deÄŸiÅŸtiremeyecektir.
* Etiketlerle gÃ¼venli iÅŸ yÃ¼kÃ¼ izolasyonunu saÄŸlayÄ±n.
* Belirli pod'larÄ±n API eriÅŸiminden kaÃ§Ä±nÄ±n.
* ApiServer'Ä±n internete aÃ§Ä±k olmasÄ±nÄ± Ã¶nleyin.
* Yetkisiz eriÅŸimi RBAC ile engelleyin.
* ApiServer portunu gÃ¼venlik duvarÄ± ve IP beyaz listeleme ile koruyun.

### SecurityContext SÄ±kÄ±laÅŸtÄ±rma

VarsayÄ±lan olarak, baÅŸka bir kullanÄ±cÄ± belirtilmediÄŸinde bir Pod baÅŸlatÄ±ldÄ±ÄŸÄ±nda kÃ¶k kullanÄ±cÄ± kullanÄ±lacaktÄ±r. UygulamanÄ±zÄ± aÅŸaÄŸÄ±daki ÅŸablon benzeri bir ÅŸablonda Ã§alÄ±ÅŸtÄ±rarak daha gÃ¼venli bir baÄŸlamda Ã§alÄ±ÅŸtÄ±rabilirsiniz:
```yaml
apiVersion: v1
kind: Pod
metadata:
name: security-context-demo
spec:
securityContext:
runAsUser: 1000
runAsGroup: 3000
fsGroup: 2000
volumes:
- name: sec-ctx-vol
emptyDir: {}
containers:
- name: sec-ctx-demo
image: busybox
command: [ "sh", "-c", "sleep 1h" ]
securityContext:
runAsNonRoot: true
volumeMounts:
- name: sec-ctx-vol
mountPath: /data/demo
securityContext:
allowPrivilegeEscalation: true
```
* [https://kubernetes.io/docs/tasks/configure-pod-container/security-context/](https://kubernetes.io/docs/tasks/configure-pod-container/security-context/)
* [https://kubernetes.io/docs/concepts/policy/pod-security-policy/](https://kubernetes.io/docs/concepts/policy/pod-security-policy/)

### Genel SÄ±kÄ±laÅŸtÄ±rma

GerektiÄŸinde Kubernetes ortamÄ±nÄ±zÄ± gÃ¼ncellemelisiniz:

* BaÄŸÄ±mlÄ±lÄ±klar gÃ¼ncel.
* Hata ve gÃ¼venlik yamalarÄ±.

[**SÃ¼rÃ¼m dÃ¶ngÃ¼leri**](https://kubernetes.io/docs/setup/release/version-skew-policy/): Her 3 ayda bir yeni bir kÃ¼Ã§Ã¼k sÃ¼rÃ¼m Ã§Ä±kar -- 1.20.3 = 1(BÃ¼yÃ¼k).20(KÃ¼Ã§Ã¼k).3(yama)

**Bir Kubernetes KÃ¼mesini gÃ¼ncellemenin en iyi yolu (buradan** [**buraya**](https://kubernetes.io/docs/tasks/administer-cluster/cluster-upgrade/)**):**

* Master DÃ¼ÄŸÃ¼m bileÅŸenlerini ÅŸu sÄ±rayla gÃ¼ncelleyin:
* etcd (tÃ¼m Ã¶rnekler).
* kube-apiserver (tÃ¼m kontrol dÃ¼zlemi ana bilgisayarlarÄ±).
* kube-controller-manager.
* kube-scheduler.
* Bulut denetleyici yÃ¶neticisi, kullanÄ±yorsanÄ±z.
* kube-proxy, kubelet gibi Ä°ÅŸÃ§i DÃ¼ÄŸÃ¼m bileÅŸenlerini gÃ¼ncelleyin.

<details>

<summary><strong>SÄ±fÄ±rdan kahraman olmak iÃ§in AWS hacklemeyi Ã¶ÄŸrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

HackTricks'i desteklemenin diÄŸer yollarÄ±:

* **Åirketinizi HackTricks'te reklamÄ±nÄ± gÃ¶rmek istiyorsanÄ±z** veya **HackTricks'i PDF olarak indirmek istiyorsanÄ±z** [**ABONELÄ°K PLANLARI**](https://github.com/sponsors/carlospolop)'na gÃ¶z atÄ±n!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* [**The PEASS Family'yi**](https://opensea.io/collection/the-peass-family) keÅŸfedin, Ã¶zel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuz
* **ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n veya beni **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm)'de **takip edin**.
* **Hacking hilelerinizi paylaÅŸarak PR gÃ¶ndererek** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na katkÄ±da bulunun.

</details>
