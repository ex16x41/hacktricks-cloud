# Kuberneteså®‰å…¨ä¸Šä¸‹æ–‡

{% hint style="success" %}
å­¦ä¹ å¹¶ç»ƒä¹ AWS Hackingï¼š<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricksåŸ¹è®­AWSçº¢é˜Ÿä¸“å®¶ï¼ˆARTEï¼‰**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
å­¦ä¹ å¹¶ç»ƒä¹ GCP Hackingï¼š<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricksåŸ¹è®­GCPçº¢é˜Ÿä¸“å®¶ï¼ˆGRTEï¼‰**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>æ”¯æŒHackTricks</summary>

* æ£€æŸ¥[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**ç”µæŠ¥ç¾¤ç»„**](https://t.me/peass) æˆ– **å…³æ³¨**æˆ‘ä»¬çš„**Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* é€šè¿‡å‘[**HackTricks**](https://github.com/carlospolop/hacktricks)å’Œ[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) githubä»“åº“æäº¤PRæ¥åˆ†äº«é»‘å®¢æŠ€å·§ã€‚

</details>
{% endhint %}

## Podå®‰å…¨ä¸Šä¸‹æ–‡ <a href="#podsecuritycontext-v1-core" id="podsecuritycontext-v1-core"></a>

[**æ¥è‡ªæ–‡æ¡£ï¼š**](https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core)

åœ¨æŒ‡å®šPodçš„å®‰å…¨ä¸Šä¸‹æ–‡æ—¶ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨å¤šä¸ªå±æ€§ã€‚ä»é˜²å¾¡å®‰å…¨æ€§çš„è§’åº¦è€ƒè™‘ï¼š

* å°†**runASNonRoot**è®¾ç½®ä¸º**True**
* é…ç½®**runAsUser**
* å¦‚æœå¯èƒ½ï¼Œè€ƒè™‘é€šè¿‡æŒ‡å®š**seLinuxOptions**å’Œ**seccompProfile**æ¥**é™åˆ¶æƒé™**
* **ä¸è¦**é€šè¿‡**runAsGroup**å’Œ**supplementaryGroups**æˆäºˆ**ç‰¹æƒç»„**è®¿é—®æƒé™

| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>fsGroup</strong></a><br><em>æ•´æ•°</em></p>                                                                                                                                                                                                                                                 | <p>é€‚ç”¨äº**Podä¸­æ‰€æœ‰å®¹å™¨**çš„ç‰¹æ®Šè¡¥å……ç»„ã€‚æŸäº›å·ç±»å‹å…è®¸Kubeletå°†**è¯¥å·çš„æ‰€æœ‰æƒ**æ›´æ”¹ä¸ºç”±Podæ‹¥æœ‰ï¼š<br>1. æ‹¥æœ‰çš„GIDå°†æ˜¯FSGroup<br>2. è®¾ç½®äº†setgidä½ï¼ˆåœ¨å·ä¸­åˆ›å»ºçš„æ–°æ–‡ä»¶å°†ç”±FSGroupæ‹¥æœ‰ï¼‰<br>3. æƒé™ä½ä¸rw-rw----è¿›è¡ŒORè¿ç®— å¦‚æœæœªè®¾ç½®ï¼ŒKubeletå°†ä¸ä¼šä¿®æ”¹ä»»ä½•å·çš„æ‰€æœ‰æƒå’Œæƒé™</p> |
| ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>fsGroupChangePolicy</strong></a><br><em>å­—ç¬¦ä¸²</em></p>                                                                                                                                                                                                                                      | è¿™å®šä¹‰äº†åœ¨æš´éœ²åˆ°Podå†…éƒ¨ä¹‹å‰**æ›´æ”¹å·çš„æ‰€æœ‰æƒå’Œæƒé™**çš„è¡Œä¸ºã€‚                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>runAsGroup</strong></a><br><em>æ•´æ•°</em></p>                                                                                                                                                                                                                                              | ç”¨äºè¿è¡Œå®¹å™¨è¿›ç¨‹å…¥å£ç‚¹çš„**GID**ã€‚å¦‚æœæœªè®¾ç½®ï¼Œåˆ™ä½¿ç”¨è¿è¡Œæ—¶é»˜è®¤å€¼ã€‚ä¹Ÿå¯ä»¥åœ¨SecurityContextä¸­è®¾ç½®ã€‚                                                                                                                                                                                                                                                                                                                                                                                                                        |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>runAsNonRoot</strong></a><br><em>å¸ƒå°”å€¼</em></p>                                                                                                                                                                                                                                            | è¡¨ç¤ºå®¹å™¨å¿…é¡»ä»¥érootç”¨æˆ·èº«ä»½è¿è¡Œã€‚å¦‚æœä¸ºtrueï¼Œåˆ™Kubeletå°†åœ¨è¿è¡Œæ—¶éªŒè¯é•œåƒï¼Œä»¥ç¡®ä¿å…¶ä¸ä»¥UID 0ï¼ˆrootï¼‰è¿è¡Œï¼Œå¹¶åœ¨å…¶è¿™æ ·åšæ—¶æ— æ³•å¯åŠ¨å®¹å™¨ã€‚                                                                                                                                                                                                                                                                                                                                          |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>runAsUser</strong></a><br><em>æ•´æ•°</em></p>                                                                                                                                                                                                                                               | ç”¨äºè¿è¡Œå®¹å™¨è¿›ç¨‹å…¥å£ç‚¹çš„**UID**ã€‚å¦‚æœæœªæŒ‡å®šï¼Œé»˜è®¤ä¸ºé•œåƒå…ƒæ•°æ®ä¸­æŒ‡å®šçš„ç”¨æˆ·ã€‚                                                                                                                                                                                                                                                                                                                                                              |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>seLinuxOptions</strong></a><br><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#selinuxoptions-v1-core"><em>SELinuxOptions</em></a><br><em>æœ‰å…³</em> <em><strong>seLinux</strong></em>çš„æ›´å¤šä¿¡æ¯</p>                                                           | è¦åº”ç”¨äºæ‰€æœ‰å®¹å™¨çš„**SELinuxä¸Šä¸‹æ–‡**ã€‚å¦‚æœæœªæŒ‡å®šï¼Œå®¹å™¨è¿è¡Œæ—¶å°†ä¸ºæ¯ä¸ªå®¹å™¨åˆ†é…ä¸€ä¸ªéšæœºçš„SELinuxä¸Šä¸‹æ–‡ã€‚                                                                                                                                                                                                                                                                                                                             |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>seccompProfile</strong></a><br><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#seccompprofile-v1-core"><em>SeccompProfile</em></a><br><em>æœ‰å…³</em> <em><strong>Seccomp</strong></em>çš„æ›´å¤šä¿¡æ¯</p>                                                           | è¯¥Podä¸­å®¹å™¨ä½¿ç”¨çš„**seccompé€‰é¡¹**ã€‚                                                                                                                                                                                                                                                                                                                                                                                                                         |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>supplementalGroups</strong></a><br><em>æ•´æ•°æ•°ç»„</em></p>                                                                                                                                                                                                                                | åº”ç”¨äºæ¯ä¸ªå®¹å™¨ä¸­ç¬¬ä¸€ä¸ªè¿è¡Œè¿›ç¨‹çš„**ç»„åˆ—è¡¨**ï¼Œé™¤äº†å®¹å™¨çš„ä¸»è¦GIDã€‚                                                                                                                                                                                                                                                                                                                                                                  |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>sysctls</strong></a><br><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#sysctl-v1-core"><em>Sysctl</em></a> <em>æ•°ç»„</em><br><em>æœ‰å…³</em> <a href="https://www.garron.me/en/go2linux/sysctl-linux.html"><em><strong>sysctls</strong></em></a></p> | SysctlsåŒ…å«ç”¨äºè¯¥Podçš„**å‘½åç©ºé—´sysctls**åˆ—è¡¨ã€‚å…·æœ‰ä¸å—å®¹å™¨è¿è¡Œæ—¶æ”¯æŒçš„sysctlsçš„Podå¯èƒ½æ— æ³•å¯åŠ¨ã€‚                                                                                                                                                                                                                                                                                                                                        |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>windowsOptions</strong></a><br><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#windowssecuritycontextoptions-v1-core"><em>WindowsSecurityContextOptions</em></a></p>                                                                                           | åº”ç”¨äºæ‰€æœ‰å®¹å™¨çš„Windowsç‰¹å®šè®¾ç½®ã€‚å¦‚æœæœªæŒ‡å®šï¼Œå°†ä½¿ç”¨å®¹å™¨çš„SecurityContextä¸­çš„é€‰é¡¹ã€‚                                                                                                                                                                                                                                                                                                                                               |
## SecurityContext

[**æ¥è‡ªæ–‡æ¡£ï¼š**](https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core)

æ­¤ä¸Šä¸‹æ–‡è®¾ç½®åœ¨**å®¹å™¨å®šä¹‰**å†…ã€‚ä»é˜²å¾¡å®‰å…¨çš„è§’åº¦è€ƒè™‘ï¼š

- å°†**allowPrivilegeEscalation**è®¾ç½®ä¸º**False**
- ä¸è¦æ·»åŠ æ•æ„Ÿçš„**capabilities**ï¼ˆå¹¶ç§»é™¤ä¸éœ€è¦çš„ï¼‰
- å°†**privileged**è®¾ç½®ä¸º**False**
- å¦‚æœå¯èƒ½ï¼Œå°†**readOnlyFilesystem**è®¾ç½®ä¸º**True**
- å°†**runAsNonRoot**è®¾ç½®ä¸º**True**ï¼Œå¹¶è®¾ç½®ä¸€ä¸ª**runAsUser**
- å¦‚æœå¯èƒ½ï¼Œè€ƒè™‘é€šè¿‡æŒ‡å®š**seLinuxOptions**å’Œ**seccompProfile**æ¥**é™åˆ¶æƒé™**
- **ä¸è¦**é€šè¿‡**runAsGroup**ç»™äºˆ**ç‰¹æƒç»„**è®¿é—®æƒé™ã€‚

è¯·æ³¨æ„ï¼Œåœ¨**SecurityContextå’ŒPodSecurityContext**ä¸­è®¾ç½®çš„å±æ€§ï¼Œ**SecurityContext**ä¸­æŒ‡å®šçš„å€¼**ä¼˜å…ˆ**ã€‚

| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>allowPrivilegeEscalation</strong></a><br><em>boolean</em></p>                                                                                                                                                                      | **AllowPrivilegeEscalation** æ§åˆ¶è¿›ç¨‹æ˜¯å¦å¯ä»¥æ¯”å…¶çˆ¶è¿›ç¨‹**è·å¾—æ›´å¤šæƒé™**ã€‚æ­¤å¸ƒå°”å€¼ç›´æ¥æ§åˆ¶å®¹å™¨è¿›ç¨‹ä¸Šæ˜¯å¦è®¾ç½®no\_new\_privsæ ‡å¿—ã€‚å½“å®¹å™¨ä»¥**Privileged**æ–¹å¼è¿è¡Œæˆ–å…·æœ‰**CAP\_SYS\_ADMIN**æ—¶ï¼ŒAllowPrivilegeEscalationå§‹ç»ˆä¸ºtrue |
| ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>capabilities</strong></a><br><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#capabilities-v1-core"><em>Capabilities</em></a><br><em>More info about</em> <em><strong>Capabilities</strong></em></p>  | è¿è¡Œå®¹å™¨æ—¶è¦æ·»åŠ /åˆ é™¤çš„**capabilities**ã€‚é»˜è®¤ä¸ºé»˜è®¤çš„capabilitiesé›†ã€‚                                                                                                                                                                                                                    |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>privileged</strong></a><br><em>boolean</em></p>                                                                                                                                                                                    | ä»¥ç‰¹æƒæ¨¡å¼è¿è¡Œå®¹å™¨ã€‚ç‰¹æƒå®¹å™¨ä¸­çš„è¿›ç¨‹åŸºæœ¬ä¸Šç­‰åŒäºä¸»æœºä¸Šçš„rootã€‚é»˜è®¤ä¸ºfalseã€‚                                                                                                                                                                               |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>procMount</strong></a><br><em>string</em></p>                                                                                                                                                                                      | procMountè¡¨ç¤ºç”¨äºå®¹å™¨çš„**procæŒ‚è½½ç±»å‹**ã€‚é»˜è®¤å€¼ä¸ºDefaultProcMountï¼Œå®ƒä½¿ç”¨å®¹å™¨è¿è¡Œæ—¶é»˜è®¤å€¼æ¥è®¾ç½®åªè¯»è·¯å¾„å’Œæ©ç è·¯å¾„ã€‚                                                                                                                                    |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>readOnlyRootFilesystem</strong></a><br><em>boolean</em></p>                                                                                                                                                                        | æ­¤**å®¹å™¨æ˜¯å¦å…·æœ‰åªè¯»æ ¹æ–‡ä»¶ç³»ç»Ÿ**ã€‚é»˜è®¤å€¼ä¸ºfalseã€‚                                                                                                                                                                                                                                             |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>runAsGroup</strong></a><br><em>integer</em></p>                                                                                                                                                                                    | è¿è¡Œå®¹å™¨è¿›ç¨‹å…¥å£ç‚¹çš„**GID**ã€‚å¦‚æœæœªè®¾ç½®ï¼Œåˆ™ä½¿ç”¨è¿è¡Œæ—¶é»˜è®¤å€¼ã€‚                                                                                                                                                                                                                                |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>runAsNonRoot</strong></a><br><em>boolean</em></p>                                                                                                                                                                                  | è¡¨ç¤ºå®¹å™¨å¿…é¡»ä»¥érootç”¨æˆ·èº«ä»½è¿è¡Œã€‚å¦‚æœä¸ºtrueï¼Œåˆ™Kubeletå°†åœ¨è¿è¡Œæ—¶éªŒè¯é•œåƒï¼Œä»¥ç¡®ä¿å…¶ä¸ä»¥UID 0ï¼ˆrootï¼‰è¿è¡Œï¼Œå¹¶åœ¨å…¶ä»¥æ­¤è¿è¡Œæ—¶å¤±è´¥å¯åŠ¨å®¹å™¨ã€‚                                                                                                          |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>runAsUser</strong></a><br><em>integer</em></p>                                                                                                                                                                                     | è¿è¡Œå®¹å™¨è¿›ç¨‹å…¥å£ç‚¹çš„**UID**ã€‚å¦‚æœæœªæŒ‡å®šï¼Œé»˜è®¤ä¸ºé•œåƒå…ƒæ•°æ®ä¸­æŒ‡å®šçš„ç”¨æˆ·ã€‚                                                                                                                                                                                                  |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>seLinuxOptions</strong></a><br><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#selinuxoptions-v1-core"><em>SELinuxOptions</em></a><br><em>More info about</em> <em><strong>seLinux</strong></em></p> | è¦åº”ç”¨äºå®¹å™¨çš„**SELinuxä¸Šä¸‹æ–‡**ã€‚å¦‚æœæœªæŒ‡å®šï¼Œå®¹å™¨è¿è¡Œæ—¶å°†ä¸ºæ¯ä¸ªå®¹å™¨åˆ†é…ä¸€ä¸ªéšæœºçš„SELinuxä¸Šä¸‹æ–‡ã€‚                                                                                                                                                                  |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>seccompProfile</strong></a><br><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#seccompprofile-v1-core"><em>SeccompProfile</em></a></p>                                                               | æ­¤å®¹å™¨è¦ä½¿ç”¨çš„**seccompé€‰é¡¹**ã€‚                                                                                                                                                                                                                                                                         |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>windowsOptions</strong></a><br><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#windowssecuritycontextoptions-v1-core"><em>WindowsSecurityContextOptions</em></a></p>                                 | åº”ç”¨äºæ‰€æœ‰å®¹å™¨çš„**Windowsç‰¹å®šè®¾ç½®**ã€‚                                                                                                                                                                                                                                                              |

## å‚è€ƒèµ„æ–™

* [https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core](https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core)
* [https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core](https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core)

{% hint style="success" %}
å­¦ä¹ å¹¶ç»ƒä¹ AWS Hackingï¼š<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks åŸ¹è®­ AWS çº¢é˜Ÿä¸“å®¶ (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
å­¦ä¹ å¹¶ç»ƒä¹ GCP Hackingï¼š<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks åŸ¹è®­ GCP çº¢é˜Ÿä¸“å®¶ (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>æ”¯æŒ HackTricks</summary>

* æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– **ç”µæŠ¥ç¾¤ç»„**](https://t.me/peass) æˆ–åœ¨ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** ä¸Šå…³æ³¨æˆ‘ä»¬**ã€‚
* é€šè¿‡å‘**HackTricks**å’Œ**HackTricks Cloud** github ä»“åº“æäº¤ PR æ¥åˆ†äº«é»‘å®¢æŠ€å·§ã€‚

</details>
{% endhint %}
