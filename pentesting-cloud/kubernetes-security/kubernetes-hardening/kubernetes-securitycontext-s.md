# Kubernetes SecurityContext(s)

{% hint style="success" %}
Lerne & √ºbe AWS Hacking:<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Lerne & √ºbe GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* √úberpr√ºfe die [**Abonnementpl√§ne**](https://github.com/sponsors/carlospolop)!
* **Tritt der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folge** uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teile Hacking-Tricks, indem du PRs zu den** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repos einreichst.

</details>
{% endhint %}

## PodSecurityContext <a href="#podsecuritycontext-v1-core" id="podsecuritycontext-v1-core"></a>

[**Aus den Dokumenten:**](https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core)

Beim Festlegen des Sicherheitskontexts eines Pods kannst du mehrere Attribute verwenden. Aus einer defensiven Sicherheits-Perspektive solltest du Folgendes ber√ºcksichtigen:

* **runASNonRoot** auf **True** setzen
* **runAsUser** konfigurieren
* Wenn m√∂glich, **Berechtigungen** einschr√§nken, indem du **seLinuxOptions** und **seccompProfile** angibst
* Gib **keinen** **Privilegien** **Gruppen**-Zugriff √ºber **runAsGroup** und **supplementaryGroups**.

| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>fsGroup</strong></a><br><em>integer</em></p>                                                                                                                                                                                                                                                 | <p>Eine spezielle erg√§nzende Gruppe, die auf <strong>alle Container in einem Pod</strong> angewendet wird. Einige Volumentypen erlauben es dem Kubelet, die <strong>Besitzverh√§ltnisse dieses Volumens</strong> auf den Pod zu √§ndern:<br>1. Die besitzende GID wird die FSGroup sein<br>2. Das setgid-Bit ist gesetzt (neue Dateien, die im Volumen erstellt werden, geh√∂ren zur FSGroup)<br>3. Die Berechtigungsbits werden mit rw-rw---- OR'd. Wenn nicht gesetzt, wird das Kubelet die Besitzverh√§ltnisse und Berechtigungen eines Volumens nicht √§ndern.</p> |
| ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>fsGroupChangePolicy</strong></a><br><em>string</em></p>                                                                                                                                                                                                                                      | Dies definiert das Verhalten des **√Ñnderns von Besitzverh√§ltnissen und Berechtigungen des Volumens**, bevor es innerhalb des Pods exponiert wird.                                                                                                                                                                                                                                                                                                                                                                         |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>runAsGroup</strong></a><br><em>integer</em></p>                                                                                                                                                                                                                                              | Die **GID, unter der der Einstiegspunkt des Containerprozesses ausgef√ºhrt wird**. Verwendet den Standard zur Laufzeit, wenn nicht gesetzt.                                                                                                                                                                                                                                                                                                                                                        |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>runAsNonRoot</strong></a><br><em>boolean</em></p>                                                                                                                                                                                                                                            | Gibt an, dass der Container als ein Nicht-Root-Benutzer ausgef√ºhrt werden muss. Wenn dies zutrifft, validiert das Kubelet das Image zur Laufzeit, um sicherzustellen, dass es nicht als UID 0 (Root) ausgef√ºhrt wird, und schl√§gt fehl, den Container zu starten, wenn dies der Fall ist.                                                                                                                                                                                                                  |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>runAsUser</strong></a><br><em>integer</em></p>                                                                                                                                                                                                                                               | Die **UID, unter der der Einstiegspunkt des Containerprozesses ausgef√ºhrt wird**. Standardm√§√üig wird der Benutzer verwendet, der in den Metadaten des Images angegeben ist, wenn nicht angegeben.                                                                                                                                                                                                                                                                                                                                                              |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>seLinuxOptions</strong></a><br><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#selinuxoptions-v1-core"><em>SELinuxOptions</em></a><br><em>Weitere Informationen √ºber</em> <em><strong>seLinux</strong></em></p>                                                           | Der **SELinux-Kontext, der auf alle Container angewendet werden soll**. Wenn nicht angegeben, wird der Container-Laufzeit ein zuf√§lliger SELinux-Kontext f√ºr jeden Container zugewiesen.                                                                                                                                                                                                                                                                                                                             |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>seccompProfile</strong></a><br><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#seccompprofile-v1-core"><em>SeccompProfile</em></a><br><em>Weitere Informationen √ºber</em> <em><strong>Seccomp</strong></em></p>                                                           | Die **seccomp-Optionen, die von den Containern** in diesem Pod verwendet werden sollen.                                                                                                                                                                                                                                                                                                                                                                                                                         |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>supplementalGroups</strong></a><br><em>integer array</em></p>                                                                                                                                                                                                                                | Eine Liste von **Gruppen, die auf den ersten Prozess angewendet werden, der in jedem Container ausgef√ºhrt wird**, zus√§tzlich zur prim√§ren GID des Containers.                                                                                                                                                                                                                                                                                                                                                                  |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>sysctls</strong></a><br><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#sysctl-v1-core"><em>Sysctl</em></a> <em>array</em><br><em>Weitere Informationen √ºber</em> <a href="https://www.garron.me/en/go2linux/sysctl-linux.html"><em><strong>sysctls</strong></em></a></p> | Sysctls halten eine Liste von **namespaced sysctls, die f√ºr den Pod verwendet werden**. Pods mit nicht unterst√ºtzten Sysctls (durch die Container-Laufzeit) k√∂nnten beim Starten fehlschlagen.                                                                                                                                                                                                                                                                                                                                        |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>windowsOptions</strong></a><br><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#windowssecuritycontextoptions-v1-core"><em>WindowsSecurityContextOptions</em></a></p>                                                                                           | Die Windows-spezifischen Einstellungen, die auf alle Container angewendet werden. Wenn nicht angegeben, werden die Optionen innerhalb des Sicherheitskontexts eines Containers verwendet.                                                                                                                                                                                                                                                                                                                                               |

## SecurityContext

[**Aus den Dokumenten:**](https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core)

Dieser Kontext wird innerhalb der **Container-Definitionen** festgelegt. Aus einer defensiven Sicherheits-Perspektive solltest du Folgendes ber√ºcksichtigen:

* **allowPrivilegeEscalation** auf **False**
* F√ºge keine sensiblen **Capabilities** hinzu (und entferne die, die du nicht ben√∂tigst)
* **privileged** auf **False**
* Wenn m√∂glich, setze **readOnlyFilesystem** auf **True**
* Setze **runAsNonRoot** auf **True** und setze eine **runAsUser**
* Wenn m√∂glich, erw√§ge, **Berechtigungen** einzuschr√§nken, indem du **seLinuxOptions** und **seccompProfile** angibst
* Gib **keinen** **Privilegien** **Gruppen**-Zugriff √ºber **runAsGroup**.

Beachte, dass die in **beiden SecurityContext und PodSecurityContext** festgelegten Attribute, der in **SecurityContext** angegebene Wert **Vorrang** hat.

| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>allowPrivilegeEscalation</strong></a><br><em>boolean</em></p>                                                                                                                                                                      | **AllowPrivilegeEscalation** steuert, ob ein Prozess **mehr Privilegien** als sein √ºbergeordneter Prozess **erlangen kann**. Dieses Bool steuert direkt, ob das no\_new\_privs-Flag f√ºr den Containerprozess gesetzt wird. AllowPrivilegeEscalation ist immer true, wenn der Container als **Privileged** ausgef√ºhrt wird oder **CAP\_SYS\_ADMIN** hat. |
| ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>capabilities</strong></a><br><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#capabilities-v1-core"><em>Capabilities</em></a><br><em>Weitere Informationen √ºber</em> <em><strong>Capabilities</strong></em></p>  | Die **Capabilities, die beim Ausf√ºhren von Containern hinzugef√ºgt/entfernt werden sollen**. Standardm√§√üig wird das Standardset von Capabilities verwendet.                                                                                                                                                                                                                    |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>privileged</strong></a><br><em>boolean</em></p>                                                                                                                                                                                    | F√ºhre den Container im privilegierten Modus aus. Prozesse in privilegierten Containern sind im Wesentlichen **√§quivalent zu root auf dem Host**. Standardm√§√üig ist dies false.                                                                                                                                                                               |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>procMount</strong></a><br><em>string</em></p>                                                                                                                                                                                      | procMount bezeichnet den **Typ des proc-Mounts, der f√ºr die Container verwendet werden soll**. Der Standard ist DefaultProcMount, der die Standardwerte der Container-Laufzeit f√ºr schreibgesch√ºtzte Pfade und maskierte Pfade verwendet.                                                                                                                                    |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>readOnlyRootFilesystem</strong></a><br><em>boolean</em></p>                                                                                                                                                                        | Ob dieser **Container ein schreibgesch√ºtztes Root-Dateisystem hat**. Standard ist false.                                                                                                                                                                                                                                             |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>runAsGroup</strong></a><br><em>integer</em></p>                                                                                                                                                                                    | Die **GID, unter der der Einstiegspunkt** des Containerprozesses ausgef√ºhrt wird. Verwendet den Standard zur Laufzeit, wenn nicht gesetzt.                                                                                                                                                                                                                                |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>runAsNonRoot</strong></a><br><em>boolean</em></p>                                                                                                                                                                                  | Gibt an, dass der Container **als ein Nicht-Root-Benutzer** ausgef√ºhrt werden muss. Wenn dies zutrifft, validiert das Kubelet das Image zur Laufzeit, um sicherzustellen, dass es nicht als UID 0 (Root) ausgef√ºhrt wird, und schl√§gt fehl, den Container zu starten, wenn dies der Fall ist.                                                                                                          |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>runAsUser</strong></a><br><em>integer</em></p>                                                                                                                                                                                     | Die **UID, unter der der Einstiegspunkt** des Containerprozesses ausgef√ºhrt wird. Standardm√§√üig wird der Benutzer verwendet, der in den Metadaten des Images angegeben ist, wenn nicht angegeben.                                                                                                                                                                                                  |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>seLinuxOptions</strong></a><br><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#selinuxoptions-v1-core"><em>SELinuxOptions</em></a><br><em>Weitere Informationen √ºber</em> <em><strong>seLinux</strong></em></p> | Der **SELinux-Kontext, der auf den Container angewendet werden soll**. Wenn nicht angegeben, wird der Container-Laufzeit ein zuf√§lliger SELinux-Kontext f√ºr jeden Container zugewiesen.                                                                                                                                                                  |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>seccompProfile</strong></a><br><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#seccompprofile-v1-core"><em>SeccompProfile</em></a></p>                                                               | Die **seccomp-Optionen**, die von diesem Container verwendet werden sollen.                                                                                                                                                                                                                                                                         |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>windowsOptions</strong></a><br><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#windowssecuritycontextoptions-v1-core"><em>WindowsSecurityContextOptions</em></a></p>                                 | Die **Windows-spezifischen Einstellungen**, die auf alle Container angewendet werden.                                                                                                                                                                                                                                                              |

## References

* [https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core](https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core)
* [https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core](https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core)

{% hint style="success" %}
Lerne & √ºbe AWS Hacking:<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Lerne & √ºbe GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* √úberpr√ºfe die [**Abonnementpl√§ne**](https://github.com/sponsors/carlospolop)!
* **Tritt der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folge** uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teile Hacking-Tricks, indem du PRs zu den** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repos einreichst.

</details>
{% endhint %}
