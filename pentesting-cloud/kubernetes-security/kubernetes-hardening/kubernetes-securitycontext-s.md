# Kubernetes SecurityContext(s)

{% hint style="success" %}
Aprenda e pratique Hacking AWS:<img src="../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">\
Aprenda e pratique Hacking GCP: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Confira os [**planos de assinatura**](https://github.com/sponsors/carlospolop)!
* **Junte-se ao** üí¨ [**grupo do Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga**-nos no **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe truques de hacking enviando PRs para os reposit√≥rios do** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
{% endhint %}

## PodSecurityContext <a href="#podsecuritycontext-v1-core" id="podsecuritycontext-v1-core"></a>

[**Da documenta√ß√£o:**](https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core)

Ao especificar o contexto de seguran√ßa de um Pod, voc√™ pode usar v√°rios atributos. Do ponto de vista da seguran√ßa defensiva, voc√™ deve considerar:

* Ter **runASNonRoot** como **True**
* Configurar **runAsUser**
* Se poss√≠vel, considere **limitar** **permiss√µes** indicando **seLinuxOptions** e **seccompProfile**
* **N√ÉO** conceda acesso ao **grupo** de **privilegio** via **runAsGroup** e **supplementaryGroups**

| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>fsGroup</strong></a><br><em>inteiro</em></p>                                                                                                                                                                                                                                                 | <p>Um grupo suplementar especial que se aplica a <strong>todos os cont√™ineres em um pod</strong>. Alguns tipos de volume permitem que o Kubelet <strong>mude a propriedade desse volume</strong> para ser de propriedade do pod:<br>1. O GID propriet√°rio ser√° o FSGroup<br>2. O bit setgid est√° definido (novos arquivos criados no volume ser√£o de propriedade do FSGroup)<br>3. Os bits de permiss√£o s√£o OR'd com rw-rw---- Se n√£o definido, o Kubelet n√£o modificar√° a propriedade e permiss√µes de nenhum volume</p> |
| ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>fsGroupChangePolicy</strong></a><br><em>string</em></p>                                                                                                                                                                                                                                      | Isso define o comportamento de **mudan√ßa de propriedade e permiss√£o do volume** antes de ser exposto dentro do Pod.                                                                                                                                                                                                                                                                                                                                                                         |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>runAsGroup</strong></a><br><em>inteiro</em></p>                                                                                                                                                                                                                                              | O **GID para executar o ponto de entrada do processo do cont√™iner**. Usa o padr√£o de tempo de execu√ß√£o se n√£o definido.                                                                                                                                                                                                                                                                                                                                                        |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>runAsNonRoot</strong></a><br><em>booleano</em></p>                                                                                                                                                                                                                                            | Indica que o cont√™iner deve ser executado como um usu√°rio n√£o-root. Se verdadeiro, o Kubelet validar√° a imagem em tempo de execu√ß√£o para garantir que n√£o seja executada como UID 0 (root) e falhar√° ao iniciar o cont√™iner se o fizer.                                                                                                                                                                                                                                                                          |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>runAsUser</strong></a><br><em>inteiro</em></p>                                                                                                                                                                                                                                               | O **UID para executar o ponto de entrada do processo do cont√™iner**. Padr√£o para o usu√°rio especificado nos metadados da imagem, se n√£o especificado.                                                                                                                                                                                                                                                                                                                                                              |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>seLinuxOptions</strong></a><br><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#selinuxoptions-v1-core"><em>SELinuxOptions</em></a><br><em>Mais informa√ß√µes sobre</em> <em><strong>seLinux</strong></em></p>                                                           | O **contexto SELinux a ser aplicado a todos os cont√™ineres**. Se n√£o especificado, o tempo de execu√ß√£o do cont√™iner alocar√° um contexto SELinux aleat√≥rio para cada cont√™iner.                                                                                                                                                                                                                                                                                                                             |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>seccompProfile</strong></a><br><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#seccompprofile-v1-core"><em>SeccompProfile</em></a><br><em>Mais informa√ß√µes sobre</em> <em><strong>Seccomp</strong></em></p>                                                           | As **op√ß√µes seccomp a serem usadas pelos cont√™ineres** neste pod.                                                                                                                                                                                                                                                                                                                                                                                                                         |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>supplementalGroups</strong></a><br><em>array de inteiros</em></p>                                                                                                                                                                                                                                | Uma lista de **grupos aplicados ao primeiro processo executado em cada cont√™iner**, al√©m do GID prim√°rio do cont√™iner.                                                                                                                                                                                                                                                                                                                                                                  |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>sysctls</strong></a><br><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#sysctl-v1-core"><em>Sysctl</em></a> <em>array</em><br><em>Mais informa√ß√µes sobre</em> <a href="https://www.garron.me/en/go2linux/sysctl-linux.html"><em><strong>sysctls</strong></em></a></p> | Sysctls mant√©m uma lista de **sysctls namespaced usados para o pod**. Pods com sysctls n√£o suportados (pelo tempo de execu√ß√£o do cont√™iner) podem falhar ao iniciar.                                                                                                                                                                                                                                                                                                                                        |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>windowsOptions</strong></a><br><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#windowssecuritycontextoptions-v1-core"><em>WindowsSecurityContextOptions</em></a></p>                                                                                           | As configura√ß√µes espec√≠ficas do Windows aplicadas a todos os cont√™ineres. Se n√£o especificado, as op√ß√µes dentro do SecurityContext de um cont√™iner ser√£o usadas.                                                                                                                                                                                                                                                                                                                                               |

## SecurityContext

[**Da documenta√ß√£o:**](https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core)

Este contexto √© definido dentro das **defini√ß√µes de cont√™ineres**. Do ponto de vista da seguran√ßa defensiva, voc√™ deve considerar:

* **allowPrivilegeEscalation** como **False**
* N√£o adicione **capacidades** sens√≠veis (e remova as que voc√™ n√£o precisa)
* **privileged** como **False**
* Se poss√≠vel, defina **readOnlyFilesystem** como **True**
* Defina **runAsNonRoot** como **True** e defina um **runAsUser**
* Se poss√≠vel, considere **limitar** **permiss√µes** indicando **seLinuxOptions** e **seccompProfile**
* **N√ÉO** conceda acesso ao **grupo** de **privilegio** via **runAsGroup.**

Observe que os atributos definidos em **ambos SecurityContext e PodSecurityContext**, o valor especificado em **SecurityContext** tem **preced√™ncia**.

| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>allowPrivilegeEscalation</strong></a><br><em>booleano</em></p>                                                                                                                                                                      | **AllowPrivilegeEscalation** controla se um processo pode **ganhar mais privil√©gios** do que seu processo pai. Este booleano controla diretamente se a flag no\_new\_privs ser√° definida no processo do cont√™iner. AllowPrivilegeEscalation √© verdadeiro sempre que o cont√™iner √© executado como **Privileged** ou tem **CAP\_SYS\_ADMIN** |
| ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>capabilities</strong></a><br><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#capabilities-v1-core"><em>Capabilities</em></a><br><em>Mais informa√ß√µes sobre</em> <em><strong>Capabilities</strong></em></p>  | As **capacidades a serem adicionadas/removidas ao executar cont√™ineres**. Padr√£o para o conjunto padr√£o de capacidades.                                                                                                                                                                                                                    |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>privileged</strong></a><br><em>booleano</em></p>                                                                                                                                                                                    | Executar cont√™iner em modo privilegiado. Processos em cont√™ineres privilegiados s√£o essencialmente **equivalentes ao root no host**. Padr√£o √© falso.                                                                                                                                                                               |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>procMount</strong></a><br><em>string</em></p>                                                                                                                                                                                      | procMount denota o **tipo de montagem proc a ser usado para os cont√™ineres**. O padr√£o √© DefaultProcMount, que usa os padr√µes de tempo de execu√ß√£o do cont√™iner para caminhos somente leitura e caminhos mascarados.                                                                                                                                    |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>readOnlyRootFilesystem</strong></a><br><em>booleano</em></p>                                                                                                                                                                        | Se este **cont√™iner tem um sistema de arquivos raiz somente leitura**. O padr√£o √© falso.                                                                                                                                                                                                                                             |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>runAsGroup</strong></a><br><em>inteiro</em></p>                                                                                                                                                                                    | O **GID para executar o ponto de entrada** do processo do cont√™iner. Usa o padr√£o de tempo de execu√ß√£o se n√£o definido.                                                                                                                                                                                                                                |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>runAsNonRoot</strong></a><br><em>booleano</em></p>                                                                                                                                                                                  | Indica que o cont√™iner deve **executar como um usu√°rio n√£o-root**. Se verdadeiro, o Kubelet validar√° a imagem em tempo de execu√ß√£o para garantir que n√£o seja executada como UID 0 (root) e falhar√° ao iniciar o cont√™iner se o fizer.                                                                                                          |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>runAsUser</strong></a><br><em>inteiro</em></p>                                                                                                                                                                                     | O **UID para executar o ponto de entrada** do processo do cont√™iner. Padr√£o para o usu√°rio especificado nos metadados da imagem, se n√£o especificado.                                                                                                                                                                                                  |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>seLinuxOptions</strong></a><br><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#selinuxoptions-v1-core"><em>SELinuxOptions</em></a><br><em>Mais informa√ß√µes sobre</em> <em><strong>seLinux</strong></em></p> | O **contexto SELinux a ser aplicado ao cont√™iner**. Se n√£o especificado, o tempo de execu√ß√£o do cont√™iner alocar√° um contexto SELinux aleat√≥rio para cada cont√™iner.                                                                                                                                                                  |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>seccompProfile</strong></a><br><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#seccompprofile-v1-core"><em>SeccompProfile</em></a></p>                                                               | As **op√ß√µes seccomp** a serem usadas por este cont√™iner.                                                                                                                                                                                                                                                                         |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>windowsOptions</strong></a><br><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#windowssecuritycontextoptions-v1-core"><em>WindowsSecurityContextOptions</em></a></p>                                 | As **configura√ß√µes espec√≠ficas do Windows** aplicadas a todos os cont√™ineres.                                                                                                                                                                                                                                                              |

## Refer√™ncias

* [https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core](https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core)
* [https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core](https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core)

{% hint style="success" %}
Aprenda e pratique Hacking AWS:<img src="../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">\
Aprenda e pratique Hacking GCP: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Confira os [**planos de assinatura**](https://github.com/sponsors/carlospolop)!
* **Junte-se ao** üí¨ [**grupo do Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga**-nos no **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe truques de hacking enviando PRs para os reposit√≥rios do** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
{% endhint %}
