# Kubernetes SecurityContext(s)

{% hint style="success" %}
U캜ite i ve쬭ajte AWS Hacking:<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
U캜ite i ve쬭ajte GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Podr쬴te HackTricks</summary>

* Proverite [**planove pretplate**](https://github.com/sponsors/carlospolop)!
* **Pridru쬴te se** 游눫 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili **pratite** nas na **Twitteru** 游냕 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podelite hakerske trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
{% endhint %}

## PodSecurityContext <a href="#podsecuritycontext-v1-core" id="podsecuritycontext-v1-core"></a>

[**Iz dokumenata:**](https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core)

Kada defini코ete bezbednosni kontekst Pod-a, mo쬰te koristiti nekoliko atributa. Sa stanovi코ta odbrane, trebali biste razmotriti:

* Da **runASNonRoot** bude **True**
* Da konfiguri코ete **runAsUser**
* Ako je mogu캖e, razmotrite **ograni캜avanje** **dozvola** ozna캜avanjem **seLinuxOptions** i **seccompProfile**
* **NE** dajte **privilegije** **grupi** putem **runAsGroup** i **supplementaryGroups**

| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>fsGroup</strong></a><br><em>integer</em></p>                                                                                                                                                                                                                                                 | <p>Specijalna dopunska grupa koja se primenjuje na <strong>sve kontejnere u podu</strong>. Neki tipovi volumena omogu캖avaju Kubelet-u da <strong>promeni vlasni코tvo tog volumena</strong> da bude u vlasni코tvu poda:<br>1. Vlasni캜ki GID 캖e biti FSGroup<br>2. Setgid bit je postavljen (nove datoteke kreirane u volumenu 캖e biti u vlasni코tvu FSGroup)<br>3. Dozvola bitovi su OR'd sa rw-rw---- Ako nije postavljeno, Kubelet ne캖e menjati vlasni코tvo i dozvole bilo kog volumena</p> |
| ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>fsGroupChangePolicy</strong></a><br><em>string</em></p>                                                                                                                                                                                                                                      | Ovo defini코e pona코anje **promene vlasni코tva i dozvola volumena** pre nego 코to bude izlo쬰n unutar Pod-a.                                                                                                                                                                                                                                                                                                                                                                         |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>runAsGroup</strong></a><br><em>integer</em></p>                                                                                                                                                                                                                                              | **GID za pokretanje ulazne ta캜ke procesa kontejnera**. Koristi podrazumevanu vrednost vremena izvo캠enja ako nije postavljeno. Mo쬰 se tako캠e postaviti u SecurityContext.                                                                                                                                                                                                                                                                                                                                                        |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>runAsNonRoot</strong></a><br><em>boolean</em></p>                                                                                                                                                                                                                                            | Ukazuje da kontejner mora da se pokrene kao korisnik koji nije root. Ako je ta캜no, Kubelet 캖e validirati sliku u vreme izvo캠enja kako bi osigurao da se ne pokre캖e kao UID 0 (root) i ne캖e mo캖i da pokrene kontejner ako to u캜ini.                                                                                                                                                                                                                                                                          |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>runAsUser</strong></a><br><em>integer</em></p>                                                                                                                                                                                                                                               | **UID za pokretanje ulazne ta캜ke procesa kontejnera**. Podrazumevano je korisnik naveden u metapodacima slike ako nije navedeno.                                                                                                                                                                                                                                                                                                                                                              |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>seLinuxOptions</strong></a><br><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#selinuxoptions-v1-core"><em>SELinuxOptions</em></a><br><em>Vi코e informacija o</em> <em><strong>seLinux</strong></em></p>                                                           | **SELinux kontekst koji 캖e se primeniti na sve kontejnere**. Ako nije navedeno, runtime kontejnera 캖e dodeliti nasumi캜an SELinux kontekst za svaki kontejner.                                                                                                                                                                                                                                                                                                                             |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>seccompProfile</strong></a><br><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#seccompprofile-v1-core"><em>SeccompProfile</em></a><br><em>Vi코e informacija o</em> <em><strong>Seccomp</strong></em></p>                                                           | **Seccomp opcije koje koriste kontejneri** u ovom podu.                                                                                                                                                                                                                                                                                                                                                                                                                         |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>supplementalGroups</strong></a><br><em>integer array</em></p>                                                                                                                                                                                                                                | Lista **grupa primenjenih na prvi proces pokrenut u svakom kontejneru**, pored primarnog GID-a kontejnera.                                                                                                                                                                                                                                                                                                                                                                  |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>sysctls</strong></a><br><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#sysctl-v1-core"><em>Sysctl</em></a> <em>niz</em><br><em>Vi코e informacija o</em> <a href="https://www.garron.me/en/go2linux/sysctl-linux.html"><em><strong>sysctls</strong></em></a></p> | Sysctls sadr쬰 listu **imenskih sysctls kori코캖enih za pod**. Podovi sa nepodr쬬nim sysctls (od strane runtime-a kontejnera) mogu propasti prilikom pokretanja.                                                                                                                                                                                                                                                                                                                                        |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>windowsOptions</strong></a><br><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#windowssecuritycontextoptions-v1-core"><em>WindowsSecurityContextOptions</em></a></p>                                                                                           | Windows specifi캜ne postavke primenjene na sve kontejnere. Ako nije navedeno, koristi캖e se opcije unutar SecurityContext-a kontejnera.                                                                                                                                                                                                                                                                                                                                               |

## SecurityContext

[**Iz dokumenata:**](https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core)

Ovaj kontekst se postavlja unutar **definicija kontejnera**. Sa stanovi코ta odbrane, trebali biste razmotriti:

* **allowPrivilegeEscalation** na **False**
* Ne dodavati osetljive **kapacitete** (i ukloniti one koje ne trebate)
* **privileged** na **False**
* Ako je mogu캖e, postavite **readOnlyFilesystem** na **True**
* Postavite **runAsNonRoot** na **True** i postavite **runAsUser**
* Ako je mogu캖e, razmotrite **ograni캜avanje** **dozvola** ozna캜avanjem **seLinuxOptions** i **seccompProfile**
* **NE** dajte **privilegije** **grupi** putem **runAsGroup.**

Napomena: Atributi postavljeni u **SecurityContext i PodSecurityContext**, vrednost navedena u **SecurityContext** ima **prioritet**.

| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>allowPrivilegeEscalation</strong></a><br><em>boolean</em></p>                                                                                                                                                                      | **AllowPrivilegeEscalation** kontroli코e da li proces mo쬰 **dobiti vi코e privilegija** od svog roditeljskog procesa. Ova bool direktno kontroli코e da li 캖e biti postavljena oznaka no\_new\_privs na procesu kontejnera. AllowPrivilegeEscalation je uvek ta캜no kada se kontejner pokre캖e kao **Privileged** ili ima **CAP\_SYS\_ADMIN** |
| ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>capabilities</strong></a><br><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#capabilities-v1-core"><em>Capabilities</em></a><br><em>Vi코e informacija o</em> <em><strong>Capabilities</strong></em></p>  | **Kapaciteti koje treba dodati/ukloniti prilikom pokretanja kontejnera**. Podrazumevano je postavljen na podrazumevani skup kapaciteta.                                                                                                                                                                                                                    |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>privileged</strong></a><br><em>boolean</em></p>                                                                                                                                                                                    | Pokrenite kontejner u privilegovanom re쬴mu. Procesi u privilegovanim kontejnerima su su코tinski **ekvivalentni root-u na hostu**. Podrazumevano je false.                                                                                                                                                                               |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>procMount</strong></a><br><em>string</em></p>                                                                                                                                                                                      | procMount ozna캜ava **tip proc mount-a koji 캖e se koristiti za kontejnere**. Podrazumevano je DefaultProcMount koji koristi podrazumevane vrednosti runtime-a za putanje samo za 캜itanje i maskirane putanje.                                                                                                                                    |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>readOnlyRootFilesystem</strong></a><br><em>boolean</em></p>                                                                                                                                                                        | Da li ovaj **kontejner ima read-only root filesystem**. Podrazumevano je false.                                                                                                                                                                                                                                             |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>runAsGroup</strong></a><br><em>integer</em></p>                                                                                                                                                                                    | **GID za pokretanje ulazne ta캜ke** procesa kontejnera. Koristi podrazumevanu vrednost vremena izvo캠enja ako nije postavljeno.                                                                                                                                                                                                                                |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>runAsNonRoot</strong></a><br><em>boolean</em></p>                                                                                                                                                                                  | Ukazuje da kontejner mora **da se pokrene kao korisnik koji nije root**. Ako je ta캜no, Kubelet 캖e validirati sliku u vreme izvo캠enja kako bi osigurao da se ne pokre캖e kao UID 0 (root) i ne캖e mo캖i da pokrene kontejner ako to u캜ini.                                                                                                          |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>runAsUser</strong></a><br><em>integer</em></p>                                                                                                                                                                                     | **UID za pokretanje ulazne ta캜ke** procesa kontejnera. Podrazumevano je korisnik naveden u metapodacima slike ako nije navedeno.                                                                                                                                                                                                  |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>seLinuxOptions</strong></a><br><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#selinuxoptions-v1-core"><em>SELinuxOptions</em></a><br><em>Vi코e informacija o</em> <em><strong>seLinux</strong></em></p> | **SELinux kontekst koji 캖e se primeniti na kontejner**. Ako nije navedeno, runtime kontejnera 캖e dodeliti nasumi캜an SELinux kontekst za svaki kontejner.                                                                                                                                                                  |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>seccompProfile</strong></a><br><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#seccompprofile-v1-core"><em>SeccompProfile</em></a></p>                                                               | **Seccomp opcije** koje koristi ovaj kontejner.                                                                                                                                                                                                                                                                         |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>windowsOptions</strong></a><br><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#windowssecuritycontextoptions-v1-core"><em>WindowsSecurityContextOptions</em></a></p>                                 | **Windows specifi캜ne postavke** primenjene na sve kontejnere.                                                                                                                                                                                                                                                              |

## Reference

* [https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core](https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core)
* [https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core](https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core)

{% hint style="success" %}
U캜ite i ve쬭ajte AWS Hacking:<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
U캜ite i ve쬭ajte GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Podr쬴te HackTricks</summary>

* Proverite [**planove pretplate**](https://github.com/sponsors/carlospolop)!
* **Pridru쬴te se** 游눫 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili **pratite** nas na **Twitteru** 游냕 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podelite hakerske trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
{% endhint %}
