# Kubernetes SecurityContext(s)

{% hint style="success" %}
U캜ite i ve쬭ajte hakovanje AWS:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
U캜ite i ve쬭ajte hakovanje GCP: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Podr쬴te HackTricks</summary>

* Proverite [**planove pretplate**](https://github.com/sponsors/carlospolop)!
* **Pridru쬴te se** 游눫 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitteru** 游냕 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podelite hakovanje trikova slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
{% endhint %}

## PodSecurityContext <a href="#podsecuritycontext-v1-core" id="podsecuritycontext-v1-core"></a>

[**Iz dokumentacije:**](https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core)

Prilikom specificiranja sigurnosnog konteksta za Pod, mo쬰te koristiti nekoliko atributa. Sa aspekta defanzivne sigurnosti, trebalo bi da razmotrite:

* Da imate **runASNonRoot** kao **True**
* Da konfiguri코ete **runAsUser**
* Ako je mogu캖e, razmotrite **ograni캜avanje** **dozvola** navo캠enjem **seLinuxOptions** i **seccompProfile**
* **NE** dajte **pristup privilegijama grupa** putem **runAsGroup** i **supplementaryGroups**

| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>fsGroup</strong></a><br><em>celobrojno</em></p>                                                                                                                                                                                                                                                 | <p>Specijalna dodatna grupa koja se odnosi na <strong>sve kontejnere u podu</strong>. Neki tipovi volumena omogu캖avaju Kubeletu da <strong>promeni vlasni코tvo tog volumena</strong> tako da bude vlasni코tvo poda:<br>1. GID vlasnika 캖e biti FSGroup<br>2. Bit setgid je postavljen (novi fajlovi kreirani u volumenu 캖e biti vlasni코tvo FSGroup)<br>3. Dozvole bitova se OR-ovaju sa rw-rw---- Ako nije postavljeno, Kubelet ne캖e modifikovati vlasni코tvo i dozvole nijednog volumena</p> |
| ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>fsGroupChangePolicy</strong></a><br><em>string</em></p>                                                                                                                                                                                                                                      | Defini코e pona코anje **promene vlasni코tva i dozvola volumena** pre nego 코to budu izlo쬰ni unutar Poda.                                                                                                                                                                                                                                                                                                                                                                         |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>runAsGroup</strong></a><br><em>celobrojno</em></p>                                                                                                                                                                                                                                              | **GID za pokretanje ulazne ta캜ke procesa kontejnera**. Koristi se podrazumevana vrednost za pokretanje. Mo쬰 tako캠e biti postavljeno u SecurityContext-u.                                                                                                                                                                                                                                                                                                                                                        |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>runAsNonRoot</strong></a><br><em>boolean</em></p>                                                                                                                                                                                                                                            | Ozna캜ava da kontejner mora da se pokre캖e kao korisnik koji nije root. Ako je ta캜no, Kubelet 캖e validirati sliku u toku izvr코avanja kako bi se osiguralo da se ne pokre캖e kao UID 0 (root) i ne캖e uspeti da pokrene kontejner ako je tako.                                                                                                                                                                                                                                                                          |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>runAsUser</strong></a><br><em>celobrojno</em></p>                                                                                                                                                                                                                                               | **UID za pokretanje ulazne ta캜ke procesa kontejnera**. Podrazumevano je korisnik naveden u metapodacima slike ako nije naveden.                                                                                                                                                                                                                                                                                                                                                              |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>seLinuxOptions</strong></a><br><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#selinuxoptions-v1-core"><em>SELinuxOptions</em></a><br><em>Vi코e informacija o</em> <em><strong>seLinux</strong></em></p>                                                           | **SELinux kontekst koji 캖e se primeniti na sve kontejnere**. Ako nije navedeno, runtime kontejnera 캖e dodeliti nasumi캜an SELinux kontekst za svaki kontejner.                                                                                                                                                                                                                                                                                                                             |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>seccompProfile</strong></a><br><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#seccompprofile-v1-core"><em>SeccompProfile</em></a><br><em>Vi코e informacija o</em> <em><strong>Seccomp</strong></em></p>                                                           | **Seccomp opcije koje 캖e koristiti kontejneri** u ovom podu.                                                                                                                                                                                                                                                                                                                                                                                                                         |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>supplementalGroups</strong></a><br><em>niz celobrojnih vrednosti</em></p>                                                                                                                                                                                                                                | Lista **grupa koje se primenjuju na prvi proces pokrenut u svakom kontejneru**, pored primarne GID kontejnera.                                                                                                                                                                                                                                                                                                                                                                  |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>sysctls</strong></a><br><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#sysctl-v1-core"><em>Sysctl</em></a> <em>niz</em><br><em>Vi코e informacija o</em> <a href="https://www.garron.me/en/go2linux/sysctl-linux.html"><em><strong>sysctls</strong></em></a></p> | Sysctls sadr쬰 listu **namespaced sysctl-ova kori코캖enih za pod**. Podovi sa nepodr쬬nim sysctl-ovima (od strane runtime kontejnera) mogu neuspe코no pokrenuti.                                                                                                                                                                                                                                                                                                                                        |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>windowsOptions</strong></a><br><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#windowssecuritycontextoptions-v1-core"><em>WindowsSecurityContextOptions</em></a></p>                                                                                           | Windows specifi캜na pode코avanja koja se primenjuju na sve kontejnere. Ako nije navedeno, opcije unutar SecurityContext-a kontejnera 캖e biti kori코캖ene.                                                                                                                                                                                                                                                                                                                                               |
## SecurityContext

[**Iz dokumenata:**](https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core)

Ovaj kontekst je postavljen unutar **definicija kontejnera**. Sa stanovi코ta defanzivne sigurnosti trebalo bi da razmotrite:

* **allowPrivilegeEscalation** na **False**
* Ne dodavati osetljive **capabilities** (i ukloniti one koje vam nisu potrebne)
* **privileged** na **False**
* Ako je mogu캖e, postaviti **readOnlyFilesystem** kao **True**
* Postaviti **runAsNonRoot** na **True** i postaviti **runAsUser**
* Ako je mogu캖e, razmotrite **ograni캜avanje** **dozvola** navo캠enjem **seLinuxOptions** i **seccompProfile**
* **NE** davati pristup **privilegovanom** **grupom** putem **runAsGroup.**

Imajte na umu da atributi postavljeni u **obe SecurityContext i PodSecurityContext**, vrednost navedena u **SecurityContext** ima **prioritet**.

| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>allowPrivilegeEscalation</strong></a><br><em>boolean</em></p>                                                                                                                                                                      | **AllowPrivilegeEscalation** kontroli코e da li proces mo쬰 **dobiti vi코e privilegija** od svog roditeljskog procesa. Ova logi캜ka vrednost direktno kontroli코e da li 캖e biti postavljena zastava no\_new\_privs na procesu kontejnera. AllowPrivilegeEscalation je uvek ta캜an kada se kontejner pokre캖e kao **Privileged** ili ima **CAP\_SYS\_ADMIN** |
| ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>capabilities</strong></a><br><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#capabilities-v1-core"><em>Capabilities</em></a><br><em>Vi코e informacija o</em> <em><strong>Capabilities</strong></em></p>  | **Capabilities koje treba dodati/ukloniti prilikom pokretanja kontejnera**. Podrazumevano je postavljeno na podrazumevani skup mogu캖nosti.                                                                                                                                                                                                                    |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>privileged</strong></a><br><em>boolean</em></p>                                                                                                                                                                                    | Pokreni kontejner u privilegovanom re쬴mu. Procesi u privilegovanim kontejnerima su su코tinski **ekvivalentni root korisniku na hostu**. Podrazumevano je false.                                                                                                                                                                               |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>procMount</strong></a><br><em>string</em></p>                                                                                                                                                                                      | procMount ozna캜ava **tip proc mounta koji se koristi za kontejnere**. Podrazumevano je DefaultProcMount koji koristi podrazumevane vrednosti za putanje samo za 캜itanje i maskirane putanje.                                                                                                                                    |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>readOnlyRootFilesystem</strong></a><br><em>boolean</em></p>                                                                                                                                                                        | Da li ovaj **kontejner ima root fajl sistem samo za 캜itanje**. Podrazumevano je false.                                                                                                                                                                                                                                             |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>runAsGroup</strong></a><br><em>integer</em></p>                                                                                                                                                                                    | **GID za pokretanje ulazne ta캜ke** procesa kontejnera. Koristi podrazumevane vrednosti za pokretanje ako nije postavljeno.                                                                                                                                                                                                                                |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>runAsNonRoot</strong></a><br><em>boolean</em></p>                                                                                                                                                                                  | Ozna캜ava da kontejner mora **raditi kao korisnik koji nije root**. Ako je ta캜no, Kubelet 캖e validirati sliku u toku izvr코avanja kako bi se osiguralo da se ne pokre캖e kao UID 0 (root) i ne캖e uspeti da pokrene kontejner ako to u캜ini.                                                                                                          |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>runAsUser</strong></a><br><em>integer</em></p>                                                                                                                                                                                     | **UID za pokretanje ulazne ta캜ke** procesa kontejnera. Podrazumevano je korisnik naveden u metapodacima slike ako nije naveden.                                                                                                                                                                                                  |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>seLinuxOptions</strong></a><br><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#selinuxoptions-v1-core"><em>SELinuxOptions</em></a><br><em>Vi코e informacija o</em> <em><strong>seLinux</strong></em></p> | **SELinux kontekst koji treba primeniti na kontejner**. Ako nije navedeno, runtime kontejnera 캖e dodeliti nasumi캜an SELinux kontekst za svaki kontejner.                                                                                                                                                                  |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>seccompProfile</strong></a><br><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#seccompprofile-v1-core"><em>SeccompProfile</em></a></p>                                                               | **Seccomp opcije** koje treba koristiti za ovaj kontejner.                                                                                                                                                                                                                                                                         |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>windowsOptions</strong></a><br><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#windowssecuritycontextoptions-v1-core"><em>WindowsSecurityContextOptions</em></a></p>                                 | **Windows specifi캜na pode코avanja** primenjena na sve kontejnere.                                                                                                                                                                                                                                                              |

## Reference

* [https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core](https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core)
* [https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core](https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core)

{% hint style="success" %}
Nau캜ite i ve쬭ajte hakovanje AWS:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Obuka AWS Red Tim Ekspert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Nau캜ite i ve쬭ajte hakovanje GCP: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Obuka GCP Red Tim Ekspert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Podr쬴te HackTricks</summary>

* Proverite [**planove pretplate**](https://github.com/sponsors/carlospolop)!
* **Pridru쬴te se** 游눫 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili **telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitteru** 游냕 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podelite hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
{% endhint %}
