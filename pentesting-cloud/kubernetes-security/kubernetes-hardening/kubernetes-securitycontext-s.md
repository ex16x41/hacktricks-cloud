# Kubernetes SecurityContext(s)

{% hint style="success" %}
Ucz siƒô i ƒáwicz Hacking AWS:<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Ucz siƒô i ƒáwicz Hacking GCP: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Wsparcie dla HackTricks</summary>

* Sprawd≈∫ [**plany subskrypcyjne**](https://github.com/sponsors/carlospolop)!
* **Do≈ÇƒÖcz do** üí¨ [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegram**](https://t.me/peass) lub **≈õled≈∫** nas na **Twitterze** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podziel siƒô sztuczkami hackingowymi, przesy≈ÇajƒÖc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repozytori√≥w github.

</details>
{% endhint %}

## PodSecurityContext <a href="#podsecuritycontext-v1-core" id="podsecuritycontext-v1-core"></a>

[**Z dokumentacji:**](https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core)

Podczas okre≈õlania kontekstu bezpiecze≈Ñstwa Podu mo≈ºesz u≈ºyƒá kilku atrybut√≥w. Z punktu widzenia defensywnego bezpiecze≈Ñstwa powiniene≈õ rozwa≈ºyƒá:

* Ustawienie **runASNonRoot** na **True**
* Skonfigurowanie **runAsUser**
* Je≈õli to mo≈ºliwe, rozwa≈º **ograniczenie** **uprawnie≈Ñ** wskazujƒÖc **seLinuxOptions** i **seccompProfile**
* **NIE** przyznawaj dostƒôpu do **grupy** **privilege** za pomocƒÖ **runAsGroup** i **supplementaryGroups**

| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>fsGroup</strong></a><br><em>integer</em></p>                                                                                                                                                                                                                                                 | <p>Specjalna grupa uzupe≈ÇniajƒÖca, kt√≥ra ma zastosowanie do <strong>wszystkich kontener√≥w w podzie</strong>. Niekt√≥re typy wolumen√≥w pozwalajƒÖ Kubeletowi na <strong>zmianƒô w≈Ça≈õciciela tego wolumenu</strong> na w≈Ça≈õciciela podu:<br>1. W≈Ça≈õciciel GID bƒôdzie FSGroup<br>2. Bit setgid jest ustawiony (nowe pliki utworzone w wolumenie bƒôdƒÖ nale≈ºa≈Çy do FSGroup)<br>3. Bity uprawnie≈Ñ sƒÖ OR'd z rw-rw---- Je≈õli nie ustawione, Kubelet nie zmieni w≈Ça≈õciciela i uprawnie≈Ñ ≈ºadnego wolumenu</p> |
| ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>fsGroupChangePolicy</strong></a><br><em>string</em></p>                                                                                                                                                                                                                                      | To definiuje zachowanie **zmiany w≈Ça≈õciciela i uprawnie≈Ñ wolumenu** przed jego udostƒôpnieniem wewnƒÖtrz Podu.                                                                                                                                                                                                                                                                                                                                                                         |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>runAsGroup</strong></a><br><em>integer</em></p>                                                                                                                                                                                                                                              | **GID do uruchomienia punktu wej≈õcia procesu kontenera**. U≈ºywa domy≈õlnej warto≈õci czasu wykonywania, je≈õli nie ustawione.                                                                                                                                                                                                                                                                                                                                                        |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>runAsNonRoot</strong></a><br><em>boolean</em></p>                                                                                                                                                                                                                                            | Wskazuje, ≈ºe kontener musi dzia≈Çaƒá jako u≈ºytkownik nie-root. Je≈õli prawda, Kubelet zweryfikuje obraz w czasie wykonywania, aby upewniƒá siƒô, ≈ºe nie dzia≈Ça jako UID 0 (root) i nie uruchomi kontenera, je≈õli tak jest.                                                                                                                                                                                                                                                                          |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>runAsUser</strong></a><br><em>integer</em></p>                                                                                                                                                                                                                                               | **UID do uruchomienia punktu wej≈õcia procesu kontenera**. Domy≈õlnie u≈ºytkownik okre≈õlony w metadanych obrazu, je≈õli nieokre≈õlony.                                                                                                                                                                                                                                                                                                                                                              |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>seLinuxOptions</strong></a><br><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#selinuxoptions-v1-core"><em>SELinuxOptions</em></a><br><em>Wiƒôcej informacji o</em> <em><strong>seLinux</strong></em></p>                                                           | **Kontekst SELinux, kt√≥ry ma byƒá zastosowany do wszystkich kontener√≥w**. Je≈õli nieokre≈õlony, czas wykonywania kontenera przydzieli losowy kontekst SELinux dla ka≈ºdego kontenera.                                                                                                                                                                                                                                                                                                                             |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>seccompProfile</strong></a><br><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#seccompprofile-v1-core"><em>SeccompProfile</em></a><br><em>Wiƒôcej informacji o</em> <em><strong>Seccomp</strong></em></p>                                                           | **Opcje seccomp, kt√≥re majƒÖ byƒá u≈ºywane przez kontenery** w tym podzie.                                                                                                                                                                                                                                                                                                                                                                                                                         |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>supplementalGroups</strong></a><br><em>integer array</em></p>                                                                                                                                                                                                                                | Lista **grup stosowanych do pierwszego procesu uruchomionego w ka≈ºdym kontenerze**, opr√≥cz g≈Ç√≥wnego GID kontenera.                                                                                                                                                                                                                                                                                                                                                                  |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>sysctls</strong></a><br><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#sysctl-v1-core"><em>Sysctl</em></a> <em>array</em><br><em>Wiƒôcej informacji o</em> <a href="https://www.garron.me/en/go2linux/sysctl-linux.html"><em><strong>sysctls</strong></em></a></p> | Sysctls zawierajƒÖ listƒô **namespaced sysctls u≈ºywanych dla podu**. Pody z nieobs≈Çugiwanymi sysctls (przez czas wykonywania kontenera) mogƒÖ nie uruchomiƒá siƒô.                                                                                                                                                                                                                                                                                                                                        |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>windowsOptions</strong></a><br><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#windowssecuritycontextoptions-v1-core"><em>WindowsSecurityContextOptions</em></a></p>                                                                                           | Ustawienia specyficzne dla systemu Windows stosowane do wszystkich kontener√≥w. Je≈õli nieokre≈õlone, u≈ºyte zostanƒÖ opcje w SecurityContext kontenera.                                                                                                                                                                                                                                                                                                                                               |

## SecurityContext

[**Z dokumentacji:**](https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core)

Ten kontekst jest ustawiony wewnƒÖtrz **definicji kontener√≥w**. Z punktu widzenia defensywnego bezpiecze≈Ñstwa powiniene≈õ rozwa≈ºyƒá:

* **allowPrivilegeEscalation** na **False**
* Nie dodawaj wra≈ºliwych **capabilities** (i usu≈Ñ te, kt√≥rych nie potrzebujesz)
* **privileged** na **False**
* Je≈õli to mo≈ºliwe, ustaw **readOnlyFilesystem** na **True**
* Ustaw **runAsNonRoot** na **True** i ustaw **runAsUser**
* Je≈õli to mo≈ºliwe, rozwa≈º **ograniczenie** **uprawnie≈Ñ** wskazujƒÖc **seLinuxOptions** i **seccompProfile**
* **NIE** przyznawaj dostƒôpu do **grupy** **privilege** za pomocƒÖ **runAsGroup.**

Zauwa≈º, ≈ºe atrybuty ustawione w **zar√≥wno SecurityContext, jak i PodSecurityContext**, warto≈õƒá okre≈õlona w **SecurityContext** ma **pierwsze≈Ñstwo**.

| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>allowPrivilegeEscalation</strong></a><br><em>boolean</em></p>                                                                                                                                                                      | **AllowPrivilegeEscalation** kontroluje, czy proces mo≈ºe **uzyskaƒá wiƒôcej uprawnie≈Ñ** ni≈º jego proces nadrzƒôdny. Ta warto≈õƒá boolowska bezpo≈õrednio kontroluje, czy flaga no\_new\_privs zostanie ustawiona na proces kontenera. AllowPrivilegeEscalation jest zawsze prawdziwe, gdy kontener jest uruchamiany jako **Privileged** lub ma **CAP\_SYS\_ADMIN** |
| ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>capabilities</strong></a><br><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#capabilities-v1-core"><em>Capabilities</em></a><br><em>Wiƒôcej informacji o</em> <em><strong>Capabilities</strong></em></p>  | **Capabilities do dodania/usuniƒôcia podczas uruchamiania kontener√≥w**. Domy≈õlnie u≈ºywa domy≈õlnego zestawu capabilities.                                                                                                                                                                                                                    |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>privileged</strong></a><br><em>boolean</em></p>                                                                                                                                                                                    | Uruchom kontener w trybie uprzywilejowanym. Procesy w uprzywilejowanych kontenerach sƒÖ zasadniczo **r√≥wnowa≈ºne z rootem na ho≈õcie**. Domy≈õlnie fa≈Çsz.                                                                                                                                                                               |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>procMount</strong></a><br><em>string</em></p>                                                                                                                                                                                      | procMount oznacza **typ monta≈ºu proc, kt√≥ry ma byƒá u≈ºywany dla kontener√≥w**. Domy≈õlnie jest to DefaultProcMount, kt√≥ry u≈ºywa domy≈õlnych ustawie≈Ñ czasu wykonywania dla ≈õcie≈ºek tylko do odczytu i zamaskowanych ≈õcie≈ºek.                                                                                                                                    |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>readOnlyRootFilesystem</strong></a><br><em>boolean</em></p>                                                                                                                                                                        | Czy ten **kontener ma system plik√≥w root tylko do odczytu**. Domy≈õlnie fa≈Çsz.                                                                                                                                                                                                                                             |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>runAsGroup</strong></a><br><em>integer</em></p>                                                                                                                                                                                    | **GID do uruchomienia punktu wej≈õcia** procesu kontenera. U≈ºywa domy≈õlnej warto≈õci czasu wykonywania, je≈õli nie ustawione.                                                                                                                                                                                                                                |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>runAsNonRoot</strong></a><br><em>boolean</em></p>                                                                                                                                                                                  | Wskazuje, ≈ºe kontener musi **dzia≈Çaƒá jako u≈ºytkownik nie-root**. Je≈õli prawda, Kubelet zweryfikuje obraz w czasie wykonywania, aby upewniƒá siƒô, ≈ºe nie dzia≈Ça jako UID 0 (root) i nie uruchomi kontenera, je≈õli tak jest.                                                                                                          |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>runAsUser</strong></a><br><em>integer</em></p>                                                                                                                                                                                     | **UID do uruchomienia punktu wej≈õcia** procesu kontenera. Domy≈õlnie u≈ºytkownik okre≈õlony w metadanych obrazu, je≈õli nieokre≈õlony.                                                                                                                                                                                                  |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>seLinuxOptions</strong></a><br><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#selinuxoptions-v1-core"><em>SELinuxOptions</em></a><br><em>Wiƒôcej informacji o</em> <em><strong>seLinux</strong></em></p> | **Kontekst SELinux, kt√≥ry ma byƒá zastosowany do kontenera**. Je≈õli nieokre≈õlony, czas wykonywania kontenera przydzieli losowy kontekst SELinux dla ka≈ºdego kontenera.                                                                                                                                                                  |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>seccompProfile</strong></a><br><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#seccompprofile-v1-core"><em>SeccompProfile</em></a></p>                                                               | **Opcje seccomp** do u≈ºycia przez ten kontener.                                                                                                                                                                                                                                                                         |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>windowsOptions</strong></a><br><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#windowssecuritycontextoptions-v1-core"><em>WindowsSecurityContextOptions</em></a></p>                                 | **Ustawienia specyficzne dla systemu Windows** stosowane do wszystkich kontener√≥w.                                                                                                                                                                                                                                                              |

## References

* [https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core](https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core)
* [https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core](https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core)

{% hint style="success" %}
Ucz siƒô i ƒáwicz Hacking AWS:<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Ucz siƒô i ƒáwicz Hacking GCP: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Wsparcie dla HackTricks</summary>

* Sprawd≈∫ [**plany subskrypcyjne**](https://github.com/sponsors/carlospolop)!
* **Do≈ÇƒÖcz do** üí¨ [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegram**](https://t.me/peass) lub **≈õled≈∫** nas na **Twitterze** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podziel siƒô sztuczkami hackingowymi, przesy≈ÇajƒÖc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repozytori√≥w github.

</details>
{% endhint %}
