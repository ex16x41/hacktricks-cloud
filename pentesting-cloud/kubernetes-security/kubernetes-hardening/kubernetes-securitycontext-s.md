# Kubernetes SecurityContext(s)

{% hint style="success" %}
Apprenez et pratiquez le hacking AWS :<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
Apprenez et pratiquez le hacking GCP : <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Consultez les [**plans d'abonnement**](https://github.com/sponsors/carlospolop) !
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez** nous sur **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Partagez des astuces de hacking en soumettant des PRs aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) d√©p√¥ts github.

</details>
{% endhint %}

## PodSecurityContext <a href="#podsecuritycontext-v1-core" id="podsecuritycontext-v1-core"></a>

[**D'apr√®s la documentation :**](https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core)

Lors de la sp√©cification du contexte de s√©curit√© d'un Pod, vous pouvez utiliser plusieurs attributs. D'un point de vue de s√©curit√© d√©fensive, vous devriez consid√©rer :

* Avoir **runASNonRoot** comme **Vrai**
* Configurer **runAsUser**
* Si possible, envisager de **limiter** les **permissions** en indiquant **seLinuxOptions** et **seccompProfile**
* Ne **PAS** donner d'acc√®s au **groupe** de **privil√®ges** via **runAsGroup** et **supplementaryGroups**

| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>fsGroup</strong></a><br><em>integer</em></p>                                                                                                                                                                                                                                                 | <p>Un groupe suppl√©mentaire sp√©cial qui s'applique √† <strong>tous les conteneurs d'un pod</strong>. Certains types de volumes permettent au Kubelet de <strong>changer la propri√©t√© de ce volume</strong> pour qu'il soit poss√©d√© par le pod :<br>1. Le GID propri√©taire sera le FSGroup<br>2. Le bit setgid est d√©fini (les nouveaux fichiers cr√©√©s dans le volume seront poss√©d√©s par FSGroup)<br>3. Les bits de permission sont OR'd avec rw-rw---- Si non d√©fini, le Kubelet ne modifiera pas la propri√©t√© et les permissions de tout volume</p> |
| ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>fsGroupChangePolicy</strong></a><br><em>string</em></p>                                                                                                                                                                                                                                      | Cela d√©finit le comportement de **changement de propri√©t√© et de permission du volume** avant d'√™tre expos√© √† l'int√©rieur du Pod.                                                                                                                                                                                                                                                                                                                                                                         |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>runAsGroup</strong></a><br><em>integer</em></p>                                                                                                                                                                                                                                              | Le **GID pour ex√©cuter le point d'entr√©e du processus du conteneur**. Utilise la valeur par d√©faut d'ex√©cution si non d√©fini.                                                                                                                                                                                                                                                                                                                                                        |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>runAsNonRoot</strong></a><br><em>boolean</em></p>                                                                                                                                                                                                                                            | Indique que le conteneur doit s'ex√©cuter en tant qu'utilisateur non-root. Si vrai, le Kubelet validera l'image √† l'ex√©cution pour s'assurer qu'elle ne s'ex√©cute pas en tant que UID 0 (root) et √©chouera √† d√©marrer le conteneur si c'est le cas.                                                                                                                                                                                                                                                                          |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>runAsUser</strong></a><br><em>integer</em></p>                                                                                                                                                                                                                                               | Le **UID pour ex√©cuter le point d'entr√©e du processus du conteneur**. Par d√©faut, il s'agit de l'utilisateur sp√©cifi√© dans les m√©tadonn√©es de l'image si non sp√©cifi√©.                                                                                                                                                                                                                                                                                                                                                              |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>seLinuxOptions</strong></a><br><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#selinuxoptions-v1-core"><em>SELinuxOptions</em></a><br><em>Plus d'infos sur</em> <em><strong>seLinux</strong></em></p>                                                           | Le **contexte SELinux √† appliquer √† tous les conteneurs**. Si non sp√©cifi√©, le runtime du conteneur allouera un contexte SELinux al√©atoire pour chaque conteneur.                                                                                                                                                                                                                                                                                                                             |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>seccompProfile</strong></a><br><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#seccompprofile-v1-core"><em>SeccompProfile</em></a><br><em>Plus d'infos sur</em> <em><strong>Seccomp</strong></em></p>                                                           | Les **options seccomp √† utiliser par les conteneurs** dans ce pod.                                                                                                                                                                                                                                                                                                                                                                                                                         |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>supplementalGroups</strong></a><br><em>integer array</em></p>                                                                                                                                                                                                                                | Une liste de **groupes appliqu√©s au premier processus ex√©cut√© dans chaque conteneur**, en plus du GID principal du conteneur.                                                                                                                                                                                                                                                                                                                                                                  |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>sysctls</strong></a><br><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#sysctl-v1-core"><em>Sysctl</em></a> <em>array</em><br><em>Plus d'infos sur</em> <a href="https://www.garron.me/en/go2linux/sysctl-linux.html"><em><strong>sysctls</strong></em></a></p> | Les sysctls contiennent une liste de **sysctls namespace utilis√©s pour le pod**. Les pods avec des sysctls non pris en charge (par le runtime du conteneur) pourraient √©chouer √† se lancer.                                                                                                                                                                                                                                                                                                                                        |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>windowsOptions</strong></a><br><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#windowssecuritycontextoptions-v1-core"><em>WindowsSecurityContextOptions</em></a></p>                                                                                           | Les param√®tres sp√©cifiques √† Windows appliqu√©s √† tous les conteneurs. Si non sp√©cifi√©, les options dans le SecurityContext d'un conteneur seront utilis√©es.                                                                                                                                                                                                                                                                                                                                               |

## SecurityContext

[**D'apr√®s la documentation :**](https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core)

Ce contexte est d√©fini √† l'int√©rieur des **d√©finitions de conteneurs**. D'un point de vue de s√©curit√© d√©fensive, vous devriez consid√©rer :

* **allowPrivilegeEscalation** √† **Faux**
* Ne pas ajouter de **capabilit√©s** sensibles (et supprimer celles dont vous n'avez pas besoin)
* **privileged** √† **Faux**
* Si possible, d√©finir **readOnlyFilesystem** comme **Vrai**
* D√©finir **runAsNonRoot** √† **Vrai** et d√©finir un **runAsUser**
* Si possible, envisager de **limiter** les **permissions** en indiquant **seLinuxOptions** et **seccompProfile**
* Ne **PAS** donner d'acc√®s au **groupe** de **privil√®ges** via **runAsGroup.**

Notez que les attributs d√©finis dans **SecurityContext et PodSecurityContext**, la valeur sp√©cifi√©e dans **SecurityContext** prend **pr√©c√©dence**.

| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>allowPrivilegeEscalation</strong></a><br><em>boolean</em></p>                                                                                                                                                                      | **AllowPrivilegeEscalation** contr√¥le si un processus peut **gagner plus de privil√®ges** que son processus parent. Ce bool√©en contr√¥le directement si le drapeau no\_new\_privs sera d√©fini sur le processus du conteneur. AllowPrivilegeEscalation est toujours vrai lorsque le conteneur est ex√©cut√© en tant que **Privileged** ou a **CAP\_SYS\_ADMIN** |
| ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>capabilities</strong></a><br><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#capabilities-v1-core"><em>Capabilities</em></a><br><em>Plus d'infos sur</em> <em><strong>Capabilities</strong></em></p>  | Les **capabilit√©s √† ajouter/retirer lors de l'ex√©cution des conteneurs**. Par d√©faut, il s'agit de l'ensemble par d√©faut de capacit√©s.                                                                                                                                                                                                                    |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>privileged</strong></a><br><em>boolean</em></p>                                                                                                                                                                                    | Ex√©cuter le conteneur en mode privil√©gi√©. Les processus dans des conteneurs privil√©gi√©s sont essentiellement **√©quivalents √† root sur l'h√¥te**. Par d√©faut, c'est faux.                                                                                                                                                                               |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>procMount</strong></a><br><em>string</em></p>                                                                                                                                                                                      | procMount d√©signe le **type de montage proc √† utiliser pour les conteneurs**. La valeur par d√©faut est DefaultProcMount qui utilise les valeurs par d√©faut du runtime du conteneur pour les chemins en lecture seule et les chemins masqu√©s.                                                                                                                                    |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>readOnlyRootFilesystem</strong></a><br><em>boolean</em></p>                                                                                                                                                                        | Indique si ce **conteneur a un syst√®me de fichiers racine en lecture seule**. La valeur par d√©faut est fausse.                                                                                                                                                                                                                                             |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>runAsGroup</strong></a><br><em>integer</em></p>                                                                                                                                                                                    | Le **GID pour ex√©cuter le point d'entr√©e** du processus du conteneur. Utilise la valeur par d√©faut d'ex√©cution si non d√©fini.                                                                                                                                                                                                                                |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>runAsNonRoot</strong></a><br><em>boolean</em></p>                                                                                                                                                                                  | Indique que le conteneur doit **s'ex√©cuter en tant qu'utilisateur non-root**. Si vrai, le Kubelet validera l'image √† l'ex√©cution pour s'assurer qu'elle ne s'ex√©cute pas en tant que UID 0 (root) et √©chouera √† d√©marrer le conteneur si c'est le cas.                                                                                                          |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>runAsUser</strong></a><br><em>integer</em></p>                                                                                                                                                                                     | Le **UID pour ex√©cuter le point d'entr√©e** du processus du conteneur. Par d√©faut, il s'agit de l'utilisateur sp√©cifi√© dans les m√©tadonn√©es de l'image si non sp√©cifi√©.                                                                                                                                                                                                  |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>seLinuxOptions</strong></a><br><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#selinuxoptions-v1-core"><em>SELinuxOptions</em></a><br><em>Plus d'infos sur</em> <em><strong>seLinux</strong></em></p> | Le **contexte SELinux √† appliquer au conteneur**. Si non sp√©cifi√©, le runtime du conteneur allouera un contexte SELinux al√©atoire pour chaque conteneur.                                                                                                                                                                  |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>seccompProfile</strong></a><br><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#seccompprofile-v1-core"><em>SeccompProfile</em></a></p>                                                               | Les **options seccomp** √† utiliser par ce conteneur.                                                                                                                                                                                                                                                                         |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>windowsOptions</strong></a><br><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#windowssecuritycontextoptions-v1-core"><em>WindowsSecurityContextOptions</em></a></p>                                 | Les **param√®tres sp√©cifiques √† Windows** appliqu√©s √† tous les conteneurs.                                                                                                                                                                                                                                                              |

## References

* [https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core](https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core)
* [https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core](https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core)

{% hint style="success" %}
Apprenez et pratiquez le hacking AWS :<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
Apprenez et pratiquez le hacking GCP : <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Consultez les [**plans d'abonnement**](https://github.com/sponsors/carlospolop) !
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez** nous sur **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Partagez des astuces de hacking en soumettant des PRs aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) d√©p√¥ts github.

</details>
{% endhint %}
