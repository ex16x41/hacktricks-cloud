# Kubernetes SecurityContext(s)

{% hint style="success" %}
Ucz si i wicz Hacking AWS:<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
Ucz si i wicz Hacking GCP: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Wsparcie dla HackTricks</summary>

* Sprawd藕 [**plany subskrypcyjne**](https://github.com/sponsors/carlospolop)!
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegram**](https://t.me/peass) lub **led藕** nas na **Twitterze**  [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Podziel si sztuczkami hackingowymi, przesyajc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repozytori贸w github.

</details>
{% endhint %}

## PodSecurityContext <a href="#podsecuritycontext-v1-core" id="podsecuritycontext-v1-core"></a>

[**Z dokumentacji:**](https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core)

Podczas okrelania kontekstu bezpieczestwa Podu mo偶esz u偶y kilku atrybut贸w. Z punktu widzenia defensywnego bezpieczestwa powiniene rozwa偶y:

* Ustawienie **runASNonRoot** na **True**
* Skonfigurowanie **runAsUser**
* Jeli to mo偶liwe, rozwa偶 **ograniczenie** **uprawnie**, wskazujc **seLinuxOptions** i **seccompProfile**
* **NIE** przyznawaj dostpu do **grupy** z **privilege** za pomoc **runAsGroup** i **supplementaryGroups**

| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>fsGroup</strong></a><br><em>integer</em></p>                                                                                                                                                                                                                                                 | <p>Specjalna grupa uzupeniajca, kt贸ra ma zastosowanie do <strong>wszystkich kontener贸w w podzie</strong>. Niekt贸re typy wolumen贸w pozwalaj Kubeletowi na <strong>zmian waciciela tego wolumenu</strong> na waciciela podu:<br>1. Waciciel GID bdzie FSGroup<br>2. Bit setgid jest ustawiony (nowe pliki utworzone w wolumenie bd nale偶ay do FSGroup)<br>3. Bity uprawnie s OR'd z rw-rw---- Jeli nie jest ustawione, Kubelet nie zmieni waciciela i uprawnie 偶adnego wolumenu</p> |
| ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>fsGroupChangePolicy</strong></a><br><em>string</em></p>                                                                                                                                                                                                                                      | To definiuje zachowanie **zmiany waciciela i uprawnie wolumenu** przed jego udostpnieniem wewntrz Podu.                                                                                                                                                                                                                                                                                                                                                                         |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>runAsGroup</strong></a><br><em>integer</em></p>                                                                                                                                                                                                                                              | **GID do uruchomienia punktu wejcia procesu kontenera**. U偶ywa domylnej wartoci czasu wykonywania, jeli nie jest ustawione.                                                                                                                                                                                                                                                                                                                                                        |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>runAsNonRoot</strong></a><br><em>boolean</em></p>                                                                                                                                                                                                                                            | Wskazuje, 偶e kontener musi dziaa jako u偶ytkownik nie-root. Jeli prawda, Kubelet zweryfikuje obraz w czasie wykonywania, aby upewni si, 偶e nie dziaa jako UID 0 (root) i nie uruchomi kontenera, jeli tak jest.                                                                                                                                                                                                                                                                          |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>runAsUser</strong></a><br><em>integer</em></p>                                                                                                                                                                                                                                               | **UID do uruchomienia punktu wejcia procesu kontenera**. Domylnie u偶ytkownik okrelony w metadanych obrazu, jeli nie jest okrelony.                                                                                                                                                                                                                                                                                                                                                              |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>seLinuxOptions</strong></a><br><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#selinuxoptions-v1-core"><em>SELinuxOptions</em></a><br><em>Wicej informacji o</em> <em><strong>seLinux</strong></em></p>                                                           | **Kontekst SELinux, kt贸ry ma by zastosowany do wszystkich kontener贸w**. Jeli nie jest okrelony, czas wykonywania kontenera przydzieli losowy kontekst SELinux dla ka偶dego kontenera.                                                                                                                                                                                                                                                                                                                             |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>seccompProfile</strong></a><br><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#seccompprofile-v1-core"><em>SeccompProfile</em></a><br><em>Wicej informacji o</em> <em><strong>Seccomp</strong></em></p>                                                           | **Opcje seccomp, kt贸re maj by u偶ywane przez kontenery** w tym podzie.                                                                                                                                                                                                                                                                                                                                                                                                                         |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>supplementalGroups</strong></a><br><em>integer array</em></p>                                                                                                                                                                                                                                | Lista **grup stosowanych do pierwszego procesu uruchomionego w ka偶dym kontenerze**, opr贸cz g贸wnego GID kontenera.                                                                                                                                                                                                                                                                                                                                                                  |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>sysctls</strong></a><br><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#sysctl-v1-core"><em>Sysctl</em></a> <em>array</em><br><em>Wicej informacji o</em> <a href="https://www.garron.me/en/go2linux/sysctl-linux.html"><em><strong>sysctls</strong></em></a></p> | Sysctls zawieraj list **namespaced sysctls u偶ywanych dla podu**. Pody z nieobsugiwanymi sysctls (przez czas wykonywania kontenera) mog nie uruchomi si.                                                                                                                                                                                                                                                                                                                                        |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core"><strong>windowsOptions</strong></a><br><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#windowssecuritycontextoptions-v1-core"><em>WindowsSecurityContextOptions</em></a></p>                                                                                           | Ustawienia specyficzne dla systemu Windows stosowane do wszystkich kontener贸w. Jeli nie jest okrelone, u偶yte zostan opcje w SecurityContext kontenera.                                                                                                                                                                                                                                                                                                                                               |

## SecurityContext

[**Z dokumentacji:**](https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core)

Ten kontekst jest ustawiony wewntrz **definicji kontener贸w**. Z punktu widzenia defensywnego bezpieczestwa powiniene rozwa偶y:

* **allowPrivilegeEscalation** na **False**
* Nie dodawaj wra偶liwych **capabilities** (i usu te, kt贸rych nie potrzebujesz)
* **privileged** na **False**
* Jeli to mo偶liwe, ustaw **readOnlyFilesystem** na **True**
* Ustaw **runAsNonRoot** na **True** i ustaw **runAsUser**
* Jeli to mo偶liwe, rozwa偶 **ograniczenie** **uprawnie**, wskazujc **seLinuxOptions** i **seccompProfile**
* **NIE** przyznawaj dostpu do **grupy** z **privilege** za pomoc **runAsGroup.**

Zauwa偶, 偶e atrybuty ustawione w **zar贸wno SecurityContext, jak i PodSecurityContext**, warto okrelona w **SecurityContext** ma **pierwszestwo**.

| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>allowPrivilegeEscalation</strong></a><br><em>boolean</em></p>                                                                                                                                                                      | **AllowPrivilegeEscalation** kontroluje, czy proces mo偶e **uzyska wicej uprawnie** ni偶 jego proces nadrzdny. Ta warto boolowska bezporednio kontroluje, czy flaga no\_new\_privs zostanie ustawiona na proces kontenera. AllowPrivilegeEscalation jest zawsze prawdziwe, gdy kontener jest uruchamiany jako **Privileged** lub ma **CAP\_SYS\_ADMIN** |
| ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>capabilities</strong></a><br><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#capabilities-v1-core"><em>Capabilities</em></a><br><em>Wicej informacji o</em> <em><strong>Capabilities</strong></em></p>  | **Capabilities do dodania/usunicia podczas uruchamiania kontener贸w**. Domylnie u偶ywa domylnego zestawu uprawnie.                                                                                                                                                                                                                    |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>privileged</strong></a><br><em>boolean</em></p>                                                                                                                                                                                    | Uruchom kontener w trybie uprzywilejowanym. Procesy w uprzywilejowanych kontenerach s zasadniczo **r贸wnowa偶ne z rootem na hocie**. Domylnie jest to fasz.                                                                                                                                                                               |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>procMount</strong></a><br><em>string</em></p>                                                                                                                                                                                      | procMount oznacza **typ montowania proc, kt贸ry ma by u偶ywany dla kontener贸w**. Domylnie jest to DefaultProcMount, kt贸ry u偶ywa domylnych ustawie czasu wykonywania dla cie偶ek tylko do odczytu i zamaskowanych cie偶ek.                                                                                                                                    |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>readOnlyRootFilesystem</strong></a><br><em>boolean</em></p>                                                                                                                                                                        | Czy ten **kontener ma system plik贸w root tylko do odczytu**. Domylnie jest to fasz.                                                                                                                                                                                                                                             |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>runAsGroup</strong></a><br><em>integer</em></p>                                                                                                                                                                                    | **GID do uruchomienia punktu wejcia** procesu kontenera. U偶ywa domylnej wartoci czasu wykonywania, jeli nie jest ustawione.                                                                                                                                                                                                                                |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>runAsNonRoot</strong></a><br><em>boolean</em></p>                                                                                                                                                                                  | Wskazuje, 偶e kontener musi **dziaa jako u偶ytkownik nie-root**. Jeli prawda, Kubelet zweryfikuje obraz w czasie wykonywania, aby upewni si, 偶e nie dziaa jako UID 0 (root) i nie uruchomi kontenera, jeli tak jest.                                                                                                          |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>runAsUser</strong></a><br><em>integer</em></p>                                                                                                                                                                                     | **UID do uruchomienia punktu wejcia** procesu kontenera. Domylnie u偶ytkownik okrelony w metadanych obrazu, jeli nie jest okrelony.                                                                                                                                                                                                  |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>seLinuxOptions</strong></a><br><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#selinuxoptions-v1-core"><em>SELinuxOptions</em></a><br><em>Wicej informacji o</em> <em><strong>seLinux</strong></em></p> | **Kontekst SELinux, kt贸ry ma by zastosowany do kontenera**. Jeli nie jest okrelony, czas wykonywania kontenera przydzieli losowy kontekst SELinux dla ka偶dego kontenera.                                                                                                                                                                  |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>seccompProfile</strong></a><br><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#seccompprofile-v1-core"><em>SeccompProfile</em></a></p>                                                               | **Opcje seccomp** do u偶ycia przez ten kontener.                                                                                                                                                                                                                                                                         |
| <p><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core"><strong>windowsOptions</strong></a><br><a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#windowssecuritycontextoptions-v1-core"><em>WindowsSecurityContextOptions</em></a></p>                                 | **Ustawienia specyficzne dla systemu Windows** stosowane do wszystkich kontener贸w.                                                                                                                                                                                                                                                              |

## References

* [https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core](https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#podsecuritycontext-v1-core)
* [https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core](https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#securitycontext-v1-core)

{% hint style="success" %}
Ucz si i wicz Hacking AWS:<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
Ucz si i wicz Hacking GCP: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Wsparcie dla HackTricks</summary>

* Sprawd藕 [**plany subskrypcyjne**](https://github.com/sponsors/carlospolop)!
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegram**](https://t.me/peass) lub **led藕** nas na **Twitterze**  [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Podziel si sztuczkami hackingowymi, przesyajc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repozytori贸w github.

</details>
{% endhint %}
