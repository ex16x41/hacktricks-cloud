# Kubernetesì—ì„œ ì„œë¹„ìŠ¤ ë…¸ì¶œí•˜ê¸°

{% hint style="success" %}
AWS í•´í‚¹ ë°°ìš°ê¸° ë° ì—°ìŠµí•˜ê¸°:<img src="../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
GCP í•´í‚¹ ë°°ìš°ê¸° ë° ì—°ìŠµí•˜ê¸°: <img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks ì§€ì›í•˜ê¸°</summary>

* [**êµ¬ë… ê³„íš**](https://github.com/sponsors/carlospolop) í™•ì¸í•˜ê¸°!
* **ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— ì°¸ì—¬í•˜ê±°ë‚˜ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**ë¥¼ íŒ”ë¡œìš°í•˜ì„¸ìš”.**
* **[**HackTricks**](https://github.com/carlospolop/hacktricks) ë° [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) ê¹ƒí—ˆë¸Œ ë¦¬í¬ì§€í† ë¦¬ì— PRì„ ì œì¶œí•˜ì—¬ í•´í‚¹ íŠ¸ë¦­ì„ ê³µìœ í•˜ì„¸ìš”.**

</details>
{% endhint %}

Kubernetesì—ì„œ **ì„œë¹„ìŠ¤ë¥¼ ë…¸ì¶œí•˜ëŠ” ë‹¤ì–‘í•œ ë°©ë²•**ì´ ìˆì–´ **ë‚´ë¶€** ì—”ë“œí¬ì¸íŠ¸ì™€ **ì™¸ë¶€** ì—”ë“œí¬ì¸íŠ¸ê°€ ì´ë¥¼ ì ‘ê·¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ Kubernetes êµ¬ì„±ì€ ë§¤ìš° ì¤‘ìš”í•˜ë©°, ê´€ë¦¬ìê°€ **ê³µê²©ìê°€ ì ‘ê·¼í•´ì„œëŠ” ì•ˆ ë˜ëŠ” ì„œë¹„ìŠ¤ì— ì ‘ê·¼í•  ìˆ˜ ìˆë„ë¡** í—ˆìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### ìë™ ì—´ê±°

K8sê°€ ì„œë¹„ìŠ¤ë¥¼ ê³µê°œì ìœ¼ë¡œ ë…¸ì¶œí•˜ëŠ” ë°©ë²•ì„ ì—´ê±°í•˜ê¸° ì‹œì‘í•˜ê¸° ì „ì—, ë„¤ì„ìŠ¤í˜ì´ìŠ¤, ì„œë¹„ìŠ¤ ë° ì¸ê·¸ë ˆìŠ¤ë¥¼ ë‚˜ì—´í•  ìˆ˜ ìˆë‹¤ë©´, ê³µê°œì ìœ¼ë¡œ ë…¸ì¶œëœ ëª¨ë“  ê²ƒì„ ì°¾ì„ ìˆ˜ ìˆë‹¤ëŠ” ê²ƒì„ ì•Œì•„ë‘ì„¸ìš”:
```bash
kubectl get namespace -o custom-columns='NAME:.metadata.name' | grep -v NAME | while IFS='' read -r ns; do
echo "Namespace: $ns"
kubectl get service -n "$ns"
kubectl get ingress -n "$ns"
echo "=============================================="
echo ""
echo ""
done | grep -v "ClusterIP"
# Remove the last '| grep -v "ClusterIP"' to see also type ClusterIP
```
### ClusterIP

A **ClusterIP** ì„œë¹„ìŠ¤ëŠ” **ê¸°ë³¸** Kubernetes **ì„œë¹„ìŠ¤**ì…ë‹ˆë‹¤. í´ëŸ¬ìŠ¤í„° ë‚´ì˜ ë‹¤ë¥¸ ì•±ì´ ì ‘ê·¼í•  ìˆ˜ ìˆëŠ” **í´ëŸ¬ìŠ¤í„° ë‚´ë¶€ì˜ ì„œë¹„ìŠ¤**ë¥¼ ì œê³µí•©ë‹ˆë‹¤. **ì™¸ë¶€ ì ‘ê·¼**ì€ ì—†ìŠµë‹ˆë‹¤.

ê·¸ëŸ¬ë‚˜, Kubernetes Proxyë¥¼ ì‚¬ìš©í•˜ì—¬ ì ‘ê·¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```bash
kubectl proxy --port=8080
```
ì´ì œ ì´ ìŠ¤í‚´ì„ ì‚¬ìš©í•˜ì—¬ Kubernetes APIë¥¼ í†µí•´ ì„œë¹„ìŠ¤ì— ì ‘ê·¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

`http://localhost:8080/api/v1/proxy/namespaces/<NAMESPACE>/services/<SERVICE-NAME>:<PORT-NAME>/`

ì˜ˆë¥¼ ë“¤ì–´ ë‹¤ìŒ URLì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

`http://localhost:8080/api/v1/proxy/namespaces/default/services/my-internal-service:http/`

ì´ ì„œë¹„ìŠ¤ë¥¼ ì ‘ê·¼í•˜ê¸° ìœ„í•´:
```yaml
apiVersion: v1
kind: Service
metadata:
name: my-internal-service
spec:
selector:
app: my-app
type: ClusterIP
ports:
- name: http
port: 80
targetPort: 80
protocol: TCP
```
_ì´ ë°©ë²•ì€ **ì¸ì¦ëœ ì‚¬ìš©ì**ë¡œ `kubectl`ì„ ì‹¤í–‰í•´ì•¼ í•©ë‹ˆë‹¤._

ëª¨ë“  ClusterIP ëª©ë¡:

{% code overflow="wrap" %}
```bash
kubectl get services --all-namespaces -o=custom-columns='NAMESPACE:.metadata.namespace,NAME:.metadata.name,TYPE:.spec.type,CLUSTER-IP:.spec.clusterIP,PORT(S):.spec.ports[*].port,TARGETPORT(S):.spec.ports[*].targetPort,SELECTOR:.spec.selector' | grep ClusterIP
```
{% endcode %}

### NodePort

**NodePort**ê°€ ì‚¬ìš©ë  ë•Œ, ëª¨ë“  ë…¸ë“œ(ê°€ìƒ ë¨¸ì‹ ì„ ë‚˜íƒ€ëƒ„)ì—ì„œ ì§€ì •ëœ í¬íŠ¸ê°€ ì‚¬ìš© ê°€ëŠ¥í•´ì§‘ë‹ˆë‹¤. ì´ íŠ¹ì • í¬íŠ¸ë¡œ í–¥í•˜ëŠ” **íŠ¸ë˜í”½**ì€ ì²´ê³„ì ìœ¼ë¡œ **ì„œë¹„ìŠ¤ë¡œ ë¼ìš°íŒ…**ë©ë‹ˆë‹¤. ì¼ë°˜ì ìœ¼ë¡œ ì´ ë°©ë²•ì€ ë‹¨ì ìœ¼ë¡œ ì¸í•´ ê¶Œì¥ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.

ëª¨ë“  NodePort ë‚˜ì—´:

{% code overflow="wrap" %}
```bash
kubectl get services --all-namespaces -o=custom-columns='NAMESPACE:.metadata.namespace,NAME:.metadata.name,TYPE:.spec.type,CLUSTER-IP:.spec.clusterIP,PORT(S):.spec.ports[*].port,NODEPORT(S):.spec.ports[*].nodePort,TARGETPORT(S):.spec.ports[*].targetPort,SELECTOR:.spec.selector' | grep NodePort
```
{% endcode %}

NodePort ì‚¬ì–‘ì˜ ì˜ˆ:
```yaml
apiVersion: v1
kind: Service
metadata:
name: my-nodeport-service
spec:
selector:
app: my-app
type: NodePort
ports:
- name: http
port: 80
targetPort: 80
nodePort: 30036
protocol: TCP
```
If you **nodePort**ë¥¼ yamlì— **ì§€ì •í•˜ì§€ ì•Šìœ¼ë©´** (ì—´ë¦´ í¬íŠ¸ì…ë‹ˆë‹¤) **30000â€“32767 ë²”ìœ„ì˜ í¬íŠ¸ê°€ ì‚¬ìš©ë©ë‹ˆë‹¤**.

### LoadBalancer <a href="#id-0d96" id="id-0d96"></a>

í´ë¼ìš°ë“œ ì œê³µì—…ì²´ì˜ ë¡œë“œ ë°¸ëŸ°ì„œë¥¼ ì‚¬ìš©í•˜ì—¬ ì„œë¹„ìŠ¤ë¥¼ ì™¸ë¶€ì— ë…¸ì¶œí•©ë‹ˆë‹¤. GKEì—ì„œëŠ” [ë„¤íŠ¸ì›Œí¬ ë¡œë“œ ë°¸ëŸ°ì„œ](https://cloud.google.com/compute/docs/load-balancing/network/)ë¥¼ ì‹œì‘í•˜ì—¬ ì„œë¹„ìŠ¤ë¡œ ëª¨ë“  íŠ¸ë˜í”½ì„ ì „ë‹¬í•˜ëŠ” ë‹¨ì¼ IP ì£¼ì†Œë¥¼ ì œê³µí•©ë‹ˆë‹¤. AWSì—ì„œëŠ” ë¡œë“œ ë°¸ëŸ°ì„œë¥¼ ì‹œì‘í•©ë‹ˆë‹¤.

ë…¸ì¶œëœ ì„œë¹„ìŠ¤ë‹¹ LoadBalancerì— ëŒ€í•œ ìš”ê¸ˆì„ ì§€ë¶ˆí•´ì•¼ í•˜ë©°, ì´ëŠ” ë¹„ìš©ì´ ë§ì´ ë“¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ëª¨ë“  LoadBalancers ë‚˜ì—´í•˜ê¸°:

{% code overflow="wrap" %}
```bash
kubectl get services --all-namespaces -o=custom-columns='NAMESPACE:.metadata.namespace,NAME:.metadata.name,TYPE:.spec.type,CLUSTER-IP:.spec.clusterIP,EXTERNAL-IP:.status.loadBalancer.ingress[*],PORT(S):.spec.ports[*].port,NODEPORT(S):.spec.ports[*].nodePort,TARGETPORT(S):.spec.ports[*].targetPort,SELECTOR:.spec.selector' | grep LoadBalancer
```
{% endcode %}

### External IPs <a href="#external-ips" id="external-ips"></a>

{% hint style="success" %}
ì™¸ë¶€ IPëŠ” Load Balancer ìœ í˜•ì˜ ì„œë¹„ìŠ¤ì— ì˜í•´ ë…¸ì¶œë˜ë©°, ì¼ë°˜ì ìœ¼ë¡œ ì™¸ë¶€ í´ë¼ìš°ë“œ ì œê³µì—…ì²´ Load Balancerë¥¼ ì‚¬ìš©í•  ë•Œ ì‚¬ìš©ë©ë‹ˆë‹¤.

ì´ë¥¼ ì°¾ìœ¼ë ¤ë©´ `EXTERNAL-IP` í•„ë“œì— ê°’ì´ ìˆëŠ” ë¡œë“œ ë°¸ëŸ°ì„œë¥¼ í™•ì¸í•˜ì‹­ì‹œì˜¤.
{% endhint %}

í´ëŸ¬ìŠ¤í„°ë¡œ ë“¤ì–´ì˜¤ëŠ” íŠ¸ë˜í”½ì€ **ì™¸ë¶€ IP**(ëª©ì ì§€ IP)ë¡œ, ì„œë¹„ìŠ¤ í¬íŠ¸ì—ì„œ **ì„œë¹„ìŠ¤ ì—”ë“œí¬ì¸íŠ¸ ì¤‘ í•˜ë‚˜ë¡œ ë¼ìš°íŒ…**ë©ë‹ˆë‹¤. `externalIPs`ëŠ” Kubernetesì— ì˜í•´ ê´€ë¦¬ë˜ì§€ ì•Šìœ¼ë©° í´ëŸ¬ìŠ¤í„° ê´€ë¦¬ìì˜ ì±…ì„ì…ë‹ˆë‹¤.

ì„œë¹„ìŠ¤ ì‚¬ì–‘ì—ì„œ `externalIPs`ëŠ” `ServiceTypes` ì¤‘ í•˜ë‚˜ì™€ í•¨ê»˜ ì§€ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì•„ë˜ ì˜ˆì œì—ì„œ "`my-service`"ëŠ” "`80.11.12.10:80`"(`externalIP:port`)ì—ì„œ í´ë¼ì´ì–¸íŠ¸ê°€ ì ‘ê·¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
```yaml
apiVersion: v1
kind: Service
metadata:
name: my-service
spec:
selector:
app: MyApp
ports:
- name: http
protocol: TCP
port: 80
targetPort: 9376
externalIPs:
- 80.11.12.10
```
### ExternalName

[**ë¬¸ì„œì—ì„œ:**](https://kubernetes.io/docs/concepts/services-networking/service/#externalname) ExternalName ìœ í˜•ì˜ ì„œë¹„ìŠ¤ëŠ” **ì„œë¹„ìŠ¤ë¥¼ DNS ì´ë¦„ì— ë§¤í•‘**í•˜ë©°, `my-service` ë˜ëŠ” `cassandra`ì™€ ê°™ì€ ì¼ë°˜ ì„ íƒìì— ë§¤í•‘í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ì´ëŸ¬í•œ ì„œë¹„ìŠ¤ëŠ” `spec.externalName` ë§¤ê°œë³€ìˆ˜ë¡œ ì§€ì •í•©ë‹ˆë‹¤.

ì˜ˆë¥¼ ë“¤ì–´, ì´ ì„œë¹„ìŠ¤ ì •ì˜ëŠ” `prod` ë„¤ì„ìŠ¤í˜ì´ìŠ¤ì˜ `my-service` ì„œë¹„ìŠ¤ë¥¼ `my.database.example.com`ì— ë§¤í•‘í•©ë‹ˆë‹¤:
```yaml
apiVersion: v1
kind: Service
metadata:
name: my-service
namespace: prod
spec:
type: ExternalName
externalName: my.database.example.com
```
`my-service.prod.svc.cluster.local` í˜¸ìŠ¤íŠ¸ë¥¼ ì¡°íšŒí•  ë•Œ, í´ëŸ¬ìŠ¤í„° DNS ì„œë¹„ìŠ¤ëŠ” ê°’ì´ `my.database.example.com`ì¸ `CNAME` ë ˆì½”ë“œë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤. `my-service`ì— ì ‘ê·¼í•˜ëŠ” ê²ƒì€ ë‹¤ë¥¸ ì„œë¹„ìŠ¤ì™€ ë™ì¼í•˜ê²Œ ì‘ë™í•˜ì§€ë§Œ, **ë¦¬ë””ë ‰ì…˜ì´ í”„ë¡ì‹œ ë˜ëŠ” í¬ì›Œë”©ì´ ì•„ë‹Œ DNS ìˆ˜ì¤€ì—ì„œ ë°œìƒí•œë‹¤ëŠ” ì¤‘ìš”í•œ ì°¨ì´ì ì´ ìˆìŠµë‹ˆë‹¤.**

ëª¨ë“  ExternalNames ë‚˜ì—´í•˜ê¸°:

{% code overflow="wrap" %}
```bash
kubectl get services --all-namespaces | grep ExternalName
```
{% endcode %}

### Ingress

ìœ„ì˜ ëª¨ë“  ì˜ˆì™€ ë‹¬ë¦¬, **IngressëŠ” ì„œë¹„ìŠ¤ì˜ ìœ í˜•ì´ ì•„ë‹™ë‹ˆë‹¤**. ëŒ€ì‹ , **ì—¬ëŸ¬ ì„œë¹„ìŠ¤ ì•ì— ìœ„ì¹˜í•˜ì—¬ â€œìŠ¤ë§ˆíŠ¸ ë¼ìš°í„°â€** ë˜ëŠ” í´ëŸ¬ìŠ¤í„°ì˜ ì§„ì…ì  ì—­í• ì„ í•©ë‹ˆë‹¤.

Ingressë¥¼ ì‚¬ìš©í•˜ì—¬ ë‹¤ì–‘í•œ ì‘ì—…ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆìœ¼ë©°, **ë‹¤ì–‘í•œ ê¸°ëŠ¥ì„ ê°€ì§„ ì—¬ëŸ¬ ìœ í˜•ì˜ Ingress ì»¨íŠ¸ë¡¤ëŸ¬ê°€ ìˆìŠµë‹ˆë‹¤**.

ê¸°ë³¸ GKE Ingress ì»¨íŠ¸ë¡¤ëŸ¬ëŠ” [HTTP(S) Load Balancer](https://cloud.google.com/compute/docs/load-balancing/http/)ë¥¼ ìë™ìœ¼ë¡œ ìƒì„±í•©ë‹ˆë‹¤. ì´ë¥¼ í†µí•´ ê²½ë¡œ ê¸°ë°˜ ë° ì„œë¸Œë„ë©”ì¸ ê¸°ë°˜ ë¼ìš°íŒ…ì„ ë°±ì—”ë“œ ì„œë¹„ìŠ¤ë¡œ ìˆ˜í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´, foo.yourdomain.comì˜ ëª¨ë“  ìš”ì²­ì„ foo ì„œë¹„ìŠ¤ë¡œ ë³´ë‚´ê³ , yourdomain.com/bar/ ê²½ë¡œ ì•„ë˜ì˜ ëª¨ë“  ìš”ì²­ì„ bar ì„œë¹„ìŠ¤ë¡œ ë³´ë‚¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

GKEì—ì„œ [L7 HTTP Load Balancer](https://cloud.google.com/compute/docs/load-balancing/http/)ë¥¼ ì‚¬ìš©í•˜ëŠ” Ingress ê°ì²´ì˜ YAMLì€ ë‹¤ìŒê³¼ ê°™ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```yaml
apiVersion: extensions/v1beta1
kind: Ingress
metadata:
name: my-ingress
spec:
backend:
serviceName: other
servicePort: 8080
rules:
- host: foo.mydomain.com
http:
paths:
- backend:
serviceName: foo
servicePort: 8080
- host: mydomain.com
http:
paths:
- path: /bar/*
backend:
serviceName: bar
servicePort: 8080
```
ëª¨ë“  ì¸ê·¸ë ˆìŠ¤ë¥¼ ë‚˜ì—´í•©ë‹ˆë‹¤:

{% code overflow="wrap" %}
```bash
kubectl get ingresses --all-namespaces -o=custom-columns='NAMESPACE:.metadata.namespace,NAME:.metadata.name,RULES:spec.rules[*],STATUS:status'
```
{% endcode %}

ì´ ê²½ìš° ê° ì •ë³´ë¥¼ í•˜ë‚˜ì”© ê°€ì ¸ì˜¤ëŠ” ê²ƒì´ ë” ë‚˜ì€ ì½ê¸°ë¥¼ ìœ„í•´ ì¢‹ìŠµë‹ˆë‹¤:
```bash
kubectl get ingresses --all-namespaces -o=yaml
```
### References

* [https://medium.com/google-cloud/kubernetes-nodeport-vs-loadbalancer-vs-ingress-when-should-i-use-what-922f010849e0](https://medium.com/google-cloud/kubernetes-nodeport-vs-loadbalancer-vs-ingress-when-should-i-use-what-922f010849e0)
* [https://kubernetes.io/docs/concepts/services-networking/service/](https://kubernetes.io/docs/concepts/services-networking/service/)

{% hint style="success" %}
AWS í•´í‚¹ ë°°ìš°ê¸° ë° ì—°ìŠµí•˜ê¸°:<img src="../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
GCP í•´í‚¹ ë°°ìš°ê¸° ë° ì—°ìŠµí•˜ê¸°: <img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks ì§€ì›í•˜ê¸°</summary>

* [**êµ¬ë… ê³„íš**](https://github.com/sponsors/carlospolop) í™•ì¸í•˜ê¸°!
* **ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— ì°¸ì—¬í•˜ê±°ë‚˜ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**ë¥¼ íŒ”ë¡œìš°í•˜ì„¸ìš”.**
* **[**HackTricks**](https://github.com/carlospolop/hacktricks) ë° [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) ê¹ƒí—ˆë¸Œ ë¦¬í¬ì§€í† ë¦¬ì— PRì„ ì œì¶œí•˜ì—¬ í•´í‚¹ íŒì„ ê³µìœ í•˜ì„¸ìš”.**

</details>
{% endhint %}
