# Kubernetes'te Hizmetleri AÃ§Ä±ÄŸa Ã‡Ä±karma

<details>

<summary><strong>SÄ±fÄ±rdan kahraman olacak ÅŸekilde AWS hacklemeyi Ã¶ÄŸrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

HackTricks'Ä± desteklemenin diÄŸer yollarÄ±:

* **Åirketinizi HackTricks'te reklamÄ±nÄ± gÃ¶rmek istiyorsanÄ±z** veya **HackTricks'i PDF olarak indirmek istiyorsanÄ±z** [**ABONELÄ°K PLANLARI**]'na gÃ¶z atÄ±n (https://github.com/sponsors/carlospolop)!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* [**The PEASS Family**]'yi (https://opensea.io/collection/the-peass-family) keÅŸfedin, Ã¶zel [**NFT'lerimiz**]'i (https://opensea.io/collection/the-peass-family) iÃ§eren koleksiyonumuz
* **KatÄ±lÄ±n** ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) veya beni **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm)**'de takip edin.**
* **Hacking pÃ¼f noktalarÄ±nÄ±zÄ± paylaÅŸarak PR'lar gÃ¶ndererek** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na katkÄ±da bulunun.

</details>

Kubernetes'te hizmetleri aÃ§Ä±ÄŸa Ã§Ä±karmak iÃ§in **farklÄ± yÃ¶ntemler** bulunmaktadÄ±r, bÃ¶ylece **iÃ§** ve **dÄ±ÅŸ** uÃ§ noktalar bunlara eriÅŸebilir. Bu Kubernetes yapÄ±landÄ±rmasÄ± oldukÃ§a kritiktir Ã§Ã¼nkÃ¼ yÃ¶netici, **eriÅŸmemeleri gereken hizmetlere saldÄ±rganlara eriÅŸim saÄŸlayabilir**. 

### Otomatik NumaralandÄ±rma

K8s'in hizmetleri genel kullanÄ±ma aÃ§ma yollarÄ±nÄ± numaralandÄ±rmaya baÅŸlamadan Ã¶nce, namespace'leri, hizmetleri ve ingress'leri listeleyebiliyorsanÄ±z, her ÅŸeyin genel kullanÄ±ma aÃ§Ä±k olduÄŸunu bulabilirsiniz:
```bash
kubectl get namespace -o custom-columns='NAME:.metadata.name' | grep -v NAME | while IFS='' read -r ns; do
echo "Namespace: $ns"
kubectl get service -n "$ns"
kubectl get ingress -n "$ns"
echo "=============================================="
echo ""
echo ""
done | grep -v "ClusterIP"
# Remove the last '| grep -v "ClusterIP"' to see also type ClusterIP
```
### ClusterIP

Bir **ClusterIP** servisi, **varsayÄ±lan** Kubernetes **servisidir**. KÃ¼meniz iÃ§inde diÄŸer uygulamalarÄ±n eriÅŸebileceÄŸi bir **servis** saÄŸlar. **Harici eriÅŸim yoktur**.

Ancak, bu Kubernetes Proxy kullanÄ±larak eriÅŸilebilir:
```bash
kubectl proxy --port=8080
```
Åimdi, Kubernetes API'si Ã¼zerinden hizmetlere eriÅŸmek iÃ§in bu ÅŸemayÄ± kullanabilirsiniz:

`http://localhost:8080/api/v1/proxy/namespaces/<NAMESPACE>/services/<SERVICE-NAME>:<PORT-NAME>/`

Ã–rneÄŸin, aÅŸaÄŸÄ±daki URL'yi kullanabilirsiniz:

`http://localhost:8080/api/v1/proxy/namespaces/default/services/my-internal-service:http/`

bu hizmete eriÅŸmek iÃ§in:
```yaml
apiVersion: v1
kind: Service
metadata:
name: my-internal-service
spec:
selector:
app: my-app
type: ClusterIP
ports:
- name: http
port: 80
targetPort: 80
protocol: TCP
```
_Bu yÃ¶ntem, `kubectl`'i **kimlik doÄŸrulanmÄ±ÅŸ bir kullanÄ±cÄ±** olarak Ã§alÄ±ÅŸtÄ±rmanÄ±zÄ± gerektirir._

TÃ¼m ClusterIP'leri listele:

{% code overflow="wrap" %}
```bash
kubectl get services --all-namespaces -o=custom-columns='NAMESPACE:.metadata.namespace,NAME:.metadata.name,TYPE:.spec.type,CLUSTER-IP:.spec.clusterIP,PORT(S):.spec.ports[*].port,TARGETPORT(S):.spec.ports[*].targetPort,SELECTOR:.spec.selector' | grep ClusterIP
```
### NodePort

**NodePort** kullanÄ±ldÄ±ÄŸÄ±nda, tÃ¼m DÃ¼ÄŸÃ¼mlerde (Sanal Makineleri temsil eden) belirli bir baÄŸlantÄ± noktasÄ± kullanÄ±labilir hale getirilir. Bu belirli baÄŸlantÄ± noktasÄ±na yÃ¶nlendirilen **trafik**, ardÄ±ndan hizmete sistemli bir ÅŸekilde yÃ¶nlendirilir. Genellikle, bu yÃ¶ntem dezavantajlarÄ± nedeniyle Ã¶nerilmez.

TÃ¼m NodePort'larÄ± listele:

{% code overflow="wrap" %}
```bash
kubectl get services --all-namespaces -o=custom-columns='NAMESPACE:.metadata.namespace,NAME:.metadata.name,TYPE:.spec.type,CLUSTER-IP:.spec.clusterIP,PORT(S):.spec.ports[*].port,NODEPORT(S):.spec.ports[*].nodePort,TARGETPORT(S):.spec.ports[*].targetPort,SELECTOR:.spec.selector' | grep NodePort
```
{% endcode %}

NodePort spesifikasyonuna bir Ã¶rnek:
```yaml
apiVersion: v1
kind: Service
metadata:
name: my-nodeport-service
spec:
selector:
app: my-app
type: NodePort
ports:
- name: http
port: 80
targetPort: 80
nodePort: 30036
protocol: TCP
```
EÄŸer yaml dosyasÄ±nda **nodePort** belirtmezseniz (aÃ§Ä±lacak olan port), **30000â€“32767 aralÄ±ÄŸÄ±nda bir port** kullanÄ±lacaktÄ±r.

### LoadBalancer <a href="#id-0d96" id="id-0d96"></a>

DÄ±ÅŸarÄ±ya **bir bulut saÄŸlayÄ±cÄ±sÄ±nÄ±n yÃ¼k dengeleyicisini kullanarak** Servisi aÃ§ar. GKE'de, bu [Network Load Balancer](https://cloud.google.com/compute/docs/load-balancing/network/) oluÅŸturacak ve tÃ¼m trafiÄŸi servisinize iletecek tek bir IP adresi saÄŸlayacaktÄ±r. AWS'de bir YÃ¼k Dengeleyici baÅŸlatacaktÄ±r.

Her aÃ§Ä±lan servis iÃ§in bir YÃ¼k Dengeleyiciye Ã¶deme yapmanÄ±z gerekebilir, bu maliyetli olabilir.

TÃ¼m YÃ¼k Dengeleyicileri listele:

{% code overflow="wrap" %}
```bash
kubectl get services --all-namespaces -o=custom-columns='NAMESPACE:.metadata.namespace,NAME:.metadata.name,TYPE:.spec.type,CLUSTER-IP:.spec.clusterIP,EXTERNAL-IP:.status.loadBalancer.ingress[*],PORT(S):.spec.ports[*].port,NODEPORT(S):.spec.ports[*].nodePort,TARGETPORT(S):.spec.ports[*].targetPort,SELECTOR:.spec.selector' | grep LoadBalancer
```
{% endcode %}

### Harici IP'ler <a href="#external-ips" id="external-ips"></a>

{% hint style="success" %}
Harici IP'ler, YÃ¼k Dengeleyiciler tÃ¼rÃ¼ndeki hizmetler tarafÄ±ndan aÃ§Ä±ÄŸa Ã§Ä±karÄ±lÄ±r ve genellikle harici bir Bulut SaÄŸlayÄ±cÄ± YÃ¼k Dengeleyicisi kullanÄ±ldÄ±ÄŸÄ±nda kullanÄ±lÄ±r.

BunlarÄ± bulmak iÃ§in, `EXTERNAL-IP` alanÄ±nda deÄŸerleri olan yÃ¼k dengeleyicileri kontrol edin.
{% endhint %}

KÃ¼me iÃ§ine giren trafiÄŸin **harici IP** (hedef IP olarak) Ã¼zerinden, Servis portuna yÃ¶nlendirileceÄŸi bir Servis uÃ§ noktasÄ±na **yÃ¶nlendirilecektir**. `externalIPs`, Kubernetes tarafÄ±ndan yÃ¶netilmez ve kÃ¼me yÃ¶neticisinin sorumluluÄŸundadÄ±r.

Servis Ã¶zelliklerinde, `externalIPs` herhangi bir `ServiceTypes` ile birlikte belirtilebilir. AÅŸaÄŸÄ±daki Ã¶rnekte, "`my-service`" "`80.11.12.10:80`" (`externalIP:port`) Ã¼zerinden istemciler tarafÄ±ndan eriÅŸilebilir.
```yaml
apiVersion: v1
kind: Service
metadata:
name: my-service
spec:
selector:
app: MyApp
ports:
- name: http
protocol: TCP
port: 80
targetPort: 9376
externalIPs:
- 80.11.12.10
```
### ExternalName

[**DokÃ¼mantasyondan:**](https://kubernetes.io/docs/concepts/services-networking/service/#externalname) ExternalName tÃ¼rÃ¼ndeki Servisler, bir Servisi tipik bir seÃ§iciye (`my-service` veya `cassandra` gibi) deÄŸil, bir DNS adÄ±na **eÅŸler**. Bu Servisler belirliyorsunuz ve `spec.externalName` parametresi ile tanÄ±mlÄ±yorsunuz.

Ã–rneÄŸin, aÅŸaÄŸÄ±daki Servis tanÄ±mÄ±, `prod` ad alanÄ±ndaki `my-service` Servisini `my.database.example.com` adresine eÅŸler:
```yaml
apiVersion: v1
kind: Service
metadata:
name: my-service
namespace: prod
spec:
type: ExternalName
externalName: my.database.example.com
```
```markdown
Kubernetes'te `my-service.prod.svc.cluster.local` ana bilgisayarÄ±nÄ± aradÄ±ÄŸÄ±nÄ±zda, kÃ¼me DNS Hizmeti `my.database.example.com` deÄŸerine sahip bir `CNAME` kaydÄ± dÃ¶ndÃ¼rÃ¼r. `my-service`'e eriÅŸmek diÄŸer Hizmetlerle aynÄ± ÅŸekilde Ã§alÄ±ÅŸÄ±r ancak **yÃ¶nlendirme DNS seviyesinde** proxy veya yÃ¶nlendirme yoluyla deÄŸil gerÃ§ekleÅŸir.

TÃ¼m ExternalNames'leri listele:

{% code overflow="wrap" %}
```
```bash
kubectl get services --all-namespaces | grep ExternalName
```
{% endcode %}

### Ingress

TÃ¼m yukarÄ±daki Ã¶rneklerin aksine, **Ingress bir hizmet tÃ¼rÃ¼ DEÄÄ°LDÄ°R**. Bunun yerine, **Ã§oklu hizmetlerin Ã¶nÃ¼nde oturur ve bir "akÄ±llÄ± yÃ¶nlendirici" veya kÃ¼menize giriÅŸ noktasÄ± olarak hareket eder**.

Bir Ingress ile birÃ§ok farklÄ± ÅŸey yapabilirsiniz ve **farklÄ± yeteneklere sahip birÃ§ok tÃ¼rde Ingress denetleyicisi bulunmaktadÄ±r**.

VarsayÄ±lan GKE ingress denetleyicisi sizin iÃ§in bir [HTTP(S) YÃ¼k Dengeleyici](https://cloud.google.com/compute/docs/load-balancing/http/) oluÅŸturacaktÄ±r. Bu size hem yol tabanlÄ± hem de alt alan tabanlÄ± yÃ¶nlendirme imkanÄ± saÄŸlar. Ã–rneÄŸin, foo.yourdomain.com'daki her ÅŸeyi foo servisine gÃ¶nderebilir ve yourdomain.com/bar/ yolunun altÄ±ndaki her ÅŸeyi bar servisine gÃ¶nderebilirsiniz.

GKE'de bir Ingress nesnesi iÃ§in bir [L7 HTTP YÃ¼k Dengeleyici](https://cloud.google.com/compute/docs/load-balancing/http/) ile YAML ÅŸÃ¶yle gÃ¶rÃ¼nebilir:
```yaml
apiVersion: extensions/v1beta1
kind: Ingress
metadata:
name: my-ingress
spec:
backend:
serviceName: other
servicePort: 8080
rules:
- host: foo.mydomain.com
http:
paths:
- backend:
serviceName: foo
servicePort: 8080
- host: mydomain.com
http:
paths:
- path: /bar/*
backend:
serviceName: bar
servicePort: 8080
```
TÃ¼m giriÅŸleri listele:

{% code overflow="wrap" %}
```bash
kubectl get ingresses --all-namespaces -o=custom-columns='NAMESPACE:.metadata.namespace,NAME:.metadata.name,RULES:spec.rules[*],STATUS:status'
```
{% endcode %}

Bu durumda her birini tek tek alÄ±p daha iyi okumak iÃ§in bilgilerini almak daha iyidir:
```bash
kubectl get ingresses --all-namespaces -o=yaml
```
### Referanslar

* [https://medium.com/google-cloud/kubernetes-nodeport-vs-loadbalancer-vs-ingress-when-should-i-use-what-922f010849e0](https://medium.com/google-cloud/kubernetes-nodeport-vs-loadbalancer-vs-ingress-when-should-i-use-what-922f010849e0)
* [https://kubernetes.io/docs/concepts/services-networking/service/](https://kubernetes.io/docs/concepts/services-networking/service/)

<details>

<summary><strong>SÄ±fÄ±rdan kahraman olacak ÅŸekilde AWS hackleme Ã¶ÄŸrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

HackTricks'Ä± desteklemenin diÄŸer yollarÄ±:

* **Åirketinizi HackTricks'te reklamÄ±nÄ± gÃ¶rmek istiyorsanÄ±z** veya **HackTricks'i PDF olarak indirmek istiyorsanÄ±z** [**ABONELÄ°K PLANLARI**](https://github.com/sponsors/carlospolop)'na gÃ¶z atÄ±n!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* [**The PEASS Family'yi**](https://opensea.io/collection/the-peass-family) keÅŸfedin, Ã¶zel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuz
* **ğŸ’¬ [Discord grubuna](https://discord.gg/hRep4RUj7f) veya [telegram grubuna](https://t.me/peass) katÄ±lÄ±n veya beni Twitter'da takip edin** ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Hacking pÃ¼f noktalarÄ±nÄ±zÄ± paylaÅŸarak PR'lar gÃ¶ndererek** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na katkÄ±da bulunun.

</details>
