# Kubernetes Rol TabanlÄ± EriÅŸim KontrolÃ¼ (RBAC)

{% hint style="success" %}
AWS Hacking'i Ã¶ÄŸrenin ve uygulayÄ±n: <img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks EÄŸitim AWS KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ± (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCP Hacking'i Ã¶ÄŸrenin ve uygulayÄ±n: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks EÄŸitim GCP KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ± (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**Abonelik planlarÄ±nÄ±**](https://github.com/sponsors/carlospolop) kontrol edin!
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) katÄ±lÄ±n veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n veya bizi **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** takip edin.**
* **Hacking pÃ¼f noktalarÄ±nÄ± paylaÅŸarak PR gÃ¶ndererek** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na katkÄ±da bulunun.

</details>
{% endhint %}

## Rol TabanlÄ± EriÅŸim KontrolÃ¼ (RBAC)

Kubernetes'in **Rol TabanlÄ± EriÅŸim KontrolÃ¼** adÄ±nda bir **yetkilendirme modÃ¼lÃ¼** ([**RBAC**](https://kubernetes.io/docs/reference/access-authn-authz/rbac/)) vardÄ±r ve API sunucusuna kullanÄ±m izinleri belirlemeye yardÄ±mcÄ± olur.

RBAC'nin izin modeli **Ã¼Ã§ ayrÄ± parÃ§adan** oluÅŸur:

1. **Rol\ClusterRole â€“** GerÃ§ek izin. Bir dizi izni temsil eden _**kurallar**_ iÃ§erir. Her kural [kaynaklarÄ±](https://kubernetes.io/docs/reference/kubectl/overview/#resource-types) ve [fiilleri](https://kubernetes.io/docs/reference/access-authn-authz/authorization/#determine-the-request-verb) iÃ§erir. Fiil, kaynaÄŸa uygulanacak eylemdir.
2. **Konu (KullanÄ±cÄ±, Grup veya ServiceAccount) â€“** Ä°zinleri alacak nesne.
3. **RoleBinding\ClusterRoleBinding â€“** Rol\ClusterRole ile konu arasÄ±ndaki baÄŸlantÄ±.

![](https://www.cyberark.com/wp-content/uploads/2018/12/rolebiding\_serviceaccount\_and\_role-1024x551.png)

â€œ**Roller**â€ ile â€œ**ClusterRoller**â€ arasÄ±ndaki fark, rolÃ¼n uygulanacaÄŸÄ± yerdir - bir â€œ**Rol**â€ yalnÄ±zca **bir** **belirli** **ad alanÄ±na** eriÅŸim saÄŸlayacaktÄ±r, ancak â€œ**ClusterRole**â€ tÃ¼m ad alanlarÄ±nda kullanÄ±labilir. DahasÄ±, **ClusterRoller** ayrÄ±ca ÅŸunlara eriÅŸim saÄŸlayabilir:

* **kÃ¼me kapsamlÄ±** kaynaklar (Ã¶rneÄŸin dÃ¼ÄŸÃ¼mler).
* **kaynak olmayan** uÃ§ noktalar (/healthz gibi).
* ad alanÄ±na Ã¶zgÃ¼ kaynaklar (Ã¶rneÄŸin Pod'lar), **tÃ¼m ad alanlarÄ±** boyunca.

**Kubernetes** 1.6'dan itibaren **RBAC** politikalarÄ± **varsayÄ±lan olarak etkindir**. Ancak RBAC'yi etkinleÅŸtirmek iÃ§in ÅŸuna benzer bir ÅŸey kullanabilirsiniz:
```
kube-apiserver --authorization-mode=Example,RBAC --other-options --more-options
```
## Åablonlar

Bir **Rol** veya **ClusterRole** ÅŸablonunda **rolÃ¼n adÄ±nÄ±**, **ad alanÄ±nÄ±** (rollerde) ve ardÄ±ndan rolÃ¼n **apiGroups**, **kaynaklar** ve **fiillerini** belirtmeniz gerekecektir:

- **apiGroups**, bu kuralÄ±n uygulandÄ±ÄŸÄ± farklÄ± **API ad alanlarÄ±nÄ±** iÃ§eren bir dizi iÃ§erir. Ã–rneÄŸin, bir Pod tanÄ±mÄ± apiVersion: v1 kullanÄ±r. _DeÄŸerler rbac.authorization.k8s.io veya \[\*] olabilir_.
- **kaynaklar**, bu kuralÄ±n uygulandÄ±ÄŸÄ± **hangi kaynaklarÄ±** tanÄ±mlayan bir dizi iÃ§erir. TÃ¼m kaynaklarÄ± ÅŸu komutla bulabilirsiniz: `kubectl api-resources --namespaced=true`
- **fiiller**, **izin verilen fiilleri** iÃ§eren bir dizi iÃ§erir. Kubernetes'te fiil, kaynaÄŸa uygulamanÄ±z gereken **eylem tÃ¼rÃ¼nÃ¼** tanÄ±mlar. Ã–rneÄŸin, list fiili koleksiyonlara karÅŸÄ± kullanÄ±lÄ±rken "get" tek bir kaynaÄŸa karÅŸÄ± kullanÄ±lÄ±r.

### KurallarÄ±n Fiilleri

(_Bu bilgi_ [_**belgelerden alÄ±nmÄ±ÅŸtÄ±r**_](https://kubernetes.io/docs/reference/access-authn-authz/authorization/#determine-the-request-verb))

| HTTP fiili | istek fiili                                                                                                                                                  |
| --------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| POST      | create                                                                                                                                                        |
| GET, HEAD | get (bireysel kaynaklar iÃ§in), list (koleksiyonlar iÃ§in, tam nesne iÃ§eriÄŸi dahil), watch (bireysel kaynaÄŸÄ± veya kaynak koleksiyonunu izlemek iÃ§in) |
| PUT       | update                                                                                                                                                        |
| PATCH     | patch                                                                                                                                                         |
| DELETE    | delete (bireysel kaynaklar iÃ§in), deletecollection (koleksiyonlar iÃ§in)                                                                                         |

Kubernetes bazen Ã¶zel fiiller kullanarak ek izinler iÃ§in yetkilendirme kontrolÃ¼ yapar. Ã–rneÄŸin:

- [Pod GÃ¼venlik PolitikasÄ±](https://kubernetes.io/docs/concepts/policy/pod-security-policy/)
- `policy` API grubundaki `podsecuritypolicies` kaynaklarÄ±nda `use` fiili.
- [RBAC](https://kubernetes.io/docs/reference/access-authn-authz/rbac/#privilege-escalation-prevention-and-bootstrapping)
- `rbac.authorization.k8s.io` API grubundaki `roles` ve `clusterroles` kaynaklarÄ±nda `bind` ve `escalate` fiilleri.
- [Kimlik DoÄŸrulama](https://kubernetes.io/docs/reference/access-authn-authz/authentication/)
- `authentication.k8s.io` API grubundaki `users`, `groups` ve `serviceaccounts` Ã¼zerinde `impersonate` fiili ve `authentication.k8s.io` API grubundaki `userextras`.

{% hint style="warning" %}
Her kaynaÄŸÄ±n desteklediÄŸi **tÃ¼m fiilleri** bulabilirsiniz `kubectl api-resources --sort-by name -o wide` komutunu Ã§alÄ±ÅŸtÄ±rarak
{% endhint %}

### Ã–rnekler

{% code title="Rol" %}
```yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
namespace: defaultGreen
name: pod-and-pod-logs-reader
rules:
- apiGroups: [""]
resources: ["pods", "pods/log"]
verbs: ["get", "list", "watch"]
```
{% endcode %}

{% code title="ClusterRole" %} 

## KÃ¼me RolÃ¼
```yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
# "namespace" omitted since ClusterRoles are not namespaced
name: secret-reader
rules:
- apiGroups: [""]
resources: ["secrets"]
verbs: ["get", "watch", "list"]
```
{% endcode %}

Ã–rneÄŸin, belirli bir kullanÄ±cÄ±nÄ±n ÅŸunu Ã§alÄ±ÅŸtÄ±rmasÄ±na izin vermek iÃ§in bir **ClusterRole** kullanabilirsiniz:
```
kubectl get pods --all-namespaces
```
### **RoleBinding ve ClusterRoleBinding**

**[DokÃ¼mandan:](https://kubernetes.io/docs/reference/access-authn-authz/rbac/#rolebinding-and-clusterrolebinding)** Bir **role binding, bir role'de tanÄ±mlanan izinleri bir kullanÄ±cÄ±ya veya kullanÄ±cÄ± grubuna verir**. Bu, bir liste konularÄ± (kullanÄ±cÄ±lar, gruplar veya servis hesaplarÄ±) ve verilen role referansÄ± iÃ§erir. Bir **RoleBinding**, belirli bir **namespace** iÃ§inde izinler verirken, bir **ClusterRoleBinding** bu eriÅŸimi **kÃ¼me genelinde** verir.

{% code title="" %}
```yaml
piVersion: rbac.authorization.k8s.io/v1
# This role binding allows "jane" to read pods in the "default" namespace.
# You need to already have a Role named "pod-reader" in that namespace.
kind: RoleBinding
metadata:
name: read-pods
namespace: default
subjects:
# You can specify more than one "subject"
- kind: User
name: jane # "name" is case sensitive
apiGroup: rbac.authorization.k8s.io
roleRef:
# "roleRef" specifies the binding to a Role / ClusterRole
kind: Role #this must be Role or ClusterRole
name: pod-reader # this must match the name of the Role or ClusterRole you wish to bind to
apiGroup: rbac.authorization.k8s.io
```
{% endcode %}

{% code title="ClusterRoleBinding" %} 

---

KÃ¼me Rol BaÄŸlama

---
```yaml
apiVersion: rbac.authorization.k8s.io/v1
# This cluster role binding allows anyone in the "manager" group to read secrets in any namespace.
kind: ClusterRoleBinding
metadata:
name: read-secrets-global
subjects:
- kind: Group
name: manager # Name is case sensitive
apiGroup: rbac.authorization.k8s.io
roleRef:
kind: ClusterRole
name: secret-reader
apiGroup: rbac.authorization.k8s.io
```
{% endcode %}

**Ä°zinler eklenir** bu yÃ¼zden "list" ve "delete" izinlerine sahip bir clusterRole'unuz varsa, bunu "get" izni olan bir Role ile ekleyebilirsiniz. Bu yÃ¼zden rollerinizi ve izinlerinizi her zaman test edin ve **NEYE Ä°ZÄ°N VERÄ°LDÄ°ÄÄ°NÄ° belirtin, Ã§Ã¼nkÃ¼ varsayÄ±lan olarak HER ÅEY REDDEDÄ°LÄ°R.**

## **RBAC NumaralandÄ±rma**
```bash
# Get current privileges
kubectl auth can-i --list
# use `--as=system:serviceaccount:<namespace>:<sa_name>` to impersonate a service account

# List Cluster Roles
kubectl get clusterroles
kubectl describe clusterroles

# List Cluster Roles Bindings
kubectl get clusterrolebindings
kubectl describe clusterrolebindings

# List Roles
kubectl get roles
kubectl describe roles

# List Roles Bindings
kubectl get rolebindings
kubectl describe rolebindings
```
### Yetki YÃ¼kseltme iÃ§in Rol/ClusterRoles'un KÃ¶tÃ¼ye KullanÄ±mÄ±

{% content-ref url="abusing-roles-clusterroles-in-kubernetes/" %}
[abusing-roles-clusterroles-in-kubernetes](abusing-roles-clusterroles-in-kubernetes/)
{% endcontent-ref %}

{% hint style="success" %}
AWS Hacking'i Ã–ÄŸrenin ve UygulayÄ±n: <img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks EÄŸitim AWS KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ± (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCP Hacking'i Ã–ÄŸrenin ve UygulayÄ±n: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks EÄŸitim GCP KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ± (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**Abonelik planlarÄ±nÄ±**](https://github.com/sponsors/carlospolop) kontrol edin!
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) katÄ±lÄ±n veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n veya bizi **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** takip edin.**
* **Hacking pÃ¼f noktalarÄ±nÄ± paylaÅŸarak PR gÃ¶ndererek HackTricks** ve **HackTricks Cloud** github depolarÄ±na katkÄ±da bulunun.

</details>
{% endhint %}
