# Kubernetes Namespace Escalation

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** 💬 [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

Στο Kubernetes είναι αρκετά συνηθισμένο να **καταφέρετε να μπείτε σε ένα namespace** (κλέβοντας κάποια διαπιστευτήρια χρήστη ή συμβιβάζοντας ένα pod). Ωστόσο, συνήθως θα σας ενδιαφέρει να **κλιμακώσετε σε ένα διαφορετικό namespace καθώς εκεί μπορεί να βρείτε πιο ενδιαφέροντα πράγματα**.

Ακολουθούν μερικές τεχνικές που μπορείτε να δοκιμάσετε για να ξεφύγετε σε ένα διαφορετικό namespace:

### Κατάχρηση δικαιωμάτων K8s

Προφανώς, αν ο λογαριασμός που έχετε κλέψει έχει ευαίσθητα δικαιώματα πάνω στο namespace στο οποίο μπορείτε να κλιμακώσετε, μπορείτε να καταχραστείτε ενέργειες όπως **δημιουργία pods** με λογαριασμούς υπηρεσιών στο NS, **εκτέλεση** ενός shell σε ένα ήδη υπάρχον pod μέσα στο ns, ή να διαβάσετε τα **μυστικά** SA tokens.

Για περισσότερες πληροφορίες σχετικά με τα δικαιώματα που μπορείτε να καταχραστείτε, διαβάστε:

{% content-ref url="abusing-roles-clusterroles-in-kubernetes/" %}
[abusing-roles-clusterroles-in-kubernetes](abusing-roles-clusterroles-in-kubernetes/)
{% endcontent-ref %}

### Διαφυγή στον κόμβο

Αν μπορείτε να διαφύγετε στον κόμβο είτε επειδή έχετε συμβιβάσει ένα pod και μπορείτε να διαφύγετε είτε επειδή μπορείτε να δημιουργήσετε ένα προνομιακό pod και να διαφύγετε, μπορείτε να κάνετε αρκετά πράγματα για να κλέψετε άλλα SA tokens:

* Ελέγξτε για **SA tokens που είναι τοποθετημένα σε άλλα κοντέινερ docker** που εκτελούνται στον κόμβο
* Ελέγξτε για νέα **kubeconfig αρχεία στον κόμβο με επιπλέον δικαιώματα** που έχουν δοθεί στον κόμβο
* Αν είναι ενεργοποιημένο (ή ενεργοποιήστε το εσείς) προσπαθήστε να **δημιουργήσετε καθρεφτισμένα pods άλλων namespaces** καθώς μπορεί να αποκτήσετε πρόσβαση στους προεπιλεγμένους λογαριασμούς token αυτών των namespaces (δεν το έχω δοκιμάσει ακόμα)

Όλες αυτές οι τεχνικές εξηγούνται σε:

{% content-ref url="attacking-kubernetes-from-inside-a-pod.md" %}
[attacking-kubernetes-from-inside-a-pod.md](attacking-kubernetes-from-inside-a-pod.md)
{% endcontent-ref %}

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** 💬 [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
