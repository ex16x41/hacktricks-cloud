# Kubernetes Basics

## Kubernetes Basics

{% hint style="success" %}
AWSãƒãƒƒã‚­ãƒ³ã‚°ã®å­¦ç¿’ã¨å®Ÿè·µ:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCPãƒãƒƒã‚­ãƒ³ã‚°ã®å­¦ç¿’ã¨å®Ÿè·µ: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricksã®ã‚µãƒãƒ¼ãƒˆ</summary>

* [**ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³**](https://github.com/sponsors/carlospolop)ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ï¼
* ğŸ’¬ [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã«å‚åŠ ã™ã‚‹ã‹ã€[**telegramã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«å‚åŠ ã™ã‚‹ã‹ã€**Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**ã‚’ãƒ•ã‚©ãƒ­ãƒ¼**ã—ã¦ãã ã•ã„ã€‚
* **HackTricks**ã¨[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)ã®GitHubãƒªãƒã‚¸ãƒˆãƒªã«PRã‚’æå‡ºã—ã¦ã€ãƒãƒƒã‚­ãƒ³ã‚°ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã—ã¦ãã ã•ã„ã€‚

</details>
{% endhint %}

**ã“ã®ãƒšãƒ¼ã‚¸ã®å…ƒã®è‘—è€…ã¯** [**Jorge**](https://www.linkedin.com/in/jorge-belmonte-a924b616b/) **ã§ã™ï¼ˆå…ƒã®æŠ•ç¨¿ã¯** [**ã“ã¡ã‚‰**](https://sickrov.github.io)**ï¼‰**

## ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã¨åŸºæœ¬

### Kubernetesã®å½¹å‰²

* ã‚³ãƒ³ãƒ†ãƒŠã‚’ã‚³ãƒ³ãƒ†ãƒŠã‚¨ãƒ³ã‚¸ãƒ³ã§å®Ÿè¡Œã§ãã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚
* ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã«ã‚ˆã‚Šã‚³ãƒ³ãƒ†ãƒŠã‚’åŠ¹ç‡çš„ã«ãƒŸãƒƒã‚·ãƒ§ãƒ³ã§ãã¾ã™ã€‚
* ã‚³ãƒ³ãƒ†ãƒŠã‚’ç”Ÿã‹ã—ç¶šã‘ã¾ã™ã€‚
* ã‚³ãƒ³ãƒ†ãƒŠé–“ã®é€šä¿¡ã‚’å¯èƒ½ã«ã—ã¾ã™ã€‚
* ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆæŠ€è¡“ã‚’å¯èƒ½ã«ã—ã¾ã™ã€‚
* å¤§é‡ã®æƒ…å ±ã‚’å‡¦ç†ã—ã¾ã™ã€‚

### ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

![](https://sickrov.github.io/media/Screenshot-68.jpg)

* **ãƒãƒ¼ãƒ‰**: ãƒãƒƒãƒ‰ã¾ãŸã¯ãƒãƒƒãƒ‰ã‚’æŒã¤ã‚ªãƒšãƒ¬ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚·ã‚¹ãƒ†ãƒ ã€‚
* **ãƒãƒƒãƒ‰**: 1ã¤ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ã¿ã‚’å«ã‚€ã¹ãã§ã‚ã‚‹ãƒ©ãƒƒãƒ‘ãƒ¼ã§ã‚ã‚‹ã‚³ãƒ³ãƒ†ãƒŠã¾ãŸã¯è¤‡æ•°ã®ã‚³ãƒ³ãƒ†ãƒŠã€‚é€šå¸¸ã€1ã¤ã®ãƒãƒƒãƒ‰ã¯1ã¤ã®ã‚³ãƒ³ãƒ†ãƒŠã‚’å®Ÿè¡Œã—ã¾ã™ã€‚ãƒãƒƒãƒ‰ã¯ã€KubernetesãŒå®Ÿè¡Œã—ã¦ã„ã‚‹ã‚³ãƒ³ãƒ†ãƒŠæŠ€è¡“ã‚’æŠ½è±¡åŒ–ã™ã‚‹æ–¹æ³•ã§ã™ã€‚
* **ã‚µãƒ¼ãƒ“ã‚¹**: å„ãƒãƒƒãƒ‰ã¯ã€ãƒãƒ¼ãƒ‰ã®å†…éƒ¨ç¯„å›²ã‹ã‚‰1ã¤ã®å†…éƒ¨**IPã‚¢ãƒ‰ãƒ¬ã‚¹**ã‚’æŒã¡ã¾ã™ã€‚ãŸã ã—ã€ã‚µãƒ¼ãƒ“ã‚¹ã‚’ä»‹ã—ã¦å…¬é–‹ã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ã€‚ã‚µãƒ¼ãƒ“ã‚¹ã«ã¯IPã‚¢ãƒ‰ãƒ¬ã‚¹ã‚‚ã‚ã‚Šã€ãã®ç›®çš„ã¯ãƒãƒƒãƒ‰é–“ã®é€šä¿¡ã‚’ç¶­æŒã™ã‚‹ã“ã¨ã§ã™ã€‚ã—ãŸãŒã£ã¦ã€1ã¤ãŒãƒ€ã‚¦ãƒ³ã—ãŸå ´åˆã€**æ–°ã—ã„ç½®æ›å“**ï¼ˆç•°ãªã‚‹å†…éƒ¨IPã‚’æŒã¤ï¼‰ã¯ã€**ã‚µãƒ¼ãƒ“ã‚¹ã®åŒã˜IPã§ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½**ã«å…¬é–‹ã•ã‚Œã¾ã™ã€‚å†…éƒ¨ã¾ãŸã¯å¤–éƒ¨ã¨ã—ã¦æ§‹æˆã§ãã¾ã™ã€‚ã‚µãƒ¼ãƒ“ã‚¹ã¯ã€2ã¤ã®ãƒãƒƒãƒ‰ãŒåŒã˜ã‚µãƒ¼ãƒ“ã‚¹ã«æ¥ç¶šã•ã‚Œã¦ã„ã‚‹å ´åˆã€**ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µãƒ¼ã¨ã—ã¦æ©Ÿèƒ½**ã—ã¾ã™ã€‚\
**ã‚µãƒ¼ãƒ“ã‚¹**ãŒ**ä½œæˆ**ã•ã‚Œã‚‹ã¨ã€å„ã‚µãƒ¼ãƒ“ã‚¹ã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’è¦‹ã¤ã‘ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚`kubectl get endpoints`ã‚’å®Ÿè¡Œã—ã¦å®Ÿè¡Œä¸­ã®å„ã‚µãƒ¼ãƒ“ã‚¹ã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’è¦‹ã¤ã‘ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
* **Kubelet**: ãƒ—ãƒ©ã‚¤ãƒãƒªãƒãƒ¼ãƒ‰ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã€‚ãƒãƒ¼ãƒ‰ã¨kubectlã®é–“ã®é€šä¿¡ã‚’ç¢ºç«‹ã™ã‚‹ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§ã‚ã‚Šã€ãƒãƒƒãƒ‰ã®ã¿ã‚’å®Ÿè¡Œã§ãã¾ã™ï¼ˆAPIã‚µãƒ¼ãƒãƒ¼ã‚’ä»‹ã—ã¦ï¼‰ã€‚kubeletã¯ã€Kubernetesã«ã‚ˆã£ã¦ä½œæˆã•ã‚Œã¦ã„ãªã„ã‚³ãƒ³ãƒ†ãƒŠã‚’ç®¡ç†ã—ã¾ã›ã‚“ã€‚
* **Kube-proxy**: apiserverã¨ãƒãƒ¼ãƒ‰é–“ã®é€šä¿¡ï¼ˆã‚µãƒ¼ãƒ“ã‚¹ï¼‰ã‚’æ‹…å½“ã™ã‚‹ã‚µãƒ¼ãƒ“ã‚¹ã§ã™ã€‚ãƒ™ãƒ¼ã‚¹ã¯ãƒãƒ¼ãƒ‰ç”¨ã®IPtablesã§ã™ã€‚çµŒé¨“è±Šå¯Œãªãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ã€ä»–ã®ãƒ™ãƒ³ãƒ€ãƒ¼ã‹ã‚‰ã®ä»–ã®kube-proxyã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
* **ã‚µã‚¤ãƒ‰ã‚«ãƒ¼ã‚³ãƒ³ãƒ†ãƒŠ**: ã‚µã‚¤ãƒ‰ã‚«ãƒ¼ã‚³ãƒ³ãƒ†ãƒŠã¯ã€ãƒãƒƒãƒ‰å†…ã®ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒŠã¨ä¸€ç·’ã«å®Ÿè¡Œã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã‚³ãƒ³ãƒ†ãƒŠã§ã™ã€‚ã“ã®ã‚µã‚¤ãƒ‰ã‚«ãƒ¼ãƒ‘ã‚¿ãƒ¼ãƒ³ã¯ã€ç¾åœ¨ã®ã‚³ãƒ³ãƒ†ãƒŠã®æ©Ÿèƒ½ã‚’æ‹¡å¼µãŠã‚ˆã³å¼·åŒ–ã—ã¾ã™ãŒã€ãã‚Œã‚‰ã‚’å¤‰æ›´ã—ã¾ã›ã‚“ã€‚ç¾åœ¨ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒã©ã“ã§ã‚‚å®Ÿè¡Œã•ã‚Œã‚‹ã‚ˆã†ã«ã™ã‚‹ãŸã‚ã«ã€ã‚³ãƒ³ãƒ†ãƒŠæŠ€è¡“ã‚’ä½¿ç”¨ã—ã¦ã™ã¹ã¦ã®ä¾å­˜é–¢ä¿‚ã‚’ãƒ©ãƒƒãƒ—ã™ã‚‹ã“ã¨ã‚’çŸ¥ã£ã¦ã„ã¾ã™ã€‚ã‚³ãƒ³ãƒ†ãƒŠã¯1ã¤ã®ã“ã¨ã ã‘ã‚’è¡Œã„ã€ãã®ã“ã¨ã‚’éå¸¸ã«ã‚ˆãè¡Œã„ã¾ã™ã€‚
* **ãƒã‚¹ã‚¿ãƒ¼ãƒ—ãƒ­ã‚»ã‚¹:**
* **APIã‚µãƒ¼ãƒãƒ¼:** ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¨ãƒãƒƒãƒ‰ãŒãƒã‚¹ã‚¿ãƒ¼ãƒ—ãƒ­ã‚»ã‚¹ã¨é€šä¿¡ã™ã‚‹æ–¹æ³•ã§ã™ã€‚èªè¨¼ã•ã‚ŒãŸãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ã¿ãŒè¨±å¯ã•ã‚Œã‚‹ã¹ãã§ã™ã€‚
* **ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©**: ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒªãƒ³ã‚°ã¯ã€KubeletãŒãã‚Œã‚‰ã‚’å®Ÿè¡Œã§ãã‚‹ã‚ˆã†ã«ã€PodãŒãƒãƒ¼ãƒ‰ã«ä¸€è‡´ã™ã‚‹ã‚ˆã†ã«ã™ã‚‹ã“ã¨ã‚’æŒ‡ã—ã¾ã™ã€‚ã©ã®ãƒãƒ¼ãƒ‰ã«ã‚ˆã‚Šå¤šãã®åˆ©ç”¨å¯èƒ½ãƒªã‚½ãƒ¼ã‚¹ãŒã‚ã‚‹ã‹ã‚’åˆ¤æ–­ã—ã€æ–°ã—ã„ãƒãƒƒãƒ‰ã‚’ãã®ãƒãƒ¼ãƒ‰ã«å‰²ã‚Šå½“ã¦ã‚‹ãŸã‚ã®ååˆ†ãªçŸ¥èƒ½ã‚’æŒã£ã¦ã„ã¾ã™ã€‚ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©ã¯æ–°ã—ã„ãƒãƒƒãƒ‰ã‚’é–‹å§‹ã™ã‚‹ã®ã§ã¯ãªãã€æ–°ã—ã„ãƒãƒƒãƒ‰ã‚’èµ·å‹•ã™ã‚‹ãƒãƒ¼ãƒ‰å†…ã§å®Ÿè¡Œã•ã‚Œã¦ã„ã‚‹Kubeletãƒ—ãƒ­ã‚»ã‚¹ã¨é€šä¿¡ã—ã¾ã™ã€‚
* **Kube Controller Manager**: ãƒ¬ãƒ—ãƒªã‚«ã‚»ãƒƒãƒˆã‚„ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆãªã©ã®ãƒªã‚½ãƒ¼ã‚¹ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ã€ä¾‹ãˆã°ã€æ­£ã—ã„æ•°ã®ãƒãƒƒãƒ‰ã‚„ãƒãƒ¼ãƒ‰ãŒå®Ÿè¡Œã•ã‚Œã¦ã„ã‚‹ã‹ã©ã†ã‹ã‚’ç¢ºèªã—ã¾ã™ã€‚ãƒãƒƒãƒ‰ãŒä¸è¶³ã—ã¦ã„ã‚‹å ´åˆã€æ–°ã—ã„ãƒãƒƒãƒ‰ã‚’èµ·å‹•ã™ã‚‹ãŸã‚ã«ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©ã¨é€šä¿¡ã—ã¾ã™ã€‚APIã¸ã®ãƒ¬ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã€ãƒˆãƒ¼ã‚¯ãƒ³ã€ãŠã‚ˆã³ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚µãƒ¼ãƒ“ã‚¹ã‚’åˆ¶å¾¡ã—ã¾ã™ã€‚
* **etcd**: ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã€æ°¸ç¶šçš„ã§ä¸€è²«æ€§ãŒã‚ã‚Šã€åˆ†æ•£ã•ã‚Œã¦ã„ã¾ã™ã€‚Kubernetesã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã§ã‚ã‚Šã€ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã®å®Œå…¨ãªçŠ¶æ…‹ã‚’ä¿æŒã™ã‚‹ã‚­ãƒ¼å€¤ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã§ã™ï¼ˆå„å¤‰æ›´ã¯ã“ã“ã«è¨˜éŒ²ã•ã‚Œã¾ã™ï¼‰ã€‚ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©ã‚„ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ãªã©ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¯ã€å¤‰æ›´ãŒç™ºç”Ÿã—ãŸã“ã¨ã‚’çŸ¥ã‚‹ãŸã‚ã«ã“ã®ãƒ‡ãƒ¼ã‚¿ã«ä¾å­˜ã—ã¾ã™ï¼ˆãƒãƒ¼ãƒ‰ã®åˆ©ç”¨å¯èƒ½ãªãƒªã‚½ãƒ¼ã‚¹ã€å®Ÿè¡Œä¸­ã®ãƒãƒƒãƒ‰ã®æ•°ãªã©ï¼‰ã€‚ 
* **Cloud Controller Manager**: AWSã‚„OpenStackãªã©ã®ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ãŒã‚ã‚‹å ´åˆã€ãƒ•ãƒ­ãƒ¼åˆ¶å¾¡ã¨ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ãŸã‚ã®ç‰¹å®šã®ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã§ã™ã€‚

è¤‡æ•°ã®ãƒãƒ¼ãƒ‰ï¼ˆè¤‡æ•°ã®ãƒãƒƒãƒ‰ã‚’å®Ÿè¡Œã—ã¦ã„ã‚‹ãƒãƒ¼ãƒ‰ï¼‰ãŒã‚ã‚‹ãŸã‚ã€è¤‡æ•°ã®ãƒã‚¹ã‚¿ãƒ¼ãƒ—ãƒ­ã‚»ã‚¹ãŒã‚ã‚Šã€ãã‚Œã‚‰ã®Apiã‚µãƒ¼ãƒãƒ¼ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ãŒè² è·åˆ†æ•£ã•ã‚Œã€ãã‚Œã‚‰ã®etcdãŒåŒæœŸã•ã‚Œã¦ã„ã‚‹ã“ã¨ã«æ³¨æ„ã—ã¦ãã ã•ã„ã€‚

**ãƒœãƒªãƒ¥ãƒ¼ãƒ :**

ãƒãƒƒãƒ‰ãŒæ¶ˆãˆã¦ã‚‚å¤±ã‚ã‚Œã¦ã¯ãªã‚‰ãªã„ãƒ‡ãƒ¼ã‚¿ã‚’ä½œæˆã™ã‚‹å ´åˆã€ç‰©ç†ãƒœãƒªãƒ¥ãƒ¼ãƒ ã«ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚**Kubernetesã¯ãƒãƒƒãƒ‰ã«ãƒœãƒªãƒ¥ãƒ¼ãƒ ã‚’ã‚¢ã‚¿ãƒƒãƒã—ã¦ãƒ‡ãƒ¼ã‚¿ã‚’æ°¸ç¶šåŒ–ã™ã‚‹ã“ã¨ã‚’å¯èƒ½ã«ã—ã¾ã™**ã€‚ãƒœãƒªãƒ¥ãƒ¼ãƒ ã¯ãƒ­ãƒ¼ã‚«ãƒ«ãƒã‚·ãƒ³ã¾ãŸã¯**ãƒªãƒ¢ãƒ¼ãƒˆã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸**ã«ã‚ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ç•°ãªã‚‹ç‰©ç†ãƒãƒ¼ãƒ‰ã§ãƒãƒƒãƒ‰ã‚’å®Ÿè¡Œã—ã¦ã„ã‚‹å ´åˆã¯ã€ã™ã¹ã¦ã®ãƒãƒƒãƒ‰ãŒã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ã‚ˆã†ã«ãƒªãƒ¢ãƒ¼ãƒˆã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚’ä½¿ç”¨ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

**ãã®ä»–ã®æ§‹æˆ:**

* **ConfigMap**: ã‚µãƒ¼ãƒ“ã‚¹ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ãŸã‚ã®**URL**ã‚’æ§‹æˆã§ãã¾ã™ã€‚ãƒãƒƒãƒ‰ã¯ã“ã“ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ã¦ã€ä»–ã®ã‚µãƒ¼ãƒ“ã‚¹ï¼ˆãƒãƒƒãƒ‰ï¼‰ã¨ã®é€šä¿¡æ–¹æ³•ã‚’çŸ¥ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ã“ã‚Œã¯è³‡æ ¼æƒ…å ±ã‚’ä¿å­˜ã™ã‚‹ãŸã‚ã®æ¨å¥¨ã•ã‚Œãªã„å ´æ‰€ã§ã‚ã‚‹ã“ã¨ã«æ³¨æ„ã—ã¦ãã ã•ã„ï¼
* **Secret**: ã“ã‚Œã¯ã€ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã€APIã‚­ãƒ¼ãªã©ã®ç§˜å¯†ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜ã™ã‚‹å ´æ‰€ã§ã™ã€‚B64ã§ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã•ã‚Œã¦ã„ã¾ã™ã€‚ãƒãƒƒãƒ‰ã¯å¿…è¦ãªè³‡æ ¼æƒ…å ±ã‚’ä½¿ç”¨ã™ã‚‹ãŸã‚ã«ã“ã®ãƒ‡ãƒ¼ã‚¿ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã™ã€‚
* **Deployments**: Kubernetesã«ã‚ˆã£ã¦å®Ÿè¡Œã•ã‚Œã‚‹ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒæŒ‡å®šã•ã‚Œã‚‹å ´æ‰€ã§ã™ã€‚é€šå¸¸ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ç›´æ¥ãƒãƒƒãƒ‰ã¨ä½œæ¥­ã—ã¾ã›ã‚“ã€‚ãƒãƒƒãƒ‰ã¯**ReplicaSets**ï¼ˆè¤‡è£½ã•ã‚ŒãŸåŒã˜ãƒãƒƒãƒ‰ã®æ•°ï¼‰ã§æŠ½è±¡åŒ–ã•ã‚Œã€ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆã‚’ä»‹ã—ã¦å®Ÿè¡Œã•ã‚Œã¾ã™ã€‚ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆã¯**ã‚¹ãƒ†ãƒ¼ãƒˆãƒ¬ã‚¹**ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å‘ã‘ã§ã™ã€‚ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆã®æœ€å°æ§‹æˆã¯ã€åå‰ã¨å®Ÿè¡Œã™ã‚‹ã‚¤ãƒ¡ãƒ¼ã‚¸ã§ã™ã€‚
* **StatefulSet**: ã“ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¯ã€**åŒã˜ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹å¿…è¦ãŒã‚ã‚‹**ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãªã©ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å‘ã‘ã«ç‰¹ã«ä½œæˆã•ã‚Œã¦ã„ã¾ã™ã€‚
* **Ingress**: ã“ã‚Œã¯ã€**URLã§ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å…¬é–‹ã™ã‚‹**æ§‹æˆã§ã™ã€‚å¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹ã‚’ä½¿ç”¨ã—ã¦ã‚‚åŒæ§˜ã®ã“ã¨ãŒã§ãã¾ã™ãŒã€ã“ã‚ŒãŒã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å…¬é–‹ã™ã‚‹æ­£ã—ã„æ–¹æ³•ã§ã™ã€‚
* Ingressã‚’å®Ÿè£…ã™ã‚‹å ´åˆã¯ã€**Ingress Controllers**ã‚’ä½œæˆã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚Ingress Controllerã¯ã€ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å—ä¿¡ã—ã€ãƒã‚§ãƒƒã‚¯ã—ã¦ã‚µãƒ¼ãƒ“ã‚¹ã«ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚¹ã™ã‚‹**ãƒãƒƒãƒ‰**ã§ã™ã€‚Ingress Controllerã¯ã€æ§‹æˆã•ã‚ŒãŸIngressãƒ«ãƒ¼ãƒ«ã«åŸºã¥ã„ã¦ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’**é€ä¿¡**ã—ã¾ã™ã€‚Ingressãƒ«ãƒ¼ãƒ«ã¯ã€ç•°ãªã‚‹ãƒ‘ã‚¹ã‚„ã•ã‚‰ã«ã¯ç•°ãªã‚‹å†…éƒ¨Kubernetesã‚µãƒ¼ãƒ“ã‚¹ã¸ã®ã‚µãƒ–ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’æŒ‡ã™ã“ã¨ãŒã§ãã¾ã™ã€‚
* ã‚ˆã‚Šè‰¯ã„ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ…£è¡Œã¯ã€Kubernetesã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã®ä¸€éƒ¨ã‚’å…¬é–‹ã—ãªã„ã‚ˆã†ã«ã€ã‚¯ãƒ©ã‚¦ãƒ‰ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µãƒ¼ã‚„ãƒ—ãƒ­ã‚­ã‚·ã‚µãƒ¼ãƒãƒ¼ã‚’ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆã¨ã—ã¦ä½¿ç”¨ã™ã‚‹ã“ã¨ã§ã™ã€‚
* Ingressãƒ«ãƒ¼ãƒ«ã«ä¸€è‡´ã—ãªã„ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒå—ä¿¡ã•ã‚ŒãŸå ´åˆã€Ingress Controllerã¯ã€Œ**ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰**ã€ã«ãã‚Œã‚’ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã—ã¾ã™ã€‚ã“ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å–å¾—ã™ã‚‹ã«ã¯ã€Ingress Controllerã‚’`describe`ã§ãã¾ã™ã€‚
* `minikube addons enable ingress`
### PKIã‚¤ãƒ³ãƒ•ãƒ©ã‚¹ãƒˆãƒ©ã‚¯ãƒãƒ£ - è¨¼æ˜æ›¸æ©Ÿé–¢CA:

![](https://sickrov.github.io/media/Screenshot-66.jpg)

* CAã¯ã‚¯ãƒ©ã‚¹ã‚¿å†…ã®ã™ã¹ã¦ã®è¨¼æ˜æ›¸ã®ä¿¡é ¼ã•ã‚Œã‚‹ãƒ«ãƒ¼ãƒˆã§ã™ã€‚
* ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒãŠäº’ã„ã‚’æ¤œè¨¼ã§ãã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚
* ã™ã¹ã¦ã®ã‚¯ãƒ©ã‚¹ã‚¿è¨¼æ˜æ›¸ã¯CAã«ã‚ˆã£ã¦ç½²åã•ã‚Œã¦ã„ã¾ã™ã€‚
* ETCdã«ã¯ç‹¬è‡ªã®è¨¼æ˜æ›¸ãŒã‚ã‚Šã¾ã™ã€‚
* ã‚¿ã‚¤ãƒ—:
  * apiserverè¨¼æ˜æ›¸ã€‚
  * kubeletè¨¼æ˜æ›¸ã€‚
  * schedulerè¨¼æ˜æ›¸ã€‚

## åŸºæœ¬çš„ãªã‚¢ã‚¯ã‚·ãƒ§ãƒ³

### Minikube

**Minikube**ã¯ã€å®Œå…¨ãªkubernetesç’°å¢ƒã‚’å±•é–‹ã™ã‚‹å¿…è¦ãªã—ã«ã€kubernetesã§ã„ãã¤ã‹ã®**ã‚¯ã‚¤ãƒƒã‚¯ãƒ†ã‚¹ãƒˆ**ã‚’å®Ÿè¡Œã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã§ãã¾ã™ã€‚**ãƒã‚¹ã‚¿ãƒ¼ã¨ãƒãƒ¼ãƒ‰ãƒ—ãƒ­ã‚»ã‚¹ã‚’1ã¤ã®ãƒã‚·ãƒ³ã§å®Ÿè¡Œ**ã—ã¾ã™ã€‚Minikubeã¯ã€ãƒãƒ¼ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ãŸã‚ã«virtualboxã‚’ä½¿ç”¨ã—ã¾ã™ã€‚[**ã“ã¡ã‚‰ã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ–¹æ³•ã‚’ç¢ºèªã—ã¦ãã ã•ã„**](https://minikube.sigs.k8s.io/docs/start/)ã€‚
```
$ minikube start
ğŸ˜„  minikube v1.19.0 on Ubuntu 20.04
âœ¨  Automatically selected the virtualbox driver. Other choices: none, ssh
ğŸ’¿  Downloading VM boot image ...
> minikube-v1.19.0.iso.sha256: 65 B / 65 B [-------------] 100.00% ? p/s 0s
> minikube-v1.19.0.iso: 244.49 MiB / 244.49 MiB  100.00% 1.78 MiB p/s 2m17.
ğŸ‘  Starting control plane node minikube in cluster minikube
ğŸ’¾  Downloading Kubernetes v1.20.2 preload ...
> preloaded-images-k8s-v10-v1...: 491.71 MiB / 491.71 MiB  100.00% 2.59 MiB
ğŸ”¥  Creating virtualbox VM (CPUs=2, Memory=3900MB, Disk=20000MB) ...
ğŸ³  Preparing Kubernetes v1.20.2 on Docker 20.10.4 ...
â–ª Generating certificates and keys ...
â–ª Booting up control plane ...
â–ª Configuring RBAC rules ...
ğŸ”  Verifying Kubernetes components...
â–ª Using image gcr.io/k8s-minikube/storage-provisioner:v5
ğŸŒŸ  Enabled addons: storage-provisioner, default-storageclass
ğŸ„  Done! kubectl is now configured to use "minikube" cluster and "default" namespace by defaul

$ minikube status
host: Running
kubelet: Running
apiserver: Running
kubeconfig: Configured

---- ONCE YOU HAVE A K8 SERVICE RUNNING WITH AN EXTERNAL SERVICE -----
$ minikube service mongo-express-service
(This will open your browser to access the service exposed port)

$ minikube delete
ğŸ”¥  Deleting "minikube" in virtualbox ...
ğŸ’€  Removed all traces of the "minikube" cluster
```
### Kubectlã®åŸºæœ¬

**`Kubectl`**ã¯ã€kubernetesã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ç”¨ã®ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚ã“ã‚Œã¯ã€kubernetesã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œã—ãŸã‚Šãƒ‡ãƒ¼ã‚¿ã‚’è¦æ±‚ã™ã‚‹ãŸã‚ã«ã€ãƒã‚¹ã‚¿ãƒ¼ãƒ—ãƒ­ã‚»ã‚¹ã®Apiã‚µãƒ¼ãƒãƒ¼ã¨é€šä¿¡ã—ã¾ã™ã€‚
```bash
kubectl version #Get client and server version
kubectl get pod
kubectl get services
kubectl get deployment
kubectl get replicaset
kubectl get secret
kubectl get all
kubectl get ingress
kubectl get endpoints

#kubectl create deployment <deployment-name> --image=<docker image>
kubectl create deployment nginx-deployment --image=nginx
#Access the configuration of the deployment and modify it
#kubectl edit deployment <deployment-name>
kubectl edit deployment nginx-deployment
#Get the logs of the pod for debbugging (the output of the docker container running)
#kubectl logs <replicaset-id/pod-id>
kubectl logs nginx-deployment-84cd76b964
#kubectl describe pod <pod-id>
kubectl describe pod mongo-depl-5fd6b7d4b4-kkt9q
#kubectl exec -it <pod-id> -- bash
kubectl exec -it mongo-depl-5fd6b7d4b4-kkt9q -- bash
#kubectl describe service <service-name>
kubectl describe service mongodb-service
#kubectl delete deployment <deployment-name>
kubectl delete deployment mongo-depl
#Deploy from config file
kubectl apply -f deployment.yml
```
### Minikube ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰

ã“ã®ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã‚’ä½¿ç”¨ã™ã‚‹ã¨ã€Minikube ãŒå®Ÿè¡Œã—ã¦ã„ã‚‹å†…å®¹ã‚’ã‚ˆã‚Šç°¡å˜ã«ç¢ºèªã§ãã¾ã™ã€‚ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ãŸã‚ã® URL ã¯ä»¥ä¸‹ã§è¦‹ã¤ã‘ã‚‹ã“ã¨ãŒã§ãã¾ã™ï¼š
```
minikube dashboard --url


ğŸ”Œ  Enabling dashboard ...
â–ª Using image kubernetesui/dashboard:v2.3.1
â–ª Using image kubernetesui/metrics-scraper:v1.0.7
ğŸ¤”  Verifying dashboard health ...
ğŸš€  Launching proxy ...
ğŸ¤”  Verifying proxy health ...
http://127.0.0.1:50034/api/v1/namespaces/kubernetes-dashboard/services/http:kubernetes-dashboard:/proxy/
```
### YAMLæ§‹æˆãƒ•ã‚¡ã‚¤ãƒ«ã®ä¾‹

å„æ§‹æˆãƒ•ã‚¡ã‚¤ãƒ«ã«ã¯3ã¤ã®éƒ¨åˆ†ãŒã‚ã‚Šã¾ã™: **metadata**ã€**specification** (èµ·å‹•ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã‚‚ã®)ã€**status** (æœ›ã¾ã—ã„çŠ¶æ…‹)ã€‚\
ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆæ§‹æˆãƒ•ã‚¡ã‚¤ãƒ«ã®ä»•æ§˜ã®ä¸­ã§ã€å®Ÿè¡Œã™ã‚‹ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’å®šç¾©ã™ã‚‹æ–°ã—ã„æ§‹æˆæ§‹é€ ã§å®šç¾©ã•ã‚ŒãŸãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãŒè¦‹ã¤ã‹ã‚Šã¾ã™:

**åŒã˜æ§‹æˆãƒ•ã‚¡ã‚¤ãƒ«ã§å®£è¨€ã•ã‚ŒãŸDeployment + Serviceã®ä¾‹ (from** [**here**](https://gitlab.com/nanuchi/youtube-tutorial-series/-/blob/master/demo-kubernetes-components/mongo.yaml)**)**

ã‚µãƒ¼ãƒ“ã‚¹ã¯é€šå¸¸ã€1ã¤ã®ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆã«é–¢é€£ã—ã¦ã„ã‚‹ãŸã‚ã€åŒã˜æ§‹æˆãƒ•ã‚¡ã‚¤ãƒ«ã§ä¸¡æ–¹ã‚’å®£è¨€ã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ (ã“ã®æ§‹æˆã§å®£è¨€ã•ã‚ŒãŸã‚µãƒ¼ãƒ“ã‚¹ã¯å†…éƒ¨ã‹ã‚‰ã®ã¿ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ã§ã™):
```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
name: mongodb-deployment
labels:
app: mongodb
spec:
replicas: 1
selector:
matchLabels:
app: mongodb
template:
metadata:
labels:
app: mongodb
spec:
containers:
- name: mongodb
image: mongo
ports:
- containerPort: 27017
env:
- name: MONGO_INITDB_ROOT_USERNAME
valueFrom:
secretKeyRef:
name: mongodb-secret
key: mongo-root-username
- name: MONGO_INITDB_ROOT_PASSWORD
valueFrom:
secretKeyRef:
name: mongodb-secret
key: mongo-root-password
---
apiVersion: v1
kind: Service
metadata:
name: mongodb-service
spec:
selector:
app: mongodb
ports:
- protocol: TCP
port: 27017
targetPort: 27017
```
**å¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹æ§‹æˆã®ä¾‹**

ã“ã®ã‚µãƒ¼ãƒ“ã‚¹ã¯å¤–éƒ¨ã‹ã‚‰ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ã«ãªã‚Šã¾ã™ï¼ˆ`nodePort`ã¨`type: LoadBalancer`å±æ€§ã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼‰:
```yaml
---
apiVersion: v1
kind: Service
metadata:
name: mongo-express-service
spec:
selector:
app: mongo-express
type: LoadBalancer
ports:
- protocol: TCP
port: 8081
targetPort: 8081
nodePort: 30000
```
{% hint style="info" %}
ã“ã‚Œã¯ãƒ†ã‚¹ãƒˆã«ã¯ä¾¿åˆ©ã§ã™ãŒã€æœ¬ç•ªç”¨ã«ã¯å†…éƒ¨ã‚µãƒ¼ãƒ“ã‚¹ã®ã¿ã¨ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å…¬é–‹ã™ã‚‹ãŸã‚ã®IngressãŒå¿…è¦ã§ã™ã€‚
{% endhint %}

**Ingressæ§‹æˆãƒ•ã‚¡ã‚¤ãƒ«ã®ä¾‹**

ã“ã‚Œã«ã‚ˆã‚Šã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒ `http://dashboard.com` ã§å…¬é–‹ã•ã‚Œã¾ã™ã€‚
```yaml
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
name: dashboard-ingress
namespace: kubernetes-dashboard
spec:
rules:
- host: dashboard.com
http:
paths:
- backend:
serviceName: kubernetes-dashboard
servicePort: 80
```
**ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆæ§‹æˆãƒ•ã‚¡ã‚¤ãƒ«ã®ä¾‹**

ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒB64ã§ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã•ã‚Œã¦ã„ã‚‹ç‚¹ã«æ³¨æ„ã—ã¦ãã ã•ã„ï¼ˆã“ã‚Œã¯å®‰å…¨ã§ã¯ã‚ã‚Šã¾ã›ã‚“ï¼ï¼‰
```yaml
apiVersion: v1
kind: Secret
metadata:
name: mongodb-secret
type: Opaque
data:
mongo-root-username: dXNlcm5hbWU=
mongo-root-password: cGFzc3dvcmQ=
```
**ConfigMap ã®ä¾‹**

**ConfigMap** ã¯ã€ãƒãƒƒãƒ‰ã«ä¸ãˆã‚‰ã‚Œã‚‹æ§‹æˆã§ã‚ã‚Šã€ä»–ã®ã‚µãƒ¼ãƒ“ã‚¹ã®å ´æ‰€ã‚’ç‰¹å®šã—ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹æ–¹æ³•ã‚’çŸ¥ã£ã¦ã„ã¾ã™ã€‚ã“ã®å ´åˆã€å„ãƒãƒƒãƒ‰ã¯ã€`mongodb-service` ã¨ã„ã†åå‰ãŒã€é€šä¿¡ã§ãã‚‹ãƒãƒƒãƒ‰ã®ã‚¢ãƒ‰ãƒ¬ã‚¹ã§ã‚ã‚‹ã“ã¨ã‚’çŸ¥ã£ã¦ã„ã¾ã™ï¼ˆã“ã®ãƒãƒƒãƒ‰ã¯ mongodb ã‚’å®Ÿè¡Œã—ã¦ã„ã¾ã™ï¼‰:
```yaml
apiVersion: v1
kind: ConfigMap
metadata:
name: mongodb-configmap
data:
database_url: mongodb-service
```
ãã®å¾Œã€**ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆæ§‹æˆ**å†…ã§ã€ã“ã®ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’ä»¥ä¸‹ã®ã‚ˆã†ã«æŒ‡å®šã™ã‚‹ã“ã¨ã§ã€ãƒãƒƒãƒ‰ã®ç’°å¢ƒå¤‰æ•°å†…ã«èª­ã¿è¾¼ã¾ã‚Œã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™:
```yaml
[...]
spec:
[...]
template:
[...]
spec:
containers:
- name: mongo-express
image: mongo-express
ports:
- containerPort: 8081
env:
- name: ME_CONFIG_MONGODB_SERVER
valueFrom:
configMapKeyRef:
name: mongodb-configmap
key: database_url
[...]
```
**ãƒœãƒªãƒ¥ãƒ¼ãƒ æ§‹æˆã®ä¾‹**

[https://gitlab.com/nanuchi/youtube-tutorial-series/-/tree/master/kubernetes-volumes](https://gitlab.com/nanuchi/youtube-tutorial-series/-/tree/master/kubernetes-volumes) ã«ã€ç•°ãªã‚‹ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸æ§‹æˆã®YAMLãƒ•ã‚¡ã‚¤ãƒ«ã®ä¾‹ãŒã‚ã‚Šã¾ã™ã€‚\
**ãƒœãƒªãƒ¥ãƒ¼ãƒ ã¯ãƒãƒ¼ãƒ ã‚¹ãƒšãƒ¼ã‚¹å†…ã«å­˜åœ¨ã—ãªã„ã“ã¨ã«æ³¨æ„ã—ã¦ãã ã•ã„**

### ãƒãƒ¼ãƒ ã‚¹ãƒšãƒ¼ã‚¹

Kubernetesã¯ã€åŒã˜ç‰©ç†ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã§ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã•ã‚ŒãŸ**è¤‡æ•°ã®ä»®æƒ³ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼**ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã¾ã™ã€‚ã“ã‚Œã‚‰ã®ä»®æƒ³ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã¯**ãƒãƒ¼ãƒ ã‚¹ãƒšãƒ¼ã‚¹**ã¨å‘¼ã°ã‚Œã¾ã™ã€‚ã“ã‚Œã‚‰ã¯ã€å¤šãã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè¤‡æ•°ã®ãƒãƒ¼ãƒ ã‚„ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«ã¾ãŸãŒã£ã¦åˆ†æ•£ã—ã¦ã„ã‚‹ç’°å¢ƒã§ä½¿ç”¨ã™ã‚‹ã“ã¨ã‚’æ„å›³ã—ã¦ã„ã¾ã™ã€‚æ•°äººã‹ã‚‰æ•°åäººã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã„ã‚‹ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã§ã¯ã€ãƒãƒ¼ãƒ ã‚¹ãƒšãƒ¼ã‚¹ã‚’ä½œæˆã—ãŸã‚Šè€ƒãˆãŸã‚Šã™ã‚‹å¿…è¦ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚Kubernetesã«ãƒ‡ãƒ—ãƒ­ã‚¤ã•ã‚ŒãŸã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®å„éƒ¨åˆ†ã‚’ã‚ˆã‚Šã‚ˆãåˆ¶å¾¡ã—ã€æ•´ç†ã™ã‚‹ãŸã‚ã«ãƒãƒ¼ãƒ ã‚¹ãƒšãƒ¼ã‚¹ã‚’ä½¿ç”¨ã™ã‚‹ã¹ãã§ã™ã€‚

ãƒãƒ¼ãƒ ã‚¹ãƒšãƒ¼ã‚¹ã¯åå‰ã®ã‚¹ã‚³ãƒ¼ãƒ—ã‚’æä¾›ã—ã¾ã™ã€‚ãƒªã‚½ãƒ¼ã‚¹ã®åå‰ã¯ãƒãƒ¼ãƒ ã‚¹ãƒšãƒ¼ã‚¹å†…ã§ä¸€æ„ã§ã‚ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ãŒã€ãƒãƒ¼ãƒ ã‚¹ãƒšãƒ¼ã‚¹é–“ã§ã¯ä¸€æ„ã§ã‚ã‚‹å¿…è¦ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚ãƒãƒ¼ãƒ ã‚¹ãƒšãƒ¼ã‚¹ã¯äº’ã„ã«å…¥ã‚Œå­ã«ã™ã‚‹ã“ã¨ã¯ã§ããšã€**å„**Kubernetes**ãƒªã‚½ãƒ¼ã‚¹**ã¯**1ã¤ã®ãƒãƒ¼ãƒ ã‚¹ãƒšãƒ¼ã‚¹**ã«ã®ã¿å­˜åœ¨ã§ãã¾ã™ã€‚

minikubeã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹å ´åˆã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§4ã¤ã®ãƒãƒ¼ãƒ ã‚¹ãƒšãƒ¼ã‚¹ãŒã‚ã‚Šã¾ã™ã€‚
```
kubectl get namespace
NAME              STATUS   AGE
default           Active   1d
kube-node-lease   Active   1d
kube-public       Active   1d
kube-system       Active   1d
```
* **kube-system**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒä½¿ç”¨ã™ã‚‹ãŸã‚ã§ã¯ãªãã€è§¦ã‚Œã¦ã¯ã„ã‘ãªã„ã‚‚ã®ã§ã™ã€‚ãƒã‚¹ã‚¿ãƒ¼ã¨kubectlãƒ—ãƒ­ã‚»ã‚¹ç”¨ã§ã™ã€‚
* **kube-public**: å…¬é–‹ã•ã‚Œã¦ã„ã‚‹ãƒ‡ãƒ¼ã‚¿ã€‚ã‚¯ãƒ©ã‚¹ã‚¿æƒ…å ±ã‚’å«ã‚€configmapãŒå«ã¾ã‚Œã¦ã„ã¾ã™ã€‚
* **kube-node-lease**: ãƒãƒ¼ãƒ‰ã®å¯ç”¨æ€§ã‚’æ±ºå®šã—ã¾ã™ã€‚
* **default**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒãƒªã‚½ãƒ¼ã‚¹ã‚’ä½œæˆã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã™ã‚‹åå‰ç©ºé–“
```bash
#Create namespace
kubectl create namespace my-namespace
```
{% hint style="info" %}
ã»ã¨ã‚“ã©ã®Kubernetesãƒªã‚½ãƒ¼ã‚¹ï¼ˆä¾‹ï¼šãƒãƒƒãƒ‰ã€ã‚µãƒ¼ãƒ“ã‚¹ã€ãƒ¬ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãªã©ï¼‰ã¯ã„ãã¤ã‹ã®åå‰ç©ºé–“ã«ã‚ã‚Šã¾ã™ã€‚ãŸã ã—ã€åå‰ç©ºé–“ãƒªã‚½ãƒ¼ã‚¹ã‚„ãƒãƒ¼ãƒ‰ã€æ°¸ç¶šãƒœãƒªãƒ¥ãƒ¼ãƒ ãªã©ã®ä½ãƒ¬ãƒ™ãƒ«ãƒªã‚½ãƒ¼ã‚¹ãªã©ã€ä»–ã®ãƒªã‚½ãƒ¼ã‚¹ã¯åå‰ç©ºé–“ã«ã‚ã‚Šã¾ã›ã‚“ã€‚ã©ã®Kubernetesãƒªã‚½ãƒ¼ã‚¹ãŒåå‰ç©ºé–“ã«ã‚ã‚‹ã‹ã©ã†ã‹ã‚’ç¢ºèªã™ã‚‹ã«ã¯ã€æ¬¡ã®æ‰‹é †ã‚’å®Ÿè¡Œã—ã¾ã™ï¼š
```bash
kubectl api-resources --namespaced=true #In a namespace
kubectl api-resources --namespaced=false #Not in a namespace
```
{% endhint %}

ãã®ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã§ã®ã™ã¹ã¦ã®å¾Œç¶šã®kubectlã‚³ãƒãƒ³ãƒ‰ã®ãŸã‚ã«ã€åå‰ç©ºé–“ã‚’ä¿å­˜ã§ãã¾ã™ã€‚
```bash
kubectl config set-context --current --namespace=<insert-namespace-name-here>
```
### Helm

Helmã¯Kubernetesã®**ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒãƒãƒ¼ã‚¸ãƒ£**ã§ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€YAMLãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸åŒ–ã—ã¦ã€ãã‚Œã‚‰ã‚’å…¬é–‹ãŠã‚ˆã³ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãƒªãƒã‚¸ãƒˆãƒªã§é…å¸ƒã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ã“ã‚Œã‚‰ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¯**Helm Charts**ã¨å‘¼ã°ã‚Œã¾ã™ã€‚
```
helm search <keyword>
```
## Kubernetesã®ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆ

**ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆ**ã¯ã€ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã€ãƒˆãƒ¼ã‚¯ãƒ³ã€ã¾ãŸã¯ã‚­ãƒ¼ãªã©ã®**æ©Ÿå¯†ãƒ‡ãƒ¼ã‚¿**ã‚’å«ã‚€ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã§ã™ã€‚ã“ã®ã‚ˆã†ãªæƒ…å ±ã¯é€šå¸¸ã€Podã®ä»•æ§˜ã‚„ã‚¤ãƒ¡ãƒ¼ã‚¸ã«é…ç½®ã•ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚’ä½œæˆã§ãã€ã‚·ã‚¹ãƒ†ãƒ ã‚‚ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚’ä½œæˆã—ã¾ã™ã€‚ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®åå‰ã¯æœ‰åŠ¹ãª**DNSã‚µãƒ–ãƒ‰ãƒ¡ã‚¤ãƒ³å**ã§ã‚ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚[å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://kubernetes.io/docs/concepts/configuration/secret/)ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã«ã¯æ¬¡ã®ã‚ˆã†ãªã‚‚ã®ãŒã‚ã‚Šã¾ã™ï¼š

- APIã€SSHã‚­ãƒ¼ã€‚
- OAuthãƒˆãƒ¼ã‚¯ãƒ³ã€‚
- è³‡æ ¼æƒ…å ±ã€ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ï¼ˆå¹³æ–‡ã¾ãŸã¯b64 + æš—å·åŒ–ï¼‰ã€‚
- æƒ…å ±ã‚„ã‚³ãƒ¡ãƒ³ãƒˆã€‚
- ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šã‚³ãƒ¼ãƒ‰ã€æ–‡å­—åˆ—...ã€‚

Kubernetesã«ã¯ç•°ãªã‚‹ã‚¿ã‚¤ãƒ—ã®ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆãŒã‚ã‚Šã¾ã™

| çµ„ã¿è¾¼ã¿ã‚¿ã‚¤ãƒ—                        | ä½¿ç”¨æ³•                                     |
| ----------------------------------- | ----------------------------------------- |
| **Opaque**                          | **ä»»æ„ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼å®šç¾©ãƒ‡ãƒ¼ã‚¿ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰** |
| kubernetes.io/service-account-token | ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãƒˆãƒ¼ã‚¯ãƒ³                     |
| kubernetes.io/dockercfg             | ã‚·ãƒªã‚¢ãƒ«åŒ–ã•ã‚ŒãŸ\~/.dockercfgãƒ•ã‚¡ã‚¤ãƒ«             |
| kubernetes.io/dockerconfigjson      | ã‚·ãƒªã‚¢ãƒ«åŒ–ã•ã‚ŒãŸ\~/.docker/config.jsonãƒ•ã‚¡ã‚¤ãƒ«    |
| kubernetes.io/basic-auth            | åŸºæœ¬èªè¨¼ã®è³‡æ ¼æƒ…å ±      |
| kubernetes.io/ssh-auth              | SSHèªè¨¼ã®è³‡æ ¼æƒ…å ±        |
| kubernetes.io/tls                   | TLSã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¾ãŸã¯ã‚µãƒ¼ãƒãƒ¼ã®ãƒ‡ãƒ¼ã‚¿           |
| bootstrap.kubernetes.io/token       | ãƒ–ãƒ¼ãƒˆã‚¹ãƒˆãƒ©ãƒƒãƒ—ãƒˆãƒ¼ã‚¯ãƒ³ãƒ‡ãƒ¼ã‚¿                      |

{% hint style="info" %}
**Opaqueã‚¿ã‚¤ãƒ—ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã‚ˆã£ã¦å®šç¾©ã•ã‚ŒãŸå…¸å‹çš„ãªã‚­ãƒ¼ã¨å€¤ã®ãƒšã‚¢ã§ã™ã€‚**
{% endhint %}

**ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã®å‹•ä½œæ–¹æ³•ï¼š**

![](https://sickrov.github.io/media/Screenshot-164.jpg)

æ¬¡ã®æ§‹æˆãƒ•ã‚¡ã‚¤ãƒ«ã¯ã€`username: YWRtaW4=`ãŠã‚ˆã³`password: MWYyZDFlMmU2N2Rm`ã®2ã¤ã®ã‚­ãƒ¼ã¨å€¤ã®ãƒšã‚¢ã‚’æŒã¤`mysecret`ã¨ã„ã†**ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆ**ã‚’å®šç¾©ã—ã¦ã„ã¾ã™ã€‚ã¾ãŸã€`mysecret`ã§å®šç¾©ã•ã‚ŒãŸ`username`ã¨`password`ã‚’**ç’°å¢ƒå¤‰æ•°**`SECRET_USERNAME`ãŠã‚ˆã³`SECRET_PASSWOR`ã«å…¬é–‹ã™ã‚‹`secretpod`ã¨ã„ã†**ãƒãƒƒãƒ‰**ã‚’å®šç¾©ã—ã¦ã„ã¾ã™ã€‚ã¾ãŸã€`username`ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚’`/etc/foo/my-group/my-username`ãƒ‘ã‚¹ã«`0640`ã®æ¨©é™ã§**ãƒã‚¦ãƒ³ãƒˆ**ã—ã¾ã™ã€‚

{% code title="secretpod.yaml" %}
```yaml
apiVersion: v1
kind: Secret
metadata:
name: mysecret
type: Opaque
data:
username: YWRtaW4=
password: MWYyZDFlMmU2N2Rm
---
apiVersion: v1
kind: Pod
metadata:
name: secretpod
spec:
containers:
- name: secretpod
image: nginx
env:
- name: SECRET_USERNAME
valueFrom:
secretKeyRef:
name: mysecret
key: username
- name: SECRET_PASSWORD
valueFrom:
secretKeyRef:
name: mysecret
key: password
volumeMounts:
- name: foo
mountPath: "/etc/foo"
restartPolicy: Never
volumes:
- name: foo
secret:
secretName: mysecret
items:
- key: username
path: my-group/my-username
mode: 0640
```
{% endcode %}
```bash
kubectl apply -f <secretpod.yaml>
kubectl get pods #Wait until the pod secretpod is running
kubectl exec -it  secretpod -- bash
env | grep SECRET && cat /etc/foo/my-group/my-username && echo
```
### etcdå†…ã®ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆ <a href="#discover-secrets-in-etcd" id="discover-secrets-in-etcd"></a>

**etcd**ã¯ã€Kubernetesã®ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚¹ãƒˆã‚¢ã¨ã—ã¦ä½¿ç”¨ã•ã‚Œã‚‹ä¸€è²«æ€§ãŒã‚ã‚Šé«˜å¯ç”¨æ€§ã®**ã‚­ãƒ¼ãƒãƒªãƒ¥ãƒ¼ã‚¹ãƒˆã‚¢**ã§ã™ã€‚etcdã«ä¿å­˜ã•ã‚Œã¦ã„ã‚‹ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¾ã—ã‚‡ã†ï¼š
```bash
cat /etc/kubernetes/manifests/kube-apiserver.yaml | grep etcd
```
ä»¥ä¸‹ã¯ã€FS ã«é…ç½®ã•ã‚Œã¦ã„ã‚‹è¨¼æ˜æ›¸ã€ã‚­ãƒ¼ã€ãŠã‚ˆã³ URL ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚ã“ã‚Œã‚‰ã‚’å–å¾—ã™ã‚‹ã¨ã€etcd ã«æ¥ç¶šã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚
```bash
#ETCDCTL_API=3 etcdctl --cert <path to client.crt> --key <path to client.ket> --cacert <path to CA.cert> endpoint=[<ip:port>] health

ETCDCTL_API=3 etcdctl --cert /etc/kubernetes/pki/apiserver-etcd-client.crt --key /etc/kubernetes/pki/apiserver-etcd-client.key --cacert /etc/kubernetes/pki/etcd/etcd/ca.cert endpoint=[127.0.0.1:1234] health
```
ä¸€åº¦ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ç¢ºç«‹ã™ã‚‹ã¨ã€ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚’å–å¾—ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚
```bash
#ETCDCTL_API=3 etcdctl --cert <path to client.crt> --key <path to client.ket> --cacert <path to CA.cert> endpoint=[<ip:port>] get <path/to/secret>

ETCDCTL_API=3 etcdctl --cert /etc/kubernetes/pki/apiserver-etcd-client.crt --key /etc/kubernetes/pki/apiserver-etcd-client.key --cacert /etc/kubernetes/pki/etcd/etcd/ca.cert endpoint=[127.0.0.1:1234] get /registry/secrets/default/secret_02
```
**ETCDã¸ã®æš—å·åŒ–ã®è¿½åŠ **

ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯ã€ã™ã¹ã¦ã®ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã¯etcdå†…éƒ¨ã«å¹³æ–‡ã§ä¿å­˜ã•ã‚Œã¾ã™ãŒã€æš—å·åŒ–ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’é©ç”¨ã—ãªã„é™ã‚Šã§ã™ã€‚æ¬¡ã®ä¾‹ã¯ã€[https://kubernetes.io/docs/tasks/administer-cluster/encrypt-data/](https://kubernetes.io/docs/tasks/administer-cluster/encrypt-data/)ã«åŸºã¥ã„ã¦ã„ã¾ã™ã€‚

{% code title="encryption.yaml" %}
```yaml
apiVersion: apiserver.config.k8s.io/v1
kind: EncryptionConfiguration
resources:
- resources:
- secrets
providers:
- aescbc:
keys:
- name: key1
secret: cjjPMcWpTPKhAdieVtd+KhG4NN+N6e3NmBPMXJvbfrY= #Any random key
- identity: {}
```
{% endcode %}

ãã®å¾Œã€ä½œæˆã—ãŸæ§‹æˆãƒ•ã‚¡ã‚¤ãƒ«ã®å ´æ‰€ã‚’æŒ‡ã™ã‚ˆã†ã«`kube-apiserver`ã®`--encryption-provider-config`ãƒ•ãƒ©ã‚°ã‚’è¨­å®šã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚`/etc/kubernetes/manifest/kube-apiserver.yaml`ã‚’å¤‰æ›´ã—ã€æ¬¡ã®è¡Œã‚’è¿½åŠ ã—ã¾ã™:
```yaml
containers:
- command:
- kube-apiserver
- --encriyption-provider-config=/etc/kubernetes/etcd/<configFile.yaml>
```
volumeMounts ã§ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒ€ã‚¦ãƒ³ã—ã¦ãã ã•ã„ã€‚
```yaml
- mountPath: /etc/kubernetes/etcd
name: etcd
readOnly: true
```
ãƒœãƒªãƒ¥ãƒ¼ãƒ ãƒã‚¦ãƒ³ãƒˆã‚’hostPathã«ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒ€ã‚¦ãƒ³ã—ã¾ã™ï¼š
```yaml
- hostPath:
path: /etc/kubernetes/etcd
type: DirectoryOrCreate
name: etcd
```
**ãƒ‡ãƒ¼ã‚¿ãŒæš—å·åŒ–ã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’æ¤œè¨¼ã™ã‚‹**

ãƒ‡ãƒ¼ã‚¿ã¯etcdã«æ›¸ãè¾¼ã¾ã‚Œã‚‹éš›ã«æš—å·åŒ–ã•ã‚Œã¾ã™ã€‚`kube-apiserver`ã‚’å†èµ·å‹•ã—ãŸå¾Œã€æ–°ã—ãä½œæˆã•ã‚ŒãŸã¾ãŸã¯æ›´æ–°ã•ã‚ŒãŸã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã¯ä¿å­˜ã•ã‚Œã‚‹éš›ã«æš—å·åŒ–ã•ã‚Œã‚‹ã¯ãšã§ã™ã€‚ç¢ºèªã™ã‚‹ãŸã‚ã«ã€`etcdctl`ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’ä½¿ç”¨ã—ã¦ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã®å†…å®¹ã‚’å–å¾—ã§ãã¾ã™ã€‚

1. `default`ãƒãƒ¼ãƒ ã‚¹ãƒšãƒ¼ã‚¹ã«`secret1`ã¨ã„ã†æ–°ã—ã„ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚’ä½œæˆã—ã¾ã™ï¼š

```
kubectl create secret generic secret1 -n default --from-literal=mykey=mydata
```
2. etcdctlã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ã‚’ä½¿ç”¨ã—ã¦ã€etcdã‹ã‚‰ãã®ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚’èª­ã¿å–ã‚Šã¾ã™ï¼š

`ETCDCTL_API=3 etcdctl get /registry/secrets/default/secret1 [...] | hexdump -C`

ã“ã“ã§`[...]`ã¯etcdã‚µãƒ¼ãƒãƒ¼ã«æ¥ç¶šã™ã‚‹ãŸã‚ã®è¿½åŠ ã®å¼•æ•°ã§ã‚ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
3. ä¿å­˜ã•ã‚ŒãŸã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆãŒ`k8s:enc:aescbc:v1:`ã§å§‹ã¾ã£ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¾ã™ã€‚ã“ã‚Œã¯`aescbc`ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ãŒçµæœãƒ‡ãƒ¼ã‚¿ã‚’æš—å·åŒ–ã—ãŸã“ã¨ã‚’ç¤ºã—ã¾ã™ã€‚
4. APIã‚’ä»‹ã—ã¦å–å¾—ã•ã‚ŒãŸéš›ã«ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆãŒæ­£ã—ãå¾©å·åŒ–ã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¾ã™ï¼š

```
kubectl describe secret secret1 -n default
```

ã¯`mykey: bXlkYXRh`ã«ä¸€è‡´ã™ã‚‹ã¯ãšã§ã™ã€‚`mydata`ã¯ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã•ã‚Œã¦ã„ã¾ã™ã€‚ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚’å®Œå…¨ã«ãƒ‡ã‚³ãƒ¼ãƒ‰ã™ã‚‹ã«ã¯ã€[ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã®ãƒ‡ã‚³ãƒ¼ãƒ‰](https://kubernetes.io/docs/concepts/configuration/secret#decoding-a-secret)ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚

**ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã¯æ›¸ãè¾¼ã¿æ™‚ã«æš—å·åŒ–ã•ã‚Œã‚‹ãŸã‚ã€ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã®æ›´æ–°ã‚’è¡Œã†ã¨ãã®å†…å®¹ãŒæš—å·åŒ–ã•ã‚Œã¾ã™:**
```
kubectl get secrets --all-namespaces -o json | kubectl replace -f -
```
**æœ€çµ‚çš„ãªãƒ’ãƒ³ãƒˆ:**

- FSã«ç§˜å¯†ã‚’ä¿ç®¡ã—ãªã„ã‚ˆã†ã«ã—ã¦ã€ä»–ã®å ´æ‰€ã‹ã‚‰å–å¾—ã—ã¾ã™ã€‚
- ç§˜å¯†ã«ã•ã‚‰ãªã‚‹ä¿è­·ã‚’è¿½åŠ ã™ã‚‹ãŸã‚ã«[https://www.vaultproject.io/](https://www.vaultproject.io)ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ã€‚
- [https://kubernetes.io/docs/concepts/configuration/secret/#risks](https://kubernetes.io/docs/concepts/configuration/secret/#risks)
- [https://docs.cyberark.com/Product-Doc/OnlineHelp/AAM-DAP/11.2/en/Content/Integrations/Kubernetes\_deployApplicationsConjur-k8s-Secrets.htm](https://docs.cyberark.com/Product-Doc/OnlineHelp/AAM-DAP/11.2/en/Content/Integrations/Kubernetes\_deployApplicationsConjur-k8s-Secrets.htm)

## å‚è€ƒæ–‡çŒ®

{% embed url="https://sickrov.github.io/" %}

{% embed url="https://www.youtube.com/watch?v=X48VuDVv0do" %}

{% hint style="success" %}
AWSãƒãƒƒã‚­ãƒ³ã‚°ã®å­¦ç¿’ã¨å®Ÿè·µ:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCPãƒãƒƒã‚­ãƒ³ã‚°ã®å­¦ç¿’ã¨å®Ÿè·µ: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricksã®ã‚µãƒãƒ¼ãƒˆ</summary>

- [**ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³**](https://github.com/sponsors/carlospolop)ã‚’ãƒã‚§ãƒƒã‚¯ï¼
- ğŸ’¬ [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã«å‚åŠ ã™ã‚‹ã‹ã€[**telegramã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«å‚åŠ ã™ã‚‹ã‹ã€**Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**ã‚’ãƒ•ã‚©ãƒ­ãƒ¼**ã—ã¦ãã ã•ã„ã€‚
- **ãƒãƒƒã‚­ãƒ³ã‚°ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã™ã‚‹ãŸã‚ã«ã€**[**HackTricks**](https://github.com/carlospolop/hacktricks)ã¨[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)ã®GitHubãƒªãƒã‚¸ãƒˆãƒªã«PRã‚’æå‡ºã—ã¦ãã ã•ã„ã€‚

</details>
{% endhint %}
