# GCP - Filestore Post Exploitation



{% hint style="success" %}
AWSãƒãƒƒã‚­ãƒ³ã‚°ã®å­¦ç¿’ã¨ç·´ç¿’:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCPãƒãƒƒã‚­ãƒ³ã‚°ã®å­¦ç¿’ã¨ç·´ç¿’: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* [**ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³**](https://github.com/sponsors/carlospolop)ã‚’ãƒã‚§ãƒƒã‚¯ï¼
* ğŸ’¬ [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã«å‚åŠ ã™ã‚‹ã‹ã€[**telegramã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«å‚åŠ ã™ã‚‹ã‹ã€**Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**ã‚’ãƒ•ã‚©ãƒ­ãƒ¼**ã—ã¦ãã ã•ã„ã€‚
* **HackTricks**ã¨**HackTricks Cloud**ã®githubãƒªãƒã‚¸ãƒˆãƒªã«PRã‚’æå‡ºã—ã¦**ãƒãƒƒã‚­ãƒ³ã‚°ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰**ã—ã¦ãã ã•ã„ã€‚

</details>
{% endhint %}

## Filestore

Filestoreã«é–¢ã™ã‚‹è©³ç´°æƒ…å ±ã¯æ¬¡ã‚’å‚ç…§ã—ã¦ãã ã•ã„:

{% content-ref url="../gcp-services/gcp-filestore-enum.md" %}
[gcp-filestore-enum.md](../gcp-services/gcp-filestore-enum.md)
{% endcontent-ref %}

### Mount Filestore

å…±æœ‰ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ ã«ã¯**æ”»æ’ƒè€…ã®è¦–ç‚¹ã‹ã‚‰èˆˆå‘³æ·±ã„æ©Ÿå¯†æƒ…å ±**ãŒå«ã¾ã‚Œã¦ã„ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚Filestoreã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã¨ã€ãã‚Œã‚’**ãƒã‚¦ãƒ³ãƒˆ**ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™:

{% code overflow="wrap" %}
```bash
sudo apt-get update
sudo apt-get install nfs-common
# Check the share name
showmount -e <IP>
# Mount the share
mkdir /mnt/fs
sudo mount [FILESTORE_IP]:/[FILE_SHARE_NAME] /mnt/fs
```
{% endcode %}

ãƒ•ã‚¡ã‚¤ãƒ«ã‚¹ãƒˆã‚¢ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®IPã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’è¦‹ã¤ã‘ã‚‹ã«ã¯ã€ãƒšãƒ¼ã‚¸ã®åˆ—æŒ™ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ï¼š

{% content-ref url="../gcp-services/gcp-filestore-enum.md" %}
[gcp-filestore-enum.md](../gcp-services/gcp-filestore-enum.md)
{% endcontent-ref %}

### åˆ¶é™ã‚’è§£é™¤ã—ã¦è¿½åŠ ã®æ¨©é™ã‚’å–å¾—ã™ã‚‹

æ”»æ’ƒè€…ãŒã‚¢ã‚¯ã‚»ã‚¹æ¨©ã‚’æŒã£ã¦ã„ãªã„IPã‚¢ãƒ‰ãƒ¬ã‚¹ã«ã„ã‚‹å ´åˆã§ã‚‚ã€ãã‚Œã‚’å¤‰æ›´ã™ã‚‹æ¨©é™ãŒååˆ†ã«ã‚ã‚‹å ´åˆã¯ã€åˆ¶é™ã‚’è§£é™¤ã—ãŸã‚Šã‚¢ã‚¯ã‚»ã‚¹æ¨©ã‚’å–å¾—ã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚ã¾ãŸã€IPã‚¢ãƒ‰ãƒ¬ã‚¹ã«å¯¾ã—ã¦ã‚ˆã‚Šå¤šãã®ç‰¹æ¨©ã‚’ä»˜ä¸ã—ã¦ã€å…±æœ‰ã«å¯¾ã™ã‚‹ç®¡ç†è€…ã‚¢ã‚¯ã‚»ã‚¹æ¨©ã‚’æŒã¤ã“ã¨ã‚‚å¯èƒ½ã§ã™ï¼š
```bash
gcloud filestore instances update nfstest \
--zone=<exact-zone> \
--flags-file=nfs.json

# Contents of nfs.json
{
"--file-share":
{
"capacity": "1024",
"name": "<share-name>",
"nfs-export-options": [
{
"access-mode": "READ_WRITE",
"ip-ranges": [
"<your-ip-private-address>/32"
],
"squash-mode": "NO_ROOT_SQUASH",
"anon_uid": 1003,
"anon_gid": 1003
}
]
}
}
```
### ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã®å¾©å…ƒ

ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãŒã‚ã‚‹å ´åˆã€æ—¢å­˜ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã¾ãŸã¯æ–°ã—ã„ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã«ãã‚Œã‚’**å¾©å…ƒ**ã—ã¦ã€ãã®**æƒ…å ±ã«ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½**ã«ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
```bash
# Create a new filestore if you don't want to modify the old one
gcloud filestore instances create <new-instance-name> \
--zone=<zone> \
--tier=STANDARD \
--file-share=name=vol1,capacity=1TB \
--network=name=default,reserved-ip-range=10.0.0.0/29

# Restore a backups in a new instance
gcloud filestore instances restore <new-instance-name> \
--zone=<zone> \
--file-share=<instance-file-share-name> \
--source-backup=<backup-name> \
--source-backup-region=<backup-region>

# Follow the previous section commands to mount it
```
### ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚’ä½œæˆã—ã¦å¾©å…ƒã™ã‚‹

ã‚‚ã—ã‚·ã‚§ã‚¢ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹æ¨©ãŒãªãã€ãã‚Œã‚’å¤‰æ›´ã—ãŸããªã„å ´åˆã¯ã€ãã‚Œã®ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚’ä½œæˆã—ã€å…ˆã»ã©èª¬æ˜ã—ãŸã‚ˆã†ã«å¾©å…ƒã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™:

{% code overflow="wrap" %}
```bash
# Create share backup
gcloud filestore backups create <back-name> \
--region=<region> \
--instance=<instance-name> \
--instance-zone=<instance-zone> \
--file-share=<share-name>

# Follow the previous section commands to restore it and mount it
```
{% endcode %}

{% hint style="success" %}
AWSãƒãƒƒã‚­ãƒ³ã‚°ã®å­¦ç¿’ã¨ç·´ç¿’:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCPãƒãƒƒã‚­ãƒ³ã‚°ã®å­¦ç¿’ã¨ç·´ç¿’: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricksã®ã‚µãƒãƒ¼ãƒˆ</summary>

* [**ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³**](https://github.com/sponsors/carlospolop)ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ï¼
* ğŸ’¬ [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã«å‚åŠ ã™ã‚‹ã‹ã€[**telegramã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«å‚åŠ ã™ã‚‹ã‹ã€**Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**ã‚’ãƒ•ã‚©ãƒ­ãƒ¼**ã—ã¦ãã ã•ã„ã€‚
* ãƒãƒƒã‚­ãƒ³ã‚°ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã™ã‚‹ãŸã‚ã«ã€[**HackTricks**](https://github.com/carlospolop/hacktricks)ã¨[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)ã®GitHubãƒªãƒã‚¸ãƒˆãƒªã«PRã‚’æå‡ºã—ã¦ãã ã•ã„ã€‚

</details>
{% endhint %}
