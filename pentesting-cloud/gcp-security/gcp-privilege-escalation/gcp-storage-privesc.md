# GCP - Depolama Privilege Escalation

<details>

<summary><strong>AWS hacklemeyi sÄ±fÄ±rdan kahramana Ã¶ÄŸrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong> ile!</strong></summary>

HackTricks'i desteklemenin diÄŸer yollarÄ±:

* **Åirketinizi HackTricks'te reklamÄ±nÄ± gÃ¶rmek istiyorsanÄ±z** veya **HackTricks'i PDF olarak indirmek istiyorsanÄ±z** [**ABONELÄ°K PLANLARI**](https://github.com/sponsors/carlospolop)'na gÃ¶z atÄ±n!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* [**The PEASS Family'yi**](https://opensea.io/collection/the-peass-family) keÅŸfedin, Ã¶zel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuz
* **ğŸ’¬ [Discord grubuna](https://discord.gg/hRep4RUj7f) katÄ±lÄ±n veya [telegram grubuna](https://t.me/peass) katÄ±lÄ±n veya beni Twitter'da takip edin** ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Hacking pÃ¼f noktalarÄ±nÄ±zÄ± paylaÅŸarak PR gÃ¶ndererek HackTricks ve HackTricks Cloud** github depolarÄ±na katkÄ±da bulunun.

</details>

## Depolama

Temel Bilgiler:

{% content-ref url="../gcp-services/gcp-storage-enum.md" %}
[gcp-storage-enum.md](../gcp-services/gcp-storage-enum.md)
{% endcontent-ref %}

### `storage.objects.get`

Bu izin size **Cloud Storage iÃ§inde depolanan dosyalarÄ± indirme** olanaÄŸÄ± saÄŸlar. Bu potansiyel olarak **yetkileri yÃ¼kseltmenize izin verebilir Ã§Ã¼nkÃ¼ bazÄ± durumlarda hassas bilgiler orada saklanÄ±r**. AyrÄ±ca, bazÄ± GCP hizmetleri bilgilerini kovalara kaydeder:

* **GCP Composer**: Bir Composer OrtamÄ± oluÅŸturduÄŸunuzda, **tÃ¼m DAG'larÄ±n kodu** bir **kova iÃ§inde saklanÄ±r**. Bu gÃ¶revler, kodlarÄ±nÄ±n iÃ§inde ilginÃ§ bilgiler iÃ§erebilir.
* **GCR (Container Registry)**: **Konteynerlerin gÃ¶rÃ¼ntÃ¼leri** kovalarda saklanÄ±r, bu da kovalarÄ± okuyabiliyorsanÄ±z gÃ¶rÃ¼ntÃ¼leri indirebileceÄŸiniz ve **sÄ±zÄ±ntÄ±larÄ± ve/veya kaynak kodunu arayabileceÄŸiniz** anlamÄ±na gelir.

### `storage.objects.setIamPolicy`

Bu izin size bu bÃ¶lÃ¼mÃ¼n Ã¶nceki senaryolarÄ±ndan herhangi birini **kÃ¶tÃ¼ye kullanma izni verebilir**.

### **`storage.buckets.setIamPolicy`**

Bu izinle izinleri nasÄ±l deÄŸiÅŸtireceÄŸinizle ilgili bir Ã¶rnek iÃ§in bu sayfaya gÃ¶z atÄ±n:

{% content-ref url="../gcp-unaunthenticated-enum-and-access/gcp-storage-unauthenticated-enum/gcp-public-buckets-privilege-escalation.md" %}
[gcp-public-buckets-privilege-escalation.md](../gcp-unaunthenticated-enum-and-access/gcp-storage-unauthenticated-enum/gcp-public-buckets-privilege-escalation.md)
{% endcontent-ref %}

### `storage.hmacKeys.create`

Cloud Storage'Ä±n AWS S3 gibi **Ã§apraz bulut etkileÅŸimleri** iÃ§in tasarlanmÄ±ÅŸ "uyumluluk" Ã¶zelliÄŸi, **HMAC anahtarlarÄ±nÄ±n Hizmet HesaplarÄ± ve kullanÄ±cÄ±lar iÃ§in oluÅŸturulmasÄ±nÄ±** iÃ§erir. Bir saldÄ±rgan, bu Ã¶zelliÄŸi **yÃ¼kseltilmiÅŸ ayrÄ±calÄ±klara sahip bir Hizmet HesabÄ± iÃ§in HMAC anahtarÄ± oluÅŸturarak** sÃ¶mÃ¼rebilir, bÃ¶ylece **Cloud Storage iÃ§inde ayrÄ±calÄ±klarÄ± yÃ¼kseltebilir**. KullanÄ±cÄ±ya baÄŸlÄ± HMAC anahtarlarÄ± yalnÄ±zca web konsolu aracÄ±lÄ±ÄŸÄ±yla alÄ±nabilirken, eriÅŸim ve gizli anahtarlar **sÃ¼rekli eriÅŸilebilir** kalÄ±r, potansiyel yedek eriÅŸim depolama olanaÄŸÄ± saÄŸlar. Tersine, Hizmet HesabÄ±yla iliÅŸkilendirilmiÅŸ HMAC anahtarlarÄ± API eriÅŸimine aÃ§Ä±ktÄ±r, ancak eriÅŸim ve gizli anahtarlarÄ± oluÅŸturulduktan sonra alÄ±namaz, sÃ¼rekli eriÅŸim iÃ§in karmaÅŸÄ±k bir katman ekler.
```bash
# Create key
gsutil hmac create <sa-email>

# Configure gsutil to use it
gcloud config set pass_credentials_to_gsutil false
gsutil config -a

# Use it
gsutil ls gs://[BUCKET_NAME]

# Restore
gcloud config set pass_credentials_to_gsutil true
```
BaÅŸka bir exploit betiÄŸi bu yÃ¶ntem iÃ§in [burada](https://github.com/RhinoSecurityLabs/GCP-IAM-Privilege-Escalation/blob/master/ExploitScripts/storage.hmacKeys.create.py) bulunabilir.

## `storage.objects.create`, `storage.objects.delete` = Depolama Yazma izinleri

Bir kova iÃ§inde **yeni bir nesne oluÅŸturmak** iÃ§in `storage.objects.create`'a ihtiyacÄ±nÄ±z var ve [belgelere](https://cloud.google.com/storage/docs/access-control/iam-permissions#object\_permissions) gÃ¶re, bir var olan nesneyi **deÄŸiÅŸtirmek** iÃ§in ayrÄ±ca `storage.objects.delete`'a ihtiyacÄ±nÄ±z var.

Bulutta yazma izniniz olan kovalarÄ±n Ã§ok **sÄ±k olarak sÃ¶mÃ¼rÃ¼ldÃ¼ÄŸÃ¼** bir senaryo, **kova web sunucusu dosyalarÄ±nÄ± saklÄ±yorsa**, web uygulamasÄ± tarafÄ±ndan kullanÄ±lacak **yeni kodlarÄ± depolayabilmenizdir**.

### Composer

**Composer**, GCP iÃ§inde yÃ¶netilen **Apache Airflow**'dur. BirkaÃ§ ilginÃ§ Ã¶zelliÄŸi vardÄ±r:

* **GKE kÃ¼mesi iÃ§inde Ã§alÄ±ÅŸÄ±r**, bu nedenle Composer iÃ§inde Ã§alÄ±ÅŸan kodun eriÅŸebildiÄŸi **SA kÃ¼mesi kullanÄ±labilir**
* Kodu bir kovada saklar, bu nedenle, o kovaya **yazma eriÅŸimi olan herkes**, bir DGA kodu ekleyebilecek veya deÄŸiÅŸtirebilecek (Apache Airflow'un yÃ¼rÃ¼teceÄŸi kod)\
DolayÄ±sÄ±yla, Composer'Ä±n kodu saklamak iÃ§in kullandÄ±ÄŸÄ± kovaya **yazma eriÅŸiminiz varsa**, GKE kÃ¼mesinde Ã§alÄ±ÅŸan SA'ya **yÃ¼kselme yapabilirsiniz**.

### Cloud Functions

* Cloud Functions kodu Depolama'da saklanÄ±r, bu nedenle **Ã¼zerine yazarak keyfi kodu yÃ¼rÃ¼tmek mÃ¼mkÃ¼ndÃ¼r**.

### App Engine

* App Engine kaynak kodu kovalarda saklanÄ±r, **kodu Ã¼zerine yazarak keyfi kodu yÃ¼rÃ¼tmek mÃ¼mkÃ¼n olabilir. BU MÃœMKÃœN DEÄÄ°LDÄ°R**
* **Muhtemelen konteyner katmanlarÄ± kovada saklanÄ±r, belki onlarÄ± deÄŸiÅŸtirerek?**

### GCR

* **Google Container Registry**, gÃ¶rÃ¼ntÃ¼leri kovalarda saklar, eÄŸer **bu kovalara yazabilirseniz**, bu kovalarÄ±n Ã§alÄ±ÅŸtÄ±rÄ±ldÄ±ÄŸÄ± yere **yan yana geÃ§iÅŸ yapabilirsiniz**.
* GCR tarafÄ±ndan kullanÄ±lan kova, `gs://<eu/usa/asia/nothing>.artifacts.<project>.appspot.com` benzeri bir URL'ye sahip olacaktÄ±r (Ãœst dÃ¼zey alt alanlar [burada](https://cloud.google.com/container-registry/docs/pushing-and-pulling) belirtilmiÅŸtir).

## **Referanslar**

* [https://rhinosecuritylabs.com/cloud-security/privilege-escalation-google-cloud-platform-part-2/#:\~:text=apiKeys.-,create,privileges%20than%20our%20own%20user.](https://rhinosecuritylabs.com/cloud-security/privilege-escalation-google-cloud-platform-part-2/)

<details>

<summary><strong>AWS hacklemeyi sÄ±fÄ±rdan kahraman seviyesine Ã¶ÄŸrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong> ile!</strong></summary>

HackTricks'i desteklemenin diÄŸer yollarÄ±:

* **Åirketinizi HackTricks'te reklamÄ±nÄ± gÃ¶rmek istiyorsanÄ±z** veya **HackTricks'i PDF olarak indirmek istiyorsanÄ±z** [**ABONELÄ°K PLANLARINI**](https://github.com/sponsors/carlospolop) kontrol edin!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* [**The PEASS Family'yi**](https://opensea.io/collection/the-peass-family) keÅŸfedin, Ã¶zel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuz
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n veya **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm)**'yi takip edin.**
* **Hacking hilelerinizi paylaÅŸarak** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na PR gÃ¶ndererek.

</details>
