# GCP - Storage Privesc

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ЁЯТм [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ЁЯРж [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Storage

рдмреБрдирд┐рдпрд╛рджреА рдЬрд╛рдирдХрд╛рд░реА:

{% content-ref url="../gcp-services/gcp-storage-enum.md" %}
[gcp-storage-enum.md](../gcp-services/gcp-storage-enum.md)
{% endcontent-ref %}

### `storage.objects.get`

рдпрд╣ рдЕрдиреБрдорддрд┐ рдЖрдкрдХреЛ **Cloud Storage рдХреЗ рдЕрдВрджрд░ рд╕рдВрдЧреНрд░рд╣реАрдд рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреЛ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдиреЗ** рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддреА рд╣реИред рдпрд╣ рд╕рдВрднрд╛рд╡рд┐рдд рд░реВрдк рд╕реЗ рдЖрдкрдХреЛ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдмрдврд╝рд╛рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрдЧреА рдХреНрдпреЛрдВрдХрд┐ рдХреБрдЫ рдЕрд╡рд╕рд░реЛрдВ рдкрд░ **рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рдЬрд╛рдирдХрд╛рд░реА рд╡рд╣рд╛рдБ рд╕рдВрдЧреНрд░рд╣реАрдд рд╣реЛрддреА рд╣реИ**ред рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдХреБрдЫ GCP рд╕реЗрд╡рд╛рдПрдБ рдЕрдкрдиреА рдЬрд╛рдирдХрд╛рд░реА рдмрдХреЗрдЯ рдореЗрдВ рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд░рддреА рд╣реИрдВ:

* **GCP Composer**: рдЬрдм рдЖрдк рдПрдХ Composer Environment рдмрдирд╛рддреЗ рд╣реИрдВ, рддреЛ **рд╕рднреА DAGs рдХрд╛ рдХреЛрдб** рдПрдХ **рдмрдХреЗрдЯ** рдХреЗ рдЕрдВрджрд░ рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред рдЗрди рдХрд╛рд░реНрдпреЛрдВ рдореЗрдВ рдЙрдирдХреЗ рдХреЛрдб рдХреЗ рдЕрдВрджрд░ рджрд┐рд▓рдЪрд╕реНрдк рдЬрд╛рдирдХрд╛рд░реА рд╣реЛ рд╕рдХрддреА рд╣реИред
* **GCR (Container Registry)**: рдХрдВрдЯреЗрдирд░реЛрдВ рдХреА **рдЫрд╡рд┐** **рдмрдХреЗрдЯ** рдХреЗ рдЕрдВрджрд░ рд╕рдВрдЧреНрд░рд╣реАрдд рд╣реЛрддреА рд╣реИ, рдЬрд┐рд╕рдХрд╛ рдЕрд░реНрде рд╣реИ рдХрд┐ рдпрджрд┐ рдЖрдк рдмрдХреЗрдЯ рдХреЛ рдкрдврд╝ рд╕рдХрддреЗ рд╣реИрдВ, рддреЛ рдЖрдк рдЫрд╡рд┐рдпреЛрдВ рдХреЛ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░ рд╕рдХреЗрдВрдЧреЗ рдФрд░ **рд▓реАрдХ рдФрд░/рдпрд╛ рд╕реНрд░реЛрдд рдХреЛрдб** рдХреА рдЦреЛрдЬ рдХрд░ рд╕рдХреЗрдВрдЧреЗред

### `storage.objects.setIamPolicy`

рдЖрдкрдХреЛ **рдЗрд╕ рдЕрдиреБрднрд╛рдЧ рдХреЗ рдкрд┐рдЫрд▓реЗ рдкрд░рд┐рджреГрд╢реНрдпреЛрдВ рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдиреЗ** рдХреА рдЕрдиреБрдорддрд┐ рджреЗ рд╕рдХрддреЗ рд╣реИрдВред

### **`storage.buckets.setIamPolicy`**

рдЗрд╕ рдЕрдиреБрдорддрд┐ рдХреЗ рд╕рд╛рде рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП рдЗрд╕ рдкреГрд╖реНрда рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ:

{% content-ref url="../gcp-unauthenticated-enum-and-access/gcp-storage-unauthenticated-enum/gcp-public-buckets-privilege-escalation.md" %}
[gcp-public-buckets-privilege-escalation.md](../gcp-unauthenticated-enum-and-access/gcp-storage-unauthenticated-enum/gcp-public-buckets-privilege-escalation.md)
{% endcontent-ref %}

### `storage.hmacKeys.create`

Cloud Storage рдХреА "рдЗрдВрдЯрд░рдСрдкрд░реЗрдмрд┐рд▓рд┐рдЯреА" рд╕реБрд╡рд┐рдзрд╛, рдЬреЛ **AWS S3 рдХреЗ рд╕рд╛рде рдХреНрд░реЙрд╕-рдХреНрд▓рд╛рдЙрдб рдЗрдВрдЯрд░реИрдХреНрд╢рди** рдХреЗ рд▓рд┐рдП рдбрд┐рдЬрд╝рд╛рдЗрди рдХреА рдЧрдИ рд╣реИ, рдореЗрдВ **рд╕реЗрд╡рд╛ рдЦрд╛рддреЛрдВ рдФрд░ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЗ рд▓рд┐рдП HMAC рдХреБрдВрдЬреА рдХрд╛ рдирд┐рд░реНрдорд╛рдг** рд╢рд╛рдорд┐рд▓ рд╣реИред рдПрдХ рд╣рдорд▓рд╛рд╡рд░ рдЗрд╕рдХрд╛ рд▓рд╛рдн рдЙрдард╛ рд╕рдХрддрд╛ рд╣реИ **рдЙрдЪреНрдЪ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рд╡рд╛рд▓реЗ рд╕реЗрд╡рд╛ рдЦрд╛рддреЗ рдХреЗ рд▓рд┐рдП HMAC рдХреБрдВрдЬреА рдЙрддреНрдкрдиреНрди рдХрд░рдХреЗ**, рдЗрд╕ рдкреНрд░рдХрд╛рд░ **Cloud Storage рдХреЗ рднреАрддрд░ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдмрдврд╝рд╛рдирд╛**ред рдЬрдмрдХрд┐ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛-рд╕рдВрдмрдВрдзрд┐рдд HMAC рдХреБрдВрдЬреА рдХреЗрд╡рд▓ рд╡реЗрдм рдХрдВрд╕реЛрд▓ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдкреБрдирдГ рдкреНрд░рд╛рдкреНрдд рдХреА рдЬрд╛ рд╕рдХрддреА рд╣реИрдВ, рджреЛрдиреЛрдВ рдПрдХреНрд╕реЗрд╕ рдФрд░ рдЧреБрдкреНрдд рдХреБрдВрдЬреА **рд╕рджрд╛ рдХреЗ рд▓рд┐рдП рд╕реБрд▓рдн** рд░рд╣рддреА рд╣реИрдВ, рдЬрд┐рд╕рд╕реЗ рд╕рдВрднрд╛рд╡рд┐рдд рдмреИрдХрдЕрдк рдПрдХреНрд╕реЗрд╕ рд╕реНрдЯреЛрд░реЗрдЬ рдХреА рдЕрдиреБрдорддрд┐ рдорд┐рд▓рддреА рд╣реИред рдЗрд╕рдХреЗ рд╡рд┐рдкрд░реАрдд, рд╕реЗрд╡рд╛ рдЦрд╛рддрд╛ рд╕реЗ рдЬреБрдбрд╝реЗ HMAC рдХреБрдВрдЬреА API-рд╕реБрд▓рдн рд╣реЛрддреЗ рд╣реИрдВ, рд▓реЗрдХрд┐рди рдЙрдирдХреА рдПрдХреНрд╕реЗрд╕ рдФрд░ рдЧреБрдкреНрдд рдХреБрдВрдЬреА рдирд┐рд░реНрдорд╛рдг рдХреЗ рдмрд╛рдж рдкреБрдирдГ рдкреНрд░рд╛рдкреНрдд рдирд╣реАрдВ рдХреА рдЬрд╛ рд╕рдХрддреА, рдЬрд┐рд╕рд╕реЗ рдирд┐рд░рдВрддрд░ рдкрд╣реБрдБрдЪ рдХреЗ рд▓рд┐рдП рдЬрдЯрд┐рд▓рддрд╛ рдХрд╛ рдПрдХ рд╕реНрддрд░ рдЬреБрдбрд╝рддрд╛ рд╣реИред

{% code overflow="wrap" %}
```bash
# Create key
gsutil hmac create <sa-email> # You might need to execute this inside a VM instance

## If you have TROUBLES creating the HMAC key this was you can also do it contacting the API directly:
PROJECT_ID = '$PROJECT_ID'
TARGET_SERVICE_ACCOUNT = f"exam-storage-sa-read-flag-3@{PROJECT_ID}.iam.gserviceaccount.com"
ACCESS_TOKEN = "$CLOUDSDK_AUTH_ACCESS_TOKEN"
import requests
import json
key = requests.post(
f'https://www.googleapis.com/storage/v1/projects/{PROJECT_ID}/hmacKeys',
params={'access_token': ACCESS_TOKEN, 'serviceAccountEmail': TARGET_SERVICE_ACCOUNT}
).json()
#print(json.dumps(key, indent=4))
print(f'ID: {key["metadata"]["accessId"]}')
print(f'Secret: {key["secret"]}')


# Configure gsutil to use the HMAC key
gcloud config set pass_credentials_to_gsutil false
gsutil config -a

# Use it
gsutil ls gs://[BUCKET_NAME]

# Restore
gcloud config set pass_credentials_to_gsutil true
```
{% endcode %}

рдЗрд╕ рд╡рд┐рдзрд┐ рдХреЗ рд▓рд┐рдП рдПрдХ рдФрд░ рд╢реЛрд╖рдг рд╕реНрдХреНрд░рд┐рдкреНрдЯ [рдпрд╣рд╛рдБ](https://github.com/RhinoSecurityLabs/GCP-IAM-Privilege-Escalation/blob/master/ExploitScripts/storage.hmacKeys.create.py) рдорд┐рд▓ рд╕рдХрддреА рд╣реИред

## `storage.objects.create`, `storage.objects.delete` = рд╕реНрдЯреЛрд░реЗрдЬ рд▓рд┐рдЦрдиреЗ рдХреА рдЕрдиреБрдорддрд┐

рдПрдХ рдмрдХреЗрдЯ рдХреЗ рдЕрдВрджрд░ **рдирдпрд╛ рдСрдмреНрдЬреЗрдХреНрдЯ рдмрдирд╛рдиреЗ** рдХреЗ рд▓рд┐рдП рдЖрдкрдХреЛ `storage.objects.create` рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ рдФрд░, [рджрд╕реНрддрд╛рд╡реЗрдЬрд╝реЛрдВ](https://cloud.google.com/storage/docs/access-control/iam-permissions#object\_permissions) рдХреЗ рдЕрдиреБрд╕рд╛рд░, рдЖрдкрдХреЛ рдПрдХ рдореМрдЬреВрджрд╛ рдСрдмреНрдЬреЗрдХреНрдЯ рдХреЛ **рд╕рдВрд╢реЛрдзрд┐рдд** рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП `storage.objects.delete` рдХреА рднреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред

рдХреНрд▓рд╛рдЙрдб рдореЗрдВ рд▓рд┐рдЦрдиреЗ рдХреЗ рд▓рд┐рдП рдмрдХреЗрдЯ рдХрд╛ рдПрдХ рдмрд╣реБрдд **рд╕рд╛рдорд╛рдиреНрдп рд╢реЛрд╖рдг** рддрдм рд╣реЛрддрд╛ рд╣реИ рдЬрдм **рдмрдХреЗрдЯ рд╡реЗрдм рд╕рд░реНрд╡рд░ рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреЛ рд╕рд╣реЗрдЬ рд░рд╣рд╛ рд╣реИ**, рдЖрдк **рдирдпрд╛ рдХреЛрдб рд╕реНрдЯреЛрд░** рдХрд░рдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВ рдЬреЛ рд╡реЗрдм рдПрдкреНрд▓рд┐рдХреЗрд╢рди рджреНрд╡рд╛рд░рд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред

### Composer

**Composer** **Apache Airflow** рд╣реИ рдЬреЛ GCP рдХреЗ рдЕрдВрджрд░ рдкреНрд░рдмрдВрдзрд┐рдд рд╣реИред рдЗрд╕рдореЗрдВ рдХрдИ рджрд┐рд▓рдЪрд╕реНрдк рд╡рд┐рд╢реЗрд╖рддрд╛рдПрдБ рд╣реИрдВ:

* рдпрд╣ рдПрдХ **GKE рдХреНрд▓рд╕реНрдЯрд░** рдХреЗ рдЕрдВрджрд░ рдЪрд▓рддрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП **рдХреНрд▓рд╕реНрдЯрд░ рджреНрд╡рд╛рд░рд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рдиреЗ рд╡рд╛рд▓рд╛ SA рдХреЛрдб рдХреЗ рджреНрд╡рд╛рд░рд╛ рдкрд╣реБрдБрдЪ рдпреЛрдЧреНрдп рд╣реИ рдЬреЛ Composer рдХреЗ рдЕрдВрджрд░ рдЪрд▓ рд░рд╣рд╛ рд╣реИ**
* Composer рд╡рд╛рддрд╛рд╡рд░рдг рдХреЗ рд╕рднреА рдШрдЯрдХ (**DAGs рдХрд╛ рдХреЛрдб**, рдкреНрд▓рдЧрдЗрдиреНрд╕ рдФрд░ рдбреЗрдЯрд╛) рдПрдХ GCP рдмрдХреЗрдЯ рдХреЗ рдЕрдВрджрд░ рд╕рдВрдЧреНрд░рд╣реАрдд рд╣реЛрддреЗ рд╣реИрдВред рдпрджрд┐ рд╣рдорд▓рд╛рд╡рд░ рдХреЗ рдкрд╛рд╕ рдЗрд╕рдХреЗ рдКрдкрд░ рдкрдврд╝рдиреЗ рдФрд░ рд▓рд┐рдЦрдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рд╣реИ, рддреЛ рд╡рд╣ рдмрдХреЗрдЯ рдХреА рдирд┐рдЧрд░рд╛рдиреА рдХрд░ рд╕рдХрддрд╛ рд╣реИ рдФрд░ **рдЬрдм рднреА рдПрдХ DAG рдмрдирд╛рдпрд╛ рдпрд╛ рдЕрдкрдбреЗрдЯ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдПрдХ рдмреИрдХрдбреЛрд░ рд╕рдВрд╕реНрдХрд░рдг рд╕рдмрдорд┐рдЯ рдХрд░ рд╕рдХрддрд╛ рд╣реИ** рддрд╛рдХрд┐ Composer рд╡рд╛рддрд╛рд╡рд░рдг рд╕реНрдЯреЛрд░реЗрдЬ рд╕реЗ рдмреИрдХрдбреЛрд░ рд╕рдВрд╕реНрдХрд░рдг рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХреЗред

**рдЖрдк рдЗрд╕ рд╣рдорд▓реЗ рдХрд╛ PoC рдЗрд╕ рд░рд┐рдкреЙрдЬрд┐рдЯрд░реА рдореЗрдВ рдкрд╛ рд╕рдХрддреЗ рд╣реИрдВ:** [**https://github.com/carlospolop/Monitor-Backdoor-Composer-DAGs**](https://github.com/carlospolop/Monitor-Backdoor-Composer-DAGs)

### Cloud Functions

* Cloud Functions рдХрд╛ рдХреЛрдб рд╕реНрдЯреЛрд░реЗрдЬ рдореЗрдВ рд╕рдВрдЧреНрд░рд╣реАрдд рд╣реЛрддрд╛ рд╣реИ рдФрд░ рдЬрдм рднреА рдПрдХ рдирдпрд╛ рд╕рдВрд╕реНрдХрд░рдг рдмрдирд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдХреЛрдб рдмрдХреЗрдЯ рдореЗрдВ рдкреБрд╢ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдФрд░ рдлрд┐рд░ рдЗрд╕ рдХреЛрдб рд╕реЗ рдирдпрд╛ рдХрдВрдЯреЗрдирд░ рдмрдирд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред рдЗрд╕рд▓рд┐рдП, **рдирдП рд╕рдВрд╕реНрдХрд░рдг рдХреЗ рдмрдирдиреЗ рд╕реЗ рдкрд╣рд▓реЗ рдХреЛрдб рдХреЛ рдУрд╡рд░рд░рд╛рдЗрдЯ рдХрд░рдирд╛ рдХреНрд▓рд╛рдЙрдб рдлрд╝рдВрдХреНрд╢рди рдХреЛ рдордирдорд╛рдиреЗ рдХреЛрдб рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рдмрдирд╛рддрд╛ рд╣реИ**ред

**рдЖрдк рдЗрд╕ рд╣рдорд▓реЗ рдХрд╛ PoC рдЗрд╕ рд░рд┐рдкреЙрдЬрд┐рдЯрд░реА рдореЗрдВ рдкрд╛ рд╕рдХрддреЗ рд╣реИрдВ:** [**https://github.com/carlospolop/Monitor-Backdoor-Cloud-Functions**](https://github.com/carlospolop/Monitor-Backdoor-Cloud-Functions)

### App Engine

AppEngine рд╕рдВрд╕реНрдХрд░рдг рдПрдХ рдмрдХреЗрдЯ рдХреЗ рдЕрдВрджрд░ рдХреБрдЫ рдбреЗрдЯрд╛ рдЙрддреНрдкрдиреНрди рдХрд░рддреЗ рд╣реИрдВ рдЬрд┐рд╕рдХрд╛ рдкреНрд░рд╛рд░реВрдк рдирд╛рдо рд╣реИ: `staging.<project-id>.appspot.com`ред рдЗрд╕ рдмрдХреЗрдЯ рдХреЗ рдЕрдВрджрд░, рдПрдХ рдлрд╝реЛрд▓реНрдбрд░ `ae` рдирд╛рдо рд╕реЗ рдкрд╛рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдЬрд┐рд╕рдореЗрдВ AppEngine рдРрдк рдХреЗ рдкреНрд░рддреНрдпреЗрдХ рд╕рдВрд╕реНрдХрд░рдг рдХреЗ рд▓рд┐рдП рдПрдХ рдлрд╝реЛрд▓реНрдбрд░ рд╣реЛрдЧрд╛ рдФрд░ рдЗрди рдлрд╝реЛрд▓реНрдбрд░реЛрдВ рдХреЗ рдЕрдВрджрд░ `manifest.json` рдлрд╝рд╛рдЗрд▓ рдкрд╛рдИ рдЬрд╛ рд╕рдХрддреА рд╣реИред рдЗрд╕ рдлрд╝рд╛рдЗрд▓ рдореЗрдВ рд╕рднреА рдлрд╝рд╛рдЗрд▓реЛрдВ рдХрд╛ JSON рд╣реЛрддрд╛ рд╣реИ рдЬреЛ рд╡рд┐рд╢рд┐рд╖реНрдЯ рд╕рдВрд╕реНрдХрд░рдг рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХреА рдЬрд╛рдиреА рдЪрд╛рд╣рд┐рдПред рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, **рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреЗ рд╡рд╛рд╕реНрддрд╡рд┐рдХ рдирд╛рдо, GCP рдмрдХреЗрдЯ рдХреЗ рдЕрдВрджрд░ рдЙрдирдХреЗ рд▓рд┐рдП URL (рдмрдХреЗрдЯ рдХреЗ рдЕрдВрджрд░ рдлрд╝рд╛рдЗрд▓реЛрдВ рдиреЗ рдЕрдкрдиреЗ рдирд╛рдо рдХреЛ рдЙрдирдХреЗ sha1 рд╣реИрд╢ рдХреЗ рд▓рд┐рдП рдмрджрд▓ рджрд┐рдпрд╛) рдФрд░ рдкреНрд░рддреНрдпреЗрдХ рдлрд╝рд╛рдЗрд▓ рдХрд╛ sha1 рд╣реИрд╢** рдкрд╛рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред

_рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдЗрд╕ рдмрдХреЗрдЯ рдХреЛ рдкреВрд░реНрд╡-рдЯреЗрдХрдУрд╡рд░ рдХрд░рдирд╛ рд╕рдВрднрд╡ рдирд╣реАрдВ рд╣реИ рдХреНрдпреЛрдВрдХрд┐ GCP рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЛ appspot.com рдбреЛрдореЗрди рдирд╛рдо рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдмрдХреЗрдЯ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдЕрдзрд┐рдХреГрдд рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред_

рд╣рд╛рд▓рд╛рдВрдХрд┐, рдЗрд╕ рдмрдХреЗрдЯ рдкрд░ рдкрдврд╝рдиреЗ рдФрд░ рд▓рд┐рдЦрдиреЗ рдХреА рдкрд╣реБрдБрдЪ рдХреЗ рд╕рд╛рде, рдпрд╣ рд╕рдВрднрд╡ рд╣реИ рдХрд┐ App Engine рд╕рдВрд╕реНрдХрд░рдг рд╕реЗ рдЬреБрдбрд╝реЗ SA рдХреЗ рд▓рд┐рдП рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░реЛрдВ рдХреЛ рдмрдврд╝рд╛рдпрд╛ рдЬрд╛ рд╕рдХреЗ рдмрдХреЗрдЯ рдХреА рдирд┐рдЧрд░рд╛рдиреА рдХрд░рдХреЗ рдФрд░ рдЬрдм рднреА рдХреЛрдИ рдкрд░рд┐рд╡рд░реНрддрди рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ (рдирдпрд╛ рд╕рдВрд╕реНрдХрд░рдг), рдирдП рд╕рдВрд╕реНрдХрд░рдг рдХреЛ рдпрдерд╛рд╢реАрдШреНрд░ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рдПред рдЗрд╕ рддрд░рд╣, рдЗрд╕ рдХреЛрдб рд╕реЗ рдмрдирд╛рдпрд╛ рдЧрдпрд╛ рдХрдВрдЯреЗрдирд░ рдмреИрдХрдбреЛрд░ рдХреЛрдб рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░реЗрдЧрд╛ред

рдЙрд▓реНрд▓реЗрдЦрд┐рдд рд╣рдорд▓рд╛ рдХрдИ рдЕрд▓рдЧ-рдЕрд▓рдЧ рддрд░реАрдХреЛрдВ рд╕реЗ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рдЗрдирдореЗрдВ рд╕реЗ рд╕рднреА `staging.<project-id>.appspot.com` рдмрдХреЗрдЯ рдХреА рдирд┐рдЧрд░рд╛рдиреА рдХрд░рдХреЗ рд╢реБрд░реВ рд╣реЛрддреЗ рд╣реИрдВ:

* AppEngine рд╕рдВрд╕реНрдХрд░рдг рдХрд╛ рдкреВрд░рд╛ рдирдпрд╛ рдХреЛрдб рдПрдХ рдЕрд▓рдЧ рдФрд░ рдЙрдкрд▓рдмреНрдз рдмрдХреЗрдЯ рдореЗрдВ рдЕрдкрд▓реЛрдб рдХрд░реЗрдВ рдФрд░ **рдирдП рдмрдХреЗрдЯ рдирд╛рдо рдФрд░ рдЙрдирдХреЗ sha1 рд╣реИрд╢ рдХреЗ рд╕рд╛рде рдПрдХ `manifest.json` рдлрд╝рд╛рдЗрд▓ рддреИрдпрд╛рд░ рдХрд░реЗрдВ**ред рдлрд┐рд░, рдЬрдм рдмрдХреЗрдЯ рдХреЗ рдЕрдВрджрд░ рдПрдХ рдирдпрд╛ рд╕рдВрд╕реНрдХрд░рдг рдмрдирд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рдЖрдкрдХреЛ рдХреЗрд╡рд▓ `manifest.json` рдлрд╝рд╛рдЗрд▓ рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░рдирд╛ рд╣реИ рдФрд░ рджреБрд░реНрднрд╛рд╡рдирд╛рдкреВрд░реНрдг рдлрд╝рд╛рдЗрд▓ рдЕрдкрд▓реЛрдб рдХрд░рдиреА рд╣реИред
* рдПрдХ рд╕рдВрд╢реЛрдзрд┐рдд `requirements.txt` рд╕рдВрд╕реНрдХрд░рдг рдЕрдкрд▓реЛрдб рдХрд░реЗрдВ рдЬреЛ **рджреБрд░реНрднрд╛рд╡рдирд╛рдкреВрд░реНрдг рдирд┐рд░реНрднрд░рддрд╛рдУрдВ рдХреЗ рдХреЛрдб рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдЧрд╛ рдФрд░ `manifest.json`** рдлрд╝рд╛рдЗрд▓ рдХреЛ рдирдП рдлрд╝рд╛рдЗрд▓ рдирд╛рдо, URL рдФрд░ рдЗрд╕рдХреЗ рд╣реИрд╢ рдХреЗ рд╕рд╛рде рдЕрдкрдбреЗрдЯ рдХрд░реЗрдЧрд╛ред
* рдПрдХ **рд╕рдВрд╢реЛрдзрд┐рдд `main.py` рдпрд╛ `app.yaml` рдлрд╝рд╛рдЗрд▓ рдЕрдкрд▓реЛрдб рдХрд░реЗрдВ рдЬреЛ рджреБрд░реНрднрд╛рд╡рдирд╛рдкреВрд░реНрдг рдХреЛрдб рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░реЗрдЧреА** рдФрд░ `manifest.json` рдлрд╝рд╛рдЗрд▓ рдХреЛ рдирдП рдлрд╝рд╛рдЗрд▓ рдирд╛рдо, URL рдФрд░ рдЗрд╕рдХреЗ рд╣реИрд╢ рдХреЗ рд╕рд╛рде рдЕрдкрдбреЗрдЯ рдХрд░реЗрдЧреАред

**рдЖрдк рдЗрд╕ рд╣рдорд▓реЗ рдХрд╛ PoC рдЗрд╕ рд░рд┐рдкреЙрдЬрд┐рдЯрд░реА рдореЗрдВ рдкрд╛ рд╕рдХрддреЗ рд╣реИрдВ:** [**https://github.com/carlospolop/Monitor-Backdoor-AppEngine**](https://github.com/carlospolop/Monitor-Backdoor-AppEngine)

### GCR

* **Google Container Registry** рдмрдХреЗрдЯ рдХреЗ рдЕрдВрджрд░ рдЫрд╡рд┐рдпреЛрдВ рдХреЛ рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд░рддрд╛ рд╣реИ, рдпрджрд┐ рдЖрдк **рдЙрди рдмрдХреЗрдЯреНрд╕ рдореЗрдВ рд▓рд┐рдЦ рд╕рдХрддреЗ рд╣реИрдВ** рддреЛ рдЖрдк **рдЙрди рдмрдХреЗрдЯреНрд╕ рдХреЗ рдЪрд▓рдиреЗ рдХреЗ рд╕реНрдерд╛рди рдкрд░ рд▓реЗрдЯрд░рд▓реА рдореВрд╡ рдХрд░рдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВред**
* GCR рджреНрд╡рд╛рд░рд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рдиреЗ рд╡рд╛рд▓рд╛ рдмрдХреЗрдЯ рдПрдХ URL рдХреЗ рд╕рдорд╛рди рд╣реЛрдЧрд╛ `gs://<eu/usa/asia/nothing>.artifacts.<project>.appspot.com` (рд╢реАрд░реНрд╖ рд╕реНрддрд░ рдХреЗ рдЙрдкрдбреЛрдореЗрди [рдпрд╣рд╛рдБ](https://cloud.google.com/container-registry/docs/pushing-and-pulling) рдирд┐рд░реНрджрд┐рд╖реНрдЯ рд╣реИрдВ)ред

{% hint style="success" %}
рдпрд╣ рд╕реЗрд╡рд╛ рдЕрдкреНрд░рдЪрд▓рд┐рдд рд╣реИ рдЗрд╕рд▓рд┐рдП рдпрд╣ рд╣рдорд▓рд╛ рдЕрдм рдЙрдкрдпреЛрдЧреА рдирд╣реАрдВ рд╣реИред рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдЖрд░реНрдЯрд┐рдлреИрдХреНрдЯ рд░рдЬрд┐рд╕реНрдЯреНрд░реА, рдЬреЛ рдЗрд╕ рд╕реЗрд╡рд╛ рдХрд╛ рд╕реНрдерд╛рдирд╛рдкрдиреНрди рд╣реИ, рдмрдХреЗрдЯ рдореЗрдВ рдЫрд╡рд┐рдпреЛрдВ рдХреЛ рд╕рдВрдЧреНрд░рд╣реАрдд рдирд╣реАрдВ рдХрд░рддреА рд╣реИред
{% endhint %}

## **рд╕рдВрджрд░реНрдн**

* [https://rhinosecuritylabs.com/cloud-security/privilege-escalation-google-cloud-platform-part-2/#:\~:text=apiKeys.-,create,privileges%20than%20our%20own%20user.](https://rhinosecuritylabs.com/cloud-security/privilege-escalation-google-cloud-platform-part-2/)

{% hint style="success" %}
AWS рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ рдФрд░ рдЕрднреНрдпрд╛рд╕ рдХрд░реЗрдВ:<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
GCP рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ рдФрд░ рдЕрднреНрдпрд╛рд╕ рдХрд░реЗрдВ: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░реЗрдВ</summary>

* [**рд╕рджрд╕реНрдпрддрд╛ рдпреЛрдЬрдирд╛рдПрдБ**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* **ЁЯТм [**Discord рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдореЗрдВ рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ рдпрд╛ **Twitter** рдкрд░ рд╣рдореЗрдВ **рдлреЙрд▓реЛ рдХрд░реЗрдВ** ЁЯРж [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ рдФрд░ [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) рдЧрд┐рдЯрд╣рдм рд░рд┐рдкреЙрдЬрд┐рдЯрд░реА рдореЗрдВ PR рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗред**

</details>
{% endhint %}
