# GCP - IAM Privesc

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## IAM

IAMì— ëŒ€í•œ ë” ë§ì€ ì •ë³´ëŠ” ë‹¤ìŒì—ì„œ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤:

{% content-ref url="../gcp-services/gcp-iam-and-org-policies-enum.md" %}
[gcp-iam-and-org-policies-enum.md](../gcp-services/gcp-iam-and-org-policies-enum.md)
{% endcontent-ref %}

### `iam.roles.update` (`iam.roles.get`)

ì–¸ê¸‰ëœ ê¶Œí•œì„ ê°€ì§„ ê³µê²©ìëŠ” í• ë‹¹ëœ ì—­í• ì„ ì—…ë°ì´íŠ¸í•˜ê³  ë‹¤ìŒê³¼ ê°™ì€ ë‹¤ë¥¸ ë¦¬ì†ŒìŠ¤ì— ëŒ€í•œ ì¶”ê°€ ê¶Œí•œì„ ë¶€ì—¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```bash
gcloud iam roles update <rol name> --project <project> --add-permissions <permission>
```
ìë™í™”ëœ **ì·¨ì•½ í™˜ê²½ì˜ ìƒì„±, ì•…ìš© ë° ì •ë¦¬ë¥¼ ìœ„í•œ ìŠ¤í¬ë¦½íŠ¸ëŠ” ì—¬ê¸°**ì—ì„œ ì°¾ì„ ìˆ˜ ìˆìœ¼ë©°, ì´ ê¶Œí•œì„ ì•…ìš©í•˜ê¸° ìœ„í•œ python ìŠ¤í¬ë¦½íŠ¸ëŠ” [**ì—¬ê¸°**](https://github.com/RhinoSecurityLabs/GCP-IAM-Privilege-Escalation/blob/master/ExploitScripts/iam.roles.update.py)ì—ì„œ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ìì„¸í•œ ë‚´ìš©ì€ [**ì›ë³¸ ì—°êµ¬**](https://rhinosecuritylabs.com/gcp/privilege-escalation-google-cloud-platform-part-1/)ë¥¼ ì°¸ì¡°í•˜ì„¸ìš”.

### `iam.serviceAccounts.getAccessToken` (`iam.serviceAccounts.get`)

ì–¸ê¸‰ëœ ê¶Œí•œì„ ê°€ì§„ ê³µê²©ìëŠ” **ì„œë¹„ìŠ¤ ê³„ì •ì— ì†í•œ ì•¡ì„¸ìŠ¤ í† í°ì„ ìš”ì²­**í•  ìˆ˜ ìˆìœ¼ë¯€ë¡œ, ìš°ë¦¬ë³´ë‹¤ ë” ë§ì€ ê¶Œí•œì„ ê°€ì§„ ì„œë¹„ìŠ¤ ê³„ì •ì˜ ì•¡ì„¸ìŠ¤ í† í°ì„ ìš”ì²­í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
```bash
gcloud --impersonate-service-account="${victim}@${PROJECT_ID}.iam.gserviceaccount.com" \
auth print-access-token
```
[**ì·¨ì•½ í™˜ê²½ì˜ ìƒì„±, ì•…ìš© ë° ì •ë¦¬ë¥¼ ìë™í™”í•˜ëŠ” ìŠ¤í¬ë¦½íŠ¸ëŠ” ì—¬ê¸°**](https://github.com/carlospolop/gcp\_privesc\_scripts/blob/main/tests/4-iam.serviceAccounts.getAccessToken.sh)ì—ì„œ ì°¾ì„ ìˆ˜ ìˆìœ¼ë©°, ì´ ê¶Œí•œì„ ì•…ìš©í•˜ëŠ” python ìŠ¤í¬ë¦½íŠ¸ëŠ” [**ì—¬ê¸°**](https://github.com/RhinoSecurityLabs/GCP-IAM-Privilege-Escalation/blob/master/ExploitScripts/iam.serviceAccounts.getAccessToken.py)ì—ì„œ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ìì„¸í•œ ë‚´ìš©ì€ [**ì›ë³¸ ì—°êµ¬**](https://rhinosecuritylabs.com/gcp/privilege-escalation-google-cloud-platform-part-1/)ë¥¼ ì°¸ì¡°í•˜ì‹­ì‹œì˜¤.

### `iam.serviceAccountKeys.create`

ì–¸ê¸‰ëœ ê¶Œí•œì„ ê°€ì§„ ê³µê²©ìëŠ” **Service Accountì— ëŒ€í•œ ì‚¬ìš©ì ê´€ë¦¬ í‚¤ë¥¼ ìƒì„±**í•  ìˆ˜ ìˆìœ¼ë©°, ì´ë¥¼ í†µí•´ í•´ë‹¹ Service Accountë¡œ GCPì— ì ‘ê·¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
```bash
gcloud iam service-accounts keys create --iam-account <name> /tmp/key.json

gcloud auth activate-service-account --key-file=sa_cred.json
```
ìë™í™”ëœ [**ì·¨ì•½ í™˜ê²½ì˜ ìƒì„±, ì•…ìš© ë° ì •ë¦¬ë¥¼ ìœ„í•œ ìŠ¤í¬ë¦½íŠ¸ëŠ” ì—¬ê¸°**](https://github.com/carlospolop/gcp\_privesc\_scripts/blob/main/tests/3-iam.serviceAccountKeys.create.sh)ì—ì„œ ì°¾ì„ ìˆ˜ ìˆìœ¼ë©°, ì´ ê¶Œí•œì„ ì•…ìš©í•˜ê¸° ìœ„í•œ íŒŒì´ì¬ ìŠ¤í¬ë¦½íŠ¸ëŠ” [**ì—¬ê¸°**](https://github.com/RhinoSecurityLabs/GCP-IAM-Privilege-Escalation/blob/master/ExploitScripts/iam.serviceAccountKeys.create.py)ì—ì„œ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ìì„¸í•œ ì •ë³´ëŠ” [**ì›ë³¸ ì—°êµ¬**](https://rhinosecuritylabs.com/gcp/privilege-escalation-google-cloud-platform-part-1/)ë¥¼ ì°¸ì¡°í•˜ì‹­ì‹œì˜¤.

**`iam.serviceAccountKeys.update`ëŠ” SAì˜ í‚¤ë¥¼ ìˆ˜ì •í•˜ëŠ” ë° ì‘ë™í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤**. ì™œëƒí•˜ë©´ ì´ë¥¼ ìœ„í•´ì„œëŠ” `iam.serviceAccountKeys.create` ê¶Œí•œë„ í•„ìš”í•˜ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.

### `iam.serviceAccounts.implicitDelegation`

ë§Œì•½ íŠ¹ì • ì„œë¹„ìŠ¤ ê³„ì •ì— ëŒ€í•´ **`iam.serviceAccounts.implicitDelegation`** ê¶Œí•œì„ ê°€ì§€ê³  ìˆê³ , ê·¸ ì„œë¹„ìŠ¤ ê³„ì •ì´ ë‹¤ë¥¸ ì„œë¹„ìŠ¤ ê³„ì •ì— ëŒ€í•´ **`iam.serviceAccounts.getAccessToken`** ê¶Œí•œì„ ê°€ì§€ê³  ìˆë‹¤ë©´, implicitDelegationì„ ì‚¬ìš©í•˜ì—¬ **ê·¸ ë‹¤ë¥¸ ì„œë¹„ìŠ¤ ê³„ì •ì— ëŒ€í•œ í† í°ì„ ìƒì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤**. ë‹¤ìŒì€ ì´ë¥¼ ì„¤ëª…í•˜ê¸° ìœ„í•œ ë‹¤ì´ì–´ê·¸ë¨ì…ë‹ˆë‹¤.

![](https://rhinosecuritylabs.com/wp-content/uploads/2020/04/image2-500x493.png)

[**ë¬¸ì„œ**](https://cloud.google.com/iam/docs/understanding-service-accounts)ì— ë”°ë¥´ë©´, `gcloud`ì˜ ìœ„ì„ì€ [**generateAccessToken()**](https://cloud.google.com/iam/credentials/reference/rest/v1/projects.serviceAccounts/generateAccessToken) ë©”ì„œë“œë¥¼ ì‚¬ìš©í•˜ì—¬ í† í°ì„ ìƒì„±í•˜ëŠ” ë°ë§Œ ì‘ë™í•©ë‹ˆë‹¤. ë”°ë¼ì„œ APIë¥¼ ì§ì ‘ ì‚¬ìš©í•˜ì—¬ í† í°ì„ ì–»ëŠ” ë°©ë²•ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤:
```bash
curl -X POST \
'https://iamcredentials.googleapis.com/v1/projects/-/serviceAccounts/'"${TARGET_SERVICE_ACCOUNT}"':generateAccessToken' \
-H 'Content-Type: application/json' \
-H 'Authorization: Bearer '"$(gcloud auth print-access-token)" \
-d '{
"delegates": ["projects/-/serviceAccounts/'"${DELEGATED_SERVICE_ACCOUNT}"'"],
"scope": ["https://www.googleapis.com/auth/cloud-platform"]
}'
```
[**ì—¬ê¸°**](https://github.com/carlospolop/gcp\_privesc\_scripts/blob/main/tests/5-iam.serviceAccounts.implicitDelegation.sh)ì—ì„œ ì·¨ì•½í•œ í™˜ê²½ì˜ **ìƒì„±, ì•…ìš© ë° ì •ë¦¬ë¥¼ ìë™í™”í•˜ëŠ” ìŠ¤í¬ë¦½íŠ¸**ì™€ ì´ ê¶Œí•œì„ ì•…ìš©í•˜ëŠ” python ìŠ¤í¬ë¦½íŠ¸ë¥¼ [**ì—¬ê¸°**](https://github.com/RhinoSecurityLabs/GCP-IAM-Privilege-Escalation/blob/master/ExploitScripts/iam.serviceAccounts.implicitDelegation.py)ì—ì„œ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ìì„¸í•œ ë‚´ìš©ì€ [**ì›ë³¸ ì—°êµ¬**](https://rhinosecuritylabs.com/gcp/privilege-escalation-google-cloud-platform-part-1/)ë¥¼ ì°¸ì¡°í•˜ì„¸ìš”.

### `iam.serviceAccounts.signBlob`

ì–¸ê¸‰ëœ ê¶Œí•œì„ ê°€ì§„ ê³µê²©ìëŠ” **GCPì—ì„œ ì„ì˜ì˜ í˜ì´ë¡œë“œë¥¼ ì„œëª…**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë”°ë¼ì„œ **SAì˜ ì„œëª…ë˜ì§€ ì•Šì€ JWTë¥¼ ìƒì„±í•œ ë‹¤ìŒ ì´ë¥¼ blobìœ¼ë¡œ ë³´ë‚´ ëŒ€ìƒ SAê°€ JWTì— ì„œëª…í•˜ë„ë¡ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤**. ìì„¸í•œ ë‚´ìš©ì€ [**ì—¬ê¸°**](https://medium.com/google-cloud/using-serviceaccountactor-iam-role-for-account-impersonation-on-google-cloud-platform-a9e7118480ed)ë¥¼ ì½ì–´ë³´ì„¸ìš”.

[**ì—¬ê¸°**](https://github.com/carlospolop/gcp\_privesc\_scripts/blob/main/tests/6-iam.serviceAccounts.signBlob.sh)ì—ì„œ ì·¨ì•½í•œ í™˜ê²½ì˜ **ìƒì„±, ì•…ìš© ë° ì •ë¦¬ë¥¼ ìë™í™”í•˜ëŠ” ìŠ¤í¬ë¦½íŠ¸**ì™€ ì´ ê¶Œí•œì„ ì•…ìš©í•˜ëŠ” python ìŠ¤í¬ë¦½íŠ¸ë¥¼ [**ì—¬ê¸°**](https://github.com/RhinoSecurityLabs/GCP-IAM-Privilege-Escalation/blob/master/ExploitScripts/iam.serviceAccounts.signBlob-accessToken.py) ë° [**ì—¬ê¸°**](https://github.com/RhinoSecurityLabs/GCP-IAM-Privilege-Escalation/blob/master/ExploitScripts/iam.serviceAccounts.signBlob-gcsSignedUrl.py)ì—ì„œ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ìì„¸í•œ ë‚´ìš©ì€ [**ì›ë³¸ ì—°êµ¬**](https://rhinosecuritylabs.com/gcp/privilege-escalation-google-cloud-platform-part-1/)ë¥¼ ì°¸ì¡°í•˜ì„¸ìš”.

### `iam.serviceAccounts.signJwt`

ì–¸ê¸‰ëœ ê¶Œí•œì„ ê°€ì§„ ê³µê²©ìëŠ” **ì˜ í˜•ì„±ëœ JSON ì›¹ í† í°(JWT)ì„ ì„œëª…**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ì „ ë°©ë²•ê³¼ì˜ ì°¨ì´ì ì€ **JWTë¥¼ í¬í•¨í•˜ëŠ” blobì— ì„œëª…í•˜ë„ë¡ googleì— ìš”ì²­í•˜ëŠ” ëŒ€ì‹ , ì´ë¯¸ JWTë¥¼ ê¸°ëŒ€í•˜ëŠ” signJWT ë©”ì„œë“œë¥¼ ì‚¬ìš©í•œë‹¤ëŠ” ê²ƒ**ì…ë‹ˆë‹¤. ì´ë¥¼ í†µí•´ ì‚¬ìš©ì´ ë” ì‰¬ì›Œì§€ì§€ë§Œ, ì„ì˜ì˜ ë°”ì´íŠ¸ ëŒ€ì‹  JWTë§Œ ì„œëª…í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

[**ì—¬ê¸°**](https://github.com/carlospolop/gcp\_privesc\_scripts/blob/main/tests/7-iam.serviceAccounts.signJWT.sh)ì—ì„œ ì·¨ì•½í•œ í™˜ê²½ì˜ **ìƒì„±, ì•…ìš© ë° ì •ë¦¬ë¥¼ ìë™í™”í•˜ëŠ” ìŠ¤í¬ë¦½íŠ¸**ì™€ ì´ ê¶Œí•œì„ ì•…ìš©í•˜ëŠ” python ìŠ¤í¬ë¦½íŠ¸ë¥¼ [**ì—¬ê¸°**](https://github.com/RhinoSecurityLabs/GCP-IAM-Privilege-Escalation/blob/master/ExploitScripts/iam.serviceAccounts.signJWT.py)ì—ì„œ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ìì„¸í•œ ë‚´ìš©ì€ [**ì›ë³¸ ì—°êµ¬**](https://rhinosecuritylabs.com/gcp/privilege-escalation-google-cloud-platform-part-1/)ë¥¼ ì°¸ì¡°í•˜ì„¸ìš”.

### `iam.serviceAccounts.setIamPolicy` <a href="#iam.serviceaccounts.setiampolicy" id="iam.serviceaccounts.setiampolicy"></a>

ì–¸ê¸‰ëœ ê¶Œí•œì„ ê°€ì§„ ê³µê²©ìëŠ” **ì„œë¹„ìŠ¤ ê³„ì •ì— IAM ì •ì±…ì„ ì¶”ê°€**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ë¥¼ ì•…ìš©í•˜ì—¬ **í•„ìš”í•œ ê¶Œí•œì„ ë¶€ì—¬ë°›ì•„ ì„œë¹„ìŠ¤ ê³„ì •ì„ ê°€ì¥**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë‹¤ìŒ ì˜ˆì—ì„œëŠ” `roles/iam.serviceAccountTokenCreator` ì—­í• ì„ í¥ë¯¸ë¡œìš´ SAì— ë¶€ì—¬í•˜ê³  ìˆìŠµë‹ˆë‹¤:
```bash
gcloud iam service-accounts add-iam-policy-binding "${VICTIM_SA}@${PROJECT_ID}.iam.gserviceaccount.com" \
--member="user:username@domain.com" \
--role="roles/iam.serviceAccountTokenCreator"

# If you still have prblem grant yourself also this permission
gcloud iam service-accounts add-iam-policy-binding "${VICTIM_SA}@${PROJECT_ID}.iam.gserviceaccount.com" \ \
--member="user:username@domain.com" \
--role="roles/iam.serviceAccountUser"
```
[**ì—¬ê¸°ì—ì„œ ì·¨ì•½ í™˜ê²½ì˜ ìƒì„±, ì•…ìš© ë° ì •ë¦¬ë¥¼ ìë™í™”í•˜ëŠ” ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤**](https://github.com/carlospolop/gcp_privesc_scripts/blob/main/tests/d-iam.serviceAccounts.setIamPolicy.sh)**.**

### `iam.serviceAccounts.actAs`

**iam.serviceAccounts.actAs ê¶Œí•œ**ì€ **AWSì˜ iam:PassRole ê¶Œí•œ**ê³¼ ìœ ì‚¬í•©ë‹ˆë‹¤. ì´ëŠ” Compute Engine ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì‹œì‘í•˜ëŠ” ê²ƒê³¼ ê°™ì€ ì‘ì—…ì„ ì‹¤í–‰í•˜ëŠ” ë° í•„ìˆ˜ì ì´ë©°, ì„œë¹„ìŠ¤ ê³„ì •ìœ¼ë¡œ "actAs"í•  ìˆ˜ ìˆëŠ” ëŠ¥ë ¥ì„ ë¶€ì—¬í•˜ì—¬ ì•ˆì „í•œ ê¶Œí•œ ê´€ë¦¬ë¥¼ ë³´ì¥í•©ë‹ˆë‹¤. ì´ ê¶Œí•œì´ ì—†ìœ¼ë©´ ì‚¬ìš©ìê°€ ë¶€ë‹¹í•œ ì ‘ê·¼ì„ ì–»ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë˜í•œ, **iam.serviceAccounts.actAs**ë¥¼ ì•…ìš©í•˜ëŠ” ê²ƒì€ ì—¬ëŸ¬ ê°€ì§€ ë°©ë²•ì´ ìˆìœ¼ë©°, ê° ë°©ë²•ì€ ì¼ë ¨ì˜ ê¶Œí•œì´ í•„ìš”í•˜ë©°, ë‹¤ë¥¸ ë°©ë²•ë“¤ì€ ë‹¨ í•˜ë‚˜ì˜ ê¶Œí•œë§Œ í•„ìš”í•©ë‹ˆë‹¤.

#### ì„œë¹„ìŠ¤ ê³„ì • ê°€ì¥ <a href="#service-account-impersonation" id="service-account-impersonation"></a>

ì„œë¹„ìŠ¤ ê³„ì •ì„ ê°€ì¥í•˜ëŠ” ê²ƒì€ **ìƒˆë¡­ê³  ë” ë‚˜ì€ ê¶Œí•œì„ ì–»ëŠ” ë° ë§¤ìš° ìœ ìš©**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. [ë‹¤ë¥¸ ì„œë¹„ìŠ¤ ê³„ì •ì„ ê°€ì¥í•˜ëŠ”](https://cloud.google.com/iam/docs/understanding-service-accounts#impersonating_a_service_account) ì„¸ ê°€ì§€ ë°©ë²•ì´ ìˆìŠµë‹ˆë‹¤:

* **RSA ê°œì¸ í‚¤ë¥¼ ì‚¬ìš©í•œ ì¸ì¦** (ìœ„ì—ì„œ ë‹¤ë£¸)
* **Cloud IAM ì •ì±…ì„ ì‚¬ìš©í•œ ê¶Œí•œ ë¶€ì—¬** (ì—¬ê¸°ì—ì„œ ë‹¤ë£¸)
* **GCP ì„œë¹„ìŠ¤ì— ì‘ì—… ë°°í¬** (ì‚¬ìš©ì ê³„ì •ì˜ ì†ìƒì— ë” ì ìš© ê°€ëŠ¥)

### `iam.serviceAccounts.getOpenIdToken`

ì–¸ê¸‰ëœ ê¶Œí•œì„ ê°€ì§„ ê³µê²©ìëŠ” OpenID JWTë¥¼ ìƒì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ëŠ” ì‹ ì›ì„ ì£¼ì¥í•˜ëŠ” ë° ì‚¬ìš©ë˜ë©°, ë°˜ë“œì‹œ ë¦¬ì†ŒìŠ¤ì— ëŒ€í•œ ì•”ë¬µì ì¸ ê¶Œí•œì„ í¬í•¨í•˜ì§€ëŠ” ì•ŠìŠµë‹ˆë‹¤.

ì´ [**í¥ë¯¸ë¡œìš´ ê²Œì‹œë¬¼**](https://medium.com/google-cloud/authenticating-using-google-openid-connect-tokens-e7675051213b)ì— ë”°ë¥´ë©´, ì²­ì¤‘(í† í°ì„ ì‚¬ìš©í•˜ì—¬ ì¸ì¦í•˜ë ¤ëŠ” ì„œë¹„ìŠ¤)ì„ ì§€ì •í•´ì•¼ í•˜ë©°, Googleì´ ì„œëª…í•œ JWTë¥¼ ë°›ì•„ ì„œë¹„ìŠ¤ ê³„ì •ê³¼ JWTì˜ ì²­ì¤‘ì„ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤.

ë‹¤ìŒê³¼ ê°™ì´ OpenIDTokenì„ ìƒì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤ (ì ‘ê·¼ ê¶Œí•œì´ ìˆëŠ” ê²½ìš°):
```bash
# First activate the SA with iam.serviceAccounts.getOpenIdToken over the other SA
gcloud auth activate-service-account --key-file=/path/to/svc_account.json
# Then, generate token
gcloud auth print-identity-token "${ATTACK_SA}@${PROJECT_ID}.iam.gserviceaccount.com" --audiences=https://example.com
```
ê·¸ëŸ° ë‹¤ìŒ ì´ë¥¼ ì‚¬ìš©í•˜ì—¬ ì„œë¹„ìŠ¤ì— ì•¡ì„¸ìŠ¤í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```bash
curl -v -H "Authorization: Bearer id_token" https://some-cloud-run-uc.a.run.app
```
ì¼ë¶€ ì„œë¹„ìŠ¤ëŠ” ì´ëŸ¬í•œ ì¢…ë¥˜ì˜ í† í°ì„ í†µí•œ ì¸ì¦ì„ ì§€ì›í•©ë‹ˆë‹¤:

* [Google Cloud Run](https://cloud.google.com/run/)
* [Google Cloud Functions](https://cloud.google.com/functions/docs/)
* [Google Identity Aware Proxy](https://cloud.google.com/iap/docs/authentication-howto)
* [Google Cloud Endpoints](https://cloud.google.com/endpoints/docs/openapi/authenticating-users-google-id) (Google OIDC ì‚¬ìš© ì‹œ)

ì„œë¹„ìŠ¤ ê³„ì •ì„ ëŒ€ì‹ í•˜ì—¬ OpenID í† í°ì„ ìƒì„±í•˜ëŠ” ì˜ˆì œëŠ” [**ì—¬ê¸°**](https://github.com/carlospolop-forks/GCP-IAM-Privilege-Escalation/blob/master/ExploitScripts/iam.serviceAccounts.getOpenIdToken.py)ì—ì„œ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

## ì°¸ê³  ìë£Œ

* [https://rhinosecuritylabs.com/gcp/privilege-escalation-google-cloud-platform-part-1/](https://rhinosecuritylabs.com/gcp/privilege-escalation-google-cloud-platform-part-1/)

{% hint style="success" %}
AWS Hacking í•™ìŠµ ë° ì—°ìŠµ:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCP Hacking í•™ìŠµ ë° ì—°ìŠµ: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks ì§€ì›í•˜ê¸°</summary>

* [**êµ¬ë… í”Œëœ**](https://github.com/sponsors/carlospolop)ì„ í™•ì¸í•˜ì„¸ìš”!
* ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**telegram ê·¸ë£¹**](https://t.me/peass)ì— ê°€ì…í•˜ê±°ë‚˜ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)ì„ íŒ”ë¡œìš°í•˜ì„¸ìš”.
* PRì„ ì œì¶œí•˜ì—¬ [**HackTricks**](https://github.com/carlospolop/hacktricks) ë° [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ì €ì¥ì†Œì— í•´í‚¹ íŠ¸ë¦­ì„ ê³µìœ í•˜ì„¸ìš”.

</details>
{% endhint %}
