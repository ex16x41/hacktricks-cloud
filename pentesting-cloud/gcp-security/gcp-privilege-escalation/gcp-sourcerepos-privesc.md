# GCP - Sourcerepos Privesc

{% hint style="success" %}
Ucz siÄ™ i Ä‡wicz AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Ucz siÄ™ i Ä‡wicz GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Wspieraj HackTricks</summary>

* SprawdÅº [**plany subskrypcji**](https://github.com/sponsors/carlospolop)!
* **DoÅ‚Ä…cz do** ğŸ’¬ [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegram**](https://t.me/peass) lub **Å›ledÅº** nas na **Twitterze** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Dziel siÄ™ trikami hakerskimi, przesyÅ‚ajÄ…c PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repozytoriÃ³w na githubie.

</details>
{% endhint %}

## Source Repositories

WiÄ™cej informacji o Source Repositories znajdziesz tutaj:

{% content-ref url="../gcp-services/gcp-source-repositories-enum.md" %}
[gcp-source-repositories-enum.md](../gcp-services/gcp-source-repositories-enum.md)
{% endcontent-ref %}

### `source.repos.get`

Z tÄ… uprawnieniem moÅ¼liwe jest pobranie repozytorium lokalnie:
```bash
gcloud source repos clone <repo-name> --project=<project-uniq-name>
```
### `source.repos.update`

Podmiot z tym uprawnieniem **bÄ™dzie mÃ³gÅ‚ pisaÄ‡ kod w repozytorium sklonowanym za pomocÄ… `gcloud source repos clone <repo>`**. NaleÅ¼y jednak zauwaÅ¼yÄ‡, Å¼e to uprawnienie nie moÅ¼e byÄ‡ przypisane do rÃ³l niestandardowych, wiÄ™c musi byÄ‡ nadane za pomocÄ… roli predefiniowanej, takiej jak:

* Owner
* Editor
* Source Repository Administrator (`roles/source.admin`)
* Source Repository Writer (`roles/source.writer`)

Aby pisaÄ‡, wystarczy wykonaÄ‡ zwykÅ‚e **`git push`**.

### `source.repos.setIamPolicy`

DziÄ™ki temu uprawnieniu atakujÄ…cy mÃ³gÅ‚by przyznaÄ‡ sobie poprzednie uprawnienia.

### DostÄ™p do sekretÃ³w

JeÅ›li atakujÄ…cy ma **dostÄ™p do sekretÃ³w**, gdzie przechowywane sÄ… tokeny, bÄ™dzie mÃ³gÅ‚ je ukraÅ›Ä‡. WiÄ™cej informacji na temat dostÄ™pu do sekretÃ³w moÅ¼na znaleÅºÄ‡ tutaj:

{% content-ref url="gcp-secretmanager-privesc.md" %}
[gcp-secretmanager-privesc.md](gcp-secretmanager-privesc.md)
{% endcontent-ref %}

### Dodawanie kluczy SSH

MoÅ¼liwe jest **dodanie kluczy ssh do projektu Source Repository** w konsoli internetowej. Wykonuje to Å¼Ä…danie post do **`/v1/sshKeys:add`** i moÅ¼na to skonfigurowaÄ‡ na [https://source.cloud.google.com/user/ssh\_keys](https://source.cloud.google.com/user/ssh\_keys)

Po ustawieniu klucza ssh, moÅ¼na uzyskaÄ‡ dostÄ™p do repozytorium za pomocÄ…:

{% code overflow="wrap" %}
```bash
git clone ssh://username@domain.com@source.developers.google.com:2022/p/<proj-name>/r/<repo-name>
```
{% endcode %}

A nastÄ™pnie uÅ¼yj poleceÅ„ **`git`** jak zwykle.

### RÄ™czne poÅ›wiadczenia

MoÅ¼liwe jest utworzenie rÄ™cznych poÅ›wiadczeÅ„ do dostÄ™pu do Source Repositories:

<figure><img src="../../../.gitbook/assets/image (324).png" alt=""><figcaption></figcaption></figure>

KlikniÄ™cie na pierwszy link przekieruje CiÄ™ do [https://source.developers.google.com/auth/start?scopes=https%3A%2F%2Fwww.googleapis.com%2Fauth%2Fcloud-platform\&state\&authuser=3](https://source.developers.google.com/auth/start?scopes=https%3A%2F%2Fwww.googleapis.com%2Fauth%2Fcloud-platform\&state\&authuser=3)

Co wywoÅ‚a **monit autoryzacyjny Oauth** w celu uzyskania dostÄ™pu do **Google Cloud Development**. BÄ™dziesz wiÄ™c potrzebowaÄ‡ albo **poÅ›wiadczeÅ„ uÅ¼ytkownika**, albo **otwartej sesji w przeglÄ…darce**.

To przekieruje CiÄ™ na stronÄ™ z **skryptem bash do wykonania** i skonfigurowania ciasteczka git w **`$HOME/.gitcookies`**

<figure><img src="../../../.gitbook/assets/image (323).png" alt=""><figcaption></figcaption></figure>

Po wykonaniu skryptu moÅ¼esz uÅ¼yÄ‡ git clone, push... i bÄ™dzie dziaÅ‚aÄ‡.

### `source.repos.updateProjectConfig`

Z tym uprawnieniem moÅ¼liwe jest wyÅ‚Ä…czenie domyÅ›lnej ochrony Source Repositories, aby nie przesyÅ‚aÄ‡ kodu zawierajÄ…cego klucze prywatne:
```bash
gcloud source project-configs update --disable-pushblock
```
MoÅ¼esz rÃ³wnieÅ¼ skonfigurowaÄ‡ inny temat pub/sub lub nawet caÅ‚kowicie go wyÅ‚Ä…czyÄ‡:
```bash
gcloud source project-configs update --remove-topic=REMOVE_TOPIC
gcloud source project-configs update --remove-topic=UPDATE_TOPIC
```
{% hint style="success" %}
Naucz siÄ™ i Ä‡wicz AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Naucz siÄ™ i Ä‡wicz GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Wspieraj HackTricks</summary>

* SprawdÅº [**plany subskrypcji**](https://github.com/sponsors/carlospolop)!
* **DoÅ‚Ä…cz do** ğŸ’¬ [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegram**](https://t.me/peass) lub **Å›ledÅº** nas na **Twitterze** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Dziel siÄ™ trikami hakerskimi, przesyÅ‚ajÄ…c PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **repozytoriÃ³w na githubie**.

</details>
{% endhint %}
