# GCP - Sourcerepos Privesc

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Source Repositories

Î“Î¹Î± Ï€ÎµÏÎ¹ÏƒÏƒÏŒÏ„ÎµÏÎµÏ‚ Ï€Î»Î·ÏÎ¿Ï†Î¿ÏÎ¯ÎµÏ‚ ÏƒÏ‡ÎµÏ„Î¹ÎºÎ¬ Î¼Îµ Ï„Î± Source Repositories ÎµÎ»Î­Î³Î¾Ï„Îµ:

{% content-ref url="../gcp-services/gcp-source-repositories-enum.md" %}
[gcp-source-repositories-enum.md](../gcp-services/gcp-source-repositories-enum.md)
{% endcontent-ref %}

### `source.repos.get`

ÎœÎµ Î±Ï…Ï„Î® Ï„Î·Î½ Î¬Î´ÎµÎ¹Î± ÎµÎ¯Î½Î±Î¹ Î´Ï…Î½Î±Ï„Î® Î· Î»Î®ÏˆÎ· Ï„Î¿Ï… Î±Ï€Î¿Î¸ÎµÏ„Î·ÏÎ¯Î¿Ï… Ï„Î¿Ï€Î¹ÎºÎ¬:
```bash
gcloud source repos clone <repo-name> --project=<project-uniq-name>
```
### `source.repos.update`

ÎˆÎ½Î±Ï‚ ÎºÏÏÎ¹Î¿Ï‚ Î¼Îµ Î±Ï…Ï„Î® Ï„Î·Î½ Î¬Î´ÎµÎ¹Î± **Î¸Î± Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Î³ÏÎ¬ÏˆÎµÎ¹ ÎºÏÎ´Î¹ÎºÎ± Î¼Î­ÏƒÎ± ÏƒÎµ Î­Î½Î± Î±Ï€Î¿Î¸ÎµÏ„Î®ÏÎ¹Î¿ Ï€Î¿Ï… Î­Ï‡ÎµÎ¹ ÎºÎ»Ï‰Î½Î¿Ï€Î¿Î¹Î·Î¸ÎµÎ¯ Î¼Îµ `gcloud source repos clone <repo>`**. Î‘Î»Î»Î¬ ÏƒÎ·Î¼ÎµÎ¹ÏÏƒÏ„Îµ ÏŒÏ„Î¹ Î±Ï…Ï„Î® Î· Î¬Î´ÎµÎ¹Î± Î´ÎµÎ½ Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Ï€ÏÎ¿ÏƒÎ±ÏÏ„Î·Î¸ÎµÎ¯ ÏƒÎµ Ï€ÏÎ¿ÏƒÎ±ÏÎ¼Î¿ÏƒÎ¼Î­Î½Î¿Ï…Ï‚ ÏÏŒÎ»Î¿Ï…Ï‚, Î¿Ï€ÏŒÏ„Îµ Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± Î´Î¿Î¸ÎµÎ¯ Î¼Î­ÏƒÏ‰ ÎµÎ½ÏŒÏ‚ Ï€ÏÎ¿ÎºÎ±Î¸Î¿ÏÎ¹ÏƒÎ¼Î­Î½Î¿Ï… ÏÏŒÎ»Î¿Ï… ÏŒÏ€Ï‰Ï‚:

* Î™Î´Î¹Î¿ÎºÏ„Î®Ï„Î·Ï‚
* Î£Ï…Î½Ï„Î¬ÎºÏ„Î·Ï‚
* Î”Î¹Î±Ï‡ÎµÎ¹ÏÎ¹ÏƒÏ„Î®Ï‚ Î‘Ï€Î¿Î¸ÎµÏ„Î·ÏÎ¯Î¿Ï… Î Î·Î³Î®Ï‚ (`roles/source.admin`)
* Î£Ï…Î³Î³ÏÎ±Ï†Î­Î±Ï‚ Î‘Ï€Î¿Î¸ÎµÏ„Î·ÏÎ¯Î¿Ï… Î Î·Î³Î®Ï‚ (`roles/source.writer`)

Î“Î¹Î± Î½Î± Î³ÏÎ¬ÏˆÎµÏ„Îµ Î±Ï€Î»Î¬ ÎµÎºÏ„ÎµÎ»Î­ÏƒÏ„Îµ Î¼Î¹Î± ÎºÎ±Î½Î¿Î½Î¹ÎºÎ® **`git push`**.

### `source.repos.setIamPolicy`

ÎœÎµ Î±Ï…Ï„Î® Ï„Î·Î½ Î¬Î´ÎµÎ¹Î±, Î­Î½Î±Ï‚ ÎµÏ€Î¹Ï„Î¹Î¸Î­Î¼ÎµÎ½Î¿Ï‚ Î¸Î± Î¼Ï€Î¿ÏÎ¿ÏÏƒÎµ Î½Î± Ï€Î±ÏÎ±Ï‡Ï‰ÏÎ®ÏƒÎµÎ¹ ÏƒÏ„Î¿Î½ ÎµÎ±Ï…Ï„ÏŒ Ï„Î¿Ï… Ï„Î¹Ï‚ Ï€ÏÎ¿Î·Î³Î¿ÏÎ¼ÎµÎ½ÎµÏ‚ Î¬Î´ÎµÎ¹ÎµÏ‚.

### Î ÏÏŒÏƒÎ²Î±ÏƒÎ· ÏƒÎµ Î¼Ï…ÏƒÏ„Î¹ÎºÎ¬

Î•Î¬Î½ Î¿ ÎµÏ€Î¹Ï„Î¹Î¸Î­Î¼ÎµÎ½Î¿Ï‚ Î­Ï‡ÎµÎ¹ **Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ· ÏƒÏ„Î± Î¼Ï…ÏƒÏ„Î¹ÎºÎ¬** ÏŒÏ€Î¿Ï… Î±Ï€Î¿Î¸Î·ÎºÎµÏÎ¿Î½Ï„Î±Î¹ Ï„Î± tokens, Î¸Î± Î¼Ï€Î¿ÏÎ­ÏƒÎµÎ¹ Î½Î± Ï„Î± ÎºÎ»Î­ÏˆÎµÎ¹. Î“Î¹Î± Ï€ÎµÏÎ¹ÏƒÏƒÏŒÏ„ÎµÏÎµÏ‚ Ï€Î»Î·ÏÎ¿Ï†Î¿ÏÎ¯ÎµÏ‚ ÏƒÏ‡ÎµÏ„Î¹ÎºÎ¬ Î¼Îµ Ï„Î¿ Ï€ÏÏ‚ Î½Î± Î±Ï€Î¿ÎºÏ„Î®ÏƒÎµÏ„Îµ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ· ÏƒÎµ Î­Î½Î± Î¼Ï…ÏƒÏ„Î¹ÎºÏŒ, ÎµÎ»Î­Î³Î¾Ï„Îµ:

{% content-ref url="gcp-secretmanager-privesc.md" %}
[gcp-secretmanager-privesc.md](gcp-secretmanager-privesc.md)
{% endcontent-ref %}

### Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ· ÎºÎ»ÎµÎ¹Î´Î¹ÏÎ½ SSH

Î•Î¯Î½Î±Î¹ Î´Ï…Î½Î±Ï„Î® Î· **Ï€ÏÎ¿ÏƒÎ¸Î®ÎºÎ· ÎºÎ»ÎµÎ¹Î´Î¹ÏÎ½ ssh ÏƒÏ„Î¿ Î­ÏÎ³Î¿ Ï„Î¿Ï… Î‘Ï€Î¿Î¸ÎµÏ„Î·ÏÎ¯Î¿Ï… Î Î·Î³Î®Ï‚** ÏƒÏ„Î·Î½ Î¹ÏƒÏ„Î¿ÏƒÎµÎ»Î¯Î´Î± ÎºÎ¿Î½ÏƒÏŒÎ»Î±Ï‚. ÎšÎ¬Î½ÎµÎ¹ Î¼Î¹Î± Î±Î¯Ï„Î·ÏƒÎ· POST ÏƒÏ„Î¿ **`/v1/sshKeys:add`** ÎºÎ±Î¹ Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± ÏÏ…Î¸Î¼Î¹ÏƒÏ„ÎµÎ¯ ÏƒÏ„Î¿ [https://source.cloud.google.com/user/ssh\_keys](https://source.cloud.google.com/user/ssh\_keys)

ÎœÏŒÎ»Î¹Ï‚ ÏÏ…Î¸Î¼Î¹ÏƒÏ„ÎµÎ¯ Ï„Î¿ ÎºÎ»ÎµÎ¹Î´Î¯ ssh ÏƒÎ±Ï‚, Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Î±Ï€Î¿ÎºÏ„Î®ÏƒÎµÏ„Îµ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ· ÏƒÎµ Î­Î½Î± Î±Ï€Î¿Î¸ÎµÏ„Î®ÏÎ¹Î¿ Î¼Îµ:

{% code overflow="wrap" %}
```bash
git clone ssh://username@domain.com@source.developers.google.com:2022/p/<proj-name>/r/<repo-name>
```
{% endcode %}

ÎšÎ±Î¹ ÏƒÏ„Î· ÏƒÏ…Î½Î­Ï‡ÎµÎ¹Î± Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î®ÏƒÏ„Îµ Ï„Î¹Ï‚ ÎµÎ½Ï„Î¿Î»Î­Ï‚ **`git`** ÏŒÏ€Ï‰Ï‚ ÏƒÏ…Î½Î®Î¸Ï‰Ï‚.

### Î§ÎµÎ¹ÏÎ¿ÎºÎ¯Î½Î·Ï„Î± Î”Î¹Î±Ï€Î¹ÏƒÏ„ÎµÏ…Ï„Î®ÏÎ¹Î±

Î•Î¯Î½Î±Î¹ Î´Ï…Î½Î±Ï„ÏŒÎ½ Î½Î± Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î®ÏƒÎµÏ„Îµ Ï‡ÎµÎ¹ÏÎ¿ÎºÎ¯Î½Î·Ï„Î± Î´Î¹Î±Ï€Î¹ÏƒÏ„ÎµÏ…Ï„Î®ÏÎ¹Î± Î³Î¹Î± Î½Î± Î±Ï€Î¿ÎºÏ„Î®ÏƒÎµÏ„Îµ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ· ÏƒÏ„Î± Source Repositories:

<figure><img src="../../../.gitbook/assets/image (324).png" alt=""><figcaption></figcaption></figure>

ÎšÎ¬Î½Î¿Î½Ï„Î±Ï‚ ÎºÎ»Î¹Îº ÏƒÏ„Î¿Î½ Ï€ÏÏÏ„Î¿ ÏƒÏÎ½Î´ÎµÏƒÎ¼Î¿ Î¸Î± ÏƒÎ±Ï‚ ÎºÎ±Ï„ÎµÏ…Î¸ÏÎ½ÎµÎ¹ ÏƒÏ„Î¿ [https://source.developers.google.com/auth/start?scopes=https%3A%2F%2Fwww.googleapis.com%2Fauth%2Fcloud-platform\&state\&authuser=3](https://source.developers.google.com/auth/start?scopes=https%3A%2F%2Fwww.googleapis.com%2Fauth%2Fcloud-platform\&state\&authuser=3)

Î¤Î¿ Î¿Ï€Î¿Î¯Î¿ Î¸Î± ÎµÎ¼Ï†Î±Î½Î¯ÏƒÎµÎ¹ Î­Î½Î± **prompt ÎµÎ¾Î¿Ï…ÏƒÎ¹Î¿Î´ÏŒÏ„Î·ÏƒÎ·Ï‚ Oauth** Î³Î¹Î± Î½Î± Î´ÏÏƒÎµÎ¹ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ· ÏƒÏ„Î¿ **Google Cloud Development**. ÎˆÏ„ÏƒÎ¹ Î¸Î± Ï‡ÏÎµÎ¹Î±ÏƒÏ„ÎµÎ¯Ï„Îµ ÎµÎ¯Ï„Îµ Ï„Î± **Î´Î¹Î±Ï€Î¹ÏƒÏ„ÎµÏ…Ï„Î®ÏÎ¹Î± Ï„Î¿Ï… Ï‡ÏÎ®ÏƒÏ„Î·** ÎµÎ¯Ï„Îµ Î¼Î¹Î± **Î±Î½Î¿Î¹Ï‡Ï„Î® ÏƒÏ…Î½ÎµÎ´ÏÎ¯Î± ÏƒÏ„Î¿Î½ Ï€ÎµÏÎ¹Î·Î³Î·Ï„Î®** Î³Î¹Î± Î±Ï…Ï„ÏŒ.

Î‘Ï…Ï„ÏŒ Î¸Î± ÏƒÎ±Ï‚ ÏƒÏ„ÎµÎ¯Î»ÎµÎ¹ ÏƒÎµ Î¼Î¹Î± ÏƒÎµÎ»Î¯Î´Î± Î¼Îµ Î­Î½Î± **bash script Î³Î¹Î± ÎµÎºÏ„Î­Î»ÎµÏƒÎ·** ÎºÎ±Î¹ Î½Î± ÏÏ…Î¸Î¼Î¯ÏƒÎµÏ„Îµ Î­Î½Î± git cookie ÏƒÏ„Î¿ **`$HOME/.gitcookies`**

<figure><img src="../../../.gitbook/assets/image (323).png" alt=""><figcaption></figcaption></figure>

Î•ÎºÏ„ÎµÎ»ÏÎ½Ï„Î±Ï‚ Ï„Î¿ script Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ ÏƒÏ„Î· ÏƒÏ…Î½Î­Ï‡ÎµÎ¹Î± Î½Î± Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î®ÏƒÎµÏ„Îµ git clone, push... ÎºÎ±Î¹ Î¸Î± Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î®ÏƒÎµÎ¹.

### `source.repos.updateProjectConfig`

ÎœÎµ Î±Ï…Ï„Î® Ï„Î·Î½ Î¬Î´ÎµÎ¹Î± ÎµÎ¯Î½Î±Î¹ Î´Ï…Î½Î±Ï„ÏŒÎ½ Î½Î± Î±Ï€ÎµÎ½ÎµÏÎ³Î¿Ï€Î¿Î¹Î®ÏƒÎµÏ„Îµ Ï„Î·Î½ Ï€ÏÎ¿ÎµÏ€Î¹Î»ÎµÎ³Î¼Î­Î½Î· Ï€ÏÎ¿ÏƒÏ„Î±ÏƒÎ¯Î± Ï„Ï‰Î½ Source Repositories Î³Î¹Î± Î½Î± Î¼Î·Î½ Î±Î½ÎµÎ²Î¬ÏƒÎµÏ„Îµ ÎºÏÎ´Î¹ÎºÎ± Ï€Î¿Ï… Ï€ÎµÏÎ¹Î­Ï‡ÎµÎ¹ Î™Î´Î¹Ï‰Ï„Î¹ÎºÎ¬ ÎšÎ»ÎµÎ¹Î´Î¹Î¬:
```bash
gcloud source project-configs update --disable-pushblock
```
ÎœÏ€Î¿ÏÎµÎ¯Ï„Îµ ÎµÏ€Î¯ÏƒÎ·Ï‚ Î½Î± ÏÏ…Î¸Î¼Î¯ÏƒÎµÏ„Îµ Î­Î½Î± Î´Î¹Î±Ï†Î¿ÏÎµÏ„Î¹ÎºÏŒ Î¸Î­Î¼Î± pub/sub Î® Î±ÎºÏŒÎ¼Î· ÎºÎ±Î¹ Î½Î± Ï„Î¿ Î±Ï€ÎµÎ½ÎµÏÎ³Î¿Ï€Î¿Î¹Î®ÏƒÎµÏ„Îµ ÎµÎ½Ï„ÎµÎ»ÏÏ‚:
```bash
gcloud source project-configs update --remove-topic=REMOVE_TOPIC
gcloud source project-configs update --remove-topic=UPDATE_TOPIC
```
{% hint style="success" %}
ÎœÎ¬Î¸ÎµÏ„Îµ & ÎµÎ¾Î±ÏƒÎºÎ·Î¸ÎµÎ¯Ï„Îµ ÏƒÏ„Î¿ AWS Hacking:<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
ÎœÎ¬Î¸ÎµÏ„Îµ & ÎµÎ¾Î±ÏƒÎºÎ·Î¸ÎµÎ¯Ï„Îµ ÏƒÏ„Î¿ GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Î¥Ï€Î¿ÏƒÏ„Î®ÏÎ¹Î¾Î· HackTricks</summary>

* Î•Î»Î­Î³Î¾Ï„Îµ Ï„Î± [**ÏƒÏ‡Î­Î´Î¹Î± ÏƒÏ…Î½Î´ÏÎ¿Î¼Î®Ï‚**](https://github.com/sponsors/carlospolop)!
* **Î•Î³Î³ÏÎ±Ï†ÎµÎ¯Ï„Îµ ÏƒÏ„Î·Î½** ğŸ’¬ [**Î¿Î¼Î¬Î´Î± Discord**](https://discord.gg/hRep4RUj7f) Î® ÏƒÏ„Î·Î½ [**Î¿Î¼Î¬Î´Î± telegram**](https://t.me/peass) Î® **Î±ÎºÎ¿Î»Î¿Ï…Î¸Î®ÏƒÏ„Îµ** Î¼Î±Ï‚ ÏƒÏ„Î¿ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **ÎœÎ¿Î¹ÏÎ±ÏƒÏ„ÎµÎ¯Ï„Îµ ÎºÏŒÎ»Ï€Î± hacking Ï…Ï€Î¿Î²Î¬Î»Î»Î¿Î½Ï„Î±Ï‚ PRs ÏƒÏ„Î±** [**HackTricks**](https://github.com/carlospolop/hacktricks) ÎºÎ±Î¹ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
