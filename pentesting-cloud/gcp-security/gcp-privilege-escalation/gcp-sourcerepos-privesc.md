# GCP - Sourcerepos Privesc

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## ã‚½ãƒ¼ã‚¹ãƒªãƒã‚¸ãƒˆãƒª

ã‚½ãƒ¼ã‚¹ãƒªãƒã‚¸ãƒˆãƒªã«é–¢ã™ã‚‹è©³ç´°æƒ…å ±ã¯ä»¥ä¸‹ã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼š

{% content-ref url="../gcp-services/gcp-source-repositories-enum.md" %}
[gcp-source-repositories-enum.md](../gcp-services/gcp-source-repositories-enum.md)
{% endcontent-ref %}

### `source.repos.get`

ã“ã®æ¨©é™ãŒã‚ã‚Œã°ã€ãƒªãƒã‚¸ãƒˆãƒªã‚’ãƒ­ãƒ¼ã‚«ãƒ«ã«ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ï¼š
```bash
gcloud source repos clone <repo-name> --project=<project-uniq-name>
```
### `source.repos.update`

ã“ã®æ¨©é™ã‚’æŒã¤ãƒ—ãƒªãƒ³ã‚·ãƒ‘ãƒ«ã¯ã€**`gcloud source repos clone <repo>`ã§ã‚¯ãƒ­ãƒ¼ãƒ³ã—ãŸãƒªãƒã‚¸ãƒˆãƒªå†…ã«ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ãã“ã¨ãŒã§ãã¾ã™**ã€‚ãŸã ã—ã€ã“ã®æ¨©é™ã¯ã‚«ã‚¹ã‚¿ãƒ ãƒ­ãƒ¼ãƒ«ã«ä»˜ä¸ã§ããªã„ãŸã‚ã€æ¬¡ã®ã‚ˆã†ãªäº‹å‰å®šç¾©ã•ã‚ŒãŸãƒ­ãƒ¼ãƒ«ã‚’ä»‹ã—ã¦ä»˜ä¸ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ï¼š

* Owner
* Editor
* Source Repository Administrator (`roles/source.admin`)
* Source Repository Writer (`roles/source.writer`)

æ›¸ãè¾¼ã‚€ã«ã¯ã€é€šå¸¸ã®**`git push`**ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚

### `source.repos.setIamPolicy`

ã“ã®æ¨©é™ã‚’æŒã¤æ”»æ’ƒè€…ã¯ã€å‰è¿°ã®æ¨©é™ã‚’è‡ªåˆ†ã«ä»˜ä¸ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

### Secret access

æ”»æ’ƒè€…ãŒ**ãƒˆãƒ¼ã‚¯ãƒ³ãŒä¿å­˜ã•ã‚Œã¦ã„ã‚‹ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹å ´åˆ**ã€å½¼ã¯ãã‚Œã‚‰ã‚’ç›—ã‚€ã“ã¨ãŒã§ãã¾ã™ã€‚ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã¸ã®ã‚¢ã‚¯ã‚»ã‚¹æ–¹æ³•ã«ã¤ã„ã¦ã®è©³ç´°ã¯ã€ä»¥ä¸‹ã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼š

{% content-ref url="gcp-secretmanager-privesc.md" %}
[gcp-secretmanager-privesc.md](gcp-secretmanager-privesc.md)
{% endcontent-ref %}

### Add SSH keys

ã‚¦ã‚§ãƒ–ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§**Source Repositoryãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«SSHã‚­ãƒ¼ã‚’è¿½åŠ ã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™**ã€‚ã“ã‚Œã¯**`/v1/sshKeys:add`**ã¸ã®POSTãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’è¡Œã„ã€[https://source.cloud.google.com/user/ssh\_keys](https://source.cloud.google.com/user/ssh\_keys)ã§è¨­å®šã§ãã¾ã™ã€‚

SSHã‚­ãƒ¼ãŒè¨­å®šã•ã‚Œã‚‹ã¨ã€æ¬¡ã®ã‚ˆã†ã«ãƒªãƒã‚¸ãƒˆãƒªã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã™ï¼š

{% code overflow="wrap" %}
```bash
git clone ssh://username@domain.com@source.developers.google.com:2022/p/<proj-name>/r/<repo-name>
```
{% endcode %}

ãã—ã¦ã€é€šå¸¸é€šã‚Šã«**`git`**ã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚

### æ‰‹å‹•èªè¨¼æƒ…å ±

ã‚½ãƒ¼ã‚¹ãƒªãƒã‚¸ãƒˆãƒªã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ãŸã‚ã®æ‰‹å‹•èªè¨¼æƒ…å ±ã‚’ä½œæˆã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ï¼š

<figure><img src="../../../.gitbook/assets/image (324).png" alt=""><figcaption></figcaption></figure>

æœ€åˆã®ãƒªãƒ³ã‚¯ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨ã€[https://source.developers.google.com/auth/start?scopes=https%3A%2F%2Fwww.googleapis.com%2Fauth%2Fcloud-platform\&state\&authuser=3](https://source.developers.google.com/auth/start?scopes=https%3A%2F%2Fwww.googleapis.com%2Fauth%2Fcloud-platform\&state\&authuser=3)ã«ç§»å‹•ã—ã¾ã™ã€‚

ã“ã‚Œã«ã‚ˆã‚Šã€**Google Cloud Development**ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’è¨±å¯ã™ã‚‹ãŸã‚ã®**Oauthèªè¨¼ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ**ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚ã—ãŸãŒã£ã¦ã€**ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®èªè¨¼æƒ…å ±**ã¾ãŸã¯**ãƒ–ãƒ©ã‚¦ã‚¶ã§ã®ã‚ªãƒ¼ãƒ—ãƒ³ã‚»ãƒƒã‚·ãƒ§ãƒ³**ãŒå¿…è¦ã§ã™ã€‚

ã“ã‚Œã«ã‚ˆã‚Šã€**`$HOME/.gitcookies`**ã«gitã‚¯ãƒƒã‚­ãƒ¼ã‚’è¨­å®šã™ã‚‹ãŸã‚ã®**bashã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å®Ÿè¡Œã™ã‚‹**ãƒšãƒ¼ã‚¸ã«ç§»å‹•ã—ã¾ã™ã€‚

<figure><img src="../../../.gitbook/assets/image (323).png" alt=""><figcaption></figcaption></figure>

ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å®Ÿè¡Œã™ã‚‹ã¨ã€git cloneã€push...ã‚’ä½¿ç”¨ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã€å‹•ä½œã—ã¾ã™ã€‚

### `source.repos.updateProjectConfig`

ã“ã®æ¨©é™ã‚’æŒã¤ã“ã¨ã§ã€ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆã‚­ãƒ¼ã‚’å«ã‚€ã‚³ãƒ¼ãƒ‰ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ãªã„ã‚ˆã†ã«ã‚½ãƒ¼ã‚¹ãƒªãƒã‚¸ãƒˆãƒªã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆä¿è­·ã‚’ç„¡åŠ¹ã«ã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ï¼š
```bash
gcloud source project-configs update --disable-pushblock
```
åˆ¥ã® pub/sub ãƒˆãƒ”ãƒƒã‚¯ã‚’è¨­å®šã™ã‚‹ã‹ã€å®Œå…¨ã«ç„¡åŠ¹ã«ã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™:
```bash
gcloud source project-configs update --remove-topic=REMOVE_TOPIC
gcloud source project-configs update --remove-topic=UPDATE_TOPIC
```
{% hint style="success" %}
AWSãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã³ã€å®Ÿè·µã™ã‚‹ï¼š<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
GCPãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã³ã€å®Ÿè·µã™ã‚‹ï¼š<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricksã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹</summary>

* [**ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³**](https://github.com/sponsors/carlospolop)ã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼
* **ğŸ’¬ [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã¾ãŸã¯[**Telegramã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«å‚åŠ ã™ã‚‹ã‹ã€**Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**ã‚’ãƒ•ã‚©ãƒ­ãƒ¼ã—ã¦ãã ã•ã„ã€‚**
* **[**HackTricks**](https://github.com/carlospolop/hacktricks)ãŠã‚ˆã³[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)ã®GitHubãƒªãƒã‚¸ãƒˆãƒªã«PRã‚’æå‡ºã—ã¦ãƒãƒƒã‚­ãƒ³ã‚°ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã—ã¦ãã ã•ã„ã€‚**

</details>
{% endhint %}
