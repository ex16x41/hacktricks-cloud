# GCP - ã‚³ãƒ³ãƒ†ãƒŠç‰¹æ¨©æ˜‡æ ¼

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## ã‚³ãƒ³ãƒ†ãƒŠ

### `container.clusters.get`

ã“ã®æ¨©é™ã¯ã€**Kubernetes ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã®è³‡æ ¼æƒ…å ±ã‚’åé›†ã™ã‚‹**ã“ã¨ã‚’è¨±å¯ã—ã¾ã™ã€‚
```bash
gcloud container clusters get-credentials <cluster_name> --zone <zone>
```
è¿½åŠ ã®æ¨©é™ãŒãªãã¦ã‚‚ã€è³‡æ ¼æƒ…å ±ã¯éå¸¸ã«åŸºæœ¬çš„ã§ã€**ã„ãã¤ã‹ã®ãƒªã‚½ãƒ¼ã‚¹ã‚’ãƒªã‚¹ãƒˆã™ã‚‹ã“ã¨ãŒã§ãã¾ã™**ãŒã€ç’°å¢ƒå†…ã®èª¤è¨­å®šã‚’è¦‹ã¤ã‘ã‚‹ã®ã«å½¹ç«‹ã¡ã¾ã™ã€‚

{% hint style="info" %}
**Kubernetesã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã¯ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆã«è¨­å®šã•ã‚Œã¦ã„ã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹**ãŸã‚ã€ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã‹ã‚‰Kube-APIã‚µãƒ¼ãƒãƒ¼ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ãŒç¦æ­¢ã•ã‚Œã¾ã™ã€‚
{% endhint %}

ã“ã®æ¨©é™ãŒãªã„å ´åˆã§ã‚‚ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã™ãŒã€**ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã®æƒ…å ±ã‚’å«ã‚€ç‹¬è‡ªã®kubectlè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™**ã€‚æ–°ã—ãç”Ÿæˆã•ã‚ŒãŸã‚‚ã®ã¯æ¬¡ã®ã‚ˆã†ã«ãªã‚Šã¾ã™:
```yaml
apiVersion: v1
clusters:
- cluster:
certificate-authority-data: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUVMRENDQXBTZ0F3SUJBZ0lRRzNaQmJTSVlzeVRPR1FYODRyNDF3REFOQmdrcWhraUc5dzBCQVFzRkFEQXYKTVMwd0t3WURWUVFERXlRMk9UQXhZVEZoWlMweE56ZGxMVFF5TkdZdE9HVmhOaTAzWVdFM01qVmhNR05tTkdFdwpJQmNOTWpJeE1qQTBNakl4T1RJMFdoZ1BNakExTWpFeE1qWXlNekU1TWpSYU1DOHhMVEFyQmdOVkJBTVRKRFk1Ck1ERmhNV0ZsTFRFM04yVXROREkwWmkwNFpXRTJMVGRoWVRjeU5XRXdZMlkwWVRDQ0FhSXdEUVlKS29aSWh2Y04KQVFFQkJRQURnZ0dQQURDQ0FZb0NnZ0dCQU00TWhGemJ3Y3VEQXhiNGt5WndrNEdGNXRHaTZmb0pydExUWkI4Rgo5TDM4a2V2SUVWTHpqVmtoSklpNllnSHg4SytBUHl4RHJQaEhXMk5PczFNMmpyUXJLSHV6M0dXUEtRUmtUWElRClBoMy9MMDVtbURwRGxQK3hKdzI2SFFqdkE2Zy84MFNLakZjRXdKRVhZbkNMMy8yaFBFMzdxN3hZbktwTWdKVWYKVnoxOVhwNEhvbURvOEhUN2JXUTJKWTVESVZPTWNpbDhkdDZQd3FUYmlLNjJoQzNRTHozNzNIbFZxaiszNy90RgpmMmVwUUdFOG90a0VVOFlHQ3FsRTdzaVllWEFqbUQ4bFZENVc5dk1RNXJ0TW8vRHBTVGNxRVZUSzJQWk1rc0hyCmMwbGVPTS9LeXhnaS93TlBRdW5oQ2hnRUJIZTVzRmNxdmRLQ1pmUFovZVI1Qk0vc0w1WFNmTE9sWWJLa2xFL1YKNFBLNHRMVmpiYVg1VU9zMUZIVXMrL3IyL1BKQ2hJTkRaVTV2VjU0L1c5NWk4RnJZaUpEYUVGN0pveXJvUGNuMwpmTmNjQ2x1eGpOY1NsZ01ISGZKRzZqb0FXLzB0b2U3ek05RHlQOFh3NW44Zm5lQm5aVTFnYXNKREZIYVlZbXpGCitoQzFETmVaWXNibWNxOGVPVG9LOFBKRjZ3SURBUUFCbzBJd1FEQU9CZ05WSFE4QkFmOEVCQU1DQWdRd0R3WUQKVlIwVEFRSC9CQVV3QXdFQi96QWRCZ05WSFE0RUZnUVU5UkhvQXlxY3RWSDVIcmhQZ1BjYzF6Sm9kWFV3RFFZSgpLb1pJaHZjTkFRRUxCUUFEZ2dHQkFLbnp3VEx0QlJBVE1KRVB4TlBNbmU2UUNqZDJZTDgxcC9oeVc1eWpYb2w5CllkMTRRNFVlVUJJVXI0QmJadzl0LzRBQ3ZlYUttVENaRCswZ2wyNXVzNzB3VlFvZCtleVhEK2I1RFBwUUR3Z1gKbkJLcFFCY1NEMkpvZ29tT3M3U1lPdWVQUHNrODVvdWEwREpXLytQRkY1WU5ublc3Z1VLT2hNZEtKcnhuYUVGZAprVVl1TVdPT0d4U29qVndmNUsyOVNCbGJ5YXhDNS9tOWkxSUtXV2piWnZPN0s4TTlYLytkcDVSMVJobDZOSVNqCi91SmQ3TDF2R0crSjNlSjZneGs4U2g2L28yRnhxZWFNdDladWw4MFk4STBZaGxXVmlnSFMwZmVBUU1NSzUrNzkKNmozOWtTZHFBYlhPaUVOMzduOWp2dVlNN1ZvQzlNUk1oYUNyQVNhR2ZqWEhtQThCdlIyQW5iQThTVGpQKzlSMQp6VWRpK3dsZ0V4bnFvVFpBcUVHRktuUTlQcjZDaDYvR0xWWStqYXhuR3lyUHFPYlpNZTVXUDFOUGs4NkxHSlhCCjc1elFvanEyRUpxanBNSjgxT0gzSkxOeXRTdmt4UDFwYklxTzV4QUV0OWxRMjh4N28vbnRuaWh1WmR6M0lCRU8KODdjMDdPRGxYNUJQd0hIdzZtKzZjUT09Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K
server: https://34.123.141.28
name: gke_security-devbox_us-central1_autopilot-cluster-1
contexts:
- context:
cluster: gke_security-devbox_us-central1_autopilot-cluster-1
user: gke_security-devbox_us-central1_autopilot-cluster-1
name: gke_security-devbox_us-central1_autopilot-cluster-1
current-context: gke_security-devbox_us-central1_autopilot-cluster-1
kind: Config
preferences: {}
users:
- name: gke_security-devbox_us-central1_autopilot-cluster-1
user:
auth-provider:
config:
access-token: <access token>
cmd-args: config config-helper --format=json
cmd-path: gcloud
expiry: "2022-12-06T01:13:11Z"
expiry-key: '{.credential.token_expiry}'
token-key: '{.credential.access_token}'
name: gcp
```
### `container.roles.escalate` | `container.clusterRoles.escalate`

**Kubernetes** ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã€ãƒ—ãƒªãƒ³ã‚·ãƒ‘ãƒ«ãŒè‡ªåˆ†ãŒæŒã£ã¦ã„ã‚‹æ¨©é™ã‚ˆã‚Šã‚‚**å¤šãã®æ¨©é™**ã‚’æŒã¤**Roles**ã‚„**ClusterRoles**ã‚’**ä½œæˆ**ã¾ãŸã¯**æ›´æ–°**ã§ããªã„ã‚ˆã†ã«**é˜²æ­¢**ã—ã¾ã™ã€‚ã—ã‹ã—ã€æ¨©é™ã‚’æŒã¤**GCP**ã®ãƒ—ãƒªãƒ³ã‚·ãƒ‘ãƒ«ã¯ã€è‡ªåˆ†ãŒæŒã£ã¦ã„ã‚‹æ¨©é™ã‚ˆã‚Šã‚‚**å¤šãã®æ¨©é™**ã‚’æŒã¤**Roles/ClusterRolesã‚’ä½œæˆ/æ›´æ–°**ã§ãã€Kubernetesã®ã“ã®å‹•ä½œã«å¯¾ã™ã‚‹ä¿è­·ã‚’åŠ¹æœçš„ã«å›é¿ã—ã¾ã™ã€‚

**`container.roles.create`**ãŠã‚ˆã³/ã¾ãŸã¯**`container.roles.update`**ã¾ãŸã¯**`container.clusterRoles.create`**ãŠã‚ˆã³/ã¾ãŸã¯**`container.clusterRoles.update`**ã‚‚ã€ã“ã‚Œã‚‰ã®ç‰¹æ¨©æ˜‡æ ¼ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œã™ã‚‹ãŸã‚ã«**å¿…è¦**ã§ã™ã€‚

### `container.roles.bind` | `container.clusterRoles.bind`

**Kubernetes** ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã€ãƒ—ãƒªãƒ³ã‚·ãƒ‘ãƒ«ãŒè‡ªåˆ†ãŒæŒã£ã¦ã„ã‚‹æ¨©é™ã‚ˆã‚Šã‚‚**å¤šãã®æ¨©é™**ã‚’ä¸ãˆã‚‹**RoleBindings**ã‚„**ClusterRoleBindings**ã‚’**ä½œæˆ**ã¾ãŸã¯**æ›´æ–°**ã§ããªã„ã‚ˆã†ã«**é˜²æ­¢**ã—ã¾ã™ã€‚ã—ã‹ã—ã€æ¨©é™ã‚’æŒã¤**GCP**ã®ãƒ—ãƒªãƒ³ã‚·ãƒ‘ãƒ«ã¯ã€è‡ªåˆ†ãŒæŒã£ã¦ã„ã‚‹æ¨©é™ã‚ˆã‚Šã‚‚**å¤šãã®æ¨©é™**ã‚’æŒã¤**RoleBindings/ClusterRoleBindingsã‚’ä½œæˆ/æ›´æ–°**ã§ãã€Kubernetesã®ã“ã®å‹•ä½œã«å¯¾ã™ã‚‹ä¿è­·ã‚’åŠ¹æœçš„ã«å›é¿ã—ã¾ã™ã€‚

**`container.roleBindings.create`**ãŠã‚ˆã³/ã¾ãŸã¯**`container.roleBindings.update`**ã¾ãŸã¯**`container.clusterRoleBindings.create`**ãŠã‚ˆã³/ã¾ãŸã¯**`container.clusterRoleBindings.update`**ã‚‚ã€ã“ã‚Œã‚‰ã®ç‰¹æ¨©æ˜‡æ ¼ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œã™ã‚‹ãŸã‚ã«**å¿…è¦**ã§ã™ã€‚

### `container.cronJobs.create` | `container.cronJobs.update` | `container.daemonSets.create` | `container.daemonSets.update` | `container.deployments.create` | `container.deployments.update` | `container.jobs.create` | `container.jobs.update` | `container.pods.create` | `container.pods.update` | `container.replicaSets.create` | `container.replicaSets.update` | `container.replicationControllers.create` | `container.replicationControllers.update` | `container.scheduledJobs.create` | `container.scheduledJobs.update` | `container.statefulSets.create` | `container.statefulSets.update`

ã“ã‚Œã‚‰ã®ã™ã¹ã¦ã®æ¨©é™ã¯ã€**ãƒªã‚½ãƒ¼ã‚¹ã‚’ä½œæˆã¾ãŸã¯æ›´æ–°**ã™ã‚‹ã“ã¨ã‚’å¯èƒ½ã«ã—ã€ãã“ã§**pod**ã‚’**å®šç¾©**ã§ãã¾ã™ã€‚podã‚’å®šç¾©ã™ã‚‹ã“ã¨ã§ã€**SA**ã‚’**æ·»ä»˜**ã—ã€**å®Ÿè¡Œ**ã•ã‚Œã‚‹**ã‚¤ãƒ¡ãƒ¼ã‚¸**ã‚’æŒ‡å®šã§ãã‚‹ãŸã‚ã€**SAã®ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ã‚ãªãŸã®ã‚µãƒ¼ãƒãƒ¼ã«**ã‚¨ã‚¯ã‚¹ãƒ•ã‚£ãƒ«ãƒˆãƒ¬ãƒ¼ãƒˆã™ã‚‹ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’å®Ÿè¡Œã§ãã€ä»»æ„ã®ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã«æ˜‡æ ¼ã§ãã¾ã™ã€‚\
è©³ç´°ã«ã¤ã„ã¦ã¯ã€æ¬¡ã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼š

GCPç’°å¢ƒã«ã„ã‚‹ãŸã‚ã€**ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿**ã‚µãƒ¼ãƒ“ã‚¹ã‹ã‚‰**ãƒãƒ¼ãƒ‰ãƒ—ãƒ¼ãƒ«GCP SA**ã‚’**å–å¾—**ã—ã€**GCPã§ç‰¹æ¨©ã‚’æ˜‡æ ¼**ã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ãƒˆSAãŒä½¿ç”¨ã•ã‚Œã¾ã™ï¼‰ã€‚

### `container.secrets.get` | `container.secrets.list`

[**ã“ã®ãƒšãƒ¼ã‚¸ã§èª¬æ˜ã•ã‚Œã¦ã„ã‚‹ã‚ˆã†ã«**](../../kubernetes-security/abusing-roles-clusterroles-in-kubernetes/#listing-secrets)ã€ã“ã‚Œã‚‰ã®æ¨©é™ã‚’ä½¿ç”¨ã™ã‚‹ã¨ã€ã™ã¹ã¦ã®**Kubernetesã®SAã®ãƒˆãƒ¼ã‚¯ãƒ³**ã‚’**èª­ã¿å–ã‚‹**ã“ã¨ãŒã§ãã‚‹ãŸã‚ã€ãã‚Œã‚‰ã«æ˜‡æ ¼ã§ãã¾ã™ã€‚

### `container.pods.exec`

ã“ã®æ¨©é™ã‚’æŒã¤ã“ã¨ã§ã€**podã«exec**ã§ãã€**Kubernetesã®SAã«ã‚¢ã‚¯ã‚»ã‚¹**ã—ã¦K8så†…ã§ç‰¹æ¨©ã‚’æ˜‡æ ¼ã•ã›ã‚‹ã“ã¨ãŒã§ãã¾ã™ãŒã€**NodePoolã®GCPã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’**ã‚‚**ç›—ã‚€**ã“ã¨ãŒã§ãã€**GCPã§ç‰¹æ¨©ã‚’æ˜‡æ ¼**ã•ã›ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ã€‚

### `container.pods.portForward`

**ã“ã®ãƒšãƒ¼ã‚¸ã§èª¬æ˜ã•ã‚Œã¦ã„ã‚‹ã‚ˆã†ã«**ã€ã“ã‚Œã‚‰ã®æ¨©é™ã‚’ä½¿ç”¨ã™ã‚‹ã¨ã€**pod**ã§å®Ÿè¡Œã•ã‚Œã¦ã„ã‚‹**ãƒ­ãƒ¼ã‚«ãƒ«ã‚µãƒ¼ãƒ“ã‚¹ã«ã‚¢ã‚¯ã‚»ã‚¹**ã§ãã€**Kubernetesã§ç‰¹æ¨©ã‚’æ˜‡æ ¼**ã•ã›ã‚‹ã“ã¨ãŒã§ãã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ï¼ˆãã—ã¦ã€**GCP**ã§ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚µãƒ¼ãƒ“ã‚¹ã«æ¥ç¶šã§ãã‚Œã°ï¼‰ã€‚

### `container.serviceAccounts.createToken`

**æ¨©é™ã®åå‰**ã‹ã‚‰ã€**K8sã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ç”Ÿæˆ**ã™ã‚‹ã“ã¨ã‚’**è¨±å¯**ã™ã‚‹ã‚ˆã†ã«è¦‹ãˆã¾ã™ã®ã§ã€Kuberneteså†…ã®**ä»»æ„ã®SAã«æ˜‡æ ¼**ã§ãã‚‹ã§ã—ã‚‡ã†ã€‚ã—ã‹ã—ã€ä½¿ç”¨ã™ã‚‹APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’è¦‹ã¤ã‘ã‚‰ã‚Œãªã‹ã£ãŸã®ã§ã€è¦‹ã¤ã‘ãŸã‚‰æ•™ãˆã¦ãã ã•ã„ã€‚

### `container.mutatingWebhookConfigurations.create` | `container.mutatingWebhookConfigurations.update`

ã“ã‚Œã‚‰ã®æ¨©é™ã¯Kubernetesã§ç‰¹æ¨©ã‚’æ˜‡æ ¼ã•ã›ã‚‹ã“ã¨ã‚’å¯èƒ½ã«ã™ã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ãŒã€ã‚ˆã‚Šå¯èƒ½æ€§ãŒé«˜ã„ã®ã¯ã€ã“ã‚Œã‚‰ã‚’æ‚ªç”¨ã—ã¦**ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã«æŒç¶šã™ã‚‹**ã“ã¨ã§ã™ã€‚\
è©³ç´°ã«ã¤ã„ã¦ã¯ã€[**ã“ã®ãƒªãƒ³ã‚¯ã‚’ãƒ•ã‚©ãƒ­ãƒ¼**](../../kubernetes-security/abusing-roles-clusterroles-in-kubernetes/#malicious-admission-controller)ã—ã¦ãã ã•ã„ã€‚

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
