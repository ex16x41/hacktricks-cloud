# GCP - Container Privesc

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## container

### `container.clusters.get`

ì´ ê¶Œí•œì€ **Kubernetes í´ëŸ¬ìŠ¤í„°ì— ëŒ€í•œ ìê²© ì¦ëª…ì„ ìˆ˜ì§‘í•  ìˆ˜ ìˆê²Œ í•´ì¤ë‹ˆë‹¤**.
```bash
gcloud container clusters get-credentials <cluster_name> --zone <zone>
```
ì¶”ê°€ ê¶Œí•œ ì—†ì´ ìê²© ì¦ëª…ì€ ê¸°ë³¸ì ì´ë©° **ì¼ë¶€ ë¦¬ì†ŒìŠ¤ë¥¼ ë‚˜ì—´í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤**, ê·¸ëŸ¬ë‚˜ ì´ëŠ” í™˜ê²½ì—ì„œ ì˜ëª» êµ¬ì„±ëœ ë¶€ë¶„ì„ ì°¾ëŠ” ë° ìœ ìš©í•©ë‹ˆë‹¤.

{% hint style="info" %}
**ì¿ ë²„ë„¤í‹°ìŠ¤ í´ëŸ¬ìŠ¤í„°ê°€ ë¹„ê³µì‹ì ìœ¼ë¡œ êµ¬ì„±ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤**. ì´ëŠ” ì¸í„°ë„·ì—ì„œ Kube-API ì„œë²„ì— ëŒ€í•œ ì ‘ê·¼ì„ í—ˆìš©í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
{% endhint %}

ì´ ê¶Œí•œì´ ì—†ë”ë¼ë„ í´ëŸ¬ìŠ¤í„°ì— ì ‘ê·¼í•  ìˆ˜ ìˆì§€ë§Œ, **í´ëŸ¬ìŠ¤í„° ì •ë³´ë¥¼ í¬í•¨í•œ ìì‹ ì˜ kubectl êµ¬ì„± íŒŒì¼ì„ ìƒì„±í•´ì•¼ í•©ë‹ˆë‹¤**. ìƒˆë¡œ ìƒì„±ëœ íŒŒì¼ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤:
```yaml
apiVersion: v1
clusters:
- cluster:
certificate-authority-data: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUVMRENDQXBTZ0F3SUJBZ0lRRzNaQmJTSVlzeVRPR1FYODRyNDF3REFOQmdrcWhraUc5dzBCQVFzRkFEQXYKTVMwd0t3WURWUVFERXlRMk9UQXhZVEZoWlMweE56ZGxMVFF5TkdZdE9HVmhOaTAzWVdFM01qVmhNR05tTkdFdwpJQmNOTWpJeE1qQTBNakl4T1RJMFdoZ1BNakExTWpFeE1qWXlNekU1TWpSYU1DOHhMVEFyQmdOVkJBTVRKRFk1Ck1ERmhNV0ZsTFRFM04yVXROREkwWmkwNFpXRTJMVGRoWVRjeU5XRXdZMlkwWVRDQ0FhSXdEUVlKS29aSWh2Y04KQVFFQkJRQURnZ0dQQURDQ0FZb0NnZ0dCQU00TWhGemJ3Y3VEQXhiNGt5WndrNEdGNXRHaTZmb0pydExUWkI4Rgo5TDM4a2V2SUVWTHpqVmtoSklpNllnSHg4SytBUHl4RHJQaEhXMk5PczFNMmpyUXJLSHV6M0dXUEtRUmtUWElRClBoMy9MMDVtbURwRGxQK3hKdzI2SFFqdkE2Zy84MFNLakZjRXdKRVhZbkNMMy8yaFBFMzdxN3hZbktwTWdKVWYKVnoxOVhwNEhvbURvOEhUN2JXUTJKWTVESVZPTWNpbDhkdDZQd3FUYmlLNjJoQzNRTHozNzNIbFZxaiszNy90RgpmMmVwUUdFOG90a0VVOFlHQ3FsRTdzaVllWEFqbUQ4bFZENVc5dk1RNXJ0TW8vRHBTVGNxRVZUSzJQWk1rc0hyCmMwbGVPTS9LeXhnaS93TlBRdW5oQ2hnRUJIZTVzRmNxdmRLQ1pmUFovZVI1Qk0vc0w1WFNmTE9sWWJLa2xFL1YKNFBLNHRMVmpiYVg1VU9zMUZIVXMrL3IyL1BKQ2hJTkRaVTV2VjU0L1c5NWk4RnJZaUpEYUVGN0pveXJvUGNuMwpmTmNjQ2x1eGpOY1NsZ01ISGZKRzZqb0FXLzB0b2U3ek05RHlQOFh3NW44Zm5lQm5aVTFnYXNKREZIYVlZbXpGCitoQzFETmVaWXNibWNxOGVPVG9LOFBKRjZ3SURBUUFCbzBJd1FEQU9CZ05WSFE4QkFmOEVCQU1DQWdRd0R3WUQKVlIwVEFRSC9CQVV3QXdFQi96QWRCZ05WSFE0RUZnUVU5UkhvQXlxY3RWSDVIcmhQZ1BjYzF6Sm9kWFV3RFFZSgpLb1pJaHZjTkFRRUxCUUFEZ2dHQkFLbnp3VEx0QlJBVE1KRVB4TlBNbmU2UUNqZDJZTDgxcC9oeVc1eWpYb2w5CllkMTRRNFVlVUJJVXI0QmJadzl0LzRBQ3ZlYUttVENaRCswZ2wyNXVzNzB3VlFvZCtleVhEK2I1RFBwUUR3Z1gKbkJLcFFCY1NEMkpvZ29tT3M3U1lPdWVQUHNrODVvdWEwREpXLytQRkY1WU5ublc3Z1VLT2hNZEtKcnhuYUVGZAprVVl1TVdPT0d4U29qVndmNUsyOVNCbGJ5YXhDNS9tOWkxSUtXV2piWnZPN0s4TTlYLytkcDVSMVJobDZOSVNqCi91SmQ3TDF2R0crSjNlSjZneGs4U2g2L28yRnhxZWFNdDladWw4MFk4STBZaGxXVmlnSFMwZmVBUU1NSzUrNzkKNmozOWtTZHFBYlhPaUVOMzduOWp2dVlNN1ZvQzlNUk1oYUNyQVNhR2ZqWEhtQThCdlIyQW5iQThTVGpQKzlSMQp6VWRpK3dsZ0V4bnFvVFpBcUVHRktuUTlQcjZDaDYvR0xWWStqYXhuR3lyUHFPYlpNZTVXUDFOUGs4NkxHSlhCCjc1elFvanEyRUpxanBNSjgxT0gzSkxOeXRTdmt4UDFwYklxTzV4QUV0OWxRMjh4N28vbnRuaWh1WmR6M0lCRU8KODdjMDdPRGxYNUJQd0hIdzZtKzZjUT09Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K
server: https://34.123.141.28
name: gke_security-devbox_us-central1_autopilot-cluster-1
contexts:
- context:
cluster: gke_security-devbox_us-central1_autopilot-cluster-1
user: gke_security-devbox_us-central1_autopilot-cluster-1
name: gke_security-devbox_us-central1_autopilot-cluster-1
current-context: gke_security-devbox_us-central1_autopilot-cluster-1
kind: Config
preferences: {}
users:
- name: gke_security-devbox_us-central1_autopilot-cluster-1
user:
auth-provider:
config:
access-token: <access token>
cmd-args: config config-helper --format=json
cmd-path: gcloud
expiry: "2022-12-06T01:13:11Z"
expiry-key: '{.credential.token_expiry}'
token-key: '{.credential.access_token}'
name: gcp
```
### `container.roles.escalate` | `container.clusterRoles.escalate`

**Kubernetes**ëŠ” ê¸°ë³¸ì ìœ¼ë¡œ ì£¼ì²´ê°€ **ë” ë§ì€ ê¶Œí•œ**ì„ ê°€ì§„ **Roles** ë° **ClusterRoles**ë¥¼ **ìƒì„±**í•˜ê±°ë‚˜ **ì—…ë°ì´íŠ¸**í•˜ëŠ” ê²ƒì„ **ë°©ì§€**í•©ë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ í•´ë‹¹ ê¶Œí•œì„ ê°€ì§„ **GCP** ì£¼ì²´ëŠ” **ë” ë§ì€ ê¶Œí•œ**ì„ ê°€ì§„ Roles/ClusterRolesë¥¼ **ìƒì„±/ì—…ë°ì´íŠ¸**í•  ìˆ˜ ìˆì–´, Kubernetesì˜ ì´ëŸ¬í•œ í–‰ë™ì— ëŒ€í•œ ë³´í˜¸ë¥¼ íš¨ê³¼ì ìœ¼ë¡œ ìš°íšŒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

**`container.roles.create`** ë°/ë˜ëŠ” **`container.roles.update`** ë˜ëŠ” **`container.clusterRoles.create`** ë°/ë˜ëŠ” **`container.clusterRoles.update`**ëŠ” ê°ê° ì´ëŸ¬í•œ ê¶Œí•œ ìƒìŠ¹ ì‘ì—…ì„ ìˆ˜í–‰í•˜ëŠ” ë° **í•„ìš”í•©ë‹ˆë‹¤**.

### `container.roles.bind` | `container.clusterRoles.bind`

**Kubernetes**ëŠ” ê¸°ë³¸ì ìœ¼ë¡œ ì£¼ì²´ê°€ **ë” ë§ì€ ê¶Œí•œ**ì„ ê°€ì§„ **RoleBindings** ë° **ClusterRoleBindings**ë¥¼ **ìƒì„±**í•˜ê±°ë‚˜ **ì—…ë°ì´íŠ¸**í•˜ëŠ” ê²ƒì„ **ë°©ì§€**í•©ë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ í•´ë‹¹ ê¶Œí•œì„ ê°€ì§„ **GCP** ì£¼ì²´ëŠ” **ë” ë§ì€ ê¶Œí•œ**ì„ ê°€ì§„ RoleBindings/ClusterRolesBindingsë¥¼ **ìƒì„±/ì—…ë°ì´íŠ¸**í•  ìˆ˜ ìˆì–´, Kubernetesì˜ ì´ëŸ¬í•œ í–‰ë™ì— ëŒ€í•œ ë³´í˜¸ë¥¼ íš¨ê³¼ì ìœ¼ë¡œ ìš°íšŒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

**`container.roleBindings.create`** ë°/ë˜ëŠ” **`container.roleBindings.update`** ë˜ëŠ” **`container.clusterRoleBindings.create`** ë°/ë˜ëŠ” **`container.clusterRoleBindings.update`**ëŠ” ê°ê° ì´ëŸ¬í•œ ê¶Œí•œ ìƒìŠ¹ ì‘ì—…ì„ ìˆ˜í–‰í•˜ëŠ” ë° **í•„ìš”í•©ë‹ˆë‹¤**.

### `container.cronJobs.create` | `container.cronJobs.update` | `container.daemonSets.create` | `container.daemonSets.update` | `container.deployments.create` | `container.deployments.update` | `container.jobs.create` | `container.jobs.update` | `container.pods.create` | `container.pods.update` | `container.replicaSets.create` | `container.replicaSets.update` | `container.replicationControllers.create` | `container.replicationControllers.update` | `container.scheduledJobs.create` | `container.scheduledJobs.update` | `container.statefulSets.create` | `container.statefulSets.update`

ì´ ëª¨ë“  ê¶Œí•œì€ **ë¦¬ì†ŒìŠ¤ë¥¼ ìƒì„±í•˜ê±°ë‚˜ ì—…ë°ì´íŠ¸**í•  ìˆ˜ ìˆê²Œ í•´ì£¼ë©°, ì—¬ê¸°ì„œ **pod**ë¥¼ **ì •ì˜**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. podë¥¼ ì •ì˜í•¨ìœ¼ë¡œì¨ **SA**ë¥¼ **ì²¨ë¶€**í•˜ê³  **ì‹¤í–‰í•  ì´ë¯¸ì§€**ë¥¼ **ì§€ì •**í•  ìˆ˜ ìˆìœ¼ë¯€ë¡œ, **SAì˜ í† í°ì„ ì„œë²„ë¡œ ìœ ì¶œ**í•˜ëŠ” ì´ë¯¸ì§€ë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆì–´, ì–´ë–¤ ì„œë¹„ìŠ¤ ê³„ì •ìœ¼ë¡œë„ ê¶Œí•œ ìƒìŠ¹ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.\
ìì„¸í•œ ì •ë³´ëŠ” í™•ì¸í•˜ì„¸ìš”:

GCP í™˜ê²½ì— ìˆìœ¼ë¯€ë¡œ, **ë©”íƒ€ë°ì´í„°** ì„œë¹„ìŠ¤ì—ì„œ **nodepool GCP SA**ë¥¼ **ê°€ì ¸ì˜¤ê³ ** **GCPì—ì„œ ê¶Œí•œì„ ìƒìŠ¹**ì‹œí‚¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤ (ê¸°ë³¸ì ìœ¼ë¡œ ì»´í“¨íŠ¸ SAê°€ ì‚¬ìš©ë©ë‹ˆë‹¤).

### `container.secrets.get` | `container.secrets.list`

[**ì´ í˜ì´ì§€ì—ì„œ ì„¤ëª…í•œ ë°”ì™€ ê°™ì´**](../../kubernetes-security/abusing-roles-clusterroles-in-kubernetes/#listing-secrets) ì´ ê¶Œí•œìœ¼ë¡œ ëª¨ë“  **Kubernetesì˜ SA**ì˜ **í† í°**ì„ **ì½ì„** ìˆ˜ ìˆì–´, ì´ë“¤ë¡œ ê¶Œí•œì„ ìƒìŠ¹ì‹œí‚¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### `container.pods.exec`

ì´ ê¶Œí•œìœ¼ë¡œ **podì— exec**í•  ìˆ˜ ìˆì–´, **Kubernetes SAs**ì— **ì ‘ê·¼**í•˜ì—¬ K8s ë‚´ì—ì„œ ê¶Œí•œì„ ìƒìŠ¹ì‹œí‚¬ ìˆ˜ ìˆìœ¼ë©°, ë˜í•œ **NodePool**ì˜ **GCP ì„œë¹„ìŠ¤ ê³„ì •**ì„ **íƒˆì·¨**í•˜ì—¬ **GCPì—ì„œ ê¶Œí•œì„ ìƒìŠ¹**ì‹œí‚¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### `container.pods.portForward`

[**ì´ í˜ì´ì§€ì—ì„œ ì„¤ëª…í•œ ë°”ì™€ ê°™ì´**](../../kubernetes-security/abusing-roles-clusterroles-in-kubernetes/#listing-secrets) ì´ ê¶Œí•œìœ¼ë¡œ **podì—ì„œ ì‹¤í–‰ ì¤‘ì¸ ë¡œì»¬ ì„œë¹„ìŠ¤**ì— **ì ‘ê·¼**í•  ìˆ˜ ìˆì–´, **Kubernetesì—ì„œ ê¶Œí•œì„ ìƒìŠ¹**ì‹œí‚¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤ (ê·¸ë¦¬ê³  **GCP**ì—ì„œ ë©”íƒ€ë°ì´í„° ì„œë¹„ìŠ¤ì™€ í†µì‹ í•  ìˆ˜ ìˆë‹¤ë©´).

### `container.serviceAccounts.createToken`

**ê¶Œí•œ**ì˜ **ì´ë¦„** ë•Œë¬¸ì—, **K8s ì„œë¹„ìŠ¤ ê³„ì •ì˜ í† í°ì„ ìƒì„±**í•  ìˆ˜ ìˆì„ ê²ƒì²˜ëŸ¼ ë³´ì…ë‹ˆë‹¤. ë”°ë¼ì„œ Kubernetes ë‚´ì˜ **ì–´ë–¤ SAë¡œë„ ê¶Œí•œ ìƒìŠ¹**ì´ ê°€ëŠ¥í•  ê²ƒì…ë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ ì´ë¥¼ ì‚¬ìš©í•  API ì—”ë“œí¬ì¸íŠ¸ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìœ¼ë‹ˆ, ë°œê²¬í•˜ë©´ ì•Œë ¤ì£¼ì„¸ìš”.

### `container.mutatingWebhookConfigurations.create` | `container.mutatingWebhookConfigurations.update`

ì´ ê¶Œí•œì€ Kubernetesì—ì„œ ê¶Œí•œì„ ìƒìŠ¹ì‹œí‚¬ ìˆ˜ ìˆì§€ë§Œ, ë” ê°€ëŠ¥ì„±ì´ ë†’ì€ ê²ƒì€ **í´ëŸ¬ìŠ¤í„°ì— ì§€ì†ì ìœ¼ë¡œ ë‚¨ì•„ìˆê¸° ìœ„í•´ ì•…ìš©**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\
ìì„¸í•œ ì •ë³´ëŠ” [**ì´ ë§í¬ë¥¼ ë”°ë¼ê°€ì„¸ìš”**](../../kubernetes-security/abusing-roles-clusterroles-in-kubernetes/#malicious-admission-controller).

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
