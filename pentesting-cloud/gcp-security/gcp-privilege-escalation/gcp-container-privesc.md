# GCP - ì»¨í…Œì´ë„ˆ ê¶Œí•œ ìƒìŠ¹

{% hint style="success" %}
AWS í•´í‚¹ í•™ìŠµ ë° ì‹¤ìŠµ:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCP í•´í‚¹ í•™ìŠµ ë° ì‹¤ìŠµ: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks ì§€ì›</summary>

* [**êµ¬ë… ìš”ê¸ˆì œ**](https://github.com/sponsors/carlospolop)ë¥¼ í™•ì¸í•˜ì„¸ìš”!
* ğŸ’¬ [**ë””ìŠ¤ì½”ë“œ ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— **ê°€ì…**í•˜ê±°ë‚˜ **íŠ¸ìœ„í„°** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**ë¥¼ íŒ”ë¡œìš°**í•˜ì„¸ìš”.
* [**HackTricks**](https://github.com/carlospolop/hacktricks) ë° [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) ê¹ƒí—™ ë ˆí¬ì§€í† ë¦¬ì— PRì„ ì œì¶œí•˜ì—¬ í•´í‚¹ ìš”ë ¹ì„ ê³µìœ í•˜ì„¸ìš”.

</details>
{% endhint %}

## container

### `container.clusters.get`

ì´ ê¶Œí•œì€ **ì¿ ë²„ë„¤í‹°ìŠ¤ í´ëŸ¬ìŠ¤í„°ì˜ ìê²© ì¦ëª…ì„ ìˆ˜ì§‘**í•  ìˆ˜ ìˆê²Œ í•©ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´ ë‹¤ìŒê³¼ ê°™ì´ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```bash
gcloud container clusters get-credentials <cluster_name> --zone <zone>
```
**ì¶”ê°€ ê¶Œí•œ ì—†ì´ëŠ” ìê²© ì¦ëª…ì´ ë§¤ìš° ê¸°ë³¸ì ì…ë‹ˆë‹¤.** ì¼ë¶€ ë¦¬ì†ŒìŠ¤ë¥¼ **ì—´ê±°í•  ìˆ˜ë§Œ ìˆìŠµë‹ˆë‹¤**, ê·¸ëŸ¬ë‚˜ í™˜ê²½ì—ì„œ êµ¬ì„± ì˜¤ë¥˜ë¥¼ ì°¾ëŠ” ë° ìœ ìš©í•©ë‹ˆë‹¤.

{% hint style="info" %}
**ì¿ ë²„ë„¤í‹°ìŠ¤ í´ëŸ¬ìŠ¤í„°ê°€ ë¹„ê³µê°œë¡œ êµ¬ì„±**ë  ìˆ˜ ìˆë‹¤ëŠ” ì ì— ìœ ì˜í•˜ì‹­ì‹œì˜¤. ì´ëŠ” ì¸í„°ë„·ì—ì„œ Kube-API ì„œë²„ì— ì•¡ì„¸ìŠ¤í•˜ëŠ” ê²ƒì„ ê¸ˆì§€í•©ë‹ˆë‹¤.
{% endhint %}

ì´ ê¶Œí•œì´ ì—†ë”ë¼ë„ í´ëŸ¬ìŠ¤í„°ì— ì•¡ì„¸ìŠ¤í•  ìˆ˜ ìˆì§€ë§Œ, í´ëŸ¬ìŠ¤í„° ì •ë³´ë¥¼ ì‚¬ìš©í•˜ì—¬ **ìì²´ kubectl êµ¬ì„± íŒŒì¼ì„ ìƒì„±í•´ì•¼** í•©ë‹ˆë‹¤. ìƒˆë¡œ ìƒì„±ëœ íŒŒì¼ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤:
```yaml
apiVersion: v1
clusters:
- cluster:
certificate-authority-data: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUVMRENDQXBTZ0F3SUJBZ0lRRzNaQmJTSVlzeVRPR1FYODRyNDF3REFOQmdrcWhraUc5dzBCQVFzRkFEQXYKTVMwd0t3WURWUVFERXlRMk9UQXhZVEZoWlMweE56ZGxMVFF5TkdZdE9HVmhOaTAzWVdFM01qVmhNR05tTkdFdwpJQmNOTWpJeE1qQTBNakl4T1RJMFdoZ1BNakExTWpFeE1qWXlNekU1TWpSYU1DOHhMVEFyQmdOVkJBTVRKRFk1Ck1ERmhNV0ZsTFRFM04yVXROREkwWmkwNFpXRTJMVGRoWVRjeU5XRXdZMlkwWVRDQ0FhSXdEUVlKS29aSWh2Y04KQVFFQkJRQURnZ0dQQURDQ0FZb0NnZ0dCQU00TWhGemJ3Y3VEQXhiNGt5WndrNEdGNXRHaTZmb0pydExUWkI4Rgo5TDM4a2V2SUVWTHpqVmtoSklpNllnSHg4SytBUHl4RHJQaEhXMk5PczFNMmpyUXJLSHV6M0dXUEtRUmtUWElRClBoMy9MMDVtbURwRGxQK3hKdzI2SFFqdkE2Zy84MFNLakZjRXdKRVhZbkNMMy8yaFBFMzdxN3hZbktwTWdKVWYKVnoxOVhwNEhvbURvOEhUN2JXUTJKWTVESVZPTWNpbDhkdDZQd3FUYmlLNjJoQzNRTHozNzNIbFZxaiszNy90RgpmMmVwUUdFOG90a0VVOFlHQ3FsRTdzaVllWEFqbUQ4bFZENVc5dk1RNXJ0TW8vRHBTVGNxRVZUSzJQWk1rc0hyCmMwbGVPTS9LeXhnaS93TlBRdW5oQ2hnRUJIZTVzRmNxdmRLQ1pmUFovZVI1Qk0vc0w1WFNmTE9sWWJLa2xFL1YKNFBLNHRMVmpiYVg1VU9zMUZIVXMrL3IyL1BKQ2hJTkRaVTV2VjU0L1c5NWk4RnJZaUpEYUVGN0pveXJvUGNuMwpmTmNjQ2x1eGpOY1NsZ01ISGZKRzZqb0FXLzB0b2U3ek05RHlQOFh3NW44Zm5lQm5aVTFnYXNKREZIYVlZbXpGCitoQzFETmVaWXNibWNxOGVPVG9LOFBKRjZ3SURBUUFCbzBJd1FEQU9CZ05WSFE4QkFmOEVCQU1DQWdRd0R3WUQKVlIwVEFRSC9CQVV3QXdFQi96QWRCZ05WSFE0RUZnUVU5UkhvQXlxY3RWSDVIcmhQZ1BjYzF6Sm9kWFV3RFFZSgpLb1pJaHZjTkFRRUxCUUFEZ2dHQkFLbnp3VEx0QlJBVE1KRVB4TlBNbmU2UUNqZDJZTDgxcC9oeVc1eWpYb2w5CllkMTRRNFVlVUJJVXI0QmJadzl0LzRBQ3ZlYUttVENaRCswZ2wyNXVzNzB3VlFvZCtleVhEK2I1RFBwUUR3Z1gKbkJLcFFCY1NEMkpvZ29tT3M3U1lPdWVQUHNrODVvdWEwREpXLytQRkY1WU5ublc3Z1VLT2hNZEtKcnhuYUVGZAprVVl1TVdPT0d4U29qVndmNUsyOVNCbGJ5YXhDNS9tOWkxSUtXV2piWnZPN0s4TTlYLytkcDVSMVJobDZOSVNqCi91SmQ3TDF2R0crSjNlSjZneGs4U2g2L28yRnhxZWFNdDladWw4MFk4STBZaGxXVmlnSFMwZmVBUU1NSzUrNzkKNmozOWtTZHFBYlhPaUVOMzduOWp2dVlNN1ZvQzlNUk1oYUNyQVNhR2ZqWEhtQThCdlIyQW5iQThTVGpQKzlSMQp6VWRpK3dsZ0V4bnFvVFpBcUVHRktuUTlQcjZDaDYvR0xWWStqYXhuR3lyUHFPYlpNZTVXUDFOUGs4NkxHSlhCCjc1elFvanEyRUpxanBNSjgxT0gzSkxOeXRTdmt4UDFwYklxTzV4QUV0OWxRMjh4N28vbnRuaWh1WmR6M0lCRU8KODdjMDdPRGxYNUJQd0hIdzZtKzZjUT09Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K
server: https://34.123.141.28
name: gke_security-devbox_us-central1_autopilot-cluster-1
contexts:
- context:
cluster: gke_security-devbox_us-central1_autopilot-cluster-1
user: gke_security-devbox_us-central1_autopilot-cluster-1
name: gke_security-devbox_us-central1_autopilot-cluster-1
current-context: gke_security-devbox_us-central1_autopilot-cluster-1
kind: Config
preferences: {}
users:
- name: gke_security-devbox_us-central1_autopilot-cluster-1
user:
auth-provider:
config:
access-token: <access token>
cmd-args: config config-helper --format=json
cmd-path: gcloud
expiry: "2022-12-06T01:13:11Z"
expiry-key: '{.credential.token_expiry}'
token-key: '{.credential.access_token}'
name: gcp
```
### `container.roles.escalate` | `container.clusterRoles.escalate`

**Kubernetes**ëŠ” ê¸°ë³¸ì ìœ¼ë¡œ ì£¼ì²´(principals)ê°€ ê°€ì§„ ê¶Œí•œë³´ë‹¤ ë” ë§ì€ ê¶Œí•œì„ ê°–ëŠ” **Roles** ë° **ClusterRoles**ë¥¼ **ìƒì„±**í•˜ê±°ë‚˜ **ì—…ë°ì´íŠ¸**í•˜ëŠ” ê²ƒì„ **ë°©ì§€**í•©ë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ í•´ë‹¹ ê¶Œí•œì„ ê°€ì§„ **GCP** ì£¼ì²´ëŠ” ì´ëŸ¬í•œ ë™ì‘ì— ëŒ€í•œ Kubernetes ë³´í˜¸ë¥¼ ìš°íšŒí•˜ì—¬ ë” ë§ì€ ê¶Œí•œì„ ê°–ëŠ” Roles/ClusterRolesë¥¼ ìƒì„±/ì—…ë°ì´íŠ¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

**`container.roles.create`** ë°/ë˜ëŠ” **`container.roles.update`** ë˜ëŠ” **`container.clusterRoles.create`** ë°/ë˜ëŠ” **`container.clusterRoles.update`** ë˜í•œ ì´ëŸ¬í•œ ê¶Œí•œ ìƒìŠ¹ ë™ì‘ì„ ìˆ˜í–‰í•˜ëŠ” ë° **í•„ìš”**í•©ë‹ˆë‹¤.

### `container.roles.bind` | `container.clusterRoles.bind`

**Kubernetes**ëŠ” ê¸°ë³¸ì ìœ¼ë¡œ ì£¼ì²´(principals)ê°€ ê°€ì§„ ê¶Œí•œë³´ë‹¤ ë” ë§ì€ ê¶Œí•œì„ ë¶€ì—¬í•˜ê¸° ìœ„í•´ **RoleBindings** ë° **ClusterRoleBindings**ë¥¼ **ìƒì„±**í•˜ê±°ë‚˜ **ì—…ë°ì´íŠ¸**í•˜ëŠ” ê²ƒì„ **ë°©ì§€**í•©ë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ í•´ë‹¹ ê¶Œí•œì„ ê°€ì§„ **GCP** ì£¼ì²´ëŠ” ì´ëŸ¬í•œ ë™ì‘ì— ëŒ€í•œ Kubernetes ë³´í˜¸ë¥¼ ìš°íšŒí•˜ì—¬ ë” ë§ì€ ê¶Œí•œì„ ê°–ëŠ” RoleBindings/ClusterRoleBindingsë¥¼ ìƒì„±/ì—…ë°ì´íŠ¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

**`container.roleBindings.create`** ë°/ë˜ëŠ” **`container.roleBindings.update`** ë˜ëŠ” **`container.clusterRoleBindings.create`** ë°/ë˜ëŠ” **`container.clusterRoleBindings.update`** ë˜í•œ ì´ëŸ¬í•œ ê¶Œí•œ ìƒìŠ¹ ë™ì‘ì„ ìˆ˜í–‰í•˜ëŠ” ë° **í•„ìš”**í•©ë‹ˆë‹¤.

### `container.cronJobs.create` | `container.cronJobs.update` | `container.daemonSets.create` | `container.daemonSets.update` | `container.deployments.create` | `container.deployments.update` | `container.jobs.create` | `container.jobs.update` | `container.pods.create` | `container.pods.update` | `container.replicaSets.create` | `container.replicaSets.update` | `container.replicationControllers.create` | `container.replicationControllers.update` | `container.scheduledJobs.create` | `container.scheduledJobs.update` | `container.statefulSets.create` | `container.statefulSets.update`

ì´ëŸ¬í•œ ëª¨ë“  ê¶Œí•œì€ **ë¦¬ì†ŒìŠ¤ë¥¼ ìƒì„±**í•˜ê±°ë‚˜ **ì—…ë°ì´íŠ¸**í•  ìˆ˜ ìˆë„ë¡ í•˜ì—¬ **pod**ë¥¼ **ì •ì˜**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. Podë¥¼ ì •ì˜í•˜ë©´ **ì²¨ë¶€**ë  **SA**ì™€ **ì‹¤í–‰**ë  **ì´ë¯¸ì§€**ë¥¼ **ì§€ì •**í•  ìˆ˜ ìˆìœ¼ë¯€ë¡œ, SAì˜ í† í°ì„ ì„œë²„ë¡œ **ìœ ì¶œ**í•  ìˆ˜ ìˆëŠ” ì´ë¯¸ì§€ë¥¼ ì‹¤í–‰í•˜ì—¬ ì–´ë–¤ ì„œë¹„ìŠ¤ ê³„ì •ìœ¼ë¡œë„ ìƒìŠ¹í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\
ìì„¸í•œ ì •ë³´ëŠ” ë‹¤ìŒì„ ì°¸ì¡°í•˜ì‹­ì‹œì˜¤:

GCP í™˜ê²½ì—ì„œëŠ” **ë©”íƒ€ë°ì´í„°** ì„œë¹„ìŠ¤ì—ì„œ **nodepool GCP SA**ë¥¼ ê°€ì ¸ì™€ **GC**Pì—ì„œ ê¶Œí•œì„ ìƒìŠ¹í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤(ê¸°ë³¸ì ìœ¼ë¡œ compute SAê°€ ì‚¬ìš©ë¨).

### `container.secrets.get` | `container.secrets.list`

[**ì´ í˜ì´ì§€ì—ì„œ ì„¤ëª…ëœëŒ€ë¡œ**, ](../../kubernetes-security/abusing-roles-clusterroles-in-kubernetes/#listing-secrets)ì´ ê¶Œí•œì„ ì‚¬ìš©í•˜ë©´ **kubernetesì˜ ëª¨ë“  SAì˜ í† í°**ì„ **ì½ì„** ìˆ˜ ìˆìœ¼ë¯€ë¡œ í•´ë‹¹ SAë¡œ ìƒìŠ¹í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### `container.pods.exec`

ì´ ê¶Œí•œì„ ì‚¬ìš©í•˜ë©´ **podì— exec**í•  ìˆ˜ ìˆì–´ **podì—ì„œ ì‹¤í–‰ ì¤‘ì¸ ëª¨ë“  Kubernetes SA**ì— ì•¡ì„¸ìŠ¤í•˜ì—¬ K8s ë‚´ì—ì„œ ê¶Œí•œì„ ìƒìŠ¹í•  ìˆ˜ ìˆì„ ë¿ë§Œ ì•„ë‹ˆë¼ **NodePool**ì˜ **GCP ì„œë¹„ìŠ¤ ê³„ì •**ì„ **ë„ë‚œ**í•  ìˆ˜ ìˆì–´ **GCP**ì—ì„œ ê¶Œí•œì„ ìƒìŠ¹í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### `container.pods.portForward`

[**ì´ í˜ì´ì§€ì—ì„œ ì„¤ëª…ëœëŒ€ë¡œ**, ] ì´ ê¶Œí•œì„ ì‚¬ìš©í•˜ë©´ **podì—ì„œ ì‹¤í–‰ ì¤‘ì¸ ë¡œì»¬ ì„œë¹„ìŠ¤**ì— **ì•¡ì„¸ìŠ¤**í•  ìˆ˜ ìˆì–´ Kubernetes ë° **GCP**ì—ì„œ ê¶Œí•œì„ ìƒìŠ¹í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤(ë©”íƒ€ë°ì´í„° ì„œë¹„ìŠ¤ì™€ í†µì‹ í•˜ëŠ” ë°©ë²•ì„ ì°¾ëŠ”ë‹¤ë©´).

### `container.serviceAccounts.createToken`

ì´ **ê¶Œí•œì˜ ì´ë¦„** ë•Œë¬¸ì— **K8s ì„œë¹„ìŠ¤ ê³„ì •ì˜ í† í°ì„ ìƒì„±**í•  ìˆ˜ ìˆì„ ê²ƒìœ¼ë¡œ ë³´ì´ë¯€ë¡œ Kubernetes ë‚´ì˜ ëª¨ë“  SAë¡œ **ìƒìŠ¹**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ í•´ë‹¹ API ì—”ë“œí¬ì¸íŠ¸ë¥¼ ì°¾ì§€ ëª»í–ˆìœ¼ë¯€ë¡œ ì°¾ìœ¼ë©´ ì•Œë ¤ì£¼ì„¸ìš”.

### `container.mutatingWebhookConfigurations.create` | `container.mutatingWebhookConfigurations.update`

ì´ëŸ¬í•œ ê¶Œí•œì€ Kubernetesì—ì„œ ê¶Œí•œì„ ìƒìŠ¹í•  ìˆ˜ ìˆì§€ë§Œ ë” í™•ì‹¤í•˜ê²ŒëŠ” í´ëŸ¬ìŠ¤í„°ì— **ì˜ì†ì„±ì„ ìœ ì§€**í•  ìˆ˜ ìˆì„ ê²ƒì…ë‹ˆë‹¤.\
ìì„¸í•œ ì •ë³´ëŠ” [**ì´ ë§í¬ë¥¼ ë”°ë¥´ì„¸ìš”**](../../kubernetes-security/abusing-roles-clusterroles-in-kubernetes/#malicious-admission-controller).
