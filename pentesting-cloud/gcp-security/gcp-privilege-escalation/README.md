# GCP - Yetki YÃ¼kseltme

{% hint style="success" %}
AWS Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n:<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
GCP Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**abonelik planlarÄ±nÄ±**](https://github.com/sponsors/carlospolop) kontrol edin!
* **Bize katÄ±lÄ±n** ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) veya **bizi** **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**'da takip edin.**
* **Hacking ipuÃ§larÄ±nÄ± paylaÅŸarak** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna PR gÃ¶nderin.

</details>
{% endhint %}

## GCP Yetki YÃ¼kseltmeye GiriÅŸ <a href="#introduction-to-gcp-privilege-escalation" id="introduction-to-gcp-privilege-escalation"></a>

GCP, diÄŸer bulutlar gibi bazÄ± **prensipler**: kullanÄ±cÄ±lar, gruplar ve hizmet hesaplarÄ± ile bazÄ± **kaynaklar**: hesaplama motoru, bulut fonksiyonlarÄ±â€¦\
Sonra, roller aracÄ±lÄ±ÄŸÄ±yla, **bu prensiplere kaynaklar Ã¼zerinde izinler verilir**. Bu, GCP'de bir prensibin bir kaynak Ã¼zerindeki izinlerini belirtmenin yoludur.\
KullanÄ±cÄ±nÄ±n bir kaynak veya Ã¼Ã§Ã¼ncÃ¼ taraf kaynaklar Ã¼zerinde **daha fazla izin almasÄ±na** olanak tanÄ±yan belirli izinler vardÄ±r ve buna **yetki yÃ¼kseltme** denir (ayrÄ±ca, daha fazla izin almak iÃ§in zafiyetlerin istismar edilmesi).

Bu nedenle, GCP yetki yÃ¼kseltme tekniklerini **2 gruba** ayÄ±rmak istiyorum:

* **Bir prensibe yetki yÃ¼kseltme**: Bu, **baÅŸka bir prensibi taklit etmenizi** saÄŸlar ve dolayÄ±sÄ±yla onun tÃ¼m izinleriyle hareket edersiniz. Ã–rneÄŸin: Bir hizmet hesabÄ±nÄ± taklit etmek iÃ§in _getAccessToken_ kullanmak.
* **Kaynak Ã¼zerinde yetki yÃ¼kseltme**: Bu, **belirli bir kaynak Ã¼zerinde daha fazla izin almanÄ±zÄ±** saÄŸlar. Ã–rneÄŸin: Bulut fonksiyonlarÄ±nÄ± tetiklemek iÃ§in _setIamPolicy_ iznini kÃ¶tÃ¼ye kullanabilirsiniz.
* BazÄ± **kaynak izinleri, bir hizmet hesabÄ±nÄ±** kaynaÄŸa eklemenize de olanak tanÄ±r. Bu, bir SA ile bir kaynak baÅŸlatabileceÄŸiniz, kaynaÄŸa girebileceÄŸiniz ve **SA token'Ä±nÄ± Ã§alabileceÄŸiniz** anlamÄ±na gelir. Bu nedenle, bu, bir kaynak yÃ¼kseltmesi aracÄ±lÄ±ÄŸÄ±yla bir prensibe yÃ¼kselmenizi saÄŸlar. Daha Ã¶nce birÃ§ok kaynakta bu gerÃ§ekleÅŸti, ancak ÅŸimdi daha az sÄ±klÄ±kla (ama hala olabilir).

AÃ§Ä±kÃ§a, en ilginÃ§ yetki yÃ¼kseltme teknikleri **ikinci gruptaki** tekniklerdir Ã§Ã¼nkÃ¼ bu, **zaten bazÄ± izinlere sahip olduÄŸunuz kaynaklarÄ±n dÄ±ÅŸÄ±ndaki daha fazla ayrÄ±calÄ±k elde etmenizi** saÄŸlar. Ancak, **kaynaklarda yÃ¼kselmenin** size **hassas bilgilere** veya hatta **diÄŸer prensiplere** (belki bir SA'nÄ±n token'Ä±nÄ± iÃ§eren bir sÄ±rrÄ± okuyarak) eriÅŸim verebileceÄŸini unutmayÄ±n.

{% hint style="warning" %}
AyrÄ±ca, **GCP'de Hizmet HesaplarÄ± hem prensipler hem de izinlerdir**, bu nedenle bir SA'da yetki yÃ¼kseltmek, onu taklit etmenizi de saÄŸlar.
{% endhint %}

{% hint style="info" %}
Parantez iÃ§indeki izinler, zafiyeti `gcloud` ile istismar etmek iÃ§in gereken izinleri gÃ¶sterir. API aracÄ±lÄ±ÄŸÄ±yla istismar ediliyorsa bunlar gerekli olmayabilir.
{% endhint %}

## Yetki YÃ¼kseltme Metodolojisi iÃ§in Ä°zinler

Bu, GCP iÃ§inde belirli eylemleri gerÃ§ekleÅŸtirmek iÃ§in **belirli izinleri test etme** ÅŸeklimdir.

1. Github reposunu indirin [https://github.com/carlospolop/gcp\_privesc\_scripts](https://github.com/carlospolop/gcp\_privesc\_scripts)
2. tests/ dizinine yeni script ekleyin

## EriÅŸim KapsamlarÄ±nÄ± AÅŸma <a href="#bypassing-access-scopes" id="bypassing-access-scopes"></a>

GCP meta veri hizmetinden sÄ±zan SA token'larÄ± **eriÅŸim kapsamlarÄ±na** sahiptir. Bunlar, token'Ä±n sahip olduÄŸu **izinler** Ã¼zerinde **kÄ±sÄ±tlamalardÄ±r**. Ã–rneÄŸin, token **`https://www.googleapis.com/auth/cloud-platform`** kapsamÄ±na sahipse, tÃ¼m GCP hizmetlerine **tam eriÅŸim** olacaktÄ±r. Ancak, token **`https://www.googleapis.com/auth/cloud-platform.read-only`** kapsamÄ±na sahipse, SA'nÄ±n IAM'de daha fazla izni olsa bile, tÃ¼m GCP hizmetlerine yalnÄ±zca **salt okunur eriÅŸim** olacaktÄ±r.

Bu izinleri aÅŸmanÄ±n doÄŸrudan bir yolu yoktur, ancak her zaman **kompromize edilmiÅŸ hostta yeni kimlik bilgileri** aramayÄ±, **kÄ±sÄ±tlama olmadan bir OAuth token'Ä± oluÅŸturmak iÃ§in hizmet anahtarÄ±nÄ± bulmayÄ±** veya **daha az kÄ±sÄ±tlÄ± bir VM'ye atlamayÄ±** deneyebilirsiniz.

[eriÅŸim kapsamlarÄ±](https://cloud.google.com/compute/docs/access/service-accounts#accesscopesiam) kullanÄ±ldÄ±ÄŸÄ±nda, hesaplama Ã¶rnemi (VM) iÃ§in oluÅŸturulan OAuth token'Ä± **bir** [**kapsam**](https://oauth.net/2/scope/) **kÄ±sÄ±tlamasÄ± iÃ§erir**. Ancak, bu kÄ±sÄ±tlamayÄ± **aÅŸabilir** ve kompromize edilmiÅŸ hesabÄ±n sahip olduÄŸu izinleri istismar edebilirsiniz.

Bu kÄ±sÄ±tlamayÄ± aÅŸmanÄ±n **en iyi yolu**, ya **kompromize edilmiÅŸ hostta yeni kimlik bilgileri bulmak**, ya **kÄ±sÄ±tlama olmadan bir OAuth token'Ä± oluÅŸturmak iÃ§in hizmet anahtarÄ±nÄ± bulmak** ya da **daha az kÄ±sÄ±tlÄ± bir SA ile farklÄ± bir VM'yi ele geÃ§irmek** olacaktÄ±r.

AnahtarlarÄ± ile SA'yÄ± kontrol edin:
```bash
for i in $(gcloud iam service-accounts list --format="table[no-heading](email)"); do
echo "Looking for keys for $i:"
gcloud iam service-accounts keys list --iam-account $i
done
```
## Yetki YÃ¼kseltme Teknikleri

AWS'de yetkilerinizi yÃ¼kseltmenin yolu, diÄŸer hizmet hesaplarÄ±nÄ±n/kullanÄ±cÄ±larÄ±nÄ±n/gruplarÄ±nÄ±n yetkilerine eriÅŸebilecek kadar izne sahip olmaktÄ±r. YÃ¼kseltmeleri zincirleme yaparak organizasyon Ã¼zerinde yÃ¶netici eriÅŸimi elde etmek.

{% hint style="warning" %}
GCP'nin bir varlÄ±ÄŸa verilebilecek **yÃ¼zlerce** (binlerce deÄŸilse) **izni** vardÄ±r. Bu kitapta, **yetki yÃ¼kseltmek iÃ§in kÃ¶tÃ¼ye kullanabileceÄŸiniz** **tÃ¼m izinleri** bulabilirsiniz, ancak burada belirtilmeyen **bir yol biliyorsanÄ±z**, **lÃ¼tfen paylaÅŸÄ±n**.
{% endhint %}

**Bu bÃ¶lÃ¼mÃ¼n alt sayfalarÄ± hizmetlere gÃ¶re sÄ±ralanmÄ±ÅŸtÄ±r. Her hizmette, hizmetler Ã¼zerinde yetki yÃ¼kseltmenin farklÄ± yollarÄ±nÄ± bulabilirsiniz.**

### GCP'yi yerel olarak yetki yÃ¼kseltmek iÃ§in kÃ¶tÃ¼ye kullanma

EÄŸer GCP'de bir makinenin iÃ§indeyseniz, yerel olarak yetkileri yÃ¼kseltmek iÃ§in izinleri kÃ¶tÃ¼ye kullanma imkanÄ±nÄ±z olabilir:

{% content-ref url="gcp-local-privilege-escalation-ssh-pivoting.md" %}
[gcp-local-privilege-escalation-ssh-pivoting.md](gcp-local-privilege-escalation-ssh-pivoting.md)
{% endcontent-ref %}

## Referanslar

* [https://rhinosecuritylabs.com/gcp/privilege-escalation-google-cloud-platform-part-1/](https://rhinosecuritylabs.com/gcp/privilege-escalation-google-cloud-platform-part-1/)
* [https://rhinosecuritylabs.com/cloud-security/privilege-escalation-google-cloud-platform-part-2/](https://rhinosecuritylabs.com/cloud-security/privilege-escalation-google-cloud-platform-part-2/#gcp-privesc-scanner)
* [https://about.gitlab.com/blog/2020/02/12/plundering-gcp-escalating-privileges-in-google-cloud-platform/](https://about.gitlab.com/blog/2020/02/12/plundering-gcp-escalating-privileges-in-google-cloud-platform/)

{% hint style="success" %}
AWS Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n:<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
GCP Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**abonelik planlarÄ±nÄ±**](https://github.com/sponsors/carlospolop) kontrol edin!
* **ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n ya da **Twitter'da** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**'i takip edin.**
* **Hacking ipuÃ§larÄ±nÄ± paylaÅŸmak iÃ§in** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna PR gÃ¶nderin.

</details>
{% endhint %}
