# GCP - AyrÄ±calÄ±k YÃ¼kseltme

{% hint style="success" %}
AWS Hacking'i Ã¶ÄŸrenin ve uygulayÄ±n:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks EÄŸitim AWS KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ± (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCP Hacking'i Ã¶ÄŸrenin ve uygulayÄ±n: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks EÄŸitim GCP KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ± (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**Abonelik planlarÄ±nÄ±**](https://github.com/sponsors/carlospolop) kontrol edin!
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) katÄ±lÄ±n veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n veya bizi **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** takip edin.**
* **Hacking pÃ¼f noktalarÄ±nÄ± paylaÅŸarak PR'ler gÃ¶ndererek** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na katkÄ±da bulunun.

</details>
{% endhint %}

## GCP AyrÄ±calÄ±k YÃ¼kseltme GiriÅŸ <a href="#introduction-to-gcp-privilege-escalation" id="introduction-to-gcp-privilege-escalation"></a>

GCP, diÄŸer bulutlar gibi bazÄ± **ilkeleri** bulunur: kullanÄ±cÄ±lar, gruplar ve hizmet hesaplarÄ±, ve bazÄ± **kaynaklar** gibi hesaplama motoru, bulut iÅŸlevleri...\
Sonra, roller aracÄ±lÄ±ÄŸÄ±yla, **izinler bu ilkelerin kaynaklar Ã¼zerinde verilir**. Bu, bir ilkenin GCP'deki bir kaynaÄŸa sahip olduÄŸu izinleri belirtmenin yoludur.\
BazÄ± izinler, bir kullanÄ±cÄ±ya kaynaÄŸÄ±n Ã¼zerinde **daha fazla izin almasÄ±na izin verecek**, ve bu da **ayrÄ±calÄ±k yÃ¼kseltme** olarak adlandÄ±rÄ±lÄ±r (ayrÄ±ca, daha fazla izin almak iÃ§in zafiyetlerin sÃ¶mÃ¼rÃ¼lmesi).

Bu nedenle, GCP ayrÄ±calÄ±k yÃ¼kseltme tekniklerini **2 gruba ayÄ±rmak istiyorum**:

* **Ä°lke yÃ¼kseltme bir ilkeye**: Bu size **baÅŸka bir ilkeyi taklit etme** izni verecektir ve dolayÄ±sÄ±yla tÃ¼m izinleriyle onun gibi davranmanÄ±za olanak tanÄ±r. Ã¶rn.: Bir hizmet hesabÄ±nÄ± taklit etmek iÃ§in _getAccessToken_ kÃ¶tÃ¼ye kullanÄ±mÄ±.
* **Kaynak Ã¼zerinde ilke yÃ¼kseltme**: Bu size **belirli kaynaÄŸÄ±n Ã¼zerinde daha fazla izin almanÄ±zÄ± saÄŸlayacaktÄ±r**. Ã¶rn.: cloudfunctions Ã¼zerinde _setIamPolicy_ iznini kÃ¶tÃ¼ye kullanarak iÅŸlevi tetiklemenize izin verir.
* BazÄ± **kaynak izinleri ayrÄ±ca bir hizmet hesabÄ±nÄ± kaynaÄŸa eklemenize izin verecektir**. Bu, bir kaynaÄŸÄ± bir SA ile baÅŸlatmanÄ±za, kaynaÄŸa girmenize ve **SA belirtecinin Ã§alÄ±nmasÄ±na izin verecektir**. Bu nedenle, bu, bir kaynak yÃ¼kseltmesi aracÄ±lÄ±ÄŸÄ±yla bir ilkeye yÃ¼kselmenize izin verecektir. Bu daha Ã¶nce birkaÃ§ kaynakta meydana gelmiÅŸ olsa da, ÅŸimdi daha az yaygÄ±n (ancak hala olabilir).

AÃ§Ä±kÃ§asÄ±, en ilginÃ§ ayrÄ±calÄ±k yÃ¼kseltme teknikleri **ikinci gruptakilerdir** Ã§Ã¼nkÃ¼ size **zaten bazÄ± ayrÄ±calÄ±klara sahip olduÄŸunuz kaynaklarÄ±n dÄ±ÅŸÄ±nda daha fazla ayrÄ±calÄ±k kazandÄ±racaktÄ±r**. Ancak, **kaynaklarda yÃ¼kselme** size aynÄ± zamanda **duyarlÄ± bilgilere** veya hatta **diÄŸer ilkelerin** (belki bir SA belirteci iÃ§eren bir sÄ±rrÄ± okuyarak) eriÅŸim saÄŸlayabilir.

{% hint style="warning" %}
AyrÄ±ca **GCP Hizmet HesaplarÄ± hem ilke hem izinlerdir**, bu nedenle bir SA'da ayrÄ±calÄ±klar yÃ¼kseltmek, onu taklit etmenize de izin verecektir.
{% endhint %}

{% hint style="info" %}
Parantez iÃ§indeki izinler, zafiyetin `gcloud` ile sÃ¶mÃ¼rÃ¼lmesi iÃ§in gereken izinleri gÃ¶sterir. Bunlar, API aracÄ±lÄ±ÄŸÄ±yla sÃ¶mÃ¼rÃ¼lÃ¼rken gerekli olmayabilir.
{% endhint %}

## AyrÄ±calÄ±k YÃ¼kseltme Metodolojisi iÃ§in Ä°zinler

Bu, belirli eylemleri gerÃ§ekleÅŸtirmek iÃ§in belirli izinleri **test etmek iÃ§in nasÄ±l** yaptÄ±ÄŸÄ±mÄ± gÃ¶sterir GCP iÃ§inde.

1. Github deposunu indirin [https://github.com/carlospolop/gcp\_privesc\_scripts](https://github.com/carlospolop/gcp\_privesc\_scripts)
2. Yeni betiÄŸi tests/ klasÃ¶rÃ¼ne ekleyin

## EriÅŸim KapsamlarÄ±nÄ± Atlatma <a href="#bypassing-access-scopes" id="bypassing-access-scopes"></a>

GCP metadata servisinden sÄ±zdÄ±rÄ±lan SA belirteÃ§leri **eriÅŸim kapsamlarÄ±na** sahiptir. Bunlar, belirtecin sahip olduÄŸu **izinler Ã¼zerindeki kÄ±sÄ±tlamalardÄ±r**. Ã–rneÄŸin, belirtecin **`https://www.googleapis.com/auth/cloud-platform`** kapsamÄ± varsa, tÃ¼m GCP hizmetlerine **tam eriÅŸimi** olacaktÄ±r. Ancak, belirtecin **`https://www.googleapis.com/auth/cloud-platform.read-only`** kapsamÄ± varsa, IAM'de SA'nÄ±n daha fazla izne sahip olmasÄ±na raÄŸmen, tÃ¼m GCP hizmetlerine **salt okuma eriÅŸimi** olacaktÄ±r.

Bu izinleri atlamak iÃ§in doÄŸrudan bir yol yoktur, ancak kompromize edilmiÅŸ ana makinede **yeni kimlik bilgileri arayabilir**, kÄ±sÄ±tlamasÄ±z bir OAuth belirteci oluÅŸturmak iÃ§in **hizmet anahtarÄ±nÄ± bulabilir** veya **daha az kÄ±sÄ±tlanmÄ±ÅŸ farklÄ± bir VM'ye geÃ§ebilirsiniz**.

[eriÅŸim kapsamlarÄ±](https://cloud.google.com/compute/docs/access/service-accounts#accesscopesiam) kullanÄ±ldÄ±ÄŸÄ±nda, hesaplama Ã¶rneÄŸi (VM) iÃ§in oluÅŸturulan OAuth belirteci **dahil edilmiÅŸ bir kapsam sÄ±nÄ±rlamasÄ±na** sahip olacaktÄ±r. Bununla birlikte, bu sÄ±nÄ±rlamayÄ± atlayabilir ve kompromize edilmiÅŸ hesabÄ±n sahip olduÄŸu izinleri sÃ¶mÃ¼rebilirsiniz.

Bu kÄ±sÄ±tlamayÄ± atlatmanÄ±n **en iyi yolu**, ya kompromize edilmiÅŸ ana makinede **yeni kimlik bilgileri bulmak**, kÄ±sÄ±tlamasÄ±z bir OAuth belirteci oluÅŸturmak iÃ§in **hizmet anahtarÄ±nÄ± bulmak** veya **daha az kÄ±sÄ±tlanmÄ±ÅŸ bir SA'ya sahip farklÄ± bir VM'yi ele geÃ§irmektir**.

AnahtarlarÄ± oluÅŸturulan SA'yÄ± kontrol edin:
```bash
for i in $(gcloud iam service-accounts list --format="table[no-heading](email)"); do
echo "Looking for keys for $i:"
gcloud iam service-accounts keys list --iam-account $i
done
```
## Yetki YÃ¼kseltme Teknikleri

AWS'de yetkilerinizi yÃ¼kseltmenin yolu, baÅŸka hizmet hesaplarÄ±/kullanÄ±cÄ±larÄ±/gruplarÄ±nÄ±n yetkilerine bir ÅŸekilde eriÅŸebilecek kadar yeterli izne sahip olmaktÄ±r. YÃ¶netici eriÅŸimine sahip olana kadar yÃ¼kseltmeleri zincirleme olarak gerÃ§ekleÅŸtirirsiniz.

{% hint style="warning" %}
GCP'de bir varlÄ±ÄŸa verilebilecek **yÃ¼zlerce** (belki de binlerce) **izin** bulunmaktadÄ±r. Bu kitapta, **yetki yÃ¼kseltmek iÃ§in kÃ¶tÃ¼ye kullanabileceÄŸiniz tÃ¼m izinleri** bulabilirsiniz, ancak burada bahsedilmeyen **bir yol biliyorsanÄ±z, lÃ¼tfen paylaÅŸÄ±n**.
{% endhint %}

**Bu bÃ¶lÃ¼mÃ¼n alt sayfalarÄ± hizmetlere gÃ¶re sÄ±ralanmÄ±ÅŸtÄ±r. Her hizmette yetkileri yÃ¼kseltmenin farklÄ± yollarÄ±nÄ± bulabilirsiniz.**

### Yetkileri yerel olarak yÃ¼kseltmek iÃ§in GCP'yi kÃ¶tÃ¼ye kullanma

EÄŸer GCP'deki bir makinede iseniz, izinleri kÃ¶tÃ¼ye kullanarak yerel olarak bile yetkileri yÃ¼kseltebilirsiniz:

{% content-ref url="gcp-local-privilege-escalation-ssh-pivoting.md" %}
[gcp-local-privilege-escalation-ssh-pivoting.md](gcp-local-privilege-escalation-ssh-pivoting.md)
{% endcontent-ref %}

## Referanslar

* [https://rhinosecuritylabs.com/gcp/privilege-escalation-google-cloud-platform-part-1/](https://rhinosecuritylabs.com/gcp/privilege-escalation-google-cloud-platform-part-1/)
* [https://rhinosecuritylabs.com/cloud-security/privilege-escalation-google-cloud-platform-part-2/](https://rhinosecuritylabs.com/cloud-security/privilege-escalation-google-cloud-platform-part-2/#gcp-privesc-scanner)
* [https://about.gitlab.com/blog/2020/02/12/plundering-gcp-escalating-privileges-in-google-cloud-platform/](https://about.gitlab.com/blog/2020/02/12/plundering-gcp-escalating-privileges-in-google-cloud-platform/)

{% hint style="success" %}
AWS Hacking'i Ã¶ÄŸrenin ve uygulayÄ±n:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks EÄŸitim AWS KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ± (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCP Hacking'i Ã¶ÄŸrenin ve uygulayÄ±n: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks EÄŸitim GCP KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ± (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**Abonelik planlarÄ±nÄ±**](https://github.com/sponsors/carlospolop) kontrol edin!
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n veya bizi **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** takip edin.**
* **Hacking pÃ¼f noktalarÄ±nÄ± paylaÅŸarak PR gÃ¶ndererek** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na katkÄ±da bulunun.

</details>
{% endhint %}
