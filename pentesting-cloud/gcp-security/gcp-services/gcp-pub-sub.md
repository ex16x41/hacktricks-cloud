# GCP - Pub/Sub Enum

{% hint style="success" %}
Dowiedz siÄ™ i Ä‡wicz Hacking AWS:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Dowiedz siÄ™ i Ä‡wicz Hacking GCP: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Wesprzyj HackTricks</summary>

* SprawdÅº [**plany subskrypcji**](https://github.com/sponsors/carlospolop)!
* **DoÅ‚Ä…cz do** ğŸ’¬ [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **Å›ledÅº** nas na **Twitterze** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Dziel siÄ™ trikami hakerskimi, przesyÅ‚ajÄ…c PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) na githubie.

</details>
{% endhint %}

## Pub/Sub <a href="#reviewing-cloud-pubsub" id="reviewing-cloud-pubsub"></a>

[Google **Cloud Pub/Sub**](https://cloud.google.com/pubsub/) jest opisany jako usÅ‚uga uÅ‚atwiajÄ…ca wymianÄ™ wiadomoÅ›ci miÄ™dzy niezaleÅ¼nymi aplikacjami. GÅ‚Ã³wne skÅ‚adniki obejmujÄ… **tematy**, do ktÃ³rych aplikacje mogÄ… **subskrybowaÄ‡**. Subskrybowane aplikacje majÄ… moÅ¼liwoÅ›Ä‡ **wysyÅ‚ania i odbierania wiadomoÅ›ci**. KaÅ¼da wiadomoÅ›Ä‡ skÅ‚ada siÄ™ z rzeczywistej treÅ›ci oraz powiÄ…zanych metadanych.

**Temat to kolejka**, do ktÃ³rej bÄ™dÄ… wysyÅ‚ane wiadomoÅ›ci, podczas gdy **subskrypcje** sÄ… **obiektami**, ktÃ³rych uÅ¼ytkownicy bÄ™dÄ… uÅ¼ywaÄ‡ do **dostÄ™pu do wiadomoÅ›ci w tematach**. MoÅ¼e byÄ‡ wiÄ™cej niÅ¼ **1 subskrypcja na temat**, a istniejÄ… 4 rodzaje subskrypcji:

* **Pull**: UÅ¼ytkownik(i) tej subskrypcji muszÄ… pobraÄ‡ wiadomoÅ›ci.
* **Push**: Wskazany jest adres URL punktu koÅ„cowego, a wiadomoÅ›ci zostanÄ… natychmiast wysÅ‚ane na niego.
* **Tabela BigQuery**: Podobnie jak push, ale ustawia wiadomoÅ›ci w tabeli BigQuery.
* **Cloud Storage**: Dostarcza wiadomoÅ›ci bezpoÅ›rednio do istniejÄ…cego kubeÅ‚ka.

DomyÅ›lnie **subskrypcja wygasa po 31 dniach**, chociaÅ¼ moÅ¼na ustawiÄ‡ jÄ… na nigdy nie wygasajÄ…cÄ….

DomyÅ›lnie wiadomoÅ›Ä‡ jest **przechowywana przez 7 dni**, ale ten czas moÅ¼na **zwiÄ™kszyÄ‡ do 31 dni**. Ponadto, jeÅ›li nie zostanie **potwierdzona w ciÄ…gu 10 sekund**, wraca do kolejki. MoÅ¼na takÅ¼e ustawiÄ‡, Å¼e potwierdzone wiadomoÅ›ci powinny nadal byÄ‡ przechowywane.

Temat jest domyÅ›lnie szyfrowany za pomocÄ… **zarzÄ…dzanego przez Google klucza szyfrowania**. Ale moÅ¼na takÅ¼e wybraÄ‡ **CMEK** (Klucz Szyfrowania ZarzÄ…dzany przez Klienta) z KMS.

**Skrzynka na martwe listy**: Subskrypcje mogÄ… skonfigurowaÄ‡ **maksymalnÄ… liczbÄ™ prÃ³b dostarczenia**. Gdy wiadomoÅ›Ä‡ nie moÅ¼e zostaÄ‡ dostarczona, jest **ponownie publikowana do okreÅ›lonego tematu skrzynki na martwe listy**.

### Zrzuty i Schematy

Zrzut to funkcja, ktÃ³ra **przechwytuje stan subskrypcji w okreÅ›lonym momencie**. Jest to w zasadzie spÃ³jna **kopia niepotwierdzonych wiadomoÅ›ci w subskrypcji**. TworzÄ…c zrzut, zachowujesz stan potwierdzenia wiadomoÅ›ci subskrypcji, pozwalajÄ…c na wznowienie konsumpcji wiadomoÅ›ci od momentu utworzenia zrzutu, nawet po usuniÄ™ciu oryginalnych wiadomoÅ›ci.\
JeÅ›li masz szczÄ™Å›cie, zrzut moÅ¼e zawieraÄ‡ **stare wraÅ¼liwe informacje** z chwili utworzenia zrzutu.

Podczas tworzenia tematu, moÅ¼na wskazaÄ‡, Å¼e **wiadomoÅ›ci tematu muszÄ… przestrzegaÄ‡ schematu**.

### Wyliczanie
```bash
# Get a list of topics in the project
gcloud pubsub topics list
gcloud pubsub topics describe <topic>
gcloud pubsub topics list-subscriptions <topic>
gcloud pubsub topics get-iam-policy <topic>

# Get a list of subscriptions across all topics
gcloud pubsub subscriptions list
gcloud pubsub subscriptions describe <subscription>
gcloud pubsub subscriptions get-iam-policy <subscription>

# Get list of schemas
gcloud pubsub schemas list
gcloud pubsub schemas describe <schema>
gcloud pubsub schemas list-revisions <schema>

# Get list of snapshots
gcloud pubsub snapshots list
gcloud pubsub snapshots describe <snapshot>
```
JednakÅ¼e moÅ¼esz uzyskaÄ‡ lepsze wyniki [**proszÄ…c o wiÄ™kszy zestaw danych**](https://cloud.google.com/pubsub/docs/replay-overview), w tym starsze wiadomoÅ›ci. Wymaga to speÅ‚nienia pewnych warunkÃ³w wstÄ™pnych i moÅ¼e wpÅ‚ynÄ…Ä‡ na aplikacje, dlatego upewnij siÄ™, Å¼e naprawdÄ™ wiesz, co robisz.

### Eskalacja uprawnieÅ„ i eksploatacja po wÅ‚amaniu

{% content-ref url="../gcp-post-exploitation/gcp-pub-sub-post-exploitation.md" %}
[gcp-pub-sub-post-exploitation.md](../gcp-post-exploitation/gcp-pub-sub-post-exploitation.md)
{% endcontent-ref %}

## Pub/Sub Lite

[**Pub/Sub Lite**](https://cloud.google.com/pubsub/docs/choosing-pubsub-or-lite) to usÅ‚uga przekazywania wiadomoÅ›ci z **przechowywaniem strefowym**. Pub/Sub Lite **kosztuje uÅ‚amek** ceny Pub/Sub i jest przeznaczony do **strumieniowania o duÅ¼ej przepustowoÅ›ci** (do 10 milionÃ³w wiadomoÅ›ci na sekundÄ™) oraz systemÃ³w zdarzeniowych, gdzie gÅ‚Ã³wnym kryterium jest niski koszt.

W PubSub Lite istniejÄ… **tematy** i **subskrypcje**, nie ma **migawek** ani **schematÃ³w**, a takÅ¼e:

* **Rezerwacje**: Rezerwacje Pub/Sub Lite to funkcja, ktÃ³ra pozwala uÅ¼ytkownikom zarezerwowaÄ‡ pojemnoÅ›Ä‡ w okreÅ›lonym regionie dla swoich strumieni wiadomoÅ›ci.
* **Operacje**: Odnosi siÄ™ do dziaÅ‚aÅ„ i zadaÅ„ zwiÄ…zanych z zarzÄ…dzaniem i administrowaniem Pub/Sub Lite.

### Wyliczanie
```bash
# lite-topics
gcloud pubsub lite-topics list
gcloud pubsub lite-topics describe <topic>
gcloud pubsub lite-topics list-subscriptions <topic>

# lite-subscriptions
gcloud pubsub lite-subscriptions list
gcloud pubsub lite-subscriptions describe <subscription>

# lite-reservations
gcloud pubsub lite-reservations list
gcloud pubsub lite-reservations describe <topic>
gcloud pubsub lite-reservations list-topics <topic>

# lite-operations
gcloud pubsub lite-operations list
gcloud pubsub lite-operations describe <topic>
```
{% hint style="success" %}
Ucz siÄ™ i praktykuj hakowanie AWS: <img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Ucz siÄ™ i praktykuj hakowanie GCP: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Wesprzyj HackTricks</summary>

* SprawdÅº [**plany subskrypcyjne**](https://github.com/sponsors/carlospolop)!
* **DoÅ‚Ä…cz do** ğŸ’¬ [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **Å›ledÅº** nas na **Twitterze** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **UdostÄ™pniaj sztuczki hakerskie, przesyÅ‚ajÄ…c PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repozytoriÃ³w na githubie.

</details>
{% endhint %}
