# GCP - Pub/Sub Enum

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** 游눫 [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** 游냕 [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Pub/Sub <a href="#reviewing-cloud-pubsub" id="reviewing-cloud-pubsub"></a>

[Google **Cloud Pub/Sub**](https://cloud.google.com/pubsub/) se describe como un servicio que facilita el intercambio de mensajes entre aplicaciones independientes. Los componentes principales incluyen **temas**, a los que las aplicaciones pueden **suscribirse**. Las aplicaciones suscritas tienen la capacidad de **enviar y recibir mensajes**. Cada mensaje comprende el contenido real junto con los metadatos asociados.

El **tema es la cola** donde se enviar치n los mensajes, mientras que las **suscripciones** son los **objetos** que los usuarios utilizar치n para **acceder a los mensajes en los temas**. Puede haber m치s de **1 suscripci칩n por tema** y hay 4 tipos de suscripciones:

* **Pull**: El/los usuario(s) de esta suscripci칩n necesitan buscar mensajes.
* **Push**: Se indica un endpoint de URL y los mensajes se enviar치n inmediatamente a 칠l.
* **Big query table**: Como push pero colocando los mensajes dentro de una tabla de Big query.
* **Cloud Storage**: Entregar mensajes directamente a un bucket existente.

Por **defecto**, una **suscripci칩n expira despu칠s de 31 d칤as**, aunque se puede configurar para que nunca expire.

Por **defecto**, un mensaje es **retenido durante 7 d칤as**, pero este tiempo puede ser **aumentado hasta 31 d칤as**. Adem치s, si no se **ACKea en 10s**, vuelve a la cola. Tambi칠n se puede configurar que los mensajes ACKeados contin칰en siendo almacenados.

Un tema est치 por defecto cifrado utilizando una **clave de cifrado gestionada por Google**. Pero tambi칠n se puede seleccionar una **CMEK** (Clave de Cifrado Gestionada por el Cliente) de KMS.

**Dead letter**: Las suscripciones pueden configurar un **n칰mero m치ximo de intentos de entrega**. Cuando un mensaje no puede ser entregado, se **rep칰blica en el tema de carta muerta especificado**.

### Snapshots & Schemas

Un snapshot es una caracter칤stica que **captura el estado de una suscripci칩n en un momento espec칤fico**. Es esencialmente una **copia de seguridad consistente de los mensajes no reconocidos en una suscripci칩n**. Al crear un snapshot, preservas el estado de reconocimiento de mensajes de la suscripci칩n, lo que te permite reanudar el consumo de mensajes desde el punto en que se tom칩 el snapshot, incluso despu칠s de que los mensajes originales habr칤an sido eliminados de otro modo.\
Si tienes mucha suerte, un snapshot podr칤a contener **informaci칩n sensible antigua** de cuando se tom칩 el snapshot.

Al crear un tema, puedes indicar que los **mensajes del tema deben seguir un esquema**.

### Enumeration
```bash
# Get a list of topics in the project
gcloud pubsub topics list
gcloud pubsub topics describe <topic>
gcloud pubsub topics list-subscriptions <topic>
gcloud pubsub topics get-iam-policy <topic>

# Get a list of subscriptions across all topics
gcloud pubsub subscriptions list
gcloud pubsub subscriptions describe <subscription>
gcloud pubsub subscriptions get-iam-policy <subscription>

# Get list of schemas
gcloud pubsub schemas list
gcloud pubsub schemas describe <schema>
gcloud pubsub schemas list-revisions <schema>

# Get list of snapshots
gcloud pubsub snapshots list
gcloud pubsub snapshots describe <snapshot>
```
Sin embargo, puede que obtengas mejores resultados [**solicitando un conjunto de datos m치s grande**](https://cloud.google.com/pubsub/docs/replay-overview), incluyendo mensajes m치s antiguos. Esto tiene algunos requisitos previos y podr칤a afectar a las aplicaciones, as칤 que aseg칰rate de saber realmente lo que est치s haciendo.

### Escalamiento de Privilegios y Post Explotaci칩n

{% content-ref url="../gcp-post-exploitation/gcp-pub-sub-post-exploitation.md" %}
[gcp-pub-sub-post-exploitation.md](../gcp-post-exploitation/gcp-pub-sub-post-exploitation.md)
{% endcontent-ref %}

## Pub/Sub Lite

[**Pub/Sub Lite**](https://cloud.google.com/pubsub/docs/choosing-pubsub-or-lite) es un servicio de mensajer칤a con **almacenamiento zonal**. Pub/Sub Lite **cuesta una fracci칩n** de Pub/Sub y est치 destinado a **transmisiones de alto volumen** (hasta 10 millones de mensajes por segundo) y sistemas impulsados por eventos donde el bajo costo es la consideraci칩n principal.

En PubSub Lite **hay** **temas** y **suscripciones**, no **hay instant치neas** ni **esquemas** y hay:

* **Reservas**: Las Reservas de Pub/Sub Lite son una caracter칤stica que permite a los usuarios reservar capacidad en una regi칩n espec칤fica para sus flujos de mensajes.
* **Operaciones**: Se refiere a las acciones y tareas involucradas en la gesti칩n y administraci칩n de Pub/Sub Lite.

### Enumeraci칩n
```bash
# lite-topics
gcloud pubsub lite-topics list
gcloud pubsub lite-topics describe <topic>
gcloud pubsub lite-topics list-subscriptions <topic>

# lite-subscriptions
gcloud pubsub lite-subscriptions list
gcloud pubsub lite-subscriptions describe <subscription>

# lite-reservations
gcloud pubsub lite-reservations list
gcloud pubsub lite-reservations describe <topic>
gcloud pubsub lite-reservations list-topics <topic>

# lite-operations
gcloud pubsub lite-operations list
gcloud pubsub lite-operations describe <topic>
```
{% hint style="success" %}
Aprende y practica Hacking en AWS:<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
Aprende y practica Hacking en GCP: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Apoya a HackTricks</summary>

* Revisa los [**planes de suscripci칩n**](https://github.com/sponsors/carlospolop)!
* **칔nete al** 游눫 [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s칤guenos** en **Twitter** 游냕 [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Comparte trucos de hacking enviando PRs a los** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repositorios de github.

</details>
{% endhint %}
