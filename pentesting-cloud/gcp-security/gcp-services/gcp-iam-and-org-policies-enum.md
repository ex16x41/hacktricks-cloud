# GCP - IAM, Principals & Org Policies Enum

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ЁЯТм [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ЁЯРж [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Service Accounts

рдПрдХ рд╕реЗрд╡рд╛ рдЦрд╛рддрд╛ рд╣рдореЗрд╢рд╛ рдПрдХ рдкрд░рд┐рдпреЛрдЬрдирд╛ рд╕реЗ рд╕рдВрдмрдВрдзрд┐рдд рд╣реЛрддрд╛ рд╣реИ: 

### Enumeration
```bash
gcloud iam service-accounts list --project <project>
```
## Users & Groups

GCP рдореЗрдВ Users & Groups рдХреИрд╕реЗ рдХрд╛рдо рдХрд░рддреЗ рд╣реИрдВ, рдЗрд╕рдХреЗ рд▓рд┐рдП рдПрдХ рдкрд░рд┐рдЪрдп рджреЗрдЦреЗрдВ:

{% content-ref url="../gcp-basic-information/" %}
[gcp-basic-information](../gcp-basic-information/)
{% endcontent-ref %}

### Enumeration

рдЕрдиреБрдорддрд┐рдпреЛрдВ **`serviceusage.services.enable`** рдФрд░ **`serviceusage.services.use`** рдХреЗ рд╕рд╛рде, рдХрд┐рд╕реА рдкреНрд░реЛрдЬреЗрдХреНрдЯ рдореЗрдВ **рд╕реЗрд╡рд╛рдУрдВ рдХреЛ рд╕рдХреНрд╖рдо рдХрд░рдирд╛** рдФрд░ рдЙрдирдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рд╕рдВрднрд╡ рд╣реИред

{% hint style="danger" %}
рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ, Workspace рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЛ **Project Creator** рднреВрдорд┐рдХрд╛ рджреА рдЬрд╛рддреА рд╣реИ, рдЬрд┐рд╕рд╕реЗ рдЙрдиреНрд╣реЗрдВ **рдирдП рдкреНрд░реЛрдЬреЗрдХреНрдЯ рдмрдирд╛рдиреЗ** рдХреА рдЕрдиреБрдорддрд┐ рдорд┐рд▓рддреА рд╣реИред рдЬрдм рдПрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдПрдХ рдкреНрд░реЛрдЬреЗрдХреНрдЯ рдмрдирд╛рддрд╛ рд╣реИ, рддреЛ рдЙрд╕реЗ рдЙрд╕ рдкрд░ **`owner`** рднреВрдорд┐рдХрд╛ рджреА рдЬрд╛рддреА рд╣реИред рдЗрд╕рд▓рд┐рдП, рд╡рд╣ **Workspace рдХреЛ рд╕реВрдЪреАрдмрджреНрдз рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдкреНрд░реЛрдЬреЗрдХреНрдЯ рдкрд░ рдЗрди рд╕реЗрд╡рд╛рдУрдВ рдХреЛ рд╕рдХреНрд╖рдо рдХрд░ рд╕рдХрддрд╛ рд╣реИ**ред

рд╣рд╛рд▓рд╛рдВрдХрд┐, рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдЗрди APIs рдХреЛ рдХреЙрд▓ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП **Workspace рдореЗрдВ рдкрд░реНрдпрд╛рдкреНрдд рдЕрдиреБрдорддрд┐рдпрд╛рдБ рд╣реЛрдирд╛ рднреА рдЖрд╡рд╢реНрдпрдХ рд╣реИ**ред
{% endhint %}

рдпрджрд┐ рдЖрдк **`admin` рд╕реЗрд╡рд╛ рдХреЛ рд╕рдХреНрд╖рдо рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ** рдФрд░ рдпрджрд┐ рдЖрдкрдХреЗ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рдкрд╛рд╕ **Workspace рдореЗрдВ рдкрд░реНрдпрд╛рдкреНрдд рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рд╣реИрдВ,** рддреЛ рдЖрдк рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдкрдВрдХреНрддрд┐рдпреЛрдВ рдХреЗ рд╕рд╛рде **рд╕рднреА рд╕рдореВрд╣реЛрдВ рдФрд░ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЛ рд╕реВрдЪреАрдмрджреНрдз рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ**ред\
рдпрд╣рд╛рдВ рддрдХ рдХрд┐ рдЕрдЧрд░ рдпрд╣ **`identity groups`** рдХрд╣рддрд╛ рд╣реИ, рддреЛ рдпрд╣ **рдмрд┐рдирд╛ рдХрд┐рд╕реА рд╕рдореВрд╣ рдХреЗ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ** рдХреЛ рднреА рд▓реМрдЯрд╛рддрд╛ рд╣реИ:

{% code overflow="wrap" %}
```bash
# Enable admin
gcloud services enable admin.googleapis.com
gcloud services enable cloudidentity.googleapis.com

# Using admin.googleapis.com
## List all users
gcloud organizations list #The DIRECTORY_CUSTOMER_ID is the Workspace ID
gcloud beta identity groups preview --customer <workspace-id>

# Using cloudidentity.googleapis.com
## List groups of a user (you can list at least the groups you belong to)
gcloud identity groups memberships search-transitive-groups --member-email <email> --labels=cloudidentity.googleapis.com/groups.discussion_forum

## List Group Members (you can list at least the groups you belong to)
gcloud identity groups memberships list --group-email=<email>
### Make it transitive
gcloud identity groups memberships search-transitive-memberships --group-email=<email>

## Get a graph (if you have enough permissions)
gcloud identity groups memberships get-membership-graph --member-email=<email> --labels=cloudidentity.googleapis.com/groups.discussion_forum
```
{% endcode %}

{% hint style="success" %}
рдкрд┐рдЫрд▓реЗ рдЙрджрд╛рд╣рд░рдгреЛрдВ рдореЗрдВ `--labels` рдкреИрд░рд╛рдореАрдЯрд░ рдЖрд╡рд╢реНрдпрдХ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдПрдХ рд╕рд╛рдорд╛рдиреНрдп рдорд╛рди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ (рдпрджрд┐ рдЖрдкрдиреЗ API рдХрд╛ рд╕реАрдзреЗ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рд╣реИ рдЬреИрд╕реЗ рдХрд┐ [**PurplePanda рдпрд╣рд╛рдБ рдХрд░рддрд╛ рд╣реИ**](https://github.com/carlospolop/PurplePanda/blob/master/intel/google/discovery/disc\_groups\_users.py)ред
{% endhint %}

рдпрд╣рд╛рдВ рддрдХ рдХрд┐ рдпрджрд┐ рдкреНрд░рд╢рд╛рд╕рди рд╕реЗрд╡рд╛ рд╕рдХреНрд╖рдо рд╣реИ, рддреЛ рдпрд╣ рд╕рдВрднрд╡ рд╣реИ рдХрд┐ рдЖрдкрдХреЛ рдЙрдиреНрд╣реЗрдВ рд╕реВрдЪреАрдмрджреНрдз рдХрд░рддреЗ рд╕рдордп рдПрдХ рддреНрд░реБрдЯрд┐ рдорд┐рд▓реЗ рдХреНрдпреЛрдВрдХрд┐ рдЖрдкрдХрд╛ рд╕рдордЭреМрддрд╛ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдХрд╛рд░реНрдпрдХреНрд╖реЗрддреНрд░ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рдкрд╛рд╕ рдкрд░реНрдпрд╛рдкреНрдд рдЕрдиреБрдорддрд┐рдпрд╛рдБ рдирд╣реАрдВ рд╣реИрдВ:

<figure><img src="../../../.gitbook/assets/image (193).png" alt=""><figcaption></figcaption></figure>

## IAM

[**IAM рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдореВрд▓ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП рдЗрд╕реЗ рджреЗрдЦреЗрдВ**](../gcp-basic-information/#iam-roles)ред

### рдбрд┐рдлрд╝реЙрд▓реНрдЯ рдЕрдиреБрдорддрд┐рдпрд╛рдБ

[**рджрд╕реНрддрд╛рд╡реЗрдЬрд╝реЛрдВ**](https://cloud.google.com/resource-manager/docs/default-access-control) рд╕реЗ: рдЬрдм рдПрдХ рд╕рдВрдЧрдарди рд╕рдВрд╕рд╛рдзрди рдмрдирд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рдЖрдкрдХреЗ рдбреЛрдореЗрди рдореЗрдВ рд╕рднреА рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЛ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ **рдмрд┐рд▓рд┐рдВрдЧ рдЦрд╛рддрд╛ рдирд┐рд░реНрдорд╛рддрд╛** рдФрд░ **рдкреНрд░реЛрдЬреЗрдХреНрдЯ рдирд┐рд░реНрдорд╛рддрд╛** рднреВрдорд┐рдХрд╛рдПрдБ рджреА рдЬрд╛рддреА рд╣реИрдВред рдпреЗ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рднреВрдорд┐рдХрд╛рдПрдБ рдЖрдкрдХреЗ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЛ рддреБрд░рдВрдд Google Cloud рдХрд╛ рдЙрдкрдпреЛрдЧ рд╢реБрд░реВ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддреА рд╣реИрдВ, рд▓реЗрдХрд┐рди рдЖрдкрдХреЗ рд╕рдВрдЧрдарди рд╕рдВрд╕рд╛рдзрди рдХреЗ рдирд┐рдпрдорд┐рдд рд╕рдВрдЪрд╛рд▓рди рдореЗрдВ рдЙрдкрдпреЛрдЧ рдХреЗ рд▓рд┐рдП рдирд╣реАрдВ рд╣реЛрддреА рд╣реИрдВред

рдпреЗ **рднреВрдорд┐рдХрд╛рдПрдБ** **рдЕрдиреБрдорддрд┐рдпрд╛рдБ** рдкреНрд░рджрд╛рди рдХрд░рддреА рд╣реИрдВ:

* `billing.accounts.create` рдФрд░ `resourcemanager.organizations.get`
* `resourcemanager.organizations.get` рдФрд░ `resourcemanager.projects.create`

рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдЬрдм рдПрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдПрдХ рдкреНрд░реЛрдЬреЗрдХреНрдЯ рдмрдирд╛рддрд╛ рд╣реИ, рддреЛ рдЙрд╕реЗ [рджрд╕реНрддрд╛рд╡реЗрдЬрд╝реЛрдВ](https://cloud.google.com/resource-manager/docs/access-control-proj) рдХреЗ рдЕрдиреБрд╕рд╛рд░ **рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ рдЙрд╕ рдкреНрд░реЛрдЬреЗрдХреНрдЯ рдХрд╛ рдорд╛рд▓рд┐рдХ рдмрдирд╛ рджрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ**ред рдЗрд╕рд▓рд┐рдП, рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ, рдПрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдПрдХ рдкреНрд░реЛрдЬреЗрдХреНрдЯ рдмрдирд╛рдиреЗ рдФрд░ рдЙрд╕ рдкрд░ рдХреЛрдИ рднреА рд╕реЗрд╡рд╛ рдЪрд▓рд╛рдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рд╣реЛрдЧрд╛ (рдЦрдирдирдХрд░реНрддрд╛? рдХрд╛рд░реНрдпрдХреНрд╖реЗрддреНрд░ рд╕реВрдЪреАрдХрд░рдг? ...)

{% hint style="danger" %}
GCP рд╕рдВрдЧрдарди рдореЗрдВ рд╕рдмрд╕реЗ рдЙрдЪреНрдЪ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ **рд╕рдВрдЧрдарди рдкреНрд░рд╢рд╛рд╕рдХ** рднреВрдорд┐рдХрд╛ рд╣реИред
{% endhint %}

### set-iam-policy рдмрдирд╛рдо add-iam-policy-binding

рдЕрдзрд┐рдХрд╛рдВрд╢ рд╕реЗрд╡рд╛рдУрдВ рдореЗрдВ, рдЖрдк **`add-iam-policy-binding`** рдпрд╛ **`set-iam-policy`** рд╡рд┐рдзрд┐ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдПрдХ рд╕рдВрд╕рд╛рдзрди рдкрд░ рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХреЛ рдмрджрд▓рдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рд╣реЛрдВрдЧреЗред рдореБрдЦреНрдп рдЕрдВрддрд░ рдпрд╣ рд╣реИ рдХрд┐ **`add-iam-policy-binding` рдПрдХ рдирдИ рднреВрдорд┐рдХрд╛ рдмрд╛рдЗрдВрдбрд┐рдВрдЧ рдЬреЛрдбрд╝рддрд╛ рд╣реИ** рдореМрдЬреВрджрд╛ IAM рдиреАрддрд┐ рдореЗрдВ рдЬрдмрдХрд┐ **`set-iam-policy`** **рдкрд╣рд▓реЗ рд╕реЗ рджреА рдЧрдИ** рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХреЛ **рд╣рдЯрд╛рдПрдЧрд╛** рдФрд░ **рдХреЗрд╡рд▓ рдЙрди рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХреЛ рд╕реЗрдЯ рдХрд░реЗрдЧрд╛** рдЬреЛ рдЖрджреЗрд╢ рдореЗрдВ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рд╣реИрдВред

### рд╕реВрдЪреАрдХрд░рдг
```bash
# Roles
## List roles
gcloud iam roles list --project $PROJECT_ID # List only custom roles
gcloud iam roles list --filter='etag:AA=='

## Get perms and description of role
gcloud iam roles describe roles/container.admin
gcloud iam roles describe --project <proj-name> <role-name>

# Policies
gcloud organizations get-iam-policy <org_id>
gcloud resource-manager folders get-iam-policy <folder-id>
gcloud projects get-iam-policy <project-id>

# MISC
## Testable permissions in resource
gcloud iam list-testable-permissions --filter "NOT apiDisabled: true" <resource>
## Grantable roles to a resource
gcloud iam list-grantable-roles <project URL>
```
### cloudasset IAM Enumeration

рдЗрд╕ рд╕реЗрд╡рд╛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд╡рд┐рднрд┐рдиреНрди рд╕рдВрд╕рд╛рдзрдиреЛрдВ (рдЬреИрд╕реЗ рд╕рдВрдЧрдардиреЛрдВ, рдлрд╝реЛрд▓реНрдбрд░реЛрдВ, рдкрд░рд┐рдпреЛрдЬрдирд╛рдУрдВ...) рдореЗрдВ рдПрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреА рд╕рднреА рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХреА рдЬрд╛рдВрдЪ рдХрд░рдиреЗ рдХреЗ рд╡рд┐рднрд┐рдиреНрди рддрд░реАрдХреЗ рд╣реИрдВред

* рдЕрдиреБрдорддрд┐ **`cloudasset.assets.searchAllIamPolicies`** рдПрдХ рд╕рдВрд╕рд╛рдзрди рдХреЗ рднреАрддрд░ **рд╕рднреА iam рдиреАрддрд┐рдпреЛрдВ** рдХрд╛ рдЕрдиреБрд░реЛрдз рдХрд░ рд╕рдХрддреА рд╣реИред
```bash
gcloud asset search-all-iam-policies #By default uses current configured project
gcloud asset search-all-iam-policies --scope folders/1234567
gcloud asset search-all-iam-policies --scope organizations/123456
gcloud asset search-all-iam-policies --scope projects/project-id-123123
```
* рдЕрдиреБрдорддрд┐ **`cloudasset.assets.analyzeIamPolicy`** рдПрдХ рд╕рдВрд╕рд╛рдзрди рдХреЗ рднреАрддрд░ рдПрдХ рдкреНрд░рдореБрдЦ рдХреЗ рд╕рднреА iam рдиреАрддрд┐рдпреЛрдВ рдХрд╛ рдЕрдиреБрд░реЛрдз рдХрд░ рд╕рдХрддреА рд╣реИред
```bash
# Needs perm "cloudasset.assets.analyzeIamPolicy" over the asset
gcloud asset analyze-iam-policy --organization=<org-id> \
--identity='user:email@hacktricks.xyz'
gcloud asset analyze-iam-policy --folder=<folder-id> \
--identity='user:email@hacktricks.xyz'
gcloud asset analyze-iam-policy --project=<project-name> \
--identity='user:email@hacktricks.xyz'
```
* рдЕрдиреБрдорддрд┐ **`cloudasset.assets.searchAllResources`** рдХрд┐рд╕реА рд╕рдВрдЧрдарди, рдлрд╝реЛрд▓реНрдбрд░, рдпрд╛ рдкреНрд░реЛрдЬреЗрдХреНрдЯ рдХреЗ рд╕рднреА рд╕рдВрд╕рд╛рдзрдиреЛрдВ рдХреА рд╕реВрдЪреА рдмрдирд╛рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддреА рд╣реИред IAM рд╕реЗ рд╕рдВрдмрдВрдзрд┐рдд рд╕рдВрд╕рд╛рдзрди (рдЬреИрд╕реЗ рднреВрдорд┐рдХрд╛рдПрдБ) рд╢рд╛рдорд┐рд▓ рд╣реИрдВред
```bash
gcloud asset search-all-resources --scope projects/<proj-name>
gcloud asset search-all-resources --scope folders/1234567
gcloud asset search-all-resources --scope organizations/123456
```
* рдЕрдиреБрдорддрд┐ **`cloudasset.assets.analyzeMove`** рдПрдХ рд╕рдВрд╕рд╛рдзрди рдЬреИрд╕реЗ рдкреНрд░реЛрдЬреЗрдХреНрдЯ рдкрд░ рдкреНрд░рднрд╛рд╡ рдбрд╛рд▓рдиреЗ рд╡рд╛рд▓реА рдиреАрддрд┐рдпреЛрдВ рдХреЛ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рднреА рдЙрдкрдпреЛрдЧреА рд╣реЛ рд╕рдХрддреА рд╣реИред
```bash
gcloud asset analyze-move --project=<proj-name> \
--destination-organization=609216679593
```
* рдореБрдЭреЗ рд▓рдЧрддрд╛ рд╣реИ рдХрд┐ рдЕрдиреБрдорддрд┐ **`cloudasset.assets.queryIamPolicy`** рднреА рдкреНрд░рд┐рдВрд╕рд┐рдкрд▓реЛрдВ рдХреА рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХреЛ рдЦреЛрдЬрдиреЗ рдХреЗ рд▓рд┐рдП рдкрд╣реБрдВрдЪ рджреЗ рд╕рдХрддреА рд╣реИ
```bash
# But, when running something like this
gcloud asset query --project=<proj> --statement='SELECT * FROM compute_googleapis_com_Instance'
# I get the error
ERROR: (gcloud.asset.query) UNAUTHENTICATED: QueryAssets API is only supported for SCC premium customers. See https://cloud.google.com/security-command-center/pricing
```
### testIamPermissions enumeration

{% hint style="danger" %}
рдпрджрд┐ рдЖрдк **рдкрд┐рдЫрд▓реЗ рддрд░реАрдХреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ IAM рдЬрд╛рдирдХрд╛рд░реА рддрдХ рдкрд╣реБрдБрдЪ рдирд╣реАрдВ рд╕рдХрддреЗ** рдФрд░ рдЖрдк рдПрдХ рд░реЗрдб рдЯреАрдо рдореЗрдВ рд╣реИрдВред рдЖрдк **рдЙрдкрдХрд░рдг рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ**[ **https://github.com/carlospolop/bf\_my\_gcp\_perms**](https://github.com/carlospolop/bf\_my\_gcp\_perms) **рдЕрдкрдиреЗ рд╡рд░реНрддрдорд╛рди рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХреЛ рдмреНрд░реВрдЯ-рдлреЛрд░реНрд╕ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдПред**

рд╣рд╛рд▓рд╛рдВрдХрд┐, рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рд╕реЗрд╡рд╛ **`cloudresourcemanager.googleapis.com`** рдХреЛ рд╕рдХреНрд╖рдо рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдПред
{% endhint %}

### Privesc

рдЕрдЧрд▓реА рдкреГрд╖реНрда рдкрд░ рдЖрдк рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ **IAM рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдХреЗ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдХреИрд╕реЗ рдмрдврд╝рд╛рдПрдВ**:

{% content-ref url="../gcp-privilege-escalation/gcp-iam-privesc.md" %}
[gcp-iam-privesc.md](../gcp-privilege-escalation/gcp-iam-privesc.md)
{% endcontent-ref %}

### Unauthenticated Enum <a href="#service-account-impersonation" id="service-account-impersonation"></a>

{% content-ref url="../gcp-unauthenticated-enum-and-access/gcp-iam-principals-and-org-unauthenticated-enum.md" %}
[gcp-iam-principals-and-org-unauthenticated-enum.md](../gcp-unauthenticated-enum-and-access/gcp-iam-principals-and-org-unauthenticated-enum.md)
{% endcontent-ref %}

### Post Exploitation <a href="#service-account-impersonation" id="service-account-impersonation"></a>

{% content-ref url="../gcp-post-exploitation/gcp-iam-post-exploitation.md" %}
[gcp-iam-post-exploitation.md](../gcp-post-exploitation/gcp-iam-post-exploitation.md)
{% endcontent-ref %}

### Persistence

рдпрджрд┐ рдЖрдкрдХреЗ рдкрд╛рд╕ рдЙрдЪреНрдЪ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рд╣реИрдВ рддреЛ рдЖрдк рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:

* рдирдП SAs (рдпрд╛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдпрджрд┐ Workspace рдореЗрдВ рд╣реИрдВ) рдмрдирд╛рдПрдВ
* рдЕрдкрдиреЗ рджреНрд╡рд╛рд░рд╛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдкреНрд░рд┐рдВрд╕рд┐рдкрд▓ рдХреЛ рдЕрдзрд┐рдХ рдЕрдиреБрдорддрд┐рдпрд╛рдБ рджреЗрдВ
* рдХрдордЬреЛрд░ SAs рдХреЛ рдЕрдзрд┐рдХ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рджреЗрдВ (vm рдореЗрдВ SSRF, vuln Cloud FunctionтАж)
* тАж

## Org Policies

Org Policies рдХреНрдпрд╛ рд╣реИрдВ, рдЗрд╕рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдПрдХ рдкрд░рд┐рдЪрдп рдХреЗ рд▓рд┐рдП рджреЗрдЦреЗрдВ:

{% content-ref url="../gcp-basic-information/" %}
[gcp-basic-information](../gcp-basic-information/)
{% endcontent-ref %}

IAM рдиреАрддрд┐рдпрд╛рдБ рдпрд╣ рд╕рдВрдХреЗрдд рджреЗрддреА рд╣реИрдВ рдХрд┐ рдкреНрд░рд┐рдВрд╕рд┐рдкрд▓ рдХреЗ рдкрд╛рд╕ рд╕рдВрд╕рд╛рдзрдиреЛрдВ рдкрд░ рднреВрдорд┐рдХрд╛рдУрдВ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдХреМрди рд╕реА рдЕрдиреБрдорддрд┐рдпрд╛рдБ рд╣реИрдВ, рдЬрд┐рдиреНрд╣реЗрдВ рдмрд╛рд░реАрдХ рдЕрдиреБрдорддрд┐рдпрд╛рдБ рджреА рдЬрд╛рддреА рд╣реИрдВред рд╕рдВрдЧрдарди рдиреАрддрд┐рдпрд╛рдБ **рдпрд╣ рд╕реАрдорд┐рдд рдХрд░рддреА рд╣реИрдВ рдХрд┐ рдЙрди рд╕реЗрд╡рд╛рдУрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХреИрд╕реЗ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдпрд╛ рдХреМрди рд╕реА рд╕реБрд╡рд┐рдзрд╛рдПрдБ рдЕрдХреНрд╖рдо рд╣реИрдВ**ред рдпрд╣ GCP рд╡рд╛рддрд╛рд╡рд░рдг рдореЗрдВ рдкреНрд░рддреНрдпреЗрдХ рд╕рдВрд╕рд╛рдзрди рдХреЗ рд▓рд┐рдП рдиреНрдпреВрдирддрдо рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдХреЛ рд╕реБрдзрд╛рд░рдиреЗ рдореЗрдВ рдорджрдж рдХрд░рддрд╛ рд╣реИред
```bash
gcloud resource-manager org-policies list --organization=ORGANIZATION_ID
gcloud resource-manager org-policies list --folder=FOLDER_ID
gcloud resource-manager org-policies list --project=PROJECT_ID
```
### Privesc

In the following page you can check how to **org рдиреАрддрд┐рдпреЛрдВ рдХреА рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдХреЗ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдмрдврд╝рд╛рдПрдВ**:

{% content-ref url="../gcp-privilege-escalation/gcp-orgpolicy-privesc.md" %}
[gcp-orgpolicy-privesc.md](../gcp-privilege-escalation/gcp-orgpolicy-privesc.md)
{% endcontent-ref %}

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ЁЯТм [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ЁЯРж [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
