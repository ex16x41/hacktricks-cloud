# GCP - Cloud Functions Enum

{% hint style="success" %}
å­¦ä¹ å’Œç»ƒä¹  AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
å­¦ä¹ å’Œç»ƒä¹  GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>æ”¯æŒ HackTricks</summary>

* æŸ¥çœ‹ [**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**telegram ç¾¤ç»„**](https://t.me/peass) æˆ– **å…³æ³¨** æˆ‘ä»¬çš„ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **é€šè¿‡æäº¤ PRs åˆ†äº«é»‘å®¢æŠ€å·§åˆ°** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ä»“åº“ã€‚

</details>
{% endhint %}

## Cloud Functions <a href="#reviewing-cloud-functions" id="reviewing-cloud-functions"></a>

[Google Cloud Functions](https://cloud.google.com/functions/) æ—¨åœ¨æ‰˜ç®¡æ‚¨çš„ä»£ç ï¼Œè¯¥ä»£ç **å“åº”äº‹ä»¶æ‰§è¡Œ**ï¼Œæ— éœ€ç®¡ç†ä¸»æœºæ“ä½œç³»ç»Ÿã€‚æ­¤å¤–ï¼Œè¿™äº›å‡½æ•°æ”¯æŒå­˜å‚¨ç¯å¢ƒå˜é‡ï¼Œä»£ç å¯ä»¥åˆ©ç”¨è¿™äº›å˜é‡ã€‚

### Storage

Cloud Functions **ä»£ç å­˜å‚¨åœ¨ GCP Storage** ä¸­ã€‚å› æ­¤ï¼Œä»»ä½•æ‹¥æœ‰ **bucket è¯»å–æƒé™** çš„äººéƒ½å¯ä»¥**è¯»å– Cloud Functions ä»£ç **ã€‚\
ä»£ç å­˜å‚¨åœ¨å¦‚ä¸‹æ‰€ç¤ºçš„ bucket ä¸­ï¼š

* `gcf-sources-<number>-<region>/<function-name>-<uuid>/version-<n>/function-source.zip`
* `gcf-v2-sources-<number>-<region>/<function-name>function-source.zip`

ä¾‹å¦‚ï¼š\
`gcf-sources-645468741258-us-central1/function-1-003dcbdf-32e1-430f-a5ff-785a6e238c76/version-4/function-source.zip`

{% hint style="warning" %}
ä»»ä½•æ‹¥æœ‰ **bucket è¯»å–æƒé™** çš„ç”¨æˆ·éƒ½å¯ä»¥**è¯»å–æ‰§è¡Œçš„ä»£ç **ã€‚
{% endhint %}

### Artifact Registry

å¦‚æœ cloud function é…ç½®ä¸ºåœ¨é¡¹ç›®å†…çš„ Artifact Registry ä»“åº“ä¸­å­˜å‚¨æ‰§è¡Œçš„ Docker å®¹å™¨ï¼Œä»»ä½•æ‹¥æœ‰ä»“åº“è¯»å–æƒé™çš„äººéƒ½å¯ä»¥ä¸‹è½½é•œåƒå¹¶æ£€æŸ¥æºä»£ç ã€‚æ›´å¤šä¿¡æ¯è¯·æŸ¥çœ‹ï¼š

{% content-ref url="gcp-artifact-registry-enum.md" %}
[gcp-artifact-registry-enum.md](gcp-artifact-registry-enum.md)
{% endcontent-ref %}

### SA

å¦‚æœæœªæŒ‡å®šï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œå…·æœ‰é¡¹ç›® **Editor æƒé™** çš„ **App Engine Default Service Account** å°†é™„åŠ åˆ° Cloud Functionã€‚

### Triggers, URL & Authentication

åˆ›å»º Cloud Function æ—¶éœ€è¦æŒ‡å®š **trigger**ã€‚ä¸€ä¸ªå¸¸è§çš„æ˜¯ **HTTPS**ï¼Œè¿™å°†**åˆ›å»ºä¸€ä¸ª URLï¼Œå‡½æ•°å¯ä»¥é€šè¿‡ç½‘é¡µæµè§ˆè§¦å‘**ã€‚\
å…¶ä»–è§¦å‘å™¨åŒ…æ‹¬ pub/subã€Storageã€Filestore ç­‰ã€‚

URL æ ¼å¼ä¸º **`https://<region>-<project-gcp-name>.cloudfunctions.net/<func_name>`**

ä½¿ç”¨ HTTPS è§¦å‘å™¨æ—¶ï¼Œè¿˜ä¼šæŒ‡æ˜**è°ƒç”¨è€…æ˜¯å¦éœ€è¦ IAM æˆæƒ**æ‰èƒ½è°ƒç”¨å‡½æ•°ï¼Œæˆ–è€…**ä»»ä½•äºº**éƒ½å¯ä»¥è°ƒç”¨å®ƒï¼š

<figure><img src="../../../.gitbook/assets/image (19).png" alt=""><figcaption></figcaption></figure>

### Inside the Cloud Function

ä»£ç **ä¸‹è½½åˆ°**æ–‡ä»¶å¤¹ **`/workspace`** ä¸­ï¼Œæ–‡ä»¶åä¸ Cloud Function ä¸­çš„æ–‡ä»¶åç›¸åŒï¼Œå¹¶ä»¥ç”¨æˆ· `www-data` æ‰§è¡Œã€‚\
ç£ç›˜**æœªæŒ‚è½½ä¸ºåªè¯»**ã€‚

### Enumeration
```bash
# List functions
gcloud functions list
gcloud functions describe <func_name> # Check triggers to see how is this function invoked
gcloud functions get-iam-policy <func_name>

# Get logs of previous runs. By default, limits to 10 lines
gcloud functions logs read <func_name> --limit [NUMBER]

# Call a function
curl https://<region>-<project>.cloudfunctions.net/<func_name>
gcloud functions call <func_name> --data='{"message": "Hello World!"}'

# If you know the name of projects you could try to BF cloud functions names

# Get events that could be used to trigger a cloud function
gcloud functions event-types list

# Access function with authentication
curl -X POST https://<region>-<project>.cloudfunctions.net/<func_name> \
-H "Authorization: bearer $(gcloud auth print-identity-token)" \
-H "Content-Type: application/json" \
-d '{}'
```
### ææƒ

åœ¨ä»¥ä¸‹é¡µé¢ä¸­ï¼Œæ‚¨å¯ä»¥æŸ¥çœ‹å¦‚ä½•**æ»¥ç”¨ cloud function æƒé™æ¥æå‡æƒé™**ï¼š

{% content-ref url="../gcp-privilege-escalation/gcp-cloudfunctions-privesc.md" %}
[gcp-cloudfunctions-privesc.md](../gcp-privilege-escalation/gcp-cloudfunctions-privesc.md)
{% endcontent-ref %}

### æœªç»èº«ä»½éªŒè¯çš„è®¿é—®

{% content-ref url="../gcp-unaunthenticated-enum-and-access/gcp-cloud-functions-unauthenticated-enum.md" %}
[gcp-cloud-functions-unauthenticated-enum.md](../gcp-unaunthenticated-enum-and-access/gcp-cloud-functions-unauthenticated-enum.md)
{% endcontent-ref %}

### åˆ©ç”¨åæ“ä½œ

{% content-ref url="../gcp-post-exploitation/gcp-cloud-functions-post-exploitation.md" %}
[gcp-cloud-functions-post-exploitation.md](../gcp-post-exploitation/gcp-cloud-functions-post-exploitation.md)
{% endcontent-ref %}

### æŒä¹…æ€§

{% content-ref url="../gcp-persistence/gcp-cloud-functions-persistence.md" %}
[gcp-cloud-functions-persistence.md](../gcp-persistence/gcp-cloud-functions-persistence.md)
{% endcontent-ref %}

## å‚è€ƒèµ„æ–™

* [https://about.gitlab.com/blog/2020/02/12/plundering-gcp-escalating-privileges-in-google-cloud-platform/#reviewing-stackdriver-logging](https://about.gitlab.com/blog/2020/02/12/plundering-gcp-escalating-privileges-in-google-cloud-platform/#reviewing-stackdriver-logging)

{% hint style="success" %}
å­¦ä¹ å’Œç»ƒä¹  AWS Hackingï¼š<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
å­¦ä¹ å’Œç»ƒä¹  GCP Hackingï¼š<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>æ”¯æŒ HackTricks</summary>

* æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**telegram ç¾¤ç»„**](https://t.me/peass) æˆ– **å…³æ³¨** æˆ‘ä»¬çš„ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **é€šè¿‡æäº¤ PRs åˆ†äº«é»‘å®¢æŠ€å·§åˆ°** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ä»“åº“ã€‚

</details>
{% endhint %}
