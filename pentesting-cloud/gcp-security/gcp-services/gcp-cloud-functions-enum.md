# GCP - Cloud Functions Enum

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Cloud Functions <a href="#reviewing-cloud-functions" id="reviewing-cloud-functions"></a>

[Google Cloud Functions](https://cloud.google.com/functions/) æ—¨åœ¨æ‰˜ç®¡æ‚¨çš„ä»£ç ï¼Œè¯¥ä»£ç **åœ¨å“åº”äº‹ä»¶æ—¶æ‰§è¡Œ**ï¼Œè€Œæ— éœ€ç®¡ç†ä¸»æœºæ“ä½œç³»ç»Ÿã€‚æ­¤å¤–ï¼Œè¿™äº›å‡½æ•°æ”¯æŒå­˜å‚¨ç¯å¢ƒå˜é‡ï¼Œä»£ç å¯ä»¥åˆ©ç”¨è¿™äº›å˜é‡ã€‚

### Storage

Cloud Functions **ä»£ç å­˜å‚¨åœ¨ GCP Storage ä¸­**ã€‚å› æ­¤ï¼Œä»»ä½•å¯¹ GCP ä¸­çš„**å­˜å‚¨æ¡¶å…·æœ‰è¯»å–æƒé™**çš„äººéƒ½èƒ½å¤Ÿ**è¯»å– Cloud Functions ä»£ç **ã€‚\
ä»£ç å­˜å‚¨åœ¨ä¸€ä¸ªå­˜å‚¨æ¡¶ä¸­ï¼Œæ ¼å¼å¦‚ä¸‹ï¼š

* `gcf-sources-<number>-<region>/<function-name>-<uuid>/version-<n>/function-source.zip`
* `gcf-v2-sources-<number>-<region>/<function-name>function-source.zip`

ä¾‹å¦‚ï¼š\
`gcf-sources-645468741258-us-central1/function-1-003dcbdf-32e1-430f-a5ff-785a6e238c76/version-4/function-source.zip`

{% hint style="warning" %}
ä»»ä½•å¯¹å­˜å‚¨ Cloud Function çš„å­˜å‚¨æ¡¶å…·æœ‰**è¯»å–æƒé™**çš„ç”¨æˆ·éƒ½å¯ä»¥**è¯»å–æ‰§è¡Œçš„ä»£ç **ã€‚
{% endhint %}

### Artifact Registry

å¦‚æœäº‘å‡½æ•°é…ç½®ä¸ºå°†æ‰§è¡Œçš„ Docker å®¹å™¨å­˜å‚¨åœ¨é¡¹ç›®å†…çš„ Artifact Registry ä»“åº“ä¸­ï¼Œä»»ä½•å¯¹è¯¥ä»“åº“å…·æœ‰è¯»å–æƒé™çš„äººéƒ½èƒ½å¤Ÿä¸‹è½½è¯¥é•œåƒå¹¶æ£€æŸ¥æºä»£ç ã€‚æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·æŸ¥çœ‹ï¼š

{% content-ref url="gcp-artifact-registry-enum.md" %}
[gcp-artifact-registry-enum.md](gcp-artifact-registry-enum.md)
{% endcontent-ref %}

### SA

å¦‚æœæœªæŒ‡å®šï¼Œé»˜è®¤æƒ…å†µä¸‹å°†é™„åŠ å…·æœ‰**ç¼–è¾‘æƒé™**çš„**App Engine é»˜è®¤æœåŠ¡å¸æˆ·**åˆ° Cloud Functionã€‚

### Triggers, URL & Authentication

åˆ›å»º Cloud Function æ—¶ï¼Œéœ€è¦æŒ‡å®š**è§¦å‘å™¨**ã€‚ä¸€ä¸ªå¸¸è§çš„è§¦å‘å™¨æ˜¯**HTTPS**ï¼Œè¿™å°†**åˆ›å»ºä¸€ä¸ª URLï¼Œæ‚¨å¯ä»¥é€šè¿‡ç½‘é¡µæµè§ˆè§¦å‘è¯¥å‡½æ•°**ã€‚\
å…¶ä»–è§¦å‘å™¨åŒ…æ‹¬ pub/subã€Storageã€Filestore...

URL æ ¼å¼ä¸º **`https://<region>-<project-gcp-name>.cloudfunctions.net/<func_name>`**

å½“ä½¿ç”¨ HTTPS è§¦å‘å™¨æ—¶ï¼Œè¿˜ä¼šæŒ‡ç¤º**è°ƒç”¨è€…æ˜¯å¦éœ€è¦ IAM æˆæƒ**æ‰èƒ½è°ƒç”¨è¯¥å‡½æ•°ï¼Œæˆ–è€…**æ¯ä¸ªäºº**æ˜¯å¦éƒ½å¯ä»¥è°ƒç”¨å®ƒï¼š

<figure><img src="../../../.gitbook/assets/image (19).png" alt=""><figcaption></figcaption></figure>

### Inside the Cloud Function

ä»£ç **ä¸‹è½½åˆ°**æ–‡ä»¶å¤¹**`/workspace`**ä¸­ï¼Œæ–‡ä»¶åä¸ Cloud Function ä¸­çš„æ–‡ä»¶åç›¸åŒï¼Œå¹¶ä»¥ç”¨æˆ· `www-data` æ‰§è¡Œã€‚\
ç£ç›˜**æœªä»¥åªè¯»æ–¹å¼æŒ‚è½½**ã€‚

### Enumeration
```bash
# List functions
gcloud functions list
gcloud functions describe <func_name> # Check triggers to see how is this function invoked
gcloud functions get-iam-policy <func_name>

# Get logs of previous runs. By default, limits to 10 lines
gcloud functions logs read <func_name> --limit [NUMBER]

# Call a function
curl https://<region>-<project>.cloudfunctions.net/<func_name>
gcloud functions call <func_name> --data='{"message": "Hello World!"}'

# If you know the name of projects you could try to BF cloud functions names

# Get events that could be used to trigger a cloud function
gcloud functions event-types list

# Access function with authentication
curl -X POST https://<region>-<project>.cloudfunctions.net/<func_name> \
-H "Authorization: bearer $(gcloud auth print-identity-token)" \
-H "Content-Type: application/json" \
-d '{}'
```
### æƒé™æå‡

åœ¨ä»¥ä¸‹é¡µé¢ä¸­ï¼Œæ‚¨å¯ä»¥æŸ¥çœ‹å¦‚ä½•**æ»¥ç”¨äº‘å‡½æ•°æƒé™ä»¥æå‡æƒé™**ï¼š

{% content-ref url="../gcp-privilege-escalation/gcp-cloudfunctions-privesc.md" %}
[gcp-cloudfunctions-privesc.md](../gcp-privilege-escalation/gcp-cloudfunctions-privesc.md)
{% endcontent-ref %}

### æœªç»èº«ä»½éªŒè¯çš„è®¿é—®

{% content-ref url="../gcp-unaunthenticated-enum-and-access/gcp-cloud-functions-unauthenticated-enum.md" %}
[gcp-cloud-functions-unauthenticated-enum.md](../gcp-unaunthenticated-enum-and-access/gcp-cloud-functions-unauthenticated-enum.md)
{% endcontent-ref %}

### åˆ©ç”¨å

{% content-ref url="../gcp-post-exploitation/gcp-cloud-functions-post-exploitation.md" %}
[gcp-cloud-functions-post-exploitation.md](../gcp-post-exploitation/gcp-cloud-functions-post-exploitation.md)
{% endcontent-ref %}

### æŒä¹…æ€§

{% content-ref url="../gcp-persistence/gcp-cloud-functions-persistence.md" %}
[gcp-cloud-functions-persistence.md](../gcp-persistence/gcp-cloud-functions-persistence.md)
{% endcontent-ref %}

## å‚è€ƒæ–‡çŒ®

* [https://about.gitlab.com/blog/2020/02/12/plundering-gcp-escalating-privileges-in-google-cloud-platform/#reviewing-stackdriver-logging](https://about.gitlab.com/blog/2020/02/12/plundering-gcp-escalating-privileges-in-google-cloud-platform/#reviewing-stackdriver-logging)

{% hint style="success" %}
å­¦ä¹ å’Œå®è·µ AWS é»‘å®¢æŠ€æœ¯ï¼š<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks åŸ¹è®­ AWS çº¢é˜Ÿä¸“å®¶ (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
å­¦ä¹ å’Œå®è·µ GCP é»‘å®¢æŠ€æœ¯ï¼š<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks åŸ¹è®­ GCP çº¢é˜Ÿä¸“å®¶ (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>æ”¯æŒ HackTricks</summary>

* æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f)æˆ–[**ç”µæŠ¥ç¾¤ç»„**](https://t.me/peass)æˆ–**åœ¨** **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**ä¸Šå…³æ³¨æˆ‘ä»¬ã€‚**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks)å’Œ[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub ä»“åº“æäº¤ PR æ¥åˆ†äº«é»‘å®¢æŠ€å·§ã€‚

</details>
{% endhint %}
