# GCP - Cloud Functions Enum

<details>

<summary><strong>Nau캜ite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi na캜ini podr코ke HackTricks-u:

* Ako 쬰lite da vidite svoju **kompaniju reklamiranu na HackTricks-u** ili **preuzmete HackTricks u PDF formatu** proverite [**PLANOVE ZA PRIJAVU**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvani캜ni PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**Porodi캜nu PEASS**](https://opensea.io/collection/the-peass-family), na코u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **Pridru쬴te se** 游눫 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitteru** 游냕 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>

## Cloud Functions <a href="#reviewing-cloud-functions" id="reviewing-cloud-functions"></a>

[Google Cloud Functions](https://cloud.google.com/functions/) su dizajnirane da hostuju va코 kod, koji **se izvr코ava kao odgovor na doga캠aje**, bez potrebe za upravljanjem operativnim sistemom doma캖ina. Osim toga, ove funkcije podr쬬vaju 캜uvanje promenljivih okru쬰nja, koje kod mo쬰 koristiti.

### Skladi코tenje

Kod Cloud Functions **je sme코ten u GCP Skladi코tu**. Stoga, svako sa **pristupom za 캜itanje nad bucket-ima** u GCP-u 캖e mo캖i **da 캜ita kod Cloud Functions**.\
Kod je sme코ten u bucket-u kao jedan od slede캖ih formata:

* `gcf-sources-<broj>-<region>/<ime-funkcije>-<uuid>/verzija-<n>/izvorni-kod-funkcije.zip`
* `gcf-v2-sources-<broj>-<region>/<ime-funkcije>izvorni-kod-funkcije.zip`

Na primer:\
`gcf-sources-645468741258-us-central1/funkcija-1-003dcbdf-32e1-430f-a5ff-785a6e238c76/verzija-4/izvorni-kod-funkcije.zip`

{% hint style="warning" %}
Svaki korisnik sa **privilegijama za 캜itanje nad bucket-om** koji 캜uva Cloud Function bi mogao **da 캜ita izvr코eni kod**.
{% endhint %}

### Registar Artefakata

Ako je cloud funkcija konfigurisana tako da je izvr코eni Docker kontejner sme코ten unutar Registra Artefakata repozitorijuma unutar projekta, svako sa pristupom za 캜itanje nad repozitorijumom 캖e mo캖i da preuzme sliku i proveri izvorni kod. Za vi코e informacija pogledajte:

{% content-ref url="gcp-artifact-registry-enum.md" %}
[gcp-artifact-registry-enum.md](gcp-artifact-registry-enum.md)
{% endcontent-ref %}

### SA

Ako nije specificirano, podrazumevano 캖e biti povezan **App Engine Podrazumevani Servisni Nalog** sa **Editor privilegijama** nad projektom sa Cloud Function.

### Okida캜i, URL & Autentikacija

Kada se kreira Cloud Function, potrebno je specificirati **okida캜**. Jedan uobi캜ajeni je **HTTPS**, koji 캖e **kreirati URL gde funkcija** mo쬰 biti okida캜 putem web pregleda캜a.\
Drugi okida캜i su pub/sub, Skladi코te, Filestore...

Format URL-a je **`https://<region>-<ime-projekta-gcp>.cloudfunctions.net/<ime_funkcije>`**

Kada se koristi HTTPS okida캜, tako캠e je nazna캜eno da li **pozivaoc treba da ima IAM autorizaciju** da pozove Funkciju ili ako to mo쬰 uraditi **svako**:

<figure><img src="../../../.gitbook/assets/image (19).png" alt=""><figcaption></figcaption></figure>

### Unutar Cloud Funkcije

Kod je **preuzet unutar** foldera **`/workspace`** sa istim imenima fajlova kao 코to ih imaju fajlovi u Cloud Function i izvr코ava se sa korisnikom `www-data`.\
Disk **nije montiran kao samo za 캜itanje.**

### Enumeracija
```bash
# List functions
gcloud functions list
gcloud functions describe <func_name> # Check triggers to see how is this function invoked
gcloud functions get-iam-policy <func_name>

# Get logs of previous runs. By default, limits to 10 lines
gcloud functions logs read <func_name> --limit [NUMBER]

# Call a function
curl https://<region>-<project>.cloudfunctions.net/<func_name>
gcloud functions call <func_name> --data='{"message": "Hello World!"}'

# If you know the name of projects you could try to BF cloud functions names

# Get events that could be used to trigger a cloud function
gcloud functions event-types list

# Access function with authentication
curl -X POST https://<region>-<project>.cloudfunctions.net/<func_name> \
-H "Authorization: bearer $(gcloud auth print-identity-token)" \
-H "Content-Type: application/json" \
-d '{}'
```
### Eskalacija privilegija

Na slede캖oj stranici mo쬰te proveriti kako **zloupotrebiti dozvole cloud funkcija radi eskalacije privilegija**:

{% content-ref url="../gcp-privilege-escalation/gcp-cloudfunctions-privesc.md" %}
[gcp-cloudfunctions-privesc.md](../gcp-privilege-escalation/gcp-cloudfunctions-privesc.md)
{% endcontent-ref %}

### Neautentifikovan pristup

{% content-ref url="../gcp-unaunthenticated-enum-and-access/gcp-cloud-functions-unauthenticated-enum.md" %}
[gcp-cloud-functions-unauthenticated-enum.md](../gcp-unaunthenticated-enum-and-access/gcp-cloud-functions-unauthenticated-enum.md)
{% endcontent-ref %}

### Post eksploatacija

{% content-ref url="../gcp-post-exploitation/gcp-cloud-functions-post-exploitation.md" %}
[gcp-cloud-functions-post-exploitation.md](../gcp-post-exploitation/gcp-cloud-functions-post-exploitation.md)
{% endcontent-ref %}

### Upornost

{% content-ref url="../gcp-persistence/gcp-cloud-functions-persistence.md" %}
[gcp-cloud-functions-persistence.md](../gcp-persistence/gcp-cloud-functions-persistence.md)
{% endcontent-ref %}

## Reference

* [https://about.gitlab.com/blog/2020/02/12/plundering-gcp-escalating-privileges-in-google-cloud-platform/#reviewing-stackdriver-logging](https://about.gitlab.com/blog/2020/02/12/plundering-gcp-escalating-privileges-in-google-cloud-platform/#reviewing-stackdriver-logging)

<details>

<summary><strong>Nau캜ite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi na캜ini podr코ke HackTricks-u:

* Ako 쬰lite da vidite svoju **kompaniju reklamiranu na HackTricks-u** ili da **preuzmete HackTricks u PDF formatu** proverite [**PLANOVE ZA PRIJAVU**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvani캜ni PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), na코u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **Pridru쬴te se** 游눫 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitteru** 游냕 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
