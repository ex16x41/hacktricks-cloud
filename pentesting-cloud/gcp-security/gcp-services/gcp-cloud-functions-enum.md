# GCP - Cloud Functions Enum

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** 游눫 [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** 游냕 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Cloud Functions <a href="#reviewing-cloud-functions" id="reviewing-cloud-functions"></a>

[Google Cloud Functions](https://cloud.google.com/functions/) su dizajnirane da hostuju va코 kod, koji **se izvr코ava kao odgovor na doga캠aje**, bez potrebe za upravljanjem host operativnim sistemom. Pored toga, ove funkcije podr쬬vaju skladi코tenje promenljivih okru쬰nja, koje kod mo쬰 koristiti.

### Storage

Kod Cloud Functions **se skladi코ti u GCP Storage**. Stoga, svako ko ima **pristup za 캜itanje nad bucket-ima** u GCP 캖e mo캖i da **pro캜ita kod Cloud Functions**.\
Kod se skladi코ti u bucket-u kao jedan od slede캖ih:

* `gcf-sources-<number>-<region>/<function-name>-<uuid>/version-<n>/function-source.zip`
* `gcf-v2-sources-<number>-<region>/<function-name>function-source.zip`

Na primer:\
`gcf-sources-645468741258-us-central1/function-1-003dcbdf-32e1-430f-a5ff-785a6e238c76/version-4/function-source.zip`

{% hint style="warning" %}
Svaki korisnik sa **privilgijama za 캜itanje nad bucket-om** koji skladi코ti Cloud Function mo쬰 **pro캜itati izvr코eni kod**.
{% endhint %}

### Artifact Registry

Ako je cloud funkcija konfigurisana tako da se izvr코eni Docker kontejner skladi코ti unutar Artifact Registry repozitorijuma unutar projekta, svako ko ima pristup za 캜itanje nad repozitorijumom 캖e mo캖i da preuzme sliku i proveri izvorni kod. Za vi코e informacija pogledajte:

{% content-ref url="gcp-artifact-registry-enum.md" %}
[gcp-artifact-registry-enum.md](gcp-artifact-registry-enum.md)
{% endcontent-ref %}

### SA

Ako nije navedeno, podrazumevano 캖e biti prilo쬰n **App Engine Default Service Account** sa **Editor privilegijama** nad projektom.

### Triggers, URL & Authentication

Kada se kreira Cloud Function, potrebno je odrediti **okida캜**. Jedan uobi캜ajen je **HTTPS**, 코to 캖e **napraviti URL gde se funkcija** mo쬰 aktivirati putem web pretra쬴va캜a.\
Ostali okida캜i su pub/sub, Storage, Filestore...

Format URL-a je **`https://<region>-<project-gcp-name>.cloudfunctions.net/<func_name>`**

Kada se koristi HTTPS okida캜, tako캠e se nazna캜uje da li **pozivalac treba da ima IAM autorizaciju** da pozove funkciju ili ako **svako** mo쬰 jednostavno da je pozove:

<figure><img src="../../../.gitbook/assets/image (19).png" alt=""><figcaption></figcaption></figure>

### Inside the Cloud Function

Kod se **preuzima unutar** foldera **`/workspace`** sa istim nazivima datoteka kao 코to ih datoteke imaju u Cloud Function i izvr코ava se sa korisnikom `www-data`.\
Disk **nije montiran kao samo za 캜itanje.**

### Enumeration
```bash
# List functions
gcloud functions list
gcloud functions describe <func_name> # Check triggers to see how is this function invoked
gcloud functions get-iam-policy <func_name>

# Get logs of previous runs. By default, limits to 10 lines
gcloud functions logs read <func_name> --limit [NUMBER]

# Call a function
curl https://<region>-<project>.cloudfunctions.net/<func_name>
gcloud functions call <func_name> --data='{"message": "Hello World!"}'

# If you know the name of projects you could try to BF cloud functions names

# Get events that could be used to trigger a cloud function
gcloud functions event-types list

# Access function with authentication
curl -X POST https://<region>-<project>.cloudfunctions.net/<func_name> \
-H "Authorization: bearer $(gcloud auth print-identity-token)" \
-H "Content-Type: application/json" \
-d '{}'
```
### Eskalacija privilegija

Na slede캖oj stranici mo쬰te proveriti kako da **zloupotrebite dozvole cloud funkcija za eskalaciju privilegija**:

{% content-ref url="../gcp-privilege-escalation/gcp-cloudfunctions-privesc.md" %}
[gcp-cloudfunctions-privesc.md](../gcp-privilege-escalation/gcp-cloudfunctions-privesc.md)
{% endcontent-ref %}

### Neautentifikovani pristup

{% content-ref url="../gcp-unauthenticated-enum-and-access/gcp-cloud-functions-unauthenticated-enum.md" %}
[gcp-cloud-functions-unauthenticated-enum.md](../gcp-unauthenticated-enum-and-access/gcp-cloud-functions-unauthenticated-enum.md)
{% endcontent-ref %}

### Post eksploatacija

{% content-ref url="../gcp-post-exploitation/gcp-cloud-functions-post-exploitation.md" %}
[gcp-cloud-functions-post-exploitation.md](../gcp-post-exploitation/gcp-cloud-functions-post-exploitation.md)
{% endcontent-ref %}

### Persistencija

{% content-ref url="../gcp-persistence/gcp-cloud-functions-persistence.md" %}
[gcp-cloud-functions-persistence.md](../gcp-persistence/gcp-cloud-functions-persistence.md)
{% endcontent-ref %}

## Reference

* [https://about.gitlab.com/blog/2020/02/12/plundering-gcp-escalating-privileges-in-google-cloud-platform/#reviewing-stackdriver-logging](https://about.gitlab.com/blog/2020/02/12/plundering-gcp-escalating-privileges-in-google-cloud-platform/#reviewing-stackdriver-logging)

{% hint style="success" %}
U캜ite i ve쬭ajte AWS Hacking:<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
U캜ite i ve쬭ajte GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Podr쬴te HackTricks</summary>

* Proverite [**planove pretplate**](https://github.com/sponsors/carlospolop)!
* **Pridru쬴te se** 游눫 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili **pratite** nas na **Twitteru** 游냕 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podelite hakerske trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
{% endhint %}
