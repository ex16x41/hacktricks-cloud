# GCP - Secrets Manager Enum

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Secret Manager

O Google [**Secret Manager**](https://cloud.google.com/solutions/secrets-management/) √© uma solu√ß√£o semelhante a um cofre para armazenar senhas, chaves de API, certificados, arquivos (m√°x. 64KB) e outros dados sens√≠veis.

Um segredo pode ter **diferentes vers√µes armazenando diferentes dados**.

Os segredos, por **padr√£o**, s√£o **criptografados usando uma chave gerenciada pelo Google**, mas √© **poss√≠vel selecionar uma chave do KMS** para usar na criptografia do segredo.

Quanto √† **rota√ß√£o**, √© poss√≠vel configurar **mensagens para serem enviadas ao pub-sub a cada n√∫mero de dias**, o c√≥digo que escuta essas mensagens pode **rotacionar o segredo**.

√â poss√≠vel configurar um dia para **exclus√£o autom√°tica**, quando o dia indicado for **atingido**, o **segredo ser√° automaticamente exclu√≠do**.

### Enumeration
```bash
# First, list the entries
gcloud secrets list
gcloud secrets get-iam-policy <secret_name>

# Then, pull the clear-text of any version of any secret
gcloud secrets versions list <secret_name>
gcloud secrets versions access 1 --secret="<secret_name>"
```
### Escalada de Privil√©gios

Na p√°gina a seguir, voc√™ pode verificar como **abusar das permiss√µes do secretmanager para escalar privil√©gios.**

{% content-ref url="../gcp-privilege-escalation/gcp-secretmanager-privesc.md" %}
[gcp-secretmanager-privesc.md](../gcp-privilege-escalation/gcp-secretmanager-privesc.md)
{% endcontent-ref %}

### P√≥s Explora√ß√£o

{% content-ref url="../gcp-post-exploitation/gcp-secretmanager-post-exploitation.md" %}
[gcp-secretmanager-post-exploitation.md](../gcp-post-exploitation/gcp-secretmanager-post-exploitation.md)
{% endcontent-ref %}

### Persist√™ncia

{% content-ref url="../gcp-persistence/gcp-secret-manager-persistence.md" %}
[gcp-secret-manager-persistence.md](../gcp-persistence/gcp-secret-manager-persistence.md)
{% endcontent-ref %}

### Uso indevido de rota√ß√£o

Um atacante poderia atualizar o segredo para **parar as rota√ß√µes** (para que n√£o seja modificado), ou **fazer rota√ß√µes muito menos frequentes** (para que o segredo n√£o seja modificado) ou **publicar a mensagem de rota√ß√£o em um pub/sub diferente**, ou modificar o c√≥digo de rota√ß√£o que est√° sendo executado (isso acontece em um servi√ßo diferente, provavelmente em uma Cloud Function, ent√£o o atacante precisar√° de acesso privilegiado sobre a Cloud Function ou qualquer outro servi√ßo)

{% hint style="success" %}
Aprenda e pratique Hacking AWS:<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
Aprenda e pratique Hacking GCP: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Confira os [**planos de assinatura**](https://github.com/sponsors/carlospolop)!
* **Junte-se ao** üí¨ [**grupo do Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga**-nos no **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Compartilhe truques de hacking enviando PRs para os reposit√≥rios do** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
{% endhint %}
