# GCP - Hesaplama Enum

<details>

<summary><strong>SÄ±fÄ±rdan kahraman olmaya kadar AWS hackleme Ã¶ÄŸrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ±)</strong></a><strong>!</strong></summary>

HackTricks'Ä± desteklemenin diÄŸer yollarÄ±:

* **Åirketinizi HackTricks'te reklamÄ±nÄ± gÃ¶rmek istiyorsanÄ±z** veya **HackTricks'i PDF olarak indirmek istiyorsanÄ±z** [**ABONELÄ°K PLANLARI**]'na (https://github.com/sponsors/carlospolop) gÃ¶z atÄ±n!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* [**The PEASS Ailesi'ni**](https://opensea.io/collection/the-peass-family) keÅŸfedin, Ã¶zel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuz
* **KatÄ±lÄ±n** ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) veya bizi **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** takip edin.**
* **Hacking pÃ¼f noktalarÄ±nÄ±zÄ± paylaÅŸarak PR'lar gÃ¶ndererek** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na.

</details>

## GCP VPC ve AÄŸ

Bunun nasÄ±l Ã§alÄ±ÅŸtÄ±ÄŸÄ±nÄ± Ã¶ÄŸrenin:

{% content-ref url="gcp-vpc-and-networking.md" %}
[gcp-vpc-and-networking.md](gcp-vpc-and-networking.md)
{% endcontent-ref %}

### Enumerasyon

{% code overflow="wrap" %}
```bash
# List networks
gcloud compute networks list
gcloud compute networks describe <network>

# List subnetworks
gcloud compute networks subnets list
gcloud compute networks subnets get-iam-policy <name> --region <region>
gcloud compute networks subnets describe <name> --region <region>

# List FW rules in networks
gcloud compute firewall-rules list --format="table(
name,
network,
direction,
priority,
sourceRanges.list():label=SRC_RANGES,
destinationRanges.list():label=DEST_RANGES,
allowed[].map().firewall_rule().list():label=ALLOW,
denied[].map().firewall_rule().list():label=DENY,
sourceTags.list():label=SRC_TAGS,
sourceServiceAccounts.list():label=SRC_SVC_ACCT,
targetTags.list():label=TARGET_TAGS,
targetServiceAccounts.list():label=TARGET_SVC_ACCT,
disabled
)"

# List Hierarchical Firewalls
gcloud compute firewall-policies list  (--folder <value>| --organization <value>)
gcloud compute firewall-policies describe <fw_policy>
gcloud compute firewall-policies list-rules <fw_policy>

# Get Firewalls of each region
gcloud compute network-firewall-policies list
## Get final FWs applied in a region
gcloud compute network-firewall-policies get-effective-firewalls --network=<vpc_name> --region <region>
```
{% endcode %}

AÃ§Ä±k gÃ¼venlik duvarÄ± kurallarÄ±na sahip hesaplama Ã¶rneklerini kolayca bulabilirsiniz [https://gitlab.com/gitlab-com/gl-security/security-operations/gl-redteam/gcp\_firewall\_enum](https://gitlab.com/gitlab-com/gl-security/security-operations/gl-redteam/gcp\_firewall\_enum)

## Hesaplama Ã–rnekleri

Bu, **GCP iÃ§inde sanal makineleri Ã§alÄ±ÅŸtÄ±rabileceÄŸiniz yol.** Daha fazla bilgi iÃ§in bu sayfaya gÃ¶z atÄ±n:

{% content-ref url="gcp-compute-instance.md" %}
[gcp-compute-instance.md](gcp-compute-instance.md)
{% endcontent-ref %}

### NumaralandÄ±rma
```bash
# Get list of zones
# It's interesting to know which zones are being used
gcloud compute regions list | grep -E "NAME|[^0]/"

# List compute instances & get info
gcloud compute instances list
gcloud compute instances describe <instance name>
gcloud compute instances get-iam-policy <instance> --zone=ZONE
gcloud compute instances get-screenshot <instance name> # Instace must have "Display Device" enabled
gcloud compute instances os-inventory list-instances # Get OS info of instances (OS Config agent is running on instances)


# Enumerate disks
gcloud compute disks list
gcloud compute disks describe <disk>
gcloud compute disks get-iam-policy <disk>
```
### Yetkilendirme YÃ¼kseltme

AÅŸaÄŸÄ±daki sayfada, **yetkilendirme yÃ¼kseltmek iÃ§in bilgisayar izinlerini kÃ¶tÃ¼ye nasÄ±l kullanabileceÄŸinizi** kontrol edebilirsiniz:

{% content-ref url="../../gcp-privilege-escalation/gcp-compute-privesc/" %}
[gcp-compute-privesc](../../gcp-privilege-escalation/gcp-compute-privesc/)
{% endcontent-ref %}

### Kimlik DoÄŸrulamasÄ±z Sorgulama

{% content-ref url="../../gcp-unaunthenticated-enum-and-access/gcp-compute-unauthenticated-enum.md" %}
[gcp-compute-unauthenticated-enum.md](../../gcp-unaunthenticated-enum-and-access/gcp-compute-unauthenticated-enum.md)
{% endcontent-ref %}

### SaldÄ±rÄ± SonrasÄ± Ä°ÅŸlemler

{% content-ref url="../../gcp-post-exploitation/gcp-compute-post-exploitation.md" %}
[gcp-compute-post-exploitation.md](../../gcp-post-exploitation/gcp-compute-post-exploitation.md)
{% endcontent-ref %}

### KalÄ±cÄ±lÄ±k

{% content-ref url="../../gcp-persistence/gcp-compute-persistence.md" %}
[gcp-compute-persistence.md](../../gcp-persistence/gcp-compute-persistence.md)
{% endcontent-ref %}

## Seri Konsol KayÄ±tlarÄ±

Bilgisayar Motoru Seri Konsol KayÄ±tlarÄ±, sanal makine Ã¶rneklerinizin **Ã¶nyÃ¼kleme ve iÅŸletim sistemi kayÄ±tlarÄ±nÄ± gÃ¶rÃ¼ntÃ¼lemenize ve teÅŸhis etmenize** olanak tanÄ±yan bir Ã¶zelliktir.

Seri Konsol KayÄ±tlarÄ±, Ã¶nyÃ¼kleme sÃ¼recinin **dÃ¼ÅŸÃ¼k seviyeli bir gÃ¶rÃ¼nÃ¼mÃ¼nÃ¼** saÄŸlar; bu, Ã¶nyÃ¼kleme sÄ±rasÄ±nda meydana gelen Ã§ekirdek iletileri, init betikleri ve diÄŸer sistem olaylarÄ±nÄ± iÃ§erir. Bu, Ã¶nyÃ¼kleme sorunlarÄ±nÄ± hata ayÄ±klamak, yanlÄ±ÅŸ yapÄ±landÄ±rmalarÄ± veya yazÄ±lÄ±m hatalarÄ±nÄ± tanÄ±mlamak veya aÄŸ baÄŸlantÄ± sorunlarÄ±nÄ± gidermek iÃ§in faydalÄ± olabilir.

Bu kayÄ±tlar, genellikle dÃ¼ÅŸÃ¼k ayrÄ±calÄ±klÄ± kullanÄ±cÄ±larÄ±n gÃ¶rmemesi gereken sistem kayÄ±tlarÄ±ndan **duyarlÄ± bilgileri ortaya Ã§Ä±karabilir**, ancak uygun IAM izinleriyle bunlarÄ± okuyabilirsiniz.

Seri port kayÄ±tlarÄ±nÄ± sorgulamak iÃ§in aÅŸaÄŸÄ±daki [gcloud komutunu](https://cloud.google.com/sdk/gcloud/reference/compute/instances/get-serial-port-output) kullanabilirsiniz (gereken izin `compute.instances.getSerialPortOutput`):
```bash
gcloud compute instances get-serial-port-output <instance-name>
```
## BaÅŸlangÄ±Ã§ Betikleri Ã§Ä±ktÄ±sÄ±

VM'den ÅŸu komutu Ã§alÄ±ÅŸtÄ±rarak **baÅŸlangÄ±Ã§ betiklerinin Ã§Ä±ktÄ±sÄ±nÄ±** gÃ¶rmek mÃ¼mkÃ¼ndÃ¼r:
```bash
sudo journalctl -u google-startup-scripts.service
```
## Ä°ÅŸletim Sistemi YapÄ±landÄ±rma YÃ¶neticisi

Ä°ÅŸletim sistemi yapÄ±landÄ±rma yÃ¶neticisi hizmetini kullanarak sanal makine Ã¶rneÄŸinizin (VM) **istenen durumu ve yazÄ±lÄ±mÄ± daÄŸÄ±tmak, sorgulamak ve tutarlÄ± yapÄ±landÄ±rmalarÄ± sÃ¼rdÃ¼rmek** iÃ§in kullanabilirsiniz. Compute Engine Ã¼zerinde, VM'lerinizde tutarlÄ± yazÄ±lÄ±m yapÄ±landÄ±rmalarÄ±nÄ± sÃ¼rdÃ¼rmek iÃ§in [konuk politikalarÄ±nÄ±](https://cloud.google.com/compute/docs/os-config-management#guest-policy) kullanmalÄ±sÄ±nÄ±z.

Ä°ÅŸletim Sistemi YapÄ±landÄ±rma yÃ¶netimi Ã¶zelliÄŸi, VM'lerinizde hangi yazÄ±lÄ±m paketlerinin yÃ¼klÃ¼ olmasÄ± gerektiÄŸini, hangi hizmetlerin etkinleÅŸtirilmesi gerektiÄŸini ve hangi dosyalarÄ±n veya yapÄ±landÄ±rmalarÄ±n VM'lerinizde bulunmasÄ± gerektiÄŸini belirten yapÄ±landÄ±rma politikalarÄ±nÄ± tanÄ±mlamanÄ±za olanak tanÄ±r. VM'lerinizin yazÄ±lÄ±m yapÄ±landÄ±rmasÄ±nÄ± yÃ¶netmek iÃ§in deklaratif bir yaklaÅŸÄ±m kullanabilirsiniz, bu da yapÄ±landÄ±rma yÃ¶netim sÃ¼recinizi daha kolay otomatikleÅŸtirmenize ve Ã¶lÃ§eklendirmenize olanak tanÄ±r.

Bu ayrÄ±ca IAM izinleri aracÄ±lÄ±ÄŸÄ±yla Ã¶rneklerde oturum aÃ§manÄ±za olanak tanÄ±r, bu nedenle **hak yÃ¼kseltme ve dÃ¶nÃ¼ÅŸ** iÃ§in Ã§ok **yararlÄ±dÄ±r**.

{% hint style="warning" %}
**Bir projenin veya bir Ã¶rneÄŸin iÃ§inde os-config'i etkinleÅŸtirmek** iÃ§in sadece istenen dÃ¼zeyde **`enable-oslogin`** anahtarÄ±nÄ± **`true`** olarak ayarlamanÄ±z yeterlidir.\
AyrÄ±ca, 2fa'yÄ± etkinleÅŸtirmek iÃ§in **`enable-oslogin-2fa`** anahtarÄ±nÄ± **`true`** olarak ayarlayabilirsiniz.

Bir Ã¶rneÄŸi oluÅŸtururken etkinleÅŸtirdiÄŸinizde, metadata anahtarlarÄ± otomatik olarak ayarlanacaktÄ±r.
{% endhint %}

**OS-config'de 2fa hakkÄ±nda** daha fazla bilgi, **kullanÄ±cÄ± bir kullanÄ±cÄ±ysa** yalnÄ±zca uygulanÄ±r, eÄŸer bir SA ise (Ã¶rneÄŸin, compute SA gibi) ekstra bir ÅŸey gerektirmez.

### NumaralandÄ±rma
```bash
gcloud compute os-config patch-deployments list
gcloud compute os-config patch-deployments describe <patch-deployment>

gcloud compute os-config patch-jobs list
gcloud compute os-config patch-jobs describe <patch-job>
```
## GÃ¶rÃ¼ntÃ¼ler

### Ã–zel GÃ¶rÃ¼ntÃ¼ler

**Ã–zel hesaplama gÃ¶rÃ¼ntÃ¼leri hassas ayrÄ±ntÄ±lar** veya baÅŸka zayÄ±f yapÄ±landÄ±rmalar iÃ§erebilir ki bunlarÄ± sÃ¶mÃ¼rebilirsiniz.

Bir gÃ¶rÃ¼ntÃ¼ oluÅŸturulduÄŸunda **3 tÃ¼r ÅŸifreleme** seÃ§ebilirsiniz: **Google tarafÄ±ndan yÃ¶netilen anahtar** (varsayÄ±lan), bir **KMS'den anahtar**, veya mÃ¼ÅŸteri tarafÄ±ndan verilen bir **ham anahtar**.

#### NumaralandÄ±rma

Bir projedeki standart olmayan gÃ¶rÃ¼ntÃ¼lerin listesini sorgulayabilirsiniz aÅŸaÄŸÄ±daki komutla:

{% code overflow="wrap" %}
```bash
gcloud compute machine-images list
gcloud compute machine-images describe <name>
gcloud compute machine-images get-iam-policy <name>
```
{% endcode %}

Herhangi bir gÃ¶rÃ¼ntÃ¼den sanal diskleri Ã§eÅŸitli biÃ§imlerde [**dÄ±ÅŸa aktarabilirsiniz**](https://cloud.google.com/sdk/gcloud/reference/compute/images/export). AÅŸaÄŸÄ±daki komut, `test-image` gÃ¶rÃ¼ntÃ¼sÃ¼nÃ¼ qcow2 biÃ§iminde dÄ±ÅŸa aktaracak ve dosyayÄ± indirip daha fazla inceleme iÃ§in yerel olarak bir sanal makine oluÅŸturmanÄ±za olanak tanÄ±yacaktÄ±r:
```bash
gcloud compute images export --image test-image \
--export-format qcow2 --destination-uri [BUCKET]

# Execute container inside a docker
docker run --rm -ti gcr.io/<project-name>/secret:v1 sh
```
#### Yetki YÃ¼kseltme

Bilgisayar Ã–rnekleri yetki yÃ¼kseltme bÃ¶lÃ¼mÃ¼nÃ¼ kontrol edin.

### Ã–zel Ã–rnek ÅablonlarÄ±

Bir [**Ã¶rnek ÅŸablonu**](https://cloud.google.com/compute/docs/instance-templates/), tutarlÄ± yapÄ±landÄ±rmalarÄ± daÄŸÄ±tmaya yardÄ±mcÄ± olmak iÃ§in Ã¶rnek Ã¶zelliklerini tanÄ±mlar. Bu, Ã§alÄ±ÅŸan bir Ã¶rneÄŸin Ã¶zel meta verileri gibi aynÄ± tÃ¼rde hassas verileri iÃ§erebilir. AraÅŸtÄ±rmak iÃ§in aÅŸaÄŸÄ±daki komutlarÄ± kullanabilirsiniz:
```bash
# List the available templates
gcloud compute instance-templates list

# Get the details of a specific template
gcloud compute instance-templates describe [TEMPLATE NAME]
```
## AnlÄ±k GÃ¶rÃ¼ntÃ¼ler

**AnlÄ±k gÃ¶rÃ¼ntÃ¼ler disk yedeklemeleridir**. Bu, bir diski klonlamakla aynÄ± ÅŸey deÄŸildir (baÅŸka bir mevcut Ã¶zellik).\
**AnlÄ±k gÃ¶rÃ¼ntÃ¼**, alÄ±ndÄ±ÄŸÄ± disk ile **aynÄ± ÅŸifrelemeyi kullanacaktÄ±r**.

### NumaralandÄ±rma
```bash
gcloud compute snapshots list
gcloud compute snapshots describe <snapshot>
gcloud compute snapshots get-iam-policy <snapshot>
```
### Yetki YÃ¼kseltme

Bilgi Ä°ÅŸlem Ã–rneklerinde Yetki YÃ¼kseltme bÃ¶lÃ¼mÃ¼nÃ¼ kontrol edin.

## Referanslar

* [https://blog.raphael.karger.is/articles/2022-08/GCP-OS-Patching](https://blog.raphael.karger.is/articles/2022-08/GCP-OS-Patching)

<details>

<summary><strong>SÄ±fÄ±rdan Kahraman'a AWS hackleme Ã¶ÄŸrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

HackTricks'i desteklemenin diÄŸer yollarÄ±:

* **Åirketinizi HackTricks'te reklamÄ±nÄ± gÃ¶rmek istiyorsanÄ±z** veya **HackTricks'i PDF olarak indirmek istiyorsanÄ±z** [**ABONELÄ°K PLANLARI**]'na gÃ¶z atÄ±n (https://github.com/sponsors/carlospolop)!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) koleksiyonumuzu keÅŸfedin, Ã¶zel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family)
* **ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n veya bizi **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.** takip edin.
* **Hacking pÃ¼f noktalarÄ±nÄ±zÄ± paylaÅŸarak PR'ler gÃ¶ndererek** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na katkÄ±da bulunun.

</details>
