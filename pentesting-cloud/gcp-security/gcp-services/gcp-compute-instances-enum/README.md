# GCP - Compute Enum

{% hint style="success" %}
AWS Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n:<img src="../../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks EÄŸitim AWS KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ± (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
GCP Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n: <img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks EÄŸitim GCP KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ± (GRTE)**<img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**abonelik planlarÄ±nÄ±**](https://github.com/sponsors/carlospolop) kontrol edin!
* **ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n ya da **Twitter'da** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**'i takip edin.**
* **Hacking ipuÃ§larÄ±nÄ± paylaÅŸmak iÃ§in** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna PR gÃ¶nderin.

</details>
{% endhint %}

## GCP VPC & Networking

Bunun nasÄ±l Ã§alÄ±ÅŸtÄ±ÄŸÄ±nÄ± Ã¶ÄŸrenin:

{% content-ref url="gcp-vpc-and-networking.md" %}
[gcp-vpc-and-networking.md](gcp-vpc-and-networking.md)
{% endcontent-ref %}

### Enumeration

{% code overflow="wrap" %}
```bash
# List networks
gcloud compute networks list
gcloud compute networks describe <network>

# List subnetworks
gcloud compute networks subnets list
gcloud compute networks subnets get-iam-policy <name> --region <region>
gcloud compute networks subnets describe <name> --region <region>

# List FW rules in networks
gcloud compute firewall-rules list --format="table(
name,
network,
direction,
priority,
sourceRanges.list():label=SRC_RANGES,
destinationRanges.list():label=DEST_RANGES,
allowed[].map().firewall_rule().list():label=ALLOW,
denied[].map().firewall_rule().list():label=DENY,
sourceTags.list():label=SRC_TAGS,
sourceServiceAccounts.list():label=SRC_SVC_ACCT,
targetTags.list():label=TARGET_TAGS,
targetServiceAccounts.list():label=TARGET_SVC_ACCT,
disabled
)"

# List Hierarchical Firewalls
gcloud compute firewall-policies list  (--folder <value>| --organization <value>)
gcloud compute firewall-policies describe <fw_policy>
gcloud compute firewall-policies list-rules <fw_policy>

# Get Firewalls of each region
gcloud compute network-firewall-policies list
## Get final FWs applied in a region
gcloud compute network-firewall-policies get-effective-firewalls --network=<vpc_name> --region <region>
```
{% endcode %}

AÃ§Ä±k gÃ¼venlik duvarÄ± kurallarÄ±yla compute instance'larÄ± kolayca bulabilirsiniz [https://gitlab.com/gitlab-com/gl-security/security-operations/gl-redteam/gcp\_firewall\_enum](https://gitlab.com/gitlab-com/gl-security/security-operations/gl-redteam/gcp\_firewall\_enum)

## Compute instance'larÄ±

Bu, **GCP iÃ§inde sanal makineleri Ã§alÄ±ÅŸtÄ±rmanÄ±n yoludur.** Daha fazla bilgi iÃ§in bu sayfayÄ± kontrol edin:

{% content-ref url="gcp-compute-instance.md" %}
[gcp-compute-instance.md](gcp-compute-instance.md)
{% endcontent-ref %}

### Enumeration
```bash
# Get list of zones
# It's interesting to know which zones are being used
gcloud compute regions list | grep -E "NAME|[^0]/"

# List compute instances & get info
gcloud compute instances list
gcloud compute instances describe <instance name>
gcloud compute instances get-iam-policy <instance> --zone=ZONE
gcloud compute instances get-screenshot <instance name> # Instace must have "Display Device" enabled
gcloud compute instances os-inventory list-instances # Get OS info of instances (OS Config agent is running on instances)


# Enumerate disks
gcloud compute disks list
gcloud compute disks describe <disk>
gcloud compute disks get-iam-policy <disk>
```
Daha fazla bilgi iÃ§in **SSH** veya bir Ã¶rneÄŸin **metadata'sÄ±nÄ± deÄŸiÅŸtirme** ile **yetki yÃ¼kseltme** hakkÄ±nda, bu sayfaya bakÄ±n:

{% content-ref url="../../gcp-privilege-escalation/gcp-local-privilege-escalation-ssh-pivoting.md" %}
[gcp-local-privilege-escalation-ssh-pivoting.md](../../gcp-privilege-escalation/gcp-local-privilege-escalation-ssh-pivoting.md)
{% endcontent-ref %}

### Yetki YÃ¼kseltme

AÅŸaÄŸÄ±daki sayfada, **hesaplama izinlerini kÃ¶tÃ¼ye kullanarak yetki yÃ¼kseltme** nasÄ±l yapÄ±lacaÄŸÄ±nÄ± kontrol edebilirsiniz:

{% content-ref url="../../gcp-privilege-escalation/gcp-compute-privesc/" %}
[gcp-compute-privesc](../../gcp-privilege-escalation/gcp-compute-privesc/)
{% endcontent-ref %}

### Kimlik DoÄŸrulamasÄ± Olmadan Enum

{% content-ref url="../../gcp-unauthenticated-enum-and-access/gcp-compute-unauthenticated-enum.md" %}
[gcp-compute-unauthenticated-enum.md](../../gcp-unauthenticated-enum-and-access/gcp-compute-unauthenticated-enum.md)
{% endcontent-ref %}

### SÃ¶mÃ¼rÃ¼ SonrasÄ±

{% content-ref url="../../gcp-post-exploitation/gcp-compute-post-exploitation.md" %}
[gcp-compute-post-exploitation.md](../../gcp-post-exploitation/gcp-compute-post-exploitation.md)
{% endcontent-ref %}

### SÃ¼reklilik

{% content-ref url="../../gcp-persistence/gcp-compute-persistence.md" %}
[gcp-compute-persistence.md](../../gcp-persistence/gcp-compute-persistence.md)
{% endcontent-ref %}

## Seri Konsol GÃ¼nlÃ¼kleri

Compute Engine Seri Konsol GÃ¼nlÃ¼kleri, sanal makine Ã¶rneklerinizin **Ã¶nyÃ¼kleme ve iÅŸletim sistemi gÃ¼nlÃ¼klerini gÃ¶rÃ¼ntÃ¼lemenizi ve teÅŸhis etmenizi** saÄŸlayan bir Ã¶zelliktir.

Seri Konsol GÃ¼nlÃ¼kleri, Ã¶rneÄŸin Ã¶nyÃ¼kleme sÃ¼recinin **dÃ¼ÅŸÃ¼k seviyeli bir gÃ¶rÃ¼nÃ¼mÃ¼nÃ¼** saÄŸlar; bu, Ã§ekirdek mesajlarÄ±, baÅŸlatma betikleri ve Ã¶nyÃ¼kleme sÄ±rasÄ±nda meydana gelen diÄŸer sistem olaylarÄ±nÄ± iÃ§erir. Bu, Ã¶nyÃ¼kleme sorunlarÄ±nÄ± gidermek, yanlÄ±ÅŸ yapÄ±landÄ±rmalarÄ± veya yazÄ±lÄ±m hatalarÄ±nÄ± tanÄ±mlamak veya aÄŸ baÄŸlantÄ±sÄ± sorunlarÄ±nÄ± Ã§Ã¶zmek iÃ§in yararlÄ± olabilir.

Bu gÃ¼nlÃ¼kler, dÃ¼ÅŸÃ¼k yetkili bir kullanÄ±cÄ±nÄ±n genellikle gÃ¶remeyeceÄŸi sistem gÃ¼nlÃ¼klerinden **hassas bilgileri aÃ§Ä±ÄŸa Ã§Ä±karabilir**, ancak uygun IAM izinleri ile bunlarÄ± okuyabilirsiniz.

AÅŸaÄŸÄ±daki [gcloud komutunu](https://cloud.google.com/sdk/gcloud/reference/compute/instances/get-serial-port-output) kullanarak seri port gÃ¼nlÃ¼klerini sorgulayabilirsiniz (gerekli izin `compute.instances.getSerialPortOutput`):
```bash
gcloud compute instances get-serial-port-output <instance-name>
```
## Startup Scripts output

VM'yi Ã§alÄ±ÅŸtÄ±rarak **baÅŸlangÄ±Ã§ betiklerinin Ã§Ä±ktÄ±sÄ±nÄ±** gÃ¶rmek mÃ¼mkÃ¼ndÃ¼r:
```bash
sudo journalctl -u google-startup-scripts.service
```
## OS Configuration Manager

OS yapÄ±landÄ±rma yÃ¶netim hizmetini kullanarak **VM Ã¶rneÄŸiniz iÃ§in tutarlÄ± yapÄ±landÄ±rmalar (istenen durum ve yazÄ±lÄ±m) daÄŸÄ±tabilir, sorgulayabilir ve sÃ¼rdÃ¼rebilirsiniz**. Compute Engine'de, VM'de tutarlÄ± yazÄ±lÄ±m yapÄ±landÄ±rmalarÄ±nÄ± sÃ¼rdÃ¼rmek iÃ§in [misafir politikalarÄ±nÄ±](https://cloud.google.com/compute/docs/os-config-management#guest-policy) kullanmalÄ±sÄ±nÄ±z.

OS YapÄ±landÄ±rma yÃ¶netim Ã¶zelliÄŸi, hangi yazÄ±lÄ±m paketlerinin yÃ¼klenmesi gerektiÄŸini, hangi hizmetlerin etkinleÅŸtirilmesi gerektiÄŸini ve VM'lerinizde hangi dosyalarÄ±n veya yapÄ±landÄ±rmalarÄ±n bulunmasÄ± gerektiÄŸini belirten yapÄ±landÄ±rma politikalarÄ± tanÄ±mlamanÄ±za olanak tanÄ±r. VM'lerinizin yazÄ±lÄ±m yapÄ±landÄ±rmasÄ±nÄ± yÃ¶netmek iÃ§in deklaratif bir yaklaÅŸÄ±m kullanabilirsiniz, bu da yapÄ±landÄ±rma yÃ¶netim sÃ¼recinizi daha kolay otomatikleÅŸtirmenizi ve Ã¶lÃ§eklendirmenizi saÄŸlar.

Bu ayrÄ±ca IAM izinleri aracÄ±lÄ±ÄŸÄ±yla Ã¶rneklere giriÅŸ yapmayÄ± da saÄŸlar, bu nedenle **privesc ve pivoting iÃ§in Ã§ok kullanÄ±ÅŸlÄ±dÄ±r**.

{% hint style="warning" %}
**Bir projede veya bir Ã¶rnekte os-config'i etkinleÅŸtirmek iÃ§in** sadece **metadata** anahtarÄ±nÄ± **`enable-oslogin`** deÄŸerini **`true`** olarak ayarlamanÄ±z yeterlidir.\
AyrÄ±ca, 2fa'yÄ± etkinleÅŸtirmek iÃ§in metadata **`enable-oslogin-2fa`** anahtarÄ±nÄ± **`true`** olarak ayarlayabilirsiniz.

Bir Ã¶rnek oluÅŸtururken bunu etkinleÅŸtirdiÄŸinizde, metadata anahtarlarÄ± otomatik olarak ayarlanacaktÄ±r.
{% endhint %}

**OS-config'deki 2fa hakkÄ±nda daha fazla bilgi**, **sadece kullanÄ±cÄ± bir kullanÄ±cÄ±ysa geÃ§erlidir**, eÄŸer bir SA (Ã¶rneÄŸin compute SA) ise ekstra bir ÅŸey gerektirmeyecektir.

### Enumeration
```bash
gcloud compute os-config patch-deployments list
gcloud compute os-config patch-deployments describe <patch-deployment>

gcloud compute os-config patch-jobs list
gcloud compute os-config patch-jobs describe <patch-job>
```
## GÃ¶rseller

### Ã–zel GÃ¶rseller

**Ã–zel hesaplama gÃ¶rselleri hassas detaylar** veya istismar edebileceÄŸiniz diÄŸer savunmasÄ±z yapÄ±landÄ±rmalar iÃ§erebilir.

Bir gÃ¶rsel oluÅŸturulduÄŸunda **3 tÃ¼r ÅŸifreleme** seÃ§ebilirsiniz: **Google yÃ¶netimli anahtarÄ±** (varsayÄ±lan), **KMS'den bir anahtar** veya mÃ¼ÅŸterinin verdiÄŸi **ham anahtar**.

#### SayÄ±m

AÅŸaÄŸÄ±daki komut ile bir projedeki standart dÄ±ÅŸÄ± gÃ¶rsellerin listesini sorgulayabilirsiniz:

{% code overflow="wrap" %}
```bash
gcloud compute machine-images list
gcloud compute machine-images describe <name>
gcloud compute machine-images get-iam-policy <name>
```
{% endcode %}

Herhangi bir gÃ¶rÃ¼ntÃ¼den **sanallaÅŸtÄ±rma disklerini** birden fazla formatta [**dÄ±ÅŸa aktarabilirsiniz**](https://cloud.google.com/sdk/gcloud/reference/compute/images/export). AÅŸaÄŸÄ±daki komut, `test-image` gÃ¶rÃ¼ntÃ¼sÃ¼nÃ¼ qcow2 formatÄ±nda dÄ±ÅŸa aktarÄ±r ve dosyayÄ± indirip yerel olarak daha fazla inceleme iÃ§in bir VM oluÅŸturmanÄ±za olanak tanÄ±r:
```bash
gcloud compute images export --image test-image \
--export-format qcow2 --destination-uri [BUCKET]

# Execute container inside a docker
docker run --rm -ti gcr.io/<project-name>/secret:v1 sh
```
#### Yetki YÃ¼kseltme

Compute Instances yetki yÃ¼kseltme bÃ¶lÃ¼mÃ¼nÃ¼ kontrol edin.

### Ã–zel Instance ÅablonlarÄ±

Bir [**instance ÅŸablonu**](https://cloud.google.com/compute/docs/instance-templates/) **instance Ã¶zelliklerini tanÄ±mlar** ve tutarlÄ± yapÄ±landÄ±rmalarÄ±n daÄŸÄ±tÄ±mÄ±na yardÄ±mcÄ± olur. Bunlar, Ã§alÄ±ÅŸan bir instance'Ä±n Ã¶zel meta verileriyle aynÄ± tÃ¼rde hassas verileri iÃ§erebilir. AraÅŸtÄ±rmak iÃ§in aÅŸaÄŸÄ±daki komutlarÄ± kullanabilirsiniz:
```bash
# List the available templates
gcloud compute instance-templates list

# Get the details of a specific template
gcloud compute instance-templates describe [TEMPLATE NAME]
```
Yeni gÃ¶rÃ¼ntÃ¼lerin hangi diski kullandÄ±ÄŸÄ±nÄ± bilmek ilginÃ§ olabilir, ancak bu ÅŸablonlar genellikle hassas bilgi iÃ§ermez.

## AnlÄ±k GÃ¶rÃ¼ntÃ¼ler

**AnlÄ±k gÃ¶rÃ¼ntÃ¼ler disklerin yedekleridir**. Bunun, bir diski kopyalamakla (baÅŸka bir mevcut Ã¶zellik) aynÄ± ÅŸey olmadÄ±ÄŸÄ±nÄ± unutmayÄ±n.\
**AnlÄ±k gÃ¶rÃ¼ntÃ¼**, alÄ±ndÄ±ÄŸÄ± **disk ile aynÄ± ÅŸifrelemeyi** kullanacaktÄ±r.

### SayÄ±m
```bash
gcloud compute snapshots list
gcloud compute snapshots describe <snapshot>
gcloud compute snapshots get-iam-policy <snapshot>
```
### Yetki YÃ¼kseltme

Compute Instances yetki yÃ¼kseltme bÃ¶lÃ¼mÃ¼nÃ¼ kontrol edin.

## Referanslar

* [https://blog.raphael.karger.is/articles/2022-08/GCP-OS-Patching](https://blog.raphael.karger.is/articles/2022-08/GCP-OS-Patching)

{% hint style="success" %}
AWS Hacking Ã¶ÄŸrenin ve pratik yapÄ±n:<img src="../../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
GCP Hacking Ã¶ÄŸrenin ve pratik yapÄ±n: <img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**abonelik planlarÄ±nÄ±**](https://github.com/sponsors/carlospolop) kontrol edin!
* **ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n ya da **Twitter'da** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**'i takip edin.**
* **Hacking ipuÃ§larÄ±nÄ± paylaÅŸmak iÃ§in** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna PR gÃ¶nderin.

</details>
{% endhint %}
