# GCP - Compute Instances

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* [**Abonelik planlarÄ±nÄ±**](https://github.com/sponsors/carlospolop) kontrol edin!
* **ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n ya da bizi **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**'da takip edin.**
* **HackTricks'e PR gÃ¶ndererek hacking ipuÃ§larÄ±nÄ± paylaÅŸÄ±n** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na.

</details>
{% endhint %}

## Temel Bilgiler

Google Cloud Compute Instances, **Google'Ä±n bulut altyapÄ±sÄ±nda Ã¶zelleÅŸtirilebilir sanal makineler** olup, geniÅŸ bir uygulama yelpazesi iÃ§in Ã¶lÃ§eklenebilir ve isteÄŸe baÄŸlÄ± hesaplama gÃ¼cÃ¼ sunar. KÃ¼resel daÄŸÄ±tÄ±m, kalÄ±cÄ± depolama, esnek iÅŸletim sistemi seÃ§enekleri ve gÃ¼Ã§lÃ¼ aÄŸ ve gÃ¼venlik entegrasyonlarÄ± gibi Ã¶zellikler sunarak, web sitelerini barÄ±ndÄ±rma, veri iÅŸleme ve uygulamalarÄ± bulutta verimli bir ÅŸekilde Ã§alÄ±ÅŸtÄ±rma iÃ§in Ã§ok yÃ¶nlÃ¼ bir seÃ§enek haline getirir.

### Confidential VM

Confidential VM'ler, AMD EPYC iÅŸlemcilerin en son neslinin sunduÄŸu **donanÄ±m tabanlÄ± gÃ¼venlik Ã¶zelliklerini** kullanÄ±r; bu Ã¶zellikler arasÄ±nda bellek ÅŸifreleme ve gÃ¼venli ÅŸifrelenmiÅŸ sanallaÅŸtÄ±rma bulunur. Bu Ã¶zellikler, VM'nin iÅŸlediÄŸi ve depoladÄ±ÄŸÄ± verileri, ana iÅŸletim sistemi ve hipervizÃ¶rden bile korumasÄ±nÄ± saÄŸlar.

Confidential VM Ã§alÄ±ÅŸtÄ±rmak iÃ§in **makine tÃ¼rÃ¼**, aÄŸ **arayÃ¼zÃ¼**, **Ã¶nyÃ¼kleme disk gÃ¶rÃ¼ntÃ¼sÃ¼** gibi ÅŸeyleri **deÄŸiÅŸtirmek** gerekebilir.

### Disk & Disk Åifreleme

KullanÄ±lacak **diski seÃ§mek** veya **yeni bir disk oluÅŸturmak** mÃ¼mkÃ¼ndÃ¼r. Yeni bir disk seÃ§erseniz:

* Diskin **boyutunu** seÃ§in
* **Ä°ÅŸletim sistemini** seÃ§in
* **Diskin, Ã¶rnek silindiÄŸinde silinmesini isteyip istemediÄŸinizi** belirtin
* **Åifreleme**: **VarsayÄ±lan olarak** bir **Google yÃ¶netimli anahtar** kullanÄ±lacaktÄ±r, ancak **KMS'den bir anahtar seÃ§ebilir** veya **kullanÄ±lacak ham anahtarÄ± belirtebilirsiniz**.

### Container DaÄŸÄ±tÄ±mÄ±

Sanal makine iÃ§inde bir **container** daÄŸÄ±tmak mÃ¼mkÃ¼ndÃ¼r.\
KullanÄ±lacak **gÃ¶rÃ¼ntÃ¼yÃ¼** yapÄ±landÄ±rmak, iÃ§inde Ã§alÄ±ÅŸtÄ±rÄ±lacak **komutu**, **argÃ¼manlarÄ±**, bir **hacim** baÄŸlamak ve **Ã§evre deÄŸiÅŸkenlerini** (hassas bilgiler?) ayarlamak ve bu container iÃ§in **privileged** olarak Ã§alÄ±ÅŸtÄ±rmak, stdin ve pseudo TTY gibi Ã§eÅŸitli seÃ§enekleri yapÄ±landÄ±rmak mÃ¼mkÃ¼ndÃ¼r.

### Service Account

VarsayÄ±lan olarak, **Compute Engine varsayÄ±lan service account** kullanÄ±lacaktÄ±r. Bu SA'nÄ±n e-postasÄ± ÅŸu ÅŸekildedir: `<proj-num>-compute@developer.gserviceaccount.com`\
Bu service account, **tÃ¼m proje Ã¼zerinde Editor rolÃ¼ne sahiptir (yÃ¼ksek ayrÄ±calÄ±klar).**

Ve **varsayÄ±lan eriÅŸim kapsamlarÄ±** ÅŸunlardÄ±r:

* **https://www.googleapis.com/auth/devstorage.read\_only** -- Buckets iÃ§in okuma eriÅŸimi :)
* https://www.googleapis.com/auth/logging.write
* https://www.googleapis.com/auth/monitoring.write
* https://www.googleapis.com/auth/servicecontrol
* https://www.googleapis.com/auth/service.management.readonly
* https://www.googleapis.com/auth/trace.append

Ancak, **bir tÄ±klama ile `cloud-platform` yetkisi vermek** veya **Ã¶zel olanlarÄ± belirtmek** mÃ¼mkÃ¼ndÃ¼r.

<figure><img src="../../../../.gitbook/assets/image (327).png" alt=""><figcaption></figcaption></figure>

### GÃ¼venlik DuvarÄ±

HTTP ve HTTPS trafiÄŸine izin vermek mÃ¼mkÃ¼ndÃ¼r.

<figure><img src="../../../../.gitbook/assets/image (326).png" alt=""><figcaption></figcaption></figure>

### AÄŸ

* **IP YÃ¶nlendirme**: Ã–rneÄŸin oluÅŸturulmasÄ±ndan itibaren **IP yÃ¶nlendirmeyi etkinleÅŸtirmek** mÃ¼mkÃ¼ndÃ¼r.
* **Hostname**: Ã–rneÄŸe kalÄ±cÄ± bir hostname vermek mÃ¼mkÃ¼ndÃ¼r.
* **ArayÃ¼z**: Bir aÄŸ arayÃ¼zÃ¼ eklemek mÃ¼mkÃ¼ndÃ¼r.

### Ekstra GÃ¼venlik

Bu seÃ§enekler, VM'nin **gÃ¼venliÄŸini artÄ±racak** ve Ã¶nerilmektedir:

* **GÃ¼venli Ã¶nyÃ¼kleme:** GÃ¼venli Ã¶nyÃ¼kleme, VM Ã¶rneklerinizi Ã¶nyÃ¼kleme dÃ¼zeyinde ve Ã§ekirdek dÃ¼zeyinde kÃ¶tÃ¼ amaÃ§lÄ± yazÄ±lÄ±mlara ve rootkit'lere karÅŸÄ± korumaya yardÄ±mcÄ± olur.
* **vTPM'yi etkinleÅŸtir:** Sanal GÃ¼venilir Platform ModÃ¼lÃ¼ (vTPM), misafir VM'nizin Ã¶nyÃ¼kleme Ã¶ncesi ve Ã¶nyÃ¼kleme bÃ¼tÃ¼nlÃ¼ÄŸÃ¼nÃ¼ doÄŸrular ve anahtar oluÅŸturma ve koruma saÄŸlar.
* **BÃ¼tÃ¼nlÃ¼k denetimi:** BÃ¼tÃ¼nlÃ¼k izleme, Stackdriver raporlarÄ±nÄ± kullanarak korumalÄ± VM Ã¶rneklerinizin Ã§alÄ±ÅŸma zamanÄ± Ã¶nyÃ¼kleme bÃ¼tÃ¼nlÃ¼ÄŸÃ¼nÃ¼ izleyip doÄŸrulamanÄ±za olanak tanÄ±r. vTPM'nin etkinleÅŸtirilmesi gereklidir.

### VM EriÅŸimi

VM'ye eriÅŸimi etkinleÅŸtirmenin yaygÄ±n yolu, **belirli SSH genel anahtarlarÄ±nÄ±n** VM'ye eriÅŸmesine izin vermektir.\
Ancak, **IAM kullanarak `os-config` hizmeti aracÄ±lÄ±ÄŸÄ±yla VM'ye eriÅŸimi etkinleÅŸtirmek** de mÃ¼mkÃ¼ndÃ¼r. AyrÄ±ca, bu hizmeti kullanarak VM'ye eriÅŸim iÃ§in 2FA'yÄ± etkinleÅŸtirmek de mÃ¼mkÃ¼ndÃ¼r.\
Bu **hizmet** **etkinleÅŸtirildiÄŸinde**, **SSH anahtarlarÄ± aracÄ±lÄ±ÄŸÄ±yla eriÅŸim devre dÄ±ÅŸÄ± bÄ±rakÄ±lÄ±r.**

<figure><img src="../../../../.gitbook/assets/image (328).png" alt=""><figcaption></figcaption></figure>

### Metadata

**Makine her aÃ§Ä±ldÄ±ÄŸÄ±nda veya yeniden baÅŸlatÄ±ldÄ±ÄŸÄ±nda Ã§alÄ±ÅŸtÄ±rÄ±lacak** **otomasyon** (AWS'de userdata) tanÄ±mlamak mÃ¼mkÃ¼ndÃ¼r.

AyrÄ±ca, metadata endpoint'inden eriÅŸilebilecek **ekstra metadata anahtar-deÄŸer deÄŸerleri** eklemek de mÃ¼mkÃ¼ndÃ¼r. Bu bilgiler genellikle Ã§evre deÄŸiÅŸkenleri ve baÅŸlangÄ±Ã§/kapanÄ±ÅŸ komut dosyalarÄ± iÃ§in kullanÄ±lÄ±r. Bu, komutun betimleme yÃ¶ntemini kullanarak elde edilebilir, ancak aynÄ± zamanda Ã¶rneÄŸin iÃ§inden metadata endpoint'ine eriÅŸerek de elde edilebilir.
```bash
# view project metadata
curl "http://metadata.google.internal/computeMetadata/v1/project/attributes/?recursive=true&alt=text" \
-H "Metadata-Flavor: Google"

# view instance metadata
curl "http://metadata.google.internal/computeMetadata/v1/instance/attributes/?recursive=true&alt=text" \
-H "Metadata-Flavor: Google"
```
AyrÄ±ca, **baÄŸlÄ± hizmet hesabÄ± iÃ§in kimlik doÄŸrulama belirteci** ve **genel bilgi** Ã¶rnek, aÄŸ ve proje hakkÄ±nda **metadata endpoint**'inden de elde edilebilir. Daha fazla bilgi iÃ§in:

{% embed url="https://book.hacktricks.xyz/pentesting-web/ssrf-server-side-request-forgery/cloud-ssrf#6440" %}

### Åifreleme

VarsayÄ±lan olarak Google tarafÄ±ndan yÃ¶netilen bir ÅŸifreleme anahtarÄ± kullanÄ±lÄ±r, ancak MÃ¼ÅŸteri tarafÄ±ndan yÃ¶netilen bir ÅŸifreleme anahtarÄ± (CMEK) yapÄ±landÄ±rÄ±labilir. KullanÄ±lan CMEK iptal edildiÄŸinde ne yapÄ±lacaÄŸÄ±nÄ± da yapÄ±landÄ±rabilirsiniz: HiÃ§bir ÅŸey yapmamak veya VM'yi kapatmak.

<figure><img src="../../../../.gitbook/assets/image (329).png" alt=""><figcaption></figcaption></figure>

{% hint style="success" %}
AWS Hacking Ã¶ÄŸrenin ve pratik yapÄ±n:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCP Hacking Ã¶ÄŸrenin ve pratik yapÄ±n: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**abonelik planlarÄ±nÄ±**](https://github.com/sponsors/carlospolop) kontrol edin!
* **ğŸ’¬ Discord grubuna** [**katÄ±lÄ±n**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n ya da **Twitter'da** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**'Ä± takip edin.**
* **HackTricks'e PR gÃ¶ndererek hacking ipuÃ§larÄ±nÄ± paylaÅŸÄ±n** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na.

</details>
{% endhint %}
