# GCP - Compute Instances

{% hint style="success" %}
NauÄite i veÅ¾bajte AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
NauÄite i veÅ¾bajte GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>PodrÅ¾ite HackTricks</summary>

* Proverite [**planove pretplate**](https://github.com/sponsors/carlospolop)!
* **PridruÅ¾ite se** ğŸ’¬ [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili **pratite** nas na **Twitteru** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Delite hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
{% endhint %}

## Osnovne Informacije

Google Cloud Compute Instances su **prilagodljive virtuelne maÅ¡ine na Google-ovoj cloud infrastrukturi**, koje nude skalabilnu i na zahtev dostupnu raÄunarsku snagu za Å¡irok spektar aplikacija. One pruÅ¾aju funkcije kao Å¡to su globalno rasporeÄ‘ivanje, trajno skladiÅ¡tenje, fleksibilan izbor operativnih sistema i snaÅ¾ne mreÅ¾ne i sigurnosne integracije, ÄineÄ‡i ih svestranim izborom za hosting web sajtova, obradu podataka i efikasno pokretanje aplikacija u oblaku.

### Confidential VM

Confidential VMs koriste **hardverske sigurnosne funkcije** koje nude najnovije generacije AMD EPYC procesora, koje ukljuÄuju enkripciju memorije i sigurnu enkriptovanu virtualizaciju. Ove funkcije omoguÄ‡avaju VM-u da zaÅ¡titi podatke koji se obraÄ‘uju i skladiÅ¡te unutar njega Äak i od operativnog sistema domaÄ‡ina i hipervizora.

Da bi se pokrenuo Confidential VM, moÅ¾da Ä‡e biti potrebno **promeniti** stvari kao Å¡to su **tip** **maÅ¡ine**, mreÅ¾ni **interfejs**, **sliku boot diska**.

### Disk & Disk Enkripcija

MoguÄ‡e je **izabrati disk** za koriÅ¡Ä‡enje ili **kreirati novi**. Ako izaberete novi, moÅ¾ete:

* Izabrati **veliÄinu** diska
* Izabrati **OS**
* NaznaÄiti da li Å¾elite **obrisati disk kada se instanca obriÅ¡e**
* **Enkripcija**: Po **defaultu** Ä‡e se koristiti **Google upravljani kljuÄ**, ali moÅ¾ete takoÄ‘e **izabrati kljuÄ iz KMS-a** ili naznaÄiti **sirovi kljuÄ za koriÅ¡Ä‡enje**.

### Deploy Container

MoguÄ‡e je deploy-ovati **container** unutar virtuelne maÅ¡ine.\
MoguÄ‡e je konfigurisati **sliku** za koriÅ¡Ä‡enje, postaviti **komandu** za pokretanje unutar, **argumente**, montirati **volumen**, i **env varijable** (osetljive informacije?) i konfigurisati nekoliko opcija za ovaj container kao Å¡to su izvrÅ¡avanje kao **privilegovan**, stdin i pseudo TTY.

### Service Account

Po defaultu Ä‡e se koristiti **Compute Engine default service account**. Email ovog SA je kao: `<proj-num>-compute@developer.gserviceaccount.com`\
Ovaj service account ima **Editor rolu nad celim projektom (visoke privilegije).**

I **default pristupni opsezi** su sledeÄ‡i:

* **https://www.googleapis.com/auth/devstorage.read\_only** -- Pristup za Äitanje bucket-a :)
* https://www.googleapis.com/auth/logging.write
* https://www.googleapis.com/auth/monitoring.write
* https://www.googleapis.com/auth/servicecontrol
* https://www.googleapis.com/auth/service.management.readonly
* https://www.googleapis.com/auth/trace.append

MeÄ‘utim, moguÄ‡e je **dodeliti mu `cloud-platform` jednim klikom** ili specificirati **prilagoÄ‘ene**.

<figure><img src="../../../../.gitbook/assets/image (327).png" alt=""><figcaption></figcaption></figure>

### Firewall

MoguÄ‡e je dozvoliti HTTP i HTTPS saobraÄ‡aj.

<figure><img src="../../../../.gitbook/assets/image (326).png" alt=""><figcaption></figcaption></figure>

### Networking

* **IP Forwarding**: MoguÄ‡e je **omoguÄ‡iti IP forwarding** od kreiranja instance.
* **Hostname**: MoguÄ‡e je dati instanci trajno ime hosta.
* **Interface**: MoguÄ‡e je dodati mreÅ¾ni interfejs.

### Dodatna Sigurnost

Ove opcije Ä‡e **poveÄ‡ati sigurnost** VM-a i preporuÄuju se:

* **Secure boot:** Secure boot pomaÅ¾e u zaÅ¡titi vaÅ¡ih VM instanci od malware-a na nivou boot-a i kernela i rootkit-ova.
* **Enable vTPM:** Virtual Trusted Platform Module (vTPM) validira pre-boot i boot integritet vaÅ¡eg gostujuÄ‡eg VM-a, i nudi generisanje i zaÅ¡titu kljuÄeva.
* **Integrity supervision:** Integrity monitoring vam omoguÄ‡ava da pratite i verifikujete runtime boot integritet vaÅ¡ih shielded VM instanci koristeÄ‡i Stackdriver izveÅ¡taje. Zahteva da vTPM bude omoguÄ‡en.

### VM Pristup

UobiÄajen naÄin za omoguÄ‡avanje pristupa VM-u je **dozvoljavanje odreÄ‘enih SSH javnih kljuÄeva** za pristup VM-u.\
MeÄ‘utim, moguÄ‡e je takoÄ‘e **omoguÄ‡iti pristup VM-u putem `os-config` servisa koristeÄ‡i IAM**. Å taviÅ¡e, moguÄ‡e je omoguÄ‡iti 2FA za pristup VM-u koristeÄ‡i ovaj servis.\
Kada je ovaj **servis** **omoguÄ‡en**, pristup putem **SSH kljuÄeva je onemoguÄ‡en.**

<figure><img src="../../../../.gitbook/assets/image (328).png" alt=""><figcaption></figcaption></figure>

### Metadata

MoguÄ‡e je definisati **automatizaciju** (userdata u AWS-u) koja su **shell komande** koje Ä‡e se izvrÅ¡avati svaki put kada se maÅ¡ina ukljuÄi ili restartuje.

TakoÄ‘e je moguÄ‡e **dodati dodatne metapodatke u obliku kljuÄ-vrednost** koji Ä‡e biti dostupni sa endpoint-a metapodataka. Ove informacije se obiÄno koriste za environment varijable i startup/shutdown skripte. Ovo se moÅ¾e dobiti koristeÄ‡i **`describe` metodu** iz komande u sekciji za enumeraciju, ali se takoÄ‘e moÅ¾e dobiti iz unutraÅ¡njosti instance pristupom endpoint-u metapodataka.
```bash
# view project metadata
curl "http://metadata.google.internal/computeMetadata/v1/project/attributes/?recursive=true&alt=text" \
-H "Metadata-Flavor: Google"

# view instance metadata
curl "http://metadata.google.internal/computeMetadata/v1/instance/attributes/?recursive=true&alt=text" \
-H "Metadata-Flavor: Google"
```
Moreover, **auth token za pridruÅ¾eni service account** i **opÅ¡te informacije** o instanci, mreÅ¾i i projektu Ä‡e takoÄ‘e biti dostupni sa **metadata endpoint**. Za viÅ¡e informacija pogledajte:

{% embed url="https://book.hacktricks.xyz/pentesting-web/ssrf-server-side-request-forgery/cloud-ssrf#6440" %}

### Encryption

Google-managed encryption key se koristi po default-u, ali se moÅ¾e konfigurisati Customer-managed encryption key (CMEK). TakoÄ‘e moÅ¾ete konfigurisati Å¡ta da se radi kada se koriÅ¡Ä‡eni CMEK opozove: NiÅ¡ta ili iskljuÄiti VM.

<figure><img src="../../../../.gitbook/assets/image (329).png" alt=""><figcaption></figcaption></figure>

{% hint style="success" %}
NauÄite i veÅ¾bajte AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
NauÄite i veÅ¾bajte GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>PodrÅ¾ite HackTricks</summary>

* Pogledajte [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **PridruÅ¾ite se** ğŸ’¬ [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili **pratite** nas na **Twitter-u** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Delite hacking trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
{% endhint %}
