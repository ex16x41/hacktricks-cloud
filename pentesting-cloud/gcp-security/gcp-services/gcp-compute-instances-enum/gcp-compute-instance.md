# GCP - Compute Instances

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Basic Information

Google Cloud Compute Instances æ˜¯ **å¯å®šåˆ¶çš„è™šæ‹Ÿæœºï¼Œè¿è¡Œåœ¨ Google çš„äº‘åŸºç¡€è®¾æ–½ä¸Š**ï¼Œä¸ºå„ç§åº”ç”¨æä¾›å¯æ‰©å±•å’ŒæŒ‰éœ€çš„è®¡ç®—èƒ½åŠ›ã€‚å®ƒä»¬æä¾›å…¨çƒéƒ¨ç½²ã€æŒä¹…å­˜å‚¨ã€çµæ´»çš„æ“ä½œç³»ç»Ÿé€‰æ‹©ä»¥åŠå¼ºå¤§çš„ç½‘ç»œå’Œå®‰å…¨é›†æˆç­‰åŠŸèƒ½ï¼Œä½¿å…¶æˆä¸ºé«˜æ•ˆæ‰˜ç®¡ç½‘ç«™ã€å¤„ç†æ•°æ®å’Œè¿è¡Œåº”ç”¨ç¨‹åºçš„å¤šåŠŸèƒ½é€‰æ‹©ã€‚

### Confidential VM

ä¿å¯†è™šæ‹Ÿæœºä½¿ç”¨ **æœ€æ–°ä¸€ä»£ AMD EPYC å¤„ç†å™¨æä¾›çš„åŸºäºç¡¬ä»¶çš„å®‰å…¨åŠŸèƒ½**ï¼ŒåŒ…æ‹¬å†…å­˜åŠ å¯†å’Œå®‰å…¨åŠ å¯†è™šæ‹ŸåŒ–ã€‚è¿™äº›åŠŸèƒ½ä½¿è™šæ‹Ÿæœºèƒ½å¤Ÿä¿æŠ¤å¤„ç†å’Œå­˜å‚¨çš„æ•°æ®ï¼Œç”šè‡³å…å—ä¸»æœºæ“ä½œç³»ç»Ÿå’Œè™šæ‹Ÿæœºç›‘æ§ç¨‹åºçš„å½±å“ã€‚

è¦è¿è¡Œä¿å¯†è™šæ‹Ÿæœºï¼Œå¯èƒ½éœ€è¦ **æ›´æ”¹** ä¸€äº›è®¾ç½®ï¼Œä¾‹å¦‚ **æœºå™¨ç±»å‹**ã€ç½‘ç»œ **æ¥å£**ã€**å¯åŠ¨ç£ç›˜æ˜ åƒ**ã€‚

### Disk & Disk Encryption

å¯ä»¥ **é€‰æ‹©è¦ä½¿ç”¨çš„ç£ç›˜**æˆ– **åˆ›å»ºä¸€ä¸ªæ–°ç£ç›˜**ã€‚å¦‚æœé€‰æ‹©æ–°ç£ç›˜ï¼Œå¯ä»¥ï¼š

* é€‰æ‹©ç£ç›˜çš„ **å¤§å°**
* é€‰æ‹© **æ“ä½œç³»ç»Ÿ**
* æŒ‡å®šæ˜¯å¦å¸Œæœ›åœ¨å®ä¾‹è¢«åˆ é™¤æ—¶ **åˆ é™¤ç£ç›˜**
* **åŠ å¯†**ï¼šé»˜è®¤æƒ…å†µä¸‹å°†ä½¿ç”¨ **Google ç®¡ç†çš„å¯†é’¥**ï¼Œä½†æ‚¨ä¹Ÿå¯ä»¥ **ä» KMS é€‰æ‹©ä¸€ä¸ªå¯†é’¥**æˆ–æŒ‡å®š **è¦ä½¿ç”¨çš„åŸå§‹å¯†é’¥**ã€‚

### Deploy Container

å¯ä»¥åœ¨è™šæ‹Ÿæœºå†…éƒ¨ç½² **å®¹å™¨**ã€‚\
å¯ä»¥é…ç½®è¦ä½¿ç”¨çš„ **æ˜ åƒ**ï¼Œè®¾ç½®è¦åœ¨å†…éƒ¨è¿è¡Œçš„ **å‘½ä»¤**ã€**å‚æ•°**ã€æŒ‚è½½ **å·** å’Œ **ç¯å¢ƒå˜é‡**ï¼ˆæ•æ„Ÿä¿¡æ¯ï¼Ÿï¼‰ï¼Œå¹¶ä¸ºè¯¥å®¹å™¨é…ç½®å¤šä¸ªé€‰é¡¹ï¼Œä¾‹å¦‚ä»¥ **ç‰¹æƒ** èº«ä»½æ‰§è¡Œã€æ ‡å‡†è¾“å…¥å’Œä¼ª TTYã€‚

### Service Account

é»˜è®¤æƒ…å†µä¸‹ï¼Œå°†ä½¿ç”¨ **è®¡ç®—å¼•æ“é»˜è®¤æœåŠ¡å¸æˆ·**ã€‚è¯¥æœåŠ¡å¸æˆ·çš„ç”µå­é‚®ä»¶æ ¼å¼ä¸ºï¼š`<proj-num>-compute@developer.gserviceaccount.com`\
è¯¥æœåŠ¡å¸æˆ·åœ¨æ•´ä¸ªé¡¹ç›®ä¸­å…·æœ‰ **ç¼–è¾‘è€…è§’è‰²ï¼ˆé«˜æƒé™ï¼‰**ã€‚

é»˜è®¤è®¿é—®èŒƒå›´å¦‚ä¸‹ï¼š

* **https://www.googleapis.com/auth/devstorage.read\_only** -- å¯¹å­˜å‚¨æ¡¶çš„è¯»å–è®¿é—® :)
* https://www.googleapis.com/auth/logging.write
* https://www.googleapis.com/auth/monitoring.write
* https://www.googleapis.com/auth/servicecontrol
* https://www.googleapis.com/auth/service.management.readonly
* https://www.googleapis.com/auth/trace.append

ä½†æ˜¯ï¼Œå¯ä»¥ **é€šè¿‡ç‚¹å‡»æˆäºˆ `cloud-platform` æƒé™**æˆ–æŒ‡å®š **è‡ªå®šä¹‰æƒé™**ã€‚

<figure><img src="../../../../.gitbook/assets/image (327).png" alt=""><figcaption></figcaption></figure>

### Firewall

å¯ä»¥å…è®¸ HTTP å’Œ HTTPS æµé‡ã€‚

<figure><img src="../../../../.gitbook/assets/image (326).png" alt=""><figcaption></figcaption></figure>

### Networking

* **IP Forwarding**ï¼šå¯ä»¥åœ¨å®ä¾‹åˆ›å»ºæ—¶ **å¯ç”¨ IP è½¬å‘**ã€‚
* **Hostname**ï¼šå¯ä»¥ä¸ºå®ä¾‹æä¾›ä¸€ä¸ªæ°¸ä¹…ä¸»æœºåã€‚
* **Interface**ï¼šå¯ä»¥æ·»åŠ ç½‘ç»œæ¥å£ã€‚

### Extra Security

è¿™äº›é€‰é¡¹å°† **æé«˜è™šæ‹Ÿæœºçš„å®‰å…¨æ€§**ï¼Œå¹¶ä¸”æ¨èä½¿ç”¨ï¼š

* **å®‰å…¨å¯åŠ¨**ï¼šå®‰å…¨å¯åŠ¨æœ‰åŠ©äºä¿æŠ¤æ‚¨çš„è™šæ‹Ÿæœºå®ä¾‹å…å—å¯åŠ¨çº§å’Œå†…æ ¸çº§æ¶æ„è½¯ä»¶å’Œæ ¹å¥—ä»¶çš„æ”»å‡»ã€‚
* **å¯ç”¨ vTPM**ï¼šè™šæ‹Ÿå—ä¿¡ä»»å¹³å°æ¨¡å—ï¼ˆvTPMï¼‰éªŒè¯æ‚¨çš„å®¢æˆ·è™šæ‹Ÿæœºçš„é¢„å¯åŠ¨å’Œå¯åŠ¨å®Œæ•´æ€§ï¼Œå¹¶æä¾›å¯†é’¥ç”Ÿæˆå’Œä¿æŠ¤ã€‚
* **å®Œæ•´æ€§ç›‘æ§**ï¼šå®Œæ•´æ€§ç›‘æ§å…è®¸æ‚¨ä½¿ç”¨ Stackdriver æŠ¥å‘Šç›‘æ§å’ŒéªŒè¯å—ä¿æŠ¤è™šæ‹Ÿæœºå®ä¾‹çš„è¿è¡Œæ—¶å¯åŠ¨å®Œæ•´æ€§ã€‚éœ€è¦å¯ç”¨ vTPMã€‚

### VM Access

å¯ç”¨å¯¹è™šæ‹Ÿæœºçš„è®¿é—®çš„å¸¸è§æ–¹æ³•æ˜¯ **å…è®¸æŸäº› SSH å…¬é’¥** è®¿é—®è™šæ‹Ÿæœºã€‚\
ä½†æ˜¯ï¼Œä¹Ÿå¯ä»¥ **é€šè¿‡ `os-config` æœåŠ¡ä½¿ç”¨ IAM å¯ç”¨å¯¹è™šæ‹Ÿæœºçš„è®¿é—®**ã€‚æ­¤å¤–ï¼Œè¿˜å¯ä»¥ä½¿ç”¨æ­¤æœåŠ¡å¯ç”¨ 2FA ä»¥è®¿é—®è™šæ‹Ÿæœºã€‚\
å½“æ­¤ **æœåŠ¡** è¢« **å¯ç”¨** æ—¶ï¼Œé€šè¿‡ **SSH å¯†é’¥çš„è®¿é—®å°†è¢«ç¦ç”¨**ã€‚

<figure><img src="../../../../.gitbook/assets/image (328).png" alt=""><figcaption></figcaption></figure>

### Metadata

å¯ä»¥å®šä¹‰ **è‡ªåŠ¨åŒ–**ï¼ˆAWS ä¸­çš„ç”¨æˆ·æ•°æ®ï¼‰ï¼Œè¿™äº›æ˜¯æ¯æ¬¡æœºå™¨å¯åŠ¨æˆ–é‡å¯æ—¶å°†æ‰§è¡Œçš„ **Shell å‘½ä»¤**ã€‚

è¿˜å¯ä»¥ **æ·»åŠ é¢å¤–çš„å…ƒæ•°æ®é”®å€¼å¯¹**ï¼Œè¿™äº›å°†å¯ä»¥ä»å…ƒæ•°æ®ç«¯ç‚¹è®¿é—®ã€‚æ­¤ä¿¡æ¯é€šå¸¸ç”¨äºç¯å¢ƒå˜é‡å’Œå¯åŠ¨/å…³é—­è„šæœ¬ã€‚å¯ä»¥ä½¿ç”¨æšä¸¾éƒ¨åˆ†ä¸­çš„å‘½ä»¤çš„ **`describe` æ–¹æ³•** è·å–æ­¤ä¿¡æ¯ï¼Œä½†ä¹Ÿå¯ä»¥é€šè¿‡è®¿é—®å…ƒæ•°æ®ç«¯ç‚¹ä»å®ä¾‹å†…éƒ¨æ£€ç´¢ã€‚
```bash
# view project metadata
curl "http://metadata.google.internal/computeMetadata/v1/project/attributes/?recursive=true&alt=text" \
-H "Metadata-Flavor: Google"

# view instance metadata
curl "http://metadata.google.internal/computeMetadata/v1/instance/attributes/?recursive=true&alt=text" \
-H "Metadata-Flavor: Google"
```
æ­¤å¤–ï¼Œ**é™„åŠ æœåŠ¡å¸æˆ·çš„èº«ä»½éªŒè¯ä»¤ç‰Œ**å’Œ**æœ‰å…³å®ä¾‹ã€ç½‘ç»œå’Œé¡¹ç›®çš„ä¸€èˆ¬ä¿¡æ¯**ä¹Ÿå°†å¯ä»¥ä»**å…ƒæ•°æ®ç«¯ç‚¹**è·å–ã€‚æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·æŸ¥çœ‹ï¼š

{% embed url="https://book.hacktricks.xyz/pentesting-web/ssrf-server-side-request-forgery/cloud-ssrf#6440" %}

### åŠ å¯†

é»˜è®¤æƒ…å†µä¸‹ä½¿ç”¨Googleç®¡ç†çš„åŠ å¯†å¯†é’¥ï¼Œä½†å¯ä»¥é…ç½®å®¢æˆ·ç®¡ç†çš„åŠ å¯†å¯†é’¥ï¼ˆCMEKï¼‰ã€‚æ‚¨è¿˜å¯ä»¥é…ç½®åœ¨ä½¿ç”¨çš„CMEKè¢«æ’¤é”€æ—¶è¯¥æ€ä¹ˆåŠï¼šä¸åšä»»ä½•äº‹æƒ…æˆ–å…³é—­è™šæ‹Ÿæœºã€‚

<figure><img src="../../../../.gitbook/assets/image (329).png" alt=""><figcaption></figcaption></figure>

{% hint style="success" %}
å­¦ä¹ å’Œå®è·µAWSé»‘å®¢æ”»å‡»ï¼š<img src="../../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricksåŸ¹è®­AWSçº¢é˜Ÿä¸“å®¶ï¼ˆARTEï¼‰**](https://training.hacktricks.xyz/courses/arte)<img src="../../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
å­¦ä¹ å’Œå®è·µGCPé»‘å®¢æ”»å‡»ï¼š<img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricksåŸ¹è®­GCPçº¢é˜Ÿä¸“å®¶ï¼ˆGRTEï¼‰**<img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>æ”¯æŒHackTricks</summary>

* æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f)æˆ–[**ç”µæŠ¥ç¾¤ç»„**](https://t.me/peass)æˆ–**åœ¨** **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**ä¸Šå…³æ³¨æˆ‘ä»¬ã€‚**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks)å’Œ[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHubåº“æäº¤PRæ¥åˆ†äº«é»‘å®¢æŠ€å·§ã€‚

</details>
{% endhint %}
