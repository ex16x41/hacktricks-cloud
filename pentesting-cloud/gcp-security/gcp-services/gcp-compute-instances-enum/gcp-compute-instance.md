# GCP - Compute Instances

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Basic Information

Google Cloud Compute Instances, **Google'Ä±n bulut altyapÄ±sÄ±nda Ã¶zelleÅŸtirilebilir sanal makinelerdir**, geniÅŸ bir uygulama yelpazesi iÃ§in Ã¶lÃ§eklenebilir ve talep Ã¼zerine hesaplama gÃ¼cÃ¼ sunar. KÃ¼resel daÄŸÄ±tÄ±m, kalÄ±cÄ± depolama, esnek iÅŸletim sistemi seÃ§imleri ve gÃ¼Ã§lÃ¼ aÄŸ ve gÃ¼venlik entegrasyonlarÄ± gibi Ã¶zellikler sunarak, web sitelerini barÄ±ndÄ±rmak, verileri iÅŸlemek ve uygulamalarÄ± bulutta verimli bir ÅŸekilde Ã§alÄ±ÅŸtÄ±rmak iÃ§in Ã§ok yÃ¶nlÃ¼ bir seÃ§enek haline gelir.

### Confidential VM

Confidential VM'ler, **AMD EPYC iÅŸlemcilerinin en son nesli tarafÄ±ndan sunulan donanÄ±m tabanlÄ± gÃ¼venlik Ã¶zelliklerini** kullanÄ±r; bu Ã¶zellikler arasÄ±nda bellek ÅŸifreleme ve gÃ¼venli ÅŸifreli sanallaÅŸtÄ±rma bulunur. Bu Ã¶zellikler, VM'nin iÃ§indeki iÅŸlenen ve depolanan verileri, hatta ana iÅŸletim sistemi ve hipervizÃ¶rden korumasÄ±nÄ± saÄŸlar.

Confidential VM Ã§alÄ±ÅŸtÄ±rmak iÃ§in, **makine tÃ¼rÃ¼**, aÄŸ **arayÃ¼zÃ¼**, **Ã¶nyÃ¼kleme diski gÃ¶rÃ¼ntÃ¼sÃ¼** gibi ÅŸeyleri **deÄŸiÅŸtirmek** gerekebilir.

### Disk & Disk Encryption

KullanÄ±lacak **diski seÃ§mek** veya **yeni bir tane oluÅŸturmak** mÃ¼mkÃ¼ndÃ¼r. Yeni bir tane seÃ§erseniz:

* **Diskin boyutunu** seÃ§in
* **Ä°ÅŸletim sistemini** seÃ§in
* Ã–rneÄŸin, **Ã¶rneÄŸin silindiÄŸinde diski silmek** isteyip istemediÄŸinizi belirtin
* **Åifreleme**: **VarsayÄ±lan olarak** bir **Google yÃ¶netimli anahtar** kullanÄ±lacaktÄ±r, ancak bir **KMS anahtarÄ± seÃ§ebilir** veya **kullanÄ±lacak ham anahtarÄ±** belirtebilirsiniz.

### Deploy Container

Sanal makine iÃ§inde bir **konteyner** daÄŸÄ±tmak mÃ¼mkÃ¼ndÃ¼r.\
KullanÄ±lacak **gÃ¶rÃ¼ntÃ¼yÃ¼** yapÄ±landÄ±rmak, iÃ§inde Ã§alÄ±ÅŸtÄ±rÄ±lacak **komutu**, **argÃ¼manlarÄ±**, bir **hacim** baÄŸlamak ve **env deÄŸiÅŸkenlerini** (hassas bilgiler?) ayarlamak ve bu konteyner iÃ§in **yetkili** olarak Ã§alÄ±ÅŸtÄ±rma, stdin ve sahte TTY gibi Ã§eÅŸitli seÃ§enekleri yapÄ±landÄ±rmak mÃ¼mkÃ¼ndÃ¼r.

### Service Account

VarsayÄ±lan olarak, **Compute Engine varsayÄ±lan hizmet hesabÄ±** kullanÄ±lacaktÄ±r. Bu SA'nÄ±n e-posta adresi ÅŸÃ¶yle gÃ¶rÃ¼nÃ¼r: `<proj-num>-compute@developer.gserviceaccount.com`\
Bu hizmet hesabÄ±, **tÃ¼m projede EditÃ¶r rolÃ¼ne (yÃ¼ksek ayrÄ±calÄ±klar)** sahiptir.

Ve **varsayÄ±lan eriÅŸim kapsamlarÄ±** ÅŸunlardÄ±r:

* **https://www.googleapis.com/auth/devstorage.read\_only** -- Kovalara okuma eriÅŸimi :)
* https://www.googleapis.com/auth/logging.write
* https://www.googleapis.com/auth/monitoring.write
* https://www.googleapis.com/auth/servicecontrol
* https://www.googleapis.com/auth/service.management.readonly
* https://www.googleapis.com/auth/trace.append

Ancak, **bir tÄ±klama ile `cloud-platform` vermek** veya **Ã¶zel olanlarÄ±** belirtmek mÃ¼mkÃ¼ndÃ¼r.

<figure><img src="../../../../.gitbook/assets/image (327).png" alt=""><figcaption></figcaption></figure>

### Firewall

HTTP ve HTTPS trafiÄŸine izin vermek mÃ¼mkÃ¼ndÃ¼r.

<figure><img src="../../../../.gitbook/assets/image (326).png" alt=""><figcaption></figcaption></figure>

### Networking

* **IP Forwarding**: Ã–rneÄŸin, Ã¶rneÄŸin oluÅŸturulurken **IP yÃ¶nlendirmesini etkinleÅŸtirmek** mÃ¼mkÃ¼ndÃ¼r.
* **Hostname**: Ã–rneÄŸe kalÄ±cÄ± bir ana bilgisayar adÄ± vermek mÃ¼mkÃ¼ndÃ¼r.
* **ArayÃ¼z**: Bir aÄŸ arayÃ¼zÃ¼ eklemek mÃ¼mkÃ¼ndÃ¼r.

### Extra Security

Bu seÃ§enekler, VM'nin **gÃ¼venliÄŸini artÄ±racak** ve Ã¶nerilmektedir:

* **GÃ¼venli Ã¶nyÃ¼kleme:** GÃ¼venli Ã¶nyÃ¼kleme, VM Ã¶rneklerinizi Ã¶nyÃ¼kleme dÃ¼zeyinde ve Ã§ekirdek dÃ¼zeyinde kÃ¶tÃ¼ amaÃ§lÄ± yazÄ±lÄ±mlara ve rootkit'lere karÅŸÄ± korumaya yardÄ±mcÄ± olur.
* **vTPM'yi etkinleÅŸtir:** Sanal GÃ¼venilir Platform ModÃ¼lÃ¼ (vTPM), misafir VM'nizin Ã¶nyÃ¼kleme Ã¶ncesi ve Ã¶nyÃ¼kleme bÃ¼tÃ¼nlÃ¼ÄŸÃ¼nÃ¼ doÄŸrular ve anahtar oluÅŸturma ve koruma sunar.
* **BÃ¼tÃ¼nlÃ¼k denetimi:** BÃ¼tÃ¼nlÃ¼k izleme, Stackdriver raporlarÄ±nÄ± kullanarak korumalÄ± VM Ã¶rneklerinizin Ã§alÄ±ÅŸma zamanÄ± Ã¶nyÃ¼kleme bÃ¼tÃ¼nlÃ¼ÄŸÃ¼nÃ¼ izlemenizi ve doÄŸrulamanÄ±zÄ± saÄŸlar. vTPM'nin etkinleÅŸtirilmesi gereklidir.

### VM Access

VM'ye eriÅŸimi etkinleÅŸtirmenin yaygÄ±n yolu, **belirli SSH genel anahtarlarÄ±na** VM'ye eriÅŸim izni vermektir.\
Ancak, bu hizmeti kullanarak **IAM ile VM'ye eriÅŸimi etkinleÅŸtirmek** de mÃ¼mkÃ¼ndÃ¼r. AyrÄ±ca, bu hizmeti kullanarak VM'ye eriÅŸim iÃ§in 2FA'yÄ± etkinleÅŸtirmek mÃ¼mkÃ¼ndÃ¼r.\
Bu **hizmet** **etkinleÅŸtirildiÄŸinde**, **SSH anahtarlarÄ± ile eriÅŸim devre dÄ±ÅŸÄ± bÄ±rakÄ±lÄ±r.**

<figure><img src="../../../../.gitbook/assets/image (328).png" alt=""><figcaption></figcaption></figure>

### Metadata

Her seferinde makine aÃ§Ä±ldÄ±ÄŸÄ±nda veya yeniden baÅŸlatÄ±ldÄ±ÄŸÄ±nda Ã§alÄ±ÅŸtÄ±rÄ±lacak **otomasyon** (AWS'deki userdata) olarak tanÄ±mlamak mÃ¼mkÃ¼ndÃ¼r.

AyrÄ±ca, metadata uÃ§ noktasÄ±ndan eriÅŸilebilecek **ekstra metadata anahtar-deÄŸer Ã§iftleri** eklemek de mÃ¼mkÃ¼ndÃ¼r. Bu bilgi genellikle ortam deÄŸiÅŸkenleri ve baÅŸlangÄ±Ã§/kapatma betikleri iÃ§in kullanÄ±lÄ±r. Bu, enumerasyon bÃ¶lÃ¼mÃ¼ndeki bir komuttan **`describe` yÃ¶ntemini** kullanarak elde edilebilir, ancak aynÄ± zamanda metadata uÃ§ noktasÄ±na eriÅŸerek Ã¶rneÄŸin iÃ§inden de alÄ±nabilir.
```bash
# view project metadata
curl "http://metadata.google.internal/computeMetadata/v1/project/attributes/?recursive=true&alt=text" \
-H "Metadata-Flavor: Google"

# view instance metadata
curl "http://metadata.google.internal/computeMetadata/v1/instance/attributes/?recursive=true&alt=text" \
-H "Metadata-Flavor: Google"
```
AyrÄ±ca, **baÄŸlÄ± hizmet hesabÄ± iÃ§in auth token** ve **Ã¶rnek, aÄŸ ve proje hakkÄ±nda genel bilgiler** de **metadata uÃ§ noktasÄ±ndan** eriÅŸilebilir olacaktÄ±r. Daha fazla bilgi iÃ§in kontrol edin:

{% embed url="https://book.hacktricks.xyz/pentesting-web/ssrf-server-side-request-forgery/cloud-ssrf#6440" %}

### Åifreleme

VarsayÄ±lan olarak Google tarafÄ±ndan yÃ¶netilen bir ÅŸifreleme anahtarÄ± kullanÄ±lÄ±r, ancak MÃ¼ÅŸteri tarafÄ±ndan yÃ¶netilen bir ÅŸifreleme anahtarÄ± (CMEK) yapÄ±landÄ±rÄ±labilir. KullanÄ±lan CMEK'in iptal edilmesi durumunda ne yapÄ±lacaÄŸÄ±nÄ± da yapÄ±landÄ±rabilirsiniz: Not almak veya VM'yi kapatmak.

<figure><img src="../../../../.gitbook/assets/image (329).png" alt=""><figcaption></figcaption></figure>

{% hint style="success" %}
AWS Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n:<img src="../../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
GCP Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n: <img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**abonelik planlarÄ±nÄ±**](https://github.com/sponsors/carlospolop) kontrol edin!
* **ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n ya da **Twitter'da** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)** bizi takip edin.**
* **Hacking ipuÃ§larÄ±nÄ± paylaÅŸmak iÃ§in [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna PR gÃ¶nderin.**

</details>
{% endhint %}
