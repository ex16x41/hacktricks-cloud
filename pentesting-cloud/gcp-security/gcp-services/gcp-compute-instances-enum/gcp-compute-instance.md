# GCP - Compute Instances

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Basic Information

As Inst√¢ncias de Computa√ß√£o do Google Cloud s√£o **m√°quinas virtuais personaliz√°veis na infraestrutura de nuvem do Google**, oferecendo poder computacional escal√°vel e sob demanda para uma ampla gama de aplica√ß√µes. Elas fornecem recursos como implanta√ß√£o global, armazenamento persistente, op√ß√µes flex√≠veis de SO e fortes integra√ß√µes de rede e seguran√ßa, tornando-as uma escolha vers√°til para hospedar sites, processar dados e executar aplica√ß√µes de forma eficiente na nuvem.

### Confidential VM

As VMs Confidenciais usam **recursos de seguran√ßa baseados em hardware** oferecidos pela √∫ltima gera√ß√£o de processadores AMD EPYC, que incluem criptografia de mem√≥ria e virtualiza√ß√£o criptografada segura. Esses recursos permitem que a VM proteja os dados processados e armazenados dentro dela, at√© mesmo do sistema operacional host e do hipervisor.

Para executar uma VM Confidencial, pode ser necess√°rio **alterar** coisas como o **tipo** da **m√°quina**, **interface** de rede, **imagem do disco de inicializa√ß√£o**.

### Disk & Disk Encryption

√â poss√≠vel **selecionar o disco** a ser usado ou **criar um novo**. Se voc√™ selecionar um novo, pode:

* Selecionar o **tamanho** do disco
* Selecionar o **SO**
* Indicar se deseja **deletar o disco quando a inst√¢ncia for deletada**
* **Criptografia**: Por **padr√£o**, uma **chave gerenciada pelo Google** ser√° usada, mas voc√™ tamb√©m pode **selecionar uma chave do KMS** ou indicar **chave bruta a ser usada**.

### Deploy Container

√â poss√≠vel implantar um **container** dentro da m√°quina virtual.\
√â poss√≠vel configurar a **imagem** a ser usada, definir o **comando** a ser executado dentro, **argumentos**, montar um **volume** e **vari√°veis de ambiente** (informa√ß√µes sens√≠veis?) e configurar v√°rias op√ß√µes para este container, como executar como **privilegiado**, stdin e pseudo TTY.

### Service Account

Por padr√£o, a **conta de servi√ßo padr√£o do Compute Engine** ser√° usada. O e-mail desta SA √© como: `<proj-num>-compute@developer.gserviceaccount.com`\
Esta conta de servi√ßo tem **papel de Editor sobre todo o projeto (altos privil√©gios).**

E os **escopos de acesso padr√£o** s√£o os seguintes:

* **https://www.googleapis.com/auth/devstorage.read\_only** -- Acesso de leitura a buckets :)
* https://www.googleapis.com/auth/logging.write
* https://www.googleapis.com/auth/monitoring.write
* https://www.googleapis.com/auth/servicecontrol
* https://www.googleapis.com/auth/service.management.readonly
* https://www.googleapis.com/auth/trace.append

No entanto, √© poss√≠vel **conceder `cloud-platform` com um clique** ou especificar **personalizados**.

<figure><img src="../../../../.gitbook/assets/image (327).png" alt=""><figcaption></figcaption></figure>

### Firewall

√â poss√≠vel permitir tr√°fego HTTP e HTTPS.

<figure><img src="../../../../.gitbook/assets/image (326).png" alt=""><figcaption></figcaption></figure>

### Networking

* **IP Forwarding**: √â poss√≠vel **habilitar o encaminhamento de IP** a partir da cria√ß√£o da inst√¢ncia.
* **Hostname**: √â poss√≠vel dar √† inst√¢ncia um hostname permanente.
* **Interface**: √â poss√≠vel adicionar uma interface de rede.

### Extra Security

Essas op√ß√µes ir√£o **aumentar a seguran√ßa** da VM e s√£o recomendadas:

* **Secure boot:** O Secure boot ajuda a proteger suas inst√¢ncias de VM contra malware e rootkits em n√≠vel de inicializa√ß√£o e kernel.
* **Enable vTPM:** O M√≥dulo de Plataforma Confi√°vel Virtual (vTPM) valida a integridade de pr√©-inicializa√ß√£o e inicializa√ß√£o da sua VM convidada e oferece gera√ß√£o e prote√ß√£o de chaves.
* **Integrity supervision:** A supervis√£o de integridade permite que voc√™ monitore e verifique a integridade de inicializa√ß√£o em tempo de execu√ß√£o de suas inst√¢ncias de VM blindadas usando relat√≥rios do Stackdriver. Requer que o vTPM esteja habilitado.

### VM Access

A maneira comum de habilitar o acesso √† VM √© **permitindo certas chaves p√∫blicas SSH** para acessar a VM.\
No entanto, tamb√©m √© poss√≠vel **habilitar o acesso √† VM via servi√ßo `os-config` usando IAM**. Al√©m disso, √© poss√≠vel habilitar 2FA para acessar a VM usando este servi√ßo.\
Quando este **servi√ßo** est√° **habilitado**, o acesso via **chaves SSH √© desabilitado.**

<figure><img src="../../../../.gitbook/assets/image (328).png" alt=""><figcaption></figcaption></figure>

### Metadata

√â poss√≠vel definir **automa√ß√£o** (userdata no AWS) que s√£o **comandos shell** que ser√£o executados toda vez que a m√°quina ligar ou reiniciar.

√â tamb√©m poss√≠vel **adicionar valores de chave-valor de metadados extras** que estar√£o acess√≠veis a partir do endpoint de metadados. Essas informa√ß√µes s√£o comumente usadas para vari√°veis de ambiente e scripts de inicializa√ß√£o/desligamento. Isso pode ser obtido usando o **m√©todo `describe`** de um comando na se√ß√£o de enumera√ß√£o, mas tamb√©m pode ser recuperado de dentro da inst√¢ncia acessando o endpoint de metadados.
```bash
# view project metadata
curl "http://metadata.google.internal/computeMetadata/v1/project/attributes/?recursive=true&alt=text" \
-H "Metadata-Flavor: Google"

# view instance metadata
curl "http://metadata.google.internal/computeMetadata/v1/instance/attributes/?recursive=true&alt=text" \
-H "Metadata-Flavor: Google"
```
Al√©m disso, **o token de autentica√ß√£o para a conta de servi√ßo anexada** e **informa√ß√µes gerais** sobre a inst√¢ncia, rede e projeto tamb√©m estar√£o dispon√≠veis no **endpoint de metadados**. Para mais informa√ß√µes, consulte:

{% embed url="https://book.hacktricks.xyz/pentesting-web/ssrf-server-side-request-forgery/cloud-ssrf#6440" %}

### Criptografia

Uma chave de criptografia gerenciada pelo Google √© usada por padr√£o, mas uma chave de criptografia gerenciada pelo cliente (CMEK) pode ser configurada. Voc√™ tamb√©m pode configurar o que fazer quando a CMEK utilizada for revogada: Notificar ou desligar a VM.

<figure><img src="../../../../.gitbook/assets/image (329).png" alt=""><figcaption></figcaption></figure>

{% hint style="success" %}
Aprenda e pratique Hacking AWS:<img src="../../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
Aprenda e pratique Hacking GCP: <img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Confira os [**planos de assinatura**](https://github.com/sponsors/carlospolop)!
* **Junte-se ao** üí¨ [**grupo do Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga**-nos no **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Compartilhe truques de hacking enviando PRs para os reposit√≥rios do** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
{% endhint %}
