# GCP - Compute Instances

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Grundinformationen

Google Cloud Compute Instances sind **anpassbare virtuelle Maschinen auf der Cloud-Infrastruktur von Google**, die skalierbare und bedarfsgerechte Rechenleistung f√ºr eine Vielzahl von Anwendungen bieten. Sie bieten Funktionen wie globale Bereitstellung, persistente Speicherung, flexible Betriebssystemauswahl sowie starke Netzwerk- und Sicherheitsintegrationen, was sie zu einer vielseitigen Wahl f√ºr das Hosting von Websites, die Datenverarbeitung und das effiziente Ausf√ºhren von Anwendungen in der Cloud macht.

### Vertrauliche VM

Vertrauliche VMs nutzen **hardwarebasierte Sicherheitsfunktionen**, die von der neuesten Generation der AMD EPYC-Prozessoren angeboten werden, einschlie√ülich Speicherverschl√ºsselung und sicherer verschl√ºsselter Virtualisierung. Diese Funktionen erm√∂glichen es der VM, die verarbeiteten und gespeicherten Daten vor sogar dem Host-Betriebssystem und Hypervisor zu sch√ºtzen.

Um eine vertrauliche VM auszuf√ºhren, m√ºssen m√∂glicherweise Dinge wie der **Typ** der **Maschine**, die Netzwerk-**schnittstelle**, das **Boot-Disk-Image** **ge√§ndert** werden.

### Festplatte & Festplattenverschl√ºsselung

Es ist m√∂glich, die **Festplatte** auszuw√§hlen, die verwendet werden soll, oder **eine neue zu erstellen**. Wenn Sie eine neue ausw√§hlen, k√∂nnen Sie:

* Die **Gr√∂√üe** der Festplatte ausw√§hlen
* Das **Betriebssystem** ausw√§hlen
* Angeben, ob Sie die **Festplatte l√∂schen m√∂chten, wenn die Instanz gel√∂scht wird**
* **Verschl√ºsselung**: Standardm√§√üig wird ein **von Google verwalteter Schl√ºssel** verwendet, aber Sie k√∂nnen auch **einen Schl√ºssel aus KMS ausw√§hlen** oder **einen Rohschl√ºssel angeben**.

### Container bereitstellen

Es ist m√∂glich, einen **Container** innerhalb der virtuellen Maschine bereitzustellen.\
Es ist m√∂glich, das **Image** auszuw√§hlen, das verwendet werden soll, den **Befehl** festzulegen, der innerhalb ausgef√ºhrt werden soll, **Argumente**, ein **Volume** zu mounten und **Umgebungsvariablen** (sensible Informationen?) zu konfigurieren sowie mehrere Optionen f√ºr diesen Container wie Ausf√ºhrung als **privilegiert**, stdin und pseudo TTY zu konfigurieren.

### Dienstkonto

Standardm√§√üig wird das **Standarddienstkonto von Compute Engine** verwendet. Die E-Mail dieses SA lautet: `<proj-num>-compute@developer.gserviceaccount.com`\
Dieses Dienstkonto hat die **Editor-Rolle √ºber das gesamte Projekt (hohe Berechtigungen).**

Und die **Standardzugriffsbereiche** sind die folgenden:

* **https://www.googleapis.com/auth/devstorage.read\_only** -- Lesezugriff auf Buckets :)
* https://www.googleapis.com/auth/logging.write
* https://www.googleapis.com/auth/monitoring.write
* https://www.googleapis.com/auth/servicecontrol
* https://www.googleapis.com/auth/service.management.readonly
* https://www.googleapis.com/auth/trace.append

Es ist jedoch m√∂glich, **es mit einem Klick `cloud-platform` zu gew√§hren** oder **benutzerdefinierte** zu spezifizieren.

<figure><img src="../../../../.gitbook/assets/image (327).png" alt=""><figcaption></figcaption></figure>

### Firewall

Es ist m√∂glich, HTTP- und HTTPS-Verkehr zuzulassen.

<figure><img src="../../../../.gitbook/assets/image (326).png" alt=""><figcaption></figcaption></figure>

### Netzwerk

* **IP-Weiterleitung**: Es ist m√∂glich, die **IP-Weiterleitung** bei der Erstellung der Instanz zu **aktivieren**.
* **Hostname**: Es ist m√∂glich, der Instanz einen permanenten Hostnamen zu geben.
* **Schnittstelle**: Es ist m√∂glich, eine Netzwerkschnittstelle hinzuzuf√ºgen.

### Zus√§tzliche Sicherheit

Diese Optionen werden die **Sicherheit** der VM **erh√∂hen** und sind empfohlen:

* **Sicherer Boot:** Sicherer Boot hilft, Ihre VM-Instanzen vor Malware und Rootkits auf Boot- und Kernel-Ebene zu sch√ºtzen.
* **vTPM aktivieren:** Das virtuelle Trusted Platform Module (vTPM) validiert die Integrit√§t Ihrer Gast-VM vor dem Booten und w√§hrend des Bootvorgangs und bietet Schl√ºsselgenerierung und -schutz.
* **Integrit√§ts√ºberwachung:** Die Integrit√§ts√ºberwachung erm√∂glicht es Ihnen, die Laufzeit-Integrit√§t des Bootvorgangs Ihrer gesch√ºtzten VM-Instanzen mithilfe von Stackdriver-Berichten zu √ºberwachen und zu √ºberpr√ºfen. Erfordert, dass vTPM aktiviert ist.

### VM-Zugriff

Der g√§ngige Weg, um den Zugriff auf die VM zu erm√∂glichen, besteht darin, **bestimmte SSH-√ñffentlichkeits-Schl√ºssel** den Zugriff auf die VM zu erlauben.\
Es ist jedoch auch m√∂glich, den Zugriff auf die VM √ºber den `os-config`-Dienst mithilfe von IAM zu **aktivieren**. Dar√ºber hinaus ist es m√∂glich, 2FA zu aktivieren, um auf die VM √ºber diesen Dienst zuzugreifen.\
Wenn dieser **Dienst** **aktiviert** ist, ist der Zugriff √ºber **SSH-Schl√ºssel deaktiviert.**

<figure><img src="../../../../.gitbook/assets/image (328).png" alt=""><figcaption></figcaption></figure>

### Metadaten

Es ist m√∂glich, **Automatisierung** (Benutzerdaten in AWS) zu definieren, die **Shell-Befehle** sind, die jedes Mal ausgef√ºhrt werden, wenn die Maschine eingeschaltet oder neu gestartet wird.

Es ist auch m√∂glich, **zus√§tzliche Metadaten-Schl√ºssel-Wert-Paare** hinzuzuf√ºgen, die √ºber den Metadaten-Endpunkt zug√§nglich sind. Diese Informationen werden h√§ufig f√ºr Umgebungsvariablen und Start-/Herunterfahrskripte verwendet. Dies kann mit der **`describe`-Methode** aus einem Befehl im Enumerationsabschnitt abgerufen werden, kann jedoch auch von innerhalb der Instanz √ºber den Metadaten-Endpunkt abgerufen werden.
```bash
# view project metadata
curl "http://metadata.google.internal/computeMetadata/v1/project/attributes/?recursive=true&alt=text" \
-H "Metadata-Flavor: Google"

# view instance metadata
curl "http://metadata.google.internal/computeMetadata/v1/instance/attributes/?recursive=true&alt=text" \
-H "Metadata-Flavor: Google"
```
Moreover, **Auth-Token f√ºr das angeh√§ngte Dienstkonto** und **allgemeine Informationen** √ºber die Instanz, das Netzwerk und das Projekt sind ebenfalls √ºber den **Metadaten-Endpunkt** verf√ºgbar. F√ºr weitere Informationen siehe:

{% embed url="https://book.hacktricks.xyz/pentesting-web/ssrf-server-side-request-forgery/cloud-ssrf#6440" %}

### Verschl√ºsselung

Standardm√§√üig wird ein von Google verwalteter Verschl√ºsselungsschl√ºssel verwendet, aber ein vom Kunden verwalteter Verschl√ºsselungsschl√ºssel (CMEK) kann konfiguriert werden. Sie k√∂nnen auch konfigurieren, was zu tun ist, wenn der verwendete CMEK widerrufen wird: Nichts oder die VM herunterfahren.

<figure><img src="../../../../.gitbook/assets/image (329).png" alt=""><figcaption></figcaption></figure>

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
