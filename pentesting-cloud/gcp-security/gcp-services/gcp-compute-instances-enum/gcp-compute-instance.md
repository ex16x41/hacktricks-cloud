# GCP - Compute Instances

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Podstawowe Informacje

Google Cloud Compute Instances to **dostosowywalne maszyny wirtualne na infrastrukturze chmurowej Google**, oferujÄ…ce skalowalnÄ… i na Å¼Ä…danie moc obliczeniowÄ… dla szerokiego zakresu aplikacji. OferujÄ… funkcje takie jak globalne wdraÅ¼anie, trwaÅ‚e przechowywanie, elastyczne wybory systemu operacyjnego oraz silne integracje sieciowe i bezpieczeÅ„stwa, co czyni je wszechstronnym wyborem do hostowania stron internetowych, przetwarzania danych i efektywnego uruchamiania aplikacji w chmurze.

### Confidential VM

Confidential VMs uÅ¼ywajÄ… **funkcji bezpieczeÅ„stwa opartych na sprzÄ™cie** oferowanych przez najnowszÄ… generacjÄ™ procesorÃ³w AMD EPYC, ktÃ³re obejmujÄ… szyfrowanie pamiÄ™ci i bezpiecznÄ… wirtualizacjÄ™ szyfrowanÄ…. Te funkcje umoÅ¼liwiajÄ… VM ochronÄ™ przetwarzanych i przechowywanych danych przed nawet systemem operacyjnym hosta i hypervisorem.

Aby uruchomiÄ‡ Confidential VM, moÅ¼e byÄ‡ konieczne **zmienienie** takich rzeczy jak **typ** **maszyny**, **interfejs sieciowy**, **obraz dysku startowego**.

### Dysk i Szyfrowanie Dysku

MoÅ¼liwe jest **wybranie dysku** do uÅ¼ycia lub **utworzenie nowego**. JeÅ›li wybierzesz nowy, moÅ¼esz:

* WybraÄ‡ **rozmiar** dysku
* WybraÄ‡ **system operacyjny**
* WskazaÄ‡, czy chcesz **usunÄ…Ä‡ dysk, gdy instancja zostanie usuniÄ™ta**
* **Szyfrowanie**: DomyÅ›lnie uÅ¼ywany bÄ™dzie **klucz zarzÄ…dzany przez Google**, ale moÅ¼esz rÃ³wnieÅ¼ **wybraÄ‡ klucz z KMS** lub wskazaÄ‡ **surowy klucz do uÅ¼ycia**.

### WdraÅ¼anie Kontenera

MoÅ¼liwe jest wdroÅ¼enie **kontenera** wewnÄ…trz maszyny wirtualnej.\
MoÅ¼liwe jest skonfigurowanie **obrazu** do uÅ¼ycia, ustawienie **polecenia** do uruchomienia wewnÄ…trz, **argumentÃ³w**, zamontowanie **woluminu** i **zmiennych Å›rodowiskowych** (wraÅ¼liwe informacje?) oraz skonfigurowanie kilku opcji dla tego kontenera, takich jak uruchomienie jako **uprzywilejowany**, stdin i pseudo TTY.

### Konto UsÅ‚ugi

DomyÅ›lnie uÅ¼ywane bÄ™dzie **domyÅ›lne konto usÅ‚ugi Compute Engine**. Email tego SA wyglÄ…da tak: `<proj-num>-compute@developer.gserviceaccount.com`\
To konto usÅ‚ugi ma **rolÄ™ Edytora nad caÅ‚ym projektem (wysokie uprawnienia).**

A domyÅ›lne zakresy dostÄ™pu sÄ… nastÄ™pujÄ…ce:

* **https://www.googleapis.com/auth/devstorage.read\_only** -- DostÄ™p do odczytu do bucketÃ³w :)
* https://www.googleapis.com/auth/logging.write
* https://www.googleapis.com/auth/monitoring.write
* https://www.googleapis.com/auth/servicecontrol
* https://www.googleapis.com/auth/service.management.readonly
* https://www.googleapis.com/auth/trace.append

JednakÅ¼e, moÅ¼liwe jest **przyznanie `cloud-platform` jednym klikniÄ™ciem** lub okreÅ›lenie **wÅ‚asnych**.

<figure><img src="../../../../.gitbook/assets/image (327).png" alt=""><figcaption></figcaption></figure>

### Zapora Sieciowa

MoÅ¼liwe jest zezwolenie na ruch HTTP i HTTPS.

<figure><img src="../../../../.gitbook/assets/image (326).png" alt=""><figcaption></figcaption></figure>

### SieÄ‡

* **Przekazywanie IP**: MoÅ¼liwe jest **wÅ‚Ä…czenie przekazywania IP** od momentu tworzenia instancji.
* **Nazwa hosta**: MoÅ¼liwe jest nadanie instancji staÅ‚ej nazwy hosta.
* **Interfejs**: MoÅ¼liwe jest dodanie interfejsu sieciowego.

### Dodatkowe Zabezpieczenia

Te opcje **zwiÄ™kszÄ… bezpieczeÅ„stwo** VM i sÄ… zalecane:

* **Bezpieczny rozruch:** Bezpieczny rozruch pomaga chroniÄ‡ instancje VM przed zÅ‚oÅ›liwym oprogramowaniem na poziomie rozruchu i jÄ…dra oraz rootkitami.
* **WÅ‚Ä…cz vTPM:** Wirtualny Zaufany ModuÅ‚ Platformy (vTPM) weryfikuje integralnoÅ›Ä‡ przedrozruchowÄ… i rozruchowÄ… twojej goÅ›cinnej VM oraz oferuje generowanie i ochronÄ™ kluczy.
* **NadzÃ³r integralnoÅ›ci:** Monitorowanie integralnoÅ›ci pozwala monitorowaÄ‡ i weryfikowaÄ‡ integralnoÅ›Ä‡ rozruchowÄ… twoich osÅ‚oniÄ™tych instancji VM za pomocÄ… raportÃ³w Stackdriver. Wymaga wÅ‚Ä…czenia vTPM.

### DostÄ™p do VM

Powszechnym sposobem umoÅ¼liwienia dostÄ™pu do VM jest **zezwolenie na dostÄ™p okreÅ›lonym kluczom publicznym SSH**.\
JednakÅ¼e, moÅ¼liwe jest rÃ³wnieÅ¼ **wÅ‚Ä…czenie dostÄ™pu do VM za pomocÄ… usÅ‚ugi `os-config` przy uÅ¼yciu IAM**. Ponadto, moÅ¼liwe jest wÅ‚Ä…czenie 2FA do dostÄ™pu do VM za pomocÄ… tej usÅ‚ugi.\
Gdy ta **usÅ‚uga** jest **wÅ‚Ä…czona**, dostÄ™p za pomocÄ… **kluczy SSH jest wyÅ‚Ä…czony.**

<figure><img src="../../../../.gitbook/assets/image (328).png" alt=""><figcaption></figcaption></figure>

### Metadane

MoÅ¼liwe jest zdefiniowanie **automatyzacji** (userdata w AWS), ktÃ³re sÄ… **poleceniami powÅ‚oki** wykonywanymi za kaÅ¼dym razem, gdy maszyna siÄ™ wÅ‚Ä…cza lub restartuje.

MoÅ¼liwe jest rÃ³wnieÅ¼ **dodanie dodatkowych wartoÅ›ci klucz-wartoÅ›Ä‡ metadanych**, ktÃ³re bÄ™dÄ… dostÄ™pne z punktu koÅ„cowego metadanych. Te informacje sÄ… powszechnie uÅ¼ywane do zmiennych Å›rodowiskowych i skryptÃ³w startowych/zamykajÄ…cych. MoÅ¼na je uzyskaÄ‡ za pomocÄ… **metody `describe`** z polecenia w sekcji enumeracji, ale moÅ¼na je rÃ³wnieÅ¼ pobraÄ‡ z wnÄ™trza instancji, uzyskujÄ…c dostÄ™p do punktu koÅ„cowego metadanych.
```bash
# view project metadata
curl "http://metadata.google.internal/computeMetadata/v1/project/attributes/?recursive=true&alt=text" \
-H "Metadata-Flavor: Google"

# view instance metadata
curl "http://metadata.google.internal/computeMetadata/v1/instance/attributes/?recursive=true&alt=text" \
-H "Metadata-Flavor: Google"
```
Moreover, **auth token for the attached service account** i **ogÃ³lne informacje** o instancji, sieci i projekcie bÄ™dÄ… rÃ³wnieÅ¼ dostÄ™pne z **endpointu metadata**. WiÄ™cej informacji znajdziesz tutaj:

{% embed url="https://book.hacktricks.xyz/pentesting-web/ssrf-server-side-request-forgery/cloud-ssrf#6440" %}

### Szyfrowanie

DomyÅ›lnie uÅ¼ywany jest klucz szyfrowania zarzÄ…dzany przez Google, ale moÅ¼na skonfigurowaÄ‡ klucz szyfrowania zarzÄ…dzany przez klienta (CMEK). MoÅ¼esz rÃ³wnieÅ¼ skonfigurowaÄ‡, co zrobiÄ‡, gdy uÅ¼ywany CMEK zostanie odwoÅ‚any: Nic lub wyÅ‚Ä…czyÄ‡ VM.

<figure><img src="../../../../.gitbook/assets/image (329).png" alt=""><figcaption></figcaption></figure>

{% hint style="success" %}
Ucz siÄ™ i Ä‡wicz AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Ucz siÄ™ i Ä‡wicz GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Wspieraj HackTricks</summary>

* SprawdÅº [**plany subskrypcji**](https://github.com/sponsors/carlospolop)!
* **DoÅ‚Ä…cz do** ğŸ’¬ [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegram**](https://t.me/peass) lub **Å›ledÅº** nas na **Twitterze** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Dziel siÄ™ trikami hakerskimi, przesyÅ‚ajÄ…c PR do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repozytoriÃ³w na githubie.

</details>
{% endhint %}
