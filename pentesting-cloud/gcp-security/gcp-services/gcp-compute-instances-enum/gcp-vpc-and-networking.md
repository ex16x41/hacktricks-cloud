# GCP - VPC & Networking

{% hint style="success" %}
AWS Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n:<img src="../../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
GCP Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n: <img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**abonelik planlarÄ±nÄ±**](https://github.com/sponsors/carlospolop) kontrol edin!
* **ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n ya da **Twitter**'da **bizi takip edin** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Hacking ipuÃ§larÄ±nÄ± paylaÅŸmak iÃ§in** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna PR gÃ¶nderin.

</details>
{% endhint %}

## **GCP Compute Networking KÄ±saca**

**VPC'ler**, VPC'ye gelen trafiÄŸi izin vermek iÃ§in **Firewall** kurallarÄ±nÄ± iÃ§erir. VPC'ler ayrÄ±ca **sanallaÅŸtÄ±rÄ±lmÄ±ÅŸ makinelerin** **baÄŸlanacaÄŸÄ±** **alt aÄŸlarÄ±** iÃ§erir.\
AWS ile karÅŸÄ±laÅŸtÄ±rÄ±ldÄ±ÄŸÄ±nda, **Firewall**, **AWS** **GÃ¼venlik GruplarÄ± ve NACL'ler** iÃ§in en **yakÄ±n** ÅŸeydir, ancak bu durumda bunlar **VPC'de** tanÄ±mlanmÄ±ÅŸtÄ±r ve her bir Ã¶rnekte deÄŸil.

## **GCP'de VPC, Alt AÄŸlar & Firewall'lar**

Compute Instances, **VPC'lerin** ([Sanal Ã–zel Bulutlar](https://cloud.google.com/vpc/docs/vpc)) bir parÃ§asÄ± olan **alt aÄŸlara** baÄŸlÄ±dÄ±r. GCP'de gÃ¼venlik gruplarÄ± yoktur, bu aÄŸ seviyesinde tanÄ±mlanan ancak her VM Ã–rneÄŸine uygulanan [**VPC firewall'larÄ±**](https://cloud.google.com/vpc/docs/firewalls) vardÄ±r.

### Alt AÄŸlar

Bir **VPC**, **birÃ§ok alt aÄŸa** sahip olabilir. Her **alt aÄŸ 1 bÃ¶lgede** bulunur.

### Firewall'lar

VarsayÄ±lan olarak, her aÄŸÄ±n iki [**anlamlÄ± firewall kuralÄ±**](https://cloud.google.com/vpc/docs/firewalls#default_firewall_rules) vardÄ±r: **Ã§Ä±kÄ±ÅŸa izin ver** ve **giriÅŸe engel ol**.

Bir GCP projesi oluÅŸturulduÄŸunda, aÅŸaÄŸÄ±daki firewall kurallarÄ± ile birlikte **`default`** adÄ±nda bir VPC de oluÅŸturulur:

* **default-allow-internal:** `default` aÄŸÄ±ndaki diÄŸer Ã¶rneklerden gelen tÃ¼m trafiÄŸe izin ver
* **default-allow-ssh:** her yerden 22'ye izin ver
* **default-allow-rdp:** her yerden 3389'a izin ver
* **default-allow-icmp:** her yerden ping'e izin ver

{% hint style="warning" %}
GÃ¶rdÃ¼ÄŸÃ¼nÃ¼z gibi, **firewall kurallarÄ±** **iÃ§ IP adresleri** iÃ§in **daha izin verici** olma eÄŸilimindedir. VarsayÄ±lan VPC, Compute Instances arasÄ±nda tÃ¼m trafiÄŸe izin verir.
{% endhint %}

VarsayÄ±lan VPC veya yeni VPC'ler iÃ§in daha fazla **Firewall kuralÄ±** oluÅŸturulabilir. [**Firewall kurallarÄ±**](https://cloud.google.com/vpc/docs/firewalls), aÅŸaÄŸÄ±daki **yÃ¶ntemler** aracÄ±lÄ±ÄŸÄ±yla Ã¶rneklere uygulanabilir:

* [**AÄŸ etiketleri**](https://cloud.google.com/vpc/docs/add-remove-network-tags)
* [**Hizmet hesaplarÄ±**](https://cloud.google.com/vpc/docs/firewalls#serviceaccounts)
* **Bir VPC iÃ§indeki tÃ¼m Ã¶rnekler**

Ne yazÄ±k ki, internette aÃ§Ä±k portlara sahip tÃ¼m Compute Instances'Ä± dÃ¶ken basit bir `gcloud` komutu yoktur. Firewall kurallarÄ±, aÄŸ etiketleri, hizmet hesaplarÄ± ve Ã¶rnekler arasÄ±nda baÄŸlantÄ± kurmanÄ±z gerekir.

Bu sÃ¼reÃ§, aÅŸaÄŸÄ±dakileri dÄ±ÅŸa aktaracak olan [bu python betiÄŸi](https://gitlab.com/gitlab-com/gl-security/gl-redteam/gcp_firewall_enum) kullanÄ±larak otomatikleÅŸtirildi:

* Ã–rnek, genel IP, izin verilen TCP, izin verilen UDP gÃ¶steren CSV dosyasÄ±
* Genel internetten (0.0.0.0/0) izin verilen portlarda tÃ¼m Ã¶rnekleri hedef alan nmap taramasÄ±
* Genel internetten (0.0.0.0/0) TÃ¼m TCP portlarÄ±na izin veren bu Ã¶rneklerin tam TCP aralÄ±ÄŸÄ±nÄ± hedef alan masscan

### HiyerarÅŸik Firewall PolitikalarÄ± <a href="#hierarchical-firewall-policies" id="hierarchical-firewall-policies"></a>

_HiyerarÅŸik firewall politikalarÄ±_, **kuruluÅŸunuz genelinde tutarlÄ± bir firewall politikasÄ± oluÅŸturmanÄ±za ve uygulamanÄ±za** olanak tanÄ±r. **HiyerarÅŸik firewall politikalarÄ±nÄ±** kuruluÅŸun tamamÄ±na veya bireysel **kataloglara** atayabilirsiniz. Bu politikalar, baÄŸlantÄ±larÄ± aÃ§Ä±kÃ§a reddedebilen veya izin verebilen kurallar iÃ§erir.

Firewall politikalarÄ±nÄ± ayrÄ± adÄ±mlar olarak oluÅŸturur ve uygularsÄ±nÄ±z. Firewall politikalarÄ±nÄ± [**kaynak hiyerarÅŸisi**](https://cloud.google.com/resource-manager/docs/cloud-platform-resource-hierarchy) Ã¼zerindeki **kuruluÅŸ veya klasÃ¶r dÃ¼ÄŸÃ¼mlerinde** oluÅŸturabilir ve uygulayabilirsiniz. Bir firewall politika kuralÄ±, **baÄŸlantÄ±larÄ± engelleyebilir, baÄŸlantÄ±lara izin verebilir veya firewall kuralÄ± deÄŸerlendirmesini** daha dÃ¼ÅŸÃ¼k dÃ¼zeydeki klasÃ¶rlere veya VPC aÄŸlarÄ±nda tanÄ±mlanan VPC firewall kurallarÄ±na erteleyebilir.

VarsayÄ±lan olarak, tÃ¼m hiyerarÅŸik firewall politika kurallarÄ±, politikanÄ±n iliÅŸkilendirildiÄŸi kuruluÅŸ veya klasÃ¶r altÄ±ndaki tÃ¼m projelerdeki tÃ¼m VM'lere uygulanÄ±r. Ancak, [hedef aÄŸlar veya hedef hizmet hesaplarÄ±](https://cloud.google.com/vpc/docs/firewall-policies#targets) belirterek hangi VM'lerin belirli bir kuralÄ± alacaÄŸÄ±nÄ± **kÄ±sÄ±tlayabilirsiniz**.

[**HiyerarÅŸik Firewall PolitikasÄ± oluÅŸturma**](https://cloud.google.com/vpc/docs/using-firewall-policies#gcloud) hakkÄ±nda buradan okuyabilirsiniz.

### Firewall KurallarÄ± DeÄŸerlendirmesi

<figure><img src="../../../../.gitbook/assets/image (2) (1).png" alt=""><figcaption></figcaption></figure>

1. Org: KuruluÅŸa atanan firewall politikalarÄ±
2. KlasÃ¶r: KlasÃ¶re atanan firewall politikalarÄ±
3. VPC: VPC'ye atanan firewall kurallarÄ±
4. Global: VPC'lere atanabilen baÅŸka bir tÃ¼r firewall kuralÄ±
5. BÃ¶lgesel: VM'nin NIC'sinin ve VM'nin bÃ¶lgesinin VPC aÄŸÄ± ile iliÅŸkili firewall kurallarÄ±.

## VPC AÄŸ Peering

Ä°ki Sanal Ã–zel Bulut (VPC) aÄŸÄ±nÄ± baÄŸlayarak **her aÄŸdaki kaynaklarÄ±n birbirleriyle iletiÅŸim kurmasÄ±nÄ±** saÄŸlar.\
Peered VPC aÄŸlarÄ± aynÄ± projede, aynÄ± kuruluÅŸun farklÄ± projelerinde veya **farklÄ± kuruluÅŸlarÄ±n farklÄ± projelerinde** olabilir.

Gerekli izinler ÅŸunlardÄ±r:

* `compute.networks.addPeering`
* `compute.networks.updatePeering`
* `compute.networks.removePeering`
* `compute.networks.listPeeringRoutes`

[**Belgelerde daha fazla bilgi**](https://cloud.google.com/vpc/docs/vpc-peering).

## Referanslar

* [https://about.gitlab.com/blog/2020/02/12/plundering-gcp-escalating-privileges-in-google-cloud-platform/](https://about.gitlab.com/blog/2020/02/12/plundering-gcp-escalating-privileges-in-google-cloud-platform/)
* [https://cloud.google.com/vpc/docs/firewall-policies-overview#rule-evaluation](https://cloud.google.com/vpc/docs/firewall-policies-overview#rule-evaluation)

{% hint style="success" %}
AWS Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n:<img src="../../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
GCP Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n: <img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**abonelik planlarÄ±nÄ±**](https://github.com/sponsors/carlospolop) kontrol edin!
* **ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n ya da **Twitter**'da **bizi takip edin** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Hacking ipuÃ§larÄ±nÄ± paylaÅŸmak iÃ§in** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna PR gÃ¶nderin.

</details>
{% endhint %}
