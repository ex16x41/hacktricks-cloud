# GCP - Cloud Run Enum

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Cloud Run <a href="#reviewing-cloud-run-configurations" id="reviewing-cloud-run-configurations"></a>

Cloud Run √® una piattaforma di calcolo gestita senza server che ti consente di **eseguire container** direttamente sopra l'infrastruttura scalabile di Google.

Puoi eseguire il tuo container o, se stai usando Go, Node.js, Python, Java, .NET Core o Ruby, puoi utilizzare l'opzione [source-based deployment](https://cloud.google.com/run/docs/deploying-source-code) che **costruisce il container per te.**

Google ha costruito Cloud Run per **funzionare bene insieme ad altri servizi su Google Cloud**, cos√¨ puoi costruire applicazioni complete.

### Services and jobs <a href="#services-and-jobs" id="services-and-jobs"></a>

Su Cloud Run, il tuo codice pu√≤ essere eseguito continuamente come un _**servizio**_ o come un _**lavoro**_. Sia i servizi che i lavori vengono eseguiti nello stesso ambiente e possono utilizzare le stesse integrazioni con altri servizi su Google Cloud.

* **Cloud Run services.** Utilizzati per eseguire codice che risponde a richieste web o eventi.
* **Cloud Run jobs.** Utilizzati per eseguire codice che svolge un lavoro (un lavoro) e termina quando il lavoro √® completato.

## Cloud Run Service

Google [Cloud Run](https://cloud.google.com/run) √® un'altra offerta senza server dove puoi cercare anche variabili d'ambiente. Cloud Run crea un piccolo server web, in esecuzione sulla porta 8080 all'interno del container per impostazione predefinita, che rimane in attesa di una richiesta HTTP GET. Quando la richiesta viene ricevuta, viene eseguito un lavoro e il log del lavoro viene restituito tramite una risposta HTTP.

### Relevant details

* Per **impostazione predefinita**, l'**accesso** al server web √® **pubblico**, ma pu√≤ anche essere **limitato al traffico interno** (VPC...)\
Inoltre, l'**autenticazione** per contattare il server web pu√≤ essere **consentita a tutti** o **richiedere autenticazione tramite IAM**.
* Per impostazione predefinita, la **cifratura** utilizza una **chiave gestita da Google**, ma pu√≤ anche essere **scelta** una **CMEK** (Customer Managed Encryption Key) da **KMS**.
* Per **impostazione predefinita**, l'**account di servizio** utilizzato √® quello **predefinito di Compute Engine** che ha accesso **Editor** sul progetto e ha lo **scopo `cloud-platform`.**
* √à possibile definire **variabili d'ambiente in chiaro** per l'esecuzione e persino **montare segreti cloud** o **aggiungere segreti cloud alle variabili d'ambiente.**
* √à anche possibile **aggiungere connessioni con Cloud SQL** e **montare un file system.**
* Gli **URL** dei servizi distribuiti sono simili a **`https://<svc-name>-<random>.a.run.app`**
* Un servizio Run pu√≤ avere **pi√π di 1 versione o revisione**, e **dividere il traffico** tra diverse revisioni.

### Enumeration
```bash
# List services
gcloud run services list
gcloud run services list --platform=managed
gcloud run services list --platform=gke

# Get info of a service
gcloud run services describe --region <region> <svc-name>

# Get info of all the services together
gcloud run services list --format=yaml
gcloud run services list --platform=managed --format=json
gcloud run services list --platform=gke --format=json

# Get policy
gcloud run services get-iam-policy --region <region> <svc-name>

# Get revisions
gcloud run revisions list --region <region>
gcloud run revisions describe --region <region> <revision>

# Get domains
gcloud run domain-mappings list
gcloud run domain-mappings describe <name>

# Attempt to trigger a job unauthenticated
curl <url>

# Attempt to trigger a job with your current gcloud authorization
curl -H "Authorization: Bearer $(gcloud auth print-identity-token)" <url>
```
## Cloud Run Jobs

I lavori di Cloud Run sono pi√π adatti per **contenitori che vengono eseguiti fino al completamento e non servono richieste**. I lavori non hanno la capacit√† di servire richieste o ascoltare su una porta. Questo significa che, a differenza dei servizi di Cloud Run, i lavori non dovrebbero includere un server web. Invece, i contenitori dei lavori dovrebbero uscire quando hanno finito.

### Enumeration
```bash
gcloud beta run jobs list
gcloud beta run jobs describe --region <region> <job-name>
gcloud beta run jobs get-iam-policy --region <region> <job-name>
```
## Escalation dei privilegi

Nella pagina seguente, puoi controllare come **abuse cloud run permissions to escalate privileges**:

{% content-ref url="../gcp-privilege-escalation/gcp-run-privesc.md" %}
[gcp-run-privesc.md](../gcp-privilege-escalation/gcp-run-privesc.md)
{% endcontent-ref %}

## Accesso non autenticato

{% content-ref url="../gcp-unauthenticated-enum-and-access/gcp-cloud-run-unauthenticated-enum.md" %}
[gcp-cloud-run-unauthenticated-enum.md](../gcp-unauthenticated-enum-and-access/gcp-cloud-run-unauthenticated-enum.md)
{% endcontent-ref %}

## Post sfruttamento

{% content-ref url="../gcp-post-exploitation/gcp-cloud-run-post-exploitation.md" %}
[gcp-cloud-run-post-exploitation.md](../gcp-post-exploitation/gcp-cloud-run-post-exploitation.md)
{% endcontent-ref %}

## Persistenza

{% content-ref url="../gcp-persistence/gcp-cloud-run-persistence.md" %}
[gcp-cloud-run-persistence.md](../gcp-persistence/gcp-cloud-run-persistence.md)
{% endcontent-ref %}

## Riferimenti

* [https://cloud.google.com/run/docs/overview/what-is-cloud-run](https://cloud.google.com/run/docs/overview/what-is-cloud-run)

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Supporta HackTricks</summary>

* Controlla i [**piani di abbonamento**](https://github.com/sponsors/carlospolop)!
* **Unisciti al** üí¨ [**gruppo Discord**](https://discord.gg/hRep4RUj7f) o al [**gruppo telegram**](https://t.me/peass) o **seguici** su **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Condividi trucchi di hacking inviando PR ai** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repos github.

</details>
{% endhint %}
