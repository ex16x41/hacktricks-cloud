# GCP - Cloud Run Enum

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** 💬 [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Cloud Run <a href="#reviewing-cloud-run-configurations" id="reviewing-cloud-run-configurations"></a>

Cloud Run to zarządzana platforma obliczeniowa bezserwerowa, która pozwala na **uruchamianie kontenerów** bezpośrednio na skalowalnej infrastrukturze Google'a.

Możesz uruchomić swój kontener lub, jeśli używasz Go, Node.js, Pythona, Javy, .NET Core lub Rubiego, możesz skorzystać z opcji [wdrożenia opartego na źródle](https://cloud.google.com/run/docs/deploying-source-code), która **buduje kontener za Ciebie.**

Google stworzył Cloud Run, aby **dobrze współpracował z innymi usługami w Google Cloud**, dzięki czemu możesz budować aplikacje z pełną funkcjonalnością.

### Usługi i zadania <a href="#services-and-jobs" id="services-and-jobs"></a>

Na Cloud Run Twój kod może działać ciągle jako _**usługa**_ lub jako _**zadanie**_. Zarówno usługi, jak i zadania działają w tym samym środowisku i mogą korzystać z tych samych integracji z innymi usługami w Google Cloud.

* **Usługi Cloud Run.** Używane do uruchamiania kodu, który odpowiada na żądania sieciowe lub zdarzenia.
* **Zadania Cloud Run.** Używane do uruchamiania kodu, który wykonuje pracę (zadanie) i kończy działanie, gdy praca jest zakończona.

## Usługa Cloud Run

Google [Cloud Run](https://cloud.google.com/run) to kolejna oferta bezserwerowa, w której możesz również wyszukiwać zmienne środowiskowe. Cloud Run tworzy mały serwer WWW, działający domyślnie na porcie 8080 wewnątrz kontenera, który czeka na żądanie HTTP GET. Gdy żądanie zostanie odebrane, wykonywane jest zadanie, a logi zadania są zwracane w odpowiedzi HTTP.

### Istotne szczegóły

* Domyślnie **dostęp** do serwera WWW jest **publiczny**, ale może być również **ograniczony do ruchu wewnętrznego** (VPC...)\
Ponadto **uwierzytelnienie** do kontaktu z serwerem WWW może być **zezwalające na wszystko** lub **wymagać uwierzytelnienia za pomocą IAM**.
* Domyślnie **szyfrowanie** używa **klucza zarządzanego przez Google**, ale można również **wybrać** **CMEK** (Klucz Szyfrowania Zarządzany przez Klienta) z **KMS**.
* Domyślnie używana jest **konto usługi**, które jest **domyślnym kontem Compute Engine**, które ma **dostęp Edytora** do projektu i ma **zakres `cloud-platform`.**
* Możliwe jest zdefiniowanie **zmiennych środowiskowych w postaci czystego tekstu** do wykonania, a nawet **zamontowanie tajemnic w chmurze** lub **dodanie tajemnic w chmurze do zmiennych środowiskowych.**
* Możliwe jest również **dodanie połączeń z Cloud SQL** i **zamontowanie systemu plików.**
* **URL-e** wdrożonych usług są podobne do **`https://<svc-name>-<random>.a.run.app`**
* Usługa Run może mieć **więcej niż 1 wersję lub rewizję**, a **ruch może być dzielony** między kilka rewizji.

### Enumeracja
```bash
# List services
gcloud run services list
gcloud run services list --platform=managed
gcloud run services list --platform=gke

# Get info of a service
gcloud run services describe --region <region> <svc-name>

# Get info of all the services together
gcloud run services list --format=yaml
gcloud run services list --platform=managed --format=json
gcloud run services list --platform=gke --format=json

# Get policy
gcloud run services get-iam-policy --region <region> <svc-name>

# Get revisions
gcloud run revisions list --region <region>
gcloud run revisions describe --region <region> <revision>

# Get domains
gcloud run domain-mappings list
gcloud run domain-mappings describe <name>

# Attempt to trigger a job unauthenticated
curl <url>

# Attempt to trigger a job with your current gcloud authorization
curl -H "Authorization: Bearer $(gcloud auth print-identity-token)" <url>
```
## Cloud Run Jobs

Cloud Run jobs są lepszym rozwiązaniem dla **kontenerów, które kończą działanie i nie obsługują żądań**. Zadania nie mają możliwości obsługi żądań ani nasłuchiwania na porcie. Oznacza to, że w przeciwieństwie do usług Cloud Run, zadania nie powinny zawierać serwera WWW. Zamiast tego kontenery z zadaniami powinny zakończyć działanie, gdy skończą. 

### Enumeration
```bash
gcloud beta run jobs list
gcloud beta run jobs describe --region <region> <job-name>
gcloud beta run jobs get-iam-policy --region <region> <job-name>
```
## Eskalacja Uprawnień

Na następnej stronie możesz sprawdzić, jak **nadużywać uprawnień cloud run, aby eskalować uprawnienia**:

{% content-ref url="../gcp-privilege-escalation/gcp-run-privesc.md" %}
[gcp-run-privesc.md](../gcp-privilege-escalation/gcp-run-privesc.md)
{% endcontent-ref %}

## Dostęp bez uwierzytelnienia

{% content-ref url="../gcp-unauthenticated-enum-and-access/gcp-cloud-run-unauthenticated-enum.md" %}
[gcp-cloud-run-unauthenticated-enum.md](../gcp-unauthenticated-enum-and-access/gcp-cloud-run-unauthenticated-enum.md)
{% endcontent-ref %}

## Po Eksploatacji

{% content-ref url="../gcp-post-exploitation/gcp-cloud-run-post-exploitation.md" %}
[gcp-cloud-run-post-exploitation.md](../gcp-post-exploitation/gcp-cloud-run-post-exploitation.md)
{% endcontent-ref %}

## Utrzymywanie

{% content-ref url="../gcp-persistence/gcp-cloud-run-persistence.md" %}
[gcp-cloud-run-persistence.md](../gcp-persistence/gcp-cloud-run-persistence.md)
{% endcontent-ref %}

## Odniesienia

* [https://cloud.google.com/run/docs/overview/what-is-cloud-run](https://cloud.google.com/run/docs/overview/what-is-cloud-run)

{% hint style="success" %}
Ucz się i ćwicz Hacking AWS:<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Ucz się i ćwicz Hacking GCP: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Wsparcie HackTricks</summary>

* Sprawdź [**plany subskrypcyjne**](https://github.com/sponsors/carlospolop)!
* **Dołącz do** 💬 [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegram**](https://t.me/peass) lub **śledź** nas na **Twitterze** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Dziel się sztuczkami hackingowymi, przesyłając PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repozytoriów github.

</details>
{% endhint %}
