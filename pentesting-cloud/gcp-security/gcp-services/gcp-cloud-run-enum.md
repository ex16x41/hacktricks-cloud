# GCP - Cloud Run Enum

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Cloud Run <a href="#reviewing-cloud-run-configurations" id="reviewing-cloud-run-configurations"></a>

Cloud Run je serverless upravljana platforma za raƒçunanje koja vam omoguƒáava da **pokreƒáete kontejnere** direktno na Google-ovoj skalabilnoj infrastrukturi.

Mo≈æete pokrenuti svoj kontejner ili ako koristite Go, Node.js, Python, Java, .NET Core ili Ruby, mo≈æete koristiti opciju [source-based deployment](https://cloud.google.com/run/docs/deploying-source-code) koja **gradi kontejner za vas.**

Google je izgradio Cloud Run da **dobro funkcioni≈°e zajedno sa drugim uslugama na Google Cloud-u**, tako da mo≈æete graditi aplikacije sa punim funkcionalnostima.

### Services and jobs <a href="#services-and-jobs" id="services-and-jobs"></a>

Na Cloud Run-u, va≈° kod mo≈æe da se izvr≈°ava kontinuirano kao _**usluga**_ ili kao _**posao**_. I usluge i poslovi se izvr≈°avaju u istom okru≈æenju i mogu koristiti iste integracije sa drugim uslugama na Google Cloud-u.

* **Cloud Run usluge.** Koriste se za izvr≈°avanje koda koji odgovara na web zahteve ili dogaƒëaje.
* **Cloud Run poslovi.** Koriste se za izvr≈°avanje koda koji obavlja posao (posao) i zavr≈°ava kada je posao gotov.

## Cloud Run Service

Google [Cloud Run](https://cloud.google.com/run) je jo≈° jedna serverless ponuda gde mo≈æete pretra≈æivati env varijable takoƒëe. Cloud Run kreira mali web server, koji po default-u radi na portu 8080 unutar kontejnera, koji ƒçeka na HTTP GET zahtev. Kada se zahtev primi, izvr≈°ava se posao i log posla se izlazi putem HTTP odgovora.

### Relevant details

* Po **default-u**, **pristup** web serveru je **javan**, ali mo≈æe biti i **ograniƒçen na internu mre≈æu** (VPC...)\
Pored toga, **autentifikacija** za kontaktiranje web servera mo≈æe biti **dozvoljena svima** ili **zahtevati autentifikaciju putem IAM**.
* Po default-u, **enkripcija** koristi **Google upravljani kljuƒç**, ali se mo≈æe izabrati i **CMEK** (Customer Managed Encryption Key) iz **KMS**.
* Po **default-u**, **servisni nalog** koji se koristi je **podrazumevani Compute Engine** koji ima **Editor** pristup projektu i ima **opseg `cloud-platform`.**
* Moguƒáe je definisati **varijable okru≈æenja u ƒçistom tekstu** za izvr≈°avanje, i ƒçak **montirati cloud tajne** ili **dodati cloud tajne u varijable okru≈æenja.**
* Takoƒëe je moguƒáe **dodati konekcije sa Cloud SQL** i **montirati fajl sistem.**
* **URL-ovi** usluga koje su implementirane su sliƒçni **`https://<svc-name>-<random>.a.run.app`**
* Run Service mo≈æe imati **vi≈°e od 1 verzije ili revizije**, i **podeliti saobraƒáaj** meƒëu nekoliko revizija.

### Enumeration
```bash
# List services
gcloud run services list
gcloud run services list --platform=managed
gcloud run services list --platform=gke

# Get info of a service
gcloud run services describe --region <region> <svc-name>

# Get info of all the services together
gcloud run services list --format=yaml
gcloud run services list --platform=managed --format=json
gcloud run services list --platform=gke --format=json

# Get policy
gcloud run services get-iam-policy --region <region> <svc-name>

# Get revisions
gcloud run revisions list --region <region>
gcloud run revisions describe --region <region> <revision>

# Get domains
gcloud run domain-mappings list
gcloud run domain-mappings describe <name>

# Attempt to trigger a job unauthenticated
curl <url>

# Attempt to trigger a job with your current gcloud authorization
curl -H "Authorization: Bearer $(gcloud auth print-identity-token)" <url>
```
## Cloud Run Jobs

Cloud Run poslovi su bolji izbor za **kontejnere koji se izvr≈°avaju do kraja i ne obraƒëuju zahteve**. Poslovi nemaju moguƒánost da obraƒëuju zahteve ili slu≈°aju na portu. To znaƒçi da, za razliku od Cloud Run usluga, poslovi ne bi trebali da ukljuƒçuju veb server. Umesto toga, kontejneri poslova bi trebali da se zatvore kada zavr≈°e. 

### Enumeration
```bash
gcloud beta run jobs list
gcloud beta run jobs describe --region <region> <job-name>
gcloud beta run jobs get-iam-policy --region <region> <job-name>
```
## Eskalacija privilegija

Na sledeƒáoj stranici mo≈æete proveriti kako da **zloupotrebite cloud run dozvole za eskalaciju privilegija**:

{% content-ref url="../gcp-privilege-escalation/gcp-run-privesc.md" %}
[gcp-run-privesc.md](../gcp-privilege-escalation/gcp-run-privesc.md)
{% endcontent-ref %}

## Neautentifikovani pristup

{% content-ref url="../gcp-unauthenticated-enum-and-access/gcp-cloud-run-unauthenticated-enum.md" %}
[gcp-cloud-run-unauthenticated-enum.md](../gcp-unauthenticated-enum-and-access/gcp-cloud-run-unauthenticated-enum.md)
{% endcontent-ref %}

## Post eksploatacija

{% content-ref url="../gcp-post-exploitation/gcp-cloud-run-post-exploitation.md" %}
[gcp-cloud-run-post-exploitation.md](../gcp-post-exploitation/gcp-cloud-run-post-exploitation.md)
{% endcontent-ref %}

## Persistencija

{% content-ref url="../gcp-persistence/gcp-cloud-run-persistence.md" %}
[gcp-cloud-run-persistence.md](../gcp-persistence/gcp-cloud-run-persistence.md)
{% endcontent-ref %}

## Reference

* [https://cloud.google.com/run/docs/overview/what-is-cloud-run](https://cloud.google.com/run/docs/overview/what-is-cloud-run)

{% hint style="success" %}
Uƒçite i ve≈æbajte AWS Hacking:<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Uƒçite i ve≈æbajte GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Podr≈æite HackTricks</summary>

* Proverite [**planove pretplate**](https://github.com/sponsors/carlospolop)!
* **Pridru≈æite se** üí¨ [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili **pratite** nas na **Twitteru** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podelite hakerske trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
{% endhint %}
