# GCP - Cloud Run Enum

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the**  [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter**  [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Cloud Run <a href="#reviewing-cloud-run-configurations" id="reviewing-cloud-run-configurations"></a>

Cloud Run to zarzdzana platforma obliczeniowa bezserwerowa, kt贸ra pozwala na **uruchamianie kontener贸w** bezporednio na skalowalnej infrastrukturze Google'a.

Mo偶esz uruchomi sw贸j kontener lub, jeli u偶ywasz Go, Node.js, Pythona, Javy, .NET Core lub Rubiego, mo偶esz skorzysta z opcji [wdro偶enia opartego na 藕r贸dle](https://cloud.google.com/run/docs/deploying-source-code), kt贸ra **buduje kontener za Ciebie.**

Google stworzy Cloud Run, aby **dobrze wsp贸pracowa z innymi usugami w Google Cloud**, dziki czemu mo偶esz budowa aplikacje z pen funkcjonalnoci.

### Usugi i zadania <a href="#services-and-jobs" id="services-and-jobs"></a>

Na Cloud Run Tw贸j kod mo偶e dziaa cigle jako _**usuga**_ lub jako _**zadanie**_. Zar贸wno usugi, jak i zadania dziaaj w tym samym rodowisku i mog korzysta z tych samych integracji z innymi usugami w Google Cloud.

* **Usugi Cloud Run.** U偶ywane do uruchamiania kodu, kt贸ry odpowiada na 偶dania sieciowe lub zdarzenia.
* **Zadania Cloud Run.** U偶ywane do uruchamiania kodu, kt贸ry wykonuje prac (zadanie) i koczy dziaanie, gdy praca jest zakoczona.

## Usuga Cloud Run

Google [Cloud Run](https://cloud.google.com/run) to kolejna oferta bezserwerowa, w kt贸rej mo偶esz r贸wnie偶 wyszukiwa zmienne rodowiskowe. Cloud Run tworzy may serwer WWW, dziaajcy domylnie na porcie 8080 wewntrz kontenera, kt贸ry czeka na 偶danie HTTP GET. Gdy 偶danie zostanie odebrane, wykonywane jest zadanie, a logi zadania s zwracane w odpowiedzi HTTP.

### Istotne szczeg贸y

* Domylnie **dostp** do serwera WWW jest **publiczny**, ale mo偶e by r贸wnie偶 **ograniczony do ruchu wewntrznego** (VPC...)\
Ponadto **uwierzytelnienie** do kontaktu z serwerem WWW mo偶e by **zezwalajce na wszystko** lub **wymaga uwierzytelnienia za pomoc IAM**.
* Domylnie **szyfrowanie** u偶ywa **klucza zarzdzanego przez Google**, ale mo偶na r贸wnie偶 **wybra** **CMEK** (Klucz Szyfrowania Zarzdzany przez Klienta) z **KMS**.
* Domylnie u偶ywana jest **konto usugi**, kt贸re jest **domylnym kontem Compute Engine**, kt贸re ma **dostp Edytora** do projektu i ma **zakres `cloud-platform`.**
* Mo偶liwe jest zdefiniowanie **zmiennych rodowiskowych w postaci czystego tekstu** do wykonania, a nawet **zamontowanie tajemnic w chmurze** lub **dodanie tajemnic w chmurze do zmiennych rodowiskowych.**
* Mo偶liwe jest r贸wnie偶 **dodanie pocze z Cloud SQL** i **zamontowanie systemu plik贸w.**
* **URL-e** wdro偶onych usug s podobne do **`https://<svc-name>-<random>.a.run.app`**
* Usuga Run mo偶e mie **wicej ni偶 1 wersj lub rewizj**, a **ruch mo偶e by dzielony** midzy kilka rewizji.

### Enumeracja
```bash
# List services
gcloud run services list
gcloud run services list --platform=managed
gcloud run services list --platform=gke

# Get info of a service
gcloud run services describe --region <region> <svc-name>

# Get info of all the services together
gcloud run services list --format=yaml
gcloud run services list --platform=managed --format=json
gcloud run services list --platform=gke --format=json

# Get policy
gcloud run services get-iam-policy --region <region> <svc-name>

# Get revisions
gcloud run revisions list --region <region>
gcloud run revisions describe --region <region> <revision>

# Get domains
gcloud run domain-mappings list
gcloud run domain-mappings describe <name>

# Attempt to trigger a job unauthenticated
curl <url>

# Attempt to trigger a job with your current gcloud authorization
curl -H "Authorization: Bearer $(gcloud auth print-identity-token)" <url>
```
## Cloud Run Jobs

Cloud Run jobs s lepszym rozwizaniem dla **kontener贸w, kt贸re kocz dziaanie i nie obsuguj 偶da**. Zadania nie maj mo偶liwoci obsugi 偶da ani nasuchiwania na porcie. Oznacza to, 偶e w przeciwiestwie do usug Cloud Run, zadania nie powinny zawiera serwera WWW. Zamiast tego kontenery z zadaniami powinny zakoczy dziaanie, gdy skocz. 

### Enumeration
```bash
gcloud beta run jobs list
gcloud beta run jobs describe --region <region> <job-name>
gcloud beta run jobs get-iam-policy --region <region> <job-name>
```
## Eskalacja Uprawnie

Na nastpnej stronie mo偶esz sprawdzi, jak **nadu偶ywa uprawnie cloud run, aby eskalowa uprawnienia**:

{% content-ref url="../gcp-privilege-escalation/gcp-run-privesc.md" %}
[gcp-run-privesc.md](../gcp-privilege-escalation/gcp-run-privesc.md)
{% endcontent-ref %}

## Dostp bez uwierzytelnienia

{% content-ref url="../gcp-unauthenticated-enum-and-access/gcp-cloud-run-unauthenticated-enum.md" %}
[gcp-cloud-run-unauthenticated-enum.md](../gcp-unauthenticated-enum-and-access/gcp-cloud-run-unauthenticated-enum.md)
{% endcontent-ref %}

## Po Eksploatacji

{% content-ref url="../gcp-post-exploitation/gcp-cloud-run-post-exploitation.md" %}
[gcp-cloud-run-post-exploitation.md](../gcp-post-exploitation/gcp-cloud-run-post-exploitation.md)
{% endcontent-ref %}

## Utrzymywanie

{% content-ref url="../gcp-persistence/gcp-cloud-run-persistence.md" %}
[gcp-cloud-run-persistence.md](../gcp-persistence/gcp-cloud-run-persistence.md)
{% endcontent-ref %}

## Odniesienia

* [https://cloud.google.com/run/docs/overview/what-is-cloud-run](https://cloud.google.com/run/docs/overview/what-is-cloud-run)

{% hint style="success" %}
Ucz si i wicz Hacking AWS:<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Ucz si i wicz Hacking GCP: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Wsparcie HackTricks</summary>

* Sprawd藕 [**plany subskrypcyjne**](https://github.com/sponsors/carlospolop)!
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegram**](https://t.me/peass) lub **led藕** nas na **Twitterze**  [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Dziel si sztuczkami hackingowymi, przesyajc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repozytori贸w github.

</details>
{% endhint %}
