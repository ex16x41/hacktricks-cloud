# GCP - Storage Enum

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Storage

Google Cloud Platform (GCP) Storage, **yapÄ±landÄ±rÄ±lmamÄ±ÅŸ veriler iÃ§in yÃ¼ksek dayanÄ±klÄ±lÄ±k ve eriÅŸilebilirlik saÄŸlayan bulut tabanlÄ± bir depolama Ã§Ã¶zÃ¼mÃ¼dÃ¼r**. Performansa, eriÅŸilebilirliÄŸe ve maliyete dayalÄ± olarak **Standart, Nearline, Coldline ve ArÅŸiv** dahil olmak Ã¼zere **Ã§eÅŸitli depolama sÄ±nÄ±flarÄ±** sunar. GCP Storage ayrÄ±ca verileri etkili bir ÅŸekilde yÃ¶netmek ve gÃ¼vence altÄ±na almak iÃ§in **yaÅŸam dÃ¶ngÃ¼sÃ¼ politikalarÄ±, sÃ¼rÃ¼mleme ve eriÅŸim kontrolÃ¼** gibi geliÅŸmiÅŸ Ã¶zellikler saÄŸlar.

Kova bir bÃ¶lgede, 2 bÃ¶lgede veya **Ã§ok bÃ¶lgeli (varsayÄ±lan)** olarak depolanabilir.

### Storage Types

* **Standart Depolama**: Bu, **sÄ±k eriÅŸilen verilere yÃ¼ksek performans, dÃ¼ÅŸÃ¼k gecikme sÃ¼resi ile eriÅŸim sunan varsayÄ±lan depolama seÃ§eneÄŸidir**. Web sitesi iÃ§eriÄŸi sunma, medya akÄ±ÅŸÄ± ve veri analitiÄŸi boru hatlarÄ± barÄ±ndÄ±rma gibi geniÅŸ bir kullanÄ±m yelpazesi iÃ§in uygundur.
* **Nearline Depolama**: Bu depolama sÄ±nÄ±fÄ±, **Standart Depolama'dan daha dÃ¼ÅŸÃ¼k depolama maliyetleri** ve **biraz daha yÃ¼ksek eriÅŸim maliyetleri** sunar. SÄ±k eriÅŸilmeyen veriler iÃ§in optimize edilmiÅŸtir ve minimum depolama sÃ¼resi 30 gÃ¼ndÃ¼r. Yedekleme ve arÅŸivleme amaÃ§larÄ± iÃ§in idealdir.
* **Coldline Depolama**: Bu depolama sÄ±nÄ±fÄ±, **sÄ±k eriÅŸilmeyen verilerin uzun vadeli depolamasÄ± iÃ§in optimize edilmiÅŸtir**, minimum depolama sÃ¼resi 90 gÃ¼ndÃ¼r. Nearline Depolama'dan **daha dÃ¼ÅŸÃ¼k depolama maliyetleri** sunar, ancak **daha yÃ¼ksek eriÅŸim maliyetleri** vardÄ±r.
* **ArÅŸiv Depolama**: Bu depolama sÄ±nÄ±fÄ±, **Ã§ok nadir eriÅŸilen soÄŸuk veriler** iÃ§in tasarlanmÄ±ÅŸtÄ±r ve minimum depolama sÃ¼resi 365 gÃ¼ndÃ¼r. TÃ¼m GCP depolama seÃ§eneklerinin **en dÃ¼ÅŸÃ¼k depolama maliyetlerini** sunar, ancak **en yÃ¼ksek eriÅŸim maliyetleri** vardÄ±r. Uyumluluk veya dÃ¼zenleyici nedenlerle saklanmasÄ± gereken verilerin uzun vadeli korunumu iÃ§in uygundur.
* **Autoclass**: EÄŸer **verilere ne kadar eriÅŸeceÄŸinizi bilmiyorsanÄ±z**, Autoclass'Ä± seÃ§ebilir ve GCP, **maliyetleri en aza indirmek iÃ§in depolama tÃ¼rÃ¼nÃ¼ otomatik olarak deÄŸiÅŸtirecektir**.

### Access Control

**VarsayÄ±lan olarak**, eriÅŸimi **IAM** Ã¼zerinden kontrol etmeniz **Ã¶nerilir**, ancak **ACL'lerin kullanÄ±mÄ±nÄ± etkinleÅŸtirmek** de mÃ¼mkÃ¼ndÃ¼r.\
Sadece IAM kullanmayÄ± seÃ§erseniz (varsayÄ±lan) ve **90 gÃ¼n geÃ§erse**, kova iÃ§in **ACL'leri etkinleÅŸtiremeyeceksiniz**.

### Versioning

SÃ¼rÃ¼mlemeyi etkinleÅŸtirmek mÃ¼mkÃ¼ndÃ¼r, bu **kovanÄ±n iÃ§indeki dosyanÄ±n eski sÃ¼rÃ¼mlerini kaydedecektir**. **Tutmak istediÄŸiniz sÃ¼rÃ¼m sayÄ±sÄ±nÄ±** ve hatta **eski sÃ¼rÃ¼mlerin (geÃ§ersiz sÃ¼rÃ¼mler) ne kadar sÃ¼reyle** saklanmasÄ±nÄ± istediÄŸinizi yapÄ±landÄ±rmak mÃ¼mkÃ¼ndÃ¼r. **Standart tÃ¼r iÃ§in 7 gÃ¼n** Ã¶nerilmektedir.

**GeÃ§ersiz bir sÃ¼rÃ¼mÃ¼n meta verileri saklanÄ±r**. AyrÄ±ca, **geÃ§ersiz sÃ¼rÃ¼mlerin ACL'leri de saklanÄ±r**, bu nedenle eski sÃ¼rÃ¼mlerin mevcut sÃ¼rÃ¼mden farklÄ± ACL'leri olabilir.

Daha fazla bilgi iÃ§in [**belgelere**](https://cloud.google.com/storage/docs/object-versioning) bakÄ±n.

### Retention Policy

Kovadaki nesnelerin silinmesini **ne kadar sÃ¼reyle** yasaklamak istediÄŸinizi belirtin (en azÄ±ndan uyumluluk iÃ§in Ã§ok faydalÄ±dÄ±r).\
**Sadece bir sÃ¼rÃ¼mleme veya saklama politikasÄ± aynÄ± anda etkinleÅŸtirilebilir**.

### Encryption

VarsayÄ±lan olarak nesneler, **Google yÃ¶netimli anahtarlar kullanÄ±larak ÅŸifrelenir**, ancak **KMS'den bir anahtar** da kullanabilirsiniz.

### Public Access

**DÄ±ÅŸ kullanÄ±cÄ±lara** (GCP'ye giriÅŸ yapmÄ±ÅŸ olsun ya da olmasÄ±n) **kovalarÄ±n iÃ§eriÄŸine eriÅŸim verme** mÃ¼mkÃ¼ndÃ¼r.\
VarsayÄ±lan olarak, bir kova oluÅŸturulduÄŸunda, kovanÄ±n **kamusal olarak aÃ§Ä±lma seÃ§eneÄŸi devre dÄ±ÅŸÄ± bÄ±rakÄ±lmÄ±ÅŸtÄ±r**, ancak yeterli izinlerle bu deÄŸiÅŸtirilebilir.

Bir kovaya eriÅŸim iÃ§in **URL formatÄ±** **`https://storage.googleapis.com/<bucket-name>` veya `https://<bucket_name>.storage.googleapis.com`** ÅŸeklindedir (her ikisi de geÃ§erlidir).

### HMAC Keys

HMAC anahtarÄ±, bir tÃ¼r _kimlik bilgisi_ olup, **Cloud Storage'da bir hizmet hesabÄ± veya kullanÄ±cÄ± hesabÄ± ile iliÅŸkilendirilebilir**. HMAC anahtarÄ±nÄ±, Cloud Storage'a yapÄ±lan isteklerde yer alan _imzalar_ oluÅŸturmak iÃ§in kullanÄ±rsÄ±nÄ±z. Ä°mzalar, **belirli bir isteÄŸin kullanÄ±cÄ± veya hizmet hesabÄ± tarafÄ±ndan yetkilendirildiÄŸini** gÃ¶sterir.

HMAC anahtarlarÄ±nÄ±n iki ana bileÅŸeni vardÄ±r: bir _eriÅŸim kimliÄŸi_ ve bir _gizli anahtar_.

*   **EriÅŸim KimliÄŸi**: Belirli bir hizmet veya kullanÄ±cÄ± hesabÄ±na baÄŸlÄ± alfanÃ¼merik bir dizedir. Bir hizmet hesabÄ±na baÄŸlÄ± olduÄŸunda, dize 61 karakter uzunluÄŸundadÄ±r ve bir kullanÄ±cÄ± hesabÄ±na baÄŸlÄ± olduÄŸunda, dize 24 karakter uzunluÄŸundadÄ±r. AÅŸaÄŸÄ±da bir eriÅŸim kimliÄŸi Ã¶rneÄŸi gÃ¶sterilmektedir:

`GOOGTS7C7FUP3AIRVJTE2BCDKINBTES3HC2GY5CBFJDCQ2SYHV6A6XXVTJFSA`
*   **Gizli Anahtar**: Belirli bir eriÅŸim kimliÄŸine baÄŸlÄ± 40 karakterlik Base-64 kodlu bir dizedir. Gizli anahtar, yalnÄ±zca sizin ve Cloud Storage'Ä±n bildiÄŸi Ã¶nceden paylaÅŸÄ±lmÄ±ÅŸ bir anahtardÄ±r. Ä°mza oluÅŸturmak iÃ§in gizli anahtarÄ±nÄ±zÄ± kimlik doÄŸrulama sÃ¼recinin bir parÃ§asÄ± olarak kullanÄ±rsÄ±nÄ±z. AÅŸaÄŸÄ±da bir gizli anahtar Ã¶rneÄŸi gÃ¶sterilmektedir:

`bGoa+V7g/yqDXvKRqq+JTFn4uQZbPiQJo4pf9RzJ`

Hem **eriÅŸim kimliÄŸi hem de gizli anahtar, bir HMAC anahtarÄ±nÄ± benzersiz olarak tanÄ±mlar**, ancak gizli anahtar Ã§ok daha hassas bir bilgidir, Ã§Ã¼nkÃ¼ **imzalar oluÅŸturmak iÃ§in kullanÄ±lÄ±r**.

### Enumeration
```bash
# List all storage buckets in project
gsutil ls

# Get each bucket configuration (protections, CLs, times, configs...)
gsutil ls -L

# List contents of a specific bucket
gsutil ls gs://bucket-name/
gsutil ls -r gs://bucket-name/ # Recursive
gsutil ls -a gs://bucket-name/ # Get ALL versions of objects

# Cat the context of a file without copying it locally
gsutil cat 'gs://bucket-name/folder/object'
gsutil cat 'gs://bucket-name/folder/object#<num>' # cat specific version

# Copy an object from the bucket to your local storage for review
gsutil cp gs://bucket-name/folder/object ~/

# List using a raw OAuth token
## Useful because "CLOUDSDK_AUTH_ACCESS_TOKEN" and "gcloud config set auth/access_token_file" doesn't work with gsutil
curl -H "Authorization: Bearer $TOKEN" "https://storage.googleapis.com/storage/v1/b/<storage-name>/o"
# Download file content from bucket
curl -H "Authorization: Bearer $TOKEN" "https://storage.googleapis.com/storage/v1/b/supportstorage-58249/o/flag.txt?alt=media" --output -

# Enumerate HMAC keys
gsutil hmac list

# Get permissions
gcloud storage buckets get-iam-policy gs://bucket-name/
gcloud storage objects get-iam-policy gs://bucket-name/folder/object
```
EÄŸer bucket'larÄ± listelemekte izin reddedildi hatasÄ± alÄ±yorsanÄ±z, yine de iÃ§eriÄŸe eriÅŸiminiz olabilir. Åimdi bucket'larÄ±n isimlendirme kuralÄ±nÄ± bildiÄŸinize gÃ¶re, olasÄ± isimlerin bir listesini oluÅŸturabilir ve onlara eriÅŸmeyi deneyebilirsiniz:
```bash
for i in $(cat wordlist.txt); do gsutil ls -r gs://"$i"; done
```
`storage.objects.list` ve `storage.objects.get` izinleriyle, bunlarÄ± indirmek iÃ§in kovadan tÃ¼m klasÃ¶rleri ve dosyalarÄ± listeleyebilmelisiniz. Bunu bu Python betiÄŸiyle gerÃ§ekleÅŸtirebilirsiniz:
```python
import requests
import xml.etree.ElementTree as ET

def list_bucket_objects(bucket_name, prefix='', marker=None):
url = f"https://storage.googleapis.com/{bucket_name}?prefix={prefix}"
if marker:
url += f"&marker={marker}"
response = requests.get(url)
xml_data = response.content
root = ET.fromstring(xml_data)
ns = {'ns': 'http://doc.s3.amazonaws.com/2006-03-01'}
for contents in root.findall('.//ns:Contents', namespaces=ns):
key = contents.find('ns:Key', namespaces=ns).text
print(key)
next_marker = root.find('ns:NextMarker', namespaces=ns)
if next_marker is not None:
next_marker_value = next_marker.text
list_bucket_objects(bucket_name, prefix, next_marker_value)

list_bucket_objects('<storage-name>')
```
### Yetki YÃ¼kseltme

AÅŸaÄŸÄ±daki sayfada **depolama izinlerini kÃ¶tÃ¼ye kullanarak yetki yÃ¼kseltme** yÃ¶ntemlerini kontrol edebilirsiniz:

{% content-ref url="../gcp-privilege-escalation/gcp-storage-privesc.md" %}
[gcp-storage-privesc.md](../gcp-privilege-escalation/gcp-storage-privesc.md)
{% endcontent-ref %}

### Kimlik DoÄŸrulamasÄ± Olmadan Enum

{% content-ref url="../gcp-unauthenticated-enum-and-access/gcp-storage-unauthenticated-enum/" %}
[gcp-storage-unauthenticated-enum](../gcp-unauthenticated-enum-and-access/gcp-storage-unauthenticated-enum/)
{% endcontent-ref %}

### SÃ¶mÃ¼rÃ¼ SonrasÄ±

{% content-ref url="../gcp-post-exploitation/gcp-storage-post-exploitation.md" %}
[gcp-storage-post-exploitation.md](../gcp-post-exploitation/gcp-storage-post-exploitation.md)
{% endcontent-ref %}

### SÃ¼reklilik

{% content-ref url="../gcp-persistence/gcp-storage-persistence.md" %}
[gcp-storage-persistence.md](../gcp-persistence/gcp-storage-persistence.md)
{% endcontent-ref %}

{% hint style="success" %}
AWS Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n:<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
GCP Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**abonelik planlarÄ±nÄ±**](https://github.com/sponsors/carlospolop) kontrol edin!
* **ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n ya da **Twitter'da** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**'i takip edin.**
* **Hacking ipuÃ§larÄ±nÄ± paylaÅŸmak iÃ§in** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna PR gÃ¶nderin.

</details>
{% endhint %}
