# GCP - Depolama SÄ±ralamasÄ±

{% hint style="success" %}
AWS Hacking Ã¶ÄŸrenin ve uygulayÄ±n:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks EÄŸitim AWS KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ± (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCP Hacking Ã¶ÄŸrenin ve uygulayÄ±n: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks EÄŸitim GCP KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ± (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**Abonelik planlarÄ±nÄ±**](https://github.com/sponsors/carlospolop) kontrol edin!
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) katÄ±lÄ±n veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n veya bizi **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** takip edin.**
* **Hacking pÃ¼f noktalarÄ±nÄ± paylaÅŸarak PR'ler gÃ¶ndererek** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na katkÄ±da bulunun.

</details>
{% endhint %}

## Depolama

Google Cloud Platform (GCP) Depolama, yapÄ±landÄ±rÄ±lmamÄ±ÅŸ veriler iÃ§in **yÃ¼ksek dayanÄ±klÄ±lÄ±k ve kullanÄ±labilirlik saÄŸlayan bulut tabanlÄ± bir depolama Ã§Ã¶zÃ¼mÃ¼dÃ¼r**. Performansa, kullanÄ±labilirliÄŸe ve maliyeye dayalÄ± Ã§eÅŸitli depolama sÄ±nÄ±flarÄ± sunar, bunlar arasÄ±nda Standart, Nearline, Coldline ve ArÅŸiv bulunmaktadÄ±r. GCP Depolama ayrÄ±ca **yaÅŸam dÃ¶ngÃ¼sÃ¼ politikalarÄ±, sÃ¼rÃ¼mleme ve eriÅŸim kontrolÃ¼** gibi geliÅŸmiÅŸ Ã¶zellikler sunarak verileri etkili bir ÅŸekilde yÃ¶netmeyi ve gÃ¼vence altÄ±na almayÄ± saÄŸlar.

Kova bir bÃ¶lgede, 2 bÃ¶lgede veya **Ã§oklu bÃ¶lgede (varsayÄ±lan olarak)** depolanabilir.

### Depolama TÃ¼rleri

* **Standart Depolama**: Bu, sÄ±k eriÅŸilen verilere **yÃ¼ksek performanslÄ±, dÃ¼ÅŸÃ¼k gecikmeli eriÅŸim** sunan varsayÄ±lan depolama seÃ§eneÄŸidir. Web sitesi iÃ§eriÄŸi sunma, medya akÄ±ÅŸÄ± ve veri analitiÄŸi boru hatlarÄ±nÄ± barÄ±ndÄ±rma gibi geniÅŸ bir kullanÄ±m alanÄ± iÃ§in uygundur.
* **Nearline Depolama**: Bu depolama sÄ±nÄ±fÄ±, Standart Depolamadan **daha dÃ¼ÅŸÃ¼k depolama maliyetleri** ve **biraz daha yÃ¼ksek eriÅŸim maliyetleri** sunar. En az 30 gÃ¼n depolama sÃ¼resi olan nadiren eriÅŸilen veriler iÃ§in optimize edilmiÅŸtir. Yedekleme ve arÅŸivleme amaÃ§larÄ± iÃ§in idealdir.
* **Coldline Depolama**: Bu depolama sÄ±nÄ±fÄ±, **nadir eriÅŸilen verilerin uzun vadeli depolanmasÄ±** iÃ§in optimize edilmiÅŸtir ve en az 90 gÃ¼n depolama sÃ¼resine sahiptir. Nearline Depolamadan daha **dÃ¼ÅŸÃ¼k depolama maliyetleri** sunar, ancak **daha yÃ¼ksek eriÅŸim maliyetleriyle**.
* **ArÅŸiv Depolama**: Bu depolama sÄ±nÄ±fÄ±, **Ã§ok nadiren eriÅŸilen soÄŸuk veriler** iÃ§in tasarlanmÄ±ÅŸ olup en az 365 gÃ¼n depolama sÃ¼resine sahiptir. TÃ¼m GCP depolama seÃ§eneklerinin **en dÃ¼ÅŸÃ¼k depolama maliyetlerini** sunar, ancak **en yÃ¼ksek eriÅŸim maliyetleriyle**. Uygunluk veya dÃ¼zenleyici gereksinimler nedeniyle saklanmasÄ± gereken verilerin uzun vadeli saklanmasÄ± iÃ§in uygundur.
* **Otomatik SÄ±nÄ±f**: Verilere **ne kadar eriÅŸeceÄŸinizi bilmiyorsanÄ±z** Otomatik SÄ±nÄ±fÄ± seÃ§ebilir ve GCP, maliyetleri en aza indirmek iÃ§in **otomatik olarak depolama tÃ¼rÃ¼nÃ¼ deÄŸiÅŸtirir**.

### EriÅŸim KontrolÃ¼

**VarsayÄ±lan olarak** eriÅŸimi **IAM** aracÄ±lÄ±ÄŸÄ±yla kontrol etmek **tavsiye edilir**, ancak **ACL'lerin kullanÄ±mÄ±nÄ± etkinleÅŸtirmek de mÃ¼mkÃ¼ndÃ¼r**.\
Sadece IAM'Ä± (varsayÄ±lan) kullanmayÄ± seÃ§erseniz ve **90 gÃ¼n geÃ§erse**, kovaya **ACL'leri etkinleÅŸtiremezsiniz**.

### SÃ¼rÃ¼mleme

SÃ¼rÃ¼mleme etkinleÅŸtirilebilir, bu durumda dosyanÄ±n iÃ§indeki **eski sÃ¼rÃ¼mler kaydedilir**. **Saklamak istediÄŸiniz sÃ¼rÃ¼m sayÄ±sÄ±nÄ±** ve hatta **eski sÃ¼rÃ¼mlerin (eski sÃ¼rÃ¼mler) ne kadar sÃ¼reyle yaÅŸamasÄ±nÄ± istediÄŸinizi** yapÄ±landÄ±rabilirsiniz. Ã–nerilen, **Standart tÃ¼r iÃ§in 7 gÃ¼n**'dÃ¼r.

**Eski sÃ¼rÃ¼mÃ¼n metadatasÄ± saklanÄ±r**. DahasÄ±, **eski sÃ¼rÃ¼mlerin ACL'leri de saklanÄ±r**, bu nedenle eski sÃ¼rÃ¼mler mevcut sÃ¼rÃ¼mden farklÄ± ACL'lere sahip olabilir.

Daha fazla bilgi iÃ§in [**belgelere**](https://cloud.google.com/storage/docs/object-versioning) bakÄ±n.

### Saklama PolitikasÄ±

Kovadaki Nesnelerin **silinmesini yasaklamak istediÄŸiniz sÃ¼reyi** belirtin (en azÄ±ndan uyumluluk iÃ§in Ã§ok yararlÄ±).\
**SÃ¼rÃ¼mleme veya saklama politikasÄ±ndan yalnÄ±zca biri aynÄ± anda etkinleÅŸtirilebilir**.

### Åifreleme

VarsayÄ±lan olarak nesneler **Google tarafÄ±ndan yÃ¶netilen anahtarlar kullanÄ±larak ÅŸifrelenir**, ancak ayrÄ±ca bir **KMS anahtarÄ±** da kullanabilirsiniz.

### Genel EriÅŸim

**Harici kullanÄ±cÄ±lara** (GCP'de oturum aÃ§mÄ±ÅŸ veya aÃ§mamÄ±ÅŸ) **kova iÃ§eriÄŸine eriÅŸim vermek mÃ¼mkÃ¼ndÃ¼r**.\
Bir kova oluÅŸturulduÄŸunda, kovanÄ±n **genel olarak aÃ§Ä±ÄŸa Ã§Ä±karÄ±lmasÄ±nÄ± devre dÄ±ÅŸÄ± bÄ±rakma seÃ§eneÄŸi varsayÄ±lan olarak devre dÄ±ÅŸÄ± bÄ±rakÄ±lÄ±r, ancak yeterli izinlerle deÄŸiÅŸtirilebilir.

Bir kovaya eriÅŸmek iÃ§in bir URL'nin **biÃ§imi** ÅŸudur: **`https://storage.googleapis.com/<kova-adÄ±>` veya `https://<kova_adÄ±>.storage.googleapis.com`** (her ikisi de geÃ§erlidir).

### HMAC AnahtarlarÄ±

HMAC anahtarÄ± bir tÃ¼r _kimlik bilgisi_ ve **Cloud Depolama'da bir hizmet hesabÄ± veya kullanÄ±cÄ± hesabÄ± ile iliÅŸkilendirilebilir**. Bir HMAC anahtarÄ± oluÅŸturmak iÃ§in HMAC anahtarÄ±nÄ± kullanÄ±rsÄ±nÄ±z ve bu, Cloud Depolama'ya yapÄ±lan isteklere dahil edilen _imzalarÄ±_ oluÅŸturur. Ä°mzalar, **belirli bir isteÄŸin kullanÄ±cÄ± veya hizmet hesabÄ± tarafÄ±ndan yetkilendirildiÄŸini gÃ¶sterir**.

HMAC anahtarlarÄ±nÄ±n iki temel parÃ§asÄ± vardÄ±r, bir _eriÅŸim kimliÄŸi_ ve bir _gizli_.

*   **EriÅŸim KimliÄŸi**: Belirli bir hizmet veya kullanÄ±cÄ± hesabÄ±na baÄŸlÄ± alfasayÄ±sal bir dizedir. Bir hizmet hesabÄ±na baÄŸlandÄ±ÄŸÄ±nda, dize 61 karakter uzunluÄŸundadÄ±r ve bir kullanÄ±cÄ± hesabÄ±na baÄŸlandÄ±ÄŸÄ±nda, dize 24 karakter uzunluÄŸundadÄ±r. AÅŸaÄŸÄ±daki, bir eriÅŸim kimliÄŸinin bir Ã¶rneÄŸini gÃ¶stermektedir:

`GOOGTS7C7FUP3AIRVJTE2BCDKINBTES3HC2GY5CBFJDCQ2SYHV6A6XXVTJFSA`
*   **Gizli**: Belirli bir eriÅŸim kimliÄŸine baÄŸlÄ± olan 40 karakterlik Base-64 kodlanmÄ±ÅŸ bir dizedir. Gizli, yalnÄ±zca sizin ve Cloud Depolama'nÄ±n bildiÄŸi bir Ã¶nceden paylaÅŸÄ±lmÄ±ÅŸ anahtardÄ±r. Kimlik doÄŸrulama sÃ¼recinin bir parÃ§asÄ± olarak imzalar oluÅŸturmak iÃ§in gizlinizi kullanÄ±rsÄ±nÄ±z. AÅŸaÄŸÄ±daki, bir gizli Ã¶rneÄŸini gÃ¶stermektedir:

`bGoa+V7g/yqDXvKRqq+JTFn4uQZbPiQJo4pf9RzJ`

**EriÅŸim kimliÄŸi ve gizli, bir HMAC anahtarÄ±nÄ± benzersiz ÅŸekilde tanÄ±mlar**, ancak gizli, _imzalarÄ± oluÅŸturmak_ iÃ§in kullanÄ±ldÄ±ÄŸÄ±ndan daha hassas bilgidir. 

### NumaralandÄ±rma
```bash
# List all storage buckets in project
gsutil ls

# Get each bucket configuration (protections, CLs, times, configs...)
gsutil ls -L

# List contents of a specific bucket
gsutil ls gs://bucket-name/
gsutil ls -r gs://bucket-name/ # Recursive
gsutil ls -a gs://bucket-name/ # Get ALL versions of objects

# Cat the context of a file without copying it locally
gsutil cat 'gs://bucket-name/folder/object'
gsutil cat 'gs://bucket-name/folder/object#<num>' # cat specific version

# Copy an object from the bucket to your local storage for review
gsutil cp gs://bucket-name/folder/object ~/

# List using a raw OAuth token
## Useful because "CLOUDSDK_AUTH_ACCESS_TOKEN" and "gcloud config set auth/access_token_file" doesn't work with gsutil
curl -H "Authorization: Bearer $TOKEN" "https://storage.googleapis.com/storage/v1/b/<storage-name>/o"
# Download file content from bucket
curl -H "Authorization: Bearer $TOKEN" "https://storage.googleapis.com/storage/v1/b/supportstorage-58249/o/flag.txt?alt=media" --output -

# Enumerate HMAC keys
gsutil hmac list

# Get permissions
gcloud storage buckets get-iam-policy gs://bucket-name/
gcloud storage objects get-iam-policy gs://bucket-name/folder/object
```
EÄŸer kovalarÄ± listelerken izin reddedildi hatasÄ± alÄ±rsanÄ±z, iÃ§eriÄŸe hala eriÅŸiminiz olabilir. DolayÄ±sÄ±yla, kovalarÄ±n ad konvansiyonu hakkÄ±nda bilgi sahibi olduktan sonra olasÄ± adlarÄ± listelemek ve bunlara eriÅŸmeyi denemek iÃ§in bir liste oluÅŸturabilirsiniz:
```bash
for i in $(cat wordlist.txt); do gsutil ls -r gs://"$i"; done
```
Ä°zinler `storage.objects.list` ve `storage.objects.get` ile, tÃ¼m klasÃ¶rleri ve dosyalarÄ± listeleyip indirmek iÃ§in kovadan yararlanabilirsiniz. Bunun iÃ§in ÅŸu Python betiÄŸi ile baÅŸarabilirsiniz:
```python
import requests
import xml.etree.ElementTree as ET

def list_bucket_objects(bucket_name, prefix='', marker=None):
url = f"https://storage.googleapis.com/{bucket_name}?prefix={prefix}"
if marker:
url += f"&marker={marker}"
response = requests.get(url)
xml_data = response.content
root = ET.fromstring(xml_data)
ns = {'ns': 'http://doc.s3.amazonaws.com/2006-03-01'}
for contents in root.findall('.//ns:Contents', namespaces=ns):
key = contents.find('ns:Key', namespaces=ns).text
print(key)
next_marker = root.find('ns:NextMarker', namespaces=ns)
if next_marker is not None:
next_marker_value = next_marker.text
list_bucket_objects(bucket_name, prefix, next_marker_value)

list_bucket_objects('<storage-name>')
```
### Yetki YÃ¼kseltme

AÅŸaÄŸÄ±daki sayfada **yetki yÃ¼kseltmek iÃ§in depolama izinlerini kÃ¶tÃ¼ye kullanma** yÃ¶ntemlerini kontrol edebilirsiniz:

{% content-ref url="../gcp-privilege-escalation/gcp-storage-privesc.md" %}
[gcp-storage-privesc.md](../gcp-privilege-escalation/gcp-storage-privesc.md)
{% endcontent-ref %}

### Kimlik DoÄŸrulamasÄ±z Sorgulama

{% content-ref url="../gcp-unaunthenticated-enum-and-access/gcp-storage-unauthenticated-enum/" %}
[gcp-storage-unauthenticated-enum](../gcp-unaunthenticated-enum-and-access/gcp-storage-unauthenticated-enum/)
{% endcontent-ref %}

### SaldÄ±rÄ± SonrasÄ± Ä°ÅŸlemler

{% content-ref url="../gcp-post-exploitation/gcp-storage-post-exploitation.md" %}
[gcp-storage-post-exploitation.md](../gcp-post-exploitation/gcp-storage-post-exploitation.md)
{% endcontent-ref %}

### KalÄ±cÄ±lÄ±k

{% content-ref url="../gcp-persistence/gcp-storage-persistence.md" %}
[gcp-storage-persistence.md](../gcp-persistence/gcp-storage-persistence.md)
{% endcontent-ref %}

{% hint style="success" %}
AWS Hacking Ã¶ÄŸrenin ve pratik yapÄ±n:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks EÄŸitim AWS KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ± (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCP Hacking Ã¶ÄŸrenin ve pratik yapÄ±n: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks EÄŸitim GCP KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ± (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**Abonelik planlarÄ±nÄ±**](https://github.com/sponsors/carlospolop) kontrol edin!
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) katÄ±lÄ±n veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n veya bizi **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** takip edin.**
* **Hacking pÃ¼f noktalarÄ±nÄ± paylaÅŸarak PR gÃ¶ndererek** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na katkÄ±da bulunun.

</details>
{% endhint %}
