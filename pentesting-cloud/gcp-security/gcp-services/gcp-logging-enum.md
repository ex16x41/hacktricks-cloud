# GCP - Logging Enum

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Basic Information

ì´ ì„œë¹„ìŠ¤ëŠ” ì‚¬ìš©ìê°€ GCPì˜ **ë¡œê·¸ ë°ì´í„° ë° ì´ë²¤íŠ¸**ë¥¼ ì €ì¥, ê²€ìƒ‰, ë¶„ì„, ëª¨ë‹ˆí„°ë§ ë° ê²½ê³ í•  ìˆ˜ ìˆë„ë¡ í•©ë‹ˆë‹¤.

Cloud Loggingì€ ë‹¤ë¥¸ GCP ì„œë¹„ìŠ¤ì™€ ì™„ì „íˆ í†µí•©ë˜ì–´ ëª¨ë“  GCP ë¦¬ì†ŒìŠ¤ì˜ ë¡œê·¸ë¥¼ ìœ„í•œ ì¤‘ì•™ ì§‘ì¤‘ì‹ ì €ì¥ì†Œë¥¼ ì œê³µí•©ë‹ˆë‹¤. **App Engine, Compute Engine ë° Cloud Functions**ì™€ ê°™ì€ ë‹¤ì–‘í•œ GCP ì„œë¹„ìŠ¤ì—ì„œ ë¡œê·¸ë¥¼ ìë™ìœ¼ë¡œ ìˆ˜ì§‘í•©ë‹ˆë‹¤. Cloud Logging ì—ì´ì „íŠ¸ë‚˜ APIë¥¼ ì‚¬ìš©í•˜ì—¬ ì˜¨í”„ë ˆë¯¸ìŠ¤ ë˜ëŠ” ë‹¤ë¥¸ í´ë¼ìš°ë“œì—ì„œ ì‹¤í–‰ë˜ëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜ì—ë„ Cloud Loggingì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì£¼ìš” ê¸°ëŠ¥:

* **ë¡œê·¸ ë°ì´í„° ì¤‘ì•™ ì§‘ì¤‘í™”:** ë‹¤ì–‘í•œ ì¶œì²˜ì—ì„œ ë¡œê·¸ ë°ì´í„°ë¥¼ ì§‘ê³„í•˜ì—¬ ì• í”Œë¦¬ì¼€ì´ì…˜ ë° ì¸í”„ë¼ì— ëŒ€í•œ ì „ì²´ì ì¸ ë·°ë¥¼ ì œê³µí•©ë‹ˆë‹¤.
* **ì‹¤ì‹œê°„ ë¡œê·¸ ê´€ë¦¬:** ì¦‰ê°ì ì¸ ë¶„ì„ ë° ëŒ€ì‘ì„ ìœ„í•´ ë¡œê·¸ë¥¼ ì‹¤ì‹œê°„ìœ¼ë¡œ ìŠ¤íŠ¸ë¦¬ë°í•©ë‹ˆë‹¤.
* **ê°•ë ¥í•œ ë°ì´í„° ë¶„ì„:** ê³ ê¸‰ í•„í„°ë§ ë° ê²€ìƒ‰ ê¸°ëŠ¥ì„ ì‚¬ìš©í•˜ì—¬ ëŒ€ëŸ‰ì˜ ë¡œê·¸ ë°ì´í„°ë¥¼ ì‹ ì†í•˜ê²Œ ë¶„ì„í•©ë‹ˆë‹¤.
* **BigQueryì™€ì˜ í†µí•©:** ë¡œê·¸ë¥¼ BigQueryë¡œ ë‚´ë³´ë‚´ì–´ ìƒì„¸ ë¶„ì„ ë° ì¿¼ë¦¬ë¥¼ ìˆ˜í–‰í•©ë‹ˆë‹¤.
* **ë¡œê·¸ ê¸°ë°˜ ë©”íŠ¸ë¦­:** ëª¨ë‹ˆí„°ë§ ë° ê²½ê³ ë¥¼ ìœ„í•´ ë¡œê·¸ ë°ì´í„°ì—ì„œ ì‚¬ìš©ì ì •ì˜ ë©”íŠ¸ë¦­ì„ ìƒì„±í•©ë‹ˆë‹¤.

### Logs flow

<figure><img src="../../../.gitbook/assets/image (3) (1).png" alt=""><figcaption><p><a href="https://betterstack.com/community/guides/logging/gcp-logging/">https://betterstack.com/community/guides/logging/gcp-logging/</a></p></figcaption></figure>

ê¸°ë³¸ì ìœ¼ë¡œ ì‹±í¬ì™€ ë¡œê·¸ ê¸°ë°˜ ë©”íŠ¸ë¦­ì€ ë¡œê·¸ê°€ ì €ì¥ë  ìœ„ì¹˜ë¥¼ ê²°ì •í•©ë‹ˆë‹¤.

### Configurations Supported by GCP Logging

Cloud Loggingì€ ë‹¤ì–‘í•œ ìš´ì˜ ìš”êµ¬ì— ë§ê²Œ ë†’ì€ êµ¬ì„± ê°€ëŠ¥ì„±ì„ ì œê³µí•©ë‹ˆë‹¤:

1. **ë¡œê·¸ ë²„í‚· (ì›¹ì—ì„œì˜ ë¡œê·¸ ì €ì¥):** Cloud Loggingì—ì„œ ë¡œê·¸ ë³´ì¡´ì„ ê´€ë¦¬í•˜ê¸° ìœ„í•´ ë²„í‚·ì„ ì •ì˜í•˜ì—¬ ë¡œê·¸ í•­ëª©ì´ ì–¼ë§ˆë‚˜ ì˜¤ë˜ ë³´ì¡´ë˜ëŠ”ì§€ë¥¼ ì œì–´í•©ë‹ˆë‹¤.
* ê¸°ë³¸ì ìœ¼ë¡œ `_Default`ì™€ `_Required` ë²„í‚·ì´ ìƒì„±ë©ë‹ˆë‹¤ (í•˜ë‚˜ëŠ” ë‹¤ë¥¸ í•˜ë‚˜ê°€ ê¸°ë¡í•˜ì§€ ì•ŠëŠ” ë‚´ìš©ì„ ê¸°ë¡í•©ë‹ˆë‹¤).
* **\_Required**ëŠ”: 

{% code overflow="wrap" %}
````
```bash
LOG_ID("cloudaudit.googleapis.com/activity") OR LOG_ID("externalaudit.googleapis.com/activity") OR LOG_ID("cloudaudit.googleapis.com/system_event") OR LOG_ID("externalaudit.googleapis.com/system_event") OR LOG_ID("cloudaudit.googleapis.com/access_transparency") OR LOG_ID("externalaudit.googleapis.com/access_transparency")
```

````
{% endcode %}

* ë°ì´í„°ì˜ **ë³´ì¡´ ê¸°ê°„**ì€ ë²„í‚·ë³„ë¡œ êµ¬ì„±ë˜ë©° **ìµœì†Œ 1ì¼ ì´ìƒ**ì´ì–´ì•¼ í•©ë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ **\_Requiredì˜ ë³´ì¡´ ê¸°ê°„ì€ 400ì¼**ë¡œ ìˆ˜ì •í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.
* ë¡œê·¸ ë²„í‚·ì€ **Cloud Storageì—ì„œ ë³¼ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.**

2. **ë¡œê·¸ ì‹±í¬(ì›¹ì˜ ë¡œê·¸ ë¼ìš°í„°):** **í•„í„°**ì— ë”°ë¼ Pub/Sub, BigQuery ë˜ëŠ” Cloud Storageì™€ ê°™ì€ ë‹¤ì–‘í•œ ëª©ì ì§€ë¡œ **ë¡œê·¸ í•­ëª©ì„ ë‚´ë³´ë‚´ê¸° ìœ„í•´ ì‹±í¬ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.**
* ê¸°ë³¸ì ìœ¼ë¡œ `_Default` ë° `_Required` ë²„í‚·ì— ëŒ€í•œ ì‹±í¬ê°€ ìƒì„±ë©ë‹ˆë‹¤:
* ```bash
_Required  logging.googleapis.com/projects/<proj-name>/locations/global/buckets/_Required  LOG_ID("cloudaudit.googleapis.com/activity") OR LOG_ID("externalaudit.googleapis.com/activity") OR LOG_ID("cloudaudit.googleapis.com/system_event") OR LOG_ID("externalaudit.googleapis.com/system_event") OR LOG_ID("cloudaudit.googleapis.com/access_transparency") OR LOG_ID("externalaudit.googleapis.com/access_transparency")
_Default   logging.googleapis.com/projects/<proj-name>/locations/global/buckets/_Default   NOT LOG_ID("cloudaudit.googleapis.com/activity") AND NOT LOG_ID("externalaudit.googleapis.com/activity") AND NOT LOG_ID("cloudaudit.googleapis.com/system_event") AND NOT LOG_ID("externalaudit.googleapis.com/system_event") AND NOT LOG_ID("cloudaudit.googleapis.com/access_transparency") AND NOT LOG_ID("externalaudit.googleapis.com/access_transparency")
```
* **ì œì™¸ í•„í„°:** íŠ¹ì • ë¡œê·¸ í•­ëª©ì´ ìˆ˜ì§‘ë˜ëŠ” ê²ƒì„ ë°©ì§€í•˜ê¸° ìœ„í•´ **ì œì™¸ë¥¼ ì„¤ì •í•  ìˆ˜ ìˆìœ¼ë©°**, ë¹„ìš©ì„ ì ˆê°í•˜ê³  ë¶ˆí•„ìš”í•œ ë…¸ì´ì¦ˆë¥¼ ì¤„ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
3. **ë¡œê·¸ ê¸°ë°˜ ë©”íŠ¸ë¦­:** ë¡œê·¸ì˜ ë‚´ìš©ì„ ê¸°ë°˜ìœ¼ë¡œ **ì‚¬ìš©ì ì •ì˜ ë©”íŠ¸ë¦­**ì„ êµ¬ì„±í•˜ì—¬ ë¡œê·¸ ë°ì´í„°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ê²½ê³  ë° ëª¨ë‹ˆí„°ë§ì„ ê°€ëŠ¥í•˜ê²Œ í•©ë‹ˆë‹¤.
4. **ë¡œê·¸ ë·°:** ë¡œê·¸ ë·°ëŠ” ë¡œê·¸ ë²„í‚· ë‚´ì—ì„œ **ëˆ„ê°€ ë¡œê·¸ì— ì ‘ê·¼í•  ìˆ˜ ìˆëŠ”ì§€ì— ëŒ€í•œ ê³ ê¸‰ ë° ì„¸ë¶„í™”ëœ ì œì–´ë¥¼ ì œê³µí•©ë‹ˆë‹¤.**
* Cloud Loggingì€ **ëª¨ë“  ë²„í‚·ì— ëŒ€í•´ `_AllLogs` ë·°ë¥¼ ìë™ìœ¼ë¡œ ìƒì„±**í•˜ë©°, ì´ëŠ” ëª¨ë“  ë¡œê·¸ë¥¼ ë³´ì—¬ì¤ë‹ˆë‹¤. Cloud Loggingì€ `_Default` ë²„í‚·ì— ëŒ€í•´ `_Default`ë¼ëŠ” ë·°ë„ ìƒì„±í•©ë‹ˆë‹¤. `_Default` ë²„í‚·ì˜ `_Default` ë·°ëŠ” ë°ì´í„° ì ‘ê·¼ ê°ì‚¬ ë¡œê·¸ë¥¼ ì œì™¸í•œ ëª¨ë“  ë¡œê·¸ë¥¼ ë³´ì—¬ì¤ë‹ˆë‹¤. `_AllLogs` ë° `_Default` ë·°ëŠ” í¸ì§‘í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.

IAM ì •ì±…ì„ ì‚¬ìš©í•˜ì—¬ íŠ¹ì • ë¡œê·¸ ë·°ë§Œ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ ì£¼ì²´ë¥¼ í—ˆìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

{% code overflow="wrap" %}
```json
{
"bindings": [
{
"members": [
"user:username@gmail.com"
],
"role": "roles/logging.viewAccessor",
"condition": {
"title": "Bucket reader condition example",
"description": "Grants logging.viewAccessor role to user username@gmail.com for the VIEW_ID log view.",
"expression":
"resource.name == \"projects/PROJECT_ID/locations/LOCATION/buckets/BUCKET_NAME/views/VIEW_ID\""
}
}
],
"etag": "BwWd_6eERR4=",
"version": 3
}
```
{% endcode %}

### ê¸°ë³¸ ë¡œê·¸

ê¸°ë³¸ì ìœ¼ë¡œ **Admin Write** ì‘ì—…(ê´€ë¦¬ í™œë™ ê°ì‚¬ ë¡œê·¸ë¼ê³ ë„ í•¨)ì´ ê¸°ë¡ë˜ë©°(ë©”íƒ€ë°ì´í„° ë˜ëŠ” êµ¬ì„± ì •ë³´ë¥¼ ì‘ì„±) **ë¹„í™œì„±í™”í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤**.

ê·¸ëŸ° ë‹¤ìŒ ì‚¬ìš©ìëŠ” **Data Access ê°ì‚¬ ë¡œê·¸**ë¥¼ í™œì„±í™”í•  ìˆ˜ ìˆìœ¼ë©°, ì´ëŠ” **Admin Read, Data Write ë° Data Write**ì…ë‹ˆë‹¤.

ê° ë¡œê·¸ ìœ í˜•ì— ëŒ€í•œ ìì„¸í•œ ì •ë³´ëŠ” ë¬¸ì„œì—ì„œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤: [https://cloud.google.com/iam/docs/audit-logging](https://cloud.google.com/iam/docs/audit-logging)

ê·¸ëŸ¬ë‚˜ ê¸°ë³¸ì ìœ¼ë¡œ **`GetIamPolicy`** ì‘ì—… ë° ê¸°íƒ€ ì½ê¸° ì‘ì—…ì´ **ê¸°ë¡ë˜ì§€ ì•ŠìŒ**ì„ ì˜ë¯¸í•©ë‹ˆë‹¤. ë”°ë¼ì„œ ê¸°ë³¸ì ìœ¼ë¡œ í™˜ê²½ì„ ì—´ê±°í•˜ë ¤ëŠ” ê³µê²©ìëŠ” ì‹œìŠ¤í…œ ê´€ë¦¬ìê°€ ë” ë§ì€ ë¡œê·¸ ìƒì„±ì„ êµ¬ì„±í•˜ì§€ ì•ŠëŠ” í•œ ì¡íˆì§€ ì•ŠìŠµë‹ˆë‹¤.

ì½˜ì†”ì—ì„œ ë” ë§ì€ ë¡œê·¸ë¥¼ í™œì„±í™”í•˜ë ¤ë©´ ì‹œìŠ¤í…œ ê´€ë¦¬ìê°€ [https://console.cloud.google.com/iam-admin/audit](https://console.cloud.google.com/iam-admin/audit)ë¡œ ì´ë™í•˜ì—¬ ì´ë¥¼ í™œì„±í™”í•´ì•¼ í•©ë‹ˆë‹¤. ë‘ ê°€ì§€ ë‹¤ë¥¸ ì˜µì…˜ì´ ìˆìŠµë‹ˆë‹¤:

* **ê¸°ë³¸ êµ¬ì„±**: ê¸°ë³¸ êµ¬ì„±ì„ ìƒì„±í•˜ê³  ëª¨ë“  Admin Read ë°/ë˜ëŠ” Data Read ë°/ë˜ëŠ” Data Write ë¡œê·¸ë¥¼ ê¸°ë¡í•˜ê³  ë©´ì œëœ ì£¼ì²´ë¥¼ ì¶”ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

<figure><img src="../../../.gitbook/assets/image (338).png" alt=""><figcaption></figcaption></figure>

* **ì„œë¹„ìŠ¤ ì„ íƒ**: ë˜ëŠ” ë¡œê·¸ë¥¼ ìƒì„±í•  ì„œë¹„ìŠ¤ì™€ í•´ë‹¹ íŠ¹ì • ì„œë¹„ìŠ¤ì— ëŒ€í•œ ë¡œê·¸ ìœ í˜• ë° ë©´ì œëœ ì£¼ì²´ë¥¼ **ì„ íƒ**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ë˜í•œ ê¸°ë³¸ì ìœ¼ë¡œ ì´ëŸ¬í•œ ë¡œê·¸ë§Œ ìƒì„±ë˜ë©°, ë” ë§ì€ ë¡œê·¸ë¥¼ ìƒì„±í•˜ë©´ ë¹„ìš©ì´ ì¦ê°€í•©ë‹ˆë‹¤.

### ì—´ê±°

`gcloud` ëª…ë ¹ì¤„ ë„êµ¬ëŠ” GCP ìƒíƒœê³„ì˜ í•„ìˆ˜ì ì¸ ë¶€ë¶„ìœ¼ë¡œ, ë¦¬ì†ŒìŠ¤ ë° ì„œë¹„ìŠ¤ë¥¼ ê´€ë¦¬í•  ìˆ˜ ìˆê²Œ í•´ì¤ë‹ˆë‹¤. `gcloud`ë¥¼ ì‚¬ìš©í•˜ì—¬ ë¡œê·¸ êµ¬ì„± ë° ë¡œê·¸ ì•¡ì„¸ìŠ¤ë¥¼ ê´€ë¦¬í•˜ëŠ” ë°©ë²•ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.

{% code overflow="wrap" %}
```bash
# List buckets
gcloud logging buckets list
gcloud logging buckets describe <bucket-name> --location <location>

# List log entries: only logs that contain log entries are listed.
gcloud logging logs list

# Get log metrics
gcloud logging metrics list
gcloud logging metrics describe <metric-name>

# Get log sinks
gcloud logging sinks list
gcloud logging sinks describe <sink-name>

# Get log views
gcloud logging views list --bucket <bucket> --location global
gcloud logging views describe --bucket <bucket> --location global <view-id> # view-id is usually the same as the bucket name

# Get log links
gcloud logging links list --bucket _Default --location global
gcloud logging links describe <link-id> --bucket _Default --location global
```
{% endcode %}

**`cloudresourcemanager`**ì˜ ë¡œê·¸ë¥¼ í™•ì¸í•˜ëŠ” ì˜ˆì‹œ (ê¶Œí•œì„ BFí•˜ëŠ” ë° ì‚¬ìš©ë¨): [https://console.cloud.google.com/logs/query;query=protoPayload.serviceName%3D%22cloudresourcemanager.googleapis.com%22;summaryFields=:false:32:beginning;cursorTimestamp=2024-01-20T00:07:14.482809Z;startTime=2024-01-01T11:12:26.062Z;endTime=2024-02-02T17:12:26.062Z?authuser=2\&project=digital-bonfire-410512](https://console.cloud.google.com/logs/query;query=protoPayload.serviceName%3D%22cloudresourcemanager.googleapis.com%22;summaryFields=:false:32:beginning;cursorTimestamp=2024-01-20T00:07:14.482809Z;startTime=2024-01-01T11:12:26.062Z;endTime=2024-02-02T17:12:26.062Z?authuser=2\&project=digital-bonfire-410512)

**`testIamPermissions`**ì˜ ë¡œê·¸ê°€ ì—†ìŠµë‹ˆë‹¤:

<figure><img src="../../../.gitbook/assets/image (2) (1) (1).png" alt=""><figcaption></figcaption></figure>

### Post Exploitation

{% content-ref url="../gcp-post-exploitation/gcp-logging-post-exploitation.md" %}
[gcp-logging-post-exploitation.md](../gcp-post-exploitation/gcp-logging-post-exploitation.md)
{% endcontent-ref %}

### Persistence

{% content-ref url="../gcp-persistence/gcp-logging-persistence.md" %}
[gcp-logging-persistence.md](../gcp-persistence/gcp-logging-persistence.md)
{% endcontent-ref %}

## References

* [https://cloud.google.com/logging/docs/logs-views#gcloud](https://cloud.google.com/logging/docs/logs-views#gcloud)
* [https://betterstack.com/community/guides/logging/gcp-logging/](https://betterstack.com/community/guides/logging/gcp-logging/)

{% hint style="success" %}
AWS í•´í‚¹ ë°°ìš°ê¸° ë° ì—°ìŠµí•˜ê¸°:<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
GCP í•´í‚¹ ë°°ìš°ê¸° ë° ì—°ìŠµí•˜ê¸°: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks ì§€ì›í•˜ê¸°</summary>

* [**êµ¬ë… ê³„íš**](https://github.com/sponsors/carlospolop) í™•ì¸í•˜ê¸°!
* **ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— ì°¸ì—¬í•˜ê±°ë‚˜ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**ë¥¼ íŒ”ë¡œìš°í•˜ì„¸ìš”.**
* **[**HackTricks**](https://github.com/carlospolop/hacktricks) ë° [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ë¦¬í¬ì§€í† ë¦¬ì— PRì„ ì œì¶œí•˜ì—¬ í•´í‚¹ íŒì„ ê³µìœ í•˜ì„¸ìš”.**

</details>
{% endhint %}
