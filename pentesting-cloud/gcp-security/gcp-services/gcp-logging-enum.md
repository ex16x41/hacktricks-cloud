# GCP - GÃ¼nlÃ¼k NumaralandÄ±rma

<details>

<summary><strong>SÄ±fÄ±rdan kahraman olmak iÃ§in AWS hackleme Ã¶ÄŸrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ±)</strong></a><strong> ile!</strong></summary>

HackTricks'Ä± desteklemenin diÄŸer yollarÄ±:

* **Åirketinizi HackTricks'te reklamÄ±nÄ± gÃ¶rmek istiyorsanÄ±z** veya **HackTricks'i PDF olarak indirmek istiyorsanÄ±z** [**ABONELÄ°K PLANLARI**]'na (https://github.com/sponsors/carlospolop) gÃ¶z atÄ±n!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nleri**]'ni alÄ±n (https://peass.creator-spring.com)
* [**PEASS Ailesi**]'ni keÅŸfedin (https://opensea.io/collection/the-peass-family), Ã¶zel [**NFT'lerimiz**]'in (https://opensea.io/collection/the-peass-family) koleksiyonu
* **KatÄ±lÄ±n** ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) veya **Twitter** ğŸ¦ [**@carlospolopm**]'yi (https://twitter.com/carlospolopm) takip edin.
* **Hacking pÃ¼f noktalarÄ±nÄ±zÄ± paylaÅŸarak PR'lar gÃ¶ndererek** [**HackTricks**]'e (https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**]'a (https://github.com/carlospolop/hacktricks-cloud) katkÄ±da bulunun.

</details>

## Temel Bilgiler

Bu hizmet, kullanÄ±cÄ±larÄ±n GCP'den **gÃ¼nlÃ¼k verileri ve olaylarÄ±** depolamalarÄ±na, aramalarÄ±na, analiz etmelerine, izlemelerine ve uyarÄ± almalarÄ±na olanak tanÄ±r.

Cloud Logging, diÄŸer GCP hizmetleriyle tam entegredir ve tÃ¼m GCP kaynaklarÄ±ndan gÃ¼nlÃ¼kleri toplamak iÃ§in merkezi bir depo saÄŸlar. **App Engine, Compute Engine ve Cloud Functions** gibi Ã§eÅŸitli GCP hizmetlerinden gÃ¼nlÃ¼kleri otomatik olarak toplar. Cloud Logging'i, Cloud Logging ajanÄ±nÄ± veya API'sÄ±nÄ± kullanarak yerinde veya diÄŸer bulutlarda Ã§alÄ±ÅŸan uygulamalar iÃ§in de kullanabilirsiniz.

Ana Ã–zellikler:

* **GÃ¼nlÃ¼k Verilerinin MerkezileÅŸtirilmesi:** Ã‡eÅŸitli kaynaklardan gÃ¼nlÃ¼k verileri bir araya getirerek uygulamalarÄ±nÄ±zÄ±n ve altyapÄ±nÄ±zÄ±n bÃ¼tÃ¼nsel bir gÃ¶rÃ¼nÃ¼mÃ¼nÃ¼ sunar.
* **GerÃ§ek ZamanlÄ± GÃ¼nlÃ¼k YÃ¶netimi:** GerÃ§ek zamanlÄ± olarak gÃ¼nlÃ¼kleri akÄ±tarak hemen analiz ve yanÄ±t verme imkanÄ± saÄŸlar.
* **GÃ¼Ã§lÃ¼ Veri Analizi:** BÃ¼yÃ¼k miktardaki gÃ¼nlÃ¼k verilerini hÄ±zlÄ± bir ÅŸekilde sÃ¼zmek iÃ§in geliÅŸmiÅŸ filtreleme ve arama yeteneklerini kullanÄ±r.
* **BigQuery ile Entegrasyon:** GÃ¼nlÃ¼kleri ayrÄ±ntÄ±lÄ± analiz ve sorgulama iÃ§in BigQuery'e aktarÄ±r.
* **GÃ¼nlÃ¼k TabanlÄ± Metrikler:** GÃ¼nlÃ¼k verilerinizden Ã¶zel metrikler oluÅŸturarak izleme ve uyarÄ±lar iÃ§in kullanabilirsiniz.

### GÃ¼nlÃ¼k AkÄ±ÅŸÄ±

<figure><img src="../../../.gitbook/assets/image (3) (1).png" alt=""><figcaption><p><a href="https://betterstack.com/community/guides/logging/gcp-logging/">https://betterstack.com/community/guides/logging/gcp-logging/</a></p></figcaption></figure>

Temelde, sÄ±zÄ±ntÄ±lar ve gÃ¼nlÃ¼k tabanlÄ± metrikler bir gÃ¼nlÃ¼ÄŸÃ¼n nerede depolanacaÄŸÄ±nÄ± belirler.

### GCP Logging TarafÄ±ndan Desteklenen YapÄ±landÄ±rmalar

Cloud Logging, Ã§eÅŸitli iÅŸletme ihtiyaÃ§larÄ±na uyacak ÅŸekilde yÃ¼ksek derecede yapÄ±landÄ±rÄ±labilir:

1. **GÃ¼nlÃ¼k KovalarÄ± (Web'de gÃ¼nlÃ¼k depolama):** Cloud Logging'de **gÃ¼nlÃ¼k saklama** iÃ§in kovalar tanÄ±mlayarak, gÃ¼nlÃ¼k giriÅŸlerinizin ne kadar sÃ¼reyle saklanacaÄŸÄ± konusunda kontrol saÄŸlar.
* VarsayÄ±lan olarak `_Default` ve `_Required` adlÄ± kovalar oluÅŸturulur (bir tanesi diÄŸerinin ne yaptÄ±ÄŸÄ±nÄ± kaydeder).
*   **\_Required** ÅŸudur:

{% code overflow="wrap" %}
```bash
LOG_ID("cloudaudit.googleapis.com/activity") OR LOG_ID("externalaudit.googleapis.com/activity") OR LOG_ID("cloudaudit.googleapis.com/system_event") OR LOG_ID("externalaudit.googleapis.com/system_event") OR LOG_ID("cloudaudit.googleapis.com/access_transparency") OR LOG_ID("externalaudit.googleapis.com/access_transparency")
```
{% endcode %}
* Verilerin **saklama sÃ¼resi** kova baÅŸÄ±na yapÄ±landÄ±rÄ±lÄ±r ve en az **1 gÃ¼n olmalÄ±dÄ±r.** Ancak **\_Required'Ä±n saklama sÃ¼resi 400 gÃ¼n** ve deÄŸiÅŸtirilemez.
* GÃ¼nlÃ¼k KovalarÄ±'nÄ±n **Cloud Storage'da gÃ¶rÃ¼nÃ¼r olmadÄ±ÄŸÄ±nÄ±** unutmayÄ±n.
2. **GÃ¼nlÃ¼k SÄ±zÄ±ntÄ±larÄ± (Web'de gÃ¼nlÃ¼k yÃ¶nlendirici):** Filtreye dayalÄ± olarak gÃ¼nlÃ¼k giriÅŸlerini Pub/Sub, BigQuery veya Cloud Storage gibi Ã§eÅŸitli hedeflere **aktarmak iÃ§in sÄ±zÄ±ntÄ±lar oluÅŸturun.**
* VarsayÄ±lan olarak `_Default` ve `_Required` kovalarÄ± iÃ§in sÄ±zÄ±ntÄ±lar oluÅŸturulur:
* ```bash
_Required  logging.googleapis.com/projects/<proj-name>/locations/global/buckets/_Required  LOG_ID("cloudaudit.googleapis.com/activity") OR LOG_ID("externalaudit.googleapis.com/activity") OR LOG_ID("cloudaudit.googleapis.com/system_event") OR LOG_ID("externalaudit.googleapis.com/system_event") OR LOG_ID("cloudaudit.googleapis.com/access_transparency") OR LOG_ID("externalaudit.googleapis.com/access_transparency")
_Default   logging.googleapis.com/projects/<proj-name>/locations/global/buckets/_Default   NOT LOG_ID("cloudaudit.googleapis.com/activity") AND NOT LOG_ID("externalaudit.googleapis.com/activity") AND NOT LOG_ID("cloudaudit.googleapis.com/system_event") AND NOT LOG_ID("externalaudit.googleapis.com/system_event") AND NOT LOG_ID("cloudaudit.googleapis.com/access_transparency") AND NOT LOG_ID("externalaudit.googleapis.com/access_transparency")
```
* **DÄ±ÅŸlama Filtreleri:** Belirli gÃ¼nlÃ¼k giriÅŸlerinin alÄ±nmasÄ±nÄ± Ã¶nlemek iÃ§in **dÄ±ÅŸlamalarÄ± yapÄ±landÄ±rmak mÃ¼mkÃ¼ndÃ¼r**, bÃ¶ylece maliyetleri azaltabilir ve gereksiz gÃ¼rÃ¼ltÃ¼yÃ¼ azaltabilirsiniz.
3. **GÃ¼nlÃ¼k TabanlÄ± Metrikler:** GÃ¼nlÃ¼k iÃ§eriÄŸine dayalÄ± olarak **Ã¶zel metrikleri yapÄ±landÄ±rarak**, gÃ¼nlÃ¼k verilerine dayalÄ± uyarÄ±lar ve izlemeler saÄŸlayabilirsiniz.
4. **GÃ¼nlÃ¼k gÃ¶rÃ¼nÃ¼mleri:** GÃ¼nlÃ¼k gÃ¶rÃ¼nÃ¼mleri, gÃ¼nlÃ¼k kovalarÄ±nÄ±z iÃ§indeki gÃ¼nlÃ¼klere kimin eriÅŸebileceÄŸi konusunda ileri dÃ¼zeyde ve **aÅŸÄ±rÄ± kontrol saÄŸlar.**
* Cloud Logging, her kova iÃ§in **otomatik olarak `_AllLogs` gÃ¶rÃ¼nÃ¼mÃ¼nÃ¼ oluÅŸturur**, bu gÃ¶rÃ¼nÃ¼m tÃ¼m gÃ¼nlÃ¼kleri gÃ¶sterir. Cloud Logging ayrÄ±ca `_Default` kovasÄ± iÃ§in `_Default` adÄ±nda bir gÃ¶rÃ¼nÃ¼m oluÅŸturur. `_Default` kovasÄ± iÃ§in `_Default` gÃ¶rÃ¼nÃ¼mÃ¼, Veri EriÅŸim denetim gÃ¼nlÃ¼klerini hariÃ§ tutan tÃ¼m gÃ¼nlÃ¼kleri gÃ¶sterir. `_AllLogs` ve `_Default` gÃ¶rÃ¼nÃ¼mleri dÃ¼zenlenemez.

Belirli bir GÃ¼nlÃ¼k gÃ¶rÃ¼nÃ¼mÃ¼nÃ¼ kullanmasÄ±na izin vermek iÃ§in bir IAM politikasÄ± ile bir prensibe **yalnÄ±zca belirli bir GÃ¼nlÃ¼k gÃ¶rÃ¼nÃ¼mÃ¼nÃ¼ kullanmasÄ±na izin vermek mÃ¼mkÃ¼ndÃ¼r**:

{% code overflow="wrap" %}
```json
{
"bindings": [
{
"members": [
"user:username@gmail.com"
],
"role": "roles/logging.viewAccessor",
"condition": {
"title": "Bucket reader condition example",
"description": "Grants logging.viewAccessor role to user username@gmail.com for the VIEW_ID log view.",
"expression":
"resource.name == \"projects/PROJECT_ID/locations/LOCATION/buckets/BUCKET_NAME/views/VIEW_ID\""
}
}
],
"etag": "BwWd_6eERR4=",
"version": 3
}
```
{% endcode %}

### VarsayÄ±lan GÃ¼nlÃ¼kler

VarsayÄ±lan olarak **YÃ¶netici Yazma** iÅŸlemleri (ayrÄ±ca YÃ¶netici Etkinlik denetim gÃ¼nlÃ¼kleri olarak da adlandÄ±rÄ±lÄ±r) kaydedilen iÅŸlemlerdir (meta veri yazma veya yapÄ±landÄ±rma bilgileri) ve **devre dÄ±ÅŸÄ± bÄ±rakÄ±lamazlar**.

Daha sonra, kullanÄ±cÄ± **Veri EriÅŸimi denetim gÃ¼nlÃ¼klerini** etkinleÅŸtirebilir, bunlar **YÃ¶netici Okuma, Veri Yazma ve Veri Yazma** iÅŸlemlerini iÃ§erir.

Her gÃ¼nlÃ¼k tÃ¼rÃ¼ hakkÄ±nda daha fazla bilgiyi belgelerde bulabilirsiniz: [https://cloud.google.com/iam/docs/audit-logging](https://cloud.google.com/iam/docs/audit-logging)

Ancak, bu varsayÄ±lan olarak demek ki **`GetIamPolicy`** eylemleri ve diÄŸer okuma eylemleri **kaydedilmiyor** demektir. Bu nedenle, varsayÄ±lan olarak bir saldÄ±rganÄ±n ortamÄ± numaralandÄ±rmaya Ã§alÄ±ÅŸmasÄ± durumunda, sistem yÃ¶neticisi daha fazla gÃ¼nlÃ¼k oluÅŸturacak ÅŸekilde yapÄ±landÄ±rmadÄ±ysa yakalanmayacaktÄ±r.

Sistem yÃ¶neticisinin konsolda daha fazla gÃ¼nlÃ¼k etkinleÅŸtirmek iÃ§in [https://console.cloud.google.com/iam-admin/audit](https://console.cloud.google.com/iam-admin/audit) adresine gitmesi ve bunlarÄ± etkinleÅŸtirmesi gerekmektedir. 2 farklÄ± seÃ§enek bulunmaktadÄ±r:

* **VarsayÄ±lan YapÄ±landÄ±rma**: VarsayÄ±lan bir yapÄ±landÄ±rma oluÅŸturmak ve tÃ¼m YÃ¶netici Okuma ve/veya Veri Okuma ve/veya Veri Yazma gÃ¼nlÃ¼klerini kaydetmek hatta muaf tutulan prensipler eklemek mÃ¼mkÃ¼ndÃ¼r:

<figure><img src="../../../.gitbook/assets/image (338).png" alt=""><figcaption></figcaption></figure>

* **Hizmetleri SeÃ§in**: Veya sadece gÃ¼nlÃ¼k oluÅŸturmak istediÄŸiniz hizmetleri seÃ§in ve gÃ¼nlÃ¼k tÃ¼rÃ¼nÃ¼ ve belirli hizmet iÃ§in muaf tutulan prensipleri seÃ§in.

AyrÄ±ca, varsayÄ±lan olarak yalnÄ±zca bu gÃ¼nlÃ¼kler oluÅŸturulmaktadÄ±r Ã§Ã¼nkÃ¼ daha fazla gÃ¼nlÃ¼k oluÅŸturmak maliyetleri artÄ±racaktÄ±r.

### NumaralandÄ±rma

`gcloud` komut satÄ±rÄ± aracÄ±, kaynaklarÄ±nÄ±zÄ± ve hizmetlerinizi yÃ¶netmenize olanak tanÄ±yan GCP ekosisteminin ayrÄ±lmaz bir parÃ§asÄ±dÄ±r. Ä°ÅŸte `gcloud`'u gÃ¼nlÃ¼k yapÄ±landÄ±rmalarÄ±nÄ±zÄ± ve eriÅŸim gÃ¼nlÃ¼klerinizi yÃ¶netmek iÃ§in nasÄ±l kullanabileceÄŸiniz:
```bash
# List buckets
gcloud logging buckets list
gcloud logging buckets describe <bucket-name> --location <location>

# List log entries: only logs that contain log entries are listed.
gcloud logging logs list

# Get log metrics
gcloud logging metrics list
gcloud logging metrics describe <metric-name>

# Get log sinks
gcloud logging sinks list
gcloud logging sinks describe <sink-name>

# Get log views
gcloud logging views list --bucket <bucket> --location global
gcloud logging views describe --bucket <bucket> --location global <view-id> # view-id is usually the same as the bucket name

# Get log links
gcloud logging links list --bucket _Default --location global
gcloud logging links describe <link-id> --bucket _Default --location global
```
{% endcode %}

Ã–rnek, **`cloudresourcemanager`** gÃ¼nlÃ¼klerini kontrol etmek iÃ§in (izinleri BF iÃ§in kullanÄ±lan): [https://console.cloud.google.com/logs/query;query=protoPayload.serviceName%3D%22cloudresourcemanager.googleapis.com%22;summaryFields=:false:32:beginning;cursorTimestamp=2024-01-20T00:07:14.482809Z;startTime=2024-01-01T11:12:26.062Z;endTime=2024-02-02T17:12:26.062Z?authuser=2\&project=digital-bonfire-410512](https://console.cloud.google.com/logs/query;query=protoPayload.serviceName%3D%22cloudresourcemanager.googleapis.com%22;summaryFields=:false:32:beginning;cursorTimestamp=2024-01-20T00:07:14.482809Z;startTime=2024-01-01T11:12:26.062Z;endTime=2024-02-02T17:12:26.062Z?authuser=2\&project=digital-bonfire-410512)

**`testIamPermissions`** iÃ§in gÃ¼nlÃ¼kler bulunmamaktadÄ±r:

<figure><img src="../../../.gitbook/assets/image (2) (1) (1).png" alt=""><figcaption></figcaption></figure>

### SonrasÄ± SÃ¶mÃ¼rÃ¼

{% content-ref url="../gcp-post-exploitation/gcp-logging-post-exploitation.md" %}
[gcp-logging-post-exploitation.md](../gcp-post-exploitation/gcp-logging-post-exploitation.md)
{% endcontent-ref %}

### KalÄ±cÄ±lÄ±k

{% content-ref url="../gcp-persistence/gcp-logging-persistence.md" %}
[gcp-logging-persistence.md](../gcp-persistence/gcp-logging-persistence.md)
{% endcontent-ref %}

## Referanslar

* [https://cloud.google.com/logging/docs/logs-views#gcloud](https://cloud.google.com/logging/docs/logs-views#gcloud)
* [https://betterstack.com/community/guides/logging/gcp-logging/](https://betterstack.com/community/guides/logging/gcp-logging/)

<details>

<summary><strong>SÄ±fÄ±rdan kahraman olmak iÃ§in AWS hackleme Ã¶ÄŸrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

HackTricks'i desteklemenin diÄŸer yollarÄ±:

* **Åirketinizi HackTricks'te reklamÄ±nÄ±zÄ± gÃ¶rmek istiyorsanÄ±z** veya **HackTricks'i PDF olarak indirmek istiyorsanÄ±z** [**ABONELÄ°K PLANLARINI**](https://github.com/sponsors/carlospolop) kontrol edin!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini alÄ±n**](https://peass.creator-spring.com)
* [**The PEASS Family'yi**](https://opensea.io/collection/the-peass-family) keÅŸfedin, Ã¶zel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuz
* **ğŸ’¬ [Discord grubuna](https://discord.gg/hRep4RUj7f) veya [telegram grubuna](https://t.me/peass) katÄ±lÄ±n veya** beni **Twitter** ğŸ¦ [**@carlospolopm**](https://twitter.com/carlospolopm)** takip edin.**
* **Hacking pÃ¼f noktalarÄ±nÄ±zÄ± paylaÅŸarak PR'lar gÃ¶ndererek** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na katkÄ±da bulunun.

</details>
