# GCP - Logging Enum

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Temel Bilgiler

Bu hizmet, kullanÄ±cÄ±larÄ±n GCP'den **log verilerini ve olaylarÄ±nÄ±** depolamasÄ±na, aramasÄ±na, analiz etmesine, izlemesine ve uyarÄ± vermesine olanak tanÄ±r.

Cloud Logging, tÃ¼m GCP kaynaklarÄ±nÄ±zdan gelen loglar iÃ§in merkezi bir depo saÄŸlayarak diÄŸer GCP hizmetleriyle tamamen entegre edilmiÅŸtir. **FarklÄ± GCP hizmetlerinden loglarÄ± otomatik olarak toplar**; App Engine, Compute Engine ve Cloud Functions gibi. AyrÄ±ca, Cloud Logging ajanÄ± veya API'sini kullanarak yerel veya diÄŸer bulutlarda Ã§alÄ±ÅŸan uygulamalar iÃ§in de Cloud Logging'i kullanabilirsiniz.

Ana Ã–zellikler:

* **Log Verisi MerkezileÅŸtirmesi:** Ã‡eÅŸitli kaynaklardan log verilerini bir araya getirerek uygulamalarÄ±nÄ±z ve altyapÄ±nÄ±z hakkÄ±nda bÃ¼tÃ¼nsel bir gÃ¶rÃ¼nÃ¼m sunar.
* **GerÃ§ek ZamanlÄ± Log YÃ¶netimi:** HÄ±zlÄ± analiz ve yanÄ±t iÃ§in loglarÄ± gerÃ§ek zamanlÄ± olarak akÄ±tarak.
* **GÃ¼Ã§lÃ¼ Veri Analizi:** BÃ¼yÃ¼k hacimlerdeki log verilerini hÄ±zlÄ±ca sÃ¼zmek iÃ§in geliÅŸmiÅŸ filtreleme ve arama yeteneklerini kullanÄ±n.
* **BigQuery ile Entegrasyon:** DetaylÄ± analiz ve sorgulama iÃ§in loglarÄ± BigQuery'ye aktarÄ±n.
* **Log TabanlÄ± Metrikler:** Ä°zleme ve uyarÄ± iÃ§in log verilerinizden Ã¶zel metrikler oluÅŸturun.

### Log AkÄ±ÅŸÄ±

<figure><img src="../../../.gitbook/assets/image (3) (1).png" alt=""><figcaption><p><a href="https://betterstack.com/community/guides/logging/gcp-logging/">https://betterstack.com/community/guides/logging/gcp-logging/</a></p></figcaption></figure>

Temelde, loglarÄ±n nerede saklanacaÄŸÄ±nÄ± belirlemek iÃ§in sink'ler ve log tabanlÄ± metrikler kullanÄ±lacaktÄ±r.

### GCP Logging TarafÄ±ndan Desteklenen YapÄ±landÄ±rmalar

Cloud Logging, Ã§eÅŸitli operasyonel ihtiyaÃ§lara uyacak ÅŸekilde yÃ¼ksek derecede yapÄ±landÄ±rÄ±labilir:

1. **Log Kovalari (Web'de log depolama):** Log giriÅŸlerinizin ne kadar sÃ¼reyle saklanacaÄŸÄ±nÄ± kontrol ederek **log saklama sÃ¼resi** yÃ¶netmek iÃ§in Cloud Logging'de kovalara tanÄ±m yapÄ±n.
* VarsayÄ±lan olarak `_Default` ve `_Required` kovalari oluÅŸturulur (biri diÄŸerinin ne olduÄŸunu kaydeder).
* **\_Required** ÅŸudur: 

{% code overflow="wrap" %}
````
```bash
LOG_ID("cloudaudit.googleapis.com/activity") OR LOG_ID("externalaudit.googleapis.com/activity") OR LOG_ID("cloudaudit.googleapis.com/system_event") OR LOG_ID("externalaudit.googleapis.com/system_event") OR LOG_ID("cloudaudit.googleapis.com/access_transparency") OR LOG_ID("externalaudit.googleapis.com/access_transparency")
```

````
{% endcode %}

* Verilerin **saklama sÃ¼resi** her bir bucket iÃ§in yapÄ±landÄ±rÄ±lÄ±r ve **en az 1 gÃ¼n** olmalÄ±dÄ±r. Ancak **_Required iÃ§in saklama sÃ¼resi 400 gÃ¼ndÃ¼r** ve deÄŸiÅŸtirilemez.
* Log Buckets'Ä±n **Cloud Storage'da gÃ¶rÃ¼nmediÄŸini** unutmayÄ±n.

2. **Log Sinks (Web'deki Log yÃ¶nlendirici):** Log giriÅŸlerini **Ã§Ä±karmak iÃ§in** Pub/Sub, BigQuery veya Cloud Storage gibi Ã§eÅŸitli hedeflere **filtreye** dayalÄ± olarak oluÅŸturun.
* **VarsayÄ±lan** olarak `_Default` ve `_Required` bucket'larÄ± iÃ§in sink'ler oluÅŸturulur:
* ```bash
_Required  logging.googleapis.com/projects/<proj-name>/locations/global/buckets/_Required  LOG_ID("cloudaudit.googleapis.com/activity") OR LOG_ID("externalaudit.googleapis.com/activity") OR LOG_ID("cloudaudit.googleapis.com/system_event") OR LOG_ID("externalaudit.googleapis.com/system_event") OR LOG_ID("cloudaudit.googleapis.com/access_transparency") OR LOG_ID("externalaudit.googleapis.com/access_transparency")
_Default   logging.googleapis.com/projects/<proj-name>/locations/global/buckets/_Default   NOT LOG_ID("cloudaudit.googleapis.com/activity") AND NOT LOG_ID("externalaudit.googleapis.com/activity") AND NOT LOG_ID("cloudaudit.googleapis.com/system_event") AND NOT LOG_ID("externalaudit.googleapis.com/system_event") AND NOT LOG_ID("cloudaudit.googleapis.com/access_transparency") AND NOT LOG_ID("externalaudit.googleapis.com/access_transparency")
```
* **HariÃ§ Tutma Filtreleri:** Belirli log giriÅŸlerinin **alÄ±nmasÄ±nÄ± Ã¶nlemek iÃ§in hariÃ§ tutmalar** ayarlamak mÃ¼mkÃ¼ndÃ¼r, bu da maliyetleri tasarruf ettirir ve gereksiz gÃ¼rÃ¼ltÃ¼yÃ¼ azaltÄ±r.
3. **Log TabanlÄ± Metrikler:** LoglarÄ±n iÃ§eriÄŸine dayalÄ± **Ã¶zel metrikler** yapÄ±landÄ±rarak log verilerine dayalÄ± olarak uyarÄ± ve izleme yapÄ±lmasÄ±nÄ± saÄŸlar.
4. **Log GÃ¶rÃ¼nÃ¼mleri:** Log gÃ¶rÃ¼nÃ¼mleri, log bucket'larÄ±nÄ±z iÃ§indeki loglara **kimlerin eriÅŸimi olduÄŸunu** kontrol etme konusunda geliÅŸmiÅŸ ve **detaylÄ± kontrol** saÄŸlar.
* Cloud Logging, her bucket iÃ§in otomatik olarak `_AllLogs` gÃ¶rÃ¼nÃ¼mÃ¼nÃ¼ oluÅŸturur; bu gÃ¶rÃ¼nÃ¼m tÃ¼m loglarÄ± gÃ¶sterir. Cloud Logging ayrÄ±ca `_Default` bucket'Ä± iÃ§in `_Default` adÄ±nda bir gÃ¶rÃ¼nÃ¼m oluÅŸturur. `_Default` bucket'Ä± iÃ§in `_Default` gÃ¶rÃ¼nÃ¼mÃ¼, Data Access denetim loglarÄ± hariÃ§ tÃ¼m loglarÄ± gÃ¶sterir. `_AllLogs` ve `_Default` gÃ¶rÃ¼nÃ¼mleri dÃ¼zenlenemez.

Bir ilkenin **sadece belirli bir Log gÃ¶rÃ¼nÃ¼mÃ¼nÃ¼ kullanmasÄ±na** izin vermek mÃ¼mkÃ¼ndÃ¼r: 

{% code overflow="wrap" %}
```json
{
"bindings": [
{
"members": [
"user:username@gmail.com"
],
"role": "roles/logging.viewAccessor",
"condition": {
"title": "Bucket reader condition example",
"description": "Grants logging.viewAccessor role to user username@gmail.com for the VIEW_ID log view.",
"expression":
"resource.name == \"projects/PROJECT_ID/locations/LOCATION/buckets/BUCKET_NAME/views/VIEW_ID\""
}
}
],
"etag": "BwWd_6eERR4=",
"version": 3
}
```
{% endcode %}

### VarsayÄ±lan GÃ¼nlÃ¼kler

VarsayÄ±lan olarak **Admin Write** iÅŸlemleri (Admin Activity denetim gÃ¼nlÃ¼kleri olarak da adlandÄ±rÄ±lÄ±r) kaydedilir (meta verileri veya yapÄ±landÄ±rma bilgilerini yazma) ve **devre dÄ±ÅŸÄ± bÄ±rakÄ±lamaz**.

Daha sonra, kullanÄ±cÄ± **Data Access denetim gÃ¼nlÃ¼klerini** etkinleÅŸtirebilir, bunlar **Admin Read, Data Write ve Data Write**'dÄ±r.

Her bir gÃ¼nlÃ¼k tÃ¼rÃ¼ hakkÄ±nda daha fazla bilgi iÃ§in belgeleri inceleyebilirsiniz: [https://cloud.google.com/iam/docs/audit-logging](https://cloud.google.com/iam/docs/audit-logging)

Ancak, bu durumun varsayÄ±lan olarak **`GetIamPolicy`** eylemleri ve diÄŸer okuma eylemlerinin **kaydedilmediÄŸi** anlamÄ±na geldiÄŸini unutmayÄ±n. Yani, varsayÄ±lan olarak bir saldÄ±rgan ortamÄ± listelemeye Ã§alÄ±ÅŸÄ±yorsa, sistem yÃ¶neticisi daha fazla gÃ¼nlÃ¼k oluÅŸturmak iÃ§in yapÄ±landÄ±rmadÄ±ysa yakalanmayacaktÄ±r.

Konsolda daha fazla gÃ¼nlÃ¼k etkinleÅŸtirmek iÃ§in sistem yÃ¶neticisinin [https://console.cloud.google.com/iam-admin/audit](https://console.cloud.google.com/iam-admin/audit) adresine gitmesi ve bunlarÄ± etkinleÅŸtirmesi gerekir. Ä°ki farklÄ± seÃ§enek vardÄ±r:

* **VarsayÄ±lan YapÄ±landÄ±rma**: VarsayÄ±lan bir yapÄ±landÄ±rma oluÅŸturmak ve tÃ¼m Admin Read ve/veya Data Read ve/veya Data Write gÃ¼nlÃ¼klerini kaydetmek ve hatta muaf tutulan ilkeleri eklemek mÃ¼mkÃ¼ndÃ¼r:

<figure><img src="../../../.gitbook/assets/image (338).png" alt=""><figcaption></figcaption></figure>

* **Hizmetleri SeÃ§in**: Ya da sadece **gÃ¼nlÃ¼k oluÅŸturmak istediÄŸiniz hizmetleri** ve o belirli hizmet iÃ§in gÃ¼nlÃ¼k tÃ¼rÃ¼nÃ¼ ve muaf tutulan ilkeleri seÃ§ebilirsiniz.

AyrÄ±ca, varsayÄ±lan olarak yalnÄ±zca bu gÃ¼nlÃ¼klerin oluÅŸturulduÄŸunu unutmayÄ±n Ã§Ã¼nkÃ¼ daha fazla gÃ¼nlÃ¼k oluÅŸturmak maliyetleri artÄ±racaktÄ±r.

### Listeleme

`gcloud` komut satÄ±rÄ± aracÄ±, GCP ekosisteminin ayrÄ±lmaz bir parÃ§asÄ±dÄ±r ve kaynaklarÄ±nÄ±zÄ± ve hizmetlerinizi yÃ¶netmenizi saÄŸlar. Ä°ÅŸte `gcloud`'u gÃ¼nlÃ¼k yapÄ±landÄ±rmalarÄ±nÄ±zÄ± yÃ¶netmek ve gÃ¼nlÃ¼k eriÅŸimlerini kontrol etmek iÃ§in nasÄ±l kullanabileceÄŸiniz. 

{% code overflow="wrap" %}
```bash
# List buckets
gcloud logging buckets list
gcloud logging buckets describe <bucket-name> --location <location>

# List log entries: only logs that contain log entries are listed.
gcloud logging logs list

# Get log metrics
gcloud logging metrics list
gcloud logging metrics describe <metric-name>

# Get log sinks
gcloud logging sinks list
gcloud logging sinks describe <sink-name>

# Get log views
gcloud logging views list --bucket <bucket> --location global
gcloud logging views describe --bucket <bucket> --location global <view-id> # view-id is usually the same as the bucket name

# Get log links
gcloud logging links list --bucket _Default --location global
gcloud logging links describe <link-id> --bucket _Default --location global
```
{% endcode %}

**`cloudresourcemanager`** (izinleri BF iÃ§in kullanÄ±lan) gÃ¼nlÃ¼klerini kontrol etmek iÃ§in Ã¶rnek: [https://console.cloud.google.com/logs/query;query=protoPayload.serviceName%3D%22cloudresourcemanager.googleapis.com%22;summaryFields=:false:32:beginning;cursorTimestamp=2024-01-20T00:07:14.482809Z;startTime=2024-01-01T11:12:26.062Z;endTime=2024-02-02T17:12:26.062Z?authuser=2\&project=digital-bonfire-410512](https://console.cloud.google.com/logs/query;query=protoPayload.serviceName%3D%22cloudresourcemanager.googleapis.com%22;summaryFields=:false:32:beginning;cursorTimestamp=2024-01-20T00:07:14.482809Z;startTime=2024-01-01T11:12:26.062Z;endTime=2024-02-02T17:12:26.062Z?authuser=2\&project=digital-bonfire-410512)

**`testIamPermissions`** iÃ§in gÃ¼nlÃ¼k yok:

<figure><img src="../../../.gitbook/assets/image (2) (1) (1).png" alt=""><figcaption></figcaption></figure>

### Post Exploitation

{% content-ref url="../gcp-post-exploitation/gcp-logging-post-exploitation.md" %}
[gcp-logging-post-exploitation.md](../gcp-post-exploitation/gcp-logging-post-exploitation.md)
{% endcontent-ref %}

### Persistence

{% content-ref url="../gcp-persistence/gcp-logging-persistence.md" %}
[gcp-logging-persistence.md](../gcp-persistence/gcp-logging-persistence.md)
{% endcontent-ref %}

## References

* [https://cloud.google.com/logging/docs/logs-views#gcloud](https://cloud.google.com/logging/docs/logs-views#gcloud)
* [https://betterstack.com/community/guides/logging/gcp-logging/](https://betterstack.com/community/guides/logging/gcp-logging/)

{% hint style="success" %}
AWS Hacking Ã¶ÄŸrenin ve pratik yapÄ±n:<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
GCP Hacking Ã¶ÄŸrenin ve pratik yapÄ±n: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**abonelik planlarÄ±nÄ±**](https://github.com/sponsors/carlospolop) kontrol edin!
* **ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n ya da **Twitter'da** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**'i takip edin.**
* **Hacking ipuÃ§larÄ±nÄ± paylaÅŸmak iÃ§in** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna PR gÃ¶nderin.

</details>
{% endhint %}
