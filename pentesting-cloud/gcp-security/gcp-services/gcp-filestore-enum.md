# GCP - Filestore Enum

{% hint style="success" %}
Ucz si i praktykuj Hacking AWS:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Ucz si i praktykuj Hacking GCP: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Wesprzyj HackTricks</summary>

* Sprawd藕 [**plany subskrypcyjne**](https://github.com/sponsors/carlospolop)!
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **led藕** nas na **Twitterze**  [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Dziel si trikami hakerskimi, przesyajc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) na githubie.

</details>
{% endhint %}

## Podstawowe informacje

Google Cloud Filestore to **zarzdzana usuga przechowywania plik贸w** dostosowana do aplikacji potrzebujcych zar贸wno **interfejsu systemu plik贸w, jak i wsp贸dzielonego systemu plik贸w do przechowywania danych**. Ta usuga wyr贸偶nia si oferowaniem udzia贸w plik贸w o wysokiej wydajnoci, kt贸re mo偶na zintegrowa z r贸偶nymi usugami GCP. Jej u偶yteczno przejawia si w scenariuszach, gdzie tradycyjne interfejsy i semantyka systemu plik贸w s kluczowe, takich jak przetwarzanie medi贸w, zarzdzanie treci i tworzenie kopii zapasowych baz danych.

Mo偶esz to por贸wna do dowolnego **repozytorium dokument贸w NFS** - potencjalnego 藕r贸da poufnych informacji.

### Poczenia

Podczas tworzenia instancji Filestore mo偶liwe jest **wybranie sieci, w kt贸rej bdzie dostpna**.

Co wicej, **domylnie wszyscy klienci w wybranej sieci VPC i regionie bd mieli do niej dostp**, jednak偶e mo偶liwe jest **ograniczenie dostpu r贸wnie偶 przez adres IP** lub zakres oraz okrelenie uprawnie dostpu (Administrator, Administrator Widz, Edytor, Widz) dla klienta w zale偶noci od adresu IP.

Mo偶na r贸wnie偶 uzyska do niej dostp za porednictwem **Poczenia z Prywatnym Dostpem do Usugi:**

* Dotycz one sieci VPC i mog by u偶ywane we wszystkich usugach zarzdzanych, takich jak Memorystore, Tensorflow i SQL.
* S **midzy twoj sieci VPC a sieci nale偶c do Google za pomoc poczenia VPC peering**, umo偶liwiajc twoim instancjom i usugom komunikacj wycznie **za pomoc adres贸w IP wewntrznych**.
* Tworz izolowany projekt dla ciebie po stronie producenta usugi, co oznacza, 偶e nie dziel go inni klienci. Bdziesz paci tylko za zasoby, kt贸re udostpnisz.
* VPC peering importuje nowe trasy do twojej sieci VPC

### Kopie zapasowe

Mo偶liwe jest utworzenie **kopii zapasowych udzia贸w plik贸w**. Mog one by p贸藕niej **przywr贸cone w oryginalnej** nowej instancji udziau plik贸w lub w **nowych**.

### Szyfrowanie

Domylnie u偶ywany bdzie **klucz szyfrowania zarzdzany przez Google**, ale mo偶liwe jest wybranie **klucza szyfrowania zarzdzanego przez klienta (CMEK)**.

### Wyliczanie

Jeli znajdziesz dostpny plikstore w projekcie, mo偶esz go **zamontowa** z wewntrz skompromitowanej instancji obliczeniowej. U偶yj poni偶szej komendy, aby sprawdzi, czy istniej jakiekolwiek. 

{% code overflow="wrap" %}
```bash
# Instances
gcloud filestore instances list # Check the IP address
gcloud filestore instances describe --zone <zone> <name> # Check IP and access restrictions

# Backups
gcloud filestore backups list
gcloud filestore backups describe --region <region> <backup>

# Search for NFS shares in a VPC subnet
sudo nmap -n -T5 -Pn -p 2049 --min-parallelism 100 --min-rate 1000 --open 10.99.160.2/20
```
{% endcode %}

{% hint style="danger" %}
Nale偶y pamita, 偶e usuga filestore mo偶e znajdowa si w **cakowicie nowej podsieci utworzonej dla niej** (w ramach Poczenia Dostpu do Usugi Prywatnej, kt贸re jest **peerem VPC**).\
Dlatego mo偶e by konieczne **wyliczenie peer贸w VPC** w celu uruchomienia nmap na tych zakresach sieciowych.

{% code overflow="wrap" %}
```bash
# Get peerings
gcloud compute networks peerings list
# Get routes imported from a peering
gcloud compute networks peerings list-routes <peering-name> --network=<network-name> --region=<region> --direction=INCOMING
```
{% endcode %}
{% endhint %}

### Eskalacja uprawnie i wykorzystanie po wamaniu

Nie ma bezporednich sposob贸w eskalacji uprawnie w usudze GCP, ale korzystajc z niekt贸rych **sztuczek wykorzystania po wamaniu, mo偶na uzyska dostp do danych** i by mo偶e znajdziesz pewne powiadczenia do eskalacji uprawnie:

{% content-ref url="../gcp-post-exploitation/gcp-filestore-post-exploitation.md" %}
[gcp-filestore-post-exploitation.md](../gcp-post-exploitation/gcp-filestore-post-exploitation.md)
{% endcontent-ref %}

### Trwao

{% content-ref url="../gcp-persistence/gcp-filestore-persistence.md" %}
[gcp-filestore-persistence.md](../gcp-persistence/gcp-filestore-persistence.md)
{% endcontent-ref %}

{% hint style="success" %}
Dowiedz si i wicz Hacking AWS:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Dowiedz si i wicz Hacking GCP: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Wesprzyj HackTricks</summary>

* Sprawd藕 [**plany subskrypcyjne**](https://github.com/sponsors/carlospolop)!
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **led藕** nas na **Twitterze**  [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Udostpnij sztuczki hakerskie, przesyajc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
