# GCP - Enumeraci贸n de Filestore

{% hint style="success" %}
Aprende y practica Hacking en AWS: <img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Aprende y practica Hacking en GCP: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Apoya a HackTricks</summary>

* 隆Consulta los [**planes de suscripci贸n**](https://github.com/sponsors/carlospolop)!
* **nete al**  [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s铆guenos** en **Twitter**  [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Comparte trucos de hacking enviando PRs a los** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repositorios de github.

</details>
{% endhint %}

## Informaci贸n B谩sica

Google Cloud Filestore es un servicio de **almacenamiento de archivos administrado** dise帽ado para aplicaciones que necesitan tanto una **interfaz de sistema de archivos como un sistema de archivos compartido para datos**. Este servicio destaca al ofrecer comparticiones de archivos de alto rendimiento, que se pueden integrar con varios servicios de GCP. Su utilidad brilla en escenarios donde las interfaces y sem谩ntica de sistemas de archivos tradicionales son cruciales, como en el procesamiento de medios, la gesti贸n de contenido y la copia de seguridad de bases de datos.

Puedes pensar en esto como cualquier otro **repositorio de documentos compartidos NFS** - una posible fuente de informaci贸n sensible.

### Conexiones

Al crear una instancia de Filestore es posible **seleccionar la red donde va a ser accesible**.

Adem谩s, de forma **predeterminada todos los clientes en la red VPC y regi贸n seleccionadas podr谩n acceder a 茅l**, sin embargo, es posible **restringir el acceso tambi茅n por direcci贸n IP** o rango e indicar el privilegio de acceso (Administrador, Administrador de visualizaci贸n, Editor, Visualizador) que el cliente va a obtener **dependiendo de la direcci贸n IP**.

Tambi茅n puede ser accesible a trav茅s de una **Conexi贸n de Acceso a Servicio Privado:**

* Son por red VPC y se pueden utilizar en todos los servicios administrados como Memorystore, Tensorflow y SQL.
* Son **entre tu red VPC y la red propiedad de Google utilizando un VPC peering**, permitiendo que tus instancias y servicios se comuniquen exclusivamente **utilizando direcciones IP internas**.
* Crea un proyecto aislado para ti en el lado del productor de servicios, lo que significa que ning煤n otro cliente lo comparte. Se te facturar谩 solo por los recursos que provisiones.
* El VPC peering importar谩 nuevas rutas a tu VPC

### Copias de Seguridad

Es posible crear **copias de seguridad de las comparticiones de archivos**. Estas pueden ser luego **restauradas en el origen** de la nueva instancia de Fileshare o en **nuevas**.

### Encriptaci贸n

Por defecto se utilizar谩 una **clave de encriptaci贸n administrada por Google** para encriptar los datos, pero es posible seleccionar una **clave de encriptaci贸n administrada por el cliente (CMEK)**.

### Enumeraci贸n

Si encuentras un filestore disponible en el proyecto, puedes **montarlo** desde tu Instancia de C贸mputo comprometida. Utiliza el siguiente comando para ver si existe alguno.

{% code overflow="wrap" %}
```bash
# Instances
gcloud filestore instances list # Check the IP address
gcloud filestore instances describe --zone <zone> <name> # Check IP and access restrictions

# Backups
gcloud filestore backups list
gcloud filestore backups describe --region <region> <backup>

# Search for NFS shares in a VPC subnet
sudo nmap -n -T5 -Pn -p 2049 --min-parallelism 100 --min-rate 1000 --open 10.99.160.2/20
```
{% endcode %}

{% hint style="danger" %}
Ten en cuenta que un servicio de almacenamiento de archivos podr铆a estar en una **subred completamente nueva creada para 茅l** (dentro de una Conexi贸n de Acceso a Servicios Privados, que es un **VPC peer**).\
Por lo tanto, es posible que necesites **enumerar los VPC peers** para tambi茅n ejecutar nmap en esos rangos de red.

{% code overflow="wrap" %}
```bash
# Get peerings
gcloud compute networks peerings list
# Get routes imported from a peering
gcloud compute networks peerings list-routes <peering-name> --network=<network-name> --region=<region> --direction=INCOMING
```
{% endcode %}
{% endhint %}

### Escalada de Privilegios y Post Explotaci贸n

No hay formas de escalar privilegios en GCP abusando directamente de este servicio, pero utilizando algunos trucos de **Post Explotaci贸n es posible acceder a los datos** y tal vez puedas encontrar algunas credenciales para escalar privilegios:

{% content-ref url="../gcp-post-exploitation/gcp-filestore-post-exploitation.md" %}
[gcp-filestore-post-exploitation.md](../gcp-post-exploitation/gcp-filestore-post-exploitation.md)
{% endcontent-ref %}

### Persistencia

{% content-ref url="../gcp-persistence/gcp-filestore-persistence.md" %}
[gcp-filestore-persistence.md](../gcp-persistence/gcp-filestore-persistence.md)
{% endcontent-ref %}

{% hint style="success" %}
Aprende y practica Hacking en AWS:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Aprende y practica Hacking en GCP: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Apoya a HackTricks</summary>

* 隆Consulta los [**planes de suscripci贸n**](https://github.com/sponsors/carlospolop)!
* **nete al**  [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s铆guenos** en **Twitter**  [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Comparte trucos de hacking enviando PRs a los repositorios de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
{% endhint %}
