# GCP - Filestore Enum

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Basic Information

Google Cloud Filestore je **upravljana usluga za skladiÅ¡tenje datoteka** prilagoÄ‘ena aplikacijama koje zahtevaju i **interfejs datoteÄnog sistema i zajedniÄki datoteÄni sistem za podatke**. Ova usluga se istiÄe pruÅ¾anjem visokih performansi deljenja datoteka, koja se mogu integrisati sa raznim GCP uslugama. Njena korisnost se posebno istiÄe u scenarijima gde su tradicionalni interfejsi i semantika datoteÄnih sistema kljuÄni, kao Å¡to su obrada medija, upravljanje sadrÅ¾ajem i pravljenje rezervnih kopija baza podataka.

MoÅ¾ete to zamisliti kao bilo koji drugi **NFS** **zajedniÄki repozitorijum dokumenata -** potencijalni izvor osetljivih informacija.

### Connections

Kada kreirate Filestore instancu, moguÄ‡e je **izabrati mreÅ¾u na kojoj Ä‡e biti dostupna**.

Å taviÅ¡e, **podrazumevano Ä‡e svi klijenti na odabranoj VPC mreÅ¾i i regionu moÄ‡i da joj pristupe**, meÄ‘utim, moguÄ‡e je **ograniÄiti pristup i po IP adresi** ili opsegu i naznaÄiti privilegije pristupa (Admin, Admin Viewer, Editor, Viewer) koje Ä‡e korisnik klijenta dobiti **u zavisnosti od IP adrese.**

TakoÄ‘e moÅ¾e biti dostupna putem **Privatne usluge pristupne veze:**

* Su per VPC mreÅ¾u i mogu se koristiti Å¡irom svih upravljanih usluga kao Å¡to su Memorystore, Tensorflow i SQL.
* Su **izmeÄ‘u vaÅ¡e VPC mreÅ¾e i mreÅ¾e koju poseduje Google koristeÄ‡i VPC peering**, omoguÄ‡avajuÄ‡i vaÅ¡im instancama i uslugama da komuniciraju iskljuÄivo koristeÄ‡i **unutraÅ¡nje IP adrese**.
* Kreirajte izolovani projekat za vas na strani proizvoÄ‘aÄa usluga, Å¡to znaÄi da nijedan drugi kupac ne deli tu uslugu. BiÄ‡ete naplaÄ‡eni samo za resurse koje obezbedite.
* VPC peering Ä‡e uvesti nove rute u vaÅ¡u VPC

### Backups

MoguÄ‡e je kreirati **rezervne kopije deljenja datoteka**. Ove se mogu kasnije **vratiti u izvor** novu Fileshare instancu ili u **nove**.

### Encryption

Podrazumevano Ä‡e se koristiti **Google-upravljani kljuÄ za enkripciju** za enkripciju podataka, ali je moguÄ‡e izabrati **KljuÄ za enkripciju koji upravlja kupac (CMEK)**.

### Enumeration

Ako pronaÄ‘ete filestore dostupan u projektu, moÅ¾ete ga **montirati** iz vaÅ¡e kompromitovane Compute Instance. Koristite sledeÄ‡u komandu da vidite da li neki postoje.

{% code overflow="wrap" %}
```bash
# Instances
gcloud filestore instances list # Check the IP address
gcloud filestore instances describe --zone <zone> <name> # Check IP and access restrictions

# Backups
gcloud filestore backups list
gcloud filestore backups describe --region <region> <backup>

# Search for NFS shares in a VPC subnet
sudo nmap -n -T5 -Pn -p 2049 --min-parallelism 100 --min-rate 1000 --open 10.99.160.2/20
```
{% endcode %}

{% hint style="danger" %}
Imajte na umu da filestore usluga moÅ¾e biti u **potpuno novoj podmreÅ¾i kreiranoj za nju** (unutar Privatne Servisne Pristupne Konekcije, koja je **VPC peer**).\
Tako da moÅ¾da treba da **enumeriÅ¡ete VPC peer-ove** da biste takoÄ‘e pokrenuli nmap preko tih mreÅ¾nih opsega.

{% code overflow="wrap" %}
```bash
# Get peerings
gcloud compute networks peerings list
# Get routes imported from a peering
gcloud compute networks peerings list-routes <peering-name> --network=<network-name> --region=<region> --direction=INCOMING
```
{% endcode %}
{% endhint %}

### Eskalacija privilegija i post eksploatacija

Ne postoje naÄini za eskalaciju privilegija u GCP direktnim zloupotrebom ove usluge, ali koriÅ¡Ä‡enjem nekih **trikova post eksploatacije moguÄ‡e je dobiti pristup podacima** i moÅ¾da moÅ¾ete pronaÄ‡i neke akreditive za eskalaciju privilegija:

{% content-ref url="../gcp-post-exploitation/gcp-filestore-post-exploitation.md" %}
[gcp-filestore-post-exploitation.md](../gcp-post-exploitation/gcp-filestore-post-exploitation.md)
{% endcontent-ref %}

### Postojanost

{% content-ref url="../gcp-persistence/gcp-filestore-persistence.md" %}
[gcp-filestore-persistence.md](../gcp-persistence/gcp-filestore-persistence.md)
{% endcontent-ref %}

{% hint style="success" %}
UÄite i veÅ¾bajte AWS Hacking:<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
UÄite i veÅ¾bajte GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>PodrÅ¾ite HackTricks</summary>

* Proverite [**planove pretplate**](https://github.com/sponsors/carlospolop)!
* **PridruÅ¾ite se** ğŸ’¬ [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili **pratite** nas na **Twitteru** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Podelite hakerske trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
{% endhint %}
