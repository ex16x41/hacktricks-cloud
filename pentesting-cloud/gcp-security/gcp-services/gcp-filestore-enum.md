# GCP - Filestore Enum

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** 💬 [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Basic Information

Google Cloud Filestore es un **servicio de almacenamiento de archivos gestionado** diseñado para aplicaciones que necesitan tanto una **interfaz de sistema de archivos como un sistema de archivos compartido para datos**. Este servicio se destaca al ofrecer comparticiones de archivos de alto rendimiento, que pueden integrarse con varios servicios de GCP. Su utilidad brilla en escenarios donde las interfaces y semánticas de sistemas de archivos tradicionales son cruciales, como en el procesamiento de medios, la gestión de contenido y la copia de seguridad de bases de datos.

Puedes pensar en esto como cualquier otro **repositorio de documentos compartidos NFS** - una posible fuente de información sensible.

### Connections

Al crear una instancia de Filestore, es posible **seleccionar la red donde va a ser accesible**.

Además, por **defecto, todos los clientes en la red VPC seleccionada y región podrán acceder a ella**, sin embargo, es posible **restringir el acceso también por dirección IP** o rango e indicar el privilegio de acceso (Admin, Admin Viewer, Editor, Viewer) que el cliente va a obtener **dependiendo de la dirección IP.**

También puede ser accesible a través de una **Conexión de Acceso a Servicio Privado:**

* Son por red VPC y pueden ser utilizados en todos los servicios gestionados como Memorystore, Tensorflow y SQL.
* Son **entre tu red VPC y la red propiedad de Google usando un emparejamiento de VPC**, permitiendo que tus instancias y servicios se comuniquen exclusivamente **usando direcciones IP internas**.
* Crea un proyecto aislado para ti en el lado del productor de servicios, lo que significa que ningún otro cliente lo comparte. Se te cobrará solo por los recursos que aprovisionas.
* El emparejamiento de VPC importará nuevas rutas a tu VPC.

### Backups

Es posible crear **copias de seguridad de las comparticiones de archivos**. Estas pueden ser **restauradas más tarde en la instancia de Fileshare de origen** o en **nuevas**.

### Encryption

Por defecto, se utilizará una **clave de cifrado gestionada por Google** para cifrar los datos, pero es posible seleccionar una **clave de cifrado gestionada por el cliente (CMEK)**.

### Enumeration

Si encuentras un filestore disponible en el proyecto, puedes **montarlo** desde tu Instancia de Cómputo comprometida. Usa el siguiente comando para ver si existen. 

{% code overflow="wrap" %}
```bash
# Instances
gcloud filestore instances list # Check the IP address
gcloud filestore instances describe --zone <zone> <name> # Check IP and access restrictions

# Backups
gcloud filestore backups list
gcloud filestore backups describe --region <region> <backup>

# Search for NFS shares in a VPC subnet
sudo nmap -n -T5 -Pn -p 2049 --min-parallelism 100 --min-rate 1000 --open 10.99.160.2/20
```
{% endcode %}

{% hint style="danger" %}
Tenga en cuenta que un servicio de filestore podría estar en una **subred completamente nueva creada para él** (dentro de una Conexión de Acceso a Servicio Privado, que es un **peer de VPC**).\
Por lo tanto, es posible que necesite **enumerar peers de VPC** para también ejecutar nmap sobre esos rangos de red.

{% code overflow="wrap" %}
```bash
# Get peerings
gcloud compute networks peerings list
# Get routes imported from a peering
gcloud compute networks peerings list-routes <peering-name> --network=<network-name> --region=<region> --direction=INCOMING
```
{% endcode %}
{% endhint %}

### Escalación de Privilegios y Post Explotación

No hay formas de escalar privilegios en GCP abusando directamente de este servicio, pero usando algunos **trucos de Post Explotación es posible obtener acceso a los datos** y tal vez puedas encontrar algunas credenciales para escalar privilegios:

{% content-ref url="../gcp-post-exploitation/gcp-filestore-post-exploitation.md" %}
[gcp-filestore-post-exploitation.md](../gcp-post-exploitation/gcp-filestore-post-exploitation.md)
{% endcontent-ref %}

### Persistencia

{% content-ref url="../gcp-persistence/gcp-filestore-persistence.md" %}
[gcp-filestore-persistence.md](../gcp-persistence/gcp-filestore-persistence.md)
{% endcontent-ref %}

{% hint style="success" %}
Aprende y practica Hacking en AWS:<img src="../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">\
Aprende y practica Hacking en GCP: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Apoya a HackTricks</summary>

* Revisa los [**planes de suscripción**](https://github.com/sponsors/carlospolop)!
* **Únete al** 💬 [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **síguenos** en **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Comparte trucos de hacking enviando PRs a los** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repositorios de github.

</details>
{% endhint %}
