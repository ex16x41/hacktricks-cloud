# GCP - Filestore Enum

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Basic Information

O Google Cloud Filestore √© um **servi√ßo de armazenamento de arquivos gerenciado** voltado para aplica√ß√µes que necessitam tanto de uma **interface de sistema de arquivos quanto de um sistema de arquivos compartilhado para dados**. Este servi√ßo se destaca ao oferecer compartilhamentos de arquivos de alto desempenho, que podem ser integrados com v√°rios servi√ßos do GCP. Sua utilidade brilha em cen√°rios onde interfaces e sem√¢nticas de sistema de arquivos tradicionais s√£o cruciais, como em processamento de m√≠dia, gerenciamento de conte√∫do e backup de bancos de dados.

Voc√™ pode pensar nisso como qualquer outro **reposit√≥rio de documentos compartilhados NFS -** uma fonte potencial de informa√ß√µes sens√≠veis.

### Connections

Ao criar uma inst√¢ncia do Filestore, √© poss√≠vel **selecionar a rede onde ela estar√° acess√≠vel**.

Al√©m disso, por **padr√£o, todos os clientes na rede VPC selecionada e regi√£o poder√£o acess√°-la**, no entanto, √© poss√≠vel **restringir o acesso tamb√©m por endere√ßo IP** ou intervalo e indicar o privil√©gio de acesso (Admin, Admin Viewer, Editor, Viewer) que o cliente receber√° **dependendo do endere√ßo IP.**

Ela tamb√©m pode ser acessada via uma **Conex√£o de Acesso a Servi√ßo Privado:**

* S√£o por rede VPC e podem ser usadas em todos os servi√ßos gerenciados, como Memorystore, Tensorflow e SQL.
* S√£o **entre sua rede VPC e a rede de propriedade do Google usando um peering VPC**, permitindo que suas inst√¢ncias e servi√ßos se comuniquem exclusivamente **usando endere√ßos IP internos**.
* Crie um projeto isolado para voc√™ no lado do produtor de servi√ßos, significando que nenhum outro cliente o compartilha. Voc√™ ser√° cobrado apenas pelos recursos que provisionar.
* O peering VPC importar√° novas rotas para sua VPC.

### Backups

√â poss√≠vel criar **backups dos compartilhamentos de arquivos**. Estes podem ser posteriormente **restaurados na inst√¢ncia de Fileshare de origem** ou em **novas**.

### Encryption

Por padr√£o, uma **chave de criptografia gerenciada pelo Google** ser√° usada para criptografar os dados, mas √© poss√≠vel selecionar uma **chave de criptografia gerenciada pelo cliente (CMEK)**.

### Enumeration

Se voc√™ encontrar um filestore dispon√≠vel no projeto, pode **mont√°-lo** a partir da sua Inst√¢ncia de Computa√ß√£o comprometida. Use o seguinte comando para ver se algum existe.

{% code overflow="wrap" %}
```bash
# Instances
gcloud filestore instances list # Check the IP address
gcloud filestore instances describe --zone <zone> <name> # Check IP and access restrictions

# Backups
gcloud filestore backups list
gcloud filestore backups describe --region <region> <backup>

# Search for NFS shares in a VPC subnet
sudo nmap -n -T5 -Pn -p 2049 --min-parallelism 100 --min-rate 1000 --open 10.99.160.2/20
```
{% endcode %}

{% hint style="danger" %}
Observe que um servi√ßo de filestore pode estar em uma **sub-rede completamente nova criada para ele** (dentro de uma Conex√£o de Acesso a Servi√ßo Privado, que √© um **peer VPC**).\
Portanto, voc√™ pode precisar **enumerar peers VPC** para tamb√©m executar nmap sobre esses intervalos de rede.

{% code overflow="wrap" %}
```bash
# Get peerings
gcloud compute networks peerings list
# Get routes imported from a peering
gcloud compute networks peerings list-routes <peering-name> --network=<network-name> --region=<region> --direction=INCOMING
```
{% endcode %}
{% endhint %}

### Escalada de Privil√©gios & P√≥s Explora√ß√£o

N√£o h√° maneiras de escalar privil√©gios no GCP abusando diretamente deste servi√ßo, mas usando alguns **truques de P√≥s Explora√ß√£o √© poss√≠vel obter acesso aos dados** e talvez voc√™ consiga encontrar algumas credenciais para escalar privil√©gios:

{% content-ref url="../gcp-post-exploitation/gcp-filestore-post-exploitation.md" %}
[gcp-filestore-post-exploitation.md](../gcp-post-exploitation/gcp-filestore-post-exploitation.md)
{% endcontent-ref %}

### Persist√™ncia

{% content-ref url="../gcp-persistence/gcp-filestore-persistence.md" %}
[gcp-filestore-persistence.md](../gcp-persistence/gcp-filestore-persistence.md)
{% endcontent-ref %}

{% hint style="success" %}
Aprenda e pratique Hacking AWS:<img src="../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">\
Aprenda e pratique Hacking GCP: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Confira os [**planos de assinatura**](https://github.com/sponsors/carlospolop)!
* **Junte-se ao** üí¨ [**grupo do Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga**-nos no **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe truques de hacking enviando PRs para os reposit√≥rios do** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
{% endhint %}
