# GCP - Filestore Enum

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Basic Information

Google Cloud Filestore est un **service de stockage de fichiers g√©r√©** con√ßu pour les applications ayant besoin √† la fois d'une **interface de syst√®me de fichiers et d'un syst√®me de fichiers partag√© pour les donn√©es**. Ce service excelle en offrant des partages de fichiers haute performance, qui peuvent √™tre int√©gr√©s avec divers services GCP. Son utilit√© se manifeste dans des sc√©narios o√π les interfaces et s√©mantiques de syst√®mes de fichiers traditionnels sont cruciales, comme dans le traitement des m√©dias, la gestion de contenu et la sauvegarde de bases de donn√©es.

Vous pouvez le consid√©rer comme tout autre **NFS** **d√©p√¥t de documents partag√© -** une source potentielle d'informations sensibles.

### Connections

Lors de la cr√©ation d'une instance Filestore, il est possible de **s√©lectionner le r√©seau o√π elle sera accessible**.

De plus, par **d√©faut, tous les clients sur le r√©seau VPC s√©lectionn√© et la r√©gion pourront y acc√©der**, cependant, il est possible de **restreindre l'acc√®s √©galement par adresse IP** ou plage et d'indiquer le privil√®ge d'acc√®s (Admin, Admin Viewer, Editor, Viewer) que l'utilisateur client obtiendra **en fonction de l'adresse IP.**

Elle peut √©galement √™tre accessible via une **connexion d'acc√®s de service priv√© :**

* Sont par r√©seau VPC et peuvent √™tre utilis√©es √† travers tous les services g√©r√©s tels que Memorystore, Tensorflow et SQL.
* Sont **entre votre r√©seau VPC et un r√©seau appartenant √† Google utilisant un peering VPC**, permettant √† vos instances et services de communiquer exclusivement en **utilisant des adresses IP internes**.
* Cr√©ez un projet isol√© pour vous du c√¥t√© du producteur de services, ce qui signifie qu'aucun autre client ne le partage. Vous serez factur√© uniquement pour les ressources que vous provisionnez.
* Le peering VPC importera de nouvelles routes vers votre VPC.

### Backups

Il est possible de cr√©er des **sauvegardes des partages de fichiers**. Celles-ci peuvent √™tre ensuite **restaur√©es dans l'instance de Fileshare d'origine** ou dans **de nouvelles**.

### Encryption

Par d√©faut, une **cl√© de chiffrement g√©r√©e par Google** sera utilis√©e pour chiffrer les donn√©es, mais il est possible de s√©lectionner une **cl√© de chiffrement g√©r√©e par le client (CMEK)**.

### Enumeration

Si vous trouvez un filestore disponible dans le projet, vous pouvez **le monter** depuis votre instance Compute compromise. Utilisez la commande suivante pour voir s'il en existe. 

{% code overflow="wrap" %}
```bash
# Instances
gcloud filestore instances list # Check the IP address
gcloud filestore instances describe --zone <zone> <name> # Check IP and access restrictions

# Backups
gcloud filestore backups list
gcloud filestore backups describe --region <region> <backup>

# Search for NFS shares in a VPC subnet
sudo nmap -n -T5 -Pn -p 2049 --min-parallelism 100 --min-rate 1000 --open 10.99.160.2/20
```
{% endcode %}

{% hint style="danger" %}
Notez qu'un service filestore pourrait √™tre dans un **sous-r√©seau compl√®tement nouveau cr√©√© pour lui** (√† l'int√©rieur d'une connexion d'acc√®s de service priv√©, qui est un **pair VPC**).\
Vous pourriez donc avoir besoin d'**√©num√©rer les pairs VPC** pour √©galement ex√©cuter nmap sur ces plages de r√©seau.

{% code overflow="wrap" %}
```bash
# Get peerings
gcloud compute networks peerings list
# Get routes imported from a peering
gcloud compute networks peerings list-routes <peering-name> --network=<network-name> --region=<region> --direction=INCOMING
```
{% endcode %}
{% endhint %}

### Escalade de privil√®ges & Post Exploitation

Il n'y a pas de moyens d'escalader les privil√®ges dans GCP en abusant directement de ce service, mais en utilisant quelques **astuces de Post Exploitation, il est possible d'acc√©der aux donn√©es** et peut-√™tre que vous pouvez trouver des identifiants pour escalader les privil√®ges :

{% content-ref url="../gcp-post-exploitation/gcp-filestore-post-exploitation.md" %}
[gcp-filestore-post-exploitation.md](../gcp-post-exploitation/gcp-filestore-post-exploitation.md)
{% endcontent-ref %}

### Persistance

{% content-ref url="../gcp-persistence/gcp-filestore-persistence.md" %}
[gcp-filestore-persistence.md](../gcp-persistence/gcp-filestore-persistence.md)
{% endcontent-ref %}

{% hint style="success" %}
Apprenez & pratiquez le Hacking AWS :<img src="../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">\
Apprenez & pratiquez le Hacking GCP : <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Soutenir HackTricks</summary>

* Consultez les [**plans d'abonnement**](https://github.com/sponsors/carlospolop) !
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez-nous sur** **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Partagez des astuces de hacking en soumettant des PRs aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) d√©p√¥ts github.

</details>
{% endhint %}
