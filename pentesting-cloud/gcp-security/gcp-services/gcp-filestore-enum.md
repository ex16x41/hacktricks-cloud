# GCP - Filestore Enum

{% hint style="success" %}
Leer & oefen AWS Hacking:<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
Leer & oefen GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Kyk na die [**subskripsie planne**](https://github.com/sponsors/carlospolop)!
* **Sluit aan by die** 💬 [**Discord groep**](https://discord.gg/hRep4RUj7f) of die [**telegram groep**](https://t.me/peass) of **volg** ons op **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Deel hacking truuks deur PRs in te dien na die** [**HackTricks**](https://github.com/carlospolop/hacktricks) en [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Basiese Inligting

Google Cloud Filestore is 'n **bestuurde lêeropbergingsdiens** wat ontwerp is vir toepassings wat 'n **lêerstelsel koppelvlak en 'n gedeelde lêerstelsel vir data** benodig. Hierdie diens blink uit deur hoë-prestasie lêer deel, wat geïntegreer kan word met verskeie GCP dienste. Sy nut skyn in scenario's waar tradisionele lêerstelsel koppelvlakke en semantiek van kardinale belang is, soos in media verwerking, inhoud bestuur, en die rugsteun van databasisse.

Jy kan dit beskou as enige ander **NFS** **gedeelde dokumentbewaarplek -** 'n potensiële bron van sensitiewe inligting.

### Verbindinge

Wanneer jy 'n Filestore instansie skep, is dit moontlik om die **netwerk te kies waar dit toeganklik gaan wees**.

Boonop, **standaard kan alle kliënte op die geselekteerde VPC netwerk en streek dit toegang hê**, egter, dit is moontlik om die toegang ook per IP adres of reeks te **beperk** en die toegang regte (Admin, Admin Viewer, Editor, Viewer) aan te dui wat die kliënt gaan kry **afhangende van die IP adres.**

Dit kan ook toeganklik wees via 'n **Privaat Diens Toegang Verbinding:**

* Is per VPC netwerk en kan gebruik word oor alle bestuurde dienste soos Memorystore, Tensorflow en SQL.
* Is **tussen jou VPC netwerk en netwerk besit deur Google met 'n VPC peering**, wat jou instansies en dienste in staat stel om eksklusief te kommunikeer deur **interne IP adresse** te gebruik.
* Skep 'n geïsoleerde projek vir jou aan die diens-producer kant, wat beteken dat geen ander kliënte dit deel nie. Jy sal slegs vir die hulpbronne wat jy voorsien, gefaktureer word.
* Die VPC peering sal nuwe roetes na jou VPC invoer.

### Rugsteun

Dit is moontlik om **rugsteun van die lêer dele** te skep. Hierdie kan later **herstel word in die oorsprong** nuwe Fileshare instansie of in **nuwe**.

### Enkripsie

Standaard sal 'n **Google-beheerde enkripsiesleutel** gebruik word om die data te enkripteer, maar dit is moontlik om 'n **Kliënt-beheerde enkripsiesleutel (CMEK)** te kies.

### Enumerasie

As jy 'n filestore in die projek vind, kan jy dit **monteer** vanuit jou gecompromitteerde Compute Instansie. Gebruik die volgende opdrag om te sien of enige bestaan. 

{% code overflow="wrap" %}
```bash
# Instances
gcloud filestore instances list # Check the IP address
gcloud filestore instances describe --zone <zone> <name> # Check IP and access restrictions

# Backups
gcloud filestore backups list
gcloud filestore backups describe --region <region> <backup>

# Search for NFS shares in a VPC subnet
sudo nmap -n -T5 -Pn -p 2049 --min-parallelism 100 --min-rate 1000 --open 10.99.160.2/20
```
{% endcode %}

{% hint style="danger" %}
Let daarop dat 'n filestore-diens dalk in 'n **heeltemal nuwe subnetwerk geskep vir dit** (binne 'n Private Service Access Connection, wat 'n **VPC-peer** is).\
So jy mag nodig hê om **VPC-peers** te **enumereer** om ook nmap oor daardie netwerkreekse te laat loop.

{% code overflow="wrap" %}
```bash
# Get peerings
gcloud compute networks peerings list
# Get routes imported from a peering
gcloud compute networks peerings list-routes <peering-name> --network=<network-name> --region=<region> --direction=INCOMING
```
{% endcode %}
{% endhint %}

### Privilege Escalation & Post Exploitation

Daar is nie maniere om voorregte in GCP direk te verhoog deur hierdie diens te misbruik nie, maar deur sommige **Post Exploitation truuks is dit moontlik om toegang tot die data te verkry** en dalk kan jy 'n paar akrediteerbare inligting vind om voorregte te verhoog:

{% content-ref url="../gcp-post-exploitation/gcp-filestore-post-exploitation.md" %}
[gcp-filestore-post-exploitation.md](../gcp-post-exploitation/gcp-filestore-post-exploitation.md)
{% endcontent-ref %}

### Persistence

{% content-ref url="../gcp-persistence/gcp-filestore-persistence.md" %}
[gcp-filestore-persistence.md](../gcp-persistence/gcp-filestore-persistence.md)
{% endcontent-ref %}

{% hint style="success" %}
Leer & oefen AWS Hacking:<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
Leer & oefen GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Kyk na die [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Sluit aan by die** 💬 [**Discord groep**](https://discord.gg/hRep4RUj7f) of die [**telegram groep**](https://t.me/peass) of **volg** ons op **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Deel hacking truuks deur PRs in te dien na die** [**HackTricks**](https://github.com/carlospolop/hacktricks) en [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
