# GCP - Filestore Enum

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the**  [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter**  [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Podstawowe informacje

Google Cloud Filestore to **zarzdzana usuga przechowywania plik贸w**, dostosowana do aplikacji potrzebujcych zar贸wno **interfejsu systemu plik贸w, jak i wsp贸dzielonego systemu plik贸w dla danych**. Usuga ta wyr贸偶nia si oferowaniem wydajnych wsp贸dzielonych zasob贸w plikowych, kt贸re mo偶na zintegrowa z r贸偶nymi usugami GCP. Jej u偶yteczno objawia si w scenariuszach, w kt贸rych tradycyjne interfejsy i semantyka systemu plik贸w s kluczowe, takich jak przetwarzanie medi贸w, zarzdzanie treci i tworzenie kopii zapasowych baz danych.

Mo偶na to por贸wna do ka偶dego innego **NFS** **wsp贸dzielonego repozytorium dokument贸w -** potencjalnego 藕r贸da wra偶liwych informacji.

### Poczenia

Podczas tworzenia instancji Filestore mo偶na **wybra sie, w kt贸rej bdzie dostpna**.

Ponadto, **domylnie wszyscy klienci w wybranej sieci VPC i regionie bd mogli uzyska do niej dostp**, jednak mo偶liwe jest **ograniczenie dostpu r贸wnie偶 wedug adresu IP** lub zakresu oraz wskazanie uprawnie dostpu (Admin, Admin Viewer, Editor, Viewer), kt贸re klient otrzyma **w zale偶noci od adresu IP.**

Mo偶na r贸wnie偶 uzyska dostp za pomoc **Poczenia z Prywatnym Dostpem do Usug:**

* S per sie VPC i mog by u偶ywane w ramach wszystkich zarzdzanych usug, takich jak Memorystore, Tensorflow i SQL.
* S **midzy twoj sieci VPC a sieci nale偶c do Google przy u偶yciu poczenia VPC**, umo偶liwiajc twoim instancjom i usugom komunikacj wycznie za pomoc **wewntrznych adres贸w IP**.
* Tworz izolowany projekt dla ciebie po stronie producenta usugi, co oznacza, 偶e 偶aden inny klient go nie dzieli. Bdziesz obci偶any tylko za zasoby, kt贸re przydzielisz.
* Poczenie VPC zaimportuje nowe trasy do twojej VPC.

### Kopie zapasowe

Mo偶liwe jest tworzenie **kopii zapasowych wsp贸dzielonych plik贸w**. Mog by one p贸藕niej **przywracane w oryginalnej** nowej instancji Fileshare lub w **nowych**.

### Szyfrowanie

Domylnie u偶ywany bdzie **klucz szyfrowania zarzdzany przez Google** do szyfrowania danych, ale mo偶liwe jest wybranie **klucza szyfrowania zarzdzanego przez klienta (CMEK)**.

### Enumeracja

Jeli znajdziesz filestore dostpny w projekcie, mo偶esz **zamontowa go** z poziomu swojej skompromitowanej instancji Compute. U偶yj nastpujcego polecenia, aby sprawdzi, czy jakie istniej.

{% code overflow="wrap" %}
```bash
# Instances
gcloud filestore instances list # Check the IP address
gcloud filestore instances describe --zone <zone> <name> # Check IP and access restrictions

# Backups
gcloud filestore backups list
gcloud filestore backups describe --region <region> <backup>

# Search for NFS shares in a VPC subnet
sudo nmap -n -T5 -Pn -p 2049 --min-parallelism 100 --min-rate 1000 --open 10.99.160.2/20
```
{% endcode %}

{% hint style="danger" %}
Zauwa偶, 偶e usuga filestore mo偶e znajdowa si w **cakowicie nowej podsieci utworzonej dla niej** (w ramach Poczenia Prywatnego Dostpu do Usug, kt贸re jest **VPC peer**).\
Mo偶esz wic potrzebowa **enumerowa VPC peers**, aby r贸wnie偶 uruchomi nmap w tych zakresach sieci.

{% code overflow="wrap" %}
```bash
# Get peerings
gcloud compute networks peerings list
# Get routes imported from a peering
gcloud compute networks peerings list-routes <peering-name> --network=<network-name> --region=<region> --direction=INCOMING
```
{% endcode %}
{% endhint %}

### Eskalacja Uprawnie i Po Eksploatacji

Nie ma sposob贸w na eskalacj uprawnie w GCP bezporednio wykorzystujc t usug, ale u偶ywajc kilku **sztuczek po eksploatacji, mo偶liwe jest uzyskanie dostpu do danych** i by mo偶e znajdziesz jakie powiadczenia do eskalacji uprawnie:

{% content-ref url="../gcp-post-exploitation/gcp-filestore-post-exploitation.md" %}
[gcp-filestore-post-exploitation.md](../gcp-post-exploitation/gcp-filestore-post-exploitation.md)
{% endcontent-ref %}

### Utrzymywanie

{% content-ref url="../gcp-persistence/gcp-filestore-persistence.md" %}
[gcp-filestore-persistence.md](../gcp-persistence/gcp-filestore-persistence.md)
{% endcontent-ref %}

{% hint style="success" %}
Ucz si i wicz Hacking AWS:<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Ucz si i wicz Hacking GCP: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Wsparcie dla HackTricks</summary>

* Sprawd藕 [**plany subskrypcyjne**](https://github.com/sponsors/carlospolop)!
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **led藕** nas na **Twitterze**  [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Dziel si sztuczkami hackingowymi, przesyajc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repozytori贸w na githubie.

</details>
{% endhint %}
