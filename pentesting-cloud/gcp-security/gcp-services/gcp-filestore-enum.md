# GCP - Filestore Enum

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** 💬 [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Podstawowe informacje

Google Cloud Filestore to **zarządzana usługa przechowywania plików**, dostosowana do aplikacji potrzebujących zarówno **interfejsu systemu plików, jak i współdzielonego systemu plików dla danych**. Usługa ta wyróżnia się wysokowydajnymi udostępnieniami plików, które można integrować z różnymi usługami GCP. Jej użyteczność objawia się w scenariuszach, w których tradycyjne interfejsy i semantyka systemu plików są kluczowe, takich jak przetwarzanie mediów, zarządzanie treścią i tworzenie kopii zapasowych baz danych.

Można to porównać do każdego innego **repozytorium dokumentów NFS** - potencjalnego źródła wrażliwych informacji.

### Połączenia

Podczas tworzenia instancji Filestore można **wybrać sieć, w której będzie dostępna**.

Ponadto, **domyślnie wszyscy klienci w wybranej sieci VPC i regionie będą mogli uzyskać do niej dostęp**, jednak możliwe jest również **ograniczenie dostępu według adresu IP** lub zakresu oraz wskazanie uprawnień dostępu (Admin, Admin Viewer, Editor, Viewer), które użytkownik klienta otrzyma **w zależności od adresu IP.**

Można również uzyskać dostęp za pomocą **Połączenia z Prywatnym Dostępem do Usług:**

* Są per sieć VPC i mogą być używane w ramach wszystkich zarządzanych usług, takich jak Memorystore, Tensorflow i SQL.
* Są **między twoją siecią VPC a siecią należącą do Google przy użyciu połączenia VPC**, umożliwiając komunikację twoich instancji i usług wyłącznie za pomocą **wewnętrznych adresów IP**.
* Tworzą izolowany projekt dla ciebie po stronie producenta usługi, co oznacza, że żaden inny klient go nie dzieli. Będziesz obciążany tylko za zasoby, które przydzielisz.
* Połączenie VPC zaimportuje nowe trasy do twojej VPC.

### Kopie zapasowe

Możliwe jest tworzenie **kopii zapasowych udostępnień plików**. Mogą być one później **przywracane w oryginalnej** nowej instancji Fileshare lub w **nowych**.

### Szyfrowanie

Domyślnie używany będzie **klucz szyfrowania zarządzany przez Google** do szyfrowania danych, ale możliwe jest wybranie **klucza szyfrowania zarządzanego przez klienta (CMEK)**.

### Enumeracja

Jeśli znajdziesz dostępny filestore w projekcie, możesz **zamontować go** z poziomu swojej skompromitowanej instancji Compute. Użyj następującego polecenia, aby sprawdzić, czy jakiekolwiek istnieją. 

{% code overflow="wrap" %}
```bash
# Instances
gcloud filestore instances list # Check the IP address
gcloud filestore instances describe --zone <zone> <name> # Check IP and access restrictions

# Backups
gcloud filestore backups list
gcloud filestore backups describe --region <region> <backup>

# Search for NFS shares in a VPC subnet
sudo nmap -n -T5 -Pn -p 2049 --min-parallelism 100 --min-rate 1000 --open 10.99.160.2/20
```
{% endcode %}

{% hint style="danger" %}
Zauważ, że usługa filestore może znajdować się w **całkowicie nowej podsieci utworzonej dla niej** (w ramach Połączenia Prywatnego Dostępu do Usług, które jest **VPC peer**).\
Możesz więc potrzebować **enumerować VPC peers**, aby również uruchomić nmap w tych zakresach sieci.

{% code overflow="wrap" %}
```bash
# Get peerings
gcloud compute networks peerings list
# Get routes imported from a peering
gcloud compute networks peerings list-routes <peering-name> --network=<network-name> --region=<region> --direction=INCOMING
```
{% endcode %}
{% endhint %}

### Eskalacja Uprawnień i Po Eksploatacji

Nie ma sposobów na eskalację uprawnień w GCP bezpośrednio wykorzystując tę usługę, ale używając niektórych **sztuczek po eksploatacji, możliwe jest uzyskanie dostępu do danych** i być może znajdziesz jakieś poświadczenia do eskalacji uprawnień:

{% content-ref url="../gcp-post-exploitation/gcp-filestore-post-exploitation.md" %}
[gcp-filestore-post-exploitation.md](../gcp-post-exploitation/gcp-filestore-post-exploitation.md)
{% endcontent-ref %}

### Utrzymywanie

{% content-ref url="../gcp-persistence/gcp-filestore-persistence.md" %}
[gcp-filestore-persistence.md](../gcp-persistence/gcp-filestore-persistence.md)
{% endcontent-ref %}

{% hint style="success" %}
Ucz się i ćwicz Hacking AWS:<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Ucz się i ćwicz Hacking GCP: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Wsparcie dla HackTricks</summary>

* Sprawdź [**plany subskrypcyjne**](https://github.com/sponsors/carlospolop)!
* **Dołącz do** 💬 [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **śledź** nas na **Twitterze** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Dziel się sztuczkami hackingowymi, przesyłając PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repozytoriów na githubie.

</details>
{% endhint %}
