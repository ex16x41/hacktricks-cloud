# GCP - Filestore Enum

{% hint style="success" %}
学习和实践 AWS 黑客技术：<img src="../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">[**HackTricks 培训 AWS 红队专家 (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">\
学习和实践 GCP 黑客技术：<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks 培训 GCP 红队专家 (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>支持 HackTricks</summary>

* 查看 [**订阅计划**](https://github.com/sponsors/carlospolop)!
* **加入** 💬 [**Discord 群组**](https://discord.gg/hRep4RUj7f) 或 [**Telegram 群组**](https://t.me/peass) 或 **在 Twitter 上关注** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **通过向** [**HackTricks**](https://github.com/carlospolop/hacktricks) 和 [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub 仓库提交 PR 分享黑客技巧。

</details>
{% endhint %}

## 基本信息

Google Cloud Filestore 是一个**托管文件存储服务**，专为需要**文件系统接口和共享文件系统的数据**的应用程序量身定制。该服务通过提供高性能的文件共享而表现出色，可以与各种 GCP 服务集成。它在传统文件系统接口和语义至关重要的场景中表现尤为突出，例如媒体处理、内容管理和数据库备份。

你可以将其视为任何其他**NFS** **共享文档库 -** 一个潜在的敏感信息来源。

### 连接

创建 Filestore 实例时，可以**选择可访问的网络**。

此外，**默认情况下，所选 VPC 网络和区域上的所有客户端都可以访问它**，但是，可以**通过 IP 地址或范围限制访问**并指示客户端将获得的访问权限（管理员、管理员查看者、编辑者、查看者），**这取决于 IP 地址。**

它还可以通过**私有服务访问连接**进行访问：

* 每个 VPC 网络，并且可以在所有托管服务中使用，例如 Memorystore、Tensorflow 和 SQL。
* **在你的 VPC 网络和 Google 拥有的网络之间使用 VPC 对等连接**，使你的实例和服务能够仅通过**使用内部 IP 地址**进行通信。
* 在服务提供方创建一个隔离项目，意味着没有其他客户共享它。你只需为你配置的资源付费。
* VPC 对等连接将导入新路由到你的 VPC。

### 备份

可以创建**文件共享的备份**。这些备份可以在**原始**新的文件共享实例或**新的**文件共享实例中**恢复**。

### 加密

默认情况下，将使用**Google 管理的加密密钥**来加密数据，但可以选择**客户管理的加密密钥 (CMEK)**。

### 枚举

如果你在项目中发现可用的 Filestore，可以从你被攻陷的计算实例中**挂载它**。使用以下命令查看是否存在。 

{% code overflow="wrap" %}
```bash
# Instances
gcloud filestore instances list # Check the IP address
gcloud filestore instances describe --zone <zone> <name> # Check IP and access restrictions

# Backups
gcloud filestore backups list
gcloud filestore backups describe --region <region> <backup>

# Search for NFS shares in a VPC subnet
sudo nmap -n -T5 -Pn -p 2049 --min-parallelism 100 --min-rate 1000 --open 10.99.160.2/20
```
{% endcode %}

{% hint style="danger" %}
请注意，filestore 服务可能位于为其创建的 **全新子网络** 中（在私有服务访问连接内，这是一个 **VPC 对等连接**）。\
因此，您可能需要 **枚举 VPC 对等连接** 以便在这些网络范围内运行 nmap。

{% code overflow="wrap" %}
```bash
# Get peerings
gcloud compute networks peerings list
# Get routes imported from a peering
gcloud compute networks peerings list-routes <peering-name> --network=<network-name> --region=<region> --direction=INCOMING
```
{% endcode %}
{% endhint %}

### 权限提升与后期利用

在 GCP 中没有直接利用此服务提升权限的方法，但使用一些 **后期利用技巧可以访问数据**，也许你可以找到一些凭证来提升权限：

{% content-ref url="../gcp-post-exploitation/gcp-filestore-post-exploitation.md" %}
[gcp-filestore-post-exploitation.md](../gcp-post-exploitation/gcp-filestore-post-exploitation.md)
{% endcontent-ref %}

### 持久性

{% content-ref url="../gcp-persistence/gcp-filestore-persistence.md" %}
[gcp-filestore-persistence.md](../gcp-persistence/gcp-filestore-persistence.md)
{% endcontent-ref %}

{% hint style="success" %}
学习与实践 AWS 黑客技术：<img src="../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">[**HackTricks 培训 AWS 红队专家 (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">\
学习与实践 GCP 黑客技术：<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks 培训 GCP 红队专家 (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>支持 HackTricks</summary>

* 查看 [**订阅计划**](https://github.com/sponsors/carlospolop)!
* **加入** 💬 [**Discord 群组**](https://discord.gg/hRep4RUj7f) 或 [**Telegram 群组**](https://t.me/peass) 或 **在 Twitter 上关注** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **通过向** [**HackTricks**](https://github.com/carlospolop/hacktricks) 和 [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub 仓库提交 PR 来分享黑客技巧。

</details>
{% endhint %}
