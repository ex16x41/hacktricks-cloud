# GCP - Filestore Enum

{% hint style="success" %}
Lerne & √ºbe AWS Hacking:<img src="../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">\
Lerne & √ºbe GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* √úberpr√ºfe die [**Abonnementpl√§ne**](https://github.com/sponsors/carlospolop)!
* **Tritt der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folge** uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teile Hacking-Tricks, indem du PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repos einreichst.

</details>
{% endhint %}

## Grundinformationen

Google Cloud Filestore ist ein **verwalteter Dateispeicherdienst**, der f√ºr Anwendungen entwickelt wurde, die sowohl eine **Dateisystemschnittstelle als auch ein gemeinsames Dateisystem f√ºr Daten** ben√∂tigen. Dieser Dienst zeichnet sich durch die Bereitstellung von leistungsstarken Dateifreigaben aus, die mit verschiedenen GCP-Diensten integriert werden k√∂nnen. Seine N√ºtzlichkeit zeigt sich in Szenarien, in denen traditionelle Dateisystemschnittstellen und -semantiken entscheidend sind, wie z.B. in der Medienverarbeitung, im Content-Management und bei der Sicherung von Datenbanken.

Man kann dies wie jedes andere **NFS** **gemeinsame Dokumentenrepository** betrachten - eine potenzielle Quelle sensibler Informationen.

### Verbindungen

Beim Erstellen einer Filestore-Instanz ist es m√∂glich, **das Netzwerk auszuw√§hlen, in dem es zug√§nglich sein wird**.

Dar√ºber hinaus k√∂nnen **standardm√§√üig alle Clients im ausgew√§hlten VPC-Netzwerk und in der Region darauf zugreifen**, jedoch ist es m√∂glich, den Zugriff auch nach IP-Adresse oder -Bereich zu **beschr√§nken** und die Zugriffsberechtigung (Admin, Admin Viewer, Editor, Viewer) anzugeben, die der Client je nach IP-Adresse erh√§lt.

Es kann auch √ºber eine **Private Service Access Connection** zug√§nglich sein:

* Ist pro VPC-Netzwerk und kann √ºber alle verwalteten Dienste wie Memorystore, Tensorflow und SQL verwendet werden.
* Ist **zwischen deinem VPC-Netzwerk und einem von Google betriebenen Netzwerk unter Verwendung eines VPC-Peerings**, wodurch deine Instanzen und Dienste ausschlie√ülich √ºber **interne IP-Adressen** kommunizieren k√∂nnen.
* Erstelle ein isoliertes Projekt f√ºr dich auf der Dienstanbieter-Seite, was bedeutet, dass keine anderen Kunden es teilen. Du wirst nur f√ºr die Ressourcen, die du bereitstellst, in Rechnung gestellt.
* Das VPC-Peering importiert neue Routen in dein VPC.

### Backups

Es ist m√∂glich, **Backups der Dateifreigaben** zu erstellen. Diese k√∂nnen sp√§ter im Ursprungs-**neuen Fileshare-Instanz** oder in **neuen** wiederhergestellt werden.

### Verschl√ºsselung

Standardm√§√üig wird ein **von Google verwalteter Verschl√ºsselungsschl√ºssel** verwendet, um die Daten zu verschl√ºsseln, aber es ist m√∂glich, einen **vom Kunden verwalteten Verschl√ºsselungsschl√ºssel (CMEK)** auszuw√§hlen.

### Enumeration

Wenn du einen Filestore im Projekt findest, kannst du ihn **von deiner kompromittierten Compute-Instanz aus einbinden**. Verwende den folgenden Befehl, um zu sehen, ob welche existieren.

{% code overflow="wrap" %}
```bash
# Instances
gcloud filestore instances list # Check the IP address
gcloud filestore instances describe --zone <zone> <name> # Check IP and access restrictions

# Backups
gcloud filestore backups list
gcloud filestore backups describe --region <region> <backup>

# Search for NFS shares in a VPC subnet
sudo nmap -n -T5 -Pn -p 2049 --min-parallelism 100 --min-rate 1000 --open 10.99.160.2/20
```
{% endcode %}

{% hint style="danger" %}
Beachten Sie, dass ein Filestore-Dienst sich in einem **v√∂llig neuen Subnetz befinden kann, das daf√ºr erstellt wurde** (innerhalb einer Private Service Access Connection, die ein **VPC-Peer** ist).\
Sie m√ºssen m√∂glicherweise auch **VPC-Peers enumerieren**, um nmap √ºber diese Netzwerkbereiche auszuf√ºhren.

{% code overflow="wrap" %}
```bash
# Get peerings
gcloud compute networks peerings list
# Get routes imported from a peering
gcloud compute networks peerings list-routes <peering-name> --network=<network-name> --region=<region> --direction=INCOMING
```
{% endcode %}
{% endhint %}

### Privilegieneskalation & Nach der Ausnutzung

Es gibt keine M√∂glichkeiten, Privilegien in GCP direkt durch den Missbrauch dieses Dienstes zu eskalieren, aber mit einigen **Nach der Ausnutzung Tricks ist es m√∂glich, auf die Daten zuzugreifen** und vielleicht finden Sie einige Anmeldeinformationen, um Privilegien zu eskalieren:

{% content-ref url="../gcp-post-exploitation/gcp-filestore-post-exploitation.md" %}
[gcp-filestore-post-exploitation.md](../gcp-post-exploitation/gcp-filestore-post-exploitation.md)
{% endcontent-ref %}

### Persistenz

{% content-ref url="../gcp-persistence/gcp-filestore-persistence.md" %}
[gcp-filestore-persistence.md](../gcp-persistence/gcp-filestore-persistence.md)
{% endcontent-ref %}

{% hint style="success" %}
Lernen & √ºben Sie AWS Hacking:<img src="../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">\
Lernen & √ºben Sie GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Unterst√ºtzen Sie HackTricks</summary>

* √úberpr√ºfen Sie die [**Abonnementpl√§ne**](https://github.com/sponsors/carlospolop)!
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teilen Sie Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repos senden.

</details>
{% endhint %}
