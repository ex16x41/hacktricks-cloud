# GCP - Filestore Enum

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** 💬 [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Basic Information

Η Google Cloud Filestore είναι μια **διαχειριζόμενη υπηρεσία αποθήκευσης αρχείων** που έχει σχεδιαστεί για εφαρμογές που χρειάζονται τόσο **διεπαφή συστήματος αρχείων όσο και κοινό σύστημα αρχείων για δεδομένα**. Αυτή η υπηρεσία διακρίνεται προσφέροντας υψηλής απόδοσης κοινές διανομές αρχείων, οι οποίες μπορούν να ενσωματωθούν με διάφορες υπηρεσίες GCP. Η χρησιμότητά της είναι εμφανής σε σενάρια όπου οι παραδοσιακές διεπαφές και οι σημασιολογίες συστήματος αρχείων είναι κρίσιμες, όπως στην επεξεργασία πολυμέσων, τη διαχείριση περιεχομένου και την εφεδρεία βάσεων δεδομένων.

Μπορείτε να το σκεφτείτε όπως οποιοδήποτε άλλο **NFS** **κοινό αποθετήριο εγγράφων -** μια πιθανή πηγή ευαίσθητων πληροφοριών.

### Connections

Κατά τη δημιουργία μιας παρουσίας Filestore, είναι δυνατόν να **επιλέξετε το δίκτυο στο οποίο θα είναι προσβάσιμο**.

Επιπλέον, **κατά προεπιλογή όλοι οι πελάτες στο επιλεγμένο δίκτυο VPC και περιοχή θα μπορούν να έχουν πρόσβαση σε αυτό**, ωστόσο, είναι δυνατόν να **περιορίσετε την πρόσβαση και με διεύθυνση IP** ή εύρος και να υποδείξετε το δικαίωμα πρόσβασης (Διαχειριστής, Θεατής Διαχειριστή, Συντάκτης, Θεατής) που θα αποκτήσει ο πελάτης **ανάλογα με τη διεύθυνση IP.**

Μπορεί επίσης να είναι προσβάσιμο μέσω **Ιδιωτικής Υπηρεσίας Πρόσβασης:**

* Είναι ανά δίκτυο VPC και μπορούν να χρησιμοποιηθούν σε όλες τις διαχειριζόμενες υπηρεσίες όπως Memorystore, Tensorflow και SQL.
* Είναι **μεταξύ του δικτύου VPC σας και του δικτύου που ανήκει στη Google χρησιμοποιώντας VPC peering**, επιτρέποντας στις παρουσίες και τις υπηρεσίες σας να επικοινωνούν αποκλειστικά **χρησιμοποιώντας εσωτερικές διευθύνσεις IP**.
* Δημιουργήστε ένα απομονωμένο έργο για εσάς στην πλευρά του παραγωγού υπηρεσιών, που σημαίνει ότι κανένας άλλος πελάτης δεν το μοιράζεται. Θα χρεωθείτε μόνο για τους πόρους που προμηθεύετε.
* Το VPC peering θα εισάγει νέες διαδρομές στο VPC σας.

### Backups

Είναι δυνατόν να δημιουργήσετε **αντίγραφα ασφαλείας των κοινών αρχείων**. Αυτά μπορούν να **αποκατασταθούν αργότερα στην αρχή** σε νέα παρουσία Fileshare ή σε **νέα**.

### Encryption

Κατά προεπιλογή θα χρησιμοποιηθεί ένα **κλειδί κρυπτογράφησης που διαχειρίζεται η Google** για την κρυπτογράφηση των δεδομένων, αλλά είναι δυνατόν να επιλέξετε ένα **κλειδί κρυπτογράφησης που διαχειρίζεται ο πελάτης (CMEK)**.

### Enumeration

Εάν βρείτε ένα filestore διαθέσιμο στο έργο, μπορείτε να **το τοποθετήσετε** από την παραβιασμένη παρουσία Compute. Χρησιμοποιήστε την παρακάτω εντολή για να δείτε αν υπάρχουν. 

{% code overflow="wrap" %}
```bash
# Instances
gcloud filestore instances list # Check the IP address
gcloud filestore instances describe --zone <zone> <name> # Check IP and access restrictions

# Backups
gcloud filestore backups list
gcloud filestore backups describe --region <region> <backup>

# Search for NFS shares in a VPC subnet
sudo nmap -n -T5 -Pn -p 2049 --min-parallelism 100 --min-rate 1000 --open 10.99.160.2/20
```
{% endcode %}

{% hint style="danger" %}
Σημειώστε ότι μια υπηρεσία filestore μπορεί να βρίσκεται σε ένα **εντελώς νέο υποδίκτυο που έχει δημιουργηθεί γι' αυτό** (μέσα σε μια Σύνδεση Ιδιωτικής Υπηρεσίας Πρόσβασης, η οποία είναι ένα **VPC peer**).\
Έτσι, μπορεί να χρειαστεί να **καταμετρήσετε τα VPC peers** για να εκτελέσετε επίσης nmap σε αυτές τις διευθύνσεις δικτύου.

{% code overflow="wrap" %}
```bash
# Get peerings
gcloud compute networks peerings list
# Get routes imported from a peering
gcloud compute networks peerings list-routes <peering-name> --network=<network-name> --region=<region> --direction=INCOMING
```
{% endcode %}
{% endhint %}

### Κλιμάκωση Δικαιωμάτων & Μετά την Εκμετάλλευση

Δεν υπάρχουν τρόποι να κλιμακωθούν τα δικαιώματα στο GCP εκμεταλλευόμενοι άμεσα αυτή την υπηρεσία, αλλά χρησιμοποιώντας μερικά **tricks Μετά την Εκμετάλλευση είναι δυνατόν να αποκτήσετε πρόσβαση στα δεδομένα** και ίσως να βρείτε κάποια διαπιστευτήρια για να κλιμακώσετε τα δικαιώματα:

{% content-ref url="../gcp-post-exploitation/gcp-filestore-post-exploitation.md" %}
[gcp-filestore-post-exploitation.md](../gcp-post-exploitation/gcp-filestore-post-exploitation.md)
{% endcontent-ref %}

### Επιμονή

{% content-ref url="../gcp-persistence/gcp-filestore-persistence.md" %}
[gcp-filestore-persistence.md](../gcp-persistence/gcp-filestore-persistence.md)
{% endcontent-ref %}

{% hint style="success" %}
Μάθετε & εξασκηθείτε στο AWS Hacking:<img src="../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">\
Μάθετε & εξασκηθείτε στο GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Υποστήριξη HackTricks</summary>

* Ελέγξτε τα [**σχέδια συνδρομής**](https://github.com/sponsors/carlospolop)!
* **Εγγραφείτε στην** 💬 [**ομάδα Discord**](https://discord.gg/hRep4RUj7f) ή στην [**ομάδα telegram**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Μοιραστείτε hacking tricks υποβάλλοντας PRs στα** [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
