# GCP - Filestore Enum

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** 💬 [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## 基本情報

Google Cloud Filestoreは、**ファイルシステムインターフェースとデータ用の共有ファイルシステム**の両方を必要とするアプリケーション向けに特化した**管理されたファイルストレージサービス**です。このサービスは、高性能なファイル共有を提供し、さまざまなGCPサービスと統合できます。従来のファイルシステムインターフェースとセマンティクスが重要なシナリオ、例えばメディア処理、コンテンツ管理、データベースのバックアップなどでその有用性が際立ちます。

これは、他の**NFS** **共有ドキュメントリポジトリ**のように考えることができ、機密情報の潜在的なソースとなります。

### 接続

Filestoreインスタンスを作成する際、**アクセス可能なネットワークを選択することができます**。

さらに、**デフォルトでは選択したVPCネットワークとリージョンのすべてのクライアントがアクセスできる**ようになりますが、**IPアドレス**または範囲によってアクセスを**制限することも可能**で、クライアントが得るアクセス権限（Admin、Admin Viewer、Editor、Viewer）を**IPアドレスに応じて指定**できます。

また、**プライベートサービスアクセス接続**を介してアクセスすることもできます：

* VPCネットワークごとにあり、Memorystore、Tensorflow、SQLなどのすべての管理サービスで使用できます。
* **VPCピアリングを使用して、Googleが所有するネットワークとあなたのVPCネットワークの間にあります**。これにより、インスタンスとサービスが**内部IPアドレスを使用して専用に通信**できます。
* サービスプロデューサー側にあなた専用の孤立したプロジェクトを作成し、他の顧客と共有されないことを意味します。プロビジョニングしたリソースに対してのみ請求されます。
* VPCピアリングは、新しいルートをあなたのVPCにインポートします。

### バックアップ

**ファイル共有のバックアップを作成することが可能**です。これらは後で**元の**新しいファイル共有インスタンスまたは**新しいものに**復元できます。

### 暗号化

デフォルトでは、**Google管理の暗号化キー**がデータを暗号化するために使用されますが、**顧客管理の暗号化キー（CMEK）**を選択することも可能です。

### 列挙

プロジェクト内で利用可能なFilestoreを見つけた場合、侵害されたCompute Instance内から**マウントすることができます**。次のコマンドを使用して、存在するかどうかを確認してください。

{% code overflow="wrap" %}
```bash
# Instances
gcloud filestore instances list # Check the IP address
gcloud filestore instances describe --zone <zone> <name> # Check IP and access restrictions

# Backups
gcloud filestore backups list
gcloud filestore backups describe --region <region> <backup>

# Search for NFS shares in a VPC subnet
sudo nmap -n -T5 -Pn -p 2049 --min-parallelism 100 --min-rate 1000 --open 10.99.160.2/20
```
{% endcode %}

{% hint style="danger" %}
フィルストアサービスは、**それ専用に作成された完全に新しいサブネットワーク**に存在する可能性があります（プライベートサービスアクセス接続内、これは**VPCピア**です）。\
そのため、**VPCピアを列挙する**必要があり、これらのネットワーク範囲に対してnmapを実行する必要があります。

{% code overflow="wrap" %}
```bash
# Get peerings
gcloud compute networks peerings list
# Get routes imported from a peering
gcloud compute networks peerings list-routes <peering-name> --network=<network-name> --region=<region> --direction=INCOMING
```
{% endcode %}
{% endhint %}

### 権限昇格とポストエクスプロイト

このサービスを直接利用して権限を昇格させる方法はありませんが、いくつかの**ポストエクスプロイトのトリックを使用することでデータにアクセスすることが可能です**。おそらく権限を昇格させるための資格情報を見つけることができるでしょう：

{% content-ref url="../gcp-post-exploitation/gcp-filestore-post-exploitation.md" %}
[gcp-filestore-post-exploitation.md](../gcp-post-exploitation/gcp-filestore-post-exploitation.md)
{% endcontent-ref %}

### 永続性

{% content-ref url="../gcp-persistence/gcp-filestore-persistence.md" %}
[gcp-filestore-persistence.md](../gcp-persistence/gcp-filestore-persistence.md)
{% endcontent-ref %}

{% hint style="success" %}
AWSハッキングを学び、実践する：<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
GCPハッキングを学び、実践する：<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricksをサポートする</summary>

* [**サブスクリプションプラン**](https://github.com/sponsors/carlospolop)を確認してください！
* **💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)または[**Telegramグループ**](https://t.me/peass)に参加するか、**Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**をフォローしてください。**
* **ハッキングトリックを共有するには、[**HackTricks**](https://github.com/carlospolop/hacktricks)および[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)のGitHubリポジトリにPRを提出してください。**

</details>
{% endhint %}
