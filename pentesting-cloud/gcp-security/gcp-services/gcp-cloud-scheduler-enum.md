# GCP - Enumera√ß√£o do Cloud Scheduler

{% hint style="success" %}
Aprenda e pratique Hacking AWS:<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Aprenda e pratique Hacking GCP: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Confira os [**planos de assinatura**](https://github.com/sponsors/carlospolop)!
* **Junte-se ao** üí¨ [**grupo do Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga**-nos no **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe truques de hacking enviando PRs para os reposit√≥rios do** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
{% endhint %}

## Informa√ß√µes B√°sicas

O Google Cloud Scheduler √© um **servi√ßo de cron job** totalmente gerenciado que permite executar trabalhos arbitr√°rios‚Äîcomo trabalhos em lote, trabalhos de big data, opera√ß√µes de infraestrutura em nuvem‚Äîem hor√°rios, datas ou intervalos fixos. Ele est√° integrado aos servi√ßos do Google Cloud, fornecendo uma maneira de **automatizar v√°rias tarefas, como atualiza√ß√µes ou processamento em lote em uma programa√ß√£o regular**.

Embora, do ponto de vista ofensivo, isso pare√ßa incr√≠vel, na verdade n√£o √© t√£o interessante, pois o servi√ßo apenas permite agendar certas a√ß√µes simples em um determinado momento e n√£o executar c√≥digo arbitr√°rio.

No momento em que este texto foi escrito, estas s√£o as a√ß√µes que este servi√ßo permite agendar:

<figure><img src="../../../.gitbook/assets/image (347).png" alt="" width="563"><figcaption></figcaption></figure>

* **HTTP**: Enviar uma solicita√ß√£o HTTP definindo os cabe√ßalhos e o corpo da solicita√ß√£o.
* **Pub/Sub**: Enviar uma mensagem para um t√≥pico espec√≠fico.
* **App Engine HTTP**: Enviar uma solicita√ß√£o HTTP para um aplicativo constru√≠do no App Engine.
* **Workflows**: Chamar um Workflow do GCP.

## Contas de Servi√ßo

Uma conta de servi√ßo nem sempre √© necess√°ria para cada agendador. Os tipos **Pub/Sub** e **App Engine HTTP** n√£o requerem nenhuma conta de servi√ßo. O **Workflow** requer uma conta de servi√ßo, mas apenas invocar√° o workflow.\
Finalmente, o tipo HTTP regular n√£o requer uma conta de servi√ßo, mas √© poss√≠vel indicar que algum tipo de autentica√ß√£o √© necess√°ria pelo workflow e adicionar um **token OAuth ou um token OIDC √† solicita√ß√£o HTTP enviada**.

{% hint style="danger" %}
Portanto, √© poss√≠vel roubar o **token OIDC** e abusar do **token OAuth** das contas de servi√ßo **abusando do tipo HTTP**. Mais sobre isso na p√°gina de escalonamento de privil√©gios.
{% endhint %}

Observe que √© poss√≠vel limitar o escopo do token OAuth enviado, no entanto, por padr√£o, ser√° `cloud-platform`.

## Enumera√ß√£o
```bash
# Get schedulers in a location
gcloud scheduler jobs list --location us-central1

# Get information of an specific scheduler
gcloud scheduler jobs describe --location us-central1 <scheduler-name>
```
## Escala√ß√£o de Privil√©gios

{% content-ref url="../gcp-privilege-escalation/gcp-cloudscheduler-privesc.md" %}
[gcp-cloudscheduler-privesc.md](../gcp-privilege-escalation/gcp-cloudscheduler-privesc.md)
{% endcontent-ref %}

{% hint style="success" %}
Aprenda e pratique Hacking AWS:<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Aprenda e pratique Hacking GCP: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Confira os [**planos de assinatura**](https://github.com/sponsors/carlospolop)!
* **Junte-se ao** üí¨ [**grupo do Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga**-nos no **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe truques de hacking enviando PRs para os reposit√≥rios do** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
{% endhint %}
