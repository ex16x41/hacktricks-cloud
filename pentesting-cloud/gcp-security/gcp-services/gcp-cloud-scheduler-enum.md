# GCP - Cloud Scheduler Enum

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** 💬 [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## 基本信息

Google Cloud Scheduler 是一个完全托管的 **cron 作业服务**，允许您在固定的时间、日期或间隔运行任意作业，例如批处理、大数据作业、云基础设施操作。它与 Google Cloud 服务集成，提供了一种 **定期自动化各种任务，如更新或批处理** 的方式。

虽然从攻击的角度来看，这听起来很不错，但实际上并没有那么有趣，因为该服务仅允许在特定时间调度某些简单操作，而不是执行任意代码。

在撰写本文时，该服务允许调度的操作如下：

<figure><img src="../../../.gitbook/assets/image (347).png" alt="" width="563"><figcaption></figcaption></figure>

* **HTTP**：发送一个 HTTP 请求，定义请求的头和主体。
* **Pub/Sub**：向特定主题发送消息。
* **App Engine HTTP**：向在 App Engine 中构建的应用发送 HTTP 请求。
* **Workflows**：调用 GCP 工作流。

## 服务账户

并非每个调度程序都始终需要服务账户。**Pub/Sub** 和 **App Engine HTTP** 类型不需要任何服务账户。**Workflow** 确实需要服务账户，但它只会调用工作流。\
最后，常规的 HTTP 类型不需要服务账户，但可以指示工作流需要某种身份验证，并将 **OAuth 令牌或 OIDC 令牌添加到发送的** HTTP 请求中。

{% hint style="danger" %}
因此，可以通过 **滥用 HTTP 类型** 来窃取 **OIDC** 令牌并滥用服务账户的 **OAuth** 令牌。有关更多信息，请参见权限提升页面。
{% endhint %}

请注意，可以限制发送的 OAuth 令牌的范围，但默认情况下，它将是 `cloud-platform`。

## 枚举
```bash
# Get schedulers in a location
gcloud scheduler jobs list --location us-central1

# Get information of an specific scheduler
gcloud scheduler jobs describe --location us-central1 <scheduler-name>
```
## 权限提升

{% content-ref url="../gcp-privilege-escalation/gcp-cloudscheduler-privesc.md" %}
[gcp-cloudscheduler-privesc.md](../gcp-privilege-escalation/gcp-cloudscheduler-privesc.md)
{% endcontent-ref %}

{% hint style="success" %}
学习与实践 AWS 黑客技术：<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks 培训 AWS 红队专家 (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
学习与实践 GCP 黑客技术：<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks 培训 GCP 红队专家 (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>支持 HackTricks</summary>

* 查看 [**订阅计划**](https://github.com/sponsors/carlospolop)!
* **加入** 💬 [**Discord 群组**](https://discord.gg/hRep4RUj7f) 或 [**Telegram 群组**](https://t.me/peass) 或 **在 Twitter 上关注** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **通过向** [**HackTricks**](https://github.com/carlospolop/hacktricks) 和 [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub 仓库提交 PR 来分享黑客技巧。

</details>
{% endhint %}
