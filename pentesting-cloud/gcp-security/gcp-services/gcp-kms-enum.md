# GCP - KMS Enum

{% hint style="success" %}
AWS Hacking Ã¶ÄŸrenin ve pratik yapÄ±n: [**HackTricks EÄŸitim AWS KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ± (ARTE)**](https://training.hacktricks.xyz/courses/arte)\
GCP Hacking Ã¶ÄŸrenin ve pratik yapÄ±n: [**HackTricks EÄŸitim GCP KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ± (GRTE)**](https://training.hacktricks.xyz/courses/grte)

<details>

<summary> HackTricks'i Destekleyin </summary>

- [**Abonelik planlarÄ±nÄ±**](https://github.com/sponsors/carlospolop) kontrol edin!
- ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) katÄ±lÄ±n veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n veya bizi **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** takip edin.**
- **Hacking pÃ¼f noktalarÄ±nÄ± paylaÅŸarak PR'ler gÃ¶ndererek HackTricks ve HackTricks Cloud github depolarÄ±na katkÄ±da bulunun.**

</details>
{% endhint %}

## KMS

[**Cloud Key Management Service**](https://cloud.google.com/kms/docs/), hassas verilerin ÅŸifrelenmesi ve ÅŸifrelenmiÅŸ verilerin Ã§Ã¶zÃ¼mlenmesi gibi iÅŸlemler iÃ§in gerekli olan **ÅŸifreleme anahtarlarÄ±nÄ±n** gÃ¼venli bir depolama alanÄ± olarak hizmet verir. Bu anahtarlar, yapÄ±landÄ±rÄ±lmÄ±ÅŸ yÃ¶netimi saÄŸlayan anahtar halkalarÄ± iÃ§inde dÃ¼zenlenir. AyrÄ±ca, eriÅŸim kontrolÃ¼, izinlerin gÃ¼venlik gereksinimleriyle tam olarak uyumlu olduÄŸundan emin olmak iÃ§in, bireysel anahtar dÃ¼zeyinde veya tÃ¼m anahtar halkasÄ± iÃ§in titizlikle yapÄ±landÄ±rÄ±labilir.

KMS anahtar halkalarÄ± **varsayÄ±lan olarak kÃ¼resel olarak oluÅŸturulur**, bu da o anahtar halkasÄ±ndaki anahtarlarÄ±n herhangi bir bÃ¶lgeden eriÅŸilebilir olduÄŸu anlamÄ±na gelir. Bununla birlikte, **belirli bÃ¶lgelerde belirli anahtar halkalarÄ± oluÅŸturmak mÃ¼mkÃ¼ndÃ¼r**.

### Anahtar Koruma Seviyesi

- **YazÄ±lÄ±m anahtarlarÄ±**: YazÄ±lÄ±m anahtarlarÄ±, **tamamen yazÄ±lÄ±m aracÄ±lÄ±ÄŸÄ±yla KMS tarafÄ±ndan oluÅŸturulur ve yÃ¶netilir**. Bu anahtarlar, **herhangi bir donanÄ±m gÃ¼venlik modÃ¼lÃ¼ (HSM) tarafÄ±ndan korunmaz** ve **test ve geliÅŸtirme amaÃ§larÄ±** iÃ§in kullanÄ±labilir. YazÄ±lÄ±m anahtarlarÄ±, dÃ¼ÅŸÃ¼k gÃ¼venlik saÄŸladÄ±klarÄ± ve saldÄ±rÄ±lara aÃ§Ä±k olduklarÄ± iÃ§in **Ã¼retim iÃ§in Ã¶nerilmez**.
- **Bulut barÄ±ndÄ±rÄ±lan anahtarlar**: Bulut barÄ±ndÄ±rÄ±lan anahtarlar, KMS tarafÄ±ndan bulutta **yÃ¼ksek eriÅŸilebilirlik ve gÃ¼venilirlik altyapÄ±sÄ± kullanÄ±larak oluÅŸturulur ve yÃ¶netilir**. Bu anahtarlar, **HSM'ler tarafÄ±ndan korunur**, ancak HSM'ler **belirli bir mÃ¼ÅŸteriye Ã¶zgÃ¼ deÄŸildir**. Bulut barÄ±ndÄ±rÄ±lan anahtarlar, Ã§oÄŸu Ã¼retim kullanÄ±m durumu iÃ§in uygundur.
- **Harici anahtarlar**: Harici anahtarlar, KMS dÄ±ÅŸÄ±nda **oluÅŸturulur ve yÃ¶netilir** ve ÅŸifreleme iÅŸlemlerinde kullanÄ±lmak Ã¼zere KMS'e ithal edilir. Harici anahtarlar, mÃ¼ÅŸterinin tercihine baÄŸlÄ± olarak **bir donanÄ±m gÃ¼venlik modÃ¼lÃ¼nde (HSM) veya yazÄ±lÄ±m kitaplÄ±ÄŸÄ±nda saklanabilir**.

### Anahtar AmaÃ§larÄ±

- **Simetrik ÅŸifreleme/Ã§Ã¶zme**: Tek bir anahtar kullanÄ±larak verilerin **hem ÅŸifrelenmesi hem de Ã§Ã¶zÃ¼lmesi** iÃ§in kullanÄ±lÄ±r. Simetrik anahtarlar, bÃ¼yÃ¼k veri hacimlerini ÅŸifrelemek ve Ã§Ã¶zmek iÃ§in hÄ±zlÄ± ve verimlidir.
- **Desteklenen**: [cryptoKeys.encrypt](https://cloud.google.com/kms/docs/reference/rest/v1/projects.locations.keyRings.cryptoKeys/encrypt), [cryptoKeys.decrypt](https://cloud.google.com/kms/docs/reference/rest/v1/projects.locations.keyRings.cryptoKeys/decrypt)
- **Asimetrik Ä°mzalama**: Ä°ki taraf arasÄ±nda gÃ¼venli iletiÅŸim iÃ§in anahtarÄ±n paylaÅŸÄ±lmadan kullanÄ±ldÄ±ÄŸÄ± asimetrik anahtarlar kullanÄ±lÄ±r. Asimetrik anahtarlar, bir **genel anahtar ve Ã¶zel anahtar** Ã§iftinden oluÅŸur. Genel anahtar baÅŸkalarÄ±yla paylaÅŸÄ±lÄ±rken, Ã¶zel anahtar gizli tutulur.
- **Desteklenen:** [cryptoKeyVersions.asymmetricSign](https://cloud.google.com/kms/docs/reference/rest/v1/projects.locations.keyRings.cryptoKeys.cryptoKeyVersions/asymmetricSign), [cryptoKeyVersions.getPublicKey](https://cloud.google.com/kms/docs/reference/rest/v1/projects.locations.keyRings.cryptoKeys.cryptoKeyVersions/getPublicKey)
- **Asimetrik Ã‡Ã¶zme**: Bir mesajÄ±n veya verinin doÄŸruluÄŸunu doÄŸrulamak iÃ§in kullanÄ±lÄ±r. Bir dijital imza, bir Ã¶zel anahtar kullanÄ±larak oluÅŸturulur ve karÅŸÄ±lÄ±k gelen genel anahtar kullanÄ±larak doÄŸrulanabilir.
- **Desteklenen:** [cryptoKeyVersions.asymmetricDecrypt](https://cloud.google.com/kms/docs/reference/rest/v1/projects.locations.keyRings.cryptoKeys.cryptoKeyVersions/asymmetricDecrypt), [cryptoKeyVersions.getPublicKey](https://cloud.google.com/kms/docs/reference/rest/v1/projects.locations.keyRings.cryptoKeys.cryptoKeyVersions/getPublicKey)
- **MAC Ä°mzalama**: Bir gizli anahtar kullanÄ±larak **veri bÃ¼tÃ¼nlÃ¼ÄŸÃ¼nÃ¼ ve doÄŸruluÄŸunu saÄŸlamak iÃ§in bir mesaj doÄŸrulama kodu (MAC) oluÅŸturulmasÄ±** iÃ§in kullanÄ±lÄ±r. HMAC, aÄŸ protokollerinde ve yazÄ±lÄ±m uygulamalarÄ±nda mesaj doÄŸrulamasÄ± iÃ§in yaygÄ±n olarak kullanÄ±lÄ±r.
- **Desteklenen:** [cryptoKeyVersions.macSign](https://cloud.google.com/kms/docs/reference/rest/v1/projects.locations.keyRings.cryptoKeys.cryptoKeyVersions/macSign), [cryptoKeyVersions.macVerify](https://cloud.google.com/kms/docs/reference/rest/v1/projects.locations.keyRings.cryptoKeys.cryptoKeyVersions/macVerify)

### DÃ¶ndÃ¼rme SÃ¼resi ve ProgramlanmÄ±ÅŸ imha sÃ¼resi

**VarsayÄ±lan olarak**, her **90 gÃ¼n** ancak **kolayca** ve **tamamen Ã¶zelleÅŸtirilebilir.**

"ProgramlanmÄ±ÅŸ imha" sÃ¼resi, **kullanÄ±cÄ±nÄ±n anahtarÄ± silmeyi istediÄŸi andan** anahtarÄ±n **silindiÄŸi ana kadar geÃ§en sÃ¼redir**. Anahtar oluÅŸturulduktan sonra deÄŸiÅŸtirilemez (varsayÄ±lan 1 gÃ¼n).

### Birincil SÃ¼rÃ¼m

Her KMS anahtarÄ±nÄ±n birkaÃ§ sÃ¼rÃ¼mÃ¼ olabilir, bunlardan biri **varsayÄ±lan** olmalÄ±dÄ±r, bu, KMS anahtarÄ±yla etkileÅŸimde **sÃ¼rÃ¼m belirtilmediÄŸinde kullanÄ±lacak olan sÃ¼rÃ¼m** olacaktÄ±r.

### NumaralandÄ±rma

**AnahtarlarÄ± listeleme izinlerine sahipseniz**, bunlara eriÅŸebilirsiniz:
```bash
# List the global keyrings available
gcloud kms keyrings list --location global
gcloud kms keyrings get-iam-policy <KEYRING>

# List the keys inside a keyring
gcloud kms keys list --keyring <KEYRING> --location <global/other_locations>
gcloud kms keys get-iam-policy <KEY>

# Encrypt a file using one of your keys
gcloud kms decrypt --ciphertext-file=[INFILE] \
--plaintext-file=[OUTFILE] \
--key [KEY] \
--keyring [KEYRING] \
--location global

# Decrypt a file using one of your keys
gcloud kms decrypt --ciphertext-file=[INFILE] \
--plaintext-file=[OUTFILE] \
--key [KEY] \
--keyring [KEYRING] \
--location global
```
### Yetki YÃ¼kseltme

{% content-ref url="../gcp-privilege-escalation/gcp-kms-privesc.md" %}
[gcp-kms-privesc.md](../gcp-privilege-escalation/gcp-kms-privesc.md)
{% endcontent-ref %}

### SaldÄ±rÄ± SonrasÄ± Ä°ÅŸlemler

{% content-ref url="../gcp-post-exploitation/gcp-kms-post-exploitation.md" %}
[gcp-kms-post-exploitation.md](../gcp-post-exploitation/gcp-kms-post-exploitation.md)
{% endcontent-ref %}

## Referanslar

* [https://about.gitlab.com/blog/2020/02/12/plundering-gcp-escalating-privileges-in-google-cloud-platform/#reviewing-stackdriver-logging](https://about.gitlab.com/blog/2020/02/12/plundering-gcp-escalating-privileges-in-google-cloud-platform/#reviewing-stackdriver-logging)

{% hint style="success" %}
AWS Hacking'i Ã¶ÄŸrenin ve uygulayÄ±n: <img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks EÄŸitimi AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCP Hacking'i Ã¶ÄŸrenin ve uygulayÄ±n: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks EÄŸitimi GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**Abonelik planlarÄ±nÄ±**](https://github.com/sponsors/carlospolop) kontrol edin!
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) katÄ±lÄ±n veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n veya bizi **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** takip edin.**
* **Hacking pÃ¼f noktalarÄ±nÄ± paylaÅŸarak PR'ler gÃ¶ndererek** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na katkÄ±da bulunun.

</details>
{% endhint %}
