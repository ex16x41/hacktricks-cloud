# GCP - KMS Enum

{% hint style="success" %}
Lerne & √ºbe AWS Hacking:<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Lerne & √ºbe GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* √úberpr√ºfe die [**Abonnementpl√§ne**](https://github.com/sponsors/carlospolop)!
* **Tritt der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folge** uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teile Hacking-Tricks, indem du PRs zu den** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repos einreichst.

</details>
{% endhint %}

## KMS

Der [**Cloud Key Management Service**](https://cloud.google.com/kms/docs/) dient als sichere Speicherung f√ºr **kryptografische Schl√ºssel**, die f√ºr Operationen wie **Verschl√ºsselung und Entschl√ºsselung sensibler Daten** unerl√§sslich sind. Diese Schl√ºssel sind in Schl√ºssels√§tzen organisiert, was eine strukturierte Verwaltung erm√∂glicht. Dar√ºber hinaus kann die Zugriffskontrolle sorgf√§ltig konfiguriert werden, entweder auf der Ebene des einzelnen Schl√ºssels oder f√ºr den gesamten Schl√ºsselsatz, um sicherzustellen, dass die Berechtigungen genau mit den Sicherheitsanforderungen √ºbereinstimmen.

KMS-Schl√ºssels√§tze werden standardm√§√üig als **global** erstellt, was bedeutet, dass die Schl√ºssel innerhalb dieses Schl√ºsselsatzes aus jeder Region zug√§nglich sind. Es ist jedoch m√∂glich, spezifische Schl√ºssels√§tze in **spezifischen Regionen** zu erstellen.

### Schl√ºssel-Schutzstufe

* **Software-Schl√ºssel**: Software-Schl√ºssel werden **vollst√§ndig in Software von KMS erstellt und verwaltet**. Diese Schl√ºssel sind **nicht durch ein Hardware-Sicherheitsmodul (HSM)** gesch√ºtzt und k√∂nnen f√ºr **Test- und Entwicklungszwecke** verwendet werden. Software-Schl√ºssel werden **nicht f√ºr die Produktion** empfohlen, da sie eine geringe Sicherheit bieten und anf√§llig f√ºr Angriffe sind.
* **Cloud-gehostete Schl√ºssel**: Cloud-gehostete Schl√ºssel werden **in der Cloud von KMS** unter Verwendung einer hochverf√ºgbaren und zuverl√§ssigen Infrastruktur erstellt und verwaltet. Diese Schl√ºssel sind **durch HSMs gesch√ºtzt**, aber die HSMs sind **nicht einem bestimmten Kunden zugeordnet**. Cloud-gehostete Schl√ºssel sind f√ºr die meisten Produktionsanwendungen geeignet.
* **Externe Schl√ºssel**: Externe Schl√ºssel werden **au√üerhalb von KMS erstellt und verwaltet** und in KMS importiert, um in kryptografischen Operationen verwendet zu werden. Externe Schl√ºssel **k√∂nnen in einem Hardware-Sicherheitsmodul (HSM) oder einer Softwarebibliothek gespeichert werden, je nach den Vorlieben des Kunden**.

### Schl√ºsselzwecke

* **Symmetrische Verschl√ºsselung/Entschl√ºsselung**: Wird verwendet, um **Daten mit einem einzigen Schl√ºssel f√ºr beide Operationen zu verschl√ºsseln und zu entschl√ºsseln**. Symmetrische Schl√ºssel sind schnell und effizient f√ºr die Verschl√ºsselung und Entschl√ºsselung gro√üer Datenmengen.
* **Unterst√ºtzt**: [cryptoKeys.encrypt](https://cloud.google.com/kms/docs/reference/rest/v1/projects.locations.keyRings.cryptoKeys/encrypt), [cryptoKeys.decrypt](https://cloud.google.com/kms/docs/reference/rest/v1/projects.locations.keyRings.cryptoKeys/decrypt)
* **Asymmetrische Signatur**: Wird f√ºr die sichere Kommunikation zwischen zwei Parteien verwendet, ohne den Schl√ºssel zu teilen. Asymmetrische Schl√ºssel kommen in einem Paar, bestehend aus einem **√∂ffentlichen Schl√ºssel und einem privaten Schl√ºssel**. Der √∂ffentliche Schl√ºssel wird mit anderen geteilt, w√§hrend der private Schl√ºssel geheim gehalten wird.
* **Unterst√ºtzt:** [cryptoKeyVersions.asymmetricSign](https://cloud.google.com/kms/docs/reference/rest/v1/projects.locations.keyRings.cryptoKeys.cryptoKeyVersions/asymmetricSign), [cryptoKeyVersions.getPublicKey](https://cloud.google.com/kms/docs/reference/rest/v1/projects.locations.keyRings.cryptoKeys.cryptoKeyVersions/getPublicKey)
* **Asymmetrische Entschl√ºsselung**: Wird verwendet, um die Authentizit√§t einer Nachricht oder Daten zu √ºberpr√ºfen. Eine digitale Signatur wird mit einem privaten Schl√ºssel erstellt und kann mit dem entsprechenden √∂ffentlichen Schl√ºssel verifiziert werden.
* **Unterst√ºtzt:** [cryptoKeyVersions.asymmetricDecrypt](https://cloud.google.com/kms/docs/reference/rest/v1/projects.locations.keyRings.cryptoKeys.cryptoKeyVersions/asymmetricDecrypt), [cryptoKeyVersions.getPublicKey](https://cloud.google.com/kms/docs/reference/rest/v1/projects.locations.keyRings.cryptoKeys.cryptoKeyVersions/getPublicKey)
* **MAC-Signatur**: Wird verwendet, um **Datenintegrit√§t und Authentizit√§t zu gew√§hrleisten, indem ein Nachrichten-Authentifizierungscode (MAC) mit einem geheimen Schl√ºssel erstellt wird**. HMAC wird h√§ufig f√ºr die Nachrichtenauthentifizierung in Netzwerkprotokollen und Softwareanwendungen verwendet.
* **Unterst√ºtzt:** [cryptoKeyVersions.macSign](https://cloud.google.com/kms/docs/reference/rest/v1/projects.locations.keyRings.cryptoKeys.cryptoKeyVersions/macSign), [cryptoKeyVersions.macVerify](https://cloud.google.com/kms/docs/reference/rest/v1/projects.locations.keyRings.cryptoKeys.cryptoKeyVersions/macVerify)

### Rotationszeitraum & Programmierte Zerst√∂rungszeit

Standardm√§√üig **alle 90 Tage**, kann jedoch **einfach** und **vollst√§ndig angepasst** werden.

Der Zeitraum "Programmiert zur Zerst√∂rung" ist die **Zeit, seit der der Benutzer die L√∂schung des Schl√ºssels beantragt hat**, bis der Schl√ºssel **gel√∂scht** wird. Er kann nach der Erstellung des Schl√ºssels nicht mehr ge√§ndert werden (Standard 1 Tag).

### Prim√§re Version

Jeder KMS-Schl√ºssel kann mehrere Versionen haben, eine davon muss die **Standardversion** sein, die verwendet wird, wenn **keine Version angegeben ist, wenn mit dem KMS-Schl√ºssel interagiert wird**.

### Aufz√§hlung

Wenn du **Berechtigungen zum Auflisten der Schl√ºssel** hast, so kannst du auf sie zugreifen:
```bash
# List the global keyrings available
gcloud kms keyrings list --location global
gcloud kms keyrings get-iam-policy <KEYRING>

# List the keys inside a keyring
gcloud kms keys list --keyring <KEYRING> --location <global/other_locations>
gcloud kms keys get-iam-policy <KEY>

# Encrypt a file using one of your keys
gcloud kms encrypt --ciphertext-file=[INFILE] \
--plaintext-file=[OUTFILE] \
--key [KEY] \
--keyring [KEYRING] \
--location global

# Decrypt a file using one of your keys
gcloud kms decrypt --ciphertext-file=[INFILE] \
--plaintext-file=[OUTFILE] \
--key [KEY] \
--keyring [KEYRING] \
--location global
```
### Privilegieneskalation

{% content-ref url="../gcp-privilege-escalation/gcp-kms-privesc.md" %}
[gcp-kms-privesc.md](../gcp-privilege-escalation/gcp-kms-privesc.md)
{% endcontent-ref %}

### Nach der Ausnutzung

{% content-ref url="../gcp-post-exploitation/gcp-kms-post-exploitation.md" %}
[gcp-kms-post-exploitation.md](../gcp-post-exploitation/gcp-kms-post-exploitation.md)
{% endcontent-ref %}

## Referenzen

* [https://about.gitlab.com/blog/2020/02/12/plundering-gcp-escalating-privileges-in-google-cloud-platform/#reviewing-stackdriver-logging](https://about.gitlab.com/blog/2020/02/12/plundering-gcp-escalating-privileges-in-google-cloud-platform/#reviewing-stackdriver-logging)

{% hint style="success" %}
Lerne & √ºbe AWS Hacking:<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Lerne & √ºbe GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Unterst√ºtze HackTricks</summary>

* √úberpr√ºfe die [**Abonnementpl√§ne**](https://github.com/sponsors/carlospolop)!
* **Tritt der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folge** uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teile Hacking-Tricks, indem du PRs zu den** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repos einreichst.

</details>
{% endhint %}
