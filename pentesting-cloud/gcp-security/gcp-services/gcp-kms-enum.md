# GCP - KMS Enum

{% hint style="success" %}
Nau캜ite i ve쬭ajte hakovanje AWS-a:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Nau캜ite i ve쬭ajte hakovanje GCP-a: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Podr쬴te HackTricks</summary>

* Proverite [**planove pretplate**](https://github.com/sponsors/carlospolop)!
* **Pridru쬴te se** 游눫 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitteru** 游냕 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podelite hakovanje trikova slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
{% endhint %}

## KMS

[**Cloud Key Management Service**](https://cloud.google.com/kms/docs/) slu쬴 kao sigurno skladi코te za **kriptografske klju캜eve**, koji su neophodni za operacije poput **코ifrovanja i de코ifrovanja osetljivih podataka**. Ovi klju캜evi su organizovani unutar prstenova klju캜eva, omogu캖avaju캖i strukturirano upravljanje. Nadalje, kontrola pristupa mo쬰 biti pa쬷jivo konfigurisana, bilo na nivou pojedina캜nog klju캜a ili za ceo prsten klju캜eva, osiguravaju캖i da dozvole ta캜no odgovaraju sigurnosnim zahtevima.

KMS prstenovi klju캜eva su **podrazumevano kreirani kao globalni**, 코to zna캜i da su klju캜evi unutar tog prstena klju캜eva dostupni iz bilo koje regije. Me캠utim, mogu캖e je kreirati specifi캜ne prstenove klju캜eva u **specifi캜nim regionima**.

### Nivo za코tite klju캜a

* **Softverski klju캜evi**: Softverski klju캜evi su **kreirani i upravljani od strane KMS-a isklju캜ivo u softveru**. Ovi klju캜evi **nisu za코ti캖eni nikakvim hardverskim sigurnosnim modulom (HSM)** i mogu se koristiti u **testiranju i razvojne svrhe**. Softverski klju캜evi **nisu preporu캜ljivi za proizvodnju** jer pru쬬ju nisku sigurnost i podlo쬹i su napadima.
* **Klju캜evi u oblaku**: Klju캜evi u oblaku su **kreirani i upravljani od strane KMS-a** u oblaku koriste캖i visoko dostupnu i pouzdanu infrastrukturu. Ovi klju캜evi su **za코ti캖eni HSM-ovima**, ali HSM-ovi **nisu posve캖eni odre캠enom korisniku**. Klju캜evi u oblaku su pogodni za ve캖inu slu캜ajeva upotrebe u proizvodnji.
* **Spoljni klju캜evi**: Spoljni klju캜evi su **kreirani i upravljani van KMS-a**, i uvezeni su u KMS radi kori코캖enja u kriptografskim operacijama. Spoljni klju캜evi **mogu biti sme코teni u hardverskom sigurnosnom modulu (HSM) ili softverskoj biblioteci, u zavisnosti od preferencije korisnika**.

### Namene klju캜a

* **Simetri캜no 코ifrovanje/de코ifrovanje**: Koristi se za **코ifrovanje i de코ifrovanje podataka kori코캖enjem jednog klju캜a za obe operacije**. Simetri캜ni klju캜evi su brzi i efikasni za 코ifrovanje i de코ifrovanje velikih koli캜ina podataka.
* **Podr쬬no**: [cryptoKeys.encrypt](https://cloud.google.com/kms/docs/reference/rest/v1/projects.locations.keyRings.cryptoKeys/encrypt), [cryptoKeys.decrypt](https://cloud.google.com/kms/docs/reference/rest/v1/projects.locations.keyRings.cryptoKeys/decrypt)
* **Asimetri캜no potpisivanje**: Koristi se za sigurnu komunikaciju izme캠u dve strane bez deljenja klju캜a. Asimetri캜ni klju캜evi dolaze u paru, sastoje캖i se od **javnog klju캜a i privatnog klju캜a**. Javni klju캜 se deli sa drugima, dok se privatni klju캜 캜uva tajnim.
* **Podr쬬no**: [cryptoKeyVersions.asymmetricSign](https://cloud.google.com/kms/docs/reference/rest/v1/projects.locations.keyRings.cryptoKeys.cryptoKeyVersions/asymmetricSign), [cryptoKeyVersions.getPublicKey](https://cloud.google.com/kms/docs/reference/rest/v1/projects.locations.keyRings.cryptoKeys.cryptoKeyVersions/getPublicKey)
* **Asimetri캜no de코ifrovanje**: Koristi se za proveru autenti캜nosti poruke ili podataka. Digitalni potpis se kreira kori코캖enjem privatnog klju캜a i mo쬰 se verifikovati kori코캖enjem odgovaraju캖eg javnog klju캜a.
* **Podr쬬no**: [cryptoKeyVersions.asymmetricDecrypt](https://cloud.google.com/kms/docs/reference/rest/v1/projects.locations.keyRings.cryptoKeys.cryptoKeyVersions/asymmetricDecrypt), [cryptoKeyVersions.getPublicKey](https://cloud.google.com/kms/docs/reference/rest/v1/projects.locations.keyRings.cryptoKeys.cryptoKeyVersions/getPublicKey)
* **MAC potpisivanje**: Koristi se za osiguranje **integriteta i autenti캜nosti podataka kreiranjem koda za autentikaciju poruke (MAC) kori코캖enjem tajnog klju캜a**. HMAC se 캜esto koristi za autentikaciju poruka u mre쬹im protokolima i softverskim aplikacijama.
* **Podr쬬no**: [cryptoKeyVersions.macSign](https://cloud.google.com/kms/docs/reference/rest/v1/projects.locations.keyRings.cryptoKeys.cryptoKeyVersions/macSign), [cryptoKeyVersions.macVerify](https://cloud.google.com/kms/docs/reference/rest/v1/projects.locations.keyRings.cryptoKeys.cryptoKeyVersions/macVerify)

### Period rotacije i Programiran za period uni코tenja

Podrazumevano, svakih **90 dana**, ali se mo쬰 **lako** i **potpuno prilagoditi.**

Period "Programiran za uni코tenje" je **vreme od kada korisnik zatra쬴 brisanje klju캜a** do trenutka kada je klju캜 **obrisan**. Ne mo쬰 se promeniti nakon 코to je klju캜 kreiran (podrazumevano 1 dan).

### Primarna verzija

Svaki KMS klju캜 mo쬰 imati nekoliko verzija, od kojih jedna mora biti **podrazumevana**, koja 캖e se koristiti kada **verzija nije navedena prilikom interakcije sa KMS klju캜em**.

### Enumeracija

Imaju캖i **dozvole za listanje klju캜eva**, ovako im mo쬰te pristupiti:
```bash
# List the global keyrings available
gcloud kms keyrings list --location global
gcloud kms keyrings get-iam-policy <KEYRING>

# List the keys inside a keyring
gcloud kms keys list --keyring <KEYRING> --location <global/other_locations>
gcloud kms keys get-iam-policy <KEY>

# Encrypt a file using one of your keys
gcloud kms decrypt --ciphertext-file=[INFILE] \
--plaintext-file=[OUTFILE] \
--key [KEY] \
--keyring [KEYRING] \
--location global

# Decrypt a file using one of your keys
gcloud kms decrypt --ciphertext-file=[INFILE] \
--plaintext-file=[OUTFILE] \
--key [KEY] \
--keyring [KEYRING] \
--location global
```
### Eskalacija privilegija

{% content-ref url="../gcp-privilege-escalation/gcp-kms-privesc.md" %}
[gcp-kms-privesc.md](../gcp-privilege-escalation/gcp-kms-privesc.md)
{% endcontent-ref %}

### Post eksploatacija

{% content-ref url="../gcp-post-exploitation/gcp-kms-post-exploitation.md" %}
[gcp-kms-post-exploitation.md](../gcp-post-exploitation/gcp-kms-post-exploitation.md)
{% endcontent-ref %}

## Reference

* [https://about.gitlab.com/blog/2020/02/12/plundering-gcp-escalating-privileges-in-google-cloud-platform/#reviewing-stackdriver-logging](https://about.gitlab.com/blog/2020/02/12/plundering-gcp-escalating-privileges-in-google-cloud-platform/#reviewing-stackdriver-logging)

{% hint style="success" %}
Nau캜ite i ve쬭ajte hakovanje AWS:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Nau캜ite i ve쬭ajte hakovanje GCP: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Podr쬴te HackTricks</summary>

* Proverite [**planove pretplate**](https://github.com/sponsors/carlospolop)!
* **Pridru쬴te se** 游눫 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili **pratite** nas na **Twitteru** 游냕 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podelite hakovanje trikova slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
{% endhint %}
