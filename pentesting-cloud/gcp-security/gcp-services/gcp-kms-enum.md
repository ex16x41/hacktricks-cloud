# GCP - KMS Enum

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## KMS

[**Cloud Key Management Service**](https://cloud.google.com/kms/docs/) **kriptografik anahtarlar** iÃ§in gÃ¼venli bir depolama alanÄ± olarak hizmet eder; bu anahtarlar **hassas verileri ÅŸifrelemek ve ÅŸifre Ã§Ã¶zmek** gibi iÅŸlemler iÃ§in gereklidir. Bu anahtarlar, yapÄ±landÄ±rÄ±lmÄ±ÅŸ yÃ¶netim saÄŸlamak iÃ§in anahtar halkalarÄ± iÃ§inde organize edilir. AyrÄ±ca, eriÅŸim kontrolÃ¼, bireysel anahtar dÃ¼zeyinde veya tÃ¼m anahtar halkasÄ± iÃ§in titizlikle yapÄ±landÄ±rÄ±labilir, bÃ¶ylece izinler gÃ¼venlik gereksinimleriyle tam olarak uyumlu hale getirilir.

KMS anahtar halkalarÄ± **varsayÄ±lan olarak kÃ¼resel** olarak oluÅŸturulur; bu, o anahtar halkasÄ±ndaki anahtarlarÄ±n herhangi bir bÃ¶lgeden eriÅŸilebilir olduÄŸu anlamÄ±na gelir. Ancak, **belirli bÃ¶lgelerde** Ã¶zel anahtar halkalarÄ± oluÅŸturmak mÃ¼mkÃ¼ndÃ¼r.

### Anahtar Koruma Seviyesi

* **YazÄ±lÄ±m anahtarlarÄ±**: YazÄ±lÄ±m anahtarlarÄ± **tamamen yazÄ±lÄ±mda KMS tarafÄ±ndan oluÅŸturulur ve yÃ¶netilir**. Bu anahtarlar **herhangi bir donanÄ±m gÃ¼venlik modÃ¼lÃ¼ (HSM) tarafÄ±ndan korunmaz** ve **test ve geliÅŸtirme amaÃ§larÄ±** iÃ§in kullanÄ±labilir. YazÄ±lÄ±m anahtarlarÄ±, dÃ¼ÅŸÃ¼k gÃ¼venlik saÄŸladÄ±klarÄ± ve saldÄ±rÄ±lara karÅŸÄ± hassas olduklarÄ± iÃ§in **Ã¼retim** kullanÄ±mÄ± iÃ§in Ã¶nerilmez.
* **Bulut tabanlÄ± anahtarlar**: Bulut tabanlÄ± anahtarlar, **KMS tarafÄ±ndan bulutta** yÃ¼ksek kullanÄ±labilirlik ve gÃ¼venilir bir altyapÄ± kullanÄ±larak oluÅŸturulur ve yÃ¶netilir. Bu anahtarlar **HSM'ler tarafÄ±ndan korunur**, ancak HSM'ler **belirli bir mÃ¼ÅŸteri iÃ§in ayrÄ±lmamÄ±ÅŸtÄ±r**. Bulut tabanlÄ± anahtarlar, Ã§oÄŸu Ã¼retim kullanÄ±m durumu iÃ§in uygundur.
* **DÄ±ÅŸ anahtarlar**: DÄ±ÅŸ anahtarlar, **KMS dÄ±ÅŸÄ±nda oluÅŸturulur ve yÃ¶netilir** ve kriptografik iÅŸlemlerde kullanÄ±lmak Ã¼zere KMS'ye aktarÄ±lÄ±r. DÄ±ÅŸ anahtarlar, **mÃ¼ÅŸterinin tercihlerine baÄŸlÄ± olarak bir donanÄ±m gÃ¼venlik modÃ¼lÃ¼nde (HSM) veya bir yazÄ±lÄ±m kÃ¼tÃ¼phanesinde saklanabilir**.

### Anahtar AmaÃ§larÄ±

* **Simetrik ÅŸifreleme/ÅŸifre Ã§Ã¶zme**: **Her iki iÅŸlem iÃ§in tek bir anahtar kullanarak verileri ÅŸifrelemek ve ÅŸifre Ã§Ã¶zmek** iÃ§in kullanÄ±lÄ±r. Simetrik anahtarlar, bÃ¼yÃ¼k veri hacimlerini ÅŸifrelemek ve ÅŸifre Ã§Ã¶zmek iÃ§in hÄ±zlÄ± ve etkilidir.
* **Desteklenen**: [cryptoKeys.encrypt](https://cloud.google.com/kms/docs/reference/rest/v1/projects.locations.keyRings.cryptoKeys/encrypt), [cryptoKeys.decrypt](https://cloud.google.com/kms/docs/reference/rest/v1/projects.locations.keyRings.cryptoKeys/decrypt)
* **Asimetrik Ä°mza**: Anahtar paylaÅŸmadan iki taraf arasÄ±nda gÃ¼venli iletiÅŸim iÃ§in kullanÄ±lÄ±r. Asimetrik anahtarlar, **bir aÃ§Ä±k anahtar ve bir Ã¶zel anahtar** iÃ§eren bir Ã§ift olarak gelir. AÃ§Ä±k anahtar baÅŸkalarÄ±yla paylaÅŸÄ±lÄ±rken, Ã¶zel anahtar gizli tutulur.
* **Desteklenen:** [cryptoKeyVersions.asymmetricSign](https://cloud.google.com/kms/docs/reference/rest/v1/projects.locations.keyRings.cryptoKeys.cryptoKeyVersions/asymmetricSign), [cryptoKeyVersions.getPublicKey](https://cloud.google.com/kms/docs/reference/rest/v1/projects.locations.keyRings.cryptoKeys.cryptoKeyVersions/getPublicKey)
* **Asimetrik Åifre Ã‡Ã¶zme**: Bir mesajÄ±n veya verinin doÄŸruluÄŸunu doÄŸrulamak iÃ§in kullanÄ±lÄ±r. Bir dijital imza, bir Ã¶zel anahtar kullanÄ±larak oluÅŸturulur ve ilgili aÃ§Ä±k anahtar kullanÄ±larak doÄŸrulanabilir.
* **Desteklenen:** [cryptoKeyVersions.asymmetricDecrypt](https://cloud.google.com/kms/docs/reference/rest/v1/projects.locations.keyRings.cryptoKeys.cryptoKeyVersions/asymmetricDecrypt), [cryptoKeyVersions.getPublicKey](https://cloud.google.com/kms/docs/reference/rest/v1/projects.locations.keyRings.cryptoKeys.cryptoKeyVersions/getPublicKey)
* **MAC Ä°mzasÄ±**: **Bir gizli anahtar kullanarak bir mesaj kimlik doÄŸrulama kodu (MAC) oluÅŸturarak veri bÃ¼tÃ¼nlÃ¼ÄŸÃ¼ ve doÄŸruluÄŸunu saÄŸlamak** iÃ§in kullanÄ±lÄ±r. HMAC, aÄŸ protokolleri ve yazÄ±lÄ±m uygulamalarÄ±nda mesaj kimlik doÄŸrulama iÃ§in yaygÄ±n olarak kullanÄ±lÄ±r.
* **Desteklenen:** [cryptoKeyVersions.macSign](https://cloud.google.com/kms/docs/reference/rest/v1/projects.locations.keyRings.cryptoKeys.cryptoKeyVersions/macSign), [cryptoKeyVersions.macVerify](https://cloud.google.com/kms/docs/reference/rest/v1/projects.locations.keyRings.cryptoKeys.cryptoKeyVersions/macVerify)

### DÃ¶nÃ¼ÅŸÃ¼m SÃ¼resi & Yok etme sÃ¼resi iÃ§in programlanmÄ±ÅŸ

**VarsayÄ±lan olarak**, her **90 gÃ¼nde bir** ancak **kolayca** ve **tamamen Ã¶zelleÅŸtirilebilir.**

"Yok etme iÃ§in programlanmÄ±ÅŸ" sÃ¼resi, **kullanÄ±cÄ±nÄ±n anahtarÄ±n silinmesini istemesinden itibaren geÃ§en sÃ¼re** ve anahtarÄ±n **silindiÄŸi** zamana kadardÄ±r. Anahtar oluÅŸturulduktan sonra deÄŸiÅŸtirilemez (varsayÄ±lan 1 gÃ¼n).

### Birincil Versiyon

Her KMS anahtarÄ±nÄ±n birkaÃ§ versiyonu olabilir, bunlardan biri **varsayÄ±lan** olmalÄ±dÄ±r; bu, **KMS anahtarÄ±yla etkileÅŸimde bulunurken bir versiyon belirtilmediÄŸinde kullanÄ±lacak olanÄ±dÄ±r**.

### SayÄ±m

**AnahtarlarÄ± listeleme izinlerine sahip olduÄŸunuzda**, onlara eriÅŸmenin yolu budur:
```bash
# List the global keyrings available
gcloud kms keyrings list --location global
gcloud kms keyrings get-iam-policy <KEYRING>

# List the keys inside a keyring
gcloud kms keys list --keyring <KEYRING> --location <global/other_locations>
gcloud kms keys get-iam-policy <KEY>

# Encrypt a file using one of your keys
gcloud kms encrypt --ciphertext-file=[INFILE] \
--plaintext-file=[OUTFILE] \
--key [KEY] \
--keyring [KEYRING] \
--location global

# Decrypt a file using one of your keys
gcloud kms decrypt --ciphertext-file=[INFILE] \
--plaintext-file=[OUTFILE] \
--key [KEY] \
--keyring [KEYRING] \
--location global
```
### Yetki YÃ¼kseltme

{% content-ref url="../gcp-privilege-escalation/gcp-kms-privesc.md" %}
[gcp-kms-privesc.md](../gcp-privilege-escalation/gcp-kms-privesc.md)
{% endcontent-ref %}

### Ä°stismar SonrasÄ±

{% content-ref url="../gcp-post-exploitation/gcp-kms-post-exploitation.md" %}
[gcp-kms-post-exploitation.md](../gcp-post-exploitation/gcp-kms-post-exploitation.md)
{% endcontent-ref %}

## Referanslar

* [https://about.gitlab.com/blog/2020/02/12/plundering-gcp-escalating-privileges-in-google-cloud-platform/#reviewing-stackdriver-logging](https://about.gitlab.com/blog/2020/02/12/plundering-gcp-escalating-privileges-in-google-cloud-platform/#reviewing-stackdriver-logging)

{% hint style="success" %}
AWS Hacking Ã¶ÄŸrenin ve pratik yapÄ±n:<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
GCP Hacking Ã¶ÄŸrenin ve pratik yapÄ±n: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**abonelik planlarÄ±nÄ±**](https://github.com/sponsors/carlospolop) kontrol edin!
* **ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n ya da **Twitter'da** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**'i takip edin.**
* **Hacking ipuÃ§larÄ±nÄ± paylaÅŸmak iÃ§in** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna PR gÃ¶nderin.

</details>
{% endhint %}
