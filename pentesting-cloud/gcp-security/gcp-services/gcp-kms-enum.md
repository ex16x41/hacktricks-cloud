# GCP - KMS Enum

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** 💬 [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## KMS

[**Cloud Key Management Service**](https://cloud.google.com/kms/docs/) **kriptografik anahtarlar** için güvenli bir depolama alanı olarak hizmet eder; bu anahtarlar **hassas verileri şifrelemek ve şifre çözmek** gibi işlemler için gereklidir. Bu anahtarlar, yapılandırılmış yönetim sağlamak için anahtar halkaları içinde organize edilir. Ayrıca, erişim kontrolü, bireysel anahtar düzeyinde veya tüm anahtar halkası için titizlikle yapılandırılabilir, böylece izinler güvenlik gereksinimleriyle tam olarak uyumlu hale getirilir.

KMS anahtar halkaları **varsayılan olarak küresel** olarak oluşturulur; bu, o anahtar halkasındaki anahtarların herhangi bir bölgeden erişilebilir olduğu anlamına gelir. Ancak, **belirli bölgelerde** özel anahtar halkaları oluşturmak mümkündür.

### Anahtar Koruma Seviyesi

* **Yazılım anahtarları**: Yazılım anahtarları **tamamen yazılımda KMS tarafından oluşturulur ve yönetilir**. Bu anahtarlar **herhangi bir donanım güvenlik modülü (HSM) tarafından korunmaz** ve **test ve geliştirme amaçları** için kullanılabilir. Yazılım anahtarları, düşük güvenlik sağladıkları ve saldırılara karşı hassas oldukları için **üretim** kullanımı için önerilmez.
* **Bulut tabanlı anahtarlar**: Bulut tabanlı anahtarlar, **KMS tarafından bulutta** yüksek kullanılabilirlik ve güvenilir bir altyapı kullanılarak oluşturulur ve yönetilir. Bu anahtarlar **HSM'ler tarafından korunur**, ancak HSM'ler **belirli bir müşteri için ayrılmamıştır**. Bulut tabanlı anahtarlar, çoğu üretim kullanım durumu için uygundur.
* **Dış anahtarlar**: Dış anahtarlar, **KMS dışında oluşturulur ve yönetilir** ve kriptografik işlemlerde kullanılmak üzere KMS'ye aktarılır. Dış anahtarlar, **müşterinin tercihlerine bağlı olarak bir donanım güvenlik modülünde (HSM) veya bir yazılım kütüphanesinde saklanabilir**.

### Anahtar Amaçları

* **Simetrik şifreleme/şifre çözme**: **Her iki işlem için tek bir anahtar kullanarak verileri şifrelemek ve şifre çözmek** için kullanılır. Simetrik anahtarlar, büyük veri hacimlerini şifrelemek ve şifre çözmek için hızlı ve etkilidir.
* **Desteklenen**: [cryptoKeys.encrypt](https://cloud.google.com/kms/docs/reference/rest/v1/projects.locations.keyRings.cryptoKeys/encrypt), [cryptoKeys.decrypt](https://cloud.google.com/kms/docs/reference/rest/v1/projects.locations.keyRings.cryptoKeys/decrypt)
* **Asimetrik İmza**: Anahtar paylaşmadan iki taraf arasında güvenli iletişim için kullanılır. Asimetrik anahtarlar, **bir açık anahtar ve bir özel anahtar** içeren bir çift olarak gelir. Açık anahtar başkalarıyla paylaşılırken, özel anahtar gizli tutulur.
* **Desteklenen:** [cryptoKeyVersions.asymmetricSign](https://cloud.google.com/kms/docs/reference/rest/v1/projects.locations.keyRings.cryptoKeys.cryptoKeyVersions/asymmetricSign), [cryptoKeyVersions.getPublicKey](https://cloud.google.com/kms/docs/reference/rest/v1/projects.locations.keyRings.cryptoKeys.cryptoKeyVersions/getPublicKey)
* **Asimetrik Şifre Çözme**: Bir mesajın veya verinin doğruluğunu doğrulamak için kullanılır. Bir dijital imza, bir özel anahtar kullanılarak oluşturulur ve ilgili açık anahtar kullanılarak doğrulanabilir.
* **Desteklenen:** [cryptoKeyVersions.asymmetricDecrypt](https://cloud.google.com/kms/docs/reference/rest/v1/projects.locations.keyRings.cryptoKeys.cryptoKeyVersions/asymmetricDecrypt), [cryptoKeyVersions.getPublicKey](https://cloud.google.com/kms/docs/reference/rest/v1/projects.locations.keyRings.cryptoKeys.cryptoKeyVersions/getPublicKey)
* **MAC İmzası**: **Bir gizli anahtar kullanarak bir mesaj kimlik doğrulama kodu (MAC) oluşturarak veri bütünlüğü ve doğruluğunu sağlamak** için kullanılır. HMAC, ağ protokolleri ve yazılım uygulamalarında mesaj kimlik doğrulama için yaygın olarak kullanılır.
* **Desteklenen:** [cryptoKeyVersions.macSign](https://cloud.google.com/kms/docs/reference/rest/v1/projects.locations.keyRings.cryptoKeys.cryptoKeyVersions/macSign), [cryptoKeyVersions.macVerify](https://cloud.google.com/kms/docs/reference/rest/v1/projects.locations.keyRings.cryptoKeys.cryptoKeyVersions/macVerify)

### Dönüşüm Süresi & Yok etme süresi için programlanmış

**Varsayılan olarak**, her **90 günde bir** ancak **kolayca** ve **tamamen özelleştirilebilir.**

"Yok etme için programlanmış" süresi, **kullanıcının anahtarın silinmesini istemesinden itibaren geçen süre** ve anahtarın **silindiği** zamana kadardır. Anahtar oluşturulduktan sonra değiştirilemez (varsayılan 1 gün).

### Birincil Versiyon

Her KMS anahtarının birkaç versiyonu olabilir, bunlardan biri **varsayılan** olmalıdır; bu, **KMS anahtarıyla etkileşimde bulunurken bir versiyon belirtilmediğinde kullanılacak olanıdır**.

### Sayım

**Anahtarları listeleme izinlerine sahip olduğunuzda**, onlara erişmenin yolu budur:
```bash
# List the global keyrings available
gcloud kms keyrings list --location global
gcloud kms keyrings get-iam-policy <KEYRING>

# List the keys inside a keyring
gcloud kms keys list --keyring <KEYRING> --location <global/other_locations>
gcloud kms keys get-iam-policy <KEY>

# Encrypt a file using one of your keys
gcloud kms encrypt --ciphertext-file=[INFILE] \
--plaintext-file=[OUTFILE] \
--key [KEY] \
--keyring [KEYRING] \
--location global

# Decrypt a file using one of your keys
gcloud kms decrypt --ciphertext-file=[INFILE] \
--plaintext-file=[OUTFILE] \
--key [KEY] \
--keyring [KEYRING] \
--location global
```
### Yetki Yükseltme

{% content-ref url="../gcp-privilege-escalation/gcp-kms-privesc.md" %}
[gcp-kms-privesc.md](../gcp-privilege-escalation/gcp-kms-privesc.md)
{% endcontent-ref %}

### İstismar Sonrası

{% content-ref url="../gcp-post-exploitation/gcp-kms-post-exploitation.md" %}
[gcp-kms-post-exploitation.md](../gcp-post-exploitation/gcp-kms-post-exploitation.md)
{% endcontent-ref %}

## Referanslar

* [https://about.gitlab.com/blog/2020/02/12/plundering-gcp-escalating-privileges-in-google-cloud-platform/#reviewing-stackdriver-logging](https://about.gitlab.com/blog/2020/02/12/plundering-gcp-escalating-privileges-in-google-cloud-platform/#reviewing-stackdriver-logging)

{% hint style="success" %}
AWS Hacking öğrenin ve pratik yapın:<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
GCP Hacking öğrenin ve pratik yapın: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**abonelik planlarını**](https://github.com/sponsors/carlospolop) kontrol edin!
* **💬 [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katılın ya da **Twitter'da** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**'i takip edin.**
* **Hacking ipuçlarını paylaşmak için** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna PR gönderin.

</details>
{% endhint %}
