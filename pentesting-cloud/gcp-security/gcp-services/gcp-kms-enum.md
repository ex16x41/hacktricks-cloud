# GCP - KMS Enum

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## KMS

Le [**Cloud Key Management Service**](https://cloud.google.com/kms/docs/) sert de stockage s√©curis√© pour les **cl√©s cryptographiques**, qui sont essentielles pour des op√©rations telles que **le chiffrement et le d√©chiffrement de donn√©es sensibles**. Ces cl√©s sont organis√©es au sein de cercles de cl√©s, permettant une gestion structur√©e. De plus, le contr√¥le d'acc√®s peut √™tre m√©ticuleusement configur√©, soit au niveau de la cl√© individuelle, soit pour l'ensemble du cercle de cl√©s, garantissant que les autorisations sont pr√©cis√©ment align√©es avec les exigences de s√©curit√©.

Les cercles de cl√©s KMS sont par **d√©faut cr√©√©s comme globaux**, ce qui signifie que les cl√©s √† l'int√©rieur de ce cercle de cl√©s sont accessibles depuis n'importe quelle r√©gion. Cependant, il est possible de cr√©er des cercles de cl√©s sp√©cifiques dans **des r√©gions sp√©cifiques**.

### Niveau de protection des cl√©s

* **Cl√©s logicielles** : Les cl√©s logicielles sont **cr√©√©es et g√©r√©es par KMS enti√®rement en logiciel**. Ces cl√©s ne sont **pas prot√©g√©es par un module de s√©curit√© mat√©riel (HSM)** et peuvent √™tre utilis√©es √† des fins de **test et de d√©veloppement**. Les cl√©s logicielles ne sont **pas recommand√©es pour une utilisation en production** car elles offrent une faible s√©curit√© et sont susceptibles aux attaques.
* **Cl√©s h√©berg√©es dans le cloud** : Les cl√©s h√©berg√©es dans le cloud sont **cr√©√©es et g√©r√©es par KMS** dans le cloud en utilisant une infrastructure hautement disponible et fiable. Ces cl√©s sont **prot√©g√©es par des HSM**, mais les HSM ne sont **pas d√©di√©s √† un client sp√©cifique**. Les cl√©s h√©berg√©es dans le cloud conviennent √† la plupart des cas d'utilisation en production.
* **Cl√©s externes** : Les cl√©s externes sont **cr√©√©es et g√©r√©es en dehors de KMS**, et sont import√©es dans KMS pour √™tre utilis√©es dans des op√©rations cryptographiques. Les cl√©s externes **peuvent √™tre stock√©es dans un module de s√©curit√© mat√©riel (HSM) ou une biblioth√®que logicielle, selon la pr√©f√©rence du client**.

### Objectifs des cl√©s

* **Chiffrement/d√©chiffrement sym√©trique** : Utilis√© pour **chiffrer et d√©chiffrer des donn√©es en utilisant une seule cl√© pour les deux op√©rations**. Les cl√©s sym√©triques sont rapides et efficaces pour chiffrer et d√©chiffrer de grands volumes de donn√©es.
* **Support√©** : [cryptoKeys.encrypt](https://cloud.google.com/kms/docs/reference/rest/v1/projects.locations.keyRings.cryptoKeys/encrypt), [cryptoKeys.decrypt](https://cloud.google.com/kms/docs/reference/rest/v1/projects.locations.keyRings.cryptoKeys/decrypt)
* **Signature asym√©trique** : Utilis√© pour une communication s√©curis√©e entre deux parties sans partager la cl√©. Les cl√©s asym√©triques se pr√©sentent sous forme de paire, compos√©e d'une **cl√© publique et d'une cl√© priv√©e**. La cl√© publique est partag√©e avec d'autres, tandis que la cl√© priv√©e est gard√©e secr√®te.
* **Support√© :** [cryptoKeyVersions.asymmetricSign](https://cloud.google.com/kms/docs/reference/rest/v1/projects.locations.keyRings.cryptoKeys.cryptoKeyVersions/asymmetricSign), [cryptoKeyVersions.getPublicKey](https://cloud.google.com/kms/docs/reference/rest/v1/projects.locations.keyRings.cryptoKeys.cryptoKeyVersions/getPublicKey)
* **D√©chiffrement asym√©trique** : Utilis√© pour v√©rifier l'authenticit√© d'un message ou de donn√©es. Une signature num√©rique est cr√©√©e √† l'aide d'une cl√© priv√©e et peut √™tre v√©rifi√©e √† l'aide de la cl√© publique correspondante.
* **Support√© :** [cryptoKeyVersions.asymmetricDecrypt](https://cloud.google.com/kms/docs/reference/rest/v1/projects.locations.keyRings.cryptoKeys.cryptoKeyVersions/asymmetricDecrypt), [cryptoKeyVersions.getPublicKey](https://cloud.google.com/kms/docs/reference/rest/v1/projects.locations.keyRings.cryptoKeys.cryptoKeyVersions/getPublicKey)
* **Signature MAC** : Utilis√© pour garantir **l'int√©grit√© et l'authenticit√© des donn√©es en cr√©ant un code d'authentification de message (MAC) √† l'aide d'une cl√© secr√®te**. HMAC est couramment utilis√© pour l'authentification des messages dans les protocoles r√©seau et les applications logicielles.
* **Support√© :** [cryptoKeyVersions.macSign](https://cloud.google.com/kms/docs/reference/rest/v1/projects.locations.keyRings.cryptoKeys.cryptoKeyVersions/macSign), [cryptoKeyVersions.macVerify](https://cloud.google.com/kms/docs/reference/rest/v1/projects.locations.keyRings.cryptoKeys.cryptoKeyVersions/macVerify)

### P√©riode de rotation & p√©riode programm√©e pour destruction

Par **d√©faut**, chaque **90 jours** mais cela peut √™tre **facilement** et **compl√®tement personnalis√©.**

La p√©riode "programm√©e pour destruction" est le **temps depuis que l'utilisateur demande la suppression de la cl√©** jusqu'√† ce que la cl√© soit **supprim√©e**. Elle ne peut pas √™tre modifi√©e apr√®s la cr√©ation de la cl√© (par d√©faut 1 jour).

### Version principale

Chaque cl√© KMS peut avoir plusieurs versions, l'une d'elles doit √™tre la **version par d√©faut**, celle-ci sera utilis√©e lorsqu'une **version n'est pas sp√©cifi√©e lors de l'interaction avec la cl√© KMS**.

### √ânum√©ration

Ayant **les autorisations pour lister les cl√©s**, voici comment vous pouvez y acc√©der :
```bash
# List the global keyrings available
gcloud kms keyrings list --location global
gcloud kms keyrings get-iam-policy <KEYRING>

# List the keys inside a keyring
gcloud kms keys list --keyring <KEYRING> --location <global/other_locations>
gcloud kms keys get-iam-policy <KEY>

# Encrypt a file using one of your keys
gcloud kms encrypt --ciphertext-file=[INFILE] \
--plaintext-file=[OUTFILE] \
--key [KEY] \
--keyring [KEYRING] \
--location global

# Decrypt a file using one of your keys
gcloud kms decrypt --ciphertext-file=[INFILE] \
--plaintext-file=[OUTFILE] \
--key [KEY] \
--keyring [KEYRING] \
--location global
```
### Escalade de privil√®ges

{% content-ref url="../gcp-privilege-escalation/gcp-kms-privesc.md" %}
[gcp-kms-privesc.md](../gcp-privilege-escalation/gcp-kms-privesc.md)
{% endcontent-ref %}

### Post-exploitation

{% content-ref url="../gcp-post-exploitation/gcp-kms-post-exploitation.md" %}
[gcp-kms-post-exploitation.md](../gcp-post-exploitation/gcp-kms-post-exploitation.md)
{% endcontent-ref %}

## R√©f√©rences

* [https://about.gitlab.com/blog/2020/02/12/plundering-gcp-escalating-privileges-in-google-cloud-platform/#reviewing-stackdriver-logging](https://about.gitlab.com/blog/2020/02/12/plundering-gcp-escalating-privileges-in-google-cloud-platform/#reviewing-stackdriver-logging)

{% hint style="success" %}
Apprenez et pratiquez le hacking AWS :<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Formation Expert Red Team AWS (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Apprenez et pratiquez le hacking GCP : <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Formation Expert Red Team GCP (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Soutenir HackTricks</summary>

* Consultez les [**plans d'abonnement**](https://github.com/sponsors/carlospolop) !
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez-nous** sur **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Partagez des astuces de hacking en soumettant des PR aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) d√©p√¥ts github.

</details>
{% endhint %}
