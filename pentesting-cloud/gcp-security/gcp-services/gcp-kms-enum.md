# GCP - KMS Enum

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** 游눫 [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** 游냕 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## KMS

[**Cloud Key Management Service**](https://cloud.google.com/kms/docs/) slu쬴 kao sigurno skladi코te za **kriptografske klju캜eve**, koji su neophodni za operacije kao 코to su **코ifrovanje i de코ifrovanje osetljivih podataka**. Ovi klju캜evi su organizovani unutar klju캜nih prstenova, 코to omogu캖ava strukturirano upravljanje. Pored toga, kontrola pristupa mo쬰 se pa쬷jivo konfigurisati, bilo na nivou pojedina캜nog klju캜a ili za ceo klju캜ni prsten, osiguravaju캖i da su dozvole precizno uskla캠ene sa bezbednosnim zahtevima.

KMS klju캜ni prstenovi su po **defaultu kreirani kao globalni**, 코to zna캜i da su klju캜evi unutar tog klju캜nog prstena dostupni iz bilo koje regije. Me캠utim, mogu캖e je kreirati specifi캜ne klju캜ne prstenove u **specifi캜nim regijama**.

### Nivo za코tite klju캜eva

* **Softverski klju캜evi**: Softverski klju캜evi su **kreirani i upravljani od strane KMS-a potpuno u softveru**. Ovi klju캜evi **nisu za코ti캖eni nijednim hardverskim bezbednosnim modulom (HSM)** i mogu se koristiti za **testiranje i razvojne svrhe**. Softverski klju캜evi se **ne preporu캜uju za proizvodnu** upotrebu jer pru쬬ju nisku bezbednost i podlo쬹i su napadima.
* **Klju캜evi u oblaku**: Klju캜evi u oblaku su **kreirani i upravljani od strane KMS-a** u oblaku koriste캖i visoko dostupnu i pouzdanu infrastrukturu. Ovi klju캜evi su **za코ti캖eni HSM-ima**, ali HSM-ovi nisu **posve캖eni odre캠enom korisniku**. Klju캜evi u oblaku su pogodni za ve캖inu proizvodnih slu캜ajeva.
* **Eksterni klju캜evi**: Eksterni klju캜evi su **kreirani i upravljani van KMS-a**, i uvoze se u KMS za kori코캖enje u kriptografskim operacijama. Eksterni klju캜evi **mogu biti pohranjeni u hardverskom bezbednosnom modulu (HSM) ili softverskoj biblioteci, u zavisnosti od preferencija korisnika**.

### Svrhe klju캜eva

* **Simetri캜no 코ifrovanje/de코ifrovanje**: Koristi se za **코ifrovanje i de코ifrovanje podataka koriste캖i jedan klju캜 za obe operacije**. Simetri캜ni klju캜evi su brzi i efikasni za 코ifrovanje i de코ifrovanje velikih koli캜ina podataka.
* **Podr쬬no**: [cryptoKeys.encrypt](https://cloud.google.com/kms/docs/reference/rest/v1/projects.locations.keyRings.cryptoKeys/encrypt), [cryptoKeys.decrypt](https://cloud.google.com/kms/docs/reference/rest/v1/projects.locations.keyRings.cryptoKeys/decrypt)
* **Asimetri캜no potpisivanje**: Koristi se za sigurnu komunikaciju izme캠u dve strane bez deljenja klju캜a. Asimetri캜ni klju캜evi dolaze u paru, koji se sastoji od **javnog klju캜a i privatnog klju캜a**. Javni klju캜 se deli sa drugima, dok se privatni klju캜 캜uva u tajnosti.
* **Podr쬬no:** [cryptoKeyVersions.asymmetricSign](https://cloud.google.com/kms/docs/reference/rest/v1/projects.locations.keyRings.cryptoKeys.cryptoKeyVersions/asymmetricSign), [cryptoKeyVersions.getPublicKey](https://cloud.google.com/kms/docs/reference/rest/v1/projects.locations.keyRings.cryptoKeys.cryptoKeyVersions/getPublicKey)
* **Asimetri캜no de코ifrovanje**: Koristi se za verifikaciju autenti캜nosti poruke ili podataka. Digitalni potpis se kreira koriste캖i privatni klju캜 i mo쬰 se verifikovati koriste캖i odgovaraju캖i javni klju캜.
* **Podr쬬no:** [cryptoKeyVersions.asymmetricDecrypt](https://cloud.google.com/kms/docs/reference/rest/v1/projects.locations.keyRings.cryptoKeys.cryptoKeyVersions/asymmetricDecrypt), [cryptoKeyVersions.getPublicKey](https://cloud.google.com/kms/docs/reference/rest/v1/projects.locations.keyRings.cryptoKeys.cryptoKeyVersions/getPublicKey)
* **MAC potpisivanje**: Koristi se za osiguranje **integriteta i autenti캜nosti podataka kreiranjem koda za autentifikaciju poruka (MAC) koriste캖i tajni klju캜**. HMAC se 캜esto koristi za autentifikaciju poruka u mre쬹im protokolima i softverskim aplikacijama.
* **Podr쬬no:** [cryptoKeyVersions.macSign](https://cloud.google.com/kms/docs/reference/rest/v1/projects.locations.keyRings.cryptoKeys.cryptoKeyVersions/macSign), [cryptoKeyVersions.macVerify](https://cloud.google.com/kms/docs/reference/rest/v1/projects.locations.keyRings.cryptoKeys.cryptoKeyVersions/macVerify)

### Period rotacije i period programiran za uni코tenje

Po **defaultu**, svaki **90 dana**, ali se mo쬰 **lako** i **potpuno prilagoditi.**

Period "Programiran za uni코tenje" je **vreme od kada korisnik zatra쬴 brisanje klju캜a** do trenutka kada je klju캜 **obrisan**. Ne mo쬰 se promeniti nakon 코to je klju캜 kreiran (default 1 dan).

### Primarna verzija

Svaki KMS klju캜 mo쬰 imati nekoliko verzija, jedna od njih mora biti **default** verzija, koja 캖e se koristiti kada **verzija nije specificirana prilikom interakcije sa KMS klju캜em**.

### Enumeracija

Imaju캖i **dozvole za listanje klju캜eva**, ovako mo쬰te pristupiti njima:
```bash
# List the global keyrings available
gcloud kms keyrings list --location global
gcloud kms keyrings get-iam-policy <KEYRING>

# List the keys inside a keyring
gcloud kms keys list --keyring <KEYRING> --location <global/other_locations>
gcloud kms keys get-iam-policy <KEY>

# Encrypt a file using one of your keys
gcloud kms encrypt --ciphertext-file=[INFILE] \
--plaintext-file=[OUTFILE] \
--key [KEY] \
--keyring [KEYRING] \
--location global

# Decrypt a file using one of your keys
gcloud kms decrypt --ciphertext-file=[INFILE] \
--plaintext-file=[OUTFILE] \
--key [KEY] \
--keyring [KEYRING] \
--location global
```
### Eskalacija privilegija

{% content-ref url="../gcp-privilege-escalation/gcp-kms-privesc.md" %}
[gcp-kms-privesc.md](../gcp-privilege-escalation/gcp-kms-privesc.md)
{% endcontent-ref %}

### Post eksploatacija

{% content-ref url="../gcp-post-exploitation/gcp-kms-post-exploitation.md" %}
[gcp-kms-post-exploitation.md](../gcp-post-exploitation/gcp-kms-post-exploitation.md)
{% endcontent-ref %}

## Reference

* [https://about.gitlab.com/blog/2020/02/12/plundering-gcp-escalating-privileges-in-google-cloud-platform/#reviewing-stackdriver-logging](https://about.gitlab.com/blog/2020/02/12/plundering-gcp-escalating-privileges-in-google-cloud-platform/#reviewing-stackdriver-logging)

{% hint style="success" %}
U캜ite i ve쬭ajte AWS Hacking:<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
U캜ite i ve쬭ajte GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Podr쬴te HackTricks</summary>

* Proverite [**planove pretplate**](https://github.com/sponsors/carlospolop)!
* **Pridru쬴te se** 游눫 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili **pratite** nas na **Twitteru** 游냕 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podelite hakerske trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
{% endhint %}
