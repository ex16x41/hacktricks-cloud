# GCP - Artifact Registry Enum

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Grundinformationen

Google Cloud Artifact Registry ist ein vollst√§ndig verwalteter Dienst, der es Ihnen erm√∂glicht, **Ihre Softwareartefakte zu verwalten, zu speichern und zu sichern**. Es ist im Wesentlichen ein Repository zum **Speichern von Build-Abh√§ngigkeiten**, wie **Docker**-Images, **Maven**, npm-Paketen und anderen Arten von Artefakten. Es wird **h√§ufig in CI/CD-Pipelines** verwendet, um die w√§hrend des Softwareentwicklungsprozesses produzierten Artefakte zu speichern und zu versionieren.

Wichtige Funktionen des Artifact Registry umfassen:

1. **Einheitliches Repository**: Es unterst√ºtzt **mehrere Arten von Artefakten**, sodass Sie ein einzelnes Repository f√ºr Docker-Images, Sprachpakete (wie Javas Maven, Node.js npm) und andere Arten von Artefakten haben k√∂nnen, was konsistente Zugriffskontrollen und eine einheitliche Ansicht √ºber alle Ihre Artefakte erm√∂glicht.
2. **Vollst√§ndig verwaltet**: Als verwalteter Dienst k√ºmmert es sich um die zugrunde liegende Infrastruktur, Skalierung und Sicherheit, wodurch der Wartungsaufwand f√ºr die Benutzer reduziert wird.
3. **Feingranulare Zugriffskontrolle**: Es integriert sich mit Googles Identity and Access Management (IAM), sodass Sie definieren k√∂nnen, wer auf Ihre Artefakte in Ihren Repositories zugreifen, sie hochladen oder herunterladen kann.
4. **Geo-Replikation**: Es unterst√ºtzt die Replikation von Artefakten √ºber mehrere Regionen hinweg, verbessert die Downloadgeschwindigkeit und gew√§hrleistet die Verf√ºgbarkeit.
5. **Integration mit Google Cloud-Diensten**: Es funktioniert nahtlos mit **anderen GCP-Diensten wie Cloud Build, Kubernetes Engine und Compute Engine**, was es zu einer praktischen Wahl f√ºr Teams macht, die bereits im Google Cloud-√ñkosystem arbeiten.
6. **Sicherheit**: Bietet Funktionen wie **Schwachstellenscanning und Containeranalyse**, um sicherzustellen, dass die gespeicherten Artefakte sicher und frei von bekannten Sicherheitsproblemen sind.

### Formate und Modi

Beim Erstellen eines neuen Repositories ist es m√∂glich, **das Format/den Typ** des Repositories aus mehreren wie Docker, Maven, npm, Python... auszuw√§hlen und den Modus, der normalerweise einer dieser drei sein kann:

* **Standard-Repository**: Standardmodus zum **Speichern Ihrer eigenen Artefakte** (wie Docker-Images, Maven-Pakete) direkt in GCP. Es ist sicher, skalierbar und integriert sich gut in das Google Cloud-√ñkosystem.
* **Remote-Repository** (falls verf√ºgbar): Fungiert als Proxy zum **Caching von Artefakten aus externen**, √∂ffentlichen Repositories. Es hilft, Probleme durch √Ñnderungen von Abh√§ngigkeiten upstream zu verhindern und reduziert die Latenz, indem h√§ufig verwendete Artefakte zwischengespeichert werden.
* **Virtuelles Repository** (falls verf√ºgbar): Bietet eine **einheitliche Schnittstelle zum Zugriff auf mehrere (Standard- oder Remote-) Repositories** √ºber einen einzigen Endpunkt, was die clientseitige Konfiguration und das Zugriffsmanagement f√ºr √ºber verschiedene Repositories verteilte Artefakte vereinfacht.
* F√ºr ein virtuelles Repository m√ºssen Sie **Repositories ausw√§hlen und ihnen eine Priorit√§t geben** (das Repository mit der h√∂chsten Priorit√§t wird verwendet).
* Sie k√∂nnen **Remote- und Standard**-Repositories in einem **virtuellen** kombinieren, wenn die **Priorit√§t** des **Remote** h√∂her ist als die des Standard, **werden Pakete von Remote (z. B. PyPi) verwendet**. Dies k√∂nnte zu einer **Dependency Confusion** f√ºhren.

Beachten Sie, dass es in der **Remote-Version von Docker** m√∂glich ist, einen Benutzernamen und ein Token zum Zugriff auf Docker Hub anzugeben. Das **Token wird dann im Secret Manager gespeichert**.

### Verschl√ºsselung

Wie erwartet wird standardm√§√üig ein von Google verwalteter Schl√ºssel verwendet, aber ein vom Kunden verwalteter Schl√ºssel kann angegeben werden (CMEK).

### Bereinigungspolitiken

* **Artefakte l√∂schen:** Artefakte werden **gem√§√ü den Kriterien der Bereinigungspolitik gel√∂scht**.
* **Trockenlauf:** (Standard) Artefakte werden **nicht gel√∂scht**. Die Bereinigungspolitiken werden bewertet und Testl√∂schereignisse an Cloud Audit Logging gesendet.

### Schwachstellenscanning

Es ist m√∂glich, den **Schwachstellenscanner** zu aktivieren, der nach Schwachstellen in **Container-Images** sucht.

### Enumeration
```bash
# Get repositories
gcloud artifacts repositories list
gcloud artifacts repositories describe --location <location> <repo-name>
gcloud artifacts versions list --repository=<repo-name> -location <location> --package <package-name>

# Get settings of a repository (example using python but could be other)
gcloud artifacts print-settings python --repository <repo-name> --location <location>

# Get docker images
gcloud artifacts docker images list us-central1-docker.pkg.dev/<proj-name>/<repo-name>

# Get packages (like python and others...)
gcloud artifacts packages list --repository <repo-name> --location <location>

# Get SBOMB artifacts
gcloud artifacts sbom list

# Get vulnerabilities (docker images)
gcloud artifacts vulnerabilities list us-east1-docker.pkg.dev/project123/repository123/someimage@sha256:49765698074d6d7baa82f
gcloud artifacts docker images list-vulnerabilities projects/<proj-name>/locations/<location>/scans/<scan-uuid>
```
### Privilegienerweiterung

{% content-ref url="../gcp-privilege-escalation/gcp-artifact-registry-privesc.md" %}
[gcp-artifact-registry-privesc.md](../gcp-privilege-escalation/gcp-artifact-registry-privesc.md)
{% endcontent-ref %}

### Unauthentifizierter Zugriff

{% content-ref url="../gcp-unauthenticated-enum-and-access/gcp-artifact-registry-unauthenticated-enum.md" %}
[gcp-artifact-registry-unauthenticated-enum.md](../gcp-unauthenticated-enum-and-access/gcp-artifact-registry-unauthenticated-enum.md)
{% endcontent-ref %}

### Post-Exploitation

{% content-ref url="../gcp-post-exploitation/gcp-artifact-registry-post-exploitation.md" %}
[gcp-artifact-registry-post-exploitation.md](../gcp-post-exploitation/gcp-artifact-registry-post-exploitation.md)
{% endcontent-ref %}

### Persistenz

{% content-ref url="../gcp-persistence/gcp-artifact-registry-persistence.md" %}
[gcp-artifact-registry-persistence.md](../gcp-persistence/gcp-artifact-registry-persistence.md)
{% endcontent-ref %}

{% hint style="success" %}
Lerne & √ºbe AWS Hacking:<img src="../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">\
Lerne & √ºbe GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Unterst√ºtze HackTricks</summary>

* √úberpr√ºfe die [**Abonnementpl√§ne**](https://github.com/sponsors/carlospolop)!
* **Tritt der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folge** uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teile Hacking-Tricks, indem du PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repos sendest.

</details>
{% endhint %}
