# GCP - Artifact Registry Enum

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Basic Information

Google Cloud Artifact Registry √® un servizio completamente gestito che consente di **gestire, archiviare e proteggere i propri artefatti software**. √à essenzialmente un repository per **archiviare le dipendenze di build**, come **immagini Docker**, **Maven**, pacchetti npm e altri tipi di artefatti. √à **comunemente utilizzato nei pipeline CI/CD** per archiviare e versionare gli artefatti prodotti durante il processo di sviluppo software.

Le caratteristiche principali di Artifact Registry includono:

1. **Repository Unificato**: Supporta **pi√π tipi di artefatti**, consentendo di avere un unico repository per immagini Docker, pacchetti di linguaggi (come Maven di Java, npm di Node.js) e altri tipi di artefatti, abilitando controlli di accesso coerenti e una vista unificata su tutti i propri artefatti.
2. **Completamente Gestito**: Essendo un servizio gestito, si occupa dell'infrastruttura sottostante, della scalabilit√† e della sicurezza, riducendo il carico di manutenzione per gli utenti.
3. **Controllo degli Accessi Flessibile**: Si integra con l'Identity and Access Management (IAM) di Google Cloud, consentendo di definire chi pu√≤ accedere, caricare o scaricare artefatti nei propri repository.
4. **Geo-replica**: Supporta la replica di artefatti in pi√π regioni, migliorando la velocit√† dei download e garantendo disponibilit√†.
5. **Integrazione con i Servizi Google Cloud**: Funziona senza problemi con **altri servizi GCP come Cloud Build, Kubernetes Engine e Compute Engine**, rendendolo una scelta conveniente per i team gi√† attivi nell'ecosistema Google Cloud.
6. **Sicurezza**: Offre funzionalit√† come **scansione delle vulnerabilit√† e analisi dei container** per aiutare a garantire che gli artefatti archiviati siano sicuri e privi di problemi di sicurezza noti.

### Formats and Modes

Quando si crea un nuovo repository √® possibile **selezionare il formato/tipo** del repository tra diversi come Docker, Maven, npm, Python... e la modalit√† che di solito pu√≤ essere una di queste tre:

* **Repository Standard**: Modalit√† predefinita per **archiviare i propri artefatti** (come immagini Docker, pacchetti Maven) direttamente in GCP. √à sicuro, scalabile e si integra bene nell'ecosistema Google Cloud.
* **Repository Remoto** (se disponibile): Funziona come un proxy per **caching di artefatti da repository esterni**, pubblici. Aiuta a prevenire problemi derivanti da dipendenze che cambiano a monte e riduce la latenza memorizzando nella cache artefatti frequentemente accessibili.
* **Repository Virtuale** (se disponibile): Fornisce un **interfaccia unificata per accedere a pi√π repository (standard o remoti)** attraverso un unico endpoint, semplificando la configurazione lato client e la gestione degli accessi per artefatti distribuiti su vari repository.
* Per un repository virtuale sar√† necessario **selezionare i repository e assegnare loro una priorit√†** (il repository con la priorit√† pi√π alta sar√† utilizzato).
* √à possibile **mescolare repository remoti e standard** in uno **virtuale**, se la **priorit√†** del **remoto** √® **maggiore** rispetto allo standard, **i pacchetti dal remoto (ad esempio PyPi) saranno utilizzati**. Questo potrebbe portare a una **Confusione delle Dipendenze.**

Nota che nella **versione Remota di Docker** √® possibile fornire un nome utente e un token per accedere a Docker Hub. Il **token viene quindi memorizzato nel Secret Manager**.

### Encryption

Come previsto, per impostazione predefinita viene utilizzata una chiave gestita da Google, ma pu√≤ essere indicata una chiave gestita dal cliente (CMEK).

### Cleanup Policies

* **Elimina artefatti:** Gli artefatti saranno **eliminati secondo i criteri della politica di pulizia**.
* **Esecuzione in prova:** (Quella predefinita) Gli artefatti **non saranno eliminati**. Le politiche di pulizia saranno valutate e gli eventi di eliminazione di prova inviati a Cloud Audit Logging.

### Vulnerability Scanning

√à possibile abilitare lo **scanner di vulnerabilit√†** che controller√† la presenza di vulnerabilit√† all'interno delle **immagini dei container**.

### Enumeration
```bash
# Get repositories
gcloud artifacts repositories list
gcloud artifacts repositories describe --location <location> <repo-name>
gcloud artifacts versions list --repository=<repo-name> -location <location> --package <package-name>

# Get settings of a repository (example using python but could be other)
gcloud artifacts print-settings python --repository <repo-name> --location <location>

# Get docker images
gcloud artifacts docker images list us-central1-docker.pkg.dev/<proj-name>/<repo-name>

# Get packages (like python and others...)
gcloud artifacts packages list --repository <repo-name> --location <location>

# Get SBOMB artifacts
gcloud artifacts sbom list

# Get vulnerabilities (docker images)
gcloud artifacts vulnerabilities list us-east1-docker.pkg.dev/project123/repository123/someimage@sha256:49765698074d6d7baa82f
gcloud artifacts docker images list-vulnerabilities projects/<proj-name>/locations/<location>/scans/<scan-uuid>
```
### Escalation dei privilegi

{% content-ref url="../gcp-privilege-escalation/gcp-artifact-registry-privesc.md" %}
[gcp-artifact-registry-privesc.md](../gcp-privilege-escalation/gcp-artifact-registry-privesc.md)
{% endcontent-ref %}

### Accesso non autenticato

{% content-ref url="../gcp-unaunthenticated-enum-and-access/gcp-artifact-registry-unauthenticated-enum.md" %}
[gcp-artifact-registry-unauthenticated-enum.md](../gcp-unaunthenticated-enum-and-access/gcp-artifact-registry-unauthenticated-enum.md)
{% endcontent-ref %}

### Post-sfruttamento

{% content-ref url="../gcp-post-exploitation/gcp-artifact-registry-post-exploitation.md" %}
[gcp-artifact-registry-post-exploitation.md](../gcp-post-exploitation/gcp-artifact-registry-post-exploitation.md)
{% endcontent-ref %}

### Persistenza

{% content-ref url="../gcp-persistence/gcp-artifact-registry-persistence.md" %}
[gcp-artifact-registry-persistence.md](../gcp-persistence/gcp-artifact-registry-persistence.md)
{% endcontent-ref %}

{% hint style="success" %}
Impara e pratica Hacking AWS:<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Impara e pratica Hacking GCP: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Supporta HackTricks</summary>

* Controlla i [**piani di abbonamento**](https://github.com/sponsors/carlospolop)!
* **Unisciti al** üí¨ [**gruppo Discord**](https://discord.gg/hRep4RUj7f) o al [**gruppo telegram**](https://t.me/peass) o **seguici** su **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Condividi trucchi di hacking inviando PR ai** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repos di github.

</details>
{% endhint %}
