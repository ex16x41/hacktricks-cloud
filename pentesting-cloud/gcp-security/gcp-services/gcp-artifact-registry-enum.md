# GCP - Enum√©ration de l'Artifact Registry

{% hint style="success" %}
Apprenez et pratiquez le hacking AWS :<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**Formation HackTricks AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
Apprenez et pratiquez le hacking GCP : <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**Formation HackTricks GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Soutenir HackTricks</summary>

* Consultez les [**plans d'abonnement**](https://github.com/sponsors/carlospolop) !
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez-nous sur** **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Partagez des astuces de hacking en soumettant des PRs aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) d√©p√¥ts GitHub.

</details>
{% endhint %}

## Informations de base

Google Cloud Artifact Registry est un service enti√®rement g√©r√© qui vous permet de **g√©rer, stocker et s√©curiser vos artefacts logiciels**. C'est essentiellement un d√©p√¥t pour **stocker les d√©pendances de construction**, telles que les **images Docker**, les **Maven**, les paquets npm et d'autres types d'artefacts. Il est **couramment utilis√© dans les pipelines CI/CD** pour stocker et versionner les artefacts produits lors du processus de d√©veloppement logiciel.

Les principales caract√©ristiques de l'Artifact Registry incluent :

1. **D√©p√¥t unifi√©** : Il prend en charge **plusieurs types d'artefacts**, vous permettant d'avoir un seul d√©p√¥t pour les images Docker, les paquets de langage (comme Maven de Java, npm de Node.js) et d'autres types d'artefacts, permettant des contr√¥les d'acc√®s coh√©rents et une vue unifi√©e de tous vos artefacts.
2. **Enti√®rement g√©r√©** : En tant que service g√©r√©, il s'occupe de l'infrastructure sous-jacente, de la mise √† l'√©chelle et de la s√©curit√©, r√©duisant ainsi la charge de maintenance pour les utilisateurs.
3. **Contr√¥le d'acc√®s granulaire** : Il s'int√®gre √† l'Identity and Access Management (IAM) de Google Cloud, vous permettant de d√©finir qui peut acc√©der, t√©l√©charger ou t√©l√©charger des artefacts dans vos d√©p√¥ts.
4. **G√©o-r√©plication** : Il prend en charge la r√©plication des artefacts √† travers plusieurs r√©gions, am√©liorant la vitesse des t√©l√©chargements et garantissant la disponibilit√©.
5. **Int√©gration avec les services Google Cloud** : Il fonctionne de mani√®re transparente avec **d'autres services GCP comme Cloud Build, Kubernetes Engine et Compute Engine**, ce qui en fait un choix pratique pour les √©quipes travaillant d√©j√† au sein de l'√©cosyst√®me Google Cloud.
6. **S√©curit√©** : Offre des fonctionnalit√©s telles que **l'analyse des vuln√©rabilit√©s et l'analyse des conteneurs** pour aider √† garantir que les artefacts stock√©s sont s√©curis√©s et exempts de probl√®mes de s√©curit√© connus.

### Formats et modes

Lors de la cr√©ation d'un nouveau d√©p√¥t, il est possible de **s√©lectionner le format/type** du d√©p√¥t parmi plusieurs comme Docker, Maven, npm, Python... et le mode qui peut g√©n√©ralement √™tre l'un de ces trois :

* **D√©p√¥t standard** : Mode par d√©faut pour **stocker vos propres artefacts** (comme les images Docker, les paquets Maven) directement dans GCP. C'est s√©curis√©, √©volutif et s'int√®gre bien dans l'√©cosyst√®me Google Cloud.
* **D√©p√¥t distant** (si disponible) : Agit comme un proxy pour **mettre en cache des artefacts provenant de d√©p√¥ts externes**, publics. Cela aide √† pr√©venir les probl√®mes dus aux changements de d√©pendances en amont et r√©duit la latence en mettant en cache les artefacts fr√©quemment acc√©d√©s.
* **D√©p√¥t virtuel** (si disponible) : Fournit une **interface unifi√©e pour acc√©der √† plusieurs d√©p√¥ts (standards ou distants)** via un seul point de terminaison, simplifiant la configuration c√¥t√© client et la gestion des acc√®s pour les artefacts r√©partis sur divers d√©p√¥ts.
* Pour un d√©p√¥t virtuel, vous devrez **s√©lectionner des d√©p√¥ts et leur donner une priorit√©** (le d√©p√¥t avec la plus grande priorit√© sera utilis√©).
* Vous pouvez **m√©langer des d√©p√¥ts distants et standards** dans un **d√©p√¥t virtuel**, si la **priorit√©** du **distant** est **plus grande** que celle du standard, **les paquets du distant (par exemple PyPi) seront utilis√©s**. Cela pourrait conduire √† une **confusion de d√©pendance.**

Notez que dans la **version distante de Docker**, il est possible de donner un nom d'utilisateur et un jeton pour acc√©der √† Docker Hub. Le **jeton est ensuite stock√© dans le Secret Manager**.

### Chiffrement

Comme pr√©vu, par d√©faut, une cl√© g√©r√©e par Google est utilis√©e, mais une cl√© g√©r√©e par le client peut √™tre indiqu√©e (CMEK).

### Politiques de nettoyage

* **Supprimer les artefacts :** Les artefacts seront **supprim√©s selon les crit√®res de la politique de nettoyage**.
* **Ex√©cution √† blanc :** (Par d√©faut) Les artefacts **ne seront pas supprim√©s**. Les politiques de nettoyage seront √©valu√©es et des √©v√©nements de suppression de test envoy√©s √† Cloud Audit Logging.

### Analyse des vuln√©rabilit√©s

Il est possible d'activer le **scanner de vuln√©rabilit√©s** qui v√©rifiera les vuln√©rabilit√©s √† l'int√©rieur des **images de conteneurs**.

### √ânum√©ration
```bash
# Get repositories
gcloud artifacts repositories list
gcloud artifacts repositories describe --location <location> <repo-name>
gcloud artifacts versions list --repository=<repo-name> -location <location> --package <package-name>

# Get settings of a repository (example using python but could be other)
gcloud artifacts print-settings python --repository <repo-name> --location <location>

# Get docker images
gcloud artifacts docker images list us-central1-docker.pkg.dev/<proj-name>/<repo-name>

# Get packages (like python and others...)
gcloud artifacts packages list --repository <repo-name> --location <location>

# Get SBOMB artifacts
gcloud artifacts sbom list

# Get vulnerabilities (docker images)
gcloud artifacts vulnerabilities list us-east1-docker.pkg.dev/project123/repository123/someimage@sha256:49765698074d6d7baa82f
gcloud artifacts docker images list-vulnerabilities projects/<proj-name>/locations/<location>/scans/<scan-uuid>
```
### Escalade de Privil√®ges

{% content-ref url="../gcp-privilege-escalation/gcp-artifact-registry-privesc.md" %}
[gcp-artifact-registry-privesc.md](../gcp-privilege-escalation/gcp-artifact-registry-privesc.md)
{% endcontent-ref %}

### Acc√®s Non Authentifi√©

{% content-ref url="../gcp-unauthenticated-enum-and-access/gcp-artifact-registry-unauthenticated-enum.md" %}
[gcp-artifact-registry-unauthenticated-enum.md](../gcp-unauthenticated-enum-and-access/gcp-artifact-registry-unauthenticated-enum.md)
{% endcontent-ref %}

### Post-Exploitation

{% content-ref url="../gcp-post-exploitation/gcp-artifact-registry-post-exploitation.md" %}
[gcp-artifact-registry-post-exploitation.md](../gcp-post-exploitation/gcp-artifact-registry-post-exploitation.md)
{% endcontent-ref %}

### Persistance

{% content-ref url="../gcp-persistence/gcp-artifact-registry-persistence.md" %}
[gcp-artifact-registry-persistence.md](../gcp-persistence/gcp-artifact-registry-persistence.md)
{% endcontent-ref %}

{% hint style="success" %}
Apprenez et pratiquez le Hacking AWS :<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks Formation Expert Red Team AWS (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
Apprenez et pratiquez le Hacking GCP : <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Formation Expert Red Team GCP (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Soutenir HackTricks</summary>

* Consultez les [**plans d'abonnement**](https://github.com/sponsors/carlospolop) !
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez-nous sur** **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Partagez des astuces de hacking en soumettant des PR aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) d√©p√¥ts github.

</details>
{% endhint %}
