# GCP - Enum√©ration du Registre d'Artifacts

{% hint style="success" %}
Apprenez et pratiquez le Hacking AWS :<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**Formation HackTricks AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Apprenez et pratiquez le Hacking GCP : <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**Formation HackTricks GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Soutenez HackTricks</summary>

* Consultez les [**plans d'abonnement**](https://github.com/sponsors/carlospolop)!
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez-nous** sur **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Partagez des astuces de piratage en soumettant des PR aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) d√©p√¥ts GitHub.

</details>
{% endhint %}

## Informations de Base

Google Cloud Artifact Registry est un service enti√®rement g√©r√© qui vous permet de **g√©rer, stocker et s√©curiser vos artefacts logiciels**. C'est essentiellement un r√©f√©rentiel pour **stocker les d√©pendances de construction**, telles que les images **Docker**, **Maven**, les packages npm et d'autres types d'artefacts. Il est **couramment utilis√© dans les pipelines CI/CD** pour stocker et versionner les artefacts produits lors du processus de d√©veloppement logiciel.

Les principales caract√©ristiques d'Artifact Registry comprennent :

1. **D√©p√¥t Unifi√©** : Il prend en charge **plusieurs types d'artefacts**, vous permettant d'avoir un seul r√©f√©rentiel pour les images Docker, les packages de langage (comme Maven de Java, npm de Node.js) et d'autres types d'artefacts, permettant des contr√¥les d'acc√®s coh√©rents et une vue unifi√©e de tous vos artefacts.
2. **Enti√®rement G√©r√©** : En tant que service g√©r√©, il s'occupe de l'infrastructure sous-jacente, de l'√©volutivit√© et de la s√©curit√©, r√©duisant la charge de maintenance pour les utilisateurs.
3. **Contr√¥le d'Acc√®s Finement Granulaire** : Il s'int√®gre √† la Gestion des Identit√©s et des Acc√®s (IAM) de Google Cloud, vous permettant de d√©finir qui peut acc√©der, t√©l√©charger ou t√©l√©verser des artefacts dans vos r√©f√©rentiels.
4. **G√©o-r√©plication** : Il prend en charge la r√©plication des artefacts dans plusieurs r√©gions, am√©liorant la vitesse de t√©l√©chargement et garantissant la disponibilit√©.
5. **Int√©gration avec les Services Google Cloud** : Il fonctionne parfaitement avec **d'autres services GCP comme Cloud Build, Kubernetes Engine et Compute Engine**, en en faisant un choix pratique pour les √©quipes travaillant d√©j√† dans l'√©cosyst√®me Google Cloud.
6. **S√©curit√©** : Offre des fonctionnalit√©s telles que **l'analyse de vuln√©rabilit√©s et l'analyse de conteneurs** pour garantir que les artefacts stock√©s sont s√©curis√©s et exempts de probl√®mes de s√©curit√© connus.

### Formats et Modes

Lors de la cr√©ation d'un nouveau r√©f√©rentiel, il est possible de **s√©lectionner un format/type** de r√©f√©rentiel parmi plusieurs comme Docker, Maven, npm, Python... et le mode qui peut g√©n√©ralement √™tre l'un de ces trois :

* **R√©f√©rentiel Standard** : Mode par d√©faut pour **stocker vos propres artefacts** (comme les images Docker, les packages Maven) directement dans GCP. Il est s√©curis√©, √©volutif et s'int√®gre bien dans l'√©cosyst√®me Google Cloud.
* **R√©f√©rentiel Distant** (si disponible) : Agit comme un proxy pour **mettre en cache les artefacts provenant d'externes**, des r√©f√©rentiels publics. Cela aide √† √©viter les probl√®mes li√©s aux modifications des d√©pendances en amont et r√©duit la latence en mettant en cache les artefacts fr√©quemment consult√©s.
* **R√©f√©rentiel Virtuel** (si disponible) : Fournit une **interface unifi√©e pour acc√©der √† plusieurs r√©f√©rentiels (standard ou distants)** via un seul point d'acc√®s, simplifiant la configuration c√¥t√© client et la gestion de l'acc√®s pour les artefacts r√©partis dans divers r√©f√©rentiels.
* Pour un r√©f√©rentiel virtuel, vous devrez **s√©lectionner des r√©f√©rentiels et leur donner une priorit√©** (le r√©f√©rentiel avec la plus grande priorit√© sera utilis√©).
* Vous pouvez **m√©langer des r√©f√©rentiels distants et standards** dans un **virtuel**, si la **priorit√©** du **distant** est **sup√©rieure** √† celle du standard, **les packages du distant (PyPi par exemple) seront utilis√©s**. Cela pourrait entra√Æner une **Confusion de D√©pendance**.

Notez que dans la **version distante de Docker**, il est possible de donner un nom d'utilisateur et un jeton pour acc√©der √† Docker Hub. Le **jeton est ensuite stock√© dans le Gestionnaire de Secrets**.

### Chiffrement

Comme pr√©vu, par d√©faut une cl√© g√©r√©e par Google est utilis√©e mais une cl√© g√©r√©e par le client peut √™tre indiqu√©e (CMEK).

### Politiques de Nettoyage

* **Supprimer les artefacts** : Les artefacts seront **supprim√©s selon les crit√®res de la politique de nettoyage**.
* **Essai √† Sec** : (Par d√©faut) Les artefacts ne seront **pas supprim√©s**. Les politiques de nettoyage seront √©valu√©es et des √©v√©nements de suppression de test seront envoy√©s √† l'audit de journalisation Cloud.

### Analyse de Vuln√©rabilit√©s

Il est possible d'activer le **scanner de vuln√©rabilit√©s** qui v√©rifiera les vuln√©rabilit√©s √† l'int√©rieur des **images de conteneurs**.

### √ânum√©ration
```bash
# Get repositories
gcloud artifacts repositories list
gcloud artifacts repositories describe --location <location> <repo-name>
gcloud artifacts versions list --repository=<repo-name> -location <location> --package <package-name>

# Get settings of a repository (example using python but could be other)
gcloud artifacts print-settings python --repository <repo-name> --location <location>

# Get docker images
gcloud artifacts docker images list us-central1-docker.pkg.dev/<proj-name>/<repo-name>

# Get packages (like python and others...)
gcloud artifacts packages list --repository <repo-name> --location <location>

# Get SBOMB artifacts
gcloud artifacts sbom list

# Get vulnerabilities (docker images)
gcloud artifacts vulnerabilities list us-east1-docker.pkg.dev/project123/repository123/someimage@sha256:49765698074d6d7baa82f
gcloud artifacts docker images list-vulnerabilities projects/<proj-name>/locations/<location>/scans/<scan-uuid>
```
### √âl√©vation de privil√®ges

{% content-ref url="../gcp-privilege-escalation/gcp-artifact-registry-privesc.md" %}
[gcp-artifact-registry-privesc.md](../gcp-privilege-escalation/gcp-artifact-registry-privesc.md)
{% endcontent-ref %}

### Acc√®s non authentifi√©

{% content-ref url="../gcp-unaunthenticated-enum-and-access/gcp-artifact-registry-unauthenticated-enum.md" %}
[gcp-artifact-registry-unauthenticated-enum.md](../gcp-unaunthenticated-enum-and-access/gcp-artifact-registry-unauthenticated-enum.md)
{% endcontent-ref %}

### Post-exploitation

{% content-ref url="../gcp-post-exploitation/gcp-artifact-registry-post-exploitation.md" %}
[gcp-artifact-registry-post-exploitation.md](../gcp-post-exploitation/gcp-artifact-registry-post-exploitation.md)
{% endcontent-ref %}

### Persistance

{% content-ref url="../gcp-persistence/gcp-artifact-registry-persistence.md" %}
[gcp-artifact-registry-persistence.md](../gcp-persistence/gcp-artifact-registry-persistence.md)
{% endcontent-ref %}

{% hint style="success" %}
Apprenez et pratiquez le piratage AWS :<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**Formation HackTricks AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Apprenez et pratiquez le piratage GCP : <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**Formation HackTricks GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Soutenez HackTricks</summary>

* Consultez les [**plans d'abonnement**](https://github.com/sponsors/carlospolop)!
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez-nous** sur **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Partagez des astuces de piratage en soumettant des PR aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
