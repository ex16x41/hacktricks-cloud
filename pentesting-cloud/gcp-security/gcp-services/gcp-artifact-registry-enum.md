# GCP - Artifact Registry Enum

{% hint style="success" %}
Leer & oefen AWS Hacking:<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Leer & oefen GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Kyk na die [**subskripsie planne**](https://github.com/sponsors/carlospolop)!
* **Sluit aan by die** üí¨ [**Discord groep**](https://discord.gg/hRep4RUj7f) of die [**telegram groep**](https://t.me/peass) of **volg** ons op **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Deel hacking truuks deur PRs in te dien na die** [**HackTricks**](https://github.com/carlospolop/hacktricks) en [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Basiese Inligting

Google Cloud Artifact Registry is 'n volledig bestuurde diens wat jou toelaat om **jou sagteware artefakte te bestuur, stoor en beveilig**. Dit is in wese 'n repository vir **die stoor van bou afhanklikhede**, soos **Docker** beelde, **Maven**, npm pakkette, en ander tipes artefakte. Dit word **gewoonlik in CI/CD pyplyne** gebruik om die artefakte wat tydens die sagteware ontwikkelingsproses geproduseer word, te stoor en te versioneer.

Belangrike kenmerke van Artifact Registry sluit in:

1. **Gekonsolideerde Repository**: Dit ondersteun **meerdere tipes artefakte**, wat jou toelaat om 'n enkele repository vir Docker beelde, taal pakkette (soos Java se Maven, Node.js se npm), en ander tipes artefakte te h√™, wat konsekwente toegangbeheer en 'n gekonsolideerde uitsig oor al jou artefakte moontlik maak.
2. **Volledig Bestuurde**: As 'n bestuurde diens, sorg dit vir die onderliggende infrastruktuur, skaal, en sekuriteit, wat die onderhoudsbelasting vir gebruikers verminder.
3. **Fyn-granul√™re Toegangbeheer**: Dit integreer met Google Cloud se Identiteit en Toegang Bestuur (IAM), wat jou toelaat om te definieer wie toegang kan h√™ tot, op te laai, of artefakte in jou repositories kan aflaai.
4. **Geo-replikasie**: Dit ondersteun die replika van artefakte oor meerdere streke, wat die spoed van aflaaie verbeter en beskikbaarheid verseker.
5. **Integrasie met Google Cloud Dienste**: Dit werk naatloos saam met **ander GCP dienste soos Cloud Build, Kubernetes Engine, en Compute Engine**, wat dit 'n gerieflike keuse maak vir spanne wat reeds binne die Google Cloud ekosisteem werk.
6. **Sekuriteit**: Bied kenmerke soos **kwesbaarheid skandering en houer analise** om te help verseker dat die gestoor artefakte veilig is en vry van bekende sekuriteitsprobleme.

### Formate en Modusse

Wanneer jy 'n nuwe repository skep, is dit moontlik om **die formaat/tipes** van die repository onder verskeie soos Docker, Maven, npm, Python... te **kies** en die modus wat gewoonlik een van hierdie drie kan wees:

* **Standaard Repository**: Standaard modus vir **die stoor van jou eie artefakte** (soos Docker beelde, Maven pakkette) direk in GCP. Dit is veilig, skaalbaar, en integreer goed binne die Google Cloud ekosisteem.
* **Afgele√´ Repository** (indien beskikbaar): Funksioneer as 'n proxy vir **die kas van artefakte van eksterne**, openbare repositories. Dit help om probleme van afhanklikhede wat opwaarts verander te voorkom en verminder latensie deur gereeld toegankelijke artefakte te kas.
* **Virtuele Repository** (indien beskikbaar): Bied 'n **gekonsoleerde koppelvlak om toegang te verkry tot meerdere (standaard of afgele√´) repositories** deur 'n enkele eindpunt, wat kli√´nt-kant konfigurasie en toegangbeheer vir artefakte wat oor verskeie repositories versprei is, vereenvoudig.
* Vir 'n virtuele repository sal jy **repositories moet kies en hulle 'n prioriteit gee** (die repo met die grootste prioriteit sal gebruik word).
* Jy kan **afgele√´ en standaard** repositories in 'n **virtuele** een meng, as die **prioriteit** van die **afgele√´** groter is as die standaard, **sal pakkette van afgele√´ (PyPi byvoorbeeld) gebruik word**. Dit kan lei tot 'n **Afhanklikheid Verwarring.**

Let daarop dat in die **Afgele√´ weergawe van Docker** dit moontlik is om 'n gebruikersnaam en token te gee om toegang tot Docker Hub te verkry. Die **token word dan in die Secret Manager gestoor**.

### Enkripsie

Soos verwag, word 'n Google-bestuurde sleutel standaard gebruik, maar 'n Klant-bestuurde sleutel kan aangedui word (CMEK).

### Opruim Beleide

* **Verwyder artefakte:** Artefakte sal **verwyder word volgens opruim beleid** kriteria.
* **Dro√´ loop:** (Standaard een) Artefakte sal **nie verwyder word** nie. Opruim beleide sal ge√´valueer word, en toets verwyder gebeurtenisse sal na Cloud Audit Logging gestuur word.

### Kwesbaarheid Skandering

Dit is moontlik om die **kwesbaarheid skandeerder** in te skakel wat vir kwesbaarhede binne **houer beelde** sal kyk.

### Enumerasie
```bash
# Get repositories
gcloud artifacts repositories list
gcloud artifacts repositories describe --location <location> <repo-name>
gcloud artifacts versions list --repository=<repo-name> -location <location> --package <package-name>

# Get settings of a repository (example using python but could be other)
gcloud artifacts print-settings python --repository <repo-name> --location <location>

# Get docker images
gcloud artifacts docker images list us-central1-docker.pkg.dev/<proj-name>/<repo-name>

# Get packages (like python and others...)
gcloud artifacts packages list --repository <repo-name> --location <location>

# Get SBOMB artifacts
gcloud artifacts sbom list

# Get vulnerabilities (docker images)
gcloud artifacts vulnerabilities list us-east1-docker.pkg.dev/project123/repository123/someimage@sha256:49765698074d6d7baa82f
gcloud artifacts docker images list-vulnerabilities projects/<proj-name>/locations/<location>/scans/<scan-uuid>
```
### Privilege Escalation

{% content-ref url="../gcp-privilege-escalation/gcp-artifact-registry-privesc.md" %}
[gcp-artifact-registry-privesc.md](../gcp-privilege-escalation/gcp-artifact-registry-privesc.md)
{% endcontent-ref %}

### Unauthenticated Access

{% content-ref url="../gcp-unaunthenticated-enum-and-access/gcp-artifact-registry-unauthenticated-enum.md" %}
[gcp-artifact-registry-unauthenticated-enum.md](../gcp-unaunthenticated-enum-and-access/gcp-artifact-registry-unauthenticated-enum.md)
{% endcontent-ref %}

### Post-Exploitation

{% content-ref url="../gcp-post-exploitation/gcp-artifact-registry-post-exploitation.md" %}
[gcp-artifact-registry-post-exploitation.md](../gcp-post-exploitation/gcp-artifact-registry-post-exploitation.md)
{% endcontent-ref %}

### Persistence

{% content-ref url="../gcp-persistence/gcp-artifact-registry-persistence.md" %}
[gcp-artifact-registry-persistence.md](../gcp-persistence/gcp-artifact-registry-persistence.md)
{% endcontent-ref %}

{% hint style="success" %}
Leer & oefen AWS Hacking:<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Leer & oefen GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Kyk na die [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Sluit aan by die** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) of die [**telegram group**](https://t.me/peass) of **volg** ons op **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Deel hacking truuks deur PRs in te dien na die** [**HackTricks**](https://github.com/carlospolop/hacktricks) en [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
