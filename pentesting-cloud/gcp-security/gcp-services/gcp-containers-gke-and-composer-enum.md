# GCP - ì»¨í…Œì´ë„ˆ ë° GKE Enum

{% hint style="success" %}
AWS í•´í‚¹ í•™ìŠµ ë° ì‹¤ìŠµ:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCP í•´í‚¹ í•™ìŠµ ë° ì‹¤ìŠµ: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks ì§€ì›</summary>

* [**êµ¬ë… ìš”ê¸ˆì œ**](https://github.com/sponsors/carlospolop)ë¥¼ í™•ì¸í•˜ì„¸ìš”!
* ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— **ì°¸ì—¬**í•˜ê±°ë‚˜ **íŠ¸ìœ„í„°** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**ë¥¼ íŒ”ë¡œìš°**í•˜ì„¸ìš”.
* í•´í‚¹ íŠ¸ë¦­ì„ ê³µìœ í•˜ë ¤ë©´ [**HackTricks**](https://github.com/carlospolop/hacktricks) ë° [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) ê¹ƒí—ˆë¸Œ ì €ì¥ì†Œì— PRì„ ì œì¶œí•˜ì„¸ìš”.

</details>
{% endhint %}

## ì»¨í…Œì´ë„ˆ

GCP ì»¨í…Œì´ë„ˆì—ì„œëŠ” GCPê°€ ì œê³µí•˜ëŠ” ëŒ€ë¶€ë¶„ì˜ ì»¨í…Œì´ë„ˆ ê¸°ë°˜ ì„œë¹„ìŠ¤ë¥¼ ì°¾ì„ ìˆ˜ ìˆìœ¼ë©°, ì—¬ê¸°ì—ì„œ ê°€ì¥ ì¼ë°˜ì ì¸ ê²ƒë“¤ì„ ì—´ê±°í•˜ëŠ” ë°©ë²•ì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```bash
gcloud container images list
gcloud container images list --repository us.gcr.io/<project-name> #Search in other subdomains repositories
gcloud container images describe <name>
gcloud container subnets list-usable
gcloud container clusters list
gcloud container clusters describe <name>
gcloud container clusters get-credentials [NAME]

# Run a container locally
docker run --rm -ti gcr.io/<project-name>/secret:v1 sh

# Login & Download
sudo docker login -u oauth2accesstoken -p $(gcloud auth print-access-token) https://HOSTNAME
## where HOSTNAME is gcr.io, us.gcr.io, eu.gcr.io, or asia.gcr.io.
sudo docker pull HOSTNAME/<project-name>/<image-name>
```
### ê¶Œí•œ ìƒìŠ¹

ë‹¤ìŒ í˜ì´ì§€ì—ì„œëŠ” **ê¶Œí•œ ìƒìŠ¹ì„ ìœ„í•´ ì»¨í…Œì´ë„ˆ ê¶Œí•œì„ ë‚¨ìš©í•˜ëŠ” ë°©ë²•**ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

{% content-ref url="../gcp-privilege-escalation/gcp-container-privesc.md" %}
[gcp-container-privesc.md](../gcp-privilege-escalation/gcp-container-privesc.md)
{% endcontent-ref %}

## ë…¸ë“œ í’€

ì´ê²ƒë“¤ì€ ì¿ ë²„ë„¤í‹°ìŠ¤ í´ëŸ¬ìŠ¤í„°ë¥¼ í˜•ì„±í•˜ëŠ” ë¨¸ì‹ (ë…¸ë“œ)ì˜ í’€ì…ë‹ˆë‹¤.
```bash
# Pool of machines used by the cluster
gcloud container node-pools list --zone <zone> --cluster <cluster>
gcloud container node-pools describe --cluster <cluster> --zone <zone> <node-pool>
```
## Kubernetes

ì¿ ë²„ë„¤í‹°ìŠ¤ì— ëŒ€í•œ ì •ë³´ëŠ” ë‹¤ìŒ í˜ì´ì§€ë¥¼ í™•ì¸í•˜ì‹­ì‹œì˜¤:

{% content-ref url="../../kubernetes-security/" %}
[kubernetes-security](../../kubernetes-security/)
{% endcontent-ref %}

ë¨¼ì € í”„ë¡œì íŠ¸ì— ì¿ ë²„ë„¤í‹°ìŠ¤ í´ëŸ¬ìŠ¤í„°ê°€ ìˆëŠ”ì§€ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
```
gcloud container clusters list
```
ë§Œì•½ í´ëŸ¬ìŠ¤í„°ê°€ ìˆë‹¤ë©´ `gcloud`ë¥¼ ì‚¬ìš©í•˜ì—¬ ìë™ìœ¼ë¡œ `~/.kube/config` íŒŒì¼ì„ êµ¬ì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ íŒŒì¼ì€ K8s í´ëŸ¬ìŠ¤í„°ì™€ ìƒí˜¸ ì‘ìš©í•˜ê¸° ìœ„í•œ ë„¤ì´í‹°ë¸Œ CLI ì¸ [kubectl](https://kubernetes.io/docs/reference/kubectl/overview/)ë¥¼ ì‚¬ìš©í•  ë•Œ ì¸ì¦í•˜ëŠ” ë° ì‚¬ìš©ë©ë‹ˆë‹¤. ë‹¤ìŒ ëª…ë ¹ì„ ì‹œë„í•´ë³´ì„¸ìš”.
```
gcloud container clusters get-credentials [CLUSTER NAME] --region [REGION]
```
ê·¸ëŸ¼ ìƒì„±ëœ ìê²© ì¦ëª…ì„ í™•ì¸í•˜ê¸° ìœ„í•´ `~/.kube/config` íŒŒì¼ì„ ì‚´í´ë³´ì„¸ìš”. ì´ íŒŒì¼ì€ í™œì„± `gcloud` ì„¸ì…˜ì—ì„œ ì‚¬ìš© ì¤‘ì¸ ë™ì¼í•œ IDë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì•¡ì„¸ìŠ¤ í† í°ì„ ìë™ìœ¼ë¡œ ìƒˆë¡œ ê³ ì¹  ë•Œ ì‚¬ìš©ë©ë‹ˆë‹¤. ë¬¼ë¡  ì´ë¥¼ ìœ„í•´ì„œëŠ” ì˜¬ë°”ë¥¸ ê¶Œí•œì´ í•„ìš”í•©ë‹ˆë‹¤.

ì´ ì„¤ì •ì´ ì™„ë£Œë˜ë©´ ë‹¤ìŒ ëª…ë ¹ì„ ì‹œë„í•˜ì—¬ í´ëŸ¬ìŠ¤í„° êµ¬ì„±ì„ ê°€ì ¸ì˜¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
```
kubectl cluster-info
```
ë‹¹ì‹ ì€ `gcloud`ë¥¼ ìœ„í•œ ì»¨í…Œì´ë„ˆì— ëŒ€í•´ ë” ë§ì€ ì •ë³´ë¥¼ [ì—¬ê¸°](https://cloud.google.com/sdk/gcloud/reference/container/)ì—ì„œ ì½ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì´ê²ƒì€ GCPì—ì„œ ì¿ ë²„ë„¤í‹°ìŠ¤ë¥¼ ì—´ê±°í•˜ëŠ” ê°„ë‹¨í•œ ìŠ¤í¬ë¦½íŠ¸ì…ë‹ˆë‹¤: [https://gitlab.com/gitlab-com/gl-security/security-operations/gl-redteam/gcp\_k8s\_enum](https://gitlab.com/gitlab-com/gl-security/security-operations/gl-redteam/gcp\_k8s\_enum)

### TLS ë¶€íŠ¸ìŠ¤íŠ¸ë© ê¶Œí•œ ìƒìŠ¹

ì´ˆê¸°ì— ì´ ê¶Œí•œ ìƒìŠ¹ ê¸°ìˆ ì€ **GKE í´ëŸ¬ìŠ¤í„° ë‚´ë¶€ì—ì„œ ê¶Œí•œ ìƒìŠ¹**ì„ í—ˆìš©í•˜ì—¬ ê³µê²©ìê°€ **ì™„ì „íˆ ì¹¨íˆ¬**í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.

ì´ëŠ” GKEê°€ [TLS ë¶€íŠ¸ìŠ¤íŠ¸ë© ìê²© ì¦ëª…](https://kubernetes.io/docs/reference/command-line-tools-reference/kubelet-tls-bootstrapping/)ì„ ë©”íƒ€ë°ì´í„°ì—ì„œ ì œê³µí•˜ê¸° ë•Œë¬¸ì— **ì–´ë–¤ ì‚¬ëŒì´ë¼ë„ podë¥¼ ì¹¨íˆ¬í•¨ìœ¼ë¡œì¨ ì•¡ì„¸ìŠ¤**í•  ìˆ˜ ìˆê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.

ì‚¬ìš©ëœ ê¸°ìˆ ì€ ë‹¤ìŒ ê²Œì‹œë¬¼ì—ì„œ ì„¤ëª…ë˜ì–´ ìˆìŠµë‹ˆë‹¤:

* [https://www.4armed.com/blog/hacking-kubelet-on-gke/](https://www.4armed.com/blog/hacking-kubelet-on-gke/)
* [https://www.4armed.com/blog/kubeletmein-kubelet-hacking-tool/](https://www.4armed.com/blog/kubeletmein-kubelet-hacking-tool/)
* [https://rhinosecuritylabs.com/cloud-security/kubelet-tls-bootstrap-privilege-escalation/](https://rhinosecuritylabs.com/cloud-security/kubelet-tls-bootstrap-privilege-escalation/)

ê·¸ë¦¬ê³  ì´ ë„êµ¬ëŠ” ì´ í”„ë¡œì„¸ìŠ¤ë¥¼ ìë™í™”í•˜ê¸° ìœ„í•´ ë§Œë“¤ì–´ì¡ŒìŠµë‹ˆë‹¤: [https://github.com/4ARMED/kubeletmein](https://github.com/4ARMED/kubeletmein)

ê·¸ëŸ¬ë‚˜, ì´ ê¸°ìˆ ì€ **ë©”íƒ€ë°ì´í„° ìê²© ì¦ëª…**ì„ í†µí•´ **ìƒˆ ë…¸ë“œë¥¼ ìœ„í•œ CSR** (ì„œëª… ìš”ì²­ì„œ)ë¥¼ ìƒì„±í•  ìˆ˜ ìˆì—ˆê³ , ì´ëŠ” **ìë™ìœ¼ë¡œ ìŠ¹ì¸**ë˜ì—ˆìŠµë‹ˆë‹¤.\
ë‚´ í…ŒìŠ¤íŠ¸ì—ì„œ **ì´ëŸ¬í•œ ìš”ì²­ì´ ë” ì´ìƒ ìë™ìœ¼ë¡œ ìŠ¹ì¸ë˜ì§€ ì•ŠëŠ” ê²ƒì„ í™•ì¸í–ˆìœ¼ë¯€ë¡œ**, ì´ ê¸°ìˆ ì´ ì—¬ì „íˆ ìœ íš¨í•œì§€ í™•ì‹ í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.

### Kubelet APIì˜ Secrets <a href="#the-kubelet-api-git-secrets-redux" id="the-kubelet-api-git-secrets-redux"></a>

[**ì´ ê²Œì‹œë¬¼**](https://blog.assetnote.io/2022/05/06/cloudflare-pages-pt3/)ì—ì„œ GKE ë‚´ë¶€ì˜ podì—ì„œ ì•¡ì„¸ìŠ¤í•  ìˆ˜ ìˆëŠ” Kubelet API ì£¼ì†Œê°€ ë°œê²¬ë˜ì—ˆìœ¼ë©°, ì‹¤í–‰ ì¤‘ì¸ podì˜ ì„¸ë¶€ ì •ë³´ë¥¼ ì œê³µí–ˆìŠµë‹ˆë‹¤.
```
curl -v -k http://10.124.200.1:10255/pods
```
ì‹¬ê°í•œ ì •ë³´ë¥¼ ì‘ë‹µì—ì„œ ì°¾ì„ ìˆ˜ ìˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. [**Kiterunner**](https://github.com/assetnote/kiterunner)ë¥¼ ì‚¬ìš©í•˜ì—¬ /pods ì—”ë“œí¬ì¸íŠ¸ë¥¼ ë°œê²¬í–ˆìŠµë‹ˆë‹¤.

{% hint style="success" %}
AWS í•´í‚¹ í•™ìŠµ ë° ì‹¤ìŠµ:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCP í•´í‚¹ í•™ìŠµ ë° ì‹¤ìŠµ: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks ì§€ì›</summary>

* [**êµ¬ë… ìš”ê¸ˆì œ**](https://github.com/sponsors/carlospolop)ë¥¼ í™•ì¸í•˜ì„¸ìš”!
* ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— **ì°¸ì—¬**í•˜ê±°ë‚˜ **íŠ¸ìœ„í„°** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**ë¥¼ íŒ”ë¡œìš°**í•˜ì„¸ìš”.
* í•´í‚¹ íŒì„ ê³µìœ í•˜ë ¤ë©´ [**HackTricks**](https://github.com/carlospolop/hacktricks) ë° [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) ê¹ƒí—ˆë¸Œ ì €ì¥ì†Œì— PRì„ ì œì¶œí•˜ì„¸ìš”.

</details>
{% endhint %}
