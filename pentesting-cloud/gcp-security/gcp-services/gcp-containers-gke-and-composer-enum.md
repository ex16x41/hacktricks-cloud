# GCP - Containers & GKE Enum

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Containers

Î£Ï„Î± GCP containers Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Î²ÏÎµÎ¯Ï„Îµ Ï„Î¹Ï‚ Ï€ÎµÏÎ¹ÏƒÏƒÏŒÏ„ÎµÏÎµÏ‚ Î±Ï€ÏŒ Ï„Î¹Ï‚ Ï…Ï€Î·ÏÎµÏƒÎ¯ÎµÏ‚ Ï€Î¿Ï… Î²Î±ÏƒÎ¯Î¶Î¿Î½Ï„Î±Î¹ ÏƒÎµ containers Ï€Î¿Ï… Ï€ÏÎ¿ÏƒÏ†Î­ÏÎµÎ¹ Ï„Î¿ GCP, ÎµÎ´Ï Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Î´ÎµÎ¯Ï„Îµ Ï€ÏÏ‚ Î½Î± ÎºÎ±Ï„Î±Î³ÏÎ¬ÏˆÎµÏ„Îµ Ï„Î¹Ï‚ Ï€Î¹Î¿ ÎºÎ¿Î¹Î½Î­Ï‚:
```bash
gcloud container images list
gcloud container images list --repository us.gcr.io/<project-name> #Search in other subdomains repositories
gcloud container images describe <name>
gcloud container subnets list-usable
gcloud container clusters list
gcloud container clusters describe <name>
gcloud container clusters get-credentials [NAME]

# Run a container locally
docker run --rm -ti gcr.io/<project-name>/secret:v1 sh

# Login & Download
sudo docker login -u oauth2accesstoken -p $(gcloud auth print-access-token) https://HOSTNAME
## where HOSTNAME is gcr.io, us.gcr.io, eu.gcr.io, or asia.gcr.io.
sudo docker pull HOSTNAME/<project-name>/<image-name>
```
### Privesc

Î£Ï„Î·Î½ ÎµÏ€ÏŒÎ¼ÎµÎ½Î· ÏƒÎµÎ»Î¯Î´Î± Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Î´ÎµÎ¯Ï„Îµ Ï€ÏÏ‚ Î½Î± **ÎºÎ±Ï„Î±Ï‡ÏÎ±ÏƒÏ„ÎµÎ¯Ï„Îµ Ï„Î¹Ï‚ Î¬Î´ÎµÎ¹ÎµÏ‚ ÎºÎ¿Î½Ï„Î­Î¹Î½ÎµÏ Î³Î¹Î± Î½Î± ÎºÎ»Î¹Î¼Î±ÎºÏÏƒÎµÏ„Îµ Ï„Î± Ï€ÏÎ¿Î½ÏŒÎ¼Î¹Î±**:

{% content-ref url="../gcp-privilege-escalation/gcp-container-privesc.md" %}
[gcp-container-privesc.md](../gcp-privilege-escalation/gcp-container-privesc.md)
{% endcontent-ref %}

## Node Pools

Î‘Ï…Ï„Î­Ï‚ ÎµÎ¯Î½Î±Î¹ Î¿Î¹ Î¿Î¼Î¬Î´ÎµÏ‚ Î¼Î·Ï‡Î±Î½ÏÎ½ (ÎºÏŒÎ¼Î²Ï‰Î½) Ï€Î¿Ï… ÏƒÏ‡Î·Î¼Î±Ï„Î¯Î¶Î¿Ï…Î½ Ï„Î± clusters kubernetes.
```bash
# Pool of machines used by the cluster
gcloud container node-pools list --zone <zone> --cluster <cluster>
gcloud container node-pools describe --cluster <cluster> --zone <zone> <node-pool>
```
## Kubernetes

Î“Î¹Î± Ï€Î»Î·ÏÎ¿Ï†Î¿ÏÎ¯ÎµÏ‚ ÏƒÏ‡ÎµÏ„Î¹ÎºÎ¬ Î¼Îµ Ï„Î¿ Ï„Î¹ ÎµÎ¯Î½Î±Î¹ Ï„Î¿ Kubernetes, ÎµÎ»Î­Î³Î¾Ï„Îµ Î±Ï…Ï„Î® Ï„Î· ÏƒÎµÎ»Î¯Î´Î±:

{% content-ref url="../../kubernetes-security/" %}
[kubernetes-security](../../kubernetes-security/)
{% endcontent-ref %}

Î‘ÏÏ‡Î¹ÎºÎ¬, Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± ÎµÎ»Î­Î³Î¾ÎµÏ„Îµ Î±Î½ Ï…Ï€Î¬ÏÏ‡Î¿Ï…Î½ Î¿Ï€Î¿Î¹Î¿Î¹Î´Î®Ï€Î¿Ï„Îµ Kubernetes clusters ÏƒÏ„Î¿ Î­ÏÎ³Î¿ ÏƒÎ±Ï‚.
```
gcloud container clusters list
```
Î‘Î½ Î­Ï‡ÎµÏ„Îµ Î­Î½Î± cluster, Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Î­Ï‡ÎµÏ„Îµ Ï„Î¿ `gcloud` Î½Î± Î´Î¹Î±Î¼Î¿ÏÏ†ÏÎ½ÎµÎ¹ Î±Ï…Ï„ÏŒÎ¼Î±Ï„Î± Ï„Î¿ Î±ÏÏ‡ÎµÎ¯Î¿ `~/.kube/config`. Î‘Ï…Ï„ÏŒ Ï„Î¿ Î±ÏÏ‡ÎµÎ¯Î¿ Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÎµÎ¯Ï„Î±Î¹ Î³Î¹Î± Î½Î± ÏƒÎ±Ï‚ Ï€Î¹ÏƒÏ„Î¿Ï€Î¿Î¹Î®ÏƒÎµÎ¹ ÏŒÏ„Î±Î½ Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÎµÎ¯Ï„Îµ Ï„Î¿ [kubectl](https://kubernetes.io/docs/reference/kubectl/overview/), Ï„Î¿ ÎµÎ³Î³ÎµÎ½Î­Ï‚ CLI Î³Î¹Î± Î±Î»Î»Î·Î»ÎµÏ€Î¯Î´ÏÎ±ÏƒÎ· Î¼Îµ Ï„Î± K8s clusters. Î”Î¿ÎºÎ¹Î¼Î¬ÏƒÏ„Îµ Î±Ï…Ï„Î® Ï„Î·Î½ ÎµÎ½Ï„Î¿Î»Î®.
```
gcloud container clusters get-credentials [CLUSTER NAME] --region [REGION]
```
Î£Ï„Î· ÏƒÏ…Î½Î­Ï‡ÎµÎ¹Î±, ÏÎ¯Î¾Ï„Îµ Î¼Î¹Î± Î¼Î±Ï„Î¹Î¬ ÏƒÏ„Î¿ Î±ÏÏ‡ÎµÎ¯Î¿ `~/.kube/config` Î³Î¹Î± Î½Î± Î´ÎµÎ¯Ï„Îµ Ï„Î± Ï€Î±ÏÎ±Î³ÏŒÎ¼ÎµÎ½Î± Î´Î¹Î±Ï€Î¹ÏƒÏ„ÎµÏ…Ï„Î®ÏÎ¹Î±. Î‘Ï…Ï„ÏŒ Ï„Î¿ Î±ÏÏ‡ÎµÎ¯Î¿ Î¸Î± Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î·Î¸ÎµÎ¯ Î³Î¹Î± Ï„Î·Î½ Î±Ï…Ï„ÏŒÎ¼Î±Ï„Î· Î±Î½Î±Î½Î­Ï‰ÏƒÎ· Ï„Ï‰Î½ Î´Î¹Î±Ï€Î¹ÏƒÏ„ÎµÏ…Ï„Î·ÏÎ¯Ï‰Î½ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ·Ï‚ Î¼Îµ Î²Î¬ÏƒÎ· Ï„Î·Î½ Î¯Î´Î¹Î± Ï„Î±Ï…Ï„ÏŒÏ„Î·Ï„Î± Ï€Î¿Ï… Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÎµÎ¯ Î· ÎµÎ½ÎµÏÎ³Î® ÏƒÏ…Î½ÎµÎ´ÏÎ¯Î± `gcloud` ÏƒÎ±Ï‚. Î‘Ï…Ï„ÏŒ Ï†Ï…ÏƒÎ¹ÎºÎ¬ Î±Ï€Î±Î¹Ï„ÎµÎ¯ Ï„Î¹Ï‚ ÏƒÏ‰ÏƒÏ„Î­Ï‚ Î¬Î´ÎµÎ¹ÎµÏ‚.

Î‘Ï†Î¿Ï ÏÏ…Î¸Î¼Î¹ÏƒÏ„ÎµÎ¯ Î±Ï…Ï„ÏŒ, Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Î´Î¿ÎºÎ¹Î¼Î¬ÏƒÎµÏ„Îµ Ï„Î·Î½ Ï€Î±ÏÎ±ÎºÎ¬Ï„Ï‰ ÎµÎ½Ï„Î¿Î»Î® Î³Î¹Î± Î½Î± Î±Ï€Î¿ÎºÏ„Î®ÏƒÎµÏ„Îµ Ï„Î· Î´Î¹Î±Î¼ÏŒÏÏ†Ï‰ÏƒÎ· Ï„Î¿Ï… ÎºÎ»Î¬ÏƒÏ„ÎµÏ.
```
kubectl cluster-info
```
ÎœÏ€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Î´Î¹Î±Î²Î¬ÏƒÎµÏ„Îµ Ï€ÎµÏÎ¹ÏƒÏƒÏŒÏ„ÎµÏÎ± Î³Î¹Î± Ï„Î¿ `gcloud` Î³Î¹Î± ÎºÎ¿Î½Ï„Î­Î¹Î½ÎµÏ [ÎµÎ´Ï](https://cloud.google.com/sdk/gcloud/reference/container/).

Î‘Ï…Ï„ÏŒ ÎµÎ¯Î½Î±Î¹ Î­Î½Î± Î±Ï€Î»ÏŒ ÏƒÎµÎ½Î¬ÏÎ¹Î¿ Î³Î¹Î± Ï„Î·Î½ ÎºÎ±Ï„Î±Î¼Î­Ï„ÏÎ·ÏƒÎ· Ï„Î¿Ï… kubernetes ÏƒÏ„Î¿ GCP: [https://gitlab.com/gitlab-com/gl-security/security-operations/gl-redteam/gcp\_k8s\_enum](https://gitlab.com/gitlab-com/gl-security/security-operations/gl-redteam/gcp\_k8s\_enum)

### TLS Boostrap Privilege Escalation

Î‘ÏÏ‡Î¹ÎºÎ¬, Î±Ï…Ï„Î® Î· Ï„ÎµÏ‡Î½Î¹ÎºÎ® ÎºÎ»Î¹Î¼Î¬ÎºÏ‰ÏƒÎ·Ï‚ Ï€ÏÎ¿Î½Î¿Î¼Î¯Ï‰Î½ ÎµÏ€Î­Ï„ÏÎµÏ€Îµ **privesc Î¼Î­ÏƒÎ± ÏƒÏ„Î¿ GKE cluster** ÎµÏ€Î¹Ï„ÏÎ­Ï€Î¿Î½Ï„Î±Ï‚ Î±Ï€Î¿Ï„ÎµÎ»ÎµÏƒÎ¼Î±Ï„Î¹ÎºÎ¬ ÏƒÎµ Î­Î½Î±Î½ ÎµÏ€Î¹Ï„Î¹Î¸Î­Î¼ÎµÎ½Î¿ Î½Î± **ÏƒÏ…Î¼Î²Î¹Î²Î¬ÏƒÎµÎ¹ Ï€Î»Î®ÏÏ‰Ï‚** Ï„Î¿ ÏƒÏÏƒÏ„Î·Î¼Î±.

Î‘Ï…Ï„ÏŒ ÏƒÏ…Î¼Î²Î±Î¯Î½ÎµÎ¹ ÎµÏ€ÎµÎ¹Î´Î® Ï„Î¿ GKE Ï€Î±ÏÎ­Ï‡ÎµÎ¹ [TLS Bootstrap credentials](https://kubernetes.io/docs/reference/command-line-tools-reference/kubelet-tls-bootstrapping/) ÏƒÏ„Î± Î¼ÎµÏ„Î±Î´ÎµÎ´Î¿Î¼Î­Î½Î±, Ï„Î± Î¿Ï€Î¿Î¯Î± ÎµÎ¯Î½Î±Î¹ **Ï€ÏÎ¿ÏƒÎ²Î¬ÏƒÎ¹Î¼Î± Î±Ï€ÏŒ Î¿Ï€Î¿Î¹Î¿Î½Î´Î®Ï€Î¿Ï„Îµ Î±Ï€Î»Î¬ ÏƒÏ…Î¼Î²Î¹Î²Î¬Î¶Î¿Î½Ï„Î±Ï‚ Î­Î½Î± pod**.

Î— Ï„ÎµÏ‡Î½Î¹ÎºÎ® Ï€Î¿Ï… Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î®Î¸Î·ÎºÎµ ÎµÎ¾Î·Î³ÎµÎ¯Ï„Î±Î¹ ÏƒÏ„Î¹Ï‚ Ï€Î±ÏÎ±ÎºÎ¬Ï„Ï‰ Î±Î½Î±ÏÏ„Î®ÏƒÎµÎ¹Ï‚:

* [https://www.4armed.com/blog/hacking-kubelet-on-gke/](https://www.4armed.com/blog/hacking-kubelet-on-gke/)
* [https://www.4armed.com/blog/kubeletmein-kubelet-hacking-tool/](https://www.4armed.com/blog/kubeletmein-kubelet-hacking-tool/)
* [https://rhinosecuritylabs.com/cloud-security/kubelet-tls-bootstrap-privilege-escalation/](https://rhinosecuritylabs.com/cloud-security/kubelet-tls-bootstrap-privilege-escalation/)

ÎšÎ±Î¹ Î±Ï…Ï„ÏŒ Ï„Î¿ ÎµÏÎ³Î±Î»ÎµÎ¯Î¿ Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î®Î¸Î·ÎºÎµ Î³Î¹Î± Î½Î± Î±Ï…Ï„Î¿Î¼Î±Ï„Î¿Ï€Î¿Î¹Î®ÏƒÎµÎ¹ Ï„Î· Î´Î¹Î±Î´Î¹ÎºÎ±ÏƒÎ¯Î±: [https://github.com/4ARMED/kubeletmein](https://github.com/4ARMED/kubeletmein)

Î©ÏƒÏ„ÏŒÏƒÎ¿, Î· Ï„ÎµÏ‡Î½Î¹ÎºÎ® ÎµÎºÎ¼ÎµÏ„Î±Î»Î»ÎµÏÏ„Î·ÎºÎµ Ï„Î¿ Î³ÎµÎ³Î¿Î½ÏŒÏ‚ ÏŒÏ„Î¹ **Î¼Îµ Ï„Î± Î´Î¹Î±Ï€Î¹ÏƒÏ„ÎµÏ…Ï„Î®ÏÎ¹Î± Î¼ÎµÏ„Î±Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½** Î®Ï„Î±Î½ Î´Ï…Î½Î±Ï„ÏŒ Î½Î± **Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î·Î¸ÎµÎ¯ Î­Î½Î± CSR** (Certificate Signing Request) Î³Î¹Î± Î­Î½Î± **Î½Î­Î¿ ÎºÏŒÎ¼Î²Î¿**, Ï„Î¿ Î¿Ï€Î¿Î¯Î¿ Î®Ï„Î±Î½ **Î±Ï…Ï„ÏŒÎ¼Î±Ï„Î± ÎµÎ³ÎºÎµÎºÏÎ¹Î¼Î­Î½Î¿**.\
Î£Ï„Î· Î´Î¿ÎºÎ¹Î¼Î® Î¼Î¿Ï…, Î´Î¹Î±Ï€Î¯ÏƒÏ„Ï‰ÏƒÎ± ÏŒÏ„Î¹ **Î±Ï…Ï„Î­Ï‚ Î¿Î¹ Î±Î¹Ï„Î®ÏƒÎµÎ¹Ï‚ Î´ÎµÎ½ ÎµÎ³ÎºÏÎ¯Î½Î¿Î½Ï„Î±Î¹ Î±Ï…Ï„ÏŒÎ¼Î±Ï„Î± Ï€Î¹Î±**, Î¿Ï€ÏŒÏ„Îµ Î´ÎµÎ½ ÎµÎ¯Î¼Î±Î¹ ÏƒÎ¯Î³Î¿Ï…ÏÎ¿Ï‚ Î±Î½ Î±Ï…Ï„Î® Î· Ï„ÎµÏ‡Î½Î¹ÎºÎ® ÎµÎ¯Î½Î±Î¹ Î±ÎºÏŒÎ¼Î± Î­Î³ÎºÏ…ÏÎ·.

### Secrets in Kubelet API <a href="#the-kubelet-api-git-secrets-redux" id="the-kubelet-api-git-secrets-redux"></a>

Î£Îµ [**Î±Ï…Ï„Î® Ï„Î·Î½ Î±Î½Î¬ÏÏ„Î·ÏƒÎ·**](https://blog.assetnote.io/2022/05/06/cloudflare-pages-pt3/) Î±Î½Î±ÎºÎ±Î»ÏÏ†Î¸Î·ÎºÎµ Î¼Î¹Î± Î´Î¹ÎµÏÎ¸Ï…Î½ÏƒÎ· Kubelet API Ï€ÏÎ¿ÏƒÎ²Î¬ÏƒÎ¹Î¼Î· Î±Ï€ÏŒ Î¼Î­ÏƒÎ± ÏƒÎµ Î­Î½Î± pod ÏƒÏ„Î¿ GKE Ï€Î¿Ï… Ï€Î±ÏÎ­Ï‡ÎµÎ¹ Î»ÎµÏ€Ï„Î¿Î¼Î­ÏÎµÎ¹ÎµÏ‚ Î³Î¹Î± Ï„Î± pods Ï€Î¿Ï… ÎµÎºÏ„ÎµÎ»Î¿ÏÎ½Ï„Î±Î¹:
```
curl -v -k http://10.124.200.1:10255/pods
```
Î‘ÎºÏŒÎ¼Î± ÎºÎ±Î¹ Î±Î½ Ï„Î¿ API **Î´ÎµÎ½ ÎµÏ€Î¹Ï„ÏÎ­Ï€ÎµÎ¹ Ï„Î·Î½ Ï„ÏÎ¿Ï€Î¿Ï€Î¿Î¯Î·ÏƒÎ· Ï€ÏŒÏÏ‰Î½**, Î¸Î± Î¼Ï€Î¿ÏÎ¿ÏÏƒÎµ Î½Î± ÎµÎ¯Î½Î±Î¹ Î´Ï…Î½Î±Ï„ÏŒ Î½Î± Î²ÏÎµÎ¸Î¿ÏÎ½ **ÎµÏ…Î±Î¯ÏƒÎ¸Î·Ï„ÎµÏ‚ Ï€Î»Î·ÏÎ¿Ï†Î¿ÏÎ¯ÎµÏ‚** ÏƒÏ„Î·Î½ Î±Ï€Î¬Î½Ï„Î·ÏƒÎ·. Î¤Î¿ endpoint /pods Î²ÏÎ­Î¸Î·ÎºÎµ Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÏÎ½Ï„Î±Ï‚ [**Kiterunner**](https://github.com/assetnote/kiterunner).

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
