# GCP - Osnovne informacije

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## **Hijerarhija resursa**

Google Cloud koristi [Hijerarhiju resursa](https://cloud.google.com/resource-manager/docs/cloud-platform-resource-hierarchy) koja je konceptualno sliÄna tradicionalnom fajl sistemu. Ovo pruÅ¾a logiÄki radni tok roditelj/dete sa specifiÄnim taÄkama vezivanja za politike i dozvole.

Na visokom nivou, izgleda ovako:
```
Organization
--> Folders
--> Projects
--> Resources
```
A virtual machine (called a Compute Instance) is a resource. A resource resides in a project, probably alongside other Compute Instances, storage buckets, etc.

<figure><img src="../../../.gitbook/assets/image (1) (1) (1) (1).png" alt=""><figcaption><p><a href="https://cloud.google.com/static/resource-manager/img/cloud-hierarchy.svg">https://cloud.google.com/static/resource-manager/img/cloud-hierarchy.svg</a></p></figcaption></figure>

## **Migracija projekata**

MoguÄ‡e je **migrirati projekat bez organizacije** u organizaciju sa dozvolama `roles/resourcemanager.projectCreator` i `roles/resourcemanager.projectMover`. Ako je projekat unutar druge organizacije, potrebno je kontaktirati GCP podrÅ¡ku da **ih prvo premestite iz organizacije**. Za viÅ¡e informacija pogledajte [**ovo**](https://medium.com/google-cloud/migrating-a-project-from-one-organization-to-another-gcp-4b37a86dd9e6).

## **Politike organizacije**

OmoguÄ‡avaju centralizaciju kontrole nad resursima vaÅ¡e organizacije u oblaku:

* Centralizujte kontrolu da **konfiguriÅ¡ete ograniÄenja** o tome kako se resursi vaÅ¡e organizacije mogu koristiti.
* DefiniÅ¡ite i uspostavite **ograniÄenja** za vaÅ¡e razvojne timove da ostanu unutar granica usklaÄ‘enosti.
* Pomozite vlasnicima projekata i njihovim timovima da brzo napreduju bez brige o krÅ¡enju usklaÄ‘enosti.

Ove politike mogu biti kreirane da **uticaju na celu organizaciju, folder(e) ili projekat(e)**. Potomci ciljanog Ävora hijerarhije resursa **nasleÄ‘uju politiku organizacije**.

Da biste **definisali** politiku organizacije, **birate** [**ograniÄenje**](https://cloud.google.com/resource-manager/docs/organization-policy/overview#constraints), Å¡to je poseban tip ograniÄenja prema Google Cloud usluzi ili grupi Google Cloud usluga. **KonfiguriÅ¡ete to ograniÄenje sa Å¾eljenim ograniÄenjima**.

<figure><img src="../../../.gitbook/assets/image (217).png" alt=""><figcaption><p><a href="https://cloud.google.com/resource-manager/img/org-policy-concepts.svg">https://cloud.google.com/resource-manager/img/org-policy-concepts.svg</a></p></figcaption></figure>

#### UobiÄajeni sluÄajevi koriÅ¡Ä‡enja <a href="#common_use_cases" id="common_use_cases"></a>

* OgraniÄite deljenje resursa na osnovu domena.
* OgraniÄite koriÅ¡Ä‡enje naloga usluga za identitet i pristup.
* OgraniÄite fiziÄku lokaciju novokreiranih resursa.
* OnemoguÄ‡ite kreiranje naloga usluga.

<figure><img src="../../../.gitbook/assets/image (172).png" alt=""><figcaption></figcaption></figure>

Postoji mnogo drugih ograniÄenja koja vam daju preciznu kontrolu nad resursima vaÅ¡e organizacije. Za **viÅ¡e informacija, pogledajte** [**spisak svih ograniÄenja politike organizacije**](https://cloud.google.com/resource-manager/docs/organization-policy/org-policy-constraints)**.**

### **Podrazumevane politike organizacije**

<details>

<summary>Ovo su politike koje Ä‡e Google dodati podrazumevano prilikom postavljanja vaÅ¡e GCP organizacije:</summary>

**Politike upravljanja pristupom**

* **Kontakti sa ograniÄenim domenom:** SpreÄava dodavanje korisnika u Esencijalne kontakte van vaÅ¡ih specificiranih domena. Ovo ograniÄava Esencijalne kontakte da dozvole samo upravljanim identitetima korisnika u vaÅ¡im odabranim domenama da primaju obaveÅ¡tenja sa platforme.
* **Deljenje sa ograniÄenim domenom:** SpreÄava dodavanje korisnika u IAM politike van vaÅ¡ih specificiranih domena. Ovo ograniÄava IAM politike da dozvole samo upravljanim identitetima korisnika u vaÅ¡im odabranim domenama da pristupaju resursima unutar ove organizacije.
* **SpreÄavanje javnog pristupa:** SpreÄava Cloud Storage kante da budu izloÅ¾ene javnosti. Ovo osigurava da programer ne moÅ¾e konfigurisati Cloud Storage kante da imaju neautentifikovani pristup internetu.
* **Uniformni pristup na nivou kante:** SpreÄava liste kontrola pristupa (ACL) na nivou objekta u Cloud Storage kantama. Ovo pojednostavljuje vaÅ¡e upravljanje pristupom primenom IAM politika dosledno na svim objektima u Cloud Storage kantama.
* **Zahtevajte OS prijavu:** VMs kreirane u novim projektima Ä‡e imati omoguÄ‡enu OS prijavu. Ovo vam omoguÄ‡ava da upravljate SSH pristupom vaÅ¡im instancama koristeÄ‡i IAM bez potrebe da kreirate i upravljate pojedinaÄnim SSH kljuÄevima.

**Dodatne sigurnosne politike za naloge usluga**

* **OnemoguÄ‡ite automatske IAM dozvole:** SpreÄava da se podrazumevani App Engine i Compute Engine nalozi usluga automatski dodeljuju IAM ulogu urednika prilikom kreiranja projekta. Ovo osigurava da nalozi usluga ne dobiju previÅ¡e dozvola prilikom kreiranja.
* **OnemoguÄ‡ite kreiranje kljuÄeva naloga usluga:** SpreÄava kreiranje javnih kljuÄeva naloga usluga. Ovo pomaÅ¾e u smanjenju rizika od izlaganja trajnih akreditiva.
* **OnemoguÄ‡ite otpremu kljuÄeva naloga usluga:** SpreÄava otpremu javnih kljuÄeva naloga usluga. Ovo pomaÅ¾e u smanjenju rizika od curenja ili ponovne upotrebe materijala kljuÄeva.

**Politike konfiguracije sigurnih VPC mreÅ¾a**

* **DefiniÅ¡ite dozvoljene spoljne IP adrese za VM instance:** SpreÄava kreiranje Compute instanci sa javnim IP, Å¡to moÅ¾e izloÅ¾iti internet saobraÄ‡aju.

<!---->

* **OnemoguÄ‡ite VM ugnjeÅ¾denu virtualizaciju:** SpreÄava kreiranje ugnjeÅ¾denih VMs na Compute Engine VMs. Ovo smanjuje sigurnosni rizik od neproverenih ugnjeÅ¾denih VMs.

<!---->

* **OnemoguÄ‡ite serijski port VM:** SpreÄava pristup serijskom portu na Compute Engine VMs. Ovo spreÄava unos u serijski port servera koristeÄ‡i Compute Engine API.

<!---->

* **OgraniÄite autorizovane mreÅ¾e na Cloud SQL instancama:** SpreÄava javne ili neinternetske mreÅ¾ne opsege da pristupaju vaÅ¡im Cloud SQL bazama podataka.

<!---->

* **OgraniÄite prosleÄ‘ivanje protokola na osnovu tipa IP adrese:** SpreÄava VM prosleÄ‘ivanje protokola za spoljne IP adrese.

<!---->

* **OgraniÄite javni pristup na Cloud SQL instancama:** SpreÄava kreiranje Cloud SQL instanci sa javnim IP, Å¡to moÅ¾e izloÅ¾iti internet saobraÄ‡aju.

<!---->

* **OgraniÄite uklanjanje tereta zajedniÄkog VPC projekta:** SpreÄava sluÄajno brisanje zajedniÄkih VPC host projekata.

<!---->

* **Postavlja unutraÅ¡nju DNS postavku za nove projekte na Zonal DNS Samo:** SpreÄava koriÅ¡Ä‡enje nasleÄ‘ene DNS postavke koja je smanjila dostupnost usluga.

<!---->

* **PreskoÄite kreiranje podrazumevane mreÅ¾e:** SpreÄava automatsko kreiranje podrazumevane VPC mreÅ¾e i povezanih resursa. Ovo izbegava previÅ¡e dozvola podrazumevanih pravila vatrozida.

<!---->

* **OnemoguÄ‡ite koriÅ¡Ä‡enje VPC spoljnog IPv6:** SpreÄava kreiranje spoljaÅ¡njih IPv6 podmreÅ¾a, koje mogu biti izloÅ¾ene neovlaÅ¡Ä‡enom pristupu internetu.

</details>

## **IAM Uloge**

Ove su sliÄne IAM politikama u AWS-u jer **svaka uloga sadrÅ¾i skup dozvola.**

MeÄ‘utim, za razliku od AWS-a, ne postoji **centralizovani repozitorij** uloga. Umesto toga, **resursi daju X pristupne uloge Y principima**, a jedini naÄin da saznate ko ima pristup resursu je koriÅ¡Ä‡enje **`get-iam-policy` metode nad tim resursom**.\
To moÅ¾e biti problem jer to znaÄi da je jedini naÄin da saznate **koje dozvole ima princip da pitate svaki resurs kome dodeljuje dozvole**, a korisnik moÅ¾da nema dozvole da dobije dozvole od svih resursa.

Postoje **tri tipa** uloga u IAM:

* **Osnovne/Primitivne uloge**, koje ukljuÄuju **Vlasnika**, **Urednika** i **Gledaoca** uloge koje su postojale pre uvoÄ‘enja IAM-a.
* **Predefinisane uloge**, koje pruÅ¾aju granularan pristup za odreÄ‘enu uslugu i kojima upravlja Google Cloud. Postoji mnogo predefinisanih uloga, moÅ¾ete **videti sve njih sa privilegijama koje imaju** [**ovde**](https://cloud.google.com/iam/docs/understanding-roles#predefined\_roles).
* **PrilagoÄ‘ene uloge**, koje pruÅ¾aju granularan pristup prema listi dozvola koju je naveo korisnik.

Postoje hiljade dozvola u GCP-u. Da biste proverili da li uloga ima dozvolu, moÅ¾ete [**pretraÅ¾iti dozvolu ovde**](https://cloud.google.com/iam/docs/permissions-reference) i videti koje uloge je imaju.

TakoÄ‘e moÅ¾ete [**pretraÅ¾iti ovde predefinisane uloge**](https://cloud.google.com/iam/docs/understanding-roles#product\_specific\_documentation) **koje nudi svaki proizvod.** Imajte na umu da neke **uloge** ne mogu biti dodeljene korisnicima i **samo SAs zbog nekih dozvola** koje sadrÅ¾e.\
Pored toga, imajte na umu da Ä‡e **dozvole** imati efekat samo ako su **prikljuÄene relevantnoj usluzi.**

Ili proverite da li **prilagoÄ‘ena uloga moÅ¾e koristiti** [**specifiÄnu dozvolu ovde**](https://cloud.google.com/iam/docs/custom-roles-permissions-support)**.**

{% content-ref url="../gcp-services/gcp-iam-and-org-policies-enum.md" %}
[gcp-iam-and-org-policies-enum.md](../gcp-services/gcp-iam-and-org-policies-enum.md)
{% endcontent-ref %}

## Korisnici <a href="#default-credentials" id="default-credentials"></a>

U **GCP konzoli** ne postoji upravljanje Korisnicima ili Grupama, to se obavlja u **Google Workspace**. Iako moÅ¾ete sinhronizovati razliÄitog provajdera identiteta u Google Workspace.

MoÅ¾ete pristupiti korisnicima i grupama Workspace-a na **[https://admin.google.com](https://admin.google.com/)**.

**MFA** se moÅ¾e **naterati** na korisnike Workspace-a, meÄ‘utim, **napadaÄ** moÅ¾e koristiti token za pristup GCP-u **putem cli koji neÄ‡e biti zaÅ¡tiÄ‡en MFA** (biÄ‡e zaÅ¡tiÄ‡en MFA samo kada se korisnik prijavi da ga generiÅ¡e: `gcloud auth login`).

## Grupe

Kada se organizacija kreira, nekoliko grupa je **snaÅ¾no preporuÄeno da se kreira.** Ako upravljate bilo kojom od njih, mogli biste kompromitovati sve ili vaÅ¾an deo organizacije:

<table data-header-hidden><thead><tr><th width="299.3076923076923"></th><th></th></tr></thead><tbody><tr><td><strong>Grupa</strong></td><td><strong>Funkcija</strong></td></tr><tr><td><strong><code>gcp-organization-admins</code></strong><br><em>(grupa ili pojedinaÄni nalozi potrebni za kontrolnu listu)</em></td><td>Upravljanje bilo kojim resursom koji pripada organizaciji. Dodelite ovu ulogu Å¡tedljivo; administratori organizacije imaju pristup svim vaÅ¡im Google Cloud resursima. Alternativno, s obzirom na to da je ova funkcija visoko privilegovana, razmislite o koriÅ¡Ä‡enju pojedinaÄnih naloga umesto kreiranja grupe.</td></tr><tr><td><strong><code>gcp-network-admins</code></strong><br><em>(potrebno za kontrolnu listu)</em></td><td>Kreiranje mreÅ¾a, podmreÅ¾a, pravila vatrozida i mreÅ¾nih ureÄ‘aja kao Å¡to su Cloud Router, Cloud VPN i cloud load balancers.</td></tr><tr><td><strong><code>gcp-billing-admins</code></strong><br><em>(potrebno za kontrolnu listu)</em></td><td>Postavljanje raÄuna za naplatu i praÄ‡enje njihove upotrebe.</td></tr><tr><td><strong><code>gcp-developers</code></strong><br><em>(potrebno za kontrolnu listu)</em></td><td>Dizajniranje, kodiranje i testiranje aplikacija.</td></tr><tr><td><strong><code>gcp-security-admins</code></strong><br></td><td>Uspostavljanje i upravljanje sigurnosnim politikama za celu organizaciju, ukljuÄujuÄ‡i upravljanje pristupom i <a href="https://cloud.google.com/resource-manager/docs/organization-policy/org-policy-constraints">politike ograniÄenja organizacije</a>. Pogledajte <a href="https://cloud.google.com/architecture/security-foundations/authentication-authorization#users_and_groups">vodiÄ za sigurnosne osnove Google Clouda</a> za viÅ¡e informacija o planiranju vaÅ¡e Google Cloud sigurnosne infrastrukture.</td></tr><tr><td><strong><code>gcp-devops</code></strong></td><td>Kreiranje ili upravljanje end-to-end procesima koji podrÅ¾avaju kontinuiranu integraciju i isporuku, praÄ‡enje i sistemsko obezbeÄ‘enje.</td></tr><tr><td><strong><code>gcp-logging-admins</code></strong></td><td></td></tr><tr><td><strong><code>gcp-logging-viewers</code></strong></td><td></td></tr><tr><td><strong><code>gcp-monitor-admins</code></strong></td><td></td></tr><tr><td><strong><code>gcp-billing-viewer</code></strong><br><em>(viÅ¡e nije podrazumevano)</em></td><td>PraÄ‡enje troÅ¡kova na projektima. TipiÄni Älanovi su deo finansijskog tima.</td></tr><tr><td><strong><code>gcp-platform-viewer</code></strong><br><em>(viÅ¡e nije podrazumevano)</em></td><td>Pregled informacija o resursima Å¡irom Google Cloud organizacije.</td></tr><tr><td><strong><code>gcp-security-reviewer</code></strong><br><em>(viÅ¡e nije podrazumevano)</em></td><td>Pregledanje sigurnosti u oblaku.</td></tr><tr><td><strong><code>gcp-network-viewer</code></strong><br><em>(viÅ¡e nije podrazumevano)</em></td><td>Pregledanje mreÅ¾nih konfiguracija.</td></tr><tr><td><strong><code>grp-gcp-audit-viewer</code></strong><br><em>(viÅ¡e nije podrazumevano)</em></td><td>Pregledanje revizorskih logova.</td></tr><tr><td><strong><code>gcp-scc-admin</code></strong><br><em>(viÅ¡e nije podrazumevano)</em></td><td>Upravljanje Security Command Center-om.</td></tr><tr><td><strong><code>gcp-secrets-admin</code></strong><br><em>(viÅ¡e nije podrazumevano)</em></td><td>Upravljanje tajnama u Secret Manager-u.</td></tr></tbody></table>

## **Podrazumevana politika lozinki**

* Sprovodite jake lozinke
* IzmeÄ‘u 8 i 100 karaktera
* Bez ponovne upotrebe
* Bez isteka
* Ako ljudi pristupaju Workspace-u putem treÄ‡e strane, ovi zahtevi se ne primenjuju.

<figure><img src="../../../.gitbook/assets/image (20).png" alt=""><figcaption></figcaption></figure>

<figure><img src="../../../.gitbook/assets/image (22).png" alt=""><figcaption></figcaption></figure>

## **Nalozi usluga**

Ovo su principi koje **resursi** mogu **imati** **prikljuÄene** i pristupiti kako bi lako interagovali sa GCP-om. Na primer, moguÄ‡e je pristupiti **auth tokenu** naloga usluga **prikljuÄenom VM-u** u metapodacima.\
MoguÄ‡e je naiÄ‡i na neke **sukobe** kada koristite i **IAM i pristupne opsege**. Na primer, vaÅ¡ nalog usluga moÅ¾e imati IAM ulogu `compute.instanceAdmin`, ali instanca koju ste kompromitovali ima ograniÄenje opsega `https://www.googleapis.com/auth/compute.readonly`. Ovo bi vam onemoguÄ‡ilo da napravite bilo kakve promene koristeÄ‡i OAuth token koji je automatski dodeljen vaÅ¡oj instanci.

SliÄno je **IAM ulogama iz AWS-a**. Ali ne kao u AWS-u, **bilo koji** nalog usluga moÅ¾e biti **prikljuÄen bilo kojoj usluzi** (ne mora to dozvoliti putem politike).

Nekoliko naloga usluga koje Ä‡ete pronaÄ‡i su zapravo **automatski generisani od strane GCP-a** kada poÄnete koristiti uslugu, kao:
```
PROJECT_NUMBER-compute@developer.gserviceaccount.com
PROJECT_ID@appspot.gserviceaccount.com
```
MeÄ‘utim, takoÄ‘e je moguÄ‡e kreirati i povezati se sa resursima **prilagoÄ‘enim servisnim nalozima**, koji Ä‡e izgledati ovako:
```
SERVICE_ACCOUNT_NAME@PROJECT_NAME.iam.gserviceaccount.com
```
### **KljuÄevi i Tokeni**

Postoje 2 glavna naÄina za pristup GCP-u kao servisnom nalogu:

* **Putem OAuth tokena**: To su tokeni koje Ä‡ete dobiti sa mesta kao Å¡to su metapodaci ili kraÄ‘om http zahteva i ograniÄeni su **opsegom pristupa**.
* **KljuÄevi**: To su javni i privatni parovi kljuÄeva koji Ä‡e vam omoguÄ‡iti da potpiÅ¡ete zahteve kao servisni nalog i Äak generiÅ¡ete OAuth tokene za izvrÅ¡avanje akcija kao servisni nalog. Ovi kljuÄevi su opasni jer ih je teÅ¾e ograniÄiti i kontrolisati, zato GCP preporuÄuje da ih ne generiÅ¡ete.
* Imajte na umu da svaki put kada se kreira SA, **GCP generiÅ¡e kljuÄ za servisni nalog** kojem korisnik ne moÅ¾e pristupiti (i neÄ‡e biti naveden u web aplikaciji). Prema [**ovoj temi**](https://www.reddit.com/r/googlecloud/comments/f0ospy/service\_account\_keys\_observations/) ovaj kljuÄ je **interno koriÅ¡Ä‡en od strane GCP-a** da omoguÄ‡i metapodacima pristup za generisanje dostupnih OAuth tokena.

### **Opsezi pristupa**

Opsezi pristupa su **prikljuÄeni generisanim OAuth tokenima** za pristup GCP API krajnjim taÄkama. Oni **ograniÄavaju dozvole** OAuth tokena.\
To znaÄi da ako token pripada vlasniku resursa, ali nema u opsegu tokena pristup tom resursu, token **ne moÅ¾e biti koriÅ¡Ä‡en za (zlo)upotrebu tih privilegija**.

Google zapravo [preporuÄuje](https://cloud.google.com/compute/docs/access/service-accounts#service\_account\_permissions) da **opsezi pristupa ne budu koriÅ¡Ä‡eni i da se potpuno oslanjate na IAM**. Web portal za upravljanje zapravo to sprovodi, ali opsezi pristupa se i dalje mogu primeniti na instance koristeÄ‡i prilagoÄ‘ene servisne naloge programatski.

MoÅ¾ete videti koji su **opsezi** **dodeljeni** **upitom:** 

{% code overflow="wrap" %}
```bash
curl 'https://www.googleapis.com/oauth2/v1/tokeninfo?access_token=<access_token>'

{
"issued_to": "223044615559.apps.googleusercontent.com",
"audience": "223044615559.apps.googleusercontent.com",
"user_id": "139746512919298469201",
"scope": "openid https://www.googleapis.com/auth/userinfo.email https://www.googleapis.com/auth/cloud-platform https://www.googleapis.com/auth/appengine.admin https://www.googleapis.com/auth/sqlservice.login https://www.googleapis.com/auth/compute https://www.googleapis.com/auth/accounts.reauth",
"expires_in": 2253,
"email": "username@testing.com",
"verified_email": true,
"access_type": "offline"
}
```
{% endcode %}

Prethodni **opseg** su oni generisani **podrazumevano** koristeÄ‡i **`gcloud`** za pristup podacima. To je zato Å¡to kada koristite **`gcloud`** prvo kreirate OAuth token, a zatim ga koristite za kontaktiranje krajnjih taÄaka.

NajvaÅ¾niji opseg od onih potencijalno je **`cloud-platform`**, Å¡to u suÅ¡tini znaÄi da je moguÄ‡e **pristupiti bilo kojoj usluzi u GCP**.

MoÅ¾ete **pronaÄ‡i listu** [**svi moguÄ‡i opsezi ovde**](https://developers.google.com/identity/protocols/googlescopes)**.**

Ako imate **`gcloud`** kredencijale za pretraÅ¾ivaÄ, moguÄ‡e je **dobiti token sa drugim opsezima,** radeÄ‡i neÅ¡to poput:

{% code overflow="wrap" %}
```bash
# Maybe you can get a user token with other scopes changing the scopes array from ~/.config/gcloud/credentials.db

# Set new scopes for SDKs credentials
gcloud auth application-default login --scopes=https://www.googleapis.com/auth/userinfo.email,https://www.googleapis.com/auth/cloud-platform,https://www.googleapis.com/auth/sqlservice.login,https://www.googleapis.com/auth/appengine.admin,https://www.googleapis.com/auth/compute,https://www.googleapis.com/auth/accounts.reauth,https://www.googleapis.com/auth/admin.directory.user,https://www.googleapis.com/auth/admin.directory.group,https://www.googleapis.com/auth/admin.directory.domain,https://www.googleapis.com/auth/admin.directory.user

# Print new token
gcloud auth application-default print-access-token

# To use this token with some API you might need to use curl to indicate the project header with --header "X-Goog-User-Project: <project-name>"
```
{% endcode %}

## **Terraform IAM Politike, Povezivanja i ÄŒlanstva**

Kao Å¡to je definisano od strane terraform-a u [https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/google\_project\_iam](https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/google\_project\_iam), koriÅ¡Ä‡enjem terraform-a sa GCP postoje razliÄiti naÄini za dodeljivanje pristupa principalu nad resursom:

* **ÄŒlanstva**: Postavljate **principale kao Älanove uloga** **bez ograniÄenja** nad ulogom ili principima. MoÅ¾ete staviti korisnika kao Älana uloge, a zatim staviti grupu kao Älana iste uloge i takoÄ‘e postaviti te principe (korisnika i grupu) kao Älanove drugih uloga.
* **Povezivanja**: Nekoliko **principala moÅ¾e biti povezano sa ulogom**. Ti **principali mogu i dalje biti povezani ili Älanovi drugih uloga**. MeÄ‘utim, ako je principal koji nije povezan sa ulogom postavljen kao **Älan povezane uloge**, sledeÄ‡i put kada se **povezivanje primeni, Älanstvo Ä‡e nestati**.
* **Politike**: Politika je **autoritativna**, ukazuje na uloge i principe i tada, **ti principi ne mogu imati viÅ¡e uloga i te uloge ne mogu imati viÅ¡e principa** osim ako ta politika nije izmenjena (Äak ni u drugim politikama, povezivanjima ili Älanstvima). Stoga, kada je uloga ili principal specificiran u politici, sva njegova privilegija su **ograniÄena tom politikom**. OÄigledno, ovo se moÅ¾e zaobiÄ‡i u sluÄaju da principal dobije opciju da izmeni politiku ili dozvole za eskalaciju privilegija (kao Å¡to je kreiranje novog principa i povezivanje sa novom ulogom).

## Reference

* [https://about.gitlab.com/blog/2020/02/12/plundering-gcp-escalating-privileges-in-google-cloud-platform/](https://about.gitlab.com/blog/2020/02/12/plundering-gcp-escalating-privileges-in-google-cloud-platform/)
* [https://cloud.google.com/resource-manager/docs/cloud-platform-resource-hierarchy](https://cloud.google.com/resource-manager/docs/cloud-platform-resource-hierarchy)

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
