# GCP - Grundinformationen

{% hint style="success" %}
Lerne & √ºbe AWS Hacking:<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Lerne & √ºbe GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Unterst√ºtze HackTricks</summary>

* √úberpr√ºfe die [**Abonnementpl√§ne**](https://github.com/sponsors/carlospolop)!
* **Tritt der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folge** uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teile Hacking-Tricks, indem du PRs zu den** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repos einreichst.

</details>
{% endhint %}

## **Ressourcenhierarchie**

Google Cloud verwendet eine [Ressourcenhierarchie](https://cloud.google.com/resource-manager/docs/cloud-platform-resource-hierarchy), die konzeptionell √§hnlich ist wie die eines traditionellen Dateisystems. Dies bietet einen logischen Eltern-/Kind-Workflow mit spezifischen Ankn√ºpfungspunkten f√ºr Richtlinien und Berechtigungen.

Auf hoher Ebene sieht es so aus:
```
Organization
--> Folders
--> Projects
--> Resources
```
Eine virtuelle Maschine (genannt Compute Instance) ist eine Ressource. Eine Ressource befindet sich in einem Projekt, wahrscheinlich zusammen mit anderen Compute Instances, Speicher-Buckets usw.

<figure><img src="../../../.gitbook/assets/image (1) (1) (1) (1).png" alt=""><figcaption><p><a href="https://cloud.google.com/static/resource-manager/img/cloud-hierarchy.svg">https://cloud.google.com/static/resource-manager/img/cloud-hierarchy.svg</a></p></figcaption></figure>

## **Projekte migrieren**

Es ist m√∂glich, ein **Projekt ohne Organisation** in eine Organisation mit den Berechtigungen `roles/resourcemanager.projectCreator` und `roles/resourcemanager.projectMover` zu **migrieren**. Wenn sich das Projekt in einer anderen Organisation befindet, muss GCP-Support kontaktiert werden, um **es zuerst aus der Organisation zu verschieben**. F√ºr weitere Informationen siehe [**dies**](https://medium.com/google-cloud/migrating-a-project-from-one-organization-to-another-gcp-4b37a86dd9e6).

## **Organisationsrichtlinien**

Erlauben die Zentralisierung der Kontrolle √ºber die Cloud-Ressourcen Ihrer Organisation:

* Zentralisieren Sie die Kontrolle, um **Einschr√§nkungen** zu konfigurieren, wie die Ressourcen Ihrer Organisation verwendet werden k√∂nnen.
* Definieren und etablieren Sie **Richtlinien**, damit Ihre Entwicklungsteams innerhalb der Compliance-Grenzen bleiben.
* Helfen Sie Projektbesitzern und ihren Teams, schnell zu arbeiten, ohne sich um die Einhaltung der Vorschriften sorgen zu m√ºssen.

Diese Richtlinien k√∂nnen erstellt werden, um die **gesamte Organisation, Ordner oder Projekte** zu **beeinflussen**. Nachkommen des Zielressourcen-Hierarchieknotens **erben die Organisationsrichtlinie**.

Um eine **Organisationsrichtlinie zu definieren**, **w√§hlen Sie eine** [**Einschr√§nkung**](https://cloud.google.com/resource-manager/docs/organization-policy/overview#constraints), die eine bestimmte Art von Einschr√§nkung gegen einen Google Cloud-Dienst oder eine Gruppe von Google Cloud-Diensten ist. Sie **konfigurieren diese Einschr√§nkung mit Ihren gew√ºnschten Einschr√§nkungen**.

<figure><img src="../../../.gitbook/assets/image (217).png" alt=""><figcaption><p><a href="https://cloud.google.com/resource-manager/img/org-policy-concepts.svg">https://cloud.google.com/resource-manager/img/org-policy-concepts.svg</a></p></figcaption></figure>

#### H√§ufige Anwendungsf√§lle <a href="#common_use_cases" id="common_use_cases"></a>

* Begrenzen Sie die Ressourcenteilung basierend auf der Domain.
* Begrenzen Sie die Nutzung von Identit√§ts- und Zugriffsmanagement-Dienstkonten.
* Beschr√§nken Sie den physischen Standort neu erstellter Ressourcen.
* Deaktivieren Sie die Erstellung von Dienstkonten.

<figure><img src="../../../.gitbook/assets/image (172).png" alt=""><figcaption></figcaption></figure>

Es gibt viele weitere Einschr√§nkungen, die Ihnen eine feink√∂rnige Kontrolle √ºber die Ressourcen Ihrer Organisation geben. F√ºr **weitere Informationen siehe die** [**Liste aller Einschr√§nkungen des Organisation Policy Service**](https://cloud.google.com/resource-manager/docs/organization-policy/org-policy-constraints)**.**

### **Standard-Organisationsrichtlinien**

<details>

<summary>Dies sind die Richtlinien, die Google standardm√§√üig hinzuf√ºgt, wenn Sie Ihre GCP-Organisation einrichten:</summary>

**Zugriffsmanagement-Richtlinien**

* **Domain-restricted contacts:** Verhindert das Hinzuf√ºgen von Benutzern zu Essential Contacts au√üerhalb Ihrer angegebenen Domains. Dies beschr√§nkt Essential Contacts darauf, nur verwaltete Benutzeridentit√§ten in Ihren ausgew√§hlten Domains Plattformbenachrichtigungen zu erhalten.
* **Domain-restricted sharing:** Verhindert das Hinzuf√ºgen von Benutzern zu IAM-Richtlinien au√üerhalb Ihrer angegebenen Domains. Dies beschr√§nkt IAM-Richtlinien darauf, nur verwaltete Benutzeridentit√§ten in Ihren ausgew√§hlten Domains den Zugriff auf Ressourcen innerhalb dieser Organisation zu erm√∂glichen.
* **√ñffentlicher Zugriffsverhinderung:** Verhindert, dass Cloud Storage-Buckets der √ñffentlichkeit ausgesetzt werden. Dies stellt sicher, dass ein Entwickler Cloud Storage-Buckets nicht so konfigurieren kann, dass sie unauthentifizierten Internetzugang haben.
* **Einheitlicher Bucket-Level-Zugriff:** Verhindert objektbasierte Zugriffskontrolllisten (ACLs) in Cloud Storage-Buckets. Dies vereinfacht Ihr Zugriffsmanagement, indem IAM-Richtlinien konsistent auf alle Objekte in Cloud Storage-Buckets angewendet werden.
* **OS-Login erforderlich:** VMs, die in neuen Projekten erstellt werden, haben OS-Login aktiviert. Dies erm√∂glicht Ihnen, den SSH-Zugriff auf Ihre Instanzen mithilfe von IAM zu verwalten, ohne individuelle SSH-Schl√ºssel erstellen und verwalten zu m√ºssen.

**Zus√§tzliche Sicherheitsrichtlinien f√ºr Dienstkonten**

* **Automatische IAM-Zugriffsrechte deaktivieren:** Verhindert, dass die Standard-App-Engine- und Compute-Engine-Dienstkonten beim Erstellen automatisch die IAM-Rolle Editor erhalten. Dies stellt sicher, dass Dienstkonten beim Erstellen keine √ºberm√§√üig gro√üz√ºgigen IAM-Rollen erhalten.
* **Erstellung von Dienstkontenschl√ºsseln deaktivieren:** Verhindert die Erstellung √∂ffentlicher Dienstkontenschl√ºssel. Dies hilft, das Risiko der Offenlegung persistenter Anmeldeinformationen zu verringern.
* **Hochladen von Dienstkontenschl√ºsseln deaktivieren:** Verhindert das Hochladen √∂ffentlicher Dienstkontenschl√ºssel. Dies hilft, das Risiko von geleakten oder wiederverwendeten Schl√ºsselmaterialien zu verringern.

**Sichere VPC-Netzwerkkonfigurationsrichtlinien**

* **Erlaubte externe IPs f√ºr VM-Instanzen definieren:** Verhindert die Erstellung von Compute-Instanzen mit einer √∂ffentlichen IP, die sie dem Internetverkehr aussetzen kann.

<!---->

* **VM-nested Virtualisierung deaktivieren:** Verhindert die Erstellung von verschachtelten VMs auf Compute Engine-VMs. Dies verringert das Sicherheitsrisiko, un√ºberwachte verschachtelte VMs zu haben.

<!---->

* **VM-Seriellen Port deaktivieren:** Verhindert den Zugriff auf den seriellen Port von Compute Engine-VMs. Dies verhindert Eingaben an den seriellen Port eines Servers √ºber die Compute Engine-API.

<!---->

* **Autorisierte Netzwerke auf Cloud SQL-Instanzen einschr√§nken:** Verhindert, dass √∂ffentliche oder nicht interne Netzwerkbereiche auf Ihre Cloud SQL-Datenbanken zugreifen.

<!---->

* **Protokollweiterleitung basierend auf der Art der IP-Adresse einschr√§nken:** Verhindert die VM-Protokollweiterleitung f√ºr externe IP-Adressen.

<!---->

* **√ñffentlichen IP-Zugriff auf Cloud SQL-Instanzen einschr√§nken:** Verhindert die Erstellung von Cloud SQL-Instanzen mit einer √∂ffentlichen IP, die sie dem Internetverkehr aussetzen kann.

<!---->

* **Entfernung von Shared VPC-Projektpfandrechten einschr√§nken:** Verhindert das versehentliche L√∂schen von Shared VPC-Hostprojekten.

<!---->

* **Setzt die interne DNS-Einstellung f√ºr neue Projekte auf Zonal DNS Only:** Verhindert die Verwendung einer veralteten DNS-Einstellung, die die Verf√ºgbarkeit des Dienstes verringert.

<!---->

* **Standardnetzwerkerstellung √ºberspringen:** Verhindert die automatische Erstellung des Standard-VPC-Netzwerks und verwandter Ressourcen. Dies vermeidet √ºberm√§√üig gro√üz√ºgige Standard-Firewallregeln.

<!---->

* **Verwendung von VPC-Externen IPv6 deaktivieren:** Verhindert die Erstellung externer IPv6-Subnetze, die unbefugtem Internetzugang ausgesetzt werden k√∂nnen.

</details>

## **IAM-Rollen**

Diese sind wie IAM-Richtlinien in AWS, da **jede Rolle eine Reihe von Berechtigungen enth√§lt.**

Im Gegensatz zu AWS gibt es jedoch **kein zentrales Repository** f√ºr Rollen. Stattdessen **geben Ressourcen X Zugriffsrollen an Y Prinzipale**, und der einzige Weg herauszufinden, wer Zugriff auf eine Ressource hat, besteht darin, die **`get-iam-policy`-Methode √ºber diese Ressource** zu verwenden.\
Das k√∂nnte ein Problem darstellen, da dies bedeutet, dass der einzige Weg herauszufinden, **welche Berechtigungen ein Prinzipal hat, darin besteht, jede Ressource zu fragen, wem sie Berechtigungen erteilt**, und ein Benutzer m√∂glicherweise nicht die Berechtigung hat, Berechtigungen von allen Ressourcen abzurufen.

Es gibt **drei Arten** von Rollen in IAM:

* **Basis-/Primitive Rollen**, die die **Owner**, **Editor** und **Viewer** Rollen umfassen, die vor der Einf√ºhrung von IAM existierten.
* **Vordefinierte Rollen**, die granularen Zugriff f√ºr einen bestimmten Dienst bieten und von Google Cloud verwaltet werden. Es gibt viele vordefinierte Rollen, Sie k√∂nnen **alle mit den Berechtigungen, die sie haben, hier sehen** [**hier**](https://cloud.google.com/iam/docs/understanding-roles#predefined\_roles).
* **Benutzerdefinierte Rollen**, die granularen Zugriff gem√§√ü einer benutzerspezifizierten Liste von Berechtigungen bieten.

Es gibt Tausende von Berechtigungen in GCP. Um zu √ºberpr√ºfen, ob eine Rolle eine Berechtigung hat, k√∂nnen Sie [**hier nach der Berechtigung suchen**](https://cloud.google.com/iam/docs/permissions-reference) und sehen, welche Rollen sie haben.

Sie k√∂nnen auch [**hier nach vordefinierten Rollen suchen**](https://cloud.google.com/iam/docs/understanding-roles#product\_specific\_documentation), **die von jedem Produkt angeboten werden.** Beachten Sie, dass einige **Rollen** nicht Benutzern zugewiesen werden k√∂nnen und **nur SAs zugewiesen werden k√∂nnen, aufgrund einiger Berechtigungen**, die sie enthalten.\
Dar√ºber hinaus beachten Sie, dass **Berechtigungen** nur **wirksam werden**, wenn sie **dem relevanten Dienst zugewiesen sind.**

Oder √ºberpr√ºfen Sie, ob eine **benutzerdefinierte Rolle eine** [**spezifische Berechtigung hier verwenden kann**](https://cloud.google.com/iam/docs/custom-roles-permissions-support)**.**

{% content-ref url="../gcp-services/gcp-iam-and-org-policies-enum.md" %}
[gcp-iam-and-org-policies-enum.md](../gcp-services/gcp-iam-and-org-policies-enum.md)
{% endcontent-ref %}

## Benutzer <a href="#default-credentials" id="default-credentials"></a>

In der **GCP-Konsole** gibt es **kein Benutzer- oder Gruppenmanagement**, das erfolgt in **Google Workspace**. Obwohl Sie einen anderen Identit√§tsanbieter in Google Workspace synchronisieren k√∂nnten.

Sie k√∂nnen auf die Benutzer und Gruppen von Workspaces **unter** [**https://admin.google.com**](https://admin.google.com/) zugreifen.

**MFA** kann f√ºr Workspaces-Benutzer **erzwungen** werden, jedoch k√∂nnte ein **Angreifer** ein Token verwenden, um GCP **√ºber die CLI zuzugreifen, das nicht durch MFA gesch√ºtzt ist** (es wird nur gesch√ºtzt, wenn der Benutzer sich anmeldet, um es zu generieren: `gcloud auth login`).

## Gruppen

Wenn eine Organisation erstellt wird, wird dringend empfohlen, mehrere Gruppen zu erstellen. Wenn Sie eine davon verwalten, k√∂nnten Sie die gesamte Organisation oder einen wichtigen Teil davon kompromittiert haben:

<table data-header-hidden><thead><tr><th width="299.3076923076923"></th><th></th></tr></thead><tbody><tr><td><strong>Gruppe</strong></td><td><strong>Funktion</strong></td></tr><tr><td><strong><code>gcp-organization-admins</code></strong><br><em>(Gruppe oder individuelle Konten erforderlich f√ºr die Checkliste)</em></td><td>Verwaltung aller Ressourcen, die zur Organisation geh√∂ren. Weisen Sie diese Rolle sparsam zu; Org-Admins haben Zugriff auf alle Ihre Google Cloud-Ressourcen. Alternativ, da diese Funktion hochprivilegiert ist, ziehen Sie in Betracht, individuelle Konten anstelle der Erstellung einer Gruppe zu verwenden.</td></tr><tr><td><strong><code>gcp-network-admins</code></strong><br><em>(erforderlich f√ºr die Checkliste)</em></td><td>Erstellung von Netzwerken, Subnetzen, Firewall-Regeln und Netzwerkger√§ten wie Cloud Router, Cloud VPN und Cloud Load Balancers.</td></tr><tr><td><strong><code>gcp-billing-admins</code></strong><br><em>(erforderlich f√ºr die Checkliste)</em></td><td>Einrichtung von Abrechnungskonten und √úberwachung ihrer Nutzung.</td></tr><tr><td><strong><code>gcp-developers</code></strong><br><em>(erforderlich f√ºr die Checkliste)</em></td><td>Entwicklung, Codierung und Testen von Anwendungen.</td></tr><tr><td><strong><code>gcp-security-admins</code></strong><br></td><td>Festlegung und Verwaltung von Sicherheitsrichtlinien f√ºr die gesamte Organisation, einschlie√ülich Zugriffsmanagement und <a href="https://cloud.google.com/resource-manager/docs/organization-policy/org-policy-constraints">Organisationsbeschr√§nkungsrichtlinien</a>. Siehe den <a href="https://cloud.google.com/architecture/security-foundations/authentication-authorization#users_and_groups">Google Cloud Sicherheitsgrundlagenleitfaden</a> f√ºr weitere Informationen zur Planung Ihrer Google Cloud-Sicherheitsinfrastruktur.</td></tr><tr><td><strong><code>gcp-devops</code></strong></td><td>Erstellung oder Verwaltung von End-to-End-Pipelines, die kontinuierliche Integration und Bereitstellung, √úberwachung und Systembereitstellung unterst√ºtzen.</td></tr><tr><td><strong><code>gcp-logging-admins</code></strong></td><td></td></tr><tr><td><strong><code>gcp-logging-viewers</code></strong></td><td></td></tr><tr><td><strong><code>gcp-monitor-admins</code></strong></td><td></td></tr><tr><td><strong><code>gcp-billing-viewer</code></strong><br><em>(nicht mehr standardm√§√üig)</em></td><td>√úberwachung der Ausgaben f√ºr Projekte. Typische Mitglieder sind Teil des Finanzteams.</td></tr><tr><td><strong><code>gcp-platform-viewer</code></strong><br><em>(nicht mehr standardm√§√üig)</em></td><td>√úberpr√ºfung von Ressourceninformationen √ºber die Google Cloud-Organisation.</td></tr><tr><td><strong><code>gcp-security-reviewer</code></strong><br><em>(nicht mehr standardm√§√üig)</em></td><td>√úberpr√ºfung der Cloud-Sicherheit.</td></tr><tr><td><strong><code>gcp-network-viewer</code></strong><br><em>(nicht mehr standardm√§√üig)</em></td><td>√úberpr√ºfung von Netzwerkkonfigurationen.</td></tr><tr><td><strong><code>grp-gcp-audit-viewer</code></strong><br><em>(nicht mehr standardm√§√üig)</em></td><td>Einsehen von Audit-Protokollen.</td></tr><tr><td><strong><code>gcp-scc-admin</code></strong><br><em>(nicht mehr standardm√§√üig)</em></td><td>Verwaltung des Security Command Center.</td></tr><tr><td><strong><code>gcp-secrets-admin</code></strong><br><em>(nicht mehr standardm√§√üig)</em></td><td>Verwaltung von Geheimnissen im Secret Manager.</td></tr></tbody></table>

## **Standard-Passwortrichtlinie**

* Durchsetzung starker Passw√∂rter
* Zwischen 8 und 100 Zeichen
* Keine Wiederverwendung
* Keine Ablauffrist
* Wenn Personen √ºber einen Drittanbieter auf Workspace zugreifen, werden diese Anforderungen nicht angewendet.

<figure><img src="../../../.gitbook/assets/image (20).png" alt=""><figcaption></figcaption></figure>

<figure><img src="../../../.gitbook/assets/image (22).png" alt=""><figcaption></figcaption></figure>

## **Dienstkonten**

Dies sind die Prinzipale, die **Ressourcen** **haben** **angeh√§ngt** und Zugriff haben, um einfach mit GCP zu interagieren. Zum Beispiel ist es m√∂glich, auf das **Auth-Token** eines Dienstkontos **zuzugreifen, das an eine VM** in den Metadaten angeh√§ngt ist.\
Es ist m√∂glich, einige **Konflikte** zu begegnen, wenn sowohl **IAM als auch Zugriffsscope** verwendet werden. Zum Beispiel kann Ihr Dienstkonto die IAM-Rolle `compute.instanceAdmin` haben, aber die Instanz, die Sie kompromittiert haben, wurde mit der Scope-Einschr√§nkung `https://www.googleapis.com/auth/compute.readonly` eingeschr√§nkt. Dies w√ºrde Sie daran hindern, √Ñnderungen mit dem OAuth-Token vorzunehmen, das automatisch Ihrer Instanz zugewiesen wird.

Es ist √§hnlich wie **IAM-Rollen von AWS**. Aber im Gegensatz zu AWS kann **jedes** Dienstkonto **an jeden Dienst** angeh√§ngt werden (es muss nicht √ºber eine Richtlinie erlaubt werden).

Mehrere der Dienstkonten, die Sie finden werden, sind tats√§chlich **automatisch von GCP generiert**, wenn Sie einen Dienst zu nutzen beginnen, wie:
```
PROJECT_NUMBER-compute@developer.gserviceaccount.com
PROJECT_ID@appspot.gserviceaccount.com
```
Es ist jedoch auch m√∂glich, **benutzerdefinierte Dienstkonten** zu erstellen und an Ressourcen anzuh√§ngen, die so aussehen werden:
```
SERVICE_ACCOUNT_NAME@PROJECT_NAME.iam.gserviceaccount.com
```
### **Zugriffsbereiche**

Zugriffsbereiche sind **an generierte OAuth-Token angeh√§ngt**, um auf die GCP-API-Endpunkte zuzugreifen. Sie **beschr√§nken die Berechtigungen** des OAuth-Tokens.\
Das bedeutet, dass, wenn ein Token einem Eigent√ºmer einer Ressource geh√∂rt, aber nicht den erforderlichen Bereich im Token hat, um auf diese Ressource zuzugreifen, das Token **nicht verwendet werden kann, um diese Berechtigungen (miss)zuverwenden**.

Google empfiehlt tats√§chlich, dass **Zugriffsbereiche nicht verwendet werden und man sich vollst√§ndig auf IAM verl√§sst**. Das Web-Management-Portal setzt dies tats√§chlich durch, aber Zugriffsbereiche k√∂nnen weiterhin programmgesteuert auf Instanzen angewendet werden, die benutzerdefinierte Dienstkonten verwenden.

Sie k√∂nnen sehen, welche **Bereiche** **zugewiesen** sind, indem Sie **abfragen:** 

{% code overflow="wrap" %}
```bash
curl 'https://www.googleapis.com/oauth2/v1/tokeninfo?access_token=<access_token>'

{
"issued_to": "223044615559.apps.googleusercontent.com",
"audience": "223044615559.apps.googleusercontent.com",
"user_id": "139746512919298469201",
"scope": "openid https://www.googleapis.com/auth/userinfo.email https://www.googleapis.com/auth/cloud-platform https://www.googleapis.com/auth/appengine.admin https://www.googleapis.com/auth/sqlservice.login https://www.googleapis.com/auth/compute https://www.googleapis.com/auth/accounts.reauth",
"expires_in": 2253,
"email": "username@testing.com",
"verified_email": true,
"access_type": "offline"
}
```
{% endcode %}

Die vorherigen **Scopes** sind die, die **standardm√§√üig** mit **`gcloud`** generiert werden, um auf Daten zuzugreifen. Das liegt daran, dass Sie beim Verwenden von **`gcloud`** zuerst ein OAuth-Token erstellen und es dann verwenden, um die Endpunkte zu kontaktieren.

Der wichtigste Scope davon ist wahrscheinlich **`cloud-platform`**, was im Grunde bedeutet, dass es m√∂glich ist, **auf jeden Dienst in GCP zuzugreifen**.

Sie k√∂nnen **eine Liste von** [**allen m√∂glichen Scopes hier finden**](https://developers.google.com/identity/protocols/googlescopes)**.**

Wenn Sie **`gcloud`** Browser-Anmeldeinformationen haben, ist es m√∂glich, **ein Token mit anderen Scopes zu erhalten,** indem Sie etwas wie Folgendes tun: 

{% code overflow="wrap" %}
```bash
# Maybe you can get a user token with other scopes changing the scopes array from ~/.config/gcloud/credentials.db

# Set new scopes for SDKs credentials
gcloud auth application-default login --scopes=https://www.googleapis.com/auth/userinfo.email,https://www.googleapis.com/auth/cloud-platform,https://www.googleapis.com/auth/sqlservice.login,https://www.googleapis.com/auth/appengine.admin,https://www.googleapis.com/auth/compute,https://www.googleapis.com/auth/accounts.reauth,https://www.googleapis.com/auth/admin.directory.user,https://www.googleapis.com/auth/admin.directory.group,https://www.googleapis.com/auth/admin.directory.domain,https://www.googleapis.com/auth/admin.directory.user

# Print new token
gcloud auth application-default print-access-token

# To use this token with some API you might need to use curl to indicate the project header with --header "X-Goog-User-Project: <project-name>"
```
{% endcode %}

## **Terraform IAM-Richtlinien, Bindungen und Mitgliedschaften**

Wie von terraform in [https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/google\_project\_iam](https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/google\_project\_iam) definiert, gibt es beim Einsatz von terraform mit GCP verschiedene M√∂glichkeiten, einem Principal Zugriff auf eine Ressource zu gew√§hren:

* **Mitgliedschaften**: Sie setzen **Principals als Mitglieder von Rollen** **ohne Einschr√§nkungen** √ºber die Rolle oder die Principals. Sie k√∂nnen einen Benutzer als Mitglied einer Rolle festlegen und dann eine Gruppe als Mitglied derselben Rolle festlegen und auch diese Principals (Benutzer und Gruppe) als Mitglieder anderer Rollen festlegen.
* **Bindungen**: Mehrere **Principals k√∂nnen an eine Rolle gebunden werden**. Diese **Principals k√∂nnen weiterhin an andere Rollen gebunden oder Mitglieder anderer Rollen sein**. Wenn jedoch ein Principal, der nicht an die Rolle gebunden ist, als **Mitglied einer gebundenen Rolle** festgelegt wird, wird beim n√§chsten Mal, wenn die **Bindung angewendet wird, die Mitgliedschaft verschwinden**.
* **Richtlinien**: Eine Richtlinie ist **verbindlich**, sie gibt Rollen und Principals an und dann **k√∂nnen diese Principals keine weiteren Rollen haben und diese Rollen k√∂nnen keine weiteren Principals haben**, es sei denn, diese Richtlinie wird ge√§ndert (nicht einmal in anderen Richtlinien, Bindungen oder Mitgliedschaften). Daher sind alle Privilegien eines in der Richtlinie angegebenen Rollens oder Principals **durch diese Richtlinie eingeschr√§nkt**. Offensichtlich kann dies umgangen werden, wenn dem Principal die M√∂glichkeit gegeben wird, die Richtlinie zu √§ndern oder Berechtigungen zur Privilegieneskalation zu erhalten (wie das Erstellen eines neuen Principals und das Binden an eine neue Rolle).

## Referenzen

* [https://about.gitlab.com/blog/2020/02/12/plundering-gcp-escalating-privileges-in-google-cloud-platform/](https://about.gitlab.com/blog/2020/02/12/plundering-gcp-escalating-privileges-in-google-cloud-platform/)
* [https://cloud.google.com/resource-manager/docs/cloud-platform-resource-hierarchy](https://cloud.google.com/resource-manager/docs/cloud-platform-resource-hierarchy)

{% hint style="success" %}
Lernen & √ºben Sie AWS Hacking:<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Lernen & √ºben Sie GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* √úberpr√ºfen Sie die [**Abonnementpl√§ne**](https://github.com/sponsors/carlospolop)!
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teilen Sie Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repos senden.

</details>
{% endhint %}
