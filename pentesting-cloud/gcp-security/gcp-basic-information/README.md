# GCP - Temel Bilgiler

{% hint style="success" %}
AWS Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n:<img src="../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">\
GCP Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**abonelik planlarÄ±nÄ±**](https://github.com/sponsors/carlospolop) kontrol edin!
* **ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n ya da **Twitter**'da **bizi takip edin** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Hacking ipuÃ§larÄ±nÄ± paylaÅŸmak iÃ§in** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna PR gÃ¶nderin.

</details>
{% endhint %}

## **Kaynak hiyerarÅŸisi**

Google Cloud, geleneksel bir dosya sistemine kavramsal olarak benzer bir [Kaynak hiyerarÅŸisi](https://cloud.google.com/resource-manager/docs/cloud-platform-resource-hierarchy) kullanÄ±r. Bu, politikalar ve izinler iÃ§in belirli ekleme noktalarÄ± ile mantÄ±ksal bir ebeveyn/Ã§ocuk iÅŸ akÄ±ÅŸÄ± saÄŸlar.

YÃ¼ksek seviyede, bu ÅŸekilde gÃ¶rÃ¼nÃ¼r:
```
Organization
--> Folders
--> Projects
--> Resources
```
Bir sanal makine (Compute Instance olarak adlandÄ±rÄ±lÄ±r) bir kaynaktÄ±r. Bir kaynak, muhtemelen diÄŸer Compute Instance'lar, depolama kovalarÄ± vb. ile birlikte bir projede bulunur.

<figure><img src="../../../.gitbook/assets/image (1) (1) (1) (1) (1).png" alt=""><figcaption><p><a href="https://cloud.google.com/static/resource-manager/img/cloud-hierarchy.svg">https://cloud.google.com/static/resource-manager/img/cloud-hierarchy.svg</a></p></figcaption></figure>

## **Projelerin TaÅŸÄ±nmasÄ±**

**Bir projeyi herhangi bir organizasyondan** bir organizasyona taÅŸÄ±mak mÃ¼mkÃ¼ndÃ¼r; bunun iÃ§in `roles/resourcemanager.projectCreator` ve `roles/resourcemanager.projectMover` izinlerine sahip olmanÄ±z gerekir. Proje baÅŸka bir organizasyonun iÃ§indeyse, **Ã¶ncelikle organizasyondan Ã§Ä±karmak iÃ§in GCP desteÄŸi ile iletiÅŸime geÃ§mek** gerekmektedir. Daha fazla bilgi iÃ§in [**ÅŸuraya**](https://medium.com/google-cloud/migrating-a-project-from-one-organization-to-another-gcp-4b37a86dd9e6) bakÄ±n.

## **Organizasyon PolitikalarÄ±**

Organizasyonunuzun bulut kaynaklarÄ± Ã¼zerinde merkezi kontrol saÄŸlamaya olanak tanÄ±r:

* Organizasyonunuzun kaynaklarÄ±nÄ±n nasÄ±l kullanÄ±labileceÄŸi Ã¼zerinde **kÄ±sÄ±tlamalar** yapÄ±landÄ±rmak iÃ§in merkezi kontrol saÄŸlayÄ±n.
* GeliÅŸtirme ekiplerinizin uyum sÄ±nÄ±rlarÄ± iÃ§inde kalmasÄ±nÄ± saÄŸlamak iÃ§in **koruma Ã¶nlemleri** tanÄ±mlayÄ±n ve oluÅŸturun.
* Proje sahiplerine ve ekiplerine uyumu ihlal etme endiÅŸesi olmadan hÄ±zlÄ± hareket etme konusunda yardÄ±mcÄ± olun.

Bu politikalar, **tÃ¼m organizasyonu, klasÃ¶r(ler) veya proje(ler)i etkilemek Ã¼zere** oluÅŸturulabilir. Hedeflenen kaynak hiyerarÅŸi dÃ¼ÄŸÃ¼mÃ¼nÃ¼n altÄ±ndaki varlÄ±klar **organizasyon politikasÄ±nÄ± miras alÄ±r**.

Bir organizasyon politikasÄ±nÄ± **tanÄ±mlamak iÃ§in**, **bir** [**kÄ±sÄ±tlama**](https://cloud.google.com/resource-manager/docs/organization-policy/overview#constraints) seÃ§ersiniz; bu, belirli bir Google Cloud hizmetine veya bir grup Google Cloud hizmetine karÅŸÄ± bir kÄ±sÄ±tlama tÃ¼rÃ¼dÃ¼r. Bu kÄ±sÄ±tlamayÄ± **istediÄŸiniz kÄ±sÄ±tlamalarla yapÄ±landÄ±rÄ±rsÄ±nÄ±z**.

<figure><img src="../../../.gitbook/assets/image (217).png" alt=""><figcaption><p><a href="https://cloud.google.com/resource-manager/img/org-policy-concepts.svg">https://cloud.google.com/resource-manager/img/org-policy-concepts.svg</a></p></figcaption></figure>

#### YaygÄ±n kullanÄ±m senaryolarÄ± <a href="#common_use_cases" id="common_use_cases"></a>

* Alan adÄ±na dayalÄ± kaynak paylaÅŸÄ±mÄ±nÄ± sÄ±nÄ±rlayÄ±n.
* Kimlik ve EriÅŸim YÃ¶netimi hizmet hesaplarÄ±nÄ±n kullanÄ±mÄ±nÄ± sÄ±nÄ±rlayÄ±n.
* Yeni oluÅŸturulan kaynaklarÄ±n fiziksel konumunu kÄ±sÄ±tlayÄ±n.
* Hizmet hesabÄ± oluÅŸturmayÄ± devre dÄ±ÅŸÄ± bÄ±rakÄ±n.

<figure><img src="../../../.gitbook/assets/image (172).png" alt=""><figcaption></figcaption></figure>

Organizasyonunuzun kaynaklarÄ± Ã¼zerinde ince ayar kontrolÃ¼ saÄŸlayan daha birÃ§ok kÄ±sÄ±tlama vardÄ±r. **Daha fazla bilgi iÃ§in,** [**TÃ¼m Organizasyon PolitikasÄ± Hizmeti kÄ±sÄ±tlamalarÄ±nÄ±n listesini**](https://cloud.google.com/resource-manager/docs/organization-policy/org-policy-constraints)** gÃ¶rÃ¼n.**

### **VarsayÄ±lan Organizasyon PolitikalarÄ±**

<details>

<summary>GCP organizasyonunuzu kurarken Google'Ä±n varsayÄ±lan olarak ekleyeceÄŸi politikalar ÅŸunlardÄ±r:</summary>

**EriÅŸim YÃ¶netimi PolitikalarÄ±**

* **Alan kÄ±sÄ±tlamalÄ± kiÅŸiler:** Belirtilen alanlarÄ±nÄ±zÄ±n dÄ±ÅŸÄ±ndaki KullanÄ±cÄ±larÄ± Temel Ä°letiÅŸimlere eklemeyi engeller. Bu, Temel Ä°letiÅŸimlerin yalnÄ±zca seÃ§ilen alanlarÄ±nÄ±zdaki yÃ¶netilen kullanÄ±cÄ± kimliklerinin platform bildirimlerini almasÄ±na izin verir.
* **Alan kÄ±sÄ±tlamalÄ± paylaÅŸÄ±m:** Belirtilen alanlarÄ±nÄ±zÄ±n dÄ±ÅŸÄ±ndaki IAM politikalarÄ±na kullanÄ±cÄ± eklemeyi engeller. Bu, IAM politikalarÄ±nÄ±n yalnÄ±zca seÃ§ilen alanlarÄ±nÄ±zdaki yÃ¶netilen kullanÄ±cÄ± kimliklerinin bu organizasyondaki kaynaklara eriÅŸmesine izin vermesiyle sÄ±nÄ±rlÄ±dÄ±r.
* **Halka aÃ§Ä±k eriÅŸim Ã¶nleme:** Cloud Storage kovalarÄ±nÄ±n halka aÃ§Ä±lmasÄ±nÄ± engeller. Bu, bir geliÅŸtiricinin Cloud Storage kovalarÄ±nÄ± kimlik doÄŸrulamasÄ± yapÄ±lmamÄ±ÅŸ internet eriÅŸimine sahip olacak ÅŸekilde yapÄ±landÄ±rmasÄ±nÄ± engeller.
* **EÅŸit dÃ¼zeyde kova eriÅŸimi:** Cloud Storage kovalarÄ±nda nesne dÃ¼zeyinde eriÅŸim kontrol listelerini (ACL'ler) engeller. Bu, eriÅŸim yÃ¶netiminizi Cloud Storage kovalarÄ±ndaki tÃ¼m nesneler Ã¼zerinde IAM politikalarÄ±nÄ± tutarlÄ± bir ÅŸekilde uygulayarak basitleÅŸtirir.
* **OS giriÅŸini zorunlu kÄ±l:** Yeni projelerde oluÅŸturulan VM'lerde OS GiriÅŸi etkin olacaktÄ±r. Bu, SSH eriÅŸimini IAM kullanarak yÃ¶netmenizi saÄŸlar; bireysel SSH anahtarlarÄ± oluÅŸturup yÃ¶netmenize gerek kalmaz.

**Hizmet hesaplarÄ± iÃ§in ek gÃ¼venlik politikalarÄ±**

* **Otomatik IAM atamalarÄ±nÄ± devre dÄ±ÅŸÄ± bÄ±rak:** VarsayÄ±lan App Engine ve Compute Engine hizmet hesaplarÄ±nÄ±n oluÅŸturulurken projeye Editor IAM rolÃ¼ otomatik olarak verilmesini engeller. Bu, hizmet hesaplarÄ±nÄ±n oluÅŸturulurken aÅŸÄ±rÄ± izinli IAM rolleri almasÄ±nÄ± engeller.
* **Hizmet hesabÄ± anahtarÄ± oluÅŸturmayÄ± devre dÄ±ÅŸÄ± bÄ±rak:** Kamuya aÃ§Ä±k hizmet hesabÄ± anahtarlarÄ±nÄ±n oluÅŸturulmasÄ±nÄ± engeller. Bu, kalÄ±cÄ± kimlik bilgilerini aÃ§Ä±ÄŸa Ã§Ä±karma riskini azaltmaya yardÄ±mcÄ± olur.
* **Hizmet hesabÄ± anahtarÄ± yÃ¼klemeyi devre dÄ±ÅŸÄ± bÄ±rak:** Kamuya aÃ§Ä±k hizmet hesabÄ± anahtarlarÄ±nÄ±n yÃ¼klenmesini engeller. Bu, sÄ±zdÄ±rÄ±lan veya yeniden kullanÄ±lan anahtar materyali riskini azaltmaya yardÄ±mcÄ± olur.

**GÃ¼venli VPC aÄŸ yapÄ±landÄ±rma politikalarÄ±**

* **VM Ã¶rnekleri iÃ§in izin verilen dÄ±ÅŸ IP'leri tanÄ±mlayÄ±n:** Kamu IP'sine sahip Compute Ã¶rneklerinin oluÅŸturulmasÄ±nÄ± engeller; bu, onlarÄ± internet trafiÄŸine maruz bÄ±rakabilir.

<!---->

* **VM iÃ§ iÃ§e sanallaÅŸtÄ±rmayÄ± devre dÄ±ÅŸÄ± bÄ±rak:** Compute Engine VM'lerinde iÃ§ iÃ§e VM'lerin oluÅŸturulmasÄ±nÄ± engeller. Bu, izlenmeyen iÃ§ iÃ§e VM'lerin gÃ¼venlik riskini azaltÄ±r.

<!---->

* **VM seri portunu devre dÄ±ÅŸÄ± bÄ±rak:** Compute Engine VM'lerine seri port eriÅŸimini engeller. Bu, bir sunucunun seri portuna Compute Engine API'si kullanarak giriÅŸ yapÄ±lmasÄ±nÄ± engeller.

<!---->

* **Cloud SQL Ã¶rneklerinde yetkilendirilmiÅŸ aÄŸlarÄ± kÄ±sÄ±tla:** Kamuya aÃ§Ä±k veya dahili olmayan aÄŸ aralÄ±klarÄ±nÄ±n Cloud SQL veritabanlarÄ±nÄ±za eriÅŸmesini engeller.

<!---->

* **IP adresinin tÃ¼rÃ¼ne gÃ¶re Protokol YÃ¶nlendirmeyi kÄ±sÄ±tla:** DÄ±ÅŸ IP adresleri iÃ§in VM protokol yÃ¶nlendirmesini engeller.

<!---->

* **Cloud SQL Ã¶rneklerinde Kamu IP eriÅŸimini kÄ±sÄ±tla:** Kamu IP'sine sahip Cloud SQL Ã¶rneklerinin oluÅŸturulmasÄ±nÄ± engeller; bu, onlarÄ± internet trafiÄŸine maruz bÄ±rakabilir.

<!---->

* **PaylaÅŸÄ±lan VPC proje iptalini kÄ±sÄ±tla:** PaylaÅŸÄ±lan VPC ana projelerinin kazara silinmesini engeller.

<!---->

* **Yeni projeler iÃ§in dahili DNS ayarÄ±nÄ± Zonal DNS Sadece olarak ayarlayÄ±n:** Hizmet kullanÄ±labilirliÄŸini azaltan eski bir DNS ayarÄ±nÄ±n kullanÄ±lmasÄ±nÄ± engeller.

<!---->

* **VarsayÄ±lan aÄŸ oluÅŸturmayÄ± atla:** VarsayÄ±lan VPC aÄŸÄ±nÄ±n ve ilgili kaynaklarÄ±n otomatik olarak oluÅŸturulmasÄ±nÄ± engeller. Bu, aÅŸÄ±rÄ± izinli varsayÄ±lan gÃ¼venlik duvarÄ± kurallarÄ±nÄ± Ã¶nler.

<!---->

* **VPC DÄ±ÅŸ IPv6 kullanÄ±mÄ±nÄ± devre dÄ±ÅŸÄ± bÄ±rak:** Yetkisiz internet eriÅŸimine maruz kalabilecek dÄ±ÅŸ IPv6 alt aÄŸlarÄ±nÄ±n oluÅŸturulmasÄ±nÄ± engeller.

</details>

## **IAM Rolleri**

Bunlar, **her rolÃ¼n bir dizi izin iÃ§erdiÄŸi** AWS'deki IAM politikalarÄ±na benzer.

Ancak, AWS'deki gibi **merkezi bir rol deposu yoktur**. Bunun yerine, **kaynaklar Y'ye X eriÅŸim rolleri verir** ve bir kaynaÄŸa kimin eriÅŸimi olduÄŸunu Ã¶ÄŸrenmenin tek yolu, o kaynak Ã¼zerinde **`get-iam-policy` yÃ¶ntemini kullanmaktÄ±r**.\
Bu bir sorun olabilir Ã§Ã¼nkÃ¼ bu, bir ilkenin hangi izinlere sahip olduÄŸunu Ã¶ÄŸrenmenin tek yolunun, her kaynaÄŸa kimin izin verdiÄŸini sormak olduÄŸunu gÃ¶sterir ve bir kullanÄ±cÄ±nÄ±n tÃ¼m kaynaklardan izinleri alma yetkisi olmayabilir.

IAM'de **Ã¼Ã§ tÃ¼r** rol vardÄ±r:

* **Temel/Primitif roller**, **Sahip**, **DÃ¼zenleyici** ve **GÃ¶rÃ¼ntÃ¼leyici** rollerini iÃ§erir; bu roller IAM'Ä±n tanÄ±tÄ±lmasÄ±ndan Ã¶nce mevcuttu.
* **Ã–n tanÄ±mlÄ± roller**, belirli bir hizmet iÃ§in ayrÄ±ntÄ±lÄ± eriÅŸim saÄŸlar ve Google Cloud tarafÄ±ndan yÃ¶netilir. BirÃ§ok Ã¶n tanÄ±mlÄ± rol vardÄ±r; bunlarÄ±n **tÃ¼mÃ¼nÃ¼ sahip olduklarÄ± ayrÄ±calÄ±klarla birlikte** [**buradan**](https://cloud.google.com/iam/docs/understanding-roles#predefined_roles) gÃ¶rebilirsiniz.
* **Ã–zel roller**, kullanÄ±cÄ± tarafÄ±ndan belirtilen bir izin listesine gÃ¶re ayrÄ±ntÄ±lÄ± eriÅŸim saÄŸlar.

GCP'de binlerce izin vardÄ±r. Bir rolÃ¼n izinlere sahip olup olmadÄ±ÄŸÄ±nÄ± kontrol etmek iÃ§in [**buradan izin arayabilirsiniz**](https://cloud.google.com/iam/docs/permissions-reference) ve hangi rollerin buna sahip olduÄŸunu gÃ¶rebilirsiniz.

AyrÄ±ca, [**buradan Ã¶n tanÄ±mlÄ± rolleri**](https://cloud.google.com/iam/docs/understanding-roles#product_specific_documentation) **her Ã¼rÃ¼n tarafÄ±ndan sunulan** gÃ¶rebilirsiniz. BazÄ± **rollerin** kullanÄ±cÄ±lara eklenemeyeceÄŸini ve **yalnÄ±zca SA'lara eklenebileceÄŸini** unutmayÄ±n; Ã§Ã¼nkÃ¼ iÃ§erdiÄŸi bazÄ± izinler nedeniyle.\
AyrÄ±ca, **izinlerin** yalnÄ±zca **ilgili hizmete eklenmesi durumunda** **geÃ§erli olacaÄŸÄ±nÄ±** unutmayÄ±n.

Veya bir **Ã¶zel rolÃ¼n** [**belirli bir izni kullanÄ±p kullanamayacaÄŸÄ±nÄ± buradan kontrol edebilirsiniz**](https://cloud.google.com/iam/docs/custom-roles-permissions-support)**.**

{% content-ref url="../gcp-services/gcp-iam-and-org-policies-enum.md" %}
[gcp-iam-and-org-policies-enum.md](../gcp-services/gcp-iam-and-org-policies-enum.md)
{% endcontent-ref %}

## KullanÄ±cÄ±lar <a href="#default-credentials" id="default-credentials"></a>

**GCP konsolunda** **KullanÄ±cÄ±lar veya Gruplar** yÃ¶netimi yoktur; bu, **Google Workspace**'te yapÄ±lÄ±r. Ancak, Google Workspace'te farklÄ± bir kimlik saÄŸlayÄ±cÄ±sÄ±nÄ± senkronize edebilirsiniz.

Workspace **kullanÄ±cÄ±larÄ± ve gruplarÄ±na** [**https://admin.google.com**](https://admin.google.com/) adresinden eriÅŸebilirsiniz.

**MFA**, Workspace kullanÄ±cÄ±larÄ±na **zorunlu kÄ±lÄ±nabilir**, ancak bir **saldÄ±rgan**, GCP'ye **cli Ã¼zerinden eriÅŸmek iÃ§in bir token** kullanabilir; bu, MFA ile korunmayacaktÄ±r (sadece kullanÄ±cÄ± giriÅŸ yaptÄ±ÄŸÄ±nda oluÅŸturulurken MFA ile korunacaktÄ±r: `gcloud auth login`).

## Gruplar

Bir organizasyon oluÅŸturulduÄŸunda birkaÃ§ grup **oluÅŸturulmasÄ± ÅŸiddetle Ã¶nerilir.** EÄŸer bunlardan herhangi birini yÃ¶netiyorsanÄ±z, organizasyonun tamamÄ±nÄ± veya Ã¶nemli bir kÄ±smÄ±nÄ± tehlikeye atmÄ±ÅŸ olabilirsiniz:

<table data-header-hidden><thead><tr><th width="299.3076923076923"></th><th></th></tr></thead><tbody><tr><td><strong>Grup</strong></td><td><strong>Fonksiyon</strong></td></tr><tr><td><strong><code>gcp-organization-admins</code></strong><br><em>(kontrol listesi iÃ§in grup veya bireysel hesaplar gereklidir)</em></td><td>Organizasyona ait herhangi bir kaynaÄŸÄ± yÃ¶netmek. Bu rolÃ¼ dikkatli bir ÅŸekilde atayÄ±n; organizasyon yÃ¶neticileri, tÃ¼m Google Cloud kaynaklarÄ±nÄ±za eriÅŸim saÄŸlar. Alternatif olarak, bu iÅŸlev yÃ¼ksek ayrÄ±calÄ±klÄ± olduÄŸundan, bir grup oluÅŸturmak yerine bireysel hesaplar kullanmayÄ± dÃ¼ÅŸÃ¼nÃ¼n.</td></tr><tr><td><strong><code>gcp-network-admins</code></strong><br><em>(kontrol listesi iÃ§in gereklidir)</em></td><td>AÄŸlar, alt aÄŸlar, gÃ¼venlik duvarÄ± kurallarÄ± ve Cloud Router, Cloud VPN ve bulut yÃ¼k dengeleyicileri gibi aÄŸ cihazlarÄ± oluÅŸturma.</td></tr><tr><td><strong><code>gcp-billing-admins</code></strong><br><em>(kontrol listesi iÃ§in gereklidir)</em></td><td>Faturalama hesaplarÄ±nÄ± ayarlama ve kullanÄ±mÄ±nÄ± izleme.</td></tr><tr><td><strong><code>gcp-developers</code></strong><br><em>(kontrol listesi iÃ§in gereklidir)</em></td><td>UygulamalarÄ± tasarlama, kodlama ve test etme.</td></tr><tr><td><strong><code>gcp-security-admins</code></strong><br></td><td>TÃ¼m organizasyon iÃ§in eriÅŸim yÃ¶netimi ve <a href="https://cloud.google.com/resource-manager/docs/organization-policy/org-policy-constraints">organizasyon kÄ±sÄ±tlama politikalarÄ±</a> dahil olmak Ã¼zere gÃ¼venlik politikalarÄ±nÄ± oluÅŸturma ve yÃ¶netme. Google Cloud gÃ¼venlik altyapÄ±nÄ±zÄ± planlamak iÃ§in daha fazla bilgi iÃ§in <a href="https://cloud.google.com/architecture/security-foundations/authentication-authorization#users_and_groups">Google Cloud gÃ¼venlik temelleri kÄ±lavuzuna</a> bakÄ±n.</td></tr><tr><td><strong><code>gcp-devops</code></strong></td><td>SÃ¼rekli entegrasyon ve teslimatÄ±, izlemeyi ve sistem saÄŸlama sÃ¼reÃ§lerini destekleyen uÃ§tan uca boru hatlarÄ± oluÅŸturma veya yÃ¶netme.</td></tr><tr><td><strong><code>gcp-logging-admins</code></strong></td><td></td></tr><tr><td><strong><code>gcp-logging-viewers</code></strong></td><td></td></tr><tr><td><strong><code>gcp-monitor-admins</code></strong></td><td></td></tr><tr><td><strong><code>gcp-billing-viewer</code></strong><br><em>(artÄ±k varsayÄ±lan olarak yok)</em></td><td>Projelerdeki harcamalarÄ± izleme. Tipik Ã¼yeler finans ekibinin bir parÃ§asÄ±dÄ±r.</td></tr><tr><td><strong><code>gcp-platform-viewer</code></strong><br><em>(artÄ±k varsayÄ±lan olarak yok)</em></td><td>Google Cloud organizasyonu genelindeki kaynak bilgilerini gÃ¶zden geÃ§irme.</td></tr><tr><td><strong><code>gcp-security-reviewer</code></strong><br><em>(artÄ±k varsayÄ±lan olarak yok)</em></td><td>Bulut gÃ¼venliÄŸini gÃ¶zden geÃ§irme.</td></tr><tr><td><strong><code>gcp-network-viewer</code></strong><br><em>(artÄ±k varsayÄ±lan olarak yok)</em></td><td>AÄŸ yapÄ±landÄ±rmalarÄ±nÄ± gÃ¶zden geÃ§irme.</td></tr><tr><td><strong><code>grp-gcp-audit-viewer</code></strong><br><em>(artÄ±k varsayÄ±lan olarak yok)</em></td><td>Denetim gÃ¼nlÃ¼klerini gÃ¶rÃ¼ntÃ¼leme.</td></tr><tr><td><strong><code>gcp-scc-admin</code></strong><br><em>(artÄ±k varsayÄ±lan olarak yok)</em></td><td>GÃ¼venlik Komut Merkezi'ni yÃ¶netme.</td></tr><tr><td><strong><code>gcp-secrets-admin</code></strong><br><em>(artÄ±k varsayÄ±lan olarak yok)</em></td><td>Secret Manager'da gizli bilgileri yÃ¶netme.</td></tr></tbody></table>

## **VarsayÄ±lan Åifre PolitikasÄ±**

* GÃ¼Ã§lÃ¼ ÅŸifreleri zorunlu kÄ±l
* 8 ile 100 karakter arasÄ±nda
* Yeniden kullanÄ±m yok
* SÃ¼re sona erme yok
* EÄŸer insanlar Workspace'e Ã¼Ã§Ã¼ncÃ¼ taraf bir saÄŸlayÄ±cÄ± aracÄ±lÄ±ÄŸÄ±yla eriÅŸiyorsa, bu gereksinimler uygulanmaz.

<figure><img src="../../../.gitbook/assets/image (20).png" alt=""><figcaption></figcaption></figure>

<figure><img src="../../../.gitbook/assets/image (22).png" alt=""><figcaption></figcaption></figure>

## **Hizmet hesaplarÄ±**

Bunlar, **kaynaklarÄ±n** **baÄŸlÄ± olabileceÄŸi** ve GCP ile etkileÅŸimde bulunmayÄ± kolaylaÅŸtÄ±ran ilkelerdir. Ã–rneÄŸin, bir VM'ye **baÄŸlÄ± bir Hizmet HesabÄ±nÄ±n** **kimlik doÄŸrulama tokenine** metadata'da eriÅŸmek mÃ¼mkÃ¼ndÃ¼r.\
**IAM ve eriÅŸim kapsamlarÄ±nÄ±** kullanÄ±rken bazÄ± **Ã§eliÅŸkilerle** karÅŸÄ±laÅŸmak mÃ¼mkÃ¼ndÃ¼r. Ã–rneÄŸin, hizmet hesabÄ±nÄ±zÄ±n `compute.instanceAdmin` IAM rolÃ¼ olabilir, ancak ihlal ettiÄŸiniz Ã¶rnek, `https://www.googleapis.com/auth/compute.readonly` kapsam kÄ±sÄ±tlamasÄ± ile sÄ±nÄ±rlÄ± olabilir. Bu, Ã¶rneÄŸinize otomatik olarak atanan OAuth tokenini kullanarak herhangi bir deÄŸiÅŸiklik yapmanÄ±zÄ± engeller.

Bu, **AWS'deki IAM rollerine** benzer. Ancak AWS'deki gibi, **herhangi bir** hizmet hesabÄ± **herhangi bir hizmete** **baÄŸlanabilir** (bir politika aracÄ±lÄ±ÄŸÄ±yla izin vermesi gerekmez).

BulacaÄŸÄ±nÄ±z birÃ§ok hizmet hesabÄ± aslÄ±nda bir hizmet kullanmaya baÅŸladÄ±ÄŸÄ±nÄ±zda **GCP tarafÄ±ndan otomatik olarak oluÅŸturulur**, Ã¶rneÄŸin:
```
PROJECT_NUMBER-compute@developer.gserviceaccount.com
PROJECT_ID@appspot.gserviceaccount.com
```
Ancak, **Ã¶zel hizmet hesaplarÄ±** oluÅŸturmak ve bunlara eklemek de mÃ¼mkÃ¼ndÃ¼r, bu da ÅŸÃ¶yle gÃ¶rÃ¼necektir:
```
SERVICE_ACCOUNT_NAME@PROJECT_NAME.iam.gserviceaccount.com
```
### **Anahtarlar & Tokenlar**

GCP'ye bir hizmet hesabÄ± olarak eriÅŸmenin 2 ana yolu vardÄ±r:

* **OAuth tokenlarÄ± aracÄ±lÄ±ÄŸÄ±yla**: Bunlar, metadata uÃ§ noktalarÄ± gibi yerlerden veya http isteklerini Ã§alarak elde edeceÄŸiniz tokenlardÄ±r ve **eriÅŸim kapsamlarÄ±** ile sÄ±nÄ±rlÄ±dÄ±r.
* **Anahtarlar**: Bunlar, hizmet hesabÄ± olarak istekleri imzalamanÄ±za ve hatta hizmet hesabÄ± olarak eylemler gerÃ§ekleÅŸtirmek iÃ§in OAuth tokenlarÄ± oluÅŸturmanÄ±za olanak tanÄ±yan genel ve Ã¶zel anahtar Ã§iftleridir. Bu anahtarlar tehlikelidir Ã§Ã¼nkÃ¼ sÄ±nÄ±rlamak ve kontrol etmek daha karmaÅŸÄ±ktÄ±r, bu yÃ¼zden GCP bunlarÄ± oluÅŸturmanÄ±zÄ± Ã¶nermemektedir.
* Her seferinde bir SA oluÅŸturulduÄŸunda, **GCP hizmet hesabÄ± iÃ§in bir anahtar oluÅŸturur** ve kullanÄ±cÄ± bu anahtara eriÅŸemez (ve web uygulamasÄ±nda listelenmez). [**bu baÅŸlÄ±ÄŸa**](https://www.reddit.com/r/googlecloud/comments/f0ospy/service\_account\_keys\_observations/) gÃ¶re bu anahtar, **GCP tarafÄ±ndan dahili olarak** eriÅŸilebilir OAuth tokenlarÄ± oluÅŸturmak iÃ§in metadata uÃ§ noktalarÄ±na eriÅŸim vermek amacÄ±yla kullanÄ±lmaktadÄ±r.

### **EriÅŸim KapsamlarÄ±**

EriÅŸim kapsamlarÄ±, GCP API uÃ§ noktalarÄ±na eriÅŸmek iÃ§in **oluÅŸturulan OAuth tokenlarÄ±na eklenir**. Bunlar, OAuth tokenÄ±nÄ±n **izinlerini kÄ±sÄ±tlar**.\
Bu, bir token bir kaynaÄŸÄ±n sahibi olsa bile, token kapsamÄ± o kaynaÄŸa eriÅŸim izni vermiyorsa, tokenÄ±n **bu ayrÄ±calÄ±klarÄ± (suistimal) kullanmak iÃ§in kullanÄ±lamayacaÄŸÄ±** anlamÄ±na gelir.

Google aslÄ±nda [Ã¶nerir](https://cloud.google.com/compute/docs/access/service-accounts#service\_account\_permissions) ki **eriÅŸim kapsamlarÄ± kullanÄ±lmasÄ±n ve tamamen IAM'e gÃ¼venilsin**. Web yÃ¶netim portalÄ± aslÄ±nda bunu zorunlu kÄ±lar, ancak eriÅŸim kapsamlarÄ± yine de Ã¶zel hizmet hesaplarÄ± kullanÄ±larak programlÄ± olarak Ã¶rneklere uygulanabilir.

Hangi **kapsamlarÄ±n** **atanmÄ±ÅŸ olduÄŸunu** **sorgulayarak** gÃ¶rebilirsiniz:

{% code overflow="wrap" %}
```bash
curl 'https://www.googleapis.com/oauth2/v1/tokeninfo?access_token=<access_token>'

{
"issued_to": "223044615559.apps.googleusercontent.com",
"audience": "223044615559.apps.googleusercontent.com",
"user_id": "139746512919298469201",
"scope": "openid https://www.googleapis.com/auth/userinfo.email https://www.googleapis.com/auth/cloud-platform https://www.googleapis.com/auth/appengine.admin https://www.googleapis.com/auth/sqlservice.login https://www.googleapis.com/auth/compute https://www.googleapis.com/auth/accounts.reauth",
"expires_in": 2253,
"email": "username@testing.com",
"verified_email": true,
"access_type": "offline"
}
```
{% endcode %}

Ã–nceki **scopes**, veriye eriÅŸmek iÃ§in **`gcloud`** kullanÄ±larak **varsayÄ±lan** olarak oluÅŸturulanlardÄ±r. Bunun nedeni, **`gcloud`** kullandÄ±ÄŸÄ±nÄ±zda Ã¶nce bir OAuth token'Ä± oluÅŸturmanÄ±z ve ardÄ±ndan bunu uÃ§ noktalarla iletiÅŸim kurmak iÃ§in kullanmanÄ±zdÄ±r.

Bu potansiyel **scopes** arasÄ±nda en Ã¶nemli olanÄ± **`cloud-platform`**'dur; bu, GCP'deki **herhangi bir hizmete eriÅŸmenin** mÃ¼mkÃ¼n olduÄŸu anlamÄ±na gelir.

**Burada** [**tÃ¼m olasÄ± scopes listesini bulabilirsiniz**](https://developers.google.com/identity/protocols/googlescopes)**.**

EÄŸer **`gcloud`** tarayÄ±cÄ± kimlik bilgilerine sahipseniz, **diÄŸer scopes ile bir token elde etmek** mÃ¼mkÃ¼ndÃ¼r; bunu ÅŸÃ¶yle yapabilirsiniz: 

{% code overflow="wrap" %}
```bash
# Maybe you can get a user token with other scopes changing the scopes array from ~/.config/gcloud/credentials.db

# Set new scopes for SDKs credentials
gcloud auth application-default login --scopes=https://www.googleapis.com/auth/userinfo.email,https://www.googleapis.com/auth/cloud-platform,https://www.googleapis.com/auth/sqlservice.login,https://www.googleapis.com/auth/appengine.admin,https://www.googleapis.com/auth/compute,https://www.googleapis.com/auth/accounts.reauth,https://www.googleapis.com/auth/admin.directory.user,https://www.googleapis.com/auth/admin.directory.group,https://www.googleapis.com/auth/admin.directory.domain,https://www.googleapis.com/auth/admin.directory.user

# Print new token
gcloud auth application-default print-access-token

# To use this token with some API you might need to use curl to indicate the project header with --header "X-Goog-User-Project: <project-name>"
```
{% endcode %}

## **Terraform IAM PolitikalarÄ±, BaÄŸlantÄ±lar ve Ãœyelikler**

Terraform tarafÄ±ndan tanÄ±mlandÄ±ÄŸÄ± gibi [https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/google\_project\_iam](https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/google\_project\_iam) GCP ile terraform kullanarak bir kaynaÄŸa eriÅŸim vermenin farklÄ± yollarÄ± vardÄ±r:

* **Ãœyelikler**: **Prensipleri rollerin Ã¼yeleri olarak** **kÄ±sÄ±tlama olmaksÄ±zÄ±n** belirlersiniz. Bir kullanÄ±cÄ±yÄ± bir rolÃ¼n Ã¼yesi olarak koyabilir ve ardÄ±ndan aynÄ± rolÃ¼n bir Ã¼yesi olarak bir grubu koyabilir ve ayrÄ±ca bu prensipleri (kullanÄ±cÄ± ve grup) diÄŸer rollerin Ã¼yesi olarak ayarlayabilirsiniz.
* **BaÄŸlantÄ±lar**: Birden fazla **prensip bir role baÄŸlanabilir**. Bu **prensipler hala diÄŸer rollerin Ã¼yeleri veya baÄŸlanmÄ±ÅŸ olabilir**. Ancak, bir role baÄŸlÄ± olmayan bir prensip **baÄŸlÄ± bir rolÃ¼n Ã¼yesi** olarak ayarlandÄ±ÄŸÄ±nda, **baÄŸlantÄ± uygulandÄ±ÄŸÄ±nda, Ã¼yelik kaybolur**.
* **Politikalar**: Bir politika **otoritativdir**, roller ve prensipleri belirtir ve ardÄ±ndan, **bu prensiplerin daha fazla rolÃ¼ olamaz ve bu rollerin daha fazla prensibi olamaz**, bu politika deÄŸiÅŸtirilmedikÃ§e (diÄŸer politikalar, baÄŸlantÄ±lar veya Ã¼yeliklerde bile deÄŸil). Bu nedenle, bir rol veya prensip politika iÃ§inde belirtildiÄŸinde, tÃ¼m ayrÄ±calÄ±klarÄ± **o politika ile sÄ±nÄ±rlÄ±dÄ±r**. AÃ§Ä±kÃ§a, bu, prensibe politikanÄ±n deÄŸiÅŸtirilmesi veya ayrÄ±calÄ±k yÃ¼kseltme izinleri (yeni bir prensip oluÅŸturmak ve ona yeni bir rol baÄŸlamak gibi) verilmesi durumunda aÅŸÄ±labilir.

## Referanslar

* [https://about.gitlab.com/blog/2020/02/12/plundering-gcp-escalating-privileges-in-google-cloud-platform/](https://about.gitlab.com/blog/2020/02/12/plundering-gcp-escalating-privileges-in-google-cloud-platform/)
* [https://cloud.google.com/resource-manager/docs/cloud-platform-resource-hierarchy](https://cloud.google.com/resource-manager/docs/cloud-platform-resource-hierarchy)

{% hint style="success" %}
AWS Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n:<img src="../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">\
GCP Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**abonelik planlarÄ±nÄ±**](https://github.com/sponsors/carlospolop) kontrol edin!
* **ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n veya **Twitter'da** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** bizi takip edin.**
* **Hacking ipuÃ§larÄ±nÄ± paylaÅŸmak iÃ§in** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna PR gÃ¶nderin.

</details>
{% endhint %}
