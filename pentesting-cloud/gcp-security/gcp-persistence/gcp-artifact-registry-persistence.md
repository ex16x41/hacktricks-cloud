# GCP - Artifact Registry Persistence

{% hint style="success" %}
AWS Hacking'i öğrenin ve pratik yapın:<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
GCP Hacking'i öğrenin ve pratik yapın: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**abonelik planlarını**](https://github.com/sponsors/carlospolop) kontrol edin!
* **💬 [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katılın ya da **Twitter**'da **bizi takip edin** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Hacking ipuçlarını paylaşmak için** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna PR gönderin.

</details>
{% endhint %}

## Artifact Registry

Artifact Registry hakkında daha fazla bilgi için kontrol edin:

{% content-ref url="../gcp-services/gcp-artifact-registry-enum.md" %}
[gcp-artifact-registry-enum.md](../gcp-services/gcp-artifact-registry-enum.md)
{% endcontent-ref %}

### Bağımlılık Karışıklığı

* **Uzak ve standart** depolar **sanaldaki** bir depoda karıştırılırsa ve her ikisinde de bir paket varsa ne olur?
* **Sanal depoda en yüksek önceliğe sahip olan** kullanılır
* Eğer **öncelik aynıysa**:
* Eğer **sürüm** **aynıysa**, sanal depodaki **politika adı alfabetik olarak** önce gelir
* Eğer değilse, **en yüksek sürüm** kullanılır

{% hint style="danger" %}
Bu nedenle, eğer uzak depo daha yüksek veya aynı önceliğe sahipse, bir kamu paket kayıt defterinde **en yüksek sürümün (bağımlılık karışıklığı) kötüye kullanılması** mümkündür.
{% endhint %}

Bu teknik, **kalıcılık** ve **kimlik doğrulaması yapılmamış erişim** için yararlı olabilir; çünkü bunu kötüye kullanmak için sadece Artifact Registry'de saklanan bir **kütüphane adını bilmek** ve **aynı kütüphaneyi kamu deposunda (örneğin Python için PyPi)** daha yüksek bir sürümle oluşturmak gerekir.

Kalıcılık için takip etmeniz gereken adımlar şunlardır:

* **Gereksinimler**: Bir **sanal depo** **var olmalı** ve kullanılmalı, **kamu deposunda** mevcut olmayan bir **isim** ile bir **iç paket** kullanılmalıdır.
* Eğer yoksa bir uzak depo oluşturun
* Uzak depoyu sanal depoya ekleyin
* Uzak depoya daha yüksek (veya aynı) öncelik vermek için sanal kayıt defterinin politikalarını düzenleyin.\
Şu şekilde bir şey çalıştırın:
* [gcloud artifacts repositories update --upstream-policy-file ...](https://cloud.google.com/sdk/gcloud/reference/artifacts/repositories/update#--upstream-policy-file)
* Meşru paketi indirin, kötü niyetli kodunuzu ekleyin ve aynı sürümle kamu deposuna kaydedin. Her seferinde bir geliştirici bunu yüklediğinde, sizin paketiniz yüklenmiş olacak!

Bağımlılık karışıklığı hakkında daha fazla bilgi için kontrol edin:

{% embed url="https://book.hacktricks.xyz/pentesting-web/dependency-confusion" %}

{% hint style="success" %}
AWS Hacking'i öğrenin ve pratik yapın:<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
GCP Hacking'i öğrenin ve pratik yapın: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**abonelik planlarını**](https://github.com/sponsors/carlospolop) kontrol edin!
* **💬 [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katılın ya da **Twitter**'da **bizi takip edin** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Hacking ipuçlarını paylaşmak için** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna PR gönderin.

</details>
{% endhint %}
