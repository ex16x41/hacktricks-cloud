# GCP - ç†è§£åŸŸèŒƒå›´å§”æ‰˜

{% hint style="success" %}
å­¦ä¹ å¹¶ç»ƒä¹ AWS Hackingï¼š<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks åŸ¹è®­ AWS çº¢é˜Ÿä¸“å®¶ (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
å­¦ä¹ å¹¶ç»ƒä¹ GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks åŸ¹è®­ GCP çº¢é˜Ÿä¸“å®¶ (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>æ”¯æŒ HackTricks</summary>

* æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**ç”µæŠ¥ç¾¤ç»„**](https://t.me/peass) æˆ– **å…³æ³¨**æˆ‘ä»¬çš„ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* é€šè¿‡å‘ [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ä»“åº“æäº¤ PR æ¥åˆ†äº«é»‘å®¢æŠ€å·§ã€‚

</details>
{% endhint %}

è¿™ç¯‡æ–‡ç« æ˜¯å…³äº[https://www.hunters.security/en/blog/delefriend-a-newly-discovered-design-flaw-in-domain-wide-delegation-could-leave-google-workspace-vulnerable-for-takeover](https://www.hunters.security/en/blog/delefriend-a-newly-discovered-design-flaw-in-domain-wide-delegation-could-leave-google-workspace-vulnerable-for-takeover)çš„ä»‹ç»ï¼Œå¯ä»¥è®¿é—®è·å–æ›´å¤šè¯¦ç»†ä¿¡æ¯ã€‚

## **ç†è§£åŸŸèŒƒå›´å§”æ‰˜**

Google Workspace çš„åŸŸèŒƒå›´å§”æ‰˜å…è®¸ä¸€ä¸ªèº«ä»½å¯¹è±¡ï¼Œå¯ä»¥æ˜¯æ¥è‡ª Google Workspace Marketplace çš„**å¤–éƒ¨åº”ç”¨**ï¼Œä¹Ÿå¯ä»¥æ˜¯å†…éƒ¨çš„**GCP æœåŠ¡è´¦å·**ï¼Œä»£è¡¨ç”¨æˆ·**è·¨ Workspace è®¿é—®æ•°æ®**ã€‚è¿™ä¸ªåŠŸèƒ½å¯¹äºä¸ Google API äº¤äº’çš„åº”ç”¨æˆ–éœ€è¦ç”¨æˆ·æ¨¡æ‹Ÿçš„æœåŠ¡è‡³å…³é‡è¦ï¼Œé€šè¿‡è‡ªåŠ¨åŒ–ä»»åŠ¡æé«˜æ•ˆç‡å¹¶å‡å°‘äººä¸ºé”™è¯¯ã€‚ä½¿ç”¨ OAuth 2.0ï¼Œåº”ç”¨å¼€å‘äººå‘˜å’Œç®¡ç†å‘˜å¯ä»¥ä¸ºè¿™äº›æœåŠ¡è´¦å·æˆäºˆå¯¹ç”¨æˆ·æ•°æ®çš„è®¿é—®æƒé™ï¼Œè€Œæ— éœ€å•ç‹¬ç”¨æˆ·åŒæ„ã€‚

Google Workspace å…è®¸åˆ›å»ºä¸¤ç§ä¸»è¦ç±»å‹çš„å…¨å±€å§”æ‰˜å¯¹è±¡èº«ä»½ï¼š

* **GWS åº”ç”¨ç¨‹åºï¼š** Workspace Marketplace ä¸­çš„åº”ç”¨ç¨‹åºå¯ä»¥è®¾ç½®ä¸ºå§”æ‰˜èº«ä»½ã€‚åœ¨ä¸Šæ¶å¸‚åœºä¹‹å‰ï¼Œæ¯ä¸ª Workspace åº”ç”¨ç¨‹åºéƒ½ç»è¿‡ Google çš„å®¡æ ¸ï¼Œä»¥æœ€å°åŒ–æ½œåœ¨çš„æ»¥ç”¨ã€‚è™½ç„¶è¿™å¹¶ä¸èƒ½å®Œå…¨æ¶ˆé™¤æ»¥ç”¨çš„é£é™©ï¼Œä½†æ˜¾è‘—å¢åŠ äº†æ­¤ç±»äº‹ä»¶å‘ç”Ÿçš„éš¾åº¦ã€‚
* **GCP æœåŠ¡è´¦å·ï¼š** äº†è§£æ›´å¤šå…³äº[**GCP æœåŠ¡è´¦å·çš„ä¿¡æ¯**](../gcp-basic-information/#service-accounts)ã€‚

### **åŸŸèŒƒå›´å§”æ‰˜ï¼šå†…éƒ¨åŸç†**

è¿™æ˜¯ GCP æœåŠ¡è´¦å·å¦‚ä½•ä»£è¡¨ Google Workspace ä¸­çš„å…¶ä»–èº«ä»½è®¿é—® Google API çš„è¿‡ç¨‹ï¼š

<figure><img src="../../../.gitbook/assets/image (58).png" alt=""><figcaption></figcaption></figure>

1. **èº«ä»½åˆ›å»º JWTï¼š** èº«ä»½ä½¿ç”¨æœåŠ¡è´¦å·çš„ç§é’¥ï¼ˆJSON å¯†é’¥å¯¹æ–‡ä»¶çš„ä¸€éƒ¨åˆ†ï¼‰ç­¾ç½² JWTã€‚æ­¤ JWT åŒ…å«æœ‰å…³æœåŠ¡è´¦å·ã€è¦æ¨¡æ‹Ÿçš„ç›®æ ‡ç”¨æˆ·ä»¥åŠæ­£åœ¨è¯·æ±‚çš„ REST API çš„ OAuth è®¿é—®èŒƒå›´çš„å£°æ˜ã€‚
2. **èº«ä»½ä½¿ç”¨ JWT è¯·æ±‚è®¿é—®ä»¤ç‰Œï¼š** åº”ç”¨ç¨‹åº/ç”¨æˆ·ä½¿ç”¨ JWT ä» Google çš„ OAuth 2.0 æœåŠ¡è¯·æ±‚è®¿é—®ä»¤ç‰Œã€‚è¯·æ±‚è¿˜åŒ…æ‹¬è¦æ¨¡æ‹Ÿçš„ç›®æ ‡ç”¨æˆ·ï¼ˆç”¨æˆ·çš„ Workspace ç”µå­é‚®ä»¶ï¼‰ä»¥åŠè¯·æ±‚è®¿é—®æƒé™çš„èŒƒå›´ã€‚
3. **Google çš„ OAuth 2.0 æœåŠ¡è¿”å›è®¿é—®ä»¤ç‰Œï¼š** è®¿é—®ä»¤ç‰Œä»£è¡¨æœåŠ¡è´¦å·ä»£è¡¨ç”¨æˆ·æ‰§è¡ŒæŒ‡å®šèŒƒå›´æ“ä½œçš„æƒé™ã€‚æ­¤ä»¤ç‰Œé€šå¸¸æ˜¯çŸ­æš‚çš„ï¼Œå¿…é¡»æ ¹æ®åº”ç”¨ç¨‹åºçš„éœ€è¦å®šæœŸåˆ·æ–°ã€‚é‡è¦çš„æ˜¯è¦ç†è§£ JWT ä»¤ç‰Œä¸­æŒ‡å®šçš„ OAuth è®¿é—®èŒƒå›´å¯¹ç”Ÿæˆçš„è®¿é—®ä»¤ç‰Œçš„æœ‰æ•ˆæ€§å’Œå½±å“ã€‚ä¾‹å¦‚ï¼Œå…·æœ‰å¤šä¸ªèŒƒå›´çš„è®¿é—®ä»¤ç‰Œå°†å¯¹å¤šä¸ª REST API åº”ç”¨ç¨‹åºå…·æœ‰æœ‰æ•ˆæ€§ã€‚
4. **èº«ä»½ä½¿ç”¨è®¿é—®ä»¤ç‰Œè°ƒç”¨ Google APIï¼š** ç°åœ¨å…·æœ‰ç›¸å…³è®¿é—®ä»¤ç‰Œï¼ŒæœåŠ¡å¯ä»¥è®¿é—®æ‰€éœ€çš„ REST APIã€‚åº”ç”¨ç¨‹åºå°†æ­¤è®¿é—®ä»¤ç‰Œç”¨äºå…¶å‘é€è‡³ Google API çš„ HTTP è¯·æ±‚çš„â€œAuthorizationâ€æ ‡å¤´ã€‚è¿™äº› API åˆ©ç”¨ä»¤ç‰ŒéªŒè¯è¢«æ¨¡æ‹Ÿçš„èº«ä»½ï¼Œå¹¶ç¡®è®¤å…¶å…·æœ‰å¿…è¦çš„æˆæƒã€‚
5. **Google API è¿”å›è¯·æ±‚çš„æ•°æ®ï¼š** å¦‚æœè®¿é—®ä»¤ç‰Œæœ‰æ•ˆä¸”æœåŠ¡è´¦å·å…·æœ‰é€‚å½“çš„æˆæƒï¼ŒGoogle API å°†è¿”å›è¯·æ±‚çš„æ•°æ®ã€‚ä¾‹å¦‚ï¼Œåœ¨ä¸‹å›¾ä¸­ï¼Œæˆ‘ä»¬åˆ©ç”¨äº† _users.messages.list_ æ–¹æ³•åˆ—å‡ºäº†ä¸ç›®æ ‡ Workspace ç”¨æˆ·å…³è”çš„æ‰€æœ‰ Gmail æ¶ˆæ¯ IDã€‚

{% hint style="success" %}
å­¦ä¹ å¹¶ç»ƒä¹ AWS Hackingï¼š<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks åŸ¹è®­ AWS çº¢é˜Ÿä¸“å®¶ (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
å­¦ä¹ å¹¶ç»ƒä¹ GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks åŸ¹è®­ GCP çº¢é˜Ÿä¸“å®¶ (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>æ”¯æŒ HackTricks</summary>

* æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**ç”µæŠ¥ç¾¤ç»„**](https://t.me/peass) æˆ– **å…³æ³¨**æˆ‘ä»¬çš„ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* é€šè¿‡å‘ [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ä»“åº“æäº¤ PR æ¥åˆ†äº«é»‘å®¢æŠ€å·§ã€‚

</details>
{% endhint %}
