# GCP - Domain-Wide Delegation'Ä± Anlamak

{% hint style="success" %}
AWS Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n:<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
GCP Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**abonelik planlarÄ±nÄ±**](https://github.com/sponsors/carlospolop) kontrol edin!
* **ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n ya da **Twitter**'da **bizi takip edin** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Hacking ipuÃ§larÄ±nÄ± paylaÅŸmak iÃ§in** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna PR gÃ¶nderin.

</details>
{% endhint %}

Bu gÃ¶nderi, daha fazla ayrÄ±ntÄ± iÃ§in eriÅŸilebilen [https://www.hunters.security/en/blog/delefriend-a-newly-discovered-design-flaw-in-domain-wide-delegation-could-leave-google-workspace-vulnerable-for-takeover](https://www.hunters.security/en/blog/delefriend-a-newly-discovered-design-flaw-in-domain-wide-delegation-could-leave-google-workspace-vulnerable-for-takeover) baÄŸlantÄ±sÄ±nÄ±n tanÄ±tÄ±mÄ±dÄ±r.

## **Domain-Wide Delegation'Ä± Anlamak**

Google Workspace'in Domain-Wide delegasyonu, bir kimlik nesnesinin, ya bir **harici uygulama** ya da bir iÃ§ **GCP Service Account** aracÄ±lÄ±ÄŸÄ±yla, **kullanÄ±cÄ±lar adÄ±na Workspace'teki verilere eriÅŸmesine** olanak tanÄ±r. Bu Ã¶zellik, Google API'leri veya kullanÄ±cÄ± taklidi gerektiren hizmetlerle etkileÅŸimde bulunan uygulamalar iÃ§in kritik Ã¶neme sahiptir, gÃ¶revleri otomatikleÅŸtirerek verimliliÄŸi artÄ±rÄ±r ve insan hatalarÄ±nÄ± en aza indirir. OAuth 2.0 kullanarak, uygulama geliÅŸtiricileri ve yÃ¶neticileri, bu hizmet hesaplarÄ±na bireysel kullanÄ±cÄ± onayÄ± olmadan kullanÄ±cÄ± verilerine eriÅŸim verebilir.\
\
Google Workspace, iki ana tÃ¼rde kÃ¼resel devredilmiÅŸ nesne kimlikleri oluÅŸturulmasÄ±na izin verir:

* **GWS UygulamalarÄ±:** Workspace Marketplace'ten uygulamalar, devredilmiÅŸ bir kimlik olarak ayarlanabilir. Her Workspace uygulamasÄ±, potansiyel kÃ¶tÃ¼ye kullanÄ±mÄ± en aza indirmek iÃ§in pazara sunulmadan Ã¶nce Google tarafÄ±ndan gÃ¶zden geÃ§irilir. Bu, kÃ¶tÃ¼ye kullanÄ±m riskini tamamen ortadan kaldÄ±rmasa da, bu tÃ¼r olaylarÄ±n gerÃ§ekleÅŸmesini Ã¶nemli Ã¶lÃ§Ã¼de zorlaÅŸtÄ±rÄ±r.
* **GCP Service Account:** [**GCP Service Accounts hakkÄ±nda daha fazla bilgi edinin**](../gcp-basic-information/#service-accounts).

### **Domain-Wide Delegation: Arkada Neler Oluyor**

Bir GCP Service Account'Ä±n Google API'lerine diÄŸer kimlikler adÄ±na nasÄ±l eriÅŸebileceÄŸi:

<figure><img src="../../../.gitbook/assets/image (58).png" alt=""><figcaption></figcaption></figure>

1. **Kimlik bir JWT oluÅŸturur:** Kimlik, bir JWT'yi imzalamak iÃ§in hizmet hesabÄ±nÄ±n Ã¶zel anahtarÄ±nÄ± (JSON anahtar Ã§ift dosyasÄ±nÄ±n bir parÃ§asÄ±) kullanÄ±r. Bu JWT, hizmet hesabÄ±, taklit edilecek hedef kullanÄ±cÄ± ve talep edilen REST API'ye eriÅŸim iÃ§in OAuth kapsamlarÄ± hakkÄ±nda iddialar iÃ§erir.
2. **Kimlik, eriÅŸim token'Ä± talep etmek iÃ§in JWT'yi kullanÄ±r:** Uygulama/kullanÄ±cÄ±, Google'Ä±n OAuth 2.0 hizmetinden bir eriÅŸim token'Ä± talep etmek iÃ§in JWT'yi kullanÄ±r. Talep ayrÄ±ca taklit edilecek hedef kullanÄ±cÄ±yÄ± (kullanÄ±cÄ±nÄ±n Workspace e-posta adresi) ve eriÅŸim talep edilen kapsamlarÄ± iÃ§erir.
3. **Google'Ä±n OAuth 2.0 hizmeti bir eriÅŸim token'Ä± dÃ¶ner:** EriÅŸim token'Ä±, belirtilen kapsamlar iÃ§in kullanÄ±cÄ± adÄ±na hareket etme yetkisini temsil eder. Bu token genellikle kÄ±sa Ã¶mÃ¼rlÃ¼dÃ¼r ve periyodik olarak yenilenmesi gerekir (uygulamanÄ±n ihtiyacÄ±na gÃ¶re). JWT token'Ä±nda belirtilen OAuth kapsamlarÄ±nÄ±n geÃ§erliliÄŸi ve sonuÃ§ta elde edilen eriÅŸim token'Ä± Ã¼zerindeki etkisi Ã¶nemlidir. Ã–rneÄŸin, birden fazla kapsamÄ± olan eriÅŸim token'larÄ±, birÃ§ok REST API uygulamasÄ± iÃ§in geÃ§erlilik taÅŸÄ±r.
4. **Kimlik, Google API'lerini Ã§aÄŸÄ±rmak iÃ§in eriÅŸim token'Ä±nÄ± kullanÄ±r:** Åimdi ilgili bir eriÅŸim token'Ä± ile, hizmet gerekli REST API'ye eriÅŸebilir. Uygulama, bu eriÅŸim token'Ä±nÄ± Google API'lerine yÃ¶nelik HTTP isteklerinin "Authorization" baÅŸlÄ±ÄŸÄ±nda kullanÄ±r. Bu API'ler, token'Ä± taklit edilen kimliÄŸi doÄŸrulamak ve gerekli yetkilendirmeye sahip olduÄŸunu onaylamak iÃ§in kullanÄ±r.
5. **Google API'leri talep edilen verileri dÃ¶ner:** EriÅŸim token'Ä± geÃ§erliyse ve hizmet hesabÄ± uygun yetkilendirmeye sahipse, Google API'leri talep edilen verileri dÃ¶ner. Ã–rneÄŸin, aÅŸaÄŸÄ±daki resimde, hedef Workspace kullanÄ±cÄ±sÄ±yla iliÅŸkili tÃ¼m Gmail mesaj kimliklerini listelemek iÃ§in _users.messages.list_ yÃ¶ntemini kullandÄ±k.

{% hint style="success" %}
AWS Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n:<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
GCP Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**abonelik planlarÄ±nÄ±**](https://github.com/sponsors/carlospolop) kontrol edin!
* **ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n ya da **Twitter**'da **bizi takip edin** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Hacking ipuÃ§larÄ±nÄ± paylaÅŸmak iÃ§in** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna PR gÃ¶nderin.

</details>
{% endhint %}
