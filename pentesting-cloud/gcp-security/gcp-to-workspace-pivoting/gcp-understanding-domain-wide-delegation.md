# GCP - Alan GeniÅŸ Delegasyonun AnlaÅŸÄ±lmasÄ±

{% hint style="success" %}
AWS Hacking'i Ã¶ÄŸrenin ve uygulayÄ±n: <img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks EÄŸitim AWS KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ± (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCP Hacking'i Ã¶ÄŸrenin ve uygulayÄ±n: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks EÄŸitim GCP KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ± (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**Abonelik planlarÄ±nÄ±**](https://github.com/sponsors/carlospolop) kontrol edin!
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) katÄ±lÄ±n veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n veya bizi **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** takip edin.**
* **Hacking pÃ¼f noktalarÄ±nÄ± paylaÅŸarak PR'ler gÃ¶ndererek** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na katkÄ±da bulunun.

</details>
{% endhint %}

Bu yazÄ±, daha fazla ayrÄ±ntÄ± iÃ§in eriÅŸilebilen [https://www.hunters.security/en/blog/delefriend-a-newly-discovered-design-flaw-in-domain-wide-delegation-could-leave-google-workspace-vulnerable-for-takeover](https://www.hunters.security/en/blog/delefriend-a-newly-discovered-design-flaw-in-domain-wide-delegation-could-leave-google-workspace-vulnerable-for-takeover) adresindeki [https://www.hunters.security/en/blog/delefriend-a-newly-discovered-design-flaw-in-domain-wide-delegation-could-leave-google-workspace-vulnerable-for-takeover](https://www.hunters.security/en/blog/delefriend-a-newly-discovered-design-flaw-in-domain-wide-delegation-could-leave-google-workspace-vulnerable-for-takeover) adresindeki giriÅŸ yazÄ±sÄ±dÄ±r.

## **Alan GeniÅŸ Delegasyonunun AnlaÅŸÄ±lmasÄ±**

Google Workspace'in Alan GeniÅŸ Delegasyonu, bir **harici uygulama** (Google Workspace Marketplace'den) veya bir iÃ§ **GCP Hizmet HesabÄ±** olmak Ã¼zere bir kimlik nesnesinin, kullanÄ±cÄ±lar adÄ±na Workspace Ã¼zerindeki verilere **eriÅŸmesine izin verir**. Google API'leri ile etkileÅŸim kuran uygulamalar veya kullanÄ±cÄ± taklitine ihtiyaÃ§ duyan hizmetler iÃ§in hayati olan bu Ã¶zellik, gÃ¶revleri otomatikleÅŸtirerek verimliliÄŸi artÄ±rÄ±r ve insan hatalarÄ±nÄ± en aza indirir. OAuth 2.0 kullanarak, uygulama geliÅŸtiricileri ve yÃ¶neticiler, bu hizmet hesaplarÄ±na bireysel kullanÄ±cÄ± onayÄ± olmaksÄ±zÄ±n eriÅŸim izni verebilirler.\
\
Google Workspace, iki ana tÃ¼rde global delegasyon nesnesi kimlik oluÅŸturmayÄ± saÄŸlar:

* **GWS UygulamalarÄ±:** Workspace Marketplace'den uygulamalar, bir delegasyon kimliÄŸi olarak yapÄ±landÄ±rÄ±labilir. Marketplace'de mevcut hale getirilmeden Ã¶nce, her Workspace uygulamasÄ±, olasÄ± kÃ¶tÃ¼ye kullanÄ±mÄ± en aza indirmek iÃ§in Google tarafÄ±ndan incelenir. Bu, kÃ¶tÃ¼ye kullanÄ±m riskini tamamen ortadan kaldÄ±rmaz, ancak bu tÃ¼r olaylarÄ±n gerÃ§ekleÅŸme olasÄ±lÄ±ÄŸÄ±nÄ± Ã¶nemli Ã¶lÃ§Ã¼de azaltÄ±r.
* **GCP Hizmet HesabÄ±:** [**GCP Hizmet HesaplarÄ± hakkÄ±nda daha fazla bilgi edinin**](../gcp-basic-information/#service-accounts).

### **Alan GeniÅŸ Delegasyonu: Ä°Ã§ Mekanizma**

Bir GCP Hizmet HesabÄ±nÄ±n, Google Workspace'deki diÄŸer kimlikler adÄ±na Google API'lerine eriÅŸmesi ÅŸu ÅŸekilde gerÃ§ekleÅŸir:

<figure><img src="../../../.gitbook/assets/image (58).png" alt=""><figcaption></figcaption></figure>

1. **Kimlik bir JWT oluÅŸturur:** Kimlik, hizmet hesabÄ±nÄ±n Ã¶zel anahtarÄ±nÄ± (JSON anahtar Ã§ifti dosyasÄ±nÄ±n bir parÃ§asÄ±) kullanarak bir JWT imzalar. Bu JWT, istenen REST API'sine eriÅŸim kapsamÄ± iÃ§in hizmet hesabÄ±, taklit edilecek hedef kullanÄ±cÄ± ve OAuth kapsamlarÄ± hakkÄ±nda iddialar iÃ§erir.
2. **Kimlik, bir eriÅŸim belirteci istemek iÃ§in JWT'yi kullanÄ±r:** Uygulama/kullanÄ±cÄ±, JWT'yi Google'Ä±n OAuth 2.0 hizmetinden bir eriÅŸim belirteci istemek iÃ§in kullanÄ±r. Ä°stek ayrÄ±ca taklit edilecek hedef kullanÄ±cÄ±yÄ± (kullanÄ±cÄ±nÄ±n Workspace e-postasÄ±) ve eriÅŸim istendiÄŸi kapsamlarÄ± iÃ§erir.
3. **Google'Ä±n OAuth 2.0 hizmeti bir eriÅŸim belirteci dÃ¶ndÃ¼rÃ¼r:** EriÅŸim belirteci, hizmet hesabÄ±nÄ±n belirtilen kapsamlar iÃ§in kullanÄ±cÄ± adÄ±na hareket etme yetkisini temsil eder. Bu belirteÃ§ genellikle kÄ±sa Ã¶mÃ¼rlÃ¼dÃ¼r ve periyodik olarak yenilenmelidir (uygulamanÄ±n ihtiyacÄ±na gÃ¶re). JWT belirtecinde belirtilen OAuth kapsamlarÄ±nÄ±n geÃ§erliliÄŸi ve eriÅŸim belirteci Ã¼zerindeki etkisi Ã¶nemlidir. Ã–rneÄŸin, birden fazla kapsama sahip eriÅŸim belirteÃ§leri, birÃ§ok REST API uygulamasÄ± iÃ§in geÃ§erlilik saÄŸlar.
4. **Kimlik, Google API'lerini aramak iÃ§in eriÅŸim belirtecini kullanÄ±r**: ArtÄ±k ilgili bir eriÅŸim belirteciyle, hizmet gerekli REST API'ye eriÅŸebilir. Uygulama, bu eriÅŸim belirtecini, Google API'lerine yÃ¶nelik HTTP istekleri iÃ§in "Yetkilendirme" baÅŸlÄ±ÄŸÄ±nda kullanÄ±r. Bu API'ler, taklit edilen kimliÄŸi doÄŸrulamak ve gerekli yetkiye sahip olduÄŸunu onaylamak iÃ§in bu belirteci kullanÄ±r.
5. **Google API'leri istenen verileri dÃ¶ndÃ¼rÃ¼r**: EriÅŸim belirteci geÃ§erli ise ve hizmet hesabÄ±nÄ±n uygun yetkisi varsa, Google API'leri istenen verileri dÃ¶ndÃ¼rÃ¼r. Ã–rneÄŸin, aÅŸaÄŸÄ±daki resimde, bir hedef Workspace kullanÄ±cÄ±sÄ±yla iliÅŸkilendirilen tÃ¼m Gmail mesaj kimliklerini listelemek iÃ§in _users.messages.list_ yÃ¶ntemini kullandÄ±k.

{% hint style="success" %}
AWS Hacking'i Ã¶ÄŸrenin ve uygulayÄ±n: <img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks EÄŸitim AWS KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ± (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCP Hacking'i Ã¶ÄŸrenin ve uygulayÄ±n: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks EÄŸitim GCP KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ± (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**Abonelik planlarÄ±nÄ±**](https://github.com/sponsors/carlospolop) kontrol edin!
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) katÄ±lÄ±n veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n veya bizi **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** takip edin.**
* **Hacking pÃ¼f noktalarÄ±nÄ± paylaÅŸarak PR'ler gÃ¶ndererek** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na katkÄ±da bulunun.

</details>
{% endhint %}
