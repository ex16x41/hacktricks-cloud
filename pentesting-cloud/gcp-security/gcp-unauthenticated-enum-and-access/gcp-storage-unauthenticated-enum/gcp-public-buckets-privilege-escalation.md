# GCP - Public Buckets Privilege Escalation

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** 💬 [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Buckets Privilege Escalation

버킷 정책이 “allUsers” 또는 “allAuthenticatedUsers”가 **버킷 정책에 쓰기** (즉, **storage.buckets.setIamPolicy** 권한)를 허용한다면, 누구나 버킷 정책을 수정하고 자신에게 전체 접근 권한을 부여할 수 있습니다.

### Check Permissions

버킷에 대한 권한을 확인하는 방법은 두 가지가 있습니다. 첫 번째는 `https://www.googleapis.com/storage/v1/b/BUCKET_NAME/iam`에 요청을 하거나 `gsutil iam get gs://BUCKET_NAME`을 실행하는 것입니다.

그러나 사용자가 (잠재적으로 allUsers 또는 allAuthenticatedUsers에 속하는) 버킷의 iam 정책을 읽을 권한이 없다면 (storage.buckets.getIamPolicy), 이는 작동하지 않습니다.

항상 작동하는 다른 옵션은 버킷의 testPermissions 엔드포인트를 사용하여 지정된 권한이 있는지 확인하는 것입니다. 예를 들어 다음에 접근할 수 있습니다: `https://www.googleapis.com/storage/v1/b/BUCKET_NAME/iam/testPermissions?permissions=storage.buckets.delete&permissions=storage.buckets.get&permissions=storage.buckets.getIamPolicy&permissions=storage.buckets.setIamPolicy&permissions=storage.buckets.update&permissions=storage.objects.create&permissions=storage.objects.delete&permissions=storage.objects.get&permissions=storage.objects.list&permissions=storage.objects.update`

### Escalating

`allAuthenticatedUsers`에게 `Storage Admin` 권한을 부여하기 위해 다음을 실행할 수 있습니다:
```bash
gsutil iam ch allAuthenticatedUsers:admin gs://BUCKET_NAME
```
또 다른 공격은 **버킷을 제거하고 당신의 계정에서 다시 생성하여 소유권을 훔치는 것**입니다.

## References

* [https://rhinosecuritylabs.com/gcp/google-cloud-platform-gcp-bucket-enumeration/](https://rhinosecuritylabs.com/gcp/google-cloud-platform-gcp-bucket-enumeration/)

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** 💬 [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
