# GCP - IAM, Principals & Org Unauthenticated Enum

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Iam & GCP Principals

Daha fazla bilgi iÃ§in kontrol edin:

{% content-ref url="../gcp-services/gcp-iam-and-org-policies-enum.md" %}
[gcp-iam-and-org-policies-enum.md](../gcp-services/gcp-iam-and-org-policies-enum.md)
{% endcontent-ref %}

### Workspace'de alan adÄ± kullanÄ±lÄ±yor mu?

1. **DNS kayÄ±tlarÄ±nÄ± kontrol et**

EÄŸer **`google-site-verification`** kaydÄ± varsa, muhtemelen Workspace kullanÄ±yordur (veya kullanÄ±yordu):
```
dig txt hacktricks.xyz

[...]
hacktricks.xyz.		3600	IN	TXT	"google-site-verification=2mWyPXMPXEEy6QqWbCfWkxFTcQhyYdwHrOxee1Yeo-0"
hacktricks.xyz.		3600	IN	TXT	"google-site-verification=C19PtLcZ1EGyzUYYJTX1Tp6bOGessxzN9gqE-SVKhRA"
hacktricks.xyz.		300	IN	TXT	"v=spf1 include:usb._netblocks.mimecast.com include:_spf.google.com include:_spf.psm.knowbe4.com include:_spf.salesforce.com include:spf.mandrillapp.com ~all"
```
If something like **`include:_spf.google.com`** also appears it confirms it (note that if it doesn't appear it doesn't denies it as a domain can be in Workspace without using gmail as mail provider).

2. **O alan adÄ±yla bir Workspace kurmayÄ± deneyin**

BaÅŸka bir seÃ§enek, o alan adÄ±nÄ± kullanarak bir Workspace kurmayÄ± denemektir, eÄŸer **alan adÄ±nÄ±n zaten kullanÄ±ldÄ±ÄŸÄ±na dair bir ÅŸikayet alÄ±rsanÄ±z** (resimdeki gibi), bunun zaten kullanÄ±ldÄ±ÄŸÄ±nÄ± bilirsiniz!

Bir Workspace alan adÄ± kurmayÄ± denemek iÃ§in: [https://workspace.google.com/business/signup/welcome](https://workspace.google.com/business/signup/welcome)

<figure><img src="../../../.gitbook/assets/image (330).png" alt=""><figcaption></figcaption></figure>

3. **O alan adÄ±nÄ± kullanarak bir e-posta ÅŸifresini kurtarmayÄ± deneyin**

EÄŸer o alan adÄ±nda kullanÄ±lan geÃ§erli bir e-posta adresini biliyorsanÄ±z (Ã¶rneÄŸin: admin@email.com veya info@email.com) **hesabÄ± kurtarmayÄ±** [https://accounts.google.com/signin/v2/recoveryidentifier](https://accounts.google.com/signin/v2/recoveryidentifier) deneyebilirsiniz ve eÄŸer deneme, Google'Ä±n o hesap hakkÄ±nda hiÃ§bir fikri olmadÄ±ÄŸÄ±nÄ± belirten bir hata gÃ¶stermezse, o zaman Workspace kullanÄ±yordur.

### E-postalarÄ± ve hizmet hesaplarÄ±nÄ± listele

Bir Workspace alan adÄ±nÄ±n geÃ§erli e-postalarÄ±nÄ± ve SA e-postalarÄ±nÄ± **listelemek** mÃ¼mkÃ¼ndÃ¼r, bunlara izinler atamayÄ± deneyerek ve hata mesajlarÄ±nÄ± kontrol ederek. Bunun iÃ§in sadece bir projeye izin atama yetkisine sahip olmanÄ±z gerekir (bu proje sadece sizin tarafÄ±nÄ±zdan sahip olunmuÅŸ olabilir).

OnlarÄ± kontrol etmek iÃ§in, ancak varlarsa onlara izin vermemek iÃ§in **`serviceAccount`** tÃ¼rÃ¼nÃ¼ **`user`** olduÄŸunda ve **`user`** tÃ¼rÃ¼nÃ¼ **`SA`** olduÄŸunda kullanabilirsiniz:

{% code overflow="wrap" %}
```bash
# Try to assign permissions to user 'unvalid-email-34r434f@hacktricks.xyz'
# but indicating it's a service account
gcloud projects add-iam-policy-binding <project-controlled-by-you> \
--member='serviceAccount:unvalid-email-34r434f@hacktricks.xyz' \
--role='roles/viewer'
## Response:
ERROR: (gcloud.projects.add-iam-policy-binding) INVALID_ARGUMENT: User unvalid-email-34r434f@hacktricks.xyz does not exist.

# Now try with a valid email
gcloud projects add-iam-policy-binding <project-controlled-by-you> \
--member='serviceAccount:support@hacktricks.xyz' \
--role='roles/viewer'
# Response:
ERROR: (gcloud.projects.add-iam-policy-binding) INVALID_ARGUMENT: Principal support@hacktricks.xyz is of type "user". The principal should appear as "user:support@hacktricks.xyz". See https://cloud.google.com/iam/help/members/types for additional documentation.
```
{% endcode %}

Hizmet HesaplarÄ±nÄ± bilinen projelerde listelemenin daha hÄ±zlÄ± bir yolu, URL'ye eriÅŸmeye Ã§alÄ±ÅŸmaktÄ±r: `https://iam.googleapis.com/v1/projects/<project-id>/serviceAccounts/<sa-email>`\
Ã–rneÄŸin: `https://iam.googleapis.com/v1/projects/gcp-labs-3uis1xlx/serviceAccounts/appengine-lab-1-tarsget@gcp-labs-3uis1xlx.iam.gserviceaccount.com`

EÄŸer yanÄ±t 403 ise, bu SA'nÄ±n var olduÄŸu anlamÄ±na gelir. Ancak yanÄ±t 404 ise, bu SA'nÄ±n mevcut olmadÄ±ÄŸÄ± anlamÄ±na gelir:
```json
// Exists
{
"error": {
"code": 403,
"message": "Method doesn't allow unregistered callers (callers without established identity). Please use API Key or other form of API consumer identity to call this API.",
"status": "PERMISSION_DENIED"
}
}

// Doesn't exist
{
"error": {
"code": 404,
"message": "Unknown service account",
"status": "NOT_FOUND"
}
}
```
KullanÄ±cÄ± e-posta adresi geÃ§erli olduÄŸunda, hata mesajÄ±nÄ±n tÃ¼rÃ¼n geÃ§erli olmadÄ±ÄŸÄ±nÄ± belirttiÄŸine dikkat edin, bu nedenle support@hacktricks.xyz e-posta adresinin var olduÄŸunu, herhangi bir ayrÄ±calÄ±k vermeden keÅŸfetmeyi baÅŸardÄ±k.

**AynÄ±sÄ±nÄ± Hizmet HesaplarÄ±yla** da yapabilirsiniz, **`serviceAccount:`** yerine **`user:`** tÃ¼rÃ¼nÃ¼ kullanarak:

{% code overflow="wrap" %}
```bash
# Non existent
gcloud projects add-iam-policy-binding <project-controlled-by-you> \
--member='serviceAccount:<invalid-sa-name>@<proj-uniq-name>.iam.gserviceaccount.com' \
--role='roles/viewer'
# Response
ERROR: (gcloud.projects.add-iam-policy-binding) INVALID_ARGUMENT: User <invalid-sa-name>@<proj-uniq-name>.iam.gserviceaccount.com does not exist.

# Existent
gcloud projects add-iam-policy-binding <project-controlled-by-you> \
--member='serviceAccount:<sa-name>@<proj-uniq-name>.iam.gserviceaccount.com' \
--role='roles/viewer'
# Response
ERROR: (gcloud.projects.add-iam-policy-binding) INVALID_ARGUMENT: Principal testing@digital-bonfire-410512.iam.gserviceaccount.com is of type "serviceAccount". The principal should appear as "serviceAccount:testing@digital-bonfire-410512.iam.gserviceaccount.com". See https://cloud.google.com/iam/help/members/types for additional documentation.
```
{% endcode %}

{% hint style="success" %}
AWS Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n:<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks EÄŸitim AWS KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ± (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
GCP Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks EÄŸitim GCP KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ± (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**abonelik planlarÄ±nÄ±**](https://github.com/sponsors/carlospolop) kontrol edin!
* **ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n ya da **Twitter'da** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**'i takip edin.**
* **Hacking ipuÃ§larÄ±nÄ± paylaÅŸmak iÃ§in** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna PR gÃ¶nderin.

</details>
{% endhint %}
