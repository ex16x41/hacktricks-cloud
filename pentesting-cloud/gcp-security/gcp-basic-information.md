# GCP - Basic Information

{% hint style="success" %}
å­¦ä¹ å’Œç»ƒä¹  AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
å­¦ä¹ å’Œç»ƒä¹  GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>æ”¯æŒ HackTricks</summary>

* æŸ¥çœ‹ [**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**telegram ç¾¤ç»„**](https://t.me/peass) æˆ– **å…³æ³¨** æˆ‘ä»¬çš„ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **é€šè¿‡æäº¤ PRs åˆ†äº«é»‘å®¢æŠ€å·§åˆ°** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ä»“åº“ã€‚

</details>
{% endhint %}

## **èµ„æºå±‚æ¬¡ç»“æ„**

Google Cloud ä½¿ç”¨ä¸€ä¸ª [èµ„æºå±‚æ¬¡ç»“æ„](https://cloud.google.com/resource-manager/docs/cloud-platform-resource-hierarchy)ï¼Œæ¦‚å¿µä¸Šç±»ä¼¼äºä¼ ç»Ÿçš„æ–‡ä»¶ç³»ç»Ÿã€‚è¿™æä¾›äº†ä¸€ä¸ªé€»è¾‘ä¸Šçš„çˆ¶/å­å·¥ä½œæµï¼Œå¹¶ä¸ºç­–ç•¥å’Œæƒé™æä¾›äº†ç‰¹å®šçš„é™„åŠ ç‚¹ã€‚

åœ¨é«˜å±‚æ¬¡ä¸Šï¼Œå®ƒçœ‹èµ·æ¥åƒè¿™æ ·ï¼š
```
Organization
--> Folders
--> Projects
--> Resources
```
è™šæ‹Ÿæœºï¼ˆç§°ä¸º Compute Instanceï¼‰æ˜¯ä¸€ç§èµ„æºã€‚èµ„æºä½äºé¡¹ç›®ä¸­ï¼Œå¯èƒ½ä¸å…¶ä»– Compute Instanceã€å­˜å‚¨æ¡¶ç­‰ä¸€èµ·å­˜åœ¨ã€‚

<figure><img src="../../.gitbook/assets/image (1).png" alt=""><figcaption><p><a href="https://cloud.google.com/static/resource-manager/img/cloud-hierarchy.svg">https://cloud.google.com/static/resource-manager/img/cloud-hierarchy.svg</a></p></figcaption></figure>

## **é¡¹ç›®è¿ç§»**

åœ¨æ²¡æœ‰ä»»ä½•ç»„ç»‡çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥é€šè¿‡å…·æœ‰ `roles/resourcemanager.projectCreator` å’Œ `roles/resourcemanager.projectMover` æƒé™çš„ç»„ç»‡è¿ç§»é¡¹ç›®ã€‚å¦‚æœé¡¹ç›®åœ¨å…¶ä»–ç»„ç»‡å†…ï¼Œåˆ™éœ€è¦è”ç³» GCP æ”¯æŒä»¥**é¦–å…ˆå°†å…¶ç§»å‡ºç»„ç»‡**ã€‚æ›´å¤šä¿¡æ¯è¯·æŸ¥çœ‹[**æ­¤å¤„**](https://medium.com/google-cloud/migrating-a-project-from-one-organization-to-another-gcp-4b37a86dd9e6)ã€‚

## **ç»„ç»‡æ”¿ç­–**

å…è®¸é›†ä¸­æ§åˆ¶ç»„ç»‡çš„äº‘èµ„æºï¼š

* é›†ä¸­æ§åˆ¶ä»¥**é…ç½®é™åˆ¶**ï¼Œè§„å®šç»„ç»‡èµ„æºçš„ä½¿ç”¨æ–¹å¼ã€‚
* å®šä¹‰å’Œå»ºç«‹**æŠ¤æ **ï¼Œä½¿å¼€å‘å›¢é˜Ÿåœ¨åˆè§„è¾¹ç•Œå†…å·¥ä½œã€‚
* å¸®åŠ©é¡¹ç›®æ‰€æœ‰è€…åŠå…¶å›¢é˜Ÿå¿«é€Ÿè¡ŒåŠ¨ï¼Œè€Œæ— éœ€æ‹…å¿ƒè¿ååˆè§„æ€§ã€‚

è¿™äº›æ”¿ç­–å¯ä»¥åˆ›å»ºä»¥**å½±å“æ•´ä¸ªç»„ç»‡ã€æ–‡ä»¶å¤¹æˆ–é¡¹ç›®**ã€‚ç›®æ ‡èµ„æºå±‚æ¬¡ç»“æ„èŠ‚ç‚¹çš„åä»£**ç»§æ‰¿ç»„ç»‡æ”¿ç­–**ã€‚

ä¸ºäº†**å®šä¹‰**ç»„ç»‡æ”¿ç­–ï¼Œ**ä½ éœ€è¦é€‰æ‹©ä¸€ä¸ª**[**çº¦æŸ**](https://cloud.google.com/resource-manager/docs/organization-policy/overview#constraints)ï¼Œè¿™æ˜¯å¯¹ Google Cloud æœåŠ¡æˆ–ä¸€ç»„ Google Cloud æœåŠ¡çš„ç‰¹å®šç±»å‹çš„é™åˆ¶ã€‚ä½ **æ ¹æ®æ‰€éœ€çš„é™åˆ¶é…ç½®è¯¥çº¦æŸ**ã€‚

<figure><img src="../../.gitbook/assets/image (5) (4).png" alt=""><figcaption><p><a href="https://cloud.google.com/resource-manager/img/org-policy-concepts.svg">https://cloud.google.com/resource-manager/img/org-policy-concepts.svg</a></p></figcaption></figure>

#### å¸¸è§ç”¨ä¾‹ <a href="#common_use_cases" id="common_use_cases"></a>

* åŸºäºåŸŸé™åˆ¶èµ„æºå…±äº«ã€‚
* é™åˆ¶ Identity and Access Management æœåŠ¡è´¦æˆ·çš„ä½¿ç”¨ã€‚
* é™åˆ¶æ–°åˆ›å»ºèµ„æºçš„ç‰©ç†ä½ç½®ã€‚
* ç¦ç”¨æœåŠ¡è´¦æˆ·åˆ›å»ºã€‚

<figure><img src="../../.gitbook/assets/image (83).png" alt=""><figcaption></figcaption></figure>

è¿˜æœ‰è®¸å¤šå…¶ä»–çº¦æŸå¯ä»¥å¯¹ç»„ç»‡çš„èµ„æºè¿›è¡Œç»†ç²’åº¦æ§åˆ¶ã€‚æœ‰å…³**æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…**[**æ‰€æœ‰ç»„ç»‡æ”¿ç­–æœåŠ¡çº¦æŸçš„åˆ—è¡¨**](https://cloud.google.com/resource-manager/docs/organization-policy/org-policy-constraints)**ã€‚**

### **é»˜è®¤ç»„ç»‡æ”¿ç­–**

<details>

<summary>è¿™äº›æ˜¯ Google åœ¨è®¾ç½® GCP ç»„ç»‡æ—¶é»˜è®¤æ·»åŠ çš„æ”¿ç­–ï¼š</summary>

**è®¿é—®ç®¡ç†æ”¿ç­–**

* **åŸŸé™åˆ¶è”ç³»äººï¼š** é˜²æ­¢å°†ç”¨æˆ·æ·»åŠ åˆ°æŒ‡å®šåŸŸä¹‹å¤–çš„ Essential Contactsã€‚è¿™é™åˆ¶äº† Essential Contacts ä»…å…è®¸é€‰å®šåŸŸä¸­çš„æ‰˜ç®¡ç”¨æˆ·èº«ä»½æ¥æ”¶å¹³å°é€šçŸ¥ã€‚
* **åŸŸé™åˆ¶å…±äº«ï¼š** é˜²æ­¢å°†ç”¨æˆ·æ·»åŠ åˆ°æŒ‡å®šåŸŸä¹‹å¤–çš„ IAM æ”¿ç­–ã€‚è¿™é™åˆ¶äº† IAM æ”¿ç­–ä»…å…è®¸é€‰å®šåŸŸä¸­çš„æ‰˜ç®¡ç”¨æˆ·èº«ä»½è®¿é—®ç»„ç»‡å†…çš„èµ„æºã€‚
* **å…¬å…±è®¿é—®é¢„é˜²ï¼š** é˜²æ­¢ Cloud Storage å­˜å‚¨æ¡¶æš´éœ²ç»™å…¬ä¼—ã€‚è¿™ç¡®ä¿å¼€å‘äººå‘˜æ— æ³•é…ç½® Cloud Storage å­˜å‚¨æ¡¶ä»¥è¿›è¡Œæœªç»èº«ä»½éªŒè¯çš„äº’è”ç½‘è®¿é—®ã€‚
* **ç»Ÿä¸€å­˜å‚¨æ¡¶çº§åˆ«è®¿é—®ï¼š** é˜²æ­¢ Cloud Storage å­˜å‚¨æ¡¶ä¸­çš„å¯¹è±¡çº§è®¿é—®æ§åˆ¶åˆ—è¡¨ï¼ˆACLï¼‰ã€‚è¿™é€šè¿‡åœ¨ Cloud Storage å­˜å‚¨æ¡¶ä¸­çš„æ‰€æœ‰å¯¹è±¡ä¸Šå§‹ç»ˆå¦‚ä¸€åœ°åº”ç”¨ IAM æ”¿ç­–æ¥ç®€åŒ–è®¿é—®ç®¡ç†ã€‚
* **è¦æ±‚ OS ç™»å½•ï¼š** åœ¨æ–°é¡¹ç›®ä¸­åˆ›å»ºçš„ VM å°†å¯ç”¨ OS ç™»å½•ã€‚è¿™ä½¿ä½ å¯ä»¥ä½¿ç”¨ IAM ç®¡ç†å¯¹å®ä¾‹çš„ SSH è®¿é—®ï¼Œè€Œæ— éœ€åˆ›å»ºå’Œç®¡ç†å•ç‹¬çš„ SSH å¯†é’¥ã€‚

**æœåŠ¡è´¦æˆ·çš„å…¶ä»–å®‰å…¨æ”¿ç­–**

* **ç¦ç”¨è‡ªåŠ¨ IAM æˆæƒï¼š** é˜²æ­¢é»˜è®¤çš„ App Engine å’Œ Compute Engine æœåŠ¡è´¦æˆ·åœ¨åˆ›å»ºé¡¹ç›®æ—¶è‡ªåŠ¨è·å¾— Editor IAM è§’è‰²ã€‚è¿™ç¡®ä¿æœåŠ¡è´¦æˆ·åœ¨åˆ›å»ºæ—¶ä¸ä¼šè·å¾—è¿‡äºå®½æ³›çš„ IAM è§’è‰²ã€‚
* **ç¦ç”¨æœåŠ¡è´¦æˆ·å¯†é’¥åˆ›å»ºï¼š** é˜²æ­¢åˆ›å»ºå…¬å…±æœåŠ¡è´¦æˆ·å¯†é’¥ã€‚è¿™æœ‰åŠ©äºå‡å°‘æš´éœ²æŒä¹…å‡­è¯çš„é£é™©ã€‚
* **ç¦ç”¨æœåŠ¡è´¦æˆ·å¯†é’¥ä¸Šä¼ ï¼š** é˜²æ­¢ä¸Šä¼ å…¬å…±æœåŠ¡è´¦æˆ·å¯†é’¥ã€‚è¿™æœ‰åŠ©äºå‡å°‘æ³„éœ²æˆ–é‡å¤ä½¿ç”¨å¯†é’¥ææ–™çš„é£é™©ã€‚

**å®‰å…¨ VPC ç½‘ç»œé…ç½®æ”¿ç­–**

* **å®šä¹‰ VM å®ä¾‹çš„å…è®¸å¤–éƒ¨ IPï¼š** é˜²æ­¢åˆ›å»ºå…·æœ‰å…¬å…± IP çš„ Compute å®ä¾‹ï¼Œè¿™å¯èƒ½ä¼šå°†å…¶æš´éœ²ç»™äº’è”ç½‘æµé‡ã€‚

<!---->

* **ç¦ç”¨ VM åµŒå¥—è™šæ‹ŸåŒ–ï¼š** é˜²æ­¢åœ¨ Compute Engine VM ä¸Šåˆ›å»ºåµŒå¥— VMã€‚è¿™å‡å°‘äº†æœªç›‘æ§åµŒå¥— VM å¸¦æ¥çš„å®‰å…¨é£é™©ã€‚

<!---->

* **ç¦ç”¨ VM ä¸²è¡Œç«¯å£ï¼š** é˜²æ­¢å¯¹ Compute Engine VM çš„ä¸²è¡Œç«¯å£è®¿é—®ã€‚è¿™é˜²æ­¢é€šè¿‡ Compute Engine API å‘æœåŠ¡å™¨çš„ä¸²è¡Œç«¯å£è¾“å…¥ã€‚

<!---->

* **é™åˆ¶ Cloud SQL å®ä¾‹ä¸Šçš„æˆæƒç½‘ç»œï¼š** é˜²æ­¢å…¬å…±æˆ–éå†…éƒ¨ç½‘ç»œèŒƒå›´è®¿é—® Cloud SQL æ•°æ®åº“ã€‚

<!---->

* **åŸºäº IP åœ°å€ç±»å‹é™åˆ¶åè®®è½¬å‘ï¼š** é˜²æ­¢ VM åè®®è½¬å‘å¤–éƒ¨ IP åœ°å€ã€‚

<!---->

* **é™åˆ¶ Cloud SQL å®ä¾‹ä¸Šçš„å…¬å…± IP è®¿é—®ï¼š** é˜²æ­¢åˆ›å»ºå…·æœ‰å…¬å…± IP çš„ Cloud SQL å®ä¾‹ï¼Œè¿™å¯èƒ½ä¼šå°†å…¶æš´éœ²ç»™äº’è”ç½‘æµé‡ã€‚

<!---->

* **é™åˆ¶å…±äº« VPC é¡¹ç›®ç•™ç½®åˆ é™¤ï¼š** é˜²æ­¢æ„å¤–åˆ é™¤å…±äº« VPC ä¸»æœºé¡¹ç›®ã€‚

<!---->

* **å°†æ–°é¡¹ç›®çš„å†…éƒ¨ DNS è®¾ç½®ä¸ºä»…åŒºåŸŸ DNSï¼š** é˜²æ­¢ä½¿ç”¨æœåŠ¡å¯ç”¨æ€§è¾ƒä½çš„æ—§ç‰ˆ DNS è®¾ç½®ã€‚

<!---->

* **è·³è¿‡é»˜è®¤ç½‘ç»œåˆ›å»ºï¼š** é˜²æ­¢è‡ªåŠ¨åˆ›å»ºé»˜è®¤ VPC ç½‘ç»œåŠç›¸å…³èµ„æºã€‚è¿™é¿å…äº†è¿‡äºå®½æ³›çš„é»˜è®¤é˜²ç«å¢™è§„åˆ™ã€‚

<!---->

* **ç¦ç”¨ VPC å¤–éƒ¨ IPv6 ä½¿ç”¨ï¼š** é˜²æ­¢åˆ›å»ºå¤–éƒ¨ IPv6 å­ç½‘ï¼Œè¿™å¯èƒ½ä¼šæš´éœ²ç»™æœªç»æˆæƒçš„äº’è”ç½‘è®¿é—®ã€‚

</details>

## **IAM è§’è‰²**

è¿™äº›ç±»ä¼¼äº AWS ä¸­çš„ IAM æ”¿ç­–ï¼Œå› ä¸º**æ¯ä¸ªè§’è‰²åŒ…å«ä¸€ç»„æƒé™ã€‚**

ç„¶è€Œï¼Œä¸ AWS ä¸åŒçš„æ˜¯ï¼Œæ²¡æœ‰**é›†ä¸­å­˜å‚¨åº“**æ¥å­˜å‚¨è§’è‰²ã€‚ç›¸åï¼Œ**èµ„æºä¸º Y ä¸»ä½“æä¾› X è®¿é—®è§’è‰²**ï¼Œå”¯ä¸€çš„æ–¹æ³•æ˜¯ä½¿ç”¨**`get-iam-policy` æ–¹æ³•è·å–è¯¥èµ„æºçš„æƒé™**ã€‚\
è¿™å¯èƒ½æ˜¯ä¸€ä¸ªé—®é¢˜ï¼Œå› ä¸ºè¿™æ„å‘³ç€å”¯ä¸€çš„æ–¹æ³•æ˜¯**è¯¢é—®æ¯ä¸ªèµ„æºå®ƒæˆäºˆäº†å“ªäº›æƒé™**ï¼Œè€Œç”¨æˆ·å¯èƒ½æ²¡æœ‰æƒé™ä»æ‰€æœ‰èµ„æºè·å–æƒé™ã€‚

IAM ä¸­æœ‰**ä¸‰ç§ç±»å‹**çš„è§’è‰²ï¼š

* **åŸºæœ¬/åŸå§‹è§’è‰²**ï¼ŒåŒ…æ‹¬åœ¨å¼•å…¥ IAM ä¹‹å‰å­˜åœ¨çš„**æ‰€æœ‰è€…**ã€**ç¼–è¾‘è€…**å’Œ**æŸ¥çœ‹è€…**è§’è‰²ã€‚
* **é¢„å®šä¹‰è§’è‰²**ï¼Œä¸ºç‰¹å®šæœåŠ¡æä¾›ç»†ç²’åº¦è®¿é—®æƒé™ï¼Œç”± Google Cloud ç®¡ç†ã€‚æœ‰å¾ˆå¤šé¢„å®šä¹‰è§’è‰²ï¼Œä½ å¯ä»¥**åœ¨æ­¤å¤„æŸ¥çœ‹å®ƒä»¬çš„æ‰€æœ‰æƒé™**[**è¿™é‡Œ**](https://cloud.google.com/iam/docs/understanding-roles#predefined\_roles)ã€‚
* **è‡ªå®šä¹‰è§’è‰²**ï¼Œæ ¹æ®ç”¨æˆ·æŒ‡å®šçš„æƒé™åˆ—è¡¨æä¾›ç»†ç²’åº¦è®¿é—®æƒé™ã€‚

GCP ä¸­æœ‰æˆåƒä¸Šä¸‡çš„æƒé™ã€‚ä¸ºäº†æ£€æŸ¥æŸä¸ªè§’è‰²æ˜¯å¦å…·æœ‰æŸä¸ªæƒé™ï¼Œä½ å¯ä»¥[**åœ¨æ­¤å¤„æœç´¢æƒé™**](https://cloud.google.com/iam/docs/permissions-reference)å¹¶æŸ¥çœ‹å“ªäº›è§’è‰²å…·æœ‰è¯¥æƒé™ã€‚

ä½ è¿˜å¯ä»¥[**åœ¨æ­¤å¤„æœç´¢é¢„å®šä¹‰è§’è‰²**](https://cloud.google.com/iam/docs/understanding-roles#product\_specific\_documentation)**ï¼Œç”±æ¯ä¸ªäº§å“æä¾›ã€‚**è¯·æ³¨æ„ï¼ŒæŸäº›**è§’è‰²**ä¸èƒ½é™„åŠ åˆ°ç”¨æˆ·ï¼Œ**åªèƒ½é™„åŠ åˆ° SAsï¼Œå› ä¸ºå®ƒä»¬åŒ…å«æŸäº›æƒé™**ã€‚\
æ­¤å¤–ï¼Œè¯·æ³¨æ„ï¼Œ**æƒé™**åªæœ‰åœ¨**é™„åŠ åˆ°ç›¸å…³æœåŠ¡æ—¶**æ‰ä¼š**ç”Ÿæ•ˆ**ã€‚

æˆ–è€…æ£€æŸ¥**è‡ªå®šä¹‰è§’è‰²æ˜¯å¦å¯ä»¥ä½¿ç”¨**[**ç‰¹å®šæƒé™åœ¨è¿™é‡Œ**](https://cloud.google.com/iam/docs/custom-roles-permissions-support)**ã€‚**

{% content-ref url="gcp-services/gcp-iam-and-org-policies-enum.md" %}
[gcp-iam-and-org-policies-enum.md](gcp-services/gcp-iam-and-org-policies-enum.md)
{% endcontent-ref %}

## ç”¨æˆ· <a href="#default-credentials" id="default-credentials"></a>

åœ¨**GCP æ§åˆ¶å°**ä¸­æ²¡æœ‰**ç”¨æˆ·æˆ–ç»„**ç®¡ç†ï¼Œè¿™æ˜¯åœ¨**Google Workspace**ä¸­å®Œæˆçš„ã€‚å°½ç®¡ä½ å¯ä»¥åœ¨ Google Workspace ä¸­åŒæ­¥ä¸åŒçš„èº«ä»½æä¾›è€…ã€‚

ä½ å¯ä»¥è®¿é—® Workspaces **ç”¨æˆ·å’Œç»„åœ¨**[**https://admin.google.com**](https://admin.google.com/)ã€‚

**MFA** å¯ä»¥**å¼ºåˆ¶** Workspaces ç”¨æˆ·ä½¿ç”¨ï¼Œä½†**æ”»å‡»è€…**å¯ä»¥ä½¿ç”¨ä»¤ç‰Œé€šè¿‡ cli è®¿é—® GCP **ï¼Œè¿™ä¸ä¼šå—åˆ° MFA ä¿æŠ¤**ï¼ˆåªæœ‰å½“ç”¨æˆ·ç™»å½•ç”Ÿæˆå®ƒæ—¶æ‰ä¼šå—åˆ° MFA ä¿æŠ¤ï¼š`gcloud auth login`ï¼‰ã€‚

## ç»„

å½“åˆ›å»ºä¸€ä¸ªç»„ç»‡æ—¶ï¼Œå¼ºçƒˆå»ºè®®åˆ›å»ºå‡ ä¸ªç»„ã€‚å¦‚æœä½ ç®¡ç†å…¶ä¸­ä»»ä½•ä¸€ä¸ªï¼Œä½ å¯èƒ½å·²ç»å¦¥åäº†æ•´ä¸ªæˆ–é‡è¦éƒ¨åˆ†çš„ç»„ç»‡ï¼š

<table data-header-hidden><thead><tr><th width="299.3076923076923"></th><th></th></tr></thead><tbody><tr><td><strong>ç»„</strong></td><td><strong>åŠŸèƒ½</strong></td></tr><tr><td><strong><code>gcp-organization-admins</code></strong><br><em>ï¼ˆæ£€æŸ¥è¡¨æ‰€éœ€çš„ç»„æˆ–ä¸ªäººè´¦æˆ·ï¼‰</em></td><td>ç®¡ç†å±äºç»„ç»‡çš„ä»»ä½•èµ„æºã€‚è°¨æ…åˆ†é…æ­¤è§’è‰²ï¼›ç»„ç»‡ç®¡ç†å‘˜å¯ä»¥è®¿é—®æ‰€æœ‰ Google Cloud èµ„æºã€‚æˆ–è€…ï¼Œç”±äºæ­¤åŠŸèƒ½æƒé™å¾ˆé«˜ï¼Œè€ƒè™‘ä½¿ç”¨ä¸ªäººè´¦æˆ·è€Œä¸æ˜¯åˆ›å»ºç»„ã€‚</td></tr><tr><td><strong><code>gcp-network-admins</code></strong><br><em>ï¼ˆæ£€æŸ¥è¡¨æ‰€éœ€ï¼‰</em></td><td>åˆ›å»ºç½‘ç»œã€å­ç½‘ã€é˜²ç«å¢™è§„åˆ™å’Œç½‘ç»œè®¾å¤‡ï¼Œå¦‚ Cloud Routerã€Cloud VPN å’Œäº‘è´Ÿè½½å‡è¡¡å™¨ã€‚</td></tr><tr><td><strong><code>gcp-billing-admins</code></strong><br><em>ï¼ˆæ£€æŸ¥è¡¨æ‰€éœ€ï¼‰</em></td><td>è®¾ç½®è®¡è´¹è´¦æˆ·å¹¶ç›‘æ§å…¶ä½¿ç”¨æƒ…å†µã€‚</td></tr><tr><td><strong><code>gcp-developers</code></strong><br><em>ï¼ˆæ£€æŸ¥è¡¨æ‰€éœ€ï¼‰</em></td><td>è®¾è®¡ã€ç¼–ç å’Œæµ‹è¯•åº”ç”¨ç¨‹åºã€‚</td></tr><tr><td><strong><code>gcp-security-admins</code></strong><br></td><td>ä¸ºæ•´ä¸ªç»„ç»‡å»ºç«‹å’Œç®¡ç†å®‰å…¨æ”¿ç­–ï¼ŒåŒ…æ‹¬è®¿é—®ç®¡ç†å’Œ<a href="https://cloud.google.com/resource-manager/docs/organization-policy/org-policy-constraints">ç»„ç»‡çº¦æŸæ”¿ç­–</a>ã€‚æœ‰å…³è§„åˆ’ Google Cloud å®‰å…¨åŸºç¡€è®¾æ–½çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…<a href="https://cloud.google.com/architecture/security-foundations/authentication-authorization#users_and_groups">Google Cloud å®‰å…¨åŸºç¡€æŒ‡å—</a>ã€‚</td></tr><tr><td><strong><code>gcp-devops</code></strong></td><td>åˆ›å»ºæˆ–ç®¡ç†æ”¯æŒæŒç»­é›†æˆå’Œäº¤ä»˜ã€ç›‘æ§å’Œç³»ç»Ÿé…ç½®çš„ç«¯åˆ°ç«¯ç®¡é“ã€‚</td></tr><tr><td><strong><code>gcp-logging-admins</code></strong></td><td></td></tr><tr><td><strong><code>gcp-logging-viewers</code></strong></td><td></td></tr><tr><td><strong><code>gcp-monitor-admins</code></strong></td><td></td></tr><tr><td><strong><code>gcp-billing-viewer</code></strong><br><em>ï¼ˆä¸å†é»˜è®¤ï¼‰</em></td><td>ç›‘æ§é¡¹ç›®çš„æ”¯å‡ºã€‚å…¸å‹æˆå‘˜æ˜¯è´¢åŠ¡å›¢é˜Ÿçš„ä¸€éƒ¨åˆ†ã€‚</td></tr><tr><td><strong><code>gcp-platform-viewer</code></strong><br><em>ï¼ˆä¸å†é»˜è®¤ï¼‰</em></td><td>å®¡æŸ¥ Google Cloud ç»„ç»‡ä¸­çš„èµ„æºä¿¡æ¯ã€‚</td></tr><tr><td><strong><code>gcp-security-reviewer</code></strong><br><em>ï¼ˆä¸å†é»˜è®¤ï¼‰</em></td><td>å®¡æŸ¥äº‘å®‰å…¨ã€‚</td></tr><tr><td><strong><code>gcp-network-viewer</code></strong><br><em>ï¼ˆä¸å†é»˜è®¤ï¼‰</em></td><td>å®¡æŸ¥ç½‘ç»œé…ç½®ã€‚</td></tr><tr><td><strong><code>grp-gcp-audit-viewer</code></strong><br><em>ï¼ˆä¸å†é»˜è®¤ï¼‰</em></td><td>æŸ¥çœ‹å®¡è®¡æ—¥å¿—ã€‚</td></tr><tr><td><strong><code>gcp-scc-admin</code></strong><br><em>ï¼ˆä¸å†é»˜è®¤ï¼‰</em></td><td>ç®¡ç†å®‰å…¨æŒ‡æŒ¥ä¸­å¿ƒã€‚</td></tr><tr><td><strong><code>gcp-secrets-admin</code></strong><br><em>ï¼ˆä¸å†é»˜è®¤ï¼‰</em></td><td>ç®¡ç† Secret Manager ä¸­çš„ç§˜å¯†ã€‚</td></tr></tbody></table>

## **é»˜è®¤å¯†ç æ”¿ç­–**

* å¼ºåˆ¶ä½¿ç”¨å¼ºå¯†ç 
* é•¿åº¦åœ¨ 8 åˆ° 100 ä¸ªå­—ç¬¦ä¹‹é—´
* ä¸å…è®¸é‡å¤ä½¿ç”¨
* æ— åˆ°æœŸæ—¶é—´
* å¦‚æœé€šè¿‡ç¬¬ä¸‰æ–¹æä¾›å•†è®¿é—® Workspaceï¼Œè¿™äº›è¦æ±‚ä¸é€‚ç”¨ã€‚

<figure><img src="../../.gitbook/assets/image (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

<figure><img src="../../.gitbook/assets/image (2) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

## **æœåŠ¡è´¦æˆ·**

è¿™äº›æ˜¯**èµ„æº**å¯ä»¥**é™„åŠ **å¹¶è®¿é—®ä»¥ä¾¿ä¸ GCP è½»æ¾äº¤äº’çš„ä¸»ä½“ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥åœ¨å…ƒæ•°æ®ä¸­è®¿é—®**é™„åŠ åˆ° VM çš„æœåŠ¡è´¦æˆ·**çš„**èº«ä»½éªŒè¯ä»¤ç‰Œ**ã€‚\
ä½¿ç”¨**IAM å’Œè®¿é—®èŒƒå›´**æ—¶å¯èƒ½ä¼šé‡åˆ°ä¸€äº›**å†²çª**ã€‚ä¾‹å¦‚ï¼Œä½ çš„æœåŠ¡è´¦æˆ·å¯èƒ½å…·æœ‰ `compute.instanceAdmin` çš„ IAM è§’è‰²ï¼Œä½†ä½ å…¥ä¾µçš„å®ä¾‹è¢«é™åˆ¶ä¸º `https://www.googleapis.com/auth/compute.readonly` çš„èŒƒå›´ã€‚è¿™å°†é˜»æ­¢ä½ ä½¿ç”¨è‡ªåŠ¨åˆ†é…ç»™å®ä¾‹çš„ OAuth ä»¤ç‰Œè¿›è¡Œä»»ä½•æ›´æ”¹ã€‚

è¿™ç±»ä¼¼äº**AWS çš„ IAM è§’è‰²**ã€‚ä½†ä¸ AWS ä¸åŒï¼Œ**ä»»ä½•**æœåŠ¡è´¦æˆ·éƒ½å¯ä»¥**é™„åŠ åˆ°ä»»ä½•æœåŠ¡**ï¼ˆä¸éœ€è¦é€šè¿‡ç­–ç•¥å…è®¸ï¼‰ã€‚

ä½ ä¼šå‘ç°çš„å‡ ä¸ªæœåŠ¡è´¦æˆ·å®é™…ä¸Šæ˜¯**å½“ä½ å¼€å§‹ä½¿ç”¨æŸä¸ªæœåŠ¡æ—¶ç”± GCP è‡ªåŠ¨ç”Ÿæˆçš„**ï¼Œä¾‹å¦‚ï¼š
```
PROJECT_NUMBER-compute@developer.gserviceaccount.com
PROJECT_ID@appspot.gserviceaccount.com
```
ç„¶è€Œï¼Œä¹Ÿå¯ä»¥åˆ›å»ºå’Œé™„åŠ åˆ°èµ„æº**è‡ªå®šä¹‰æœåŠ¡è´¦æˆ·**ï¼Œå…¶å½¢å¼å¦‚ä¸‹ï¼š
```
SERVICE_ACCOUNT_NAME@PROJECT_NAME.iam.gserviceaccount.com
```
### **Access scopes**

è®¿é—®èŒƒå›´æ˜¯**é™„åŠ åˆ°ç”Ÿæˆçš„OAuthä»¤ç‰Œ**ä»¥è®¿é—®GCP APIç«¯ç‚¹ã€‚å®ƒä»¬**é™åˆ¶äº†OAuthä»¤ç‰Œçš„æƒé™**ã€‚\
è¿™æ„å‘³ç€å¦‚æœä¸€ä¸ªä»¤ç‰Œå±äºèµ„æºçš„æ‰€æœ‰è€…ï¼Œä½†åœ¨ä»¤ç‰ŒèŒƒå›´å†…æ²¡æœ‰è®¿é—®è¯¥èµ„æºçš„æƒé™ï¼Œåˆ™è¯¥ä»¤ç‰Œ**ä¸èƒ½ç”¨äºï¼ˆæ»¥ç”¨ï¼‰è¿™äº›ç‰¹æƒ**ã€‚

è°·æ­Œå®é™…ä¸Š[å»ºè®®](https://cloud.google.com/compute/docs/access/service-accounts#service\_account\_permissions) **ä¸è¦ä½¿ç”¨è®¿é—®èŒƒå›´ï¼Œè€Œå®Œå…¨ä¾èµ–IAM**ã€‚Webç®¡ç†é—¨æˆ·å®é™…ä¸Šå¼ºåˆ¶æ‰§è¡Œè¿™ä¸€ç‚¹ï¼Œä½†è®¿é—®èŒƒå›´ä»ç„¶å¯ä»¥é€šè¿‡ç¼–ç¨‹æ–¹å¼åº”ç”¨äºä½¿ç”¨è‡ªå®šä¹‰æœåŠ¡å¸æˆ·çš„å®ä¾‹ã€‚

ä½ å¯ä»¥é€šè¿‡**æŸ¥è¯¢**æ¥æŸ¥çœ‹**åˆ†é…çš„** **èŒƒå›´**ï¼š

{% code overflow="wrap" %}
```bash
curl 'https://www.googleapis.com/oauth2/v1/tokeninfo?access_token=<access_token>'

{
"issued_to": "223044615559.apps.googleusercontent.com",
"audience": "223044615559.apps.googleusercontent.com",
"user_id": "139746512919298469201",
"scope": "openid https://www.googleapis.com/auth/userinfo.email https://www.googleapis.com/auth/cloud-platform https://www.googleapis.com/auth/appengine.admin https://www.googleapis.com/auth/sqlservice.login https://www.googleapis.com/auth/compute https://www.googleapis.com/auth/accounts.reauth",
"expires_in": 2253,
"email": "username@testing.com",
"verified_email": true,
"access_type": "offline"
}
```
{% endcode %}

å‰é¢çš„ **scopes** æ˜¯ä½¿ç”¨ **`gcloud`** è®¿é—®æ•°æ®æ—¶ **é»˜è®¤** ç”Ÿæˆçš„ã€‚è¿™æ˜¯å› ä¸ºå½“ä½ ä½¿ç”¨ **`gcloud`** æ—¶ï¼Œé¦–å…ˆä¼šåˆ›å»ºä¸€ä¸ª OAuth ä»¤ç‰Œï¼Œç„¶åä½¿ç”¨å®ƒæ¥è”ç³»ç«¯ç‚¹ã€‚

å…¶ä¸­æœ€é‡è¦çš„ scope å¯èƒ½æ˜¯ **`cloud-platform`**ï¼Œè¿™åŸºæœ¬ä¸Šæ„å‘³ç€å¯ä»¥ **è®¿é—® GCP ä¸­çš„ä»»ä½•æœåŠ¡**ã€‚

ä½ å¯ä»¥ **åœ¨è¿™é‡Œæ‰¾åˆ°æ‰€æœ‰å¯èƒ½çš„ scopes åˆ—è¡¨** [**all the possible scopes in here**](https://developers.google.com/identity/protocols/googlescopes)**.**

å¦‚æœä½ æœ‰ **`gcloud`** æµè§ˆå™¨å‡­è¯ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼ **è·å–å…·æœ‰å…¶ä»– scopes çš„ä»¤ç‰Œ**ï¼š

{% code overflow="wrap" %}
```bash
# Maybe you can get a user token with other scopes changing the scopes array from ~/.config/gcloud/credentials.db

# Set new scopes for SDKs credentials
gcloud auth application-default login --scopes=https://www.googleapis.com/auth/userinfo.email,https://www.googleapis.com/auth/cloud-platform,https://www.googleapis.com/auth/sqlservice.login,https://www.googleapis.com/auth/appengine.admin,https://www.googleapis.com/auth/compute,https://www.googleapis.com/auth/accounts.reauth,https://www.googleapis.com/auth/admin.directory.user,https://www.googleapis.com/auth/admin.directory.group,https://www.googleapis.com/auth/admin.directory.domain,https://www.googleapis.com/auth/admin.directory.user

# Print new token
gcloud auth application-default print-access-token

# To use this token with some API you might need to use curl to indicate the project header with --header "X-Goog-User-Project: <project-name>"
```
{% endcode %}

## **Terraform IAM Policies, Bindings and Memberships**

æ ¹æ®terraformåœ¨[https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/google\_project\_iam](https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/google\_project\_iam)ä¸­çš„å®šä¹‰ï¼Œä½¿ç”¨terraformä¸GCPæ—¶ï¼Œæœ‰ä¸åŒçš„æ–¹æ³•æˆäºˆä¸»ä½“å¯¹èµ„æºçš„è®¿é—®æƒé™ï¼š

* **Memberships**: ä½ å¯ä»¥å°†**ä¸»ä½“è®¾ç½®ä¸ºè§’è‰²çš„æˆå‘˜**ï¼Œ**æ²¡æœ‰å¯¹è§’è‰²æˆ–ä¸»ä½“çš„é™åˆ¶**ã€‚ä½ å¯ä»¥å°†ä¸€ä¸ªç”¨æˆ·è®¾ç½®ä¸ºä¸€ä¸ªè§’è‰²çš„æˆå‘˜ï¼Œç„¶åå°†ä¸€ä¸ªç»„è®¾ç½®ä¸ºåŒä¸€è§’è‰²çš„æˆå‘˜ï¼Œå¹¶ä¸”è¿˜å¯ä»¥å°†è¿™äº›ä¸»ä½“ï¼ˆç”¨æˆ·å’Œç»„ï¼‰è®¾ç½®ä¸ºå…¶ä»–è§’è‰²çš„æˆå‘˜ã€‚
* **Bindings**: å¤šä¸ª**ä¸»ä½“å¯ä»¥ç»‘å®šåˆ°ä¸€ä¸ªè§’è‰²**ã€‚è¿™äº›**ä¸»ä½“ä»ç„¶å¯ä»¥ç»‘å®šæˆ–æˆä¸ºå…¶ä»–è§’è‰²çš„æˆå‘˜**ã€‚ç„¶è€Œï¼Œå¦‚æœä¸€ä¸ªæœªç»‘å®šåˆ°è¯¥è§’è‰²çš„ä¸»ä½“è¢«è®¾ç½®ä¸º**ç»‘å®šè§’è‰²çš„æˆå‘˜**ï¼Œé‚£ä¹ˆä¸‹æ¬¡**åº”ç”¨ç»‘å®šæ—¶ï¼Œè¯¥æˆå‘˜å…³ç³»å°†æ¶ˆå¤±**ã€‚
* **Policies**: ç­–ç•¥æ˜¯**æƒå¨æ€§çš„**ï¼Œå®ƒæŒ‡ç¤ºè§’è‰²å’Œä¸»ä½“ï¼Œç„¶åï¼Œ**è¿™äº›ä¸»ä½“ä¸èƒ½æ‹¥æœ‰æ›´å¤šçš„è§’è‰²ï¼Œè¿™äº›è§’è‰²ä¹Ÿä¸èƒ½æ‹¥æœ‰æ›´å¤šçš„ä¸»ä½“**ï¼Œé™¤éè¯¥ç­–ç•¥è¢«ä¿®æ”¹ï¼ˆå³ä½¿åœ¨å…¶ä»–ç­–ç•¥ã€ç»‘å®šæˆ–æˆå‘˜å…³ç³»ä¸­ä¹Ÿä¸è¡Œï¼‰ã€‚å› æ­¤ï¼Œå½“ç­–ç•¥ä¸­æŒ‡å®šäº†è§’è‰²æˆ–ä¸»ä½“æ—¶ï¼Œå…¶æ‰€æœ‰æƒé™éƒ½**å—è¯¥ç­–ç•¥é™åˆ¶**ã€‚æ˜¾ç„¶ï¼Œå¦‚æœä¸»ä½“è¢«èµ‹äºˆä¿®æ”¹ç­–ç•¥æˆ–æƒé™å‡çº§çš„æƒé™ï¼ˆå¦‚åˆ›å»ºä¸€ä¸ªæ–°ä¸»ä½“å¹¶å°†å…¶ç»‘å®šåˆ°ä¸€ä¸ªæ–°è§’è‰²ï¼‰ï¼Œè¿™å¯ä»¥è¢«ç»•è¿‡ã€‚

## References

* [https://about.gitlab.com/blog/2020/02/12/plundering-gcp-escalating-privileges-in-google-cloud-platform/](https://about.gitlab.com/blog/2020/02/12/plundering-gcp-escalating-privileges-in-google-cloud-platform/)
* [https://cloud.google.com/resource-manager/docs/cloud-platform-resource-hierarchy](https://cloud.google.com/resource-manager/docs/cloud-platform-resource-hierarchy)

{% hint style="success" %}
å­¦ä¹ å’Œç»ƒä¹ AWS Hackingï¼š<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
å­¦ä¹ å’Œç»ƒä¹ GCP Hackingï¼š<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>æ”¯æŒHackTricks</summary>

* æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**telegramç¾¤ç»„**](https://t.me/peass) æˆ– **å…³æ³¨** æˆ‘ä»¬çš„ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **é€šè¿‡æäº¤PRåˆ†äº«é»‘å®¢æŠ€å·§åˆ°** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) githubä»“åº“ã€‚

</details>
{% endhint %}
