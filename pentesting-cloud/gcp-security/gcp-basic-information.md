# GCP - Temel Bilgiler

{% hint style="success" %}
AWS Hacking Ã¶ÄŸrenin ve pratik yapÄ±n:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCP Hacking Ã¶ÄŸrenin ve pratik yapÄ±n: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**abonelik planlarÄ±nÄ±**](https://github.com/sponsors/carlospolop) kontrol edin!
* **ğŸ’¬ Discord grubuna** [**katÄ±lÄ±n**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n ya da **Twitter'da** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live) **bizi takip edin.**
* **HackTricks'e PR gÃ¶ndererek hacking ipuÃ§larÄ±nÄ± paylaÅŸÄ±n** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na.

</details>
{% endhint %}

## **Kaynak HiyerarÅŸisi**

Google Cloud, kavramsal olarak geleneksel bir dosya sistemine benzer bir [Kaynak hiyerarÅŸisi](https://cloud.google.com/resource-manager/docs/cloud-platform-resource-hierarchy) kullanÄ±r. Bu, politikalar ve izinler iÃ§in belirli ekleme noktalarÄ± ile mantÄ±ksal bir ebeveyn/Ã§ocuk iÅŸ akÄ±ÅŸÄ± saÄŸlar.

YÃ¼ksek seviyede, ÅŸÃ¶yle gÃ¶rÃ¼nÃ¼r:
```
Organization
--> Folders
--> Projects
--> Resources
```
Bir sanal makine (Compute Instance olarak adlandÄ±rÄ±lÄ±r) bir kaynaktÄ±r. Bir kaynak, muhtemelen diÄŸer Compute Instance'lar, depolama kovalarÄ± vb. ile birlikte bir projede bulunur.

<figure><img src="../../.gitbook/assets/image (1).png" alt=""><figcaption><p><a href="https://cloud.google.com/static/resource-manager/img/cloud-hierarchy.svg">https://cloud.google.com/static/resource-manager/img/cloud-hierarchy.svg</a></p></figcaption></figure>

## **Projelerin TaÅŸÄ±nmasÄ±**

`roles/resourcemanager.projectCreator` ve `roles/resourcemanager.projectMover` izinlerine sahip bir organizasyona **herhangi bir organizasyona baÄŸlÄ± olmayan bir projeyi taÅŸÄ±mak mÃ¼mkÃ¼ndÃ¼r**. Proje baÅŸka bir organizasyonun iÃ§indeyse, **Ã¶nce organizasyondan Ã§Ä±karmak iÃ§in** GCP desteÄŸi ile iletiÅŸime geÃ§mek gereklidir. Daha fazla bilgi iÃ§in [**buraya**](https://medium.com/google-cloud/migrating-a-project-from-one-organization-to-another-gcp-4b37a86dd9e6) bakÄ±n.

## **Organizasyon PolitikalarÄ±**

Organizasyonunuzun bulut kaynaklarÄ± Ã¼zerinde merkezi kontrol saÄŸlar:

* Organizasyonunuzun kaynaklarÄ±nÄ±n nasÄ±l kullanÄ±labileceÄŸi konusunda **kÄ±sÄ±tlamalar yapÄ±landÄ±rmak** iÃ§in merkezi kontrol saÄŸlar.
* GeliÅŸtirme ekiplerinizin uyumluluk sÄ±nÄ±rlarÄ± iÃ§inde kalmasÄ±nÄ± saÄŸlamak iÃ§in **koruyucu Ã¶nlemler** tanÄ±mlar ve kurar.
* Proje sahiplerine ve ekiplerine uyumluluÄŸu bozma endiÅŸesi olmadan hÄ±zlÄ± hareket etmelerine yardÄ±mcÄ± olur.

Bu politikalar, **tÃ¼m organizasyonu, klasÃ¶r(ler)i veya proje(ler)i etkileyecek ÅŸekilde oluÅŸturulabilir**. Hedeflenen kaynak hiyerarÅŸi dÃ¼ÄŸÃ¼mÃ¼nÃ¼n alt Ã¶ÄŸeleri **organizasyon politikasÄ±nÄ± devralÄ±r**.

Bir organizasyon politikasÄ± **tanÄ±mlamak** iÃ§in, bir Google Cloud hizmetine veya bir grup Google Cloud hizmetine karÅŸÄ± belirli bir tÃ¼r kÄ±sÄ±tlama olan bir [**kÄ±sÄ±tlama**](https://cloud.google.com/resource-manager/docs/organization-policy/overview#constraints) seÃ§ersiniz. Bu kÄ±sÄ±tlamayÄ± istediÄŸiniz kÄ±sÄ±tlamalarla **yapÄ±landÄ±rÄ±rsÄ±nÄ±z**.

<figure><img src="../../.gitbook/assets/image (5) (4).png" alt=""><figcaption><p><a href="https://cloud.google.com/resource-manager/img/org-policy-concepts.svg">https://cloud.google.com/resource-manager/img/org-policy-concepts.svg</a></p></figcaption></figure>

#### YaygÄ±n kullanÄ±m durumlarÄ± <a href="#common_use_cases" id="common_use_cases"></a>

* Alan adÄ±na dayalÄ± kaynak paylaÅŸÄ±mÄ±nÄ± sÄ±nÄ±rlayÄ±n.
* Identity and Access Management hizmet hesaplarÄ±nÄ±n kullanÄ±mÄ±nÄ± sÄ±nÄ±rlayÄ±n.
* Yeni oluÅŸturulan kaynaklarÄ±n fiziksel konumunu kÄ±sÄ±tlayÄ±n.
* Hizmet hesabÄ± oluÅŸturmayÄ± devre dÄ±ÅŸÄ± bÄ±rakÄ±n.

<figure><img src="../../.gitbook/assets/image (83).png" alt=""><figcaption></figcaption></figure>

Organizasyonunuzun kaynaklarÄ± Ã¼zerinde ince ayar kontrolÃ¼ saÄŸlayan birÃ§ok baÅŸka kÄ±sÄ±tlama vardÄ±r. **Daha fazla bilgi iÃ§in,** [**tÃ¼m Organizasyon PolitikasÄ± Hizmeti kÄ±sÄ±tlamalarÄ±nÄ±n listesini**](https://cloud.google.com/resource-manager/docs/organization-policy/org-policy-constraints) **gÃ¶rÃ¼n.**

### **VarsayÄ±lan Organizasyon PolitikalarÄ±**

<details>

<summary>GCP organizasyonunuzu kurarken Google'Ä±n varsayÄ±lan olarak ekleyeceÄŸi politikalar ÅŸunlardÄ±r:</summary>

**EriÅŸim YÃ¶netimi PolitikalarÄ±**

* **Alan adÄ± kÄ±sÄ±tlÄ± kiÅŸiler:** Belirtilen alan adlarÄ±nÄ±z dÄ±ÅŸÄ±ndaki kullanÄ±cÄ±larÄ±n Essential Contacts'a eklenmesini engeller. Bu, Essential Contacts'Ä±n yalnÄ±zca seÃ§ilen alanlarÄ±nÄ±zdaki yÃ¶netilen kullanÄ±cÄ± kimliklerinin platform bildirimlerini almasÄ±na izin verir.
* **Alan adÄ± kÄ±sÄ±tlÄ± paylaÅŸÄ±m:** Belirtilen alan adlarÄ±nÄ±z dÄ±ÅŸÄ±ndaki kullanÄ±cÄ±larÄ±n IAM politikalarÄ±na eklenmesini engeller. Bu, IAM politikalarÄ±nÄ±n yalnÄ±zca seÃ§ilen alanlarÄ±nÄ±zdaki yÃ¶netilen kullanÄ±cÄ± kimliklerinin bu organizasyon iÃ§indeki kaynaklara eriÅŸmesine izin verir.
* **Genel eriÅŸim Ã¶nleme:** Cloud Storage kovalarÄ±nÄ±n halka aÃ§Ä±k olmasÄ±nÄ± engeller. Bu, bir geliÅŸtiricinin Cloud Storage kovalarÄ±nÄ± kimliÄŸi doÄŸrulanmamÄ±ÅŸ internet eriÅŸimine sahip olacak ÅŸekilde yapÄ±landÄ±ramayacaÄŸÄ±nÄ± garanti eder.
* **TekdÃ¼ze kova dÃ¼zeyi eriÅŸimi:** Cloud Storage kovalarÄ±ndaki nesne dÃ¼zeyi eriÅŸim kontrol listelerini (ACL'ler) engeller. Bu, IAM politikalarÄ±nÄ± Cloud Storage kovalarÄ±ndaki tÃ¼m nesneler arasÄ±nda tutarlÄ± bir ÅŸekilde uygulayarak eriÅŸim yÃ¶netiminizi basitleÅŸtirir.
* **OS giriÅŸini zorunlu kÄ±l:** Yeni projelerde oluÅŸturulan VM'lerde OS Login etkinleÅŸtirilecektir. Bu, bireysel SSH anahtarlarÄ± oluÅŸturup yÃ¶netmeye gerek kalmadan IAM kullanarak Ã¶rneklerinize SSH eriÅŸimini yÃ¶netmenizi saÄŸlar.

**Hizmet hesaplarÄ± iÃ§in ek gÃ¼venlik politikalarÄ±**

* **Otomatik IAM yetkilerini devre dÄ±ÅŸÄ± bÄ±rak:** VarsayÄ±lan App Engine ve Compute Engine hizmet hesaplarÄ±nÄ±n oluÅŸturma sÄ±rasÄ±nda otomatik olarak projede Editor IAM rolÃ¼ verilmesini engeller. Bu, hizmet hesaplarÄ±nÄ±n oluÅŸturma sÄ±rasÄ±nda aÅŸÄ±rÄ± yetkili IAM rolleri almamasÄ±nÄ± saÄŸlar.
* **Hizmet hesabÄ± anahtarÄ± oluÅŸturmayÄ± devre dÄ±ÅŸÄ± bÄ±rak:** Genel hizmet hesabÄ± anahtarlarÄ±nÄ±n oluÅŸturulmasÄ±nÄ± engeller. Bu, kalÄ±cÄ± kimlik bilgilerini ifÅŸa etme riskini azaltmaya yardÄ±mcÄ± olur.
* **Hizmet hesabÄ± anahtarÄ± yÃ¼klemeyi devre dÄ±ÅŸÄ± bÄ±rak:** Genel hizmet hesabÄ± anahtarlarÄ±nÄ±n yÃ¼klenmesini engeller. Bu, sÄ±zdÄ±rÄ±lmÄ±ÅŸ veya yeniden kullanÄ±lan anahtar materyalinin riskini azaltmaya yardÄ±mcÄ± olur.

**GÃ¼venli VPC aÄŸ yapÄ±landÄ±rma politikalarÄ±**

* **VM Ã¶rnekleri iÃ§in izin verilen dÄ±ÅŸ IP'leri tanÄ±mlayÄ±n:** Ä°nternet trafiÄŸine maruz kalabilecek genel IP'ye sahip Compute Ã¶rneklerinin oluÅŸturulmasÄ±nÄ± engeller.

<!---->

* **VM iÃ§ iÃ§e sanallaÅŸtÄ±rmayÄ± devre dÄ±ÅŸÄ± bÄ±rak:** Compute Engine VM'lerinde iÃ§ iÃ§e VM'lerin oluÅŸturulmasÄ±nÄ± engeller. Bu, izlenmeyen iÃ§ iÃ§e VM'lerin gÃ¼venlik riskini azaltÄ±r.

<!---->

* **VM seri portunu devre dÄ±ÅŸÄ± bÄ±rak:** Compute Engine VM'lerine seri port eriÅŸimini engeller. Bu, Compute Engine API'sini kullanarak bir sunucunun seri portuna giriÅŸ yapÄ±lmasÄ±nÄ± engeller.

<!---->

* **Cloud SQL Ã¶rneklerinde yetkili aÄŸlarÄ± kÄ±sÄ±tlayÄ±n:** Cloud SQL veritabanlarÄ±nÄ±za genel veya dahili olmayan aÄŸ aralÄ±klarÄ±nÄ±n eriÅŸimini engeller.

<!---->

* **IP Adresi tÃ¼rÃ¼ne gÃ¶re Protokol YÃ¶nlendirmesini KÄ±sÄ±tlayÄ±n:** DÄ±ÅŸ IP adresleri iÃ§in VM protokol yÃ¶nlendirmesini engeller.

<!---->

* **Cloud SQL Ã¶rneklerinde genel IP eriÅŸimini kÄ±sÄ±tlayÄ±n:** Ä°nternet trafiÄŸine maruz kalabilecek genel IP'ye sahip Cloud SQL Ã¶rneklerinin oluÅŸturulmasÄ±nÄ± engeller.

<!---->

* **PaylaÅŸÄ±lan VPC proje iptali kÄ±sÄ±tlamasÄ±nÄ± kaldÄ±rmayÄ± kÄ±sÄ±tlayÄ±n:** PaylaÅŸÄ±lan VPC ana projelerinin yanlÄ±ÅŸlÄ±kla silinmesini engeller.

<!---->

* **Yeni projeler iÃ§in dahili DNS ayarÄ±nÄ± yalnÄ±zca BÃ¶lgesel DNS olarak ayarlar:** Hizmet kullanÄ±labilirliÄŸi azalmÄ±ÅŸ eski bir DNS ayarÄ±nÄ±n kullanÄ±lmasÄ±nÄ± engeller.

<!---->

* **VarsayÄ±lan aÄŸ oluÅŸturmayÄ± atla:** VarsayÄ±lan VPC aÄŸÄ± ve ilgili kaynaklarÄ±n otomatik olarak oluÅŸturulmasÄ±nÄ± engeller. Bu, aÅŸÄ±rÄ± yetkili varsayÄ±lan gÃ¼venlik duvarÄ± kurallarÄ±ndan kaÃ§Ä±nÄ±r.

<!---->

* **VPC DÄ±ÅŸ IPv6 kullanÄ±mÄ±nÄ± devre dÄ±ÅŸÄ± bÄ±rak:** Yetkisiz internet eriÅŸimine maruz kalabilecek dÄ±ÅŸ IPv6 alt aÄŸlarÄ±nÄ±n oluÅŸturulmasÄ±nÄ± engeller.

</details>

## **IAM Rolleri**

Bunlar AWS'deki IAM politikalarÄ± gibidir Ã§Ã¼nkÃ¼ **her rol bir dizi izin iÃ§erir.**

Ancak, AWS'den farklÄ± olarak, **merkezi bir rol deposu yoktur**. Bunun yerine, **kaynaklar Y yetkililerine X eriÅŸim rolleri verir** ve bir kaynaÄŸa kimin eriÅŸimi olduÄŸunu Ã¶ÄŸrenmenin tek yolu, **o kaynak Ã¼zerinde `get-iam-policy` yÃ¶ntemini kullanmaktÄ±r**.\
Bu bir sorun olabilir Ã§Ã¼nkÃ¼ bu, bir yetkilinin hangi izinlere sahip olduÄŸunu Ã¶ÄŸrenmenin tek yolunun **her kaynaÄŸa kime izin verdiÄŸini sormak** olduÄŸu anlamÄ±na gelir ve bir kullanÄ±cÄ±nÄ±n tÃ¼m kaynaklardan izin alma yetkisi olmayabilir.

IAM'de **Ã¼Ã§ tÃ¼r** rol vardÄ±r:

* **Temel/Ä°lkel roller**, IAM'in tanÄ±tÄ±lmasÄ±ndan Ã¶nce var olan **Owner**, **Editor** ve **Viewer** rollerini iÃ§erir.
* **Ã–nceden tanÄ±mlanmÄ±ÅŸ roller**, belirli bir hizmet iÃ§in ayrÄ±ntÄ±lÄ± eriÅŸim saÄŸlar ve Google Cloud tarafÄ±ndan yÃ¶netilir. BirÃ§ok Ã¶nceden tanÄ±mlanmÄ±ÅŸ rol vardÄ±r, **sahip olduklarÄ± ayrÄ±calÄ±klarla birlikte hepsini** [**burada**](https://cloud.google.com/iam/docs/understanding-roles#predefined\_roles) **gÃ¶rebilirsiniz**.
* **Ã–zel roller**, kullanÄ±cÄ± tarafÄ±ndan belirlenen bir izin listesine gÃ¶re ayrÄ±ntÄ±lÄ± eriÅŸim saÄŸlar.

GCP'de binlerce izin vardÄ±r. Bir rolÃ¼n bir izne sahip olup olmadÄ±ÄŸÄ±nÄ± kontrol etmek iÃ§in [**burada izni arayabilir**](https://cloud.google.com/iam/docs/permissions-reference) ve hangi rollerin bu izne sahip olduÄŸunu gÃ¶rebilirsiniz.

AyrÄ±ca [**her Ã¼rÃ¼n tarafÄ±ndan sunulan Ã¶nceden tanÄ±mlanmÄ±ÅŸ rolleri**](https://cloud.google.com/iam/docs/understanding-roles#product\_specific\_documentation) **burada arayabilirsiniz.** BazÄ± **rollerin** kullanÄ±cÄ±larla iliÅŸkilendirilemeyeceÄŸini ve **yalnÄ±zca bazÄ± izinler** iÃ§erdikleri iÃ§in SA'larla iliÅŸkilendirilebileceÄŸini unutmayÄ±n.\
AyrÄ±ca, **izinlerin** yalnÄ±zca **ilgili hizmete baÄŸlÄ± olduklarÄ±nda** **etkili olacaÄŸÄ±nÄ±** unutmayÄ±n.

Veya bir **Ã¶zel rolÃ¼n belirli bir izni kullanÄ±p kullanamayacaÄŸÄ±nÄ±** [**burada**](https://cloud.google.com/iam/docs/custom-roles-permissions-support) **kontrol edin.**

{% content-ref url="gcp-services/gcp-iam-and-org-policies-enum.md" %}
[gcp-iam-and-org-policies-enum.md](gcp-services/gcp-iam-and-org-policies-enum.md)
{% endcontent-ref %}

## KullanÄ±cÄ±lar <a href="#default-credentials" id="default-credentials"></a>

**GCP konsolunda** **KullanÄ±cÄ±lar veya Gruplar** yÃ¶netimi yoktur, bu **Google Workspace**'te yapÄ±lÄ±r. Ancak, Google Workspace'te farklÄ± bir kimlik saÄŸlayÄ±cÄ±sÄ±nÄ± senkronize edebilirsiniz.

Workspaces **kullanÄ±cÄ±larÄ±na ve gruplarÄ±na** [**https://admin.google.com**](https://admin.google.com/) adresinden eriÅŸebilirsiniz.

**MFA** Workspaces kullanÄ±cÄ±larÄ±na **zorlanabilir**, ancak bir **saldÄ±rgan** GCP'ye **cli Ã¼zerinden eriÅŸmek iÃ§in bir token kullanabilir ve bu token MFA ile korunmaz** (yalnÄ±zca kullanÄ±cÄ± giriÅŸ yaptÄ±ÄŸÄ±nda MFA ile korunur: `gcloud auth login`).

## Gruplar

Bir organizasyon oluÅŸturulduÄŸunda, birkaÃ§ grup **gÃ¼Ã§lÃ¼ bir ÅŸekilde oluÅŸturulmasÄ± Ã¶nerilir.** Bunlardan herhangi birini yÃ¶netiyorsanÄ±z, organizasyonun tamamÄ±nÄ± veya Ã¶nemli bir kÄ±smÄ±nÄ± tehlikeye atmÄ±ÅŸ olabilirsiniz:

<table data-header-hidden><thead><tr><th width="299.3076923076923"></th><th></th></tr></thead><tbody><tr><td><strong>Grup</strong></td><td><strong>Fonksiyon</strong></td></tr><tr><td><strong><code>gcp-organization-admins</code></strong><br><em>(kontrol listesi iÃ§in grup veya bireysel hesaplar gereklidir)</em></td><td>Organizasyona ait herhangi bir kaynaÄŸÄ± yÃ¶netmek. Bu rolÃ¼ dikkatli bir ÅŸekilde atayÄ±n; organizasyon yÃ¶neticileri tÃ¼m Google Cloud kaynaklarÄ±nÄ±za eriÅŸebilir. Alternatif olarak, bu iÅŸlev yÃ¼ksek derecede ayrÄ±calÄ±klÄ± olduÄŸundan, bir grup oluÅŸturmak yerine bireysel hesaplar kullanmayÄ± dÃ¼ÅŸÃ¼nÃ¼n.</td></tr><tr><td><strong><code>gcp-network-admins</code></strong><br><em>(kontrol listesi iÃ§in gereklidir)</em></td><td>AÄŸlar, alt aÄŸlar, gÃ¼venlik duvarÄ± kurallarÄ± ve Cloud Router, Cloud VPN ve bulut yÃ¼k dengeleyiciler gibi aÄŸ cihazlarÄ± oluÅŸturmak.</td></tr><tr><td><strong><code>gcp-billing-admins</code></strong><br><em>(kontrol listesi iÃ§in gereklidir)</em></td><td>Fatura hesaplarÄ±nÄ± kurmak ve kullanÄ±mÄ±nÄ± izlemek.</td></tr><tr><td><strong><code>gcp-developers</code></strong><br><em>(kontrol listesi iÃ§in gereklidir)</em></td><td>UygulamalarÄ± tasarlamak, kodlamak ve test etmek.</td></tr><tr><td><strong><code>gcp-security-admins</code></strong><br></td><td>EriÅŸim yÃ¶netimi ve <a href="https://cloud.google.com/resource-manager/docs/organization-policy/org-policy-constraints">organizasyon kÄ±sÄ±tlama politikalarÄ±</a> dahil olmak Ã¼zere tÃ¼m organizasyon iÃ§in gÃ¼venlik politikalarÄ± oluÅŸturmak ve yÃ¶netmek. Google Cloud gÃ¼venlik altyapÄ±nÄ±zÄ± planlama hakkÄ±nda daha fazla bilgi iÃ§in <a href="https://cloud.google.com/architecture/security-foundations/authentication-authorization#users_and_groups">Google Cloud gÃ¼venlik temelleri kÄ±lavuzuna</a> bakÄ±n.</td></tr><tr><td><strong><code>gcp-devops</code></strong></td><td>SÃ¼rekli entegrasyon ve teslimat, izleme ve sistem saÄŸlama desteÄŸi saÄŸlayan uÃ§tan uca boru hatlarÄ± oluÅŸturmak veya yÃ¶netmek.</td></tr><tr><td><strong><code>gcp-logging-admins</code></strong></td><td></td></tr><tr><td><strong><code>gcp-logging-viewers</code></strong></td><td></td></tr><tr><td><strong><code>gcp-monitor-admins</code></strong></td><td></td></tr><tr><td><strong><code>gcp-billing-viewer</code></strong><br><em>(artÄ±k varsayÄ±lan olarak deÄŸil)</em></td><td>Projelerdeki harcamalarÄ± izlemek. Tipik Ã¼yeler finans ekibinin bir parÃ§asÄ±dÄ±r.</td></tr><tr><td><strong><code>gcp-platform-viewer</code></strong><br><em>(artÄ±k varsayÄ±lan olarak deÄŸil)</em></td><td>Google Cloud organizasyonu genelinde kaynak bilgilerini gÃ¶zden geÃ§irmek.</td></tr><tr><td><strong><code>gcp-security-reviewer</code></strong><br><em>(artÄ±k varsayÄ±lan olarak deÄŸil)</em></td><td>Bulut gÃ¼venliÄŸini gÃ¶zden geÃ§irmek.</td></tr><tr><td><strong><code>gcp-network-viewer</code></strong><br><em>(artÄ±k varsayÄ±lan olarak deÄŸil)</em></td><td>AÄŸ yapÄ±landÄ±rmalarÄ±nÄ± gÃ¶zden geÃ§irmek.</td></tr><tr><td><strong><code>grp-gcp-audit-viewer</code></strong><br><em>(artÄ±k varsayÄ±lan olarak deÄŸil)</em></td><td>Denetim gÃ¼nlÃ¼klerini gÃ¶rÃ¼ntÃ¼lemek.</td></tr><tr><td><strong><code>gcp-scc-admin</code></strong><br><em>(artÄ±k varsayÄ±lan olarak deÄŸil)</em></td><td>Security Command Center'Ä± yÃ¶netmek.</td></tr><tr><td><strong><code>gcp-secrets-admin</code></strong><br><em>(artÄ±k varsayÄ±lan olarak deÄŸil)</em></td><td>Secret Manager'da sÄ±rlarÄ± yÃ¶netmek.</td></tr></tbody></table>

## **VarsayÄ±lan Åifre PolitikasÄ±**

* GÃ¼Ã§lÃ¼ ÅŸifreleri zorunlu kÄ±l
* 8 ile 100 karakter arasÄ±nda
* Yeniden kullanÄ±m yok
* SÃ¼re sonu yok
* Ä°nsanlar Workspace'e Ã¼Ã§Ã¼ncÃ¼ taraf bir saÄŸlayÄ±cÄ± aracÄ±lÄ±ÄŸÄ±yla eriÅŸiyorsa, bu gereksinimler uygulanmaz.

<figure><img src="../../.gitbook/assets/image (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

<figure><img src="../../.gitbook/assets/image (2) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

## **Hizmet hesaplarÄ±**

Bunlar, **kaynaklarÄ±n** **baÄŸlÄ±** olabileceÄŸi ve GCP ile kolayca etkileÅŸimde bulunabileceÄŸi **yetkililerdir**. Ã–rneÄŸin, bir VM'ye **baÄŸlÄ± bir Hizmet HesabÄ±nÄ±n** **kimlik doÄŸrulama jetonuna** metaveride eriÅŸmek mÃ¼mkÃ¼ndÃ¼r.\
Hem **IAM hem de eriÅŸim kapsamlarÄ±nÄ±** kullanÄ±rken bazÄ± **Ã§akÄ±ÅŸmalar** yaÅŸanabilir. Ã–rneÄŸin, hizmet hesabÄ±nÄ±z `compute.instanceAdmin` IAM rolÃ¼ne sahip olabilir, ancak ele geÃ§irdiÄŸiniz Ã¶rnek `https://www.googleapis.com/auth/compute.readonly` kapsam sÄ±nÄ±rlamasÄ±yla kÄ±sÄ±tlanmÄ±ÅŸ olabilir. Bu, Ã¶rneÄŸinize otomatik olarak atanan OAuth jetonunu kullanarak herhangi bir deÄŸiÅŸiklik yapmanÄ±zÄ± engeller.

AWS'deki **IAM rollerine** benzer. Ancak AWS'den farklÄ± olarak, **herhangi bir** hizmet hesabÄ± **herhangi bir hizmete** baÄŸlanabilir (bir politika aracÄ±lÄ±ÄŸÄ±yla izin vermesi gerekmez).

KarÅŸÄ±laÅŸacaÄŸÄ±nÄ±z hizmet hesaplarÄ±nÄ±n birÃ§oÄŸu aslÄ±nda **GCP tarafÄ±ndan otomatik olarak oluÅŸturulur** hizmeti kullanmaya baÅŸladÄ±ÄŸÄ±nÄ±zda, Ã¶rneÄŸin:
```
PROJECT_NUMBER-compute@developer.gserviceaccount.com
PROJECT_ID@appspot.gserviceaccount.com
```
Ancak, **Ã¶zel hizmet hesaplarÄ±** oluÅŸturmak ve kaynaklara eklemek de mÃ¼mkÃ¼ndÃ¼r, bu ÅŸekilde gÃ¶rÃ¼necektir:
```
SERVICE_ACCOUNT_NAME@PROJECT_NAME.iam.gserviceaccount.com
```
### **Access scopes**

Access scope'lar, GCP API uÃ§ noktalarÄ±na eriÅŸmek iÃ§in **oluÅŸturulan OAuth token'larÄ±na eklenir**. Bu, OAuth token'Ä±nÄ±n **izinlerini kÄ±sÄ±tlar**.\
Bu, bir token'Ä±n bir kaynaÄŸÄ±n Sahibi'ne ait olmasÄ± ancak o kaynaÄŸa eriÅŸim iÃ§in token kapsamÄ±na sahip olmamasÄ± durumunda, token'Ä±n **bu ayrÄ±calÄ±klarÄ± (kÃ¶tÃ¼ye) kullanmak iÃ§in kullanÄ±lamayacaÄŸÄ±** anlamÄ±na gelir.

Google aslÄ±nda **access scope'larÄ±n kullanÄ±lmamasÄ±nÄ± ve tamamen IAM'e gÃ¼venilmesini** [Ã¶nerir](https://cloud.google.com/compute/docs/access/service-accounts#service\_account\_permissions). Web yÃ¶netim portalÄ± aslÄ±nda bunu zorunlu kÄ±lar, ancak access scope'lar Ã¶zel hizmet hesaplarÄ± kullanÄ±larak programlÄ± olarak instance'lara uygulanabilir.

**Atanan** scope'larÄ± **sorgulayarak** gÃ¶rebilirsiniz:

{% code overflow="wrap" %}
```bash
curl 'https://www.googleapis.com/oauth2/v1/tokeninfo?access_token=<access_token>'

{
"issued_to": "223044615559.apps.googleusercontent.com",
"audience": "223044615559.apps.googleusercontent.com",
"user_id": "139746512919298469201",
"scope": "openid https://www.googleapis.com/auth/userinfo.email https://www.googleapis.com/auth/cloud-platform https://www.googleapis.com/auth/appengine.admin https://www.googleapis.com/auth/sqlservice.login https://www.googleapis.com/auth/compute https://www.googleapis.com/auth/accounts.reauth",
"expires_in": 2253,
"email": "username@testing.com",
"verified_email": true,
"access_type": "offline"
}
```
{% endcode %}

Ã–nceki **scopes**, **`gcloud`** kullanarak veri eriÅŸimi iÃ§in **varsayÄ±lan** olarak oluÅŸturulanlardÄ±r. Bunun nedeni, **`gcloud`** kullandÄ±ÄŸÄ±nÄ±zda Ã¶nce bir OAuth token oluÅŸturmanÄ±z ve ardÄ±ndan uÃ§ noktalarla iletiÅŸim kurmak iÃ§in kullanmanÄ±zdÄ±r.

Bu scope'lar arasÄ±nda en Ã¶nemlisi potansiyel olarak **`cloud-platform`**'dur, bu da temelde **GCP'deki herhangi bir hizmete eriÅŸmenin mÃ¼mkÃ¼n olduÄŸu** anlamÄ±na gelir.

**TÃ¼m olasÄ± scope'larÄ±n listesini** [**burada bulabilirsiniz**](https://developers.google.com/identity/protocols/googlescopes)**.**

**`gcloud`** tarayÄ±cÄ± kimlik bilgilerine sahipseniz, **baÅŸka scope'larla bir token elde etmek** mÃ¼mkÃ¼ndÃ¼r, ÅŸÃ¶yle bir ÅŸey yaparak:

{% code overflow="wrap" %}
```bash
# Maybe you can get a user token with other scopes changing the scopes array from ~/.config/gcloud/credentials.db

# Set new scopes for SDKs credentials
gcloud auth application-default login --scopes=https://www.googleapis.com/auth/userinfo.email,https://www.googleapis.com/auth/cloud-platform,https://www.googleapis.com/auth/sqlservice.login,https://www.googleapis.com/auth/appengine.admin,https://www.googleapis.com/auth/compute,https://www.googleapis.com/auth/accounts.reauth,https://www.googleapis.com/auth/admin.directory.user,https://www.googleapis.com/auth/admin.directory.group,https://www.googleapis.com/auth/admin.directory.domain,https://www.googleapis.com/auth/admin.directory.user

# Print new token
gcloud auth application-default print-access-token

# To use this token with some API you might need to use curl to indicate the project header with --header "X-Goog-User-Project: <project-name>"
```
{% endcode %}

## **Terraform IAM Policies, Bindings and Memberships**

Terraform tarafÄ±ndan tanÄ±mlandÄ±ÄŸÄ± gibi [https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/google\_project\_iam](https://registry.terraform.io/providers/hashicorp/google/latest/docs/resources/google\_project\_iam) adresinde, GCP ile terraform kullanarak bir principal'a bir kaynak Ã¼zerinde eriÅŸim vermenin farklÄ± yollarÄ± vardÄ±r:

* **Memberships**: **Principal'larÄ± rollerin Ã¼yeleri olarak** **kÄ±sÄ±tlama olmaksÄ±zÄ±n** ayarlarsÄ±nÄ±z. Bir kullanÄ±cÄ±yÄ± bir rolÃ¼n Ã¼yesi olarak belirleyebilir ve ardÄ±ndan bir grubu aynÄ± rolÃ¼n Ã¼yesi olarak belirleyebilir ve bu principal'larÄ± (kullanÄ±cÄ± ve grup) diÄŸer rollerin Ã¼yesi olarak da ayarlayabilirsiniz.
* **Bindings**: Bir role **birden fazla principal baÄŸlanabilir**. Bu **principal'lar hala diÄŸer rollerin Ã¼yesi veya baÄŸlÄ± olabilir**. Ancak, bir role baÄŸlÄ± olmayan bir principal **baÄŸlÄ± bir rolÃ¼n Ã¼yesi olarak ayarlanÄ±rsa**, **baÄŸlama uygulandÄ±ÄŸÄ±nda Ã¼yelik kaybolur**.
* **Policies**: Bir politika **otoriterdir**, roller ve principal'larÄ± belirtir ve ardÄ±ndan, **bu principal'lar daha fazla role sahip olamaz ve bu roller daha fazla principal'a sahip olamaz** o politika deÄŸiÅŸtirilmedikÃ§e (diÄŸer politikalarda, baÄŸlamalarda veya Ã¼yeliklerde bile). Bu nedenle, bir rol veya principal politikada belirtildiÄŸinde tÃ¼m ayrÄ±calÄ±klarÄ± **o politika ile sÄ±nÄ±rlÄ±dÄ±r**. AÃ§Ä±kÃ§a, bu, principal'a politikayÄ± deÄŸiÅŸtirme veya ayrÄ±calÄ±k yÃ¼kseltme izinleri verilirse atlatÄ±labilir (Ã¶rneÄŸin, yeni bir principal oluÅŸturup ona yeni bir rol baÄŸlamak gibi).

## Referanslar

* [https://about.gitlab.com/blog/2020/02/12/plundering-gcp-escalating-privileges-in-google-cloud-platform/](https://about.gitlab.com/blog/2020/02/12/plundering-gcp-escalating-privileges-in-google-cloud-platform/)
* [https://cloud.google.com/resource-manager/docs/cloud-platform-resource-hierarchy](https://cloud.google.com/resource-manager/docs/cloud-platform-resource-hierarchy)

{% hint style="success" %}
AWS Hacking Ã¶ÄŸrenin ve pratik yapÄ±n:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCP Hacking Ã¶ÄŸrenin ve pratik yapÄ±n: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**Abonelik planlarÄ±nÄ±**](https://github.com/sponsors/carlospolop) kontrol edin!
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n ya da **Twitter'da** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live) **bizi takip edin**.
* **HackTricks** ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na PR gÃ¶ndererek hacking ipuÃ§larÄ±nÄ± paylaÅŸÄ±n.

</details>
{% endhint %}
