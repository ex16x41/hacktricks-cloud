# GCP Pentesting

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Basic Information

**Î ÏÎ¹Î½ Î¾ÎµÎºÎ¹Î½Î®ÏƒÎµÏ„Îµ Ï„Î¿ pentesting** ÎµÎ½ÏŒÏ‚ **GCP** Ï€ÎµÏÎ¹Î²Î¬Î»Î»Î¿Î½Ï„Î¿Ï‚, Ï…Ï€Î¬ÏÏ‡Î¿Ï…Î½ Î¼ÎµÏÎ¹ÎºÎ¬ **Î²Î±ÏƒÎ¹ÎºÎ¬ Ï€ÏÎ¬Î³Î¼Î±Ï„Î± Ï€Î¿Ï… Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± Î³Î½Ï‰ÏÎ¯Î¶ÎµÏ„Îµ** Î³Î¹Î± Ï„Î¿ Ï€ÏÏ‚ Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³ÎµÎ¯, ÏÏƒÏ„Îµ Î½Î± ÏƒÎ±Ï‚ Î²Î¿Î·Î¸Î®ÏƒÎµÎ¹ Î½Î± ÎºÎ±Ï„Î±Î½Î¿Î®ÏƒÎµÏ„Îµ Ï„Î¹ Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± ÎºÎ¬Î½ÎµÏ„Îµ, Ï€ÏÏ‚ Î½Î± Î²ÏÎµÎ¯Ï„Îµ ÎºÎ±ÎºÎ¿Î´Î¹Î±Î¼Î¿ÏÏ†ÏÏƒÎµÎ¹Ï‚ ÎºÎ±Î¹ Ï€ÏÏ‚ Î½Î± Ï„Î¹Ï‚ ÎµÎºÎ¼ÎµÏ„Î±Î»Î»ÎµÏ…Ï„ÎµÎ¯Ï„Îµ.

ÎˆÎ½Î½Î¿Î¹ÎµÏ‚ ÏŒÏ€Ï‰Ï‚ Î· **Î¹ÎµÏÎ±ÏÏ‡Î¯Î±** Ï„Î·Ï‚ **Î¿ÏÎ³Î¬Î½Ï‰ÏƒÎ·Ï‚**, Î¿Î¹ **Î¬Î´ÎµÎ¹ÎµÏ‚** ÎºÎ±Î¹ Î¬Î»Î»ÎµÏ‚ Î²Î±ÏƒÎ¹ÎºÎ­Ï‚ Î­Î½Î½Î¿Î¹ÎµÏ‚ ÎµÎ¾Î·Î³Î¿ÏÎ½Ï„Î±Î¹ ÏƒÏ„Î¿:

{% content-ref url="gcp-basic-information/" %}
[gcp-basic-information](gcp-basic-information/)
{% endcontent-ref %}

## Labs to learn

* [https://gcpgoat.joshuajebaraj.com/](https://gcpgoat.joshuajebaraj.com/)
* [https://github.com/ine-labs/GCPGoat](https://github.com/ine-labs/GCPGoat)
* [https://github.com/lacioffi/GCP-pentest-lab/](https://github.com/lacioffi/GCP-pentest-lab/)
* [https://github.com/carlospolop/gcp\_privesc\_scripts](https://github.com/carlospolop/gcp\_privesc\_scripts)

## GCP Pentester/Red Team Methodology

Î“Î¹Î± Î½Î± ÎµÎ»Î­Î³Î¾ÎµÏ„Îµ Î­Î½Î± Ï€ÎµÏÎ¹Î²Î¬Î»Î»Î¿Î½ GCP, ÎµÎ¯Î½Î±Î¹ Ï€Î¿Î»Ï ÏƒÎ·Î¼Î±Î½Ï„Î¹ÎºÏŒ Î½Î± Î³Î½Ï‰ÏÎ¯Î¶ÎµÏ„Îµ: Ï€Î¿Î¹ÎµÏ‚ **Ï…Ï€Î·ÏÎµÏƒÎ¯ÎµÏ‚ Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î¿ÏÎ½Ï„Î±Î¹**, Ï„Î¹ **ÎµÎºÏ„Î¯Î¸ÎµÏ„Î±Î¹**, Ï€Î¿Î¹Î¿Ï‚ Î­Ï‡ÎµÎ¹ **Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ·** ÏƒÎµ Ï„Î¹ ÎºÎ±Î¹ Ï€ÏÏ‚ ÏƒÏ…Î½Î´Î­Î¿Î½Ï„Î±Î¹ Î¿Î¹ ÎµÏƒÏ‰Ï„ÎµÏÎ¹ÎºÎ­Ï‚ Ï…Ï€Î·ÏÎµÏƒÎ¯ÎµÏ‚ GCP Î¼Îµ Ï„Î¹Ï‚ **ÎµÎ¾Ï‰Ï„ÎµÏÎ¹ÎºÎ­Ï‚ Ï…Ï€Î·ÏÎµÏƒÎ¯ÎµÏ‚**.

Î‘Ï€ÏŒ Ï„Î·Î½ Î¿Ï€Ï„Î¹ÎºÎ® Î³Ï‰Î½Î¯Î± Ï„Î·Ï‚ Red Team, Ï„Î¿ **Ï€ÏÏÏ„Î¿ Î²Î®Î¼Î± Î³Î¹Î± Î½Î± ÏƒÏ…Î¼Î²Î¹Î²Î±ÏƒÏ„ÎµÎ¯ Î­Î½Î± Ï€ÎµÏÎ¹Î²Î¬Î»Î»Î¿Î½ GCP** ÎµÎ¯Î½Î±Î¹ Î½Î± ÎºÎ±Ï„Î±Ï†Î­ÏÎµÏ„Îµ Î½Î± Î±Ï€Î¿ÎºÏ„Î®ÏƒÎµÏ„Îµ ÎºÎ¬Ï€Î¿Î¹Î± **Î´Î¹Î±Ï€Î¹ÏƒÏ„ÎµÏ…Ï„Î®ÏÎ¹Î±**. Î•Î´Ï Î­Ï‡ÎµÏ„Îµ Î¼ÎµÏÎ¹ÎºÎ­Ï‚ Î¹Î´Î­ÎµÏ‚ Î³Î¹Î± Ï„Î¿ Ï€ÏÏ‚ Î½Î± Ï„Î¿ ÎºÎ¬Î½ÎµÏ„Îµ Î±Ï…Ï„ÏŒ:

* **Leaks** ÏƒÏ„Î¿ github (Î® Ï€Î±ÏÏŒÎ¼Î¿Î¹Î±) - OSINT
* **Social** Engineering (Î”ÎµÎ¯Ï„Îµ Ï„Î· ÏƒÎµÎ»Î¯Î´Î± [**Workspace Security**](../workspace-security/))
* **Î•Ï€Î±Î½Î±Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¯Î·ÏƒÎ·** ÎºÏ‰Î´Î¹ÎºÏÎ½ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ·Ï‚ (leaks ÎºÏ‰Î´Î¹ÎºÏÎ½)
* Î•Ï…Ï€Î¬Î¸ÎµÎ¹ÎµÏ‚ ÏƒÎµ ÎµÏ†Î±ÏÎ¼Î¿Î³Î­Ï‚ Ï€Î¿Ï… Ï†Î¹Î»Î¿Î¾ÎµÎ½Î¿ÏÎ½Ï„Î±Î¹ ÏƒÏ„Î¿ GCP
* [**Server Side Request Forgery**](https://book.hacktricks.xyz/pentesting-web/ssrf-server-side-request-forgery/cloud-ssrf) Î¼Îµ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ· ÏƒÏ„Î¿ endpoint Î¼ÎµÏ„Î±Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½
* **Local File Read**
* `/home/USERNAME/.config/gcloud/*`
* `C:\Users\USERNAME\.config\gcloud\*`
* 3rd parties **breached**
* **Î•ÏƒÏ‰Ï„ÎµÏÎ¹ÎºÏŒÏ‚** Î¥Ï€Î¬Î»Î»Î·Î»Î¿Ï‚

Î‰ Î¼Îµ **ÏƒÏ…Î¼Î²Î¹Î²Î±ÏƒÎ¼ÏŒ Î¼Î¹Î±Ï‚ Î¼Î· Î±Ï…Î¸ÎµÎ½Ï„Î¹ÎºÎ¿Ï€Î¿Î¹Î·Î¼Î­Î½Î·Ï‚ Ï…Ï€Î·ÏÎµÏƒÎ¯Î±Ï‚** Ï€Î¿Ï… ÎµÎºÏ„Î¯Î¸ÎµÏ„Î±Î¹:

{% content-ref url="gcp-unaunthenticated-enum-and-access/" %}
[gcp-unaunthenticated-enum-and-access](gcp-unaunthenticated-enum-and-access/)
{% endcontent-ref %}

Î‰ Î±Î½ ÎºÎ¬Î½ÎµÏ„Îµ Î¼Î¹Î± **Î±Î½Î±ÏƒÎºÏŒÏ€Î·ÏƒÎ·**, Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î±Ï€Î»Î¬ Î½Î± **Î¶Î·Ï„Î®ÏƒÎµÏ„Îµ Î´Î¹Î±Ï€Î¹ÏƒÏ„ÎµÏ…Ï„Î®ÏÎ¹Î±** Î¼Îµ Î±Ï…Ï„Î¿ÏÏ‚ Ï„Î¿Ï…Ï‚ ÏÏŒÎ»Î¿Ï…Ï‚:

{% content-ref url="gcp-permissions-for-a-pentest.md" %}
[gcp-permissions-for-a-pentest.md](gcp-permissions-for-a-pentest.md)
{% endcontent-ref %}

{% hint style="info" %}
Î‘Ï†Î¿Ï ÎºÎ±Ï„Î±Ï†Î­ÏÎµÏ„Îµ Î½Î± Î±Ï€Î¿ÎºÏ„Î®ÏƒÎµÏ„Îµ Î´Î¹Î±Ï€Î¹ÏƒÏ„ÎµÏ…Ï„Î®ÏÎ¹Î±, Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± Î³Î½Ï‰ÏÎ¯Î¶ÎµÏ„Îµ **ÏƒÎµ Ï€Î¿Î¹Î¿Î½ Î±Î½Î®ÎºÎ¿Ï…Î½ Î±Ï…Ï„Î¬ Ï„Î± creds**, ÎºÎ±Î¹ **ÏƒÎµ Ï„Î¹ Î­Ï‡Î¿Ï…Î½ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ·**, Î¿Ï€ÏŒÏ„Îµ Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± ÎµÎºÏ„ÎµÎ»Î­ÏƒÎµÏ„Îµ ÎºÎ¬Ï€Î¿Î¹Î± Î²Î±ÏƒÎ¹ÎºÎ® Î±ÏÎ¯Î¸Î¼Î·ÏƒÎ·:
{% endhint %}

## Basic Enumeration

### **SSRF**

Î“Î¹Î± Ï€ÎµÏÎ¹ÏƒÏƒÏŒÏ„ÎµÏÎµÏ‚ Ï€Î»Î·ÏÎ¿Ï†Î¿ÏÎ¯ÎµÏ‚ ÏƒÏ‡ÎµÏ„Î¹ÎºÎ¬ Î¼Îµ Ï„Î¿ Ï€ÏÏ‚ Î½Î± **Î±ÏÎ¹Î¸Î¼Î®ÏƒÎµÏ„Îµ Ï„Î± Î¼ÎµÏ„Î±Î´ÎµÎ´Î¿Î¼Î­Î½Î± GCP**, ÎµÎ»Î­Î³Î¾Ï„Îµ Ï„Î·Î½ Ï€Î±ÏÎ±ÎºÎ¬Ï„Ï‰ ÏƒÎµÎ»Î¯Î´Î± hacktricks:

{% embed url="https://book.hacktricks.xyz/pentesting-web/ssrf-server-side-request-forgery/cloud-ssrf#6440" %}

### Whoami

Î£Ï„Î¿ GCP Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Î´Î¿ÎºÎ¹Î¼Î¬ÏƒÎµÏ„Îµ Ï€Î¿Î»Î»Î­Ï‚ ÎµÏ€Î¹Î»Î¿Î³Î­Ï‚ Î³Î¹Î± Î½Î± Ï€ÏÎ¿ÏƒÏ€Î±Î¸Î®ÏƒÎµÏ„Îµ Î½Î± Î¼Î±Î½Ï„Î­ÏˆÎµÏ„Îµ Ï€Î¿Î¹Î¿Ï‚ ÎµÎ¯ÏƒÏ„Îµ:

{% code overflow="wrap" %}
```bash
#If you are inside a compromise machine
gcloud auth list
curl -H "Content-Type: application/x-www-form-urlencoded" -d "access_token=$(gcloud auth print-access-token)" https://www.googleapis.com/oauth2/v1/tokeninfo
gcloud auth print-identity-token #Get info from the token

#If you compromised a metadata token or somehow found an OAuth token
curl -H "Content-Type: application/x-www-form-urlencoded" -d "access_token=<token>" https://www.googleapis.com/oauth2/v1/tokeninfo
```
{% endcode %}

### ÎŸÏÎ³Î¬Î½Ï‰ÏƒÎ· Î‘ÏÎ¯Î¸Î¼Î·ÏƒÎ·Ï‚
```bash
# Get organizations
gcloud organizations list #The DIRECTORY_CUSTOMER_ID is the Workspace ID
gcloud resource-manager folders list --organization <org_number> # Get folders
gcloud projects list # Get projects
```
### Principals & IAM Enumeration

Î‘Î½ Î­Ï‡ÎµÏ„Îµ Î±ÏÎºÎµÏ„Î¬ Î´Î¹ÎºÎ±Î¹ÏÎ¼Î±Ï„Î±, **Î· Î­Î»ÎµÎ³Ï‡Î¿Ï‚ Ï„Ï‰Î½ Ï€ÏÎ¿Î½Î¿Î¼Î¯Ï‰Î½ ÎºÎ¬Î¸Îµ Î¿Î½Ï„ÏŒÏ„Î·Ï„Î±Ï‚ Î¼Î­ÏƒÎ± ÏƒÏ„Î¿Î½ Î»Î¿Î³Î±ÏÎ¹Î±ÏƒÎ¼ÏŒ GCP** Î¸Î± ÏƒÎ±Ï‚ Î²Î¿Î·Î¸Î®ÏƒÎµÎ¹ Î½Î± ÎºÎ±Ï„Î±Î½Î¿Î®ÏƒÎµÏ„Îµ Ï„Î¹ Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± ÎºÎ¬Î½ÎµÏ„Îµ ÎµÏƒÎµÎ¯Ï‚ ÎºÎ±Î¹ Î¬Î»Î»ÎµÏ‚ Ï„Î±Ï…Ï„ÏŒÏ„Î·Ï„ÎµÏ‚ ÎºÎ±Î¹ Ï€ÏÏ‚ Î½Î± **ÎºÎ»Î¹Î¼Î±ÎºÏÏƒÎµÏ„Îµ Ï„Î± Ï€ÏÎ¿Î½ÏŒÎ¼Î¹Î±**.

Î‘Î½ Î´ÎµÎ½ Î­Ï‡ÎµÏ„Îµ Î±ÏÎºÎµÏ„Î¬ Î´Î¹ÎºÎ±Î¹ÏÎ¼Î±Ï„Î± Î³Î¹Î± Î½Î± ÎºÎ±Ï„Î±Î³ÏÎ¬ÏˆÎµÏ„Îµ Ï„Î¿ IAM, Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± **Ï„Î± ÎºÎ»Î­ÏˆÎµÏ„Îµ Î¼Îµ brute-force** Î³Î¹Î± Î½Î± Ï„Î± Î±Î½Î±ÎºÎ±Î»ÏÏˆÎµÏ„Îµ.\
Î”ÎµÎ¯Ï„Îµ **Ï€ÏÏ‚ Î½Î± ÎºÎ¬Î½ÎµÏ„Îµ Ï„Î·Î½ ÎºÎ±Ï„Î±Î³ÏÎ±Ï†Î® ÎºÎ±Î¹ Ï„Î¿ brute-forcing** ÏƒÏ„Î¿:

{% content-ref url="gcp-services/gcp-iam-and-org-policies-enum.md" %}
[gcp-iam-and-org-policies-enum.md](gcp-services/gcp-iam-and-org-policies-enum.md)
{% endcontent-ref %}

{% hint style="info" %}
Î¤ÏÏÎ± Ï€Î¿Ï… **Î­Ï‡ÎµÏ„Îµ ÎºÎ¬Ï€Î¿Î¹ÎµÏ‚ Ï€Î»Î·ÏÎ¿Ï†Î¿ÏÎ¯ÎµÏ‚ ÏƒÏ‡ÎµÏ„Î¹ÎºÎ¬ Î¼Îµ Ï„Î± Î´Î¹Î±Ï€Î¹ÏƒÏ„ÎµÏ…Ï„Î®ÏÎ¹Î¬ ÏƒÎ±Ï‚** (ÎºÎ±Î¹ Î±Î½ ÎµÎ¯ÏƒÏ„Îµ red team ÎµÎ»Ï€Î¯Î¶Ï‰ Î½Î± **Î´ÎµÎ½ Î­Ï‡ÎµÏ„Îµ Î±Î½Î¹Ï‡Î½ÎµÏ…Î¸ÎµÎ¯**). Î•Î¯Î½Î±Î¹ ÎºÎ±Î¹ÏÏŒÏ‚ Î½Î± ÎºÎ±Ï„Î±Î½Î¿Î®ÏƒÎµÏ„Îµ Ï€Î¿Î¹ÎµÏ‚ Ï…Ï€Î·ÏÎµÏƒÎ¯ÎµÏ‚ Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î¿ÏÎ½Ï„Î±Î¹ ÏƒÏ„Î¿ Ï€ÎµÏÎ¹Î²Î¬Î»Î»Î¿Î½.\
Î£Ï„Î·Î½ ÎµÏ€ÏŒÎ¼ÎµÎ½Î· ÎµÎ½ÏŒÏ„Î·Ï„Î± Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Î´ÎµÎ¯Ï„Îµ Î¼ÎµÏÎ¹ÎºÎ¿ÏÏ‚ Ï„ÏÏŒÏ€Î¿Ï…Ï‚ Î³Î¹Î± Î½Î± **ÎºÎ±Ï„Î±Î³ÏÎ¬ÏˆÎµÏ„Îµ ÎºÎ¬Ï€Î¿Î¹ÎµÏ‚ ÎºÎ¿Î¹Î½Î­Ï‚ Ï…Ï€Î·ÏÎµÏƒÎ¯ÎµÏ‚.**
{% endhint %}

## Services Enumeration

Î— GCP Î­Ï‡ÎµÎ¹ Î¼Î¹Î± ÎµÎºÏ€Î»Î·ÎºÏ„Î¹ÎºÎ® Ï€Î¿ÏƒÏŒÏ„Î·Ï„Î± Ï…Ï€Î·ÏÎµÏƒÎ¹ÏÎ½, ÏƒÏ„Î·Î½ ÎµÏ€ÏŒÎ¼ÎµÎ½Î· ÏƒÎµÎ»Î¯Î´Î± Î¸Î± Î²ÏÎµÎ¯Ï„Îµ **Î²Î±ÏƒÎ¹ÎºÎ­Ï‚ Ï€Î»Î·ÏÎ¿Ï†Î¿ÏÎ¯ÎµÏ‚, ÎºÎ±Ï„Î±Î³ÏÎ±Ï†Î­Ï‚** cheatsheets, Ï€ÏÏ‚ Î½Î± **Î±Ï€Î¿Ï†ÏÎ³ÎµÏ„Îµ Ï„Î·Î½ Î±Î½Î¯Ï‡Î½ÎµÏ…ÏƒÎ·**, Î½Î± Î±Ï€Î¿ÎºÏ„Î®ÏƒÎµÏ„Îµ **ÎµÏ€Î¹Î¼Î¿Î½Î®**, ÎºÎ±Î¹ Î¬Î»Î»Î± **tricks Î¼ÎµÏ„Î¬ Ï„Î·Î½ ÎµÎºÎ¼ÎµÏ„Î¬Î»Î»ÎµÏ…ÏƒÎ·** ÏƒÏ‡ÎµÏ„Î¹ÎºÎ¬ Î¼Îµ Î¼ÎµÏÎ¹ÎºÎ­Ï‚ Î±Ï€ÏŒ Î±Ï…Ï„Î­Ï‚:

{% content-ref url="gcp-services/" %}
[gcp-services](gcp-services/)
{% endcontent-ref %}

Î£Î·Î¼ÎµÎ¹ÏÏƒÏ„Îµ ÏŒÏ„Î¹ **Î´ÎµÎ½** Ï‡ÏÎµÎ¹Î¬Î¶ÎµÏ„Î±Î¹ Î½Î± ÎµÎºÏ„ÎµÎ»Î­ÏƒÎµÏ„Îµ ÏŒÎ»Î· Ï„Î· Î´Î¿Ï…Î»ÎµÎ¹Î¬ **Ï‡ÎµÎ¹ÏÎ¿ÎºÎ¯Î½Î·Ï„Î±**, Ï€Î±ÏÎ±ÎºÎ¬Ï„Ï‰ ÏƒÎµ Î±Ï…Ï„Î® Ï„Î·Î½ Î±Î½Î¬ÏÏ„Î·ÏƒÎ· Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Î²ÏÎµÎ¯Ï„Îµ Î¼Î¹Î± **ÎµÎ½ÏŒÏ„Î·Ï„Î± ÏƒÏ‡ÎµÏ„Î¹ÎºÎ¬ Î¼Îµ** [**Î±Ï…Ï„ÏŒÎ¼Î±Ï„Î± ÎµÏÎ³Î±Î»ÎµÎ¯Î±**](./#automatic-tools).

Î•Ï€Î¹Ï€Î»Î­Î¿Î½, ÏƒÎµ Î±Ï…Ï„ÏŒ Ï„Î¿ ÏƒÏ„Î¬Î´Î¹Î¿ Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Î­Ï‡ÎµÏ„Îµ Î±Î½Î±ÎºÎ±Î»ÏÏˆÎµÎ¹ **Ï€ÎµÏÎ¹ÏƒÏƒÏŒÏ„ÎµÏÎµÏ‚ Ï…Ï€Î·ÏÎµÏƒÎ¯ÎµÏ‚ ÎµÎºÏ„ÎµÎ¸ÎµÎ¹Î¼Î­Î½ÎµÏ‚ ÏƒÎµ Î¼Î· Î±Ï…Î¸ÎµÎ½Ï„Î¹ÎºÎ¿Ï€Î¿Î¹Î·Î¼Î­Î½Î¿Ï…Ï‚ Ï‡ÏÎ®ÏƒÏ„ÎµÏ‚,** Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± ÎµÎ¯ÏƒÏ„Îµ ÏƒÎµ Î¸Î­ÏƒÎ· Î½Î± Ï„Î¹Ï‚ ÎµÎºÎ¼ÎµÏ„Î±Î»Î»ÎµÏ…Ï„ÎµÎ¯Ï„Îµ:

{% content-ref url="gcp-unaunthenticated-enum-and-access/" %}
[gcp-unaunthenticated-enum-and-access](gcp-unaunthenticated-enum-and-access/)
{% endcontent-ref %}

## Privilege Escalation, Post Exploitation & Persistence

ÎŸ Ï€Î¹Î¿ ÎºÎ¿Î¹Î½ÏŒÏ‚ Ï„ÏÏŒÏ€Î¿Ï‚ Î¼ÏŒÎ»Î¹Ï‚ Î­Ï‡ÎµÏ„Îµ Î±Ï€Î¿ÎºÏ„Î®ÏƒÎµÎ¹ ÎºÎ¬Ï€Î¿Î¹Î± Î´Î¹Î±Ï€Î¹ÏƒÏ„ÎµÏ…Ï„Î®ÏÎ¹Î± cloud Î® Î­Ï‡ÎµÏ„Îµ Ï€Î±ÏÎ±Î²Î¹Î¬ÏƒÎµÎ¹ ÎºÎ¬Ï€Î¿Î¹Î± Ï…Ï€Î·ÏÎµÏƒÎ¯Î± Ï€Î¿Ï… ÎµÎºÏ„ÎµÎ»ÎµÎ¯Ï„Î±Î¹ Î¼Î­ÏƒÎ± ÏƒÎµ Î­Î½Î± cloud ÎµÎ¯Î½Î±Î¹ Î½Î± **ÎºÎ±Ï„Î±Ï‡ÏÎ±ÏƒÏ„ÎµÎ¯Ï„Îµ ÎºÎ±ÎºÏÏ‚ ÏÏ…Î¸Î¼Î¹ÏƒÎ¼Î­Î½Î± Ï€ÏÎ¿Î½ÏŒÎ¼Î¹Î±** Ï€Î¿Ï… Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Î­Ï‡ÎµÎ¹ Î¿ Ï€Î±ÏÎ±Î²Î¹Î±ÏƒÎ¼Î­Î½Î¿Ï‚ Î»Î¿Î³Î±ÏÎ¹Î±ÏƒÎ¼ÏŒÏ‚. ÎˆÏ„ÏƒÎ¹, Ï„Î¿ Ï€ÏÏÏ„Î¿ Ï€ÏÎ¬Î³Î¼Î± Ï€Î¿Ï… Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± ÎºÎ¬Î½ÎµÏ„Îµ ÎµÎ¯Î½Î±Î¹ Î½Î± ÎºÎ±Ï„Î±Î³ÏÎ¬ÏˆÎµÏ„Îµ Ï„Î± Ï€ÏÎ¿Î½ÏŒÎ¼Î¹Î¬ ÏƒÎ±Ï‚.

Î•Ï€Î¹Ï€Î»Î­Î¿Î½, ÎºÎ±Ï„Î¬ Ï„Î· Î´Î¹Î¬ÏÎºÎµÎ¹Î± Î±Ï…Ï„Î®Ï‚ Ï„Î·Ï‚ ÎºÎ±Ï„Î±Î³ÏÎ±Ï†Î®Ï‚, Î¸Ï…Î¼Î·Î¸ÎµÎ¯Ï„Îµ ÏŒÏ„Î¹ **Ï„Î± Î´Î¹ÎºÎ±Î¹ÏÎ¼Î±Ï„Î± Î¼Ï€Î¿ÏÎ¿ÏÎ½ Î½Î± ÏÏ…Î¸Î¼Î¹ÏƒÏ„Î¿ÏÎ½ ÏƒÏ„Î¿ Ï…ÏˆÎ·Î»ÏŒÏ„ÎµÏÎ¿ ÎµÏ€Î¯Ï€ÎµÎ´Î¿ "ÎŸÏÎ³Î¬Î½Ï‰ÏƒÎ·Ï‚"** ÎµÏ€Î¯ÏƒÎ·Ï‚.

{% content-ref url="gcp-privilege-escalation/" %}
[gcp-privilege-escalation](gcp-privilege-escalation/)
{% endcontent-ref %}

{% content-ref url="gcp-post-exploitation/" %}
[gcp-post-exploitation](gcp-post-exploitation/)
{% endcontent-ref %}

{% content-ref url="gcp-persistence/" %}
[gcp-persistence](gcp-persistence/)
{% endcontent-ref %}

### Publicly Exposed Services

ÎšÎ±Ï„Î¬ Ï„Î·Î½ ÎºÎ±Ï„Î±Î³ÏÎ±Ï†Î® Ï…Ï€Î·ÏÎµÏƒÎ¹ÏÎ½ GCP Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Î­Ï‡ÎµÏ„Îµ Î²ÏÎµÎ¹ ÎºÎ¬Ï€Î¿Î¹ÎµÏ‚ Î±Ï€ÏŒ Î±Ï…Ï„Î­Ï‚ **Î½Î± ÎµÎºÎ¸Î­Ï„Î¿Ï…Î½ ÏƒÏ„Î¿Î¹Ï‡ÎµÎ¯Î± ÏƒÏ„Î¿ Î”Î¹Î±Î´Î¯ÎºÏ„Ï…Î¿** (Î¸ÏÏÎµÏ‚ VM/Containers, Î²Î¬ÏƒÎµÎ¹Ï‚ Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½ Î® Ï…Ï€Î·ÏÎµÏƒÎ¯ÎµÏ‚ Î¿Ï…ÏÏÎ½, ÏƒÏ„Î¹Î³Î¼Î¹ÏŒÏ„Ï…Ï€Î± Î® ÎºÎ¬Î´Î¿Ï…Ï‚...).\
Î©Ï‚ pentester/red teamer Î¸Î± Ï€ÏÎ­Ï€ÎµÎ¹ Ï€Î¬Î½Ï„Î± Î½Î± ÎµÎ»Î­Î³Ï‡ÎµÏ„Îµ Î±Î½ Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Î²ÏÎµÎ¯Ï„Îµ **ÎµÏ…Î±Î¯ÏƒÎ¸Î·Ï„ÎµÏ‚ Ï€Î»Î·ÏÎ¿Ï†Î¿ÏÎ¯ÎµÏ‚ / ÎµÏ…Ï€Î¬Î¸ÎµÎ¹ÎµÏ‚** ÏƒÎµ Î±Ï…Ï„Î­Ï‚ ÎºÎ±Î¸ÏÏ‚ Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± ÏƒÎ±Ï‚ Ï€Î±ÏÎ­Ï‡Î¿Ï…Î½ **Ï€ÎµÏÎ±Î¹Ï„Î­ÏÏ‰ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ· ÏƒÏ„Î¿Î½ Î»Î¿Î³Î±ÏÎ¹Î±ÏƒÎ¼ÏŒ AWS**.

Î£Îµ Î±Ï…Ï„ÏŒ Ï„Î¿ Î²Î¹Î²Î»Î¯Î¿ Î¸Î± Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± Î²ÏÎµÎ¯Ï„Îµ **Ï€Î»Î·ÏÎ¿Ï†Î¿ÏÎ¯ÎµÏ‚** ÏƒÏ‡ÎµÏ„Î¹ÎºÎ¬ Î¼Îµ Ï„Î¿ Ï€ÏÏ‚ Î½Î± Î²ÏÎµÎ¯Ï„Îµ **ÎµÎºÏ„ÎµÎ¸ÎµÎ¹Î¼Î­Î½ÎµÏ‚ Ï…Ï€Î·ÏÎµÏƒÎ¯ÎµÏ‚ GCP ÎºÎ±Î¹ Ï€ÏÏ‚ Î½Î± Ï„Î¹Ï‚ ÎµÎ»Î­Î³Î¾ÎµÏ„Îµ**. Î£Ï‡ÎµÏ„Î¹ÎºÎ¬ Î¼Îµ Ï„Î¿ Ï€ÏÏ‚ Î½Î± Î²ÏÎµÎ¯Ï„Îµ **ÎµÏ…Ï€Î¬Î¸ÎµÎ¹ÎµÏ‚ ÏƒÎµ ÎµÎºÏ„ÎµÎ¸ÎµÎ¹Î¼Î­Î½ÎµÏ‚ Î´Î¹ÎºÏ„Ï…Î±ÎºÎ­Ï‚ Ï…Ï€Î·ÏÎµÏƒÎ¯ÎµÏ‚** Î¸Î± ÏƒÎ±Ï‚ ÏƒÏ…Î½Î¹ÏƒÏ„Î¿ÏÏƒÎ± Î½Î± **Î±Î½Î±Î¶Î·Ï„Î®ÏƒÎµÏ„Îµ** Ï„Î·Î½ ÏƒÏ…Î³ÎºÎµÎºÏÎ¹Î¼Î­Î½Î· **Ï…Ï€Î·ÏÎµÏƒÎ¯Î±** ÏƒÏ„Î¿:

{% embed url="https://book.hacktricks.xyz/" %}

## GCP <--> Workspace Pivoting

**Î— Ï€Î±ÏÎ±Î²Î¯Î±ÏƒÎ·** Î¿Î½Ï„Î¿Ï„Î®Ï„Ï‰Î½ ÏƒÎµ **Î¼Î¯Î±** Ï€Î»Î±Ï„Ï†ÏŒÏÎ¼Î± Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± ÎµÏ€Î¹Ï„ÏÎ­ÏˆÎµÎ¹ ÏƒÎµ Î­Î½Î±Î½ ÎµÏ€Î¹Ï„Î¹Î¸Î­Î¼ÎµÎ½Î¿ Î½Î± **Ï€Î±ÏÎ±Î²Î¹Î¬ÏƒÎµÎ¹ Ï„Î·Î½ Î¬Î»Î»Î·**, ÎµÎ»Î­Î³Î¾Ï„Îµ Ï„Î¿ ÏƒÏ„Î¿:

{% content-ref url="gcp-to-workspace-pivoting/" %}
[gcp-to-workspace-pivoting](gcp-to-workspace-pivoting/)
{% endcontent-ref %}

## Automatic Tools

* Î£Ï„Î·Î½ **ÎºÎ¿Î½ÏƒÏŒÎ»Î± GCloud**, ÏƒÏ„Î¿ [https://console.cloud.google.com/iam-admin/asset-inventory/dashboard](https://console.cloud.google.com/iam-admin/asset-inventory/dashboard) Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Î´ÎµÎ¯Ï„Îµ Ï€ÏŒÏÎ¿Ï…Ï‚ ÎºÎ±Î¹ IAM Ï€Î¿Ï… Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î¿ÏÎ½Ï„Î±Î¹ Î±Ï€ÏŒ Ï„Î¿ Î­ÏÎ³Î¿.
* Î•Î´Ï Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Î´ÎµÎ¯Ï„Îµ Ï„Î± Ï€ÎµÏÎ¹Î¿Ï…ÏƒÎ¹Î±ÎºÎ¬ ÏƒÏ„Î¿Î¹Ï‡ÎµÎ¯Î± Ï€Î¿Ï… Ï…Ï€Î¿ÏƒÏ„Î·ÏÎ¯Î¶Î¿Î½Ï„Î±Î¹ Î±Ï€ÏŒ Î±Ï…Ï„Î® Ï„Î·Î½ API: [https://cloud.google.com/asset-inventory/docs/supported-asset-types](https://cloud.google.com/asset-inventory/docs/supported-asset-types)
* Î”ÎµÎ¯Ï„Îµ **ÎµÏÎ³Î±Î»ÎµÎ¯Î±** Ï€Î¿Ï… Î¼Ï€Î¿ÏÎ¿ÏÎ½ Î½Î± [**Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î·Î¸Î¿ÏÎ½ ÏƒÎµ Ï€Î¿Î»Î»Î­Ï‚ cloud ÎµÎ´Ï**](../pentesting-cloud-methodology.md).
* [**gcp\_scanner**](https://github.com/google/gcp\_scanner): Î‘Ï…Ï„ÏŒ ÎµÎ¯Î½Î±Î¹ Î­Î½Î± scanner Ï€ÏŒÏÏ‰Î½ GCP Ï€Î¿Ï… Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Î²Î¿Î·Î¸Î®ÏƒÎµÎ¹ Î½Î± Ï€ÏÎ¿ÏƒÎ´Î¹Î¿ÏÎ¯ÏƒÎµÏ„Îµ Ï„Î¹ **ÎµÏ€Î¯Ï€ÎµÎ´Î¿ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ·Ï‚ Î­Ï‡Î¿Ï…Î½ Î¿ÏÎ¹ÏƒÎ¼Î­Î½Î± Î´Î¹Î±Ï€Î¹ÏƒÏ„ÎµÏ…Ï„Î®ÏÎ¹Î±** ÏƒÏ„Î¿ GCP.
```bash
# Install
git clone https://github.com/google/gcp_scanner.git
cd gcp_scanner
virtualenv -p python3 venv
source venv/bin/activate
pip install -r requirements.txt
# Execute with gcloud creds
python3 __main__.py -o /tmp/output/ -g "$HOME/.config/gcloud"
```
* [**gcp\_enum**](https://gitlab.com/gitlab-com/gl-security/threatmanagement/redteam/redteam-public/gcp\_enum): Bash script Î³Î¹Î± Ï„Î·Î½ ÎºÎ±Ï„Î±Î¼Î­Ï„ÏÎ·ÏƒÎ· ÎµÎ½ÏŒÏ‚ Ï€ÎµÏÎ¹Î²Î¬Î»Î»Î¿Î½Ï„Î¿Ï‚ GCP Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÏÎ½Ï„Î±Ï‚ gcloud cli ÎºÎ±Î¹ Î±Ï€Î¿Î¸Î®ÎºÎµÏ…ÏƒÎ· Ï„Ï‰Î½ Î±Ï€Î¿Ï„ÎµÎ»ÎµÏƒÎ¼Î¬Ï„Ï‰Î½ ÏƒÎµ Î­Î½Î± Î±ÏÏ‡ÎµÎ¯Î¿.
* [**GCP-IAM-Privilege-Escalation**](https://github.com/RhinoSecurityLabs/GCP-IAM-Privilege-Escalation): Scripts Î³Î¹Î± Ï„Î·Î½ ÎºÎ±Ï„Î±Î¼Î­Ï„ÏÎ·ÏƒÎ· Ï…ÏˆÎ·Î»ÏÎ½ IAM Î´Î¹ÎºÎ±Î¹Ï‰Î¼Î¬Ï„Ï‰Î½ ÎºÎ±Î¹ Î³Î¹Î± Ï„Î·Î½ ÎºÎ»Î¹Î¼Î¬ÎºÏ‰ÏƒÎ· Î´Î¹ÎºÎ±Î¹Ï‰Î¼Î¬Ï„Ï‰Î½ ÏƒÏ„Î¿ GCP ÎµÎºÎ¼ÎµÏ„Î±Î»Î»ÎµÏ…ÏŒÎ¼ÎµÎ½Î± Î±Ï…Ï„Î¬ (Î´ÎµÎ½ Î¼Ï€ÏŒÏÎµÏƒÎ± Î½Î± ÎµÎºÏ„ÎµÎ»Î­ÏƒÏ‰ Ï„Î¿ script ÎºÎ±Ï„Î±Î¼Î­Ï„ÏÎ·ÏƒÎ·Ï‚).
* [**BF My GCP Permissions**](https://github.com/carlospolop/bf\_my\_gcp\_permissions): Script Î³Î¹Î± brute force Ï„Ï‰Î½ Î´Î¹ÎºÎ±Î¹Ï‰Î¼Î¬Ï„Ï‰Î½ ÏƒÎ±Ï‚.

## gcloud config & debug
```bash
# Login so gcloud can use your credentials
gcloud auth login
gcloud config set project security-devbox
gcloud auth print-access-token

# Login so SDKs can use your user credentials
gcloud auth application-default login
gcloud auth application-default set-quota-project security-devbox
gcloud auth application-default print-access-token

# Update gcloud
gcloud components update
```
### Capture gcloud, gsutil... network

Î˜Ï…Î¼Î·Î¸ÎµÎ¯Ï„Îµ ÏŒÏ„Î¹ Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î®ÏƒÎµÏ„Îµ Ï„Î·Î½ **Ï€Î±ÏÎ¬Î¼ÎµÏ„ÏÎ¿** **`--log-http`** Î¼Îµ Ï„Î¿ **`gcloud`** cli Î³Î¹Î± Î½Î± **ÎµÎºÏ„Ï…Ï€ÏÏƒÎµÏ„Îµ** Ï„Î¹Ï‚ **Î±Î¹Ï„Î®ÏƒÎµÎ¹Ï‚** Ï€Î¿Ï… ÎµÎºÏ„ÎµÎ»ÎµÎ¯ Ï„Î¿ ÎµÏÎ³Î±Î»ÎµÎ¯Î¿. Î‘Î½ Î´ÎµÎ½ Î¸Î­Î»ÎµÏ„Îµ Ï„Î± Î±ÏÏ‡ÎµÎ¯Î± ÎºÎ±Ï„Î±Î³ÏÎ±Ï†Î®Ï‚ Î½Î± Î±Ï€Î¿ÎºÏÏÏ€Ï„Î¿Ï…Î½ Ï„Î·Î½ Ï„Î¹Î¼Î® Ï„Î¿Ï… token, Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î®ÏƒÏ„Îµ `gcloud config set log_http_redact_token false`

Î•Ï€Î¹Ï€Î»Î­Î¿Î½, Î³Î¹Î± Î½Î± Ï€Î±Î³Î¹Î´ÎµÏÏƒÎµÏ„Îµ Ï„Î·Î½ ÎµÏ€Î¹ÎºÎ¿Î¹Î½Ï‰Î½Î¯Î±:
```bash
gcloud config set proxy/address 127.0.0.1
gcloud config set proxy/port 8080
gcloud config set proxy/type http
gcloud config set auth/disable_ssl_validation True

# If you don't want to completely disable ssl_validation use:
gcloud config set core/custom_ca_certs_file cert.pem

# Back to normal
gcloud config unset proxy/address
gcloud config unset proxy/port
gcloud config unset proxy/type
gcloud config unset auth/disable_ssl_validation
gcloud config unset core/custom_ca_certs_file
```
### OAuth token configure in gcloud

Î“Î¹Î± Î½Î± **Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î®ÏƒÎµÏ„Îµ Î­Î½Î± ÎµÎ¾Î±Î³ÏŒÎ¼ÎµÎ½Î¿ OAuth token Ï…Ï€Î·ÏÎµÏƒÎ¯Î±Ï‚ Î±Ï€ÏŒ Ï„Î¿ endpoint Î¼ÎµÏ„Î±Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½** Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î±Ï€Î»Î¬ Î½Î± ÎºÎ¬Î½ÎµÏ„Îµ:
```bash
# Via env vars
export CLOUDSDK_AUTH_ACCESS_TOKEN=<token>
gcloud projects list

# Via setup
echo "<token>" > /some/path/to/token
gcloud config set auth/access_token_file /some/path/to/token
gcloud projects list
gcloud config unset auth/access_token_file
```
## Î‘Î½Î±Ï†Î¿ÏÎ­Ï‚

* [https://about.gitlab.com/blog/2020/02/12/plundering-gcp-escalating-privileges-in-google-cloud-platform/](https://about.gitlab.com/blog/2020/02/12/plundering-gcp-escalating-privileges-in-google-cloud-platform/)

{% hint style="success" %}
ÎœÎ¬Î¸ÎµÏ„Îµ & ÎµÎ¾Î±ÏƒÎºÎ·Î¸ÎµÎ¯Ï„Îµ ÏƒÏ„Î¿ AWS Hacking:<img src="../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/image (1).png" alt="" data-size="line">\
ÎœÎ¬Î¸ÎµÏ„Îµ & ÎµÎ¾Î±ÏƒÎºÎ·Î¸ÎµÎ¯Ï„Îµ ÏƒÏ„Î¿ GCP Hacking: <img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Î¥Ï€Î¿ÏƒÏ„Î®ÏÎ¹Î¾Î· HackTricks</summary>

* Î•Î»Î­Î³Î¾Ï„Îµ Ï„Î± [**ÏƒÏ‡Î­Î´Î¹Î± ÏƒÏ…Î½Î´ÏÎ¿Î¼Î®Ï‚**](https://github.com/sponsors/carlospolop)!
* **Î•Î³Î³ÏÎ±Ï†ÎµÎ¯Ï„Îµ ÏƒÏ„Î·Î½** ğŸ’¬ [**Î¿Î¼Î¬Î´Î± Discord**](https://discord.gg/hRep4RUj7f) Î® ÏƒÏ„Î·Î½ [**Î¿Î¼Î¬Î´Î± telegram**](https://t.me/peass) Î® **Î±ÎºÎ¿Î»Î¿Ï…Î¸Î®ÏƒÏ„Îµ** Î¼Î±Ï‚ ÏƒÏ„Î¿ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **ÎœÎ¿Î¹ÏÎ±ÏƒÏ„ÎµÎ¯Ï„Îµ ÎºÏŒÎ»Ï€Î± hacking Ï…Ï€Î¿Î²Î¬Î»Î»Î¿Î½Ï„Î±Ï‚ PRs ÏƒÏ„Î±** [**HackTricks**](https://github.com/carlospolop/hacktricks) ÎºÎ±Î¹ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
