# GCP Pentesting

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## åŸºæœ¬æƒ…å ±

**GCP** ç’°å¢ƒã® **ãƒšãƒ³ãƒ†ã‚¹ãƒˆ** ã‚’é–‹å§‹ã™ã‚‹å‰ã«ã€ã©ã®ã‚ˆã†ã«æ©Ÿèƒ½ã™ã‚‹ã‹ã«ã¤ã„ã¦çŸ¥ã£ã¦ãŠãã¹ã **åŸºæœ¬çš„ãªã“ã¨** ãŒã„ãã¤ã‹ã‚ã‚Šã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€ä½•ã‚’ã™ã¹ãã‹ã€èª¤è¨­å®šã‚’è¦‹ã¤ã‘ã‚‹æ–¹æ³•ã€ãã—ã¦ãã‚Œã‚’ã©ã®ã‚ˆã†ã«æ‚ªç”¨ã™ã‚‹ã‹ã‚’ç†è§£ã™ã‚‹ã®ã«å½¹ç«‹ã¡ã¾ã™ã€‚

**çµ„ç¹”** éšå±¤ã€**æ¨©é™**ã€ãŠã‚ˆã³ãã®ä»–ã®åŸºæœ¬çš„ãªæ¦‚å¿µã«ã¤ã„ã¦ã¯ã€ä»¥ä¸‹ã§èª¬æ˜ã•ã‚Œã¦ã„ã¾ã™ã€‚

{% content-ref url="gcp-basic-information/" %}
[gcp-basic-information](gcp-basic-information/)
{% endcontent-ref %}

## å­¦ç¿’ç”¨ãƒ©ãƒœ

* [https://gcpgoat.joshuajebaraj.com/](https://gcpgoat.joshuajebaraj.com/)
* [https://github.com/ine-labs/GCPGoat](https://github.com/ine-labs/GCPGoat)
* [https://github.com/lacioffi/GCP-pentest-lab/](https://github.com/lacioffi/GCP-pentest-lab/)
* [https://github.com/carlospolop/gcp\_privesc\_scripts](https://github.com/carlospolop/gcp\_privesc\_scripts)

## GCP ãƒšãƒ³ãƒ†ã‚¹ã‚¿ãƒ¼/ãƒ¬ãƒƒãƒ‰ãƒãƒ¼ãƒ ã®æ–¹æ³•è«–

GCP ç’°å¢ƒã‚’ç›£æŸ»ã™ã‚‹ãŸã‚ã«ã¯ã€ã©ã® **ã‚µãƒ¼ãƒ“ã‚¹ãŒä½¿ç”¨ã•ã‚Œã¦ã„ã‚‹ã‹**ã€ä½•ãŒ **å…¬é–‹ã•ã‚Œã¦ã„ã‚‹ã‹**ã€èª°ãŒ **ä½•ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ã‹**ã€ãŠã‚ˆã³å†…éƒ¨ GCP ã‚µãƒ¼ãƒ“ã‚¹ã¨ **å¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹** ãŒã©ã®ã‚ˆã†ã«æ¥ç¶šã•ã‚Œã¦ã„ã‚‹ã‹ã‚’çŸ¥ã‚‹ã“ã¨ãŒéå¸¸ã«é‡è¦ã§ã™ã€‚

ãƒ¬ãƒƒãƒ‰ãƒãƒ¼ãƒ ã®è¦³ç‚¹ã‹ã‚‰ã€GCP ç’°å¢ƒã‚’ä¾µå®³ã™ã‚‹ãŸã‚ã® **æœ€åˆã®ã‚¹ãƒ†ãƒƒãƒ—** ã¯ã€ã„ãã¤ã‹ã® **è³‡æ ¼æƒ…å ±** ã‚’å–å¾—ã™ã‚‹ã“ã¨ã§ã™ã€‚ä»¥ä¸‹ã¯ãã®æ–¹æ³•ã®ã„ãã¤ã‹ã®ã‚¢ã‚¤ãƒ‡ã‚¢ã§ã™ï¼š

* githubï¼ˆã¾ãŸã¯é¡ä¼¼ã®ã‚‚ã®ï¼‰ã§ã® **æ¼æ´©** - OSINT
* **ã‚½ãƒ¼ã‚·ãƒ£ãƒ«** ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãƒªãƒ³ã‚°ï¼ˆãƒšãƒ¼ã‚¸ [**Workspace Security**](../workspace-security/) ã‚’ç¢ºèªï¼‰
* **ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰** å†åˆ©ç”¨ï¼ˆãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰æ¼æ´©ï¼‰
* GCP ãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚°ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®è„†å¼±æ€§
* [**ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ•ã‚©ãƒ¼ã‚¸ã‚§ãƒª**](https://book.hacktricks.xyz/pentesting-web/ssrf-server-side-request-forgery/cloud-ssrf) ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã¸ã®ã‚¢ã‚¯ã‚»ã‚¹
* **ãƒ­ãƒ¼ã‚«ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿å–ã‚Š**
* `/home/USERNAME/.config/gcloud/*`
* `C:\Users\USERNAME\.config\gcloud\*`
* ç¬¬ä¸‰è€…ã® **ä¾µå®³**
* **å†…éƒ¨** å¾“æ¥­å“¡

ã¾ãŸã¯ã€**èªè¨¼ã•ã‚Œã¦ã„ãªã„ã‚µãƒ¼ãƒ“ã‚¹** ã‚’ä¾µå®³ã™ã‚‹ã“ã¨ã«ã‚ˆã£ã¦ï¼š

{% content-ref url="gcp-unauthenticated-enum-and-access/" %}
[gcp-unauthenticated-enum-and-access](gcp-unauthenticated-enum-and-access/)
{% endcontent-ref %}

ã¾ãŸã¯ã€**ãƒ¬ãƒ“ãƒ¥ãƒ¼** ã‚’è¡Œã£ã¦ã„ã‚‹å ´åˆã¯ã€ã“ã‚Œã‚‰ã®å½¹å‰²ã§ **è³‡æ ¼æƒ…å ±ã‚’è¦æ±‚** ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ï¼š

{% content-ref url="gcp-permissions-for-a-pentest.md" %}
[gcp-permissions-for-a-pentest.md](gcp-permissions-for-a-pentest.md)
{% endcontent-ref %}

{% hint style="info" %}
è³‡æ ¼æƒ…å ±ã‚’å–å¾—ã—ãŸå¾Œã¯ã€ãã‚Œã‚‰ã®è³‡æ ¼æƒ…å ±ãŒ **èª°ã«å±ã—ã¦ã„ã‚‹ã‹**ã€ãŠã‚ˆã³ **ä½•ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ã‹** ã‚’çŸ¥ã‚‹å¿…è¦ãŒã‚ã‚‹ãŸã‚ã€ã„ãã¤ã‹ã®åŸºæœ¬çš„ãªåˆ—æŒ™ã‚’è¡Œã†å¿…è¦ãŒã‚ã‚Šã¾ã™ï¼š
{% endhint %}

## åŸºæœ¬çš„ãªåˆ—æŒ™

### **SSRF**

GCP ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚’ **åˆ—æŒ™** ã™ã‚‹æ–¹æ³•ã«ã¤ã„ã¦ã®è©³ç´°ã¯ã€ä»¥ä¸‹ã® hacktricks ãƒšãƒ¼ã‚¸ã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼š

{% embed url="https://book.hacktricks.xyz/pentesting-web/ssrf-server-side-request-forgery/cloud-ssrf#6440" %}

### Whoami

GCP ã§ã¯ã€ã‚ãªãŸãŒèª°ã§ã‚ã‚‹ã‹ã‚’æ¨æ¸¬ã™ã‚‹ãŸã‚ã«ã„ãã¤ã‹ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’è©¦ã™ã“ã¨ãŒã§ãã¾ã™ï¼š

{% code overflow="wrap" %}
```bash
#If you are inside a compromise machine
gcloud auth list
curl -H "Content-Type: application/x-www-form-urlencoded" -d "access_token=$(gcloud auth print-access-token)" https://www.googleapis.com/oauth2/v1/tokeninfo
gcloud auth print-identity-token #Get info from the token

#If you compromised a metadata token or somehow found an OAuth token
curl -H "Content-Type: application/x-www-form-urlencoded" -d "access_token=<token>" https://www.googleapis.com/oauth2/v1/tokeninfo
```
{% endcode %}

### çµ„ç¹”ã®åˆ—æŒ™
```bash
# Get organizations
gcloud organizations list #The DIRECTORY_CUSTOMER_ID is the Workspace ID
gcloud resource-manager folders list --organization <org_number> # Get folders
gcloud projects list # Get projects
```
### ãƒ—ãƒªãƒ³ã‚·ãƒ‘ãƒ«ã¨IAMåˆ—æŒ™

ååˆ†ãªæ¨©é™ãŒã‚ã‚‹å ´åˆã€**GCPã‚¢ã‚«ã‚¦ãƒ³ãƒˆå†…ã®å„ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã®æ¨©é™ã‚’ç¢ºèªã™ã‚‹ã“ã¨**ã¯ã€ã‚ãªãŸã‚„ä»–ã®ã‚¢ã‚¤ãƒ‡ãƒ³ãƒ†ã‚£ãƒ†ã‚£ãŒä½•ã‚’ã§ãã‚‹ã‹ã€ã¾ãŸ**æ¨©é™ã‚’æ˜‡æ ¼ã•ã›ã‚‹æ–¹æ³•**ã‚’ç†è§£ã™ã‚‹ã®ã«å½¹ç«‹ã¡ã¾ã™ã€‚

IAMã‚’åˆ—æŒ™ã™ã‚‹ãŸã‚ã®ååˆ†ãªæ¨©é™ãŒãªã„å ´åˆã¯ã€**å¼·åˆ¶çš„ã«ç›—ã‚€ã“ã¨ãŒã§ãã¾ã™**ã€‚\
**åˆ—æŒ™ã¨å¼·åˆ¶çš„ã«å–å¾—ã™ã‚‹æ–¹æ³•**ã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼š

{% content-ref url="gcp-services/gcp-iam-and-org-policies-enum.md" %}
[gcp-iam-and-org-policies-enum.md](gcp-services/gcp-iam-and-org-policies-enum.md)
{% endcontent-ref %}

{% hint style="info" %}
ä»Šã€ã‚ãªãŸã¯**è³‡æ ¼æƒ…å ±ã«é–¢ã™ã‚‹æƒ…å ±ã‚’æŒã£ã¦ã„ã¾ã™**ï¼ˆãã—ã¦ã€ã‚‚ã—ã‚ãªãŸãŒãƒ¬ãƒƒãƒ‰ãƒãƒ¼ãƒ ã§ã‚ã‚Œã°ã€**æ¤œå‡ºã•ã‚Œã¦ã„ãªã„ã“ã¨ã‚’é¡˜ã£ã¦ã„ã¾ã™**ï¼‰ã€‚ç’°å¢ƒã§ä½¿ç”¨ã•ã‚Œã¦ã„ã‚‹ã‚µãƒ¼ãƒ“ã‚¹ã‚’ç‰¹å®šã™ã‚‹æ™‚ãŒæ¥ã¾ã—ãŸã€‚\
æ¬¡ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã§ã¯ã€**ä¸€èˆ¬çš„ãªã‚µãƒ¼ãƒ“ã‚¹ã‚’åˆ—æŒ™ã™ã‚‹æ–¹æ³•**ã‚’ç¢ºèªã§ãã¾ã™ã€‚
{% endhint %}

## ã‚µãƒ¼ãƒ“ã‚¹åˆ—æŒ™

GCPã«ã¯é©šãã¹ãæ•°ã®ã‚µãƒ¼ãƒ“ã‚¹ãŒã‚ã‚Šã¾ã™ã€‚æ¬¡ã®ãƒšãƒ¼ã‚¸ã§ã¯ã€**åŸºæœ¬æƒ…å ±ã€åˆ—æŒ™**ã®ãƒãƒ¼ãƒˆã‚·ãƒ¼ãƒˆã€**æ¤œå‡ºã‚’å›é¿ã™ã‚‹æ–¹æ³•**ã€**æŒç¶šæ€§**ã‚’å¾—ã‚‹æ–¹æ³•ã€ãã®ä»–ã®**ãƒã‚¹ãƒˆã‚¨ã‚¯ã‚¹ãƒ—ãƒ­ã‚¤ãƒˆ**ã®ãƒˆãƒªãƒƒã‚¯ã«ã¤ã„ã¦ã®æƒ…å ±ã‚’è¦‹ã¤ã‘ã‚‹ã“ã¨ãŒã§ãã¾ã™ï¼š

{% content-ref url="gcp-services/" %}
[gcp-services](gcp-services/)
{% endcontent-ref %}

ã™ã¹ã¦ã®ä½œæ¥­ã‚’**æ‰‹å‹•ã§**è¡Œã†å¿…è¦ã¯ãªã„ã“ã¨ã«æ³¨æ„ã—ã¦ãã ã•ã„ã€‚ä»¥ä¸‹ã®æŠ•ç¨¿ã§ã¯ã€[**è‡ªå‹•ãƒ„ãƒ¼ãƒ«**](./#automatic-tools)ã«é–¢ã™ã‚‹**ã‚»ã‚¯ã‚·ãƒ§ãƒ³**ã‚’è¦‹ã¤ã‘ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

ã•ã‚‰ã«ã€ã“ã®æ®µéšã§**èªè¨¼ã•ã‚Œã¦ã„ãªã„ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«å…¬é–‹ã•ã‚Œã¦ã„ã‚‹ã‚µãƒ¼ãƒ“ã‚¹ã‚’**ç™ºè¦‹ã™ã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚ãã‚Œã‚‰ã‚’æ‚ªç”¨ã§ãã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ï¼š

{% content-ref url="gcp-unauthenticated-enum-and-access/" %}
[gcp-unauthenticated-enum-and-access](gcp-unauthenticated-enum-and-access/)
{% endcontent-ref %}

## æ¨©é™æ˜‡æ ¼ã€ãƒã‚¹ãƒˆã‚¨ã‚¯ã‚¹ãƒ—ãƒ­ã‚¤ãƒˆï¼†æŒç¶šæ€§

ã‚¯ãƒ©ã‚¦ãƒ‰ã®è³‡æ ¼æƒ…å ±ã‚’å–å¾—ã—ãŸã‚Šã€ã‚¯ãƒ©ã‚¦ãƒ‰å†…ã§å®Ÿè¡Œã•ã‚Œã¦ã„ã‚‹ã‚µãƒ¼ãƒ“ã‚¹ã‚’ä¾µå®³ã—ãŸå¾Œã®æœ€ã‚‚ä¸€èˆ¬çš„ãªæ–¹æ³•ã¯ã€**ä¾µå®³ã•ã‚ŒãŸã‚¢ã‚«ã‚¦ãƒ³ãƒˆãŒæŒã¤èª¤è¨­å®šã•ã‚ŒãŸæ¨©é™ã‚’æ‚ªç”¨ã™ã‚‹ã“ã¨**ã§ã™ã€‚ã—ãŸãŒã£ã¦ã€æœ€åˆã«è¡Œã†ã¹ãã“ã¨ã¯ã€ã‚ãªãŸã®æ¨©é™ã‚’åˆ—æŒ™ã™ã‚‹ã“ã¨ã§ã™ã€‚

ã•ã‚‰ã«ã€ã“ã®åˆ—æŒ™ä¸­ã«ã€**æ¨©é™ã¯ã€Œçµ„ç¹”ã€ã®æœ€é«˜ãƒ¬ãƒ™ãƒ«ã§è¨­å®šã§ãã‚‹**ã“ã¨ã‚’å¿˜ã‚Œãªã„ã§ãã ã•ã„ã€‚

{% content-ref url="gcp-privilege-escalation/" %}
[gcp-privilege-escalation](gcp-privilege-escalation/)
{% endcontent-ref %}

{% content-ref url="gcp-post-exploitation/" %}
[gcp-post-exploitation](gcp-post-exploitation/)
{% endcontent-ref %}

{% content-ref url="gcp-persistence/" %}
[gcp-persistence](gcp-persistence/)
{% endcontent-ref %}

### å…¬é–‹ã•ã‚Œã¦ã„ã‚‹ã‚µãƒ¼ãƒ“ã‚¹

GCPã‚µãƒ¼ãƒ“ã‚¹ã‚’åˆ—æŒ™ã—ã¦ã„ã‚‹ã¨ãã«ã€ã„ãã¤ã‹ã®ã‚µãƒ¼ãƒ“ã‚¹ãŒ**ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã«è¦ç´ ã‚’å…¬é–‹ã—ã¦ã„ã‚‹**ã®ã‚’è¦‹ã¤ã‘ãŸã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ï¼ˆVM/ã‚³ãƒ³ãƒ†ãƒŠã®ãƒãƒ¼ãƒˆã€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚„ã‚­ãƒ¥ãƒ¼ã‚µãƒ¼ãƒ“ã‚¹ã€ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã‚„ãƒã‚±ãƒƒãƒˆãªã©ï¼‰ã€‚\
ãƒšãƒ³ãƒ†ã‚¹ã‚¿ãƒ¼/ãƒ¬ãƒƒãƒ‰ãƒãƒ¼ãƒ ã¨ã—ã¦ã€**æ©Ÿå¯†æƒ…å ±ã‚„è„†å¼±æ€§**ã‚’è¦‹ã¤ã‘ã‚‰ã‚Œã‚‹ã‹ã©ã†ã‹ã‚’å¸¸ã«ç¢ºèªã™ã¹ãã§ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€**AWSã‚¢ã‚«ã‚¦ãƒ³ãƒˆã¸ã®ã•ã‚‰ãªã‚‹ã‚¢ã‚¯ã‚»ã‚¹**ã‚’å¾—ã‚‹ã“ã¨ãŒã§ãã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚

ã“ã®æœ¬ã§ã¯ã€**å…¬é–‹ã•ã‚Œã¦ã„ã‚‹GCPã‚µãƒ¼ãƒ“ã‚¹ã‚’è¦‹ã¤ã‘ã‚‹æ–¹æ³•ã¨ãã‚Œã‚’ç¢ºèªã™ã‚‹æ–¹æ³•**ã«é–¢ã™ã‚‹**æƒ…å ±**ã‚’è¦‹ã¤ã‘ã‚‹ã“ã¨ãŒã§ãã‚‹ã¯ãšã§ã™ã€‚**å…¬é–‹ã•ã‚ŒãŸãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚µãƒ¼ãƒ“ã‚¹ã®è„†å¼±æ€§ã‚’è¦‹ã¤ã‘ã‚‹æ–¹æ³•**ã«ã¤ã„ã¦ã¯ã€ç‰¹å®šã®**ã‚µãƒ¼ãƒ“ã‚¹**ã‚’ä»¥ä¸‹ã§**æ¤œç´¢**ã™ã‚‹ã“ã¨ã‚’ãŠå‹§ã‚ã—ã¾ã™ï¼š

{% embed url="https://book.hacktricks.xyz/" %}

## GCP <--> Workspace ãƒ”ãƒœãƒƒãƒˆ

**ä¸€ã¤ã®**ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã§ãƒ—ãƒªãƒ³ã‚·ãƒ‘ãƒ«ã‚’**ä¾µå®³ã™ã‚‹ã“ã¨**ã¯ã€æ”»æ’ƒè€…ãŒ**ã‚‚ã†ä¸€æ–¹ã‚’ä¾µå®³ã™ã‚‹**ã“ã¨ã‚’å¯èƒ½ã«ã™ã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚ä»¥ä¸‹ã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼š

{% content-ref url="gcp-to-workspace-pivoting/" %}
[gcp-to-workspace-pivoting](gcp-to-workspace-pivoting/)
{% endcontent-ref %}

## è‡ªå‹•ãƒ„ãƒ¼ãƒ«

* **GCloudã‚³ãƒ³ã‚½ãƒ¼ãƒ«**ã§ã¯ã€[https://console.cloud.google.com/iam-admin/asset-inventory/dashboard](https://console.cloud.google.com/iam-admin/asset-inventory/dashboard)ã§ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«ã‚ˆã£ã¦ä½¿ç”¨ã•ã‚Œã¦ã„ã‚‹ãƒªã‚½ãƒ¼ã‚¹ã¨IAMã‚’ç¢ºèªã§ãã¾ã™ã€‚
* ã“ã®APIã§ã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã‚‹è³‡ç”£ã‚’ç¢ºèªã§ãã¾ã™ï¼š[https://cloud.google.com/asset-inventory/docs/supported-asset-types](https://cloud.google.com/asset-inventory/docs/supported-asset-types)
* [**è¤‡æ•°ã®ã‚¯ãƒ©ã‚¦ãƒ‰ã§ä½¿ç”¨ã§ãã‚‹ãƒ„ãƒ¼ãƒ«**](../pentesting-cloud-methodology.md)ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚
* [**gcp\_scanner**](https://github.com/google/gcp\_scanner)ï¼šã“ã‚Œã¯ã€GCPä¸Šã§ç‰¹å®šã®è³‡æ ¼æƒ…å ±ãŒæŒã¤**ã‚¢ã‚¯ã‚»ã‚¹ãƒ¬ãƒ™ãƒ«ã‚’åˆ¤æ–­ã™ã‚‹ã®ã«å½¹ç«‹ã¤GCPãƒªã‚½ãƒ¼ã‚¹ã‚¹ã‚­ãƒ£ãƒŠãƒ¼ã§ã™**ã€‚
```bash
# Install
git clone https://github.com/google/gcp_scanner.git
cd gcp_scanner
virtualenv -p python3 venv
source venv/bin/activate
pip install -r requirements.txt
# Execute with gcloud creds
python3 __main__.py -o /tmp/output/ -g "$HOME/.config/gcloud"
```
* [**gcp\_enum**](https://gitlab.com/gitlab-com/gl-security/threatmanagement/redteam/redteam-public/gcp\_enum): gcloud cliã‚’ä½¿ç”¨ã—ã¦GCPç’°å¢ƒã‚’åˆ—æŒ™ã—ã€çµæœã‚’ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜ã™ã‚‹Bashã‚¹ã‚¯ãƒªãƒ—ãƒˆã€‚
* [**GCP-IAM-Privilege-Escalation**](https://github.com/RhinoSecurityLabs/GCP-IAM-Privilege-Escalation): é«˜ã„IAMæ¨©é™ã‚’åˆ—æŒ™ã—ã€ãã‚Œã‚’æ‚ªç”¨ã—ã¦GCPã§æ¨©é™ã‚’æ˜‡æ ¼ã•ã›ã‚‹ã‚¹ã‚¯ãƒªãƒ—ãƒˆï¼ˆåˆ—æŒ™ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å®Ÿè¡Œã§ãã¾ã›ã‚“ã§ã—ãŸï¼‰ã€‚
* [**BF My GCP Permissions**](https://github.com/carlospolop/bf\_my\_gcp\_permissions): ã‚ãªãŸã®æ¨©é™ã‚’ãƒ–ãƒ«ãƒ¼ãƒˆãƒ•ã‚©ãƒ¼ã‚¹ã™ã‚‹ã‚¹ã‚¯ãƒªãƒ—ãƒˆã€‚

## gcloud config & debug
```bash
# Login so gcloud can use your credentials
gcloud auth login
gcloud config set project security-devbox
gcloud auth print-access-token

# Login so SDKs can use your user credentials
gcloud auth application-default login
gcloud auth application-default set-quota-project security-devbox
gcloud auth application-default print-access-token

# Update gcloud
gcloud components update
```
### Capture gcloud, gsutil... network

**gcloud** CLIã§**ãƒªã‚¯ã‚¨ã‚¹ãƒˆ**ã‚’**è¡¨ç¤º**ã™ã‚‹ãŸã‚ã«ã€**ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿** **`--log-http`**ã‚’ä½¿ç”¨ã§ãã‚‹ã“ã¨ã‚’å¿˜ã‚Œãªã„ã§ãã ã•ã„ã€‚ãƒˆãƒ¼ã‚¯ãƒ³å€¤ã‚’ãƒ­ã‚°ã‹ã‚‰éš ã—ãŸããªã„å ´åˆã¯ã€`gcloud config set log_http_redact_token false`ã‚’ä½¿ç”¨ã—ã¦ãã ã•ã„ã€‚

ã•ã‚‰ã«ã€é€šä¿¡ã‚’å‚å—ã™ã‚‹ã«ã¯ï¼š
```bash
gcloud config set proxy/address 127.0.0.1
gcloud config set proxy/port 8080
gcloud config set proxy/type http
gcloud config set auth/disable_ssl_validation True

# If you don't want to completely disable ssl_validation use:
gcloud config set core/custom_ca_certs_file cert.pem

# Back to normal
gcloud config unset proxy/address
gcloud config unset proxy/port
gcloud config unset proxy/type
gcloud config unset auth/disable_ssl_validation
gcloud config unset core/custom_ca_certs_file
```
### OAuthãƒˆãƒ¼ã‚¯ãƒ³ã‚’gcloudã§è¨­å®šã™ã‚‹

**ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‹ã‚‰æŠ½å‡ºã•ã‚ŒãŸã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆOAuthãƒˆãƒ¼ã‚¯ãƒ³ã‚’ä½¿ç”¨ã™ã‚‹ãŸã‚ã«ã¯**ã€æ¬¡ã®ã‚ˆã†ã«ã™ã‚‹ã ã‘ã§ã™ï¼š
```bash
# Via env vars
export CLOUDSDK_AUTH_ACCESS_TOKEN=<token>
gcloud projects list

# Via setup
echo "<token>" > /some/path/to/token
gcloud config set auth/access_token_file /some/path/to/token
gcloud projects list
gcloud config unset auth/access_token_file
```
## å‚è€ƒæ–‡çŒ®

* [https://about.gitlab.com/blog/2020/02/12/plundering-gcp-escalating-privileges-in-google-cloud-platform/](https://about.gitlab.com/blog/2020/02/12/plundering-gcp-escalating-privileges-in-google-cloud-platform/)

{% hint style="success" %}
AWSãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã³ã€å®Ÿè·µã™ã‚‹ï¼š<img src="../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/image (1).png" alt="" data-size="line">\
GCPãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã³ã€å®Ÿè·µã™ã‚‹ï¼š<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricksã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹</summary>

* [**ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³**](https://github.com/sponsors/carlospolop)ã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼
* **ğŸ’¬ [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã¾ãŸã¯[**Telegramã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«å‚åŠ ã™ã‚‹ã‹ã€**Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**ã‚’ãƒ•ã‚©ãƒ­ãƒ¼ã—ã¦ãã ã•ã„ã€‚**
* **ãƒãƒƒã‚­ãƒ³ã‚°ã®ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã™ã‚‹ã«ã¯ã€[**HackTricks**](https://github.com/carlospolop/hacktricks)ã¨[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)ã®GitHubãƒªãƒã‚¸ãƒˆãƒªã«PRã‚’æå‡ºã—ã¦ãã ã•ã„ã€‚**

</details>
{% endhint %}
