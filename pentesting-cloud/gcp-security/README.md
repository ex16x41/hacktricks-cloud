# GCP Pentesting

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Basic Information

**–ü–µ—Ä–µ–¥ –ø–æ—á–∞—Ç–∫–æ–º pentesting** —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞ **GCP**, —î –∫—ñ–ª—å–∫–∞ **–æ—Å–Ω–æ–≤–Ω–∏—Ö —Ä–µ—á–µ–π, —è–∫—ñ –≤–∞–º –ø–æ—Ç—Ä—ñ–±–Ω–æ –∑–Ω–∞—Ç–∏** –ø—Ä–æ —Ç–µ, —è–∫ —Ü–µ –ø—Ä–∞—Ü—é—î, —â–æ–± –¥–æ–ø–æ–º–æ–≥—Ç–∏ –≤–∞–º –∑—Ä–æ–∑—É–º—ñ—Ç–∏, —â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ —Ä–æ–±–∏—Ç–∏, —è–∫ –∑–Ω–∞—Ö–æ–¥–∏—Ç–∏ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ñ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è —Ç–∞ —è–∫ —ó—Ö –µ–∫—Å–ø–ª—É–∞—Ç—É–≤–∞—Ç–∏.

–ö–æ–Ω—Ü–µ–ø—Ü—ñ—ó, —Ç–∞–∫—ñ —è–∫ **—ñ—î—Ä–∞—Ä—Ö—ñ—è –æ—Ä–≥–∞–Ω—ñ–∑–∞—Ü—ñ—ó**, **–¥–æ–∑–≤–æ–ª–∏** —Ç–∞ —ñ–Ω—à—ñ –æ—Å–Ω–æ–≤–Ω—ñ –∫–æ–Ω—Ü–µ–ø—Ü—ñ—ó –ø–æ—è—Å–Ω—é—é—Ç—å—Å—è –≤:

{% content-ref url="gcp-basic-information/" %}
[gcp-basic-information](gcp-basic-information/)
{% endcontent-ref %}

## Labs to learn

* [https://gcpgoat.joshuajebaraj.com/](https://gcpgoat.joshuajebaraj.com/)
* [https://github.com/ine-labs/GCPGoat](https://github.com/ine-labs/GCPGoat)
* [https://github.com/lacioffi/GCP-pentest-lab/](https://github.com/lacioffi/GCP-pentest-lab/)
* [https://github.com/carlospolop/gcp\_privesc\_scripts](https://github.com/carlospolop/gcp_privesc_scripts)

## GCP Pentester/Red Team Methodology

–©–æ–± –ø—Ä–æ–≤–µ—Å—Ç–∏ –∞—É–¥–∏—Ç —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞ GCP, –¥—É–∂–µ –≤–∞–∂–ª–∏–≤–æ –∑–Ω–∞—Ç–∏: —è–∫—ñ **–ø–æ—Å–ª—É–≥–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å—Å—è**, —â–æ **–µ–∫—Å–ø–æ–Ω—É—î—Ç—å—Å—è**, —Ö—Ç–æ –º–∞—î **–¥–æ—Å—Ç—É–ø** –¥–æ —á–æ–≥–æ, —ñ —è–∫ –≤–Ω—É—Ç—Ä—ñ—à–Ω—ñ GCP –ø–æ—Å–ª—É–≥–∏ —Ç–∞ **–∑–æ–≤–Ω—ñ—à–Ω—ñ –ø–æ—Å–ª—É–≥–∏** –∑'—î–¥–Ω–∞–Ω—ñ.

–ó —Ç–æ—á–∫–∏ –∑–æ—Ä—É Red Team, **–ø–µ—Ä—à–∏–π –∫—Ä–æ–∫ –¥–ª—è –∫–æ–º–ø—Ä–æ–º–µ—Ç–∞—Ü—ñ—ó —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞ GCP** - —Ü–µ –æ—Ç—Ä–∏–º–∞—Ç–∏ –¥–µ—è–∫—ñ **–æ–±–ª—ñ–∫–æ–≤—ñ –¥–∞–Ω—ñ**. –û—Å—å –∫—ñ–ª—å–∫–∞ —ñ–¥–µ–π, —è–∫ —Ü–µ –∑—Ä–æ–±–∏—Ç–∏:

* **–í–∏—Ç–æ–∫–∏** –≤ github (–∞–±–æ –ø–æ–¥—ñ–±–Ω–∏—Ö) - OSINT
* **–°–æ—Ü—ñ–∞–ª—å–Ω–∞** —ñ–Ω–∂–µ–Ω–µ—Ä—ñ—è (–ø–µ—Ä–µ–≤—ñ—Ä—Ç–µ —Å—Ç–æ—Ä—ñ–Ω–∫—É [**Workspace Security**](../workspace-security/))
* **–ü–æ–≤—Ç–æ—Ä–Ω–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –ø–∞—Ä–æ–ª—ñ–≤** (–≤–∏—Ç–æ–∫–∏ –ø–∞—Ä–æ–ª—ñ–≤)
* –í—Ä–∞–∑–ª–∏–≤–æ—Å—Ç—ñ –≤ GCP-—Ä–æ–∑–º—ñ—â–µ–Ω–∏—Ö –¥–æ–¥–∞—Ç–∫–∞—Ö
* [**Server Side Request Forgery**](https://book.hacktricks.xyz/pentesting-web/ssrf-server-side-request-forgery/cloud-ssrf) –∑ –¥–æ—Å—Ç—É–ø–æ–º –¥–æ –º–µ—Ç–∞–¥–∞–Ω–∏—Ö
* **–ß–∏—Ç–∞–Ω–Ω—è –ª–æ–∫–∞–ª—å–Ω–∏—Ö —Ñ–∞–π–ª—ñ–≤**
* `/home/USERNAME/.config/gcloud/*`
* `C:\Users\USERNAME\.config\gcloud\*`
* 3-—Ç—ñ —Å—Ç–æ—Ä–æ–Ω–∏ **–∑–ª–∞–º–∞–Ω—ñ**
* **–í–Ω—É—Ç—Ä—ñ—à–Ω—ñ–π** –ø—Ä–∞—Ü—ñ–≤–Ω–∏–∫

–ê–±–æ —à–ª—è—Ö–æ–º **–∫–æ–º–ø—Ä–æ–º–µ—Ç–∞—Ü—ñ—ó –Ω–µ–∞–≤—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–æ–≤–∞–Ω–æ—ó —Å–ª—É–∂–±–∏**, —â–æ –µ–∫—Å–ø–æ–Ω—É—î—Ç—å—Å—è:

{% content-ref url="gcp-unauthenticated-enum-and-access/" %}
[gcp-unauthenticated-enum-and-access](gcp-unauthenticated-enum-and-access/)
{% endcontent-ref %}

–ê–±–æ, —è–∫—â–æ –≤–∏ –ø—Ä–æ–≤–æ–¥–∏—Ç–µ **–æ–≥–ª—è–¥**, –≤–∏ –º–æ–∂–µ—Ç–µ –ø—Ä–æ—Å—Ç–æ **–ø–æ–ø—Ä–æ—Å–∏—Ç–∏ –æ–±–ª—ñ–∫–æ–≤—ñ –¥–∞–Ω—ñ** –∑ —Ü–∏–º–∏ —Ä–æ–ª—è–º–∏:

{% content-ref url="gcp-permissions-for-a-pentest.md" %}
[gcp-permissions-for-a-pentest.md](gcp-permissions-for-a-pentest.md)
{% endcontent-ref %}

{% hint style="info" %}
–ü—ñ—Å–ª—è —Ç–æ–≥–æ, —è–∫ –≤–∏ –∑–º–æ–≥–ª–∏ –æ—Ç—Ä–∏–º–∞—Ç–∏ –æ–±–ª—ñ–∫–æ–≤—ñ –¥–∞–Ω—ñ, –≤–∞–º –ø–æ—Ç—Ä—ñ–±–Ω–æ –∑–Ω–∞—Ç–∏, **–∫–æ–º—É –Ω–∞–ª–µ–∂–∞—Ç—å —Ü—ñ –æ–±–ª—ñ–∫–æ–≤—ñ –¥–∞–Ω—ñ**, —ñ **–¥–æ —á–æ–≥–æ –≤–æ–Ω–∏ –º–∞—é—Ç—å –¥–æ—Å—Ç—É–ø**, —Ç–æ–º—É –≤–∞–º –ø–æ—Ç—Ä—ñ–±–Ω–æ –≤–∏–∫–æ–Ω–∞—Ç–∏ –¥–µ—è–∫—É –±–∞–∑–æ–≤—É –µ–Ω—É–º–µ—Ä–∞—Ü—ñ—é:
{% endhint %}

## Basic Enumeration

### **SSRF**

–î–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –¥–æ–¥–∞—Ç–∫–æ–≤–æ—ó —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó –ø—Ä–æ —Ç–µ, —è–∫ **–ø–µ—Ä–µ—Ä–∞—Ö—É–≤–∞—Ç–∏ –º–µ—Ç–∞–¥–∞–Ω—ñ GCP**, –ø–µ—Ä–µ–≤—ñ—Ä—Ç–µ –Ω–∞—Å—Ç—É–ø–Ω—É —Å—Ç–æ—Ä—ñ–Ω–∫—É hacktricks:

{% embed url="https://book.hacktricks.xyz/pentesting-web/ssrf-server-side-request-forgery/cloud-ssrf#6440" %}

### Whoami

–í GCP –≤–∏ –º–æ–∂–µ—Ç–µ —Å–ø—Ä–æ–±—É–≤–∞—Ç–∏ –∫—ñ–ª—å–∫–∞ –≤–∞—Ä—ñ–∞–Ω—Ç—ñ–≤, —â–æ–± —Å–ø—Ä–æ–±—É–≤–∞—Ç–∏ –≤–≥–∞–¥–∞—Ç–∏, —Ö—Ç–æ –≤–∏ —î:

{% code overflow="wrap" %}
```bash
#If you are inside a compromise machine
gcloud auth list
curl -H "Content-Type: application/x-www-form-urlencoded" -d "access_token=$(gcloud auth print-access-token)" https://www.googleapis.com/oauth2/v1/tokeninfo
gcloud auth print-identity-token #Get info from the token

#If you compromised a metadata token or somehow found an OAuth token
curl -H "Content-Type: application/x-www-form-urlencoded" -d "access_token=<token>" https://www.googleapis.com/oauth2/v1/tokeninfo
```
{% endcode %}

–í–∏ —Ç–∞–∫–æ–∂ –º–æ–∂–µ—Ç–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ API-—ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å `/userinfo`, —â–æ–± –æ—Ç—Ä–∏–º–∞—Ç–∏ –±—ñ–ª—å—à–µ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó –ø—Ä–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞:

{% code overflow="wrap" %}
```bash
curl -H "Content-Type: application/x-www-form-urlencoded" -H "Authorization: OAuth $(gcloud auth print-access-token)" https://www.googleapis.com/oauth2/v1/userinfo

curl -H "Content-Type: application/x-www-form-urlencoded" -H "Authorization: OAuth <access_token>" https://www.googleapis.com/oauth2/v1/userinfo
```
{% endcode %}

### –ü–µ—Ä–µ—Ä–∞—Ö—É–Ω–æ–∫ –æ—Ä–≥–∞–Ω—ñ–∑–∞—Ü—ñ–π
```bash
# Get organizations
gcloud organizations list #The DIRECTORY_CUSTOMER_ID is the Workspace ID
gcloud resource-manager folders list --organization <org_number> # Get folders
gcloud projects list # Get projects
```
### –ü—Ä–∏–Ω—Ü–∏–ø–∏ —Ç–∞ IAM –ü–µ—Ä–µ—Ä–∞—Ö—É–Ω–æ–∫

–Ø–∫—â–æ —É –≤–∞—Å –¥–æ—Å—Ç–∞—Ç–Ω—å–æ –ø—Ä–∞–≤, **–ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ –ø—Ä–∏–≤—ñ–ª–µ—ó–≤ –∫–æ–∂–Ω–æ—ó —Å—É—Ç–Ω–æ—Å—Ç—ñ –≤ –æ–±–ª—ñ–∫–æ–≤–æ–º—É –∑–∞–ø–∏—Å—ñ GCP** –¥–æ–ø–æ–º–æ–∂–µ –≤–∞–º –∑—Ä–æ–∑—É–º—ñ—Ç–∏, —â–æ –≤–∏ —Ç–∞ —ñ–Ω—à—ñ —ñ–¥–µ–Ω—Ç–∏—á–Ω–æ—Å—Ç—ñ –º–æ–∂–µ—Ç–µ —Ä–æ–±–∏—Ç–∏ —ñ —è–∫ **–ø—ñ–¥–≤–∏—â–∏—Ç–∏ –ø—Ä–∏–≤—ñ–ª–µ—ó**.

–Ø–∫—â–æ —É –≤–∞—Å –Ω–µ–¥–æ—Å—Ç–∞—Ç–Ω—å–æ –ø—Ä–∞–≤ –¥–ª—è –ø–µ—Ä–µ—Ä–∞—Ö—É–Ω–∫—É IAM, –≤–∏ –º–æ–∂–µ—Ç–µ **–≤–∏–∫—Ä–∞—Å—Ç–∏ —ó—Ö –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –±—Ä—É—Ç—Ñ–æ—Ä—Å—É**, —â–æ–± –¥—ñ–∑–Ω–∞—Ç–∏—Å—è.\
–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ **—è–∫ –≤–∏–∫–æ–Ω–∞—Ç–∏ –ø–µ—Ä–µ—Ä–∞—Ö—É–Ω–æ–∫ —Ç–∞ –±—Ä—É—Ç—Ñ–æ—Ä—Å** —É:

{% content-ref url="gcp-services/gcp-iam-and-org-policies-enum.md" %}
[gcp-iam-and-org-policies-enum.md](gcp-services/gcp-iam-and-org-policies-enum.md)
{% endcontent-ref %}

{% hint style="info" %}
–¢–µ–ø–µ—Ä, –∫–æ–ª–∏ –≤–∏ **–º–∞—î—Ç–µ –¥–µ—è–∫—É —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ —Å–≤–æ—ó –æ–±–ª—ñ–∫–æ–≤—ñ –¥–∞–Ω—ñ** (—ñ —è–∫—â–æ –≤–∏ —á–µ—Ä–≤–æ–Ω–∞ –∫–æ–º–∞–Ω–¥–∞, —Å–ø–æ–¥—ñ–≤–∞—é—Å—å, –≤–∏ **–Ω–µ –±—É–ª–∏ –≤–∏—è–≤–ª–µ–Ω—ñ**). –ß–∞—Å –¥—ñ–∑–Ω–∞—Ç–∏—Å—è, —è–∫—ñ —Å–µ—Ä–≤—ñ—Å–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å—Å—è –≤ —Å–µ—Ä–µ–¥–æ–≤–∏—â—ñ.\
–£ –Ω–∞—Å—Ç—É–ø–Ω–æ–º—É —Ä–æ–∑–¥—ñ–ª—ñ –≤–∏ –º–æ–∂–µ—Ç–µ –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –¥–µ—è–∫—ñ —Å–ø–æ—Å–æ–±–∏ **–ø–µ—Ä–µ—Ä–∞—Ö—É–Ω–∫—É –¥–µ—è–∫–∏—Ö –∑–∞–≥–∞–ª—å–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤.**
{% endhint %}

## –ü–µ—Ä–µ—Ä–∞—Ö—É–Ω–æ–∫ –°–µ—Ä–≤—ñ—Å—ñ–≤

GCP –º–∞—î –≤—Ä–∞–∂–∞—é—á—É –∫—ñ–ª—å–∫—ñ—Å—Ç—å —Å–µ—Ä–≤—ñ—Å—ñ–≤, –Ω–∞ –Ω–∞—Å—Ç—É–ø–Ω—ñ–π —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ –≤–∏ –∑–Ω–∞–π–¥–µ—Ç–µ **–æ—Å–Ω–æ–≤–Ω—É —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é, –ø–µ—Ä–µ—Ä–∞—Ö—É–Ω–æ–∫** —à–ø–∞—Ä–≥–∞–ª–æ–∫, —è–∫ **—É–Ω–∏–∫–Ω—É—Ç–∏ –≤–∏—è–≤–ª–µ–Ω–Ω—è**, –æ—Ç—Ä–∏–º–∞—Ç–∏ **–ø–æ—Å—Ç—ñ–π–Ω—ñ—Å—Ç—å** —Ç–∞ —ñ–Ω—à—ñ **–ø—ñ—Å–ª—è–µ–∫—Å–ø–ª—É–∞—Ç–∞—Ü—ñ–π–Ω—ñ** —Ç—Ä—é–∫–∏ –ø—Ä–æ –¥–µ—è–∫—ñ –∑ –Ω–∏—Ö:

{% content-ref url="gcp-services/" %}
[gcp-services](gcp-services/)
{% endcontent-ref %}

–ó–≤–µ—Ä–Ω—ñ—Ç—å —É–≤–∞–≥—É, —â–æ –≤–∞–º **–Ω–µ –ø–æ—Ç—Ä—ñ–±–Ω–æ** –≤–∏–∫–æ–Ω—É–≤–∞—Ç–∏ –≤—Å—é —Ä–æ–±–æ—Ç—É **–≤—Ä—É—á–Ω—É**, –Ω–∏–∂—á–µ –≤ —Ü—å–æ–º—É –ø–æ—Å—Ç—ñ –≤–∏ –º–æ–∂–µ—Ç–µ –∑–Ω–∞–π—Ç–∏ **—Ä–æ–∑–¥—ñ–ª –ø—Ä–æ** [**–∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω—ñ —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∏**](./#automatic-tools).

–ë—ñ–ª—å—à–µ —Ç–æ–≥–æ, –Ω–∞ —Ü—å–æ–º—É –µ—Ç–∞–ø—ñ –≤–∏ –º–æ–≥–ª–∏ –≤–∏—è–≤–∏—Ç–∏ **–±—ñ–ª—å—à–µ —Å–µ—Ä–≤—ñ—Å—ñ–≤, –¥–æ—Å—Ç—É–ø–Ω–∏—Ö –¥–ª—è –Ω–µ–∞–≤—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–æ–≤–∞–Ω–∏—Ö –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤,** –≤–∏ –º–æ–∂–µ—Ç–µ –º–∞—Ç–∏ –º–æ–∂–ª–∏–≤—ñ—Å—Ç—å —ó—Ö –µ–∫—Å–ø–ª—É–∞—Ç—É–≤–∞—Ç–∏:

{% content-ref url="gcp-unauthenticated-enum-and-access/" %}
[gcp-unauthenticated-enum-and-access](gcp-unauthenticated-enum-and-access/)
{% endcontent-ref %}

## –ü—ñ–¥–≤–∏—â–µ–Ω–Ω—è –ü—Ä–∏–≤—ñ–ª–µ—ó–≤, –ü—ñ—Å–ª—è–µ–∫—Å–ø–ª—É–∞—Ç–∞—Ü—ñ—è —Ç–∞ –ü–æ—Å—Ç—ñ–π–Ω—ñ—Å—Ç—å

–ù–∞–π–±—ñ–ª—å—à –ø–æ—à–∏—Ä–µ–Ω–∏–π —Å–ø–æ—Å—ñ–±, –∫–æ–ª–∏ –≤–∏ –æ—Ç—Ä–∏–º–∞–ª–∏ –¥–µ—è–∫—ñ –æ–±–ª—ñ–∫–æ–≤—ñ –¥–∞–Ω—ñ —Ö–º–∞—Ä–∏ –∞–±–æ —Å–∫–æ–º–ø—Ä–æ–º–µ—Ç—É–≤–∞–ª–∏ –¥–µ—è–∫–∏–π —Å–µ—Ä–≤—ñ—Å, —â–æ –ø—Ä–∞—Ü—é—î –≤ —Ö–º–∞—Ä—ñ, - —Ü–µ **–∑–ª–æ–≤–∂–∏–≤–∞—Ç–∏ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω–∏–º–∏ –ø—Ä–∏–≤—ñ–ª–µ—è–º–∏**, —è–∫—ñ –º–æ–∂–µ –º–∞—Ç–∏ —Å–∫–æ–º–ø—Ä–æ–º–µ—Ç–æ–≤–∞–Ω–∏–π –æ–±–ª—ñ–∫–æ–≤–∏–π –∑–∞–ø–∏—Å. –û—Ç–∂–µ, –ø–µ—Ä—à–µ, —â–æ –≤–∞–º —Å–ª—ñ–¥ –∑—Ä–æ–±–∏—Ç–∏, - —Ü–µ –ø–µ—Ä–µ—Ä–∞—Ö—É–≤–∞—Ç–∏ —Å–≤–æ—ó –ø—Ä–∏–≤—ñ–ª–µ—ó.

–ë—ñ–ª—å—à–µ —Ç–æ–≥–æ, –ø—ñ–¥ —á–∞—Å —Ü—å–æ–≥–æ –ø–µ—Ä–µ—Ä–∞—Ö—É–Ω–∫—É –ø–∞–º'—è—Ç–∞–π—Ç–µ, —â–æ **–¥–æ–∑–≤–æ–ª–∏ –º–æ–∂—É—Ç—å –±—É—Ç–∏ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ñ –Ω–∞ –Ω–∞–π–≤–∏—â–æ–º—É —Ä—ñ–≤–Ω—ñ "–û—Ä–≥–∞–Ω—ñ–∑–∞—Ü—ñ—ó"** —Ç–∞–∫–æ–∂.

{% content-ref url="gcp-privilege-escalation/" %}
[gcp-privilege-escalation](gcp-privilege-escalation/)
{% endcontent-ref %}

{% content-ref url="gcp-post-exploitation/" %}
[gcp-post-exploitation](gcp-post-exploitation/)
{% endcontent-ref %}

{% content-ref url="gcp-persistence/" %}
[gcp-persistence](gcp-persistence/)
{% endcontent-ref %}

### –ü—É–±–ª—ñ—á–Ω–æ –í—ñ–¥–∫—Ä–∏—Ç—ñ –°–µ—Ä–≤—ñ—Å–∏

–ü—ñ–¥ —á–∞—Å –ø–µ—Ä–µ—Ä–∞—Ö—É–Ω–∫—É —Å–µ—Ä–≤—ñ—Å—ñ–≤ GCP –≤–∏ –º–æ–≥–ª–∏ –∑–Ω–∞–π—Ç–∏ –¥–µ—è–∫—ñ –∑ –Ω–∏—Ö, **—è–∫—ñ –≤—ñ–¥–∫—Ä–∏–≤–∞—é—Ç—å –µ–ª–µ–º–µ–Ω—Ç–∏ –≤ –Ü–Ω—Ç–µ—Ä–Ω–µ—Ç** (–ø–æ—Ä—Ç–∏ VM/–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ñ–≤, –±–∞–∑–∏ –¥–∞–Ω–∏—Ö –∞–±–æ —Å–µ—Ä–≤—ñ—Å–∏ —á–µ—Ä–≥, –∑–Ω—ñ–º–∫–∏ –∞–±–æ –∫–æ—à–∏–∫–∏...).\
–Ø–∫ –ø–µ–Ω—Ç–µ—Å—Ç–µ—Ä/—á–µ—Ä–≤–æ–Ω–∞ –∫–æ–º–∞–Ω–¥–∞, –≤–∏ –∑–∞–≤–∂–¥–∏ –ø–æ–≤–∏–Ω–Ω—ñ –ø–µ—Ä–µ–≤—ñ—Ä—è—Ç–∏, —á–∏ –º–æ–∂–µ—Ç–µ –≤–∏ –∑–Ω–∞–π—Ç–∏ **—á—É—Ç–ª–∏–≤—É —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é / –≤—Ä–∞–∑–ª–∏–≤–æ—Å—Ç—ñ** –Ω–∞ –Ω–∏—Ö, –æ—Å–∫—ñ–ª—å–∫–∏ –≤–æ–Ω–∏ –º–æ–∂—É—Ç—å –Ω–∞–¥–∞—Ç–∏ –≤–∞–º **–¥–æ–¥–∞—Ç–∫–æ–≤–∏–π –¥–æ—Å—Ç—É–ø –¥–æ –æ–±–ª—ñ–∫–æ–≤–æ–≥–æ –∑–∞–ø–∏—Å—É AWS**.

–£ —Ü—ñ–π –∫–Ω–∏–∑—ñ –≤–∏ –ø–æ–≤–∏–Ω–Ω—ñ –∑–Ω–∞–π—Ç–∏ **—ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é** –ø—Ä–æ —Ç–µ, —è–∫ –∑–Ω–∞–π—Ç–∏ **–≤—ñ–¥–∫—Ä–∏—Ç—ñ —Å–µ—Ä–≤—ñ—Å–∏ GCP —Ç–∞ —è–∫ —ó—Ö –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏**. –©–æ–¥–æ —Ç–æ–≥–æ, —è–∫ –∑–Ω–∞–π—Ç–∏ **–≤—Ä–∞–∑–ª–∏–≤–æ—Å—Ç—ñ –≤ –≤—ñ–¥–∫—Ä–∏—Ç–∏—Ö –º–µ—Ä–µ–∂–µ–≤–∏—Ö —Å–µ—Ä–≤—ñ—Å–∞—Ö**, —è –± —Ä–µ–∫–æ–º–µ–Ω–¥—É–≤–∞–≤ –≤–∞–º **—à—É–∫–∞—Ç–∏** –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∏–π **—Å–µ—Ä–≤—ñ—Å** —É:

{% embed url="https://book.hacktricks.xyz/" %}

## GCP <--> Workspace –ü—ñ–≤–æ—Ç—É–≤–∞–Ω–Ω—è

**–°–∫–æ–º–ø—Ä–æ–º–µ—Ç—É–≤–∞–Ω–Ω—è** –ø—Ä–∏–Ω—Ü–∏–ø—ñ–≤ –≤ **–æ–¥–Ω—ñ–π** –ø–ª–∞—Ç—Ñ–æ—Ä–º—ñ –º–æ–∂–µ –¥–æ–∑–≤–æ–ª–∏—Ç–∏ –∑–ª–æ–≤–º–∏—Å–Ω–∏–∫—É **—Å–∫–æ–º–ø—Ä–æ–º–µ—Ç—É–≤–∞—Ç–∏ —ñ–Ω—à—É**, –ø–µ—Ä–µ–≤—ñ—Ä—Ç–µ —Ü–µ –≤:

{% content-ref url="gcp-to-workspace-pivoting/" %}
[gcp-to-workspace-pivoting](gcp-to-workspace-pivoting/)
{% endcontent-ref %}

## –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω—ñ –Ü–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∏

* –£ **–∫–æ–Ω—Å–æ–ª—ñ GCloud**, –Ω–∞ [https://console.cloud.google.com/iam-admin/asset-inventory/dashboard](https://console.cloud.google.com/iam-admin/asset-inventory/dashboard) –≤–∏ –º–æ–∂–µ—Ç–µ –±–∞—á–∏—Ç–∏ —Ä–µ—Å—É—Ä—Å–∏ —Ç–∞ IAM, —â–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å—Å—è –ø—Ä–æ–µ–∫—Ç–æ–º.
* –¢—É—Ç –≤–∏ –º–æ–∂–µ—Ç–µ –ø–æ–±–∞—á–∏—Ç–∏ –∞–∫—Ç–∏–≤–∏, –ø—ñ–¥—Ç—Ä–∏–º—É–≤–∞–Ω—ñ —Ü–∏–º API: [https://cloud.google.com/asset-inventory/docs/supported-asset-types](https://cloud.google.com/asset-inventory/docs/supported-asset-types)
* –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ **—ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∏**, —è–∫—ñ –º–æ–∂–Ω–∞ [**–≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –≤ –∫—ñ–ª—å–∫–æ—Ö —Ö–º–∞—Ä–∞—Ö —Ç—É—Ç**](../pentesting-cloud-methodology.md).
* [**gcp\_scanner**](https://github.com/google/gcp_scanner): –¶–µ —Å–∫–∞–Ω–µ—Ä —Ä–µ—Å—É—Ä—Å—ñ–≤ GCP, —è–∫–∏–π –º–æ–∂–µ –¥–æ–ø–æ–º–æ–≥—Ç–∏ –≤–∏–∑–Ω–∞—á–∏—Ç–∏, —è–∫–∏–π **—Ä—ñ–≤–µ–Ω—å –¥–æ—Å—Ç—É–ø—É –º–∞—é—Ç—å –ø–µ–≤–Ω—ñ –æ–±–ª—ñ–∫–æ–≤—ñ –¥–∞–Ω—ñ** –Ω–∞ GCP.
```bash
# Install
git clone https://github.com/google/gcp_scanner.git
cd gcp_scanner
virtualenv -p python3 venv
source venv/bin/activate
pip install -r requirements.txt
# Execute with gcloud creds
python3 __main__.py -o /tmp/output/ -g "$HOME/.config/gcloud"
```
* [**gcp\_enum**](https://gitlab.com/gitlab-com/gl-security/threatmanagement/redteam/redteam-public/gcp_enum): Bash-—Å–∫—Ä–∏–ø—Ç –¥–ª—è –ø–µ—Ä–µ—Ä–∞—Ö—É–Ω–∫—É —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞ GCP –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é gcloud cli —Ç–∞ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —É —Ñ–∞–π–ª.
* [**GCP-IAM-Privilege-Escalation**](https://github.com/RhinoSecurityLabs/GCP-IAM-Privilege-Escalation): –°–∫—Ä–∏–ø—Ç–∏ –¥–ª—è –ø–µ—Ä–µ—Ä–∞—Ö—É–Ω–∫—É –≤–∏—Å–æ–∫–∏—Ö IAM-–ø—Ä–∏–≤—ñ–ª–µ—ó–≤ —Ç–∞ –¥–ª—è –µ—Å–∫–∞–ª–∞—Ü—ñ—ó –ø—Ä–∏–≤—ñ–ª–µ—ó–≤ —É GCP, –∑–ª–æ–≤–∂–∏–≤–∞—é—á–∏ –Ω–∏–º–∏ (—è –Ω–µ –∑–º—ñ–≥ –∑–∞–ø—É—Å—Ç–∏—Ç–∏ —Å–∫—Ä–∏–ø—Ç –¥–ª—è –ø–µ—Ä–µ—Ä–∞—Ö—É–Ω–∫—É).
* [**BF My GCP Permissions**](https://github.com/carlospolop/bf_my_gcp_permissions): –°–∫—Ä–∏–ø—Ç –¥–ª—è –±—Ä—É—Ç—Ñ–æ—Ä—Å—É –≤–∞—à–∏—Ö –ø—Ä–∏–≤—ñ–ª–µ—ó–≤.

## gcloud config & debug
```bash
# Login so gcloud can use your credentials
gcloud auth login
gcloud config set project security-devbox
gcloud auth print-access-token

# Login so SDKs can use your user credentials
gcloud auth application-default login
gcloud auth application-default set-quota-project security-devbox
gcloud auth application-default print-access-token

# Update gcloud
gcloud components update
```
### Capture gcloud, gsutil... network

–ü–∞–º'—è—Ç–∞–π—Ç–µ, —â–æ –≤–∏ –º–æ–∂–µ—Ç–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ **–ø–∞—Ä–∞–º–µ—Ç—Ä** **`--log-http`** –∑ **`gcloud`** cli, —â–æ–± **–¥—Ä—É–∫—É–≤–∞—Ç–∏** **–∑–∞–ø–∏—Ç–∏**, —è–∫—ñ –≤–∏–∫–æ–Ω—É—î —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç. –Ø–∫—â–æ –≤–∏ –Ω–µ —Ö–æ—á–µ—Ç–µ, —â–æ–± –∂—É—Ä–Ω–∞–ª–∏ —Ä–µ–¥–∞–≥—É–≤–∞–ª–∏ –∑–Ω–∞—á–µ–Ω–Ω—è —Ç–æ–∫–µ–Ω–∞, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ `gcloud config set log_http_redact_token false`

–ö—Ä—ñ–º —Ç–æ–≥–æ, —â–æ–± –ø–µ—Ä–µ—Ö–æ–ø–∏—Ç–∏ –∑–≤'—è–∑–æ–∫:
```bash
gcloud config set proxy/address 127.0.0.1
gcloud config set proxy/port 8080
gcloud config set proxy/type http
gcloud config set auth/disable_ssl_validation True

# If you don't want to completely disable ssl_validation use:
gcloud config set core/custom_ca_certs_file cert.pem

# Back to normal
gcloud config unset proxy/address
gcloud config unset proxy/port
gcloud config unset proxy/type
gcloud config unset auth/disable_ssl_validation
gcloud config unset core/custom_ca_certs_file
```
### –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è —Ç–æ–∫–µ–Ω–∞ OAuth —É gcloud

–©–æ–± **–≤–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ –µ–∫—Å—Ñ—ñ–ª—å—Ç—Ä–æ–≤–∞–Ω–∏–π —Ç–æ–∫–µ–Ω OAuth –æ–±–ª—ñ–∫–æ–≤–æ–≥–æ –∑–∞–ø–∏—Å—É —Å–ª—É–∂–±–∏ –∑ –∫—ñ–Ω—Ü–µ–≤–æ—ó —Ç–æ—á–∫–∏ –º–µ—Ç–∞–¥–∞–Ω–∏—Ö**, –≤–∏ –º–æ–∂–µ—Ç–µ –ø—Ä–æ—Å—Ç–æ –∑—Ä–æ–±–∏—Ç–∏:
```bash
# Via env vars
export CLOUDSDK_AUTH_ACCESS_TOKEN=<token>
gcloud projects list

# Via setup
echo "<token>" > /some/path/to/token
gcloud config set auth/access_token_file /some/path/to/token
gcloud projects list
gcloud config unset auth/access_token_file
```
## –ü–æ—Å–∏–ª–∞–Ω–Ω—è

* [https://about.gitlab.com/blog/2020/02/12/plundering-gcp-escalating-privileges-in-google-cloud-platform/](https://about.gitlab.com/blog/2020/02/12/plundering-gcp-escalating-privileges-in-google-cloud-platform/)

{% hint style="success" %}
–í–∏–≤—á–∞–π—Ç–µ —Ç–∞ –ø—Ä–∞–∫—Ç–∏–∫—É–π—Ç–µ AWS Hacking:<img src="../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
–í–∏–≤—á–∞–π—Ç–µ —Ç–∞ –ø—Ä–∞–∫—Ç–∏–∫—É–π—Ç–µ GCP Hacking: <img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>–ü—ñ–¥—Ç—Ä–∏–º–∞—Ç–∏ HackTricks</summary>

* –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ [**–ø–ª–∞–Ω–∏ –ø—ñ–¥–ø–∏—Å–∫–∏**](https://github.com/sponsors/carlospolop)!
* **–ü—Ä–∏—î–¥–Ω—É–π—Ç–µ—Å—å –¥–æ** üí¨ [**–≥—Ä—É–ø–∏ Discord**](https://discord.gg/hRep4RUj7f) –∞–±–æ [**–≥—Ä—É–ø–∏ Telegram**](https://t.me/peass) –∞–±–æ **—Å–ª—ñ–¥–∫—É–π—Ç–µ** –∑–∞ –Ω–∞–º–∏ –≤ **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **–î—ñ–ª—ñ—Ç—å—Å—è —Ö–∞–∫–µ—Ä—Å—å–∫–∏–º–∏ —Ç—Ä—é–∫–∞–º–∏, –Ω–∞–¥—Å–∏–ª–∞—é—á–∏ PR –¥–æ** [**HackTricks**](https://github.com/carlospolop/hacktricks) —Ç–∞ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—ó–≤ –Ω–∞ github.

</details>
{% endhint %}
