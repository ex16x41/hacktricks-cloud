# GCP - Cloud Build Unauthenticated Enum

{% hint style="success" %}
AWSハッキングを学び、実践する：<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
GCPハッキングを学び、実践する：<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricksをサポートする</summary>

* [**サブスクリプションプラン**](https://github.com/sponsors/carlospolop)を確認してください！
* **💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)または[**Telegramグループ**](https://t.me/peass)に参加するか、**Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**をフォローしてください。**
* **[**HackTricks**](https://github.com/carlospolop/hacktricks)および[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)のGitHubリポジトリにPRを送信してハッキングトリックを共有してください。**

</details>
{% endhint %}

## Cloud Build

Cloud Buildに関する詳細情報は次を確認してください：

{% content-ref url="../gcp-services/gcp-cloud-build-enum.md" %}
[gcp-cloud-build-enum.md](../gcp-services/gcp-cloud-build-enum.md)
{% endcontent-ref %}

### cloudbuild.yml

**`cloudbuild.yml`**という名前のファイルを含むリポジトリに対する書き込みアクセスを侵害した場合、このファイルを**バックドア**することができ、Cloud Build内で実行される**コマンドを指定**し、秘密情報を流出させ、実行される内容を侵害し、さらに**Cloud Buildサービスアカウントを侵害**することができます。

{% hint style="info" %}
GCPには、管理者が外部PRからビルドシステムの実行を制御できるオプション「コメントコントロール」があることに注意してください。コメントコントロールは、コラボレーター/プロジェクトオーナーが**ビルドをトリガーするために「/gcbrun」とコメントする必要がある**機能であり、この機能を使用することで、インターネット上の誰もがビルドシステムをトリガーすることを本質的に防ぎます。
{% endhint %}

関連情報として、Github Actionsを攻撃する方法に関するページを確認できます（これに類似）：

{% content-ref url="../../../pentesting-ci-cd/github-security/abusing-github-actions/" %}
[abusing-github-actions](../../../pentesting-ci-cd/github-security/abusing-github-actions/)
{% endcontent-ref %}

### PR承認

トリガーがPRの場合、**誰でも公開リポジトリにPRを行うことができるため**、**任意のPRでトリガーの実行を許可することは非常に危険です**。したがって、デフォルトでは、実行は**オーナーとコラボレーターのみに自動**で行われ、他のユーザーのPRでトリガーを実行するには、オーナーまたはコラボレーターが「/gcbrun」とコメントする必要があります。

<figure><img src="../../../.gitbook/assets/image (339).png" alt="" width="563"><figcaption></figcaption></figure>

{% hint style="danger" %}
したがって、これが**`必要なし`**に設定されている場合、攻撃者は**ブランチにPRを行い**、悪意のあるコード実行を**`cloudbuild.yml`**ファイルに追加してcloudbuildの実行を侵害することができます（cloudbuildはPRからコードをダウンロードするため、悪意のある**`cloudbuild.yml`**を実行します）。
{% endhint %}

さらに、PRを送信するときにcloudbuildの実行が必要かどうかを確認するのは簡単です。なぜなら、それはGithubに表示されるからです：

<figure><img src="../../../.gitbook/assets/image (340).png" alt=""><figcaption></figcaption></figure>

{% hint style="warning" %}
そのため、cloudbuildが実行されなくても、攻撃者は会社に属する**GCPプロジェクトのプロジェクト名**を見ることができます。
{% endhint %}

{% hint style="success" %}
AWSハッキングを学び、実践する：<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
GCPハッキングを学び、実践する：<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricksをサポートする</summary>

* [**サブスクリプションプラン**](https://github.com/sponsors/carlospolop)を確認してください！
* **💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)または[**Telegramグループ**](https://t.me/peass)に参加するか、**Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**をフォローしてください。**
* **[**HackTricks**](https://github.com/carlospolop/hacktricks)および[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)のGitHubリポジトリにPRを送信してハッキングトリックを共有してください。**

</details>
{% endhint %}
