# GCP - IAM, Principals & Org Unauthenticated Enum

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Iam & GCP Principals

ìì„¸í•œ ì •ë³´ëŠ” ë‹¤ìŒì„ í™•ì¸í•˜ì„¸ìš”:

{% content-ref url="../gcp-services/gcp-iam-and-org-policies-enum.md" %}
[gcp-iam-and-org-policies-enum.md](../gcp-services/gcp-iam-and-org-policies-enum.md)
{% endcontent-ref %}

### Workspaceì—ì„œ ë„ë©”ì¸ì´ ì‚¬ìš©ë˜ì—ˆë‚˜ìš”?

1. **DNS ë ˆì½”ë“œ í™•ì¸**

**`google-site-verification`** ë ˆì½”ë“œê°€ ìˆë‹¤ë©´, Workspaceë¥¼ ì‚¬ìš©í•˜ê³  ìˆì—ˆê±°ë‚˜ ì‚¬ìš© ì¤‘ì¼ ê°€ëŠ¥ì„±ì´ ë†’ìŠµë‹ˆë‹¤:
```
dig txt hacktricks.xyz

[...]
hacktricks.xyz.		3600	IN	TXT	"google-site-verification=2mWyPXMPXEEy6QqWbCfWkxFTcQhyYdwHrOxee1Yeo-0"
hacktricks.xyz.		3600	IN	TXT	"google-site-verification=C19PtLcZ1EGyzUYYJTX1Tp6bOGessxzN9gqE-SVKhRA"
hacktricks.xyz.		300	IN	TXT	"v=spf1 include:usb._netblocks.mimecast.com include:_spf.google.com include:_spf.psm.knowbe4.com include:_spf.salesforce.com include:spf.mandrillapp.com ~all"
```
If something like **`include:_spf.google.com`**ë„ ë‚˜íƒ€ë‚˜ë©´ ì´ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤ (ë‚˜íƒ€ë‚˜ì§€ ì•ŠëŠ” ê²½ìš°ì—ë„ ë„ë©”ì¸ì´ Gmailì„ ë©”ì¼ ì œê³µìë¡œ ì‚¬ìš©í•˜ì§€ ì•Šê³  Workspaceì— ìˆì„ ìˆ˜ ìˆìœ¼ë¯€ë¡œ ë¶€ì •í•˜ì§€ëŠ” ì•ŠìŠµë‹ˆë‹¤).

2. **í•´ë‹¹ ë„ë©”ì¸ìœ¼ë¡œ Workspace ì„¤ì • ì‹œë„í•˜ê¸°**

ë˜ ë‹¤ë¥¸ ì˜µì…˜ì€ í•´ë‹¹ ë„ë©”ì¸ì„ ì‚¬ìš©í•˜ì—¬ Workspaceë¥¼ ì„¤ì •í•´ë³´ëŠ” ê²ƒì…ë‹ˆë‹¤. ë§Œì•½ **ë„ë©”ì¸ì´ ì´ë¯¸ ì‚¬ìš© ì¤‘ì´ë¼ëŠ” ì˜¤ë¥˜ê°€ ë°œìƒí•˜ë©´** (ì´ë¯¸ì§€ì™€ ê°™ì´), ì´ë¯¸ ì‚¬ìš© ì¤‘ì„ì„ ì•Œ ìˆ˜ ìˆìŠµë‹ˆë‹¤!

Workspace ë„ë©”ì¸ì„ ì„¤ì •í•˜ë ¤ë©´ ë‹¤ìŒì„ ë”°ë¥´ì„¸ìš”: [https://workspace.google.com/business/signup/welcome](https://workspace.google.com/business/signup/welcome)

<figure><img src="../../../.gitbook/assets/image (330).png" alt=""><figcaption></figcaption></figure>

3. **í•´ë‹¹ ë„ë©”ì¸ì„ ì‚¬ìš©í•˜ì—¬ ì´ë©”ì¼ ë¹„ë°€ë²ˆí˜¸ ë³µêµ¬ ì‹œë„í•˜ê¸°**

í•´ë‹¹ ë„ë©”ì¸ì—ì„œ ì‚¬ìš© ì¤‘ì¸ ìœ íš¨í•œ ì´ë©”ì¼ ì£¼ì†Œë¥¼ ì•Œê³  ìˆë‹¤ë©´ (ì˜ˆ: admin@email.com ë˜ëŠ” info@email.com) [https://accounts.google.com/signin/v2/recoveryidentifier](https://accounts.google.com/signin/v2/recoveryidentifier)ì—ì„œ **ê³„ì •ì„ ë³µêµ¬** ì‹œë„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë§Œì•½ ì‹œë„ê°€ Googleì´ í•´ë‹¹ ê³„ì •ì— ëŒ€í•´ ì•Œì§€ ëª»í•œë‹¤ëŠ” ì˜¤ë¥˜ë¥¼ í‘œì‹œí•˜ì§€ ì•ŠëŠ”ë‹¤ë©´, ì´ëŠ” Workspaceë¥¼ ì‚¬ìš©í•˜ê³  ìˆëŠ” ê²ƒì…ë‹ˆë‹¤.

### ì´ë©”ì¼ ë° ì„œë¹„ìŠ¤ ê³„ì • ì—´ê±°í•˜ê¸°

ìœ íš¨í•œ Workspace ë„ë©”ì¸ì˜ ì´ë©”ì¼ ë° SA ì´ë©”ì¼ì„ **ì—´ê±°**í•˜ëŠ” ê²ƒì´ ê°€ëŠ¥í•©ë‹ˆë‹¤. ê¶Œí•œì„ í• ë‹¹í•˜ê³  ì˜¤ë¥˜ ë©”ì‹œì§€ë¥¼ í™•ì¸í•˜ì—¬ ì´ë¥¼ ìˆ˜í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ë¥¼ ìœ„í•´ì„œëŠ” í”„ë¡œì íŠ¸ì— ê¶Œí•œì„ í• ë‹¹í•  ìˆ˜ ìˆëŠ” ê¶Œí•œì´ í•„ìš”í•©ë‹ˆë‹¤ (ì´ëŠ” ë‹¨ì§€ ê·€í•˜ê°€ ì†Œìœ í•œ ê²ƒì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤).

ì¡´ì¬ ì—¬ë¶€ë¥¼ í™•ì¸í•˜ê¸° ìœ„í•´ ê¶Œí•œì„ ë¶€ì—¬í•˜ì§€ ì•Šê³ ë„ í™•ì¸í•  ìˆ˜ ìˆìœ¼ë©°, **`serviceAccount`** ìœ í˜•ì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì‚¬ìš©ìê°€ **`user`**ì¼ ë•ŒëŠ” **`user`**ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤:

{% code overflow="wrap" %}
```bash
# Try to assign permissions to user 'unvalid-email-34r434f@hacktricks.xyz'
# but indicating it's a service account
gcloud projects add-iam-policy-binding <project-controlled-by-you> \
--member='serviceAccount:unvalid-email-34r434f@hacktricks.xyz' \
--role='roles/viewer'
## Response:
ERROR: (gcloud.projects.add-iam-policy-binding) INVALID_ARGUMENT: User unvalid-email-34r434f@hacktricks.xyz does not exist.

# Now try with a valid email
gcloud projects add-iam-policy-binding <project-controlled-by-you> \
--member='serviceAccount:support@hacktricks.xyz' \
--role='roles/viewer'
# Response:
ERROR: (gcloud.projects.add-iam-policy-binding) INVALID_ARGUMENT: Principal support@hacktricks.xyz is of type "user". The principal should appear as "user:support@hacktricks.xyz". See https://cloud.google.com/iam/help/members/types for additional documentation.
```
{% endcode %}

ì‚¬ìš©ì ì´ë©”ì¼ì´ ìœ íš¨í•  ë•Œ ì˜¤ë¥˜ ë©”ì‹œì§€ê°€ ìœ í˜•ì´ ì•„ë‹ˆë¼ëŠ” ê²ƒì„ ë‚˜íƒ€ë‚´ëŠ” ë°©ì‹ì— ì£¼ëª©í•˜ì„¸ìš”. ë”°ë¼ì„œ ìš°ë¦¬ëŠ” ì´ë©”ì¼ support@hacktricks.xyzê°€ ì¡´ì¬í•œë‹¤ëŠ” ê²ƒì„ ê¶Œí•œì„ ë¶€ì—¬í•˜ì§€ ì•Šê³ ë„ ë°œê²¬í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.

**ì„œë¹„ìŠ¤ ê³„ì •**ì— ëŒ€í•´ì„œë„ **`serviceAccount:`** ëŒ€ì‹  **`user:`** ìœ í˜•ì„ ì‚¬ìš©í•˜ì—¬ **ê°™ì€ ì‘ì—…ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤**:

{% code overflow="wrap" %}
```bash
# Non existent
gcloud projects add-iam-policy-binding <project-controlled-by-you> \
--member='serviceAccount:<invalid-sa-name>@<proj-uniq-name>.iam.gserviceaccount.com' \
--role='roles/viewer'
# Response
ERROR: (gcloud.projects.add-iam-policy-binding) INVALID_ARGUMENT: User <invalid-sa-name>@<proj-uniq-name>.iam.gserviceaccount.com does not exist.

# Existent
gcloud projects add-iam-policy-binding <project-controlled-by-you> \
--member='serviceAccount:<sa-name>@<proj-uniq-name>.iam.gserviceaccount.com' \
--role='roles/viewer'
# Response
ERROR: (gcloud.projects.add-iam-policy-binding) INVALID_ARGUMENT: Principal testing@digital-bonfire-410512.iam.gserviceaccount.com is of type "serviceAccount". The principal should appear as "serviceAccount:testing@digital-bonfire-410512.iam.gserviceaccount.com". See https://cloud.google.com/iam/help/members/types for additional documentation.
```
{% endcode %}

{% hint style="success" %}
AWS í•´í‚¹ ë°°ìš°ê¸° ë° ì—°ìŠµí•˜ê¸°:<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
GCP í•´í‚¹ ë°°ìš°ê¸° ë° ì—°ìŠµí•˜ê¸°: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks ì§€ì›í•˜ê¸°</summary>

* [**êµ¬ë… ê³„íš**](https://github.com/sponsors/carlospolop) í™•ì¸í•˜ê¸°!
* **ğŸ’¬ [**ë””ìŠ¤ì½”ë“œ ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— ì°¸ì—¬í•˜ê±°ë‚˜ **íŠ¸ìœ„í„°** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**ë¥¼ íŒ”ë¡œìš°í•˜ì„¸ìš”.**
* **[**HackTricks**](https://github.com/carlospolop/hacktricks) ë° [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) ê¹ƒí—ˆë¸Œ ë¦¬í¬ì§€í† ë¦¬ì— PRì„ ì œì¶œí•˜ì—¬ í•´í‚¹ íŠ¸ë¦­ì„ ê³µìœ í•˜ì„¸ìš”.**

</details>
{% endhint %}
