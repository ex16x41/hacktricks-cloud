# GCP - Privilegije eskalacije javnih kanti

{% hint style="success" %}
NauÄite i veÅ¾bajte hakovanje AWS-a: <img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
NauÄite i veÅ¾bajte hakovanje GCP-a: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>PodrÅ¾ite HackTricks</summary>

* Proverite [**planove pretplate**](https://github.com/sponsors/carlospolop)!
* **PridruÅ¾ite se** ğŸ’¬ [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitteru** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podelite hakovanje trikova slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
{% endhint %}

## Eskalacija privilegija kanti

Ako je politika kante dozvolila "allUsers" ili "allAuthenticatedUsers" da **piÅ¡u u svoju politiku kante** (dozvola **storage.buckets.setIamPolicy**), tada bilo ko moÅ¾e izmeniti politiku kante i dodeliti sebi pun pristup.

### Provera dozvola

Postoje 2 naÄina za proveru dozvola nad kantom. Prvi naÄin je da ih zatraÅ¾ite praveÄ‡i zahtev ka `https://www.googleapis.com/storage/v1/b/IME_KANTE/iam` ili pokretanjem `gsutil iam get gs://IME_KANTE`.

MeÄ‘utim, ako vaÅ¡ korisnik (potencijalno pripadajuÄ‡i allUsers ili allAuthenticatedUsers") nema dozvole da proÄita iam politiku kante (storage.buckets.getIamPolicy), to neÄ‡e raditi.

Druga opcija koja Ä‡e uvek raditi je koriÅ¡Ä‡enje testPermissions endpointa kante kako biste saznali da li imate odreÄ‘enu dozvolu, na primer pristupanje: `https://www.googleapis.com/storage/v1/b/IME_KANTE/iam/testPermissions?permissions=storage.buckets.delete&permissions=storage.buckets.get&permissions=storage.buckets.getIamPolicy&permissions=storage.buckets.setIamPolicy&permissions=storage.buckets.update&permissions=storage.objects.create&permissions=storage.objects.delete&permissions=storage.objects.get&permissions=storage.objects.list&permissions=storage.objects.update`

### Eskalacija

Da biste dodelili `Storage Admin` korisnicima `allAuthenticatedUsers`, moguÄ‡e je pokrenuti:
```
gsutil iam ch group:allAuthenticatedUsers:admin gs://BUCKET_NAME
```
JoÅ¡ jedan napad bio bi **ukloniti kantu i ponovo je kreirati u vaÅ¡em nalogu kako biste ukrali vlasniÅ¡tvo**.

## Reference

* [https://rhinosecuritylabs.com/gcp/google-cloud-platform-gcp-bucket-enumeration/](https://rhinosecuritylabs.com/gcp/google-cloud-platform-gcp-bucket-enumeration/)
