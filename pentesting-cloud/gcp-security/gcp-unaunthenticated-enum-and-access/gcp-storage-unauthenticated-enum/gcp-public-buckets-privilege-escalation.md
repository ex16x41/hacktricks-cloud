# GCP - Public Buckets Privilege Escalation

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Buckets Privilege Escalation

ë²„í‚· ì •ì±…ì´ â€œallUsersâ€ ë˜ëŠ” â€œallAuthenticatedUsersâ€ê°€ **ë²„í‚· ì •ì±…ì— ì“°ê¸°** (ì¦‰, **storage.buckets.setIamPolicy** ê¶Œí•œ)ë¥¼ í—ˆìš©í•œë‹¤ë©´, ëˆ„êµ¬ë‚˜ ë²„í‚· ì •ì±…ì„ ìˆ˜ì •í•˜ê³  ìì‹ ì—ê²Œ ì „ì²´ ì ‘ê·¼ ê¶Œí•œì„ ë¶€ì—¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### Check Permissions

ë²„í‚·ì— ëŒ€í•œ ê¶Œí•œì„ í™•ì¸í•˜ëŠ” ë°©ë²•ì€ ë‘ ê°€ì§€ê°€ ìˆìŠµë‹ˆë‹¤. ì²« ë²ˆì§¸ ë°©ë²•ì€ `https://www.googleapis.com/storage/v1/b/BUCKET_NAME/iam`ì— ìš”ì²­ì„ í•˜ê±°ë‚˜ `gsutil iam get gs://BUCKET_NAME`ì„ ì‹¤í–‰í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤.

í•˜ì§€ë§Œ, ì‚¬ìš©ìê°€ (ì ì¬ì ìœ¼ë¡œ allUsers ë˜ëŠ” allAuthenticatedUsersì— ì†í•˜ëŠ”) ë²„í‚·ì˜ iam ì •ì±…ì„ ì½ì„ ê¶Œí•œ(storage.buckets.getIamPolicy)ì´ ì—†ë‹¤ë©´, ì´ ë°©ë²•ì€ ì‘ë™í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.

í•­ìƒ ì‘ë™í•˜ëŠ” ë‹¤ë¥¸ ì˜µì…˜ì€ ë²„í‚·ì˜ testPermissions ì—”ë“œí¬ì¸íŠ¸ë¥¼ ì‚¬ìš©í•˜ì—¬ ì§€ì •ëœ ê¶Œí•œì´ ìˆëŠ”ì§€ í™•ì¸í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´, ë‹¤ìŒì— ì ‘ê·¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤: `https://www.googleapis.com/storage/v1/b/BUCKET_NAME/iam/testPermissions?permissions=storage.buckets.delete&permissions=storage.buckets.get&permissions=storage.buckets.getIamPolicy&permissions=storage.buckets.setIamPolicy&permissions=storage.buckets.update&permissions=storage.objects.create&permissions=storage.objects.delete&permissions=storage.objects.get&permissions=storage.objects.list&permissions=storage.objects.update`

### Escalating

`allAuthenticatedUsers`ì—ê²Œ `Storage Admin` ê¶Œí•œì„ ë¶€ì—¬í•˜ê¸° ìœ„í•´ ë‹¤ìŒì„ ì‹¤í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```bash
gsutil iam ch allAuthenticatedUsers:admin gs://BUCKET_NAME
```
ë˜ ë‹¤ë¥¸ ê³µê²©ì€ **ë²„í‚·ì„ ì œê±°í•˜ê³  ê·€í•˜ì˜ ê³„ì •ì—ì„œ ë‹¤ì‹œ ìƒì„±í•˜ì—¬ ì†Œìœ ê¶Œì„ í›”ì¹˜ëŠ” ê²ƒ**ì…ë‹ˆë‹¤.

## References

* [https://rhinosecuritylabs.com/gcp/google-cloud-platform-gcp-bucket-enumeration/](https://rhinosecuritylabs.com/gcp/google-cloud-platform-gcp-bucket-enumeration/)

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
