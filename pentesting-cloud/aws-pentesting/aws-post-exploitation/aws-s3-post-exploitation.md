# AWS - S3 Post Exploitation

{% hint style="success" %}
Apprenez et pratiquez le hacking AWS :<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Apprenez et pratiquez le hacking GCP : <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Consultez les [**plans d'abonnement**](https://github.com/sponsors/carlospolop) !
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez** nous sur **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Partagez des astuces de hacking en soumettant des PR aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) d√©p√¥ts github.

</details>
{% endhint %}

## S3

Pour plus d'informations, consultez :

{% content-ref url="../aws-services/aws-s3-athena-and-glacier-enum.md" %}
[aws-s3-athena-and-glacier-enum.md](../aws-services/aws-s3-athena-and-glacier-enum.md)
{% endcontent-ref %}

### Informations Sensibles

Parfois, vous pourrez trouver des informations sensibles lisibles dans les buckets. Par exemple, des secrets d'√©tat terraform.

### Pivoting

Diff√©rentes plateformes pourraient utiliser S3 pour stocker des actifs sensibles.\
Par exemple, **airflow** pourrait stocker le **code** des **DAGs** l√†-dedans, ou des **pages web** pourraient √™tre directement servies depuis S3. Un attaquant avec des permissions d'√©criture pourrait **modifier le code** du bucket pour **pivoter** vers d'autres plateformes, ou **prendre le contr√¥le des comptes** en modifiant des fichiers JS.

### Ransomware S3

Dans ce sc√©nario, l'**attaquant cr√©e une cl√© KMS (Key Management Service) dans son propre compte AWS** ou un autre compte compromis. Il rend ensuite cette **cl√© accessible √† quiconque dans le monde**, permettant √† tout utilisateur, r√¥le ou compte AWS d'encrypter des objets en utilisant cette cl√©. Cependant, les objets ne peuvent pas √™tre d√©crypt√©s.

L'attaquant identifie un **bucket S3 cible et obtient un acc√®s en √©criture** √† celui-ci en utilisant diverses m√©thodes. Cela pourrait √™tre d√ª √† une mauvaise configuration du bucket qui l'expose publiquement ou √† l'acc√®s de l'attaquant √† l'environnement AWS lui-m√™me. L'attaquant cible g√©n√©ralement des buckets contenant des informations sensibles telles que des informations personnellement identifiables (PII), des informations de sant√© prot√©g√©es (PHI), des journaux, des sauvegardes, et plus encore.

Pour d√©terminer si le bucket peut √™tre cibl√© pour un ransomware, l'attaquant v√©rifie sa configuration. Cela inclut la v√©rification si **S3 Object Versioning** est activ√© et si **la suppression par authentification multi-facteurs (MFA delete) est activ√©e**. Si la version d'objet n'est pas activ√©e, l'attaquant peut proc√©der. Si la version d'objet est activ√©e mais que la suppression MFA est d√©sactiv√©e, l'attaquant peut **d√©sactiver la version d'objet**. Si √† la fois la version d'objet et la suppression MFA sont activ√©es, il devient plus difficile pour l'attaquant de ransomware ce bucket sp√©cifique.

En utilisant l'API AWS, l'attaquant **remplace chaque objet dans le bucket par une copie chiffr√©e en utilisant sa cl√© KMS**. Cela chiffre effectivement les donn√©es dans le bucket, les rendant inaccessibles sans la cl√©.

Pour ajouter une pression suppl√©mentaire, l'attaquant planifie la suppression de la cl√© KMS utilis√©e dans l'attaque. Cela donne √† la cible une fen√™tre de 7 jours pour r√©cup√©rer ses donn√©es avant que la cl√© ne soit supprim√©e et que les donn√©es ne deviennent d√©finitivement perdues.

Enfin, l'attaquant pourrait t√©l√©charger un fichier final, g√©n√©ralement nomm√© "ransom-note.txt", qui contient des instructions pour la cible sur la fa√ßon de r√©cup√©rer ses fichiers. Ce fichier est t√©l√©charg√© sans chiffrement, probablement pour attirer l'attention de la cible et lui faire prendre conscience de l'attaque ransomware.

**Pour plus d'infos** [**consultez la recherche originale**](https://rhinosecuritylabs.com/aws/s3-ransomware-part-1-attack-vector/)**.**

{% hint style="success" %}
Apprenez et pratiquez le hacking AWS :<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Apprenez et pratiquez le hacking GCP : <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Consultez les [**plans d'abonnement**](https://github.com/sponsors/carlospolop) !
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez** nous sur **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Partagez des astuces de hacking en soumettant des PR aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) d√©p√¥ts github.

</details>
{% endhint %}
