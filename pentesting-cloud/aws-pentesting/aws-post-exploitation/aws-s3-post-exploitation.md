# AWS - S3 Post Exploitation

{% hint style="success" %}
Lerne & √ºbe AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Lerne & √ºbe GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* √úberpr√ºfe die [**Abonnementpl√§ne**](https://github.com/sponsors/carlospolop)!
* **Tritt der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folge** uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teile Hacking-Tricks, indem du PRs zu den** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repos einreichst.

</details>
{% endhint %}

## S3

F√ºr weitere Informationen siehe:

{% content-ref url="../aws-services/aws-s3-athena-and-glacier-enum.md" %}
[aws-s3-athena-and-glacier-enum.md](../aws-services/aws-s3-athena-and-glacier-enum.md)
{% endcontent-ref %}

### Sensible Informationen

Manchmal kannst du sensible Informationen in lesbarer Form in den Buckets finden. Zum Beispiel Terraform-Zustandsgeheimnisse.

### Pivoting

Verschiedene Plattformen k√∂nnten S3 verwenden, um sensible Assets zu speichern.\
Zum Beispiel k√∂nnte **airflow** **DAGs** **Code** dort speichern, oder **Webseiten** k√∂nnten direkt von S3 bereitgestellt werden. Ein Angreifer mit Schreibberechtigungen k√∂nnte den **Code** aus dem Bucket **modifizieren**, um zu anderen Plattformen zu **pivotieren** oder **Konten zu √ºbernehmen**, indem er JS-Dateien √§ndert.

### S3 Ransomware

In diesem Szenario erstellt der **Angreifer einen KMS (Key Management Service) Schl√ºssel in seinem eigenen AWS-Konto** oder einem anderen kompromittierten Konto. Dann macht er diesen **Schl√ºssel f√ºr jeden auf der Welt zug√§nglich**, sodass jeder AWS-Benutzer, jede Rolle oder jedes Konto Objekte mit diesem Schl√ºssel verschl√ºsseln kann. Die Objekte k√∂nnen jedoch nicht entschl√ºsselt werden.

Der Angreifer identifiziert einen Ziel-**S3-Bucket und erh√§lt Schreibzugriff** darauf, indem er verschiedene Methoden anwendet. Dies k√∂nnte auf eine schlechte Bucket-Konfiguration zur√ºckzuf√ºhren sein, die ihn √∂ffentlich macht, oder der Angreifer erh√§lt Zugriff auf die AWS-Umgebung selbst. Der Angreifer zielt typischerweise auf Buckets ab, die sensible Informationen wie personenbezogene Daten (PII), gesch√ºtzte Gesundheitsinformationen (PHI), Protokolle, Backups und mehr enthalten.

Um festzustellen, ob der Bucket f√ºr Ransomware angegriffen werden kann, √ºberpr√ºft der Angreifer seine Konfiguration. Dazu geh√∂rt die √úberpr√ºfung, ob **S3 Object Versioning** aktiviert ist und ob **Multi-Faktor-Authentifizierungsl√∂schung (MFA-L√∂schung) aktiviert ist**. Wenn Object Versioning nicht aktiviert ist, kann der Angreifer fortfahren. Wenn Object Versioning aktiviert ist, aber MFA-L√∂schung deaktiviert ist, kann der Angreifer **Object Versioning deaktivieren**. Wenn sowohl Object Versioning als auch MFA-L√∂schung aktiviert sind, wird es f√ºr den Angreifer schwieriger, diesen speziellen Bucket mit Ransomware anzugreifen.

Mit der AWS-API **ersetzt der Angreifer jedes Objekt im Bucket durch eine verschl√ºsselte Kopie mit seinem KMS-Schl√ºssel**. Dies verschl√ºsselt effektiv die Daten im Bucket, sodass sie ohne den Schl√ºssel nicht zug√§nglich sind.

Um zus√§tzlichen Druck auszu√ºben, plant der Angreifer die L√∂schung des KMS-Schl√ºssels, der im Angriff verwendet wurde. Dies gibt dem Ziel ein 7-t√§giges Zeitfenster, um seine Daten wiederherzustellen, bevor der Schl√ºssel gel√∂scht wird und die Daten dauerhaft verloren gehen.

Schlie√ülich k√∂nnte der Angreifer eine letzte Datei hochladen, die normalerweise "ransom-note.txt" hei√üt und Anweisungen f√ºr das Ziel enth√§lt, wie es seine Dateien abrufen kann. Diese Datei wird unverschl√ºsselt hochgeladen, wahrscheinlich um die Aufmerksamkeit des Ziels zu erregen und es auf den Ransomware-Angriff aufmerksam zu machen.

**F√ºr weitere Informationen** [**√ºberpr√ºfe die urspr√ºngliche Forschung**](https://rhinosecuritylabs.com/aws/s3-ransomware-part-1-attack-vector/)**.**

{% hint style="success" %}
Lerne & √ºbe AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Lerne & √ºbe GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* √úberpr√ºfe die [**Abonnementpl√§ne**](https://github.com/sponsors/carlospolop)!
* **Tritt der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folge** uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teile Hacking-Tricks, indem du PRs zu den** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repos einreichst.

</details>
{% endhint %}
