# AWS - S3 Post Exploitation

{% hint style="success" %}
U캜ite i ve쬭ajte AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
U캜ite i ve쬭ajte GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Podr쬴te HackTricks</summary>

* Proverite [**planove pretplate**](https://github.com/sponsors/carlospolop)!
* **Pridru쬴te se** 游눫 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili **pratite** nas na **Twitteru** 游냕 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podelite hakerske trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
{% endhint %}

## S3

Za vi코e informacija proverite:

{% content-ref url="../aws-services/aws-s3-athena-and-glacier-enum.md" %}
[aws-s3-athena-and-glacier-enum.md](../aws-services/aws-s3-athena-and-glacier-enum.md)
{% endcontent-ref %}

### Osetljive Informacije

Ponekad 캖ete mo캖i da prona캠ete osetljive informacije u 캜itljivom formatu u kanticama. Na primer, terraform state tajne.

### Pivotiranje

Razli캜ite platforme mogu koristiti S3 za skladi코tenje osetljivih sredstava.\
Na primer, **airflow** mo쬰 skladi코titi **DAGs** **kod** tamo, ili se **web stranice** mogu direktno servirati iz S3. Napada캜 sa pravima pisanja mo쬰 **modifikovati kod** iz kante da **pivotira** na druge platforme, ili **preuzeti naloge** modifikovanjem JS datoteka.

### S3 Ransomware

U ovom scenariju, **napada캜 kreira KMS (Key Management Service) klju캜 u svom AWS nalogu** ili drugom kompromitovanom nalogu. Zatim 캜ini ovaj **klju캜 dostupnim svima na svetu**, omogu캖avaju캖i bilo kojem AWS korisniku, ulozi ili nalogu da enkriptuje objekte koriste캖i ovaj klju캜. Me캠utim, objekti se ne mogu dekriptovati.

Napada캜 identifikuje cilj **S3 kantu i dobija pristup na nivou pisanja** koriste캖i razli캜ite metode. To mo쬰 biti zbog lo코e konfiguracije kante koja je javno izlo쬰na ili napada캜 dobija pristup AWS okru쬰nju. Napada캜 obi캜no cilja kante koje sadr쬰 osetljive informacije kao 코to su li캜ne identifikacione informacije (PII), za코ti캖ene zdravstvene informacije (PHI), logove, rezervne kopije i jo코 mnogo toga.

Da bi utvrdio da li se kanta mo쬰 ciljati za ransomware, napada캜 proverava njenu konfiguraciju. Ovo uklju캜uje verifikaciju da li je **S3 Object Versioning** omogu캖en i da li je **multi-factor authentication delete (MFA delete) omogu캖en**. Ako Object Versioning nije omogu캖en, napada캜 mo쬰 nastaviti. Ako je Object Versioning omogu캖en, ali je MFA delete onemogu캖en, napada캜 mo쬰 **onemogu캖iti Object Versioning**. Ako su i Object Versioning i MFA delete omogu캖eni, postaje te쬰 za napada캜a da ransomware-uje tu specifi캜nu kantu.

Koriste캖i AWS API, napada캜 **menja svaki objekat u kanti sa enkriptovanom kopijom koriste캖i svoj KMS klju캜**. Ovo efikasno enkriptuje podatke u kanti, 캜ine캖i ih nedostupnim bez klju캜a.

Da bi dodatno pritisnuo, napada캜 zakazuje brisanje KMS klju캜a kori코캖enog u napadu. Ovo daje cilju 7-dnevni period da povrati svoje podatke pre nego 코to klju캜 bude obrisan i podaci postanu trajno izgubljeni.

Na kraju, napada캜 mo쬰 otpremiti kona캜nu datoteku, obi캜no nazvanu "ransom-note.txt," koja sadr쬴 uputstva za cilj kako da povrati svoje datoteke. Ova datoteka se otprema bez enkripcije, verovatno da bi privukla pa쬹ju cilja i obavestila ih o ransomware napadu.

**Za vi코e informacija** [**proverite originalno istra쬴vanje**](https://rhinosecuritylabs.com/aws/s3-ransomware-part-1-attack-vector/)**.**

{% hint style="success" %}
U캜ite i ve쬭ajte AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
U캜ite i ve쬭ajte GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Podr쬴te HackTricks</summary>

* Proverite [**planove pretplate**](https://github.com/sponsors/carlospolop)!
* **Pridru쬴te se** 游눫 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili **pratite** nas na **Twitteru** 游냕 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podelite hakerske trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
{% endhint %}
