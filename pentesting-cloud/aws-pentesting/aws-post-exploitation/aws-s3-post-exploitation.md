# AWS - S3 Post Explotaci칩n

{% hint style="success" %}
Aprende y practica Hacking en AWS:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Aprende y practica Hacking en GCP: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Apoya a HackTricks</summary>

* Revisa los [**planes de suscripci칩n**](https://github.com/sponsors/carlospolop)!
* **칔nete al** 游눫 [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s칤guenos** en **Twitter** 游냕 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Comparte trucos de hacking enviando PRs a los** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repos de github.

</details>
{% endhint %}

## S3

Para m치s informaci칩n consulta:

{% content-ref url="../aws-services/aws-s3-athena-and-glacier-enum.md" %}
[aws-s3-athena-and-glacier-enum.md](../aws-services/aws-s3-athena-and-glacier-enum.md)
{% endcontent-ref %}

### Informaci칩n Sensible

A veces podr치s encontrar informaci칩n sensible legible en los buckets. Por ejemplo, secretos del estado de terraform.

### Pivotar

Diferentes plataformas podr칤an estar usando S3 para almacenar activos sensibles.\
Por ejemplo, **airflow** podr칤a estar almacenando **c칩digo** de **DAGs** all칤, o **p치ginas web** podr칤an ser servidas directamente desde S3. Un atacante con permisos de escritura podr칤a **modificar el c칩digo** del bucket para **pivotar** a otras plataformas, o **tomar cuentas** modificando archivos JS.

### Ransomware en S3

En este escenario, el **atacante crea una clave KMS (Key Management Service) en su propia cuenta de AWS** o en otra cuenta comprometida. Luego hace que esta **clave sea accesible para cualquier persona en el mundo**, permitiendo que cualquier usuario, rol o cuenta de AWS encripte objetos usando esta clave. Sin embargo, los objetos no pueden ser desencriptados.

El atacante identifica un **bucket S3 y obtiene acceso de nivel de escritura** a 칠l usando varios m칠todos. Esto podr칤a deberse a una mala configuraci칩n del bucket que lo expone p칰blicamente o a que el atacante obtiene acceso al entorno de AWS. El atacante generalmente apunta a buckets que contienen informaci칩n sensible como informaci칩n personal identificable (PII), informaci칩n de salud protegida (PHI), registros, copias de seguridad, y m치s.

Para determinar si el bucket puede ser objetivo de ransomware, el atacante verifica su configuraci칩n. Esto incluye verificar si **S3 Object Versioning** est치 habilitado y si **la eliminaci칩n de autenticaci칩n multifactor (MFA delete) est치 habilitada**. Si Object Versioning no est치 habilitado, el atacante puede proceder. Si Object Versioning est치 habilitado pero MFA delete est치 deshabilitado, el atacante puede **deshabilitar Object Versioning**. Si tanto Object Versioning como MFA delete est치n habilitados, se vuelve m치s dif칤cil para el atacante hacer ransomware a ese bucket espec칤fico.

Usando la API de AWS, el atacante **reemplaza cada objeto en el bucket con una copia encriptada usando su clave KMS**. Esto encripta efectivamente los datos en el bucket, haci칠ndolos inaccesibles sin la clave.

Para a침adir m치s presi칩n, el atacante programa la eliminaci칩n de la clave KMS utilizada en el ataque. Esto le da al objetivo una ventana de 7 d칤as para recuperar sus datos antes de que la clave sea eliminada y los datos se pierdan permanentemente.

Finalmente, el atacante podr칤a subir un archivo final, generalmente llamado "ransom-note.txt," que contiene instrucciones para el objetivo sobre c칩mo recuperar sus archivos. Este archivo se sube sin encriptar, probablemente para captar la atenci칩n del objetivo y hacerle consciente del ataque de ransomware.

**Para m치s informaci칩n** [**consulta la investigaci칩n original**](https://rhinosecuritylabs.com/aws/s3-ransomware-part-1-attack-vector/)**.**

{% hint style="success" %}
Aprende y practica Hacking en AWS:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Aprende y practica Hacking en GCP: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Apoya a HackTricks</summary>

* Revisa los [**planes de suscripci칩n**](https://github.com/sponsors/carlospolop)!
* **칔nete al** 游눫 [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s칤guenos** en **Twitter** 游냕 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Comparte trucos de hacking enviando PRs a los** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repos de github.

</details>
{% endhint %}
