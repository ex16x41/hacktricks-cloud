# AWS - Abusing Lambda Extensions

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Lambda Extensions

Lambda extensionsëŠ” ë‹¤ì–‘í•œ **ëª¨ë‹ˆí„°ë§, ê´€ì°°ì„±, ë³´ì•ˆ ë° ê±°ë²„ë„ŒìŠ¤ ë„êµ¬**ì™€ í†µí•©í•˜ì—¬ ê¸°ëŠ¥ì„ í–¥ìƒì‹œí‚µë‹ˆë‹¤. ì´ëŸ¬í•œ í™•ì¥ì€ [.zip ì•„ì¹´ì´ë¸Œë¥¼ ì‚¬ìš©í•œ Lambda ë ˆì´ì–´](https://docs.aws.amazon.com/lambda/latest/dg/configuration-layers.html) ë˜ëŠ” [ì»¨í…Œì´ë„ˆ ì´ë¯¸ì§€ ë°°í¬ì— í¬í•¨](https://aws.amazon.com/blogs/compute/working-with-lambda-layers-and-extensions-in-container-images/)í•˜ì—¬ ì¶”ê°€ë˜ë©°, **ë‚´ë¶€** ë° **ì™¸ë¶€** ëª¨ë“œë¡œ ì‘ë™í•©ë‹ˆë‹¤.

* **ë‚´ë¶€ í™•ì¥**ì€ ëŸ°íƒ€ì„ í”„ë¡œì„¸ìŠ¤ì™€ í†µí•©ë˜ì–´ **ì–¸ì–´ë³„ í™˜ê²½ ë³€ìˆ˜** ë° **ë˜í¼ ìŠ¤í¬ë¦½íŠ¸**ë¥¼ ì‚¬ìš©í•˜ì—¬ ì‹œì‘ì„ ì¡°ì‘í•©ë‹ˆë‹¤. ì´ ë§ì¶¤í™”ëŠ” **Java Correto 8 ë° 11, Node.js 10 ë° 12, .NET Core 3.1**ì„ í¬í•¨í•œ ë‹¤ì–‘í•œ ëŸ°íƒ€ì„ì— ì ìš©ë©ë‹ˆë‹¤.
* **ì™¸ë¶€ í™•ì¥**ì€ ë³„ë„ì˜ í”„ë¡œì„¸ìŠ¤ë¡œ ì‹¤í–‰ë˜ë©°, Lambda í•¨ìˆ˜ì˜ ìƒëª… ì£¼ê¸°ì™€ ì¼ì¹˜í•˜ì—¬ ì‘ë™ì„ ìœ ì§€í•©ë‹ˆë‹¤. ì´ë“¤ì€ **Node.js 10 ë° 12, Python 3.7 ë° 3.8, Ruby 2.5 ë° 2.7, Java Corretto 8 ë° 11, .NET Core 3.1** ë° **ì‚¬ìš©ì ì •ì˜ ëŸ°íƒ€ì„**ê³¼ í˜¸í™˜ë©ë‹ˆë‹¤.

[**Lambda í™•ì¥ì´ ì‘ë™í•˜ëŠ” ë°©ì‹ì— ëŒ€í•œ ìì„¸í•œ ë‚´ìš©ì€ ë¬¸ì„œë¥¼ ì°¸ì¡°í•˜ì‹­ì‹œì˜¤**](https://docs.aws.amazon.com/lambda/latest/dg/runtimes-extensions-api.html).

### External Extension for Persistence, Stealing Requests & modifying Requests

ì´ê²ƒì€ ì´ ê²Œì‹œë¬¼ì—ì„œ ì œì•ˆëœ ê¸°ìˆ ì˜ ìš”ì•½ì…ë‹ˆë‹¤: [https://www.clearvector.com/blog/lambda-spy/](https://www.clearvector.com/blog/lambda-spy/)

Lambda ëŸ°íƒ€ì„ í™˜ê²½ì˜ ê¸°ë³¸ Linux ì»¤ë„ì´ â€œ**process\_vm\_readv**â€ ë° â€œ**process\_vm\_writev**â€ ì‹œìŠ¤í…œ í˜¸ì¶œë¡œ ì»´íŒŒì¼ëœ ê²ƒì´ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤. ê·¸ë¦¬ê³  ëª¨ë“  í”„ë¡œì„¸ìŠ¤ëŠ” ì™¸ë¶€ í™•ì¥ì„ ìœ„í•´ ìƒì„±ëœ ìƒˆë¡œìš´ í”„ë¡œì„¸ìŠ¤ì¡°ì°¨ë„ ë™ì¼í•œ ì‚¬ìš©ì IDë¡œ ì‹¤í–‰ë©ë‹ˆë‹¤. **ì´ëŠ” ì™¸ë¶€ í™•ì¥ì´ ì„¤ê³„ìƒ Rapidì˜ í™ ë©”ëª¨ë¦¬ì— ëŒ€í•œ ì „ì²´ ì½ê¸° ë° ì“°ê¸° ì•¡ì„¸ìŠ¤ ê¶Œí•œì„ ê°€ì§„ë‹¤ëŠ” ê²ƒì„ ì˜ë¯¸í•©ë‹ˆë‹¤.**

ê²Œë‹¤ê°€, Lambda í™•ì¥ì€ **í˜¸ì¶œ ì´ë²¤íŠ¸ì— êµ¬ë…í•  ìˆ˜ ìˆëŠ”** ê¸°ëŠ¥ì„ ê°€ì§€ê³  ìˆì§€ë§Œ, AWSëŠ” ì´ëŸ¬í•œ í™•ì¥ì— ì›ì‹œ ë°ì´í„°ë¥¼ ê³µê°œí•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ì´ëŠ” **í™•ì¥ì´ HTTP ìš”ì²­ì„ í†µí•´ ì „ì†¡ë˜ëŠ” ë¯¼ê°í•œ ì •ë³´ì— ì•¡ì„¸ìŠ¤í•  ìˆ˜ ì—†ë„ë¡** ë³´ì¥í•©ë‹ˆë‹¤.

Init (Rapid) í”„ë¡œì„¸ìŠ¤ëŠ” Lambda í™•ì¥ì´ ì´ˆê¸°í™”ë˜ê³  ëª¨ë“  ëŸ°íƒ€ì„ ì½”ë“œê°€ ì‹¤í–‰ë˜ê¸° ì „ì— [http://127.0.0.1:9001](http://127.0.0.1:9001/)ì—ì„œ ëª¨ë“  API ìš”ì²­ì„ ëª¨ë‹ˆí„°ë§í•©ë‹ˆë‹¤.

<figure><img src="../../../../.gitbook/assets/image (90).png" alt=""><figcaption><p><a href="https://www.clearvector.com/blog/content/images/size/w1000/2022/11/2022110801.rapid.default.png">https://www.clearvector.com/blog/content/images/size/w1000/2022/11/2022110801.rapid.default.png</a></p></figcaption></figure>

ë³€ìˆ˜ **`AWS_LAMBDA_RUNTIME_API`**ëŠ” **IP** ì£¼ì†Œì™€ **í¬íŠ¸** ë²ˆí˜¸ë¥¼ **ìì‹ ëŸ°íƒ€ì„ í”„ë¡œì„¸ìŠ¤** ë° ì¶”ê°€ í™•ì¥ì— ë‚˜íƒ€ëƒ…ë‹ˆë‹¤.

{% hint style="warning" %}
**`AWS_LAMBDA_RUNTIME_API`** í™˜ê²½ ë³€ìˆ˜ë¥¼ ìš°ë¦¬ê°€ ì ‘ê·¼í•  ìˆ˜ ìˆëŠ” **`port`**ë¡œ ë³€ê²½í•˜ë©´ Lambda ëŸ°íƒ€ì„ ë‚´ì˜ ëª¨ë“  ì‘ì—…ì„ ê°€ë¡œì±Œ ìˆ˜ ìˆìŠµë‹ˆë‹¤ (**man-in-the-middle**). ì´ëŠ” í™•ì¥ì´ Rapid Initê³¼ ë™ì¼í•œ ê¶Œí•œìœ¼ë¡œ ì‹¤í–‰ë˜ë©°, ì‹œìŠ¤í…œì˜ ì»¤ë„ì´ **í”„ë¡œì„¸ìŠ¤ ë©”ëª¨ë¦¬ ìˆ˜ì •**ì„ í—ˆìš©í•˜ì—¬ í¬íŠ¸ ë²ˆí˜¸ë¥¼ ë³€ê²½í•  ìˆ˜ ìˆê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.
{% endhint %}

**í™•ì¥ì´ ëª¨ë“  ëŸ°íƒ€ì„ ì½”ë“œë³´ë‹¤ ë¨¼ì € ì‹¤í–‰ë˜ê¸° ë•Œë¬¸ì—**, í™˜ê²½ ë³€ìˆ˜ë¥¼ ìˆ˜ì •í•˜ë©´ ëŸ°íƒ€ì„ í”„ë¡œì„¸ìŠ¤(ì˜ˆ: Python, Java, Node, Ruby)ê°€ ì‹œì‘ë  ë•Œ ì˜í–¥ì„ ë¯¸ì¹©ë‹ˆë‹¤. ë˜í•œ, **ìš°ë¦¬ì˜ í™•ì¥ í›„ì— ë¡œë“œëœ** í™•ì¥ë„ ì´ ë³€ìˆ˜ë¥¼ ì˜ì¡´í•˜ê¸° ë•Œë¬¸ì— ìš°ë¦¬ì˜ í™•ì¥ì„ í†µí•´ ë¼ìš°íŒ…ë©ë‹ˆë‹¤. ì´ ì„¤ì •ì€ ì•…ì„± ì½”ë“œê°€ ëŸ°íƒ€ì„ í™˜ê²½ ë‚´ì—ì„œ ë³´ì•ˆ ì¡°ì¹˜ë‚˜ ë¡œê¹… í™•ì¥ì„ ì™„ì „íˆ ìš°íšŒí•  ìˆ˜ ìˆê²Œ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

<figure><img src="../../../../.gitbook/assets/image (3) (4).png" alt=""><figcaption><p><a href="https://www.clearvector.com/blog/content/images/size/w1000/2022/11/2022110801.rapid.mitm.png">https://www.clearvector.com/blog/content/images/size/w1000/2022/11/2022110801.rapid.mitm.png</a></p></figcaption></figure>

ë„êµ¬ [**lambda-spy**](https://github.com/clearvector/lambda-spy)ëŠ” **ë©”ëª¨ë¦¬ ì“°ê¸°**ë¥¼ ìˆ˜í–‰í•˜ê³  lambda ìš”ì²­, ë‹¤ë¥¸ **í™•ì¥** **ìš”ì²­**ì—ì„œ ë¯¼ê°í•œ ì •ë³´ë¥¼ **í›”ì¹˜ê³ ** ì‹¬ì§€ì–´ **ìˆ˜ì •**í•  ìˆ˜ ìˆë„ë¡ ë§Œë“¤ì–´ì¡ŒìŠµë‹ˆë‹¤.

## References

* [https://aws.amazon.com/blogs/compute/building-extensions-for-aws-lambda-in-preview/](https://aws.amazon.com/blogs/compute/building-extensions-for-aws-lambda-in-preview/)
* [https://www.clearvector.com/blog/lambda-spy/](https://www.clearvector.com/blog/lambda-spy/)

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
