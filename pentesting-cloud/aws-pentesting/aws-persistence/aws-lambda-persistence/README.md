# AWS - Lambda Persistence

{% hint style="success" %}
AWS í•´í‚¹ ë°°ìš°ê¸° ë° ì—°ìŠµí•˜ê¸°:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCP í•´í‚¹ ë°°ìš°ê¸° ë° ì—°ìŠµí•˜ê¸°: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks ì§€ì›í•˜ê¸°</summary>

* [**êµ¬ë… ê³„íš**](https://github.com/sponsors/carlospolop) í™•ì¸í•˜ê¸°!
* **ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— ì°¸ì—¬í•˜ê±°ë‚˜ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**ë¥¼ íŒ”ë¡œìš°í•˜ì„¸ìš”.**
* **[**HackTricks**](https://github.com/carlospolop/hacktricks) ë° [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub ë¦¬í¬ì§€í† ë¦¬ì— PRì„ ì œì¶œí•˜ì—¬ í•´í‚¹ íŠ¸ë¦­ì„ ê³µìœ í•˜ì„¸ìš”.**

</details>
{% endhint %}

## Lambda

ìì„¸í•œ ì •ë³´ëŠ” ë‹¤ìŒì„ í™•ì¸í•˜ì„¸ìš”:

{% content-ref url="../../../aws-security/aws-services/aws-lambda-enum.md" %}
[aws-lambda-enum.md](../../../aws-security/aws-services/aws-lambda-enum.md)
{% endcontent-ref %}

### Lambda Layer Persistence

ëŒë‹¤ê°€ ì€ë°€í•˜ê²Œ ì‹¤í–‰ë  ë•Œ **ì„ì˜ ì½”ë“œë¥¼ ì‹¤í–‰í•˜ê¸° ìœ„í•´ ë ˆì´ì–´ë¥¼ ë„ì…/ë°±ë„ì–´**í•˜ëŠ” ê²ƒì´ ê°€ëŠ¥í•©ë‹ˆë‹¤:

{% content-ref url="aws-lambda-layers-persistence.md" %}
[aws-lambda-layers-persistence.md](aws-lambda-layers-persistence.md)
{% endcontent-ref %}

### Lambda Extension Persistence

Lambda Layersë¥¼ ì•…ìš©í•˜ì—¬ í™•ì¥ì„ ì•…ìš©í•˜ê³  ëŒë‹¤ì— ì§€ì†ì ìœ¼ë¡œ ì¡´ì¬í•  ìˆ˜ ìˆìœ¼ë©° ìš”ì²­ì„ í›”ì¹˜ê³  ìˆ˜ì •í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.

{% content-ref url="aws-abusing-lambda-extensions.md" %}
[aws-abusing-lambda-extensions.md](aws-abusing-lambda-extensions.md)
{% endcontent-ref %}

### ë¦¬ì†ŒìŠ¤ ì •ì±…ì„ í†µí•œ ì ‘ê·¼

ì™¸ë¶€ ê³„ì •ì— ëŒ€í•´ ë‹¤ì–‘í•œ ëŒë‹¤ ì‘ì—…(ì˜ˆ: í˜¸ì¶œ ë˜ëŠ” ì½”ë“œ ì—…ë°ì´íŠ¸)ì— ëŒ€í•œ ì ‘ê·¼ì„ ë¶€ì—¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

<figure><img src="../../../../.gitbook/assets/image (2) (1) (2) (2).png" alt=""><figcaption></figcaption></figure>

### ë²„ì „, ë³„ì¹­ ë° ê°€ì¤‘ì¹˜

ëŒë‹¤ëŠ” **ë‹¤ì–‘í•œ ë²„ì „**(ê° ë²„ì „ë§ˆë‹¤ ë‹¤ë¥¸ ì½”ë“œ)ì„ ê°€ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤.\
ê·¸ëŸ° ë‹¤ìŒ, ëŒë‹¤ì˜ **ë‹¤ì–‘í•œ ë²„ì „ìœ¼ë¡œ ë‹¤ì–‘í•œ ë³„ì¹­ì„ ìƒì„±í•˜ê³  ê° ë²„ì „ì— ëŒ€í•´ ë‹¤ë¥¸ ê°€ì¤‘ì¹˜ë¥¼ ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.**\
ì´ë ‡ê²Œ í•˜ë©´ ê³µê²©ìëŠ” **ë°±ë„ì–´ê°€ ìˆëŠ” ë²„ì „ 1**ê³¼ **ì •ìƒ ì½”ë“œë§Œ ìˆëŠ” ë²„ì „ 2**ë¥¼ ìƒì„±í•˜ê³  **ìš”ì²­ì˜ 1%ì—ì„œë§Œ ë²„ì „ 1ì„ ì‹¤í–‰í•˜ì—¬ ì€ë°€í•¨ì„ ìœ ì§€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.**

<figure><img src="../../../../.gitbook/assets/image (2) (2).png" alt=""><figcaption></figcaption></figure>

### ë²„ì „ ë°±ë„ì–´ + API Gateway

1. Lambdaì˜ ì›ë³¸ ì½”ë“œë¥¼ ë³µì‚¬í•©ë‹ˆë‹¤.
2. ì›ë³¸ ì½”ë“œë¥¼ **ë°±ë„ì–´í•˜ëŠ” ìƒˆë¡œìš´ ë²„ì „ì„ ìƒì„±**í•©ë‹ˆë‹¤(ë˜ëŠ” ì•…ì„± ì½”ë“œë§Œ í¬í•¨). í•´ë‹¹ ë²„ì „ì„ ê²Œì‹œí•˜ê³  **$LATESTì— ë°°í¬í•©ë‹ˆë‹¤.**
3. ëŒë‹¤ì™€ ê´€ë ¨ëœ API ê²Œì´íŠ¸ì›¨ì´ë¥¼ í˜¸ì¶œí•˜ì—¬ ì½”ë“œë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤.
4. **ì›ë³¸ ì½”ë“œë¡œ ìƒˆë¡œìš´ ë²„ì „ì„ ìƒì„±í•˜ê³ **, í•´ë‹¹ **ë²„ì „ì„ $LATESTì— ê²Œì‹œí•˜ê³  ë°°í¬í•©ë‹ˆë‹¤.**
5. ì´ë ‡ê²Œ í•˜ë©´ ì´ì „ ë²„ì „ì—ì„œ ë°±ë„ì–´ ì½”ë“œê°€ ìˆ¨ê²¨ì§‘ë‹ˆë‹¤.
6. API Gatewayë¡œ ì´ë™í•˜ì—¬ **ë°±ë„ì–´ê°€ ìˆëŠ” ëŒë‹¤ ë²„ì „ì„ ì‹¤í–‰í•  ìƒˆë¡œìš´ POST ë©”ì„œë“œë¥¼ ìƒì„±**í•©ë‹ˆë‹¤: `arn:aws:lambda:us-east-1:<acc_id>:function:<func_name>:1`
7. arnì˜ ë§ˆì§€ë§‰ :1ì€ **í•¨ìˆ˜ì˜ ë²„ì „ì„ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤**(ì´ ì‹œë‚˜ë¦¬ì˜¤ì—ì„œ ë²„ì „ 1ì€ ë°±ë„ì–´ê°€ ìˆëŠ” ê²ƒì…ë‹ˆë‹¤).
8. ìƒì„±ëœ POST ë©”ì„œë“œë¥¼ ì„ íƒí•˜ê³  ì‘ì—…ì—ì„œ **`API ë°°í¬`**ë¥¼ ì„ íƒí•©ë‹ˆë‹¤.
9. ì´ì œ **POSTë¥¼ í†µí•´ í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ë©´ ë°±ë„ì–´ê°€ í˜¸ì¶œë©ë‹ˆë‹¤.**

### Cron/Event actuator

ë¬´ì–¸ê°€ê°€ ë°œìƒí•˜ê±°ë‚˜ ì‹œê°„ì´ ì§€ë‚˜ë©´ **ëŒë‹¤ í•¨ìˆ˜ë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆë‹¤ëŠ” ì‚¬ì‹¤**ì€ ëŒë‹¤ë¥¼ ì§€ì†ì„±ì„ ì–»ê³  íƒì§€ë¥¼ í”¼í•˜ëŠ” ì¢‹ì€ ë°©ë²•ìœ¼ë¡œ ë§Œë“­ë‹ˆë‹¤.\
ì—¬ê¸° AWSì—ì„œ **ì€ë°€í•˜ê²Œ ì¡´ì¬í•˜ê¸° ìœ„í•´ ëŒë‹¤ë¥¼ ìƒì„±í•˜ëŠ” ëª‡ ê°€ì§€ ì•„ì´ë””ì–´ê°€ ìˆìŠµë‹ˆë‹¤.**

* ìƒˆë¡œìš´ ì‚¬ìš©ìê°€ ìƒì„±ë  ë•Œë§ˆë‹¤ ëŒë‹¤ê°€ ìƒˆë¡œìš´ ì‚¬ìš©ì í‚¤ë¥¼ ìƒì„±í•˜ê³  ê³µê²©ìì—ê²Œ ì „ì†¡í•©ë‹ˆë‹¤.
* ìƒˆë¡œìš´ ì—­í• ì´ ìƒì„±ë  ë•Œë§ˆë‹¤ ëŒë‹¤ê°€ ì†ìƒëœ ì‚¬ìš©ìì—ê²Œ ì—­í•  ìˆ˜ì„ ê¶Œí•œì„ ë¶€ì—¬í•©ë‹ˆë‹¤.
* ìƒˆë¡œìš´ CloudTrail ë¡œê·¸ê°€ ìƒì„±ë  ë•Œë§ˆë‹¤ ì‚­ì œ/ë³€ê²½í•©ë‹ˆë‹¤.

{% hint style="success" %}
AWS í•´í‚¹ ë°°ìš°ê¸° ë° ì—°ìŠµí•˜ê¸°:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCP í•´í‚¹ ë°°ìš°ê¸° ë° ì—°ìŠµí•˜ê¸°: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks ì§€ì›í•˜ê¸°</summary>

* [**êµ¬ë… ê³„íš**](https://github.com/sponsors/carlospolop) í™•ì¸í•˜ê¸°!
* **ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— ì°¸ì—¬í•˜ê±°ë‚˜ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**ë¥¼ íŒ”ë¡œìš°í•˜ì„¸ìš”.**
* **[**HackTricks**](https://github.com/carlospolop/hacktricks) ë° [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub ë¦¬í¬ì§€í† ë¦¬ì— PRì„ ì œì¶œí•˜ì—¬ í•´í‚¹ íŠ¸ë¦­ì„ ê³µìœ í•˜ì„¸ìš”.**

</details>
{% endhint %}
