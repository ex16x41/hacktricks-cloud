# AWS - Elastic Beanstalk Enum

{% hint style="success" %}
Aprenda e pratique Hacking AWS:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Aprenda e pratique Hacking GCP: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Confira os [**planos de assinatura**](https://github.com/sponsors/carlospolop)!
* **Junte-se ao** üí¨ [**grupo do Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga**-nos no **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe truques de hacking enviando PRs para os** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) reposit√≥rios do github.

</details>
{% endhint %}

## Elastic Beanstalk

Amazon Elastic Beanstalk fornece uma plataforma simplificada para **implantar, gerenciar e escalar aplica√ß√µes e servi√ßos web**. Ele suporta uma variedade de linguagens de programa√ß√£o e frameworks, como Java, .NET, PHP, Node.js, Python, Ruby e Go, al√©m de cont√™ineres Docker. O servi√ßo √© compat√≠vel com servidores amplamente utilizados, incluindo Apache, Nginx, Passenger e IIS.

Elastic Beanstalk fornece uma maneira simples e flex√≠vel de **implantar suas aplica√ß√µes na nuvem AWS**, sem a necessidade de se preocupar com a infraestrutura subjacente. Ele **automaticamente** lida com os detalhes de **provisionamento** de capacidade, **balanceamento** de carga, **escalonamento** e **monitoramento** da sa√∫de da aplica√ß√£o, permitindo que voc√™ se concentre em escrever e implantar seu c√≥digo.

A infraestrutura criada pelo Elastic Beanstalk √© gerenciada por **Grupos de Autoscaling** em **EC2** (com um balanceador de carga). O que significa que, no final do dia, se voc√™ **comprometer o host**, voc√™ deve saber sobre o EC2:

{% content-ref url="../../aws-security/aws-services/aws-ec2-ebs-elb-ssm-vpc-and-vpn-enum/" %}
[aws-ec2-ebs-elb-ssm-vpc-and-vpn-enum](../../aws-security/aws-services/aws-ec2-ebs-elb-ssm-vpc-and-vpn-enum/)
{% endcontent-ref %}

Al√©m disso, se o Docker for usado, √© poss√≠vel usar **ECS**.

{% content-ref url="../../aws-security/aws-services/aws-eks-enum.md" %}
[aws-eks-enum.md](../../aws-security/aws-services/aws-eks-enum.md)
{% endcontent-ref %}

### Aplica√ß√£o e Ambientes

No AWS Elastic Beanstalk, os conceitos de "aplica√ß√£o" e "ambiente" servem a prop√≥sitos diferentes e t√™m pap√©is distintos no processo de implanta√ß√£o.

#### Aplica√ß√£o

* Uma aplica√ß√£o no Elastic Beanstalk √© um **container l√≥gico para o c√≥digo-fonte, ambientes e configura√ß√µes da sua aplica√ß√£o**. Ela agrupa diferentes vers√µes do c√≥digo da sua aplica√ß√£o e permite que voc√™ as gerencie como uma √∫nica entidade.
* Quando voc√™ cria uma aplica√ß√£o, voc√™ fornece um nome e **descri√ß√£o, mas nenhum recurso √© provisionado** nesta fase. √â simplesmente uma maneira de organizar e gerenciar seu c√≥digo e recursos relacionados.
* Voc√™ pode ter **m√∫ltiplas vers√µes de aplica√ß√£o** dentro de uma aplica√ß√£o. Cada vers√£o corresponde a um lan√ßamento espec√≠fico do seu c√≥digo, que pode ser implantado em um ou mais ambientes.

#### Ambiente

* Um ambiente √© uma **inst√¢ncia provisionada da sua aplica√ß√£o** executando na infraestrutura da AWS. √â **onde o c√≥digo da sua aplica√ß√£o √© implantado e executado**. O Elastic Beanstalk provisiona os recursos necess√°rios (por exemplo, inst√¢ncias EC2, balanceadores de carga, grupos de autoescalonamento, bancos de dados) com base na configura√ß√£o do ambiente.
* **Cada ambiente executa uma √∫nica vers√£o da sua aplica√ß√£o**, e voc√™ pode ter m√∫ltiplos ambientes para diferentes prop√≥sitos, como desenvolvimento, teste, homologa√ß√£o e produ√ß√£o.
* Quando voc√™ cria um ambiente, voc√™ escolhe uma plataforma (por exemplo, Java, .NET, Node.js, etc.) e um tipo de ambiente (por exemplo, servidor web ou trabalhador). Voc√™ tamb√©m pode personalizar a configura√ß√£o do ambiente para controlar v√°rios aspectos da infraestrutura e das configura√ß√µes da aplica√ß√£o.

### 2 tipos de Ambientes

1. **Ambiente de Servidor Web**: √â projetado para **hospedar e servir aplica√ß√µes web e APIs**. Essas aplica√ß√µes normalmente lidam com solicita√ß√µes HTTP/HTTPS recebidas. O ambiente de servidor web provisiona recursos como **inst√¢ncias EC2, balanceadores de carga e grupos de autoescalonamento** para lidar com o tr√°fego recebido, gerenciar capacidade e garantir a alta disponibilidade da aplica√ß√£o.
2. **Ambiente de Trabalhador**: √â projetado para processar **tarefas em segundo plano**, que s√£o frequentemente opera√ß√µes demoradas ou intensivas em recursos que n√£o requerem respostas imediatas aos clientes. O ambiente de trabalhador provisiona recursos como **inst√¢ncias EC2 e grupos de autoescalonamento**, mas **n√£o possui um balanceador de carga** uma vez que n√£o lida diretamente com solicita√ß√µes HTTP/HTTPS. Em vez disso, ele consome tarefas de uma **fila do Amazon Simple Queue Service (SQS)**, que atua como um buffer entre o ambiente de trabalhador e as tarefas que ele processa.

### Seguran√ßa

Ao criar um App no Beanstalk, h√° 3 op√ß√µes de seguran√ßa muito importantes a serem escolhidas:

* **Par de chaves EC2**: Esta ser√° a **chave SSH** que poder√° acessar as inst√¢ncias EC2 executando o app.
* **Perfil de inst√¢ncia IAM**: Este √© o **perfil de inst√¢ncia** que as inst√¢ncias ter√£o (**privil√©gios IAM**).
* O papel gerado automaticamente √© chamado de **`aws-elasticbeanstalk-ec2-role`** e possui alguns acessos interessantes sobre todo o ECS, todo o SQS, DynamoDB elasticbeanstalk e elasticbeanstalk S3 usando as pol√≠ticas gerenciadas pela AWS: [AWSElasticBeanstalkWebTier](https://us-east-1.console.aws.amazon.com/iam/home#/policies/arn:aws:iam::aws:policy/AWSElasticBeanstalkWebTier), [AWSElasticBeanstalkMulticontainerDocker](https://us-east-1.console.aws.amazon.com/iam/home#/policies/arn:aws:iam::aws:policy/AWSElasticBeanstalkMulticontainerDocker), [AWSElasticBeanstalkWorkerTier](https://us-east-1.console.aws.amazon.com/iam/home#/policies/arn:aws:iam::aws:policy/AWSElasticBeanstalkWorkerTier).
* **Papel de servi√ßo**: Este √© o **papel que o servi√ßo AWS** usar√° para realizar todas as a√ß√µes necess√°rias. At√© onde sei, um usu√°rio regular da AWS n√£o pode acessar esse papel.
* Este papel gerado pela AWS √© chamado de **`aws-elasticbeanstalk-service-role`** e usa as pol√≠ticas gerenciadas pela AWS [AWSElasticBeanstalkEnhancedHealth](https://us-east-1.console.aws.amazon.com/iam/home#/policies/arn:aws:iam::aws:policy/service-role/AWSElasticBeanstalkEnhancedHealth) e [AWSElasticBeanstalkManagedUpdatesCustomerRolePolicy](https://us-east-1.console.aws.amazon.com/iamv2/home?region=us-east-1#/roles/details/aws-elasticbeanstalk-service-role?section=permissions)

Por padr√£o, **a vers√£o de metadados 1 est√° desativada**:

<figure><img src="../../../.gitbook/assets/image (18) (1) (2).png" alt=""><figcaption></figcaption></figure>

### Exposi√ß√£o

Os dados do Beanstalk s√£o armazenados em um **bucket S3** com o seguinte nome: **`elasticbeanstalk-<region>-<acc-id>`** (se foi criado no console AWS). Dentro deste bucket voc√™ encontrar√° o **c√≥digo-fonte da aplica√ß√£o** carregado.

A **URL** da p√°gina web criada √© **`http://<webapp-name>-env.<random>.<region>.elasticbeanstalk.com/`**

{% hint style="warning" %}
Se voc√™ obter **acesso de leitura** sobre o bucket, voc√™ pode **ler o c√≥digo-fonte** e at√© encontrar **credenciais sens√≠veis** nele.

Se voc√™ obter **acesso de grava√ß√£o** sobre o bucket, voc√™ poderia **modificar o c√≥digo-fonte** para **comprometer** o **papel IAM** que a aplica√ß√£o est√° usando na pr√≥xima vez que for executada.
{% endhint %}

### Enumera√ß√£o

{% code overflow="wrap" %}
```bash
# Find S3 bucket
ACCOUNT_NUMBER=<account_number>
for r in us-east-1 us-east-2 us-west-1 us-west-2 ap-south-1 ap-south-2 ap-northeast-1 ap-northeast-2 ap-northeast-3 ap-southeast-1 ap-southeast-2 ap-southeast-3 ca-central-1 eu-central-1 eu-central-2 eu-west-1 eu-west-2 eu-west-3 eu-north-1 sa-east-1 af-south-1 ap-east-1 eu-south-1 eu-south-2 me-south-1 me-central-1; do aws s3 ls elasticbeanstalk-$r-$ACCOUNT_NUMBER 2>/dev/null && echo "Found in: elasticbeanstalk-$r-$ACCOUNT_NUMBER"; done

# Get apps and URLs
aws elasticbeanstalk describe-applications # List apps
aws elasticbeanstalk describe-application-versions # Get apps & bucket name with source code
aws elasticbeanstalk describe-environments # List envs
aws elasticbeanstalk describe-environments | grep -E "EndpointURL|CNAME"
aws elasticbeanstalk describe-configuration-settings --application-name <app_name> --environment-name <env_name>
aws elasticbeanstalk describe-environment-resources --environment-name <env_name> # Get env info such as SQS used queues
aws elasticbeanstalk describe-instances-health --environment-name <env_name> # Get the instances of an environment

# Get events
aws elasticbeanstalk describe-events
```
{% endcode %}

### Acesso N√£o Autenticado

{% content-ref url="../../aws-security/aws-unauthenticated-enum-access/aws-elastic-beanstalk-unauthenticated-enum.md" %}
[aws-elastic-beanstalk-unauthenticated-enum.md](../../aws-security/aws-unauthenticated-enum-access/aws-elastic-beanstalk-unauthenticated-enum.md)
{% endcontent-ref %}

### Persist√™ncia

{% content-ref url="../../aws-security/aws-persistence/aws-elastic-beanstalk-persistence.md" %}
[aws-elastic-beanstalk-persistence.md](../../aws-security/aws-persistence/aws-elastic-beanstalk-persistence.md)
{% endcontent-ref %}

### Escala√ß√£o de Privil√©gios

{% content-ref url="../aws-privilege-escalation/aws-elastic-beanstalk-privesc.md" %}
[aws-elastic-beanstalk-privesc.md](../aws-privilege-escalation/aws-elastic-beanstalk-privesc.md)
{% endcontent-ref %}

### P√≥s Explora√ß√£o

{% content-ref url="../../aws-security/aws-post-exploitation/aws-elastic-beanstalk-post-exploitation.md" %}
[aws-elastic-beanstalk-post-exploitation.md](../../aws-security/aws-post-exploitation/aws-elastic-beanstalk-post-exploitation.md)
{% endcontent-ref %}

{% hint style="success" %}
Aprenda e pratique Hacking AWS:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Aprenda e pratique Hacking GCP: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Confira os [**planos de assinatura**](https://github.com/sponsors/carlospolop)!
* **Junte-se ao** üí¨ [**grupo do Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga**-nos no **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe truques de hacking enviando PRs para os reposit√≥rios do** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
{% endhint %}
