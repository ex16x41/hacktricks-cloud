# AWS - Elastic Beanstalk Enum

{% hint style="success" %}
Ucz si i wicz Hacking AWS:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Ucz si i wicz Hacking GCP: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Wsparcie dla HackTricks</summary>

* Sprawd藕 [**plany subskrypcyjne**](https://github.com/sponsors/carlospolop)!
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **led藕** nas na **Twitterze**  [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podziel si sztuczkami hackingowymi, przesyajc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repozytori贸w github.

</details>
{% endhint %}

## Elastic Beanstalk

Amazon Elastic Beanstalk zapewnia uproszczon platform do **wdra偶ania, zarzdzania i skalowania aplikacji internetowych i usug**. Obsuguje r贸偶norodne jzyki programowania i frameworki, takie jak Java, .NET, PHP, Node.js, Python, Ruby i Go, a tak偶e kontenery Docker. Usuga jest zgodna z powszechnie u偶ywanymi serwerami, w tym Apache, Nginx, Passenger i IIS.

Elastic Beanstalk zapewnia prosty i elastyczny spos贸b na **wdra偶anie aplikacji w chmurze AWS**, bez potrzeby martwienia si o infrastruktur. **Automatycznie** zajmuje si szczeg贸ami dotyczcymi **prowizjonowania** pojemnoci, **r贸wnowa偶enia obci偶enia**, **skalowania** i **monitorowania** stanu aplikacji, co pozwala skupi si na pisaniu i wdra偶aniu kodu.

Infrastruktura tworzona przez Elastic Beanstalk jest zarzdzana przez **Autoscaling** Groups w **EC2** (z r贸wnowa偶nikiem obci偶enia). Oznacza to, 偶e na koniec dnia, jeli **skomprymujesz hosta**, powiniene wiedzie o EC2:

{% content-ref url="../../aws-security/aws-services/aws-ec2-ebs-elb-ssm-vpc-and-vpn-enum/" %}
[aws-ec2-ebs-elb-ssm-vpc-and-vpn-enum](../../aws-security/aws-services/aws-ec2-ebs-elb-ssm-vpc-and-vpn-enum/)
{% endcontent-ref %}

Ponadto, jeli u偶ywany jest Docker, mo偶liwe jest korzystanie z **ECS**.

{% content-ref url="../../aws-security/aws-services/aws-eks-enum.md" %}
[aws-eks-enum.md](../../aws-security/aws-services/aws-eks-enum.md)
{% endcontent-ref %}

### Aplikacja i rodowiska

W AWS Elastic Beanstalk pojcia "aplikacja" i "rodowisko" peni r贸偶ne funkcje i maj odrbne role w procesie wdra偶ania.

#### Aplikacja

* Aplikacja w Elastic Beanstalk to **logiczny kontener dla kodu 藕r贸dowego aplikacji, rodowisk i konfiguracji**. Grupuje r贸偶ne wersje kodu aplikacji i pozwala zarzdza nimi jako jedn jednostk.
* Kiedy tworzysz aplikacj, podajesz nazw i **opis, ale w tym etapie nie s przydzielane 偶adne zasoby**. To po prostu spos贸b na zorganizowanie i zarzdzanie swoim kodem i powizanymi zasobami.
* Mo偶esz mie **wiele wersji aplikacji** w ramach jednej aplikacji. Ka偶da wersja odpowiada konkretnej wersji twojego kodu, kt贸ra mo偶e by wdro偶ona w jednym lub wicej rodowiskach.

#### rodowisko

* rodowisko to **przydzielona instancja twojej aplikacji** dziaajca na infrastrukturze AWS. To **gdzie kod twojej aplikacji jest wdra偶any i wykonywany**. Elastic Beanstalk przydziela niezbdne zasoby (np. instancje EC2, r贸wnowa偶niki obci偶enia, grupy auto-skalowania, bazy danych) na podstawie konfiguracji rodowiska.
* **Ka偶de rodowisko uruchamia jedn wersj twojej aplikacji**, a ty mo偶esz mie wiele rodowisk do r贸偶nych cel贸w, takich jak rozw贸j, testowanie, staging i produkcja.
* Kiedy tworzysz rodowisko, wybierasz platform (np. Java, .NET, Node.js itp.) oraz typ rodowiska (np. serwer WWW lub pracownik). Mo偶esz r贸wnie偶 dostosowa konfiguracj rodowiska, aby kontrolowa r贸偶ne aspekty infrastruktury i ustawie aplikacji.

### 2 typy rodowisk

1. **rodowisko serwera WWW**: Jest zaprojektowane do **hostowania i obsugi aplikacji internetowych i API**. Te aplikacje zazwyczaj obsuguj przychodzce 偶dania HTTP/HTTPS. rodowisko serwera WWW przydziela zasoby takie jak **instancje EC2, r贸wnowa偶niki obci偶enia i grupy auto-skalowania**, aby obsugiwa ruch przychodzcy, zarzdza pojemnoci i zapewni wysok dostpno aplikacji.
2. **rodowisko pracownika**: Jest zaprojektowane do przetwarzania **zada w tle**, kt贸re czsto s czasochonne lub zasobo偶erne i nie wymagaj natychmiastowych odpowiedzi dla klient贸w. rodowisko pracownika przydziela zasoby takie jak **instancje EC2 i grupy auto-skalowania**, ale **nie ma r贸wnowa偶nika obci偶enia**, poniewa偶 nie obsuguje 偶da HTTP/HTTPS bezporednio. Zamiast tego, konsumuje zadania z **Amazon Simple Queue Service (SQS)**, kt贸re dziaa jako bufor midzy rodowiskiem pracownika a zadaniami, kt贸re przetwarza.

### Bezpieczestwo

Podczas tworzenia aplikacji w Beanstalk istniej 3 bardzo wa偶ne opcje bezpieczestwa do wyboru:

* **Para kluczy EC2**: To bdzie **klucz SSH**, kt贸ry bdzie m贸g uzyska dostp do instancji EC2 uruchamiajcych aplikacj.
* **Profil instancji IAM**: To jest **profil instancji**, kt贸ry bd miay instancje (**uprawnienia IAM**).
* Autogenerowana rola nazywa si **`aws-elasticbeanstalk-ec2-role`** i ma interesujcy dostp do wszystkich ECS, wszystkich SQS, DynamoDB elasticbeanstalk i elasticbeanstalk S3, korzystajc z zarzdzanych polityk AWS: [AWSElasticBeanstalkWebTier](https://us-east-1.console.aws.amazon.com/iam/home#/policies/arn:aws:iam::aws:policy/AWSElasticBeanstalkWebTier), [AWSElasticBeanstalkMulticontainerDocker](https://us-east-1.console.aws.amazon.com/iam/home#/policies/arn:aws:iam::aws:policy/AWSElasticBeanstalkMulticontainerDocker), [AWSElasticBeanstalkWorkerTier](https://us-east-1.console.aws.amazon.com/iam/home#/policies/arn:aws:iam::aws:policy/AWSElasticBeanstalkWorkerTier).
* **Rola usugi**: To jest **rola, kt贸r usuga AWS** bdzie u偶ywa do wykonywania wszystkich potrzebnych dziaa. O ile mi wiadomo, zwyky u偶ytkownik AWS nie mo偶e uzyska dostpu do tej roli.
* Ta rola generowana przez AWS nazywa si **`aws-elasticbeanstalk-service-role`** i korzysta z zarzdzanych polityk AWS [AWSElasticBeanstalkEnhancedHealth](https://us-east-1.console.aws.amazon.com/iam/home#/policies/arn:aws:iam::aws:policy/service-role/AWSElasticBeanstalkEnhancedHealth) i [AWSElasticBeanstalkManagedUpdatesCustomerRolePolicy](https://us-east-1.console.aws.amazon.com/iamv2/home?region=us-east-1#/roles/details/aws-elasticbeanstalk-service-role?section=permissions)

Domylnie **wersja metadanych 1 jest wyczona**:

<figure><img src="../../../.gitbook/assets/image (18) (1) (2).png" alt=""><figcaption></figcaption></figure>

### Ekspozycja

Dane Beanstalk s przechowywane w **wiadrze S3** o nastpujcej nazwie: **`elasticbeanstalk-<region>-<acc-id>`** (jeli zostao utworzone w konsoli AWS). Wewntrz tego wiadra znajdziesz przesany **kod 藕r贸dowy aplikacji**.

**URL** utworzonej strony internetowej to **`http://<webapp-name>-env.<random>.<region>.elasticbeanstalk.com/`**

{% hint style="warning" %}
Jeli uzyskasz **dostp do odczytu** do wiadra, mo偶esz **odczyta kod 藕r贸dowy** i nawet znale藕 **wra偶liwe dane uwierzytelniajce** w nim

jeli uzyskasz **dostp do zapisu** do wiadra, mo偶esz **zmodyfikowa kod 藕r贸dowy**, aby **skomprymowa** **rol IAM**, kt贸rej aplikacja u偶ywa przy nastpnym uruchomieniu.
{% endhint %}

### Enumeracja

{% code overflow="wrap" %}
```bash
# Find S3 bucket
ACCOUNT_NUMBER=<account_number>
for r in us-east-1 us-east-2 us-west-1 us-west-2 ap-south-1 ap-south-2 ap-northeast-1 ap-northeast-2 ap-northeast-3 ap-southeast-1 ap-southeast-2 ap-southeast-3 ca-central-1 eu-central-1 eu-central-2 eu-west-1 eu-west-2 eu-west-3 eu-north-1 sa-east-1 af-south-1 ap-east-1 eu-south-1 eu-south-2 me-south-1 me-central-1; do aws s3 ls elasticbeanstalk-$r-$ACCOUNT_NUMBER 2>/dev/null && echo "Found in: elasticbeanstalk-$r-$ACCOUNT_NUMBER"; done

# Get apps and URLs
aws elasticbeanstalk describe-applications # List apps
aws elasticbeanstalk describe-application-versions # Get apps & bucket name with source code
aws elasticbeanstalk describe-environments # List envs
aws elasticbeanstalk describe-environments | grep -E "EndpointURL|CNAME"
aws elasticbeanstalk describe-configuration-settings --application-name <app_name> --environment-name <env_name>
aws elasticbeanstalk describe-environment-resources --environment-name <env_name> # Get env info such as SQS used queues
aws elasticbeanstalk describe-instances-health --environment-name <env_name> # Get the instances of an environment

# Get events
aws elasticbeanstalk describe-events
```
{% endcode %}

### Nieautoryzowany dostp

{% content-ref url="../../aws-security/aws-unauthenticated-enum-access/aws-elastic-beanstalk-unauthenticated-enum.md" %}
[aws-elastic-beanstalk-unauthenticated-enum.md](../../aws-security/aws-unauthenticated-enum-access/aws-elastic-beanstalk-unauthenticated-enum.md)
{% endcontent-ref %}

### Utrzymywanie

{% content-ref url="../../aws-security/aws-persistence/aws-elastic-beanstalk-persistence.md" %}
[aws-elastic-beanstalk-persistence.md](../../aws-security/aws-persistence/aws-elastic-beanstalk-persistence.md)
{% endcontent-ref %}

### Privesc

{% content-ref url="../aws-privilege-escalation/aws-elastic-beanstalk-privesc.md" %}
[aws-elastic-beanstalk-privesc.md](../aws-privilege-escalation/aws-elastic-beanstalk-privesc.md)
{% endcontent-ref %}

### Po eksploatacji

{% content-ref url="../../aws-security/aws-post-exploitation/aws-elastic-beanstalk-post-exploitation.md" %}
[aws-elastic-beanstalk-post-exploitation.md](../../aws-security/aws-post-exploitation/aws-elastic-beanstalk-post-exploitation.md)
{% endcontent-ref %}

{% hint style="success" %}
Ucz si i wicz Hacking AWS:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Ucz si i wicz Hacking GCP: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Wsparcie dla HackTricks</summary>

* Sprawd藕 [**plany subskrypcyjne**](https://github.com/sponsors/carlospolop)!
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **led藕** nas na **Twitterze**  [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Dziel si sztuczkami hackingowymi, przesyajc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repozytori贸w na githubie.

</details>
{% endhint %}
