# AWS - Elastic Beanstalk Enum

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Elastic Beanstalk

Amazon Elastic Beanstalk fournit une plateforme simplifi√©e pour **d√©ployer, g√©rer et mettre √† l'√©chelle des applications et services web**. Il prend en charge une vari√©t√© de langages de programmation et de frameworks, tels que Java, .NET, PHP, Node.js, Python, Ruby et Go, ainsi que des conteneurs Docker. Le service est compatible avec des serveurs largement utilis√©s, y compris Apache, Nginx, Passenger et IIS.

Elastic Beanstalk offre un moyen simple et flexible de **d√©ployer vos applications dans le cloud AWS**, sans avoir √† se soucier de l'infrastructure sous-jacente. Il **g√®re automatiquement** les d√©tails de la **provisionnement** de capacit√©, de l'**√©quilibrage de charge**, de la **mise √† l'√©chelle** et de la **surveillance de la sant√©** des applications, vous permettant de vous concentrer sur l'√©criture et le d√©ploiement de votre code.

L'infrastructure cr√©√©e par Elastic Beanstalk est g√©r√©e par des **Groupes d'Autoscaling** dans **EC2** (avec un √©quilibreur de charge). Ce qui signifie qu'√† la fin de la journ√©e, si vous **compromettez l'h√¥te**, vous devez conna√Ætre EC2 :

{% content-ref url="../../aws-security/aws-services/aws-ec2-ebs-elb-ssm-vpc-and-vpn-enum/" %}
[aws-ec2-ebs-elb-ssm-vpc-and-vpn-enum](../../aws-security/aws-services/aws-ec2-ebs-elb-ssm-vpc-and-vpn-enum/)
{% endcontent-ref %}

De plus, si Docker est utilis√©, il est possible d'utiliser **ECS**.

{% content-ref url="../../aws-security/aws-services/aws-eks-enum.md" %}
[aws-eks-enum.md](../../aws-security/aws-services/aws-eks-enum.md)
{% endcontent-ref %}

### Application & Environnements

Dans AWS Elastic Beanstalk, les concepts d'une "application" et d'un "environnement" servent des objectifs diff√©rents et ont des r√¥les distincts dans le processus de d√©ploiement.

#### Application

* Une application dans Elastic Beanstalk est un **conteneur logique pour le code source de votre application, les environnements et les configurations**. Elle regroupe diff√©rentes versions de votre code d'application et vous permet de les g√©rer en tant qu'entit√© unique.
* Lorsque vous cr√©ez une application, vous fournissez un nom et une **description, mais aucune ressource n'est provisionn√©e** √† ce stade. C'est simplement un moyen d'organiser et de g√©rer votre code et les ressources associ√©es.
* Vous pouvez avoir **plusieurs versions d'application** au sein d'une application. Chaque version correspond √† une version sp√©cifique de votre code, qui peut √™tre d√©ploy√©e dans un ou plusieurs environnements.

#### Environnement

* Un environnement est une **instance provisionn√©e de votre application** fonctionnant sur l'infrastructure AWS. C'est **l√† o√π le code de votre application est d√©ploy√© et ex√©cut√©**. Elastic Beanstalk provisionne les ressources n√©cessaires (par exemple, instances EC2, √©quilibreurs de charge, groupes d'auto-scaling, bases de donn√©es) en fonction de la configuration de l'environnement.
* **Chaque environnement ex√©cute une seule version de votre application**, et vous pouvez avoir plusieurs environnements pour diff√©rents objectifs, tels que le d√©veloppement, les tests, la mise en sc√®ne et la production.
* Lorsque vous cr√©ez un environnement, vous choisissez une plateforme (par exemple, Java, .NET, Node.js, etc.) et un type d'environnement (par exemple, serveur web ou travailleur). Vous pouvez √©galement personnaliser la configuration de l'environnement pour contr√¥ler divers aspects de l'infrastructure et des param√®tres de l'application.

### 2 types d'Environnements

1. **Environnement de Serveur Web** : Il est con√ßu pour **h√©berger et servir des applications web et des API**. Ces applications g√®rent g√©n√©ralement les requ√™tes HTTP/HTTPS entrantes. L'environnement de serveur web provisionne des ressources telles que des **instances EC2, des √©quilibreurs de charge et des groupes d'auto-scaling** pour g√©rer le trafic entrant, g√©rer la capacit√© et garantir la haute disponibilit√© de l'application.
2. **Environnement de Travailleur** : Il est con√ßu pour traiter des **t√¢ches en arri√®re-plan**, qui sont souvent des op√©rations longues ou gourmandes en ressources qui ne n√©cessitent pas de r√©ponses imm√©diates aux clients. L'environnement de travailleur provisionne des ressources comme des **instances EC2 et des groupes d'auto-scaling**, mais il **n'a pas d'√©quilibreur de charge** car il ne g√®re pas directement les requ√™tes HTTP/HTTPS. Au lieu de cela, il consomme des t√¢ches √† partir d'une **file d'attente Amazon Simple Queue Service (SQS)**, qui agit comme un tampon entre l'environnement de travailleur et les t√¢ches qu'il traite.

### S√©curit√©

Lors de la cr√©ation d'une application dans Beanstalk, il y a 3 options de s√©curit√© tr√®s importantes √† choisir :

* **Paire de cl√©s EC2** : Ce sera la **cl√© SSH** qui pourra acc√©der aux instances EC2 ex√©cutant l'application.
* **Profil d'instance IAM** : C'est le **profil d'instance** que les instances auront (**privil√®ges IAM**).
* Le r√¥le g√©n√©r√© automatiquement s'appelle **`aws-elasticbeanstalk-ec2-role`** et a un acc√®s int√©ressant sur tous les ECS, toutes les SQS, DynamoDB elasticbeanstalk et elasticbeanstalk S3 en utilisant les politiques g√©r√©es par AWS : [AWSElasticBeanstalkWebTier](https://us-east-1.console.aws.amazon.com/iam/home#/policies/arn:aws:iam::aws:policy/AWSElasticBeanstalkWebTier), [AWSElasticBeanstalkMulticontainerDocker](https://us-east-1.console.aws.amazon.com/iam/home#/policies/arn:aws:iam::aws:policy/AWSElasticBeanstalkMulticontainerDocker), [AWSElasticBeanstalkWorkerTier](https://us-east-1.console.aws.amazon.com/iam/home#/policies/arn:aws:iam::aws:policy/AWSElasticBeanstalkWorkerTier).
* **R√¥le de service** : C'est le **r√¥le que le service AWS** utilisera pour effectuer toutes les actions n√©cessaires. √Ä ma connaissance, un utilisateur AWS ordinaire ne peut pas acc√©der √† ce r√¥le.
* Ce r√¥le g√©n√©r√© par AWS s'appelle **`aws-elasticbeanstalk-service-role`** et utilise les politiques g√©r√©es par AWS [AWSElasticBeanstalkEnhancedHealth](https://us-east-1.console.aws.amazon.com/iam/home#/policies/arn:aws:iam::aws:policy/service-role/AWSElasticBeanstalkEnhancedHealth) et [AWSElasticBeanstalkManagedUpdatesCustomerRolePolicy](https://us-east-1.console.aws.amazon.com/iamv2/home?region=us-east-1#/roles/details/aws-elasticbeanstalk-service-role?section=permissions)

Par d√©faut, **la version des m√©tadonn√©es 1 est d√©sactiv√©e** :

<figure><img src="../../../.gitbook/assets/image (18) (1) (2).png" alt=""><figcaption></figcaption></figure>

### Exposition

Les donn√©es Beanstalk sont stock√©es dans un **bucket S3** avec le nom suivant : **`elasticbeanstalk-<region>-<acc-id>`** (si elles ont √©t√© cr√©√©es dans la console AWS). √Ä l'int√©rieur de ce bucket, vous trouverez le **code source de l'application** t√©l√©charg√©.

L'**URL** de la page web cr√©√©e est **`http://<webapp-name>-env.<random>.<region>.elasticbeanstalk.com/`**

{% hint style="warning" %}
Si vous obtenez un **acc√®s en lecture** sur le bucket, vous pouvez **lire le code source** et m√™me trouver des **identifiants sensibles** dessus.

Si vous obtenez un **acc√®s en √©criture** sur le bucket, vous pourriez **modifier le code source** pour **compromettre** le **r√¥le IAM** que l'application utilise la prochaine fois qu'elle est ex√©cut√©e.
{% endhint %}

### √ânum√©ration

{% code overflow="wrap" %}
```bash
# Find S3 bucket
ACCOUNT_NUMBER=<account_number>
for r in us-east-1 us-east-2 us-west-1 us-west-2 ap-south-1 ap-south-2 ap-northeast-1 ap-northeast-2 ap-northeast-3 ap-southeast-1 ap-southeast-2 ap-southeast-3 ca-central-1 eu-central-1 eu-central-2 eu-west-1 eu-west-2 eu-west-3 eu-north-1 sa-east-1 af-south-1 ap-east-1 eu-south-1 eu-south-2 me-south-1 me-central-1; do aws s3 ls elasticbeanstalk-$r-$ACCOUNT_NUMBER 2>/dev/null && echo "Found in: elasticbeanstalk-$r-$ACCOUNT_NUMBER"; done

# Get apps and URLs
aws elasticbeanstalk describe-applications # List apps
aws elasticbeanstalk describe-application-versions # Get apps & bucket name with source code
aws elasticbeanstalk describe-environments # List envs
aws elasticbeanstalk describe-environments | grep -E "EndpointURL|CNAME"
aws elasticbeanstalk describe-configuration-settings --application-name <app_name> --environment-name <env_name>
aws elasticbeanstalk describe-environment-resources --environment-name <env_name> # Get env info such as SQS used queues
aws elasticbeanstalk describe-instances-health --environment-name <env_name> # Get the instances of an environment

# Get events
aws elasticbeanstalk describe-events
```
{% endcode %}

### Acc√®s non authentifi√©

{% content-ref url="../../aws-security/aws-unauthenticated-enum-access/aws-elastic-beanstalk-unauthenticated-enum.md" %}
[aws-elastic-beanstalk-unauthenticated-enum.md](../../aws-security/aws-unauthenticated-enum-access/aws-elastic-beanstalk-unauthenticated-enum.md)
{% endcontent-ref %}

### Persistance

{% content-ref url="../../aws-security/aws-persistence/aws-elastic-beanstalk-persistence.md" %}
[aws-elastic-beanstalk-persistence.md](../../aws-security/aws-persistence/aws-elastic-beanstalk-persistence.md)
{% endcontent-ref %}

### √âl√©vation de privil√®ges

{% content-ref url="../aws-privilege-escalation/aws-elastic-beanstalk-privesc.md" %}
[aws-elastic-beanstalk-privesc.md](../aws-privilege-escalation/aws-elastic-beanstalk-privesc.md)
{% endcontent-ref %}

### Post-exploitation

{% content-ref url="../../aws-security/aws-post-exploitation/aws-elastic-beanstalk-post-exploitation.md" %}
[aws-elastic-beanstalk-post-exploitation.md](../../aws-security/aws-post-exploitation/aws-elastic-beanstalk-post-exploitation.md)
{% endcontent-ref %}

{% hint style="success" %}
Apprenez et pratiquez le hacking AWS :<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Apprenez et pratiquez le hacking GCP : <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Soutenir HackTricks</summary>

* Consultez les [**plans d'abonnement**](https://github.com/sponsors/carlospolop) !
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez-nous sur** **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Partagez des astuces de hacking en soumettant des PR aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) d√©p√¥ts github.

</details>
{% endhint %}
