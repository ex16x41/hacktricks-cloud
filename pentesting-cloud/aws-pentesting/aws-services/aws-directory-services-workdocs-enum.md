# AWS - Directory Services / WorkDocs Enum

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Directory Services

AWS Directory Service for Microsoft Active Directory, AWS Bulutunda bir dizin **kurmayÄ±, iÅŸletmeyi ve Ã¶lÃ§eklendirmeyi** kolaylaÅŸtÄ±ran yÃ¶netilen bir hizmettir. GerÃ§ek **Microsoft Active Directory** Ã¼zerine inÅŸa edilmiÅŸtir ve diÄŸer AWS hizmetleriyle sÄ±kÄ± bir ÅŸekilde entegre edilmiÅŸtir, bu da dizin bilincine sahip iÅŸ yÃ¼klerinizi ve AWS kaynaklarÄ±nÄ±zÄ± yÃ¶netmeyi kolaylaÅŸtÄ±rÄ±r. AWS Managed Microsoft AD ile mevcut Active Directory kullanÄ±cÄ±larÄ±nÄ±zÄ±, gruplarÄ±nÄ±zÄ± ve politikalarÄ±nÄ±zÄ± kullanarak AWS kaynaklarÄ±nÄ±za eriÅŸimi yÃ¶netebilirsiniz. Bu, kimlik yÃ¶netiminizi basitleÅŸtirmeye ve ek kimlik Ã§Ã¶zÃ¼mlerine olan ihtiyacÄ± azaltmaya yardÄ±mcÄ± olabilir. AWS Managed Microsoft AD ayrÄ±ca otomatik yedeklemeler ve felaket kurtarma yetenekleri saÄŸlar, bu da dizininizin kullanÄ±labilirliÄŸini ve dayanÄ±klÄ±lÄ±ÄŸÄ±nÄ± saÄŸlamaya yardÄ±mcÄ± olur. Genel olarak, AWS Directory Service for Microsoft Active Directory, AWS Bulutunda yÃ¶netilen, yÃ¼ksek kullanÄ±labilirlikte ve Ã¶lÃ§eklenebilir bir Active Directory hizmeti sunarak zaman ve kaynak tasarrufu yapmanÄ±za yardÄ±mcÄ± olabilir.

### Options

Directory Services, 5 tÃ¼r dizin oluÅŸturmanÄ±za olanak tanÄ±r:

* **AWS Managed Microsoft AD**: AWS'de yeni bir **Microsoft AD** Ã§alÄ±ÅŸtÄ±racaktÄ±r. YÃ¶netici parolasÄ±nÄ± ayarlayabilecek ve bir VPC'deki DC'lere eriÅŸebileceksiniz.
* **Simple AD**: **Linux-Samba** Active Directory uyumlu bir sunucu olacaktÄ±r. YÃ¶netici parolasÄ±nÄ± ayarlayabilecek ve bir VPC'deki DC'lere eriÅŸebileceksiniz.
* **AD Connector**: Mevcut Microsoft Active Directory'nize dizin isteklerini yÃ¶nlendiren bir proxy'dir ve bulutta herhangi bir bilgi Ã¶nbelleÄŸe almaz. Bir **VPC**'de dinleyecek ve mevcut AD'ye eriÅŸim iÃ§in **kimlik bilgileri** vermeniz gerekecek.
* **Amazon Cognito User Pools**: Bu, Cognito User Pools ile aynÄ±dÄ±r.
* **Cloud Directory**: Bu, **en basit** olanÄ±dÄ±r. KullanacaÄŸÄ±nÄ±z **ÅŸemayÄ±** belirttiÄŸiniz ve **kullanÄ±ma gÃ¶re faturalandÄ±rÄ±ldÄ±ÄŸÄ±nÄ±z** bir **sunucusuz** dizindir.

AWS Directory services, mevcut **yerel** Microsoft AD'nizle **senkronize** olmanÄ±za, AWS'de kendi dizininizi **Ã§alÄ±ÅŸtÄ±rmanÄ±za** veya **diÄŸer dizin tÃ¼rleriyle** senkronize olmanÄ±za olanak tanÄ±r.

### Lab

AWS'de kendi Microsoft AD'nizi oluÅŸturmak iÃ§in gÃ¼zel bir Ã¶ÄŸretici bulabilirsiniz: [https://docs.aws.amazon.com/directoryservice/latest/admin-guide/ms\_ad\_tutorial\_test\_lab\_base.html](https://docs.aws.amazon.com/directoryservice/latest/admin-guide/ms\_ad\_tutorial\_test\_lab\_base.html)

### Enumeration
```bash
# Get directories and DCs
aws ds describe-directories
aws ds describe-domain-controllers --directory-id <id>
# Get directory settings
aws ds describe-trusts
aws ds describe-ldaps-settings --directory-id <id>
aws ds describe-shared-directories --owner-directory-id <id>
aws ds get-directory-limits
aws ds list-certificates --directory-id <id>
aws ds describe-certificate --directory-id <id> --certificate-id <id>
```
### GiriÅŸ

Dizin tanÄ±mÄ±nda **`AccessUrl`** alanÄ±nda bir **alan adÄ±** varsa, bu, bir **kullanÄ±cÄ±nÄ±n** muhtemelen bazÄ± **AWS hizmetlerinde** **AD kimlik bilgileri** ile **giriÅŸ yapabileceÄŸi** anlamÄ±na gelir:

* `<name>.awsapps.com/connect` (Amazon Connect)
* `<name>.awsapps.com/workdocs` (Amazon WorkDocs)
* `<name>.awsapps.com/workmail` (Amazon WorkMail)
* `<name>.awsapps.com/console` (Amazon YÃ¶netim Konsolu)
* `<name>.awsapps.com/start` (IAM Kimlik Merkezi)

### Yetki YÃ¼kseltme

{% content-ref url="../../aws-security/aws-privilege-escalation/aws-directory-services-privesc.md" %}
[aws-directory-services-privesc.md](../../aws-security/aws-privilege-escalation/aws-directory-services-privesc.md)
{% endcontent-ref %}

## SÃ¼reklilik

### Bir AD kullanÄ±cÄ±sÄ± kullanarak

Bir **AD kullanÄ±cÄ±sÄ±na** **AWS yÃ¶netim konsoluna eriÅŸim** saÄŸlamak iÃ§in bir Rol verilebilir. **VarsayÄ±lan kullanÄ±cÄ± adÄ± Admin**'dir ve **ÅŸifresini** AWS konsolundan **deÄŸiÅŸtirmek** mÃ¼mkÃ¼ndÃ¼r.

Bu nedenle, **Admin'in ÅŸifresini deÄŸiÅŸtirmek**, **yeni bir kullanÄ±cÄ± oluÅŸturmak** veya bir kullanÄ±cÄ±nÄ±n **ÅŸifresini deÄŸiÅŸtirmek** ve o kullanÄ±cÄ±ya eriÅŸimi sÃ¼rdÃ¼rmek iÃ§in bir Rol vermek mÃ¼mkÃ¼ndÃ¼r.\
AyrÄ±ca, **AD iÃ§inde bir kullanÄ±cÄ±yÄ± bir gruba eklemek** ve **o AD grubuna bir Role eriÅŸim vermek** de mÃ¼mkÃ¼ndÃ¼r (bu sÃ¼rekliliÄŸi daha gizli hale getirmek iÃ§in).

### AD'yi paylaÅŸma (kurbanÄ±ndan saldÄ±rgana)

Bir AD ortamÄ±nÄ± bir kurbandan bir saldÄ±rgana paylaÅŸmak mÃ¼mkÃ¼ndÃ¼r. Bu ÅŸekilde saldÄ±rgan, AD ortamÄ±na eriÅŸmeye devam edebilecektir.\
Ancak, bu, yÃ¶netilen AD'yi paylaÅŸmayÄ± ve ayrÄ±ca bir VPC peering baÄŸlantÄ±sÄ± oluÅŸturmayÄ± gerektirir.

Burada bir kÄ±lavuz bulabilirsiniz: [https://docs.aws.amazon.com/directoryservice/latest/admin-guide/step1\_setup\_networking.html](https://docs.aws.amazon.com/directoryservice/latest/admin-guide/step1\_setup\_networking.html)

### ~~AD'yi paylaÅŸma (saldÄ±rgandan kurbanÄ±na)~~

FarklÄ± bir AD ortamÄ±ndaki kullanÄ±cÄ±lara bir AWS hesabÄ±na eriÅŸim vermenin mÃ¼mkÃ¼n olmadÄ±ÄŸÄ± gÃ¶rÃ¼nmektedir.

## WorkDocs

Amazon Web Services (AWS) WorkDocs, bulut tabanlÄ± bir **dosya depolama ve paylaÅŸÄ±m hizmetidir**. AWS'nin bulut biliÅŸim hizmetleri paketinin bir parÃ§asÄ±dÄ±r ve organizasyonlarÄ±n dosyalarÄ± ve belgeleri depolamak, paylaÅŸmak ve Ã¼zerinde iÅŸbirliÄŸi yapmak iÃ§in gÃ¼venli ve Ã¶lÃ§eklenebilir bir Ã§Ã¶zÃ¼m sunmak Ã¼zere tasarlanmÄ±ÅŸtÄ±r.

AWS WorkDocs, kullanÄ±cÄ±larÄ±n dosyalarÄ±nÄ± ve belgelerini yÃ¼klemeleri, eriÅŸmeleri ve yÃ¶netmeleri iÃ§in web tabanlÄ± bir arayÃ¼z saÄŸlar. AyrÄ±ca sÃ¼rÃ¼m kontrolÃ¼, gerÃ§ek zamanlÄ± iÅŸbirliÄŸi ve diÄŸer AWS hizmetleri ve Ã¼Ã§Ã¼ncÃ¼ taraf araÃ§larla entegrasyon gibi Ã¶zellikler sunar.

### SayÄ±m

{% code overflow="wrap" %}
```bash
# Get AD users (Admin not included)
aws workdocs describe-users --organization-id <directory-id>
# Get AD groups (containing "a")
aws workdocs describe-groups --organization-id d-9067a0285c --search-query a

# Create user (created inside the AD)
aws workdocs create-user --username testingasd --given-name testingasd --surname testingasd --password <password> --email-address name@directory.domain --organization-id <directory-id>

# Get what each user has created
aws workdocs describe-activities --user-id "S-1-5-21-377..."

# Get what was created in the directory
aws workdocs describe-activities --organization-id <directory-id>

# Get folder content
aws workdocs describe-folder-contents --folder-id <fold-id>

# Get file (a url to access with the content will be retreived)
aws workdocs get-document --document-id <doc-id>

# Get resource permissions if any
aws workdocs describe-resource-permissions --resource-id <value>

# Add permission so anyway can see the file
aws workdocs add-resource-permissions --resource-id <id> --principals Id=anonymous,Type=ANONYMOUS,Role=VIEWER
## This will give an id, the file will be acesible in: https://<name>.awsapps.com/workdocs/index.html#/share/document/<id>
```
{% endcode %}

### Privesc

{% content-ref url="../../aws-security/aws-privilege-escalation/aws-workdocs-privesc.md" %}
[aws-workdocs-privesc.md](../../aws-security/aws-privilege-escalation/aws-workdocs-privesc.md)
{% endcontent-ref %}

{% hint style="success" %}
AWS Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks EÄŸitim AWS KÄ±rmÄ±zÄ± Ekip UzmanÄ± (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCP Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks EÄŸitim GCP KÄ±rmÄ±zÄ± Ekip UzmanÄ± (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**abonelik planlarÄ±nÄ±**](https://github.com/sponsors/carlospolop) kontrol edin!
* **ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n ya da **Twitter'da** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**'i takip edin.**
* **Hacking ipuÃ§larÄ±nÄ± paylaÅŸmak iÃ§in** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna PR gÃ¶nderin.

</details>
{% endhint %}
