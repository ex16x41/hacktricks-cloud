# AWS - ç›®å½•æœåŠ¡ / WorkDocs æšä¸¾

{% hint style="success" %}
å­¦ä¹ ä¸å®è·µ AWS é»‘å®¢æŠ€æœ¯ï¼š<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks åŸ¹è®­ AWS çº¢é˜Ÿä¸“å®¶ (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
å­¦ä¹ ä¸å®è·µ GCP é»‘å®¢æŠ€æœ¯ï¼š<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks åŸ¹è®­ GCP çº¢é˜Ÿä¸“å®¶ (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>æ”¯æŒ HackTricks</summary>

* æŸ¥çœ‹ [**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**Telegram ç¾¤ç»„**](https://t.me/peass) æˆ– **åœ¨** **Twitter** ğŸ¦ **ä¸Šå…³æ³¨æˆ‘ä»¬** [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub ä»“åº“æäº¤ PR æ¥åˆ†äº«é»‘å®¢æŠ€å·§ã€‚

</details>
{% endhint %}

## ç›®å½•æœåŠ¡

AWS ç›®å½•æœåŠ¡ä¸º Microsoft Active Directory æä¾›äº†ä¸€ç§æ‰˜ç®¡æœåŠ¡ï¼Œä½¿æ‚¨èƒ½å¤Ÿè½»æ¾åœ° **åœ¨ AWS äº‘ä¸­è®¾ç½®ã€æ“ä½œå’Œæ‰©å±•ç›®å½•**ã€‚å®ƒåŸºäºå®é™…çš„ **Microsoft Active Directory**ï¼Œå¹¶ä¸å…¶ä»– AWS æœåŠ¡ç´§å¯†é›†æˆï¼Œä½¿æ‚¨èƒ½å¤Ÿè½»æ¾ç®¡ç†ç›®å½•æ„ŸçŸ¥çš„å·¥ä½œè´Ÿè½½å’Œ AWS èµ„æºã€‚ä½¿ç”¨ AWS æ‰˜ç®¡çš„ Microsoft ADï¼Œæ‚¨å¯ä»¥ **ä½¿ç”¨ç°æœ‰çš„** Active Directory ç”¨æˆ·ã€ç»„å’Œç­–ç•¥æ¥ç®¡ç†å¯¹ AWS èµ„æºçš„è®¿é—®ã€‚è¿™å¯ä»¥å¸®åŠ©ç®€åŒ–æ‚¨çš„èº«ä»½ç®¡ç†ï¼Œå¹¶å‡å°‘å¯¹é¢å¤–èº«ä»½è§£å†³æ–¹æ¡ˆçš„éœ€æ±‚ã€‚AWS æ‰˜ç®¡çš„ Microsoft AD è¿˜æä¾›è‡ªåŠ¨å¤‡ä»½å’Œç¾éš¾æ¢å¤åŠŸèƒ½ï¼Œå¸®åŠ©ç¡®ä¿æ‚¨çš„ç›®å½•çš„å¯ç”¨æ€§å’ŒæŒä¹…æ€§ã€‚æ€»ä½“è€Œè¨€ï¼ŒAWS ç›®å½•æœåŠ¡ä¸º Microsoft Active Directory å¯ä»¥é€šè¿‡æä¾›ä¸€ä¸ªæ‰˜ç®¡çš„ã€é«˜å¯ç”¨çš„ã€å¯æ‰©å±•çš„ Active Directory æœåŠ¡æ¥å¸®åŠ©æ‚¨èŠ‚çœæ—¶é—´å’Œèµ„æºã€‚

### é€‰é¡¹

ç›®å½•æœåŠ¡å…è®¸åˆ›å»º 5 ç§ç±»å‹çš„ç›®å½•ï¼š

* **AWS æ‰˜ç®¡çš„ Microsoft AD**ï¼šå°†åœ¨ AWS ä¸­è¿è¡Œä¸€ä¸ªæ–°çš„ **Microsoft AD**ã€‚æ‚¨å°†èƒ½å¤Ÿè®¾ç½®ç®¡ç†å‘˜å¯†ç å¹¶è®¿é—® VPC ä¸­çš„ DCã€‚
* **ç®€å• AD**ï¼šå°†æ˜¯ä¸€ä¸ªä¸ **Linux-Samba** Active Directory å…¼å®¹çš„æœåŠ¡å™¨ã€‚æ‚¨å°†èƒ½å¤Ÿè®¾ç½®ç®¡ç†å‘˜å¯†ç å¹¶è®¿é—® VPC ä¸­çš„ DCã€‚
* **AD è¿æ¥å™¨**ï¼šä¸€ä¸ªä»£ç†ï¼Œç”¨äº **å°†ç›®å½•è¯·æ±‚é‡å®šå‘åˆ°æ‚¨ç°æœ‰çš„ Microsoft Active Directory**ï¼Œè€Œä¸åœ¨äº‘ä¸­ç¼“å­˜ä»»ä½•ä¿¡æ¯ã€‚å®ƒå°†åœ¨ **VPC** ä¸­ç›‘å¬ï¼Œæ‚¨éœ€è¦æä¾› **è®¿é—®ç°æœ‰ AD çš„å‡­æ®**ã€‚
* **Amazon Cognito ç”¨æˆ·æ± **ï¼šè¿™ä¸ Cognito ç”¨æˆ·æ± ç›¸åŒã€‚
* **äº‘ç›®å½•**ï¼šè¿™æ˜¯ **æœ€ç®€å•** çš„ä¸€ä¸ªã€‚ä¸€ä¸ª **æ— æœåŠ¡å™¨** ç›®å½•ï¼Œæ‚¨æŒ‡æ˜è¦ä½¿ç”¨çš„ **æ¨¡å¼**ï¼Œå¹¶æ ¹æ® **ä½¿ç”¨æƒ…å†µè®¡è´¹**ã€‚

AWS ç›®å½•æœåŠ¡å…è®¸ä¸æ‚¨ç°æœ‰çš„ **æœ¬åœ°** Microsoft AD **åŒæ­¥**ï¼Œ**åœ¨ AWS ä¸­è¿è¡Œæ‚¨è‡ªå·±çš„**ï¼Œæˆ–ä¸ **å…¶ä»–ç›®å½•ç±»å‹** åŒæ­¥ã€‚

### å®éªŒå®¤

åœ¨è¿™é‡Œï¼Œæ‚¨å¯ä»¥æ‰¾åˆ°ä¸€ä¸ªå¾ˆå¥½çš„æ•™ç¨‹ï¼Œæ•™æ‚¨å¦‚ä½•åœ¨ AWS ä¸­åˆ›å»ºè‡ªå·±çš„ Microsoft ADï¼š[https://docs.aws.amazon.com/directoryservice/latest/admin-guide/ms\_ad\_tutorial\_test\_lab\_base.html](https://docs.aws.amazon.com/directoryservice/latest/admin-guide/ms\_ad\_tutorial\_test\_lab\_base.html)

### æšä¸¾
```bash
# Get directories and DCs
aws ds describe-directories
aws ds describe-domain-controllers --directory-id <id>
# Get directory settings
aws ds describe-trusts
aws ds describe-ldaps-settings --directory-id <id>
aws ds describe-shared-directories --owner-directory-id <id>
aws ds get-directory-limits
aws ds list-certificates --directory-id <id>
aws ds describe-certificate --directory-id <id> --certificate-id <id>
```
### ç™»å½•

è¯·æ³¨æ„ï¼Œå¦‚æœç›®å½•çš„**æè¿°**å­—æ®µä¸­çš„**`AccessUrl`**åŒ…å«**åŸŸ**ï¼Œåˆ™å¯èƒ½æ˜¯å› ä¸º**ç”¨æˆ·**å¯ä»¥ä½¿ç”¨å…¶**ADå‡­æ®**åœ¨æŸäº›**AWSæœåŠ¡**ä¸­**ç™»å½•**ï¼š

* `<name>.awsapps.com/connect` (Amazon Connect)
* `<name>.awsapps.com/workdocs` (Amazon WorkDocs)
* `<name>.awsapps.com/workmail` (Amazon WorkMail)
* `<name>.awsapps.com/console` (Amazon Management Console)
* `<name>.awsapps.com/start` (IAM Identity Center)

### æƒé™æå‡

{% content-ref url="../../aws-security/aws-privilege-escalation/aws-directory-services-privesc.md" %}
[aws-directory-services-privesc.md](../../aws-security/aws-privilege-escalation/aws-directory-services-privesc.md)
{% endcontent-ref %}

## æŒä¹…æ€§

### ä½¿ç”¨ADç”¨æˆ·

å¯ä»¥é€šè¿‡è§’è‰²èµ‹äºˆ**ADç”¨æˆ·**å¯¹AWSç®¡ç†æ§åˆ¶å°çš„**è®¿é—®æƒé™**ã€‚**é»˜è®¤ç”¨æˆ·åæ˜¯Admin**ï¼Œå¯ä»¥ä»AWSæ§åˆ¶å°**æ›´æ”¹å…¶å¯†ç **ã€‚

å› æ­¤ï¼Œå¯ä»¥**æ›´æ”¹Adminçš„å¯†ç **ï¼Œ**åˆ›å»ºæ–°ç”¨æˆ·**æˆ–**æ›´æ”¹ç”¨æˆ·çš„å¯†ç **å¹¶æˆäºˆè¯¥ç”¨æˆ·ä¸€ä¸ªè§’è‰²ä»¥ä¿æŒè®¿é—®æƒé™ã€‚\
è¿˜å¯ä»¥**å°†ç”¨æˆ·æ·»åŠ åˆ°ADä¸­çš„ç»„**å¹¶**æˆäºˆè¯¥ADç»„å¯¹è§’è‰²çš„è®¿é—®æƒé™**ï¼ˆä»¥ä½¿æ­¤æŒä¹…æ€§æ›´åŠ éšè”½ï¼‰ã€‚

### å…±äº«ADï¼ˆä»å—å®³è€…åˆ°æ”»å‡»è€…ï¼‰

å¯ä»¥å°†ADç¯å¢ƒä»å—å®³è€…å…±äº«ç»™æ”»å‡»è€…ã€‚è¿™æ ·ï¼Œæ”»å‡»è€…å°†èƒ½å¤Ÿç»§ç»­è®¿é—®ADç¯å¢ƒã€‚\
ç„¶è€Œï¼Œè¿™æ„å‘³ç€è¦å…±äº«æ‰˜ç®¡çš„ADå¹¶åˆ›å»ºVPCå¯¹ç­‰è¿æ¥ã€‚

æ‚¨å¯ä»¥åœ¨è¿™é‡Œæ‰¾åˆ°æŒ‡å—ï¼š[https://docs.aws.amazon.com/directoryservice/latest/admin-guide/step1\_setup\_networking.html](https://docs.aws.amazon.com/directoryservice/latest/admin-guide/step1\_setup\_networking.html)

### ~~å…±äº«ADï¼ˆä»æ”»å‡»è€…åˆ°å—å®³è€…ï¼‰~~

ä¼¼ä¹ä¸å¯èƒ½å°†AWSè®¿é—®æƒé™æˆäºˆæ¥è‡ªä¸åŒADç¯å¢ƒçš„ç”¨æˆ·åˆ°ä¸€ä¸ªAWSè´¦æˆ·ã€‚

## WorkDocs

Amazon Web Services (AWS) WorkDocsæ˜¯ä¸€ä¸ªåŸºäºäº‘çš„**æ–‡ä»¶å­˜å‚¨å’Œå…±äº«æœåŠ¡**ã€‚å®ƒæ˜¯AWSäº‘è®¡ç®—æœåŠ¡å¥—ä»¶çš„ä¸€éƒ¨åˆ†ï¼Œæ—¨åœ¨ä¸ºç»„ç»‡æä¾›ä¸€ä¸ªå®‰å…¨ä¸”å¯æ‰©å±•çš„è§£å†³æ–¹æ¡ˆï¼Œä»¥å­˜å‚¨ã€å…±äº«å’Œåä½œå¤„ç†æ–‡ä»¶å’Œæ–‡æ¡£ã€‚

AWS WorkDocsæä¾›äº†ä¸€ä¸ªåŸºäºWebçš„ç•Œé¢ï¼Œä¾›ç”¨æˆ·ä¸Šä¼ ã€è®¿é—®å’Œç®¡ç†å…¶æ–‡ä»¶å’Œæ–‡æ¡£ã€‚å®ƒè¿˜æä¾›ç‰ˆæœ¬æ§åˆ¶ã€å®æ—¶åä½œä»¥åŠä¸å…¶ä»–AWSæœåŠ¡å’Œç¬¬ä¸‰æ–¹å·¥å…·çš„é›†æˆç­‰åŠŸèƒ½ã€‚

### æšä¸¾

{% code overflow="wrap" %}
```bash
# Get AD users (Admin not included)
aws workdocs describe-users --organization-id <directory-id>
# Get AD groups (containing "a")
aws workdocs describe-groups --organization-id d-9067a0285c --search-query a

# Create user (created inside the AD)
aws workdocs create-user --username testingasd --given-name testingasd --surname testingasd --password <password> --email-address name@directory.domain --organization-id <directory-id>

# Get what each user has created
aws workdocs describe-activities --user-id "S-1-5-21-377..."

# Get what was created in the directory
aws workdocs describe-activities --organization-id <directory-id>

# Get folder content
aws workdocs describe-folder-contents --folder-id <fold-id>

# Get file (a url to access with the content will be retreived)
aws workdocs get-document --document-id <doc-id>

# Get resource permissions if any
aws workdocs describe-resource-permissions --resource-id <value>

# Add permission so anyway can see the file
aws workdocs add-resource-permissions --resource-id <id> --principals Id=anonymous,Type=ANONYMOUS,Role=VIEWER
## This will give an id, the file will be acesible in: https://<name>.awsapps.com/workdocs/index.html#/share/document/<id>
```
{% endcode %}

### æƒé™æå‡

{% content-ref url="../../aws-security/aws-privilege-escalation/aws-workdocs-privesc.md" %}
[aws-workdocs-privesc.md](../../aws-security/aws-privilege-escalation/aws-workdocs-privesc.md)
{% endcontent-ref %}

{% hint style="success" %}
å­¦ä¹ å’Œå®è·µ AWS é»‘å®¢æŠ€æœ¯ï¼š<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks åŸ¹è®­ AWS çº¢é˜Ÿä¸“å®¶ (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
å­¦ä¹ å’Œå®è·µ GCP é»‘å®¢æŠ€æœ¯ï¼š<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks åŸ¹è®­ GCP çº¢é˜Ÿä¸“å®¶ (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>æ”¯æŒ HackTricks</summary>

* æŸ¥çœ‹ [**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**Telegram ç¾¤ç»„**](https://t.me/peass) æˆ– **åœ¨ Twitter ä¸Šå…³æ³¨** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub ä»“åº“æäº¤ PR æ¥åˆ†äº«é»‘å®¢æŠ€å·§ã€‚

</details>
{% endhint %}
