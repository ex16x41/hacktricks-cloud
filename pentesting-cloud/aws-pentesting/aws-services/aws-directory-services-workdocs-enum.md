# AWS - Directory Services / WorkDocs Enum

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Directory Services

AWS Directory Service for Microsoft Active Directoryã¯ã€AWS Cloudã§ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’**è¨­å®šã€é‹ç”¨ã€ã‚¹ã‚±ãƒ¼ãƒ«**ã™ã‚‹ã®ã‚’ç°¡å˜ã«ã™ã‚‹ãƒãƒãƒ¼ã‚¸ãƒ‰ã‚µãƒ¼ãƒ“ã‚¹ã§ã™ã€‚ã“ã‚Œã¯å®Ÿéš›ã®**Microsoft Active Directory**ã«åŸºã¥ã„ã¦ãŠã‚Šã€ä»–ã®AWSã‚µãƒ¼ãƒ“ã‚¹ã¨å¯†æ¥ã«çµ±åˆã•ã‚Œã¦ã„ã‚‹ãŸã‚ã€ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªå¯¾å¿œã®ãƒ¯ãƒ¼ã‚¯ãƒ­ãƒ¼ãƒ‰ã‚„AWSãƒªã‚½ãƒ¼ã‚¹ã‚’ç°¡å˜ã«ç®¡ç†ã§ãã¾ã™ã€‚AWS Managed Microsoft ADã‚’ä½¿ç”¨ã™ã‚‹ã¨ã€æ—¢å­˜ã®Active Directoryãƒ¦ãƒ¼ã‚¶ãƒ¼ã€ã‚°ãƒ«ãƒ¼ãƒ—ã€ãŠã‚ˆã³ãƒãƒªã‚·ãƒ¼ã‚’ä½¿ç”¨ã—ã¦AWSãƒªã‚½ãƒ¼ã‚¹ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’ç®¡ç†ã§ãã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€ã‚¢ã‚¤ãƒ‡ãƒ³ãƒ†ã‚£ãƒ†ã‚£ç®¡ç†ãŒç°¡ç´ åŒ–ã•ã‚Œã€è¿½åŠ ã®ã‚¢ã‚¤ãƒ‡ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã®å¿…è¦æ€§ãŒæ¸›å°‘ã—ã¾ã™ã€‚AWS Managed Microsoft ADã¯ã€è‡ªå‹•ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã¨ç½å®³å¾©æ—§æ©Ÿèƒ½ã‚‚æä¾›ã—ã€ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®å¯ç”¨æ€§ã¨è€ä¹…æ€§ã‚’ç¢ºä¿ã—ã¾ã™ã€‚å…¨ä½“ã¨ã—ã¦ã€AWS Directory Service for Microsoft Active Directoryã¯ã€AWS Cloudã§ã®ãƒãƒãƒ¼ã‚¸ãƒ‰ã§é«˜å¯ç”¨æ€§ã‹ã¤ã‚¹ã‚±ãƒ¼ãƒ©ãƒ–ãƒ«ãªActive Directoryã‚µãƒ¼ãƒ“ã‚¹ã‚’æä¾›ã™ã‚‹ã“ã¨ã§ã€æ™‚é–“ã¨ãƒªã‚½ãƒ¼ã‚¹ã‚’ç¯€ç´„ã™ã‚‹ã®ã«å½¹ç«‹ã¡ã¾ã™ã€‚

### Options

Directory Servicesã§ã¯ã€5ç¨®é¡ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½œæˆã§ãã¾ã™ï¼š

* **AWS Managed Microsoft AD**: AWSã§æ–°ã—ã„**Microsoft AD**ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚ç®¡ç†è€…ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’è¨­å®šã—ã€VPCå†…ã®DCã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã™ã€‚
* **Simple AD**: **Linux-Samba** Active Directoryäº’æ›ã‚µãƒ¼ãƒãƒ¼ã§ã™ã€‚ç®¡ç†è€…ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’è¨­å®šã—ã€VPCå†…ã®DCã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã™ã€‚
* **AD Connector**: **æ—¢å­˜ã®Microsoft Active Directory**ã¸ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã™ã‚‹ãŸã‚ã®ãƒ—ãƒ­ã‚­ã‚·ã§ã€ã‚¯ãƒ©ã‚¦ãƒ‰ã«æƒ…å ±ã‚’ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã—ã¾ã›ã‚“ã€‚**VPC**å†…ã§ãƒªã‚¹ãƒ‹ãƒ³ã‚°ã—ã€**æ—¢å­˜ã®ADã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ãŸã‚ã®è³‡æ ¼æƒ…å ±ã‚’æä¾›ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™**ã€‚
* **Amazon Cognito User Pools**: ã“ã‚Œã¯Cognito User Poolsã¨åŒã˜ã§ã™ã€‚
* **Cloud Directory**: ã“ã‚Œã¯**æœ€ã‚‚ã‚·ãƒ³ãƒ—ãƒ«**ãªã‚‚ã®ã§ã™ã€‚**ã‚µãƒ¼ãƒãƒ¼ãƒ¬ã‚¹**ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã§ã€ä½¿ç”¨ã™ã‚‹**ã‚¹ã‚­ãƒ¼ãƒ**ã‚’æŒ‡å®šã—ã€**ä½¿ç”¨é‡ã«å¿œã˜ã¦è«‹æ±‚ã•ã‚Œã¾ã™**ã€‚

AWS Directory servicesã¯ã€æ—¢å­˜ã®**ã‚ªãƒ³ãƒ—ãƒ¬ãƒŸã‚¹** Microsoft ADã¨**åŒæœŸ**ã—ãŸã‚Šã€AWSã§è‡ªåˆ†è‡ªèº«ã®ã‚‚ã®ã‚’**å®Ÿè¡Œ**ã—ãŸã‚Šã€**ä»–ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚¿ã‚¤ãƒ—**ã¨åŒæœŸã—ãŸã‚Šã§ãã¾ã™ã€‚

### Lab

ã“ã“ã§ã¯ã€AWSã§è‡ªåˆ†ã®Microsoft ADã‚’ä½œæˆã™ã‚‹ãŸã‚ã®ç´ æ™´ã‚‰ã—ã„ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã‚’è¦‹ã¤ã‘ã‚‹ã“ã¨ãŒã§ãã¾ã™: [https://docs.aws.amazon.com/directoryservice/latest/admin-guide/ms\_ad\_tutorial\_test\_lab\_base.html](https://docs.aws.amazon.com/directoryservice/latest/admin-guide/ms\_ad\_tutorial\_test\_lab\_base.html)

### Enumeration
```bash
# Get directories and DCs
aws ds describe-directories
aws ds describe-domain-controllers --directory-id <id>
# Get directory settings
aws ds describe-trusts
aws ds describe-ldaps-settings --directory-id <id>
aws ds describe-shared-directories --owner-directory-id <id>
aws ds get-directory-limits
aws ds list-certificates --directory-id <id>
aws ds describe-certificate --directory-id <id> --certificate-id <id>
```
### ãƒ­ã‚°ã‚¤ãƒ³

ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®**èª¬æ˜**ã«**`AccessUrl`**ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«**ãƒ‰ãƒ¡ã‚¤ãƒ³**ãŒå«ã¾ã‚Œã¦ã„ã‚‹å ´åˆã€ãã‚Œã¯**ãƒ¦ãƒ¼ã‚¶ãƒ¼**ãŒã„ãã¤ã‹ã®**AWSã‚µãƒ¼ãƒ“ã‚¹**ã§**ADè³‡æ ¼æƒ…å ±**ã‚’ä½¿ç”¨ã—ã¦**ãƒ­ã‚°ã‚¤ãƒ³**ã§ãã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ãŸã‚ã§ã™ï¼š

* `<name>.awsapps.com/connect` (Amazon Connect)
* `<name>.awsapps.com/workdocs` (Amazon WorkDocs)
* `<name>.awsapps.com/workmail` (Amazon WorkMail)
* `<name>.awsapps.com/console` (Amazon Management Console)
* `<name>.awsapps.com/start` (IAM Identity Center)

### æ¨©é™æ˜‡æ ¼

{% content-ref url="../../aws-security/aws-privilege-escalation/aws-directory-services-privesc.md" %}
[aws-directory-services-privesc.md](../../aws-security/aws-privilege-escalation/aws-directory-services-privesc.md)
{% endcontent-ref %}

## æ°¸ç¶šæ€§

### ADãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ä½¿ç”¨ã™ã‚‹

**ADãƒ¦ãƒ¼ã‚¶ãƒ¼**ã¯ã€å¼•ãå—ã‘ã‚‹ãƒ­ãƒ¼ãƒ«ã‚’ä»‹ã—ã¦**AWSç®¡ç†ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹**ã‚’ä¸ãˆã‚‰ã‚Œã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚**ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ãƒ¦ãƒ¼ã‚¶ãƒ¼åã¯Admin**ã§ã€AWSã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‹ã‚‰**ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å¤‰æ›´**ã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚

ã—ãŸãŒã£ã¦ã€**Adminã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å¤‰æ›´**ã—ãŸã‚Šã€**æ–°ã—ã„ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ä½œæˆ**ã—ãŸã‚Šã€**ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å¤‰æ›´**ã—ã¦ã€ãã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ãƒ­ãƒ¼ãƒ«ã‚’ä»˜ä¸ã—ã¦ã‚¢ã‚¯ã‚»ã‚¹ã‚’ç¶­æŒã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚\
ã¾ãŸã€**ADå†…ã®ã‚°ãƒ«ãƒ¼ãƒ—ã«ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’è¿½åŠ **ã—ã€ãã®**ADã‚°ãƒ«ãƒ¼ãƒ—ã«ãƒ­ãƒ¼ãƒ«ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’ä¸ãˆã‚‹**ã“ã¨ã‚‚å¯èƒ½ã§ã™ï¼ˆã“ã®æ°¸ç¶šæ€§ã‚’ã‚ˆã‚Šã‚¹ãƒ†ãƒ«ã‚¹ã«ã™ã‚‹ãŸã‚ã«ï¼‰ã€‚

### ADã®å…±æœ‰ï¼ˆè¢«å®³è€…ã‹ã‚‰æ”»æ’ƒè€…ã¸ï¼‰

è¢«å®³è€…ã‹ã‚‰æ”»æ’ƒè€…ã«ADç’°å¢ƒã‚’å…±æœ‰ã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚ã“ã®æ–¹æ³•ã§ã€æ”»æ’ƒè€…ã¯ADç’°å¢ƒã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’ç¶™ç¶šã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚\
ãŸã ã—ã€ã“ã‚Œã¯ç®¡ç†ã•ã‚ŒãŸADã‚’å…±æœ‰ã—ã€VPCãƒ”ã‚¢ãƒªãƒ³ã‚°æ¥ç¶šã‚’ä½œæˆã™ã‚‹ã“ã¨ã‚’æ„å‘³ã—ã¾ã™ã€‚

ã‚¬ã‚¤ãƒ‰ã¯ã“ã¡ã‚‰ã«ã‚ã‚Šã¾ã™: [https://docs.aws.amazon.com/directoryservice/latest/admin-guide/step1\_setup\_networking.html](https://docs.aws.amazon.com/directoryservice/latest/admin-guide/step1\_setup\_networking.html)

### ~~ADã®å…±æœ‰ï¼ˆæ”»æ’ƒè€…ã‹ã‚‰è¢«å®³è€…ã¸ï¼‰~~

ç•°ãªã‚‹ADç’°å¢ƒã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«AWSã‚¢ã‚¯ã‚»ã‚¹ã‚’ä»˜ä¸ã™ã‚‹ã“ã¨ã¯ã€1ã¤ã®AWSã‚¢ã‚«ã‚¦ãƒ³ãƒˆã«å¯¾ã—ã¦ã¯ä¸å¯èƒ½ãªã‚ˆã†ã§ã™ã€‚

## WorkDocs

Amazon Web Services (AWS) WorkDocsã¯ã€ã‚¯ãƒ©ã‚¦ãƒ‰ãƒ™ãƒ¼ã‚¹ã®**ãƒ•ã‚¡ã‚¤ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ãŠã‚ˆã³å…±æœ‰ã‚µãƒ¼ãƒ“ã‚¹**ã§ã™ã€‚AWSã®ã‚¯ãƒ©ã‚¦ãƒ‰ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚µãƒ¼ãƒ“ã‚¹ã®ä¸€éƒ¨ã§ã‚ã‚Šã€çµ„ç¹”ãŒãƒ•ã‚¡ã‚¤ãƒ«ã‚„æ–‡æ›¸ã‚’å®‰å…¨ã«ä¿å­˜ã€å…±æœ‰ã€å…±åŒä½œæ¥­ã™ã‚‹ãŸã‚ã®ã‚¹ã‚±ãƒ¼ãƒ©ãƒ–ãƒ«ãªã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æä¾›ã™ã‚‹ã‚ˆã†ã«è¨­è¨ˆã•ã‚Œã¦ã„ã¾ã™ã€‚

AWS WorkDocsã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒãƒ•ã‚¡ã‚¤ãƒ«ã‚„æ–‡æ›¸ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã€ã‚¢ã‚¯ã‚»ã‚¹ã€ç®¡ç†ã™ã‚‹ãŸã‚ã®ã‚¦ã‚§ãƒ–ãƒ™ãƒ¼ã‚¹ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’æä¾›ã—ã¾ã™ã€‚ã¾ãŸã€ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†ã€ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã‚³ãƒ©ãƒœãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã€ä»–ã®AWSã‚µãƒ¼ãƒ“ã‚¹ã‚„ã‚µãƒ¼ãƒ‰ãƒ‘ãƒ¼ãƒ†ã‚£ãƒ„ãƒ¼ãƒ«ã¨ã®çµ±åˆãªã©ã®æ©Ÿèƒ½ã‚‚æä¾›ã—ã¦ã„ã¾ã™ã€‚

### åˆ—æŒ™

{% code overflow="wrap" %}
```bash
# Get AD users (Admin not included)
aws workdocs describe-users --organization-id <directory-id>
# Get AD groups (containing "a")
aws workdocs describe-groups --organization-id d-9067a0285c --search-query a

# Create user (created inside the AD)
aws workdocs create-user --username testingasd --given-name testingasd --surname testingasd --password <password> --email-address name@directory.domain --organization-id <directory-id>

# Get what each user has created
aws workdocs describe-activities --user-id "S-1-5-21-377..."

# Get what was created in the directory
aws workdocs describe-activities --organization-id <directory-id>

# Get folder content
aws workdocs describe-folder-contents --folder-id <fold-id>

# Get file (a url to access with the content will be retreived)
aws workdocs get-document --document-id <doc-id>

# Get resource permissions if any
aws workdocs describe-resource-permissions --resource-id <value>

# Add permission so anyway can see the file
aws workdocs add-resource-permissions --resource-id <id> --principals Id=anonymous,Type=ANONYMOUS,Role=VIEWER
## This will give an id, the file will be acesible in: https://<name>.awsapps.com/workdocs/index.html#/share/document/<id>
```
{% endcode %}

### ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆã‚¨ã‚¹ã‚«ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³

{% content-ref url="../../aws-security/aws-privilege-escalation/aws-workdocs-privesc.md" %}
[aws-workdocs-privesc.md](../../aws-security/aws-privilege-escalation/aws-workdocs-privesc.md)
{% endcontent-ref %}

{% hint style="success" %}
AWSãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã³ã€å®Ÿè·µã™ã‚‹ï¼š<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCPãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã³ã€å®Ÿè·µã™ã‚‹ï¼š<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricksã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹</summary>

* [**ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³**](https://github.com/sponsors/carlospolop)ã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼
* **ğŸ’¬ [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã¾ãŸã¯[**Telegramã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«å‚åŠ ã™ã‚‹ã‹ã€**Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**ã‚’ãƒ•ã‚©ãƒ­ãƒ¼ã—ã¦ãã ã•ã„ã€‚**
* **[**HackTricks**](https://github.com/carlospolop/hacktricks)ãŠã‚ˆã³[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)ã®GitHubãƒªãƒã‚¸ãƒˆãƒªã«PRã‚’æå‡ºã—ã¦ãƒãƒƒã‚­ãƒ³ã‚°ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã—ã¦ãã ã•ã„ã€‚**

</details>
{% endhint %}
