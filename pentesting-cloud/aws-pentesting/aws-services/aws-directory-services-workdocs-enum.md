# AWS - Directory Services / WorkDocs Enum

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** 💬 [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Directory Services

AWS Directory Service for Microsoft Active Directory, AWS Bulutunda bir dizin **kurmayı, işletmeyi ve ölçeklendirmeyi** kolaylaştıran yönetilen bir hizmettir. Gerçek **Microsoft Active Directory** üzerine inşa edilmiştir ve diğer AWS hizmetleriyle sıkı bir şekilde entegre edilmiştir, bu da dizin bilincine sahip iş yüklerinizi ve AWS kaynaklarınızı yönetmeyi kolaylaştırır. AWS Managed Microsoft AD ile mevcut Active Directory kullanıcılarınızı, gruplarınızı ve politikalarınızı kullanarak AWS kaynaklarınıza erişimi yönetebilirsiniz. Bu, kimlik yönetiminizi basitleştirmeye ve ek kimlik çözümlerine olan ihtiyacı azaltmaya yardımcı olabilir. AWS Managed Microsoft AD ayrıca otomatik yedeklemeler ve felaket kurtarma yetenekleri sağlar, bu da dizininizin kullanılabilirliğini ve dayanıklılığını sağlamaya yardımcı olur. Genel olarak, AWS Directory Service for Microsoft Active Directory, AWS Bulutunda yönetilen, yüksek kullanılabilirlikte ve ölçeklenebilir bir Active Directory hizmeti sunarak zaman ve kaynak tasarrufu yapmanıza yardımcı olabilir.

### Options

Directory Services, 5 tür dizin oluşturmanıza olanak tanır:

* **AWS Managed Microsoft AD**: AWS'de yeni bir **Microsoft AD** çalıştıracaktır. Yönetici parolasını ayarlayabilecek ve bir VPC'deki DC'lere erişebileceksiniz.
* **Simple AD**: **Linux-Samba** Active Directory uyumlu bir sunucu olacaktır. Yönetici parolasını ayarlayabilecek ve bir VPC'deki DC'lere erişebileceksiniz.
* **AD Connector**: Mevcut Microsoft Active Directory'nize dizin isteklerini yönlendiren bir proxy'dir ve bulutta herhangi bir bilgi önbelleğe almaz. Bir **VPC**'de dinleyecek ve mevcut AD'ye erişim için **kimlik bilgileri** vermeniz gerekecek.
* **Amazon Cognito User Pools**: Bu, Cognito User Pools ile aynıdır.
* **Cloud Directory**: Bu, **en basit** olanıdır. Kullanacağınız **şemayı** belirttiğiniz ve **kullanıma göre faturalandırıldığınız** bir **sunucusuz** dizindir.

AWS Directory services, mevcut **yerel** Microsoft AD'nizle **senkronize** olmanıza, AWS'de kendi dizininizi **çalıştırmanıza** veya **diğer dizin türleriyle** senkronize olmanıza olanak tanır.

### Lab

AWS'de kendi Microsoft AD'nizi oluşturmak için güzel bir öğretici bulabilirsiniz: [https://docs.aws.amazon.com/directoryservice/latest/admin-guide/ms\_ad\_tutorial\_test\_lab\_base.html](https://docs.aws.amazon.com/directoryservice/latest/admin-guide/ms\_ad\_tutorial\_test\_lab\_base.html)

### Enumeration
```bash
# Get directories and DCs
aws ds describe-directories
aws ds describe-domain-controllers --directory-id <id>
# Get directory settings
aws ds describe-trusts
aws ds describe-ldaps-settings --directory-id <id>
aws ds describe-shared-directories --owner-directory-id <id>
aws ds get-directory-limits
aws ds list-certificates --directory-id <id>
aws ds describe-certificate --directory-id <id> --certificate-id <id>
```
### Giriş

Dizin tanımında **`AccessUrl`** alanında bir **alan adı** varsa, bu, bir **kullanıcının** muhtemelen bazı **AWS hizmetlerinde** **AD kimlik bilgileri** ile **giriş yapabileceği** anlamına gelir:

* `<name>.awsapps.com/connect` (Amazon Connect)
* `<name>.awsapps.com/workdocs` (Amazon WorkDocs)
* `<name>.awsapps.com/workmail` (Amazon WorkMail)
* `<name>.awsapps.com/console` (Amazon Yönetim Konsolu)
* `<name>.awsapps.com/start` (IAM Kimlik Merkezi)

### Yetki Yükseltme

{% content-ref url="../../aws-security/aws-privilege-escalation/aws-directory-services-privesc.md" %}
[aws-directory-services-privesc.md](../../aws-security/aws-privilege-escalation/aws-directory-services-privesc.md)
{% endcontent-ref %}

## Süreklilik

### Bir AD kullanıcısı kullanarak

Bir **AD kullanıcısına** **AWS yönetim konsoluna erişim** sağlamak için bir Rol verilebilir. **Varsayılan kullanıcı adı Admin**'dir ve **şifresini** AWS konsolundan **değiştirmek** mümkündür.

Bu nedenle, **Admin'in şifresini değiştirmek**, **yeni bir kullanıcı oluşturmak** veya bir kullanıcının **şifresini değiştirmek** ve o kullanıcıya erişimi sürdürmek için bir Rol vermek mümkündür.\
Ayrıca, **AD içinde bir kullanıcıyı bir gruba eklemek** ve **o AD grubuna bir Role erişim vermek** de mümkündür (bu sürekliliği daha gizli hale getirmek için).

### AD'yi paylaşma (kurbanından saldırgana)

Bir AD ortamını bir kurbandan bir saldırgana paylaşmak mümkündür. Bu şekilde saldırgan, AD ortamına erişmeye devam edebilecektir.\
Ancak, bu, yönetilen AD'yi paylaşmayı ve ayrıca bir VPC peering bağlantısı oluşturmayı gerektirir.

Burada bir kılavuz bulabilirsiniz: [https://docs.aws.amazon.com/directoryservice/latest/admin-guide/step1\_setup\_networking.html](https://docs.aws.amazon.com/directoryservice/latest/admin-guide/step1\_setup\_networking.html)

### ~~AD'yi paylaşma (saldırgandan kurbanına)~~

Farklı bir AD ortamındaki kullanıcılara bir AWS hesabına erişim vermenin mümkün olmadığı görünmektedir.

## WorkDocs

Amazon Web Services (AWS) WorkDocs, bulut tabanlı bir **dosya depolama ve paylaşım hizmetidir**. AWS'nin bulut bilişim hizmetleri paketinin bir parçasıdır ve organizasyonların dosyaları ve belgeleri depolamak, paylaşmak ve üzerinde işbirliği yapmak için güvenli ve ölçeklenebilir bir çözüm sunmak üzere tasarlanmıştır.

AWS WorkDocs, kullanıcıların dosyalarını ve belgelerini yüklemeleri, erişmeleri ve yönetmeleri için web tabanlı bir arayüz sağlar. Ayrıca sürüm kontrolü, gerçek zamanlı işbirliği ve diğer AWS hizmetleri ve üçüncü taraf araçlarla entegrasyon gibi özellikler sunar.

### Sayım

{% code overflow="wrap" %}
```bash
# Get AD users (Admin not included)
aws workdocs describe-users --organization-id <directory-id>
# Get AD groups (containing "a")
aws workdocs describe-groups --organization-id d-9067a0285c --search-query a

# Create user (created inside the AD)
aws workdocs create-user --username testingasd --given-name testingasd --surname testingasd --password <password> --email-address name@directory.domain --organization-id <directory-id>

# Get what each user has created
aws workdocs describe-activities --user-id "S-1-5-21-377..."

# Get what was created in the directory
aws workdocs describe-activities --organization-id <directory-id>

# Get folder content
aws workdocs describe-folder-contents --folder-id <fold-id>

# Get file (a url to access with the content will be retreived)
aws workdocs get-document --document-id <doc-id>

# Get resource permissions if any
aws workdocs describe-resource-permissions --resource-id <value>

# Add permission so anyway can see the file
aws workdocs add-resource-permissions --resource-id <id> --principals Id=anonymous,Type=ANONYMOUS,Role=VIEWER
## This will give an id, the file will be acesible in: https://<name>.awsapps.com/workdocs/index.html#/share/document/<id>
```
{% endcode %}

### Privesc

{% content-ref url="../../aws-security/aws-privilege-escalation/aws-workdocs-privesc.md" %}
[aws-workdocs-privesc.md](../../aws-security/aws-privilege-escalation/aws-workdocs-privesc.md)
{% endcontent-ref %}

{% hint style="success" %}
AWS Hacking'i öğrenin ve pratik yapın:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Eğitim AWS Kırmızı Ekip Uzmanı (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCP Hacking'i öğrenin ve pratik yapın: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Eğitim GCP Kırmızı Ekip Uzmanı (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**abonelik planlarını**](https://github.com/sponsors/carlospolop) kontrol edin!
* **💬 [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katılın ya da **Twitter'da** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**'i takip edin.**
* **Hacking ipuçlarını paylaşmak için** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna PR gönderin.

</details>
{% endhint %}
