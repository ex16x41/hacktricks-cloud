# AWS - S3, Athena & Glacier Enum

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## S3

Amazon S3 - —Ü–µ —Å–µ—Ä–≤—ñ—Å, —è–∫–∏–π –¥–æ–∑–≤–æ–ª—è—î –≤–∞–º **–∑–±–µ—Ä—ñ–≥–∞—Ç–∏ –≤–µ–ª–∏–∫—ñ –æ–±—Å—è–≥–∏ –¥–∞–Ω–∏—Ö**.

Amazon S3 –Ω–∞–¥–∞—î –∫—ñ–ª—å–∫–∞ –≤–∞—Ä—ñ–∞–Ω—Ç—ñ–≤ –¥–ª—è –¥–æ—Å—è–≥–Ω–µ–Ω–Ω—è **–∑–∞—Ö–∏—Å—Ç—É** –¥–∞–Ω–∏—Ö —É —Å–ø–æ–∫–æ—ó. –í–∞—Ä—ñ–∞–Ω—Ç–∏ –≤–∫–ª—é—á–∞—é—Ç—å **–¥–æ–∑–≤–æ–ª–∏** (–ø–æ–ª—ñ—Ç–∏–∫–∞), **—à–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è** (–∫–ª—ñ—î–Ω—Ç—Å—å–∫–µ —Ç–∞ —Å–µ—Ä–≤–µ—Ä–Ω–µ), **–≤–µ—Ä—Å—ñ—é–≤–∞–Ω–Ω—è –±–∞–∫–µ—Ç—ñ–≤** —Ç–∞ **–≤–∏–¥–∞–ª–µ–Ω–Ω—è –Ω–∞ –æ—Å–Ω–æ–≤—ñ MFA**. **–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –º–æ–∂–µ –∞–∫—Ç–∏–≤—É–≤–∞—Ç–∏** –±—É–¥—å-—è–∫–∏–π –∑ —Ü–∏—Ö –≤–∞—Ä—ñ–∞–Ω—Ç—ñ–≤ –¥–ª—è –¥–æ—Å—è–≥–Ω–µ–Ω–Ω—è –∑–∞—Ö–∏—Å—Ç—É –¥–∞–Ω–∏—Ö. **–†–µ–ø–ª—ñ–∫–∞—Ü—ñ—è –¥–∞–Ω–∏—Ö** - —Ü–µ –≤–Ω—É—Ç—Ä—ñ—à–Ω—è —Ñ—É–Ω–∫—Ü—ñ—è AWS, –¥–µ **S3 –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ —Ä–µ–ø–ª—ñ–∫—É—î –∫–æ–∂–µ–Ω –æ–±'—î–∫—Ç –ø–æ –≤—Å—ñ—Ö –∑–æ–Ω–∞—Ö –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—ñ**, —ñ –æ—Ä–≥–∞–Ω—ñ–∑–∞—Ü—ñ—ó –Ω–µ –ø–æ—Ç—Ä—ñ–±–Ω–æ –∞–∫—Ç–∏–≤—É–≤–∞—Ç–∏ —Ü–µ –≤ —Ü—å–æ–º—É –≤–∏–ø–∞–¥–∫—É.

–ó –¥–æ–∑–≤–æ–ª–∞–º–∏ –Ω–∞ –æ—Å–Ω–æ–≤—ñ —Ä–µ—Å—É—Ä—Å—ñ–≤ –≤–∏ –º–æ–∂–µ—Ç–µ –≤–∏–∑–Ω–∞—á–∏—Ç–∏ –¥–æ–∑–≤–æ–ª–∏ –¥–ª—è –ø—ñ–¥–∫–∞—Ç–∞–ª–æ–≥—ñ–≤ –≤–∞—à–æ–≥–æ –±–∞–∫–µ—Ç—É –æ–∫—Ä–µ–º–æ.

### –í–µ—Ä—Å—ñ—è –±–∞–∫–µ—Ç—É —Ç–∞ –≤–∏–¥–∞–ª–µ–Ω–Ω—è –Ω–∞ –æ—Å–Ω–æ–≤—ñ MFA

–ö–æ–ª–∏ –≤–µ—Ä—Å—ñ—è –±–∞–∫–µ—Ç—É –∞–∫—Ç–∏–≤–æ–≤–∞–Ω–∞, –±—É–¥—å-—è–∫–∞ –¥—ñ—è, —è–∫–∞ –Ω–∞–º–∞–≥–∞—î—Ç—å—Å—è –∑–º—ñ–Ω–∏—Ç–∏ —Ñ–∞–π–ª –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ —Ñ–∞–π–ª—É, —Å—Ç–≤–æ—Ä–∏—Ç—å –Ω–æ–≤—É –≤–µ—Ä—Å—ñ—é —Ñ–∞–π–ª—É, –∑–±–µ—Ä—ñ–≥–∞—é—á–∏ —Ç–∞–∫–æ–∂ –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ–π –≤–º—ñ—Å—Ç —Ç–æ–≥–æ –∂ —Ñ–∞–π–ª—É. –¢–∞–∫–∏–º —á–∏–Ω–æ–º, –≤—ñ–Ω –Ω–µ –ø–µ—Ä–µ–∑–∞–ø–∏—à–µ —Å–≤—ñ–π –≤–º—ñ—Å—Ç.

–ë—ñ–ª—å—à–µ —Ç–æ–≥–æ, –≤–∏–¥–∞–ª–µ–Ω–Ω—è –Ω–∞ –æ—Å–Ω–æ–≤—ñ MFA –∑–∞–ø–æ–±—ñ–≥–∞—Ç–∏–º–µ –≤–∏–¥–∞–ª–µ–Ω–Ω—é –≤–µ—Ä—Å—ñ–π —Ñ–∞–π–ª—ñ–≤ —É –±–∞–∫–µ—Ç—ñ S3, –∞ —Ç–∞–∫–æ–∂ –≤—ñ–¥–∫–ª—é—á–µ–Ω–Ω—é –≤–µ—Ä—Å—ñ—ó –±–∞–∫–µ—Ç—É, —Ç–æ–º—É –∑–ª–æ–≤–º–∏—Å–Ω–∏–∫ –Ω–µ –∑–º–æ–∂–µ –∑–º—ñ–Ω–∏—Ç–∏ —Ü—ñ —Ñ–∞–π–ª–∏.

–û–¥–Ω–∞–∫ –ø–æ—Ç–µ–Ω—Ü—ñ–π–Ω–∏–π —Ä–∏–∑–∏–∫ –≤–∏–Ω–∏–∫–∞—î, —è–∫—â–æ —Ä–æ–∑—Ä–æ–±–Ω–∏–∫–∏ –∑–∞–ª–∏—à–∞—é—Ç—å —á—É—Ç–ª–∏–≤—É —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é, —Ç–∞–∫—É —è–∫ –∫–ª—é—á—ñ API, –æ–±–ª—ñ–∫–æ–≤—ñ –¥–∞–Ω—ñ –∞–±–æ —Å—Ç–∞—Ä—ñ –∫—ñ–Ω—Ü–µ–≤—ñ —Ç–æ—á–∫–∏ API –≤ –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ—Ö –≤–µ—Ä—Å—ñ—è—Ö —Ñ–∞–π–ª—ñ–≤. –ó–ª–æ–≤–º–∏—Å–Ω–∏–∫–∏ –∞–±–æ –Ω–µ—Å–∞–Ω–∫—Ü—ñ–æ–Ω–æ–≤–∞–Ω—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ, —è–∫—ñ –æ—Ç—Ä–∏–º—É—é—Ç—å –¥–æ—Å—Ç—É–ø –¥–æ —Ü–∏—Ö —Å—Ç–∞—Ä–∏—Ö –≤–µ—Ä—Å—ñ–π, –º–æ–∂—É—Ç—å –µ–∫—Å–ø–ª—É–∞—Ç—É–≤–∞—Ç–∏ —Ü—é —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é, —è–∫—â–æ –¥–æ–∑–≤–æ–ª–∏ –Ω–∞ –±–∞–∫–µ—Ç –∞–±–æ –æ–±'—î–∫—Ç–∏ –Ω–µ –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω—ñ –Ω–∞–ª–µ–∂–Ω–∏–º —á–∏–Ω–æ–º.

–©–æ–± –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏, —á–∏ –±–∞–∫–µ—Ç –¥–æ–∑–≤–æ–ª—è—î –≤–µ—Ä—Å—ñ–π–Ω—ñ—Å—Ç—å, –≤–∏ –º–æ–∂–µ—Ç–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ —Ü—é –∫–æ–º–∞–Ω–¥—É:
```bash
aws s3api get-bucket-versioning --bucket <bucket_name>
```
–ú–æ–∂–ª–∏–≤–∏–π –≤–∏—Ö—ñ–¥ –≤–∏–≥–ª—è–¥–∞—î —Ç–∞–∫:
```json
{
"Status": "Enabled"
}
```
**–ü—Ä–∏–º—ñ—Ç–∫–∞: –í–∏ –ø–æ–≤–∏–Ω–Ω—ñ –±—É—Ç–∏ –≤–ª–∞—Å–Ω–∏–∫–æ–º –±–∞–∫–µ—Ç—É, —â–æ–± –æ—Ç—Ä–∏–º–∞—Ç–∏ —Å—Ç–∞—Ç—É—Å –≤–µ—Ä—Å—ñ–π –±–∞–∫–µ—Ç—É.**

–©–æ–± –ø–æ–±–∞—á–∏—Ç–∏ –≤—Å—ñ –≤–µ—Ä—Å—ñ—ó –æ–±'—î–∫—Ç—ñ–≤, —Å–ø—Ä–æ–±—É–π—Ç–µ:

> –©–æ–± –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ —Ü—é –æ–ø–µ—Ä–∞—Ü—ñ—é, –≤–∏ –ø–æ–≤–∏–Ω–Ω—ñ –º–∞—Ç–∏ –¥–æ–∑–≤—ñ–ª –Ω–∞ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –¥—ñ—ó s3:ListBucketVersions. –ó–≤–µ—Ä–Ω—ñ—Ç—å —É–≤–∞–≥—É –Ω–∞ —Ä—ñ–∑–Ω–∏—Ü—é –≤ –Ω–∞–∑–≤–∞—Ö.
```bash
# try to remove --no-sign-request if you are authenticated
aws --no-sign-request s3api list-object-versions --bucket <bucket_name>
# redirect output into a file
aws --no-sign-request s3api list-object-versions --bucket <bucket_name> > versions.json
```
–©–æ–± –æ—Ç—Ä–∏–º–∞—Ç–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É –≤–µ—Ä—Å—ñ—é –æ–±'—î–∫—Ç–∞, —Å–ø—Ä–æ–±—É–π—Ç–µ:
```bash
aws --no-sign-request s3api get-object --bucket <bucket_name> --key <object_key> --version-id <object_VersionId> <output_filename>
```
### S3 Access logs

–ú–æ–∂–Ω–∞ **—É–≤—ñ–º–∫–Ω—É—Ç–∏ –∂—É—Ä–Ω–∞–ª–∏ –¥–æ—Å—Ç—É–ø—É S3** (—è–∫—ñ –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º –≤–∏–º–∫–Ω–µ–Ω—ñ) –¥–ª—è –ø–µ–≤–Ω–æ–≥–æ –±–∞–∫–µ—Ç—É —Ç–∞ –∑–±–µ—Ä—ñ–≥–∞—Ç–∏ –∂—É—Ä–Ω–∞–ª–∏ –≤ —ñ–Ω—à–æ–º—É –±–∞–∫–µ—Ç—ñ, —â–æ–± –¥—ñ–∑–Ω–∞—Ç–∏—Å—è, —Ö—Ç–æ –æ—Ç—Ä–∏–º—É—î –¥–æ—Å—Ç—É–ø –¥–æ –±–∞–∫–µ—Ç—É (–æ–±–∏–¥–≤–∞ –±–∞–∫–µ—Ç–∏ –ø–æ–≤–∏–Ω–Ω—ñ –±—É—Ç–∏ –≤ –æ–¥–Ω–æ–º—É —Ä–µ–≥—ñ–æ–Ω—ñ).

### S3 Presigned URLs

–ú–æ–∂–Ω–∞ –∑–≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏ –ø–æ–ø–µ—Ä–µ–¥–Ω—å–æ –ø—ñ–¥–ø–∏—Å–∞–Ω–µ URL, —è–∫–∏–π –∑–∞–∑–≤–∏—á–∞–π –º–æ–∂–Ω–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –¥–ª—è **–¥–æ—Å—Ç—É–ø—É –¥–æ –≤–∫–∞–∑–∞–Ω–æ–≥–æ —Ñ–∞–π–ª—É** –≤ –±–∞–∫–µ—Ç—ñ. **–ü–æ–ø–µ—Ä–µ–¥–Ω—å–æ –ø—ñ–¥–ø–∏—Å–∞–Ω–µ URL –≤–∏–≥–ª—è–¥–∞—î —Ç–∞–∫**:
```
https://<bucket-name>.s3.us-east-1.amazonaws.com/asd.txt?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=ASIAUUE8GZC4S5L3TY3P%2F20230227%2Fus-east-1%2Fs3%2Faws4_request&X-Amz-Date=20230227T142551Z&X-Amz-Expires=3600&X-Amz-SignedHeaders=host&X-Amz-Security-Token=IQoJb3JpZ2luX2VjELf%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLWVhc3QtMSJHMEUCIBhQpdETJO3HKKDk2hjNIrPWwBE8gZaQccZFV3kCpPCWAiEAid3ueDtFFU%2FOQfUpvxYTGO%2BHoS4SWDMUrQAE0pIaB40qggMIYBAAGgwzMTgxNDIxMzg1NTMiDJLI5t7gr2EGxG1Y5CrfAioW0foHIQ074y4gvk0c%2B%2Fmqc7cNWb1njQslQkeePHkseJ3owzc%2FCwkgE0EuZTd4mw0aJciA2XIbJRCLPWTb%2FCBKPnIMJ5aBzIiA2ltsiUNQTTUxYmEgXZoJ6rFYgcodnmWW0Et4Xw59UlHnCDB2bLImxPprriyCzDDCD6nLyp3J8pFF1S8h3ZTJE7XguA8joMs4%2B2B1%2FeOZfuxXKyXPYSKQOOSbQiHUQc%2BFnOfwxleRL16prWk1t7TamvHR%2Bt3UgMn5QWzB3p8FgWwpJ6GjHLkYMJZ379tkimL1tJ7o%2BIod%2FMYrS7LDCifP9d%2FuYOhKWGhaakPuJKJh9fl%2B0vGl7kmApXigROxEWon6ms75laXebltsWwKcKuYca%2BUWu4jVJx%2BWUfI4ofoaGiCSaKALTqwu4QNBRT%2BMoK6h%2BQa7gN7JFGg322lkxRY53x27WMbUE4unn5EmI54T4dWt1%2Bg8ljDS%2BvKfBjqmAWRwuqyfwXa5YC3xxttOr3YVvR6%2BaXpzWtvNJQNnb6v0uI3%2BTtTexZkJpLQYqFcgZLQSxsXWSnf988qvASCIUhAzp2UnS1uqy7QjtD5T73zksYN2aesll7rvB80qIuujG6NOdHnRJ2M5%2FKXXNo1Yd15MtzPuSjRoSB9RSMon5jFu31OrQnA9eCUoawxbB0nHqwK8a43CKBZHhA8RoUAJW%2B48EuFsp3U%3D&X-Amz-Signature=3436e4139e84dbcf5e2e6086c0ebc92f4e1e9332b6fda24697bc339acbf2cdfa
```
URL –∑ –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ–º –ø—ñ–¥–ø–∏—Å–æ–º –º–æ–∂–µ –±—É—Ç–∏ **—Å—Ç–≤–æ—Ä–µ–Ω–æ –∑ cli, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ –æ–±–ª—ñ–∫–æ–≤—ñ –¥–∞–Ω—ñ —Å—É–±'—î–∫—Ç–∞, —è–∫–∏–π –º–∞—î –¥–æ—Å—Ç—É–ø –¥–æ –æ–±'—î–∫—Ç–∞** (—è–∫—â–æ –æ–±–ª—ñ–∫–æ–≤–∏–π –∑–∞–ø–∏—Å, —è–∫–∏–π –≤–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç–µ, –Ω–µ –º–∞—î –¥–æ—Å—Ç—É–ø—É, –±—É–¥–µ —Å—Ç–≤–æ—Ä–µ–Ω–æ –∫–æ—Ä–æ—Ç—à–∏–π URL –∑ –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ–º –ø—ñ–¥–ø–∏—Å–æ–º, –∞–ª–µ –≤—ñ–Ω –±—É–¥–µ –º–∞—Ä–Ω–∏–º)
```bash
aws s3 presign --region <bucket-region> 's3://<bucket-name>/<file-name>'
```
{% hint style="info" %}
–Ñ–¥–∏–Ω–æ—é –Ω–µ–æ–±—Ö—ñ–¥–Ω–æ—é –¥–æ–∑–≤–æ–ª–æ–º –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó –ø–æ–ø–µ—Ä–µ–¥–Ω—å–æ –ø—ñ–¥–ø–∏—Å–∞–Ω–æ–≥–æ URL —î –Ω–∞–¥–∞–Ω–∏–π –¥–æ–∑–≤—ñ–ª, —Ç–æ–º—É –¥–ª—è –ø–æ–ø–µ—Ä–µ–¥–Ω—å–æ—ó –∫–æ–º–∞–Ω–¥–∏ —î–¥–∏–Ω–∏–º –¥–æ–∑–≤–æ–ª–æ–º, –Ω–µ–æ–±—Ö—ñ–¥–Ω–∏–º –¥–ª—è —Å—É–±'—î–∫—Ç–∞, —î `s3:GetObject`
{% endhint %}

–¢–∞–∫–æ–∂ –º–æ–∂–ª–∏–≤–æ —Å—Ç–≤–æ—Ä—é–≤–∞—Ç–∏ –ø–æ–ø–µ—Ä–µ–¥–Ω—å–æ –ø—ñ–¥–ø–∏—Å–∞–Ω—ñ URL –∑ **—ñ–Ω—à–∏–º–∏ –¥–æ–∑–≤–æ–ª–∞–º–∏**:
```python
import boto3
url = boto3.client('s3').generate_presigned_url(
ClientMethod='put_object',
Params={'Bucket': 'BUCKET_NAME', 'Key': 'OBJECT_KEY'},
ExpiresIn=3600
)
```
### S3 Encryption Mechanisms

**DEK –æ–∑–Ω–∞—á–∞—î –ö–ª—é—á –®–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è –î–∞–Ω–∏—Ö** —ñ —î –∫–ª—é—á–µ–º, —è–∫–∏–π –∑–∞–≤–∂–¥–∏ –≥–µ–Ω–µ—Ä—É—î—Ç—å—Å—è —Ç–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –¥–ª—è —à–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è –¥–∞–Ω–∏—Ö.

<details>

<summary><strong>–®–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è –Ω–∞ —Å—Ç–æ—Ä–æ–Ω—ñ —Å–µ—Ä–≤–µ—Ä–∞ –∑ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è–º –∫–ª—é—á—ñ–≤, –∫–µ—Ä–æ–≤–∞–Ω–∏—Ö S3, SSE-S3</strong></summary>

–¶–µ–π –≤–∞—Ä—ñ–∞–Ω—Ç –≤–∏–º–∞–≥–∞—î –º—ñ–Ω—ñ–º–∞–ª—å–Ω–æ—ó –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó, —ñ –≤—Å–µ —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –∫–ª—é—á–∞–º–∏ —à–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è –∑–¥—ñ–π—Å–Ω—é—î—Ç—å—Å—è AWS. –í—Å–µ, —â–æ –≤–∞–º –ø–æ—Ç—Ä—ñ–±–Ω–æ –∑—Ä–æ–±–∏—Ç–∏, —Ü–µ **–∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ —Å–≤–æ—ó –¥–∞–Ω—ñ, —ñ S3 –≤–ø–æ—Ä–∞—î—Ç—å—Å—è –∑ —É—Å—ñ–º–∞ —ñ–Ω—à–∏–º–∏ –∞—Å–ø–µ–∫—Ç–∞–º–∏**. –ö–æ–∂–Ω–æ–º—É –±–∞–∫–µ—Ç—É –≤ –æ–±–ª—ñ–∫–æ–≤–æ–º—É –∑–∞–ø–∏—Å—ñ S3 –ø—Ä–∏–∑–Ω–∞—á–∞—î—Ç—å—Å—è –∫–ª—é—á –±–∞–∫–µ—Ç—É.

* –®–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è:
* –î–∞–Ω—ñ –æ–±'—î–∫—Ç–∞ + —Å—Ç–≤–æ—Ä–µ–Ω–∏–π –≤—ñ–¥–∫—Ä–∏—Ç–∏–π DEK --> –ó–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω—ñ –¥–∞–Ω—ñ (–∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è –≤ S3)
* –°—Ç–≤–æ—Ä–µ–Ω–∏–π –≤—ñ–¥–∫—Ä–∏—Ç–∏–π DEK + –ú–∞–π—Å—Ç–µ—Ä-–∫–ª—é—á S3 --> –ó–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–π DEK (–∑–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è –≤ S3) —ñ –≤—ñ–¥–∫—Ä–∏—Ç–∏–π —Ç–µ–∫—Å—Ç –≤–∏–¥–∞–ª—è—î—Ç—å—Å—è –∑ –ø–∞–º'—è—Ç—ñ
* –†–æ–∑—à–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è:
* –ó–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–π DEK + –ú–∞–π—Å—Ç–µ—Ä-–∫–ª—é—á S3 --> –í—ñ–¥–∫—Ä–∏—Ç–∏–π DEK
* –í—ñ–¥–∫—Ä–∏—Ç–∏–π DEK + –ó–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω—ñ –¥–∞–Ω—ñ --> –î–∞–Ω—ñ –æ–±'—î–∫—Ç–∞

–ó–≤–µ—Ä–Ω—ñ—Ç—å —É–≤–∞–≥—É, —â–æ –≤ —Ü—å–æ–º—É –≤–∏–ø–∞–¥–∫—É **–∫–ª—é—á —É–ø—Ä–∞–≤–ª—è—î—Ç—å—Å—è AWS** (–æ–±–µ—Ä—Ç–∞–Ω–Ω—è –ª–∏—à–µ –∫–æ–∂–Ω—ñ 3 —Ä–æ–∫–∏). –Ø–∫—â–æ –≤–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç–µ —Å–≤—ñ–π –≤–ª–∞—Å–Ω–∏–π –∫–ª—é—á, –≤–∏ –∑–º–æ–∂–µ—Ç–µ –æ–±–µ—Ä—Ç–∞—Ç–∏, –≤—ñ–¥–∫–ª—é—á–∞—Ç–∏ —Ç–∞ –∑–∞—Å—Ç–æ—Å–æ–≤—É–≤–∞—Ç–∏ –∫–æ–Ω—Ç—Ä–æ–ª—å –¥–æ—Å—Ç—É–ø—É.

</details>

<details>

<summary><strong>–®–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è –Ω–∞ —Å—Ç–æ—Ä–æ–Ω—ñ —Å–µ—Ä–≤–µ—Ä–∞ –∑ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è–º –∫–ª—é—á—ñ–≤, –∫–µ—Ä–æ–≤–∞–Ω–∏—Ö KMS, SSE-KMS</strong></summary>

–¶–µ–π –º–µ—Ç–æ–¥ –¥–æ–∑–≤–æ–ª—è—î S3 –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ —Å–ª—É–∂–±—É —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –∫–ª—é—á–∞–º–∏ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó –≤–∞—à–∏—Ö –∫–ª—é—á—ñ–≤ —à–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è –¥–∞–Ω–∏—Ö. KMS –Ω–∞–¥–∞—î –≤–∞–º –∑–Ω–∞—á–Ω–æ –±—ñ–ª—å—à—É –≥–Ω—É—á–∫—ñ—Å—Ç—å —É —Ç–æ–º—É, —è–∫ —É–ø—Ä–∞–≤–ª—è—é—Ç—å—Å—è –≤–∞—à—ñ –∫–ª—é—á—ñ. –ù–∞–ø—Ä–∏–∫–ª–∞–¥, –≤–∏ –º–æ–∂–µ—Ç–µ –≤—ñ–¥–∫–ª—é—á–∞—Ç–∏, –æ–±–µ—Ä—Ç–∞—Ç–∏ —Ç–∞ –∑–∞—Å—Ç–æ—Å–æ–≤—É–≤–∞—Ç–∏ –∫–æ–Ω—Ç—Ä–æ–ª—å –¥–æ—Å—Ç—É–ø—É –¥–æ CMK, –∞ —Ç–∞–∫–æ–∂ –∫–æ–Ω—Ç—Ä–æ–ª—é–≤–∞—Ç–∏ —ó—Ö –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é AWS Cloud Trail.

* –®–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è:
* S3 –∑–∞–ø–∏—Ç—É—î –∫–ª—é—á—ñ –¥–∞–Ω–∏—Ö —É KMS CMK
* KMS –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î CMK –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó –ø–∞—Ä–∏ –≤—ñ–¥–∫—Ä–∏—Ç–æ–≥–æ DEK —ñ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–æ–≥–æ DEK —Ç–∞ –Ω–∞–¥—Å–∏–ª–∞—î —ó—Ö –¥–æ S3
* S3 –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î –≤—ñ–¥–∫—Ä–∏—Ç–∏–π –∫–ª—é—á –¥–ª—è —à–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è –¥–∞–Ω–∏—Ö, –∑–±–µ—Ä—ñ–≥–∞—î –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω—ñ –¥–∞–Ω—ñ —Ç–∞ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–π –∫–ª—é—á —ñ –≤–∏–¥–∞–ª—è—î –∑ –ø–∞–º'—è—Ç—ñ –≤—ñ–¥–∫—Ä–∏—Ç–∏–π –∫–ª—é—á
* –†–æ–∑—à–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è:
* S3 –∑–∞–ø–∏—Ç—É—î KMS –¥–ª—è —Ä–æ–∑—à–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–æ–≥–æ –∫–ª—é—á–∞ –¥–∞–Ω–∏—Ö –æ–±'—î–∫—Ç–∞
* KMS —Ä–æ–∑—à–∏—Ñ—Ä–æ–≤—É—î –∫–ª—é—á –¥–∞–Ω–∏—Ö –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é CMK —ñ –Ω–∞–¥—Å–∏–ª–∞—î –π–æ–≥–æ –Ω–∞–∑–∞–¥ –¥–æ S3
* S3 —Ä–æ–∑—à–∏—Ñ—Ä–æ–≤—É—î –¥–∞–Ω—ñ –æ–±'—î–∫—Ç–∞

</details>

<details>

<summary><strong>–®–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è –Ω–∞ —Å—Ç–æ—Ä–æ–Ω—ñ —Å–µ—Ä–≤–µ—Ä–∞ –∑ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è–º –∫–ª—é—á—ñ–≤, –Ω–∞–¥–∞–Ω–∏—Ö –∫–ª—ñ—î–Ω—Ç–æ–º, SSE-C</strong></summary>

–¶–µ–π –≤–∞—Ä—ñ–∞–Ω—Ç –¥–∞—î –≤–∞–º –º–æ–∂–ª–∏–≤—ñ—Å—Ç—å –Ω–∞–¥–∞—Ç–∏ —Å–≤—ñ–π –≤–ª–∞—Å–Ω–∏–π –º–∞–π—Å—Ç–µ—Ä-–∫–ª—é—á, —è–∫–∏–π –≤–∏, –º–æ–∂–ª–∏–≤–æ, –≤–∂–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç–µ –ø–æ–∑–∞ AWS. –í–∞—à –∫–ª—é—á, –Ω–∞–¥–∞–Ω–∏–π –∫–ª—ñ—î–Ω—Ç–æ–º, –±—É–¥–µ –Ω–∞–¥—ñ—Å–ª–∞–Ω–æ —Ä–∞–∑–æ–º –∑ –≤–∞—à–∏–º–∏ –¥–∞–Ω–∏–º–∏ –¥–æ S3, –¥–µ S3 –≤–∏–∫–æ–Ω–∞—î —à–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è –¥–ª—è –≤–∞—Å.

* –®–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è:
* –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –Ω–∞–¥—Å–∏–ª–∞—î –¥–∞–Ω—ñ –æ–±'—î–∫—Ç–∞ + –ö–ª—é—á –∫–ª—ñ—î–Ω—Ç–∞ –¥–æ S3
* –ö–ª—é—á –∫–ª—ñ—î–Ω—Ç–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –¥–ª—è —à–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è –¥–∞–Ω–∏—Ö, —ñ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω—ñ –¥–∞–Ω—ñ –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è
* —Ç–∞–∫–æ–∂ –∑–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è –∑–Ω–∞—á–µ–Ω–Ω—è HMAC –∑ —Å—ñ–ª–ª—é –∫–ª—é—á–∞ –∫–ª—ñ—î–Ω—Ç–∞ –¥–ª—è –º–∞–π–±—É—Ç–Ω—å–æ—ó –≤–∞–ª—ñ–¥–∞—Ü—ñ—ó –∫–ª—é—á–∞
* –∫–ª—é—á –∫–ª—ñ—î–Ω—Ç–∞ –≤–∏–¥–∞–ª—è—î—Ç—å—Å—è –∑ –ø–∞–º'—è—Ç—ñ
* –†–æ–∑—à–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è:
* –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –Ω–∞–¥—Å–∏–ª–∞—î –∫–ª—é—á –∫–ª—ñ—î–Ω—Ç–∞
* –ö–ª—é—á –ø–µ—Ä–µ–≤—ñ—Ä—è—î—Ç—å—Å—è –Ω–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω—ñ—Å—Ç—å –∑–±–µ—Ä–µ–∂–µ–Ω–æ–º—É –∑–Ω–∞—á–µ–Ω–Ω—é HMAC
* –ö–ª—é—á, –Ω–∞–¥–∞–Ω–∏–π –∫–ª—ñ—î–Ω—Ç–æ–º, –ø–æ—Ç—ñ–º –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –¥–ª—è —Ä–æ–∑—à–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è –¥–∞–Ω–∏—Ö

</details>

<details>

<summary><strong>–®–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è –Ω–∞ —Å—Ç–æ—Ä–æ–Ω—ñ –∫–ª—ñ—î–Ω—Ç–∞ –∑ KMS, CSE-KMS</strong></summary>

–ê–Ω–∞–ª–æ–≥—ñ—á–Ω–æ –¥–æ SSE-KMS, —Ü–µ–π –º–µ—Ç–æ–¥ —Ç–∞–∫–æ–∂ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î —Å–ª—É–∂–±—É —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –∫–ª—é—á–∞–º–∏ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó –≤–∞—à–∏—Ö –∫–ª—é—á—ñ–≤ —à–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è –¥–∞–Ω–∏—Ö. –û–¥–Ω–∞–∫ —Ü—å–æ–≥–æ —Ä–∞–∑—É KMS –≤–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è —á–µ—Ä–µ–∑ –∫–ª—ñ—î–Ω—Ç–∞, –∞ –Ω–µ S3. –®–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è –≤—ñ–¥–±—É–≤–∞—î—Ç—å—Å—è –Ω–∞ —Å—Ç–æ—Ä–æ–Ω—ñ –∫–ª—ñ—î–Ω—Ç–∞, –∞ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω—ñ –¥–∞–Ω—ñ –Ω–∞–¥—Å–∏–ª–∞—é—Ç—å—Å—è –¥–æ S3 –¥–ª—è –∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è.

* –®–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è:
* –ö–ª—ñ—î–Ω—Ç –∑–∞–ø–∏—Ç—É—î –∫–ª—é—á –¥–∞–Ω–∏—Ö —É KMS
* KMS –ø–æ–≤–µ—Ä—Ç–∞—î –≤—ñ–¥–∫—Ä–∏—Ç–∏–π DEK —ñ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–π DEK –∑ CMK
* –û–±–∏–¥–≤–∞ –∫–ª—é—á—ñ –Ω–∞–¥—Å–∏–ª–∞—é—Ç—å—Å—è –Ω–∞–∑–∞–¥
* –ö–ª—ñ—î–Ω—Ç —à–∏—Ñ—Ä—É—î –¥–∞–Ω—ñ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –≤—ñ–¥–∫—Ä–∏—Ç–æ–≥–æ DEK —ñ –Ω–∞–¥—Å–∏–ª–∞—î –¥–æ S3 –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω—ñ –¥–∞–Ω—ñ + –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–π DEK (—è–∫–∏–π –∑–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è —è–∫ –º–µ—Ç–∞–¥–∞–Ω—ñ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—Ö –¥–∞–Ω–∏—Ö —É S3)
* –†–æ–∑—à–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è:
* –ó–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω—ñ –¥–∞–Ω—ñ –∑ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–º DEK –Ω–∞–¥—Å–∏–ª–∞—é—Ç—å—Å—è –∫–ª—ñ—î–Ω—Ç—É
* –ö–ª—ñ—î–Ω—Ç –∑–∞–ø–∏—Ç—É—î KMS –¥–ª—è —Ä–æ–∑—à–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–æ–≥–æ –∫–ª—é—á–∞ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é CMK, —ñ KMS –Ω–∞–¥—Å–∏–ª–∞—î –Ω–∞–∑–∞–¥ –≤—ñ–¥–∫—Ä–∏—Ç–∏–π DEK
* –¢–µ–ø–µ—Ä –∫–ª—ñ—î–Ω—Ç –º–æ–∂–µ —Ä–æ–∑—à–∏—Ñ—Ä—É–≤–∞—Ç–∏ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω—ñ –¥–∞–Ω—ñ

</details>

<details>

<summary><strong>–®–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è –Ω–∞ —Å—Ç–æ—Ä–æ–Ω—ñ –∫–ª—ñ—î–Ω—Ç–∞ –∑ –∫–ª—é—á–∞–º–∏, –Ω–∞–¥–∞–Ω–∏–º–∏ –∫–ª—ñ—î–Ω—Ç–æ–º, CSE-C</strong></summary>

–í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ —Ü–µ–π –º–µ—Ö–∞–Ω—ñ–∑–º, –≤–∏ –º–æ–∂–µ—Ç–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ —Å–≤–æ—ó –≤–ª–∞—Å–Ω—ñ –Ω–∞–¥–∞–Ω—ñ –∫–ª—é—á—ñ —Ç–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –∫–ª—ñ—î–Ω—Ç AWS-SDK –¥–ª—è —à–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è –≤–∞—à–∏—Ö –¥–∞–Ω–∏—Ö –ø–µ—Ä–µ–¥ —ó—Ö –Ω–∞–¥—Å–∏–ª–∞–Ω–Ω—è–º –¥–æ S3 –¥–ª—è –∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è.

* –®–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è:
* –ö–ª—ñ—î–Ω—Ç –≥–µ–Ω–µ—Ä—É—î DEK —ñ —à–∏—Ñ—Ä—É—î –≤—ñ–¥–∫—Ä–∏—Ç—ñ –¥–∞–Ω—ñ
* –ü–æ—Ç—ñ–º, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ —Å–≤—ñ–π –≤–ª–∞—Å–Ω–∏–π –∫–∞—Å—Ç–æ–º–Ω–∏–π CMK, –≤—ñ–Ω —à–∏—Ñ—Ä—É—î DEK
* –Ω–∞–¥—Å–∏–ª–∞—î –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω—ñ –¥–∞–Ω—ñ + –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–π DEK –¥–æ S3, –¥–µ –≤–æ–Ω–∏ –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è
* –†–æ–∑—à–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è:
* S3 –Ω–∞–¥—Å–∏–ª–∞—î –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω—ñ –¥–∞–Ω—ñ —Ç–∞ DEK
* –û—Å–∫—ñ–ª—å–∫–∏ –∫–ª—ñ—î–Ω—Ç –≤–∂–µ –º–∞—î CMK, –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–∏–π –¥–ª—è —à–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è DEK, –≤—ñ–Ω —Ä–æ–∑—à–∏—Ñ—Ä–æ–≤—É—î DEK, –∞ –ø–æ—Ç—ñ–º –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î –≤—ñ–¥–∫—Ä–∏—Ç–∏–π DEK –¥–ª—è —Ä–æ–∑—à–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è –¥–∞–Ω–∏—Ö

</details>

### **–ü–µ—Ä–µ—Ä–∞—Ö—É–≤–∞–Ω–Ω—è**

–û–¥–∏–Ω –∑ —Ç—Ä–∞–¥–∏—Ü—ñ–π–Ω–∏—Ö –æ—Å–Ω–æ–≤–Ω–∏—Ö —Å–ø–æ—Å–æ–±—ñ–≤ –∫–æ–º–ø—Ä–æ–º–µ—Ç–∞—Ü—ñ—ó –æ—Ä–≥–∞–Ω—ñ–∑–∞—Ü—ñ–π AWS –ø–æ—á–∏–Ω–∞—î—Ç—å—Å—è –∑ –∫–æ–º–ø—Ä–æ–º–µ—Ç–∞—Ü—ñ—ó –±–∞–∫–µ—Ç—ñ–≤, —è–∫—ñ —î –ø—É–±–ª—ñ—á–Ω–æ –¥–æ—Å—Ç—É–ø–Ω–∏–º–∏. **–í–∏ –º–æ–∂–µ—Ç–µ –∑–Ω–∞–π—Ç–∏** [**–ø–µ—Ä–µ—Ä–∞—Ö—É–≤–∞—á—ñ –ø—É–±–ª—ñ—á–Ω–∏—Ö –±–∞–∫–µ—Ç—ñ–≤ –Ω–∞ —Ü—ñ–π —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ**](../../aws-security/aws-unauthenticated-enum-access/#s3-buckets)**.**
```bash
# Get buckets ACLs
aws s3api get-bucket-acl --bucket <bucket-name>
aws s3api get-object-acl --bucket <bucket-name> --key flag

# Get policy
aws s3api get-bucket-policy --bucket <bucket-name>
aws s3api get-bucket-policy-status --bucket <bucket-name> #if it's public

# list S3 buckets associated with a profile
aws s3 ls
aws s3api list-buckets

# list content of bucket (no creds)
aws s3 ls s3://bucket-name --no-sign-request
aws s3 ls s3://bucket-name --recursive

# list content of bucket (with creds)
aws s3 ls s3://bucket-name
aws s3api list-objects-v2 --bucket <bucket-name>
aws s3api list-objects --bucket <bucket-name>
aws s3api list-object-versions --bucket <bucket-name>

# list objects version history
# try to remove --no-sign-request if you are authenticated
aws --no-sign-request s3api list-object-versions --bucket <bucket_name>

# get a specific version for a object
aws --no-sign-request s3api get-object --bucket <bucket_name> --key <object_key> --version-id <object_VersionId> <output_filename>

# copy local folder to S3
aws s3 cp MyFolder s3://bucket-name --recursive

# delete
aws s3 rb s3://bucket-name ‚Äì-force

# download a whole S3 bucket
aws s3 sync s3://<bucket>/ .

# move S3 bucket to different location
aws s3 sync s3://oldbucket s3://newbucket --source-region us-west-1

# list the sizes of an S3 bucket and its contents
aws s3api list-objects --bucket BUCKETNAME --output json --query "[sum(Contents[].Size), length(Contents[])]"

# Update Bucket policy
aws s3api put-bucket-policy --policy file:///root/policy.json --bucket <bucket-name>
##JSON policy example
{
"Id": "Policy1568185116930",
"Version": "2012-10-17",
"Statement": [
{
"Sid": "Stmt1568184932403",
"Action": [
"s3:ListBucket"
],
"Effect": "Allow",
"Resource": "arn:aws:s3:::welcome",
"Principal": "*"
},
{
"Sid": "Stmt1568185007451",
"Action": [
"s3:GetObject"
],
"Effect": "Allow",
"Resource": "arn:aws:s3:::welcome/*",
"Principal": "*"
}
]
}

# Update bucket ACL
aws s3api get-bucket-acl --bucket <bucket-name> # Way 1 to get the ACL
aws s3api put-bucket-acl --bucket <bucket-name> --access-control-policy file://acl.json

aws s3api get-object-acl --bucket <bucket-name> --key flag #Way 2 to get the ACL
aws s3api put-object-acl --bucket <bucket-name> --key flag --access-control-policy file://objacl.json

##JSON ACL example
## Make sure to modify the Owner‚Äôs displayName and ID according to the Object ACL you retrieved.
{
"Owner": {
"DisplayName": "<DisplayName>",
"ID": "<ID>"
},
"Grants": [
{
"Grantee": {
"Type": "Group",
"URI": "http://acs.amazonaws.com/groups/global/AuthenticatedUsers"
},
"Permission": "FULL_CONTROL"
}
]
}
## An ACL should give you the permission WRITE_ACP to be able to put a new ACL
```
### dual-stack <a href="#dual-stack-endpoints-description" id="dual-stack-endpoints-description"></a>

–í–∏ –º–æ–∂–µ—Ç–µ –æ—Ç—Ä–∏–º–∞—Ç–∏ –¥–æ—Å—Ç—É–ø –¥–æ S3 –±–∞–∫–µ—Ç—É —á–µ—Ä–µ–∑ –¥–≤–æ—Å—Ç–æ—Ä–æ–Ω–Ω—ñ–π –∫—ñ–Ω—Ü–µ–≤–∏–π –ø—É–Ω–∫—Ç, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ –≤—ñ—Ä—Ç—É–∞–ª—å–Ω–µ —ñ–º'—è, —â–æ –±–∞–∑—É—î—Ç—å—Å—è –Ω–∞ —Ö–æ—Å—Ç–∏–Ω–≥—É, –∞–±–æ —ñ–º'—è –∫—ñ–Ω—Ü–µ–≤–æ–≥–æ –ø—É–Ω–∫—Ç—É, —â–æ –±–∞–∑—É—î—Ç—å—Å—è –Ω–∞ —à–ª—è—Ö—É. –¶–µ –∫–æ—Ä–∏—Å–Ω–æ –¥–ª—è –¥–æ—Å—Ç—É–ø—É –¥–æ S3 —á–µ—Ä–µ–∑ IPv6.

–î–≤–æ—Å—Ç–æ—Ä–æ–Ω–Ω—ñ –∫—ñ–Ω—Ü–µ–≤—ñ –ø—É–Ω–∫—Ç–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å –Ω–∞—Å—Ç—É–ø–Ω–∏–π —Å–∏–Ω—Ç–∞–∫—Å–∏—Å:

* `bucketname.s3.dualstack.aws-region.amazonaws.com`
* `s3.dualstack.aws-region.amazonaws.com/bucketname`

### Privesc

–ù–∞ –Ω–∞—Å—Ç—É–ø–Ω—ñ–π —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ –≤–∏ –º–æ–∂–µ—Ç–µ –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏, —è–∫ **–∑–ª–æ–≤–∂–∏–≤–∞—Ç–∏ –ø—Ä–∞–≤–∞–º–∏ –¥–æ—Å—Ç—É–ø—É S3 –¥–ª—è –µ—Å–∫–∞–ª–∞—Ü—ñ—ó –ø—Ä–∏–≤—ñ–ª–µ—ó–≤**:

{% content-ref url="../../aws-security/aws-privilege-escalation/aws-s3-privesc.md" %}
[aws-s3-privesc.md](../../aws-security/aws-privilege-escalation/aws-s3-privesc.md)
{% endcontent-ref %}

### Unauthenticated Access

{% content-ref url="../../aws-security/aws-unauthenticated-enum-access/aws-s3-unauthenticated-enum.md" %}
[aws-s3-unauthenticated-enum.md](../../aws-security/aws-unauthenticated-enum-access/aws-s3-unauthenticated-enum.md)
{% endcontent-ref %}

### S3 Post Exploitation

{% content-ref url="../aws-post-exploitation/aws-s3-post-exploitation.md" %}
[aws-s3-post-exploitation.md](../aws-post-exploitation/aws-s3-post-exploitation.md)
{% endcontent-ref %}

### Persistence

{% content-ref url="../aws-persistence/aws-s3-persistence.md" %}
[aws-s3-persistence.md](../aws-persistence/aws-s3-persistence.md)
{% endcontent-ref %}

## Other S3 vulns

### S3 HTTP Cache Poisoning Issue <a href="#heading-s3-http-desync-cache-poisoning-issue" id="heading-s3-http-desync-cache-poisoning-issue"></a>

[**–ó–≥—ñ–¥–Ω–æ –∑ —Ü–∏–º –¥–æ—Å–ª—ñ–¥–∂–µ–Ω–Ω—è–º**](https://rafa.hashnode.dev/exploiting-http-parsers-inconsistencies#heading-s3-http-desync-cache-poisoning-issue) –±—É–ª–æ –º–æ–∂–ª–∏–≤–∏–º –∫–µ—à—É–≤–∞—Ç–∏ –≤—ñ–¥–ø–æ–≤—ñ–¥—å –¥–æ–≤—ñ–ª—å–Ω–æ–≥–æ –±–∞–∫–µ—Ç—É —Ç–∞–∫, –Ω—ñ–±–∏ –≤–æ–Ω–∞ –Ω–∞–ª–µ–∂–∞–ª–∞ —ñ–Ω—à–æ–º—É. –¶–µ –º–æ–≥–ª–æ –±—É—Ç–∏ –∑–ª–æ–≤–∂–∏—Ç–æ –¥–ª—è –∑–º—ñ–Ω–∏, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥, –≤—ñ–¥–ø–æ–≤—ñ–¥–µ–π —Ñ–∞–π–ª—ñ–≤ javascript —ñ –∫–æ–º–ø—Ä–æ–º–µ—Ç–∞—Ü—ñ—ó –¥–æ–≤—ñ–ª—å–Ω–∏—Ö —Å—Ç–æ—Ä—ñ–Ω–æ–∫, —â–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å S3 –¥–ª—è –∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è —Å—Ç–∞—Ç–∏—á–Ω–æ–≥–æ –∫–æ–¥—É.

## Amazon Athena

Amazon Athena ‚Äî —Ü–µ —ñ–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞ —Å–ª—É–∂–±–∞ –∑–∞–ø–∏—Ç—ñ–≤, —è–∫–∞ —Å–ø—Ä–æ—â—É—î **–∞–Ω–∞–ª—ñ–∑ –¥–∞–Ω–∏—Ö** –±–µ–∑–ø–æ—Å–µ—Ä–µ–¥–Ω—å–æ –≤ Amazon Simple Storage Service (Amazon **S3**) **–≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏** —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∏–π **SQL**.

–í–∞–º –ø–æ—Ç—Ä—ñ–±–Ω–æ **–ø—ñ–¥–≥–æ—Ç—É–≤–∞—Ç–∏ —Ä–µ–ª—è—Ü—ñ–π–Ω—É —Ç–∞–±–ª–∏—Ü—é –ë–î** –∑ —Ñ–æ—Ä–º–∞—Ç–æ–º –≤–º—ñ—Å—Ç—É, —è–∫–∏–π –∑'—è–≤–∏—Ç—å—Å—è –≤ –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥–æ–≤–∏—Ö S3 –±–∞–∫–µ—Ç–∞—Ö. –ê –ø–æ—Ç—ñ–º Amazon Athena –∑–º–æ–∂–µ –∑–∞–ø–æ–≤–Ω–∏—Ç–∏ –ë–î –∑ –∂—É—Ä–Ω–∞–ª—ñ–≤, —â–æ–± –≤–∏ –º–æ–≥–ª–∏ –∑–∞–ø–∏—Ç—É–≤–∞—Ç–∏ —ó—ó.

Amazon Athena –ø—ñ–¥—Ç—Ä–∏–º—É—î **–º–æ–∂–ª–∏–≤—ñ—Å—Ç—å –∑–∞–ø–∏—Ç—É–≤–∞—Ç–∏ –¥–∞–Ω—ñ S3, —è–∫—ñ –≤–∂–µ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω—ñ**, —ñ —è–∫—â–æ —Ü–µ –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω–æ, **Athena —Ç–∞–∫–æ–∂ –º–æ–∂–µ –∑–∞—à–∏—Ñ—Ä–æ–≤—É–≤–∞—Ç–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏ –∑–∞–ø–∏—Ç—É, —è–∫—ñ –ø–æ—Ç—ñ–º –º–æ–∂—É—Ç—å –±—É—Ç–∏ –∑–±–µ—Ä–µ–∂–µ–Ω—ñ –≤ S3**.

**–¶—è —à–∏—Ñ—Ä–∞—Ü—ñ—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ –Ω–µ–∑–∞–ª–µ–∂–Ω–∞ –≤—ñ–¥ –æ—Å–Ω–æ–≤–Ω–∏—Ö –∑–∞–ø–∏—Ç—É–≤–∞–Ω–∏—Ö –¥–∞–Ω–∏—Ö S3**, —â–æ –æ–∑–Ω–∞—á–∞—î, —â–æ –Ω–∞–≤—ñ—Ç—å —è–∫—â–æ –¥–∞–Ω—ñ S3 –Ω–µ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω—ñ, –∑–∞–ø–∏—Ç—É–≤–∞–Ω—ñ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏ –º–æ–∂—É—Ç—å –±—É—Ç–∏ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω—ñ. –ö—ñ–ª—å–∫–∞ –º–æ–º–µ–Ω—Ç—ñ–≤, –ø—Ä–æ —è–∫—ñ —Å–ª—ñ–¥ –ø–∞–º'—è—Ç–∞—Ç–∏, —Ü–µ —Ç–µ, —â–æ Amazon Athena –ø—ñ–¥—Ç—Ä–∏–º—É—î –ª–∏—à–µ –¥–∞–Ω—ñ, —è–∫—ñ –±—É–ª–∏ **–∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω—ñ** –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é **–Ω–∞—Å—Ç—É–ø–Ω–∏—Ö –º–µ—Ç–æ–¥—ñ–≤ —à–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è S3**, **SSE-S3, SSE-KMS —Ç–∞ CSE-KMS**.

SSE-C —Ç–∞ CSE-E –Ω–µ –ø—ñ–¥—Ç—Ä–∏–º—É—é—Ç—å—Å—è. –ö—Ä—ñ–º —Ç–æ–≥–æ, –≤–∞–∂–ª–∏–≤–æ —Ä–æ–∑—É–º—ñ—Ç–∏, —â–æ Amazon Athena –±—É–¥–µ –≤–∏–∫–æ–Ω—É–≤–∞—Ç–∏ –∑–∞–ø–∏—Ç–∏ –ª–∏—à–µ –ø—Ä–æ—Ç–∏ **–∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—Ö –æ–±'—î–∫—Ç—ñ–≤, —è–∫—ñ –∑–Ω–∞—Ö–æ–¥—è—Ç—å—Å—è –≤ —Ç–æ–º—É –∂ —Ä–µ–≥—ñ–æ–Ω—ñ, —â–æ –π —Å–∞–º –∑–∞–ø–∏—Ç**. –Ø–∫—â–æ –≤–∞–º –ø–æ—Ç—Ä—ñ–±–Ω–æ –∑–∞–ø–∏—Ç—É–≤–∞—Ç–∏ –¥–∞–Ω—ñ S3, —è–∫—ñ –±—É–ª–∏ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω—ñ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é KMS, —Ç–æ–¥—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—É Athena –ø–æ—Ç—Ä—ñ–±–Ω—ñ —Å–ø–µ—Ü–∏—Ñ—ñ—á–Ω—ñ –¥–æ–∑–≤–æ–ª–∏, —â–æ–± –¥–æ–∑–≤–æ–ª–∏—Ç–∏ —ó–º –≤–∏–∫–æ–Ω–∞—Ç–∏ –∑–∞–ø–∏—Ç.

### Enumeration
```bash
# Get catalogs
aws athena list-data-catalogs

# Get databases inside catalog
aws athena list-databases --catalog-name <catalog-name>
aws athena list-table-metadata --catalog-name <catalog-name> --database-name <db-name>

# Get query executions, queries and results
aws athena list-query-executions
aws athena get-query-execution --query-execution-id <id> # Get query and meta of results
aws athena get-query-results --query-execution-id <id> # This will rerun the query and get the results

# Get workgroups & Prepared statements
aws athena list-work-groups
aws athena list-prepared-statements --work-group <wg-name>
aws athena get-prepared-statement --statement-name <name> --work-group <wg-name>

# Run query
aws athena start-query-execution --query-string <query>
```
## References

* [https://cloudsecdocs.com/aws/defensive/tooling/cli/#s3](https://cloudsecdocs.com/aws/defensive/tooling/cli/#s3)
* [https://docs.aws.amazon.com/AmazonS3/latest/userguide/dual-stack-endpoints.html](https://docs.aws.amazon.com/AmazonS3/latest/userguide/dual-stack-endpoints.html)

{% hint style="success" %}
–í–∏–≤—á–∞–π—Ç–µ —Ç–∞ –ø—Ä–∞–∫—Ç–∏–∫—É–π—Ç–µ AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
–í–∏–≤—á–∞–π—Ç–µ —Ç–∞ –ø—Ä–∞–∫—Ç–∏–∫—É–π—Ç–µ GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>–ü—ñ–¥—Ç—Ä–∏–º–∞–π—Ç–µ HackTricks</summary>

* –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ [**–ø–ª–∞–Ω–∏ –ø—ñ–¥–ø–∏—Å–∫–∏**](https://github.com/sponsors/carlospolop)!
* **–ü—Ä–∏—î–¥–Ω—É–π—Ç–µ—Å—å –¥–æ** üí¨ [**–≥—Ä—É–ø–∏ Discord**](https://discord.gg/hRep4RUj7f) –∞–±–æ [**–≥—Ä—É–ø–∏ telegram**](https://t.me/peass) –∞–±–æ **—Å–ª—ñ–¥–∫—É–π—Ç–µ** –∑–∞ –Ω–∞–º–∏ –≤ **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **–î—ñ–ª—ñ—Ç—å—Å—è —Ö–∞–∫–µ—Ä—Å—å–∫–∏–º–∏ —Ç—Ä—é–∫–∞–º–∏, –Ω–∞–¥—Å–∏–ª–∞—é—á–∏ PR –¥–æ** [**HackTricks**](https://github.com/carlospolop/hacktricks) —Ç–∞ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—ó–≤ –Ω–∞ github.

</details>
{% endhint %}
