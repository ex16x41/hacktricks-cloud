# GWS - Google Platforms Phishing

{% hint style="success" %}
AWS Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n:<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
GCP Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**abonelik planlarÄ±nÄ±**](https://github.com/sponsors/carlospolop) kontrol edin!
* **ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n ya da **Twitter'da** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**'i takip edin.**
* **Hacking ipuÃ§larÄ±nÄ± paylaÅŸmak iÃ§in** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna PR gÃ¶nderin.

</details>
{% endhint %}

## Genel Phishing Metodolojisi

{% embed url="https://book.hacktricks.xyz/generic-methodologies-and-resources/phishing-methodology" %}

## Google GruplarÄ± Phishing

GÃ¶rÃ¼nÃ¼ÅŸe gÃ¶re, varsayÄ±lan olarak, workspace Ã¼yeleri [**gruplar oluÅŸturabilir**](https://groups.google.com/all-groups) **ve insanlarÄ± davet edebilirler**. Daha sonra kullanÄ±cÄ±ya gÃ¶nderilecek e-postayÄ± **bazÄ± baÄŸlantÄ±lar ekleyerek** deÄŸiÅŸtirebilirsiniz. **E-posta bir google adresinden gelecektir**, bu nedenle **gerÃ§ekÃ§i** gÃ¶rÃ¼necek ve insanlar baÄŸlantÄ±ya tÄ±klayabilir.

AyrÄ±ca, **FROM** adresini **Google grup e-postasÄ±** olarak ayarlamak da mÃ¼mkÃ¼ndÃ¼r, bÃ¶ylece **gruptaki kullanÄ±cÄ±lara daha fazla e-posta gÃ¶nderebilirsiniz**, aÅŸaÄŸÄ±daki resimde olduÄŸu gibi grup **`google--support@googlegroups.com`** oluÅŸturulmuÅŸ ve gruptaki tÃ¼m Ã¼yelere **bir e-posta gÃ¶nderilmiÅŸtir** (rÄ±za olmadan eklenmiÅŸlerdir).

<figure><img src="../../../.gitbook/assets/image (5).png" alt=""><figcaption></figcaption></figure>

## Google Chat Phishing

Bir kiÅŸiyle sadece e-posta adresini bilerek **sohbet baÅŸlatabilir** veya bir **konuÅŸma daveti gÃ¶nderebilirsiniz**. AyrÄ±ca, herhangi bir isimle (Ã¶rneÄŸin "Google Destek") **bir Alan oluÅŸturmak** ve Ã¼ye davet etmek mÃ¼mkÃ¼ndÃ¼r. Kabul ederlerse, Google Destek ile konuÅŸuyorlarmÄ±ÅŸ gibi dÃ¼ÅŸÃ¼nebilirler:

<figure><img src="../../../.gitbook/assets/image (6).png" alt=""><figcaption></figcaption></figure>

{% hint style="success" %}
**Ancak testlerimde davet edilen Ã¼yeler davet bile almadÄ±.**
{% endhint %}

Bunun geÃ§miÅŸte nasÄ±l Ã§alÄ±ÅŸtÄ±ÄŸÄ±nÄ± kontrol edebilirsiniz: [https://www.youtube.com/watch?v=KTVHLolz6cE\&t=904s](https://www.youtube.com/watch?v=KTVHLolz6cE\&t=904s)

## Google DokÃ¼manlarÄ± Phishing

GeÃ§miÅŸte, **gÃ¶rÃ¼nÃ¼ÅŸte meÅŸru bir belge** oluÅŸturmak ve bir yorumda **bazÄ± e-postalarÄ± (Ã¶rneÄŸin @user@gmail.com)** belirtmek mÃ¼mkÃ¼ndÃ¼. Google, o e-posta adresine **belgede bahsedildiÄŸini** bildiren bir e-posta gÃ¶nderdi.\
GÃ¼nÃ¼mÃ¼zde bu Ã§alÄ±ÅŸmÄ±yor ama eÄŸer **kurbanÄ±n e-posta eriÅŸimini belgeye verirseniz**, Google bununla ilgili bir e-posta gÃ¶nderecektir. Birini bahsettiÄŸinizde gÃ¶rÃ¼nen mesaj budur:

<figure><img src="../../../.gitbook/assets/image (7).png" alt=""><figcaption></figcaption></figure>

{% hint style="success" %}
KurbanlarÄ±n, dÄ±ÅŸ bir belgenin onlarla paylaÅŸÄ±ldÄ±ÄŸÄ±nÄ± belirten e-postalarÄ±n ulaÅŸmasÄ±nÄ± engelleyen koruma mekanizmalarÄ± olabilir.
{% endhint %}

## Google Takvim Phishing

Bir **takvim etkinliÄŸi oluÅŸturabilir** ve saldÄ±rdÄ±ÄŸÄ±nÄ±z ÅŸirketin sahip olduÄŸu kadar e-posta adresi ekleyebilirsiniz. Bu takvim etkinliÄŸini mevcut zamandan **5 veya 15 dakika** sonra planlayÄ±n. EtkinliÄŸi gerÃ§ekÃ§i gÃ¶sterin ve **okumalarÄ± gereken bir ÅŸey olduÄŸunu belirten bir yorum ve baÅŸlÄ±k ekleyin** (ile birlikte **phishing baÄŸlantÄ±sÄ±**).

Bu, "Ä°nsanlarÄ± Ä°ÅŸten Ã‡Ä±karma" baÅŸlÄ±klÄ± bir toplantÄ± ile tarayÄ±cÄ±da gÃ¶rÃ¼necek uyarÄ±dÄ±r, bu nedenle daha phishing benzeri bir baÅŸlÄ±k ayarlayabilirsiniz (ve hatta e-posta ile iliÅŸkilendirilmiÅŸ ismi deÄŸiÅŸtirebilirsiniz).

<figure><img src="../../../.gitbook/assets/image (8).png" alt=""><figcaption></figcaption></figure>

Daha az ÅŸÃ¼pheli gÃ¶rÃ¼nmesi iÃ§in:

* **alÄ±cÄ±larÄ±n diÄŸer davet edilen kiÅŸileri gÃ¶remeyecek ÅŸekilde ayarlayÄ±n**
* **Etkinlik hakkÄ±nda e-posta gÃ¶ndermeyin**. BÃ¶ylece, insanlar sadece 5 dakika iÃ§inde bir toplantÄ± hakkÄ±nda uyarÄ± gÃ¶recek ve o baÄŸlantÄ±yÄ± okumalarÄ± gerektiÄŸini bilecekler.
* GÃ¶rÃ¼nÃ¼ÅŸe gÃ¶re API kullanarak **doÄŸru** olarak **insanlarÄ±n** etkinliÄŸi **kabul ettiÄŸini** ayarlayabilir ve hatta **onlarÄ±n adÄ±na yorumlar oluÅŸturabilirsiniz**.

## Uygulama Scriptleri YÃ¶nlendirme Phishing

[https://script.google.com/](https://script.google.com/) adresinde bir script oluÅŸturmak ve **herkesin eriÅŸebileceÄŸi bir web uygulamasÄ± olarak sergilemek** mÃ¼mkÃ¼ndÃ¼r; bu, meÅŸru alan **`script.google.com`** kullanacaktÄ±r.\
AÅŸaÄŸÄ±daki gibi bir kod ile bir saldÄ±rgan, scriptin bu sayfada durmaksÄ±zÄ±n keyfi iÃ§erik yÃ¼klemesini saÄŸlayabilir: 

{% code overflow="wrap" %}
```javascript
function doGet() {
return HtmlService.createHtmlOutput('<meta http-equiv="refresh" content="0;url=https://cloud.hacktricks.xyz/pentesting-cloud/workspace-security/gws-google-platforms-phishing#app-scripts-redirect-phishing">')
.setXFrameOptionsMode(HtmlService.XFrameOptionsMode.ALLOWALL);
}
```
{% endcode %}

Ã–rneÄŸin [https://script.google.com/macros/s/AKfycbwuLlzo0PUaT63G33MtE6TbGUNmTKXCK12o59RKC7WLkgBTyltaS3gYuH\_ZscKQTJDC/exec](https://script.google.com/macros/s/AKfycbwuLlzo0PUaT63G33MtE6TbGUNmTKXCK12o59RKC7WLkgBTyltaS3gYuH\_ZscKQTJDC/exec) adresine eriÅŸtiÄŸinizde ÅŸunlarÄ± gÃ¶receksiniz:

<figure><img src="../../../.gitbook/assets/image (4).png" alt=""><figcaption></figcaption></figure>

{% hint style="success" %}
Ä°Ã§erik bir iframe iÃ§inde yÃ¼klendiÄŸinde bir uyarÄ± belirecektir.
{% endhint %}

## App Scripts OAuth Phishing

KurbanÄ±n OAuth token'Ä±na eriÅŸim saÄŸlamak iÃ§in belgelere baÄŸlÄ± App Scripts oluÅŸturmak mÃ¼mkÃ¼ndÃ¼r, daha fazla bilgi iÃ§in kontrol edin:

{% content-ref url="gws-app-scripts.md" %}
[gws-app-scripts.md](gws-app-scripts.md)
{% endcontent-ref %}

## OAuth Apps Phishing

Ã–nceki tekniklerden herhangi biri, kullanÄ±cÄ±nÄ±n **Google OAuth uygulamasÄ±na** eriÅŸmesini saÄŸlamak iÃ§in kullanÄ±labilir; bu uygulama kullanÄ±cÄ±dan bazÄ± **eriÅŸim** talep edecektir. EÄŸer kullanÄ±cÄ± **kaynaÄŸa** **gÃ¼veniyorsa**, **uygulamaya** da **gÃ¼venebilir** (yÃ¼ksek ayrÄ±calÄ±klÄ± izinler istese bile).

{% hint style="info" %}
Google, uygulamanÄ±n gÃ¼venilir olmadÄ±ÄŸÄ±nÄ± belirten Ã§irkin bir uyarÄ± sunar ve Workspace yÃ¶neticileri, insanlarÄ±n OAuth uygulamalarÄ±nÄ± kabul etmesini engelleyebilir.
{% endhint %}

**Google**, kullanÄ±cÄ±lar adÄ±na Ã§eÅŸitli **Google hizmetleri** ile **etkileÅŸimde bulunabilen** uygulamalar oluÅŸturmayÄ± saÄŸlar: Gmail, Drive, GCP...

DiÄŸer kullanÄ±cÄ±lar adÄ±na **hareket edecek** bir uygulama oluÅŸtururken, geliÅŸtirici **GCP iÃ§inde bir OAuth uygulamasÄ±** oluÅŸturmalÄ± ve uygulamanÄ±n kullanÄ±cÄ± verilerine eriÅŸmek iÃ§in ihtiyaÃ§ duyduÄŸu kapsamlarÄ± (izinleri) belirtmelidir.\
Bir **kullanÄ±cÄ±** bu **uygulamayÄ±** **kullanmak** istediÄŸinde, kendilerine belirtilen kapsamlar dahilinde uygulamanÄ±n verilerine eriÅŸim saÄŸlayacaÄŸÄ±nÄ± **kabul etmeleri** iÃ§in **uyarÄ±lÄ±rlar**.

Bu, teknik bilgisi olmayan kullanÄ±cÄ±larÄ± **hassas bilgilere eriÅŸen uygulamalarÄ± kullanmaya** **phish** etmek iÃ§in Ã§ok cazip bir yoldur Ã§Ã¼nkÃ¼ sonuÃ§larÄ± anlamayabilirler. Ancak, organizasyon hesaplarÄ±nda bunun olmasÄ±nÄ± Ã¶nlemenin yollarÄ± vardÄ±r.

### DoÄŸrulanmamÄ±ÅŸ Uygulama UyarÄ±sÄ±

Daha Ã¶nce belirtildiÄŸi gibi, Google her zaman kullanÄ±cÄ±nÄ±n uygulamaya verdikleri izinleri **kabul etmesi iÃ§in bir uyarÄ±** sunar. Ancak, uygulama **tehlikeli** olarak kabul edilirse, Google Ã¶nce **tehlikeli** olduÄŸunu belirten bir **uyarÄ±** gÃ¶sterir ve kullanÄ±cÄ±nÄ±n uygulamaya izin vermesini **daha zor hale getirir**.

Bu uyarÄ±, aÅŸaÄŸÄ±daki durumlarda gÃ¶rÃ¼len uygulamalarda ortaya Ã§Ä±kar:

* Ã–zel verilere eriÅŸebilen herhangi bir kapsam kullanÄ±yorsa (Gmail, Drive, GCP, BigQuery...)
* 100'den az kullanÄ±cÄ±ya sahip uygulamalar (100'den fazla kullanÄ±cÄ±ya sahip uygulamalar iÃ§in doÄŸrulama sÃ¼reci de gereklidir, bÃ¶ylece doÄŸrulanmamÄ±ÅŸ uyarÄ± gÃ¶sterilmez)

### Ä°lginÃ§ Kapsamlar

[**Burada**](https://developers.google.com/identity/protocols/oauth2/scopes) tÃ¼m Google OAuth kapsamlarÄ±nÄ±n bir listesini bulabilirsiniz.

* **cloud-platform**: **Google Cloud Platform** hizmetleri arasÄ±nda verilerinizi gÃ¶rÃ¼ntÃ¼leyin ve yÃ¶netin. GCP'de kullanÄ±cÄ±yÄ± taklit edebilirsiniz.
* **admin.directory.user.readonly**: KuruluÅŸunuzun GSuite dizinini gÃ¶rÃ¼n ve indirin. TÃ¼m kullanÄ±cÄ±larÄ±n isimlerini, telefonlarÄ±nÄ±, takvim URL'lerini alÄ±n.

### OAuth UygulamasÄ± OluÅŸturma

**Bir OAuth Client ID oluÅŸturmaya baÅŸlayÄ±n**

1. [https://console.cloud.google.com/apis/credentials/oauthclient](https://console.cloud.google.com/apis/credentials/oauthclient) adresine gidin ve onay ekranÄ±nÄ± yapÄ±landÄ±rmak iÃ§in tÄ±klayÄ±n.
2. ArdÄ±ndan, **kullanÄ±cÄ± tÃ¼rÃ¼nÃ¼n** **iÃ§sel** (sadece kuruluÅŸunuzdaki kiÅŸiler iÃ§in) mi yoksa **dÄ±ÅŸsal** mÄ± olduÄŸunu soracaktÄ±r. Ä°htiyacÄ±nÄ±za uygun olanÄ± seÃ§in.
* Ä°Ã§sel, eÄŸer zaten bir kullanÄ±cÄ±yÄ± ele geÃ§irdiyseniz ve bu uygulamayÄ± baÅŸka birini **phish** etmek iÃ§in oluÅŸturuyorsanÄ±z ilginÃ§ olabilir.
3. Uygulamaya bir **isim** verin, bir **destek e-postasÄ±** (kendinizi biraz daha anonimleÅŸtirmek iÃ§in bir googlegroup e-postasÄ± ayarlayabileceÄŸinizi unutmayÄ±n), bir **logo**, **yetkili alanlar** ve **gÃ¼ncellemeler** iÃ§in baÅŸka bir **e-posta** verin.
4. **OAuth kapsamlarÄ±nÄ±** **seÃ§in**.
* Bu sayfa, hassas olmayan izinler, hassas izinler ve kÄ±sÄ±tlÄ± izinler olarak bÃ¶lÃ¼nmÃ¼ÅŸtÃ¼r. Her yeni izin eklediÄŸinizde, kendi kategorisine eklenir. Ä°stenen izinlere baÄŸlÄ± olarak, kullanÄ±cÄ±nÄ±n bu izinlerin ne kadar hassas olduÄŸunu belirten farklÄ± uyarÄ±lar gÃ¶rÃ¼necektir.
* Hem **`admin.directory.user.readonly`** hem de **`cloud-platform`** hassas izinlerdir.
5. **Test kullanÄ±cÄ±larÄ±nÄ± ekleyin.** UygulamanÄ±n durumu test aÅŸamasÄ±ndayken, yalnÄ±zca bu kullanÄ±cÄ±lar uygulamaya eriÅŸebilecektir, bu nedenle **phish edeceÄŸiniz e-postayÄ± eklediÄŸinizden emin olun**.

Åimdi **Ã¶nceden oluÅŸturulan OAuth Client ID** kullanarak bir **web uygulamasÄ± iÃ§in kimlik bilgileri** alalÄ±m:

1. [https://console.cloud.google.com/apis/credentials/oauthclient](https://console.cloud.google.com/apis/credentials/oauthclient) adresine geri dÃ¶nÃ¼n, bu sefer farklÄ± bir seÃ§enek gÃ¶rÃ¼necektir.
2. **Web uygulamasÄ± iÃ§in kimlik bilgileri oluÅŸturmayÄ±** seÃ§in.
3. Gerekli **Javascript kÃ¶kenlerini** ve **yÃ¶nlendirme URI'lerini** ayarlayÄ±n.
* Test iÃ§in her ikisine de **`http://localhost:8000/callback`** gibi bir ÅŸey ayarlayabilirsiniz.
4. UygulamanÄ±zÄ±n **kimlik bilgilerini** alÄ±n.

Son olarak, **OAuth uygulama kimlik bilgilerini** kullanacak bir web uygulamasÄ± **Ã§alÄ±ÅŸtÄ±rÄ±n**. Ã–rneÄŸi [https://github.com/carlospolop/gcp\_oauth\_phishing\_example](https://github.com/carlospolop/gcp\_oauth\_phishing\_example) adresinde bulabilirsiniz.
```bash
git clone ttps://github.com/carlospolop/gcp_oauth_phishing_example
cd gcp_oauth_phishing_example
pip install flask requests google-auth-oauthlib
python3 app.py --client-id "<client_id>" --client-secret "<client_secret>"
```
**`http://localhost:8000`** adresine gidin, Google ile GiriÅŸ yap butonuna tÄ±klayÄ±n, size bu gibi bir mesaj **gÃ¶sterilecektir**:

<figure><img src="../../../.gitbook/assets/image (333).png" alt=""><figcaption></figcaption></figure>

Uygulama, kolayca kullanÄ±labilecek **eriÅŸim ve yenileme token'larÄ±nÄ±** gÃ¶sterecektir. **Bu token'larÄ± nasÄ±l kullanacaÄŸÄ±nÄ±z hakkÄ±nda daha fazla bilgi iÃ§in kontrol edin**:

{% content-ref url="../../gcp-security/gcp-persistence/gcp-non-svc-persistance.md" %}
[gcp-non-svc-persistance.md](../../gcp-security/gcp-persistence/gcp-non-svc-persistance.md)
{% endcontent-ref %}

#### `glcoud` KullanÄ±mÄ±

Web konsolu yerine gcloud kullanarak bir ÅŸeyler yapmak mÃ¼mkÃ¼ndÃ¼r, kontrol edin:

{% content-ref url="../../gcp-security/gcp-privilege-escalation/gcp-clientauthconfig-privesc.md" %}
[gcp-clientauthconfig-privesc.md](../../gcp-security/gcp-privilege-escalation/gcp-clientauthconfig-privesc.md)
{% endcontent-ref %}

## Referanslar

* [https://www.youtube-nocookie.com/embed/6AsVUS79gLw](https://www.youtube-nocookie.com/embed/6AsVUS79gLw) - Matthew Bryant - G Suite Hackleme: KaranlÄ±k Uygulama Script BÃ¼yÃ¼sÃ¼nÃ¼n GÃ¼cÃ¼
* [https://www.youtube.com/watch?v=KTVHLolz6cE](https://www.youtube.com/watch?v=KTVHLolz6cE) - Mike Felch ve Beau Bullock - Tamam Google, GSuite'i KÄ±rmÄ±zÄ± TakÄ±m olarak nasÄ±l yaparÄ±m?

{% hint style="success" %}
AWS Hackleme Ã–ÄŸrenin ve Pratik YapÄ±n:<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks EÄŸitim AWS KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ± (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
GCP Hackleme Ã–ÄŸrenin ve Pratik YapÄ±n: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks EÄŸitim GCP KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ± (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**abonelik planlarÄ±nÄ±**](https://github.com/sponsors/carlospolop) kontrol edin!
* **ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n ya da **Twitter'da** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**'i takip edin.**
* **Hacking ipuÃ§larÄ±nÄ± paylaÅŸmak iÃ§in** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna PR gÃ¶nderin.

</details>
{% endhint %}
