# GWS - Google Platforms Phishing

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Generic Phishing Methodology

{% embed url="https://book.hacktricks.xyz/generic-methodologies-and-resources/phishing-methodology" %}

## Google Groups Phishing

Naizgled, po defaultu, Älanovi u workspace-u [**mogu kreirati grupe**](https://groups.google.com/all-groups) **i pozvati ljude u njih**. Zatim moÅ¾ete izmeniti email koji Ä‡e biti poslat korisniku **dodajuÄ‡i neke linkove.** **Email Ä‡e doÄ‡i sa google adrese**, tako da Ä‡e izgledati **legitimno** i ljudi bi mogli kliknuti na link.

TakoÄ‘e je moguÄ‡e postaviti **FROM** adresu kao **Google grupu email** da se poÅ¡alje **viÅ¡e emailova korisnicima unutar grupe**, kao na sledeÄ‡oj slici gde je grupa **`google--support@googlegroups.com`** kreirana i **email je poslat svim Älanovima** grupe (koji su dodati bez ikakvog pristanka)

<figure><img src="../../../.gitbook/assets/image (5).png" alt=""><figcaption></figcaption></figure>

## Google Chat Phishing

MoÅ¾da Ä‡ete moÄ‡i da **zapoÄnete chat** sa osobom samo imajuÄ‡i njihovu email adresu ili da poÅ¡aljete **pozivnicu za razgovor**. Å taviÅ¡e, moguÄ‡e je **kreirati Space** koji moÅ¾e imati bilo koje ime (npr. "Google Support") i **pozvati** Älanove u njega. Ako prihvate, mogli bi pomisliti da razgovaraju sa Google podrÅ¡kom:

<figure><img src="../../../.gitbook/assets/image (6).png" alt=""><figcaption></figcaption></figure>

{% hint style="success" %}
**MeÄ‘utim, u mom testiranju pozvani Älanovi nisu Äak ni primili pozivnicu.**
{% endhint %}

MoÅ¾ete proveriti kako je to funkcionisalo u proÅ¡losti na: [https://www.youtube.com/watch?v=KTVHLolz6cE\&t=904s](https://www.youtube.com/watch?v=KTVHLolz6cE\&t=904s)

## Google Doc Phishing

U proÅ¡losti je bilo moguÄ‡e kreirati **naizgled legitimni dokument** i u komentaru **spomenuti neku email adresu (kao Å¡to je @user@gmail.com)**. Google **je poslao email toj adresi** obaveÅ¡tavajuÄ‡i da su spomenuti u dokumentu.\
Danas, ovo ne funkcioniÅ¡e, ali ako **dajte Å¾rtvi pristup emailu dokumentu** Google Ä‡e poslati email koji to ukazuje. Ovo je poruka koja se pojavljuje kada nekoga spomenete:

<figure><img src="../../../.gitbook/assets/image (7).png" alt=""><figcaption></figcaption></figure>

{% hint style="success" %}
Å½rtve mogu imati mehanizam zaÅ¡tite koji ne dozvoljava da emailovi koji ukazuju da je eksterni dokument podeljen sa njima stignu do njihove email adrese.
{% endhint %}

## Google Calendar Phishing

MoÅ¾ete **kreirati kalendarski dogaÄ‘aj** i dodati koliko god email adresa kompanije koju napadate imate. Zakazujte ovaj kalendarski dogaÄ‘aj u **5 ili 15 minuta** od trenutnog vremena. Neka dogaÄ‘aj izgleda legitimno i **stavite komentar i naslov koji ukazuje da treba da proÄitaju neÅ¡to** (sa **phishing linkom**).

Ovo je upozorenje koje Ä‡e se pojaviti u pretraÅ¾ivaÄu sa naslovom sastanka "Otpustiti ljude", tako da moÅ¾ete postaviti naslov koji viÅ¡e liÄi na phishing (i Äak promeniti ime povezano sa vaÅ¡im emailom).

<figure><img src="../../../.gitbook/assets/image (8).png" alt=""><figcaption></figcaption></figure>

Da bi izgledalo manje sumnjivo:

* Postavite tako da **primalaci ne mogu videti druge pozvane ljude**
* **NE Å¡aljite emailove koji obaveÅ¡tavaju o dogaÄ‘aju**. Tada Ä‡e ljudi samo videti svoje upozorenje o sastanku za 5 minuta i da treba da proÄitaju taj link.
* Naizgled, koristeÄ‡i API moÅ¾ete postaviti na **True** da su **ljudi** **prihvatili** dogaÄ‘aj i Äak kreirati **komentare u njihovo ime**.

## App Scripts Redirect Phishing

MoguÄ‡e je kreirati skriptu na [https://script.google.com/](https://script.google.com/) i **izloÅ¾iti je kao web aplikaciju dostupnu svima** koja Ä‡e koristiti legitimnu domenu **`script.google.com`**.\
Sa nekim kodom poput sledeÄ‡eg, napadaÄ bi mogao uÄiniti da skripta uÄita proizvoljan sadrÅ¾aj na ovoj stranici bez prestanka pristupajuÄ‡i domeni:

{% code overflow="wrap" %}
```javascript
function doGet() {
return HtmlService.createHtmlOutput('<meta http-equiv="refresh" content="0;url=https://cloud.hacktricks.xyz/pentesting-cloud/workspace-security/gws-google-platforms-phishing#app-scripts-redirect-phishing">')
.setXFrameOptionsMode(HtmlService.XFrameOptionsMode.ALLOWALL);
}
```
{% endcode %}

Na primer, pristupajuÄ‡i [https://script.google.com/macros/s/AKfycbwuLlzo0PUaT63G33MtE6TbGUNmTKXCK12o59RKC7WLkgBTyltaS3gYuH\_ZscKQTJDC/exec](https://script.google.com/macros/s/AKfycbwuLlzo0PUaT63G33MtE6TbGUNmTKXCK12o59RKC7WLkgBTyltaS3gYuH\_ZscKQTJDC/exec) videÄ‡ete:

<figure><img src="../../../.gitbook/assets/image (4).png" alt=""><figcaption></figcaption></figure>

{% hint style="success" %}
Napomena: Upozorenje Ä‡e se pojaviti dok se sadrÅ¾aj uÄitava unutar iframe-a.
{% endhint %}

## App Scripts OAuth Phishing

MoguÄ‡e je kreirati App Scripts povezane sa dokumentima kako bi se pokuÅ¡ao dobiti pristup Å¾rtvinom OAuth tokenu, za viÅ¡e informacija pogledajte:

{% content-ref url="gws-app-scripts.md" %}
[gws-app-scripts.md](gws-app-scripts.md)
{% endcontent-ref %}

## OAuth Apps Phishing

Bilo koja od prethodnih tehnika moÅ¾e se koristiti da se korisnik natera da pristupi **Google OAuth aplikaciji** koja Ä‡e **traÅ¾iti** od korisnika neki **pristup**. Ako korisnik **veruje** **izvoru**, moÅ¾e **verovati** i **aplikaciji** (Äak i ako traÅ¾i visoke privilegije).

{% hint style="info" %}
Napomena: Google prikazuje ruÅ¾nu poruku upozorenja da je aplikacija nepouzdana u nekoliko sluÄajeva, a Workspace administratori Äak mogu spreÄiti ljude da prihvate OAuth aplikacije.
{% endhint %}

**Google** omoguÄ‡ava kreiranje aplikacija koje mogu **interagovati u ime korisnika** sa nekoliko **Google servisa**: Gmail, Drive, GCP...

Kada se kreira aplikacija da **deluje u ime drugih korisnika**, programer treba da kreira **OAuth aplikaciju unutar GCP** i da oznaÄi opsege (dozvole) koje aplikacija treba da pristupi podacima korisnika.\
Kada **korisnik** Å¾eli da **koristi** tu **aplikaciju**, biÄ‡e **upitan** da **prihvati** da Ä‡e aplikacija imati pristup njihovim podacima navedenim u opsezima.

Ovo je veoma primamljiv naÄin da se **phish** netehniÄki korisnici u koriÅ¡Ä‡enju **aplikacija koje pristupaju osetljivim informacijama** jer moÅ¾da ne razumeju posledice. MeÄ‘utim, u organizacijama postoje naÄini da se to spreÄi.

### Upozorenje na nepouzdanu aplikaciju

Kao Å¡to je pomenuto, Google Ä‡e uvek prikazati **upit korisniku da prihvati** dozvole koje daju aplikaciji u njihovo ime. MeÄ‘utim, ako se aplikacija smatra **opasnom**, Google Ä‡e prvo prikazati **upit** koji ukazuje da je **opasna** i **oteÅ¾ava** korisniku da odobri dozvole aplikaciji.

Ovaj upit se pojavljuje u aplikacijama koje:

* Koriste bilo koji opseg koji moÅ¾e pristupiti privatnim podacima (Gmail, Drive, GCP, BigQuery...)
* Aplikacije sa manje od 100 korisnika (aplikacije sa viÅ¡e od 100 korisnika takoÄ‘e zahtevaju proces pregleda da bi prestale da prikazuju upozorenje na nepouzdanu aplikaciju)

### Zanimljivi opsezi

[**Ovde**](https://developers.google.com/identity/protocols/oauth2/scopes) moÅ¾ete pronaÄ‡i listu svih Google OAuth opsega.

* **cloud-platform**: Pregledajte i upravljajte svojim podacima Å¡irom **Google Cloud Platform** servisa. MoÅ¾ete se pretvarati da ste korisnik u GCP.
* **admin.directory.user.readonly**: Vidite i preuzmite direktorijum GSuite vaÅ¡e organizacije. Dobijate imena, telefone, URL-ove kalendara svih korisnika.

### Kreirajte OAuth aplikaciju

**ZapoÄnite kreiranje OAuth Client ID**

1. Idite na [https://console.cloud.google.com/apis/credentials/oauthclient](https://console.cloud.google.com/apis/credentials/oauthclient) i kliknite na konfiguraciju ekrana za pristanak.
2. Zatim, biÄ‡ete upitani da li je **tip korisnika** **interni** (samo za ljude u vaÅ¡oj organizaciji) ili **eksterni**. Izaberite onaj koji odgovara vaÅ¡im potrebama
* Interni moÅ¾e biti zanimljiv ako ste veÄ‡ kompromitovali korisnika organizacije i kreirate ovu aplikaciju da biste phishovali drugog.
3. Dajte **ime** aplikaciji, **email za podrÅ¡ku** (napomena: moÅ¾ete postaviti email googlegroup-a da biste pokuÅ¡ali da se malo viÅ¡e anonimno), **logo**, **ovlaÅ¡Ä‡ene domene** i drugi **email** za **aÅ¾uriranja**.
4. **Izaberite** **OAuth opsege**.
* Ova stranica je podeljena na neosetljive dozvole, osetljive dozvole i ograniÄene dozvole. Svaki put kada dodate novu dozvolu, ona se dodaje u svoju kategoriju. U zavisnosti od traÅ¾enih dozvola, razliÄiti upiti Ä‡e se pojaviti korisniku ukazujuÄ‡i koliko su te dozvole osetljive.
* I **`admin.directory.user.readonly`** i **`cloud-platform`** su osetljive dozvole.
5. **Dodajte test korisnike.** Dok je status aplikacije testiranje, samo Ä‡e ovi korisnici moÄ‡i da pristupe aplikaciji, pa se pobrinite da **dodate email koji Ä‡ete phishovati**.

Sada da dobijemo **akreditiv za web aplikaciju** koristeÄ‡i **prethodno kreirani OAuth Client ID**:

1. Vratite se na [https://console.cloud.google.com/apis/credentials/oauthclient](https://console.cloud.google.com/apis/credentials/oauthclient), ovoga puta Ä‡e se pojaviti druga opcija.
2. Izaberite da **kreirate akreditive za web aplikaciju**
3. Postavite potrebne **Javascript izvore** i **URI za preusmeravanje**
* MoÅ¾ete postaviti u oba neÅ¡to poput **`http://localhost:8000/callback`** za testiranje
4. Dobijte svoje akreditive za aplikaciju

Na kraju, hajde da **pokrenemo web aplikaciju koja Ä‡e koristiti akreditive OAuth aplikacije**. Primer moÅ¾ete pronaÄ‡i na [https://github.com/carlospolop/gcp\_oauth\_phishing\_example](https://github.com/carlospolop/gcp\_oauth\_phishing\_example).
```bash
git clone ttps://github.com/carlospolop/gcp_oauth_phishing_example
cd gcp_oauth_phishing_example
pip install flask requests google-auth-oauthlib
python3 app.py --client-id "<client_id>" --client-secret "<client_secret>"
```
Idite na **`http://localhost:8000`**, kliknite na dugme Prijavite se sa Google-om, biÄ‡ete **upitani** sa porukom poput ove:

<figure><img src="../../../.gitbook/assets/image (333).png" alt=""><figcaption></figcaption></figure>

Aplikacija Ä‡e prikazati **pristupni i osveÅ¾avajuÄ‡i token** koji se lako moÅ¾e koristiti. Za viÅ¡e informacija o **kako koristiti ove tokene proverite**:

{% content-ref url="../../gcp-security/gcp-persistence/gcp-non-svc-persistance.md" %}
[gcp-non-svc-persistance.md](../../gcp-security/gcp-persistence/gcp-non-svc-persistance.md)
{% endcontent-ref %}

#### KoriÅ¡Ä‡enje `glcoud`

MoguÄ‡e je uraditi neÅ¡to koristeÄ‡i gcloud umesto web konzole, proverite:

{% content-ref url="../../gcp-security/gcp-privilege-escalation/gcp-clientauthconfig-privesc.md" %}
[gcp-clientauthconfig-privesc.md](../../gcp-security/gcp-privilege-escalation/gcp-clientauthconfig-privesc.md)
{% endcontent-ref %}

## Reference

* [https://www.youtube-nocookie.com/embed/6AsVUS79gLw](https://www.youtube-nocookie.com/embed/6AsVUS79gLw) - Matthew Bryant - Hacking G Suite: The Power of Dark Apps Script Magic
* [https://www.youtube.com/watch?v=KTVHLolz6cE](https://www.youtube.com/watch?v=KTVHLolz6cE) - Mike Felch i Beau Bullock - OK Google, Kako da Red Team GSuite?

{% hint style="success" %}
UÄite i veÅ¾bajte AWS Hacking:<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
UÄite i veÅ¾bajte GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>PodrÅ¾ite HackTricks</summary>

* Proverite [**planove pretplate**](https://github.com/sponsors/carlospolop)!
* **PridruÅ¾ite se** ğŸ’¬ [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili **pratite** nas na **Twitter-u** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podelite hakerske trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
{% endhint %}
