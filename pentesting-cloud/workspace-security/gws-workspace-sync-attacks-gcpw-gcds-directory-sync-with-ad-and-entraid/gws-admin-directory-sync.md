# GWS - Admin Directory Sync

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Basic Information

Glavna razlika izmeÄ‘u ovog naÄina sinhronizacije korisnika sa GCDS je ta Å¡to se GCDS radi ruÄno sa nekim binarnim datotekama koje treba preuzeti i pokrenuti, dok je **Admin Directory Sync bez servera** i upravlja njime Google na [https://admin.google.com/ac/sync/externaldirectories](https://admin.google.com/ac/sync/externaldirectories).

U trenutku pisanja ovog teksta, ova usluga je u beta verziji i podrÅ¾ava 2 tipa sinhronizacije: iz **Active Directory** i iz **Azure Entra ID:**

* **Active Directory:** Da biste ovo postavili, morate dati **pristup Google-u vaÅ¡em Active Directory okruÅ¾enju**. Kako Google ima pristup samo GCP mreÅ¾ama (putem **VPC konektora**), potrebno je da kreirate konektor i zatim uÄinite svoj AD dostupnim iz tog konektora tako Å¡to Ä‡ete ga imati u VM-ovima u GCP mreÅ¾i ili koristeÄ‡i Cloud VPN ili Cloud Interconnect. TakoÄ‘e, potrebno je da obezbedite **akreditiv** naloga sa pristupom za Äitanje nad direktorijumom i **sertifikat** za kontakt putem **LDAPS**.
* **Azure Entra ID:** Da biste ovo konfigurisali, potrebno je samo da se **prijavite u Azure sa korisnikom koji ima pristup za Äitanje** nad Entra ID pretplatom u iskaÄuÄ‡em prozoru koji prikazuje Google, a Google Ä‡e zadrÅ¾ati token sa pristupom za Äitanje nad Entra ID.

Kada je ispravno konfigurisano, obe opcije Ä‡e omoguÄ‡iti **sinhronizaciju korisnika i grupa sa Workspace**, ali neÄ‡e omoguÄ‡iti konfiguraciju korisnika i grupa iz Workspace u AD ili EntraID.

Druge opcije koje Ä‡e omoguÄ‡iti tokom ove sinhronizacije su:

* Slanje e-poÅ¡te novim korisnicima za prijavu
* Automatska promena njihove adrese e-poÅ¡te na onu koju koristi Workspace. Dakle, ako Workspace koristi `@hacktricks.xyz`, a EntraID korisnici koriste `@carloshacktricks.onmicrosoft.com`, koristiÄ‡e se `@hacktricks.xyz` za korisnike kreirane u nalogu.
* Odabir **grupa koje sadrÅ¾e korisnike** koji Ä‡e biti sinhronizovani.
* Odabir **grupa** za sinhronizaciju i kreiranje u Workspace (ili oznaÄavanje za sinhronizaciju svih grupa).

### From AD/EntraID -> Google Workspace (& GCP)

Ako uspete da kompromitujete AD ili EntraID, imaÄ‡ete potpunu kontrolu nad korisnicima i grupama koje Ä‡e biti sinhronizovane sa Google Workspace.\
MeÄ‘utim, imajte na umu da **lozinke** koje korisnici moÅ¾da koriste u Workspace **mogu biti iste ili ne**.

#### Attacking users

Kada se sinhronizacija dogodi, moÅ¾e sinhronizovati **sve korisnike iz AD ili samo one iz specifiÄne OU** ili samo **korisnike Älanove specifiÄnih grupa u EntraID**. To znaÄi da da biste napali sinhronizovanog korisnika (ili kreirali novog koji se sinhronizuje), prvo Ä‡ete morati da otkrijete koji se korisnici sinhronizuju.

* Korisnici mogu **ponovo koristiti lozinku ili ne iz AD ili EntraID**, ali to znaÄi da Ä‡ete morati da **kompromitujete lozinke korisnika da biste se prijavili**.
* Ako imate pristup **mailovima** korisnika, mogli biste **promeniti Workspace lozinku postojeÄ‡eg korisnika**, ili **kreirati novog korisnika**, Äekati da se sinhronizuje i postaviti nalog.

Kada pristupite korisniku unutar Workspace, moÅ¾e mu biti dodeljeno nekoliko **dozvola po defaultu**.

#### Attacking Groups

TakoÄ‘e treba prvo da otkrijete koje se grupe sinhronizuju. Iako postoji moguÄ‡nost da se **SVE** grupe sinhronizuju (jer Workspace to omoguÄ‡ava).

{% hint style="info" %}
Napomena da Äak i ako su grupe i Älanstva uvezene u Workspace, **korisnici koji nisu sinhronizovani u sinhronizaciji korisnika neÄ‡e biti kreirani** tokom sinhronizacije grupa, Äak i ako su Älanovi bilo koje od sinhronizovanih grupa.
{% endhint %}

Ako znate koje grupe iz Azure su **dodeljene dozvole u Workspace ili GCP**, mogli biste jednostavno dodati kompromitovanog korisnika (ili novokreiranog) u tu grupu i dobiti te dozvole.

Postoji joÅ¡ jedna opcija za zloupotrebu postojeÄ‡ih privilegovanih grupa u Workspace. Na primer, grupa `gcp-organization-admins@<workspace.email>` obiÄno ima visoke privilegije nad GCP.

Ako je sinhronizacija iz, na primer, EntraID, u Workspace **konfigurisana da zameni domen** uvezenog objekta **sa email-om Workspace**, biÄ‡e moguÄ‡e da napadaÄ kreira grupu `gcp-organization-admins@<entraid.email>` u EntraID, doda korisnika u ovu grupu i Äeka da se sinhronizacija svih grupa dogodi.\
**Korisnik Ä‡e biti dodat u grupu `gcp-organization-admins@<workspace.email>` eskalirajuÄ‡i privilegije u GCP.**

### From Google Workspace -> AD/EntraID

Napomena da Workspace zahteva akreditive sa pristupom samo za Äitanje nad AD ili EntraID da bi sinhronizovao korisnike i grupe. Stoga, nije moguÄ‡e zloupotrebiti Google Workspace da bi se izvrÅ¡ila bilo kakva promena u AD ili EntraID. Dakle, **to nije moguÄ‡e** u ovom trenutku.

TakoÄ‘e ne znam gde Google Äuva AD akreditive ili EntraID token i ne moÅ¾ete ih povratiti ponovnom konfiguracijom sinhronizacije (ne pojavljuju se u web formi, morate ih ponovo uneti). MeÄ‘utim, putem web-a moÅ¾e biti moguÄ‡e zloupotrebiti trenutnu funkcionalnost da **prikazujete korisnike i grupe**.

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
