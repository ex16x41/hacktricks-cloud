# GWS - Admin Directory Sync

{% hint style="success" %}
Lernen & √ºben Sie AWS Hacking:<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
Lernen & √ºben Sie GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* √úberpr√ºfen Sie die [**Abonnementpl√§ne**](https://github.com/sponsors/carlospolop)!
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Teilen Sie Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repos senden.

</details>
{% endhint %}

## Grundinformationen

Der Hauptunterschied zwischen dieser Methode zur Synchronisierung von Benutzern mit GCDS besteht darin, dass GCDS manuell mit einigen Bin√§rdateien durchgef√ºhrt wird, die Sie herunterladen und ausf√ºhren m√ºssen, w√§hrend **Admin Directory Sync serverlos** von Google in [https://admin.google.com/ac/sync/externaldirectories](https://admin.google.com/ac/sync/externaldirectories) verwaltet wird.

Zum Zeitpunkt des Schreibens ist dieser Dienst in der Beta-Phase und unterst√ºtzt 2 Arten der Synchronisierung: Von **Active Directory** und von **Azure Entra ID:**

* **Active Directory:** Um dies einzurichten, m√ºssen Sie **Google Zugriff auf Ihre Active Directory-Umgebung gew√§hren**. Da Google nur Zugriff auf GCP-Netzwerke (√ºber **VPC-Connectoren**) hat, m√ºssen Sie einen Connector erstellen und dann Ihr AD √ºber diesen Connector verf√ºgbar machen, indem Sie es in VMs im GCP-Netzwerk haben oder Cloud VPN oder Cloud Interconnect verwenden. Dann m√ºssen Sie auch **Anmeldeinformationen** eines Kontos mit Lesezugriff auf das Verzeichnis und ein **Zertifikat** bereitstellen, um √ºber **LDAPS** zu kommunizieren.
* **Azure Entra ID:** Um dies zu konfigurieren, m√ºssen Sie sich einfach mit einem Benutzer mit Lesezugriff √ºber das Entra ID-Abonnement in einem von Google angezeigten Pop-up anmelden, und Google wird das Token mit Lesezugriff √ºber Entra ID speichern.

Sobald es korrekt konfiguriert ist, erm√∂glichen beide Optionen die **Synchronisierung von Benutzern und Gruppen mit Workspace**, jedoch nicht die Konfiguration von Benutzern und Gruppen von Workspace zu AD oder EntraID.

Weitere Optionen, die w√§hrend dieser Synchronisierung erlaubt sind:

* Senden Sie eine E-Mail an die neuen Benutzer, um sich anzumelden
* √Ñndern Sie automatisch ihre E-Mail-Adresse auf die von Workspace verwendete. Wenn Workspace also `@hacktricks.xyz` verwendet und EntraID-Benutzer `@carloshacktricks.onmicrosoft.com` verwenden, wird `@hacktricks.xyz` f√ºr die im Konto erstellten Benutzer verwendet.
* W√§hlen Sie die **Gruppen aus, die die Benutzer enthalten**, die synchronisiert werden sollen.
* W√§hlen Sie **Gruppen** aus, die synchronisiert und in Workspace erstellt werden sollen (oder geben Sie an, alle Gruppen zu synchronisieren).

### Von AD/EntraID -> Google Workspace (& GCP)

Wenn Sie es schaffen, ein AD oder EntraID zu kompromittieren, haben Sie die volle Kontrolle √ºber die Benutzer & Gruppen, die mit Google Workspace synchronisiert werden.\
Beachten Sie jedoch, dass die **Passw√∂rter**, die die Benutzer m√∂glicherweise in Workspace verwenden, **die gleichen oder unterschiedliche sein k√∂nnten**.

#### Angreifen von Benutzern

Wenn die Synchronisierung erfolgt, kann sie **alle Benutzer aus AD oder nur die aus einer bestimmten OU** oder nur die **Benutzer, die Mitglieder bestimmter Gruppen in EntraID sind**, synchronisieren. Das bedeutet, dass Sie, um einen synchronisierten Benutzer anzugreifen (oder einen neuen zu erstellen, der synchronisiert wird), zuerst herausfinden m√ºssen, welche Benutzer synchronisiert werden.

* Benutzer k√∂nnten **das Passwort von AD oder EntraID wiederverwenden oder nicht**, aber das bedeutet, dass Sie die **Passw√∂rter der Benutzer kompromittieren m√ºssen, um sich anzumelden**.
* Wenn Sie Zugriff auf die **E-Mails** der Benutzer haben, k√∂nnten Sie **das Workspace-Passwort eines vorhandenen Benutzers √§ndern** oder **einen neuen Benutzer erstellen**, warten, bis er synchronisiert wird, und das Konto einrichten.

Sobald Sie auf den Benutzer in Workspace zugreifen, k√∂nnten ihm einige **Berechtigungen standardm√§√üig** gew√§hrt werden.

#### Angreifen von Gruppen

Sie m√ºssen auch zuerst herausfinden, welche Gruppen synchronisiert werden. Obwohl die M√∂glichkeit besteht, dass **ALLE** Gruppen synchronisiert werden (da Workspace dies zul√§sst).

{% hint style="info" %}
Beachten Sie, dass selbst wenn die Gruppen und Mitgliedschaften in Workspace importiert werden, die **Benutzer, die nicht in der Benutzersynchronisierung synchronisiert werden, nicht erstellt werden** w√§hrend der Gruppensynchronisierung, selbst wenn sie Mitglieder einer der synchronisierten Gruppen sind.
{% endhint %}

Wenn Sie wissen, welche Gruppen aus Azure **Berechtigungen in Workspace oder GCP zugewiesen bekommen**, k√∂nnten Sie einfach einen kompromittierten Benutzer (oder neu erstellten) in diese Gruppe hinzuf√ºgen und diese Berechtigungen erhalten.

Es gibt eine weitere M√∂glichkeit, bestehende privilegierte Gruppen in Workspace auszunutzen. Zum Beispiel hat die Gruppe `gcp-organization-admins@<workspace.email>` normalerweise hohe Berechtigungen √ºber GCP.

Wenn die Synchronisierung von beispielsweise EntraID zu Workspace **so konfiguriert ist, dass die Domain** des importierten Objekts **mit der E-Mail von Workspace ersetzt wird**, wird es einem Angreifer m√∂glich sein, die Gruppe `gcp-organization-admins@<entraid.email>` in EntraID zu erstellen, einen Benutzer in dieser Gruppe hinzuzuf√ºgen und zu warten, bis die Synchronisierung aller Gruppen erfolgt.\
**Der Benutzer wird in die Gruppe `gcp-organization-admins@<workspace.email>` hinzugef√ºgt, wodurch die Berechtigungen in GCP eskaliert werden.**

### Von Google Workspace -> AD/EntraID

Beachten Sie, dass Workspace Anmeldeinformationen mit nur Lesezugriff auf AD oder EntraID ben√∂tigt, um Benutzer und Gruppen zu synchronisieren. Daher ist es nicht m√∂glich, Google Workspace auszunutzen, um √Ñnderungen in AD oder EntraID vorzunehmen. **Das ist derzeit nicht m√∂glich.**

Ich wei√ü auch nicht, wo Google die AD-Anmeldeinformationen oder das EntraID-Token speichert, und Sie **k√∂nnen sie nicht wiederherstellen, indem Sie die Synchronisierung neu konfigurieren** (sie erscheinen nicht im Webformular, Sie m√ºssen sie erneut angeben). Es k√∂nnte jedoch m√∂glich sein, die aktuelle Funktionalit√§t √ºber das Web auszunutzen, um **Benutzer und Gruppen aufzulisten**.

{% hint style="success" %}
Lernen & √ºben Sie AWS Hacking:<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
Lernen & √ºben Sie GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* √úberpr√ºfen Sie die [**Abonnementpl√§ne**](https://github.com/sponsors/carlospolop)!
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Teilen Sie Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repos senden.

</details>
{% endhint %}
