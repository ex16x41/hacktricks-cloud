# GWS - Admin Directory Sync

{% hint style="success" %}
Lerne & √ºbe AWS Hacking:<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Lerne & √ºbe GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* √úberpr√ºfe die [**Abonnementpl√§ne**](https://github.com/sponsors/carlospolop)!
* **Tritt der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folge** uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teile Hacking-Tricks, indem du PRs zu den** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repos einreichst.

</details>
{% endhint %}

## Grundinformationen

Der Hauptunterschied zwischen dieser Methode zur Synchronisierung von Benutzern mit GCDS besteht darin, dass GCDS manuell mit einigen Bin√§rdateien durchgef√ºhrt wird, die heruntergeladen und ausgef√ºhrt werden m√ºssen, w√§hrend **Admin Directory Sync serverlos** von Google in [https://admin.google.com/ac/sync/externaldirectories](https://admin.google.com/ac/sync/externaldirectories) verwaltet wird.

Zum Zeitpunkt des Schreibens ist dieser Dienst in der Beta-Phase und unterst√ºtzt 2 Arten der Synchronisierung: Von **Active Directory** und von **Azure Entra ID:**

* **Active Directory:** Um dies einzurichten, musst du **Google Zugriff auf deine Active Directory-Umgebung gew√§hren**. Da Google nur Zugriff auf GCP-Netzwerke (√ºber **VPC-Connectoren**) hat, musst du einen Connector erstellen und dann dein AD √ºber diesen Connector verf√ºgbar machen, indem du es in VMs im GCP-Netzwerk hast oder Cloud VPN oder Cloud Interconnect verwendest. Dann musst du auch **Anmeldeinformationen** eines Kontos mit Lesezugriff auf das Verzeichnis und ein **Zertifikat** bereitstellen, um √ºber **LDAPS** zu kommunizieren.
* **Azure Entra ID:** Um dies zu konfigurieren, ist es nur erforderlich, sich mit einem Benutzer mit Lesezugriff √ºber das Entra ID-Abonnement in einem von Google angezeigten Pop-up bei Azure anzumelden, und Google wird das Token mit Lesezugriff √ºber Entra ID speichern.

Sobald es korrekt konfiguriert ist, erm√∂glichen beide Optionen die **Synchronisierung von Benutzern und Gruppen mit Workspace**, jedoch nicht die Konfiguration von Benutzern und Gruppen von Workspace zu AD oder EntraID.

Weitere Optionen, die w√§hrend dieser Synchronisierung erm√∂glicht werden, sind:

* Sende eine E-Mail an die neuen Benutzer, um sich anzumelden
* √Ñndere automatisch ihre E-Mail-Adresse auf die von Workspace verwendete. Wenn Workspace also `@hacktricks.xyz` verwendet und EntraID-Benutzer `@carloshacktricks.onmicrosoft.com` verwenden, wird `@hacktricks.xyz` f√ºr die im Konto erstellten Benutzer verwendet.
* W√§hle die **Gruppen aus, die die Benutzer** enthalten, die synchronisiert werden sollen.
* W√§hle **Gruppen** zur Synchronisierung und Erstellung in Workspace aus (oder gib an, alle Gruppen zu synchronisieren).

### Von AD/EntraID -> Google Workspace (& GCP)

Wenn es dir gelingt, ein AD oder EntraID zu kompromittieren, hast du die volle Kontrolle √ºber die Benutzer & Gruppen, die mit Google Workspace synchronisiert werden.\
Beachte jedoch, dass die **Passw√∂rter**, die die Benutzer m√∂glicherweise in Workspace verwenden, **die gleichen sein k√∂nnten oder nicht**.

#### Angreifen von Benutzern

Wenn die Synchronisierung erfolgt, kann sie **alle Benutzer aus AD oder nur die aus einer bestimmten OU** oder nur die **Benutzer, die Mitglieder bestimmter Gruppen in EntraID sind**, synchronisieren. Das bedeutet, dass du, um einen synchronisierten Benutzer anzugreifen (oder einen neuen zu erstellen, der synchronisiert wird), zuerst herausfinden musst, welche Benutzer synchronisiert werden.

* Benutzer k√∂nnten **das Passwort von AD oder EntraID wiederverwenden oder nicht**, aber das bedeutet, dass du die **Passw√∂rter der Benutzer kompromittieren musst, um dich anzumelden**.
* Wenn du Zugriff auf die **E-Mails** der Benutzer hast, k√∂nntest du **das Workspace-Passwort eines bestehenden Benutzers √§ndern** oder **einen neuen Benutzer erstellen**, warten, bis er synchronisiert wird, und das Konto einrichten.

Sobald du auf den Benutzer in Workspace zugreifst, k√∂nnten ihm einige **Berechtigungen standardm√§√üig** gew√§hrt werden.

#### Angreifen von Gruppen

Du musst auch zuerst herausfinden, welche Gruppen synchronisiert werden. Obwohl die M√∂glichkeit besteht, dass **ALLE** Gruppen synchronisiert werden (da Workspace dies zul√§sst).

{% hint style="info" %}
Beachte, dass selbst wenn die Gruppen und Mitgliedschaften in Workspace importiert werden, die **Benutzer, die nicht in der Benutzersynchronisierung synchronisiert werden, nicht** w√§hrend der Gruppensynchronisierung erstellt werden, selbst wenn sie Mitglieder einer der synchronisierten Gruppen sind.
{% endhint %}

Wenn du wei√üt, welche Gruppen aus Azure **Berechtigungen in Workspace oder GCP zugewiesen bekommen**, k√∂nntest du einfach einen kompromittierten Benutzer (oder neu erstellten) in diese Gruppe hinzuf√ºgen und diese Berechtigungen erhalten.

Es gibt eine weitere M√∂glichkeit, bestehende privilegierte Gruppen in Workspace auszunutzen. Zum Beispiel hat die Gruppe `gcp-organization-admins@<workspace.email>` normalerweise hohe Berechtigungen √ºber GCP.

Wenn die Synchronisierung von beispielsweise EntraID zu Workspace **so konfiguriert ist, dass die Domain** des importierten Objekts **mit der E-Mail von Workspace ersetzt wird**, wird es einem Angreifer m√∂glich sein, die Gruppe `gcp-organization-admins@<entraid.email>` in EntraID zu erstellen, einen Benutzer in dieser Gruppe hinzuzuf√ºgen und zu warten, bis die Synchronisierung aller Gruppen erfolgt.\
**Der Benutzer wird in die Gruppe `gcp-organization-admins@<workspace.email>` hinzugef√ºgt, wodurch die Berechtigungen in GCP eskaliert werden.**

### Von Google Workspace -> AD/EntraID

Beachte, dass Workspace Anmeldeinformationen mit nur Lesezugriff auf AD oder EntraID ben√∂tigt, um Benutzer und Gruppen zu synchronisieren. Daher ist es nicht m√∂glich, Google Workspace auszunutzen, um √Ñnderungen in AD oder EntraID vorzunehmen. **Das ist momentan nicht m√∂glich.**

Ich wei√ü auch nicht, wo Google die AD-Anmeldeinformationen oder das EntraID-Token speichert, und du **kannst sie nicht wiederherstellen, indem du die Synchronisierung neu konfigurierst** (sie erscheinen nicht im Webformular, du musst sie erneut angeben). Es k√∂nnte jedoch m√∂glich sein, die aktuelle Funktionalit√§t √ºber das Web auszunutzen, um **Benutzer und Gruppen aufzulisten**.

{% hint style="success" %}
Lerne & √ºbe AWS Hacking:<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Lerne & √ºbe GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* √úberpr√ºfe die [**Abonnementpl√§ne**](https://github.com/sponsors/carlospolop)!
* **Tritt der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folge** uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teile Hacking-Tricks, indem du PRs zu den** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repos einreichst.

</details>
{% endhint %}
