# GWS - Admin Directory Sync

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## åŸºæœ¬ä¿¡æ¯

ä¸ä½¿ç”¨ GCDS åŒæ­¥ç”¨æˆ·çš„ä¸»è¦åŒºåˆ«åœ¨äºï¼ŒGCDS æ˜¯é€šè¿‡ä¸€äº›éœ€è¦ä¸‹è½½å’Œè¿è¡Œçš„äºŒè¿›åˆ¶æ–‡ä»¶æ‰‹åŠ¨å®Œæˆçš„ï¼Œè€Œ **Admin Directory Sync æ˜¯æ— æœåŠ¡å™¨çš„**ï¼Œç”± Google åœ¨ [https://admin.google.com/ac/sync/externaldirectories](https://admin.google.com/ac/sync/externaldirectories) ç®¡ç†ã€‚

åœ¨æ’°å†™æœ¬æ–‡æ—¶ï¼Œè¯¥æœåŠ¡å¤„äºæµ‹è¯•é˜¶æ®µï¼Œæ”¯æŒä¸¤ç§ç±»å‹çš„åŒæ­¥ï¼šæ¥è‡ª **Active Directory** å’Œ **Azure Entra IDï¼š**

* **Active Directoryï¼š** ä¸ºäº†è®¾ç½®æ­¤åŠŸèƒ½ï¼Œæ‚¨éœ€è¦**æˆäºˆ Google è®¿é—®æ‚¨çš„ Active Directory ç¯å¢ƒ**ã€‚ç”±äº Google ä»…èƒ½è®¿é—® GCP ç½‘ç»œï¼ˆé€šè¿‡ **VPC è¿æ¥å™¨**ï¼‰ï¼Œæ‚¨éœ€è¦åˆ›å»ºä¸€ä¸ªè¿æ¥å™¨ï¼Œç„¶åé€šè¿‡åœ¨ GCP ç½‘ç»œä¸­çš„è™šæ‹Ÿæœºæˆ–ä½¿ç”¨ Cloud VPN æˆ– Cloud Interconnectï¼Œä½¿æ‚¨çš„ AD å¯ç”¨ã€‚ç„¶åï¼Œæ‚¨è¿˜éœ€è¦æä¾›å…·æœ‰è¯»å–ç›®å½•æƒé™çš„å¸æˆ·çš„ **å‡­æ®** å’Œ **è¯ä¹¦** ä»¥é€šè¿‡ **LDAPS** è¿›è¡Œè”ç³»ã€‚
* **Azure Entra IDï¼š** é…ç½®æ­¤åŠŸèƒ½åªéœ€åœ¨ Google æ˜¾ç¤ºçš„å¼¹å‡ºçª—å£ä¸­**ä½¿ç”¨å…·æœ‰è¯»å–æƒé™çš„ç”¨æˆ·ç™»å½• Azure**ï¼ŒGoogle å°†ä¿ç•™å¯¹ Entra ID çš„è¯»å–æƒé™çš„ä»¤ç‰Œã€‚

ä¸€æ—¦æ­£ç¡®é…ç½®ï¼Œè¿™ä¸¤ç§é€‰é¡¹éƒ½å°†å…è®¸**å°†ç”¨æˆ·å’Œç»„åŒæ­¥åˆ° Workspace**ï¼Œä½†ä¸å…è®¸ä» Workspace é…ç½®ç”¨æˆ·å’Œç»„åˆ° AD æˆ– EntraIDã€‚

åœ¨æ­¤åŒæ­¥è¿‡ç¨‹ä¸­è¿˜å…è®¸å…¶ä»–é€‰é¡¹ï¼š

* å‘æ–°ç”¨æˆ·å‘é€ç”µå­é‚®ä»¶ä»¥ç™»å½•
* è‡ªåŠ¨å°†ä»–ä»¬çš„ç”µå­é‚®ä»¶åœ°å€æ›´æ”¹ä¸º Workspace ä½¿ç”¨çš„åœ°å€ã€‚å› æ­¤ï¼Œå¦‚æœ Workspace ä½¿ç”¨ `@hacktricks.xyz`ï¼Œè€Œ EntraID ç”¨æˆ·ä½¿ç”¨ `@carloshacktricks.onmicrosoft.com`ï¼Œåˆ™åœ¨å¸æˆ·ä¸­åˆ›å»ºçš„ç”¨æˆ·å°†ä½¿ç”¨ `@hacktricks.xyz`ã€‚
* é€‰æ‹©**åŒ…å«å°†è¢«åŒæ­¥çš„ç”¨æˆ·çš„ç»„**ã€‚
* é€‰æ‹©è¦åœ¨ Workspace ä¸­åŒæ­¥å’Œåˆ›å»ºçš„**ç»„**ï¼ˆæˆ–æŒ‡ç¤ºåŒæ­¥æ‰€æœ‰ç»„ï¼‰ã€‚

### ä» AD/EntraID -> Google Workspace (& GCP)

å¦‚æœæ‚¨æˆåŠŸæ”»é™·äº† AD æˆ– EntraIDï¼Œæ‚¨å°†å®Œå…¨æ§åˆ¶å°†ä¸ Google Workspace åŒæ­¥çš„ç”¨æˆ·å’Œç»„ã€‚\
ä½†æ˜¯ï¼Œè¯·æ³¨æ„ï¼Œç”¨æˆ·åœ¨ Workspace ä¸­å¯èƒ½ä½¿ç”¨çš„ **å¯†ç ** **å¯èƒ½ç›¸åŒï¼Œä¹Ÿå¯èƒ½ä¸åŒ**ã€‚

#### æ”»å‡»ç”¨æˆ·

å½“åŒæ­¥å‘ç”Ÿæ—¶ï¼Œå®ƒå¯èƒ½ä¼šåŒæ­¥ **æ¥è‡ª AD çš„æ‰€æœ‰ç”¨æˆ·æˆ–ä»…æ¥è‡ªç‰¹å®š OU çš„ç”¨æˆ·**ï¼Œæˆ–ä»… **EntraID ä¸­ç‰¹å®šç»„çš„æˆå‘˜ç”¨æˆ·**ã€‚è¿™æ„å‘³ç€è¦æ”»å‡»ä¸€ä¸ªå·²åŒæ­¥çš„ç”¨æˆ·ï¼ˆæˆ–åˆ›å»ºä¸€ä¸ªæ–°çš„è¢«åŒæ­¥çš„ç”¨æˆ·ï¼‰ï¼Œæ‚¨éœ€è¦é¦–å…ˆå¼„æ¸…æ¥šå“ªäº›ç”¨æˆ·æ­£åœ¨è¢«åŒæ­¥ã€‚

* ç”¨æˆ·å¯èƒ½åœ¨ AD æˆ– EntraID ä¸­**é‡ç”¨å¯†ç ï¼Œä¹Ÿå¯èƒ½ä¸é‡ç”¨**ï¼Œä½†è¿™æ„å‘³ç€æ‚¨éœ€è¦**æ”»é™·ç”¨æˆ·çš„å¯†ç ä»¥ç™»å½•**ã€‚
* å¦‚æœæ‚¨å¯ä»¥è®¿é—®ç”¨æˆ·çš„ **é‚®ä»¶**ï¼Œæ‚¨å¯ä»¥**æ›´æ”¹ç°æœ‰ç”¨æˆ·çš„ Workspace å¯†ç **ï¼Œæˆ–**åˆ›å»ºä¸€ä¸ªæ–°ç”¨æˆ·**ï¼Œç­‰å¾…å…¶è¢«åŒæ­¥å¹¶è®¾ç½®å¸æˆ·ã€‚

ä¸€æ—¦æ‚¨è®¿é—®äº† Workspace ä¸­çš„ç”¨æˆ·ï¼Œå¯èƒ½ä¼šé»˜è®¤æˆäºˆä¸€äº› **æƒé™**ã€‚

#### æ”»å‡»ç»„

æ‚¨è¿˜éœ€è¦é¦–å…ˆå¼„æ¸…æ¥šå“ªäº›ç»„æ­£åœ¨è¢«åŒæ­¥ã€‚å°½ç®¡æœ‰å¯èƒ½**æ‰€æœ‰**ç»„éƒ½åœ¨è¢«åŒæ­¥ï¼ˆå› ä¸º Workspace å…è®¸è¿™æ ·åšï¼‰ã€‚

{% hint style="info" %}
è¯·æ³¨æ„ï¼Œå³ä½¿ç»„å’Œæˆå‘˜èµ„æ ¼è¢«å¯¼å…¥åˆ° Workspaceï¼Œ**åœ¨ç”¨æˆ·åŒæ­¥ä¸­æœªåŒæ­¥çš„ç”¨æˆ·åœ¨ç»„åŒæ­¥æœŸé—´ä¹Ÿä¸ä¼šè¢«åˆ›å»º**ï¼Œå³ä½¿ä»–ä»¬æ˜¯ä»»ä½•åŒæ­¥ç»„çš„æˆå‘˜ã€‚
{% endhint %}

å¦‚æœæ‚¨çŸ¥é“å“ªäº›æ¥è‡ª Azure çš„ç»„åœ¨ **Workspace æˆ– GCP ä¸­è¢«åˆ†é…æƒé™**ï¼Œæ‚¨å¯ä»¥å°†ä¸€ä¸ªè¢«æ”»é™·çš„ç”¨æˆ·ï¼ˆæˆ–æ–°åˆ›å»ºçš„ç”¨æˆ·ï¼‰æ·»åŠ åˆ°è¯¥ç»„ä¸­ï¼Œä»è€Œè·å¾—è¿™äº›æƒé™ã€‚

è¿˜æœ‰å¦ä¸€ç§æ–¹æ³•å¯ä»¥æ»¥ç”¨ Workspace ä¸­ç°æœ‰çš„ç‰¹æƒç»„ã€‚ä¾‹å¦‚ï¼Œç»„ `gcp-organization-admins@<workspace.email>` é€šå¸¸åœ¨ GCP ä¸­å…·æœ‰é«˜æƒé™ã€‚

å¦‚æœä» EntraID åˆ° Workspace çš„åŒæ­¥**é…ç½®ä¸ºç”¨ Workspace çš„ç”µå­é‚®ä»¶æ›¿æ¢å¯¼å…¥å¯¹è±¡çš„åŸŸ**ï¼Œæ”»å‡»è€…å°†èƒ½å¤Ÿåœ¨ EntraID ä¸­åˆ›å»ºç»„ `gcp-organization-admins@<entraid.email>`ï¼Œå°†ç”¨æˆ·æ·»åŠ åˆ°è¯¥ç»„ä¸­ï¼Œå¹¶ç­‰å¾…æ‰€æœ‰ç»„çš„åŒæ­¥å‘ç”Ÿã€‚\
**è¯¥ç”¨æˆ·å°†è¢«æ·»åŠ åˆ°ç»„ `gcp-organization-admins@<workspace.email>` ä¸­ï¼Œä»è€Œåœ¨ GCP ä¸­æå‡æƒé™ã€‚**

### ä» Google Workspace -> AD/EntraID

è¯·æ³¨æ„ï¼ŒWorkspace éœ€è¦å…·æœ‰å¯¹ AD æˆ– EntraID çš„åªè¯»è®¿é—®æƒé™çš„å‡­æ®ä»¥åŒæ­¥ç”¨æˆ·å’Œç»„ã€‚å› æ­¤ï¼Œæ— æ³•æ»¥ç”¨ Google Workspace å¯¹ AD æˆ– EntraID è¿›è¡Œä»»ä½•æ›´æ”¹ã€‚å› æ­¤ï¼Œ**æ­¤æ—¶ä¸å¯è¡Œ**ã€‚

æˆ‘ä¹Ÿä¸çŸ¥é“ Google å°† AD å‡­æ®æˆ– EntraID ä»¤ç‰Œå­˜å‚¨åœ¨å“ªé‡Œï¼Œæ‚¨**æ— æ³•é€šè¿‡é‡æ–°é…ç½®åŒæ­¥æ¥æ¢å¤å®ƒä»¬**ï¼ˆå®ƒä»¬ä¸ä¼šå‡ºç°åœ¨ç½‘é¡µè¡¨å•ä¸­ï¼Œæ‚¨éœ€è¦å†æ¬¡æä¾›ï¼‰ã€‚ä½†æ˜¯ï¼Œä»ç½‘é¡µä¸Šå¯èƒ½å¯ä»¥æ»¥ç”¨å½“å‰åŠŸèƒ½æ¥**åˆ—å‡ºç”¨æˆ·å’Œç»„**ã€‚

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
