# GWS - Persistence

{% hint style="success" %}
Jifunze na fanya mazoezi ya AWS Hacking:<img src="../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
Jifunze na fanya mazoezi ya GCP Hacking: <img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Angalia [**mpango wa usajili**](https://github.com/sponsors/carlospolop)!
* **Jiunge na** üí¨ [**kikundi cha Discord**](https://discord.gg/hRep4RUj7f) au [**kikundi cha telegram**](https://t.me/peass) au **tufuatilie** kwenye **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Shiriki mbinu za hacking kwa kuwasilisha PRs kwa** [**HackTricks**](https://github.com/carlospolop/hacktricks) na [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

{% hint style="danger" %}
Vitendo vyote vilivyotajwa katika sehemu hii vinavyobadilisha mipangilio vitasababisha **arifa za usalama kwa barua pepe na hata arifa za kusukuma kwa simu yoyote iliyosawazishwa** na akaunti.
{% endhint %}

## **Persistence in Gmail**

* Unaweza kuunda **filters ili kuficha** arifa za usalama kutoka Google
* `from: (no-reply@accounts.google.com) "Security Alert"`
* Hii itazuia barua pepe za usalama kufika kwenye barua pepe (lakini haitazuia arifa za kusukuma kufika kwenye simu)

<details>

<summary>Hatua za kuunda filter ya gmail</summary>

(Maelekezo kutoka [**hapa**](https://support.google.com/mail/answer/6579))

1. Fungua [Gmail](https://mail.google.com/).
2. Katika kisanduku cha utafutaji juu, bonyeza Onyesha chaguzi za utafutaji ![photos tune](https://lh3.googleusercontent.com/cD6YR_YvqXqNKxrWn2NAWkV6tjJtg8vfvqijKT1_9zVCrl2sAx9jROKhLqiHo2ZDYTE=w36).
3. Ingiza vigezo vyako vya utafutaji. Ikiwa unataka kuangalia kama utafutaji wako umefanya kazi vizuri, angalia ni barua pepe zipi zinaonekana kwa kubonyeza **Tafuta**.
4. Chini ya dirisha la utafutaji, bonyeza **Unda filter**.
5. Chagua unachotaka filter ifanye.
6. Bonyeza **Unda filter**.

Angalia filter yako ya sasa (ili kuifuta) katika [https://mail.google.com/mail/u/0/#settings/filters](https://mail.google.com/mail/u/0/#settings/filters)

</details>

<figure><img src="../../.gitbook/assets/image (331).png" alt=""><figcaption></figcaption></figure>

* Unda **anwani ya kupeleka ili kupeleka taarifa nyeti** (au kila kitu) - Unahitaji ufikiaji wa mikono.
* Unda anwani ya kupeleka katika [https://mail.google.com/mail/u/2/#settings/fwdandpop](https://mail.google.com/mail/u/2/#settings/fwdandpop)
* Anwani ya kupokea itahitaji kuthibitisha hii
* Kisha, weka kupeleka barua pepe zote huku ukihifadhi nakala (kumbuka kubonyeza kuhifadhi mabadiliko):

<figure><img src="../../.gitbook/assets/image (332).png" alt=""><figcaption></figcaption></figure>

Pia inawezekana kuunda filters na kupeleka barua pepe maalum tu kwa anwani nyingine ya barua pepe.

## App passwords

Ikiwa umeweza **kudhoofisha kikao cha mtumiaji wa google** na mtumiaji alikuwa na **2FA**, unaweza **kuunda** [**nenosiri la programu**](https://support.google.com/accounts/answer/185833?hl=en) (fuata kiungo kuona hatua). Kumbuka kwamba **Nenosiri za programu hazipendekezwi tena na Google na zinatenguliwa** wakati mtumiaji **anabadilisha nenosiri lake la Akaunti ya Google.**

**Hata kama una kikao wazi, utahitaji kujua nenosiri la mtumiaji ili kuunda nenosiri la programu.**

{% hint style="info" %}
Nenosiri za programu zinaweza **kutumika tu na akaunti ambazo zina 2-Step Verification** zimewashwa.
{% endhint %}

## Badilisha 2-FA na mambo mengine

Pia inawezekana **kuzimisha 2-FA au kujiandikisha kifaa kipya** (au nambari ya simu) katika ukurasa huu [**https://myaccount.google.com/security**](https://myaccount.google.com/security)**.**\
**Pia inawezekana kuunda funguo za kupita (ongeza kifaa chako mwenyewe), kubadilisha nenosiri, kuongeza nambari za simu kwa simu za uthibitishaji na urejelezi, kubadilisha barua pepe ya urejelezi na kubadilisha maswali ya usalama).**

{% hint style="danger" %}
Ili **kuzuia arifa za usalama za kusukuma** kufika kwenye simu ya mtumiaji, unaweza **kumsajili nje smartphone yake** (ingawa hiyo itakuwa ya ajabu) kwa sababu huwezi kumuingiza tena kutoka hapa.

Pia inawezekana **kufuatilia kifaa.**
{% endhint %}

**Hata kama una kikao wazi, utahitaji kujua nenosiri la mtumiaji ili kubadilisha mipangilio hii.**

## Persistence via OAuth Apps

Ikiwa umeweza **kudhoofisha akaunti ya mtumiaji,** unaweza tu **kukubali** kutoa ruhusa zote zinazowezekana kwa **OAuth App**. Tatizo pekee ni kwamba Workspace inaweza kuanzishwa ili **kuzuia programu za nje zisizokaguliwa na/au za ndani.**\
Ni kawaida kwa Mashirika ya Workspace kutokuwa na imani kwa default kwa programu za nje za OAuth lakini kuamini zile za ndani, hivyo ikiwa una **ruhusa za kutosha kuunda programu mpya ya OAuth** ndani ya shirika na programu za nje zimezuiliwa, unda hiyo na **tumia programu hiyo mpya ya ndani ya OAuth ili kudumisha uthabiti**.

Angalia ukurasa ufuatao kwa maelezo zaidi kuhusu OAuth Apps:

{% content-ref url="gws-google-platforms-phishing/" %}
[gws-google-platforms-phishing](gws-google-platforms-phishing/)
{% endcontent-ref %}

## Persistence via delegation

Unaweza tu **kugawa akaunti** kwa akaunti tofauti inayodhibitiwa na mshambuliaji (ikiwa unaruhusiwa kufanya hivyo). Katika Mashirika ya Workspace **chaguo hili lazima liwe** **limewashwa**. Inaweza kuzuiliwa kwa kila mtu, kuanzishwa kutoka kwa watumiaji/vikundi fulani au kwa kila mtu (kawaida inakuwa imewashwa tu kwa watumiaji/vikundi fulani au kuzuiliwa kabisa).

<details>

<summary>Iwewe ni msimamizi wa Workspace angalia hapa ili kuanzisha kipengele</summary>

(Maelezo [yaliyokopwa kutoka kwenye nyaraka](https://support.google.com/a/answer/7223765))

Kama msimamizi wa shirika lako (kwa mfano, kazi yako au shule), unadhibiti ikiwa watumiaji wanaweza kugawa ufikiaji wa akaunti zao za Gmail. Unaweza kuruhusu kila mtu kuwa na chaguo la kugawa akaunti zao. Au, ruhusu watu katika idara fulani kuanzisha ugawaji. Kwa mfano, unaweza:

* Ongeza msaidizi wa kiutawala kama mwakilishi kwenye akaunti yako ya Gmail ili waweze kusoma na kutuma barua pepe kwa niaba yako.
* Ongeza kundi, kama idara yako ya mauzo, katika Vikundi kama mwakilishi ili kuwapa kila mtu ufikiaji wa akaunti moja ya Gmail.

Watumiaji wanaweza tu kugawa ufikiaji kwa mtumiaji mwingine katika shirika moja, bila kujali kikoa chao au kitengo chao cha shirika.

#### Mipaka na vizuizi vya ugawaji

* **Ruhusu watumiaji kutoa ufikiaji wa sanduku lao la barua kwa kundi la Google** chaguo: Ili kutumia chaguo hili, lazima iwe imewashwa kwa OU ya akaunti iliyogawiwa na kwa kila mwanachama wa kundi la OU. Wanachama wa kundi ambao ni sehemu ya OU bila chaguo hili limewashwa hawawezi kufikia akaunti iliyogawiwa.
* Kwa matumizi ya kawaida, watumiaji 40 waliogawiwa wanaweza kufikia akaunti ya Gmail kwa wakati mmoja. Matumizi ya juu ya wastani na mmoja au zaidi ya wawakilishi yanaweza kupunguza nambari hii.
* Mchakato wa kiotomatiki ambao mara kwa mara unafikia Gmail pia unaweza kupunguza idadi ya wawakilishi wanaoweza kufikia akaunti kwa wakati mmoja. Mchakato haya ni pamoja na APIs au nyongeza za kivinjari zinazofikia Gmail mara kwa mara.
* Akaunti moja ya Gmail inasaidia hadi wawakilishi 1,000 pekee. Kundi katika Vikundi kinahesabiwa kama mwakilishi mmoja kuelekea kikomo.
* Ugawaji hauongeza mipaka kwa akaunti ya Gmail. Akaunti za Gmail zenye watumiaji waliogawiwa zina mipaka na sera za kawaida za akaunti ya Gmail. Kwa maelezo zaidi, tembelea [Mipaka na sera za Gmail](https://support.google.com/a/topic/28609).

#### Hatua ya 1: Washa ugawaji wa Gmail kwa watumiaji wako

**Kabla hujaanza:** Ili kutekeleza mipangilio kwa watumiaji fulani, weka akaunti zao katika [kitengo cha shirika](https://support.google.com/a/topic/1227584).

1.  [Ingia](https://admin.google.com/) kwenye [Google Admin console](https://support.google.com/a/answer/182076).

Ingia kwa kutumia akaunti _ya msimamizi_, si akaunti yako ya sasa CarlosPolop@gmail.com
2. Katika console ya Admin, nenda kwenye Menyu ![](https://storage.googleapis.com/support-kms-prod/JxKYG9DqcsormHflJJ8Z8bHuyVI5YheC0lAp)![na kisha](https://storage.googleapis.com/support-kms-prod/Th2Tx0uwPMOhsMPn7nRXMUo3vs6J0pto2DTn)![](https://storage.googleapis.com/support-kms-prod/ocGtUSENh4QebLpvZcmLcNRZyaTBcolMRSyl) **Apps**![na kisha](https://storage.googleapis.com/support-kms-prod/Th2Tx0uwPMOhsMPn7nRXMUo3vs6J0pto2DTn)**Google Workspace**![na kisha](https://storage.googleapis.com/support-kms-prod/Th2Tx0uwPMOhsMPn7nRXMUo3vs6J0pto2DTn)**Gmail**![na kisha](https://storage.googleapis.com/support-kms-prod/Th2Tx0uwPMOhsMPn7nRXMUo3vs6J0pto2DTn)**Mipangilio ya mtumiaji**.
3. Ili kutekeleza mipangilio kwa kila mtu, acha kitengo cha juu cha shirika kikiwa kimechaguliwa. Vinginevyo, chagua [kitengo cha shirika](https://support.google.com/a/topic/1227584) cha mtoto.
4. Bonyeza **Ugawaji wa Barua**.
5. Angalia kisanduku cha **Ruhusu watumiaji kugawa ufikiaji wa sanduku lao la barua kwa watumiaji wengine katika kikoa**.
6. (Hiari) Ili kuruhusu watumiaji kubaini ni taarifa zipi za mtumaji zinazojumuishwa katika ujumbe wa ugawaji unaotumwa kutoka kwa akaunti yao, angalia kisanduku cha **Ruhusu watumiaji kubinafsisha mipangilio hii**.
7. Chagua chaguo kwa taarifa za mtumaji wa kawaida zinazojumuishwa katika ujumbe unaotumwa na wawakilishi:
* **Onyesha mmiliki wa akaunti na mwakilishi aliyemtuma barua pepe**‚ÄîUjumbe unajumuisha anwani za barua pepe za mmiliki wa akaunti ya Gmail na mwakilishi.
* **Onyesha mmiliki wa akaunti pekee**‚ÄîUjumbe unajumuisha anwani ya barua pepe ya mmiliki wa akaunti ya Gmail pekee. Anwani ya barua pepe ya mwakilishi haijajumuishwa.
8. (Hiari) Ili kuruhusu watumiaji kuongeza kundi katika Vikundi kama mwakilishi, angalia kisanduku cha **Ruhusu watumiaji kutoa ufikiaji wa sanduku lao la barua kwa kundi la Google**.
9. Bonyeza **Hifadhi**. Ikiwa umeanzisha kitengo cha shirika cha mtoto, unaweza kuwa na uwezo wa **Kurithi** au **Kukataa** mipangilio ya kitengo cha shirika cha mzazi.
10. (Hiari) Ili kuwasha ugawaji wa Gmail kwa vitengo vingine vya shirika, rudia hatua 3‚Äì9.

Mabadiliko yanaweza kuchukua hadi masaa 24 lakini kawaida hutokea haraka zaidi. [Jifunze zaidi](https://support.google.com/a/answer/7514107)

#### Hatua ya 2: Wape watumiaji kuanzisha wawakilishi kwa akaunti zao

Baada ya kuwasha ugawaji, watumiaji wako wanaenda kwenye mipangilio yao ya Gmail ili kuwateua wawakilishi. Wawakilishi wanaweza kisha kusoma, kutuma, na kupokea ujumbe kwa niaba ya mtumiaji.

Kwa maelezo zaidi, waelekeze watumiaji kwenye [Gawa na ushirikiane kwenye barua pepe](https://support.google.com/a/users/answer/138350).

</details>

<details>

<summary>Kutoka kwa mtumiaji wa kawaida, angalia hapa maelekezo ya kujaribu kugawa ufikiaji wako</summary>

(Maelezo yaliyokopwa [**kutoka kwenye nyaraka**](https://support.google.com/mail/answer/138350))

Unaweza kuongeza hadi wawakilishi 10.

Ikiwa unatumia Gmail kupitia kazi yako, shule, au shirika lingine:

* Unaweza kuongeza hadi wawakilishi 1000 ndani ya shirika lako.
* Kwa matumizi ya kawaida, wawakilishi 40 wanaweza kufikia akaunti ya Gmail kwa wakati mmoja.
* Ikiwa unatumia michakato ya kiotomatiki, kama APIs au nyongeza za kivinjari, wawakilishi wachache wanaweza kufikia akaunti ya Gmail kwa wakati mmoja.

1. Katika kompyuta yako, fungua [Gmail](https://mail.google.com/). Huwezi kuongeza wawakilishi kutoka kwenye programu ya Gmail.
2. Katika kona ya juu kulia, bonyeza Mipangilio ![Settings](https://lh3.googleusercontent.com/p3J-ZSPOLtuBBR_ofWTFDfdgAYQgi8mR5c76ie8XQ2wjegk7-yyU5zdRVHKybQgUlQ=w36-h36) ![na kisha](https://lh3.googleusercontent.com/3_l97rr0GvhSP2XV5OoCkV2ZDTIisAOczrSdzNCBxhIKWrjXjHucxNwocghoUa39gw=w36-h36) **Tazama mipangilio yote**.
3. Bonyeza tab ya **Akaunti na Uagizaji** au **Akaunti**.
4. Katika sehemu ya "Toa ufikiaji kwa akaunti yako", bonyeza **Ongeza akaunti nyingine**. Ikiwa unatumia Gmail kupitia kazi yako au shule, shirika lako linaweza kuzuia ugawaji wa barua pepe. Ikiwa huoni mipangilio hii, wasiliana na msimamizi wako.
* Ikiwa huoni Toa ufikiaji kwa akaunti yako, basi imezuiliwa.
5. Ingiza anwani ya barua pepe ya mtu unayetaka kuongeza. Ikiwa unatumia Gmail kupitia kazi yako, shule, au shirika lingine, na msimamizi wako anaruhusu, unaweza kuingiza anwani ya barua pepe ya kundi. Kundi hili lazima liwe na kikoa sawa na shirika lako. Wanachama wa nje wa kundi wanakabiliwa na ufikiaji wa ugawaji.\
\
**Muhimu:** Ikiwa akaunti unayogawa ni akaunti mpya au nenosiri limebadilishwa, Msimamizi lazima azime sharti la kubadilisha nenosiri unapojisajili mara ya kwanza.

* [Jifunze jinsi Msimamizi anaweza kuunda mtumiaji](https://support.google.com/a/answer/33310).
* [Jifunze jinsi Msimamizi anaweza kubadilisha nenosiri](https://support.google.com/a/answer/33319).

6\. Bonyeza **Hatua inayofuata** ![na kisha](https://lh3.googleusercontent.com/QbWcYKta5vh_4-OgUeFmK-JOB0YgLLoGh69P478nE6mKdfpWQniiBabjF7FVoCVXI0g=h36) **Tuma barua pepe ili kutoa ufikiaji**.

Mtu uliyemongeza atapata barua pepe ikimuuliza kuthibitisha. Mwaliko unakoma baada ya wiki moja.

Ikiwa umeongeza kundi, wanachama wote wa kundi watakuwa wawakilishi bila haja ya kuthibitisha.

Kumbuka: Inaweza kuchukua hadi masaa 24 kwa ugawaji kuanza kufanya kazi.

</details>

## Persistence via Android App

Ikiwa una **kikao ndani ya akaunti ya google ya waathiriwa** unaweza kuvinjari kwenye **Play Store** na huenda ukawa na uwezo wa **kusanidi malware** uliyopakia tayari kwenye duka moja kwa moja **kwenye simu** ili kudumisha uthabiti na kupata ufikiaji wa simu ya waathiriwa.

## **Persistence via** App Scripts

Unaweza kuunda **vichocheo vya muda** katika App Scripts, hivyo ikiwa App Script itakubaliwa na mtumiaji, itakuwa **imechochewa** hata **bila mtumiaji kuifikia**. Kwa maelezo zaidi kuhusu jinsi ya kufanya hivi angalia:

{% content-ref url="gws-google-platforms-phishing/gws-app-scripts.md" %}
[gws-app-scripts.md](gws-google-platforms-phishing/gws-app-scripts.md)
{% endcontent-ref %}

## References

* [https://www.youtube-nocookie.com/embed/6AsVUS79gLw](https://www.youtube-nocookie.com/embed/6AsVUS79gLw) - Matthew Bryant - Hacking G Suite: The Power of Dark Apps Script Magic
* [https://www.youtube.com/watch?v=KTVHLolz6cE](https://www.youtube.com/watch?v=KTVHLolz6cE) - Mike Felch na Beau Bullock - OK Google, Je, naweza vipi Red Team GSuite?

{% hint style="success" %}
Jifunze na fanya mazoezi ya AWS Hacking:<img src="../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
Jifunze na fanya mazoezi ya GCP Hacking: <img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Angalia [**mpango wa usajili**](https://github.com/sponsors/carlospolop)!
* **Jiunge na** üí¨ [**kikundi cha Discord**](https://discord.gg/hRep4RUj7f) au [**kikundi cha telegram**](https://t.me/peass) au **tufuatilie** kwenye **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Shiriki mbinu za hacking kwa kuwasilisha PRs kwa** [**HackTricks**](https://github.com/carlospolop/hacktricks) na [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
