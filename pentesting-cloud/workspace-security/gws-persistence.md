# GWS - Persistence

{% hint style="success" %}
UÄite i veÅ¾bajte AWS Hacking:<img src="../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
UÄite i veÅ¾bajte GCP Hacking: <img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>PodrÅ¾ite HackTricks</summary>

* Proverite [**planove pretplate**](https://github.com/sponsors/carlospolop)!
* **PridruÅ¾ite se** ğŸ’¬ [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili **pratite** nas na **Twitteru** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Podelite hakerske trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
{% endhint %}

{% hint style="danger" %}
Sve radnje navedene u ovom odeljku koje menjaju postavke generisaÄ‡e **bezbednosno obaveÅ¡tenje na email i Äak push obaveÅ¡tenje na bilo koji mobilni ureÄ‘aj sinhronizovan** sa nalogom.
{% endhint %}

## **Persistencija u Gmail-u**

* MoÅ¾ete kreirati **filtre za skrivanje** bezbednosnih obaveÅ¡tenja od Google-a
* `from: (no-reply@accounts.google.com) "Security Alert"`
* Ovo Ä‡e spreÄiti da bezbednosni emailovi stignu na email (ali neÄ‡e spreÄiti push obaveÅ¡tenja na mobilni)

<details>

<summary>Koraci za kreiranje gmail filtera</summary>

(Uputstva [**ovde**](https://support.google.com/mail/answer/6579))

1. Otvorite [Gmail](https://mail.google.com/).
2. U pretraÅ¾ivaÄu na vrhu, kliknite na PrikaÅ¾i opcije pretrage ![photos tune](https://lh3.googleusercontent.com/cD6YR_YvqXqNKxrWn2NAWkV6tjJtg8vfvqijKT1_9zVCrl2sAx9jROKhLqiHo2ZDYTE=w36).
3. Unesite svoje kriterijume pretrage. Ako Å¾elite da proverite da li je vaÅ¡a pretraga ispravno funkcionisala, pogledajte koji emailovi se pojavljuju klikom na **PretraÅ¾i**.
4. Na dnu prozora pretrage, kliknite na **Kreiraj filter**.
5. Izaberite Å¡ta Å¾elite da filter radi.
6. Kliknite na **Kreiraj filter**.

Proverite svoj trenutni filter (da ih obriÅ¡ete) na [https://mail.google.com/mail/u/0/#settings/filters](https://mail.google.com/mail/u/0/#settings/filters)

</details>

<figure><img src="../../.gitbook/assets/image (331).png" alt=""><figcaption></figcaption></figure>

* Kreirajte **adresu za prosleÄ‘ivanje kako biste prosledili osetljive informacije** (ili sve) - Potrebno je ruÄno pristupiti.
* Kreirajte adresu za prosleÄ‘ivanje na [https://mail.google.com/mail/u/2/#settings/fwdandpop](https://mail.google.com/mail/u/2/#settings/fwdandpop)
* Primalac Ä‡e morati da potvrdi ovo
* Zatim, postavite da prosledite sve emailove dok zadrÅ¾avate kopiju (zapamtite da kliknete na saÄuvaj promene):

<figure><img src="../../.gitbook/assets/image (332).png" alt=""><figcaption></figcaption></figure>

TakoÄ‘e je moguÄ‡e kreirati filtre i proslediti samo odreÄ‘ene emailove na drugu email adresu.

## App lozinke

Ako ste uspeli da **kompromitujete sesiju google korisnika** i korisnik je imao **2FA**, moÅ¾ete **generisati** [**app lozinku**](https://support.google.com/accounts/answer/185833?hl=en) (pratite link da vidite korake). Imajte na umu da **Google viÅ¡e ne preporuÄuje app lozinke i one se opozivaju** kada korisnik **promeni lozinku Google naloga.**

**ÄŒak i ako imate otvorenu sesiju, moraÄ‡ete da znate lozinku korisnika da biste kreirali app lozinku.**

{% hint style="info" %}
App lozinke mogu **da se koriste samo sa nalozima koji imaju ukljuÄenu 2-Step Verification**.
{% endhint %}

## Promena 2-FA i sliÄno

TakoÄ‘e je moguÄ‡e **iskljuÄiti 2-FA ili registrovati novi ureÄ‘aj** (ili broj telefona) na ovoj stranici [**https://myaccount.google.com/security**](https://myaccount.google.com/security)**.**\
**TakoÄ‘e je moguÄ‡e generisati kljuÄeve (dodati svoj ureÄ‘aj), promeniti lozinku, dodati mobilne brojeve za verifikacione telefone i oporavak, promeniti email za oporavak i promeniti bezbednosna pitanja).**

{% hint style="danger" %}
Da biste **spreÄili bezbednosna push obaveÅ¡tenja** da stignu na telefon korisnika, mogli biste **izlogovati njegov pametan telefon** (iako bi to bilo Äudno) jer ne moÅ¾ete ponovo da ga prijavite odavde.

TakoÄ‘e je moguÄ‡e **locirati ureÄ‘aj.**
{% endhint %}

**ÄŒak i ako imate otvorenu sesiju, moraÄ‡ete da znate lozinku korisnika da biste promenili ove postavke.**

## Persistencija putem OAuth aplikacija

Ako ste **kompromitovali nalog korisnika**, moÅ¾ete jednostavno **prihvatiti** da dodelite sve moguÄ‡e dozvole **OAuth aplikaciji**. Jedini problem je Å¡to Workspace moÅ¾e biti podeÅ¡en da **onemoguÄ‡i neproverene spoljne i/ili interne OAuth aplikacije.**\
PriliÄno je uobiÄajeno da Workspace organizacije po defaultu ne veruju spoljnim OAuth aplikacijama, ali veruju internim, tako da ako imate **dovoljno dozvola da generiÅ¡ete novu OAuth aplikaciju** unutar organizacije i spoljne aplikacije su onemoguÄ‡ene, generiÅ¡ite je i **koristite tu novu internu OAuth aplikaciju za odrÅ¾avanje persistencije**.

Proverite sledeÄ‡u stranicu za viÅ¡e informacija o OAuth aplikacijama:

{% content-ref url="gws-google-platforms-phishing/" %}
[gws-google-platforms-phishing](gws-google-platforms-phishing/)
{% endcontent-ref %}

## Persistencija putem delegacije

MoÅ¾ete jednostavno **delegirati nalog** na drugi nalog koji kontroliÅ¡e napadaÄ (ako vam je to dozvoljeno). U Workspace **organizacijama** ova opcija mora biti **omoguÄ‡ena**. MoÅ¾e biti onemoguÄ‡ena za sve, omoguÄ‡ena za neke korisnike/grupe ili za sve (obiÄno je omoguÄ‡ena samo za neke korisnike/grupe ili potpuno onemoguÄ‡ena).

<details>

<summary>Ako ste Workspace administrator, proverite ovo da omoguÄ‡ite funkciju</summary>

(Informacije [kopirane iz dokumenata](https://support.google.com/a/answer/7223765))

Kao administrator vaÅ¡e organizacije (na primer, vaÅ¡e posla ili Å¡kole), kontroliÅ¡ete da li korisnici mogu delegirati pristup svom Gmail nalogu. MoÅ¾ete dozvoliti svima da imaju opciju da delegiraju svoj nalog. Ili, samo dozvoliti ljudima u odreÄ‘enim odeljenjima da postave delegaciju. Na primer, moÅ¾ete:

* Dodati administrativnog asistenta kao delegata na vaÅ¡em Gmail nalogu kako bi mogli da Äitaju i Å¡alju email u vaÅ¡e ime.
* Dodati grupu, kao Å¡to je vaÅ¡e prodajno odeljenje, u Grupe kao delegata da bi svima omoguÄ‡ili pristup jednom Gmail nalogu.

Korisnici mogu delegirati pristup samo drugom korisniku u istoj organizaciji, bez obzira na njihovu domenu ili organizacionu jedinicu.

#### OgraniÄenja i restrikcije delegacije

* **Dozvolite korisnicima da dodele pristup svojoj poÅ¡ti Google grupi** opcija: Da biste koristili ovu opciju, mora biti omoguÄ‡ena za OU delegiranog naloga i za OU svakog Älana grupe. ÄŒlanovi grupe koji pripadaju OU bez ove opcije omoguÄ‡ene ne mogu pristupiti delegiranom nalogu.
* Sa tipiÄnom upotrebom, 40 delegiranih korisnika moÅ¾e pristupiti Gmail nalogu u isto vreme. IznadproseÄna upotreba od strane jednog ili viÅ¡e delegata moÅ¾e smanjiti ovaj broj.
* Automatizovani procesi koji Äesto pristupaju Gmail-u takoÄ‘e mogu smanjiti broj delegata koji mogu pristupiti nalogu u isto vreme. Ovi procesi ukljuÄuju API-je ili ekstenzije pretraÅ¾ivaÄa koje Äesto pristupaju Gmail-u.
* Jedan Gmail nalog podrÅ¾ava do 1.000 jedinstvenih delegata. Grupa u Grupama se raÄuna kao jedan delegat prema limitu.
* Delegacija ne poveÄ‡ava limite za Gmail nalog. Gmail nalozi sa delegiranim korisnicima imaju standardne limite i politike Gmail naloga. Za detalje, posetite [Gmail limite i politike](https://support.google.com/a/topic/28609).

#### Korak 1: UkljuÄite Gmail delegaciju za svoje korisnike

**Pre nego Å¡to poÄnete:** Da biste primenili postavku za odreÄ‘ene korisnike, stavite njihove naloge u [organizacionu jedinicu](https://support.google.com/a/topic/1227584).

1.  [Prijavite se](https://admin.google.com/) na vaÅ¡u [Google Admin konzolu](https://support.google.com/a/answer/182076).

Prijavite se koristeÄ‡i _administratorski nalog_, a ne vaÅ¡ trenutni nalog CarlosPolop@gmail.com
2. U Admin konzoli, idite na Meni ![](https://storage.googleapis.com/support-kms-prod/JxKYG9DqcsormHflJJ8Z8bHuyVI5YheC0lAp)![i zatim](https://storage.googleapis.com/support-kms-prod/Th2Tx0uwPMOhsMPn7nRXMUo3vs6J0pto2DTn)![](https://storage.googleapis.com/support-kms-prod/ocGtUSENh4QebLpvZcmLcNRZyaTBcolMRSyl) **Aplikacije**![i zatim](https://storage.googleapis.com/support-kms-prod/Th2Tx0uwPMOhsMPn7nRXMUo3vs6J0pto2DTn)**Google Workspace**![i zatim](https://storage.googleapis.com/support-kms-prod/Th2Tx0uwPMOhsMPn7nRXMUo3vs6J0pto2DTn)**Gmail**![i zatim](https://storage.googleapis.com/support-kms-prod/Th2Tx0uwPMOhsMPn7nRXMUo3vs6J0pto2DTn)**PodeÅ¡avanja korisnika**.
3. Da biste primenili postavku za sve, ostavite izabranu gornju organizacionu jedinicu. InaÄe, izaberite pod [organizacionu jedinicu](https://support.google.com/a/topic/1227584).
4. Kliknite na **Delegacija poÅ¡te**.
5. Proverite **Dozvoli korisnicima da delegiraju pristup svojoj poÅ¡ti drugim korisnicima u domenu** kutiju.
6. (Opcionalno) Da biste dozvolili korisnicima da odrede koje informacije o poÅ¡iljaocu su ukljuÄene u delegirane poruke poslate sa njihovog naloga, proverite **Dozvoli korisnicima da prilagode ovu postavku** kutiju.
7. Izaberite opciju za podrazumevane informacije o poÅ¡iljaocu koje su ukljuÄene u poruke koje Å¡alju delegati:
* **PrikaÅ¾i vlasnika naloga i delegata koji je poslao email**â€”Poruke ukljuÄuju email adrese vlasnika Gmail naloga i delegata.
* **PrikaÅ¾i samo vlasnika naloga**â€”Poruke ukljuÄuju email adresu samo vlasnika Gmail naloga. Email adresa delegata nije ukljuÄena.
8. (Opcionalno) Da biste dozvolili korisnicima da dodaju grupu u Grupama kao delegata, proverite **Dozvoli korisnicima da dodele pristup svojoj poÅ¡ti Google grupi** kutiju.
9. Kliknite na **SaÄuvaj**. Ako ste konfigurisali pod organizacionu jedinicu, moÅ¾da Ä‡ete moÄ‡i da **nasledite** ili **prepravite** postavke roditeljske organizacione jedinice.
10. (Opcionalno) Da biste ukljuÄili Gmail delegaciju za druge organizacione jedinice, ponovite korake 3â€“9.

Promene mogu potrajati do 24 sata, ali obiÄno se deÅ¡avaju brÅ¾e. [Saznajte viÅ¡e](https://support.google.com/a/answer/7514107)

#### Korak 2: Neka korisnici postave delegate za svoje naloge

Nakon Å¡to ukljuÄite delegaciju, vaÅ¡i korisnici idu na svoja Gmail podeÅ¡avanja da dodele delegate. Delegati tada mogu Äitati, slati i primati poruke u ime korisnika.

Za detalje, uputite korisnike na [Delegiranje i saradnja na email-u](https://support.google.com/a/users/answer/138350).

</details>

<details>

<summary>Od obiÄnog korisnika, proverite ovde uputstva da pokuÅ¡ate da delegirate svoj pristup</summary>

(Info kopirana [**iz dokumenata**](https://support.google.com/mail/answer/138350))

MoÅ¾ete dodati do 10 delegata.

Ako koristite Gmail preko svog posla, Å¡kole ili druge organizacije:

* MoÅ¾ete dodati do 1000 delegata unutar vaÅ¡e organizacije.
* Sa tipiÄnom upotrebom, 40 delegata moÅ¾e pristupiti Gmail nalogu u isto vreme.
* Ako koristite automatizovane procese, kao Å¡to su API-ji ili ekstenzije pretraÅ¾ivaÄa, nekoliko delegata moÅ¾e pristupiti Gmail nalogu u isto vreme.

1. Na svom raÄunaru, otvorite [Gmail](https://mail.google.com/). Ne moÅ¾ete dodati delegate iz Gmail aplikacije.
2. U gornjem desnom uglu, kliknite na PodeÅ¡avanja ![Settings](https://lh3.googleusercontent.com/p3J-ZSPOLtuBBR_ofWTFDfdgAYQgi8mR5c76ie8XQ2wjegk7-yyU5zdRVHKybQgUlQ=w36-h36) ![i zatim](https://lh3.googleusercontent.com/3_l97rr0GvhSP2XV5OoCkV2ZDTIisAOczrSdzNCBxhIKWrjXjHucxNwocghoUa39gw=w36-h36) **Pogledajte sve postavke**.
3. Kliknite na **Nalozi i uvoz** ili **Nalozi** tab.
4. U sekciji "Dodeli pristup svom nalogu", kliknite na **Dodaj drugi nalog**. Ako koristite Gmail preko svog posla ili Å¡kole, vaÅ¡a organizacija moÅ¾e ograniÄiti delegaciju email-a. Ako ne vidite ovu postavku, kontaktirajte svog administratora.
* Ako ne vidite Dodeli pristup svom nalogu, onda je to ograniÄeno.
5.  Unesite email adresu osobe koju Å¾elite da dodate. Ako koristite Gmail preko svog posla, Å¡kole ili druge organizacije, i vaÅ¡ administrator to dozvoljava, moÅ¾ete uneti email adresu grupe. Ova grupa mora imati istu domenu kao vaÅ¡a organizacija. Spoljni Älanovi grupe su odbijeni pristup delegaciji.\
\
**VaÅ¾no:** Ako je nalog koji delegirate novi nalog ili je lozinka resetovana, administrator mora iskljuÄiti zahtev za promenu lozinke kada se prvi put prijavite.

* [Saznajte kako administrator moÅ¾e da kreira korisnika](https://support.google.com/a/answer/33310).
* [Saznajte kako administrator moÅ¾e da resetuje lozinke](https://support.google.com/a/answer/33319).

6\. Kliknite na **SledeÄ‡i korak** ![i zatim](https://lh3.googleusercontent.com/QbWcYKta5vh_4-OgUeFmK-JOB0YgLLoGh69P478nE6mKdfpWQniiBabjF7FVoCVXI0g=h36) **PoÅ¡aljite email da dodelite pristup**.

Osoba koju ste dodali Ä‡e dobiti email u kojem se traÅ¾i da potvrdi. Poziv vaÅ¾i nedelju dana.

Ako ste dodali grupu, svi Älanovi grupe Ä‡e postati delegati bez potrebe za potvrdom.

Napomena: MoÅ¾e potrajati do 24 sata da delegacija poÄne da deluje.

</details>

## Persistencija putem Android aplikacije

Ako imate **sesiju unutar google naloga Å¾rtve**, moÅ¾ete pretraÅ¾ivati **Play Store** i moÅ¾da Ä‡ete moÄ‡i da **instalirate malver** koji ste veÄ‡ otpremili u prodavnicu direktno **na telefon** kako biste odrÅ¾ali persistenciju i pristupili telefonu Å¾rtve.

## **Persistencija putem** App skripti

MoÅ¾ete kreirati **okidaÄe zasnovane na vremenu** u App skriptama, tako da ako je App skripta prihvaÄ‡ena od strane korisnika, biÄ‡e **okidana** Äak i **bez pristupa korisnika**. Za viÅ¡e informacija o tome kako to uÄiniti, proverite:

{% content-ref url="gws-google-platforms-phishing/gws-app-scripts.md" %}
[gws-app-scripts.md](gws-google-platforms-phishing/gws-app-scripts.md)
{% endcontent-ref %}

## Reference

* [https://www.youtube-nocookie.com/embed/6AsVUS79gLw](https://www.youtube-nocookie.com/embed/6AsVUS79gLw) - Matthew Bryant - Hacking G Suite: The Power of Dark Apps Script Magic
* [https://www.youtube.com/watch?v=KTVHLolz6cE](https://www.youtube.com/watch?v=KTVHLolz6cE) - Mike Felch i Beau Bullock - OK Google, Kako da Red Team GSuite?

{% hint style="success" %}
UÄite i veÅ¾bajte AWS Hacking:<img src="../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
UÄite i veÅ¾bajte GCP Hacking: <img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>PodrÅ¾ite HackTricks</summary>

* Proverite [**planove pretplate**](https://github.com/sponsors/carlospolop)!
* **PridruÅ¾ite se** ğŸ’¬ [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili **pratite** nas na **Twitteru** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Podelite hakerske trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
{% endhint %}
