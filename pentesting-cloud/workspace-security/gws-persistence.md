# GWS - Persistence

{% hint style="success" %}
Lernen & √ºben Sie AWS Hacking:<img src="../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">\
Lernen & √ºben Sie GCP Hacking: <img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* √úberpr√ºfen Sie die [**Abonnementpl√§ne**](https://github.com/sponsors/carlospolop)!
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teilen Sie Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repos senden.

</details>
{% endhint %}

{% hint style="danger" %}
Alle in diesem Abschnitt genannten Aktionen, die Einstellungen √§ndern, generieren eine **Sicherheitswarnung an die E-Mail und sogar eine Push-Benachrichtigung an jedes mit dem Konto synchronisierte Mobilger√§t**.
{% endhint %}

## **Persistenz in Gmail**

* Sie k√∂nnen **Filter erstellen, um** Sicherheitsbenachrichtigungen von Google zu verbergen
* `from: (no-reply@accounts.google.com) "Security Alert"`
* Dies verhindert, dass Sicherheits-E-Mails die E-Mail erreichen (verhindert jedoch nicht, dass Push-Benachrichtigungen auf das Mobilger√§t gelangen)

<details>

<summary>Schritte zum Erstellen eines Gmail-Filters</summary>

(Anweisungen [**hier**](https://support.google.com/mail/answer/6579))

1. √ñffnen Sie [Gmail](https://mail.google.com/).
2. Klicken Sie im Suchfeld oben auf Suchoptionen anzeigen ![photos tune](https://lh3.googleusercontent.com/cD6YR\_YvqXqNKxrWn2NAWkV6tjJtg8vfvqijKT1\_9zVCrl2sAx9jROKhLqiHo2ZDYTE=w36).
3. Geben Sie Ihre Suchkriterien ein. Wenn Sie √ºberpr√ºfen m√∂chten, ob Ihre Suche korrekt funktioniert hat, sehen Sie sich an, welche E-Mails angezeigt werden, indem Sie auf **Suchen** klicken.
4. Klicken Sie am unteren Rand des Suchfensters auf **Filter erstellen**.
5. W√§hlen Sie aus, was der Filter tun soll.
6. Klicken Sie auf **Filter erstellen**.

√úberpr√ºfen Sie Ihren aktuellen Filter (um sie zu l√∂schen) unter [https://mail.google.com/mail/u/0/#settings/filters](https://mail.google.com/mail/u/0/#settings/filters)

</details>

<figure><img src="../../.gitbook/assets/image (331).png" alt=""><figcaption></figcaption></figure>

* Erstellen Sie **eine Weiterleitungsadresse, um sensible Informationen** (oder alles) weiterzuleiten - Sie ben√∂tigen manuellen Zugriff.
* Erstellen Sie eine Weiterleitungsadresse unter [https://mail.google.com/mail/u/2/#settings/fwdandpop](https://mail.google.com/mail/u/2/#settings/fwdandpop)
* Die empfangende Adresse muss dies best√§tigen
* Stellen Sie dann ein, dass alle E-Mails weitergeleitet werden, w√§hrend eine Kopie behalten wird (denken Sie daran, auf √Ñnderungen speichern zu klicken):

<figure><img src="../../.gitbook/assets/image (332).png" alt=""><figcaption></figcaption></figure>

Es ist auch m√∂glich, Filter zu erstellen und nur bestimmte E-Mails an die andere E-Mail-Adresse weiterzuleiten.

## App-Passw√∂rter

Wenn Sie es geschafft haben, eine **Google-Benutzersitzung zu kompromittieren** und der Benutzer **2FA** hatte, k√∂nnen Sie ein [**App-Passwort**](https://support.google.com/accounts/answer/185833?hl=en) **generieren** (folgen Sie dem Link, um die Schritte zu sehen). Beachten Sie, dass **App-Passw√∂rter von Google nicht mehr empfohlen werden und widerrufen werden**, wenn der Benutzer **sein Google-Konto-Passwort √§ndert.**

**Selbst wenn Sie eine offene Sitzung haben, m√ºssen Sie das Passwort des Benutzers kennen, um ein App-Passwort zu erstellen.**

{% hint style="info" %}
App-Passw√∂rter k√∂nnen **nur mit Konten verwendet werden, die die 2-Schritt-Verifizierung** aktiviert haben.
{% endhint %}

## 2-FA und √Ñhnliches √§ndern

Es ist auch m√∂glich, **2-FA auszuschalten oder ein neues Ger√§t** (oder eine Telefonnummer) auf dieser Seite [**https://myaccount.google.com/security**](https://myaccount.google.com/security)** zu registrieren.**\
**Es ist auch m√∂glich, Passkeys zu generieren (Ihr eigenes Ger√§t hinzuzuf√ºgen), das Passwort zu √§ndern, Mobilnummern f√ºr Verifizierungstelefone und Wiederherstellung hinzuzuf√ºgen, die Wiederherstellungs-E-Mail zu √§ndern und die Sicherheitsfragen zu √§ndern).**

{% hint style="danger" %}
Um **zu verhindern, dass Sicherheits-Push-Benachrichtigungen** das Telefon des Benutzers erreichen, k√∂nnten Sie **sein Smartphone abmelden** (obwohl das seltsam w√§re), da Sie ihn von hier aus nicht erneut anmelden k√∂nnen.

Es ist auch m√∂glich, **das Ger√§t zu lokalisieren.**
{% endhint %}

**Selbst wenn Sie eine offene Sitzung haben, m√ºssen Sie das Passwort des Benutzers kennen, um diese Einstellungen zu √§ndern.**

## Persistenz √ºber OAuth-Apps

Wenn Sie das **Konto eines Benutzers kompromittiert haben**, k√∂nnen Sie einfach **akzeptieren**, alle m√∂glichen Berechtigungen f√ºr eine **OAuth-App** zu gew√§hren. Das einzige Problem ist, dass Workspace so konfiguriert werden kann, dass **nicht √ºberpr√ºfte externe und/oder interne OAuth-Apps nicht erlaubt sind.**\
Es ist ziemlich √ºblich, dass Workspace-Organisationen standardm√§√üig externen OAuth-Apps nicht vertrauen, aber internen vertrauen, also wenn Sie **genug Berechtigungen haben, um eine neue OAuth-Anwendung** innerhalb der Organisation zu generieren und externe Apps nicht erlaubt sind, generieren Sie sie und **verwenden Sie diese neue interne OAuth-App, um Persistenz aufrechtzuerhalten**.

√úberpr√ºfen Sie die folgende Seite f√ºr weitere Informationen zu OAuth-Apps:

{% content-ref url="gws-google-platforms-phishing/" %}
[gws-google-platforms-phishing](gws-google-platforms-phishing/)
{% endcontent-ref %}

## Persistenz √ºber Delegation

Sie k√∂nnen einfach das **Konto** an ein anderes vom Angreifer kontrolliertes Konto delegieren (wenn Sie dazu berechtigt sind). In Workspace **Organisationen** muss diese Option **aktiviert** sein. Sie kann f√ºr alle deaktiviert, f√ºr einige Benutzer/Gruppen aktiviert oder f√ºr alle aktiviert werden (in der Regel ist sie nur f√ºr einige Benutzer/Gruppen aktiviert oder vollst√§ndig deaktiviert).

<details>

<summary>Wenn Sie ein Workspace-Administrator sind, √ºberpr√ºfen Sie dies, um die Funktion zu aktivieren</summary>

(Informationen [aus den Dokumenten kopiert](https://support.google.com/a/answer/7223765))

Als Administrator Ihrer Organisation (zum Beispiel Ihrer Arbeit oder Schule) steuern Sie, ob Benutzer den Zugriff auf ihr Gmail-Konto delegieren k√∂nnen. Sie k√∂nnen allen die Option geben, ihr Konto zu delegieren. Oder nur bestimmten Personen in bestimmten Abteilungen erlauben, eine Delegation einzurichten. Zum Beispiel k√∂nnen Sie:

* Einen Verwaltungsassistenten als Delegierten f√ºr Ihr Gmail-Konto hinzuf√ºgen, damit er E-Mails in Ihrem Namen lesen und senden kann.
* Eine Gruppe, wie Ihre Verkaufsabteilung, in Gruppen als Delegierten hinzuf√ºgen, um allen Zugriff auf ein Gmail-Konto zu gew√§hren.

Benutzer k√∂nnen den Zugriff nur auf einen anderen Benutzer in derselben Organisation delegieren, unabh√§ngig von ihrer Domain oder ihrer organisatorischen Einheit.

#### Delegationsgrenzen & Einschr√§nkungen

* **Benutzern erlauben, den Zugriff auf ihr Postfach an eine Google-Gruppe zu gew√§hren**: Um diese Option zu verwenden, muss sie f√ºr die OU des delegierten Kontos und f√ºr die OU jedes Gruppenmitglieds aktiviert sein. Gruppenmitglieder, die zu einer OU geh√∂ren, f√ºr die diese Option nicht aktiviert ist, k√∂nnen nicht auf das delegierte Konto zugreifen.
* Bei typischer Nutzung k√∂nnen 40 delegierte Benutzer gleichzeitig auf ein Gmail-Konto zugreifen. √úberdurchschnittliche Nutzung durch einen oder mehrere Delegierte kann diese Zahl verringern.
* Automatisierte Prozesse, die h√§ufig auf Gmail zugreifen, k√∂nnen ebenfalls die Anzahl der Delegierten verringern, die gleichzeitig auf ein Konto zugreifen k√∂nnen. Diese Prozesse umfassen APIs oder Browsererweiterungen, die h√§ufig auf Gmail zugreifen.
* Ein einzelnes Gmail-Konto unterst√ºtzt bis zu 1.000 eindeutige Delegierte. Eine Gruppe in Gruppen z√§hlt als ein Delegierter f√ºr das Limit.
* Die Delegation erh√∂ht nicht die Limits f√ºr ein Gmail-Konto. Gmail-Konten mit delegierten Benutzern haben die standardm√§√üigen Gmail-Kontolimits und -richtlinien. F√ºr Details besuchen Sie [Gmail-Limits und -Richtlinien](https://support.google.com/a/topic/28609).

#### Schritt 1: Aktivieren Sie die Gmail-Delegation f√ºr Ihre Benutzer

**Bevor Sie beginnen:** Um die Einstellung f√ºr bestimmte Benutzer anzuwenden, setzen Sie deren Konten in eine [organisatorische Einheit](https://support.google.com/a/topic/1227584).

1.  [Melden Sie sich an](https://admin.google.com/) bei Ihrer [Google Admin-Konsole](https://support.google.com/a/answer/182076).

Melden Sie sich mit einem _Administrator-Konto_ an, nicht mit Ihrem aktuellen Konto CarlosPolop@gmail.com
2. Gehen Sie in der Admin-Konsole zu Men√º ![](https://storage.googleapis.com/support-kms-prod/JxKYG9DqcsormHflJJ8Z8bHuyVI5YheC0lAp)![und dann](https://storage.googleapis.com/support-kms-prod/Th2Tx0uwPMOhsMPn7nRXMUo3vs6J0pto2DTn)![](https://storage.googleapis.com/support-kms-prod/ocGtUSENh4QebLpvZcmLcNRZyaTBcolMRSyl) **Apps**![und dann](https://storage.googleapis.com/support-kms-prod/Th2Tx0uwPMOhsMPn7nRXMUo3vs6J0pto2DTn)**Google Workspace**![und dann](https://storage.googleapis.com/support-kms-prod/Th2Tx0uwPMOhsMPn7nRXMUo3vs6J0pto2DTn)**Gmail**![und dann](https://storage.googleapis.com/support-kms-prod/Th2Tx0uwPMOhsMPn7nRXMUo3vs6J0pto2DTn)**Benutzereinstellungen**.
3. Um die Einstellung f√ºr alle anzuwenden, lassen Sie die oberste organisatorische Einheit ausgew√§hlt. Andernfalls w√§hlen Sie eine untergeordnete [organisatorische Einheit](https://support.google.com/a/topic/1227584).
4. Klicken Sie auf **Mail-Delegation**.
5. Aktivieren Sie das Kontrollk√§stchen **Benutzern erlauben, anderen Benutzern im Domain Zugriff auf ihr Postfach zu gew√§hren**.
6. (Optional) Um Benutzern zu erlauben, anzugeben, welche Absenderinformationen in delegierten Nachrichten enthalten sind, die von ihrem Konto gesendet werden, aktivieren Sie das Kontrollk√§stchen **Benutzern erlauben, diese Einstellung anzupassen**.
7. W√§hlen Sie eine Option f√ºr die standardm√§√üigen Absenderinformationen, die in von Delegierten gesendeten Nachrichten enthalten sind:
* **Zeigen Sie den Kontoinhaber und den Delegierten an, der die E-Mail gesendet hat**‚ÄîNachrichten enthalten die E-Mail-Adressen des Gmail-Kontoinhabers und des Delegierten.
* **Zeigen Sie nur den Kontoinhaber an**‚ÄîNachrichten enthalten nur die E-Mail-Adresse des Gmail-Kontoinhabers. Die E-Mail-Adresse des Delegierten ist nicht enthalten.
8. (Optional) Um Benutzern zu erlauben, eine Gruppe in Gruppen als Delegierten hinzuzuf√ºgen, aktivieren Sie das Kontrollk√§stchen **Benutzern erlauben, den Zugriff auf ihr Postfach an eine Google-Gruppe zu gew√§hren**.
9. Klicken Sie auf **Speichern**. Wenn Sie eine untergeordnete organisatorische Einheit konfiguriert haben, k√∂nnen Sie m√∂glicherweise die Einstellungen einer √ºbergeordneten organisatorischen Einheit **√ºbernehmen** oder **√ºberschreiben**.
10. (Optional) Um die Gmail-Delegation f√ºr andere organisatorische Einheiten zu aktivieren, wiederholen Sie die Schritte 3‚Äì9.

√Ñnderungen k√∂nnen bis zu 24 Stunden dauern, erfolgen jedoch normalerweise schneller. [Erfahren Sie mehr](https://support.google.com/a/answer/7514107)

#### Schritt 2: Lassen Sie Benutzer Delegierte f√ºr ihre Konten einrichten

Nachdem Sie die Delegation aktiviert haben, gehen Ihre Benutzer zu ihren Gmail-Einstellungen, um Delegierte zuzuweisen. Delegierte k√∂nnen dann im Namen des Benutzers Nachrichten lesen, senden und empfangen.

F√ºr Details leiten Sie die Benutzer zu [Delegieren und zusammenarbeiten bei E-Mails](https://support.google.com/a/users/answer/138350).

</details>

<details>

<summary>Von einem regul√§ren Benutzer, √ºberpr√ºfen Sie hier die Anweisungen, um zu versuchen, Ihren Zugriff zu delegieren</summary>

(Info kopiert [**aus den Dokumenten**](https://support.google.com/mail/answer/138350))

Sie k√∂nnen bis zu 10 Delegierte hinzuf√ºgen.

Wenn Sie Gmail √ºber Ihre Arbeit, Schule oder andere Organisation verwenden:

* Sie k√∂nnen bis zu 1000 Delegierte innerhalb Ihrer Organisation hinzuf√ºgen.
* Bei typischer Nutzung k√∂nnen 40 Delegierte gleichzeitig auf ein Gmail-Konto zugreifen.
* Wenn Sie automatisierte Prozesse verwenden, wie APIs oder Browsererweiterungen, k√∂nnen einige Delegierte gleichzeitig auf ein Gmail-Konto zugreifen.

1. √ñffnen Sie auf Ihrem Computer [Gmail](https://mail.google.com/). Sie k√∂nnen Delegierte nicht √ºber die Gmail-App hinzuf√ºgen.
2. Klicken Sie oben rechts auf Einstellungen ![Einstellungen](https://lh3.googleusercontent.com/p3J-ZSPOLtuBBR\_ofWTFDfdgAYQgi8mR5c76ie8XQ2wjegk7-yyU5zdRVHKybQgUlQ=w36-h36) ![und dann](https://lh3.googleusercontent.com/3\_l97rr0GvhSP2XV5OoCkV2ZDTIisAOczrSdzNCBxhIKWrjXjHucxNwocghoUa39gw=w36-h36) **Alle Einstellungen anzeigen**.
3. Klicken Sie auf die Registerkarte **Konten und Import** oder **Konten**.
4. Klicken Sie im Abschnitt "Zugriff auf Ihr Konto gew√§hren" auf **Ein weiteres Konto hinzuf√ºgen**. Wenn Sie Gmail √ºber Ihre Arbeit oder Schule verwenden, kann Ihre Organisation die E-Mail-Delegation einschr√§nken. Wenn Sie diese Einstellung nicht sehen, wenden Sie sich an Ihren Administrator.
* Wenn Sie "Zugriff auf Ihr Konto gew√§hren" nicht sehen, ist es eingeschr√§nkt.
5. Geben Sie die E-Mail-Adresse der Person ein, die Sie hinzuf√ºgen m√∂chten. Wenn Sie Gmail √ºber Ihre Arbeit, Schule oder andere Organisation verwenden und Ihr Administrator dies zul√§sst, k√∂nnen Sie die E-Mail-Adresse einer Gruppe eingeben. Diese Gruppe muss dieselbe Domain wie Ihre Organisation haben. Externe Mitglieder der Gruppe wird der Delegationszugriff verweigert.\
\
**Wichtig:** Wenn das Konto, das Sie delegieren, ein neues Konto ist oder das Passwort zur√ºckgesetzt wurde, muss der Administrator die Anforderung deaktivieren, das Passwort beim ersten Anmelden zu √§ndern.

* [Erfahren Sie, wie ein Administrator einen Benutzer erstellen kann](https://support.google.com/a/answer/33310).
* [Erfahren Sie, wie ein Administrator Passw√∂rter zur√ºcksetzen kann](https://support.google.com/a/answer/33319).

6. Klicken Sie auf **N√§chster Schritt** ![und dann](https://lh3.googleusercontent.com/QbWcYKta5vh\_4-OgUeFmK-JOB0YgLLoGh69P478nE6mKdfpWQniiBabjF7FVoCVXI0g=h36) **E-Mail senden, um Zugriff zu gew√§hren**.

Die Person, die Sie hinzugef√ºgt haben, erh√§lt eine E-Mail, in der sie aufgefordert wird, zu best√§tigen. Die Einladung l√§uft nach einer Woche ab.

Wenn Sie eine Gruppe hinzugef√ºgt haben, werden alle Gruppenmitglieder ohne Best√§tigung zu Delegierten.

Hinweis: Es kann bis zu 24 Stunden dauern, bis die Delegation wirksam wird.

</details>

## Persistenz √ºber Android-App

Wenn Sie eine **Sitzung im Google-Konto des Opfers** haben, k√∂nnen Sie zum **Play Store** browsen und m√∂glicherweise **Malware installieren**, die Sie bereits in den Store hochgeladen haben, direkt **auf das Telefon**, um Persistenz aufrechtzuerhalten und auf das Telefon des Opfers zuzugreifen.

## **Persistenz √ºber** App-Skripte

Sie k√∂nnen **zeitbasierte Trigger** in App-Skripten erstellen, sodass, wenn das App-Skript vom Benutzer akzeptiert wird, es **ausgel√∂st** wird, auch **ohne dass der Benutzer darauf zugreift**. F√ºr weitere Informationen dar√ºber, wie Sie dies tun k√∂nnen, √ºberpr√ºfen Sie:

{% content-ref url="gws-google-platforms-phishing/gws-app-scripts.md" %}
[gws-app-scripts.md](gws-google-platforms-phishing/gws-app-scripts.md)
{% endcontent-ref %}

## Referenzen

* [https://www.youtube-nocookie.com/embed/6AsVUS79gLw](https://www.youtube-nocookie.com/embed/6AsVUS79gLw) - Matthew Bryant - Hacking G Suite: Die Macht der dunklen Apps Script Magie
* [https://www.youtube.com/watch?v=KTVHLolz6cE](https://www.youtube.com/watch?v=KTVHLolz6cE) - Mike Felch und Beau Bullock - OK Google, wie mache ich Red Team GSuite?

{% hint style="success" %}
Lernen & √ºben Sie AWS Hacking:<img src="../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">\
Lernen & √ºben Sie GCP Hacking: <img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* √úberpr√ºfen Sie die [**Abonnementpl√§ne**](https://github.com/sponsors/carlospolop)!
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teilen Sie Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repos senden.

</details>
{% endhint %}
