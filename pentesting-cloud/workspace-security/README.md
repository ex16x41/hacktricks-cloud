# GWS - Pentesting de Workspace

{% hint style="success" %}
Aprende y practica Hacking en AWS:<img src="../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
Aprende y practica Hacking en GCP: <img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Apoya a HackTricks</summary>

* Revisa los [**planes de suscripción**](https://github.com/sponsors/carlospolop)!
* **Únete al** 💬 [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **síguenos** en **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Comparte trucos de hacking enviando PRs a los** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repos de github.

</details>
{% endhint %}

## Puntos de Entrada

### Phishing en Plataformas de Google y Apps de OAuth

Revisa cómo podrías usar diferentes plataformas de Google como Drive, Chat, Grupos... para enviar al objetivo un enlace de phishing y cómo realizar un phishing de Google OAuth en:

{% content-ref url="gws-google-platforms-phishing/" %}
[gws-google-platforms-phishing](gws-google-platforms-phishing/)
{% endcontent-ref %}

### Password Spraying

Para probar contraseñas con todos los correos que encontraste (o que has generado basándote en un patrón de nombre de correo que podrías haber descubierto) podrías usar una herramienta como [**https://github.com/ustayready/CredKing**](https://github.com/ustayready/CredKing) (aunque parece no estar mantenida) que usará lambdas de AWS para cambiar la dirección IP.

## Post-Explotación

Si has comprometido algunas credenciales o la sesión del usuario, puedes realizar varias acciones para acceder a información potencialmente sensible del usuario y tratar de escalar privilegios:

{% content-ref url="gws-post-exploitation.md" %}
[gws-post-exploitation.md](gws-post-exploitation.md)
{% endcontent-ref %}

### GWS <--> GCP Pivoting

Lee más sobre las diferentes técnicas para pivotar entre GWS y GCP en:

{% content-ref url="../gcp-security/gcp-to-workspace-pivoting/" %}
[gcp-to-workspace-pivoting](../gcp-security/gcp-to-workspace-pivoting/)
{% endcontent-ref %}

## GWS <--> GCPW | GCDS | Sincronización de Directorios (AD & EntraID)

* **GCPW (Google Credential Provider for Windows)**: Este es el inicio de sesión único que Google Workspaces proporciona para que los usuarios puedan iniciar sesión en sus PCs con Windows usando **sus credenciales de Workspace**. Además, esto **almacenará tokens para acceder a Google Workspace** en algunos lugares de la PC.
* **GCDS (Google Cloud Directory Sync)**: Esta es una herramienta que se puede usar para **sincronizar tus usuarios y grupos de Active Directory a tu Workspace**. La herramienta requiere las **credenciales de un superusuario de Workspace y un usuario privilegiado de AD**. Por lo tanto, podría ser posible encontrarla dentro de un servidor de dominio que esté sincronizando usuarios de vez en cuando.
* **Sincronización de Directorio de Administrador**: Permite sincronizar usuarios de AD y EntraID en un proceso sin servidor desde [https://admin.google.com/ac/sync/externaldirectories](https://admin.google.com/ac/sync/externaldirectories).

{% content-ref url="gws-workspace-sync-attacks-gcpw-gcds-gps-directory-sync-with-ad-and-entraid/" %}
[gws-workspace-sync-attacks-gcpw-gcds-gps-directory-sync-with-ad-and-entraid](gws-workspace-sync-attacks-gcpw-gcds-gps-directory-sync-with-ad-and-entraid/)
{% endcontent-ref %}

## Persistencia

Si has comprometido algunas credenciales o la sesión del usuario, revisa estas opciones para mantener la persistencia sobre ello:

{% content-ref url="gws-persistence.md" %}
[gws-persistence.md](gws-persistence.md)
{% endcontent-ref %}

## Recuperación de Cuenta Comprometida

* Cerrar sesión en todas las sesiones
* Cambiar la contraseña del usuario
* Generar nuevos códigos de respaldo de 2FA
* Eliminar contraseñas de aplicaciones
* Eliminar aplicaciones de OAuth
* Eliminar dispositivos de 2FA
* Eliminar reenvíos de correo electrónico
* Eliminar filtros de correos electrónicos
* Eliminar correos electrónicos/teléfonos de recuperación
* Eliminar smartphones sincronizados maliciosos
* Eliminar malas aplicaciones de Android
* Eliminar malas delegaciones de cuenta

## Referencias

* [https://www.youtube-nocookie.com/embed/6AsVUS79gLw](https://www.youtube-nocookie.com/embed/6AsVUS79gLw) - Matthew Bryant - Hacking G Suite: The Power of Dark Apps Script Magic
* [https://www.youtube.com/watch?v=KTVHLolz6cE](https://www.youtube.com/watch?v=KTVHLolz6cE) - Mike Felch y Beau Bullock - OK Google, ¿Cómo hago un Red Team en GSuite?

{% hint style="success" %}
Aprende y practica Hacking en AWS:<img src="../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
Aprende y practica Hacking en GCP: <img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Apoya a HackTricks</summary>

* Revisa los [**planes de suscripción**](https://github.com/sponsors/carlospolop)!
* **Únete al** 💬 [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **síguenos** en **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Comparte trucos de hacking enviando PRs a los** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repos de github.

</details>
{% endhint %}
