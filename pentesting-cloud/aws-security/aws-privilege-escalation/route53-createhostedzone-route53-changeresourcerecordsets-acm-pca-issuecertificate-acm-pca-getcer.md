# AWS - Escalada de privilegios en Route53

{% hint style="success" %}
Aprende y practica Hacking en AWS:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**Entrenamiento de HackTricks para Expertos en Equipos Rojos de AWS (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Aprende y practica Hacking en GCP: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**Entrenamiento de HackTricks para Expertos en Equipos Rojos de GCP (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Apoya a HackTricks</summary>

* 隆Consulta los [**planes de suscripci贸n**](https://github.com/sponsors/carlospolop)!
* **nete al**  [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s铆guenos** en **Twitter**  [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Comparte trucos de hacking enviando PRs a los repositorios de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
{% endhint %}

Para obtener m谩s informaci贸n sobre Route53, consulta:

{% content-ref url="../aws-services/aws-route53-enum.md" %}
[aws-route53-enum.md](../aws-services/aws-route53-enum.md)
{% endcontent-ref %}

### `route53:CreateHostedZone`, `route53:ChangeResourceRecordSets`, `acm-pca:IssueCertificate`, `acm-pca:GetCertificate`

{% hint style="info" %}
Para realizar este ataque, la cuenta objetivo ya debe tener una [**Autoridad de Certificaci贸n Privada de AWS**](https://aws.amazon.com/certificate-manager/private-certificate-authority/) **(AWS-PCA)** configurada en la cuenta, y las instancias EC2 en la(s) VPC ya deben haber importado los certificados para confiar en ella. Con esta infraestructura en su lugar, se puede realizar el siguiente ataque para interceptar el tr谩fico de la API de AWS.
{% endhint %}

Otros permisos **recomendados pero no requeridos para la parte de enumeraci贸n**: `route53:GetHostedZone`, `route53:ListHostedZones`, `acm-pca:ListCertificateAuthorities`, `ec2:DescribeVpcs`

Suponiendo que hay una VPC de AWS con m煤ltiples aplicaciones nativas en la nube que se comunican entre s铆 y con la API de AWS. Dado que la comunicaci贸n entre los microservicios suele estar cifrada con TLS, debe haber una CA privada para emitir los certificados v谩lidos para esos servicios. **Si se utiliza ACM-PCA** para eso y el adversario logra obtener **acceso para controlar tanto route53 como acm-pca private CA** con el conjunto m铆nimo de permisos descritos anteriormente, puede **interceptar las llamadas de aplicaci贸n a la API de AWS** tomando el control de sus permisos IAM.

Esto es posible porque:

* Los SDK de AWS no tienen [Pinning de Certificados](https://www.digicert.com/blog/certificate-pinning-what-is-certificate-pinning)
* Route53 permite crear Zona Hospedada Privada y registros DNS para nombres de dominio de API de AWS
* La CA privada en ACM-PCA no se puede restringir para firmar solo certificados para Nombres Comunes espec铆ficos

**Impacto potencial:** Escalada de privilegios indirecta al interceptar informaci贸n sensible en el tr谩fico.

#### Explotaci贸n <a href="#discovery" id="discovery"></a>

Encuentra los pasos de explotaci贸n en la investigaci贸n original: [**https://niebardzo.github.io/2022-03-11-aws-hijacking-route53/**](https://niebardzo.github.io/2022-03-11-aws-hijacking-route53/)

{% hint style="success" %}
Aprende y practica Hacking en AWS:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**Entrenamiento de HackTricks para Expertos en Equipos Rojos de AWS (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Aprende y practica Hacking en GCP: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**Entrenamiento de HackTricks para Expertos en Equipos Rojos de GCP (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Apoya a HackTricks</summary>

* 隆Consulta los [**planes de suscripci贸n**](https://github.com/sponsors/carlospolop)!
* **nete al**  [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s铆guenos** en **Twitter**  [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Comparte trucos de hacking enviando PRs a los repositorios de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
{% endhint %}
