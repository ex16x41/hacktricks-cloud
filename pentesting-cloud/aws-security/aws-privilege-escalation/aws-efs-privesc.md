# AWS - EFS ê¶Œí•œ ìƒìŠ¹

{% hint style="success" %}
AWS í•´í‚¹ì„ ë°°ìš°ê³  ì‹¤ìŠµí•˜ì„¸ìš”:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCP í•´í‚¹ì„ ë°°ìš°ê³  ì‹¤ìŠµí•˜ì„¸ìš”: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks ì§€ì›í•˜ê¸°</summary>

* [**êµ¬ë… ìš”ê¸ˆì œ**](https://github.com/sponsors/carlospolop)ë¥¼ í™•ì¸í•˜ì„¸ìš”!
* ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f)ì— ê°€ì…í•˜ê±°ë‚˜ [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— ì°¸ì—¬í•˜ê±°ë‚˜ **íŠ¸ìœ„í„°** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**ë¥¼ íŒ”ë¡œìš°**í•˜ì„¸ìš”.
* í•´í‚¹ íŒì„ ê³µìœ í•˜ë ¤ë©´ **HackTricks** ë° **HackTricks Cloud** ê¹ƒí—ˆë¸Œ ì €ì¥ì†Œì— PRì„ ì œì¶œí•˜ì„¸ìš”.

</details>
{% endhint %}

## EFS

ë” ë§ì€ **EFS ì •ë³´**ëŠ” ë‹¤ìŒì—ì„œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

{% content-ref url="../aws-services/aws-efs-enum.md" %}
[aws-efs-enum.md](../aws-services/aws-efs-enum.md)
{% endcontent-ref %}

EFSë¥¼ ë§ˆìš´íŠ¸í•˜ë ¤ë©´ EFSê°€ ë…¸ì¶œëœ í•˜ìœ„ ë„¤íŠ¸ì›Œí¬ì— ìˆì–´ì•¼ í•˜ê³  ì•¡ì„¸ìŠ¤ ê¶Œí•œì´ ìˆì–´ì•¼ í•©ë‹ˆë‹¤(ë³´ì•ˆ ê·¸ë£¹). ì´ëŸ¬í•œ ê²½ìš° ê¸°ë³¸ì ìœ¼ë¡œ í•­ìƒ ë§ˆìš´íŠ¸í•  ìˆ˜ ìˆì§€ë§Œ IAM ì •ì±…ìœ¼ë¡œ ë³´í˜¸ë˜ì–´ ìˆëŠ” ê²½ìš° ì—¬ê¸°ì„œ ì–¸ê¸‰ëœ ì¶”ê°€ ê¶Œí•œì´ í•„ìš”í•©ë‹ˆë‹¤.

### `elasticfilesystem:DeleteFileSystemPolicy`|`elasticfilesystem:PutFileSystemPolicy`

ìœ„ ê¶Œí•œ ì¤‘ í•˜ë‚˜ë¥¼ ê°€ì§€ê³  ìˆëŠ” ê³µê²©ìëŠ” **íŒŒì¼ ì‹œìŠ¤í…œ ì •ì±…ì„ ë³€ê²½**í•˜ì—¬ ì•¡ì„¸ìŠ¤ ê¶Œí•œì„ ë¶€ì—¬í•˜ê±°ë‚˜ **ì‚­ì œ**í•˜ì—¬ **ê¸°ë³¸ ì•¡ì„¸ìŠ¤**ë¥¼ ë¶€ì—¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì •ì±…ì„ ì‚­ì œí•˜ë ¤ë©´:
```bash
aws efs delete-file-system-policy \
--file-system-id <value>
```
ë³€ê²½í•˜ë ¤ë©´:
```json
aws efs put-file-system-policy --file-system-id <fs-id> --policy file:///tmp/policy.json

// Give everyone trying to mount it read, write and root access
// policy.json:
{
"Version": "2012-10-17",
"Id": "efs-policy-wizard-059944c6-35e7-4ba0-8e40-6f05302d5763",
"Statement": [
{
"Sid": "efs-statement-2161b2bd-7c59-49d7-9fee-6ea8903e6603",
"Effect": "Allow",
"Principal": {
"AWS": "*"
},
"Action": [
"elasticfilesystem:ClientRootAccess",
"elasticfilesystem:ClientWrite",
"elasticfilesystem:ClientMount"
],
"Condition": {
"Bool": {
"elasticfilesystem:AccessedViaMountTarget": "true"
}
}
}
]
}
```
### `elasticfilesystem:ClientMount|(elasticfilesystem:ClientRootAccess)|(elasticfilesystem:ClientWrite)`

ì´ ê¶Œí•œì„ ê°€ì§€ê³  ìˆìœ¼ë©´ ê³µê²©ìëŠ” **EFSë¥¼ ë§ˆìš´íŠ¸**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. EFSë¥¼ ë§ˆìš´íŠ¸í•  ìˆ˜ ìˆëŠ” ëª¨ë“  ì‚¬ìš©ìì—ê²Œ ê¸°ë³¸ì ìœ¼ë¡œ ì“°ê¸° ê¶Œí•œì´ ë¶€ì—¬ë˜ì§€ ì•Šì€ ê²½ìš° **ì½ê¸° ì•¡ì„¸ìŠ¤ë§Œ** ê°€ì§ˆ ê²ƒì…ë‹ˆë‹¤.
```bash
sudo mkdir /efs
sudo mount -t efs -o tls,iam  <file-system-id/EFS DNS name>:/ /efs/
```
**ì¶”ê°€ ê¶Œí•œ** `elasticfilesystem:ClientRootAccess` ë° `elasticfilesystem:ClientWrite`ëŠ” íŒŒì¼ ì‹œìŠ¤í…œì´ ë§ˆìš´íŠ¸ëœ í›„ì— **ë‚´ë¶€ì— ì“°ê¸°**í•˜ê³  í•´ë‹¹ íŒŒì¼ ì‹œìŠ¤í…œì„ **ë£¨íŠ¸ë¡œ ì•¡ì„¸ìŠ¤**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

**ì ì¬ì ì¸ ì˜í–¥:** íŒŒì¼ ì‹œìŠ¤í…œì—ì„œ ë¯¼ê°í•œ ì •ë³´ë¥¼ ì°¾ì•„ ê°„ì ‘ì ì¸ ê¶Œí•œ ìƒìŠ¹.

### `elasticfilesystem:CreateMountTarget`

ë§Œì•½ **EFSì˜ ë§ˆìš´íŠ¸ ëŒ€ìƒì´ ì—†ëŠ”** **ì„œë¸Œë„¤íŠ¸ì›Œí¬**ì— ê³µê²©ìê°€ ìˆë‹¤ë©´, ì´ ê¶Œí•œìœ¼ë¡œ **ìì‹ ì˜ ì„œë¸Œë„·ì— í•˜ë‚˜ë¥¼ ìƒì„±**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```bash
# You need to indicate security groups that will grant the user access to port 2049
aws efs create-mount-target --file-system-id <fs-id> \
--subnet-id <value> \
--security-groups <value>
```
**ì ì¬ì  ì˜í–¥:** íŒŒì¼ ì‹œìŠ¤í…œì—ì„œ ë¯¼ê°í•œ ì •ë³´ë¥¼ ì°¾ì•„ ê°„ì ‘ì ìœ¼ë¡œ ê¶Œí•œ ìƒìŠ¹.

### `elasticfilesystem:ModifyMountTargetSecurityGroups`

ê³µê²©ìê°€ EFSì— ìì‹ ì˜ ì„œë¸Œë„¤íŠ¸ì›Œí¬ì— ë§ˆìš´íŠ¸ ëŒ€ìƒì´ ìˆì§€ë§Œ **íŠ¸ë˜í”½ì„ í—ˆìš©í•˜ëŠ” ë³´ì•ˆ ê·¸ë£¹ì´ ì—†ëŠ” ê²ƒì„ ë°œê²¬í•œ ì‹œë‚˜ë¦¬ì˜¤**ì—ì„œ, ê·¸ëŠ” **ì„ íƒí•œ ë³´ì•ˆ ê·¸ë£¹ì„ ìˆ˜ì •í•˜ì—¬ ê·¸ê²ƒì„ ë³€ê²½**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```bash
aws efs modify-mount-target-security-groups \
--mount-target-id <value> \
--security-groups <value>
```
**ì ì¬ì ì¸ ì˜í–¥:** íŒŒì¼ ì‹œìŠ¤í…œì—ì„œ ë¯¼ê°í•œ ì •ë³´ë¥¼ ì°¾ì•„ ê°„ì ‘ì ì¸ ê¶Œí•œ ìƒìŠ¹.

{% hint style="success" %}
AWS í•´í‚¹ í•™ìŠµ ë° ì‹¤ìŠµ:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCP í•´í‚¹ í•™ìŠµ ë° ì‹¤ìŠµ: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks ì§€ì›</summary>

* [**êµ¬ë… ìš”ê¸ˆì œ**](https://github.com/sponsors/carlospolop)ë¥¼ í™•ì¸í•˜ì„¸ìš”!
* ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— **ì°¸ì—¬**í•˜ê±°ë‚˜ **íŠ¸ìœ„í„°** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**ë¥¼ íŒ”ë¡œìš°**í•˜ì„¸ìš”.
* í•´í‚¹ íŒì„ ê³µìœ í•˜ë ¤ë©´ [**HackTricks**](https://github.com/carlospolop/hacktricks) ë° [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) ê¹ƒí—™ ì €ì¥ì†Œì— PRì„ ì œì¶œí•˜ì„¸ìš”.

</details>
{% endhint %}
