# AWS - S3 Post Explotaci贸n

{% hint style="success" %}
Aprende y practica Hacking en AWS:<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Aprende y practica Hacking en GCP: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Apoya a HackTricks</summary>

* Revisa los [**planes de suscripci贸n**](https://github.com/sponsors/carlospolop)!
* **nete al**  [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s铆guenos** en **Twitter**  [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Comparte trucos de hacking enviando PRs a los** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repos de github.

</details>
{% endhint %}

## S3

Para m谩s informaci贸n consulta:

{% content-ref url="../aws-services/aws-s3-athena-and-glacier-enum.md" %}
[aws-s3-athena-and-glacier-enum.md](../aws-services/aws-s3-athena-and-glacier-enum.md)
{% endcontent-ref %}

### Informaci贸n Sensible

A veces podr谩s encontrar informaci贸n sensible legible en los buckets. Por ejemplo, secretos del estado de terraform.

### Pivotar

Diferentes plataformas podr铆an estar usando S3 para almacenar activos sensibles.\
Por ejemplo, **airflow** podr铆a estar almacenando **c贸digo** de **DAGs** all铆, o **p谩ginas web** podr铆an ser servidas directamente desde S3. Un atacante con permisos de escritura podr铆a **modificar el c贸digo** del bucket para **pivotar** a otras plataformas, o **tomar el control de cuentas** modificando archivos JS.

### Ransomware en S3

En este escenario, el **atacante crea una clave KMS (Key Management Service) en su propia cuenta de AWS** o en otra cuenta comprometida. Luego hace que esta **clave sea accesible para cualquier persona en el mundo**, permitiendo a cualquier usuario, rol o cuenta de AWS cifrar objetos usando esta clave. Sin embargo, los objetos no pueden ser descifrados.

El atacante identifica un **bucket S3 y obtiene acceso a nivel de escritura** a 茅l utilizando varios m茅todos. Esto podr铆a deberse a una mala configuraci贸n del bucket que lo expone p煤blicamente o a que el atacante obtiene acceso al entorno de AWS. El atacante generalmente apunta a buckets que contienen informaci贸n sensible como informaci贸n de identificaci贸n personal (PII), informaci贸n de salud protegida (PHI), registros, copias de seguridad, y m谩s.

Para determinar si el bucket puede ser objetivo de ransomware, el atacante verifica su configuraci贸n. Esto incluye verificar si **S3 Object Versioning** est谩 habilitado y si **la eliminaci贸n de autenticaci贸n multifactor (MFA delete) est谩 habilitada**. Si la versi贸n de objetos no est谩 habilitada, el atacante puede proceder. Si la versi贸n de objetos est谩 habilitada pero la eliminaci贸n MFA est谩 deshabilitada, el atacante puede **deshabilitar la versi贸n de objetos**. Si tanto la versi贸n de objetos como la eliminaci贸n MFA est谩n habilitadas, se vuelve m谩s dif铆cil para el atacante realizar ransomware en ese bucket espec铆fico.

Usando la API de AWS, el atacante **reemplaza cada objeto en el bucket con una copia cifrada usando su clave KMS**. Esto cifra efectivamente los datos en el bucket, haci茅ndolos inaccesibles sin la clave.

Para a帽adir m谩s presi贸n, el atacante programa la eliminaci贸n de la clave KMS utilizada en el ataque. Esto le da al objetivo una ventana de 7 d铆as para recuperar sus datos antes de que la clave sea eliminada y los datos se pierdan permanentemente.

Finalmente, el atacante podr铆a subir un archivo final, generalmente llamado "ransom-note.txt," que contiene instrucciones para el objetivo sobre c贸mo recuperar sus archivos. Este archivo se sube sin cifrado, probablemente para captar la atenci贸n del objetivo y hacerle consciente del ataque de ransomware.

**Para m谩s informaci贸n** [**consulta la investigaci贸n original**](https://rhinosecuritylabs.com/aws/s3-ransomware-part-1-attack-vector/)**.**

{% hint style="success" %}
Aprende y practica Hacking en AWS:<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Aprende y practica Hacking en GCP: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Apoya a HackTricks</summary>

* Revisa los [**planes de suscripci贸n**](https://github.com/sponsors/carlospolop)!
* **nete al**  [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s铆guenos** en **Twitter**  [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Comparte trucos de hacking enviando PRs a los** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repos de github.

</details>
{% endhint %}
