# AWS - Exploitation Post-S3

{% hint style="success" %}
Apprenez et pratiquez le piratage AWS :<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**Formation HackTricks AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Apprenez et pratiquez le piratage GCP : <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**Formation HackTricks GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Soutenez HackTricks</summary>

* Consultez les [**plans d'abonnement**](https://github.com/sponsors/carlospolop)!
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez-nous** sur **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Partagez des astuces de piratage en soumettant des PR aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) d√©p√¥ts GitHub.

</details>
{% endhint %}

## S3

Pour plus d'informations, consultez :

{% content-ref url="../aws-services/aws-s3-athena-and-glacier-enum.md" %}
[aws-s3-athena-and-glacier-enum.md](../aws-services/aws-s3-athena-and-glacier-enum.md)
{% endcontent-ref %}

### Informations Sensibles

Parfois, vous pourrez trouver des informations sensibles lisibles dans les buckets. Par exemple, des secrets d'√©tat terraform.

### Pivotage

Diff√©rentes plateformes pourraient utiliser S3 pour stocker des actifs sensibles.\
Par exemple, **airflow** pourrait stocker du **code DAGs** l√†-dedans, ou des **pages web** pourraient √™tre directement servies depuis S3. Un attaquant avec des autorisations d'√©criture pourrait **modifier le code** du bucket pour **pivoter** vers d'autres plateformes, ou **prendre le contr√¥le de comptes** en modifiant des fichiers JS.

### Ran√ßongiciel S3

Dans ce sc√©nario, l'**attaquant cr√©e une cl√© KMS (Key Management Service) dans son propre compte AWS** ou un autre compte compromis. Il rend ensuite cette **cl√© accessible √† quiconque dans le monde**, permettant √† tout utilisateur, r√¥le ou compte AWS de chiffrer des objets avec cette cl√©. Cependant, les objets ne peuvent pas √™tre d√©chiffr√©s.

L'attaquant identifie un **bucket S3 cible et obtient un acc√®s de niveau √©criture** en utilisant diverses m√©thodes. Cela pourrait √™tre d√ª √† une mauvaise configuration du bucket qui l'expose publiquement ou √† l'attaquant ayant acc√®s √† l'environnement AWS lui-m√™me. L'attaquant cible g√©n√©ralement des buckets contenant des informations sensibles telles que des informations personnellement identifiables (PII), des informations de sant√© prot√©g√©es (PHI), des journaux, des sauvegardes, et plus encore.

Pour d√©terminer si le bucket peut √™tre cibl√© par un ran√ßongiciel, l'attaquant v√©rifie sa configuration. Cela inclut la v√©rification si la **version d'objet S3** est activ√©e et si la **suppression multi-facteurs (MFA delete) est activ√©e**. Si la version d'objet n'est pas activ√©e, l'attaquant peut proc√©der. Si la version d'objet est activ√©e mais que la suppression MFA est d√©sactiv√©e, l'attaquant peut **d√©sactiver la version d'objet**. Si la version d'objet et la suppression MFA sont activ√©es, il devient plus difficile pour l'attaquant de ran√ßonner ce bucket sp√©cifique.

En utilisant l'API AWS, l'attaquant **remplace chaque objet dans le bucket par une copie chiffr√©e en utilisant sa cl√© KMS**. Cela chiffre efficacement les donn√©es dans le bucket, les rendant inaccessibles sans la cl√©.

Pour exercer une pression suppl√©mentaire, l'attaquant planifie la suppression de la cl√© KMS utilis√©e dans l'attaque. Cela donne √† la cible une fen√™tre de 7 jours pour r√©cup√©rer ses donn√©es avant que la cl√© ne soit supprim√©e et que les donn√©es soient d√©finitivement perdues.

Enfin, l'attaquant pourrait t√©l√©charger un fichier final, g√©n√©ralement nomm√© "ransom-note.txt", qui contient des instructions pour la cible sur la fa√ßon de r√©cup√©rer ses fichiers. Ce fichier est t√©l√©charg√© sans cryptage, probablement pour attirer l'attention de la cible et la sensibiliser √† l'attaque par ran√ßongiciel.

**Pour plus d'informations** [**consultez la recherche originale**](https://rhinosecuritylabs.com/aws/s3-ransomware-part-1-attack-vector/)**.**

{% hint style="success" %}
Apprenez et pratiquez le piratage AWS :<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**Formation HackTricks AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Apprenez et pratiquez le piratage GCP : <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**Formation HackTricks GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Soutenez HackTricks</summary>

* Consultez les [**plans d'abonnement**](https://github.com/sponsors/carlospolop)!
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez-nous** sur **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Partagez des astuces de piratage en soumettant des PR aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) d√©p√¥ts GitHub.

</details>
{% endhint %}
