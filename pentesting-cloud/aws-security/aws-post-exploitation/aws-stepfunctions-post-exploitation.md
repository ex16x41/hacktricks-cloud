# AWS - Step Functions Post Exploitation

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Step Functions

–î–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –¥–æ–¥–∞—Ç–∫–æ–≤–æ—ó —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó –ø—Ä–æ —Ü—é —Å–ª—É–∂–±—É AWS, –ø–µ—Ä–µ–≥–ª—è–Ω—å—Ç–µ:

{% content-ref url="../aws-services/aws-stepfunctions-enum.md" %}
[aws-stepfunctions-enum.md](../aws-services/aws-stepfunctions-enum.md)
{% endcontent-ref %}

### `states:RevealSecrets`

–¶–µ–π –¥–æ–∑–≤—ñ–ª –¥–æ–∑–≤–æ–ª—è—î **–≤–∏—è–≤–∏—Ç–∏ —Å–µ–∫—Ä–µ—Ç–Ω—ñ –¥–∞–Ω—ñ –ø—ñ–¥ —á–∞—Å –≤–∏–∫–æ–Ω–∞–Ω–Ω—è**. –î–ª—è —Ü—å–æ–≥–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ –≤—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ —Ä—ñ–≤–µ–Ω—å –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –Ω–∞ TRACE —ñ –ø–∞—Ä–∞–º–µ—Ç—Ä revealSecrets –Ω–∞ true.

<figure><img src="../../../.gitbook/assets/image (348).png" alt=""><figcaption></figcaption></figure>

### `states:DeleteStateMachine`, `states:DeleteStateMachineVersion`, `states:DeleteStateMachineAlias`

–ó–ª–æ–≤–º–∏—Å–Ω–∏–∫ –∑ —Ü–∏–º–∏ –¥–æ–∑–≤–æ–ª–∞–º–∏ –∑–º–æ–∂–µ –Ω–∞–∑–∞–≤–∂–¥–∏ –≤–∏–¥–∞–ª–∏—Ç–∏ –º–∞—à–∏–Ω–∏ —Å—Ç–∞–Ω—ñ–≤, —ó—Ö –≤–µ—Ä—Å—ñ—ó —Ç–∞ –ø—Å–µ–≤–¥–æ–Ω—ñ–º–∏. –¶–µ –º–æ–∂–µ –ø–æ—Ä—É—à–∏—Ç–∏ –∫—Ä–∏—Ç–∏—á–Ω–æ –≤–∞–∂–ª–∏–≤—ñ —Ä–æ–±–æ—á—ñ –ø—Ä–æ—Ü–µ—Å–∏, –ø—Ä–∏–∑–≤–µ—Å—Ç–∏ –¥–æ –≤—Ç—Ä–∞—Ç–∏ –¥–∞–Ω–∏—Ö —ñ –≤–∏–º–∞–≥–∞—Ç–∏ –∑–Ω–∞—á–Ω–æ–≥–æ —á–∞—Å—É –¥–ª—è –≤—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è —Ç–∞ –≤—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è –ø–æ—Å—Ç—Ä–∞–∂–¥–∞–ª–∏—Ö –º–∞—à–∏–Ω —Å—Ç–∞–Ω—ñ–≤. –ö—Ä—ñ–º —Ç–æ–≥–æ, —Ü–µ –¥–æ–∑–≤–æ–ª–∏—Ç—å –∑–ª–æ–≤–º–∏—Å–Ω–∏–∫—É –ø—Ä–∏—Ö–æ–≤–∞—Ç–∏ —Å–ª—ñ–¥–∏, –ø–æ—Ä—É—à–∏—Ç–∏ —Å—É–¥–æ–≤–æ-–º–µ–¥–∏—á–Ω—ñ —Ä–æ–∑—Å–ª—ñ–¥—É–≤–∞–Ω–Ω—è —Ç–∞ –ø–æ—Ç–µ–Ω—Ü—ñ–π–Ω–æ –ø–∞—Ä–∞–ª—ñ–∑—É–≤–∞—Ç–∏ –æ–ø–µ—Ä–∞—Ü—ñ—ó, –≤–∏–¥–∞–ª–∏–≤—à–∏ –≤–∞–∂–ª–∏–≤—ñ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–æ–≤–∞–Ω—ñ –ø—Ä–æ—Ü–µ—Å–∏ —Ç–∞ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó —Å—Ç–∞–Ω—ñ–≤.

{% hint style="info" %}
* –í–∏–¥–∞–ª—è—é—á–∏ –º–∞—à–∏–Ω—É —Å—Ç–∞–Ω—ñ–≤, –≤–∏ —Ç–∞–∫–æ–∂ –≤–∏–¥–∞–ª—è—î—Ç–µ –≤—Å—ñ —ó—ó –∞—Å–æ—Ü—ñ–π–æ–≤–∞–Ω—ñ –≤–µ—Ä—Å—ñ—ó —Ç–∞ –ø—Å–µ–≤–¥–æ–Ω—ñ–º–∏.
* –í–∏–¥–∞–ª—è—é—á–∏ –ø—Å–µ–≤–¥–æ–Ω—ñ–º –º–∞—à–∏–Ω–∏ —Å—Ç–∞–Ω—ñ–≤, –≤–∏ –Ω–µ –≤–∏–¥–∞–ª—è—î—Ç–µ –≤–µ—Ä—Å—ñ—ó –º–∞—à–∏–Ω–∏ —Å—Ç–∞–Ω—ñ–≤, —â–æ –ø–æ—Å–∏–ª–∞—é—Ç—å—Å—è –Ω–∞ —Ü–µ–π –ø—Å–µ–≤–¥–æ–Ω—ñ–º.
* –ù–µ–º–æ–∂–ª–∏–≤–æ –≤–∏–¥–∞–ª–∏—Ç–∏ –≤–µ—Ä—Å—ñ—é –º–∞—à–∏–Ω–∏ —Å—Ç–∞–Ω—ñ–≤, —è–∫–∞ –≤ –¥–∞–Ω–∏–π —á–∞—Å –ø–æ—Å–∏–ª–∞—î—Ç—å—Å—è –Ω–∞ –æ–¥–∏–Ω –∞–±–æ –∫—ñ–ª—å–∫–∞ –ø—Å–µ–≤–¥–æ–Ω—ñ–º—ñ–≤.
{% endhint %}
```bash
# Delete state machine
aws stepfunctions delete-state-machine --state-machine-arn <value>
# Delete state machine version
aws stepfunctions delete-state-machine-version --state-machine-version-arn <value>
# Delete state machine alias
aws stepfunctions delete-state-machine-alias --state-machine-alias-arn <value>
```
* **Potential Impact**: –ü–æ—Ä—É—à–µ–Ω–Ω—è –∫—Ä–∏—Ç–∏—á–Ω–∏—Ö —Ä–æ–±–æ—á–∏—Ö –ø—Ä–æ—Ü–µ—Å—ñ–≤, –≤—Ç—Ä–∞—Ç–∞ –¥–∞–Ω–∏—Ö —Ç–∞ –ø—Ä–æ—Å—Ç–æ—ó –≤ —Ä–æ–±–æ—Ç—ñ.

### `states:UpdateMapRun`

–ó–ª–æ–≤–º–∏—Å–Ω–∏–∫ –∑ —Ü–∏–º–∏ –ø—Ä–∞–≤–∞–º–∏ –∑–º–æ–∂–µ –º–∞–Ω—ñ–ø—É–ª—é–≤–∞—Ç–∏ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—î—é –ø–æ–º–∏–ª–æ–∫ Map Run —Ç–∞ –ø–∞—Ä–∞–ª–µ–ª—å–Ω–∏–º–∏ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è–º–∏, –º–∞—é—á–∏ –º–æ–∂–ª–∏–≤—ñ—Å—Ç—å –∑–±—ñ–ª—å—à—É–≤–∞—Ç–∏ –∞–±–æ –∑–º–µ–Ω—à—É–≤–∞—Ç–∏ –º–∞–∫—Å–∏–º–∞–ª—å–Ω—É –∫—ñ–ª—å–∫—ñ—Å—Ç—å –≤–∏–∫–æ–Ω–∞–Ω—å –¥–æ—á—ñ—Ä–Ω—ñ—Ö —Ä–æ–±–æ—á–∏—Ö –ø—Ä–æ—Ü–µ—Å—ñ–≤, —â–æ –±–µ–∑–ø–æ—Å–µ—Ä–µ–¥–Ω—å–æ –≤–ø–ª–∏–Ω–µ –Ω–∞ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å —Å–µ—Ä–≤—ñ—Å—É. –ö—Ä—ñ–º —Ç–æ–≥–æ, –∑–ª–æ–≤–º–∏—Å–Ω–∏–∫ –º–æ–∂–µ –ø—ñ–¥—Ä–æ–±–∏—Ç–∏ –¥–æ–ø—É—Å—Ç–∏–º–∏–π –≤—ñ–¥—Å–æ—Ç–æ–∫ –ø–æ–º–∏–ª–æ–∫ —Ç–∞ —ó—Ö –∫—ñ–ª—å–∫—ñ—Å—Ç—å, –∑–º–µ–Ω—à—É—é—á–∏ —Ü–µ –∑–Ω–∞—á–µ–Ω–Ω—è –¥–æ 0, —Ç–∞–∫ —â–æ —â–æ—Ä–∞–∑—É, –∫–æ–ª–∏ –µ–ª–µ–º–µ–Ω—Ç –∑–∞–∑–Ω–∞—î –Ω–µ–≤–¥–∞—á—ñ, –≤–µ—Å—å –∑–∞–ø—É—Å–∫ –∫–∞—Ä—Ç–∏ –∑–∞–∑–Ω–∞—î –Ω–µ–≤–¥–∞—á—ñ, —â–æ –±–µ–∑–ø–æ—Å–µ—Ä–µ–¥–Ω—å–æ –≤–ø–ª–∏–Ω–µ –Ω–∞ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è —Å—Ç–∞–Ω—ñ–≤ –º–∞—à–∏–Ω–∏ —Ç–∞ –ø–æ—Ç–µ–Ω—Ü—ñ–π–Ω–æ –ø–æ—Ä—É—à–∏—Ç—å –∫—Ä–∏—Ç–∏—á–Ω—ñ —Ä–æ–±–æ—á—ñ –ø—Ä–æ—Ü–µ—Å–∏.

{% code overflow="wrap" %}
```bash
aws stepfunctions update-map-run --map-run-arn <value> [--max-concurrency <value>] [--tolerated-failure-percentage <value>] [--tolerated-failure-count <value>]
```
{% endcode %}

* **–ü–æ—Ç–µ–Ω—Ü—ñ–π–Ω–∏–π –≤–ø–ª–∏–≤**: –ó–Ω–∏–∂–µ–Ω–Ω—è –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ —Ç–∞ –ø–æ—Ä—É—à–µ–Ω–Ω—è –∫—Ä–∏—Ç–∏—á–Ω–∏—Ö —Ä–æ–±–æ—á–∏—Ö –ø—Ä–æ—Ü–µ—Å—ñ–≤.

### `states:StopExecution`

–ó–ª–æ–≤–º–∏—Å–Ω–∏–∫ –∑ —Ü–∏–º –¥–æ–∑–≤–æ–ª–æ–º –º–æ–∂–µ –∑—É–ø–∏–Ω–∏—Ç–∏ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –±—É–¥—å-—è–∫–æ—ó –º–∞—à–∏–Ω–∏ —Å—Ç–∞–Ω—ñ–≤, –ø–æ—Ä—É—à—É—é—á–∏ –ø–æ—Ç–æ—á–Ω—ñ —Ä–æ–±–æ—á—ñ –ø—Ä–æ—Ü–µ—Å–∏ —Ç–∞ –ø—Ä–æ—Ü–µ–¥—É—Ä–∏. –¶–µ –º–æ–∂–µ –ø—Ä–∏–∑–≤–µ—Å—Ç–∏ –¥–æ –Ω–µ–∑–∞–≤–µ—Ä—à–µ–Ω–∏—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ–π, –∑—É–ø–∏–Ω–∫–∏ –±—ñ–∑–Ω–µ—Å-–æ–ø–µ—Ä–∞—Ü—ñ–π —Ç–∞ –ø–æ—Ç–µ–Ω—Ü—ñ–π–Ω–æ—ó –∫–æ—Ä—É–ø—Ü—ñ—ó –¥–∞–Ω–∏—Ö.

{% hint style="warning" %}
–¶—è –¥—ñ—è –Ω–µ –ø—ñ–¥—Ç—Ä–∏–º—É—î—Ç—å—Å—è **–µ–∫—Å–ø—Ä–µ—Å-–º–∞—à–∏–Ω–∞–º–∏ —Å—Ç–∞–Ω—ñ–≤**.
{% endhint %}

{% code overflow="wrap" %}
```bash
aws stepfunctions stop-execution --execution-arn <value> [--error <value>] [--cause <value>]
```
{% endcode %}

* **–ü–æ—Ç–µ–Ω—Ü—ñ–π–Ω–∏–π –≤–ø–ª–∏–≤**: –ü–æ—Ä—É—à–µ–Ω–Ω—è –ø–æ—Ç–æ—á–Ω–∏—Ö —Ä–æ–±–æ—á–∏—Ö –ø—Ä–æ—Ü–µ—Å—ñ–≤, –æ–ø–µ—Ä–∞—Ü—ñ–π–Ω–∏–π –ø—Ä–æ—Å—Ç—ñ–π —Ç–∞ –ø–æ—Ç–µ–Ω—Ü—ñ–π–Ω–∞ –∫–æ—Ä—É–ø—Ü—ñ—è –¥–∞–Ω–∏—Ö.

### `states:TagResource`, `states:UntagResource`

–ó–ª–æ–≤–º–∏—Å–Ω–∏–∫ –º–æ–∂–µ –¥–æ–¥–∞–≤–∞—Ç–∏, –∑–º—ñ–Ω—é–≤–∞—Ç–∏ –∞–±–æ –≤–∏–¥–∞–ª—è—Ç–∏ —Ç–µ–≥–∏ –∑ —Ä–µ—Å—É—Ä—Å—ñ–≤ Step Functions, –ø–æ—Ä—É—à—É—é—á–∏ —Ä–æ–∑–ø–æ–¥—ñ–ª –≤–∏—Ç—Ä–∞—Ç –≤–∞—à–æ—ó –æ—Ä–≥–∞–Ω—ñ–∑–∞—Ü—ñ—ó, –≤—ñ–¥—Å—Ç–µ–∂–µ–Ω–Ω—è —Ä–µ—Å—É—Ä—Å—ñ–≤ —Ç–∞ –ø–æ–ª—ñ—Ç–∏–∫–∏ –∫–æ–Ω—Ç—Ä–æ–ª—é –¥–æ—Å—Ç—É–ø—É –Ω–∞ –æ—Å–Ω–æ–≤—ñ —Ç–µ–≥—ñ–≤.
```bash
aws stepfunctions tag-resource --resource-arn <value> --tags Key=<key>,Value=<value>
aws stepfunctions untag-resource --resource-arn <value> --tag-keys <key>
```
**–ü–æ—Ç–µ–Ω—Ü—ñ–π–Ω–∏–π –≤–ø–ª–∏–≤**: –ü–æ—Ä—É—à–µ–Ω–Ω—è —Ä–æ–∑–ø–æ–¥—ñ–ª—É –≤–∏—Ç—Ä–∞—Ç, –≤—ñ–¥—Å—Ç–µ–∂–µ–Ω–Ω—è —Ä–µ—Å—É—Ä—Å—ñ–≤ —Ç–∞ –ø–æ–ª—ñ—Ç–∏–∫ –∫–æ–Ω—Ç—Ä–æ–ª—é –¥–æ—Å—Ç—É–ø—É –Ω–∞ –æ—Å–Ω–æ–≤—ñ —Ç–µ–≥—ñ–≤.

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
