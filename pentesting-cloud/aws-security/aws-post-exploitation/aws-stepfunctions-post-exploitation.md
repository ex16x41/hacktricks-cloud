# AWS - Step Functions Post Exploitation

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** 💬 [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Step Functions

Για περισσότερες πληροφορίες σχετικά με αυτή την υπηρεσία AWS, ελέγξτε:

{% content-ref url="../aws-services/aws-stepfunctions-enum.md" %}
[aws-stepfunctions-enum.md](../aws-services/aws-stepfunctions-enum.md)
{% endcontent-ref %}

### `states:DeleteStateMachine`, `states:DeleteStateMachineVersion`, `states:DeleteStateMachineAlias`

Ένας επιτιθέμενος με αυτές τις άδειες θα μπορούσε να διαγράψει μόνιμα τις μηχανές κατάστασης, τις εκδόσεις τους και τα ψευδώνυμα. Αυτό μπορεί να διαταράξει κρίσιες ροές εργασίας, να οδηγήσει σε απώλεια δεδομένων και να απαιτήσει σημαντικό χρόνο για την αποκατάσταση και την αποκατάσταση των επηρεαζόμενων μηχανών κατάστασης. Επιπλέον, θα επέτρεπε σε έναν επιτιθέμενο να καλύψει τα ίχνη που χρησιμοποιήθηκαν, να διαταράξει τις εγκληματολογικές έρευνες και ενδεχομένως να παραλύσει τις λειτουργίες αφαιρώντας βασικές διαδικασίες αυτοματοποίησης και ρυθμίσεις κατάστασης.

{% hint style="info" %}
* Διαγράφοντας μια μηχανή κατάστασης διαγράφετε επίσης όλες τις σχετικές εκδόσεις και ψευδώνυμα της.
* Διαγράφοντας ένα ψευδώνυμο μηχανής κατάστασης δεν διαγράφετε τις εκδόσεις της μηχανής κατάστασης που αναφέρονται σε αυτό το ψευδώνυμο.
* Δεν είναι δυνατή η διαγραφή μιας έκδοσης μηχανής κατάστασης που αναφέρεται αυτή τη στιγμή από ένα ή περισσότερα ψευδώνυμα.
{% endhint %}
```bash
# Delete state machine
aws stepfunctions delete-state-machine --state-machine-arn <value>
# Delete state machine version
aws stepfunctions delete-state-machine-version --state-machine-version-arn <value>
# Delete state machine alias
aws stepfunctions delete-state-machine-alias --state-machine-alias-arn <value>
```
* **Πιθανές Επιπτώσεις**: Διακοπή κρίσιμων ροών εργασίας, απώλεια δεδομένων και διακοπή λειτουργίας.

### `states:UpdateMapRun`

Ένας επιτιθέμενος με αυτή την άδεια θα μπορούσε να χειριστεί τη ρύθμιση αποτυχίας του Map Run και την παράλληλη ρύθμιση, έχοντας τη δυνατότητα να αυξήσει ή να μειώσει τον μέγιστο αριθμό εκτελέσεων παιδικών ροών εργασίας που επιτρέπονται, επηρεάζοντας άμεσα την απόδοση της υπηρεσίας. Επιπλέον, ένας επιτιθέμενος θα μπορούσε να παραποιήσει το ποσοστό και τον αριθμό των ανεκτών αποτυχιών, έχοντας τη δυνατότητα να μειώσει αυτή την τιμή στο 0, έτσι ώστε κάθε φορά που ένα στοιχείο αποτυγχάνει, ολόκληρο το map run να αποτυγχάνει, επηρεάζοντας άμεσα την εκτέλεση της μηχανής κατάστασης και δυνητικά διαταράσσοντας κρίσιμες ροές εργασίας.

{% code overflow="wrap" %}
```bash
aws stepfunctions update-map-run --map-run-arn <value> [--max-concurrency <value>] [--tolerated-failure-percentage <value>] [--tolerated-failure-count <value>]
```
{% endcode %}

* **Πιθανές Επιπτώσεις**: Επιβράδυνση της απόδοσης και διακοπή κρίσιμων ροών εργασίας.

### `states:StopExecution`

Ένας επιτιθέμενος με αυτή την άδεια θα μπορούσε να είναι σε θέση να σταματήσει την εκτέλεση οποιασδήποτε μηχανής κατάστασης, διακόπτοντας τις τρέχουσες ροές εργασίας και διαδικασίες. Αυτό θα μπορούσε να οδηγήσει σε ατελείς συναλλαγές, σταμάτημα επιχειρηματικών λειτουργιών και πιθανή διαφθορά δεδομένων.

{% hint style="warning" %}
Αυτή η ενέργεια δεν υποστηρίζεται από **μηχανές κατάστασης express**.
{% endhint %}

{% code overflow="wrap" %}
```bash
aws stepfunctions stop-execution --execution-arn <value> [--error <value>] [--cause <value>]
```
{% endcode %}

* **Πιθανές Επιπτώσεις**: Διακοπή τρεχουσών ροών εργασίας, λειτουργική διακοπή και πιθανή διαφθορά δεδομένων.

### `states:TagResource`, `states:UntagResource`

Ένας επιτιθέμενος θα μπορούσε να προσθέσει, να τροποποιήσει ή να αφαιρέσει ετικέτες από τους πόρους των Step Functions, διαταράσσοντας την κατανομή κόστους της οργάνωσής σας, την παρακολούθηση πόρων και τις πολιτικές ελέγχου πρόσβασης με βάση τις ετικέτες.
```bash
aws stepfunctions tag-resource --resource-arn <value> --tags Key=<key>,Value=<value>
aws stepfunctions untag-resource --resource-arn <value> --tag-keys <key>
```
**Πιθανές Επιπτώσεις**: Διαταραχή της κατανομής κόστους, παρακολούθησης πόρων και πολιτικών ελέγχου πρόσβασης με βάση τις ετικέτες.

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** 💬 [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
