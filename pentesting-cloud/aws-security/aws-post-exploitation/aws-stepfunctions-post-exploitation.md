# AWS - Step Functions Post Explotaci칩n

{% hint style="success" %}
Aprende y practica Hacking en AWS:<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
Aprende y practica Hacking en GCP: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Apoya a HackTricks</summary>

* Revisa los [**planes de suscripci칩n**](https://github.com/sponsors/carlospolop)!
* **칔nete al** 游눫 [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s칤guenos** en **Twitter** 游냕 [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Comparte trucos de hacking enviando PRs a los** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repos de github.

</details>
{% endhint %}

## Step Functions

Para m치s informaci칩n sobre este servicio de AWS, consulta:

{% content-ref url="../aws-services/aws-stepfunctions-enum.md" %}
[aws-stepfunctions-enum.md](../aws-services/aws-stepfunctions-enum.md)
{% endcontent-ref %}

### `states:RevealSecrets`

Este permiso permite **revelar datos secretos dentro de una ejecuci칩n**. Para ello, es necesario establecer el nivel de Inspecci칩n en TRACE y el par치metro revealSecrets en true.

<figure><img src="../../../.gitbook/assets/image (348).png" alt=""><figcaption></figcaption></figure>

### `states:DeleteStateMachine`, `states:DeleteStateMachineVersion`, `states:DeleteStateMachineAlias`

Un atacante con estos permisos podr칤a eliminar permanentemente m치quinas de estado, sus versiones y alias. Esto puede interrumpir flujos de trabajo cr칤ticos, resultar en p칠rdida de datos y requerir un tiempo significativo para recuperar y restaurar las m치quinas de estado afectadas. Adem치s, permitir칤a a un atacante cubrir las huellas utilizadas, interrumpir investigaciones forenses y potencialmente paralizar operaciones al eliminar procesos de automatizaci칩n esenciales y configuraciones de estado.

{% hint style="info" %}
* Al eliminar una m치quina de estado, tambi칠n eliminas todas sus versiones y alias asociados.
* Al eliminar un alias de m치quina de estado, no eliminas las versiones de la m치quina de estado que hacen referencia a este alias.
* No es posible eliminar una versi칩n de m치quina de estado actualmente referenciada por uno o m치s alias.
{% endhint %}
```bash
# Delete state machine
aws stepfunctions delete-state-machine --state-machine-arn <value>
# Delete state machine version
aws stepfunctions delete-state-machine-version --state-machine-version-arn <value>
# Delete state machine alias
aws stepfunctions delete-state-machine-alias --state-machine-alias-arn <value>
```
* **Impacto Potencial**: Disrupci칩n de flujos de trabajo cr칤ticos, p칠rdida de datos y tiempo de inactividad operativo.

### `states:UpdateMapRun`

Un atacante con este permiso podr칤a manipular la configuraci칩n de falla del Map Run y la configuraci칩n paralela, pudiendo aumentar o disminuir el n칰mero m치ximo de ejecuciones de flujos de trabajo hijo permitidas, afectando directamente el rendimiento del servicio. Adem치s, un atacante podr칤a alterar el porcentaje y el conteo de fallas toleradas, pudiendo disminuir este valor a 0, de modo que cada vez que un elemento falle, todo el map run fallar칤a, afectando directamente la ejecuci칩n de la m치quina de estados y potencialmente interrumpiendo flujos de trabajo cr칤ticos.

{% code overflow="wrap" %}
```bash
aws stepfunctions update-map-run --map-run-arn <value> [--max-concurrency <value>] [--tolerated-failure-percentage <value>] [--tolerated-failure-count <value>]
```
{% endcode %}

* **Impacto Potencial**: Degradaci칩n del rendimiento y interrupci칩n de flujos de trabajo cr칤ticos.

### `states:StopExecution`

Un atacante con este permiso podr칤a detener la ejecuci칩n de cualquier m치quina de estados, interrumpiendo flujos de trabajo y procesos en curso. Esto podr칤a llevar a transacciones incompletas, operaciones comerciales detenidas y posible corrupci칩n de datos.

{% hint style="warning" %}
Esta acci칩n no es compatible con **m치quinas de estados expresas**.
{% endhint %}

{% code overflow="wrap" %}
```bash
aws stepfunctions stop-execution --execution-arn <value> [--error <value>] [--cause <value>]
```
{% endcode %}

* **Impacto Potencial**: Disrupci칩n de flujos de trabajo en curso, tiempo de inactividad operativo y posible corrupci칩n de datos.

### `states:TagResource`, `states:UntagResource`

Un atacante podr칤a agregar, modificar o eliminar etiquetas de los recursos de Step Functions, interrumpiendo la asignaci칩n de costos de su organizaci칩n, el seguimiento de recursos y las pol칤ticas de control de acceso basadas en etiquetas.
```bash
aws stepfunctions tag-resource --resource-arn <value> --tags Key=<key>,Value=<value>
aws stepfunctions untag-resource --resource-arn <value> --tag-keys <key>
```
**Impacto Potencial**: Disrupci칩n de la asignaci칩n de costos, seguimiento de recursos y pol칤ticas de control de acceso basadas en etiquetas.

{% hint style="success" %}
Aprende y practica Hacking en AWS:<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
Aprende y practica Hacking en GCP: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Apoya a HackTricks</summary>

* Revisa los [**planes de suscripci칩n**](https://github.com/sponsors/carlospolop)!
* **칔nete al** 游눫 [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s칤guenos** en **Twitter** 游냕 [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Comparte trucos de hacking enviando PRs a los** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repositorios de github.

</details>
{% endhint %}
