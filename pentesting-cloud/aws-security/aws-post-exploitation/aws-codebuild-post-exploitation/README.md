# AWS - CodeBuild Post Exploitation

{% hint style="success" %}
Lerne & √ºbe AWS Hacking:<img src="../../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Lerne & √ºbe GCP Hacking: <img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Unterst√ºtze HackTricks</summary>

* √úberpr√ºfe die [**Abonnementpl√§ne**](https://github.com/sponsors/carlospolop)!
* **Tritt der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folge** uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teile Hacking-Tricks, indem du PRs zu den** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repos einreichst.

</details>
{% endhint %}

## CodeBuild

F√ºr weitere Informationen, siehe:

{% content-ref url="../../aws-services/aws-codebuild-enum.md" %}
[aws-codebuild-enum.md](../../aws-services/aws-codebuild-enum.md)
{% endcontent-ref %}

### Missbrauch des Zugriffs auf das CodeBuild-Repo

Um **CodeBuild** zu konfigurieren, ben√∂tigt es **Zugriff auf das Code-Repo**, das es verwenden wird. Mehrere Plattformen k√∂nnten diesen Code hosten:

<figure><img src="../../../../.gitbook/assets/image (96).png" alt=""><figcaption></figcaption></figure>

Das **CodeBuild-Projekt muss Zugriff** auf den konfigurierten Quellanbieter haben, entweder √ºber **IAM-Rolle** oder mit einem GitHub/Bitbucket **Token oder OAuth-Zugriff**.

Ein Angreifer mit **erh√∂hten Berechtigungen in einem CodeBuild** k√∂nnte diesen konfigurierten Zugriff missbrauchen, um den Code des konfigurierten Repos und anderer, auf die die festgelegten Anmeldeinformationen Zugriff haben, zu leaken.\
Um dies zu tun, m√ºsste ein Angreifer nur die **Repository-URL auf jedes Repo √§ndern, auf das die konfigurierten Anmeldeinformationen Zugriff haben** (beachte, dass die AWS-Webseite alle f√ºr dich auflistet):

<figure><img src="../../../../.gitbook/assets/image (107).png" alt=""><figcaption></figcaption></figure>

Und **die Buildspec-Befehle √§ndern, um jedes Repo zu exfiltrieren**.

{% hint style="warning" %}
Diese **Aufgabe ist jedoch repetitiv und m√ºhsam** und wenn ein GitHub-Token mit **Schreibberechtigungen** konfiguriert wurde, kann ein Angreifer **diese Berechtigungen nicht (miss)brauchen**, da er keinen Zugriff auf das Token hat.\
Oder doch? √úberpr√ºfe den n√§chsten Abschnitt
{% endhint %}

### Leaking von Zugriffstokens aus AWS CodeBuild

Du kannst den Zugriff, der in CodeBuild auf Plattformen wie GitHub gew√§hrt wurde, leaken. √úberpr√ºfe, ob Zugriff auf externe Plattformen gew√§hrt wurde mit:
```bash
aws codebuild list-source-credentials
```
{% content-ref url="aws-codebuild-token-leakage.md" %}
[aws-codebuild-token-leakage.md](aws-codebuild-token-leakage.md)
{% endcontent-ref %}

### `codebuild:DeleteProject`

Ein Angreifer k√∂nnte ein gesamtes CodeBuild-Projekt l√∂schen, was zu einem Verlust der Projektkonfiguration f√ºhrt und Anwendungen beeintr√§chtigt, die auf das Projekt angewiesen sind.
```bash
aws codebuild delete-project --name <value>
```
**Potenzielle Auswirkungen**: Verlust der Projektkonfiguration und Dienstunterbrechung f√ºr Anwendungen, die das gel√∂schte Projekt verwenden.

### `codebuild:TagResource` , `codebuild:UntagResource`

Ein Angreifer k√∂nnte Tags von CodeBuild-Ressourcen hinzuf√ºgen, √§ndern oder entfernen, was die Kostenallokation, die Ressourcenverfolgung und die Zugriffskontrollrichtlinien Ihrer Organisation, die auf Tags basieren, st√∂ren w√ºrde.
```bash
aws codebuild tag-resource --resource-arn <value> --tags <value>
aws codebuild untag-resource --resource-arn <value> --tag-keys <value>
```
**Potenzielle Auswirkungen**: St√∂rung der Kostenallokation, Ressourcennachverfolgung und tagbasierter Zugriffskontrollrichtlinien.

### `codebuild:DeleteSourceCredentials`

Ein Angreifer k√∂nnte die Quellanmeldeinformationen f√ºr ein Git-Repository l√∂schen, was die normale Funktionsweise von Anwendungen beeintr√§chtigt, die auf das Repository angewiesen sind.
```sql
aws codebuild delete-source-credentials --arn <value>
```
**Potenzielle Auswirkungen**: St√∂rung der normalen Funktion von Anwendungen, die auf das betroffene Repository angewiesen sind, aufgrund der Entfernung von Quellanmeldeinformationen.

{% hint style="success" %}
Lerne & √ºbe AWS Hacking:<img src="../../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Lerne & √ºbe GCP Hacking: <img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Unterst√ºtze HackTricks</summary>

* √úberpr√ºfe die [**Abonnementpl√§ne**](https://github.com/sponsors/carlospolop)!
* **Tritt der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folge** uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teile Hacking-Tricks, indem du PRs zu den** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repos einreichst.

</details>
{% endhint %}
