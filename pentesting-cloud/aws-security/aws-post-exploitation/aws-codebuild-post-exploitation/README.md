# AWS - CodeBuild Post Exploitation

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** 💬 [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## CodeBuild

Για περισσότερες πληροφορίες, ελέγξτε:

{% content-ref url="../../aws-services/aws-codebuild-enum.md" %}
[aws-codebuild-enum.md](../../aws-services/aws-codebuild-enum.md)
{% endcontent-ref %}

### Check Secrets

Εάν έχουν ρυθμιστεί διαπιστευτήρια στο Codebuild για σύνδεση με το Github, Gitlab ή Bitbucket με τη μορφή προσωπικών tokens, κωδικών πρόσβασης ή OAuth token access, αυτά τα **διαπιστευτήρια θα αποθηκευτούν ως μυστικά στον διαχειριστή μυστικών**.\
Επομένως, εάν έχετε πρόσβαση για να διαβάσετε τον διαχειριστή μυστικών, θα μπορείτε να αποκτήσετε αυτά τα μυστικά και να μεταβείτε στην συνδεδεμένη πλατφόρμα.

{% content-ref url="../../aws-privilege-escalation/aws-secrets-manager-privesc.md" %}
[aws-secrets-manager-privesc.md](../../aws-privilege-escalation/aws-secrets-manager-privesc.md)
{% endcontent-ref %}

### Abuse CodeBuild Repo Access

Για να ρυθμίσετε το **CodeBuild**, θα χρειαστεί **πρόσβαση στο αποθετήριο κώδικα** που θα χρησιμοποιεί. Πολλές πλατφόρμες θα μπορούσαν να φιλοξενούν αυτόν τον κώδικα:

<figure><img src="../../../../.gitbook/assets/image (96).png" alt=""><figcaption></figcaption></figure>

Το **έργο CodeBuild πρέπει να έχει πρόσβαση** στον ρυθμισμένο πάροχο πηγών, είτε μέσω **IAM role** είτε με ένα github/bitbucket **token ή OAuth access**.

Ένας επιτιθέμενος με **υψηλά δικαιώματα σε ένα CodeBuild** θα μπορούσε να εκμεταλλευτεί αυτήν την ρυθμισμένη πρόσβαση για να διαρρεύσει τον κώδικα του ρυθμισμένου αποθετηρίου και άλλων όπου τα ρυθμισμένα διαπιστευτήρια έχουν πρόσβαση.\
Για να το κάνει αυτό, ένας επιτιθέμενος θα χρειαστεί απλώς να **αλλάξει το URL του αποθετηρίου σε κάθε αποθετήριο στο οποίο έχουν πρόσβαση τα ρυθμισμένα διαπιστευτήρια** (σημειώστε ότι η ιστοσελίδα aws θα τα παραθέσει όλα για εσάς):

<figure><img src="../../../../.gitbook/assets/image (107).png" alt=""><figcaption></figcaption></figure>

Και **να αλλάξει τις εντολές Buildspec για να εξάγει κάθε αποθετήριο**.

{% hint style="warning" %}
Ωστόσο, αυτή η **εργασία είναι επαναλαμβανόμενη και κουραστική** και εάν έχει ρυθμιστεί ένα github token με **δικαιώματα εγγραφής**, ένας επιτιθέμενος **δεν θα μπορέσει να (κατα)χρησιμοποιήσει αυτά τα δικαιώματα** καθώς δεν έχει πρόσβαση στο token.\
Ή μήπως έχει; Ελέγξτε την επόμενη ενότητα
{% endhint %}

### Leaking Access Tokens from AWS CodeBuild

Μπορείτε να διαρρεύσετε την πρόσβαση που δίνεται στο CodeBuild σε πλατφόρμες όπως το Github. Ελέγξτε αν έχει δοθεί οποιαδήποτε πρόσβαση σε εξωτερικές πλατφόρμες με:
```bash
aws codebuild list-source-credentials
```
{% content-ref url="aws-codebuild-token-leakage.md" %}
[aws-codebuild-token-leakage.md](aws-codebuild-token-leakage.md)
{% endcontent-ref %}

### `codebuild:DeleteProject`

Ένας επιτιθέμενος θα μπορούσε να διαγράψει ολόκληρο το έργο CodeBuild, προκαλώντας απώλεια της διαμόρφωσης του έργου και επηρεάζοντας τις εφαρμογές που βασίζονται στο έργο.
```bash
aws codebuild delete-project --name <value>
```
**Πιθανές Επιπτώσεις**: Απώλεια διαμόρφωσης έργου και διακοπή υπηρεσιών για εφαρμογές που χρησιμοποιούν το διαγραμμένο έργο.

### `codebuild:TagResource` , `codebuild:UntagResource`

Ένας επιτιθέμενος θα μπορούσε να προσθέσει, να τροποποιήσει ή να αφαιρέσει ετικέτες από τους πόρους του CodeBuild, διαταράσσοντας την κατανομή κόστους της οργάνωσής σας, την παρακολούθηση πόρων και τις πολιτικές ελέγχου πρόσβασης με βάση τις ετικέτες.
```bash
aws codebuild tag-resource --resource-arn <value> --tags <value>
aws codebuild untag-resource --resource-arn <value> --tag-keys <value>
```
**Πιθανές Επιπτώσεις**: Διαταραχή της κατανομής κόστους, παρακολούθησης πόρων και πολιτικών ελέγχου πρόσβασης με βάση τις ετικέτες.

### `codebuild:DeleteSourceCredentials`

Ένας επιτιθέμενος θα μπορούσε να διαγράψει τα διαπιστευτήρια πηγής για ένα Git αποθετήριο, επηρεάζοντας τη φυσιολογική λειτουργία των εφαρμογών που βασίζονται στο αποθετήριο.
```sql
aws codebuild delete-source-credentials --arn <value>
```
**Πιθανές Επιπτώσεις**: Διακοπή της κανονικής λειτουργίας για εφαρμογές που βασίζονται στο επηρεαζόμενο αποθετήριο λόγω της αφαίρεσης των διαπιστευτηρίων πηγής.

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** 💬 [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
