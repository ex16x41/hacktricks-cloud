# AWS - DLM Post Exploitation

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## ãƒ‡ãƒ¼ã‚¿ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ (DLM)

### `EC2:DescribeVolumes`, `DLM:CreateLifeCyclePolicy`

ãƒ©ãƒ³ã‚µãƒ ã‚¦ã‚§ã‚¢æ”»æ’ƒã¯ã€ã§ãã‚‹ã ã‘å¤šãã®EBSãƒœãƒªãƒ¥ãƒ¼ãƒ ã‚’æš—å·åŒ–ã—ã€ãã®å¾Œç¾åœ¨ã®EC2ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã€EBSãƒœãƒªãƒ¥ãƒ¼ãƒ ã€ãŠã‚ˆã³ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã‚’å‰Šé™¤ã™ã‚‹ã“ã¨ã§å®Ÿè¡Œã§ãã¾ã™ã€‚ã“ã®æ‚ªæ„ã®ã‚ã‚‹æ´»å‹•ã‚’è‡ªå‹•åŒ–ã™ã‚‹ãŸã‚ã«ã€ä»–ã®AWSã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®KMSã‚­ãƒ¼ã‚’ä½¿ç”¨ã—ã¦ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã‚’æš—å·åŒ–ã—ã€æš—å·åŒ–ã•ã‚ŒãŸã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã‚’åˆ¥ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã«è»¢é€ã™ã‚‹Amazon DLMã‚’åˆ©ç”¨ã§ãã¾ã™ã€‚ã‚ã‚‹ã„ã¯ã€ç®¡ç†ã—ã¦ã„ã‚‹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã«æš—å·åŒ–ãªã—ã§ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã‚’è»¢é€ã—ã€ãã“ã§æš—å·åŒ–ã™ã‚‹ã“ã¨ã‚‚å¯èƒ½ã§ã™ã€‚æ—¢å­˜ã®EBSãƒœãƒªãƒ¥ãƒ¼ãƒ ã‚„ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã‚’ç›´æ¥æš—å·åŒ–ã™ã‚‹ã®ã¯ç°¡å˜ã§ã¯ã‚ã‚Šã¾ã›ã‚“ãŒã€æ–°ã—ã„ãƒœãƒªãƒ¥ãƒ¼ãƒ ã‚„ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã‚’ä½œæˆã™ã‚‹ã“ã¨ã§å¯èƒ½ã§ã™ã€‚

ã¾ãšã€ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹IDã€ãƒœãƒªãƒ¥ãƒ¼ãƒ IDã€æš—å·åŒ–ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã€ã‚¢ã‚¿ãƒƒãƒãƒ¡ãƒ³ãƒˆã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã€ãƒœãƒªãƒ¥ãƒ¼ãƒ ã‚¿ã‚¤ãƒ—ãªã©ã®ãƒœãƒªãƒ¥ãƒ¼ãƒ ã«é–¢ã™ã‚‹æƒ…å ±ã‚’åé›†ã™ã‚‹ã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚

`aws ec2 describe-volumes`

æ¬¡ã«ã€ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ãƒãƒªã‚·ãƒ¼ã‚’ä½œæˆã—ã¾ã™ã€‚ã“ã®ã‚³ãƒãƒ³ãƒ‰ã¯DLM APIã‚’ä½¿ç”¨ã—ã¦ã€æŒ‡å®šã•ã‚ŒãŸãƒœãƒªãƒ¥ãƒ¼ãƒ ã®æ¯æ—¥ã®ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã‚’æŒ‡å®šã•ã‚ŒãŸæ™‚é–“ã«è‡ªå‹•çš„ã«å–å¾—ã™ã‚‹ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ãƒãƒªã‚·ãƒ¼ã‚’è¨­å®šã—ã¾ã™ã€‚ã¾ãŸã€ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã«ç‰¹å®šã®ã‚¿ã‚°ã‚’é©ç”¨ã—ã€ãƒœãƒªãƒ¥ãƒ¼ãƒ ã‹ã‚‰ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã«ã‚¿ã‚°ã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã™ã€‚policyDetails.jsonãƒ•ã‚¡ã‚¤ãƒ«ã«ã¯ã€ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã‚¿ã‚°ã€ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã€æš—å·åŒ–ã®ãŸã‚ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã®KMSã‚­ãƒ¼ã®ARNã€ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆå…±æœ‰ã®ãŸã‚ã®ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã‚¢ã‚«ã‚¦ãƒ³ãƒˆãªã©ã€ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ãƒãƒªã‚·ãƒ¼ã®è©³ç´°ãŒå«ã¾ã‚Œã¦ãŠã‚Šã€è¢«å®³è€…ã®CloudTrailãƒ­ã‚°ã«è¨˜éŒ²ã•ã‚Œã¾ã™ã€‚
```bash
aws dlm create-lifecycle-policy --description "My first policy" --state ENABLED --execution-role-arn arn:aws:iam::12345678910:role/AWSDataLifecycleManagerDefaultRole --policy-details file://policyDetails.json
```
ãƒãƒªã‚·ãƒ¼æ–‡æ›¸ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã¯ã“ã“ã«ã‚ã‚Šã¾ã™:
```bash
{
"PolicyType": "EBS_SNAPSHOT_MANAGEMENT",
"ResourceTypes": [
"VOLUME"
],
"TargetTags": [
{
"Key": "ExampleKey",
"Value": "ExampleValue"
}
],
"Schedules": [
{
"Name": "DailySnapshots",
"CopyTags": true,
"TagsToAdd": [
{
"Key": "SnapshotCreator",
"Value": "DLM"
}
],
"VariableTags": [
{
"Key": "CostCenter",
"Value": "Finance"
}
],
"CreateRule": {
"Interval": 24,
"IntervalUnit": "HOURS",
"Times": [
"03:00"
]
},
"RetainRule": {
"Count": 14
},
"FastRestoreRule": {
"Count": 2,
"Interval": 12,
"IntervalUnit": "HOURS"
},
"CrossRegionCopyRules": [
{
"TargetRegion": "us-west-2",
"Encrypted": true,
"CmkArn": "arn:aws:kms:us-west-2:123456789012:key/your-kms-key-id",
"CopyTags": true,
"RetainRule": {
"Interval": 1,
"IntervalUnit": "DAYS"
}
}
],
"ShareRules": [
{
"TargetAccounts": [
"123456789012"
],
"UnshareInterval": 30,
"UnshareIntervalUnit": "DAYS"
}
]
}
],
"Parameters": {
"ExcludeBootVolume": false
}
}
```
{% hint style="success" %}
AWSãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã³ã€å®Ÿè·µã™ã‚‹ï¼š<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
GCPãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã³ã€å®Ÿè·µã™ã‚‹ï¼š<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricksã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹</summary>

* [**ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³**](https://github.com/sponsors/carlospolop)ã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼
* **ğŸ’¬ [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã¾ãŸã¯[**Telegramã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«å‚åŠ ã™ã‚‹ã‹ã€**Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**ã‚’ãƒ•ã‚©ãƒ­ãƒ¼ã—ã¦ãã ã•ã„ã€‚**
* **ãƒãƒƒã‚­ãƒ³ã‚°ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã™ã‚‹ã«ã¯ã€[**HackTricks**](https://github.com/carlospolop/hacktricks)ã¨[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)ã®GitHubãƒªãƒã‚¸ãƒˆãƒªã«PRã‚’é€ä¿¡ã—ã¦ãã ã•ã„ã€‚**

</details>
{% endhint %}
