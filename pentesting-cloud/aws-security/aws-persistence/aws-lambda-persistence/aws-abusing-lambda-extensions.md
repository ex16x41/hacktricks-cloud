# AWS - Abusing Lambda Extensions

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ЁЯТм [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ЁЯРж [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Lambda Extensions

Lambda extensions рдХрд╛рд░реНрдпреЛрдВ рдХреЛ рд╡рд┐рднрд┐рдиреНрди **рдирд┐рдЧрд░рд╛рдиреА, рдЕрд╡рд▓реЛрдХрди, рд╕реБрд░рдХреНрд╖рд╛, рдФрд░ рд╢рд╛рд╕рди рдЙрдкрдХрд░рдгреЛрдВ** рдХреЗ рд╕рд╛рде рдПрдХреАрдХреГрдд рдХрд░рдХреЗ рдмрдврд╝рд╛рддреЗ рд╣реИрдВред рдпреЗ рдПрдХреНрд╕рдЯреЗрдВрд╢рди [.zip рдЖрд░реНрдХрд╛рдЗрд╡ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ Lambda рд▓реЗрдпрд░реНрд╕](https://docs.aws.amazon.com/lambda/latest/dg/configuration-layers.html) рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдЬреЛрдбрд╝реЗ рдЬрд╛рддреЗ рд╣реИрдВ рдпрд╛ [рдХрдВрдЯреЗрдирд░ рдЗрдореЗрдЬ рдбрд┐рдкреНрд▓реЙрдпрдореЗрдВрдЯреНрд╕](https://aws.amazon.com/blogs/compute/working-with-lambda-layers-and-extensions-in-container-images/) рдореЗрдВ рд╢рд╛рдорд┐рд▓ рд╣реЛрддреЗ рд╣реИрдВ, рдФрд░ рджреЛ рдореЛрдб рдореЗрдВ рдХрд╛рд░реНрдп рдХрд░рддреЗ рд╣реИрдВ: **рдЖрдВрддрд░рд┐рдХ** рдФрд░ **рдмрд╛рд╣рд░реА**ред

* **рдЖрдВрддрд░рд┐рдХ рдПрдХреНрд╕рдЯреЗрдВрд╢рди** рд░рдирдЯрд╛рдЗрдо рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЗ рд╕рд╛рде рд╡рд┐рд▓реАрди рд╣реЛрддреЗ рд╣реИрдВ, рдЗрд╕рдХреЗ рд╕реНрдЯрд╛рд░реНрдЯрдЕрдк рдХреЛ **рднрд╛рд╖рд╛-рд╡рд┐рд╢рд┐рд╖реНрдЯ рдкрд░реНрдпрд╛рд╡рд░рдг рдЪрд░** рдФрд░ **рд░реИрдкрд░ рд╕реНрдХреНрд░рд┐рдкреНрдЯ** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░рддреЗ рд╣реИрдВред рдпрд╣ рдЕрдиреБрдХреВрд▓рди рд╡рд┐рднрд┐рдиреНрди рд░рдирдЯрд╛рдЗрдореНрд╕ рдкрд░ рд▓рд╛рдЧреВ рд╣реЛрддрд╛ рд╣реИ, рдЬрд┐рд╕рдореЗрдВ **Java Correto 8 рдФрд░ 11, Node.js 10 рдФрд░ 12, рдФрд░ .NET Core 3.1** рд╢рд╛рдорд┐рд▓ рд╣реИрдВред
* **рдмрд╛рд╣рд░реА рдПрдХреНрд╕рдЯреЗрдВрд╢рди** рдЕрд▓рдЧ рдкреНрд░рдХреНрд░рд┐рдпрд╛рдУрдВ рдХреЗ рд░реВрдк рдореЗрдВ рдЪрд▓рддреЗ рд╣реИрдВ, Lambda рдлрд╝рдВрдХреНрд╢рди рдХреЗ рдЬреАрд╡рдирдЪрдХреНрд░ рдХреЗ рд╕рд╛рде рд╕рдВрдЪрд╛рд▓рди рд╕рдВрд░реЗрдЦрдг рдмрдирд╛рдП рд░рдЦрддреЗ рд╣реИрдВред рд╡реЗ рд╡рд┐рднрд┐рдиреНрди рд░рдирдЯрд╛рдЗрдореНрд╕ рдХреЗ рд╕рд╛рде рд╕рдВрдЧрдд рд╣реИрдВ рдЬреИрд╕реЗ **Node.js 10 рдФрд░ 12, Python 3.7 рдФрд░ 3.8, Ruby 2.5 рдФрд░ 2.7, Java Corretto 8 рдФрд░ 11, .NET Core 3.1**, рдФрд░ **рдХрд╕реНрдЯрдо рд░рдирдЯрд╛рдЗрдореНрд╕**ред

рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП [**рдХреИрд╕реЗ lambda extensions рдХрд╛рдо рдХрд░рддреЗ рд╣реИрдВ, рджрд╕реНрддрд╛рд╡реЗрдЬрд╝ рджреЗрдЦреЗрдВ**](https://docs.aws.amazon.com/lambda/latest/dg/runtimes-extensions-api.html)ред

### рд╕реНрдерд┐рд░рддрд╛, рдЕрдиреБрд░реЛрдз рдЪреБрд░рд╛рдиреЗ рдФрд░ рдЕрдиреБрд░реЛрдзреЛрдВ рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдмрд╛рд╣рд░реА рдПрдХреНрд╕рдЯреЗрдВрд╢рди

рдпрд╣ рдЗрд╕ рдкреЛрд╕реНрдЯ рдореЗрдВ рдкреНрд░рд╕реНрддрд╛рд╡рд┐рдд рддрдХрдиреАрдХ рдХрд╛ рд╕рд╛рд░рд╛рдВрд╢ рд╣реИ: [https://www.clearvector.com/blog/lambda-spy/](https://www.clearvector.com/blog/lambda-spy/)

рдпрд╣ рдкрд╛рдпрд╛ рдЧрдпрд╛ рдХрд┐ Lambda рд░рдирдЯрд╛рдЗрдо рд╡рд╛рддрд╛рд╡рд░рдг рдореЗрдВ рдбрд┐рдлрд╝реЙрд▓реНрдЯ Linux рдХрд░реНрдиреЗрд▓ тАЬ**process\_vm\_readv**тАЭ рдФрд░ тАЬ**process\_vm\_writev**тАЭ рд╕рд┐рд╕реНрдЯрдо рдХреЙрд▓ рдХреЗ рд╕рд╛рде рд╕рдВрдХрд▓рд┐рдд рд╣реИред рдФрд░ рд╕рднреА рдкреНрд░рдХреНрд░рд┐рдпрд╛рдПрдБ рдПрдХ рд╣реА рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЖрдИрдбреА рдХреЗ рд╕рд╛рде рдЪрд▓рддреА рд╣реИрдВ, рдпрд╣рд╛рдВ рддрдХ рдХрд┐ рдмрд╛рд╣рд░реА рдПрдХреНрд╕рдЯреЗрдВрд╢рди рдХреЗ рд▓рд┐рдП рдмрдирд╛рдИ рдЧрдИ рдирдИ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рднреАред **рдЗрд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ рдПрдХ рдмрд╛рд╣рд░реА рдПрдХреНрд╕рдЯреЗрдВрд╢рди рдХреЛ рдбрд┐рдЬрд╝рд╛рдЗрди рдХреЗ рдЕрдиреБрд╕рд╛рд░ Rapid рдХреА рд╣реАрдк рдореЗрдореЛрд░реА рддрдХ рдкреВрд░реНрдг рдкрдврд╝рдиреЗ рдФрд░ рд▓рд┐рдЦрдиреЗ рдХреА рдкрд╣реБрдВрдЪ рд╣реИред**

рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдЬрдмрдХрд┐ Lambda рдПрдХреНрд╕рдЯреЗрдВрд╢рди **рдЖрд╣реНрд╡рд╛рди рдШрдЯрдирд╛рдУрдВ** рдХреА рд╕рджрд╕реНрдпрддрд╛ рд▓реЗрдиреЗ рдХреА рдХреНрд╖рдорддрд╛ рд░рдЦрддреЗ рд╣реИрдВ, AWS рдЗрди рдПрдХреНрд╕рдЯреЗрдВрд╢рдиреЛрдВ рдХреЛ рдХрдЪреНрдЪрд╛ рдбреЗрдЯрд╛ рдирд╣реАрдВ рджрд┐рдЦрд╛рддрд╛ред рдпрд╣ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рддрд╛ рд╣реИ рдХрд┐ **рдПрдХреНрд╕рдЯреЗрдВрд╢рди рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рдЬрд╛рдирдХрд╛рд░реА** рддрдХ рдкрд╣реБрдВрдЪ рдирд╣реАрдВ рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддреЗ рдЬреЛ HTTP рдЕрдиреБрд░реЛрдз рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рднреЗрдЬреА рдЬрд╛рддреА рд╣реИред

Init (Rapid) рдкреНрд░рдХреНрд░рд┐рдпрд╛ рд╕рднреА API рдЕрдиреБрд░реЛрдзреЛрдВ рдХреА рдирд┐рдЧрд░рд╛рдиреА рдХрд░рддреА рд╣реИ [http://127.0.0.1:9001](http://127.0.0.1:9001/) рдЬрдмрдХрд┐ Lambda рдПрдХреНрд╕рдЯреЗрдВрд╢рди рдкреНрд░рд╛рд░рдВрдн рд╣реЛрддреЗ рд╣реИрдВ рдФрд░ рдХрд┐рд╕реА рднреА рд░рдирдЯрд╛рдЗрдо рдХреЛрдб рдХреЗ рдирд┐рд╖реНрдкрд╛рджрди рд╕реЗ рдкрд╣рд▓реЗ рдЪрд▓рддреЗ рд╣реИрдВ, рд▓реЗрдХрд┐рди Rapid рдХреЗ рдмрд╛рджред

<figure><img src="../../../../.gitbook/assets/image (254).png" alt=""><figcaption><p><a href="https://www.clearvector.com/blog/content/images/size/w1000/2022/11/2022110801.rapid.default.png">https://www.clearvector.com/blog/content/images/size/w1000/2022/11/2022110801.rapid.default.png</a></p></figcaption></figure>

рдЪрд░ **`AWS_LAMBDA_RUNTIME_API`** Rapid API рдХреЗ **IP** рдкрддреЗ рдФрд░ **рдкреЛрд░реНрдЯ** рдирдВрдмрд░ рдХреЛ **рдмрдЪреНрдЪреЗ рд░рдирдЯрд╛рдЗрдо рдкреНрд░рдХреНрд░рд┐рдпрд╛рдУрдВ** рдФрд░ рдЕрддрд┐рд░рд┐рдХреНрдд рдПрдХреНрд╕рдЯреЗрдВрд╢рдиреЛрдВ рдХреЛ рдЗрдВрдЧрд┐рдд рдХрд░рддрд╛ рд╣реИред

{% hint style="warning" %}
**`AWS_LAMBDA_RUNTIME_API`** рдкрд░реНрдпрд╛рд╡рд░рдг рдЪрд░ рдХреЛ рдПрдХ **`рдкреЛрд░реНрдЯ`** рдореЗрдВ рдмрджрд▓рдХрд░, рдЬрд┐рд╕рдХреЗ рдкрд╛рд╕ рд╣рдо рдкрд╣реБрдВрдЪ рд░рдЦрддреЗ рд╣реИрдВ, Lambda рд░рдирдЯрд╛рдЗрдо рдХреЗ рднреАрддрд░ рд╕рднреА рдХреНрд░рд┐рдпрд╛рдУрдВ рдХреЛ рдЗрдВрдЯрд░рд╕реЗрдкреНрдЯ рдХрд░рдирд╛ рд╕рдВрднрд╡ рд╣реИ (**рдореИрди-рдЗрди-рдж-рдорд┐рдбрд▓**)ред рдпрд╣ рд╕рдВрднрд╡ рд╣реИ рдХреНрдпреЛрдВрдХрд┐ рдПрдХреНрд╕рдЯреЗрдВрд╢рди Rapid Init рдХреЗ рд╕рдорд╛рди рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░реЛрдВ рдХреЗ рд╕рд╛рде рдЪрд▓рддрд╛ рд╣реИ, рдФрд░ рд╕рд┐рд╕реНрдЯрдо рдХрд╛ рдХрд░реНрдиреЗрд▓ **рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдореЗрдореЛрд░реА рдореЗрдВ рд╕рдВрд╢реЛрдзрди** рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ, рдЬрд┐рд╕рд╕реЗ рдкреЛрд░реНрдЯ рдирдВрдмрд░ рдХреЛ рдмрджрд▓рдирд╛ рд╕рдВрднрд╡ рд╣реЛрддрд╛ рд╣реИред
{% endhint %}

рдХреНрдпреЛрдВрдХрд┐ **рдПрдХреНрд╕рдЯреЗрдВрд╢рди рдХрд┐рд╕реА рднреА рд░рдирдЯрд╛рдЗрдо рдХреЛрдб рд╕реЗ рдкрд╣рд▓реЗ рдЪрд▓рддреЗ рд╣реИрдВ**, рдкрд░реНрдпрд╛рд╡рд░рдг рдЪрд░ рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░рдиреЗ рд╕реЗ рд░рдирдЯрд╛рдЗрдо рдкреНрд░рдХреНрд░рд┐рдпрд╛ (рдЬреИрд╕реЗ, Python, Java, Node, Ruby) рдкрд░ рдкреНрд░рднрд╛рд╡ рдкрдбрд╝реЗрдЧрд╛ рдЬрдм рдпрд╣ рд╢реБрд░реВ рд╣реЛрддрд╛ рд╣реИред рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, **рд╣рдорд╛рд░реЗ рдмрд╛рдж рд▓реЛрдб рдХрд┐рдП рдЧрдП рдПрдХреНрд╕рдЯреЗрдВрд╢рди**, рдЬреЛ рдЗрд╕ рдЪрд░ рдкрд░ рдирд┐рд░реНрднрд░ рдХрд░рддреЗ рд╣реИрдВ, рд╡реЗ рднреА рд╣рдорд╛рд░реЗ рдПрдХреНрд╕рдЯреЗрдВрд╢рди рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд░реВрдЯ рдХрд░реЗрдВрдЧреЗред рдпрд╣ рд╕реЗрдЯрдЕрдк рдореИрд▓рд╡реЗрдпрд░ рдХреЛ рд╕реБрд░рдХреНрд╖рд╛ рдЙрдкрд╛рдпреЛрдВ рдпрд╛ рд▓реЙрдЧрд┐рдВрдЧ рдПрдХреНрд╕рдЯреЗрдВрд╢рдиреЛрдВ рдХреЛ рдкреВрд░реА рддрд░рд╣ рд╕реЗ рдмрд╛рдпрдкрд╛рд╕ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗ рд╕рдХрддрд╛ рд╣реИ рдпрд╛ рд╕реАрдзреЗ рд░рдирдЯрд╛рдЗрдо рд╡рд╛рддрд╛рд╡рд░рдг рдХреЗ рднреАрддрд░ред

<figure><img src="../../../../.gitbook/assets/image (267).png" alt=""><figcaption><p><a href="https://www.clearvector.com/blog/content/images/size/w1000/2022/11/2022110801.rapid.mitm.png">https://www.clearvector.com/blog/content/images/size/w1000/2022/11/2022110801.rapid.mitm.png</a></p></figcaption></figure>

рдЙрдкрдХрд░рдг [**lambda-spy**](https://github.com/clearvector/lambda-spy) рдХреЛ **рдореЗрдореЛрд░реА рд▓рд┐рдЦрдиреЗ** рдФрд░ Lambda рдЕрдиреБрд░реЛрдзреЛрдВ рд╕реЗ рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рдЬрд╛рдирдХрд╛рд░реА **рдЪреБрд░рд╛рдиреЗ** рдФрд░ рдпрд╣рд╛рдВ рддрдХ рдХрд┐ **рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░рдиреЗ** рдХреЗ рд▓рд┐рдП рдмрдирд╛рдпрд╛ рдЧрдпрд╛ рдерд╛ред

## рд╕рдВрджрд░реНрдн

* [https://aws.amazon.com/blogs/compute/building-extensions-for-aws-lambda-in-preview/](https://aws.amazon.com/blogs/compute/building-extensions-for-aws-lambda-in-preview/)
* [https://www.clearvector.com/blog/lambda-spy/](https://www.clearvector.com/blog/lambda-spy/)

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ЁЯТм [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ЁЯРж [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
