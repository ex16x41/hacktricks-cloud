# AWS - Lambda Persistence

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Lambda

ìì„¸í•œ ì •ë³´ëŠ” ë‹¤ìŒì„ í™•ì¸í•˜ì‹­ì‹œì˜¤:

{% content-ref url="../../aws-services/aws-lambda-enum.md" %}
[aws-lambda-enum.md](../../aws-services/aws-lambda-enum.md)
{% endcontent-ref %}

### Lambda Layer Persistence

Lambdaê°€ ì€ë°€í•˜ê²Œ ì‹¤í–‰ë  ë•Œ ì„ì˜ì˜ ì½”ë“œë¥¼ ì‹¤í–‰í•˜ë„ë¡ **ë ˆì´ì–´ë¥¼ ë„ì…/ë°±ë„ì–´**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

{% content-ref url="aws-lambda-layers-persistence.md" %}
[aws-lambda-layers-persistence.md](aws-lambda-layers-persistence.md)
{% endcontent-ref %}

### Lambda Extension Persistence

Lambda Layersë¥¼ ì•…ìš©í•˜ì—¬ í™•ì¥ì„ ì•…ìš©í•˜ê³  lambdaì— ì§€ì†ì ìœ¼ë¡œ ì¡´ì¬í•  ìˆ˜ ìˆìœ¼ë©° ìš”ì²­ì„ í›”ì¹˜ê³  ìˆ˜ì •í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.

{% content-ref url="aws-abusing-lambda-extensions.md" %}
[aws-abusing-lambda-extensions.md](aws-abusing-lambda-extensions.md)
{% endcontent-ref %}

### ë¦¬ì†ŒìŠ¤ ì •ì±…ì„ í†µí•œ ë°©ë²•

ì™¸ë¶€ ê³„ì •ì— ë‹¤ì–‘í•œ lambda ì‘ì—…(ì˜ˆ: í˜¸ì¶œ ë˜ëŠ” ì½”ë“œ ì—…ë°ì´íŠ¸)ì— ëŒ€í•œ ì•¡ì„¸ìŠ¤ë¥¼ ë¶€ì—¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

<figure><img src="../../../../.gitbook/assets/image (255).png" alt=""><figcaption></figcaption></figure>

### ë²„ì „, ë³„ì¹­ ë° ê°€ì¤‘ì¹˜

LambdaëŠ” **ë‹¤ë¥¸ ë²„ì „**(ê° ë²„ì „ë§ˆë‹¤ ë‹¤ë¥¸ ì½”ë“œ)ì„ ê°€ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤.\
ê·¸ëŸ° ë‹¤ìŒ, **ë‹¤ë¥¸ ë²„ì „**ì˜ lambdaì™€ **ë‹¤ë¥¸ ê°€ì¤‘ì¹˜**ë¥¼ ì„¤ì •í•˜ì—¬ **ë‹¤ë¥¸ ë³„ì¹­**ì„ ë§Œë“¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.\
ì´ë ‡ê²Œ í•˜ë©´ ê³µê²©ìëŠ” **ë°±ë„ì–´ëœ ë²„ì „ 1**ê³¼ **ì •ìƒ ì½”ë“œë§Œ ìˆëŠ” ë²„ì „ 2**ë¥¼ ë§Œë“¤ê³  **ìš”ì²­ì˜ 1%ì—ì„œë§Œ ë²„ì „ 1ì„ ì‹¤í–‰**í•˜ì—¬ ì€ë°€í•˜ê²Œ ìœ ì§€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

<figure><img src="../../../../.gitbook/assets/image (120).png" alt=""><figcaption></figcaption></figure>

### ë²„ì „ ë°±ë„ì–´ + API Gateway

1. Lambdaì˜ ì›ë³¸ ì½”ë“œë¥¼ ë³µì‚¬í•©ë‹ˆë‹¤.
2. ì›ë³¸ ì½”ë“œë¥¼ ë°±ë„ì–´í•˜ê±°ë‚˜(ë˜ëŠ” ì•…ì„± ì½”ë“œë§Œ í¬í•¨ëœ) **ìƒˆ ë²„ì „ì„ ìƒì„±**í•©ë‹ˆë‹¤. í•´ë‹¹ ë²„ì „ì„ $LATESTì— ê²Œì‹œí•˜ê³  **ë°°í¬**í•©ë‹ˆë‹¤.
3. Lambdaì™€ ê´€ë ¨ëœ API Gatewayë¥¼ í˜¸ì¶œí•˜ì—¬ ì½”ë“œë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤.
4. **ì›ë³¸ ì½”ë“œë¡œ ìƒˆ ë²„ì „ì„ ìƒì„±**í•˜ê³ , í•´ë‹¹ **ë²„ì „ì„ $LATESTì— ê²Œì‹œí•˜ê³  ë°°í¬**í•©ë‹ˆë‹¤.
5. ì´ëŠ” ì´ì „ ë²„ì „ì— ë°±ë„ì–´ëœ ì½”ë“œë¥¼ ìˆ¨ê¹ë‹ˆë‹¤.
6. API Gatewayë¡œ ì´ë™í•˜ì—¬ **ìƒˆ POST ë©”ì„œë“œ**(ë˜ëŠ” ë‹¤ë¥¸ ë©”ì„œë“œ ì„ íƒ)ë¥¼ ìƒì„±í•˜ì—¬ lambdaì˜ ë°±ë„ì–´ëœ ë²„ì „ì„ ì‹¤í–‰í•©ë‹ˆë‹¤: `arn:aws:lambda:us-east-1:<acc_id>:function:<func_name>:1`
7. arnì˜ ë§ˆì§€ë§‰ :1ì€ **í•¨ìˆ˜ì˜ ë²„ì „**(ì´ ì‹œë‚˜ë¦¬ì˜¤ì—ì„œëŠ” ë²„ì „ 1ì´ ë°±ë„ì–´ëœ ë²„ì „ì„)ì„ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤.
8. ìƒì„±ëœ POST ë©”ì„œë“œë¥¼ ì„ íƒí•˜ê³  ì‘ì—…ì—ì„œ **`Deploy API`**ë¥¼ ì„ íƒí•©ë‹ˆë‹¤.
9. ì´ì œ **POSTë¥¼ í†µí•´ í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ë©´ ë°±ë„ì–´**ê°€ ì‹¤í–‰ë©ë‹ˆë‹¤.

### Cron/Event ì•¡ì¶”ì—ì´í„°

**ë¬´ì–¸ê°€ê°€ ë°œìƒí•˜ê±°ë‚˜ ì¼ì • ì‹œê°„ì´ ì§€ë‚˜ë©´ lambda í•¨ìˆ˜ê°€ ì‹¤í–‰ë˜ë„ë¡** í•  ìˆ˜ ìˆë‹¤ëŠ” ì‚¬ì‹¤ì€ lambdaë¥¼ ì§€ì†ì„±ì„ í™•ë³´í•˜ê³  íƒì§€ë¥¼ í”¼í•˜ëŠ” ì¢‹ì€ ë°©ë²•ìœ¼ë¡œ ë§Œë“­ë‹ˆë‹¤.\
ì—¬ê¸°ì—ëŠ” **lambdaë¥¼ ìƒì„±í•˜ì—¬ AWSì—ì„œ ë” ì€ë°€í•˜ê²Œ ì¡´ì¬í•  ìˆ˜ ìˆëŠ”** ëª‡ ê°€ì§€ ì•„ì´ë””ì–´ê°€ ìˆìŠµë‹ˆë‹¤.

* ìƒˆ ì‚¬ìš©ìê°€ ìƒì„±ë  ë•Œë§ˆë‹¤ lambdaê°€ ìƒˆ ì‚¬ìš©ì í‚¤ë¥¼ ìƒì„±í•˜ì—¬ ê³µê²©ìì—ê²Œ ì „ì†¡í•©ë‹ˆë‹¤.
* ìƒˆ ì—­í• ì´ ìƒì„±ë  ë•Œë§ˆë‹¤ lambdaê°€ ì†ìƒëœ ì‚¬ìš©ìì—ê²Œ ì—­í•  ê°€ì • ê¶Œí•œì„ ë¶€ì—¬í•©ë‹ˆë‹¤.
* ìƒˆ cloudtrail ë¡œê·¸ê°€ ìƒì„±ë  ë•Œë§ˆë‹¤ ì‚­ì œ/ë³€ê²½í•©ë‹ˆë‹¤.

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
