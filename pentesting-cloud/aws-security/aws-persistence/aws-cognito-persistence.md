# AWS - Cognito Persistence

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** 💬 [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Cognito

Για περισσότερες πληροφορίες, αποκτήστε πρόσβαση:

{% content-ref url="../aws-services/aws-cognito-enum/" %}
[aws-cognito-enum](../aws-services/aws-cognito-enum/)
{% endcontent-ref %}

### User persistence

Το Cognito είναι μια υπηρεσία που επιτρέπει την εκχώρηση ρόλων σε μη αυθεντικοποιημένους και αυθεντικοποιημένους χρήστες και τον έλεγχο ενός καταλόγου χρηστών. Πολλές διαφορετικές ρυθμίσεις μπορούν να τροποποιηθούν για να διατηρηθεί κάποια επιμονή, όπως:

* **Προσθήκη ενός User Pool** που ελέγχεται από τον χρήστη σε ένα Identity Pool
* Δώστε έναν **IAM ρόλο σε ένα μη αυθεντικοποιημένο Identity Pool και επιτρέψτε τη ροή βασικής αυθεντικοποίησης**
* Ή σε ένα **αυθεντικοποιημένο Identity Pool** αν ο επιτιθέμενος μπορεί να συνδεθεί
* Ή **βελτιώστε τις άδειες** των δοθέντων ρόλων
* **Δημιουργία, επαλήθευση & privesc** μέσω χρηστών που ελέγχονται από χαρακτηριστικά ή νέων χρηστών σε ένα **User Pool**
* **Επιτρέποντας σε εξωτερικούς Παρόχους Ταυτότητας** να συνδεθούν σε ένα User Pool ή σε ένα Identity Pool

Δείτε πώς να εκτελέσετε αυτές τις ενέργειες στο

{% content-ref url="../aws-privilege-escalation/aws-cognito-privesc.md" %}
[aws-cognito-privesc.md](../aws-privilege-escalation/aws-cognito-privesc.md)
{% endcontent-ref %}

### `cognito-idp:SetRiskConfiguration`

Ένας επιτιθέμενος με αυτό το προνόμιο θα μπορούσε να τροποποιήσει τη ρύθμιση κινδύνου ώστε να μπορεί να συνδεθεί ως χρήστης Cognito **χωρίς να ενεργοποιηθούν συναγερμοί**. [**Δείτε το cli**](https://docs.aws.amazon.com/cli/latest/reference/cognito-idp/set-risk-configuration.html) για να ελέγξετε όλες τις επιλογές:

{% code overflow="wrap" %}
```bash
aws cognito-idp set-risk-configuration --user-pool-id <pool-id> --compromised-credentials-risk-configuration EventFilter=SIGN_UP,Actions={EventAction=NO_ACTION}
```
{% endcode %}

Από προεπιλογή, αυτό είναι απενεργοποιημένο:

<figure><img src="https://lh6.googleusercontent.com/EOiM0EVuEgZDfW3rOJHLQjd09-KmvraCMssjZYpY9sVha6NcxwUjStrLbZxAT3D3j9y08kd5oobvW8a2fLUVROyhkHaB1OPhd7X6gJW3AEQtlZM62q41uYJjTY1EJ0iQg6Orr1O7yZ798EpIJ87og4Tbzw=s2048" alt=""><figcaption></figcaption></figure>

{% hint style="success" %}
Μάθετε και εξασκηθείτε στο AWS Hacking:<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
Μάθετε και εξασκηθείτε στο GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Υποστήριξη HackTricks</summary>

* Ελέγξτε τα [**σχέδια συνδρομής**](https://github.com/sponsors/carlospolop)!
* **Εγγραφείτε στην** 💬 [**ομάδα Discord**](https://discord.gg/hRep4RUj7f) ή στην [**ομάδα telegram**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Μοιραστείτε κόλπα hacking υποβάλλοντας PRs στα** [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
