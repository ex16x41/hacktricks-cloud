# AWS - IAM Persistence

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## IAM

Î“Î¹Î± Ï€ÎµÏÎ¹ÏƒÏƒÏŒÏ„ÎµÏÎµÏ‚ Ï€Î»Î·ÏÎ¿Ï†Î¿ÏÎ¯ÎµÏ‚, ÎµÏ€Î¹ÏƒÎºÎµÏ†Î¸ÎµÎ¯Ï„Îµ:

{% content-ref url="../aws-services/aws-iam-enum.md" %}
[aws-iam-enum.md](../aws-services/aws-iam-enum.md)
{% endcontent-ref %}

### Common IAM Persistence

* Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Ï‡ÏÎ®ÏƒÏ„Î·
* Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ· ÎµÎ»ÎµÎ³Ï‡ÏŒÎ¼ÎµÎ½Î¿Ï… Ï‡ÏÎ®ÏƒÏ„Î· ÏƒÎµ Ï€ÏÎ¿Î½Î¿Î¼Î¹Î¿ÏÏ‡Î± Î¿Î¼Î¬Î´Î±
* Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± ÎºÎ»ÎµÎ¹Î´Î¹ÏÎ½ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ·Ï‚ (Ï„Î¿Ï… Î½Î­Î¿Ï… Ï‡ÏÎ®ÏƒÏ„Î· Î® ÏŒÎ»Ï‰Î½ Ï„Ï‰Î½ Ï‡ÏÎ·ÏƒÏ„ÏÎ½)
* Î Î±ÏÎ¿Ï‡Î® ÎµÏ€Î¹Ï€Î»Î­Î¿Î½ Î´Î¹ÎºÎ±Î¹Ï‰Î¼Î¬Ï„Ï‰Î½ ÏƒÎµ ÎµÎ»ÎµÎ³Ï‡ÏŒÎ¼ÎµÎ½Î¿Ï…Ï‚ Ï‡ÏÎ®ÏƒÏ„ÎµÏ‚/Î¿Î¼Î¬Î´ÎµÏ‚ (ÏƒÏ…Î½Î´ÎµÎ´ÎµÎ¼Î­Î½ÎµÏ‚ Ï€Î¿Î»Î¹Ï„Î¹ÎºÎ­Ï‚ Î® inline Ï€Î¿Î»Î¹Ï„Î¹ÎºÎ­Ï‚)
* Î‘Ï€ÎµÎ½ÎµÏÎ³Î¿Ï€Î¿Î¯Î·ÏƒÎ· MFA / Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ· Ï„Î·Ï‚ Î´Î¹ÎºÎ®Ï‚ ÏƒÎ±Ï‚ ÏƒÏ…ÏƒÎºÎµÏ…Î®Ï‚ MFA
* Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± ÎºÎ±Ï„Î±ÏƒÏ„Î¬ÏƒÎµÏ‰Ï‚ Î±Î»Ï…ÏƒÎ¯Î´Î±Ï‚ ÏÏŒÎ»Ï‰Î½ (Ï€ÎµÏÎ¹ÏƒÏƒÏŒÏ„ÎµÏÎ± Î³Î¹Î± Î±Ï…Ï„ÏŒ Ï€Î±ÏÎ±ÎºÎ¬Ï„Ï‰ ÏƒÏ„Î·Î½ ÎµÏ€Î¹Î¼Î¿Î½Î® STS)

### Backdoor Role Trust Policies

ÎœÏ€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Ï€ÏÎ¿ÏƒÎ¸Î­ÏƒÎµÏ„Îµ Î¼Î¹Î± backdoor ÏƒÎµ Î¼Î¹Î± Ï€Î¿Î»Î¹Ï„Î¹ÎºÎ® ÎµÎ¼Ï€Î¹ÏƒÏ„Î¿ÏƒÏÎ½Î·Ï‚ Î³Î¹Î± Î½Î± Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Ï„Î·Î½ Î±Î½Î±Î»Î¬Î²ÎµÏ„Îµ Î³Î¹Î± Î­Î½Î±Î½ ÎµÎ¾Ï‰Ï„ÎµÏÎ¹ÎºÏŒ Ï€ÏŒÏÎ¿ Ï€Î¿Ï… ÎµÎ»Î­Î³Ï‡ÎµÏ„Îµ (Î® Î³Î¹Î± ÏŒÎ»Î¿Ï…Ï‚):
```json
{
"Version": "2012-10-17",
"Statement": [
{
"Effect": "Allow",
"Principal": {
"AWS": [
"*",
"arn:aws:iam::123213123123:root"
]
},
"Action": "sts:AssumeRole"
}
]
}
```
### Backdoor Policy Version

Î”ÏÏƒÏ„Îµ Î´Î¹ÎºÎ±Î¹ÏÎ¼Î±Ï„Î± Î”Î¹Î±Ï‡ÎµÎ¹ÏÎ¹ÏƒÏ„Î® ÏƒÎµ Î¼Î¹Î± Ï€Î¿Î»Î¹Ï„Î¹ÎºÎ® Ï€Î¿Ï… Î´ÎµÎ½ ÎµÎ¯Î½Î±Î¹ Î· Ï„ÎµÎ»ÎµÏ…Ï„Î±Î¯Î± Ï„Î·Ï‚ Î­ÎºÎ´Î¿ÏƒÎ· (Î· Ï„ÎµÎ»ÎµÏ…Ï„Î±Î¯Î± Î­ÎºÎ´Î¿ÏƒÎ· Î¸Î± Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± Ï†Î±Î¯Î½ÎµÏ„Î±Î¹ Î½ÏŒÎ¼Î¹Î¼Î·), ÏƒÏ„Î· ÏƒÏ…Î½Î­Ï‡ÎµÎ¹Î± Î±Î½Î±Î¸Î­ÏƒÏ„Îµ Î±Ï…Ï„Î® Ï„Î·Î½ Î­ÎºÎ´Î¿ÏƒÎ· Ï„Î·Ï‚ Ï€Î¿Î»Î¹Ï„Î¹ÎºÎ®Ï‚ ÏƒÎµ Î­Î½Î±Î½ ÎµÎ»ÎµÎ³Ï‡ÏŒÎ¼ÎµÎ½Î¿ Ï‡ÏÎ®ÏƒÏ„Î·/Î¿Î¼Î¬Î´Î±.

### Backdoor / Create Identity Provider

Î•Î¬Î½ Î¿ Î»Î¿Î³Î±ÏÎ¹Î±ÏƒÎ¼ÏŒÏ‚ Î®Î´Î· ÎµÎ¼Ï€Î¹ÏƒÏ„ÎµÏÎµÏ„Î±Î¹ Î­Î½Î±Î½ ÎºÎ¿Î¹Î½ÏŒÏ‡ÏÎ·ÏƒÏ„Î¿ Ï€Î¬ÏÎ¿Ï‡Î¿ Ï„Î±Ï…Ï„ÏŒÏ„Î·Ï„Î±Ï‚ (ÏŒÏ€Ï‰Ï‚ Ï„Î¿ Github), Î¿Î¹ ÏƒÏ…Î½Î¸Î®ÎºÎµÏ‚ ÎµÎ¼Ï€Î¹ÏƒÏ„Î¿ÏƒÏÎ½Î·Ï‚ Î¸Î± Î¼Ï€Î¿ÏÎ¿ÏÏƒÎ±Î½ Î½Î± Î±Ï…Î¾Î·Î¸Î¿ÏÎ½ ÏÏƒÏ„Îµ Î¿ ÎµÏ€Î¹Ï„Î¹Î¸Î­Î¼ÎµÎ½Î¿Ï‚ Î½Î± Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Ï„Î¹Ï‚ ÎµÎºÎ¼ÎµÏ„Î±Î»Î»ÎµÏ…Ï„ÎµÎ¯.

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
