# AWS - EC2 Persistence

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** 游눫 [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** 游냕 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## EC2

Za vi코e informacija proverite:

{% content-ref url="../aws-services/aws-ec2-ebs-elb-ssm-vpc-and-vpn-enum/" %}
[aws-ec2-ebs-elb-ssm-vpc-and-vpn-enum](../aws-services/aws-ec2-ebs-elb-ssm-vpc-and-vpn-enum/)
{% endcontent-ref %}

### Pra캖enje veze sigurnosne grupe

Ako odbrambeni sistem otkrije da je **EC2 instanca kompromitovana**, verovatno 캖e poku코ati da **izoluje** **mre쬿** ma코ine. To mo쬰 u캜initi sa eksplicitnim **Deny NACL** (ali NACL uti캜e na celu podmre쬿), ili **promenom sigurnosne grupe** koja ne dozvoljava **nikakav ulazni ili izlazni** saobra캖aj.

Ako je napada캜 imao **obrnuti shell koji poti캜e sa ma코ine**, 캜ak i ako je SG izmenjen da ne dozvoljava ulazni ili izlazni saobra캖aj, **veza ne캖e biti prekinuta zbog** [**Pra캖enja veze sigurnosne grupe**](https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/security-group-connection-tracking.html)**.**

### EC2 menad쬰r 쬴votnog ciklusa

Ova usluga omogu캖ava **zakazivanje** **kreiranja AMI-a i snimaka** i 캜ak **deljenje sa drugim nalozima**.\
Napada캜 bi mogao da konfiguri코e **generisanje AMI-a ili snimaka** svih slika ili svih volumena **svake nedelje** i **podeli ih sa svojim nalogom**.

### Zakazane instance

Mogu캖e je zakazati instance da se pokre캖u dnevno, nedeljno ili 캜ak mese캜no. Napada캜 bi mogao da pokrene ma코inu sa visokim privilegijama ili zanimljivim pristupom gde bi mogao da pristupi.

### Spot Fleet zahtev

Spot instance su **jeftinije** od redovnih instanci. Napada캜 bi mogao da pokrene **mali spot fleet zahtev za 5 godina** (na primer), sa **automatskom IP** dodelom i **korisni캜kim podacima** koji 코alju napada캜u **kada spot instanca po캜ne** i **IP adresu** i sa **IAM ulogom sa visokim privilegijama**.

### Instanca sa backdoor-om

Napada캜 bi mogao da dobije pristup instancama i da ih backdoor-uje:

* Koriste캖i tradicionalni **rootkit** na primer
* Dodaju캖i novu **javnu SSH klju캜** (proverite [EC2 privesc opcije](../aws-privilege-escalation/aws-ec2-privesc.md))
* Backdoor-ovanje **Korisni캜kih podataka**

### **Backdoor konfiguracija pokretanja**

* Backdoor-ovati kori코캖eni AMI
* Backdoor-ovati korisni캜ke podatke
* Backdoor-ovati par klju캜eva

### VPN

Kreirati VPN tako da napada캜 mo쬰 direktno da se pove쬰 kroz njega na VPC.

### VPC Peering

Kreirati peering vezu izme캠u VPC-a rtve i VPC-a napada캜a kako bi mogao da pristupi VPC-u rtve.

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** 游눫 [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** 游냕 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
