# AWS - EC2 Persistence

{% hint style="success" %}
AWS рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ рдФрд░ рдЕрднреНрдпрд╛рд╕ рдХрд░реЗрдВ:<img src="../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">\
GCP рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ рдФрд░ рдЕрднреНрдпрд╛рд╕ рдХрд░реЗрдВ: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░реЗрдВ</summary>

* [**рд╕рджрд╕реНрдпрддрд╛ рдпреЛрдЬрдирд╛рдУрдВ**](https://github.com/sponsors/carlospolop) рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ!
* **рд╣рдорд╛рд░реЗ рд╕рд╛рде рдЬреБрдбрд╝реЗрдВ** ЁЯТм [**Discord рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**telegram рд╕рдореВрд╣**](https://t.me/peass) рдпрд╛ **рд╣рдореЗрдВ** **Twitter** ЁЯРж [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** рдкрд░ рдлреЙрд▓реЛ рдХрд░реЗрдВред**
* **рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ рдФрд░** [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) рдЧрд┐рдЯрд╣рдм рд░рд┐рдкреЛрдЬрд┐рдЯрд░реА рдореЗрдВ PR рд╕рдмрдорд┐рдЯ рдХрд░реЗрдВред

</details>
{% endhint %}

## EC2

рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП рджреЗрдЦреЗрдВ:

{% content-ref url="../aws-services/aws-ec2-ebs-elb-ssm-vpc-and-vpn-enum/" %}
[aws-ec2-ebs-elb-ssm-vpc-and-vpn-enum](../aws-services/aws-ec2-ebs-elb-ssm-vpc-and-vpn-enum/)
{% endcontent-ref %}

### рд╕реБрд░рдХреНрд╖рд╛ рд╕рдореВрд╣ рдХрдиреЗрдХреНрд╢рди рдЯреНрд░реИрдХрд┐рдВрдЧ рд╕реНрдерд┐рд░рддрд╛

рдпрджрд┐ рдПрдХ рд░рдХреНрд╖рдХ рдкрд╛рддрд╛ рд╣реИ рдХрд┐ рдПрдХ **EC2 рдЙрджрд╛рд╣рд░рдг рдХреЛ рд╕рдордЭреМрддрд╛ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛**, рддреЛ рд╡рд╣ рд╢рд╛рдпрдж **рдиреЗрдЯрд╡рд░реНрдХ** рдХреЛ **рдЖрдЗрд╕реЛрд▓реЗрдЯ** рдХрд░рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░реЗрдЧрд╛ред рд╡рд╣ рдПрдХ рд╕реНрдкрд╖реНрдЯ **Deny NACL** рдХреЗ рд╕рд╛рде рдРрд╕рд╛ рдХрд░ рд╕рдХрддрд╛ рд╣реИ (рд▓реЗрдХрд┐рди NACLs рдкреВрд░реЗ рд╕рдмрдиреЗрдЯ рдХреЛ рдкреНрд░рднрд╛рд╡рд┐рдд рдХрд░рддреЗ рд╣реИрдВ), рдпрд╛ **рд╕реБрд░рдХреНрд╖рд╛ рд╕рдореВрд╣ рдХреЛ рдмрджрд▓рдХрд░** **рдХрд┐рд╕реА рднреА рдкреНрд░рдХрд╛рд░ рдХреЗ рдЗрдирдмрд╛рдЙрдВрдб рдпрд╛ рдЖрдЙрдЯрдмрд╛рдЙрдВрдб** рдЯреНрд░реИрдлрд╝рд┐рдХ рдХреА рдЕрдиреБрдорддрд┐ рдирд╣реАрдВ рджреЗрддрд╛ред

рдпрджрд┐ рд╣рдорд▓рд╛рд╡рд░ рдХреЗ рдкрд╛рд╕ **рдорд╢реАрди рд╕реЗ рдЙрддреНрдкрдиреНрди рдПрдХ рд░рд┐рд╡рд░реНрд╕ рд╢реЗрд▓** рдерд╛, рддреЛ рднрд▓реЗ рд╣реА SG рдХреЛ рдЗрдирдмрд╛рдЙрдВрдб рдпрд╛ рдЖрдЙрдЯрдмрд╛рдЙрдВрдб рдЯреНрд░реИрдлрд╝рд┐рдХ рдХреА рдЕрдиреБрдорддрд┐ рдирд╣реАрдВ рджреЗрдиреЗ рдХреЗ рд▓рд┐рдП рд╕рдВрд╢реЛрдзрд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реЛ, **рдХрдиреЗрдХреНрд╢рди рдХреЛ** [**рд╕реБрд░рдХреНрд╖рд╛ рд╕рдореВрд╣ рдХрдиреЗрдХреНрд╢рди рдЯреНрд░реИрдХрд┐рдВрдЧ**](https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/security-group-connection-tracking.html)** рдХреЗ рдХрд╛рд░рдг рдирд╣реАрдВ рдорд╛рд░рд╛ рдЬрд╛рдПрдЧрд╛ред**

### EC2 рдЬреАрд╡рдирдЪрдХреНрд░ рдкреНрд░рдмрдВрдзрдХ

рдпрд╣ рд╕реЗрд╡рд╛ **AMIs рдФрд░ рд╕реНрдиреИрдкрд╢реЙрдЯреНрд╕** рдХреЗ **рдирд┐рд░реНрдорд╛рдг рдХреЛ рд╢реЗрдбреНрдпреВрд▓** рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддреА рд╣реИ рдФрд░ рдпрд╣рд╛рдВ рддрдХ рдХрд┐ **рдЙрдиреНрд╣реЗрдВ рдЕрдиреНрдп рдЦрд╛рддреЛрдВ рдХреЗ рд╕рд╛рде рд╕рд╛рдЭрд╛** рднреА рдХрд░ рд╕рдХрддреА рд╣реИред\
рдПрдХ рд╣рдорд▓рд╛рд╡рд░ **рд╣рд░ рд╕рдкреНрддрд╛рд╣** рд╕рднреА рдЫрд╡рд┐рдпреЛрдВ рдпрд╛ рд╕рднреА рд╡реЙрд▓реНрдпреВрдо рдХреЗ **AMIs рдпрд╛ рд╕реНрдиреИрдкрд╢реЙрдЯреНрд╕** рдХреЗ **рдЙрддреНрдкрд╛рджрди рдХреЛ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░** рдХрд░ рд╕рдХрддрд╛ рд╣реИ рдФрд░ **рдЙрдиреНрд╣реЗрдВ рдЕрдкрдиреЗ рдЦрд╛рддреЗ рдХреЗ рд╕рд╛рде рд╕рд╛рдЭрд╛** рдХрд░ рд╕рдХрддрд╛ рд╣реИред

### рдЕрдиреБрд╕реВрдЪрд┐рдд рдЙрджрд╛рд╣рд░рдг

рдпрд╣ рд╕рдВрднрд╡ рд╣реИ рдХрд┐ рдЙрджрд╛рд╣рд░рдгреЛрдВ рдХреЛ рджреИрдирд┐рдХ, рд╕рд╛рдкреНрддрд╛рд╣рд┐рдХ рдпрд╛ рдпрд╣рд╛рдВ рддрдХ рдХрд┐ рдорд╛рд╕рд┐рдХ рд░реВрдк рд╕реЗ рдЪрд▓рд╛рдиреЗ рдХреЗ рд▓рд┐рдП рд╢реЗрдбреНрдпреВрд▓ рдХрд┐рдпрд╛ рдЬрд╛рдПред рдПрдХ рд╣рдорд▓рд╛рд╡рд░ рдПрдХ рдорд╢реАрди рдЪрд▓рд╛ рд╕рдХрддрд╛ рд╣реИ рдЬрд┐рд╕рдореЗрдВ рдЙрдЪреНрдЪ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдпрд╛ рджрд┐рд▓рдЪрд╕реНрдк рдкрд╣реБрдВрдЪ рд╣реЛ рдЬрд╣рд╛рдВ рд╡рд╣ рдкрд╣реБрдВрдЪ рд╕рдХрддрд╛ рд╣реИред

### рд╕реНрдкреЙрдЯ рдлрд╝реНрд▓реАрдЯ рдЕрдиреБрд░реЛрдз

рд╕реНрдкреЙрдЯ рдЙрджрд╛рд╣рд░рдг **рд╕рд╛рдорд╛рдиреНрдп рдЙрджрд╛рд╣рд░рдгреЛрдВ** рдХреА рддреБрд▓рдирд╛ рдореЗрдВ **рд╕рд╕реНрддреЗ** рд╣реЛрддреЗ рд╣реИрдВред рдПрдХ рд╣рдорд▓рд╛рд╡рд░ **5 рд╡рд░реНрд╖ рдХреЗ рд▓рд┐рдП рдПрдХ рдЫреЛрдЯрд╛ рд╕реНрдкреЙрдЯ рдлрд╝реНрд▓реАрдЯ рдЕрдиреБрд░реЛрдз** рд▓реЙрдиреНрдЪ рдХрд░ рд╕рдХрддрд╛ рд╣реИ (рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП), **рд╕реНрд╡рдЪрд╛рд▓рд┐рдд IP** рдЕрд╕рд╛рдЗрдирдореЗрдВрдЯ рдХреЗ рд╕рд╛рде рдФрд░ рдПрдХ **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдбреЗрдЯрд╛** рдЬреЛ рд╣рдорд▓рд╛рд╡рд░ рдХреЛ **рдЬрдм рд╕реНрдкреЙрдЯ рдЙрджрд╛рд╣рд░рдг рд╢реБрд░реВ рд╣реЛрддрд╛ рд╣реИ** рдФрд░ **IP рдкрддрд╛** рднреЗрдЬрддрд╛ рд╣реИ рдФрд░ рдПрдХ **рдЙрдЪреНрдЪ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ IAM рднреВрдорд┐рдХрд╛** рдХреЗ рд╕рд╛рдеред

### рдмреИрдХрдбреЛрд░ рдЙрджрд╛рд╣рд░рдг

рдПрдХ рд╣рдорд▓рд╛рд╡рд░ рдЙрджрд╛рд╣рд░рдгреЛрдВ рддрдХ рдкрд╣реБрдВрдЪ рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддрд╛ рд╣реИ рдФрд░ рдЙрдиреНрд╣реЗрдВ рдмреИрдХрдбреЛрд░ рдХрд░ рд╕рдХрддрд╛ рд╣реИ:

* рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП рдПрдХ рдкрд╛рд░рдВрдкрд░рд┐рдХ **рд░реВрдЯрдХрд┐рдЯ** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛
* рдПрдХ рдирдпрд╛ **рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ SSH рдХреБрдВрдЬреА** рдЬреЛрдбрд╝рдирд╛ (рджреЗрдЦреЗрдВ [EC2 рдкреНрд░рд┐рд╡реЗрд╕реНрдХ рд╡рд┐рдХрд▓реНрдк](../aws-privilege-escalation/aws-ec2-privesc.md))
* **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдбреЗрдЯрд╛** рдХреЛ рдмреИрдХрдбреЛрд░ рдХрд░рдирд╛

### **рдмреИрдХрдбреЛрд░ рд▓реЙрдиреНрдЪ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди**

* рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдЧрдП AMI рдХреЛ рдмреИрдХрдбреЛрд░ рдХрд░реЗрдВ
* рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдбреЗрдЯрд╛ рдХреЛ рдмреИрдХрдбреЛрд░ рдХрд░реЗрдВ
* рдХреБрдВрдЬреА рдЬреЛрдбрд╝реА рдХреЛ рдмреИрдХрдбреЛрд░ рдХрд░реЗрдВ

### VPN

рдПрдХ VPN рдмрдирд╛рдПрдВ рддрд╛рдХрд┐ рд╣рдорд▓рд╛рд╡рд░ рд╕реАрдзреЗ рдЗрд╕рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ VPC рд╕реЗ рдХрдиреЗрдХреНрдЯ рдХрд░ рд╕рдХреЗред

### VPC рдкреАрдпрд░рд┐рдВрдЧ

рдкреАрдбрд╝рд┐рдд VPC рдФрд░ рд╣рдорд▓рд╛рд╡рд░ VPC рдХреЗ рдмреАрдЪ рдПрдХ рдкреАрдпрд░рд┐рдВрдЧ рдХрдиреЗрдХреНрд╢рди рдмрдирд╛рдПрдВ рддрд╛рдХрд┐ рд╡рд╣ рдкреАрдбрд╝рд┐рдд VPC рддрдХ рдкрд╣реБрдВрдЪ рд╕рдХреЗред

{% hint style="success" %}
AWS рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ рдФрд░ рдЕрднреНрдпрд╛рд╕ рдХрд░реЗрдВ:<img src="../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">\
GCP рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ рдФрд░ рдЕрднреНрдпрд╛рд╕ рдХрд░реЗрдВ: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░реЗрдВ</summary>

* [**рд╕рджрд╕реНрдпрддрд╛ рдпреЛрдЬрдирд╛рдУрдВ**](https://github.com/sponsors/carlospolop) рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ!
* **рд╣рдорд╛рд░реЗ рд╕рд╛рде рдЬреБрдбрд╝реЗрдВ** ЁЯТм [**Discord рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**telegram рд╕рдореВрд╣**](https://t.me/peass) рдпрд╛ **рд╣рдореЗрдВ** **Twitter** ЁЯРж [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** рдкрд░ рдлреЙрд▓реЛ рдХрд░реЗрдВред**
* **рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ рдФрд░** [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) рдЧрд┐рдЯрд╣рдм рд░рд┐рдкреЛрдЬрд┐рдЯрд░реА рдореЗрдВ PR рд╕рдмрдорд┐рдЯ рдХрд░реЗрдВред

</details>
{% endhint %}
