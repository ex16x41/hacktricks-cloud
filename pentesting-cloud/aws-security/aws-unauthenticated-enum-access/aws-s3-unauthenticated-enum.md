# AWS - S3 èªè¨¼ãªã—åˆ—æŒ™

{% hint style="success" %}
AWSãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã³ã€å®Ÿè·µã™ã‚‹ï¼š<img src="../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">\
GCPãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã³ã€å®Ÿè·µã™ã‚‹ï¼š<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricksã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹</summary>

* [**ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³**](https://github.com/sponsors/carlospolop)ã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼
* **ğŸ’¬ [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã¾ãŸã¯[**Telegramã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«å‚åŠ ã™ã‚‹ã‹ã€**Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**ã‚’ãƒ•ã‚©ãƒ­ãƒ¼ã—ã¦ãã ã•ã„ã€‚**
* **ãƒãƒƒã‚­ãƒ³ã‚°ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã™ã‚‹ã«ã¯ã€[**HackTricks**](https://github.com/carlospolop/hacktricks)ãŠã‚ˆã³[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)ã®GitHubãƒªãƒã‚¸ãƒˆãƒªã«PRã‚’é€ä¿¡ã—ã¦ãã ã•ã„ã€‚**

</details>
{% endhint %}

## S3 ãƒ‘ãƒ–ãƒªãƒƒã‚¯ãƒã‚±ãƒƒãƒˆ

ãƒã‚±ãƒƒãƒˆã¯ã€**ã€Œãƒ‘ãƒ–ãƒªãƒƒã‚¯ã€**ã¨è¦‹ãªã•ã‚Œã‚‹ã®ã¯ã€**ä»»æ„ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒãƒã‚±ãƒƒãƒˆã®å†…å®¹ã‚’ãƒªã‚¹ãƒˆã§ãã‚‹**å ´åˆã§ã‚ã‚Šã€**ã€Œãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆã€**ã¯ã€ãƒã‚±ãƒƒãƒˆã®å†…å®¹ãŒ**ç‰¹å®šã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã‚ˆã£ã¦ã®ã¿ãƒªã‚¹ãƒˆã¾ãŸã¯æ›¸ãè¾¼ã¾ã‚Œã‚‹**å ´åˆã§ã™ã€‚

ä¼æ¥­ã¯ã€**ãƒã‚±ãƒƒãƒˆã®æ¨©é™ãŒèª¤ã£ã¦è¨­å®šã•ã‚Œã¦ã„ã‚‹**å¯èƒ½æ€§ãŒã‚ã‚Šã€ã™ã¹ã¦ã¾ãŸã¯AWSã®ä»»æ„ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§èªè¨¼ã•ã‚ŒãŸã™ã¹ã¦ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã‚¢ã‚¯ã‚»ã‚¹ã‚’è¨±å¯ã™ã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ï¼ˆã¤ã¾ã‚Šã€èª°ã«ã§ã‚‚ï¼‰ã€‚ã“ã®ã‚ˆã†ãªèª¤è¨­å®šãŒã‚ã£ã¦ã‚‚ã€ãƒã‚±ãƒƒãƒˆã«ã¯ç‹¬è‡ªã®ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡ãƒªã‚¹ãƒˆï¼ˆACLï¼‰ãŒã‚ã‚‹ãŸã‚ã€ç‰¹å®šã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãŒå®Ÿè¡Œã§ããªã„å ´åˆãŒã‚ã‚Šã¾ã™ã€‚

**AWS-S3ã®èª¤è¨­å®šã«ã¤ã„ã¦å­¦ã¶ã«ã¯ã“ã¡ã‚‰ã‚’å‚ç…§ã—ã¦ãã ã•ã„ï¼š** [**http://flaws.cloud**](http://flaws.cloud/) **ãŠã‚ˆã³** [**http://flaws2.cloud/**](http://flaws2.cloud)

### AWSãƒã‚±ãƒƒãƒˆã®ç™ºè¦‹

ã‚¦ã‚§ãƒ–ãƒšãƒ¼ã‚¸ãŒAWSã‚’ä½¿ç”¨ã—ã¦ãƒªã‚½ãƒ¼ã‚¹ã‚’ä¿å­˜ã—ã¦ã„ã‚‹ã‹ã©ã†ã‹ã‚’è¦‹ã¤ã‘ã‚‹ãŸã‚ã®ã•ã¾ã–ã¾ãªæ–¹æ³•ï¼š

#### åˆ—æŒ™ & OSINT:

* **wappalyzer**ãƒ–ãƒ©ã‚¦ã‚¶ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’ä½¿ç”¨
* burpã‚’ä½¿ç”¨ã—ã¦ï¼ˆã‚¦ã‚§ãƒ–ã‚’**ã‚¹ãƒ‘ã‚¤ãƒ€ãƒ¼**ã™ã‚‹ï¼‰ã¾ãŸã¯æ‰‹å‹•ã§ãƒšãƒ¼ã‚¸ã‚’ãƒŠãƒ“ã‚²ãƒ¼ãƒˆã™ã‚‹ã“ã¨ã§ã€ã™ã¹ã¦ã®**ãƒªã‚½ãƒ¼ã‚¹**ãŒå±¥æ­´ã«ä¿å­˜ã•ã‚Œã¾ã™ã€‚
* **ãƒªã‚½ãƒ¼ã‚¹ã‚’ç¢ºèªã™ã‚‹**ãƒ‰ãƒ¡ã‚¤ãƒ³ã®ä¾‹ï¼š

```
http://s3.amazonaws.com/[bucket_name]/
http://[bucket_name].s3.amazonaws.com/
```
* **CNAMES**ã‚’ç¢ºèªã™ã‚‹ã€‚`resources.domain.com`ã¯`bucket.s3.amazonaws.com`ã®CNAMEã‚’æŒã¤å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚
* [https://buckets.grayhatwarfare.com](https://buckets.grayhatwarfare.com/)ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚ã“ã“ã«ã¯ã™ã§ã«**ç™ºè¦‹ã•ã‚ŒãŸã‚ªãƒ¼ãƒ—ãƒ³ãƒã‚±ãƒƒãƒˆ**ãŒã‚ã‚Šã¾ã™ã€‚
* **ãƒã‚±ãƒƒãƒˆå**ã¨**ãƒã‚±ãƒƒãƒˆãƒ‰ãƒ¡ã‚¤ãƒ³å**ã¯**åŒã˜ã§ã‚ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚**
* **flaws.cloud**ã¯**IP** 52.92.181.107ã«ã‚ã‚Šã€ãã“ã«è¡Œãã¨[https://aws.amazon.com/s3/](https://aws.amazon.com/s3/)ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã•ã‚Œã¾ã™ã€‚ã¾ãŸã€`dig -x 52.92.181.107`ã¯`s3-website-us-west-2.amazonaws.com`ã‚’è¿”ã—ã¾ã™ã€‚
* ãƒã‚±ãƒƒãƒˆã§ã‚ã‚‹ã“ã¨ã‚’ç¢ºèªã™ã‚‹ã«ã¯ã€[https://flaws.cloud.s3.amazonaws.com/](https://flaws.cloud.s3.amazonaws.com/)ã‚’**è¨ªå•**ã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ã€‚

#### ãƒ–ãƒ«ãƒ¼ãƒˆãƒ•ã‚©ãƒ¼ã‚¹

ä¼æ¥­ã«é–¢é€£ã™ã‚‹**åå‰ã‚’ãƒ–ãƒ«ãƒ¼ãƒˆãƒ•ã‚©ãƒ¼ã‚¹**ã™ã‚‹ã“ã¨ã§ãƒã‚±ãƒƒãƒˆã‚’è¦‹ã¤ã‘ã‚‹ã“ã¨ãŒã§ãã¾ã™ï¼š

* [https://github.com/sa7mon/S3Scanner](https://github.com/sa7mon/S3Scanner)
* [https://github.com/clario-tech/s3-inspector](https://github.com/clario-tech/s3-inspector)
* [https://github.com/jordanpotti/AWSBucketDump](https://github.com/jordanpotti/AWSBucketDump)ï¼ˆæ½œåœ¨çš„ãªãƒã‚±ãƒƒãƒˆåã®ãƒªã‚¹ãƒˆã‚’å«ã‚€ï¼‰
* [https://github.com/fellchase/flumberboozle/tree/master/flumberbuckets](https://github.com/fellchase/flumberboozle/tree/master/flumberbuckets)
* [https://github.com/smaranchand/bucky](https://github.com/smaranchand/bucky)
* [https://github.com/tomdev/teh\_s3\_bucketeers](https://github.com/tomdev/teh\_s3\_bucketeers)
* [https://github.com/RhinoSecurityLabs/Security-Research/tree/master/tools/aws-pentest-tools/s3](https://github.com/RhinoSecurityLabs/Security-Research/tree/master/tools/aws-pentest-tools/s3)
* [https://github.com/Eilonh/s3crets\_scanner](https://github.com/Eilonh/s3crets\_scanner)
* [https://github.com/belane/CloudHunter](https://github.com/belane/CloudHunter)

<pre class="language-bash"><code class="lang-bash"># ãƒ‘ãƒ¼ãƒŸãƒ¥ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä½œæˆã™ã‚‹ãŸã‚ã®ãƒ¯ãƒ¼ãƒ‰ãƒªã‚¹ãƒˆã‚’ç”Ÿæˆ
curl -s https://raw.githubusercontent.com/cujanovic/goaltdns/master/words.txt > /tmp/words-s3.txt.temp
curl -s https://raw.githubusercontent.com/jordanpotti/AWSBucketDump/master/BucketNames.txt >>/tmp/words-s3.txt.temp
cat /tmp/words-s3.txt.temp | sort -u > /tmp/words-s3.txt

# ãƒ†ã‚¹ãƒˆã™ã‚‹ãŸã‚ã®ãƒ‰ãƒ¡ã‚¤ãƒ³ã¨ã‚µãƒ–ãƒ‰ãƒ¡ã‚¤ãƒ³ã«åŸºã¥ã„ã¦ãƒ¯ãƒ¼ãƒ‰ãƒªã‚¹ãƒˆã‚’ç”Ÿæˆ
## ã“ã‚Œã‚‰ã®ãƒ‰ãƒ¡ã‚¤ãƒ³ã¨ã‚µãƒ–ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’subdomains.txtã«æ›¸ãè¾¼ã‚€
cat subdomains.txt > /tmp/words-hosts-s3.txt
cat subdomains.txt | tr "." "-" >> /tmp/words-hosts-s3.txt
cat subdomains.txt | tr "." "\n" | sort -u >> /tmp/words-hosts-s3.txt

# æ”»æ’ƒã™ã‚‹ãŸã‚ã®ãƒ‰ãƒ¡ã‚¤ãƒ³ã¨ã‚µãƒ–ãƒ‰ãƒ¡ã‚¤ãƒ³ã®ãƒªã‚¹ãƒˆã«åŸºã¥ã„ã¦ãƒ‘ãƒ¼ãƒŸãƒ¥ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä½œæˆ
goaltdns -l /tmp/words-hosts-s3.txt -w /tmp/words-s3.txt -o /tmp/final-words-s3.txt.temp
## å‰ã®ãƒ„ãƒ¼ãƒ«ã¯ã‚µãƒ–ãƒ‰ãƒ¡ã‚¤ãƒ³ã®ãƒ‘ãƒ¼ãƒŸãƒ¥ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä½œæˆã™ã‚‹ã®ã«ç‰¹åŒ–ã—ã¦ã„ã‚‹ã®ã§ã€ãã®ãƒªã‚¹ãƒˆã‚’ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã—ã¾ã™
<strong>### ".ã§çµ‚ã‚ã‚‹è¡Œã‚’å‰Šé™¤ã™ã‚‹
</strong>cat /tmp/final-words-s3.txt.temp | grep -Ev "\.$" > /tmp/final-words-s3.txt.temp2
### TLDãªã—ã®ãƒªã‚¹ãƒˆã‚’ä½œæˆ
cat /tmp/final-words-s3.txt.temp2 | sed -E 's/\.[a-zA-Z0-9]+$//' > /tmp/final-words-s3.txt.temp3
### ãƒ‰ãƒƒãƒˆãªã—ã®ãƒªã‚¹ãƒˆã‚’ä½œæˆ
cat /tmp/final-words-s3.txt.temp3 | tr -d "." > /tmp/final-words-s3.txt.temp4http://phantom.s3.amazonaws.com/
### ãƒã‚¤ãƒ•ãƒ³ãªã—ã®ãƒªã‚¹ãƒˆã‚’ä½œæˆ
cat /tmp/final-words-s3.txt.temp3 | tr "." "-" > /tmp/final-words-s3.txt.temp5

## æœ€çµ‚çš„ãªãƒ¯ãƒ¼ãƒ‰ãƒªã‚¹ãƒˆã‚’ç”Ÿæˆ
cat /tmp/final-words-s3.txt.temp2 /tmp/final-words-s3.txt.temp3 /tmp/final-words-s3.txt.temp4 /tmp/final-words-s3.txt.temp5 | grep -v -- "-\." | awk '{print tolower($0)}' | sort -u > /tmp/final-words-s3.txt

## s3scannerã‚’å‘¼ã³å‡ºã™
s3scanner --threads 100 scan --buckets-file /tmp/final-words-s3.txt  | grep bucket_exists
</code></pre>

#### S3ãƒã‚±ãƒƒãƒˆã®ç•¥å¥ª

ã‚ªãƒ¼ãƒ—ãƒ³ãªS3ãƒã‚±ãƒƒãƒˆãŒã‚ã‚‹å ´åˆã€[**BucketLoot**](https://github.com/redhuntlabs/BucketLoot)ã¯è‡ªå‹•çš„ã«**èˆˆå‘³æ·±ã„æƒ…å ±ã‚’æ¤œç´¢**ã§ãã¾ã™ã€‚

### ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã‚’è¦‹ã¤ã‘ã‚‹

AWSãŒã‚µãƒãƒ¼ãƒˆã™ã‚‹ã™ã¹ã¦ã®ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã¯ã€[**https://docs.aws.amazon.com/general/latest/gr/s3.html**](https://docs.aws.amazon.com/general/latest/gr/s3.html)ã§ç¢ºèªã§ãã¾ã™ã€‚

#### DNSã«ã‚ˆã‚‹ç¢ºèª

**`dig`**ãŠã‚ˆã³**`nslookup`**ã‚’ä½¿ç”¨ã—ã¦ã€ç™ºè¦‹ã•ã‚ŒãŸIPã®**DNSãƒªã‚¯ã‚¨ã‚¹ãƒˆ**ã‚’è¡Œã†ã“ã¨ã§ãƒã‚±ãƒƒãƒˆã®ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã‚’å–å¾—ã§ãã¾ã™ï¼š
```bash
dig flaws.cloud
;; ANSWER SECTION:
flaws.cloud.    5    IN    A    52.218.192.11

nslookup 52.218.192.11
Non-authoritative answer:
11.192.218.52.in-addr.arpa name = s3-website-us-west-2.amazonaws.com.
```
ãƒ‰ãƒ¡ã‚¤ãƒ³ãŒã€Œwebsiteã€ã¨ã„ã†å˜èªã‚’å«ã‚“ã§ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚\
é™çš„ã‚¦ã‚§ãƒ–ã‚µã‚¤ãƒˆã«ã¯æ¬¡ã®URLã§ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã™: `flaws.cloud.s3-website-us-west-2.amazonaws.com`\
ã¾ãŸã¯ã€ãƒã‚±ãƒƒãƒˆã«ã¯æ¬¡ã®URLã§ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã™: `flaws.cloud.s3-us-west-2.amazonaws.com`

#### è©¦ã—ã¦ã¿ã‚‹

ãƒã‚±ãƒƒãƒˆã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã‚ˆã†ã¨ã—ãŸãŒã€**æŒ‡å®šã—ãŸãƒ‰ãƒ¡ã‚¤ãƒ³åã«åˆ¥ã®ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ãŒå«ã¾ã‚Œã¦ã„ã‚‹å ´åˆ**ï¼ˆä¾‹ãˆã°ã€ãƒã‚±ãƒƒãƒˆãŒ `bucket.s3.amazonaws.com` ã«ã‚ã‚‹ãŒã€`bucket.s3-website-us-west-2.amazonaws.com` ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã‚ˆã†ã¨ã—ãŸå ´åˆï¼‰ã€**æ­£ã—ã„å ´æ‰€ã«èª˜å°ã•ã‚Œã¾ã™**:

![](<../../../.gitbook/assets/image (106).png>)

### ãƒã‚±ãƒƒãƒˆã®åˆ—æŒ™

ãƒã‚±ãƒƒãƒˆã®ã‚ªãƒ¼ãƒ—ãƒ³æ€§ã‚’ãƒ†ã‚¹ãƒˆã™ã‚‹ãŸã‚ã«ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯å˜ã«URLã‚’ã‚¦ã‚§ãƒ–ãƒ–ãƒ©ã‚¦ã‚¶ã«å…¥åŠ›ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãƒã‚±ãƒƒãƒˆã¯ã€Œã‚¢ã‚¯ã‚»ã‚¹æ‹’å¦ã€ã¨å¿œç­”ã—ã¾ã™ã€‚ãƒ‘ãƒ–ãƒªãƒƒã‚¯ãƒã‚±ãƒƒãƒˆã¯ã€ä¿å­˜ã•ã‚ŒãŸæœ€åˆã®1,000ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ãƒªã‚¹ãƒˆã—ã¾ã™ã€‚

èª°ã§ã‚‚ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½:

![](<../../../.gitbook/assets/image (201).png>)

ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆ:

![](<../../../.gitbook/assets/image (83).png>)

ã“ã‚Œã‚’CLIã§ç¢ºèªã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™:
```bash
#Use --no-sign-request for check Everyones permissions
#Use --profile <PROFILE_NAME> to indicate the AWS profile(keys) that youwant to use: Check for "Any Authenticated AWS User" permissions
#--recursive if you want list recursivelyls
#Opcionally you can select the region if you now it
aws s3 ls s3://flaws.cloud/ [--no-sign-request] [--profile <PROFILE_NAME>] [ --recursive] [--region us-west-2]
```
ãƒã‚±ãƒƒãƒˆã«ãƒ‰ãƒ¡ã‚¤ãƒ³åãŒãªã„å ´åˆã€åˆ—æŒ™ã—ã‚ˆã†ã¨ã™ã‚‹ã¨ãã¯ã€**ãƒã‚±ãƒƒãƒˆåã®ã¿ã‚’å…¥åŠ›**ã—ã€å…¨ä½“ã®AWSs3ãƒ‰ãƒ¡ã‚¤ãƒ³ã¯å…¥åŠ›ã—ãªã„ã§ãã ã•ã„ã€‚ä¾‹: `s3://<BUCKETNAME>`

### ãƒ‘ãƒ–ãƒªãƒƒã‚¯URLãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
```
https://{user_provided}.s3.amazonaws.com
```
### å…¬é–‹ãƒã‚±ãƒƒãƒˆã‹ã‚‰ã‚¢ã‚«ã‚¦ãƒ³ãƒˆIDã‚’å–å¾—ã™ã‚‹

æ–°ã—ã„ **`S3:ResourceAccount`** **ãƒãƒªã‚·ãƒ¼æ¡ä»¶ã‚­ãƒ¼**ã‚’åˆ©ç”¨ã™ã‚‹ã“ã¨ã§ã€AWSã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ç‰¹å®šã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚ã“ã®æ¡ä»¶ã¯ã€ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãŒå­˜åœ¨ã™ã‚‹S3ãƒã‚±ãƒƒãƒˆã«åŸºã¥ã„ã¦ã‚¢ã‚¯ã‚»ã‚¹ã‚’**åˆ¶é™**ã—ã¾ã™ï¼ˆä»–ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãƒ™ãƒ¼ã‚¹ã®ãƒãƒªã‚·ãƒ¼ã¯ã€ãƒªã‚¯ã‚¨ã‚¹ãƒˆå…ƒã®ãƒ—ãƒªãƒ³ã‚·ãƒ‘ãƒ«ãŒå­˜åœ¨ã™ã‚‹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã«åŸºã¥ã„ã¦åˆ¶é™ã—ã¾ã™ï¼‰ã€‚\
ãƒãƒªã‚·ãƒ¼ã«ã¯**ãƒ¯ã‚¤ãƒ«ãƒ‰ã‚«ãƒ¼ãƒ‰**ã‚’å«ã‚ã‚‹ã“ã¨ãŒã§ãã‚‹ãŸã‚ã€**1ã¤ã®æ•°å­—ãšã¤**ã‚¢ã‚«ã‚¦ãƒ³ãƒˆç•ªå·ã‚’è¦‹ã¤ã‘ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚

ã“ã®ãƒ„ãƒ¼ãƒ«ã¯ãã®ãƒ—ãƒ­ã‚»ã‚¹ã‚’è‡ªå‹•åŒ–ã—ã¾ã™ï¼š
```bash
# Installation
pipx install s3-account-search
pip install s3-account-search
# With a bucket
s3-account-search arn:aws:iam::123456789012:role/s3_read s3://my-bucket
# With an object
s3-account-search arn:aws:iam::123456789012:role/s3_read s3://my-bucket/path/to/object.ext
```
ã“ã®æŠ€è¡“ã¯ã€API Gateway URLsã€Lambda URLsã€Data Exchange ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã€ã•ã‚‰ã«ã¯ã‚¿ã‚°ã®å€¤ã‚’å–å¾—ã™ã‚‹ãŸã‚ã«ã‚‚æ©Ÿèƒ½ã—ã¾ã™ï¼ˆã‚¿ã‚°ã‚­ãƒ¼ãŒã‚ã‹ã£ã¦ã„ã‚‹å ´åˆï¼‰ã€‚è©³ç´°ã«ã¤ã„ã¦ã¯ã€[**å…ƒã®ç ”ç©¶**](https://blog.plerion.com/conditional-love-for-aws-metadata-enumeration/)ã¨ã€ã“ã®æ‚ªç”¨ã‚’è‡ªå‹•åŒ–ã™ã‚‹ãŸã‚ã®ãƒ„ãƒ¼ãƒ«[**conditional-love**](https://github.com/plerionhq/conditional-love/)ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

### ãƒã‚±ãƒƒãƒˆãŒAWSã‚¢ã‚«ã‚¦ãƒ³ãƒˆã«å±ã—ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã™ã‚‹

[**ã“ã®ãƒ–ãƒ­ã‚°è¨˜äº‹**](https://blog.plerion.com/things-you-wish-you-didnt-need-to-know-about-s3/)ã§èª¬æ˜ã•ã‚Œã¦ã„ã‚‹ã‚ˆã†ã«ã€**ãƒã‚±ãƒƒãƒˆã‚’ãƒªã‚¹ãƒˆã™ã‚‹æ¨©é™ãŒã‚ã‚‹å ´åˆ**ã€æ¬¡ã®ã‚ˆã†ãªãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã™ã‚‹ã“ã¨ã§ã€ãƒã‚±ãƒƒãƒˆãŒå±ã™ã‚‹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆIDã‚’ç¢ºèªã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ï¼š
```bash
curl -X GET "[bucketname].amazonaws.com/" \
-H "x-amz-expected-bucket-owner: [correct-account-id]"

<?xml version="1.0" encoding="UTF-8"?>
<ListBucketResult xmlns="http://s3.amazonaws.com/doc/2006-03-01/">...</ListBucketResult>
```
ã‚‚ã—ã‚¨ãƒ©ãƒ¼ãŒã€Œã‚¢ã‚¯ã‚»ã‚¹æ‹’å¦ã€ã§ã‚ã‚Œã°ã€ãã‚Œã¯ã‚¢ã‚«ã‚¦ãƒ³ãƒˆIDãŒé–“é•ã£ã¦ã„ã‚‹ã“ã¨ã‚’æ„å‘³ã—ã¾ã™ã€‚

### ãƒ«ãƒ¼ãƒˆã‚¢ã‚«ã‚¦ãƒ³ãƒˆåˆ—æŒ™ã¨ã—ã¦ã®ä½¿ç”¨ã•ã‚ŒãŸãƒ¡ãƒ¼ãƒ«

[**ã“ã®ãƒ–ãƒ­ã‚°è¨˜äº‹**](https://blog.plerion.com/things-you-wish-you-didnt-need-to-know-about-s3/)ã§èª¬æ˜ã•ã‚Œã¦ã„ã‚‹ã‚ˆã†ã«ã€S3ãƒã‚±ãƒƒãƒˆã«å¯¾ã—ã¦ACLã‚’ä»‹ã—ã¦ãƒ¡ãƒ¼ãƒ«ã«æ¨©é™ã‚’ä»˜ä¸ã—ã‚ˆã†ã¨ã™ã‚‹ã“ã¨ã§ã€ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ãŒAWSã‚¢ã‚«ã‚¦ãƒ³ãƒˆã«é–¢é€£ã—ã¦ã„ã‚‹ã‹ã©ã†ã‹ã‚’ç¢ºèªã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚ã“ã‚ŒãŒã‚¨ãƒ©ãƒ¼ã‚’å¼•ãèµ·ã“ã•ãªã„å ´åˆã€ãã®ãƒ¡ãƒ¼ãƒ«ã¯ã‚ã‚‹AWSã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®ãƒ«ãƒ¼ãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼ã§ã‚ã‚‹ã“ã¨ã‚’æ„å‘³ã—ã¾ã™ã€‚
```python
s3_client.put_bucket_acl(
Bucket=bucket_name,
AccessControlPolicy={
'Grants': [
{
'Grantee': {
'EmailAddress': 'some@emailtotest.com',
'Type': 'AmazonCustomerByEmail',
},
'Permission': 'READ'
},
],
'Owner': {
'DisplayName': 'Whatever',
'ID': 'c3d78ab5093a9ab8a5184de715d409c2ab5a0e2da66f08c2f6cc5c0bdeadbeef'
}
}
)
```
## å‚è€ƒæ–‡çŒ®

* [https://www.youtube.com/watch?v=8ZXRw4Ry3mQ](https://www.youtube.com/watch?v=8ZXRw4Ry3mQ)
* [https://cloudar.be/awsblog/finding-the-account-id-of-any-public-s3-bucket/](https://cloudar.be/awsblog/finding-the-account-id-of-any-public-s3-bucket/)

{% hint style="success" %}
AWSãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã³ã€å®Ÿè·µã™ã‚‹ï¼š<img src="../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">\
GCPãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã³ã€å®Ÿè·µã™ã‚‹ï¼š<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricksã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹</summary>

* [**ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³**](https://github.com/sponsors/carlospolop)ã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼
* **ğŸ’¬ [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã¾ãŸã¯[**Telegramã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«å‚åŠ ã™ã‚‹ã‹ã€**Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**ã‚’ãƒ•ã‚©ãƒ­ãƒ¼ã—ã¦ãã ã•ã„ã€‚**
* **ãƒãƒƒã‚­ãƒ³ã‚°ã®ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã™ã‚‹ã«ã¯ã€[**HackTricks**](https://github.com/carlospolop/hacktricks)ãŠã‚ˆã³[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)ã®GitHubãƒªãƒã‚¸ãƒˆãƒªã«PRã‚’æå‡ºã—ã¦ãã ã•ã„ã€‚**

</details>
{% endhint %}
