# AWS - Cognito Unauthenticated Enum

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the**  [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter**  [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Cognito No Autenticado

Cognito es un servicio de AWS que permite a los desarrolladores **otorgar a los usuarios de su aplicaci贸n acceso a los servicios de AWS**. Los desarrolladores otorgar谩n **roles de IAM a los usuarios autenticados** en su aplicaci贸n (potencialmente las personas podr谩n simplemente registrarse) y tambi茅n pueden otorgar un **rol de IAM a los usuarios no autenticados**.

Para informaci贸n b谩sica sobre Cognito, consulta:

{% content-ref url="../aws-services/aws-cognito-enum/" %}
[aws-cognito-enum](../aws-services/aws-cognito-enum/)
{% endcontent-ref %}

### M贸dulos de Pacu para pentesting y enumeraci贸n

[Pacu](https://github.com/RhinoSecurityLabs/pacu), el marco de explotaci贸n de AWS, ahora incluye los m贸dulos "cognito\_\_enum" y "cognito\_\_attack" que automatizan la enumeraci贸n de todos los activos de Cognito en una cuenta y marcan configuraciones d茅biles, atributos de usuario utilizados para el control de acceso, etc., y tambi茅n automatizan la creaci贸n de usuarios (incluido el soporte de MFA) y la escalada de privilegios basada en atributos personalizados modificables, credenciales de grupos de identidad utilizables, roles asumibles en tokens de id, etc.

Para una descripci贸n de las funciones de los m贸dulos, consulta la parte 2 del [blog post](https://rhinosecuritylabs.com/aws/attacking-aws-cognito-with-pacu-p2). Para instrucciones de instalaci贸n, consulta la p谩gina principal de [Pacu](https://github.com/RhinoSecurityLabs/pacu).

### Uso

Ejemplo de uso de cognito\_\_attack para intentar la creaci贸n de usuarios y todos los vectores de privesc contra un grupo de identidad y cliente de grupo de usuarios dados:
```bash
Pacu (new:test) > run cognito__attack --username randomuser --email XX+sdfs2@gmail.com --identity_pools
us-east-2:a06XXXXX-c9XX-4aXX-9a33-9ceXXXXXXXXX --user_pool_clients
59f6tuhfXXXXXXXXXXXXXXXXXX@us-east-2_0aXXXXXXX
```
Ejemplo de uso de cognito\_\_enum para recopilar todos los grupos de usuarios, clientes de grupos de usuarios, grupos de identidades, usuarios, etc. visibles en la cuenta de AWS actual:
```bash
Pacu (new:test) > run cognito__enum
```
### Identity Pool ID

Los Identity Pools pueden otorgar **roles de IAM a usuarios no autenticados** que solo **conocen el ID del Identity Pool** (que es bastante com煤n **encontrar**), y un atacante con esta informaci贸n podr铆a intentar **acceder a ese rol de IAM** y explotarlo.\
Adem谩s, los roles de IAM tambi茅n podr铆an ser asignados a **usuarios autenticados** que acceden al Identity Pool. Si un atacante puede **registrar un usuario** o ya tiene **acceso al proveedor de identidad** utilizado en el Identity Pool, podr铆a acceder al **rol de IAM que se otorga a los usuarios autenticados** y abusar de sus privilegios.

[**Consulta c贸mo hacerlo aqu铆**](../aws-services/aws-cognito-enum/cognito-identity-pools.md).

### User Pool ID

Por defecto, Cognito permite **registrar nuevos usuarios**. Poder registrar un usuario podr铆a darte **acceso** a la **aplicaci贸n subyacente** o al **rol de acceso IAM autenticado de un Identity Pool** que acepta como proveedor de identidad el Cognito User Pool. [**Consulta c贸mo hacerlo aqu铆**](../aws-services/aws-cognito-enum/cognito-user-pools.md#registration).

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the**  [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter**  [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
