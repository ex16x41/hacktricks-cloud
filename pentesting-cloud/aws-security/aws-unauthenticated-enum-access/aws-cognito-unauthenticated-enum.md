# AWS - Cognito Unauthenticated Enum

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Unauthenticated Cognito

Cognito √® un servizio AWS che consente agli sviluppatori di **concedere ai loro utenti dell'app accesso ai servizi AWS**. Gli sviluppatori concederanno **ruoli IAM agli utenti autenticati** nella loro app (potenzialmente le persone potranno semplicemente registrarsi) e possono anche concedere un **ruolo IAM agli utenti non autenticati**.

Per informazioni di base su Cognito controlla:

{% content-ref url="../aws-services/aws-cognito-enum/" %}
[aws-cognito-enum](../aws-services/aws-cognito-enum/)
{% endcontent-ref %}

### Identity Pool ID

Gli Identity Pool possono concedere **ruoli IAM agli utenti non autenticati** che conoscono semplicemente **l'ID dell'Identity Pool** (che √® abbastanza comune **trovare**), e un attaccante con queste informazioni potrebbe provare ad **accedere a quel ruolo IAM** e sfruttarlo.\
Inoltre, i ruoli IAM potrebbero anche essere assegnati a **utenti autenticati** che accedono all'Identity Pool. Se un attaccante pu√≤ **registrare un utente** o ha gi√† **accesso al provider di identit√†** utilizzato nell'identity pool, potrebbe accedere al **ruolo IAM assegnato agli utenti autenticati** e abusare dei suoi privilegi.

[**Controlla come fare qui**](../aws-services/aws-cognito-enum/cognito-identity-pools.md).

### User Pool ID

Per impostazione predefinita, Cognito consente di **registrare nuovi utenti**. Essere in grado di registrare un utente potrebbe darti **accesso** all'**applicazione sottostante** o al **ruolo di accesso IAM autenticato di un Identity Pool** che accetta come provider di identit√† il Cognito User Pool. [**Controlla come fare qui**](../aws-services/aws-cognito-enum/cognito-user-pools.md#registration).

### Moduli Pacu per pentesting e enumerazione

[Pacu](https://github.com/RhinoSecurityLabs/pacu), il framework di sfruttamento AWS, ora include i moduli "cognito\_\_enum" e "cognito\_\_attack" che automatizzano l'enumerazione di tutte le risorse Cognito in un account e segnalano configurazioni deboli, attributi utente utilizzati per il controllo degli accessi, ecc., e automatizzano anche la creazione di utenti (incluso il supporto MFA) e l'escalation dei privilegi basata su attributi personalizzabili modificabili, credenziali di pool di identit√† utilizzabili, ruoli assunti nei token di identit√†, ecc.

Per una descrizione delle funzioni dei moduli, vedi la parte 2 del [post del blog](https://rhinosecuritylabs.com/aws/attacking-aws-cognito-with-pacu-p2). Per le istruzioni di installazione, vedi la pagina principale di [Pacu](https://github.com/RhinoSecurityLabs/pacu).

#### Usage

Esempio di utilizzo di `cognito__attack` per tentare la creazione di un utente e tutti i vettori di privesc contro un dato identity pool e client di user pool:
```bash
Pacu (new:test) > run cognito__attack --username randomuser --email XX+sdfs2@gmail.com --identity_pools
us-east-2:a06XXXXX-c9XX-4aXX-9a33-9ceXXXXXXXXX --user_pool_clients
59f6tuhfXXXXXXXXXXXXXXXXXX@us-east-2_0aXXXXXXX
```
Esempio di utilizzo di cognito\_\_enum per raccogliere tutti i pool utenti, i client dei pool utenti, i pool di identit√†, gli utenti, ecc. visibili nell'attuale account AWS:
```bash
Pacu (new:test) > run cognito__enum
```
{% hint style="success" %}
Impara e pratica il hacking su AWS:<img src="../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">\
Impara e pratica il hacking su GCP: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Supporta HackTricks</summary>

* Controlla i [**piani di abbonamento**](https://github.com/sponsors/carlospolop)!
* **Unisciti al** üí¨ [**gruppo Discord**](https://discord.gg/hRep4RUj7f) o al [**gruppo telegram**](https://t.me/peass) o **seguici** su **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Condividi trucchi di hacking inviando PR ai** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repos di github.

</details>
{% endhint %}
