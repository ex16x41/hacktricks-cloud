# AWS - Acesso N√£o Autenticado ao CodeBuild

{% hint style="success" %}
Aprenda e pratique Hacking AWS:<img src="../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">\
Aprenda e pratique Hacking GCP: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Suporte ao HackTricks</summary>

* Confira os [**planos de assinatura**](https://github.com/sponsors/carlospolop)!
* **Junte-se ao** üí¨ [**grupo do Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga**-nos no **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe truques de hacking enviando PRs para os reposit√≥rios do** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
{% endhint %}

## CodeBuild

Para mais informa√ß√µes, consulte esta p√°gina:

{% content-ref url="../aws-services/aws-codebuild-enum.md" %}
[aws-codebuild-enum.md](../aws-services/aws-codebuild-enum.md)
{% endcontent-ref %}

### buildspec.yml

Se voc√™ comprometer o acesso de escrita sobre um reposit√≥rio contendo um arquivo chamado **`buildspec.yml`**, voc√™ poderia **backdoor** este arquivo, que especifica os **comandos que ser√£o executados** dentro de um projeto CodeBuild e exfiltrar os segredos, comprometer o que √© feito e tamb√©m comprometer as **credenciais da fun√ß√£o IAM do CodeBuild**.

Note que mesmo que n√£o haja nenhum arquivo **`buildspec.yml`**, mas voc√™ saiba que o Codebuild est√° sendo usado (ou um CI/CD diferente), **modificar algum c√≥digo leg√≠timo** que ser√° executado tamb√©m pode te dar um shell reverso, por exemplo.

Para algumas informa√ß√µes relacionadas, voc√™ pode conferir a p√°gina sobre como atacar Github Actions (semelhante a isso):

{% content-ref url="../../../pentesting-ci-cd/github-security/abusing-github-actions/" %}
[abusing-github-actions](../../../pentesting-ci-cd/github-security/abusing-github-actions/)
{% endcontent-ref %}

## Runners de GitHub Actions auto-hospedados no AWS CodeBuild <a href="#action-runner" id="action-runner"></a>

Como [**indicado na documenta√ß√£o**](https://docs.aws.amazon.com/codebuild/latest/userguide/action-runner.html), √© poss√≠vel configurar o **CodeBuild** para executar **a√ß√µes do Github auto-hospedadas** quando um fluxo de trabalho √© acionado dentro de um reposit√≥rio Github configurado. Isso pode ser detectado verificando a configura√ß√£o do projeto CodeBuild, pois o **`Tipo de evento`** precisa conter: **`WORKFLOW_JOB_QUEUED`** e em um Fluxo de Trabalho do Github porque ele selecionar√° um runner **auto-hospedado** assim:
```bash
runs-on: codebuild-<project-name>-${{ github.run_id }}-${{ github.run_attempt }}
```
Esta nova rela√ß√£o entre Github Actions e AWS cria outra maneira de comprometer a AWS a partir do Github, j√° que o c√≥digo no Github ser√° executado em um projeto CodeBuild com um papel IAM anexado.

{% hint style="success" %}
Aprenda e pratique Hacking AWS:<img src="../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">\
Aprenda e pratique Hacking GCP: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Confira os [**planos de assinatura**](https://github.com/sponsors/carlospolop)!
* **Junte-se ao** üí¨ [**grupo do Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga**-nos no **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe truques de hacking enviando PRs para os reposit√≥rios do** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
{% endhint %}
