# AWS - Acceso No Autenticado a CodeBuild

{% hint style="success" %}
Aprende y practica Hacking en AWS:<img src="../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">\
Aprende y practica Hacking en GCP: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Apoya a HackTricks</summary>

* Revisa los [**planes de suscripci칩n**](https://github.com/sponsors/carlospolop)!
* **칔nete al** 游눫 [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s칤guenos** en **Twitter** 游냕 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Comparte trucos de hacking enviando PRs a los** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repositorios de github.

</details>
{% endhint %}

## CodeBuild

Para m치s informaci칩n, consulta esta p치gina:

{% content-ref url="../aws-services/aws-codebuild-enum.md" %}
[aws-codebuild-enum.md](../aws-services/aws-codebuild-enum.md)
{% endcontent-ref %}

### buildspec.yml

Si comprometes el acceso de escritura sobre un repositorio que contiene un archivo llamado **`buildspec.yml`**, podr칤as **insertar un backdoor** en este archivo, que especifica los **comandos que se van a ejecutar** dentro de un proyecto de CodeBuild y exfiltrar los secretos, comprometer lo que se hace y tambi칠n comprometer las **credenciales del rol IAM de CodeBuild**.

Ten en cuenta que incluso si no hay ning칰n archivo **`buildspec.yml`** pero sabes que se est치 utilizando Codebuild (o un CI/CD diferente) **modificar alg칰n c칩digo leg칤timo** que se va a ejecutar tambi칠n puede conseguirte un reverse shell, por ejemplo.

Para informaci칩n relacionada, podr칤as consultar la p치gina sobre c칩mo atacar Github Actions (similar a esto):

{% content-ref url="../../../pentesting-ci-cd/github-security/abusing-github-actions/" %}
[abusing-github-actions](../../../pentesting-ci-cd/github-security/abusing-github-actions/)
{% endcontent-ref %}

## Runners de GitHub Actions autoalojados en AWS CodeBuild <a href="#action-runner" id="action-runner"></a>

Como [**se indica en la documentaci칩n**](https://docs.aws.amazon.com/codebuild/latest/userguide/action-runner.html), es posible configurar **CodeBuild** para ejecutar **acciones de Github autoalojadas** cuando se activa un flujo de trabajo dentro de un repositorio de Github configurado. Esto se puede detectar revisando la configuraci칩n del proyecto de CodeBuild porque el **`Tipo de evento`** necesita contener: **`WORKFLOW_JOB_QUEUED`** y en un flujo de trabajo de Github porque seleccionar치 un runner **autoalojado** como este:
```bash
runs-on: codebuild-<project-name>-${{ github.run_id }}-${{ github.run_attempt }}
```
Esta nueva relaci칩n entre Github Actions y AWS crea otra forma de comprometer AWS desde Github, ya que el c칩digo en Github se ejecutar치 en un proyecto de CodeBuild con un rol IAM adjunto.

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** 游눫 [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** 游냕 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
