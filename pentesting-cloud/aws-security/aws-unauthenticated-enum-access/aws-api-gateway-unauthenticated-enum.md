# AWS - API Gateway Unauthenticated Enum

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

### API Invoke bypass

[Attack Vectors for APIs Using AWS API Gateway Lambda Authorizers - Alexandre & Leonardo](https://www.youtube.com/watch?v=bsPKk7WDOnE)ì˜ ë°œí‘œì— ë”°ë¥´ë©´, Lambda AuthorizersëŠ” API ì—”ë“œí¬ì¸íŠ¸ë¥¼ í˜¸ì¶œí•  ìˆ˜ ìˆëŠ” ê¶Œí•œì„ ë¶€ì—¬í•˜ê¸° ìœ„í•´ **IAM êµ¬ë¬¸ì„ ì‚¬ìš©í•˜ì—¬** êµ¬ì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ëŠ” [**ë¬¸ì„œì—ì„œ ê°€ì ¸ì˜¨ ë‚´ìš©ì…ë‹ˆë‹¤**](https://docs.aws.amazon.com/apigateway/latest/developerguide/api-gateway-control-access-using-iam-policies-to-invoke-api.html):
```json
{
"Version": "2012-10-17",
"Statement": [
{
"Effect": "Permission",
"Action": [
"execute-api:Execution-operation"
],
"Resource": [
"arn:aws:execute-api:region:account-id:api-id/stage/METHOD_HTTP_VERB/Resource-path"
]
}
]
}
```
ì´ ì—”ë“œí¬ì¸íŠ¸ë¥¼ í˜¸ì¶œí•˜ê¸° ìœ„í•œ ê¶Œí•œì„ ë¶€ì—¬í•˜ëŠ” ë°©ë²•ì˜ ë¬¸ì œëŠ” **"\*"ê°€ "ëª¨ë“  ê²ƒ"ì„ ì˜ë¯¸**í•˜ë©° **ë” ì´ìƒ ì •ê·œ í‘œí˜„ì‹ êµ¬ë¬¸ì´ ì§€ì›ë˜ì§€ ì•Šê¸° ë•Œë¬¸**ì…ë‹ˆë‹¤.

ëª‡ ê°€ì§€ ì˜ˆì‹œ:

* ê° ì‚¬ìš©ìì—ê²Œ `/dashboard/user/{username}`ì— ëŒ€í•œ ì ‘ê·¼ì„ í—ˆìš©í•˜ê¸° ìœ„í•´ `arn:aws:execute-apis:sa-east-1:accid:api-id/prod/*/dashboard/*`ì™€ ê°™ì€ ê·œì¹™ì„ ì‚¬ìš©í•˜ë©´, ì˜ˆë¥¼ ë“¤ì–´ `/admin/dashboard/createAdmin`ê³¼ ê°™ì€ ë‹¤ë¥¸ ê²½ë¡œì— ëŒ€í•œ ì ‘ê·¼ë„ í—ˆìš©ë©ë‹ˆë‹¤.

{% hint style="warning" %}
**"\*"ëŠ” ìŠ¬ë˜ì‹œë¡œ í™•ì¥ë˜ëŠ” ê²ƒì„ ë©ˆì¶”ì§€ ì•ŠìŒì„ ì£¼ì˜í•˜ì„¸ìš”**, ë”°ë¼ì„œ ì˜ˆë¥¼ ë“¤ì–´ api-idì—ì„œ "\*"ë¥¼ ì‚¬ìš©í•˜ë©´ ìµœì¢… ì •ê·œ í‘œí˜„ì‹ì´ ì—¬ì „íˆ ìœ íš¨í•œ í•œ "ëª¨ë“  ë‹¨ê³„" ë˜ëŠ” "ëª¨ë“  ë©”ì„œë“œ"ë¥¼ ë‚˜íƒ€ë‚¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.\
ê·¸ë˜ì„œ `arn:aws:execute-apis:sa-east-1:accid:*/prod/GET/dashboard/*`\
ëŠ” ì˜ˆë¥¼ ë“¤ì–´ `/prod/GET/dashboard/admin` ê²½ë¡œì— ëŒ€í•œ í…ŒìŠ¤íŠ¸ ë‹¨ê³„ì— ëŒ€í•œ POST ìš”ì²­ì„ ê²€ì¦í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
{% endhint %}

í•­ìƒ í—ˆìš©í•˜ê³ ì í•˜ëŠ” ì ‘ê·¼ì„ ëª…í™•íˆ í•˜ê³ , ë¶€ì—¬ëœ ê¶Œí•œìœ¼ë¡œ ë‹¤ë¥¸ ì‹œë‚˜ë¦¬ì˜¤ê°€ ê°€ëŠ¥í•œì§€ í™•ì¸í•´ì•¼ í•©ë‹ˆë‹¤.

ìì„¸í•œ ì •ë³´ëŠ” [**ë¬¸ì„œ**](https://docs.aws.amazon.com/apigateway/latest/developerguide/api-gateway-control-access-using-iam-policies-to-invoke-api.html) ì™¸ì—ë„ [**ì´ ê³µì‹ aws github**](https://github.com/awslabs/aws-apigateway-lambda-authorizer-blueprints/tree/master/blueprints)ì—ì„œ ê¶Œí•œ ë¶€ì—¬ìë¥¼ êµ¬í˜„í•˜ëŠ” ì½”ë“œë¥¼ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### IAM ì •ì±… ì£¼ì…

ê°™ì€ [**ê°•ì—°**](https://www.youtube.com/watch?v=bsPKk7WDOnE)ì—ì„œ ì½”ë“œê°€ **ì‚¬ìš©ì ì…ë ¥**ì„ ì‚¬ìš©í•˜ì—¬ **IAM ì •ì±…ì„ ìƒì„±**í•˜ëŠ” ê²½ìš°, ì™€ì¼ë“œì¹´ë“œ(ë° "." ë˜ëŠ” íŠ¹ì • ë¬¸ìì—´ê³¼ ê°™ì€ ë‹¤ë¥¸ ê²ƒë“¤)ê°€ í¬í•¨ë  ìˆ˜ ìˆìœ¼ë©°, ì´ëŠ” **ì œí•œì„ ìš°íšŒí•˜ê¸° ìœ„í•œ ëª©ì **ì…ë‹ˆë‹¤.

### ê³µê°œ URL í…œí”Œë¦¿
```
https://{random_id}.execute-api.{region}.amazonaws.com/{user_provided}
```
### Get Account ID from public API Gateway URL

S3 ë²„í‚·, ë°ì´í„° êµí™˜ ë° Lambda URL ê²Œì´íŠ¸ì›¨ì´ì™€ ë§ˆì°¬ê°€ì§€ë¡œ, ê³µê°œ API Gateway URLì—ì„œ **`aws:ResourceAccount`** **ì •ì±… ì¡°ê±´ í‚¤**ë¥¼ ì•…ìš©í•˜ì—¬ ê³„ì •ì˜ ê³„ì • IDë¥¼ ì°¾ëŠ” ê²ƒì´ ê°€ëŠ¥í•©ë‹ˆë‹¤. ì´ëŠ” ì •ì±…ì˜ **`aws:ResourceAccount`** ì„¹ì…˜ì—ì„œ ì™€ì¼ë“œì¹´ë“œë¥¼ ì•…ìš©í•˜ì—¬ í•œ ë²ˆì— í•œ ë¬¸ìì”© ê³„ì • IDë¥¼ ì°¾ìŒìœ¼ë¡œì¨ ì´ë£¨ì–´ì§‘ë‹ˆë‹¤.\
ì´ ê¸°ìˆ ì€ íƒœê·¸ í‚¤ë¥¼ ì•Œê³  ìˆë‹¤ë©´ **íƒœê·¸ ê°’**ì„ ì–»ì„ ìˆ˜ ìˆê²Œ í•´ì¤ë‹ˆë‹¤(ê¸°ë³¸ì ìœ¼ë¡œ í¥ë¯¸ë¡œìš´ ê²ƒë“¤ì´ ìˆìŠµë‹ˆë‹¤).

ìì„¸í•œ ì •ë³´ëŠ” [**ì›ë³¸ ì—°êµ¬**](https://blog.plerion.com/conditional-love-for-aws-metadata-enumeration/)ì™€ ì´ ì•…ìš©ì„ ìë™í™”í•˜ëŠ” ë„êµ¬ [**conditional-love**](https://github.com/plerionhq/conditional-love/)ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
