# AWS - API Gateway Unauthenticated Enum

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ЁЯТм [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ЁЯРж [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

### API Invoke bypass

рдХреЗ рдЕрдиреБрд╕рд╛рд░ [Attack Vectors for APIs Using AWS API Gateway Lambda Authorizers - Alexandre & Leonardo](https://www.youtube.com/watch?v=bsPKk7WDOnE), Lambda Authorizers рдХреЛ API рдПрдВрдбрдкреЙрдЗрдВрдЯреНрд╕ рдХреЛ рдХреЙрд▓ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЕрдиреБрдорддрд┐ рджреЗрдиреЗ рдХреЗ рд▓рд┐рдП **IAM рд╕рд┐рдВрдЯреИрдХреНрд╕** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред рдпрд╣ [**docs рд╕реЗ рд▓рд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ**](https://docs.aws.amazon.com/apigateway/latest/developerguide/api-gateway-control-access-using-iam-policies-to-invoke-api.html):
```json
{
"Version": "2012-10-17",
"Statement": [
{
"Effect": "Permission",
"Action": [
"execute-api:Execution-operation"
],
"Resource": [
"arn:aws:execute-api:region:account-id:api-id/stage/METHOD_HTTP_VERB/Resource-path"
]
}
]
}
```
рдЗрд╕ рддрд░реАрдХреЗ рд╕реЗ рдПрдВрдбрдкреЙрдЗрдВрдЯреНрд╕ рдХреЛ рдЗрдирд╡реЛрдХ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЕрдиреБрдорддрд┐ рджреЗрдиреЗ рдХреА рд╕рдорд╕реНрдпрд╛ рдпрд╣ рд╣реИ рдХрд┐ **"\*" рдХрд╛ рдЕрд░реНрде "рдХреБрдЫ рднреА" рд╣реИ** рдФрд░ **рдХреЛрдИ рдФрд░ regex рд╕рд┐рдВрдЯреИрдХреНрд╕ рд╕рдорд░реНрдерд┐рдд рдирд╣реАрдВ рд╣реИ**ред

рдХреБрдЫ рдЙрджрд╛рд╣рд░рдг:

* рдПрдХ рдирд┐рдпрдо рдЬреИрд╕реЗ `arn:aws:execute-apis:sa-east-1:accid:api-id/prod/*/dashboard/*` рддрд╛рдХрд┐ рдкреНрд░рддреНрдпреЗрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ `/dashboard/user/{username}` рддрдХ рдкрд╣реБрдВрдЪ рдорд┐рд▓ рд╕рдХреЗ, рдЙрдиреНрд╣реЗрдВ рдЕрдиреНрдп рдорд╛рд░реНрдЧреЛрдВ рддрдХ рднреА рдкрд╣реБрдВрдЪ рджреЗрдЧрд╛ рдЬреИрд╕реЗ рдХрд┐ `/admin/dashboard/createAdmin` рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдПред

{% hint style="warning" %}
рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ **"\*" рд╕реНрд▓реИрд╢ рдХреЗ рд╕рд╛рде рд╡рд┐рд╕реНрддрд╛рд░рд┐рдд рд╣реЛрдирд╛ рдмрдВрдж рдирд╣реАрдВ рд╣реЛрддрд╛**, рдЗрд╕рд▓рд┐рдП, рдпрджрд┐ рдЖрдк рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП api-id рдореЗрдВ "\*" рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВ, рддреЛ рдпрд╣ "рдХрд┐рд╕реА рднреА рдЪрд░рдг" рдпрд╛ "рдХрд┐рд╕реА рднреА рд╡рд┐рдзрд┐" рдХреЛ рднреА рдЗрдВрдЧрд┐рдд рдХрд░ рд╕рдХрддрд╛ рд╣реИ рдЬрдм рддрдХ рдЕрдВрддрд┐рдо regex рдЕрднреА рднреА рдорд╛рдиреНрдп рд╣реИред\
рддреЛ `arn:aws:execute-apis:sa-east-1:accid:*/prod/GET/dashboard/*`\
рдПрдХ рдкреЛрд╕реНрдЯ рдЕрдиреБрд░реЛрдз рдХреЛ рдкрд░реАрдХреНрд╖рдг рдЪрд░рдг рдХреЗ рд▓рд┐рдП рдкрде `/prod/GET/dashboard/admin` рдкрд░ рдорд╛рдиреНрдп рдХрд░ рд╕рдХрддрд╛ рд╣реИ рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдПред
{% endhint %}

рдЖрдкрдХреЛ рд╣рдореЗрд╢рд╛ рд╕реНрдкрд╖реНрдЯ рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП рдХрд┐ рдЖрдк рдХрд┐рд╕реЗ рдкрд╣реБрдВрдЪ рджреЗрдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдФрд░ рдлрд┐рд░ рдЬрд╛рдВрдЪреЗрдВ рдХрд┐ рдХреНрдпрд╛ рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХреЗ рд╕рд╛рде рдЕрдиреНрдп рдкрд░рд┐рджреГрд╢реНрдп рд╕рдВрднрд╡ рд╣реИрдВред

рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП, [**docs**](https://docs.aws.amazon.com/apigateway/latest/developerguide/api-gateway-control-access-using-iam-policies-to-invoke-api.html) рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдЖрдк [**рдЗрд╕ рдЖрдзрд┐рдХрд╛рд░рд┐рдХ aws github**](https://github.com/awslabs/aws-apigateway-lambda-authorizer-blueprints/tree/master/blueprints) рдореЗрдВ рдСрдерд░рд╛рдЗрдЬрд╝рд░реНрд╕ рдХреЛ рд▓рд╛рдЧреВ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХреЛрдб рдкрд╛ рд╕рдХрддреЗ рд╣реИрдВред

### IAM рдиреАрддрд┐ рдЗрдВрдЬреЗрдХреНрд╢рди

рдЙрд╕реА [**talk** ](https://www.youtube.com/watch?v=bsPKk7WDOnE) рдореЗрдВ рдпрд╣ рдмрддрд╛рдпрд╛ рдЧрдпрд╛ рд╣реИ рдХрд┐ рдпрджрд┐ рдХреЛрдб **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЗрдирдкреБрдЯ** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ **IAM рдиреАрддрд┐рдпреЛрдВ** рдХреЛ **рдЬрдирд░реЗрдЯ** рдХрд░ рд░рд╣рд╛ рд╣реИ, рддреЛ рд╡рд╛рдЗрд▓реНрдбрдХрд╛рд░реНрдб (рдФрд░ рдЕрдиреНрдп рдЬреИрд╕реЗ "." рдпрд╛ рд╡рд┐рд╢рд┐рд╖реНрдЯ рд╕реНрдЯреНрд░рд┐рдВрдЧ) рдХреЛ рд╡рд╣рд╛рдВ рд╢рд╛рдорд┐рд▓ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдЬрд┐рд╕рдХрд╛ рд▓рдХреНрд╖реНрдп **рдкреНрд░рддрд┐рдмрдВрдзреЛрдВ рдХреЛ рдмрд╛рдпрдкрд╛рд╕ рдХрд░рдирд╛** рд╣реИред

### рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ URL рдЯреЗрдореНрдкрд▓реЗрдЯ
```
https://{random_id}.execute-api.{region}.amazonaws.com/{user_provided}
```
### рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ API рдЧреЗрдЯрд╡реЗ URL рд╕реЗ рдЦрд╛рддрд╛ ID рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ

S3 рдмрдХреЗрдЯ, рдбреЗрдЯрд╛ рдПрдХреНрд╕рдЪреЗрдВрдЬ рдФрд░ рд▓реИрдореНрдмреНрдбрд╛ URL рдЧреЗрдЯрд╡реЗ рдХреА рддрд░рд╣, рдПрдХ рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ API рдЧреЗрдЯрд╡реЗ URL рд╕реЗ **`aws:ResourceAccount`** **рдкреЙрд▓рд┐рд╕реА рдХрдВрдбреАрд╢рди рдХреА** рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдХреЗ рдПрдХ рдЦрд╛рддреЗ рдХреА рдЦрд╛рддрд╛ ID рдкреНрд░рд╛рдкреНрдд рдХрд░рдирд╛ рд╕рдВрднрд╡ рд╣реИред рдпрд╣ рдкреЙрд▓рд┐рд╕реА рдХреЗ **`aws:ResourceAccount`** рдЕрдиреБрднрд╛рдЧ рдореЗрдВ рд╡рд╛рдЗрд▓реНрдбрдХрд╛рд░реНрдб рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдХреЗ рдПрдХ рдмрд╛рд░ рдореЗрдВ рдПрдХ рдЕрдХреНрд╖рд░ рдЦрд╛рддрд╛ ID рдЦреЛрдЬрдХрд░ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред\
рдпрд╣ рддрдХрдиреАрдХ рдЖрдкрдХреЛ **рдЯреИрдЧ рдХреЗ рдорд╛рди** рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреА рднреА рдЕрдиреБрдорддрд┐ рджреЗрддреА рд╣реИ рдпрджрд┐ рдЖрдк рдЯреИрдЧ рдХреБрдВрдЬреА рдЬрд╛рдирддреЗ рд╣реИрдВ (рдХреБрдЫ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рджрд┐рд▓рдЪрд╕реНрдк рд╣реЛрддреЗ рд╣реИрдВ)ред

рдЖрдк [**рдореВрд▓ рд╢реЛрдз**](https://blog.plerion.com/conditional-love-for-aws-metadata-enumeration/) рдФрд░ рдЗрд╕ рд╢реЛрд╖рдг рдХреЛ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдХрд░рдг [**conditional-love**](https://github.com/plerionhq/conditional-love/) рдореЗрдВ рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

{% hint style="success" %}
AWS рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ рдФрд░ рдЕрднреНрдпрд╛рд╕ рдХрд░реЗрдВ:<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
GCP рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ рдФрд░ рдЕрднреНрдпрд╛рд╕ рдХрд░реЗрдВ: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░реЗрдВ</summary>

* [**рд╕рджрд╕реНрдпрддрд╛ рдпреЛрдЬрдирд╛рдПрдБ**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* **рд╣рдорд╛рд░реЗ** ЁЯТм [**Discord рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдореЗрдВ рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ рдпрд╛ **Twitter** ЁЯРж рдкрд░ рд╣рдореЗрдВ **рдлреЙрд▓реЛ рдХрд░реЗрдВ** [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ рдФрд░** [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) рдЧрд┐рдЯрд╣рдм рд░рд┐рдкреЛрдЬрд┐рдЯрд░реА рдореЗрдВ PR рд╕рдмрдорд┐рдЯ рдХрд░реЗрдВред

</details>
{% endhint %}
