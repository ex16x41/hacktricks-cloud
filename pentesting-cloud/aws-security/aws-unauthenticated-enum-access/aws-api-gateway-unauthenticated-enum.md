# AWS - API Gateway Unauthenticated Enum

{% hint style="success" %}
AWSãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã³ã€ç·´ç¿’ã™ã‚‹:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCPãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã³ã€ç·´ç¿’ã™ã‚‹: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricksã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹</summary>

* [**ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³**](https://github.com/sponsors/carlospolop)ã‚’ãƒã‚§ãƒƒã‚¯ï¼
* **ğŸ’¬ [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã¾ãŸã¯[**telegramã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«å‚åŠ ã™ã‚‹ã‹ã€**Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**ã‚’ãƒ•ã‚©ãƒ­ãƒ¼ã™ã‚‹ã€‚**
* **PRã‚’æå‡ºã—ã¦ãƒãƒƒã‚­ãƒ³ã‚°ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã™ã‚‹** [**HackTricks**](https://github.com/carlospolop/hacktricks)ãŠã‚ˆã³[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)ã®githubãƒªãƒã‚¸ãƒˆãƒªã€‚

</details>
{% endhint %}

### API Invoke bypass

[Attack Vectors for APIs Using AWS API Gateway Lambda Authorizers - Alexandre & Leonardo](https://www.youtube.com/watch?v=bsPKk7WDOnE)ã®è¬›æ¼”ã«ã‚ˆã‚‹ã¨ã€Lambda Authorizersã¯**IAMæ§‹æ–‡**ã‚’ä½¿ç”¨ã—ã¦APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’å‘¼ã³å‡ºã™æ¨©é™ã‚’ä»˜ä¸ã™ã‚‹ã‚ˆã†ã«è¨­å®šã§ãã¾ã™ã€‚ã“ã‚Œã¯[**ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ**](https://docs.aws.amazon.com/apigateway/latest/developerguide/api-gateway-control-access-using-iam-policies-to-invoke-api.html)ã‹ã‚‰å¼•ç”¨ã•ã‚Œã¦ã„ã¾ã™:
```json
{
"Version": "2012-10-17",
"Statement": [
{
"Effect": "Permission",
"Action": [
"execute-api:Execution-operation"
],
"Resource": [
"arn:aws:execute-api:region:account-id:api-id/stage/METHOD_HTTP_VERB/Resource-path"
]
}
]
}
```
ã“ã®æ–¹æ³•ã§ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’å‘¼ã³å‡ºã™æ¨©é™ã‚’ä¸ãˆã‚‹å•é¡Œã¯ã€**"\*" ã¯ "anything" ã‚’æ„å‘³ã™ã‚‹**ãŸã‚ã€**æ­£è¦è¡¨ç¾ã®æ§‹æ–‡ãŒã“ã‚Œä»¥ä¸Šã‚µãƒãƒ¼ãƒˆã•ã‚Œãªã„**ã“ã¨ã§ã™ã€‚

ã„ãã¤ã‹ã®ä¾‹:

* å„ãƒ¦ãƒ¼ã‚¶ãƒ¼ã« `/dashboard/user/{username}` ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’è¨±å¯ã™ã‚‹ãŸã‚ã« `arn:aws:execute-apis:sa-east-1:accid:api-id/prod/*/dashboard/*` ã®ã‚ˆã†ãªãƒ«ãƒ¼ãƒ«ã‚’è¨­å®šã™ã‚‹ã¨ã€ä¾‹ãˆã° `/admin/dashboard/createAdmin` ãªã©ã®ä»–ã®ãƒ«ãƒ¼ãƒˆã«ã‚‚ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

{% hint style="warning" %}
**"\*" ã¯ã‚¹ãƒ©ãƒƒã‚·ãƒ¥ã§å±•é–‹ãŒæ­¢ã¾ã‚‰ãªã„**ã“ã¨ã«æ³¨æ„ã—ã¦ãã ã•ã„ã€‚ã—ãŸãŒã£ã¦ã€ä¾‹ãˆã° api-id ã« "\*" ã‚’ä½¿ç”¨ã™ã‚‹ã¨ã€æœ€çµ‚çš„ãªæ­£è¦è¡¨ç¾ãŒæœ‰åŠ¹ã§ã‚ã‚‹é™ã‚Šã€ã€Œä»»æ„ã®ã‚¹ãƒ†ãƒ¼ã‚¸ã€ã‚„ã€Œä»»æ„ã®ãƒ¡ã‚½ãƒƒãƒ‰ã€ã‚’ç¤ºã™ã“ã¨ã‚‚ã§ãã¾ã™ã€‚\
ã—ãŸãŒã£ã¦ `arn:aws:execute-apis:sa-east-1:accid:*/prod/GET/dashboard/*`\
ã¯ã€ä¾‹ãˆã° `/prod/GET/dashboard/admin` ã¸ã®ãƒ†ã‚¹ãƒˆã‚¹ãƒ†ãƒ¼ã‚¸ã¸ã®ãƒã‚¹ãƒˆãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’æ¤œè¨¼ã§ãã¾ã™ã€‚
{% endhint %}

ã‚¢ã‚¯ã‚»ã‚¹ã‚’è¨±å¯ã—ãŸã„å†…å®¹ã‚’å¸¸ã«æ˜ç¢ºã«ã—ã€ä»˜ä¸ã•ã‚ŒãŸæ¨©é™ã§ä»–ã®ã‚·ãƒŠãƒªã‚ªãŒå¯èƒ½ã‹ã©ã†ã‹ã‚’ç¢ºèªã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

è©³ç´°ã«ã¤ã„ã¦ã¯ã€[**docs**](https://docs.aws.amazon.com/apigateway/latest/developerguide/api-gateway-control-access-using-iam-policies-to-invoke-api.html) ã®ä»–ã«ã€[**ã“ã®å…¬å¼ aws github**](https://github.com/awslabs/aws-apigateway-lambda-authorizer-blueprints/tree/master/blueprints) ã§ã‚ªãƒ¼ã‚½ãƒ©ã‚¤ã‚¶ãƒ¼ã‚’å®Ÿè£…ã™ã‚‹ãŸã‚ã®ã‚³ãƒ¼ãƒ‰ã‚’è¦‹ã¤ã‘ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

### IAM Policy Injection

åŒã˜ [**talk**](https://www.youtube.com/watch?v=bsPKk7WDOnE) ã§ã€ã‚³ãƒ¼ãƒ‰ãŒ **ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›** ã‚’ä½¿ç”¨ã—ã¦ **IAM ãƒãƒªã‚·ãƒ¼ã‚’ç”Ÿæˆ** ã—ã¦ã„ã‚‹å ´åˆã€ãƒ¯ã‚¤ãƒ«ãƒ‰ã‚«ãƒ¼ãƒ‰ï¼ˆãŠã‚ˆã³ "." ã‚„ç‰¹å®šã®æ–‡å­—åˆ—ãªã©ï¼‰ã‚’å«ã‚ã‚‹ã“ã¨ã§ **åˆ¶é™ã‚’å›é¿** ã§ãã‚‹ã“ã¨ãŒç¤ºã•ã‚Œã¦ã„ã¾ã™ã€‚

### Public URL template
```
https://{random_id}.execute-api.{region}.amazonaws.com/{user_provided}
```
### å…¬é–‹API Gateway URLã‹ã‚‰ã‚¢ã‚«ã‚¦ãƒ³ãƒˆIDã‚’å–å¾—

S3ãƒã‚±ãƒƒãƒˆã€Data Exchangeã€Lambda URLã‚²ãƒ¼ãƒˆã‚¦ã‚§ã‚¤ã¨åŒæ§˜ã«ã€å…¬é–‹API Gateway URLã‹ã‚‰**`aws:ResourceAccount`** **Policy Condition Key**ã‚’æ‚ªç”¨ã—ã¦ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®IDã‚’è¦‹ã¤ã‘ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚ã“ã‚Œã¯ã€ãƒãƒªã‚·ãƒ¼ã®**`aws:ResourceAccount`**ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã§ãƒ¯ã‚¤ãƒ«ãƒ‰ã‚«ãƒ¼ãƒ‰ã‚’æ‚ªç”¨ã—ã¦ã€ã‚¢ã‚«ã‚¦ãƒ³ãƒˆIDã‚’ä¸€æ–‡å­—ãšã¤è¦‹ã¤ã‘ã‚‹ã“ã¨ã§è¡Œã‚ã‚Œã¾ã™ã€‚\
ã“ã®æŠ€è¡“ã‚’ä½¿ç”¨ã™ã‚‹ã¨ã€ã‚¿ã‚°ã‚­ãƒ¼ã‚’çŸ¥ã£ã¦ã„ã‚Œã°**ã‚¿ã‚°ã®å€¤**ã‚’å–å¾—ã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ï¼ˆã„ãã¤ã‹ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®èˆˆå‘³æ·±ã„ã‚‚ã®ãŒã‚ã‚Šã¾ã™ï¼‰ã€‚

è©³ç´°ã¯[**ã‚ªãƒªã‚¸ãƒŠãƒ«ã®ç ”ç©¶**](https://blog.plerion.com/conditional-love-for-aws-metadata-enumeration/)ãŠã‚ˆã³ã“ã®ã‚¨ã‚¯ã‚¹ãƒ—ãƒ­ã‚¤ãƒˆã‚’è‡ªå‹•åŒ–ã™ã‚‹ãƒ„ãƒ¼ãƒ«[**conditional-love**](https://github.com/plerionhq/conditional-love/)ã§ç¢ºèªã§ãã¾ã™ã€‚

{% hint style="success" %}
AWSãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã³ã€ç·´ç¿’ã™ã‚‹:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCPãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã³ã€ç·´ç¿’ã™ã‚‹: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricksã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹</summary>

* [**ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³**](https://github.com/sponsors/carlospolop)ã‚’ãƒã‚§ãƒƒã‚¯ï¼
* **ğŸ’¬ [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã¾ãŸã¯[**Telegramã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«å‚åŠ ã™ã‚‹ã‹ã€**Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**ã‚’ãƒ•ã‚©ãƒ­ãƒ¼ã™ã‚‹ã€‚**
* **ãƒãƒƒã‚­ãƒ³ã‚°ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã™ã‚‹ã«ã¯ã€** [**HackTricks**](https://github.com/carlospolop/hacktricks)ãŠã‚ˆã³[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)ã®GitHubãƒªãƒã‚¸ãƒˆãƒªã«PRã‚’æå‡ºã—ã¦ãã ã•ã„ã€‚

</details>
{% endhint %}
