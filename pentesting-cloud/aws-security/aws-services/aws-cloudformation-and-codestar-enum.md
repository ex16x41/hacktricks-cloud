# AWS - CloudFormation & Codestar Enum

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## CloudFormation

AWS CloudFormation ÎµÎ¯Î½Î±Î¹ Î¼Î¹Î± Ï…Ï€Î·ÏÎµÏƒÎ¯Î± ÏƒÏ‡ÎµÎ´Î¹Î±ÏƒÎ¼Î­Î½Î· Î½Î± **Î±Ï€Î»Î¿Ï€Î¿Î¹ÎµÎ¯ Ï„Î· Î´Î¹Î±Ï‡ÎµÎ¯ÏÎ¹ÏƒÎ· Ï„Ï‰Î½ Ï€ÏŒÏÏ‰Î½ AWS**. Î•Ï€Î¹Ï„ÏÎ­Ï€ÎµÎ¹ ÏƒÏ„Î¿Ï…Ï‚ Ï‡ÏÎ®ÏƒÏ„ÎµÏ‚ Î½Î± ÎµÏ€Î¹ÎºÎµÎ½Ï„ÏÏÎ½Î¿Î½Ï„Î±Î¹ Ï€ÎµÏÎ¹ÏƒÏƒÏŒÏ„ÎµÏÎ¿ ÏƒÏ„Î¹Ï‚ ÎµÏ†Î±ÏÎ¼Î¿Î³Î­Ï‚ Ï„Î¿Ï…Ï‚ Ï€Î¿Ï… Ï„ÏÎ­Ï‡Î¿Ï…Î½ ÏƒÏ„Î¿ AWS, **ÎµÎ»Î±Ï‡Î¹ÏƒÏ„Î¿Ï€Î¿Î¹ÏÎ½Ï„Î±Ï‚ Ï„Î¿Î½ Ï‡ÏÏŒÎ½Î¿ Ï€Î¿Ï… Î´Î±Ï€Î±Î½Î¬Ï„Î±Î¹ ÏƒÏ„Î· Î´Î¹Î±Ï‡ÎµÎ¯ÏÎ¹ÏƒÎ· Ï€ÏŒÏÏ‰Î½**. Î— ÎºÏÏÎ¹Î± Î´Ï…Î½Î±Ï„ÏŒÏ„Î·Ï„Î± Î±Ï…Ï„Î®Ï‚ Ï„Î·Ï‚ Ï…Ï€Î·ÏÎµÏƒÎ¯Î±Ï‚ ÎµÎ¯Î½Î±Î¹ Ï„Î¿ **Ï€ÏÏŒÏ„Ï…Ï€Î¿**â€”Î­Î½Î± Ï€ÎµÏÎ¹Î³ÏÎ±Ï†Î¹ÎºÏŒ Î¼Î¿Î½Ï„Î­Î»Î¿ Ï„Ï‰Î½ ÎµÏ€Î¹Î¸Ï…Î¼Î·Ï„ÏÎ½ Ï€ÏŒÏÏ‰Î½ AWS. ÎœÏŒÎ»Î¹Ï‚ Ï€Î±ÏÎ±ÏƒÏ‡ÎµÎ¸ÎµÎ¯ Î±Ï…Ï„ÏŒ Ï„Î¿ Ï€ÏÏŒÏ„Ï…Ï€Î¿, Ï„Î¿ CloudFormation ÎµÎ¯Î½Î±Î¹ Ï…Ï€ÎµÏÎ¸Ï…Î½Î¿ Î³Î¹Î± Ï„Î·Î½ **Ï€Î±ÏÎ¿Ï‡Î® ÎºÎ±Î¹ ÏÏÎ¸Î¼Î¹ÏƒÎ·** Ï„Ï‰Î½ ÎºÎ±Î¸Î¿ÏÎ¹ÏƒÎ¼Î­Î½Ï‰Î½ Ï€ÏŒÏÏ‰Î½. Î‘Ï…Ï„Î® Î· Î±Ï…Ï„Î¿Î¼Î±Ï„Î¿Ï€Î¿Î¯Î·ÏƒÎ· Î´Î¹ÎµÏ…ÎºÎ¿Î»ÏÎ½ÎµÎ¹ Î¼Î¹Î± Ï€Î¹Î¿ Î±Ï€Î¿Ï„ÎµÎ»ÎµÏƒÎ¼Î±Ï„Î¹ÎºÎ® ÎºÎ±Î¹ Ï‡Ï‰ÏÎ¯Ï‚ ÏƒÏ†Î¬Î»Î¼Î±Ï„Î± Î´Î¹Î±Ï‡ÎµÎ¯ÏÎ¹ÏƒÎ· Ï„Î·Ï‚ Ï…Ï€Î¿Î´Î¿Î¼Î®Ï‚ AWS.

### Enumeration
```bash
# Stacks
aws cloudformation list-stacks
aws cloudformation describe-stacks # You could find sensitive information here
aws cloudformation list-stack-resources --stack-name <name>

## Show params and outputs
aws cloudformation describe-stacks | jq ".Stacks[] | .StackId, .StackName, .Parameters, .Outputs"

# Export
aws cloudformation list-exports
aws cloudformation list-imports --export-name <x_name>

# Stack Sets
aws cloudformation list-stack-sets
aws cloudformation describe-stack-set --stack-set-name <name>
aws cloudformation list-stack-instances --stack-set-name <name>
aws cloudformation list-stack-set-operations --stack-set-name <name>
aws cloudformation list-stack-set-operation-results --stack-set-name <name> --operation-id <id>
```
### Privesc

In the following page you can check how to **abuse cloudformation permissions to escalate privileges**:

{% content-ref url="../aws-privilege-escalation/aws-cloudformation-privesc/" %}
[aws-cloudformation-privesc](../aws-privilege-escalation/aws-cloudformation-privesc/)
{% endcontent-ref %}

### Post-Exploitation

Check for **secrets** or sensitive information in the **template, parameters & output** of each CloudFormation

## Codestar

AWS CodeStar ÎµÎ¯Î½Î±Î¹ Î¼Î¹Î± Ï…Ï€Î·ÏÎµÏƒÎ¯Î± Î³Î¹Î± Ï„Î· Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î±, Î´Î¹Î±Ï‡ÎµÎ¯ÏÎ¹ÏƒÎ· ÎºÎ±Î¹ ÎµÏÎ³Î±ÏƒÎ¯Î± Î¼Îµ Î­ÏÎ³Î± Î±Î½Î¬Ï€Ï„Ï…Î¾Î·Ï‚ Î»Î¿Î³Î¹ÏƒÎ¼Î¹ÎºÎ¿Ï ÏƒÏ„Î¿ AWS. ÎœÏ€Î¿ÏÎµÎ¯Ï„Îµ Î³ÏÎ®Î³Î¿ÏÎ± Î½Î± Î±Î½Î±Ï€Ï„ÏÎ¾ÎµÏ„Îµ, ÎºÎ±Ï„Î±ÏƒÎºÎµÏ…Î¬ÏƒÎµÏ„Îµ ÎºÎ±Î¹ Î±Î½Î±Ï€Ï„ÏÎ¾ÎµÏ„Îµ ÎµÏ†Î±ÏÎ¼Î¿Î³Î­Ï‚ ÏƒÏ„Î¿ AWS Î¼Îµ Î­Î½Î± Î­ÏÎ³Î¿ AWS CodeStar. ÎˆÎ½Î± Î­ÏÎ³Î¿ AWS CodeStar Î´Î·Î¼Î¹Î¿Ï…ÏÎ³ÎµÎ¯ ÎºÎ±Î¹ **ÎµÎ½ÏƒÏ‰Î¼Î±Ï„ÏÎ½ÎµÎ¹ Ï„Î¹Ï‚ Ï…Ï€Î·ÏÎµÏƒÎ¯ÎµÏ‚ AWS** Î³Î¹Î± Ï„Î·Î½ Î±Î»Ï…ÏƒÎ¯Î´Î± ÎµÏÎ³Î±Î»ÎµÎ¯Ï‰Î½ Î±Î½Î¬Ï€Ï„Ï…Î¾Î·Ï‚ Ï„Î¿Ï… Î­ÏÎ³Î¿Ï… ÏƒÎ±Ï‚. Î‘Î½Î¬Î»Î¿Î³Î± Î¼Îµ Ï„Î·Î½ ÎµÏ€Î¹Î»Î¿Î³Î® ÏƒÎ±Ï‚ Î³Î¹Î± Ï„Î¿ Ï€ÏÏŒÏ„Ï…Ï€Î¿ Î­ÏÎ³Î¿Ï… AWS CodeStar, Î±Ï…Ï„Î® Î· Î±Î»Ï…ÏƒÎ¯Î´Î± ÎµÏÎ³Î±Î»ÎµÎ¯Ï‰Î½ Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Ï€ÎµÏÎ¹Î»Î±Î¼Î²Î¬Î½ÎµÎ¹ Î­Î»ÎµÎ³Ï‡Î¿ Ï€Î·Î³Î®Ï‚, ÎºÎ±Ï„Î±ÏƒÎºÎµÏ…Î®, Î±Î½Î¬Ï€Ï„Ï…Î¾Î·, ÎµÎ¹ÎºÎ¿Î½Î¹ÎºÎ¿ÏÏ‚ Î´Î¹Î±ÎºÎ¿Î¼Î¹ÏƒÏ„Î­Ï‚ Î® Ï€ÏŒÏÎ¿Ï…Ï‚ Ï‡Ï‰ÏÎ¯Ï‚ Î´Î¹Î±ÎºÎ¿Î¼Î¹ÏƒÏ„Î­Ï‚, ÎºÎ±Î¹ Î¬Î»Î»Î±. Î¤Î¿ AWS CodeStar ÎµÏ€Î¯ÏƒÎ·Ï‚ **Î´Î¹Î±Ï‡ÎµÎ¹ÏÎ¯Î¶ÎµÏ„Î±Î¹ Ï„Î¹Ï‚ Î¬Î´ÎµÎ¹ÎµÏ‚ Ï€Î¿Ï… Î±Ï€Î±Î¹Ï„Î¿ÏÎ½Ï„Î±Î¹ Î³Î¹Î± Ï„Î¿Ï…Ï‚ Ï‡ÏÎ®ÏƒÏ„ÎµÏ‚ Ï„Î¿Ï… Î­ÏÎ³Î¿Ï…** (Ï€Î¿Ï… Î¿Î½Î¿Î¼Î¬Î¶Î¿Î½Ï„Î±Î¹ Î¼Î­Î»Î· Ï„Î·Ï‚ Î¿Î¼Î¬Î´Î±Ï‚).

### Enumeration
```bash
# Get projects information
aws codestar list-projects
aws codestar describe-project --id <project_id>
aws codestar list-resources --project-id <project_id>
aws codestar list-team-members --project-id <project_id>

aws codestar list-user-profiles
aws codestar describe-user-profile --user-arn <arn>
```
### Privesc

Î£Ï„Î·Î½ ÎµÏ€ÏŒÎ¼ÎµÎ½Î· ÏƒÎµÎ»Î¯Î´Î± Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± ÎµÎ»Î­Î³Î¾ÎµÏ„Îµ Ï€ÏÏ‚ Î½Î± **ÎºÎ±Ï„Î±Ï‡ÏÎ±ÏƒÏ„ÎµÎ¯Ï„Îµ Ï„Î¹Ï‚ Î¬Î´ÎµÎ¹ÎµÏ‚ Ï„Î¿Ï… codestar Î³Î¹Î± Î½Î± ÎºÎ»Î¹Î¼Î±ÎºÏÏƒÎµÏ„Îµ Ï„Î± Ï€ÏÎ¿Î½ÏŒÎ¼Î¹Î±**:

{% content-ref url="../aws-privilege-escalation/aws-codestar-privesc/" %}
[aws-codestar-privesc](../aws-privilege-escalation/aws-codestar-privesc/)
{% endcontent-ref %}

## References

* [https://docs.aws.amazon.com/cloudformation/](https://docs.aws.amazon.com/cloudformation/)

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
