# AWS - Firewall Manager Enum

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** 游눫 [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** 游냕 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Firewall Manager

**AWS Firewall Manager** simplifica la gesti칩n y el mantenimiento de **AWS WAF, AWS Shield Advanced, grupos de seguridad de Amazon VPC y Listas de Control de Acceso (ACLs), y AWS Network Firewall, AWS Route 53 Resolver DNS Firewall y cortafuegos de terceros** a trav칠s de m칰ltiples cuentas y recursos. Te permite configurar tus reglas de cortafuegos, protecciones de Shield Advanced, grupos de seguridad de VPC y configuraciones de Network Firewall una sola vez, con el servicio **aplicando autom치ticamente estas reglas y protecciones en tus cuentas y recursos**, incluidos los reci칠n a침adidos.

El servicio ofrece la capacidad de **agrupar y proteger recursos espec칤ficos juntos**, como aquellos que comparten una etiqueta com칰n o todas tus distribuciones de CloudFront. Una ventaja significativa de Firewall Manager es su capacidad para **extender autom치ticamente la protecci칩n a los recursos reci칠n a침adidos** en tu cuenta.

Un **grupo de reglas** (una colecci칩n de reglas de WAF) puede ser incorporado en una Pol칤tica de AWS Firewall Manager, que luego se vincula a recursos espec칤ficos de AWS como distribuciones de CloudFront o balanceadores de carga de aplicaciones.

AWS Firewall Manager proporciona **listas de aplicaciones y protocolos gestionadas** para simplificar la configuraci칩n y gesti칩n de pol칤ticas de grupos de seguridad. Estas listas te permiten definir los protocolos y aplicaciones permitidos o denegados por tus pol칤ticas. Hay dos tipos de listas gestionadas:

* **Listas gestionadas por Firewall Manager**: Estas listas incluyen **FMS-Default-Public-Access-Apps-Allowed**, **FMS-Default-Protocols-Allowed** y **FMS-Default-Protocols-Allowed**. Son gestionadas por Firewall Manager e incluyen aplicaciones y protocolos com칰nmente utilizados que deben ser permitidos o denegados al p칰blico en general. No es posible editarlas o eliminarlas, sin embargo, puedes elegir su versi칩n.
* **Listas gestionadas personalizadas**: T칰 gestionas estas listas t칰 mismo. Puedes crear listas de aplicaciones y protocolos personalizadas adaptadas a las necesidades de tu organizaci칩n. A diferencia de las listas gestionadas por Firewall Manager, estas listas no tienen versiones, pero tienes control total sobre las listas personalizadas, lo que te permite crear, editar y eliminarlas seg칰n sea necesario.

Es importante se침alar que **las pol칤ticas de Firewall Manager permiten solo acciones de "Bloquear" o "Contar"** para un grupo de reglas, sin una opci칩n de "Permitir".

### Prerequisites

Los siguientes pasos previos deben completarse antes de proceder a configurar Firewall Manager para comenzar a proteger efectivamente los recursos de tu organizaci칩n. Estos pasos proporcionan la configuraci칩n b치sica necesaria para que Firewall Manager aplique pol칤ticas de seguridad y garantice el cumplimiento en tu entorno de AWS:

1. **칔nete y configura AWS Organizations:** Aseg칰rate de que tu cuenta de AWS sea parte de la organizaci칩n de AWS Organizations donde se planea implementar las pol칤ticas de AWS Firewall Manager. Esto permite la gesti칩n centralizada de recursos y pol칤ticas a trav칠s de m칰ltiples cuentas de AWS dentro de la organizaci칩n.
2. **Crea una Cuenta de Administrador Predeterminada de AWS Firewall Manager:** Establece una cuenta de administrador predeterminada espec칤ficamente para gestionar las pol칤ticas de seguridad de Firewall Manager. Esta cuenta ser치 responsable de configurar y aplicar pol칤ticas de seguridad en toda la organizaci칩n. Solo la cuenta de gesti칩n de la organizaci칩n puede crear cuentas de administrador predeterminadas de Firewall Manager.
3. **Habilita AWS Config:** Activa AWS Config para proporcionar a Firewall Manager los datos de configuraci칩n e informaci칩n necesarios para aplicar efectivamente las pol칤ticas de seguridad. AWS Config ayuda a analizar, auditar, monitorear y auditar configuraciones de recursos y cambios, facilitando una mejor gesti칩n de la seguridad.
4. **Para Pol칤ticas de Terceros, Suscr칤bete en el AWS Marketplace y Configura Configuraciones de Terceros:** Si planeas utilizar pol칤ticas de cortafuegos de terceros, suscr칤bete a ellas en el AWS Marketplace y configura las configuraciones necesarias. Este paso asegura que Firewall Manager pueda integrar y aplicar pol칤ticas de proveedores de terceros de confianza.
5. **Para Pol칤ticas de Network Firewall y DNS Firewall, habilita el uso compartido de recursos:** Habilita el uso compartido de recursos espec칤ficamente para pol칤ticas de Network Firewall y DNS Firewall. Esto permite que Firewall Manager aplique protecciones de cortafuegos a tus VPCs y resoluci칩n DNS de la organizaci칩n, mejorando la seguridad de la red.
6. **Para usar AWS Firewall Manager en Regiones que est치n deshabilitadas por defecto:** Si tienes la intenci칩n de usar Firewall Manager en regiones de AWS que est치n deshabilitadas por defecto, aseg칰rate de tomar los pasos necesarios para habilitar su funcionalidad en esas regiones. Esto asegura una aplicaci칩n consistente de la seguridad en todas las regiones donde opera tu organizaci칩n.

Para m치s informaci칩n, consulta: [Getting started with AWS Firewall Manager AWS WAF policies](https://docs.aws.amazon.com/waf/latest/developerguide/getting-started-fms.html).

### Types of protection policies

AWS Firewall Manager gestiona varios tipos de pol칤ticas para aplicar controles de seguridad en diferentes aspectos de la infraestructura de tu organizaci칩n:

1. **Pol칤tica de AWS WAF:** Este tipo de pol칤tica admite tanto AWS WAF como AWS WAF Classic. Puedes definir qu칠 recursos est치n protegidos por la pol칤tica. Para las pol칤ticas de AWS WAF, puedes especificar conjuntos de grupos de reglas para ejecutarse primero y al final en el ACL web. Adem치s, los propietarios de cuentas pueden agregar reglas y grupos de reglas para ejecutarse entre estos conjuntos.
2. **Pol칤tica de Shield Advanced:** Esta pol칤tica aplica protecciones de Shield Advanced en toda tu organizaci칩n para tipos de recursos especificados. Ayuda a proteger contra ataques DDoS y otras amenazas.
3. **Pol칤tica de Grupo de Seguridad de Amazon VPC:** Con esta pol칤tica, puedes gestionar grupos de seguridad utilizados en toda tu organizaci칩n, aplicando un conjunto b치sico de reglas en tu entorno de AWS para controlar el acceso a la red.
4. **Pol칤tica de Lista de Control de Acceso (ACL) de Amazon VPC:** Este tipo de pol칤tica te da control sobre las ACLs de red utilizadas en tu organizaci칩n, permiti칠ndote aplicar un conjunto b치sico de ACLs de red en tu entorno de AWS.
5. **Pol칤tica de Network Firewall:** Esta pol칤tica aplica protecci칩n de AWS Network Firewall a las VPCs de tu organizaci칩n, mejorando la seguridad de la red al filtrar el tr치fico seg칰n reglas predefinidas.
6. **Pol칤tica de DNS Firewall de Amazon Route 53 Resolver:** Esta pol칤tica aplica protecciones de DNS Firewall a las VPCs de tu organizaci칩n, ayudando a bloquear intentos de resoluci칩n de dominios maliciosos y aplicar pol칤ticas de seguridad para el tr치fico DNS.
7. **Pol칤tica de Cortafuegos de Terceros:** Este tipo de pol칤tica aplica protecciones de cortafuegos de terceros, que est치n disponibles por suscripci칩n a trav칠s de la consola de AWS Marketplace. Permite integrar medidas de seguridad adicionales de proveedores de confianza en tu entorno de AWS.
1. **Pol칤tica de Palo Alto Networks Cloud NGFW:** Esta pol칤tica aplica protecciones y conjuntos de reglas del Cortafuegos de Nueva Generaci칩n (NGFW) de Palo Alto Networks a las VPCs de tu organizaci칩n, proporcionando prevenci칩n avanzada de amenazas y controles de seguridad a nivel de aplicaci칩n.
2. **Pol칤tica de Fortigate Cloud Native Firewall (CNF) como Servicio:** Esta pol칤tica aplica protecciones del Cortafuegos Nativo en la Nube (CNF) de Fortigate como Servicio, ofreciendo prevenci칩n de amenazas l칤der en la industria, cortafuegos de aplicaciones web (WAF) y protecci칩n de API adaptada para infraestructuras en la nube.

### Administrator accounts

AWS Firewall Manager ofrece flexibilidad en la gesti칩n de recursos de cortafuegos dentro de tu organizaci칩n a trav칠s de su alcance administrativo y dos tipos de cuentas de administrador.

**El alcance administrativo define los recursos que un administrador de Firewall Manager puede gestionar**. Despu칠s de que una cuenta de gesti칩n de AWS Organizations incorpora una organizaci칩n a Firewall Manager, puede crear administradores adicionales con diferentes alcances administrativos. Estos alcances pueden incluir:

* Cuentas o unidades organizativas (OUs) a las que el administrador puede aplicar pol칤ticas.
* Regiones donde el administrador puede realizar acciones.
* Tipos de pol칤ticas de Firewall Manager que el administrador puede gestionar.

El alcance administrativo puede ser **completo o restringido**. El alcance completo otorga al administrador acceso a **todos los tipos de recursos, regiones y tipos de pol칤ticas especificados**. En contraste, **el alcance restringido proporciona permiso administrativo solo a un subconjunto de recursos, regiones o tipos de pol칤ticas**. Se recomienda otorgar a los administradores solo los permisos que necesitan para cumplir efectivamente con sus roles. Puedes aplicar cualquier combinaci칩n de estas condiciones de alcance administrativo a un administrador, asegurando la adherencia al principio de menor privilegio.

Hay dos tipos distintos de cuentas de administrador, cada una con roles y responsabilidades espec칤ficas:

* **Administrador Predeterminado:**
* La cuenta de administrador predeterminada es creada por la cuenta de gesti칩n de la organizaci칩n de AWS Organizations durante el proceso de incorporaci칩n a Firewall Manager.
* Esta cuenta tiene la capacidad de gestionar cortafuegos de terceros y posee un alcance administrativo completo.
* Sirve como la cuenta de administrador principal para Firewall Manager, responsable de configurar y aplicar pol칤ticas de seguridad en toda la organizaci칩n.
* Aunque el administrador predeterminado tiene acceso completo a todos los tipos de recursos y funcionalidades administrativas, opera al mismo nivel de pares que otros administradores si se utilizan m칰ltiples administradores dentro de la organizaci칩n.
* **Administradores de Firewall Manager:**
* Estos administradores pueden gestionar recursos dentro del alcance designado por la cuenta de gesti칩n de AWS Organizations, seg칰n lo definido por la configuraci칩n del alcance administrativo.
* Los administradores de Firewall Manager son creados para cumplir roles espec칤ficos dentro de la organizaci칩n, permitiendo la delegaci칩n de responsabilidades mientras se mantienen est치ndares de seguridad y cumplimiento.
* Al ser creados, Firewall Manager verifica con AWS Organizations para determinar si la cuenta ya es un administrador delegado. Si no, Firewall Manager llama a Organizations para designar la cuenta como un administrador delegado para Firewall Manager.

Gestionar estas cuentas de administrador implica crearlas dentro de Firewall Manager y definir sus alcances administrativos de acuerdo con los requisitos de seguridad de la organizaci칩n y el principio de menor privilegio. Al asignar roles administrativos apropiados, las organizaciones pueden asegurar una gesti칩n de seguridad efectiva mientras mantienen un control granular sobre el acceso a recursos sensibles.

Es importante destacar que **solo una cuenta dentro de una organizaci칩n puede servir como el administrador predeterminado de Firewall Manager**, adhiri칠ndose al principio de "**el primero en entrar, el 칰ltimo en salir**". Para designar un nuevo administrador predeterminado, se deben seguir una serie de pasos:

* Primero, cada cuenta de administrador de Firewall debe revocar su propia cuenta.
* Luego, el administrador predeterminado existente puede revocar su propia cuenta, efectivamente desvinculando a la organizaci칩n de Firewall Manager. Este proceso resulta en la eliminaci칩n de todas las pol칤ticas de Firewall Manager creadas por la cuenta revocada.
* Para concluir, la cuenta de gesti칩n de AWS Organizations debe designar al administrador predeterminado de Firewall Manager.

## Enumeration
```
# Users/Administrators

## Get the AWS Organizations account that is associated with AWS Firewall Manager as the AWS Firewall Manager default administrator
aws fms get-admin-account

## List of Firewall Manager administrators within the organization
aws fms list-admin-accounts-for-organization # ReadOnlyAccess policy is not enough for this

## Return a list of the member accounts in the FM administrator's AWS organization
aws fms list-member-accounts # Only a Firewall Manager administrator or the Organization's management account can make this request

## List the accounts that are managing the specified AWS Organizations member account
aws fms list-admins-managing-account # ReadOnlyAccess policy is not enough for this

# Resources

## Get the resources that a Firewall Manager administrator can manage
aws fms get-admin-scope --admin-account <value> # ReadOnlyAccess policy is not enough for this

## Returns the summary of the resource sets used
aws fms list-resource-sets # ReadOnlyAccess policy is not enough for this

## Get information about a specific resource set
aws fms get-resource-set --identifier <value>  # ReadOnlyAccess policy is not enough for this

## Retrieve the list of tags for a given resource
aws fms list-tags-for-resource --resource-arn <value>

## List of the resources in the AWS Organization's accounts that are available to be associated with a FM resource set. Only one account is supported per request.
aws fms list-compliance-status --member-account-ids <value> --resource-type <value> # ReadOnlyAccess policy is not enough for this

## List the resources that are currently associated to a resource set
aws fms list-resource-set-resources --identifier <value> # ReadOnlyAccess policy is not enough for this

# Policies

## Returns the list of policies
aws fms list-policies

## Get information about the specified AWS Firewall Manager policy
aws fms get-policy --policy-id <value>

## List all of the third-party firewall policies that are associated with the third-party firewall administrator's account
aws fms list-third-party-firewall-firewall-policies --third-party-firewall <PALO_ALTO_NETWORKS_CLOUD_NGFW|FORTIGATE_CLOUD_NATIVE_FIREWALL> # ReadOnlyAccess policy is not enough for this

# AppsList

## Return a list of apps list
aws fms list-apps-lists --max-results [1-100]

## Get information about the specified AWS Firewall Manager applications list
aws fms get-apps-list --list-id <value>

# Protocols

## Get the details of the Firewall Manager protocols list.
aws fms list-protocols-lists

## Get information about the specified AWS Firewall Manager Protocols list
aws fms get-protocols-list --list-id <value>

# Compliance

## Return a summary of which member accounts are protected by the specified policy
aws fms list-compliance-status --policy-id <policy-id>

## Get detailed compliance information about the specified member account (resources that are in and out of compliance with the specified policy)
aws fms get-compliance-detail --policy-id <value> --member-account <value>

# Other useful info

## Get information about the SNS topic that is used to record AWS Firewall Manager SNS logs (if any)
aws fms get-notification-channel

## Get policy-level attack summary information in the event of a potential DDoS attack
aws fms get-protection-status --policy-id <value> # Just for Shield Advanced policy

## Get the onboarding status of a Firewall Manager admin account to third-party firewall vendor tenant.
aws fms get-third-party-firewall-association-status --third-party-firewall <PALO_ALTO_NETWORKS_CLOUD_NGFW|FORTIGATE_CLOUD_NATIVE_FIREWALL> # ReadOnlyAccess policy is not enough for this

## Get violations' details for a resource based on the specified AWS Firewall Manager policy and AWS account.
aws fms get-violation-details --policy-id <value> --member-account <value> --resource-id <value> --resource-type <value>
```
## Post Explotaci칩n / Bypass Detecci칩n

### `organizations:DescribeOrganization` & (`fms:AssociateAdminAccount`, `fms:DisassociateAdminAccount`, `fms:PutAdminAccount`)

Un atacante con el permiso **`fms:AssociateAdminAccount`** podr칤a establecer la cuenta de administrador predeterminada del Firewall Manager. Con el permiso **`fms:PutAdminAccount`**, un atacante podr칤a crear o actualizar una cuenta de administrador del Firewall Manager y con el permiso **`fms:DisassociateAdminAccount`**, un posible atacante podr칤a eliminar la asociaci칩n de la cuenta de administrador actual del Firewall Manager.

* La disociaci칩n del **administrador predeterminado del Firewall Manager sigue la pol칤tica de primero en entrar, 칰ltimo en salir**. Todos los administradores del Firewall Manager deben disociarse antes de que el administrador predeterminado del Firewall Manager pueda disociar la cuenta.
* Para crear un administrador del Firewall Manager mediante **PutAdminAccount**, la cuenta debe pertenecer a la organizaci칩n que fue previamente incorporada al Firewall Manager utilizando **AssociateAdminAccount**.
* La creaci칩n de una cuenta de administrador del Firewall Manager solo puede ser realizada por la cuenta de gesti칩n de la organizaci칩n.
```bash
aws fms associate-admin-account --admin-account <value>
aws fms disassociate-admin-account
aws fms put-admin-account --admin-account <value>
```
**Impacto Potencial:** P칠rdida de gesti칩n centralizada, evasi칩n de pol칤ticas, violaciones de cumplimiento y interrupci칩n de controles de seguridad dentro del entorno.

### `fms:PutPolicy`, `fms:DeletePolicy`

Un atacante con los permisos **`fms:PutPolicy`**, **`fms:DeletePolicy`** podr칤a crear, modificar o eliminar permanentemente una pol칤tica de AWS Firewall Manager.
```bash
aws fms put-policy --policy <value> | --cli-input-json file://<policy.json> [--tag-list <value>]
aws fms delete-policy --policy-id <value> [--delete-all-policy-resources | --no-delete-all-policy-resources]
```
Un ejemplo de pol칤tica permisiva a trav칠s de un grupo de seguridad permisivo, con el fin de eludir la detecci칩n, podr칤a ser el siguiente:
```json
{
"Policy": {
"PolicyName": "permisive_policy",
"SecurityServicePolicyData": {
"Type": "SECURITY_GROUPS_COMMON",
"ManagedServiceData": "{\"type\":\"SECURITY_GROUPS_COMMON\",\"securityGroups\":[{\"id\":\"<permisive_security_group_id>\"}], \"applyToAllEC2InstanceENIs\":\"true\",\"IncludeSharedVPC\":\"true\"}"
},
"ResourceTypeList": ["AWS::EC2::Instance", "AWS::EC2::NetworkInterface", "AWS::EC2::SecurityGroup", "AWS::ElasticLoadBalancingV2::LoadBalancer", "AWS::ElasticLoadBalancing::LoadBalancer"],
"ResourceType": "AWS::EC2::SecurityGroup",
"ExcludeResourceTags": false,
"ResourceTags": [],
"RemediationEnabled": true
},
"TagList": []
}
```
**Impacto Potencial:** Desmantelamiento de controles de seguridad, evasi칩n de pol칤ticas, violaciones de cumplimiento, interrupciones operativas y posibles filtraciones de datos dentro del entorno.

### `fms:BatchAssociateResource`, `fms:BatchDisassociateResource`, `fms:PutResourceSet`, `fms:DeleteResourceSet`

Un atacante con los permisos **`fms:BatchAssociateResource`** y **`fms:BatchDisassociateResource`** podr칤a asociar o desasociar recursos de un conjunto de recursos de Firewall Manager, respectivamente. Adem치s, los permisos **`fms:PutResourceSet`** y **`fms:DeleteResourceSet`** permitir칤an a un atacante crear, modificar o eliminar estos conjuntos de recursos de AWS Firewall Manager.
```bash
# Associate/Disassociate resources from a resource set
aws fms batch-associate-resource --resource-set-identifier <value> --items <value>
aws fms batch-disassociate-resource --resource-set-identifier <value> --items <value>

# Create, modify or delete a resource set
aws fms put-resource-set --resource-set <value> [--tag-list <value>]
aws fms delete-resource-set --identifier <value>
```
**Impacto Potencial:** La adici칩n de una cantidad innecesaria de elementos a un conjunto de recursos aumentar치 el nivel de ruido en el Servicio, lo que podr칤a causar un DoS. Adem치s, los cambios en los conjuntos de recursos podr칤an llevar a una interrupci칩n de recursos, evasi칩n de pol칤ticas, violaciones de cumplimiento y interrupci칩n de controles de seguridad dentro del entorno.

### `fms:PutAppsList`, `fms:DeleteAppsList`

Un atacante con los permisos **`fms:PutAppsList`** y **`fms:DeleteAppsList`** podr칤a crear, modificar o eliminar listas de aplicaciones de AWS Firewall Manager. Esto podr칤a ser cr칤tico, ya que se podr칤a permitir el acceso a aplicaciones no autorizadas al p칰blico en general, o se podr칤a denegar el acceso a aplicaciones autorizadas, causando un DoS.
```bash
aws fms put-apps-list --apps-list <value> [--tag-list <value>]
aws fms delete-apps-list --list-id <value>
```
**Impacto Potencial:** Esto podr칤a resultar en configuraciones incorrectas, evasi칩n de pol칤ticas, violaciones de cumplimiento y interrupci칩n de controles de seguridad dentro del entorno.

### `fms:PutProtocolsList`, `fms:DeleteProtocolsList`

Un atacante con los permisos **`fms:PutProtocolsList`** y **`fms:DeleteProtocolsList`** podr칤a crear, modificar o eliminar listas de protocolos de AWS Firewall Manager. De manera similar a las listas de aplicaciones, esto podr칤a ser cr칤tico ya que protocolos no autorizados podr칤an ser utilizados por el p칰blico en general, o el uso de protocolos autorizados podr칤a ser denegado, causando un DoS.
```bash
aws fms put-protocols-list --apps-list <value> [--tag-list <value>]
aws fms delete-protocols-list --list-id <value>
```
**Impacto Potencial:** Esto podr칤a resultar en configuraciones incorrectas, evasi칩n de pol칤ticas, violaciones de cumplimiento y interrupci칩n de controles de seguridad dentro del entorno.

### `fms:PutNotificationChannel`, `fms:DeleteNotificationChannel`

Un atacante con los permisos **`fms:PutNotificationChannel`** y **`fms:DeleteNotificationChannel`** podr칤a eliminar y designar el rol de IAM y el tema de Amazon Simple Notification Service (SNS) que Firewall Manager utiliza para registrar los logs de SNS.

Para usar **`fms:PutNotificationChannel`** fuera de la consola, necesitas configurar la pol칤tica de acceso del tema SNS, permitiendo que el **SnsRoleName** especificado publique logs de SNS. Si el **SnsRoleName** proporcionado es un rol diferente al **`AWSServiceRoleForFMS`**, requiere una relaci칩n de confianza configurada para permitir que el principal de servicio de Firewall Manager **fms.amazonaws.com** asuma este rol.

Para obtener informaci칩n sobre c칩mo configurar una pol칤tica de acceso de SNS:

{% content-ref url="../aws-services/aws-sns-enum.md" %}
[aws-sns-enum.md](../aws-services/aws-sns-enum.md)
{% endcontent-ref %}
```bash
aws fms put-notification-channel --sns-topic-arn <value> --sns-role-name <value>
aws fms delete-notification-channel
```
**Impacto Potencial:** Esto podr칤a llevar potencialmente a perder alertas de seguridad, retrasar la respuesta a incidentes, posibles filtraciones de datos y interrupciones operativas dentro del entorno.

### `fms:AssociateThirdPartyFirewall`, `fms:DisssociateThirdPartyFirewall`

Un atacante con los permisos **`fms:AssociateThirdPartyFirewall`**, **`fms:DisssociateThirdPartyFirewall`** podr칤a asociar o desasociar cortafuegos de terceros para ser gestionados centralmente a trav칠s de AWS Firewall Manager.

{% hint style="warning" %}
Solo el administrador predeterminado puede crear y gestionar cortafuegos de terceros.
{% endhint %}
```bash
aws fms associate-third-party-firewall --third-party-firewall [PALO_ALTO_NETWORKS_CLOUD_NGFW | FORTIGATE_CLOUD_NATIVE_FIREWALL]
aws fms disassociate-third-party-firewall --third-party-firewall [PALO_ALTO_NETWORKS_CLOUD_NGFW | FORTIGATE_CLOUD_NATIVE_FIREWALL]
```
**Impacto Potencial:** La disociaci칩n llevar칤a a una evasi칩n de pol칤ticas, violaciones de cumplimiento y interrupci칩n de controles de seguridad dentro del entorno. La asociaci칩n, por otro lado, llevar칤a a una interrupci칩n de la asignaci칩n de costos y presupuesto.

### `fms:TagResource`, `fms:UntagResource`

Un atacante podr칤a agregar, modificar o eliminar etiquetas de los recursos de Firewall Manager, interrumpiendo la asignaci칩n de costos de su organizaci칩n, el seguimiento de recursos y las pol칤ticas de control de acceso basadas en etiquetas.
```bash
aws fms tag-resource --resource-arn <value> --tag-list <value>
aws fms untag-resource --resource-arn <value> --tag-keys <value>
```
**Impacto Potencial**: Disrupci칩n de la asignaci칩n de costos, seguimiento de recursos y pol칤ticas de control de acceso basadas en etiquetas.

## Referencias

* [https://docs.aws.amazon.com/govcloud-us/latest/UserGuide/govcloud-fms.html](https://docs.aws.amazon.com/govcloud-us/latest/UserGuide/govcloud-fms.html)
* [https://docs.aws.amazon.com/service-authorization/latest/reference/list\_awsfirewallmanager.html](https://docs.aws.amazon.com/service-authorization/latest/reference/list\_awsfirewallmanager.html)
* [https://docs.aws.amazon.com/waf/latest/developerguide/fms-chapter.html](https://docs.aws.amazon.com/waf/latest/developerguide/fms-chapter.html)

{% hint style="success" %}
Aprende y practica Hacking en AWS:<img src="../../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Aprende y practica Hacking en GCP: <img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Apoya a HackTricks</summary>

* Revisa los [**planes de suscripci칩n**](https://github.com/sponsors/carlospolop)!
* **칔nete al** 游눫 [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s칤guenos** en **Twitter** 游냕 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Comparte trucos de hacking enviando PRs a los** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repositorios de github.

</details>
{% endhint %}
