# AWS - Firewall Manager Enum

{% hint style="success" %}
Lernen & √ºben Sie AWS Hacking:<img src="../../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">\
Lernen & √ºben Sie GCP Hacking: <img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* √úberpr√ºfen Sie die [**Abonnementpl√§ne**](https://github.com/sponsors/carlospolop)!
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teilen Sie Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repos senden.

</details>
{% endhint %}

## Firewall Manager

**AWS Firewall Manager** vereinfacht die Verwaltung und Wartung von **AWS WAF, AWS Shield Advanced, Amazon VPC-Sicherheitsgruppen und Netzwerkzugriffskontrolllisten (ACLs), sowie AWS Network Firewall, AWS Route 53 Resolver DNS Firewall und Drittanbieter-Firewalls** √ºber mehrere Konten und Ressourcen hinweg. Es erm√∂glicht Ihnen, Ihre Firewall-Regeln, Shield Advanced-Schutzma√ünahmen, VPC-Sicherheitsgruppen und Network Firewall-Einstellungen nur einmal zu konfigurieren, wobei der Dienst **diese Regeln und Schutzma√ünahmen automatisch √ºber Ihre Konten und Ressourcen durchsetzt**, einschlie√ülich neu hinzugef√ºgter.

Der Dienst bietet die M√∂glichkeit, **bestimmte Ressourcen zusammenzufassen und zu sch√ºtzen**, wie z.B. solche, die ein gemeinsames Tag teilen oder alle Ihre CloudFront-Distributionen. Ein wesentlicher Vorteil des Firewall Managers ist seine F√§higkeit, **den Schutz automatisch auf neu hinzugef√ºgte Ressourcen** in Ihrem Konto auszudehnen.

Eine **Regelgruppe** (eine Sammlung von WAF-Regeln) kann in eine AWS Firewall Manager-Richtlinie integriert werden, die dann mit bestimmten AWS-Ressourcen wie CloudFront-Distributionen oder Anwendungs-Load-Balancern verkn√ºpft ist.

AWS Firewall Manager bietet **verwaltete Anwendungs- und Protokolllisten**, um die Konfiguration und Verwaltung von Sicherheitsgruppenrichtlinien zu vereinfachen. Diese Listen erm√∂glichen es Ihnen, die von Ihren Richtlinien erlaubten oder abgelehnten Protokolle und Anwendungen zu definieren. Es gibt zwei Arten von verwalteten Listen:

* **Von Firewall Manager verwaltete Listen**: Diese Listen umfassen **FMS-Default-Public-Access-Apps-Allowed**, **FMS-Default-Protocols-Allowed** und **FMS-Default-Protocols-Allowed**. Sie werden von Firewall Manager verwaltet und enthalten h√§ufig verwendete Anwendungen und Protokolle, die der allgemeinen √ñffentlichkeit erlaubt oder verweigert werden sollten. Es ist nicht m√∂glich, sie zu bearbeiten oder zu l√∂schen, jedoch k√∂nnen Sie ihre Version ausw√§hlen.
* **Benutzerdefinierte verwaltete Listen**: Diese Listen verwalten Sie selbst. Sie k√∂nnen benutzerdefinierte Anwendungs- und Protokolllisten erstellen, die auf die Bed√ºrfnisse Ihrer Organisation zugeschnitten sind. Im Gegensatz zu von Firewall Manager verwalteten Listen haben diese Listen keine Versionen, aber Sie haben die volle Kontrolle √ºber benutzerdefinierte Listen, sodass Sie sie nach Bedarf erstellen, bearbeiten und l√∂schen k√∂nnen.

Es ist wichtig zu beachten, dass **Firewall Manager-Richtlinien nur "Block"- oder "Z√§hlen"-Aktionen** f√ºr eine Regelgruppe zulassen, ohne eine "Erlauben"-Option.

### Voraussetzungen

Die folgenden Voraussetzungen m√ºssen erf√ºllt sein, bevor Sie mit der Konfiguration des Firewall Managers fortfahren, um die Ressourcen Ihrer Organisation effektiv zu sch√ºtzen. Diese Schritte bieten die grundlegende Einrichtung, die erforderlich ist, damit der Firewall Manager Sicherheitsrichtlinien durchsetzen und die Einhaltung in Ihrer AWS-Umgebung sicherstellen kann:

1. **Treten Sie AWS Organizations bei und konfigurieren Sie es:** Stellen Sie sicher, dass Ihr AWS-Konto Teil der AWS Organizations-Organisation ist, in der die AWS Firewall Manager-Richtlinien implementiert werden sollen. Dies erm√∂glicht eine zentrale Verwaltung von Ressourcen und Richtlinien √ºber mehrere AWS-Konten innerhalb der Organisation.
2. **Erstellen Sie ein AWS Firewall Manager Standard-Administrator-Konto:** Richten Sie ein Standard-Administrator-Konto speziell f√ºr die Verwaltung von Firewall Manager-Sicherheitsrichtlinien ein. Dieses Konto ist verantwortlich f√ºr die Konfiguration und Durchsetzung von Sicherheitsrichtlinien in der gesamten Organisation. Nur das Verwaltungskonto der Organisation kann Standard-Administrator-Konten f√ºr den Firewall Manager erstellen.
3. **Aktivieren Sie AWS Config:** Aktivieren Sie AWS Config, um dem Firewall Manager die erforderlichen Konfigurationsdaten und Einblicke zu geben, die zur effektiven Durchsetzung von Sicherheitsrichtlinien erforderlich sind. AWS Config hilft bei der Analyse, √úberpr√ºfung, √úberwachung und Pr√ºfung von Ressourcen-Konfigurationen und -√Ñnderungen und erleichtert so ein besseres Sicherheitsmanagement.
4. **F√ºr Drittanbieter-Richtlinien, abonnieren Sie im AWS Marketplace und konfigurieren Sie die Einstellungen f√ºr Drittanbieter:** Wenn Sie planen, Drittanbieter-Firewall-Richtlinien zu nutzen, abonnieren Sie diese im AWS Marketplace und konfigurieren Sie die erforderlichen Einstellungen. Dieser Schritt stellt sicher, dass der Firewall Manager Richtlinien von vertrauensw√ºrdigen Drittanbietern integrieren und durchsetzen kann.
5. **F√ºr Netzwerk-Firewall- und DNS-Firewall-Richtlinien, aktivieren Sie die Ressourcenteilung:** Aktivieren Sie die Ressourcenteilung speziell f√ºr Netzwerk-Firewall- und DNS-Firewall-Richtlinien. Dies erm√∂glicht es dem Firewall Manager, Firewall-Schutzma√ünahmen auf die VPCs und die DNS-Aufl√∂sung Ihrer Organisation anzuwenden und die Netzwerksicherheit zu verbessern.
6. **Um AWS Firewall Manager in standardm√§√üig deaktivierten Regionen zu verwenden:** Wenn Sie beabsichtigen, den Firewall Manager in AWS-Regionen zu verwenden, die standardm√§√üig deaktiviert sind, stellen Sie sicher, dass Sie die erforderlichen Schritte unternehmen, um seine Funktionalit√§t in diesen Regionen zu aktivieren. Dies gew√§hrleistet eine konsistente Durchsetzung der Sicherheit in allen Regionen, in denen Ihre Organisation t√§tig ist.

F√ºr weitere Informationen siehe: [Erste Schritte mit AWS Firewall Manager AWS WAF-Richtlinien](https://docs.aws.amazon.com/waf/latest/developerguide/getting-started-fms.html).

### Arten von Schutzrichtlinien

AWS Firewall Manager verwaltet mehrere Arten von Richtlinien, um Sicherheitskontrollen in verschiedenen Aspekten der Infrastruktur Ihrer Organisation durchzusetzen:

1. **AWS WAF-Richtlinie:** Dieser Richtlinientyp unterst√ºtzt sowohl AWS WAF als auch AWS WAF Classic. Sie k√∂nnen definieren, welche Ressourcen durch die Richtlinie gesch√ºtzt sind. F√ºr AWS WAF-Richtlinien k√∂nnen Sie Sets von Regelgruppen angeben, die zuerst und zuletzt im Web-ACL ausgef√ºhrt werden. Dar√ºber hinaus k√∂nnen Kontoinhaber Regeln und Regelgruppen hinzuf√ºgen, die zwischen diesen Sets ausgef√ºhrt werden.
2. **Shield Advanced-Richtlinie:** Diese Richtlinie wendet Shield Advanced-Schutzma√ünahmen auf Ihre Organisation f√ºr bestimmte Ressourcentypen an. Sie hilft, sich gegen DDoS-Angriffe und andere Bedrohungen zu sch√ºtzen.
3. **Amazon VPC-Sicherheitsgruppenrichtlinie:** Mit dieser Richtlinie k√∂nnen Sie Sicherheitsgruppen verwalten, die in Ihrer Organisation verwendet werden, und ein Basisset von Regeln in Ihrer AWS-Umgebung durchsetzen, um den Netzwerkzugang zu steuern.
4. **Amazon VPC-Netzwerkzugriffskontrolllisten (ACL)-Richtlinie:** Dieser Richtlinientyp gibt Ihnen die Kontrolle √ºber Netzwerk-ACLs, die in Ihrer Organisation verwendet werden, und erm√∂glicht es Ihnen, ein Basisset von Netzwerk-ACLs in Ihrer AWS-Umgebung durchzusetzen.
5. **Netzwerk-Firewall-Richtlinie:** Diese Richtlinie wendet AWS Network Firewall-Schutz auf die VPCs Ihrer Organisation an und verbessert die Netzwerksicherheit, indem der Datenverkehr basierend auf vordefinierten Regeln gefiltert wird.
6. **Amazon Route 53 Resolver DNS-Firewall-Richtlinie:** Diese Richtlinie wendet DNS-Firewall-Schutzma√ünahmen auf die VPCs Ihrer Organisation an und hilft, b√∂sartige Domainaufl√∂sungsversuche zu blockieren und Sicherheitsrichtlinien f√ºr DNS-Verkehr durchzusetzen.
7. **Drittanbieter-Firewall-Richtlinie:** Dieser Richtlinientyp wendet Schutzma√ünahmen von Drittanbieter-Firewalls an, die √ºber das AWS Marketplace-Portal abonnierbar sind. Er erm√∂glicht es Ihnen, zus√§tzliche Sicherheitsma√ünahmen von vertrauensw√ºrdigen Anbietern in Ihre AWS-Umgebung zu integrieren.
1. **Palo Alto Networks Cloud NGFW-Richtlinie:** Diese Richtlinie wendet Schutzma√ünahmen und Regelstapel der Palo Alto Networks Cloud Next Generation Firewall (NGFW) auf die VPCs Ihrer Organisation an und bietet fortschrittliche Bedrohungspr√§vention und anwendungsspezifische Sicherheitskontrollen.
2. **Fortigate Cloud Native Firewall (CNF) als Service-Richtlinie:** Diese Richtlinie wendet Schutzma√ünahmen der Fortigate Cloud Native Firewall (CNF) als Service an und bietet branchenf√ºhrende Bedrohungspr√§vention, Webanwendungsfirewall (WAF) und API-Schutz, die auf Cloud-Infrastrukturen zugeschnitten sind.

### Administratorenkonten

AWS Firewall Manager bietet Flexibilit√§t bei der Verwaltung von Firewall-Ressourcen innerhalb Ihrer Organisation durch seinen administrativen Umfang und zwei Arten von Administratorenkonten.

**Der administrative Umfang definiert die Ressourcen, die ein Firewall Manager-Administrator verwalten kann**. Nachdem ein AWS Organizations-Verwaltungskonto eine Organisation in den Firewall Manager integriert hat, kann es zus√§tzliche Administratoren mit unterschiedlichen administrativen Umf√§ngen erstellen. Diese Umf√§nge k√∂nnen Folgendes umfassen:

* Konten oder organisatorische Einheiten (OUs), auf die der Administrator Richtlinien anwenden kann.
* Regionen, in denen der Administrator Aktionen durchf√ºhren kann.
* Firewall Manager-Richtlinientypen, die der Administrator verwalten kann.

Der administrative Umfang kann entweder **vollst√§ndig oder eingeschr√§nkt** sein. Vollst√§ndiger Umfang gew√§hrt dem Administrator Zugriff auf **alle angegebenen Ressourcentypen, Regionen und Richtlinientypen**. Im Gegensatz dazu gew√§hrt **eingeschr√§nkter Umfang administrative Berechtigungen nur f√ºr eine Teilmenge von Ressourcen, Regionen oder Richtlinientypen**. Es ist ratsam, Administratoren nur die Berechtigungen zu gew√§hren, die sie ben√∂tigen, um ihre Rollen effektiv zu erf√ºllen. Sie k√∂nnen jede Kombination dieser administrativen Umfangsbedingungen auf einen Administrator anwenden, um die Einhaltung des Prinzips der minimalen Berechtigung sicherzustellen.

Es gibt zwei verschiedene Arten von Administratorenkonten, die jeweils spezifische Rollen und Verantwortlichkeiten erf√ºllen:

* **Standard-Administrator:**
* Das Standard-Administrator-Konto wird vom Verwaltungskonto der AWS Organizations-Organisation w√§hrend des Onboarding-Prozesses f√ºr den Firewall Manager erstellt.
* Dieses Konto hat die F√§higkeit, Drittanbieter-Firewalls zu verwalten und besitzt einen vollst√§ndigen administrativen Umfang.
* Es dient als prim√§res Administrator-Konto f√ºr den Firewall Manager, das f√ºr die Konfiguration und Durchsetzung von Sicherheitsrichtlinien in der gesamten Organisation verantwortlich ist.
* W√§hrend der Standard-Administrator vollen Zugriff auf alle Ressourcentypen und administrativen Funktionen hat, operiert er auf derselben Ebene wie andere Administratoren, wenn mehrere Administratoren innerhalb der Organisation genutzt werden.
* **Firewall Manager-Administratoren:**
* Diese Administratoren k√∂nnen Ressourcen im Rahmen des vom Verwaltungskonto der AWS Organizations festgelegten Umfangs verwalten, wie in der Konfiguration des administrativen Umfangs definiert.
* Firewall Manager-Administratoren werden erstellt, um spezifische Rollen innerhalb der Organisation zu erf√ºllen, was eine Delegation von Verantwortlichkeiten erm√∂glicht, w√§hrend Sicherheits- und Compliance-Standards eingehalten werden.
* Bei der Erstellung √ºberpr√ºft der Firewall Manager bei AWS Organizations, ob das Konto bereits ein delegierter Administrator ist. Wenn nicht, ruft der Firewall Manager Organizations auf, um das Konto als delegierten Administrator f√ºr den Firewall Manager zu benennen.

Die Verwaltung dieser Administratorenkonten umfasst deren Erstellung innerhalb des Firewall Managers und die Definition ihrer administrativen Umf√§nge gem√§√ü den Sicherheitsanforderungen der Organisation und dem Prinzip der minimalen Berechtigung. Durch die Zuweisung geeigneter administrativer Rollen k√∂nnen Organisationen ein effektives Sicherheitsmanagement sicherstellen und gleichzeitig die Kontrolle √ºber den Zugriff auf sensible Ressourcen aufrechterhalten.

Es ist wichtig zu betonen, dass **nur ein Konto innerhalb einer Organisation als Standard-Administrator des Firewall Managers fungieren kann**, gem√§√ü dem Prinzip "**first in, last out**". Um einen neuen Standard-Administrator zu benennen, m√ºssen eine Reihe von Schritten befolgt werden:

* Zuerst muss jeder Firewall-Administrator sein eigenes Konto widerrufen.
* Dann kann der bestehende Standard-Administrator sein eigenes Konto widerrufen, wodurch die Organisation effektiv vom Firewall Manager abgemeldet wird. Dieser Prozess f√ºhrt zur L√∂schung aller vom widerrufenen Konto erstellten Firewall Manager-Richtlinien.
* Abschlie√üend muss das Verwaltungskonto der AWS Organizations den Standard-Administrator des Firewall Managers benennen.

## Enumeration
```
# Users/Administrators

## Get the AWS Organizations account that is associated with AWS Firewall Manager as the AWS Firewall Manager default administrator
aws fms get-admin-account

## List of Firewall Manager administrators within the organization
aws fms list-admin-accounts-for-organization # ReadOnlyAccess policy is not enough for this

## Return a list of the member accounts in the FM administrator's AWS organization
aws fms list-member-accounts # Only a Firewall Manager administrator or the Organization's management account can make this request

## List the accounts that are managing the specified AWS Organizations member account
aws fms list-admins-managing-account # ReadOnlyAccess policy is not enough for this

# Resources

## Get the resources that a Firewall Manager administrator can manage
aws fms get-admin-scope --admin-account <value> # ReadOnlyAccess policy is not enough for this

## Returns the summary of the resource sets used
aws fms list-resource-sets # ReadOnlyAccess policy is not enough for this

## Get information about a specific resource set
aws fms get-resource-set --identifier <value>  # ReadOnlyAccess policy is not enough for this

## Retrieve the list of tags for a given resource
aws fms list-tags-for-resource --resource-arn <value>

## List of the resources in the AWS Organization's accounts that are available to be associated with a FM resource set. Only one account is supported per request.
aws fms list-compliance-status --member-account-ids <value> --resource-type <value> # ReadOnlyAccess policy is not enough for this

## List the resources that are currently associated to a resource set
aws fms list-resource-set-resources --identifier <value> # ReadOnlyAccess policy is not enough for this

# Policies

## Returns the list of policies
aws fms list-policies

## Get information about the specified AWS Firewall Manager policy
aws fms get-policy --policy-id <value>

## List all of the third-party firewall policies that are associated with the third-party firewall administrator's account
aws fms list-third-party-firewall-firewall-policies --third-party-firewall <PALO_ALTO_NETWORKS_CLOUD_NGFW|FORTIGATE_CLOUD_NATIVE_FIREWALL> # ReadOnlyAccess policy is not enough for this

# AppsList

## Return a list of apps list
aws fms list-apps-lists --max-results [1-100]

## Get information about the specified AWS Firewall Manager applications list
aws fms get-apps-list --list-id <value>

# Protocols

## Get the details of the Firewall Manager protocols list.
aws fms list-protocols-lists

## Get information about the specified AWS Firewall Manager Protocols list
aws fms get-protocols-list --list-id <value>

# Compliance

## Return a summary of which member accounts are protected by the specified policy
aws fms list-compliance-status --policy-id <policy-id>

## Get detailed compliance information about the specified member account (resources that are in and out of compliance with the specified policy)
aws fms get-compliance-detail --policy-id <value> --member-account <value>

# Other useful info

## Get information about the SNS topic that is used to record AWS Firewall Manager SNS logs (if any)
aws fms get-notification-channel

## Get policy-level attack summary information in the event of a potential DDoS attack
aws fms get-protection-status --policy-id <value> # Just for Shield Advanced policy

## Get the onboarding status of a Firewall Manager admin account to third-party firewall vendor tenant.
aws fms get-third-party-firewall-association-status --third-party-firewall <PALO_ALTO_NETWORKS_CLOUD_NGFW|FORTIGATE_CLOUD_NATIVE_FIREWALL> # ReadOnlyAccess policy is not enough for this

## Get violations' details for a resource based on the specified AWS Firewall Manager policy and AWS account.
aws fms get-violation-details --policy-id <value> --member-account <value> --resource-id <value> --resource-type <value>
```
## Post Exploitation / Bypass Detection

### `organizations:DescribeOrganization` & (`fms:AssociateAdminAccount`, `fms:DisassociateAdminAccount`, `fms:PutAdminAccount`)

Ein Angreifer mit der **`fms:AssociateAdminAccount`** Berechtigung k√∂nnte das Standardadministrator-Konto des Firewall Managers festlegen. Mit der **`fms:PutAdminAccount`** Berechtigung k√∂nnte ein Angreifer ein Firewall Manager-Administrator-Konto erstellen oder aktualisieren und mit der **`fms:DisassociateAdminAccount`** Berechtigung k√∂nnte ein potenzieller Angreifer die aktuelle Zuordnung des Firewall Manager-Administrator-Kontos entfernen.

* Die Disassoziation des **Standardadministrators des Firewall Managers folgt der First-in-Last-out-Politik**. Alle Firewall Manager-Administratoren m√ºssen sich disassoziieren, bevor der Standardadministrator des Firewall Managers das Konto disassoziieren kann.
* Um einen Firewall Manager-Administrator mit **PutAdminAccount** zu erstellen, muss das Konto zur Organisation geh√∂ren, die zuvor mit **AssociateAdminAccount** in den Firewall Manager aufgenommen wurde.
* Die Erstellung eines Firewall Manager-Administrator-Kontos kann nur durch das Verwaltungs-Konto der Organisation erfolgen.
```bash
aws fms associate-admin-account --admin-account <value>
aws fms disassociate-admin-account
aws fms put-admin-account --admin-account <value>
```
**Potenzielle Auswirkungen:** Verlust der zentralen Verwaltung, Umgehung von Richtlinien, Verst√∂√üe gegen die Compliance und St√∂rung der Sicherheitskontrollen innerhalb der Umgebung.

### `fms:PutPolicy`, `fms:DeletePolicy`

Ein Angreifer mit den Berechtigungen **`fms:PutPolicy`**, **`fms:DeletePolicy`** w√§re in der Lage, eine AWS Firewall Manager-Richtlinie zu erstellen, zu √§ndern oder dauerhaft zu l√∂schen.
```bash
aws fms put-policy --policy <value> | --cli-input-json file://<policy.json> [--tag-list <value>]
aws fms delete-policy --policy-id <value> [--delete-all-policy-resources | --no-delete-all-policy-resources]
```
Ein Beispiel f√ºr eine permissive Richtlinie durch eine permissive Sicherheitsgruppe, um die Erkennung zu umgehen, k√∂nnte das folgende sein:
```json
{
"Policy": {
"PolicyName": "permisive_policy",
"SecurityServicePolicyData": {
"Type": "SECURITY_GROUPS_COMMON",
"ManagedServiceData": "{\"type\":\"SECURITY_GROUPS_COMMON\",\"securityGroups\":[{\"id\":\"<permisive_security_group_id>\"}], \"applyToAllEC2InstanceENIs\":\"true\",\"IncludeSharedVPC\":\"true\"}"
},
"ResourceTypeList": ["AWS::EC2::Instance", "AWS::EC2::NetworkInterface", "AWS::EC2::SecurityGroup", "AWS::ElasticLoadBalancingV2::LoadBalancer", "AWS::ElasticLoadBalancing::LoadBalancer"],
"ResourceType": "AWS::EC2::SecurityGroup",
"ExcludeResourceTags": false,
"ResourceTags": [],
"RemediationEnabled": true
},
"TagList": []
}
```
**Potenzielle Auswirkungen:** Abbau von Sicherheitskontrollen, Umgehung von Richtlinien, Verst√∂√üe gegen die Compliance, betriebliche St√∂rungen und potenzielle Datenlecks innerhalb der Umgebung.

### `fms:BatchAssociateResource`, `fms:BatchDisassociateResource`, `fms:PutResourceSet`, `fms:DeleteResourceSet`

Ein Angreifer mit den Berechtigungen **`fms:BatchAssociateResource`** und **`fms:BatchDisassociateResource`** w√§re in der Lage, Ressourcen von einem Firewall Manager-Ressourcensatz zuzuordnen oder zu trennen. Dar√ºber hinaus w√ºrden die Berechtigungen **`fms:PutResourceSet`** und **`fms:DeleteResourceSet`** einem Angreifer erlauben, diese Ressourcens√§tze im AWS Firewall Manager zu erstellen, zu √§ndern oder zu l√∂schen.
```bash
# Associate/Disassociate resources from a resource set
aws fms batch-associate-resource --resource-set-identifier <value> --items <value>
aws fms batch-disassociate-resource --resource-set-identifier <value> --items <value>

# Create, modify or delete a resource set
aws fms put-resource-set --resource-set <value> [--tag-list <value>]
aws fms delete-resource-set --identifier <value>
```
**Potenzielle Auswirkungen:** Die Hinzuf√ºgung einer unn√∂tigen Anzahl von Elementen zu einem Ressourcen-Set wird das Ger√§uschlevel im Dienst erh√∂hen und m√∂glicherweise einen DoS verursachen. Dar√ºber hinaus k√∂nnten √Ñnderungen der Ressourcen-Sets zu einer St√∂rung der Ressourcen, Umgehung von Richtlinien, Verst√∂√üen gegen die Compliance und St√∂rungen der Sicherheitskontrollen innerhalb der Umgebung f√ºhren.

### `fms:PutAppsList`, `fms:DeleteAppsList`

Ein Angreifer mit den Berechtigungen **`fms:PutAppsList`** und **`fms:DeleteAppsList`** w√§re in der Lage, Anwendungslisten aus dem AWS Firewall Manager zu erstellen, zu √§ndern oder zu l√∂schen. Dies k√∂nnte kritisch sein, da unautorisierte Anwendungen m√∂glicherweise Zugang zur allgemeinen √ñffentlichkeit erhalten oder der Zugang zu autorisierten Anwendungen verweigert werden k√∂nnte, was einen DoS verursachen w√ºrde.
```bash
aws fms put-apps-list --apps-list <value> [--tag-list <value>]
aws fms delete-apps-list --list-id <value>
```
**Potenzielle Auswirkungen:** Dies k√∂nnte zu Fehlkonfigurationen, Umgehungen von Richtlinien, Verst√∂√üen gegen die Compliance und St√∂rungen der Sicherheitskontrollen innerhalb der Umgebung f√ºhren.

### `fms:PutProtocolsList`, `fms:DeleteProtocolsList`

Ein Angreifer mit den Berechtigungen **`fms:PutProtocolsList`** und **`fms:DeleteProtocolsList`** w√§re in der Lage, Protokolllisten im AWS Firewall Manager zu erstellen, zu √§ndern oder zu l√∂schen. √Ñhnlich wie bei Anwendungslisten k√∂nnte dies kritisch sein, da unautorisierte Protokolle von der allgemeinen √ñffentlichkeit verwendet werden k√∂nnten oder die Verwendung autorisierter Protokolle verweigert werden k√∂nnte, was zu einem DoS f√ºhren w√ºrde.
```bash
aws fms put-protocols-list --apps-list <value> [--tag-list <value>]
aws fms delete-protocols-list --list-id <value>
```
**Potenzielle Auswirkungen:** Dies k√∂nnte zu Fehlkonfigurationen, Umgehungen von Richtlinien, Verst√∂√üen gegen die Compliance und St√∂rungen der Sicherheitskontrollen innerhalb der Umgebung f√ºhren.

### `fms:PutNotificationChannel`, `fms:DeleteNotificationChannel`

Ein Angreifer mit den Berechtigungen **`fms:PutNotificationChannel`** und **`fms:DeleteNotificationChannel`** w√§re in der Lage, die IAM-Rolle und das Amazon Simple Notification Service (SNS)-Thema zu l√∂schen und festzulegen, die Firewall Manager verwendet, um SNS-Protokolle aufzuzeichnen.

Um **`fms:PutNotificationChannel`** au√üerhalb der Konsole zu verwenden, m√ºssen Sie die Zugriffsrichtlinie des SNS-Themas einrichten, die dem angegebenen **SnsRoleName** das Ver√∂ffentlichen von SNS-Protokollen erlaubt. Wenn der angegebene **SnsRoleName** eine Rolle ist, die nicht **`AWSServiceRoleForFMS`** ist, erfordert dies eine Vertrauensbeziehung, die konfiguriert ist, um dem Firewall Manager-Dienstprinzipal **fms.amazonaws.com** zu erlauben, diese Rolle zu √ºbernehmen.

F√ºr Informationen zur Konfiguration einer SNS-Zugriffsrichtlinie:

{% content-ref url="../aws-services/aws-sns-enum.md" %}
[aws-sns-enum.md](../aws-services/aws-sns-enum.md)
{% endcontent-ref %}
```bash
aws fms put-notification-channel --sns-topic-arn <value> --sns-role-name <value>
aws fms delete-notification-channel
```
**Potenzielle Auswirkungen:** Dies k√∂nnte potenziell zu verpassten Sicherheitswarnungen, verz√∂gerter Incident-Response, potenziellen Datenlecks und betrieblichen St√∂rungen innerhalb der Umgebung f√ºhren.

### `fms:AssociateThirdPartyFirewall`, `fms:DisssociateThirdPartyFirewall`

Ein Angreifer mit den Berechtigungen **`fms:AssociateThirdPartyFirewall`**, **`fms:DisssociateThirdPartyFirewall`** w√§re in der Lage, Drittanbieter-Firewalls zuzuordnen oder von der zentralen Verwaltung √ºber AWS Firewall Manager zu trennen.

{% hint style="warning" %}
Nur der Standardadministrator kann Drittanbieter-Firewalls erstellen und verwalten.
{% endhint %}
```bash
aws fms associate-third-party-firewall --third-party-firewall [PALO_ALTO_NETWORKS_CLOUD_NGFW | FORTIGATE_CLOUD_NATIVE_FIREWALL]
aws fms disassociate-third-party-firewall --third-party-firewall [PALO_ALTO_NETWORKS_CLOUD_NGFW | FORTIGATE_CLOUD_NATIVE_FIREWALL]
```
**Potenzielle Auswirkungen:** Die Dissoziation w√ºrde zu einer Umgehung der Richtlinien, zu Compliance-Verst√∂√üen und zu einer St√∂rung der Sicherheitskontrollen innerhalb der Umgebung f√ºhren. Die Assoziation hingegen w√ºrde zu einer St√∂rung der Kosten- und Budgetzuweisung f√ºhren.

### `fms:TagResource`, `fms:UntagResource`

Ein Angreifer w√§re in der Lage, Tags von Firewall Manager-Ressourcen hinzuzuf√ºgen, zu √§ndern oder zu entfernen, was die Kostenallokation, die Ressourcenverfolgung und die Zugriffskontrollrichtlinien Ihrer Organisation, die auf Tags basieren, st√∂ren w√ºrde.
```bash
aws fms tag-resource --resource-arn <value> --tag-list <value>
aws fms untag-resource --resource-arn <value> --tag-keys <value>
```
**Potenzielle Auswirkungen**: St√∂rung der Kostenverteilung, Ressourcenverfolgung und tagbasierter Zugriffskontrollrichtlinien.

## Referenzen

* [https://docs.aws.amazon.com/govcloud-us/latest/UserGuide/govcloud-fms.html](https://docs.aws.amazon.com/govcloud-us/latest/UserGuide/govcloud-fms.html)
* [https://docs.aws.amazon.com/service-authorization/latest/reference/list\_awsfirewallmanager.html](https://docs.aws.amazon.com/service-authorization/latest/reference/list\_awsfirewallmanager.html)
* [https://docs.aws.amazon.com/waf/latest/developerguide/fms-chapter.html](https://docs.aws.amazon.com/waf/latest/developerguide/fms-chapter.html)

{% hint style="success" %}
Lernen & √ºben Sie AWS Hacking:<img src="../../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">\
Lernen & √ºben Sie GCP Hacking: <img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Unterst√ºtzen Sie HackTricks</summary>

* √úberpr√ºfen Sie die [**Abonnementpl√§ne**](https://github.com/sponsors/carlospolop)!
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teilen Sie Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repos senden.

</details>
{% endhint %}
