# AWS - Firewall Manager Enum

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Firewall Manager

**AWS Firewall Manager** simplifica a gest√£o e manuten√ß√£o do **AWS WAF, AWS Shield Advanced, grupos de seguran√ßa do Amazon VPC e Listas de Controle de Acesso √† Rede (ACLs), e AWS Network Firewall, AWS Route 53 Resolver DNS Firewall e firewalls de terceiros** em v√°rias contas e recursos. Ele permite que voc√™ configure suas regras de firewall, prote√ß√µes do Shield Advanced, grupos de seguran√ßa do VPC e configura√ß√µes do Network Firewall apenas uma vez, com o servi√ßo **aplicando automaticamente essas regras e prote√ß√µes em suas contas e recursos**, incluindo os rec√©m-adicionados.

O servi√ßo oferece a capacidade de **agrupar e proteger recursos espec√≠ficos juntos**, como aqueles que compartilham uma tag comum ou todas as suas distribui√ß√µes do CloudFront. Uma vantagem significativa do Firewall Manager √© sua capacidade de **estender automaticamente a prote√ß√£o a recursos rec√©m-adicionados** em sua conta.

Um **grupo de regras** (uma cole√ß√£o de regras do WAF) pode ser incorporado em uma Pol√≠tica do AWS Firewall Manager, que √© ent√£o vinculada a recursos espec√≠ficos da AWS, como distribui√ß√µes do CloudFront ou balanceadores de carga de aplicativos.

O AWS Firewall Manager fornece **listas de aplicativos e protocolos gerenciados** para simplificar a configura√ß√£o e gest√£o das pol√≠ticas de grupos de seguran√ßa. Essas listas permitem que voc√™ defina os protocolos e aplicativos permitidos ou negados por suas pol√≠ticas. Existem dois tipos de listas gerenciadas:

* **Listas gerenciadas pelo Firewall Manager**: Essas listas incluem **FMS-Default-Public-Access-Apps-Allowed**, **FMS-Default-Protocols-Allowed** e **FMS-Default-Protocols-Allowed**. Elas s√£o gerenciadas pelo Firewall Manager e incluem aplicativos e protocolos comumente usados que devem ser permitidos ou negados ao p√∫blico em geral. N√£o √© poss√≠vel edit√°-las ou exclu√≠-las, no entanto, voc√™ pode escolher sua vers√£o.
* **Listas gerenciadas personalizadas**: Voc√™ gerencia essas listas por conta pr√≥pria. Voc√™ pode criar listas de aplicativos e protocolos personalizadas adaptadas √†s necessidades da sua organiza√ß√£o. Ao contr√°rio das listas gerenciadas pelo Firewall Manager, essas listas n√£o t√™m vers√µes, mas voc√™ tem controle total sobre as listas personalizadas, permitindo que voc√™ as crie, edite e exclua conforme necess√°rio.

√â importante notar que **as pol√≠ticas do Firewall Manager permitem apenas a√ß√µes de "Bloquear" ou "Contar"** para um grupo de regras, sem uma op√ß√£o de "Permitir".

### Prerequisites

Os seguintes passos pr√©-requisitos devem ser conclu√≠dos antes de prosseguir para configurar o Firewall Manager para come√ßar a proteger efetivamente os recursos da sua organiza√ß√£o. Esses passos fornecem a configura√ß√£o b√°sica necess√°ria para que o Firewall Manager aplique pol√≠ticas de seguran√ßa e garanta conformidade em seu ambiente AWS:

1. **Junte-se e configure o AWS Organizations:** Certifique-se de que sua conta AWS faz parte da organiza√ß√£o do AWS Organizations onde as pol√≠ticas do AWS Firewall Manager est√£o planejadas para serem implantadas. Isso permite a gest√£o centralizada de recursos e pol√≠ticas em v√°rias contas AWS dentro da organiza√ß√£o.
2. **Crie uma Conta de Administrador Padr√£o do AWS Firewall Manager:** Estabele√ßa uma conta de administrador padr√£o especificamente para gerenciar as pol√≠ticas de seguran√ßa do Firewall Manager. Esta conta ser√° respons√°vel por configurar e aplicar pol√≠ticas de seguran√ßa em toda a organiza√ß√£o. Apenas a conta de gerenciamento da organiza√ß√£o pode criar contas de administrador padr√£o do Firewall Manager.
3. **Ative o AWS Config:** Ative o AWS Config para fornecer ao Firewall Manager os dados de configura√ß√£o e insights necess√°rios para aplicar efetivamente as pol√≠ticas de seguran√ßa. O AWS Config ajuda a analisar, auditar, monitorar e auditar configura√ß√µes e mudan√ßas de recursos, facilitando uma melhor gest√£o de seguran√ßa.
4. **Para Pol√≠ticas de Terceiros, Inscreva-se no AWS Marketplace e Configure as Configura√ß√µes de Terceiros:** Se voc√™ planeja utilizar pol√≠ticas de firewall de terceiros, inscreva-se nelas no AWS Marketplace e configure as configura√ß√µes necess√°rias. Este passo garante que o Firewall Manager possa integrar e aplicar pol√≠ticas de fornecedores de terceiros confi√°veis.
5. **Para Pol√≠ticas de Network Firewall e DNS Firewall, habilite o compartilhamento de recursos:** Habilite o compartilhamento de recursos especificamente para pol√≠ticas de Network Firewall e DNS Firewall. Isso permite que o Firewall Manager aplique prote√ß√µes de firewall aos VPCs e √† resolu√ß√£o DNS da sua organiza√ß√£o, melhorando a seguran√ßa da rede.
6. **Para usar o AWS Firewall Manager em Regi√µes que est√£o desativadas por padr√£o:** Se voc√™ pretende usar o Firewall Manager em regi√µes da AWS que est√£o desativadas por padr√£o, certifique-se de tomar as medidas necess√°rias para habilitar sua funcionalidade nessas regi√µes. Isso garante a aplica√ß√£o consistente de seguran√ßa em todas as regi√µes onde sua organiza√ß√£o opera.

Para mais informa√ß√µes, consulte: [Getting started with AWS Firewall Manager AWS WAF policies](https://docs.aws.amazon.com/waf/latest/developerguide/getting-started-fms.html).

### Types of protection policies

O AWS Firewall Manager gerencia v√°rios tipos de pol√≠ticas para aplicar controles de seguran√ßa em diferentes aspectos da infraestrutura da sua organiza√ß√£o:

1. **Pol√≠tica do AWS WAF:** Este tipo de pol√≠tica suporta tanto o AWS WAF quanto o AWS WAF Classic. Voc√™ pode definir quais recursos s√£o protegidos pela pol√≠tica. Para pol√≠ticas do AWS WAF, voc√™ pode especificar conjuntos de grupos de regras para serem executados primeiro e por √∫ltimo no ACL da web. Al√©m disso, os propriet√°rios da conta podem adicionar regras e grupos de regras para serem executados entre esses conjuntos.
2. **Pol√≠tica do Shield Advanced:** Esta pol√≠tica aplica prote√ß√µes do Shield Advanced em toda a sua organiza√ß√£o para tipos de recursos especificados. Ela ajuda a proteger contra ataques DDoS e outras amea√ßas.
3. **Pol√≠tica de Grupo de Seguran√ßa do Amazon VPC:** Com esta pol√≠tica, voc√™ pode gerenciar grupos de seguran√ßa usados em toda a sua organiza√ß√£o, aplicando um conjunto b√°sico de regras em seu ambiente AWS para controlar o acesso √† rede.
4. **Pol√≠tica de Lista de Controle de Acesso √† Rede (ACL) do Amazon VPC:** Este tipo de pol√≠tica d√° a voc√™ controle sobre as ACLs de rede usadas em sua organiza√ß√£o, permitindo que voc√™ aplique um conjunto b√°sico de ACLs de rede em seu ambiente AWS.
5. **Pol√≠tica de Network Firewall:** Esta pol√≠tica aplica prote√ß√£o do AWS Network Firewall aos VPCs da sua organiza√ß√£o, melhorando a seguran√ßa da rede filtrando o tr√°fego com base em regras predefinidas.
6. **Pol√≠tica do Amazon Route 53 Resolver DNS Firewall:** Esta pol√≠tica aplica prote√ß√µes do DNS Firewall aos VPCs da sua organiza√ß√£o, ajudando a bloquear tentativas de resolu√ß√£o de dom√≠nio maliciosas e aplicar pol√≠ticas de seguran√ßa para o tr√°fego DNS.
7. **Pol√≠tica de Firewall de Terceiros:** Este tipo de pol√≠tica aplica prote√ß√µes de firewalls de terceiros, que est√£o dispon√≠veis por assinatura atrav√©s do console do AWS Marketplace. Ela permite que voc√™ integre medidas de seguran√ßa adicionais de fornecedores confi√°veis em seu ambiente AWS.
1. **Pol√≠tica do Palo Alto Networks Cloud NGFW:** Esta pol√≠tica aplica prote√ß√µes e conjuntos de regras do Palo Alto Networks Cloud Next Generation Firewall (NGFW) aos VPCs da sua organiza√ß√£o, fornecendo preven√ß√£o avan√ßada contra amea√ßas e controles de seguran√ßa em n√≠vel de aplicativo.
2. **Pol√≠tica do Fortigate Cloud Native Firewall (CNF) como Servi√ßo:** Esta pol√≠tica aplica prote√ß√µes do Fortigate Cloud Native Firewall (CNF) como Servi√ßo, oferecendo preven√ß√£o de amea√ßas l√≠der do setor, firewall de aplicativo web (WAF) e prote√ß√£o de API adaptadas para infraestruturas em nuvem.

### Administrator accounts

O AWS Firewall Manager oferece flexibilidade na gest√£o de recursos de firewall dentro da sua organiza√ß√£o atrav√©s de seu escopo administrativo e dois tipos de contas de administrador.

**O escopo administrativo define os recursos que um administrador do Firewall Manager pode gerenciar**. Ap√≥s uma conta de gerenciamento do AWS Organizations integrar uma organiza√ß√£o ao Firewall Manager, ela pode criar administradores adicionais com diferentes escopos administrativos. Esses escopos podem incluir:

* Contas ou unidades organizacionais (OUs) √†s quais o administrador pode aplicar pol√≠ticas.
* Regi√µes onde o administrador pode realizar a√ß√µes.
* Tipos de pol√≠ticas do Firewall Manager que o administrador pode gerenciar.

O escopo administrativo pode ser **total ou restrito**. O escopo total concede ao administrador acesso a **todos os tipos de recursos, regi√µes e tipos de pol√≠ticas especificados**. Em contraste, **o escopo restrito fornece permiss√£o administrativa apenas a um subconjunto de recursos, regi√µes ou tipos de pol√≠ticas**. √â aconselh√°vel conceder aos administradores apenas as permiss√µes necess√°rias para cumprir suas fun√ß√µes de forma eficaz. Voc√™ pode aplicar qualquer combina√ß√£o dessas condi√ß√µes de escopo administrativo a um administrador, garantindo a ades√£o ao princ√≠pio do menor privil√©gio.

Existem dois tipos distintos de contas de administrador, cada uma servindo a pap√©is e responsabilidades espec√≠ficas:

* **Administrador Padr√£o:**
* A conta de administrador padr√£o √© criada pela conta de gerenciamento da organiza√ß√£o do AWS Organizations durante o processo de integra√ß√£o ao Firewall Manager.
* Esta conta tem a capacidade de gerenciar firewalls de terceiros e possui escopo administrativo total.
* Ela serve como a conta de administrador principal para o Firewall Manager, respons√°vel por configurar e aplicar pol√≠ticas de seguran√ßa em toda a organiza√ß√£o.
* Embora o administrador padr√£o tenha acesso total a todos os tipos de recursos e funcionalidades administrativas, ele opera no mesmo n√≠vel de paridade que outros administradores se m√∫ltiplos administradores forem utilizados dentro da organiza√ß√£o.
* **Administradores do Firewall Manager:**
* Esses administradores podem gerenciar recursos dentro do escopo designado pela conta de gerenciamento do AWS Organizations, conforme definido pela configura√ß√£o do escopo administrativo.
* Administradores do Firewall Manager s√£o criados para cumprir pap√©is espec√≠ficos dentro da organiza√ß√£o, permitindo a delega√ß√£o de responsabilidades enquanto mant√™m padr√µes de seguran√ßa e conformidade.
* Ao serem criados, o Firewall Manager verifica com o AWS Organizations para determinar se a conta j√° √© um administrador delegado. Se n√£o, o Firewall Manager chama o Organizations para designar a conta como um administrador delegado para o Firewall Manager.

Gerenciar essas contas de administrador envolve cri√°-las dentro do Firewall Manager e definir seus escopos administrativos de acordo com os requisitos de seguran√ßa da organiza√ß√£o e o princ√≠pio do menor privil√©gio. Ao atribuir pap√©is administrativos apropriados, as organiza√ß√µes podem garantir uma gest√£o de seguran√ßa eficaz enquanto mant√™m controle granular sobre o acesso a recursos sens√≠veis.

√â importante destacar que **apenas uma conta dentro de uma organiza√ß√£o pode servir como o administrador padr√£o do Firewall Manager**, aderindo ao princ√≠pio de "**primeiro a entrar, √∫ltimo a sair**". Para designar um novo administrador padr√£o, uma s√©rie de passos deve ser seguida:

* Primeiro, cada conta de administrador do Firewall deve revogar sua pr√≥pria conta.
* Em seguida, o administrador padr√£o existente pode revogar sua pr√≥pria conta, efetivamente desintegrando a organiza√ß√£o do Firewall Manager. Este processo resulta na exclus√£o de todas as pol√≠ticas do Firewall Manager criadas pela conta revogada.
* Para concluir, a conta de gerenciamento do AWS Organizations deve designar o administrador padr√£o do Firewall Manager.

## Enumeration
```
# Users/Administrators

## Get the AWS Organizations account that is associated with AWS Firewall Manager as the AWS Firewall Manager default administrator
aws fms get-admin-account

## List of Firewall Manager administrators within the organization
aws fms list-admin-accounts-for-organization # ReadOnlyAccess policy is not enough for this

## Return a list of the member accounts in the FM administrator's AWS organization
aws fms list-member-accounts # Only a Firewall Manager administrator or the Organization's management account can make this request

## List the accounts that are managing the specified AWS Organizations member account
aws fms list-admins-managing-account # ReadOnlyAccess policy is not enough for this

# Resources

## Get the resources that a Firewall Manager administrator can manage
aws fms get-admin-scope --admin-account <value> # ReadOnlyAccess policy is not enough for this

## Returns the summary of the resource sets used
aws fms list-resource-sets # ReadOnlyAccess policy is not enough for this

## Get information about a specific resource set
aws fms get-resource-set --identifier <value>  # ReadOnlyAccess policy is not enough for this

## Retrieve the list of tags for a given resource
aws fms list-tags-for-resource --resource-arn <value>

## List of the resources in the AWS Organization's accounts that are available to be associated with a FM resource set. Only one account is supported per request.
aws fms list-compliance-status --member-account-ids <value> --resource-type <value> # ReadOnlyAccess policy is not enough for this

## List the resources that are currently associated to a resource set
aws fms list-resource-set-resources --identifier <value> # ReadOnlyAccess policy is not enough for this

# Policies

## Returns the list of policies
aws fms list-policies

## Get information about the specified AWS Firewall Manager policy
aws fms get-policy --policy-id <value>

## List all of the third-party firewall policies that are associated with the third-party firewall administrator's account
aws fms list-third-party-firewall-firewall-policies --third-party-firewall <PALO_ALTO_NETWORKS_CLOUD_NGFW|FORTIGATE_CLOUD_NATIVE_FIREWALL> # ReadOnlyAccess policy is not enough for this

# AppsList

## Return a list of apps list
aws fms list-apps-lists --max-results [1-100]

## Get information about the specified AWS Firewall Manager applications list
aws fms get-apps-list --list-id <value>

# Protocols

## Get the details of the Firewall Manager protocols list.
aws fms list-protocols-lists

## Get information about the specified AWS Firewall Manager Protocols list
aws fms get-protocols-list --list-id <value>

# Compliance

## Return a summary of which member accounts are protected by the specified policy
aws fms list-compliance-status --policy-id <policy-id>

## Get detailed compliance information about the specified member account (resources that are in and out of compliance with the specified policy)
aws fms get-compliance-detail --policy-id <value> --member-account <value>

# Other useful info

## Get information about the SNS topic that is used to record AWS Firewall Manager SNS logs (if any)
aws fms get-notification-channel

## Get policy-level attack summary information in the event of a potential DDoS attack
aws fms get-protection-status --policy-id <value> # Just for Shield Advanced policy

## Get the onboarding status of a Firewall Manager admin account to third-party firewall vendor tenant.
aws fms get-third-party-firewall-association-status --third-party-firewall <PALO_ALTO_NETWORKS_CLOUD_NGFW|FORTIGATE_CLOUD_NATIVE_FIREWALL> # ReadOnlyAccess policy is not enough for this

## Get violations' details for a resource based on the specified AWS Firewall Manager policy and AWS account.
aws fms get-violation-details --policy-id <value> --member-account <value> --resource-id <value> --resource-type <value>
```
## P√≥s Explora√ß√£o / Bypass Detection

### `organizations:DescribeOrganization` & (`fms:AssociateAdminAccount`, `fms:DisassociateAdminAccount`, `fms:PutAdminAccount`)

Um atacante com a permiss√£o **`fms:AssociateAdminAccount`** seria capaz de definir a conta de administrador padr√£o do Firewall Manager. Com a permiss√£o **`fms:PutAdminAccount`**, um atacante poderia criar ou atualizar uma conta de administrador do Firewall Manager e, com a permiss√£o **`fms:DisassociateAdminAccount`**, um potencial atacante poderia remover a associa√ß√£o da conta de administrador atual do Firewall Manager.

* A desassocia√ß√£o do **administrador padr√£o do Firewall Manager segue a pol√≠tica de primeiro a entrar, √∫ltimo a sair**. Todos os administradores do Firewall Manager devem se desassociar antes que o administrador padr√£o do Firewall Manager possa desassociar a conta.
* Para criar um administrador do Firewall Manager por meio de **PutAdminAccount**, a conta deve pertencer √† organiza√ß√£o que foi previamente integrada ao Firewall Manager usando **AssociateAdminAccount**.
* A cria√ß√£o de uma conta de administrador do Firewall Manager s√≥ pode ser feita pela conta de gerenciamento da organiza√ß√£o.
```bash
aws fms associate-admin-account --admin-account <value>
aws fms disassociate-admin-account
aws fms put-admin-account --admin-account <value>
```
**Impacto Potencial:** Perda de gerenciamento centralizado, evas√£o de pol√≠ticas, viola√ß√µes de conformidade e interrup√ß√£o dos controles de seguran√ßa dentro do ambiente.

### `fms:PutPolicy`, `fms:DeletePolicy`

Um atacante com as permiss√µes **`fms:PutPolicy`**, **`fms:DeletePolicy`** seria capaz de criar, modificar ou excluir permanentemente uma pol√≠tica do AWS Firewall Manager.
```bash
aws fms put-policy --policy <value> | --cli-input-json file://<policy.json> [--tag-list <value>]
aws fms delete-policy --policy-id <value> [--delete-all-policy-resources | --no-delete-all-policy-resources]
```
Um exemplo de pol√≠tica permissiva atrav√©s de um grupo de seguran√ßa permissivo, a fim de contornar a detec√ß√£o, poderia ser o seguinte:
```json
{
"Policy": {
"PolicyName": "permisive_policy",
"SecurityServicePolicyData": {
"Type": "SECURITY_GROUPS_COMMON",
"ManagedServiceData": "{\"type\":\"SECURITY_GROUPS_COMMON\",\"securityGroups\":[{\"id\":\"<permisive_security_group_id>\"}], \"applyToAllEC2InstanceENIs\":\"true\",\"IncludeSharedVPC\":\"true\"}"
},
"ResourceTypeList": ["AWS::EC2::Instance", "AWS::EC2::NetworkInterface", "AWS::EC2::SecurityGroup", "AWS::ElasticLoadBalancingV2::LoadBalancer", "AWS::ElasticLoadBalancing::LoadBalancer"],
"ResourceType": "AWS::EC2::SecurityGroup",
"ExcludeResourceTags": false,
"ResourceTags": [],
"RemediationEnabled": true
},
"TagList": []
}
```
**Impacto Potencial:** Desmantelamento de controles de seguran√ßa, evas√£o de pol√≠ticas, viola√ß√µes de conformidade, interrup√ß√µes operacionais e potenciais vazamentos de dados dentro do ambiente.

### `fms:BatchAssociateResource`, `fms:BatchDisassociateResource`, `fms:PutResourceSet`, `fms:DeleteResourceSet`

Um atacante com as permiss√µes **`fms:BatchAssociateResource`** e **`fms:BatchDisassociateResource`** seria capaz de associar ou desassociar recursos de um conjunto de recursos do Firewall Manager, respectivamente. Al√©m disso, as permiss√µes **`fms:PutResourceSet`** e **`fms:DeleteResourceSet`** permitiriam que um atacante criasse, modificasse ou exclu√≠sse esses conjuntos de recursos do AWS Firewall Manager.
```bash
# Associate/Disassociate resources from a resource set
aws fms batch-associate-resource --resource-set-identifier <value> --items <value>
aws fms batch-disassociate-resource --resource-set-identifier <value> --items <value>

# Create, modify or delete a resource set
aws fms put-resource-set --resource-set <value> [--tag-list <value>]
aws fms delete-resource-set --identifier <value>
```
**Impacto Potencial:** A adi√ß√£o de uma quantidade desnecess√°ria de itens a um conjunto de recursos aumentar√° o n√≠vel de ru√≠do no Servi√ßo, potencialmente causando um DoS. Al√©m disso, mudan√ßas nos conjuntos de recursos podem levar a uma interrup√ß√£o de recursos, evas√£o de pol√≠ticas, viola√ß√µes de conformidade e interrup√ß√£o dos controles de seguran√ßa dentro do ambiente.

### `fms:PutAppsList`, `fms:DeleteAppsList`

Um atacante com as permiss√µes **`fms:PutAppsList`** e **`fms:DeleteAppsList`** seria capaz de criar, modificar ou excluir listas de aplicativos do AWS Firewall Manager. Isso poderia ser cr√≠tico, pois aplicativos n√£o autorizados poderiam ter acesso ao p√∫blico em geral, ou o acesso a aplicativos autorizados poderia ser negado, causando um DoS.
```bash
aws fms put-apps-list --apps-list <value> [--tag-list <value>]
aws fms delete-apps-list --list-id <value>
```
**Impacto Potencial:** Isso pode resultar em configura√ß√µes incorretas, evas√£o de pol√≠ticas, viola√ß√µes de conformidade e interrup√ß√£o dos controles de seguran√ßa dentro do ambiente.

### `fms:PutProtocolsList`, `fms:DeleteProtocolsList`

Um atacante com as permiss√µes **`fms:PutProtocolsList`** e **`fms:DeleteProtocolsList`** seria capaz de criar, modificar ou excluir listas de protocolos do AWS Firewall Manager. Da mesma forma que com listas de aplicativos, isso pode ser cr√≠tico, uma vez que protocolos n√£o autorizados poderiam ser usados pelo p√∫blico em geral, ou o uso de protocolos autorizados poderia ser negado, causando um DoS.
```bash
aws fms put-protocols-list --apps-list <value> [--tag-list <value>]
aws fms delete-protocols-list --list-id <value>
```
**Impacto Potencial:** Isso pode resultar em configura√ß√µes incorretas, evas√£o de pol√≠ticas, viola√ß√µes de conformidade e interrup√ß√£o dos controles de seguran√ßa dentro do ambiente.

### `fms:PutNotificationChannel`, `fms:DeleteNotificationChannel`

Um atacante com as permiss√µes **`fms:PutNotificationChannel`** e **`fms:DeleteNotificationChannel`** seria capaz de deletar e designar o papel IAM e o t√≥pico do Amazon Simple Notification Service (SNS) que o Firewall Manager usa para registrar logs do SNS.

Para usar **`fms:PutNotificationChannel`** fora do console, voc√™ precisa configurar a pol√≠tica de acesso do t√≥pico SNS, permitindo que o **SnsRoleName** especificado publique logs do SNS. Se o **SnsRoleName** fornecido for um papel diferente do **`AWSServiceRoleForFMS`**, ele requer um relacionamento de confian√ßa configurado para permitir que o principal de servi√ßo do Firewall Manager **fms.amazonaws.com** assuma esse papel.

Para informa√ß√µes sobre como configurar uma pol√≠tica de acesso do SNS:

{% content-ref url="../aws-services/aws-sns-enum.md" %}
[aws-sns-enum.md](../aws-services/aws-sns-enum.md)
{% endcontent-ref %}
```bash
aws fms put-notification-channel --sns-topic-arn <value> --sns-role-name <value>
aws fms delete-notification-channel
```
**Impacto Potencial:** Isso poderia levar a alertas de seguran√ßa perdidos, resposta a incidentes atrasada, poss√≠veis vazamentos de dados e interrup√ß√µes operacionais dentro do ambiente.

### `fms:AssociateThirdPartyFirewall`, `fms:DisssociateThirdPartyFirewall`

Um atacante com as permiss√µes **`fms:AssociateThirdPartyFirewall`**, **`fms:DisssociateThirdPartyFirewall`** seria capaz de associar ou desassociar firewalls de terceiros para serem gerenciados centralmente atrav√©s do AWS Firewall Manager.

{% hint style="warning" %}
Apenas o administrador padr√£o pode criar e gerenciar firewalls de terceiros.
{% endhint %}
```bash
aws fms associate-third-party-firewall --third-party-firewall [PALO_ALTO_NETWORKS_CLOUD_NGFW | FORTIGATE_CLOUD_NATIVE_FIREWALL]
aws fms disassociate-third-party-firewall --third-party-firewall [PALO_ALTO_NETWORKS_CLOUD_NGFW | FORTIGATE_CLOUD_NATIVE_FIREWALL]
```
**Impacto Potencial:** A desassocia√ß√£o levaria a uma evas√£o de pol√≠tica, viola√ß√µes de conformidade e interrup√ß√£o dos controles de seguran√ßa dentro do ambiente. A associa√ß√£o, por outro lado, levaria a uma interrup√ß√£o da aloca√ß√£o de custos e or√ßamento.

### `fms:TagResource`, `fms:UntagResource`

Um atacante seria capaz de adicionar, modificar ou remover tags dos recursos do Firewall Manager, interrompendo a aloca√ß√£o de custos da sua organiza√ß√£o, o rastreamento de recursos e as pol√≠ticas de controle de acesso baseadas em tags.
```bash
aws fms tag-resource --resource-arn <value> --tag-list <value>
aws fms untag-resource --resource-arn <value> --tag-keys <value>
```
**Impacto Potencial**: Interrup√ß√£o da aloca√ß√£o de custos, rastreamento de recursos e pol√≠ticas de controle de acesso baseadas em tags.

## Refer√™ncias

* [https://docs.aws.amazon.com/govcloud-us/latest/UserGuide/govcloud-fms.html](https://docs.aws.amazon.com/govcloud-us/latest/UserGuide/govcloud-fms.html)
* [https://docs.aws.amazon.com/service-authorization/latest/reference/list\_awsfirewallmanager.html](https://docs.aws.amazon.com/service-authorization/latest/reference/list\_awsfirewallmanager.html)
* [https://docs.aws.amazon.com/waf/latest/developerguide/fms-chapter.html](https://docs.aws.amazon.com/waf/latest/developerguide/fms-chapter.html)

{% hint style="success" %}
Aprenda e pratique Hacking AWS:<img src="../../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">\
Aprenda e pratique Hacking GCP: <img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Suporte ao HackTricks</summary>

* Confira os [**planos de assinatura**](https://github.com/sponsors/carlospolop)!
* **Junte-se ao** üí¨ [**grupo do Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga**-nos no **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe truques de hacking enviando PRs para o** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) reposit√≥rios do github.

</details>
{% endhint %}
