# AWS - Firewall Manager Enum

{% hint style="success" %}
AWS Hacking Ã¶ÄŸrenin ve pratik yapÄ±n:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCP Hacking Ã¶ÄŸrenin ve pratik yapÄ±n: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**abonelik planlarÄ±nÄ±**](https://github.com/sponsors/carlospolop) kontrol edin!
* **ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n ya da bizi **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**'da takip edin.**
* **HackTricks'e PR gÃ¶ndererek hacking ipuÃ§larÄ±nÄ± paylaÅŸÄ±n** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub depolarÄ±na.

</details>
{% endhint %}

## Firewall Manager

**AWS Firewall Manager**, **AWS WAF, AWS Shield Advanced, Amazon VPC gÃ¼venlik gruplarÄ± ve AÄŸ EriÅŸim Kontrol Listeleri (ACL'ler), AWS Network Firewall, AWS Route 53 Resolver DNS Firewall ve Ã¼Ã§Ã¼ncÃ¼ taraf firewall'larÄ±n** yÃ¶netimini ve bakÄ±mÄ±nÄ± kolaylaÅŸtÄ±rÄ±r. GÃ¼venlik duvarÄ± kurallarÄ±nÄ±zÄ±, Shield Advanced korumalarÄ±nÄ±, VPC gÃ¼venlik gruplarÄ±nÄ± ve Network Firewall ayarlarÄ±nÄ± bir kez yapÄ±landÄ±rmanÄ±za olanak tanÄ±r ve hizmet, bu kurallarÄ± ve korumalarÄ± hesaplarÄ±nÄ±z ve kaynaklarÄ±nÄ±z arasÄ±nda otomatik olarak uygular, yeni eklenenler de dahil.

Hizmet, ortak bir etiketi paylaÅŸan kaynaklar veya tÃ¼m CloudFront daÄŸÄ±tÄ±mlarÄ± gibi belirli kaynaklarÄ± gruplama ve koruma yeteneÄŸi sunar. Firewall Manager'Ä±n Ã¶nemli bir avantajÄ±, hesabÄ±nÄ±za yeni eklenen kaynaklara otomatik olarak koruma geniÅŸletebilmesidir.

Bir **kural grubu** (bir WAF kurallarÄ± koleksiyonu), belirli AWS kaynaklarÄ±na (Ã¶rneÄŸin CloudFront daÄŸÄ±tÄ±mlarÄ± veya uygulama yÃ¼k dengeleyicileri) baÄŸlÄ± bir AWS Firewall Manager PolitikasÄ±na dahil edilebilir.

AWS Firewall Manager, gÃ¼venlik grubu politikalarÄ±nÄ±n yapÄ±landÄ±rÄ±lmasÄ±nÄ± ve yÃ¶netimini basitleÅŸtirmek iÃ§in **yÃ¶netilen uygulama ve protokol listeleri** saÄŸlar. Bu listeler, politikalarÄ±nÄ±z tarafÄ±ndan izin verilen veya reddedilen protokolleri ve uygulamalarÄ± tanÄ±mlamanÄ±za olanak tanÄ±r. Ä°ki tÃ¼r yÃ¶netilen liste vardÄ±r:

* **Firewall Manager yÃ¶netilen listeleri**: Bu listeler **FMS-Default-Public-Access-Apps-Allowed**, **FMS-Default-Protocols-Allowed** ve **FMS-Default-Protocols-Allowed** iÃ§erir. Bu listeler Firewall Manager tarafÄ±ndan yÃ¶netilir ve genel halka izin verilmesi veya reddedilmesi gereken yaygÄ±n olarak kullanÄ±lan uygulamalarÄ± ve protokolleri iÃ§erir. Bu listeleri dÃ¼zenlemek veya silmek mÃ¼mkÃ¼n deÄŸildir, ancak sÃ¼rÃ¼mÃ¼nÃ¼ seÃ§ebilirsiniz.
* **Ã–zel yÃ¶netilen listeler**: Bu listeleri kendiniz yÃ¶netirsiniz. KuruluÅŸunuzun ihtiyaÃ§larÄ±na gÃ¶re Ã¶zel uygulama ve protokol listeleri oluÅŸturabilirsiniz. Firewall Manager yÃ¶netilen listelerinin aksine, bu listelerin sÃ¼rÃ¼mleri yoktur, ancak Ã¶zel listeler Ã¼zerinde tam kontrole sahipsiniz, bu da gerektiÄŸinde oluÅŸturma, dÃ¼zenleme ve silme iÅŸlemlerini yapmanÄ±za olanak tanÄ±r.

**Firewall Manager politikalarÄ±nÄ±n bir kural grubu iÃ§in yalnÄ±zca "Block" veya "Count" eylemlerine izin verdiÄŸini**, "Allow" seÃ§eneÄŸinin olmadÄ±ÄŸÄ±nÄ± belirtmek Ã¶nemlidir.

### Ã–nkoÅŸullar

Firewall Manager'Ä± yapÄ±landÄ±rmaya baÅŸlamadan Ã¶nce kuruluÅŸunuzun kaynaklarÄ±nÄ± etkili bir ÅŸekilde korumak iÃ§in aÅŸaÄŸÄ±daki Ã¶nkoÅŸul adÄ±mlarÄ±nÄ±n tamamlanmasÄ± gerekmektedir. Bu adÄ±mlar, Firewall Manager'Ä±n gÃ¼venlik politikalarÄ±nÄ± uygulamasÄ± ve AWS ortamÄ±nÄ±zda uyumluluÄŸu saÄŸlamasÄ± iÃ§in gerekli temel ayarlarÄ± saÄŸlar:

1. **AWS Organizations'a katÄ±lÄ±n ve yapÄ±landÄ±rÄ±n:** AWS hesabÄ±nÄ±zÄ±n, AWS Firewall Manager politikalarÄ±nÄ±n uygulanmasÄ±nÄ±n planlandÄ±ÄŸÄ± AWS Organizations organizasyonunun bir parÃ§asÄ± olduÄŸundan emin olun. Bu, organizasyon iÃ§indeki birden fazla AWS hesabÄ± arasÄ±nda kaynaklarÄ±n ve politikalarÄ±n merkezi olarak yÃ¶netilmesine olanak tanÄ±r.
2. **Bir AWS Firewall Manager VarsayÄ±lan YÃ¶netici HesabÄ± oluÅŸturun:** Firewall Manager gÃ¼venlik politikalarÄ±nÄ± yÃ¶netmek iÃ§in Ã¶zel olarak bir varsayÄ±lan yÃ¶netici hesabÄ± oluÅŸturun. Bu hesap, organizasyon genelinde gÃ¼venlik politikalarÄ±nÄ± yapÄ±landÄ±rmaktan ve uygulamaktan sorumlu olacaktÄ±r. Organizasyonun yÃ¶netim hesabÄ±, Firewall Manager varsayÄ±lan yÃ¶netici hesaplarÄ±nÄ± oluÅŸturabilen tek hesaptÄ±r.
3. **AWS Config'i etkinleÅŸtirin:** AWS Config'i etkinleÅŸtirerek Firewall Manager'a gÃ¼venlik politikalarÄ±nÄ± etkili bir ÅŸekilde uygulamak iÃ§in gerekli yapÄ±landÄ±rma verilerini ve iÃ§gÃ¶rÃ¼leri saÄŸlayÄ±n. AWS Config, kaynak yapÄ±landÄ±rmalarÄ±nÄ± ve deÄŸiÅŸikliklerini analiz etmeye, denetlemeye, izlemeye ve denetlemeye yardÄ±mcÄ± olur, daha iyi gÃ¼venlik yÃ¶netimi saÄŸlar.
4. **ÃœÃ§Ã¼ncÃ¼ Taraf PolitikalarÄ± iÃ§in, AWS Marketplace'te abone olun ve ÃœÃ§Ã¼ncÃ¼ Taraf AyarlarÄ±nÄ± YapÄ±landÄ±rÄ±n:** ÃœÃ§Ã¼ncÃ¼ taraf firewall politikalarÄ±nÄ± kullanmayÄ± planlÄ±yorsanÄ±z, AWS Marketplace'te bunlara abone olun ve gerekli ayarlarÄ± yapÄ±landÄ±rÄ±n. Bu adÄ±m, Firewall Manager'Ä±n gÃ¼venilir Ã¼Ã§Ã¼ncÃ¼ taraf satÄ±cÄ±lardan gelen politikalarÄ± entegre etmesini ve uygulamasÄ±nÄ± saÄŸlar.
5. **AÄŸ Firewall ve DNS Firewall PolitikalarÄ± iÃ§in kaynak paylaÅŸÄ±mÄ±nÄ± etkinleÅŸtirin:** AÄŸ Firewall ve DNS Firewall politikalarÄ± iÃ§in Ã¶zel olarak kaynak paylaÅŸÄ±mÄ±nÄ± etkinleÅŸtirin. Bu, Firewall Manager'Ä±n organizasyonunuzun VPC'lerine ve DNS Ã§Ã¶zÃ¼mlemesine firewall korumalarÄ± uygulamasÄ±na olanak tanÄ±r, aÄŸ gÃ¼venliÄŸini artÄ±rÄ±r.
6. **VarsayÄ±lan olarak devre dÄ±ÅŸÄ± bÄ±rakÄ±lan BÃ¶lgelerde AWS Firewall Manager'Ä± kullanmak iÃ§in:** Firewall Manager'Ä± varsayÄ±lan olarak devre dÄ±ÅŸÄ± bÄ±rakÄ±lan AWS bÃ¶lgelerinde kullanmayÄ± planlÄ±yorsanÄ±z, bu bÃ¶lgelerde iÅŸlevselliÄŸini etkinleÅŸtirmek iÃ§in gerekli adÄ±mlarÄ± attÄ±ÄŸÄ±nÄ±zdan emin olun. Bu, organizasyonunuzun faaliyet gÃ¶sterdiÄŸi tÃ¼m bÃ¶lgelerde tutarlÄ± gÃ¼venlik uygulamasÄ±nÄ± saÄŸlar.

Daha fazla bilgi iÃ§in, [AWS WAF politikalarÄ± ile AWS Firewall Manager'a baÅŸlama](https://docs.aws.amazon.com/waf/latest/developerguide/getting-started-fms.html) sayfasÄ±na bakÄ±n.

### Koruma politikasÄ± tÃ¼rleri

AWS Firewall Manager, kuruluÅŸunuzun altyapÄ±sÄ±nÄ±n farklÄ± yÃ¶nlerinde gÃ¼venlik kontrollerini uygulamak iÃ§in Ã§eÅŸitli politika tÃ¼rlerini yÃ¶netir:

1. **AWS WAF PolitikasÄ±:** Bu politika tÃ¼rÃ¼ hem AWS WAF hem de AWS WAF Classic'i destekler. Politika tarafÄ±ndan korunan kaynaklarÄ± tanÄ±mlayabilirsiniz. AWS WAF politikalarÄ± iÃ§in, web ACL'de ilk ve son Ã§alÄ±ÅŸacak kural gruplarÄ±nÄ± belirtebilirsiniz. AyrÄ±ca, hesap sahipleri bu setler arasÄ±nda Ã§alÄ±ÅŸacak kurallar ve kural gruplarÄ± ekleyebilir.
2. **Shield Advanced PolitikasÄ±:** Bu politika, belirli kaynak tÃ¼rleri iÃ§in organizasyonunuz genelinde Shield Advanced korumalarÄ±nÄ± uygular. DDoS saldÄ±rÄ±larÄ±na ve diÄŸer tehditlere karÅŸÄ± koruma saÄŸlar.
3. **Amazon VPC GÃ¼venlik Grubu PolitikasÄ±:** Bu politika ile organizasyonunuz genelinde kullanÄ±lan gÃ¼venlik gruplarÄ±nÄ± yÃ¶netebilir, AWS ortamÄ±nÄ±zda aÄŸ eriÅŸimini kontrol etmek iÃ§in temel bir kural seti uygulayabilirsiniz.
4. **Amazon VPC AÄŸ EriÅŸim Kontrol Listesi (ACL) PolitikasÄ±:** Bu politika tÃ¼rÃ¼, organizasyonunuzda kullanÄ±lan aÄŸ ACL'leri Ã¼zerinde kontrol saÄŸlar, AWS ortamÄ±nÄ±zda temel bir aÄŸ ACL seti uygulamanÄ±za olanak tanÄ±r.
5. **AÄŸ Firewall PolitikasÄ±:** Bu politika, organizasyonunuzun VPC'lerine AWS Network Firewall korumasÄ± uygular, Ã¶nceden tanÄ±mlanmÄ±ÅŸ kurallara dayalÄ± olarak trafiÄŸi filtreleyerek aÄŸ gÃ¼venliÄŸini artÄ±rÄ±r.
6. **Amazon Route 53 Resolver DNS Firewall PolitikasÄ±:** Bu politika, organizasyonunuzun VPC'lerine DNS Firewall korumalarÄ± uygular, kÃ¶tÃ¼ niyetli alan adÄ± Ã§Ã¶zÃ¼mleme giriÅŸimlerini engellemeye ve DNS trafiÄŸi iÃ§in gÃ¼venlik politikalarÄ±nÄ± uygulamaya yardÄ±mcÄ± olur.
7. **ÃœÃ§Ã¼ncÃ¼ Taraf Firewall PolitikasÄ±:** Bu politika tÃ¼rÃ¼, AWS Marketplace konsolu aracÄ±lÄ±ÄŸÄ±yla abonelikle kullanÄ±labilen Ã¼Ã§Ã¼ncÃ¼ taraf firewall'larÄ±n korumalarÄ±nÄ± uygular. GÃ¼venilir satÄ±cÄ±lardan ek gÃ¼venlik Ã¶nlemlerini AWS ortamÄ±nÄ±za entegre etmenize olanak tanÄ±r.
1. **Palo Alto Networks Cloud NGFW PolitikasÄ±:** Bu politika, organizasyonunuzun VPC'lerine Palo Alto Networks Cloud Next Generation Firewall (NGFW) korumalarÄ±nÄ± ve kural setlerini uygular, geliÅŸmiÅŸ tehdit Ã¶nleme ve uygulama dÃ¼zeyinde gÃ¼venlik kontrolleri saÄŸlar.
2. **Fortigate Cloud Native Firewall (CNF) as a Service PolitikasÄ±:** Bu politika, Fortigate Cloud Native Firewall (CNF) as a Service korumalarÄ±nÄ± uygular, bulut altyapÄ±larÄ± iÃ§in endÃ¼stri lideri tehdit Ã¶nleme, web uygulama firewall (WAF) ve API korumasÄ± sunar.

### YÃ¶netici hesaplarÄ±

AWS Firewall Manager, organizasyonunuz iÃ§inde firewall kaynaklarÄ±nÄ± yÃ¶netme esnekliÄŸi sunar ve iki tÃ¼r yÃ¶netici hesabÄ± ile yÃ¶netim kapsamÄ±nÄ± belirler.

**YÃ¶netim kapsamÄ±, bir Firewall Manager yÃ¶neticisinin yÃ¶netebileceÄŸi kaynaklarÄ± tanÄ±mlar**. Bir AWS Organizations yÃ¶netim hesabÄ±, bir organizasyonu Firewall Manager'a dahil ettikten sonra, farklÄ± yÃ¶netim kapsamlarÄ±na sahip ek yÃ¶neticiler oluÅŸturabilir. Bu kapsamlar ÅŸunlarÄ± iÃ§erebilir:

- YÃ¶neticinin politikalarÄ± uygulayabileceÄŸi hesaplar veya organizasyon birimleri (OU'lar).
- YÃ¶neticinin iÅŸlem yapabileceÄŸi bÃ¶lgeler.
- YÃ¶neticinin yÃ¶netebileceÄŸi Firewall Manager politika tÃ¼rleri.

YÃ¶netim kapsamÄ±, **tam veya kÄ±sÄ±tlÄ±** olabilir. Tam kapsam, yÃ¶neticiye **belirtilen tÃ¼m kaynak tÃ¼rlerine, bÃ¶lgelere ve politika tÃ¼rlerine** eriÅŸim saÄŸlar. Buna karÅŸÄ±lÄ±k, **kÄ±sÄ±tlÄ± kapsam, yÃ¶neticinin yalnÄ±zca belirli bir kaynak, bÃ¶lge veya politika tÃ¼rÃ¼ alt kÃ¼mesine yÃ¶netim izni saÄŸlar**. YÃ¶neticilere, rollerini etkili bir ÅŸekilde yerine getirmeleri iÃ§in gereken izinleri vermek Ã¶nerilir. Bu yÃ¶netim kapsamÄ± koÅŸullarÄ±nÄ±n herhangi bir kombinasyonunu bir yÃ¶neticiye uygulayarak, en az ayrÄ±calÄ±k ilkesine uyulmasÄ±nÄ± saÄŸlayabilirsiniz.

Her biri belirli roller ve sorumluluklar Ã¼stlenen iki farklÄ± yÃ¶netici hesabÄ± tÃ¼rÃ¼ vardÄ±r:

- **VarsayÄ±lan YÃ¶netici:**
- VarsayÄ±lan yÃ¶netici hesabÄ±, Firewall Manager'a dahil olma sÃ¼recinde AWS Organizations organizasyonunun yÃ¶netim hesabÄ± tarafÄ±ndan oluÅŸturulur.
- Bu hesap, Ã¼Ã§Ã¼ncÃ¼ taraf firewall'larÄ± yÃ¶netme yeteneÄŸine sahiptir ve tam yÃ¶netim kapsamÄ±na sahiptir.
- Organizasyon genelinde gÃ¼venlik politikalarÄ±nÄ± yapÄ±landÄ±rmaktan ve uygulamaktan sorumlu birincil yÃ¶netici hesabÄ± olarak hizmet eder.
- VarsayÄ±lan yÃ¶netici, tÃ¼m kaynak tÃ¼rlerine ve yÃ¶netim iÅŸlevlerine tam eriÅŸime sahipken, organizasyon iÃ§inde birden fazla yÃ¶netici kullanÄ±lÄ±yorsa diÄŸer yÃ¶neticilerle aynÄ± dÃ¼zeyde Ã§alÄ±ÅŸÄ±r.
- **Firewall Manager YÃ¶neticileri:**
- Bu yÃ¶neticiler, AWS Organizations yÃ¶netim hesabÄ± tarafÄ±ndan belirlenen kapsam dahilinde kaynaklarÄ± yÃ¶netebilir, yÃ¶netim kapsamÄ± yapÄ±landÄ±rmasÄ± ile tanÄ±mlanÄ±r.
- Firewall Manager yÃ¶neticileri, organizasyon iÃ§inde belirli rolleri yerine getirmek iÃ§in oluÅŸturulur, sorumluluklarÄ±n devredilmesine olanak tanÄ±r ve gÃ¼venlik ve uyumluluk standartlarÄ±nÄ± korur.
- OluÅŸturulduÄŸunda, Firewall Manager, hesabÄ±n zaten atanmÄ±ÅŸ bir yÃ¶netici olup olmadÄ±ÄŸÄ±nÄ± belirlemek iÃ§in AWS Organizations ile kontrol eder. DeÄŸilse, Firewall Manager, hesabÄ± Firewall Manager iÃ§in atanmÄ±ÅŸ bir yÃ¶netici olarak belirlemek iÃ§in Organizations'a Ã§aÄŸrÄ± yapar.

Bu yÃ¶netici hesaplarÄ±nÄ± yÃ¶netmek, onlarÄ± Firewall Manager iÃ§inde oluÅŸturmayÄ± ve organizasyonun gÃ¼venlik gereksinimlerine ve en az ayrÄ±calÄ±k ilkesine gÃ¶re yÃ¶netim kapsamlarÄ±nÄ± tanÄ±mlamayÄ± iÃ§erir. Uygun yÃ¶netim rollerini atayarak, organizasyonlar etkili gÃ¼venlik yÃ¶netimini saÄŸlarken hassas kaynaklara eriÅŸim Ã¼zerinde ayrÄ±ntÄ±lÄ± kontrol saÄŸlayabilir.

**Bir organizasyon iÃ§inde yalnÄ±zca bir hesabÄ±n Firewall Manager varsayÄ±lan yÃ¶neticisi olarak hizmet edebileceÄŸini** vurgulamak Ã¶nemlidir, "**ilk giren, son Ã§Ä±kan**" ilkesine uyar. Yeni bir varsayÄ±lan yÃ¶netici atamak iÃ§in bir dizi adÄ±m izlenmelidir:

- Ä°lk olarak, her Firewall Manager yÃ¶neticisi kendi hesabÄ±nÄ± iptal etmelidir.
- ArdÄ±ndan, mevcut varsayÄ±lan yÃ¶netici kendi hesabÄ±nÄ± iptal edebilir, bu da organizasyonun Firewall Manager'dan Ã§Ä±kÄ±ÅŸÄ±nÄ± saÄŸlar. Bu iÅŸlem, iptal edilen hesap tarafÄ±ndan oluÅŸturulan tÃ¼m Firewall Manager politikalarÄ±nÄ±n silinmesiyle sonuÃ§lanÄ±r.
- Son olarak, AWS Organizations yÃ¶netim hesabÄ±, Firewall Manager varsayÄ±lan yÃ¶neticisini atamalÄ±dÄ±r.

## Enumeration
```
# Users/Administrators

## Get the AWS Organizations account that is associated with AWS Firewall Manager as the AWS Firewall Manager default administrator
aws fms get-admin-account

## List of Firewall Manager administrators within the organization
aws fms list-admin-accounts-for-organization # ReadOnlyAccess policy is not enough for this

## Return a list of the member accounts in the FM administrator's AWS organization
aws fms list-member-accounts # Only a Firewall Manager administrator or the Organization's management account can make this request

## List the accounts that are managing the specified AWS Organizations member account
aws fms list-admins-managing-account # ReadOnlyAccess policy is not enough for this

# Resources

## Get the resources that a Firewall Manager administrator can manage
aws fms get-admin-scope --admin-account <value> # ReadOnlyAccess policy is not enough for this

## Returns the summary of the resource sets used
aws fms list-resource-sets # ReadOnlyAccess policy is not enough for this

## Get information about a specific resource set
aws fms get-resource-set --identifier <value>  # ReadOnlyAccess policy is not enough for this

## Retrieve the list of tags for a given resource
aws fms list-tags-for-resource --resource-arn <value>

## List of the resources in the AWS Organization's accounts that are available to be associated with a FM resource set. Only one account is supported per request.
aws fms list-compliance-status --member-account-ids <value> --resource-type <value> # ReadOnlyAccess policy is not enough for this

## List the resources that are currently associated to a resource set
aws fms list-resource-set-resources --identifier <value> # ReadOnlyAccess policy is not enough for this

# Policies

## Returns the list of policies
aws fms list-policies

## Get information about the specified AWS Firewall Manager policy
aws fms get-policy --policy-id <value>

## List all of the third-party firewall policies that are associated with the third-party firewall administrator's account
aws fms list-third-party-firewall-firewall-policies --third-party-firewall <PALO_ALTO_NETWORKS_CLOUD_NGFW|FORTIGATE_CLOUD_NATIVE_FIREWALL> # ReadOnlyAccess policy is not enough for this

# AppsList

## Return a list of apps list
aws fms list-apps-lists --max-results [1-100]

## Get information about the specified AWS Firewall Manager applications list
aws fms get-apps-list --list-id <value>

# Protocols

## Get the details of the Firewall Manager protocols list.
aws fms list-protocols-lists

## Get information about the specified AWS Firewall Manager Protocols list
aws fms get-protocols-list --list-id <value>

# Compliance

## Return a summary of which member accounts are protected by the specified policy
aws fms list-compliance-status --policy-id <policy-id>

## Get detailed compliance information about the specified member account (resources that are in and out of compliance with the specified policy)
aws fms get-compliance-detail --policy-id <value> --member-account <value>

# Other useful info

## Get information about the SNS topic that is used to record AWS Firewall Manager SNS logs (if any)
aws fms get-notification-channel

## Get policy-level attack summary information in the event of a potential DDoS attack
aws fms get-protection-status --policy-id <value> # Just for Shield Advanced policy

## Get the onboarding status of a Firewall Manager admin account to third-party firewall vendor tenant.
aws fms get-third-party-firewall-association-status --third-party-firewall <PALO_ALTO_NETWORKS_CLOUD_NGFW|FORTIGATE_CLOUD_NATIVE_FIREWALL> # ReadOnlyAccess policy is not enough for this

## Get violations' details for a resource based on the specified AWS Firewall Manager policy and AWS account.
aws fms get-violation-details --policy-id <value> --member-account <value> --resource-id <value> --resource-type <value>
```
## Post Exploitation / Bypass Detection

### `organizations:DescribeOrganization` & (`fms:AssociateAdminAccount`, `fms:DisassociateAdminAccount`, `fms:PutAdminAccount`)
**`fms:AssociateAdminAccount`** iznine sahip bir saldÄ±rgan, Firewall Manager varsayÄ±lan yÃ¶netici hesabÄ±nÄ± ayarlayabilir. **`fms:PutAdminAccount`** iznine sahip bir saldÄ±rgan, bir Firewall Manager yÃ¶netici hesabÄ± oluÅŸturabilir veya gÃ¼ncelleyebilir ve **`fms:DisassociateAdminAccount`** iznine sahip potansiyel bir saldÄ±rgan, mevcut Firewall Manager yÃ¶netici hesabÄ± iliÅŸkilendirmesini kaldÄ±rabilir.

- **Firewall Manager varsayÄ±lan yÃ¶neticisinin iliÅŸkisinin kesilmesi, ilk giren-son Ã§Ä±kar politikasÄ±nÄ± takip eder**. TÃ¼m Firewall Manager yÃ¶neticileri iliÅŸkiyi kesmelidir ki Firewall Manager varsayÄ±lan yÃ¶neticisi hesabÄ± iliÅŸkiyi kesebilsin.
- **PutAdminAccount** ile bir Firewall Manager yÃ¶neticisi oluÅŸturmak iÃ§in, hesap daha Ã¶nce **AssociateAdminAccount** kullanÄ±larak Firewall Manager'a dahil edilmiÅŸ olan organizasyona ait olmalÄ±dÄ±r.
- Bir Firewall Manager yÃ¶netici hesabÄ± oluÅŸturma iÅŸlemi yalnÄ±zca organizasyonun yÃ¶netim hesabÄ± tarafÄ±ndan yapÄ±labilir.
```bash
aws fms associate-admin-account --admin-account <value>
aws fms disassociate-admin-account
aws fms put-admin-account --admin-account <value>
```
**Potansiyel Etki:** Merkezi yÃ¶netimin kaybÄ±, politika ihlali, uyumluluk ihlalleri ve ortam iÃ§indeki gÃ¼venlik kontrollerinin bozulmasÄ±.

### `fms:PutPolicy`, `fms:DeletePolicy`

**`fms:PutPolicy`**, **`fms:DeletePolicy`** izinlerine sahip bir saldÄ±rgan, bir AWS Firewall Manager politikasÄ±nÄ± oluÅŸturabilir, deÄŸiÅŸtirebilir veya kalÄ±cÄ± olarak silebilir.
```bash
aws fms put-policy --policy <value> | --cli-input-json file://<policy.json> [--tag-list <value>]
aws fms delete-policy --policy-id <value> [--delete-all-policy-resources | --no-delete-all-policy-resources]
```
Bir algÄ±lamayÄ± atlatmak iÃ§in izin verici gÃ¼venlik grubu aracÄ±lÄ±ÄŸÄ±yla izin verici politika Ã¶rneÄŸi aÅŸaÄŸÄ±daki gibi olabilir:
```json
{
"Policy": {
"PolicyName": "permisive_policy",
"SecurityServicePolicyData": {
"Type": "SECURITY_GROUPS_COMMON",
"ManagedServiceData": "{\"type\":\"SECURITY_GROUPS_COMMON\",\"securityGroups\":[{\"id\":\"<permisive_security_group_id>\"}], \"applyToAllEC2InstanceENIs\":\"true\",\"IncludeSharedVPC\":\"true\"}"
},
"ResourceTypeList": ["AWS::EC2::Instance", "AWS::EC2::NetworkInterface", "AWS::EC2::SecurityGroup", "AWS::ElasticLoadBalancingV2::LoadBalancer", "AWS::ElasticLoadBalancing::LoadBalancer"],
"ResourceType": "AWS::EC2::SecurityGroup",
"ExcludeResourceTags": false,
"ResourceTags": [],
"RemediationEnabled": true
},
"TagList": []
}
```
**Potansiyel Etki:** GÃ¼venlik kontrollerinin kaldÄ±rÄ±lmasÄ±, politika ihlalleri, uyumluluk ihlalleri, operasyonel kesintiler ve ortamda potansiyel veri ihlalleri.

### `fms:BatchAssociateResource`, `fms:BatchDisassociateResource`, `fms:PutResourceSet`, `fms:DeleteResourceSet`

**`fms:BatchAssociateResource`** ve **`fms:BatchDisassociateResource`** izinlerine sahip bir saldÄ±rgan, sÄ±rasÄ±yla bir Firewall Manager kaynak setinden kaynaklarÄ± iliÅŸkilendirebilir veya iliÅŸkilendirmeyi kaldÄ±rabilir. AyrÄ±ca, **`fms:PutResourceSet`** ve **`fms:DeleteResourceSet`** izinleri, bir saldÄ±rganÄ±n AWS Firewall Manager'dan bu kaynak setlerini oluÅŸturmasÄ±na, deÄŸiÅŸtirmesine veya silmesine olanak tanÄ±r.
```bash
# Associate/Disassociate resources from a resource set
aws fms batch-associate-resource --resource-set-identifier <value> --items <value>
aws fms batch-disassociate-resource --resource-set-identifier <value> --items <value>

# Create, modify or delete a resource set
aws fms put-resource-set --resource-set <value> [--tag-list <value>]
aws fms delete-resource-set --identifier <value>
```
**Potansiyel Etki:** Bir kaynak setine gereksiz miktarda Ã¶ÄŸe eklenmesi, Hizmette gÃ¼rÃ¼ltÃ¼ seviyesini artÄ±rarak potansiyel olarak bir DoS'a neden olabilir. AyrÄ±ca, kaynak setlerindeki deÄŸiÅŸiklikler kaynak kesintisine, politika ihlaline, uyumluluk ihlallerine ve ortam iÃ§indeki gÃ¼venlik kontrollerinin bozulmasÄ±na yol aÃ§abilir.

### `fms:PutAppsList`, `fms:DeleteAppsList`

**`fms:PutAppsList`** ve **`fms:DeleteAppsList`** izinlerine sahip bir saldÄ±rgan, AWS Firewall Manager'dan uygulama listeleri oluÅŸturabilir, deÄŸiÅŸtirebilir veya silebilir. Bu kritik olabilir, Ã§Ã¼nkÃ¼ yetkisiz uygulamalara genel halka eriÅŸim izni verilebilir veya yetkili uygulamalara eriÅŸim engellenebilir, bu da bir DoS'a neden olabilir.
```bash
aws fms put-apps-list --apps-list <value> [--tag-list <value>]
aws fms delete-apps-list --list-id <value>
```
**Potansiyel Etki:** Bu, yanlÄ±ÅŸ yapÄ±landÄ±rmalara, politika ihlallerine, uyumluluk ihlallerine ve ortam iÃ§indeki gÃ¼venlik kontrollerinin bozulmasÄ±na neden olabilir.

### `fms:PutProtocolsList`, `fms:DeleteProtocolsList`

**`fms:PutProtocolsList`** ve **`fms:DeleteProtocolsList`** izinlerine sahip bir saldÄ±rgan, AWS Firewall Manager'dan protokol listeleri oluÅŸturabilir, deÄŸiÅŸtirebilir veya silebilir. Uygulama listelerinde olduÄŸu gibi, bu da kritik olabilir Ã§Ã¼nkÃ¼ yetkisiz protokoller genel kamu tarafÄ±ndan kullanÄ±labilir veya yetkili protokollerin kullanÄ±mÄ± engellenebilir, bu da bir DoS'a neden olabilir.
```bash
aws fms put-protocols-list --apps-list <value> [--tag-list <value>]
aws fms delete-protocols-list --list-id <value>
```
**Potansiyel Etki:** Bu, yanlÄ±ÅŸ yapÄ±landÄ±rmalara, politika ihlallerine, uyumluluk ihlallerine ve ortam iÃ§indeki gÃ¼venlik kontrollerinin bozulmasÄ±na neden olabilir.

### `fms:PutNotificationChannel`, `fms:DeleteNotificationChannel`

**`fms:PutNotificationChannel`** ve **`fms:DeleteNotificationChannel`** izinlerine sahip bir saldÄ±rgan, Firewall Manager'Ä±n SNS gÃ¼nlÃ¼klerini kaydetmek iÃ§in kullandÄ±ÄŸÄ± IAM rolÃ¼nÃ¼ ve Amazon Simple Notification Service (SNS) konusunu silebilir ve belirleyebilir.

**`fms:PutNotificationChannel`**'Ä± konsol dÄ±ÅŸÄ±nda kullanmak iÃ§in, belirtilen **SnsRoleName**'in SNS gÃ¼nlÃ¼klerini yayÄ±nlamasÄ±na izin veren bir SNS konu eriÅŸim politikasÄ± ayarlamanÄ±z gerekir. SaÄŸlanan **SnsRoleName**, **`AWSServiceRoleForFMS`** dÄ±ÅŸÄ±nda bir rol ise, Firewall Manager hizmet prensipali **fms.amazonaws.com**'un bu rolÃ¼ Ã¼stlenmesine izin verecek ÅŸekilde bir gÃ¼ven iliÅŸkisi yapÄ±landÄ±rÄ±lmasÄ± gereklidir.

Bir SNS eriÅŸim politikasÄ± yapÄ±landÄ±rma hakkÄ±nda bilgi iÃ§in:

{% content-ref url="../aws-services/aws-sns-enum.md" %}
[aws-sns-enum.md](../aws-services/aws-sns-enum.md)
{% endcontent-ref %}
```bash
aws fms put-notification-channel --sns-topic-arn <value> --sns-role-name <value>
aws fms delete-notification-channel
```
**Potansiyel Etki:** Bu, gÃ¼venlik uyarÄ±larÄ±nÄ±n kaÃ§Ä±rÄ±lmasÄ±na, olay mÃ¼dahalesinin gecikmesine, potansiyel veri ihlallerine ve ortam iÃ§inde operasyonel kesintilere yol aÃ§abilir.

### `fms:AssociateThirdPartyFirewall`, `fms:DisssociateThirdPartyFirewall`
**`fms:AssociateThirdPartyFirewall`**, **`fms:DisssociateThirdPartyFirewall`** izinlerine sahip bir saldÄ±rgan, Ã¼Ã§Ã¼ncÃ¼ taraf gÃ¼venlik duvarlarÄ±nÄ± AWS Firewall Manager Ã¼zerinden merkezi olarak yÃ¶netilecek ÅŸekilde iliÅŸkilendirebilir veya iliÅŸkilendirmeyi kaldÄ±rabilir.
{% hint style="warning" %}
YalnÄ±zca varsayÄ±lan yÃ¶netici Ã¼Ã§Ã¼ncÃ¼ taraf gÃ¼venlik duvarlarÄ±nÄ± oluÅŸturabilir ve yÃ¶netebilir.
{% endhint %}
```bash
aws fms associate-third-party-firewall --third-party-firewall [PALO_ALTO_NETWORKS_CLOUD_NGFW | FORTIGATE_CLOUD_NATIVE_FIREWALL]
aws fms disassociate-third-party-firewall --third-party-firewall [PALO_ALTO_NETWORKS_CLOUD_NGFW | FORTIGATE_CLOUD_NATIVE_FIREWALL]
```
**Potansiyel Etki:** AyrÄ±lma, politika ihlaline, uyumluluk ihlallerine ve ortam iÃ§indeki gÃ¼venlik kontrollerinin bozulmasÄ±na yol aÃ§ar. Ã–te yandan, iliÅŸkilendirme maliyet ve bÃ¼tÃ§e tahsisatÄ±nÄ±n bozulmasÄ±na yol aÃ§ar.

### `fms:TagResource`, `fms:UntagResource`

Bir saldÄ±rgan, Firewall Manager kaynaklarÄ±ndan etiket ekleyebilir, deÄŸiÅŸtirebilir veya kaldÄ±rabilir, bu da organizasyonunuzun maliyet tahsisini, kaynak takibini ve etiketlere dayalÄ± eriÅŸim kontrol politikalarÄ±nÄ± bozabilir.
```bash
aws fms tag-resource --resource-arn <value> --tag-list <value>
aws fms untag-resource --resource-arn <value> --tag-keys <value>
```
**Potansiyel Etki**: Maliyet tahsisi, kaynak takibi ve etiket tabanlÄ± eriÅŸim kontrol politikalarÄ±nÄ±n bozulmasÄ±.

## Referanslar

* [https://docs.aws.amazon.com/govcloud-us/latest/UserGuide/govcloud-fms.html](https://docs.aws.amazon.com/govcloud-us/latest/UserGuide/govcloud-fms.html)
* [https://docs.aws.amazon.com/service-authorization/latest/reference/list_awsfirewallmanager.html](https://docs.aws.amazon.com/service-authorization/latest/reference/list_awsfirewallmanager.html)
* [https://docs.aws.amazon.com/waf/latest/developerguide/fms-chapter.html](https://docs.aws.amazon.com/waf/latest/developerguide/fms-chapter.html)

{% hint style="success" %}
AWS Hacking Ã¶ÄŸrenin ve pratik yapÄ±n:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCP Hacking Ã¶ÄŸrenin ve pratik yapÄ±n: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**abonelik planlarÄ±nÄ±**](https://github.com/sponsors/carlospolop) kontrol edin!
* **ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n ya da **Twitter'da** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **HackTricks ve** [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **github depolarÄ±na PR gÃ¶ndererek hacking ipuÃ§larÄ±nÄ± paylaÅŸÄ±n.**

</details>
{% endhint %}
