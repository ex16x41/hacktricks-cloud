# AWS - Firewall Manager Enum

{% hint style="success" %}
å­¦ä¹ ä¸å®è·µ AWS é»‘å®¢æŠ€æœ¯ï¼š<img src="../../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks åŸ¹è®­ AWS çº¢é˜Ÿä¸“å®¶ (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
å­¦ä¹ ä¸å®è·µ GCP é»‘å®¢æŠ€æœ¯ï¼š<img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks åŸ¹è®­ GCP çº¢é˜Ÿä¸“å®¶ (GRTE)**<img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>æ”¯æŒ HackTricks</summary>

* æŸ¥çœ‹ [**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**Telegram ç¾¤ç»„**](https://t.me/peass) æˆ– **å…³æ³¨** æˆ‘ä»¬çš„ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub ä»“åº“æäº¤ PR åˆ†äº«é»‘å®¢æŠ€å·§ã€‚

</details>
{% endhint %}

## Firewall Manager

**AWS Firewall Manager** ç®€åŒ–äº† **AWS WAFã€AWS Shield Advancedã€Amazon VPC å®‰å…¨ç»„å’Œç½‘ç»œè®¿é—®æ§åˆ¶åˆ—è¡¨ (ACL)ã€AWS ç½‘ç»œé˜²ç«å¢™ã€AWS Route 53 è§£æå™¨ DNS é˜²ç«å¢™å’Œç¬¬ä¸‰æ–¹é˜²ç«å¢™** çš„ç®¡ç†å’Œç»´æŠ¤ã€‚å®ƒä½¿æ‚¨èƒ½å¤Ÿä»…é…ç½®ä¸€æ¬¡é˜²ç«å¢™è§„åˆ™ã€Shield Advanced ä¿æŠ¤ã€VPC å®‰å…¨ç»„å’Œç½‘ç»œé˜²ç«å¢™è®¾ç½®ï¼ŒæœåŠ¡ **ä¼šè‡ªåŠ¨åœ¨æ‚¨çš„è´¦æˆ·å’Œèµ„æºä¸­å¼ºåˆ¶æ‰§è¡Œè¿™äº›è§„åˆ™å’Œä¿æŠ¤**ï¼ŒåŒ…æ‹¬æ–°æ·»åŠ çš„èµ„æºã€‚

è¯¥æœåŠ¡æä¾›äº† **å°†ç‰¹å®šèµ„æºåˆ†ç»„å’Œä¿æŠ¤åœ¨ä¸€èµ·** çš„èƒ½åŠ›ï¼Œä¾‹å¦‚å…±äº«å…¬å…±æ ‡ç­¾çš„èµ„æºæˆ–æ‚¨æ‰€æœ‰çš„ CloudFront åˆ†å‘ã€‚Firewall Manager çš„ä¸€ä¸ªæ˜¾è‘—ä¼˜åŠ¿æ˜¯å…¶èƒ½å¤Ÿ **è‡ªåŠ¨æ‰©å±•ä¿æŠ¤åˆ°æ–°æ·»åŠ çš„èµ„æº**ã€‚

ä¸€ä¸ª **è§„åˆ™ç»„**ï¼ˆWAF è§„åˆ™çš„é›†åˆï¼‰å¯ä»¥çº³å…¥ AWS Firewall Manager ç­–ç•¥ä¸­ï¼Œç„¶åé“¾æ¥åˆ°ç‰¹å®šçš„ AWS èµ„æºï¼Œå¦‚ CloudFront åˆ†å‘æˆ–åº”ç”¨è´Ÿè½½å‡è¡¡å™¨ã€‚

AWS Firewall Manager æä¾› **æ‰˜ç®¡çš„åº”ç”¨ç¨‹åºå’Œåè®®åˆ—è¡¨**ï¼Œä»¥ç®€åŒ–å®‰å…¨ç»„ç­–ç•¥çš„é…ç½®å’Œç®¡ç†ã€‚è¿™äº›åˆ—è¡¨å…è®¸æ‚¨å®šä¹‰æ”¿ç­–å…è®¸æˆ–æ‹’ç»çš„åè®®å’Œåº”ç”¨ç¨‹åºã€‚æ‰˜ç®¡åˆ—è¡¨æœ‰ä¸¤ç§ç±»å‹ï¼š

* **Firewall Manager æ‰˜ç®¡åˆ—è¡¨**ï¼šè¿™äº›åˆ—è¡¨åŒ…æ‹¬ **FMS-Default-Public-Access-Apps-Allowed**ã€**FMS-Default-Protocols-Allowed** å’Œ **FMS-Default-Protocols-Allowed**ã€‚å®ƒä»¬ç”± Firewall Manager ç®¡ç†ï¼ŒåŒ…å«åº”å…è®¸æˆ–æ‹’ç»å…¬ä¼—è®¿é—®çš„å¸¸ç”¨åº”ç”¨ç¨‹åºå’Œåè®®ã€‚æ— æ³•ç¼–è¾‘æˆ–åˆ é™¤å®ƒä»¬ï¼Œä½†å¯ä»¥é€‰æ‹©å…¶ç‰ˆæœ¬ã€‚
* **è‡ªå®šä¹‰æ‰˜ç®¡åˆ—è¡¨**ï¼šæ‚¨è‡ªå·±ç®¡ç†è¿™äº›åˆ—è¡¨ã€‚æ‚¨å¯ä»¥åˆ›å»ºç¬¦åˆç»„ç»‡éœ€æ±‚çš„è‡ªå®šä¹‰åº”ç”¨ç¨‹åºå’Œåè®®åˆ—è¡¨ã€‚ä¸ Firewall Manager æ‰˜ç®¡åˆ—è¡¨ä¸åŒï¼Œè¿™äº›åˆ—è¡¨æ²¡æœ‰ç‰ˆæœ¬ï¼Œä½†æ‚¨å¯ä»¥å®Œå…¨æ§åˆ¶è‡ªå®šä¹‰åˆ—è¡¨ï¼Œå…è®¸æ‚¨æ ¹æ®éœ€è¦åˆ›å»ºã€ç¼–è¾‘å’Œåˆ é™¤å®ƒä»¬ã€‚

éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ**Firewall Manager ç­–ç•¥ä»…å…è®¸â€œé˜»æ­¢â€æˆ–â€œè®¡æ•°â€æ“ä½œ**ï¼Œæ²¡æœ‰â€œå…è®¸â€é€‰é¡¹ã€‚

### å…ˆå†³æ¡ä»¶

åœ¨é…ç½® Firewall Manager ä»¥æœ‰æ•ˆä¿æŠ¤æ‚¨ç»„ç»‡çš„èµ„æºä¹‹å‰ï¼Œå¿…é¡»å®Œæˆä»¥ä¸‹å…ˆå†³æ­¥éª¤ã€‚è¿™äº›æ­¥éª¤æä¾›äº† Firewall Manager å¼ºåˆ¶æ‰§è¡Œå®‰å…¨ç­–ç•¥å’Œç¡®ä¿åˆè§„æ€§æ‰€éœ€çš„åŸºç¡€è®¾ç½®ï¼š

1. **åŠ å…¥å¹¶é…ç½® AWS Organizations**ï¼šç¡®ä¿æ‚¨çš„ AWS è´¦æˆ·æ˜¯è®¡åˆ’å®æ–½ AWS Firewall Manager ç­–ç•¥çš„ AWS Organizations ç»„ç»‡çš„ä¸€éƒ¨åˆ†ã€‚è¿™å…è®¸åœ¨ç»„ç»‡å†…å¤šä¸ª AWS è´¦æˆ·ä¹‹é—´é›†ä¸­ç®¡ç†èµ„æºå’Œæ”¿ç­–ã€‚
2. **åˆ›å»º AWS Firewall Manager é»˜è®¤ç®¡ç†å‘˜è´¦æˆ·**ï¼šå»ºç«‹ä¸€ä¸ªä¸“é—¨ç”¨äºç®¡ç† Firewall Manager å®‰å…¨ç­–ç•¥çš„é»˜è®¤ç®¡ç†å‘˜è´¦æˆ·ã€‚è¯¥è´¦æˆ·å°†è´Ÿè´£åœ¨ç»„ç»‡å†…é…ç½®å’Œå¼ºåˆ¶æ‰§è¡Œå®‰å…¨ç­–ç•¥ã€‚åªæœ‰ç»„ç»‡çš„ç®¡ç†è´¦æˆ·èƒ½å¤Ÿåˆ›å»º Firewall Manager é»˜è®¤ç®¡ç†å‘˜è´¦æˆ·ã€‚
3. **å¯ç”¨ AWS Config**ï¼šæ¿€æ´» AWS Configï¼Œä»¥ä¸º Firewall Manager æä¾›æœ‰æ•ˆå¼ºåˆ¶æ‰§è¡Œå®‰å…¨ç­–ç•¥æ‰€éœ€çš„é…ç½®æ•°æ®å’Œæ´å¯Ÿã€‚AWS Config æœ‰åŠ©äºåˆ†æã€å®¡è®¡ã€ç›‘æ§å’Œå®¡è®¡èµ„æºé…ç½®å’Œæ›´æ”¹ï¼Œä¿ƒè¿›æ›´å¥½çš„å®‰å…¨ç®¡ç†ã€‚
4. **å¯¹äºç¬¬ä¸‰æ–¹æ”¿ç­–ï¼Œåœ¨ AWS Marketplace è®¢é˜…å¹¶é…ç½®ç¬¬ä¸‰æ–¹è®¾ç½®**ï¼šå¦‚æœæ‚¨è®¡åˆ’ä½¿ç”¨ç¬¬ä¸‰æ–¹é˜²ç«å¢™æ”¿ç­–ï¼Œè¯·åœ¨ AWS Marketplace ä¸­è®¢é˜…å®ƒä»¬å¹¶é…ç½®å¿…è¦çš„è®¾ç½®ã€‚æ­¤æ­¥éª¤ç¡®ä¿ Firewall Manager èƒ½å¤Ÿé›†æˆå¹¶å¼ºåˆ¶æ‰§è¡Œæ¥è‡ªå—ä¿¡ä»»ç¬¬ä¸‰æ–¹ä¾›åº”å•†çš„æ”¿ç­–ã€‚
5. **å¯¹äºç½‘ç»œé˜²ç«å¢™å’Œ DNS é˜²ç«å¢™æ”¿ç­–ï¼Œå¯ç”¨èµ„æºå…±äº«**ï¼šä¸“é—¨ä¸ºç½‘ç»œé˜²ç«å¢™å’Œ DNS é˜²ç«å¢™æ”¿ç­–å¯ç”¨èµ„æºå…±äº«ã€‚è¿™å…è®¸ Firewall Manager å°†é˜²ç«å¢™ä¿æŠ¤åº”ç”¨äºæ‚¨ç»„ç»‡çš„ VPC å’Œ DNS è§£æï¼Œå¢å¼ºç½‘ç»œå®‰å…¨ã€‚
6. **åœ¨é»˜è®¤ç¦ç”¨çš„åŒºåŸŸä½¿ç”¨ AWS Firewall Manager**ï¼šå¦‚æœæ‚¨æ‰“ç®—åœ¨é»˜è®¤ç¦ç”¨çš„ AWS åŒºåŸŸä½¿ç”¨ Firewall Managerï¼Œè¯·ç¡®ä¿é‡‡å–å¿…è¦æ­¥éª¤ä»¥å¯ç”¨å…¶åœ¨è¿™äº›åŒºåŸŸçš„åŠŸèƒ½ã€‚è¿™ç¡®ä¿åœ¨æ‚¨ç»„ç»‡è¿è¥çš„æ‰€æœ‰åŒºåŸŸå†…ä¸€è‡´çš„å®‰å…¨å¼ºåˆ¶æ‰§è¡Œã€‚

æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·æŸ¥çœ‹ï¼š[å¼€å§‹ä½¿ç”¨ AWS Firewall Manager AWS WAF ç­–ç•¥](https://docs.aws.amazon.com/waf/latest/developerguide/getting-started-fms.html)ã€‚

### ä¿æŠ¤æ”¿ç­–ç±»å‹

AWS Firewall Manager ç®¡ç†å‡ ç§ç±»å‹çš„æ”¿ç­–ï¼Œä»¥åœ¨æ‚¨ç»„ç»‡çš„åŸºç¡€è®¾æ–½çš„ä¸åŒæ–¹é¢å¼ºåˆ¶æ‰§è¡Œå®‰å…¨æ§åˆ¶ï¼š

1. **AWS WAF ç­–ç•¥**ï¼šæ­¤ç­–ç•¥ç±»å‹æ”¯æŒ AWS WAF å’Œ AWS WAF Classicã€‚æ‚¨å¯ä»¥å®šä¹‰å“ªäº›èµ„æºå—åˆ°è¯¥ç­–ç•¥çš„ä¿æŠ¤ã€‚å¯¹äº AWS WAF ç­–ç•¥ï¼Œæ‚¨å¯ä»¥æŒ‡å®šè¦é¦–å…ˆå’Œæœ€åè¿è¡Œçš„è§„åˆ™ç»„é›†ã€‚æ­¤å¤–ï¼Œè´¦æˆ·æ‰€æœ‰è€…å¯ä»¥æ·»åŠ åœ¨è¿™äº›é›†åˆä¹‹é—´è¿è¡Œçš„è§„åˆ™å’Œè§„åˆ™ç»„ã€‚
2. **Shield Advanced ç­–ç•¥**ï¼šæ­¤ç­–ç•¥åœ¨ç»„ç»‡å†…ä¸ºæŒ‡å®šçš„èµ„æºç±»å‹åº”ç”¨ Shield Advanced ä¿æŠ¤ã€‚å®ƒæœ‰åŠ©äºé˜²èŒƒ DDoS æ”»å‡»å’Œå…¶ä»–å¨èƒã€‚
3. **Amazon VPC å®‰å…¨ç»„ç­–ç•¥**ï¼šé€šè¿‡æ­¤ç­–ç•¥ï¼Œæ‚¨å¯ä»¥ç®¡ç†åœ¨æ•´ä¸ªç»„ç»‡ä¸­ä½¿ç”¨çš„å®‰å…¨ç»„ï¼Œåœ¨æ‚¨çš„ AWS ç¯å¢ƒä¸­å¼ºåˆ¶æ‰§è¡Œä¸€ç»„åŸºçº¿è§„åˆ™ä»¥æ§åˆ¶ç½‘ç»œè®¿é—®ã€‚
4. **Amazon VPC ç½‘ç»œè®¿é—®æ§åˆ¶åˆ—è¡¨ (ACL) ç­–ç•¥**ï¼šæ­¤ç­–ç•¥ç±»å‹ä½¿æ‚¨èƒ½å¤Ÿæ§åˆ¶åœ¨ç»„ç»‡ä¸­ä½¿ç”¨çš„ç½‘ç»œ ACLï¼Œå…è®¸æ‚¨åœ¨ AWS ç¯å¢ƒä¸­å¼ºåˆ¶æ‰§è¡Œä¸€ç»„åŸºçº¿ç½‘ç»œ ACLã€‚
5. **ç½‘ç»œé˜²ç«å¢™ç­–ç•¥**ï¼šæ­¤ç­–ç•¥å°† AWS ç½‘ç»œé˜²ç«å¢™ä¿æŠ¤åº”ç”¨äºæ‚¨ç»„ç»‡çš„ VPCï¼Œå¢å¼ºç½‘ç»œå®‰å…¨ï¼Œé€šè¿‡é¢„å®šä¹‰è§„åˆ™è¿‡æ»¤æµé‡ã€‚
6. **Amazon Route 53 è§£æå™¨ DNS é˜²ç«å¢™ç­–ç•¥**ï¼šæ­¤ç­–ç•¥å°† DNS é˜²ç«å¢™ä¿æŠ¤åº”ç”¨äºæ‚¨ç»„ç»‡çš„ VPCï¼Œå¸®åŠ©é˜»æ­¢æ¶æ„åŸŸåè§£æå°è¯•å¹¶å¼ºåˆ¶æ‰§è¡Œ DNS æµé‡çš„å®‰å…¨ç­–ç•¥ã€‚
7. **ç¬¬ä¸‰æ–¹é˜²ç«å¢™ç­–ç•¥**ï¼šæ­¤ç­–ç•¥ç±»å‹åº”ç”¨æ¥è‡ªç¬¬ä¸‰æ–¹é˜²ç«å¢™çš„ä¿æŠ¤ï¼Œè¿™äº›é˜²ç«å¢™é€šè¿‡ AWS Marketplace æ§åˆ¶å°æä¾›è®¢é˜…ã€‚å®ƒå…è®¸æ‚¨å°†æ¥è‡ªå—ä¿¡ä»»ä¾›åº”å•†çš„é¢å¤–å®‰å…¨æªæ–½é›†æˆåˆ°æ‚¨çš„ AWS ç¯å¢ƒä¸­ã€‚
1. **Palo Alto Networks Cloud NGFW ç­–ç•¥**ï¼šæ­¤ç­–ç•¥å°† Palo Alto Networks Cloud ä¸‹ä¸€ä»£é˜²ç«å¢™ (NGFW) ä¿æŠ¤å’Œè§„åˆ™å †æ ˆåº”ç”¨äºæ‚¨ç»„ç»‡çš„ VPCï¼Œæä¾›é«˜çº§å¨èƒé˜²æŠ¤å’Œåº”ç”¨çº§å®‰å…¨æ§åˆ¶ã€‚
2. **Fortigate äº‘åŸç”Ÿé˜²ç«å¢™ (CNF) ä½œä¸ºæœåŠ¡ç­–ç•¥**ï¼šæ­¤ç­–ç•¥åº”ç”¨ Fortigate äº‘åŸç”Ÿé˜²ç«å¢™ (CNF) ä½œä¸ºæœåŠ¡çš„ä¿æŠ¤ï¼Œæä¾›è¡Œä¸šé¢†å…ˆçš„å¨èƒé˜²æŠ¤ã€Web åº”ç”¨é˜²ç«å¢™ (WAF) å’Œé’ˆå¯¹äº‘åŸºç¡€è®¾æ–½çš„ API ä¿æŠ¤ã€‚

### ç®¡ç†å‘˜è´¦æˆ·

AWS Firewall Manager é€šè¿‡å…¶ç®¡ç†èŒƒå›´å’Œä¸¤ç§ç±»å‹çš„ç®¡ç†å‘˜è´¦æˆ·æä¾›çµæ´»æ€§ï¼Œä»¥ç®¡ç†æ‚¨ç»„ç»‡å†…çš„é˜²ç«å¢™èµ„æºã€‚

**ç®¡ç†èŒƒå›´å®šä¹‰äº† Firewall Manager ç®¡ç†å‘˜å¯ä»¥ç®¡ç†çš„èµ„æº**ã€‚åœ¨ AWS Organizations ç®¡ç†è´¦æˆ·å°†ç»„ç»‡å¼•å…¥ Firewall Manager åï¼Œå®ƒå¯ä»¥åˆ›å»ºå…·æœ‰ä¸åŒç®¡ç†èŒƒå›´çš„å…¶ä»–ç®¡ç†å‘˜ã€‚è¿™äº›èŒƒå›´å¯ä»¥åŒ…æ‹¬ï¼š

* ç®¡ç†å‘˜å¯ä»¥åº”ç”¨æ”¿ç­–çš„è´¦æˆ·æˆ–ç»„ç»‡å•ä½ (OU)ã€‚
* ç®¡ç†å‘˜å¯ä»¥æ‰§è¡Œæ“ä½œçš„åŒºåŸŸã€‚
* ç®¡ç†å‘˜å¯ä»¥ç®¡ç†çš„ Firewall Manager ç­–ç•¥ç±»å‹ã€‚

ç®¡ç†èŒƒå›´å¯ä»¥æ˜¯ **å®Œå…¨æˆ–å—é™**ã€‚å®Œå…¨èŒƒå›´æˆäºˆç®¡ç†å‘˜å¯¹ **æ‰€æœ‰æŒ‡å®šèµ„æºç±»å‹ã€åŒºåŸŸå’Œç­–ç•¥ç±»å‹** çš„è®¿é—®æƒé™ã€‚ç›¸åï¼Œ**å—é™èŒƒå›´ä»…æä¾›å¯¹èµ„æºã€åŒºåŸŸæˆ–ç­–ç•¥ç±»å‹çš„å­é›†çš„ç®¡ç†æƒé™**ã€‚å»ºè®®ä»…æˆäºˆç®¡ç†å‘˜å®Œæˆå…¶è§’è‰²æ‰€éœ€çš„æƒé™ã€‚æ‚¨å¯ä»¥å°†è¿™äº›ç®¡ç†èŒƒå›´æ¡ä»¶çš„ä»»æ„ç»„åˆåº”ç”¨äºç®¡ç†å‘˜ï¼Œä»¥ç¡®ä¿éµå¾ªæœ€å°æƒé™åŸåˆ™ã€‚

æœ‰ä¸¤ç§ä¸åŒç±»å‹çš„ç®¡ç†å‘˜è´¦æˆ·ï¼Œæ¯ç§è´¦æˆ·éƒ½æœ‰ç‰¹å®šçš„è§’è‰²å’Œè´£ä»»ï¼š

* **é»˜è®¤ç®¡ç†å‘˜ï¼š**
* é»˜è®¤ç®¡ç†å‘˜è´¦æˆ·ç”± AWS Organizations ç»„ç»‡çš„ç®¡ç†è´¦æˆ·åœ¨å¼•å…¥ Firewall Manager è¿‡ç¨‹ä¸­åˆ›å»ºã€‚
* æ­¤è´¦æˆ·èƒ½å¤Ÿç®¡ç†ç¬¬ä¸‰æ–¹é˜²ç«å¢™ï¼Œå¹¶æ‹¥æœ‰å®Œå…¨çš„ç®¡ç†èŒƒå›´ã€‚
* å®ƒä½œä¸º Firewall Manager çš„ä¸»è¦ç®¡ç†å‘˜è´¦æˆ·ï¼Œè´Ÿè´£åœ¨ç»„ç»‡å†…é…ç½®å’Œå¼ºåˆ¶æ‰§è¡Œå®‰å…¨ç­–ç•¥ã€‚
* è™½ç„¶é»˜è®¤ç®¡ç†å‘˜å¯¹æ‰€æœ‰èµ„æºç±»å‹å’Œç®¡ç†åŠŸèƒ½å…·æœ‰å®Œå…¨è®¿é—®æƒé™ï¼Œä½†å¦‚æœåœ¨ç»„ç»‡å†…ä½¿ç”¨å¤šä¸ªç®¡ç†å‘˜ï¼Œå®ƒä¸å…¶ä»–ç®¡ç†å‘˜å¤„äºåŒä¸€åŒçº§ã€‚
* **Firewall Manager ç®¡ç†å‘˜ï¼š**
* è¿™äº›ç®¡ç†å‘˜å¯ä»¥åœ¨ AWS Organizations ç®¡ç†è´¦æˆ·æŒ‡å®šçš„èŒƒå›´å†…ç®¡ç†èµ„æºï¼Œå¦‚ç®¡ç†èŒƒå›´é…ç½®æ‰€å®šä¹‰çš„ã€‚
* Firewall Manager ç®¡ç†å‘˜æ˜¯ä¸ºäº†åœ¨ç»„ç»‡å†…å±¥è¡Œç‰¹å®šè§’è‰²è€Œåˆ›å»ºçš„ï¼Œå…è®¸åœ¨ä¿æŒå®‰å…¨å’Œåˆè§„æ ‡å‡†çš„åŒæ—¶è¿›è¡Œè´£ä»»çš„å§”æ´¾ã€‚
* åˆ›å»ºåï¼ŒFirewall Manager ä¼šä¸ AWS Organizations æ£€æŸ¥è¯¥è´¦æˆ·æ˜¯å¦å·²æ˜¯å§”æ´¾ç®¡ç†å‘˜ã€‚å¦‚æœä¸æ˜¯ï¼ŒFirewall Manager ä¼šè°ƒç”¨ Organizations å°†è¯¥è´¦æˆ·æŒ‡å®šä¸º Firewall Manager çš„å§”æ´¾ç®¡ç†å‘˜ã€‚

ç®¡ç†è¿™äº›ç®¡ç†å‘˜è´¦æˆ·æ¶‰åŠåœ¨ Firewall Manager ä¸­åˆ›å»ºå®ƒä»¬ï¼Œå¹¶æ ¹æ®ç»„ç»‡çš„å®‰å…¨è¦æ±‚å’Œæœ€å°æƒé™åŸåˆ™å®šä¹‰å…¶ç®¡ç†èŒƒå›´ã€‚é€šè¿‡åˆ†é…é€‚å½“çš„ç®¡ç†è§’è‰²ï¼Œç»„ç»‡å¯ä»¥ç¡®ä¿æœ‰æ•ˆçš„å®‰å…¨ç®¡ç†ï¼ŒåŒæ—¶ä¿æŒå¯¹æ•æ„Ÿèµ„æºè®¿é—®çš„ç»†ç²’åº¦æ§åˆ¶ã€‚

éœ€è¦å¼ºè°ƒçš„æ˜¯ï¼Œ**åœ¨ä¸€ä¸ªç»„ç»‡å†…åªèƒ½æœ‰ä¸€ä¸ªè´¦æˆ·ä½œä¸º Firewall Manager é»˜è®¤ç®¡ç†å‘˜**ï¼Œéµå¾ªâ€œ**å…ˆå…¥åå‡º**â€åŸåˆ™ã€‚è¦æŒ‡å®šæ–°çš„é»˜è®¤ç®¡ç†å‘˜ï¼Œå¿…é¡»éµå¾ªä¸€ç³»åˆ—æ­¥éª¤ï¼š

* é¦–å…ˆï¼Œæ¯ä¸ª Firewall Administrator ç®¡ç†å‘˜è´¦æˆ·å¿…é¡»æ’¤é”€è‡ªå·±çš„è´¦æˆ·ã€‚
* ç„¶åï¼Œç°æœ‰çš„é»˜è®¤ç®¡ç†å‘˜å¯ä»¥æ’¤é”€è‡ªå·±çš„è´¦æˆ·ï¼Œæœ‰æ•ˆåœ°å°†ç»„ç»‡ä» Firewall Manager ä¸­ç§»é™¤ã€‚æ­¤è¿‡ç¨‹å°†å¯¼è‡´æ’¤é”€è´¦æˆ·åˆ›å»ºçš„æ‰€æœ‰ Firewall Manager ç­–ç•¥è¢«åˆ é™¤ã€‚
* æœ€åï¼ŒAWS Organizations ç®¡ç†è´¦æˆ·å¿…é¡»æŒ‡å®š Firewall Manager é»˜è®¤ç®¡ç†å‘˜ã€‚

## Enumeration
```
# Users/Administrators

## Get the AWS Organizations account that is associated with AWS Firewall Manager as the AWS Firewall Manager default administrator
aws fms get-admin-account

## List of Firewall Manager administrators within the organization
aws fms list-admin-accounts-for-organization # ReadOnlyAccess policy is not enough for this

## Return a list of the member accounts in the FM administrator's AWS organization
aws fms list-member-accounts # Only a Firewall Manager administrator or the Organization's management account can make this request

## List the accounts that are managing the specified AWS Organizations member account
aws fms list-admins-managing-account # ReadOnlyAccess policy is not enough for this

# Resources

## Get the resources that a Firewall Manager administrator can manage
aws fms get-admin-scope --admin-account <value> # ReadOnlyAccess policy is not enough for this

## Returns the summary of the resource sets used
aws fms list-resource-sets # ReadOnlyAccess policy is not enough for this

## Get information about a specific resource set
aws fms get-resource-set --identifier <value>  # ReadOnlyAccess policy is not enough for this

## Retrieve the list of tags for a given resource
aws fms list-tags-for-resource --resource-arn <value>

## List of the resources in the AWS Organization's accounts that are available to be associated with a FM resource set. Only one account is supported per request.
aws fms list-compliance-status --member-account-ids <value> --resource-type <value> # ReadOnlyAccess policy is not enough for this

## List the resources that are currently associated to a resource set
aws fms list-resource-set-resources --identifier <value> # ReadOnlyAccess policy is not enough for this

# Policies

## Returns the list of policies
aws fms list-policies

## Get information about the specified AWS Firewall Manager policy
aws fms get-policy --policy-id <value>

## List all of the third-party firewall policies that are associated with the third-party firewall administrator's account
aws fms list-third-party-firewall-firewall-policies --third-party-firewall <PALO_ALTO_NETWORKS_CLOUD_NGFW|FORTIGATE_CLOUD_NATIVE_FIREWALL> # ReadOnlyAccess policy is not enough for this

# AppsList

## Return a list of apps list
aws fms list-apps-lists --max-results [1-100]

## Get information about the specified AWS Firewall Manager applications list
aws fms get-apps-list --list-id <value>

# Protocols

## Get the details of the Firewall Manager protocols list.
aws fms list-protocols-lists

## Get information about the specified AWS Firewall Manager Protocols list
aws fms get-protocols-list --list-id <value>

# Compliance

## Return a summary of which member accounts are protected by the specified policy
aws fms list-compliance-status --policy-id <policy-id>

## Get detailed compliance information about the specified member account (resources that are in and out of compliance with the specified policy)
aws fms get-compliance-detail --policy-id <value> --member-account <value>

# Other useful info

## Get information about the SNS topic that is used to record AWS Firewall Manager SNS logs (if any)
aws fms get-notification-channel

## Get policy-level attack summary information in the event of a potential DDoS attack
aws fms get-protection-status --policy-id <value> # Just for Shield Advanced policy

## Get the onboarding status of a Firewall Manager admin account to third-party firewall vendor tenant.
aws fms get-third-party-firewall-association-status --third-party-firewall <PALO_ALTO_NETWORKS_CLOUD_NGFW|FORTIGATE_CLOUD_NATIVE_FIREWALL> # ReadOnlyAccess policy is not enough for this

## Get violations' details for a resource based on the specified AWS Firewall Manager policy and AWS account.
aws fms get-violation-details --policy-id <value> --member-account <value> --resource-id <value> --resource-type <value>
```
## åæœŸåˆ©ç”¨ / ç»•è¿‡æ£€æµ‹

### `organizations:DescribeOrganization` & (`fms:AssociateAdminAccount`, `fms:DisassociateAdminAccount`, `fms:PutAdminAccount`)

æ‹¥æœ‰ **`fms:AssociateAdminAccount`** æƒé™çš„æ”»å‡»è€…å°†èƒ½å¤Ÿè®¾ç½®é˜²ç«å¢™ç®¡ç†å™¨é»˜è®¤ç®¡ç†å‘˜è´¦æˆ·ã€‚æ‹¥æœ‰ **`fms:PutAdminAccount`** æƒé™çš„æ”»å‡»è€…å°†èƒ½å¤Ÿåˆ›å»ºæˆ–æ›´æ–°é˜²ç«å¢™ç®¡ç†å™¨ç®¡ç†å‘˜è´¦æˆ·ï¼Œè€Œæ‹¥æœ‰ **`fms:DisassociateAdminAccount`** æƒé™çš„æ½œåœ¨æ”»å‡»è€…å¯ä»¥ç§»é™¤å½“å‰çš„é˜²ç«å¢™ç®¡ç†å™¨ç®¡ç†å‘˜è´¦æˆ·å…³è”ã€‚

* **é˜²ç«å¢™ç®¡ç†å™¨é»˜è®¤ç®¡ç†å‘˜çš„è§£é™¤å…³è”éµå¾ªå…ˆè¿›åå‡ºæ”¿ç­–**ã€‚æ‰€æœ‰é˜²ç«å¢™ç®¡ç†å™¨ç®¡ç†å‘˜å¿…é¡»è§£é™¤å…³è”ï¼Œæ‰èƒ½è®©é˜²ç«å¢™ç®¡ç†å™¨é»˜è®¤ç®¡ç†å‘˜è§£é™¤è¯¥è´¦æˆ·çš„å…³è”ã€‚
* è¦é€šè¿‡ **PutAdminAccount** åˆ›å»ºé˜²ç«å¢™ç®¡ç†å™¨ç®¡ç†å‘˜ï¼Œè´¦æˆ·å¿…é¡»å±äºä¹‹å‰é€šè¿‡ **AssociateAdminAccount** åŠ å…¥é˜²ç«å¢™ç®¡ç†å™¨çš„ç»„ç»‡ã€‚
* é˜²ç«å¢™ç®¡ç†å™¨ç®¡ç†å‘˜è´¦æˆ·çš„åˆ›å»ºåªèƒ½ç”±ç»„ç»‡çš„ç®¡ç†è´¦æˆ·å®Œæˆã€‚
```bash
aws fms associate-admin-account --admin-account <value>
aws fms disassociate-admin-account
aws fms put-admin-account --admin-account <value>
```
**æ½œåœ¨å½±å“ï¼š** ä¸­å¿ƒåŒ–ç®¡ç†çš„ä¸§å¤±ã€ç­–ç•¥è§„é¿ã€åˆè§„æ€§è¿è§„ä»¥åŠç¯å¢ƒä¸­å®‰å…¨æ§åˆ¶çš„ä¸­æ–­ã€‚

### `fms:PutPolicy`, `fms:DeletePolicy`

æ‹¥æœ‰ **`fms:PutPolicy`**ã€**`fms:DeletePolicy`** æƒé™çš„æ”»å‡»è€…å°†èƒ½å¤Ÿåˆ›å»ºã€ä¿®æ”¹æˆ–æ°¸ä¹…åˆ é™¤ AWS Firewall Manager ç­–ç•¥ã€‚
```bash
aws fms put-policy --policy <value> | --cli-input-json file://<policy.json> [--tag-list <value>]
aws fms delete-policy --policy-id <value> [--delete-all-policy-resources | --no-delete-all-policy-resources]
```
ä¸€ä¸ªé€šè¿‡å®½æ¾å®‰å…¨ç»„çš„å®½æ¾ç­–ç•¥ç¤ºä¾‹ï¼Œä¸ºäº†ç»•è¿‡æ£€æµ‹ï¼Œå¯ä»¥æ˜¯ä»¥ä¸‹å†…å®¹ï¼š
```json
{
"Policy": {
"PolicyName": "permisive_policy",
"SecurityServicePolicyData": {
"Type": "SECURITY_GROUPS_COMMON",
"ManagedServiceData": "{\"type\":\"SECURITY_GROUPS_COMMON\",\"securityGroups\":[{\"id\":\"<permisive_security_group_id>\"}], \"applyToAllEC2InstanceENIs\":\"true\",\"IncludeSharedVPC\":\"true\"}"
},
"ResourceTypeList": ["AWS::EC2::Instance", "AWS::EC2::NetworkInterface", "AWS::EC2::SecurityGroup", "AWS::ElasticLoadBalancingV2::LoadBalancer", "AWS::ElasticLoadBalancing::LoadBalancer"],
"ResourceType": "AWS::EC2::SecurityGroup",
"ExcludeResourceTags": false,
"ResourceTags": [],
"RemediationEnabled": true
},
"TagList": []
}
```
**æ½œåœ¨å½±å“ï¼š** å®‰å…¨æ§åˆ¶çš„æ‹†è§£ã€æ”¿ç­–è§„é¿ã€åˆè§„æ€§è¿è§„ã€æ“ä½œä¸­æ–­ï¼Œä»¥åŠç¯å¢ƒå†…æ½œåœ¨çš„æ•°æ®æ³„éœ²ã€‚

### `fms:BatchAssociateResource`, `fms:BatchDisassociateResource`, `fms:PutResourceSet`, `fms:DeleteResourceSet`

æ‹¥æœ‰ **`fms:BatchAssociateResource`** å’Œ **`fms:BatchDisassociateResource`** æƒé™çš„æ”»å‡»è€…å°†èƒ½å¤Ÿåˆ†åˆ«å°†èµ„æºå…³è”æˆ–å–æ¶ˆå…³è”åˆ°é˜²ç«å¢™ç®¡ç†å™¨èµ„æºé›†ã€‚æ­¤å¤–ï¼Œ**`fms:PutResourceSet`** å’Œ **`fms:DeleteResourceSet`** æƒé™å°†å…è®¸æ”»å‡»è€…åˆ›å»ºã€ä¿®æ”¹æˆ–åˆ é™¤è¿™äº›èµ„æºé›†ã€‚
```bash
# Associate/Disassociate resources from a resource set
aws fms batch-associate-resource --resource-set-identifier <value> --items <value>
aws fms batch-disassociate-resource --resource-set-identifier <value> --items <value>

# Create, modify or delete a resource set
aws fms put-resource-set --resource-set <value> [--tag-list <value>]
aws fms delete-resource-set --identifier <value>
```
**æ½œåœ¨å½±å“ï¼š** å‘èµ„æºé›†æ·»åŠ ä¸å¿…è¦çš„é¡¹ç›®å°†å¢åŠ æœåŠ¡ä¸­çš„å™ªéŸ³æ°´å¹³ï¼Œå¯èƒ½å¯¼è‡´DoSã€‚æ­¤å¤–ï¼Œèµ„æºé›†çš„å˜åŒ–å¯èƒ½å¯¼è‡´èµ„æºä¸­æ–­ã€ç­–ç•¥è§„é¿ã€åˆè§„æ€§è¿è§„ä»¥åŠç¯å¢ƒä¸­å®‰å…¨æ§åˆ¶çš„ä¸­æ–­ã€‚

### `fms:PutAppsList`, `fms:DeleteAppsList`

æ‹¥æœ‰**`fms:PutAppsList`**å’Œ**`fms:DeleteAppsList`**æƒé™çš„æ”»å‡»è€…å°†èƒ½å¤Ÿåˆ›å»ºã€ä¿®æ”¹æˆ–åˆ é™¤AWS Firewall Managerä¸­çš„åº”ç”¨ç¨‹åºåˆ—è¡¨ã€‚è¿™å¯èƒ½æ˜¯å…³é”®çš„ï¼Œå› ä¸ºæœªç»æˆæƒçš„åº”ç”¨ç¨‹åºå¯èƒ½è¢«å…è®¸è®¿é—®å…¬ä¼—ï¼Œæˆ–è€…å¯¹æˆæƒåº”ç”¨ç¨‹åºçš„è®¿é—®å¯èƒ½è¢«æ‹’ç»ï¼Œä»è€Œå¯¼è‡´DoSã€‚
```bash
aws fms put-apps-list --apps-list <value> [--tag-list <value>]
aws fms delete-apps-list --list-id <value>
```
**æ½œåœ¨å½±å“ï¼š** è¿™å¯èƒ½å¯¼è‡´é…ç½®é”™è¯¯ã€ç­–ç•¥è§„é¿ã€åˆè§„æ€§è¿è§„ä»¥åŠç¯å¢ƒä¸­å®‰å…¨æ§åˆ¶çš„ä¸­æ–­ã€‚

### `fms:PutProtocolsList`, `fms:DeleteProtocolsList`

æ‹¥æœ‰ **`fms:PutProtocolsList`** å’Œ **`fms:DeleteProtocolsList`** æƒé™çš„æ”»å‡»è€…å°†èƒ½å¤Ÿä» AWS Firewall Manager åˆ›å»ºã€ä¿®æ”¹æˆ–åˆ é™¤åè®®åˆ—è¡¨ã€‚ä¸åº”ç”¨ç¨‹åºåˆ—è¡¨ç±»ä¼¼ï¼Œè¿™å¯èƒ½æ˜¯å…³é”®çš„ï¼Œå› ä¸ºæœªç»æˆæƒçš„åè®®å¯èƒ½è¢«å…¬ä¼—ä½¿ç”¨ï¼Œæˆ–è€…æˆæƒåè®®çš„ä½¿ç”¨å¯èƒ½è¢«æ‹’ç»ï¼Œä»è€Œå¯¼è‡´ DoSã€‚
```bash
aws fms put-protocols-list --apps-list <value> [--tag-list <value>]
aws fms delete-protocols-list --list-id <value>
```
**æ½œåœ¨å½±å“ï¼š** è¿™å¯èƒ½å¯¼è‡´é…ç½®é”™è¯¯ã€ç­–ç•¥è§„é¿ã€åˆè§„æ€§è¿è§„ä»¥åŠç¯å¢ƒä¸­å®‰å…¨æ§åˆ¶çš„ä¸­æ–­ã€‚

### `fms:PutNotificationChannel`, `fms:DeleteNotificationChannel`

æ‹¥æœ‰ **`fms:PutNotificationChannel`** å’Œ **`fms:DeleteNotificationChannel`** æƒé™çš„æ”»å‡»è€…å°†èƒ½å¤Ÿåˆ é™¤å’ŒæŒ‡å®š Firewall Manager ç”¨äºè®°å½• SNS æ—¥å¿—çš„ IAM è§’è‰²å’Œ Amazon Simple Notification Service (SNS) ä¸»é¢˜ã€‚

è¦åœ¨æ§åˆ¶å°å¤–ä½¿ç”¨ **`fms:PutNotificationChannel`**ï¼Œæ‚¨éœ€è¦è®¾ç½® SNS ä¸»é¢˜çš„è®¿é—®ç­–ç•¥ï¼Œå…è®¸æŒ‡å®šçš„ **SnsRoleName** å‘å¸ƒ SNS æ—¥å¿—ã€‚å¦‚æœæä¾›çš„ **SnsRoleName** æ˜¯é™¤ **`AWSServiceRoleForFMS`** ä¹‹å¤–çš„è§’è‰²ï¼Œåˆ™éœ€è¦é…ç½®ä¿¡ä»»å…³ç³»ï¼Œä»¥å…è®¸ Firewall Manager æœåŠ¡ä¸»ä½“ **fms.amazonaws.com** å‡è®¾è¯¥è§’è‰²ã€‚

æœ‰å…³é…ç½® SNS è®¿é—®ç­–ç•¥çš„ä¿¡æ¯ï¼š

{% content-ref url="../aws-services/aws-sns-enum.md" %}
[aws-sns-enum.md](../aws-services/aws-sns-enum.md)
{% endcontent-ref %}
```bash
aws fms put-notification-channel --sns-topic-arn <value> --sns-role-name <value>
aws fms delete-notification-channel
```
**æ½œåœ¨å½±å“ï¼š** è¿™å¯èƒ½å¯¼è‡´é”™è¿‡å®‰å…¨è­¦æŠ¥ã€å»¶è¿Ÿäº‹ä»¶å“åº”ã€æ½œåœ¨çš„æ•°æ®æ³„éœ²å’Œç¯å¢ƒå†…çš„æ“ä½œä¸­æ–­ã€‚

### `fms:AssociateThirdPartyFirewall`, `fms:DisssociateThirdPartyFirewall`

æ‹¥æœ‰ **`fms:AssociateThirdPartyFirewall`** å’Œ **`fms:DisssociateThirdPartyFirewall`** æƒé™çš„æ”»å‡»è€…å°†èƒ½å¤Ÿå°†ç¬¬ä¸‰æ–¹é˜²ç«å¢™å…³è”æˆ–è§£é™¤å…³è”ï¼Œä»¥ä¾¿é€šè¿‡ AWS Firewall Manager è¿›è¡Œé›†ä¸­ç®¡ç†ã€‚

{% hint style="warning" %}
åªæœ‰é»˜è®¤ç®¡ç†å‘˜å¯ä»¥åˆ›å»ºå’Œç®¡ç†ç¬¬ä¸‰æ–¹é˜²ç«å¢™ã€‚
{% endhint %}
```bash
aws fms associate-third-party-firewall --third-party-firewall [PALO_ALTO_NETWORKS_CLOUD_NGFW | FORTIGATE_CLOUD_NATIVE_FIREWALL]
aws fms disassociate-third-party-firewall --third-party-firewall [PALO_ALTO_NETWORKS_CLOUD_NGFW | FORTIGATE_CLOUD_NATIVE_FIREWALL]
```
**æ½œåœ¨å½±å“ï¼š** è§£é™¤å…³è”å°†å¯¼è‡´æ”¿ç­–è§„é¿ã€åˆè§„æ€§è¿è§„ä»¥åŠç¯å¢ƒå†…å®‰å…¨æ§åˆ¶çš„ä¸­æ–­ã€‚å¦ä¸€æ–¹é¢ï¼Œå…³è”å°†å¯¼è‡´æˆæœ¬å’Œé¢„ç®—åˆ†é…çš„ä¸­æ–­ã€‚

### `fms:TagResource`, `fms:UntagResource`

æ”»å‡»è€…å°†èƒ½å¤Ÿæ·»åŠ ã€ä¿®æ”¹æˆ–åˆ é™¤é˜²ç«å¢™ç®¡ç†å™¨èµ„æºçš„æ ‡ç­¾ï¼Œä»è€Œå¹²æ‰°æ‚¨ç»„ç»‡åŸºäºæ ‡ç­¾çš„æˆæœ¬åˆ†é…ã€èµ„æºè·Ÿè¸ªå’Œè®¿é—®æ§åˆ¶æ”¿ç­–ã€‚
```bash
aws fms tag-resource --resource-arn <value> --tag-list <value>
aws fms untag-resource --resource-arn <value> --tag-keys <value>
```
**æ½œåœ¨å½±å“**ï¼šæˆæœ¬åˆ†é…ã€èµ„æºè·Ÿè¸ªå’ŒåŸºäºæ ‡ç­¾çš„è®¿é—®æ§åˆ¶ç­–ç•¥çš„ä¸­æ–­ã€‚

## å‚è€ƒæ–‡çŒ®

* [https://docs.aws.amazon.com/govcloud-us/latest/UserGuide/govcloud-fms.html](https://docs.aws.amazon.com/govcloud-us/latest/UserGuide/govcloud-fms.html)
* [https://docs.aws.amazon.com/service-authorization/latest/reference/list\_awsfirewallmanager.html](https://docs.aws.amazon.com/service-authorization/latest/reference/list\_awsfirewallmanager.html)
* [https://docs.aws.amazon.com/waf/latest/developerguide/fms-chapter.html](https://docs.aws.amazon.com/waf/latest/developerguide/fms-chapter.html)

{% hint style="success" %}
å­¦ä¹ ä¸å®è·µ AWS é»‘å®¢æŠ€æœ¯ï¼š<img src="../../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks åŸ¹è®­ AWS çº¢é˜Ÿä¸“å®¶ (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
å­¦ä¹ ä¸å®è·µ GCP é»‘å®¢æŠ€æœ¯ï¼š<img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks åŸ¹è®­ GCP çº¢é˜Ÿä¸“å®¶ (GRTE)**<img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>æ”¯æŒ HackTricks</summary>

* æŸ¥çœ‹ [**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**Telegram ç¾¤ç»„**](https://t.me/peass) æˆ– **å…³æ³¨** æˆ‘ä»¬çš„ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub ä»“åº“æäº¤ PR æ¥åˆ†äº«é»‘å®¢æŠ€å·§ã€‚

</details>
{% endhint %}
