# AWS - Firewall Manager Enum

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Firewall Manager

**AWS Firewall Manager** simplifie la gestion et la maintenance de **AWS WAF, AWS Shield Advanced, les groupes de s√©curit√© Amazon VPC et les listes de contr√¥le d'acc√®s r√©seau (ACL), ainsi que AWS Network Firewall, AWS Route 53 Resolver DNS Firewall et les pare-feu tiers** √† travers plusieurs comptes et ressources. Il vous permet de configurer vos r√®gles de pare-feu, protections Shield Advanced, groupes de s√©curit√© VPC et param√®tres de Network Firewall une seule fois, le service **appliquant automatiquement ces r√®gles et protections √† vos comptes et ressources**, y compris celles nouvellement ajout√©es.

Le service offre la capacit√© de **grouper et prot√©ger des ressources sp√©cifiques ensemble**, comme celles partageant une √©tiquette commune ou toutes vos distributions CloudFront. Un avantage significatif de Firewall Manager est sa capacit√© √† **√©tendre automatiquement la protection aux ressources nouvellement ajout√©es** dans votre compte.

Un **groupe de r√®gles** (une collection de r√®gles WAF) peut √™tre int√©gr√© dans une politique AWS Firewall Manager, qui est ensuite li√©e √† des ressources AWS sp√©cifiques telles que des distributions CloudFront ou des √©quilibreurs de charge d'application.

AWS Firewall Manager fournit des **listes d'applications et de protocoles g√©r√©es** pour simplifier la configuration et la gestion des politiques de groupe de s√©curit√©. Ces listes vous permettent de d√©finir les protocoles et applications autoris√©s ou refus√©s par vos politiques. Il existe deux types de listes g√©r√©es :

* **Listes g√©r√©es par Firewall Manager** : Ces listes incluent **FMS-Default-Public-Access-Apps-Allowed**, **FMS-Default-Protocols-Allowed** et **FMS-Default-Protocols-Allowed**. Elles sont g√©r√©es par Firewall Manager et incluent des applications et protocoles couramment utilis√©s qui devraient √™tre autoris√©s ou refus√©s au grand public. Il n'est pas possible de les modifier ou de les supprimer, cependant, vous pouvez choisir sa version.
* **Listes g√©r√©es personnalis√©es** : Vous g√©rez ces listes vous-m√™me. Vous pouvez cr√©er des listes d'applications et de protocoles personnalis√©es adapt√©es aux besoins de votre organisation. Contrairement aux listes g√©r√©es par Firewall Manager, ces listes n'ont pas de versions, mais vous avez un contr√¥le total sur les listes personnalis√©es, vous permettant de les cr√©er, modifier et supprimer selon vos besoins.

Il est important de noter que **les politiques de Firewall Manager n'autorisent que les actions "Block" ou "Count"** pour un groupe de r√®gles, sans option "Allow".

### Pr√©requis

Les √©tapes pr√©alables suivantes doivent √™tre compl√©t√©es avant de proc√©der √† la configuration de Firewall Manager pour commencer √† prot√©ger efficacement les ressources de votre organisation. Ces √©tapes fournissent la configuration de base requise pour que Firewall Manager applique des politiques de s√©curit√© et assure la conformit√© dans votre environnement AWS :

1. **Rejoindre et configurer AWS Organizations :** Assurez-vous que votre compte AWS fait partie de l'organisation AWS Organizations o√π les politiques AWS Firewall Manager sont pr√©vues pour √™tre implant√©es. Cela permet une gestion centralis√©e des ressources et des politiques √† travers plusieurs comptes AWS au sein de l'organisation.
2. **Cr√©er un compte administrateur par d√©faut AWS Firewall Manager :** √âtablissez un compte administrateur par d√©faut sp√©cifiquement pour g√©rer les politiques de s√©curit√© de Firewall Manager. Ce compte sera responsable de la configuration et de l'application des politiques de s√©curit√© √† travers l'organisation. Seul le compte de gestion de l'organisation peut cr√©er des comptes administrateurs par d√©faut pour Firewall Manager.
3. **Activer AWS Config :** Activez AWS Config pour fournir √† Firewall Manager les donn√©es de configuration et les informations n√©cessaires pour appliquer efficacement les politiques de s√©curit√©. AWS Config aide √† analyser, auditer, surveiller et auditer les configurations et changements de ressources, facilitant une meilleure gestion de la s√©curit√©.
4. **Pour les politiques tierces, abonnez-vous dans le AWS Marketplace et configurez les param√®tres tiers :** Si vous pr√©voyez d'utiliser des politiques de pare-feu tierces, abonnez-vous √† celles-ci dans le AWS Marketplace et configurez les param√®tres n√©cessaires. Cette √©tape garantit que Firewall Manager peut int√©grer et appliquer des politiques de fournisseurs tiers de confiance.
5. **Pour les politiques de Network Firewall et DNS Firewall, activez le partage de ressources :** Activez le partage de ressources sp√©cifiquement pour les politiques de Network Firewall et DNS Firewall. Cela permet √† Firewall Manager d'appliquer des protections de pare-feu √† vos VPC et √† la r√©solution DNS de l'organisation, renfor√ßant la s√©curit√© du r√©seau.
6. **Pour utiliser AWS Firewall Manager dans des r√©gions qui sont d√©sactiv√©es par d√©faut :** Si vous avez l'intention d'utiliser Firewall Manager dans des r√©gions AWS qui sont d√©sactiv√©es par d√©faut, assurez-vous de prendre les mesures n√©cessaires pour activer sa fonctionnalit√© dans ces r√©gions. Cela garantit une application coh√©rente de la s√©curit√© dans toutes les r√©gions o√π votre organisation op√®re.

Pour plus d'informations, consultez : [Getting started with AWS Firewall Manager AWS WAF policies](https://docs.aws.amazon.com/waf/latest/developerguide/getting-started-fms.html).

### Types de politiques de protection

AWS Firewall Manager g√®re plusieurs types de politiques pour appliquer des contr√¥les de s√©curit√© √† diff√©rents aspects de l'infrastructure de votre organisation :

1. **Politique AWS WAF :** Ce type de politique prend en charge √† la fois AWS WAF et AWS WAF Classic. Vous pouvez d√©finir quelles ressources sont prot√©g√©es par la politique. Pour les politiques AWS WAF, vous pouvez sp√©cifier des ensembles de groupes de r√®gles √† ex√©cuter en premier et en dernier dans le web ACL. De plus, les propri√©taires de compte peuvent ajouter des r√®gles et des groupes de r√®gles √† ex√©cuter entre ces ensembles.
2. **Politique Shield Advanced :** Cette politique applique des protections Shield Advanced √† travers votre organisation pour des types de ressources sp√©cifi√©s. Elle aide √† prot√©ger contre les attaques DDoS et autres menaces.
3. **Politique de groupe de s√©curit√© Amazon VPC :** Avec cette politique, vous pouvez g√©rer les groupes de s√©curit√© utilis√©s dans toute votre organisation, appliquant un ensemble de r√®gles de base √† travers votre environnement AWS pour contr√¥ler l'acc√®s au r√©seau.
4. **Politique de liste de contr√¥le d'acc√®s r√©seau (ACL) Amazon VPC :** Ce type de politique vous donne le contr√¥le sur les ACL r√©seau utilis√©s dans votre organisation, vous permettant d'appliquer un ensemble de base d'ACL r√©seau √† travers votre environnement AWS.
5. **Politique de Network Firewall :** Cette politique applique la protection AWS Network Firewall √† vos VPC, renfor√ßant la s√©curit√© du r√©seau en filtrant le trafic en fonction de r√®gles pr√©d√©finies.
6. **Politique de DNS Firewall Amazon Route 53 Resolver :** Cette politique applique des protections DNS Firewall √† vos VPC, aidant √† bloquer les tentatives de r√©solution de domaine malveillantes et √† appliquer des politiques de s√©curit√© pour le trafic DNS.
7. **Politique de pare-feu tiers :** Ce type de politique applique des protections provenant de pare-feu tiers, qui sont disponibles par abonnement via la console AWS Marketplace. Elle vous permet d'int√©grer des mesures de s√©curit√© suppl√©mentaires de fournisseurs de confiance dans votre environnement AWS.
1. **Politique Palo Alto Networks Cloud NGFW :** Cette politique applique des protections et des ensembles de r√®gles du pare-feu de nouvelle g√©n√©ration (NGFW) Palo Alto Networks Cloud √† vos VPC, fournissant une pr√©vention avanc√©e des menaces et des contr√¥les de s√©curit√© au niveau des applications.
2. **Politique Fortigate Cloud Native Firewall (CNF) as a Service :** Cette politique applique des protections Fortigate Cloud Native Firewall (CNF) as a Service, offrant une pr√©vention des menaces de premier plan, un pare-feu d'application web (WAF) et une protection API adapt√©s aux infrastructures cloud.

### Comptes administrateurs

AWS Firewall Manager offre de la flexibilit√© dans la gestion des ressources de pare-feu au sein de votre organisation gr√¢ce √† son champ d'application administratif et √† deux types de comptes administrateurs.

**Le champ d'application administratif d√©finit les ressources qu'un administrateur de Firewall Manager peut g√©rer**. Apr√®s qu'un compte de gestion AWS Organizations ait int√©gr√© une organisation √† Firewall Manager, il peut cr√©er des administrateurs suppl√©mentaires avec diff√©rents champs d'application administratifs. Ces champs peuvent inclure :

* Comptes ou unit√©s organisationnelles (OU) auxquels l'administrateur peut appliquer des politiques.
* R√©gions o√π l'administrateur peut effectuer des actions.
* Types de politiques de Firewall Manager que l'administrateur peut g√©rer.

Le champ d'application administratif peut √™tre soit **complet soit restreint**. Le champ complet accorde √† l'administrateur l'acc√®s √† **tous les types de ressources sp√©cifi√©s, r√©gions et types de politiques**. En revanche, **le champ restreint fournit une autorisation administrative uniquement √† un sous-ensemble de ressources, r√©gions ou types de politiques**. Il est conseill√© d'accorder aux administrateurs uniquement les autorisations dont ils ont besoin pour remplir efficacement leurs r√¥les. Vous pouvez appliquer n'importe quelle combinaison de ces conditions de champ d'application administratif √† un administrateur, garantissant le respect du principe du moindre privil√®ge.

Il existe deux types distincts de comptes administrateurs, chacun ayant des r√¥les et des responsabilit√©s sp√©cifiques :

* **Administrateur par d√©faut :**
* Le compte administrateur par d√©faut est cr√©√© par le compte de gestion de l'organisation AWS Organizations lors du processus d'int√©gration √† Firewall Manager.
* Ce compte a la capacit√© de g√©rer des pare-feu tiers et poss√®de un champ d'application administratif complet.
* Il sert de compte administrateur principal pour Firewall Manager, responsable de la configuration et de l'application des politiques de s√©curit√© √† travers l'organisation.
* Bien que l'administrateur par d√©faut ait un acc√®s complet √† tous les types de ressources et fonctionnalit√©s administratives, il op√®re au m√™me niveau que d'autres administrateurs si plusieurs administrateurs sont utilis√©s au sein de l'organisation.
* **Administrateurs de Firewall Manager :**
* Ces administrateurs peuvent g√©rer des ressources dans le champ d√©fini par le compte de gestion AWS Organizations, tel que d√©fini par la configuration du champ d'application administratif.
* Les administrateurs de Firewall Manager sont cr√©√©s pour remplir des r√¥les sp√©cifiques au sein de l'organisation, permettant la d√©l√©gation de responsabilit√©s tout en maintenant des normes de s√©curit√© et de conformit√©.
* Lors de leur cr√©ation, Firewall Manager v√©rifie aupr√®s d'AWS Organizations pour d√©terminer si le compte est d√©j√† un administrateur d√©l√©gu√©. Si ce n'est pas le cas, Firewall Manager appelle Organizations pour d√©signer le compte comme administrateur d√©l√©gu√© pour Firewall Manager.

La gestion de ces comptes administrateurs implique de les cr√©er au sein de Firewall Manager et de d√©finir leurs champs d'application administratifs selon les exigences de s√©curit√© de l'organisation et le principe du moindre privil√®ge. En assignant des r√¥les administratifs appropri√©s, les organisations peuvent garantir une gestion efficace de la s√©curit√© tout en maintenant un contr√¥le granulaire sur l'acc√®s aux ressources sensibles.

Il est important de souligner que **un seul compte au sein d'une organisation peut servir d'administrateur par d√©faut de Firewall Manager**, respectant le principe de "**premier arriv√©, dernier sorti**". Pour d√©signer un nouvel administrateur par d√©faut, une s√©rie d'√©tapes doit √™tre suivie :

* Tout d'abord, chaque compte administrateur de Firewall doit r√©voquer son propre compte.
* Ensuite, l'administrateur par d√©faut existant peut r√©voquer son propre compte, effectuant ainsi le d√©part de l'organisation de Firewall Manager. Ce processus entra√Æne la suppression de toutes les politiques de Firewall Manager cr√©√©es par le compte r√©voqu√©.
* Pour conclure, le compte de gestion AWS Organizations doit d√©signer l'administrateur par d√©faut de Firewall Manager.

## Enumeration
```
# Users/Administrators

## Get the AWS Organizations account that is associated with AWS Firewall Manager as the AWS Firewall Manager default administrator
aws fms get-admin-account

## List of Firewall Manager administrators within the organization
aws fms list-admin-accounts-for-organization # ReadOnlyAccess policy is not enough for this

## Return a list of the member accounts in the FM administrator's AWS organization
aws fms list-member-accounts # Only a Firewall Manager administrator or the Organization's management account can make this request

## List the accounts that are managing the specified AWS Organizations member account
aws fms list-admins-managing-account # ReadOnlyAccess policy is not enough for this

# Resources

## Get the resources that a Firewall Manager administrator can manage
aws fms get-admin-scope --admin-account <value> # ReadOnlyAccess policy is not enough for this

## Returns the summary of the resource sets used
aws fms list-resource-sets # ReadOnlyAccess policy is not enough for this

## Get information about a specific resource set
aws fms get-resource-set --identifier <value>  # ReadOnlyAccess policy is not enough for this

## Retrieve the list of tags for a given resource
aws fms list-tags-for-resource --resource-arn <value>

## List of the resources in the AWS Organization's accounts that are available to be associated with a FM resource set. Only one account is supported per request.
aws fms list-compliance-status --member-account-ids <value> --resource-type <value> # ReadOnlyAccess policy is not enough for this

## List the resources that are currently associated to a resource set
aws fms list-resource-set-resources --identifier <value> # ReadOnlyAccess policy is not enough for this

# Policies

## Returns the list of policies
aws fms list-policies

## Get information about the specified AWS Firewall Manager policy
aws fms get-policy --policy-id <value>

## List all of the third-party firewall policies that are associated with the third-party firewall administrator's account
aws fms list-third-party-firewall-firewall-policies --third-party-firewall <PALO_ALTO_NETWORKS_CLOUD_NGFW|FORTIGATE_CLOUD_NATIVE_FIREWALL> # ReadOnlyAccess policy is not enough for this

# AppsList

## Return a list of apps list
aws fms list-apps-lists --max-results [1-100]

## Get information about the specified AWS Firewall Manager applications list
aws fms get-apps-list --list-id <value>

# Protocols

## Get the details of the Firewall Manager protocols list.
aws fms list-protocols-lists

## Get information about the specified AWS Firewall Manager Protocols list
aws fms get-protocols-list --list-id <value>

# Compliance

## Return a summary of which member accounts are protected by the specified policy
aws fms list-compliance-status --policy-id <policy-id>

## Get detailed compliance information about the specified member account (resources that are in and out of compliance with the specified policy)
aws fms get-compliance-detail --policy-id <value> --member-account <value>

# Other useful info

## Get information about the SNS topic that is used to record AWS Firewall Manager SNS logs (if any)
aws fms get-notification-channel

## Get policy-level attack summary information in the event of a potential DDoS attack
aws fms get-protection-status --policy-id <value> # Just for Shield Advanced policy

## Get the onboarding status of a Firewall Manager admin account to third-party firewall vendor tenant.
aws fms get-third-party-firewall-association-status --third-party-firewall <PALO_ALTO_NETWORKS_CLOUD_NGFW|FORTIGATE_CLOUD_NATIVE_FIREWALL> # ReadOnlyAccess policy is not enough for this

## Get violations' details for a resource based on the specified AWS Firewall Manager policy and AWS account.
aws fms get-violation-details --policy-id <value> --member-account <value> --resource-id <value> --resource-type <value>
```
## Post Exploitation / Bypass Detection

### `organizations:DescribeOrganization` & (`fms:AssociateAdminAccount`, `fms:DisassociateAdminAccount`, `fms:PutAdminAccount`)

Un attaquant avec la permission **`fms:AssociateAdminAccount`** serait capable de d√©finir le compte administrateur par d√©faut du Firewall Manager. Avec la permission **`fms:PutAdminAccount`**, un attaquant pourrait cr√©er ou mettre √† jour un compte administrateur du Firewall Manager et avec la permission **`fms:DisassociateAdminAccount`**, un attaquant potentiel pourrait supprimer l'association du compte administrateur actuel du Firewall Manager.

* La d√©sassociation de **l'administrateur par d√©faut du Firewall Manager suit la politique du premier entr√©, dernier sorti**. Tous les administrateurs du Firewall Manager doivent se d√©sassocier avant que l'administrateur par d√©faut du Firewall Manager puisse d√©sassocier le compte.
* Afin de cr√©er un administrateur du Firewall Manager par **PutAdminAccount**, le compte doit appartenir √† l'organisation qui a √©t√© pr√©c√©demment int√©gr√©e au Firewall Manager en utilisant **AssociateAdminAccount**.
* La cr√©ation d'un compte administrateur du Firewall Manager ne peut √™tre effectu√©e que par le compte de gestion de l'organisation.
```bash
aws fms associate-admin-account --admin-account <value>
aws fms disassociate-admin-account
aws fms put-admin-account --admin-account <value>
```
**Impact potentiel :** Perte de gestion centralis√©e, √©vasion de politique, violations de conformit√© et perturbation des contr√¥les de s√©curit√© au sein de l'environnement.

### `fms:PutPolicy`, `fms:DeletePolicy`

Un attaquant disposant des autorisations **`fms:PutPolicy`**, **`fms:DeletePolicy`** serait en mesure de cr√©er, modifier ou supprimer d√©finitivement une politique AWS Firewall Manager.
```bash
aws fms put-policy --policy <value> | --cli-input-json file://<policy.json> [--tag-list <value>]
aws fms delete-policy --policy-id <value> [--delete-all-policy-resources | --no-delete-all-policy-resources]
```
Un exemple de politique permissive √† travers un groupe de s√©curit√© permissif, afin de contourner la d√©tection, pourrait √™tre le suivant :
```json
{
"Policy": {
"PolicyName": "permisive_policy",
"SecurityServicePolicyData": {
"Type": "SECURITY_GROUPS_COMMON",
"ManagedServiceData": "{\"type\":\"SECURITY_GROUPS_COMMON\",\"securityGroups\":[{\"id\":\"<permisive_security_group_id>\"}], \"applyToAllEC2InstanceENIs\":\"true\",\"IncludeSharedVPC\":\"true\"}"
},
"ResourceTypeList": ["AWS::EC2::Instance", "AWS::EC2::NetworkInterface", "AWS::EC2::SecurityGroup", "AWS::ElasticLoadBalancingV2::LoadBalancer", "AWS::ElasticLoadBalancing::LoadBalancer"],
"ResourceType": "AWS::EC2::SecurityGroup",
"ExcludeResourceTags": false,
"ResourceTags": [],
"RemediationEnabled": true
},
"TagList": []
}
```
**Impact potentiel :** D√©mant√®lement des contr√¥les de s√©curit√©, √©vasion des politiques, violations de conformit√©, perturbations op√©rationnelles et violations potentielles de donn√©es au sein de l'environnement.

### `fms:BatchAssociateResource`, `fms:BatchDisassociateResource`, `fms:PutResourceSet`, `fms:DeleteResourceSet`

Un attaquant disposant des autorisations **`fms:BatchAssociateResource`** et **`fms:BatchDisassociateResource`** serait en mesure d'associer ou de dissocier des ressources d'un ensemble de ressources de Firewall Manager respectivement. De plus, les autorisations **`fms:PutResourceSet`** et **`fms:DeleteResourceSet`** permettraient √† un attaquant de cr√©er, modifier ou supprimer ces ensembles de ressources depuis AWS Firewall Manager.
```bash
# Associate/Disassociate resources from a resource set
aws fms batch-associate-resource --resource-set-identifier <value> --items <value>
aws fms batch-disassociate-resource --resource-set-identifier <value> --items <value>

# Create, modify or delete a resource set
aws fms put-resource-set --resource-set <value> [--tag-list <value>]
aws fms delete-resource-set --identifier <value>
```
**Impact potentiel :** L'ajout d'un nombre inutile d'√©l√©ments √† un ensemble de ressources augmentera le niveau de bruit dans le Service, pouvant potentiellement causer un DoS. De plus, des modifications des ensembles de ressources pourraient entra√Æner une perturbation des ressources, une √©vasion de politique, des violations de conformit√© et une perturbation des contr√¥les de s√©curit√© au sein de l'environnement.

### `fms:PutAppsList`, `fms:DeleteAppsList`

Un attaquant disposant des autorisations **`fms:PutAppsList`** et **`fms:DeleteAppsList`** serait en mesure de cr√©er, modifier ou supprimer des listes d'applications depuis AWS Firewall Manager. Cela pourrait √™tre critique, car des applications non autoris√©es pourraient se voir accorder un acc√®s au grand public, ou l'acc√®s √† des applications autoris√©es pourrait √™tre refus√©, causant un DoS.
```bash
aws fms put-apps-list --apps-list <value> [--tag-list <value>]
aws fms delete-apps-list --list-id <value>
```
**Impact potentiel :** Cela pourrait entra√Æner des erreurs de configuration, une √©vasion de politique, des violations de conformit√© et une perturbation des contr√¥les de s√©curit√© au sein de l'environnement.

### `fms:PutProtocolsList`, `fms:DeleteProtocolsList`

Un attaquant disposant des autorisations **`fms:PutProtocolsList`** et **`fms:DeleteProtocolsList`** serait en mesure de cr√©er, modifier ou supprimer des listes de protocoles depuis AWS Firewall Manager. De la m√™me mani√®re que pour les listes d'applications, cela pourrait √™tre critique puisque des protocoles non autoris√©s pourraient √™tre utilis√©s par le grand public, ou l'utilisation de protocoles autoris√©s pourrait √™tre refus√©e, entra√Ænant un DoS.
```bash
aws fms put-protocols-list --apps-list <value> [--tag-list <value>]
aws fms delete-protocols-list --list-id <value>
```
**Impact potentiel :** Cela pourrait entra√Æner des erreurs de configuration, une √©vasion de politique, des violations de conformit√© et une perturbation des contr√¥les de s√©curit√© au sein de l'environnement.

### `fms:PutNotificationChannel`, `fms:DeleteNotificationChannel`

Un attaquant disposant des autorisations **`fms:PutNotificationChannel`** et **`fms:DeleteNotificationChannel`** serait en mesure de supprimer et de d√©signer le r√¥le IAM et le sujet Amazon Simple Notification Service (SNS) que Firewall Manager utilise pour enregistrer les journaux SNS.

Pour utiliser **`fms:PutNotificationChannel`** en dehors de la console, vous devez configurer la politique d'acc√®s du sujet SNS, permettant au **SnsRoleName** sp√©cifi√© de publier des journaux SNS. Si le **SnsRoleName** fourni est un r√¥le autre que **`AWSServiceRoleForFMS`**, il n√©cessite une relation de confiance configur√©e pour permettre au principal de service Firewall Manager **fms.amazonaws.com** d'assumer ce r√¥le.

Pour des informations sur la configuration d'une politique d'acc√®s SNS :

{% content-ref url="../aws-services/aws-sns-enum.md" %}
[aws-sns-enum.md](../aws-services/aws-sns-enum.md)
{% endcontent-ref %}
```bash
aws fms put-notification-channel --sns-topic-arn <value> --sns-role-name <value>
aws fms delete-notification-channel
```
**Impact potentiel :** Cela pourrait potentiellement entra√Æner des alertes de s√©curit√© manqu√©es, un retard dans la r√©ponse aux incidents, des violations de donn√©es potentielles et des perturbations op√©rationnelles au sein de l'environnement.

### `fms:AssociateThirdPartyFirewall`, `fms:DisssociateThirdPartyFirewall`

Un attaquant avec les permissions **`fms:AssociateThirdPartyFirewall`**, **`fms:DisssociateThirdPartyFirewall`** serait capable d'associer ou de dissocier des pare-feu tiers pour √™tre g√©r√©s de mani√®re centralis√©e via AWS Firewall Manager.

{% hint style="warning" %}
Seul l'administrateur par d√©faut peut cr√©er et g√©rer des pare-feu tiers.
{% endhint %}
```bash
aws fms associate-third-party-firewall --third-party-firewall [PALO_ALTO_NETWORKS_CLOUD_NGFW | FORTIGATE_CLOUD_NATIVE_FIREWALL]
aws fms disassociate-third-party-firewall --third-party-firewall [PALO_ALTO_NETWORKS_CLOUD_NGFW | FORTIGATE_CLOUD_NATIVE_FIREWALL]
```
**Impact potentiel :** La d√©sassociation entra√Ænerait une √©vasion de politique, des violations de conformit√© et une perturbation des contr√¥les de s√©curit√© au sein de l'environnement. L'association, en revanche, entra√Ænerait une perturbation de l'allocation des co√ªts et du budget.

### `fms:TagResource`, `fms:UntagResource`

Un attaquant pourrait ajouter, modifier ou supprimer des balises des ressources de Firewall Manager, perturbant l'allocation des co√ªts de votre organisation, le suivi des ressources et les politiques de contr√¥le d'acc√®s bas√©es sur les balises.
```bash
aws fms tag-resource --resource-arn <value> --tag-list <value>
aws fms untag-resource --resource-arn <value> --tag-keys <value>
```
**Impact potentiel** : Perturbation de l'allocation des co√ªts, du suivi des ressources et des politiques de contr√¥le d'acc√®s bas√©es sur des balises.

## R√©f√©rences

* [https://docs.aws.amazon.com/govcloud-us/latest/UserGuide/govcloud-fms.html](https://docs.aws.amazon.com/govcloud-us/latest/UserGuide/govcloud-fms.html)
* [https://docs.aws.amazon.com/service-authorization/latest/reference/list\_awsfirewallmanager.html](https://docs.aws.amazon.com/service-authorization/latest/reference/list\_awsfirewallmanager.html)
* [https://docs.aws.amazon.com/waf/latest/developerguide/fms-chapter.html](https://docs.aws.amazon.com/waf/latest/developerguide/fms-chapter.html)

{% hint style="success" %}
Apprenez et pratiquez le hacking AWS :<img src="../../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">\
Apprenez et pratiquez le hacking GCP : <img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Soutenir HackTricks</summary>

* Consultez les [**plans d'abonnement**](https://github.com/sponsors/carlospolop) !
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez-nous sur** **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Partagez des astuces de hacking en soumettant des PR aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) d√©p√¥ts github.

</details>
{% endhint %}
