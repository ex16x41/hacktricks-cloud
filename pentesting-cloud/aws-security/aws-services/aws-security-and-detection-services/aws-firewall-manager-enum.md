# AWS - Firewall Manager Enum

{% hint style="success" %}
Ucz si i wicz hakowanie AWS:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Ucz si i wicz hakowanie GCP: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Wspieraj HackTricks</summary>

* Sprawd藕 [**plany subskrypcji**](https://github.com/sponsors/carlospolop)!
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegram**](https://t.me/peass) lub **led藕** nas na **Twitterze**  [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Dziel si trikami hakerskimi, przesyajc PR do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repozytori贸w na githubie.

</details>
{% endhint %}

## Firewall Manager

**AWS Firewall Manager** upraszcza zarzdzanie i utrzymanie **AWS WAF, AWS Shield Advanced, Amazon VPC security groups i Network Access Control Lists (ACLs), oraz AWS Network Firewall, AWS Route 53 Resolver DNS Firewall i zapory innych firm** w wielu kontach i zasobach. Umo偶liwia skonfigurowanie regu zapory, ochrony Shield Advanced, grup bezpieczestwa VPC i ustawie Network Firewall tylko raz, a usuga **automatycznie egzekwuje te reguy i ochrony w caych kontach i zasobach**, w tym nowo dodanych.

Usuga oferuje mo偶liwo **grupowania i zabezpieczania okrelonych zasob贸w razem**, takich jak te dzielce wsp贸lny tag lub wszystkie dystrybucje CloudFront. Znaczc zalet Firewall Manager jest jego zdolno do **automatycznego rozszerzania ochrony na nowo dodane zasoby** w Twoim koncie.

**Grupa regu** (zbi贸r regu WAF) mo偶e by wczona do Polityki AWS Firewall Manager, kt贸ra jest nastpnie powizana z okrelonymi zasobami AWS, takimi jak dystrybucje CloudFront lub load balancery aplikacji.

AWS Firewall Manager dostarcza **zarzdzane listy aplikacji i protoko贸w**, aby uproci konfiguracj i zarzdzanie politykami grup bezpieczestwa. Te listy pozwalaj na definiowanie protoko贸w i aplikacji dozwolonych lub zabronionych przez Twoje polityki. Istniej dwa rodzaje zarzdzanych list:

* **Listy zarzdzane przez Firewall Manager**: Te listy obejmuj **FMS-Default-Public-Access-Apps-Allowed**, **FMS-Default-Protocols-Allowed** i **FMS-Default-Protocols-Allowed**. S zarzdzane przez Firewall Manager i zawieraj powszechnie u偶ywane aplikacje i protokoy, kt贸re powinny by dozwolone lub zabronione dla og贸u spoeczestwa. Nie mo偶na ich edytowa ani usuwa, jednak mo偶na wybra ich wersj.
* **Listy zarzdzane niestandardowo**: Zarzdzasz tymi listami samodzielnie. Mo偶esz tworzy niestandardowe listy aplikacji i protoko贸w dostosowane do potrzeb Twojej organizacji. W przeciwiestwie do list zarzdzanych przez Firewall Manager, te listy nie maj wersji, ale masz pen kontrol nad listami niestandardowymi, co pozwala na ich tworzenie, edytowanie i usuwanie wedug potrzeb.

Wa偶ne jest, aby zauwa偶y, 偶e **polityki Firewall Manager pozwalaj tylko na akcje "Block" lub "Count"** dla grupy regu, bez opcji "Allow".

### Wymagania wstpne

Nastpujce kroki wstpne musz zosta ukoczone przed przystpieniem do konfiguracji Firewall Manager, aby skutecznie chroni zasoby Twojej organizacji. Te kroki zapewniaj podstawow konfiguracj wymagan do egzekwowania polityk bezpieczestwa przez Firewall Manager i zapewnienia zgodnoci w caym rodowisku AWS:

1. **Docz i skonfiguruj AWS Organizations:** Upewnij si, 偶e Twoje konto AWS jest czci organizacji AWS Organizations, w kt贸rej planowane jest wdro偶enie polityk AWS Firewall Manager. To pozwala na centralne zarzdzanie zasobami i politykami w wielu kontach AWS w organizacji.
2. **Utw贸rz domylne konto administratora AWS Firewall Manager:** Ustan贸w domylne konto administratora specjalnie do zarzdzania politykami bezpieczestwa Firewall Manager. To konto bdzie odpowiedzialne za konfigurowanie i egzekwowanie polityk bezpieczestwa w caej organizacji. Tylko konto zarzdzajce organizacj mo偶e tworzy domylne konta administratora Firewall Manager.
3. **Wcz AWS Config:** Aktywuj AWS Config, aby dostarczy Firewall Manager niezbdnych danych konfiguracyjnych i wgldu wymaganego do skutecznego egzekwowania polityk bezpieczestwa. AWS Config pomaga analizowa, audytowa, monitorowa i audytowa konfiguracje zasob贸w i zmiany, uatwiajc lepsze zarzdzanie bezpieczestwem.
4. **Dla polityk innych firm, subskrybuj w AWS Marketplace i skonfiguruj ustawienia innych firm:** Jeli planujesz korzysta z polityk zap贸r innych firm, subskrybuj je w AWS Marketplace i skonfiguruj niezbdne ustawienia. Ten krok zapewnia, 偶e Firewall Manager mo偶e integrowa i egzekwowa polityki od zaufanych dostawc贸w zewntrznych.
5. **Dla polityk Network Firewall i DNS Firewall, wcz udostpnianie zasob贸w:** Wcz udostpnianie zasob贸w specjalnie dla polityk Network Firewall i DNS Firewall. To pozwala Firewall Manager na zastosowanie ochrony zapory do VPC i rozwizywania DNS Twojej organizacji, zwikszajc bezpieczestwo sieci.
6. **Aby u偶ywa AWS Firewall Manager w regionach, kt贸re s domylnie wyczone:** Jeli zamierzasz u偶ywa Firewall Manager w regionach AWS, kt贸re s domylnie wyczone, upewnij si, 偶e podejmiesz niezbdne kroki, aby wczy jego funkcjonalno w tych regionach. To zapewnia sp贸jne egzekwowanie bezpieczestwa we wszystkich regionach, w kt贸rych dziaa Twoja organizacja.

Wicej informacji znajdziesz tutaj: [Getting started with AWS Firewall Manager AWS WAF policies](https://docs.aws.amazon.com/waf/latest/developerguide/getting-started-fms.html).

### Rodzaje polityk ochrony

AWS Firewall Manager zarzdza kilkoma rodzajami polityk, aby egzekwowa kontrole bezpieczestwa w r贸偶nych aspektach infrastruktury Twojej organizacji:

1. **AWS WAF Policy:** Ten typ polityki obsuguje zar贸wno AWS WAF, jak i AWS WAF Classic. Mo偶esz okreli, kt贸re zasoby s chronione przez polityk. Dla polityk AWS WAF mo偶esz okreli zestawy grup regu, kt贸re maj by uruchamiane jako pierwsze i ostatnie w web ACL. Dodatkowo, waciciele kont mog dodawa reguy i grupy regu do uruchamiania pomidzy tymi zestawami.
2. **Shield Advanced Policy:** Ta polityka stosuje ochrony Shield Advanced w caej Twojej organizacji dla okrelonych typ贸w zasob贸w. Pomaga chroni przed atakami DDoS i innymi zagro偶eniami.
3. **Amazon VPC Security Group Policy:** Dziki tej polityce mo偶esz zarzdza grupami bezpieczestwa u偶ywanymi w caej Twojej organizacji, egzekwujc podstawowy zestaw regu w caym rodowisku AWS, aby kontrolowa dostp do sieci.
4. **Amazon VPC Network Access Control List (ACL) Policy:** Ten typ polityki daje Ci kontrol nad ACL sieciowymi u偶ywanymi w Twojej organizacji, pozwalajc na egzekwowanie podstawowego zestawu ACL sieciowych w caym rodowisku AWS.
5. **Network Firewall Policy:** Ta polityka stosuje ochron AWS Network Firewall do VPC Twojej organizacji, zwikszajc bezpieczestwo sieci poprzez filtrowanie ruchu na podstawie zdefiniowanych regu.
6. **Amazon Route 53 Resolver DNS Firewall Policy:** Ta polityka stosuje ochrony DNS Firewall do VPC Twojej organizacji, pomagajc blokowa zoliwe pr贸by rozwizywania domen i egzekwowa polityki bezpieczestwa dla ruchu DNS.
7. **Third-Party Firewall Policy:** Ten typ polityki stosuje ochrony z zap贸r innych firm, kt贸re s dostpne poprzez subskrypcj w konsoli AWS Marketplace. Pozwala na integracj dodatkowych rodk贸w bezpieczestwa od zaufanych dostawc贸w w Twoim rodowisku AWS.
1. **Palo Alto Networks Cloud NGFW Policy:** Ta polityka stosuje ochrony Palo Alto Networks Cloud Next Generation Firewall (NGFW) i stosy regu do VPC Twojej organizacji, zapewniajc zaawansowan ochron przed zagro偶eniami i kontrole bezpieczestwa na poziomie aplikacji.
2. **Fortigate Cloud Native Firewall (CNF) as a Service Policy:** Ta polityka stosuje ochrony Fortigate Cloud Native Firewall (CNF) as a Service, oferujc wiodc w bran偶y ochron przed zagro偶eniami, zapor aplikacji webowych (WAF) i ochron API dostosowan do infrastruktury chmurowej.

### Konta administrator贸w

AWS Firewall Manager oferuje elastyczno w zarzdzaniu zasobami zapory w Twojej organizacji poprzez zakres administracyjny i dwa typy kont administrator贸w.

**Zakres administracyjny definiuje zasoby, kt贸rymi administrator Firewall Manager mo偶e zarzdza**. Po tym, jak konto zarzdzajce AWS Organizations wprowadzi organizacj do Firewall Manager, mo偶e tworzy dodatkowych administrator贸w z r贸偶nymi zakresami administracyjnymi. Te zakresy mog obejmowa:

- Konta lub jednostki organizacyjne (OUs), do kt贸rych administrator mo偶e stosowa polityki.
- Regiony, w kt贸rych administrator mo偶e wykonywa dziaania.
- Typy polityk Firewall Manager, kt贸rymi administrator mo偶e zarzdza.

Zakres administracyjny mo偶e by **peny lub ograniczony**. Peny zakres daje administratorowi dostp do **wszystkich okrelonych typ贸w zasob贸w, region贸w i typ贸w polityk**. W przeciwiestwie do tego, **ograniczony zakres zapewnia uprawnienia administracyjne tylko do podzbioru zasob贸w, region贸w lub typ贸w polityk**. Zaleca si przyznawanie administratorom tylko tych uprawnie, kt贸re s im potrzebne do skutecznego wykonywania ich r贸l. Mo偶esz zastosowa dowoln kombinacj tych warunk贸w zakresu administracyjnego do administratora, zapewniajc zgodno z zasad najmniejszych uprawnie.

Istniej dwa r贸偶ne typy kont administrator贸w, z kt贸rych ka偶dy peni okrelone role i obowizki:

- **Domylny Administrator:**
- Domylne konto administratora jest tworzone przez konto zarzdzajce organizacj AWS Organizations podczas procesu wprowadzania do Firewall Manager.
- To konto ma mo偶liwo zarzdzania zaporami innych firm i posiada peny zakres administracyjny.
- Su偶y jako g贸wne konto administratora dla Firewall Manager, odpowiedzialne za konfigurowanie i egzekwowanie polityk bezpieczestwa w caej organizacji.
- Chocia偶 domylny administrator ma peny dostp do wszystkich typ贸w zasob贸w i funkcji administracyjnych, dziaa na tym samym poziomie co inni administratorzy, jeli w organizacji jest u偶ywanych wielu administrator贸w.
- **Administratorzy Firewall Manager:**
- Ci administratorzy mog zarzdza zasobami w zakresie wyznaczonym przez konto zarzdzajce AWS Organizations, zgodnie z konfiguracj zakresu administracyjnego.
- Administratorzy Firewall Manager s tworzeni, aby peni okrelone role w organizacji, umo偶liwiajc delegowanie obowizk贸w przy jednoczesnym utrzymaniu standard贸w bezpieczestwa i zgodnoci.
- Po utworzeniu Firewall Manager sprawdza z AWS Organizations, czy konto jest ju偶 delegowanym administratorem. Jeli nie, Firewall Manager wywouje Organizations, aby wyznaczy konto jako delegowanego administratora dla Firewall Manager.

Zarzdzanie tymi kontami administrator贸w obejmuje ich tworzenie w Firewall Manager i definiowanie ich zakres贸w administracyjnych zgodnie z wymaganiami bezpieczestwa organizacji i zasad najmniejszych uprawnie. Przydzielajc odpowiednie role administracyjne, organizacje mog zapewni skuteczne zarzdzanie bezpieczestwem przy jednoczesnym utrzymaniu szczeg贸owej kontroli nad dostpem do wra偶liwych zasob贸w.

Wa偶ne jest, aby podkreli, 偶e **tylko jedno konto w organizacji mo偶e peni rol domylnego administratora Firewall Manager**, zgodnie z zasad "**pierwszy na wejciu, ostatni na wyjciu**". Aby wyznaczy nowego domylnego administratora, nale偶y wykona szereg krok贸w:

- Najpierw ka偶de konto administratora Firewall Manager musi odwoa swoje wasne konto.
- Nastpnie istniejcy domylny administrator mo偶e odwoa swoje wasne konto, skutecznie wycofujc organizacj z Firewall Manager. Ten proces skutkuje usuniciem wszystkich polityk Firewall Manager utworzonych przez odwoane konto.
- Na koniec konto zarzdzajce AWS Organizations musi wyznaczy nowego domylnego administratora Firewall Manager.

## Enumeracja
```
# Users/Administrators

## Get the AWS Organizations account that is associated with AWS Firewall Manager as the AWS Firewall Manager default administrator
aws fms get-admin-account

## List of Firewall Manager administrators within the organization
aws fms list-admin-accounts-for-organization # ReadOnlyAccess policy is not enough for this

## Return a list of the member accounts in the FM administrator's AWS organization
aws fms list-member-accounts # Only a Firewall Manager administrator or the Organization's management account can make this request

## List the accounts that are managing the specified AWS Organizations member account
aws fms list-admins-managing-account # ReadOnlyAccess policy is not enough for this

# Resources

## Get the resources that a Firewall Manager administrator can manage
aws fms get-admin-scope --admin-account <value> # ReadOnlyAccess policy is not enough for this

## Returns the summary of the resource sets used
aws fms list-resource-sets # ReadOnlyAccess policy is not enough for this

## Get information about a specific resource set
aws fms get-resource-set --identifier <value>  # ReadOnlyAccess policy is not enough for this

## Retrieve the list of tags for a given resource
aws fms list-tags-for-resource --resource-arn <value>

## List of the resources in the AWS Organization's accounts that are available to be associated with a FM resource set. Only one account is supported per request.
aws fms list-compliance-status --member-account-ids <value> --resource-type <value> # ReadOnlyAccess policy is not enough for this

## List the resources that are currently associated to a resource set
aws fms list-resource-set-resources --identifier <value> # ReadOnlyAccess policy is not enough for this

# Policies

## Returns the list of policies
aws fms list-policies

## Get information about the specified AWS Firewall Manager policy
aws fms get-policy --policy-id <value>

## List all of the third-party firewall policies that are associated with the third-party firewall administrator's account
aws fms list-third-party-firewall-firewall-policies --third-party-firewall <PALO_ALTO_NETWORKS_CLOUD_NGFW|FORTIGATE_CLOUD_NATIVE_FIREWALL> # ReadOnlyAccess policy is not enough for this

# AppsList

## Return a list of apps list
aws fms list-apps-lists --max-results [1-100]

## Get information about the specified AWS Firewall Manager applications list
aws fms get-apps-list --list-id <value>

# Protocols

## Get the details of the Firewall Manager protocols list.
aws fms list-protocols-lists

## Get information about the specified AWS Firewall Manager Protocols list
aws fms get-protocols-list --list-id <value>

# Compliance

## Return a summary of which member accounts are protected by the specified policy
aws fms list-compliance-status --policy-id <policy-id>

## Get detailed compliance information about the specified member account (resources that are in and out of compliance with the specified policy)
aws fms get-compliance-detail --policy-id <value> --member-account <value>

# Other useful info

## Get information about the SNS topic that is used to record AWS Firewall Manager SNS logs (if any)
aws fms get-notification-channel

## Get policy-level attack summary information in the event of a potential DDoS attack
aws fms get-protection-status --policy-id <value> # Just for Shield Advanced policy

## Get the onboarding status of a Firewall Manager admin account to third-party firewall vendor tenant.
aws fms get-third-party-firewall-association-status --third-party-firewall <PALO_ALTO_NETWORKS_CLOUD_NGFW|FORTIGATE_CLOUD_NATIVE_FIREWALL> # ReadOnlyAccess policy is not enough for this

## Get violations' details for a resource based on the specified AWS Firewall Manager policy and AWS account.
aws fms get-violation-details --policy-id <value> --member-account <value> --resource-id <value> --resource-type <value>
```
## Post Exploitation / Bypass Detection

### `organizations:DescribeOrganization` & (`fms:AssociateAdminAccount`, `fms:DisassociateAdminAccount`, `fms:PutAdminAccount`)
Atakujcy z uprawnieniem **`fms:AssociateAdminAccount`** m贸gby ustawi domylne konto administratora Firewall Manager. Z uprawnieniem **`fms:PutAdminAccount`** atakujcy m贸gby utworzy lub zaktualizowa konto administratora Firewall Manager, a z uprawnieniem **`fms:DisassociateAdminAccount`** potencjalny atakujcy m贸gby usun bie偶ce powizanie konta administratora Firewall Manager.

- **Dissociation of the Firewall Manager default administrator follows the first-in-last-out policy**. Wszyscy administratorzy Firewall Manager musz si odczy, zanim domylny administrator Firewall Manager bdzie m贸g odczy konto.
- Aby utworzy administratora Firewall Manager za pomoc **PutAdminAccount**, konto musi nale偶e do organizacji, kt贸ra wczeniej zostaa wczona do Firewall Manager za pomoc **AssociateAdminAccount**.
- Utworzenie konta administratora Firewall Manager mo偶e by dokonane tylko przez konto zarzdzajce organizacj.
```bash
aws fms associate-admin-account --admin-account <value>
aws fms disassociate-admin-account
aws fms put-admin-account --admin-account <value>
```
**Potencjalny wpyw:** Utrata scentralizowanego zarzdzania, unikanie polityki, naruszenia zgodnoci i zak贸cenia kontroli bezpieczestwa w rodowisku.

### `fms:PutPolicy`, `fms:DeletePolicy`

Atakujcy z uprawnieniami **`fms:PutPolicy`**, **`fms:DeletePolicy`** byby w stanie tworzy, modyfikowa lub trwale usuwa polityk AWS Firewall Manager.
```bash
aws fms put-policy --policy <value> | --cli-input-json file://<policy.json> [--tag-list <value>]
aws fms delete-policy --policy-id <value> [--delete-all-policy-resources | --no-delete-all-policy-resources]
```
Przykad polityki permisywnej poprzez permisywn grup zabezpiecze, aby obej wykrywanie, mo偶e by nastpujcy:
```json
{
"Policy": {
"PolicyName": "permisive_policy",
"SecurityServicePolicyData": {
"Type": "SECURITY_GROUPS_COMMON",
"ManagedServiceData": "{\"type\":\"SECURITY_GROUPS_COMMON\",\"securityGroups\":[{\"id\":\"<permisive_security_group_id>\"}], \"applyToAllEC2InstanceENIs\":\"true\",\"IncludeSharedVPC\":\"true\"}"
},
"ResourceTypeList": ["AWS::EC2::Instance", "AWS::EC2::NetworkInterface", "AWS::EC2::SecurityGroup", "AWS::ElasticLoadBalancingV2::LoadBalancer", "AWS::ElasticLoadBalancing::LoadBalancer"],
"ResourceType": "AWS::EC2::SecurityGroup",
"ExcludeResourceTags": false,
"ResourceTags": [],
"RemediationEnabled": true
},
"TagList": []
}
```
**Potencjalny wpyw:** Demonta偶 kontroli bezpieczestwa, unikanie polityki, naruszenia zgodnoci, zak贸cenia operacyjne i potencjalne wycieki danych w rodowisku.

### `fms:BatchAssociateResource`, `fms:BatchDisassociateResource`, `fms:PutResourceSet`, `fms:DeleteResourceSet`

Atakujcy z uprawnieniami **`fms:BatchAssociateResource`** i **`fms:BatchDisassociateResource`** byby w stanie odpowiednio powiza lub odczy zasoby od zestawu zasob贸w Firewall Manager. Dodatkowo, uprawnienia **`fms:PutResourceSet`** i **`fms:DeleteResourceSet`** pozwoliyby atakujcemu na tworzenie, modyfikowanie lub usuwanie tych zestaw贸w zasob贸w z AWS Firewall Manager.
```bash
# Associate/Disassociate resources from a resource set
aws fms batch-associate-resource --resource-set-identifier <value> --items <value>
aws fms batch-disassociate-resource --resource-set-identifier <value> --items <value>

# Create, modify or delete a resource set
aws fms put-resource-set --resource-set <value> [--tag-list <value>]
aws fms delete-resource-set --identifier <value>
```
**Potencjalny wpyw:** Dodanie niepotrzebnej liczby element贸w do zestawu zasob贸w zwikszy poziom szumu w usudze, co mo偶e spowodowa DoS. Ponadto, zmiany w zestawach zasob贸w mog prowadzi do zak贸ce zasob贸w, omijania polityki, narusze zgodnoci i zak贸ce kontroli bezpieczestwa w rodowisku.

### `fms:PutAppsList`, `fms:DeleteAppsList`

Atakujcy z uprawnieniami **`fms:PutAppsList`** i **`fms:DeleteAppsList`** byby w stanie tworzy, modyfikowa lub usuwa listy aplikacji z AWS Firewall Manager. Mo偶e to by krytyczne, poniewa偶 nieautoryzowane aplikacje mogyby uzyska dostp do og贸u spoeczestwa, lub dostp do autoryzowanych aplikacji m贸gby zosta odm贸wiony, powodujc DoS.
```bash
aws fms put-apps-list --apps-list <value> [--tag-list <value>]
aws fms delete-apps-list --list-id <value>
```
**Potencjalny wpyw:** Mo偶e to skutkowa bdnymi konfiguracjami, omijaniem polityk, naruszeniami zgodnoci oraz zak贸ceniem kontroli bezpieczestwa w rodowisku.

### `fms:PutProtocolsList`, `fms:DeleteProtocolsList`

Atakujcy z uprawnieniami **`fms:PutProtocolsList`** i **`fms:DeleteProtocolsList`** byby w stanie tworzy, modyfikowa lub usuwa listy protoko贸w w AWS Firewall Manager. Podobnie jak w przypadku list aplikacji, mo偶e to by krytyczne, poniewa偶 nieautoryzowane protokoy mogyby by u偶ywane przez og贸 spoeczestwa, lub u偶ycie autoryzowanych protoko贸w mogoby by zabronione, powodujc DoS.
```bash
aws fms put-protocols-list --apps-list <value> [--tag-list <value>]
aws fms delete-protocols-list --list-id <value>
```
**Potencjalny wpyw:** Mo偶e to skutkowa bdnymi konfiguracjami, omijaniem polityk, naruszeniami zgodnoci i zak贸ceniami kontroli bezpieczestwa w rodowisku.

### `fms:PutNotificationChannel`, `fms:DeleteNotificationChannel`

Atakujcy z uprawnieniami **`fms:PutNotificationChannel`** i **`fms:DeleteNotificationChannel`** bdzie w stanie usun i wyznaczy rol IAM oraz temat Amazon Simple Notification Service (SNS), kt贸rego Firewall Manager u偶ywa do rejestrowania log贸w SNS.

Aby u偶y **`fms:PutNotificationChannel`** poza konsol, musisz skonfigurowa polityk dostpu tematu SNS, pozwalajc okrelonemu **SnsRoleName** na publikowanie log贸w SNS. Jeli podany **SnsRoleName** jest rol inn ni偶 **`AWSServiceRoleForFMS`**, wymaga to skonfigurowania relacji zaufania, aby umo偶liwi g贸wnemu serwisowi Firewall Manager **fms.amazonaws.com** przejcie tej roli.

Informacje na temat konfigurowania polityki dostpu SNS:

{% content-ref url="../aws-services/aws-sns-enum.md" %}
[aws-sns-enum.md](../aws-services/aws-sns-enum.md)
{% endcontent-ref %}
```bash
aws fms put-notification-channel --sns-topic-arn <value> --sns-role-name <value>
aws fms delete-notification-channel
```
**Potencjalny wpyw:** Mo偶e to potencjalnie prowadzi do pominicia alert贸w bezpieczestwa, op贸藕nionej reakcji na incydenty, potencjalnych wyciek贸w danych i zak贸ce operacyjnych w rodowisku.

### `fms:AssociateThirdPartyFirewall`, `fms:DisssociateThirdPartyFirewall`
Atakujcy z uprawnieniami **`fms:AssociateThirdPartyFirewall`**, **`fms:DisssociateThirdPartyFirewall`** byby w stanie powiza lub odczy zapory innych firm od centralnego zarzdzania przez AWS Firewall Manager.
{% hint style="warning" %}
Tylko domylny administrator mo偶e tworzy i zarzdza zaporami innych firm.
{% endhint %}
```bash
aws fms associate-third-party-firewall --third-party-firewall [PALO_ALTO_NETWORKS_CLOUD_NGFW | FORTIGATE_CLOUD_NATIVE_FIREWALL]
aws fms disassociate-third-party-firewall --third-party-firewall [PALO_ALTO_NETWORKS_CLOUD_NGFW | FORTIGATE_CLOUD_NATIVE_FIREWALL]
```
**Potencjalny wpyw:** Rozczenie prowadzioby do unikania polityki, narusze zgodnoci i zak贸ce kontroli bezpieczestwa w rodowisku. Z kolei poczenie prowadzioby do zak贸ce w alokacji koszt贸w i bud偶etu.

### `fms:TagResource`, `fms:UntagResource`

Atakujcy m贸gby dodawa, modyfikowa lub usuwa tagi z zasob贸w Firewall Manager, zak贸cajc alokacj koszt贸w, ledzenie zasob贸w i polityki kontroli dostpu oparte na tagach w Twojej organizacji.
```bash
aws fms tag-resource --resource-arn <value> --tag-list <value>
aws fms untag-resource --resource-arn <value> --tag-keys <value>
```
**Potencjalny wpyw**: Zak贸cenie alokacji koszt贸w, ledzenia zasob贸w i polityk kontroli dostpu opartych na tagach.

## Odnoniki

* [https://docs.aws.amazon.com/govcloud-us/latest/UserGuide/govcloud-fms.html](https://docs.aws.amazon.com/govcloud-us/latest/UserGuide/govcloud-fms.html)
* [https://docs.aws.amazon.com/service-authorization/latest/reference/list_awsfirewallmanager.html](https://docs.aws.amazon.com/service-authorization/latest/reference/list_awsfirewallmanager.html)
* [https://docs.aws.amazon.com/waf/latest/developerguide/fms-chapter.html](https://docs.aws.amazon.com/waf/latest/developerguide/fms-chapter.html)

{% hint style="success" %}
Ucz si i wicz AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Ucz si i wicz GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Wspieraj HackTricks</summary>

* Sprawd藕 [**plany subskrypcji**](https://github.com/sponsors/carlospolop)!
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegram**](https://t.me/peass) lub **led藕** nas na **Twitterze**  [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Dziel si trikami hakerskimi, przesyajc PR do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repozytori贸w na githubie.

</details>
{% endhint %}
