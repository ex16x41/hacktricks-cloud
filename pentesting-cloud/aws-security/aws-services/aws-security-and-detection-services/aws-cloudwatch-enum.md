# AWS - CloudWatch Enum

{% hint style="success" %}
Lernen Sie AWS-Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Lernen Sie GCP-Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Unterst√ºtzen Sie HackTricks</summary>

* √úberpr√ºfen Sie die [**Abonnementpl√§ne**](https://github.com/sponsors/carlospolop)!
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegramm-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teilen Sie Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repositorys senden.

</details>
{% endhint %}

## CloudWatch

**CloudWatch** **sammelt** √úberwachungs- und Betriebsdaten in Form von Protokollen/Metriken/Ereignissen und bietet eine **einheitliche Ansicht der AWS-Ressourcen**, Anwendungen und Dienste.\
CloudWatch-Protokollereignisse haben eine **Gr√∂√üenbeschr√§nkung von 256 KB pro Protokollzeile**.\
Es k√∂nnen **Hochaufl√∂sungsalarme** festgelegt, **Protokolle** und **Metriken** nebeneinander visualisiert, automatisierte Aktionen durchgef√ºhrt, Probleme behoben und Erkenntnisse zur Optimierung von Anwendungen gewonnen werden.

Sie k√∂nnen beispielsweise Protokolle von CloudTrail √ºberwachen. √úberwachte Ereignisse:

* √Ñnderungen an Sicherheitsgruppen und NACLs
* Starten, Stoppen, Neustarten und Beenden von EC2-Instanzen
* √Ñnderungen an Sicherheitsrichtlinien innerhalb von IAM und S3
* Fehlgeschlagene Anmeldeversuche an der AWS Management Console
* API-Aufrufe, die zu fehlgeschlagener Autorisierung gef√ºhrt haben
* Filter zum Suchen in CloudWatch: [https://docs.aws.amazon.com/AmazonCloudWatch/latest/logs/FilterAndPatternSyntax.html](https://docs.aws.amazon.com/AmazonCloudWatch/latest/logs/FilterAndPatternSyntax.html)

## Schl√ºsselkonzepte

### Namensr√§ume

Ein Namespace ist ein Container f√ºr CloudWatch-Metriken. Er hilft dabei, Metriken zu kategorisieren und zu isolieren, was das Verwalten und Analysieren erleichtert.

- **Beispiele**: AWS/EC2 f√ºr EC2-bezogene Metriken, AWS/RDS f√ºr RDS-Metriken.

### Metriken

Metriken sind im Laufe der Zeit gesammelte Datenpunkte, die die Leistung oder Auslastung von AWS-Ressourcen darstellen. Metriken k√∂nnen von AWS-Diensten, benutzerdefinierten Anwendungen oder Integrationen von Drittanbietern gesammelt werden.

- **Beispiel**: CPU-Auslastung, Netzwerkeingang, Festplatten-Lesevorg√§nge.

### Dimensionen

Dimensionen sind Schl√ºssel-Wert-Paare, die Teil von Metriken sind. Sie helfen dabei, eine Metrik eindeutig zu identifizieren und zus√§tzlichen Kontext bereitzustellen. Es k√∂nnen bis zu 30 Dimensionen mit einer Metrik verkn√ºpft werden. Dimensionen erm√∂glichen es auch, Metriken basierend auf spezifischen Attributen zu filtern und zu aggregieren.

- **Beispiel**: F√ºr EC2-Instanzen k√∂nnten Dimensionen InstanceId, InstanceType und AvailabilityZone umfassen.

### Statistiken

Statistiken sind mathematische Berechnungen, die an Metrikdaten durchgef√ºhrt werden, um sie im Laufe der Zeit zusammenzufassen. H√§ufige Statistiken umfassen Durchschnitt, Summe, Minimum, Maximum und Stichprobenanzahl.

- **Beispiel**: Berechnung der durchschnittlichen CPU-Auslastung √ºber einen Zeitraum von einer Stunde.

### Einheiten

Einheiten sind der mit einer Metrik verbundene Messungstyp. Einheiten helfen dabei, Kontext und Bedeutung f√ºr die Metrikdaten bereitzustellen. H√§ufige Einheiten sind Prozent, Bytes, Sekunden, Anzahl.

- **Beispiel**: CPU-Auslastung k√∂nnte in Prozent gemessen werden, w√§hrend Netzwerkeingang in Bytes gemessen werden k√∂nnte.

## CloudWatch-Funktionen

### Dashboard

**CloudWatch-Dashboards** bieten anpassbare **Ansichten Ihrer AWS CloudWatch-Metriken**. Es ist m√∂glich, Dashboards zu erstellen und zu konfigurieren, um Daten zu visualisieren und Ressourcen in einer einzigen Ansicht zu √ºberwachen, indem verschiedene Metriken aus verschiedenen AWS-Diensten kombiniert werden.

**Hauptfunktionen**:

- **Widgets**: Bausteine von Dashboards, einschlie√ülich Diagrammen, Text, Alarmen und mehr.
- **Anpassung**: Layout und Inhalt k√∂nnen angepasst werden, um spezifische √úberwachungsanforderungen zu erf√ºllen.

**Beispiel-Anwendungsfall**:

- Ein einzelnes Dashboard, das wichtige Metriken f√ºr Ihre gesamte AWS-Umgebung anzeigt, einschlie√ülich EC2-Instanzen, RDS-Datenbanken und S3-Buckets.

### Metrik-Stream und Metrikdaten

**Metrik-Streams** in AWS CloudWatch erm√∂glichen es Ihnen, kontinuierlich CloudWatch-Metriken in Echtzeit an ein Ziel Ihrer Wahl zu streamen. Dies ist besonders n√ºtzlich f√ºr erweiterte √úberwachung, Analytik und benutzerdefinierte Dashboards unter Verwendung von Tools au√üerhalb von AWS.

**Metrikdaten** in Metrik-Streams beziehen sich auf die tats√§chlichen Messungen oder Datenpunkte, die gestreamt werden. Diese Datenpunkte repr√§sentieren verschiedene Metriken wie CPU-Auslastung, Speicherauslastung usw. f√ºr AWS-Ressourcen.

**Beispiel-Anwendungsfall**:

- Senden von Echtzeitmetriken an einen √úberwachungsdienst eines Drittanbieters f√ºr eine fortgeschrittene Analyse.
- Archivierung von Metriken in einem Amazon S3-Bucket f√ºr Langzeit-Speicherung und Compliance.

### Alarm

**CloudWatch-Alarme** √ºberwachen Ihre Metriken und f√ºhren Aktionen basierend auf vordefinierten Schwellenwerten aus. Wenn eine Metrik einen Schwellenwert √ºberschreitet, kann der Alarm eine oder mehrere Aktionen ausf√ºhren, wie z.B. Benachrichtigungen √ºber SNS senden, eine automatische Skalierungsrichtlinie ausl√∂sen oder eine AWS Lambda-Funktion ausf√ºhren.

**Hauptkomponenten**:

- **Schwellenwert**: Der Wert, bei dem der Alarm ausgel√∂st wird.
- **Auswertungszeitr√§ume**: Die Anzahl der Zeitr√§ume, √ºber die Daten ausgewertet werden.
- **Datenpunkte zum Alarm**: Die Anzahl der Zeitr√§ume mit einem erreichten Schwellenwert, die erforderlich sind, um den Alarm auszul√∂sen.
- **Aktionen**: Was passiert, wenn ein Alarmzustand ausgel√∂st wird (z.B. Benachrichtigung √ºber SNS senden).

**Beispiel-Anwendungsfall**:

- √úberwachung der CPU-Auslastung einer EC2-Instanz und Senden einer Benachrichtigung √ºber SNS, wenn sie 80 % f√ºr 5 aufeinanderfolgende Minuten √ºberschreitet.

### Anomalie-Detektoren

**Anomalie-Detektoren** verwenden maschinelles Lernen, um automatisch Anomalien in Ihren Metriken zu erkennen. Sie k√∂nnen die Anomalieerkennung auf jede CloudWatch-Metrik anwenden, um Abweichungen von normalen Mustern zu identifizieren, die auf Probleme hinweisen k√∂nnten.

**Hauptkomponenten**:

- **Modelltraining**: CloudWatch verwendet historische Daten, um ein Modell zu trainieren und festzulegen, wie normales Verhalten aussieht.
- **Anomalieerkennungsband**: Eine visuelle Darstellung des erwarteten Wertebereichs f√ºr eine Metrik.

**Beispiel-Anwendungsfall**:

- Erkennung ungew√∂hnlicher CPU-Auslastungsmuster in einer EC2-Instanz, die auf einen Sicherheitsvorfall oder ein Anwendungsproblem hinweisen k√∂nnten.

### Insight-Regeln und verwaltete Insight-Regeln

**Insight-Regeln** erm√∂glichen es Ihnen, Trends, Spitzen oder andere interessante Muster in Ihren Metrikdaten zu identifizieren, indem Sie **leistungsstarke mathematische Ausdr√ºcke** verwenden, um die Bedingungen festzulegen, unter denen Aktionen ausgef√ºhrt werden sollen. Diese Regeln k√∂nnen Ihnen helfen, Anomalien oder ungew√∂hnliches Verhalten in der Leistung und Auslastung Ihrer Ressourcen zu identifizieren.

**Verwaltete Insight-Regeln** sind vorab konfigurierte **Insight-Regeln, die von AWS bereitgestellt werden**. Sie sind darauf ausgelegt, spezifische AWS-Dienste oder h√§ufige Anwendungsf√§lle zu √ºberwachen und k√∂nnen ohne detaillierte Konfiguration aktiviert werden.

**Beispiel-Anwendungsfall**:

- √úberwachung der RDS-Performance: Aktivieren einer verwalteten Insight-Regel f√ºr Amazon RDS, die wichtige Leistungsindikatoren wie CPU-Auslastung, Speicherauslastung und Festplatten-I/O √ºberwacht. Wenn einer dieser Metriken sicheren Betriebsgrenzen √ºberschreitet, kann die Regel einen Alarm ausl√∂sen oder eine automatisierte Ma√ünahme ergreifen.

### CloudWatch-Protokolle <a href="#cloudwatch-logs" id="cloudwatch-logs"></a>

Erm√∂glicht das **Aggregieren und √úberwachen von Protokollen aus Anwendungen** und Systemen von **AWS-Diensten** (einschlie√ülich CloudTrail) und **von Apps/Systemen** (**CloudWatch-Agent** kann auf einem Host installiert werden). Protokolle k√∂nnen **unbegrenzt gespeichert** werden (abh√§ngig von den Einstellungen der Protokollgruppe) und k√∂nnen exportiert werden.

**Elemente**:

| **Protokollgruppe**      | Eine **Sammlung von Protokollstr√∂men**, die dieselben Aufbewahrungs-, √úberwachungs- und Zugriffskontrolleinstellungen teilen |
| ------------------------ | ----------------------------------------------------------------------------------------------------------------------------- |
| **Protokollstrom**       | Eine Sequenz von **Protokollereignissen**, die dieselbe **Quelle** teilen                                                        |
| **Abonnementfilter**    | Definieren eines **Filtermusters, das Ereignisse** in einer bestimmten Protokollgruppe √ºbereinstimmt, senden sie an einen Kinesis Data Firehose-Stream, Kinesis-Stream oder eine Lambda-Funktion |
### CloudWatch √úberwachung & Ereignisse

CloudWatch **basic** aggregiert Daten **alle 5 Minuten** (die **detaillierte** Version macht das **alle 1 Minute**). Nach der Aggregation **√ºberpr√ºft es die Schwellenwerte der Alarme**, falls einer ausgel√∂st werden muss.\
In diesem Fall kann CloudWatch so konfiguriert werden, dass es ein Ereignis sendet und automatische Aktionen ausf√ºhrt (AWS Lambda-Funktionen, SNS-Themen, SQS-Warteschlangen, Kinesis-Streams)

### Agenteninstallation

Sie k√∂nnen Agenten in Ihren Maschinen/Containern installieren, um die Protokolle automatisch an CloudWatch zur√ºckzusenden.

* **Erstellen** Sie eine **Rolle** und **f√ºgen** Sie sie dem **Instanz** hinzu, mit Berechtigungen, die es CloudWatch erm√∂glichen, Daten von den Instanzen zu sammeln, zus√§tzlich zur Interaktion mit dem AWS-System-Manager SSM (CloudWatchAgentAdminPolicy & AmazonEC2RoleforSSM)
* **Herunterladen** und **installieren** Sie den **Agenten** auf der EC2-Instanz ([https://s3.amazonaws.com/amazoncloudwatch-agent/linux/amd64/latest/AmazonCloudWatchAgent.zip](https://s3.amazonaws.com/amazoncloudwatch-agent/linux/amd64/latest/AmazonCloudWatchAgent.zip)). Sie k√∂nnen ihn von innerhalb der EC2 herunterladen oder ihn automatisch mit AWS System Manager installieren, indem Sie das Paket AWS-ConfigureAWSPackage ausw√§hlen
* **Konfigurieren** und **starten** Sie den CloudWatch-Agenten

Eine Protokollgruppe hat viele Streams. Ein Stream hat viele Ereignisse. Und innerhalb jedes Streams sind die Ereignisse garantiert in der richtigen Reihenfolge.
```bash
# Dashboards #

## Returns a list of the dashboards of your account
aws cloudwatch list-dashboards

## Retrieves the details of the specified dashboard
aws cloudwatch get-dashboard --dashboard-name <value>

# Metrics #

## Returns a list of the specified metric
aws cloudwatch list-metrics [--namespace <value>] [--metric-name <value>] [--dimensions <value>] [--include-linked-accounts | --no-include-linked-accounts]

## Retrieves metric data (this operation can include a CloudWatch Metrics Insights query, and one or more metric math functions)
aws cloudwatch get-metric-data --metric-data-queries <value> --start-time <value> --end-time <value>

## Retrieves statistics for the specified metric and namespace over a range of time
aws cloudwatch get-metric-statistics --namespace <value> --metric-name <value> [--dimensions <value>] --start-time <value> --end-time <value> --period <value>

## Returns a list of the metric streams of your account
aws cloudwatch list-metric-streams

## Retrieves information about the specified metric stream
aws cloudwatch get-metric-stream --name <value>

## Retrieve snapshots of the specified metric widgets
aws cloudwatch get-metric-widget-image --metric-widget <value>

# Alarms #

## Retrieves the specified alarm
aws cloudwatch describe-alarms [--alarm-names <value>] [--alarm-name-prefix <value>] [--alarm-types <value>] [--state-value <value>]

## Retrieves the alarms history, even for deleted alarms
aws cloudwatch describe-alarm-history [--alarm-name <value>] [--alarm-types <value>] [--history-item-type <ConfigurationUpdate | StateUpdate | Action>] [--start-date <value>] [--end-date <value>]

## Retrieves standard alarms based on the specified metric
aws cloudwatch escribe-alarms-for-metric --metric-name <value> --namespace <value> [--dimensions <value>]

# Anomaly Detections #

## Lists the anomaly detection models that you have created in your account
aws cloudwatch describe-anomaly-detectors [--namespace <value>] [--metric-name <value>] [--dimensions <value>]

## Lists all the Contributor Insight rules in your account
aws cloudwatch describe-insight-rules

## Retrieves the data collected over a time range for a given Contributor Insight rule
aws cloudwatch get-insight-rule-report --rule-name <value> --start-time <value> --end-time <value> --period <value>

## Lists managed Contributor Insights rules in your account for a specified resource
aws cloudwatch list-managed-insight-rules --resource-arn <value>

# Tags #

## Lists the tags associated with the specified CloudWatch resources
aws cloudwatch list-tags-for-resource --resource-arn <value>

# CloudWatch Logs #
aws logs tail "<log_group_name>" --followaws logs get-log-events --log-group-name "<log_group_name>" --log-stream-name "<log_stream_name>" --output text > <output_file>

# CloudWatch Events #
aws events list-rules
aws events describe-rule --name <name>aws events list-targets-by-rule --rule <name>aws events list-archives
aws events describe-archive --archive-name <name>aws events list-connections
aws events describe-connection --name <name>aws events list-endpoints
aws events describe-endpoint --name <name>aws events list-event-sources
aws events describe-event-source --name <name>aws events list-replays
aws events list-api-destinations
aws events list-event-buses
```
## Post-Exploitation / Umgehung

### **`cloudwatch:DeleteAlarms`,`cloudwatch:PutMetricAlarm` ,¬†`cloudwatch:PutCompositeAlarm`**

Ein Angreifer mit diesen Berechtigungen k√∂nnte die √úberwachungs- und Alarminfrastruktur einer Organisation erheblich untergraben. Durch das L√∂schen bestehender Alarme k√∂nnte ein Angreifer wichtige Benachrichtigungen deaktivieren, die Administratoren √ºber kritische Leistungsprobleme, Sicherheitsverletzungen oder Betriebsausf√§lle informieren. Dar√ºber hinaus k√∂nnte der Angreifer durch das Erstellen oder √Ñndern von Metrikalarmen auch Administratoren mit falschen Alarmen t√§uschen oder legitime Alarme zum Schweigen bringen, um b√∂sartige Aktivit√§ten zu verschleiern und zeitnahe Reaktionen auf tats√§chliche Vorf√§lle zu verhindern.

Dar√ºber hinaus k√∂nnte ein Angreifer mit der Berechtigung **`cloudwatch:PutCompositeAlarm`** eine Schleife oder einen Zyklus von Verbundalarmen erstellen, bei dem Verbundalarm A von Verbundalarm B abh√§ngt und Verbundalarm B auch von Verbundalarm A abh√§ngt. In diesem Szenario ist es nicht m√∂glich, einen Verbundalarm zu l√∂schen, der Teil des Zyklus ist, da immer noch ein Verbundalarm vorhanden ist, der von dem Alarm abh√§ngt, den Sie l√∂schen m√∂chten.
```bash
aws cloudwatch put-metric-alarm --cli-input-json <value> | --alarm-name <value> --comparison-operator <value> --evaluation-periods <value> [--datapoints-to-alarm <value>] [--threshold <value>] [--alarm-description <value>] [--alarm-actions <value>] [--metric-name <value>] [--namespace <value>] [--statistic <value>] [--dimensions <value>] [--period <value>]
aws cloudwatch delete-alarms --alarm-names <value>
aws cloudwatch put-composite-alarm --alarm-name <value> --alarm-rule <value> [--no-actions-enabled | --actions-enabled [--alarm-actions <value>] [--insufficient-data-actions <value>] [--ok-actions <value>] ]
```
Die folgende Beispiel zeigt, wie man einen Metrik-Alarm unwirksam macht:

- Dieser Metrik-Alarm √ºberwacht die durchschnittliche CPU-Auslastung einer bestimmten EC2-Instanz, bewertet die Metrik alle 300 Sekunden und erfordert 6 Auswertungszeitr√§ume (insgesamt 30 Minuten). Wenn die durchschnittliche CPU-Auslastung f√ºr mindestens 4 dieser Zeitr√§ume √ºber 60% liegt, wird der Alarm ausgel√∂st und eine Benachrichtigung an das angegebene SNS-Thema gesendet.
- Durch √Ñndern des Schwellenwerts auf mehr als 99%, Einstellen des Zeitraums auf 10 Sekunden, der Auswertungszeitr√§ume auf 8640 (da 8640 Zeitr√§ume von 10 Sekunden einem Tag entsprechen) und der Datenpunkte f√ºr den Alarm ebenfalls auf 8640, m√ºsste die CPU-Auslastung w√§hrend des gesamten 24-Stunden-Zeitraums alle 10 Sekunden √ºber 99% liegen, um einen Alarm auszul√∂sen.

{% tabs %}
{% tab title="Urspr√ºnglicher Metrik-Alarm" %}
```json
{
"Namespace": "AWS/EC2",
"MetricName": "CPUUtilization",
"Dimensions": [
{
"Name": "InstanceId",
"Value": "i-01234567890123456"
}
],
"AlarmActions": [
"arn:aws:sns:us-east-1:123456789012:example_sns"
],
"ComparisonOperator": "GreaterThanThreshold",
"DatapointsToAlarm": 4,
"EvaluationPeriods": 6,
"Period": 300,
"Statistic": "Average",
"Threshold": 60,
"AlarmDescription": "CPU Utilization of i-01234567890123456 over 60%",
"AlarmName": "EC2 instance i-01234567890123456 CPU Utilization"
}
```
{% endtab %}
{% tab title="Ge√§nderte Metrik-Alarm" %}
```json
{
"Namespace": "AWS/EC2",
"MetricName": "CPUUtilization",
"Dimensions": [
{
"Name": "InstanceId",
"Value": "i-0645d6d414dadf9f8"
}
],
"AlarmActions": [],
"ComparisonOperator": "GreaterThanThreshold",
"DatapointsToAlarm": 8640,
"EvaluationPeriods": 8640,
"Period": 10,
"Statistic": "Average",
"Threshold": 99,
"AlarmDescription": "CPU Utilization of i-01234567890123456 with 60% as threshold",
"AlarmName": "Instance i-0645d6d414dadf9f8 CPU Utilization"
}

```
{% endtab %}
{% endtabs %}
**Potenzielle Auswirkungen**: Fehlende Benachrichtigungen √ºber kritische Ereignisse, potenziell unentdeckte Probleme, falsche Alarme unterdr√ºcken und m√∂glicherweise echte Vorf√§lle √ºbersehen.

### **`cloudwatch:DeleteAlarmActions`,¬†`cloudwatch:EnableAlarmActions` , `cloudwatch:SetAlarmState`**

Durch das L√∂schen von Alarmaktionen k√∂nnte der Angreifer verhindern, dass kritische Warnungen und automatisierte Reaktionen ausgel√∂st werden, wenn ein Alarmpunkt erreicht wird, z. B. Benachrichtigung von Administratoren oder Ausl√∂sen von automatischen Skalierungsaktivit√§ten. Das unangemessene Aktivieren oder Wiederaktivieren von Alarmaktionen k√∂nnte auch zu unerwartetem Verhalten f√ºhren, entweder durch Reaktivierung zuvor deaktivierter Aktionen oder durch √Ñnderung der ausgel√∂sten Aktionen, was potenziell Verwirrung und Fehlleitung in der Vorfallreaktion verursachen k√∂nnte.

Dar√ºber hinaus k√∂nnte ein Angreifer mit den entsprechenden Berechtigungen Alarmzust√§nde manipulieren, um falsche Alarme zu erzeugen, um Administratoren abzulenken und zu verwirren, oder echte Alarme zum Schweigen zu bringen, um laufende b√∂sartige Aktivit√§ten oder kritische Systemausf√§lle zu verbergen.

- Wenn Sie¬†**`SetAlarmState`**¬†bei einem Verbundalarm verwenden, ist nicht garantiert, dass der Verbundalarm zu seinem tats√§chlichen Zustand zur√ºckkehrt. Er kehrt nur zu seinem tats√§chlichen Zustand zur√ºck, sobald einer seiner Kinderalarme den Zustand √§ndert. Er wird auch neu bewertet, wenn Sie seine Konfiguration aktualisieren.
```bash
aws cloudwatch disable-alarm-actions --alarm-names <value>
aws cloudwatch enable-alarm-actions --alarm-names <value>
aws cloudwatch set-alarm-state --alarm-name <value> --state-value <OK | ALARM | INSUFFICIENT_DATA> --state-reason <value> [--state-reason-data <value>]
```
**Potenzielle Auswirkungen**: Fehlende Benachrichtigungen √ºber kritische Ereignisse, potenziell unentdeckte Probleme, falsche Alarme, echte Alarme unterdr√ºcken und potenziell verpasste Erkennung von echten Vorf√§llen.

### **`cloudwatch:DeleteAnomalyDetector`,¬†`cloudwatch:PutAnomalyDetector`**

Ein Angreifer k√∂nnte die F√§higkeit zur Erkennung und Reaktion auf ungew√∂hnliche Muster oder Anomalien in Metrikdaten kompromittieren. Durch L√∂schen vorhandener Anomalieerkennungen k√∂nnte ein Angreifer kritische Alarmmechanismen deaktivieren; und durch Erstellen oder Modifizieren von ihnen k√∂nnte entweder eine falsche Konfiguration vorgenommen oder falsche Positivmeldungen erstellt werden, um das Monitoring abzulenken oder zu √ºberlasten.
```bash
aws cloudwatch delete-anomaly-detector [--cli-input-json <value> | --namespace <value> --metric-name <value> --dimensions <value> --stat <value>]
aws cloudwatch put-anomaly-detector [--cli-input-json <value> | --namespace <value> --metric-name <value> --dimensions <value> --stat <value> --configuration <value> --metric-characteristics <value>]
```
Das folgende Beispiel zeigt, wie man einen Metrikanomalie-Detektor unwirksam macht. Dieser Metrikanomalie-Detektor √ºberwacht die durchschnittliche CPU-Auslastung einer bestimmten EC2-Instanz, und allein durch das Hinzuf√ºgen des Parameters "ExcludedTimeRanges" mit dem gew√ºnschten Zeitraum w√§re es ausreichend, um sicherzustellen, dass der Anomalie-Detektor keine relevanten Daten w√§hrend dieses Zeitraums analysiert oder Alarme ausl√∂st.
```json
{
"SingleMetricAnomalyDetector": {
"Namespace": "AWS/EC2",
"MetricName": "CPUUtilization",
"Stat": "Average",
"Dimensions": [
{
"Name": "InstanceId",
"Value": "i-0123456789abcdefg"
}
]
}
}
```
{% endtab %}
{% tab title="Modifizierter Metrik-Anomalie-Detektor" %}
```json
{
"SingleMetricAnomalyDetector": {
"Namespace": "AWS/EC2",
"MetricName": "CPUUtilization",
"Stat": "Average",
"Dimensions": [
{
"Name": "InstanceId",
"Value": "i-0123456789abcdefg"
}
]
},
"Configuration": {
"ExcludedTimeRanges": [
{
"StartTime": "2023-01-01T00:00:00Z",
"EndTime": "2053-01-01T23:59:59Z"
}
],
"Timezone": "Europe/Madrid"
}
}
```
{% endtab %}
{% endtabs %}
**Potenzielle Auswirkungen**: Direkte Auswirkung auf die Erkennung ungew√∂hnlicher Muster oder Sicherheitsbedrohungen.

### **`cloudwatch:DeleteDashboards`,¬†`cloudwatch:PutDashboard`**

Ein Angreifer k√∂nnte die √úberwachungs- und Visualisierungsf√§higkeiten einer Organisation kompromittieren, indem er deren Dashboards erstellt, modifiziert oder l√∂scht. Diese Berechtigungen k√∂nnten genutzt werden, um die kritische Sichtbarkeit in die Leistung und Gesundheit von Systemen zu entfernen, Dashboards zu √§ndern, um falsche Daten anzuzeigen oder b√∂sartige Aktivit√§ten zu verbergen.
```bash
aws cloudwatch delete-dashboards --dashboard-names <value>
aws cloudwatch put-dashboard --dashboard-name <value> --dashboard-body <value>
```
**Potenzielle Auswirkungen**: Verlust der √úberwachungssichtbarkeit und irref√ºhrende Informationen.

### **`cloudwatch:DeleteInsightRules`,¬†`cloudwatch:PutInsightRule` ,`cloudwatch:PutManagedInsightRule`**

Insight-Regeln werden verwendet, um Anomalien zu erkennen, die Leistung zu optimieren und Ressourcen effektiv zu verwalten. Durch das L√∂schen bestehender Insight-Regeln k√∂nnte ein Angreifer kritische √úberwachungsfunktionen entfernen, sodass das System blind f√ºr Leistungsprobleme und Sicherheitsbedrohungen wird. Dar√ºber hinaus k√∂nnte ein Angreifer Insight-Regeln erstellen oder √§ndern, um irref√ºhrende Daten zu generieren oder b√∂sartige Aktivit√§ten zu verbergen, was zu falschen Diagnosen und unangemessenen Reaktionen des Betriebsteams f√ºhren k√∂nnte.
```bash
aws cloudwatch delete-insight-rules --rule-names <value>
aws cloudwatch put-insight-rule --rule-name <value> --rule-definition <value> [--rule-state <value>]
aws cloudwatch put-managed-insight-rules --managed-rules <value>
```
**Potenzielle Auswirkungen**: Schwierigkeiten bei der Erkennung und Reaktion auf Leistungsprobleme und Anomalien, fehlerhafte Entscheidungsfindung und m√∂glicherweise das Verbergen von b√∂sartigen Aktivit√§ten oder Systemausf√§llen.

### **`cloudwatch:DisableInsightRules`,¬†`cloudwatch:EnableInsightRules`**

Durch Deaktivieren kritischer Einsichtsregeln k√∂nnte ein Angreifer die Organisation effektiv blind f√ºr wichtige Leistungs- und Sicherheitsmetriken machen. Umgekehrt k√∂nnte es durch Aktivieren oder Konfigurieren irref√ºhrender Regeln m√∂glich sein, falsche Daten zu generieren, L√§rm zu erzeugen oder b√∂sartige Aktivit√§ten zu verbergen.
```bash
aws cloudwatch disable-insight-rules --rule-names <value>
aws cloudwatch enable-insight-rules --rule-names <value>
```
**Potenzielle Auswirkungen**: Verwirrung im Betriebsteam, was zu verz√∂gerten Reaktionen auf tats√§chliche Probleme und unn√∂tigen Aktionen aufgrund falscher Alarme f√ºhren kann.

### **`cloudwatch:DeleteMetricStream`, `cloudwatch:PutMetricStream`, `cloudwatch:PutMetricData`**

Ein Angreifer mit den Berechtigungen **`cloudwatch:DeleteMetricStream`**, **`cloudwatch:PutMetricStream`** k√∂nnte Metrikdatenstr√∂me erstellen und l√∂schen, was die Sicherheit, √úberwachung und Datenintegrit√§t gef√§hrden w√ºrde:

- **Erstellen von b√∂sartigen Str√∂men**: Erstellen von Metrikdatenstr√∂men, um sensible Daten an nicht autorisierte Ziele zu senden.
- **Ressourcenmanipulation**: Das Erstellen neuer Metrikdatenstr√∂me mit √ºberm√§√üigen Daten k√∂nnte viel L√§rm verursachen, falsche Alarme ausl√∂sen und echte Probleme maskieren.
- **√úberwachungsst√∂rung**: Durch L√∂schen von Metrikdatenstr√∂men w√ºrden Angreifer den kontinuierlichen Datenfluss der √úberwachung unterbrechen. Auf diese Weise k√∂nnten ihre b√∂sartigen Aktivit√§ten effektiv verborgen werden.

Ebenso w√§re es mit der Berechtigung **`cloudwatch:PutMetricData`** m√∂glich, Daten zu einem Metrikdatenstrom hinzuzuf√ºgen. Dies k√∂nnte zu einem DoS f√ºhren, aufgrund der Menge an falschen Daten, die hinzugef√ºgt werden, was den Datenstrom vollst√§ndig nutzlos machen w√ºrde.
```bash
aws cloudwatch delete-metric-stream --name <value>
aws cloudwatch put-metric-stream --name <value> [--include-filters <value>] [--exclude-filters <value>] --firehose-arn <value> --role-arn <value> --output-format <value>
aws cloudwatch put-metric-data --namespace <value> [--metric-data <value>] [--metric-name <value>] [--timestamp <value>] [--unit <value>] [--value <value>] [--dimensions <value>]
```
Beispiel f√ºr das Hinzuf√ºgen von Daten, die einer CPU-Auslastung von 70% √ºber einer bestimmten EC2-Instanz entsprechen:
```bash
aws cloudwatch put-metric-data --namespace "AWS/EC2" --metric-name "CPUUtilization" --value 70 --unit "Percent" --dimensions "InstanceId=i-0123456789abcdefg"
```
**Potenzielle Auswirkungen**: St√∂rung des Daten√ºberwachungsflusses, Beeintr√§chtigung der Erkennung von Anomalien und Vorf√§llen, Ressourcenmanipulation und Kostensteigerung aufgrund der Erstellung √ºberm√§√üiger Metrikstreams.

### **`cloudwatch:StopMetricStreams`,¬†`cloudwatch:StartMetricStreams`**

Ein Angreifer k√∂nnte den Fluss der betroffenen Metrikdatenstr√∂me kontrollieren (jeden Datenstrom, wenn keine Ressourcenbeschr√§nkung vorliegt). Mit der Berechtigung **`cloudwatch:StopMetricStreams`** k√∂nnten Angreifer ihre b√∂sartigen Aktivit√§ten verbergen, indem sie kritische Metrikstreams stoppen.
```bash
aws cloudwatch stop-metric-streams --names <value>
aws cloudwatch start-metric-streams --names <value>
```
**Potenzielle Auswirkungen**: St√∂rung des Daten√ºberwachungsflusses, was sich auf die Erkennung von Anomalien und Vorf√§llen auswirken k√∂nnte.

### **`cloudwatch:TagResource`,¬†`cloudwatch:UntagResource`**

Ein Angreifer k√∂nnte Tags zu CloudWatch-Ressourcen hinzuf√ºgen, √§ndern oder entfernen (derzeit nur Alarme und Contributor Insights-Regeln). Dies k√∂nnte die Zugriffskontrollrichtlinien Ihrer Organisation st√∂ren, die auf Tags basieren.
```bash
aws cloudwatch tag-resource --resource-arn <value> --tags <value>
aws cloudwatch untag-resource --resource-arn <value> --tag-keys <value>
```
**Potenzielle Auswirkungen**: St√∂rung von zugriffsbasierten Richtlinien zur Tag-Steuerung.

## Referenzen

* [https://cloudsecdocs.com/aws/services/logging/cloudwatch/](https://cloudsecdocs.com/aws/services/logging/cloudwatch/#general-info)
* [https://docs.aws.amazon.com/service-authorization/latest/reference/list_amazoncloudwatch.html](https://docs.aws.amazon.com/service-authorization/latest/reference/list_amazoncloudwatch.html)
* [https://docs.aws.amazon.com/es_es/AmazonCloudWatch/latest/monitoring/cloudwatch_concepts.html#Metric](https://docs.aws.amazon.com/es_es/AmazonCloudWatch/latest/monitoring/cloudwatch_concepts.html#Metric)

{% hint style="success" %}
Lernen Sie & √ºben Sie AWS-Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Lernen Sie & √ºben Sie GCP-Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Unterst√ºtzen Sie HackTricks</summary>

* √úberpr√ºfen Sie die [**Abonnementpl√§ne**](https://github.com/sponsors/carlospolop)!
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teilen Sie Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repositories einreichen.

</details>
{% endhint %}
