# AWS - CloudWatch Enum

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## CloudWatch

**CloudWatch** **prikuplja** monitoring i operativne **podatke** u obliku logova/metrika/dogaÄ‘aja pruÅ¾ajuÄ‡i **ujedinjeni pregled AWS resursa**, aplikacija i usluga.\
CloudWatch Log Event ima **ograniÄenje veliÄine od 256KB po svakoj log liniji**.\
MoÅ¾e postaviti **alarme visoke rezolucije**, vizualizovati **logove** i **metrike** jedan pored drugog, preduzeti automatske akcije, reÅ¡avati probleme i otkrivati uvide za optimizaciju aplikacija.

MoÅ¾ete pratiti, na primer, logove iz CloudTraila. DogaÄ‘aji koji se prate:

* Promene u sigurnosnim grupama i NACL-ima
* Pokretanje, zaustavljanje, ponovo pokretanje i gaÅ¡enje EC2 instanci
* Promene u sigurnosnim politikama unutar IAM i S3
* NeuspeÅ¡ni pokuÅ¡aji prijavljivanja na AWS Management Console
* API pozivi koji su rezultirali neuspeÅ¡nom autorizacijom
* Filteri za pretragu u cloudwatch: [https://docs.aws.amazon.com/AmazonCloudWatch/latest/logs/FilterAndPatternSyntax.html](https://docs.aws.amazon.com/AmazonCloudWatch/latest/logs/FilterAndPatternSyntax.html)

## KljuÄni koncepti

### Namespaces

Namespace je kontejner za CloudWatch metrike. PomaÅ¾e u kategorizaciji i izolaciji metrika, olakÅ¡avajuÄ‡i njihovo upravljanje i analizu.

* **Primeri**: AWS/EC2 za EC2 povezane metrike, AWS/RDS za RDS metrike.

### Metrike

Metrike su podaci prikupljeni tokom vremena koji predstavljaju performanse ili koriÅ¡Ä‡enje AWS resursa. Metrike se mogu prikupljati iz AWS usluga, prilagoÄ‘enih aplikacija ili integracija treÄ‡ih strana.

* **Primer**: CPUUtilization, NetworkIn, DiskReadOps.

### Dimenzije

Dimenzije su parovi kljuÄ-vrednost koji su deo metrika. PomaÅ¾u da se jedinstveno identifikuje metrika i pruÅ¾aju dodatni kontekst, pri Äemu je 30 maksimalan broj dimenzija koje se mogu povezati sa metrikom. Dimenzije takoÄ‘e omoguÄ‡avaju filtriranje i agregaciju metrika na osnovu specifiÄnih atributa.

* **Primer**: Za EC2 instance, dimenzije mogu ukljuÄivati InstanceId, InstanceType i AvailabilityZone.

### Statistike

Statistike su matematiÄke kalkulacije izvrÅ¡ene na podacima metrika kako bi ih saÅ¾ele tokom vremena. UobiÄajene statistike ukljuÄuju ProseÄno, Zbir, Minimum, Maksimum i Broj uzoraka.

* **Primer**: IzraÄunavanje proseÄne CPU upotrebe tokom perioda od jednog sata.

### Jedinice

Jedinice su tip merenja povezan sa metrikom. Jedinice pomaÅ¾u da se pruÅ¾i kontekst i znaÄenje podacima metrika. UobiÄajene jedinice ukljuÄuju Procenat, Bajti, Sekunde, Broj.

* **Primer**: CPUUtilization moÅ¾e biti meren u Procentima, dok NetworkIn moÅ¾e biti meren u Bajtima.

## CloudWatch Karakteristike

### Dashboard

**CloudWatch Dashboards** pruÅ¾aju prilagodljive **poglede na vaÅ¡e AWS CloudWatch metrike**. MoguÄ‡e je kreirati i konfigurisati dashboarde za vizualizaciju podataka i praÄ‡enje resursa u jednom pogledu, kombinujuÄ‡i razliÄite metrike iz raznih AWS usluga.

**KljuÄne karakteristike**:

* **Widgeti**: GraÄ‘evinski blokovi dashboarda, ukljuÄujuÄ‡i grafike, tekst, alarme i joÅ¡ mnogo toga.
* **PrilagoÄ‘avanje**: Raspored i sadrÅ¾aj mogu se prilagoditi kako bi odgovarali specifiÄnim potrebama praÄ‡enja.

**Primer upotrebe**:

* Jedan dashboard koji prikazuje kljuÄne metrike za celo vaÅ¡e AWS okruÅ¾enje, ukljuÄujuÄ‡i EC2 instance, RDS baze podataka i S3 kante.

### Metric Stream i Metric Data

**Metric Streams** u AWS CloudWatch omoguÄ‡avaju vam da kontinuirano strimujete CloudWatch metrike na odrediÅ¡te po vaÅ¡em izboru u skoro realnom vremenu. Ovo je posebno korisno za napredno praÄ‡enje, analitiku i prilagoÄ‘ene dashboarde koristeÄ‡i alate van AWS-a.

**Metric Data** unutar Metric Streams odnosi se na stvarna merenja ili podatke koji se strimuju. Ovi podaci predstavljaju razliÄite metrike kao Å¡to su CPU upotreba, koriÅ¡Ä‡enje memorije itd., za AWS resurse.

**Primer upotrebe**:

* Slanje real-time metrika treÄ‡oj strani za naprednu analizu.
* Arhiviranje metrika u Amazon S3 kanti za dugoroÄno skladiÅ¡tenje i usklaÄ‘enost.

### Alarm

**CloudWatch Alarms** prate vaÅ¡e metrike i preduzimaju akcije na osnovu unapred definisanih pragova. Kada metrika prekoraÄi prag, alarm moÅ¾e izvrÅ¡iti jednu ili viÅ¡e akcija kao Å¡to su slanje obaveÅ¡tenja putem SNS-a, pokretanje politike automatskog skaliranja ili pokretanje AWS Lambda funkcije.

**KljuÄne komponente**:

* **Prag**: Vrednost na kojoj se alarm aktivira.
* **Periodi evaluacije**: Broj perioda tokom kojih se podaci evaluiraju.
* **Podaci za alarm**: Broj perioda sa dostignutim pragom potrebnim za aktiviranje alarma.
* **Akcije**: Å ta se deÅ¡ava kada se aktivira stanje alarma (npr. obaveÅ¡tavanje putem SNS-a).

**Primer upotrebe**:

* PraÄ‡enje CPU upotrebe EC2 instance i slanje obaveÅ¡tenja putem SNS-a ako preÄ‘e 80% tokom 5 uzastopnih minuta.

### Anomaly Detectors

**Anomaly Detectors** koriste maÅ¡insko uÄenje za automatsko otkrivanje anomalija u vaÅ¡im metrikama. MoÅ¾ete primeniti detekciju anomalija na bilo koju CloudWatch metriku kako biste identifikovali odstupanja od normalnih obrazaca koja mogu ukazivati na probleme.

**KljuÄne komponente**:

* **Obuka modela**: CloudWatch koristi istorijske podatke za obuku modela i utvrÄ‘ivanje kako izgleda normalno ponaÅ¡anje.
* **Traka detekcije anomalija**: Vizuelna reprezentacija oÄekivanog opsega vrednosti za metriku.

**Primer upotrebe**:

* Otkrivanje neobiÄnih obrazaca CPU upotrebe u EC2 instanci koji mogu ukazivati na bezbednosni proboj ili problem sa aplikacijom.

### Insight Rules i Managed Insight Rules

**Insight Rules** omoguÄ‡avaju vam da identifikujete trendove, detektujete skokove ili druge obrasce od interesa u vaÅ¡im podacima metrika koristeÄ‡i **moÄ‡ne matematiÄke izraze** za definisanje uslova pod kojima bi se trebale preduzeti akcije. Ova pravila mogu vam pomoÄ‡i da identifikujete anomalije ili neobiÄno ponaÅ¡anje u performansama i koriÅ¡Ä‡enju vaÅ¡ih resursa.

**Managed Insight Rules** su unapred konfigurisana **insight pravila koja pruÅ¾a AWS**. Dizajnirana su za praÄ‡enje specifiÄnih AWS usluga ili uobiÄajenih sluÄajeva koriÅ¡Ä‡enja i mogu se omoguÄ‡iti bez potrebe za detaljnom konfiguracijom.

**Primer upotrebe**:

* PraÄ‡enje RDS performansi: OmoguÄ‡ite upravljano insight pravilo za Amazon RDS koje prati kljuÄne indikatore performansi kao Å¡to su CPU upotreba, koriÅ¡Ä‡enje memorije i disk I/O. Ako bilo koja od ovih metrika premaÅ¡i sigurne operativne pragove, pravilo moÅ¾e aktivirati upozorenje ili automatsku akciju ublaÅ¾avanja.

### CloudWatch Logs <a href="#cloudwatch-logs" id="cloudwatch-logs"></a>

OmoguÄ‡ava **agregaciju i praÄ‡enje logova iz aplikacija** i sistema iz **AWS usluga** (ukljuÄujuÄ‡i CloudTrail) i **iz aplikacija/sistema** (**CloudWatch Agent** moÅ¾e biti instaliran na hostu). Logovi se mogu **Äuvati neodreÄ‘eno** (u zavisnosti od podeÅ¡avanja Log Grupe) i mogu se eksportovati.

**Elementi**:

| **Log Group**            | **Kolekcija log stream-ova** koji dele iste postavke zadrÅ¾avanja, praÄ‡enja i kontrole pristupa                                                     |
| ------------------------ | ---------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **Log Stream**           | Sekvenca **log dogaÄ‘aja** koji dele **isti izvor**                                                                                                |
| **Subscription Filters** | DefiniÅ¡u **filter obrazac koji odgovara dogaÄ‘ajima** u odreÄ‘enoj log grupi, Å¡alju ih u Kinesis Data Firehose stream, Kinesis stream ili Lambda funkciju |

### CloudWatch Monitoring & Events

CloudWatch **osnovni** agregira podatke **svakih 5 minuta** (detaljni to radi **svakih 1 minuta**). Nakon agregacije, **proverava pragove alarma** u sluÄaju da treba da aktivira jedan.\
U tom sluÄaju, CloudWatch moÅ¾e biti spreman da poÅ¡alje dogaÄ‘aj i izvrÅ¡i neke automatske akcije (AWS lambda funkcije, SNS teme, SQS redovi, Kinesis Streams)

### Instalacija agenta

MoÅ¾ete instalirati agente unutar vaÅ¡ih maÅ¡ina/kontejnera kako biste automatski slali logove nazad u CloudWatch.

* **Kreirajte** **ulogu** i **prikljuÄite** je na **instancu** sa dozvolama koje omoguÄ‡avaju CloudWatch-u da prikuplja podatke iz instanci pored interakcije sa AWS sistem menadÅ¾erom SSM (CloudWatchAgentAdminPolicy & AmazonEC2RoleforSSM)
* **Preuzmite** i **instalirajte** **agenta** na EC2 instancu ([https://s3.amazonaws.com/amazoncloudwatch-agent/linux/amd64/latest/AmazonCloudWatchAgent.zip](https://s3.amazonaws.com/amazoncloudwatch-agent/linux/amd64/latest/AmazonCloudWatchAgent.zip)). MoÅ¾ete ga preuzeti iz EC2 ili ga automatski instalirati koristeÄ‡i AWS System Manager birajuÄ‡i paket AWS-ConfigureAWSPackage
* **KonfiguriÅ¡ite** i **pokrenite** CloudWatch Agent

Log grupa ima mnogo stream-ova. Stream ima mnogo dogaÄ‘aja. I unutar svakog stream-a, dogaÄ‘aji su zagarantovani da budu u redosledu.

## Enumeration
```bash
# Dashboards #

## Returns a list of the dashboards of your account
aws cloudwatch list-dashboards

## Retrieves the details of the specified dashboard
aws cloudwatch get-dashboard --dashboard-name <value>

# Metrics #

## Returns a list of the specified metric
aws cloudwatch list-metrics [--namespace <value>] [--metric-name <value>] [--dimensions <value>] [--include-linked-accounts | --no-include-linked-accounts]

## Retrieves metric data (this operation can include a CloudWatch Metrics Insights query, and one or more metric math functions)
aws cloudwatch get-metric-data --metric-data-queries <value> --start-time <value> --end-time <value>

## Retrieves statistics for the specified metric and namespace over a range of time
aws cloudwatch get-metric-statistics --namespace <value> --metric-name <value> [--dimensions <value>] --start-time <value> --end-time <value> --period <value>

## Returns a list of the metric streams of your account
aws cloudwatch list-metric-streams

## Retrieves information about the specified metric stream
aws cloudwatch get-metric-stream --name <value>

## Retrieve snapshots of the specified metric widgets
aws cloudwatch get-metric-widget-image --metric-widget <value>

# Alarms #

## Retrieves the specified alarm
aws cloudwatch describe-alarms [--alarm-names <value>] [--alarm-name-prefix <value>] [--alarm-types <value>] [--state-value <value>]

## Retrieves the alarms history, even for deleted alarms
aws cloudwatch describe-alarm-history [--alarm-name <value>] [--alarm-types <value>] [--history-item-type <ConfigurationUpdate | StateUpdate | Action>] [--start-date <value>] [--end-date <value>]

## Retrieves standard alarms based on the specified metric
aws cloudwatch escribe-alarms-for-metric --metric-name <value> --namespace <value> [--dimensions <value>]

# Anomaly Detections #

## Lists the anomaly detection models that you have created in your account
aws cloudwatch describe-anomaly-detectors [--namespace <value>] [--metric-name <value>] [--dimensions <value>]

## Lists all the Contributor Insight rules in your account
aws cloudwatch describe-insight-rules

## Retrieves the data collected over a time range for a given Contributor Insight rule
aws cloudwatch get-insight-rule-report --rule-name <value> --start-time <value> --end-time <value> --period <value>

## Lists managed Contributor Insights rules in your account for a specified resource
aws cloudwatch list-managed-insight-rules --resource-arn <value>

# Tags #

## Lists the tags associated with the specified CloudWatch resources
aws cloudwatch list-tags-for-resource --resource-arn <value>

# CloudWatch Logs #
aws logs tail "<log_group_name>" --followaws logs get-log-events --log-group-name "<log_group_name>" --log-stream-name "<log_stream_name>" --output text > <output_file>

# CloudWatch Events #
aws events list-rules
aws events describe-rule --name <name>aws events list-targets-by-rule --rule <name>aws events list-archives
aws events describe-archive --archive-name <name>aws events list-connections
aws events describe-connection --name <name>aws events list-endpoints
aws events describe-endpoint --name <name>aws events list-event-sources
aws events describe-event-source --name <name>aws events list-replays
aws events list-api-destinations
aws events list-event-buses
```
## Post-Exploitation / Bypass

### **`cloudwatch:DeleteAlarms`,`cloudwatch:PutMetricAlarm` , `cloudwatch:PutCompositeAlarm`**

NapadaÄ sa ovim dozvolama mogao bi znaÄajno oslabiti infrastrukturu za praÄ‡enje i obaveÅ¡tavanje organizacije. Brisanjem postojeÄ‡ih alarma, napadaÄ bi mogao onemoguÄ‡iti kljuÄne obaveÅ¡tenja koja obaveÅ¡tavaju administratore o kritiÄnim problemima sa performansama, bezbednosnim povredama ili operativnim neuspesima. Pored toga, kreiranjem ili modifikovanjem metrik alarmÃ¢, napadaÄ bi takoÄ‘e mogao da obmanjuje administratore laÅ¾nim obaveÅ¡tenjima ili da utiÅ¡a legitimne alarme, efikasno prikrivajuÄ‡i zlonamerne aktivnosti i spreÄavajuÄ‡i pravovremene reakcije na stvarne incidente.

Pored toga, sa dozvolom **`cloudwatch:PutCompositeAlarm`**, napadaÄ bi mogao da kreira petlju ili ciklus kompozitnih alarma, gde kompozitni alarm A zavisi od kompozitnog alarma B, a kompozitni alarm B takoÄ‘e zavisi od kompozitnog alarma A. U ovom scenariju, nije moguÄ‡e obrisati nijedan kompozitni alarm koji je deo ciklusa jer uvek postoji kompozitni alarm koji zavisi od alarma koji Å¾elite da obriÅ¡ete.
```bash
aws cloudwatch put-metric-alarm --cli-input-json <value> | --alarm-name <value> --comparison-operator <value> --evaluation-periods <value> [--datapoints-to-alarm <value>] [--threshold <value>] [--alarm-description <value>] [--alarm-actions <value>] [--metric-name <value>] [--namespace <value>] [--statistic <value>] [--dimensions <value>] [--period <value>]
aws cloudwatch delete-alarms --alarm-names <value>
aws cloudwatch put-composite-alarm --alarm-name <value> --alarm-rule <value> [--no-actions-enabled | --actions-enabled [--alarm-actions <value>] [--insufficient-data-actions <value>] [--ok-actions <value>] ]
```
SledeÄ‡i primer pokazuje kako uÄiniti metrik alarm neefikasnim:

* Ovaj metrik alarm prati proseÄnu CPU upotrebu specifiÄne EC2 instance, procenjuje metrik svake 300 sekundi i zahteva 6 evaluacionih perioda (ukupno 30 minuta). Ako proseÄna CPU upotreba premaÅ¡i 60% u najmanje 4 od ovih perioda, alarm Ä‡e se aktivirati i poslati obaveÅ¡tenje na odreÄ‘enu SNS temu.
* Modifikovanjem Praga na viÅ¡e od 99%, postavljanjem Perioda na 10 sekundi, Evaluacionih Perioda na 8640 (poÅ¡to 8640 perioda od 10 sekundi jednako 1 dan), i Datapoints to Alarm na 8640, bilo bi neophodno da CPU upotreba bude preko 99% svake 10 sekundi tokom celog 24-satnog perioda da bi se aktivirao alarm.

{% tabs %}
{% tab title="Original Metric Alarm" %}
```json
{
"Namespace": "AWS/EC2",
"MetricName": "CPUUtilization",
"Dimensions": [
{
"Name": "InstanceId",
"Value": "i-01234567890123456"
}
],
"AlarmActions": [
"arn:aws:sns:us-east-1:123456789012:example_sns"
],
"ComparisonOperator": "GreaterThanThreshold",
"DatapointsToAlarm": 4,
"EvaluationPeriods": 6,
"Period": 300,
"Statistic": "Average",
"Threshold": 60,
"AlarmDescription": "CPU Utilization of i-01234567890123456 over 60%",
"AlarmName": "EC2 instance i-01234567890123456 CPU Utilization"
}
```
{% endtab %}

{% tab title="Izmenjeno Metrika Alarm" %}
```json
{
"Namespace": "AWS/EC2",
"MetricName": "CPUUtilization",
"Dimensions": [
{
"Name": "InstanceId",
"Value": "i-0645d6d414dadf9f8"
}
],
"AlarmActions": [],
"ComparisonOperator": "GreaterThanThreshold",
"DatapointsToAlarm": 8640,
"EvaluationPeriods": 8640,
"Period": 10,
"Statistic": "Average",
"Threshold": 99,
"AlarmDescription": "CPU Utilization of i-01234567890123456 with 60% as threshold",
"AlarmName": "Instance i-0645d6d414dadf9f8 CPU Utilization"
}

```
{% endtab %}
{% endtabs %}

**Potencijalni uticaj**: Nedostatak obaveÅ¡tenja za kritiÄne dogaÄ‘aje, potencijalni neotkriveni problemi, laÅ¾ni alarmi, potiskivanje stvarnih alarma i potencijalno propuÅ¡tene detekcije stvarnih incidenata.

### **`cloudwatch:DeleteAlarmActions`, `cloudwatch:EnableAlarmActions`, `cloudwatch:SetAlarmState`**

Brisanjem akcija alarma, napadaÄ bi mogao spreÄiti kritiÄne obaveÅ¡tenja i automatske odgovore da budu aktivirani kada se dostigne stanje alarma, kao Å¡to je obaveÅ¡tavanje administratora ili pokretanje automatskih aktivnosti skaliranja. Neprikladno omoguÄ‡avanje ili ponovo omoguÄ‡avanje akcija alarma takoÄ‘e moÅ¾e dovesti do neoÄekivanih ponaÅ¡anja, bilo ponovnim aktiviranjem prethodno onemoguÄ‡enih akcija ili modifikovanjem koje se akcije aktiviraju, potencijalno uzrokujuÄ‡i konfuziju i pogreÅ¡ne smernice u odgovoru na incidente.

Pored toga, napadaÄ sa dozvolom mogao bi manipulisati stanjima alarma, imajuÄ‡i moguÄ‡nost da kreira laÅ¾ne alarme kako bi odvratio i zbunio administratore, ili da utiÅ¡a stvarne alarme kako bi sakrio tekuÄ‡e zlonamerne aktivnosti ili kritiÄne kvarove sistema.

* Ako koristite **`SetAlarmState`** na kompozitnom alarmu, kompozitni alarm nije garantovan da se vrati u svoje stvarno stanje. VraÄ‡a se u svoje stvarno stanje samo kada se bilo koji od njegovih alarmnih podreÄ‘enih promeni stanje. TakoÄ‘e se ponovo procenjuje ako aÅ¾urirate njegovu konfiguraciju.
```bash
aws cloudwatch disable-alarm-actions --alarm-names <value>
aws cloudwatch enable-alarm-actions --alarm-names <value>
aws cloudwatch set-alarm-state --alarm-name <value> --state-value <OK | ALARM | INSUFFICIENT_DATA> --state-reason <value> [--state-reason-data <value>]
```
**Potencijalni uticaj**: Nedostatak obaveÅ¡tenja za kritiÄne dogaÄ‘aje, potencijalni neotkriveni problemi, laÅ¾ne alarme, potiskivanje stvarnih alarma i potencijalno propuÅ¡tene detekcije pravih incidenata.

### **`cloudwatch:DeleteAnomalyDetector`, `cloudwatch:PutAnomalyDetector`**

NapadaÄ bi mogao da kompromituje sposobnost detekcije i odgovora na neobiÄne obrasce ili anomalije u metrikama podataka. Brisanjem postojeÄ‡ih detektora anomalija, napadaÄ bi mogao da onemoguÄ‡i kritiÄne mehanizme za obaveÅ¡tavanje; a kreiranjem ili modifikovanjem, mogao bi ili da pogreÅ¡no konfiguriÅ¡e ili stvara laÅ¾ne pozitivne rezultate kako bi skrenuo paÅ¾nju ili preplavio monitoring.
```bash
aws cloudwatch delete-anomaly-detector [--cli-input-json <value> | --namespace <value> --metric-name <value> --dimensions <value> --stat <value>]
aws cloudwatch put-anomaly-detector [--cli-input-json <value> | --namespace <value> --metric-name <value> --dimensions <value> --stat <value> --configuration <value> --metric-characteristics <value>]
```
SledeÄ‡i primer pokazuje kako uÄiniti detektor anomalija metrika neefikasnim. Ovaj detektor anomalija metrika prati proseÄnu CPU upotrebu specifiÄne EC2 instance, i samo dodavanjem parametra â€œExcludedTimeRangesâ€ sa Å¾eljenim vremenskim opsegom, bilo bi dovoljno da se osigura da detektor anomalija ne analizira ili ne upozorava na bilo koje relevantne podatke tokom tog perioda.

{% tabs %}
{% tab title="Original Metric Anomaly Detector" %}
```json
{
"SingleMetricAnomalyDetector": {
"Namespace": "AWS/EC2",
"MetricName": "CPUUtilization",
"Stat": "Average",
"Dimensions": [
{
"Name": "InstanceId",
"Value": "i-0123456789abcdefg"
}
]
}
}
```
{% endtab %}

{% tab title="Modifikovani Detektor Anomalija MetriÄkih Podataka" %}
```json
{
"SingleMetricAnomalyDetector": {
"Namespace": "AWS/EC2",
"MetricName": "CPUUtilization",
"Stat": "Average",
"Dimensions": [
{
"Name": "InstanceId",
"Value": "i-0123456789abcdefg"
}
]
},
"Configuration": {
"ExcludedTimeRanges": [
{
"StartTime": "2023-01-01T00:00:00Z",
"EndTime": "2053-01-01T23:59:59Z"
}
],
"Timezone": "Europe/Madrid"
}
}
```
{% endtab %}
{% endtabs %}

**Potencijalni uticaj**: Direktan efekat na detekciju neobiÄnih obrazaca ili bezbednosnih pretnji.

### **`cloudwatch:DeleteDashboards`, `cloudwatch:PutDashboard`**

NapadaÄ bi mogao da kompromituje moguÄ‡nosti praÄ‡enja i vizualizacije organizacije kreiranjem, modifikovanjem ili brisanjem svojih kontrolnih tabla. Ove dozvole bi mogle biti iskoriÅ¡Ä‡ene za uklanjanje kritiÄne vidljivosti u performansama i zdravlju sistema, menjanje kontrolnih tabla da prikazuju netaÄne podatke ili skrivanje zlonamernih aktivnosti.
```bash
aws cloudwatch delete-dashboards --dashboard-names <value>
aws cloudwatch put-dashboard --dashboard-name <value> --dashboard-body <value>
```
**Potencijalni Uticaj**: Gubitak vidljivosti nadzorom i obmanjujuÄ‡e informacije.

### **`cloudwatch:DeleteInsightRules`, `cloudwatch:PutInsightRule` ,`cloudwatch:PutManagedInsightRule`**

Insight pravila se koriste za otkrivanje anomalija, optimizaciju performansi i efikasno upravljanje resursima. Brisanjem postojeÄ‡ih insight pravila, napadaÄ bi mogao ukloniti kritiÄne moguÄ‡nosti nadzora, ostavljajuÄ‡i sistem slepim na probleme sa performansama i bezbednosnim pretnjama. Pored toga, napadaÄ bi mogao kreirati ili modifikovati insight pravila kako bi generisao obmanjujuÄ‡e podatke ili sakrio zlonamerne aktivnosti, Å¡to bi dovelo do netaÄnih dijagnostika i neprimerenih odgovora operativnog tima.
```bash
aws cloudwatch delete-insight-rules --rule-names <value>
aws cloudwatch put-insight-rule --rule-name <value> --rule-definition <value> [--rule-state <value>]
aws cloudwatch put-managed-insight-rules --managed-rules <value>
```
**Potencijalni uticaj**: TeÅ¡koÄ‡e u otkrivanju i reagovanju na probleme sa performansama i anomalijama, pogreÅ¡no informisano donoÅ¡enje odluka i potencijalno skrivanje zlonamernih aktivnosti ili kvarova sistema.

### **`cloudwatch:DisableInsightRules`, `cloudwatch:EnableInsightRules`**

OnemoguÄ‡avanjem kritiÄnih pravila uvida, napadaÄ bi mogao efikasno da zaslepi organizaciju za kljuÄne metrike performansi i bezbednosti. S druge strane, omoguÄ‡avanjem ili konfigurisanjem obmanjujuÄ‡ih pravila, moglo bi biti moguÄ‡e generisati laÅ¾ne podatke, stvoriti Å¡um ili sakriti zlonamerne aktivnosti.
```bash
aws cloudwatch disable-insight-rules --rule-names <value>
aws cloudwatch enable-insight-rules --rule-names <value>
```
**Potencijalni uticaj**: Zbunjenost meÄ‘u operativnim timom, Å¡to dovodi do kaÅ¡njenja u odgovorima na stvarne probleme i nepotrebnih akcija zasnovanih na laÅ¾nim upozorenjima.

### **`cloudwatch:DeleteMetricStream` , `cloudwatch:PutMetricStream` , `cloudwatch:PutMetricData`**

NapadaÄ sa **`cloudwatch:DeleteMetricStream`** , **`cloudwatch:PutMetricStream`** dozvolama mogao bi da kreira i briÅ¡e tokove metrika, ugroÅ¾avajuÄ‡i bezbednost, nadzor i integritet podataka:

* **Kreiranje zlonamernih tokova**: Kreirati tokove metrika za slanje osetljivih podataka na neovlaÅ¡Ä‡ene destinacije.
* **Manipulacija resursima**: Kreiranje novih tokova metrika sa prekomernim podacima moglo bi proizvesti mnogo Å¡uma, uzrokujuÄ‡i netaÄna upozorenja, prikrivajuÄ‡i prave probleme.
* **Prekid nadzora**: Brisanjem tokova metrika, napadaÄi bi prekinuli kontinuirani tok podataka za nadzor. Na taj naÄin, njihove zlonamerne aktivnosti bi bile efikasno skrivene.

SliÄno tome, sa dozvolom **`cloudwatch:PutMetricData`**, bilo bi moguÄ‡e dodati podatke u tok metrika. To bi moglo dovesti do DoS-a zbog koliÄine nepravilnih podataka koji su dodati, ÄineÄ‡i ga potpuno beskorisnim.
```bash
aws cloudwatch delete-metric-stream --name <value>
aws cloudwatch put-metric-stream --name <value> [--include-filters <value>] [--exclude-filters <value>] --firehose-arn <value> --role-arn <value> --output-format <value>
aws cloudwatch put-metric-data --namespace <value> [--metric-data <value>] [--metric-name <value>] [--timestamp <value>] [--unit <value>] [--value <value>] [--dimensions <value>]
```
Primer dodavanja podataka koji odgovaraju 70% iskoriÅ¡Ä‡enosti CPU-a na datom EC2 instancu:
```bash
aws cloudwatch put-metric-data --namespace "AWS/EC2" --metric-name "CPUUtilization" --value 70 --unit "Percent" --dimensions "InstanceId=i-0123456789abcdefg"
```
**Potencijalni Uticaj**: PoremeÄ‡aj u protoku podataka za praÄ‡enje, Å¡to utiÄe na otkrivanje anomalija i incidenata, manipulaciju resursima i poveÄ‡anje troÅ¡kova zbog kreiranja prekomernih tokova metrika.

### **`cloudwatch:StopMetricStreams`, `cloudwatch:StartMetricStreams`**

NapadaÄ bi kontrolisao protok pogoÄ‘enih tokova podataka metrika (svaki tok podataka ako nema ograniÄenja resursa). Sa dozvolom **`cloudwatch:StopMetricStreams`**, napadaÄi bi mogli da sakriju svoje zlonamerne aktivnosti zaustavljanjem kritiÄnih tokova metrika.
```bash
aws cloudwatch stop-metric-streams --names <value>
aws cloudwatch start-metric-streams --names <value>
```
**Potencijalni uticaj**: PoremeÄ‡aj u protoku podataka o nadzoru, Å¡to utiÄe na otkrivanje anomalija i incidenata.

### **`cloudwatch:TagResource`, `cloudwatch:UntagResource`**

NapadaÄ bi mogao da doda, izmeni ili ukloni oznake sa CloudWatch resursa (trenutno samo alarma i pravila za Contributor Insights). Ovo bi moglo poremetiti politike pristupa vaÅ¡e organizacije zasnovane na oznakama.
```bash
aws cloudwatch tag-resource --resource-arn <value> --tags <value>
aws cloudwatch untag-resource --resource-arn <value> --tag-keys <value>
```
**Potencijalni uticaj**: PoremeÄ‡aj politika pristupa zasnovanih na oznakama.

## Reference

* [https://cloudsecdocs.com/aws/services/logging/cloudwatch/](https://cloudsecdocs.com/aws/services/logging/cloudwatch/#general-info)
* [https://docs.aws.amazon.com/service-authorization/latest/reference/list\_amazoncloudwatch.html](https://docs.aws.amazon.com/service-authorization/latest/reference/list\_amazoncloudwatch.html)
* [https://docs.aws.amazon.com/es\_es/AmazonCloudWatch/latest/monitoring/cloudwatch\_concepts.html#Metric](https://docs.aws.amazon.com/es\_es/AmazonCloudWatch/latest/monitoring/cloudwatch\_concepts.html#Metric)

{% hint style="success" %}
UÄite i veÅ¾bajte AWS Hacking:<img src="../../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
UÄite i veÅ¾bajte GCP Hacking: <img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>PodrÅ¾ite HackTricks</summary>

* Proverite [**planove pretplate**](https://github.com/sponsors/carlospolop)!
* **PridruÅ¾ite se** ğŸ’¬ [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili **pratite** nas na **Twitteru** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podelite hakerske trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
{% endhint %}
