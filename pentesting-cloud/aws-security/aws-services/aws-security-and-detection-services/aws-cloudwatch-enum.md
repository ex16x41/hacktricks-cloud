# AWS - CloudWatch Enum

<details>

<summary><strong>NauÄite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi naÄini podrÅ¡ke HackTricks-u:

* Ako Å¾elite da vidite **vaÅ¡u kompaniju reklamiranu na HackTricks-u** ili **preuzmete HackTricks u PDF formatu** proverite [**PLANOVE ZA PRIJATELJSTVO**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvaniÄni PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), naÅ¡u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **PridruÅ¾ite se** ğŸ’¬ [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitteru** ğŸ¦ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>

## CloudWatch

**CloudWatch** **sakuplja** nadzorne i operativne **podatke** u obliku logova/metriÄkih podataka/dogaÄ‘aja pruÅ¾ajuÄ‡i **ujedinjeni prikaz AWS resursa**, aplikacija i usluga.\
CloudWatch Log dogaÄ‘aji imaju **ograniÄenje veliÄine od 256KB po svakoj liniji loga**.\
MoÅ¾e postaviti **alarme visoke rezolucije**, vizualizovati **logove** i **metrike** jedno pored drugog, preduzimati automatske akcije, reÅ¡avati probleme i otkrivati uvide radi optimizacije aplikacija.

MoÅ¾ete pratiti na primer logove iz CloudTrail-a. DogaÄ‘aji koji se prate:

* Promene u Sigurnosnim grupama i NACL-ima
* Pokretanje, zaustavljanje, ponovno pokretanje i gaÅ¡enje EC2 instanci
* Promene u Sigurnosnim politikama unutar IAM-a i S3
* NeuspeÅ¡ni pokuÅ¡aji prijave u AWS Management konzolu
* API pozivi koji su rezultirali neuspeÅ¡nom autorizacijom
* Filteri za pretragu u cloudwatch-u: [https://docs.aws.amazon.com/AmazonCloudWatch/latest/logs/FilterAndPatternSyntax.html](https://docs.aws.amazon.com/AmazonCloudWatch/latest/logs/FilterAndPatternSyntax.html)

## KljuÄni koncepti

### Namespace-ovi

Namespace je kontejner za CloudWatch metrike. PomaÅ¾e u kategorizaciji i izolaciji metrika, ÄineÄ‡i ih lakÅ¡im za upravljanje i analizu.

- **Primeri**: AWS/EC2 za metrike vezane za EC2, AWS/RDS za RDS metrike.

### Metrike

Metrike su podaci prikupljeni tokom vremena koji predstavljaju performanse ili iskoriÅ¡Ä‡enost AWS resursa. Metrike se mogu prikupljati iz AWS usluga, prilagoÄ‘enih aplikacija ili integracija treÄ‡ih strana.

- **Primer**: CPUUtilization, NetworkIn, DiskReadOps.

### Dimenzije

Dimenzije su parovi kljuÄ-vrednost koji su deo metrika. PomaÅ¾u u jedinstvenom identifikovanju metrike i pruÅ¾aju dodatni kontekst, pri Äemu je 30 najveÄ‡i broj dimenzija koje mogu biti povezane sa metrikom. Dimenzije takoÄ‘e omoguÄ‡avaju filtriranje i agregiranje metrika na osnovu specifiÄnih atributa.

- **Primer**: Za EC2 instance, dimenzije mogu ukljuÄivati InstanceId, InstanceType i AvailabilityZone.

### Statistike

Statistike su matematiÄki proraÄuni izvrÅ¡eni nad metriÄkim podacima radi sumiranja tokom vremena. UobiÄajene statistike ukljuÄuju Prosek, Zbir, Minimum, Maksimum i Broj uzoraka.

- **Primer**: RaÄunanje proseÄne iskoriÅ¡Ä‡enosti CPU-a tokom perioda od jednog sata.

### Jedinice

Jedinice su tip merenja povezan sa metrikom. Jedinice pomaÅ¾u u pruÅ¾anju konteksta i znaÄenja podataka metrike. UobiÄajene jedinice ukljuÄuju Procenat, Bajtovi, Sekunde, Broj.

- **Primer**: CPUUtilization moÅ¾e biti meren u Procentima, dok NetworkIn moÅ¾e biti meren u Bajtovima.

## CloudWatch Funkcionalnosti

### Tabla

**CloudWatch Table** pruÅ¾a prilagodljive **prikaze vaÅ¡ih AWS CloudWatch metrika**. MoguÄ‡e je kreirati i konfigurisati table za vizualizaciju podataka i nadgledanje resursa u jednom prikazu, kombinujuÄ‡i razliÄite metrike iz razliÄitih AWS usluga.

**KljuÄne Funkcionalnosti**:

- **VidÅ¾eti**: GraÄ‘evinski blokovi tabli, ukljuÄujuÄ‡i grafikone, tekst, alarme i viÅ¡e.
- **PrilagoÄ‘avanje**: Izgled i sadrÅ¾aj mogu biti prilagoÄ‘eni da odgovaraju specifiÄnim potrebama nadgledanja.

**Primer Upotrebe**:

- Jedna tabla koja prikazuje kljuÄne metrike za ceo vaÅ¡ AWS okruÅ¾enje, ukljuÄujuÄ‡i EC2 instance, RDS baze podataka i S3 kante.

### Tok Metrike i MetriÄki Podaci

**Tok Metrike** u AWS CloudWatch-u omoguÄ‡ava vam kontinuirano strujanje CloudWatch metrika do odrediÅ¡ta po vaÅ¡em izboru u gotovo realnom vremenu. Ovo je posebno korisno za napredno nadgledanje, analitiku i prilagoÄ‘ene table koristeÄ‡i alate van AWS-a.

**MetriÄki Podaci** unutar Toka Metrike odnose se na stvarna merenja ili podatke koji se strujaju. Ovi podaci predstavljaju razliÄite metrike poput iskoriÅ¡Ä‡enja CPU-a, iskoriÅ¡Ä‡enja memorije, itd., za AWS resurse.

**Primer Upotrebe**:

- Slanje metrika u realnom vremenu treÄ‡oj monitoring usluzi za naprednu analizu.
- Arhiviranje metrika u Amazon S3 kantu za dugoroÄno skladiÅ¡tenje i usklaÄ‘enost.

### Alarm

**CloudWatch Alarmi** prate vaÅ¡e metrike i vrÅ¡e akcije na osnovu unapred definisanih pragova. Kada metrika preÄ‘e prag, alarm moÅ¾e izvrÅ¡iti jednu ili viÅ¡e akcija kao Å¡to su slanje obaveÅ¡tenja putem SNS-a, pokretanje politike automatskog skaliranja ili pokretanje AWS Lambda funkcije.

**KljuÄni Komponenti**:

- **Prag**: Vrednost na kojoj alarm reaguje.
- **Periodi Evaluacije**: Broj perioda tokom kojih se podaci procenjuju.
- **Podaci do Alarma**: Broj perioda sa dostignutim pragom potrebnih da bi se alarm aktivirao.
- **Akcije**: Å ta se deÅ¡ava kada je stanje alarma aktivirano (npr. obaveÅ¡tavanje putem SNS-a).

**Primer Upotrebe**:

- Nadgledanje iskoriÅ¡Ä‡enja CPU-a EC2 instance i slanje obaveÅ¡tenja putem SNS-a ako preÄ‘e 80% tokom 5 uzastopnih minuta.

### Detektori Anomalija

**Detektori Anomalija** koriste maÅ¡insko uÄenje za automatsko otkrivanje anomalija u vaÅ¡im metrikama. MoÅ¾ete primeniti detekciju anomalija na bilo koju CloudWatch metriku kako biste identifikovali odstupanja od normalnih obrazaca koji bi mogli ukazivati na probleme.

**KljuÄne Komponente**:

- **Obuka Modela**: CloudWatch koristi istorijske podatke za obuku modela i utvrÄ‘ivanje kako normalno ponaÅ¡anje izgleda.
- **Opseg Detekcije Anomalija**: Vizuelna reprezentacija oÄekivanog opsega vrednosti za metriku.

**Primer Upotrebe**:

- Otkrivanje neobiÄnih obrazaca iskoriÅ¡Ä‡enja CPU-a u EC2 instanci koji bi mogli ukazivati na sigurnosni prekrÅ¡aj ili problem sa aplikacijom.

### Pravila Uvida i Upravljana Pravila Uvida

**Pravila Uvida** vam omoguÄ‡avaju da identifikujete trendove, detektujete skokove ili druge obrasce od interesa u vaÅ¡im metriÄkim podacima koristeÄ‡i **moÄ‡ne matematiÄke izraze** za definisanje uslova pod kojima bi trebale biti preduzete akcije. Ova pravila vam mogu pomoÄ‡i da identifikujete anomalije ili neobiÄna ponaÅ¡anja u performansama i iskoriÅ¡Ä‡enju resursa.

**Upravljana Pravila Uvida** su prekonfigurisana **pravila uvida koja pruÅ¾a AWS**. Namenski su dizajnirana za nadgledanje specifiÄnih AWS usluga ili uobiÄajenih sluÄajeva upotrebe i mogu se omoguÄ‡iti bez potrebe za detaljnom konfiguracijom.

**Primer Upotrebe**:

- Nadgledanje Performansi RDS-a: OmoguÄ‡ite upravljano pravilo uvida za Amazon RDS koje nadgleda kljuÄne pokazatelje performansi kao Å¡to su iskoriÅ¡Ä‡enje CPU-a, iskoriÅ¡Ä‡enje memorije i disk I/O. Ako neki od ovih metrika preÄ‘e sigurne operativne pragove, pravilo moÅ¾e pokrenuti upozorenje ili automatsku akciju za ublaÅ¾avanje.

### CloudWatch Logovi <a href="#cloudwatch-logs" id="cloudwatch-logs"></a>

OmoguÄ‡ava **agregiranje i nadgledanje logova iz aplikacija** i sistema iz **AWS usluga** (ukljuÄujuÄ‡i CloudTrail) i **iz aplikacija/sistema** (**CloudWatch Agent** moÅ¾e biti instaliran na hostu). Logovi mogu biti **Äuvani neograniÄeno** (u zavisnosti od postavki Grupe Logova) i mogu biti izvezeni.

**Elementi**:

| **Grupa Logova**        | **Kolekcija log streamova** koji dele iste postavke zadrÅ¾avanja, nadgledanja i kontrole pristupa                                                     |
| ----------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **Log Stream**          | Sekvenca **log dogaÄ‘aja** koji dele **isti izvor**                                                                                                |
| **Filteri Pretplate**   | DefiniÅ¡u **filter uzorka koji se poklapa sa dogaÄ‘ajima** u odreÄ‘enoj grupi logova, Å¡alju ih na Kinesis Data Firehose stream, Kinesis stream ili Lambda funkciju |
### PraÄ‡enje i dogaÄ‘aji CloudWatch

CloudWatch **osnovno** agregira podatke **svakih 5 minuta** (detaljno radi to **svakih 1 minut**). Nakon agregacije, proverava **pragove alarma** u sluÄaju potrebe za pokretanjem jednog.\
U tom sluÄaju, CloudWatch moÅ¾e biti pripremljen da poÅ¡alje dogaÄ‘aj i izvrÅ¡i neke automatske akcije (AWS lambda funkcije, SNS teme, SQS redove, Kinesis tokove)

### Instalacija agenta

MoÅ¾ete instalirati agente unutar vaÅ¡ih maÅ¡ina/kontejnera kako bi automatski slali logove nazad u CloudWatch.

* **Napravite** ulogu i **dodelite** je **instanci** sa dozvolama koje omoguÄ‡avaju CloudWatch-u da prikuplja podatke sa instanci, pored interakcije sa AWS sistem menadÅ¾erom SSM (CloudWatchAgentAdminPolicy & AmazonEC2RoleforSSM)
* **Preuzmite** i **instalirajte** agenta na EC2 instancu ([https://s3.amazonaws.com/amazoncloudwatch-agent/linux/amd64/latest/AmazonCloudWatchAgent.zip](https://s3.amazonaws.com/amazoncloudwatch-agent/linux/amd64/latest/AmazonCloudWatchAgent.zip)). MoÅ¾ete ga preuzeti unutar EC2 ili instalirati automatski koristeÄ‡i AWS System Manager birajuÄ‡i paket AWS-ConfigureAWSPackage
* **KonfiguriÅ¡ite** i **pokrenite** CloudWatch agenta

Grupa logova ima mnogo tokova. Tok ima mnogo dogaÄ‘aja. I unutar svakog toka, dogaÄ‘aji su garantovano poredani. 

## Enumeracija
```bash
# Dashboards #

## Returns a list of the dashboards of your account
aws cloudwatch list-dashboards

## Retrieves the details of the specified dashboard
aws cloudwatch get-dashboard --dashboard-name <value>

# Metrics #

## Returns a list of the specified metric
aws cloudwatch list-metrics [--namespace <value>] [--metric-name <value>] [--dimensions <value>] [--include-linked-accounts | --no-include-linked-accounts]

## Retrieves metric data (this operation can include a CloudWatch Metrics Insights query, and one or more metric math functions)
aws cloudwatch get-metric-data --metric-data-queries <value> --start-time <value> --end-time <value>

## Retrieves statistics for the specified metric and namespace over a range of time
aws cloudwatch get-metric-statistics --namespace <value> --metric-name <value> [--dimensions <value>] --start-time <value> --end-time <value> --period <value>

## Returns a list of the metric streams of your account
aws cloudwatch list-metric-streams

## Retrieves information about the specified metric stream
aws cloudwatch get-metric-stream --name <value>

## Retrieve snapshots of the specified metric widgets
aws cloudwatch get-metric-widget-image --metric-widget <value>

# Alarms #

## Retrieves the specified alarm
aws cloudwatch describe-alarms [--alarm-names <value>] [--alarm-name-prefix <value>] [--alarm-types <value>] [--state-value <value>]

## Retrieves the alarms history, even for deleted alarms
aws cloudwatch describe-alarm-history [--alarm-name <value>] [--alarm-types <value>] [--history-item-type <ConfigurationUpdate | StateUpdate | Action>] [--start-date <value>] [--end-date <value>]

## Retrieves standard alarms based on the specified metric
aws cloudwatch escribe-alarms-for-metric --metric-name <value> --namespace <value> [--dimensions <value>]

# Anomaly Detections #

## Lists the anomaly detection models that you have created in your account
aws cloudwatch describe-anomaly-detectors [--namespace <value>] [--metric-name <value>] [--dimensions <value>]

## Lists all the Contributor Insight rules in your account
aws cloudwatch describe-insight-rules

## Retrieves the data collected over a time range for a given Contributor Insight rule
aws cloudwatch get-insight-rule-report --rule-name <value> --start-time <value> --end-time <value> --period <value>

## Lists managed Contributor Insights rules in your account for a specified resource
aws cloudwatch list-managed-insight-rules --resource-arn <value>

# Tags #

## Lists the tags associated with the specified CloudWatch resources
aws cloudwatch list-tags-for-resource --resource-arn <value>

# CloudWatch Logs #
aws logs tail "<log_group_name>" --followaws logs get-log-events --log-group-name "<log_group_name>" --log-stream-name "<log_stream_name>" --output text > <output_file>

# CloudWatch Events #
aws events list-rules
aws events describe-rule --name <name>aws events list-targets-by-rule --rule <name>aws events list-archives
aws events describe-archive --archive-name <name>aws events list-connections
aws events describe-connection --name <name>aws events list-endpoints
aws events describe-endpoint --name <name>aws events list-event-sources
aws events describe-event-source --name <name>aws events list-replays
aws events list-api-destinations
aws events list-event-buses
```
## Post-Eksploatacija / ZaobilaÅ¾enje

### **`cloudwatch:DeleteAlarms`,`cloudwatch:PutMetricAlarm` ,Â `cloudwatch:PutCompositeAlarm`**

NapadaÄ sa ovim dozvolama moÅ¾e znaÄajno oslabiti nadzornu i upozoravajuÄ‡u infrastrukturu organizacije. Brisanjem postojeÄ‡ih alarma, napadaÄ moÅ¾e onemoguÄ‡iti kljuÄna upozorenja koja obaveÅ¡tavaju administratore o kritiÄnim problemima performansi, sigurnosnim prekrÅ¡ajima ili operativnim neuspesima. Osim toga, kreiranjem ili modifikovanjem metriÄkih alarma, napadaÄ takoÄ‘e moÅ¾e zavarati administratore laÅ¾nim upozorenjima ili uÄ‡utkati legitimne alarme, efikasno prikrivajuÄ‡i zlonamerne aktivnosti i spreÄavajuÄ‡i pravovremene odgovore na stvarne incidente.

Pored toga, sa dozvolom **`cloudwatch:PutCompositeAlarm`**, napadaÄ bi mogao kreirati petlju ili ciklus kompozitnih alarma, gde kompozitni alarm A zavisi od kompozitnog alarma B, a kompozitni alarm B takoÄ‘e zavisi od kompozitnog alarma A. U ovom scenariju, nije moguÄ‡e obrisati bilo koji kompozitni alarm koji je deo ciklusa jer uvek postoji joÅ¡ jedan kompozitni alarm koji zavisi od tog alarma koji Å¾elite da obriÅ¡ete.
```bash
aws cloudwatch put-metric-alarm --cli-input-json <value> | --alarm-name <value> --comparison-operator <value> --evaluation-periods <value> [--datapoints-to-alarm <value>] [--threshold <value>] [--alarm-description <value>] [--alarm-actions <value>] [--metric-name <value>] [--namespace <value>] [--statistic <value>] [--dimensions <value>] [--period <value>]
aws cloudwatch delete-alarms --alarm-names <value>
aws cloudwatch put-composite-alarm --alarm-name <value> --alarm-rule <value> [--no-actions-enabled | --actions-enabled [--alarm-actions <value>] [--insufficient-data-actions <value>] [--ok-actions <value>] ]
```
```html
ĞŸÑ€Ğ¸Ğ¼ĞµÑ€ Ğ¸ÑĞ¿Ğ¾Ğ´ Ğ¿Ğ¾ĞºĞ°Ğ·ÑƒÑ˜Ğµ ĞºĞ°ĞºĞ¾ Ğ½Ğ°Ğ¿Ñ€Ğ°Ğ²Ğ¸Ñ‚Ğ¸ Ğ¼ĞµÑ‚Ñ€Ğ¸Ñ‡ĞºĞ¾ ÑƒĞ¿Ğ¾Ğ·Ğ¾Ñ€ĞµÑšĞµ Ğ½ĞµĞµÑ„Ğ¸ĞºĞ°ÑĞ½Ğ¸Ğ¼:

- ĞĞ²Ğ¾ Ğ¼ĞµÑ‚Ñ€Ğ¸Ñ‡ĞºĞ¾ ÑƒĞ¿Ğ¾Ğ·Ğ¾Ñ€ĞµÑšĞµ Ğ¿Ñ€Ğ°Ñ‚Ğ¸ Ğ¿Ñ€Ğ¾ÑĞµÑ‡Ğ½Ñƒ Ğ¸ÑĞºĞ¾Ñ€Ğ¸ÑˆÑ›ĞµĞ½Ğ¾ÑÑ‚ Ğ¦ĞŸĞ£-Ğ° Ğ¾Ğ´Ñ€ĞµÑ’ĞµĞ½Ğµ EC2 Ğ¸Ğ½ÑÑ‚Ğ°Ğ½Ñ†Ğµ, Ğ¾Ñ†ĞµÑšÑƒÑ˜Ğµ Ğ¼ĞµÑ‚Ñ€Ğ¸ĞºÑƒ ÑĞ²Ğ°ĞºĞ¸Ñ… 300 ÑĞµĞºÑƒĞ½Ğ´Ğ¸ Ğ¸ Ğ·Ğ°Ñ…Ñ‚ĞµĞ²Ğ° 6 Ğ¿ĞµÑ€Ğ¸Ğ¾Ğ´Ğ° Ğ¾Ñ†ĞµÑšĞ¸Ğ²Ğ°ÑšĞ° (ÑƒĞºÑƒĞ¿Ğ½Ğ¾ 30 Ğ¼Ğ¸Ğ½ÑƒÑ‚Ğ°). ĞĞºĞ¾ Ğ¿Ñ€Ğ¾ÑĞµÑ‡Ğ½Ğ° Ğ¸ÑĞºĞ¾Ñ€Ğ¸ÑˆÑ›ĞµĞ½Ğ¾ÑÑ‚ Ğ¦ĞŸĞ£-Ğ° Ğ¿Ñ€ĞµĞ¼Ğ°ÑˆĞ¸ 60% Ğ·Ğ° Ğ½Ğ°Ñ˜Ğ¼Ğ°ÑšĞµ 4 Ğ¾Ğ´ Ğ¾Ğ²Ğ¸Ñ… Ğ¿ĞµÑ€Ğ¸Ğ¾Ğ´Ğ°, ÑƒĞ¿Ğ¾Ğ·Ğ¾Ñ€ĞµÑšĞµ Ñ›Ğµ ÑĞµ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ¸Ñ€Ğ°Ñ‚Ğ¸ Ğ¸ Ğ¿Ğ¾ÑĞ»Ğ°Ñ‚Ğ¸ Ğ¾Ğ±Ğ°Ğ²ĞµÑˆÑ‚ĞµÑšĞµ Ğ½Ğ° Ğ¾Ğ´Ñ€ĞµÑ’ĞµĞ½Ñƒ SNS Ñ‚ĞµĞ¼Ñƒ.
- ĞœĞµÑšĞ°ÑšĞµĞ¼ ĞŸÑ€Ğ°Ğ³Ğ° Ğ´Ğ° Ğ±ÑƒĞ´Ğµ Ğ²ĞµÑ›Ğ¸ Ğ¾Ğ´ 99%, Ğ¿Ğ¾ÑÑ‚Ğ°Ğ²Ñ™Ğ°ÑšĞµĞ¼ ĞŸĞµÑ€Ğ¸Ğ¾Ğ´Ğ° Ğ½Ğ° 10 ÑĞµĞºÑƒĞ½Ğ´Ğ¸, Ğ‘Ñ€Ğ¾Ñ˜Ğ° Ğ¿ĞµÑ€Ğ¸Ğ¾Ğ´Ğ° Ğ¾Ñ†ĞµÑšĞ¸Ğ²Ğ°ÑšĞ° Ğ½Ğ° 8640 (Ğ¿Ğ¾ÑˆÑ‚Ğ¾ 8640 Ğ¿ĞµÑ€Ğ¸Ğ¾Ğ´Ğ° Ğ¾Ğ´ 10 ÑĞµĞºÑƒĞ½Ğ´Ğ¸ Ñ˜ĞµĞ´Ğ½Ğ°ĞºĞ¾ Ñ˜ĞµĞ´Ğ½Ğ¾Ğ¼ Ğ´Ğ°Ğ½Ñƒ), Ğ¸ Ğ¢Ğ°Ñ‡Ğ°ĞºĞ° Ğ¿Ğ¾Ğ´Ğ°Ñ‚Ğ°ĞºĞ° Ğ·Ğ° ÑƒĞ¿Ğ¾Ğ·Ğ¾Ñ€ĞµÑšĞµ Ğ½Ğ° 8640 Ñ‚Ğ°ĞºĞ¾Ñ’Ğµ, Ğ±Ğ¸Ğ»Ğ¾ Ğ±Ğ¸ Ğ¿Ğ¾Ñ‚Ñ€ĞµĞ±Ğ½Ğ¾ Ğ´Ğ° Ğ¸ÑĞºĞ¾Ñ€Ğ¸ÑˆÑ›ĞµĞ½Ğ¾ÑÑ‚ Ğ¦ĞŸĞ£-Ğ° Ğ±ÑƒĞ´Ğµ Ğ²Ğ¸ÑˆĞµ Ğ¾Ğ´ 99% ÑĞ²Ğ°ĞºĞ¸Ñ… 10 ÑĞµĞºÑƒĞ½Ğ´Ğ¸ Ñ‚Ğ¾ĞºĞ¾Ğ¼ Ñ†ĞµĞ»Ğ¾Ğ³ 24-Ñ‡Ğ°ÑĞ¾Ğ²Ğ½Ğ¾Ğ³ Ğ¿ĞµÑ€Ğ¸Ğ¾Ğ´Ğ° Ğ´Ğ° Ğ±Ğ¸ ÑĞµ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ¸Ñ€Ğ°Ğ»Ğ¾ ÑƒĞ¿Ğ¾Ğ·Ğ¾Ñ€ĞµÑšĞµ.
```
```json
{
"Namespace": "AWS/EC2",
"MetricName": "CPUUtilization",
"Dimensions": [
{
"Name": "InstanceId",
"Value": "i-01234567890123456"
}
],
"AlarmActions": [
"arn:aws:sns:us-east-1:123456789012:example_sns"
],
"ComparisonOperator": "GreaterThanThreshold",
"DatapointsToAlarm": 4,
"EvaluationPeriods": 6,
"Period": 300,
"Statistic": "Average",
"Threshold": 60,
"AlarmDescription": "CPU Utilization of i-01234567890123456 over 60%",
"AlarmName": "EC2 instance i-01234567890123456 CPU Utilization"
}
```
{% endtab %}
{% tab title="Izmenjeni metriÄki alarm" %}
```json
{
"Namespace": "AWS/EC2",
"MetricName": "CPUUtilization",
"Dimensions": [
{
"Name": "InstanceId",
"Value": "i-0645d6d414dadf9f8"
}
],
"AlarmActions": [],
"ComparisonOperator": "GreaterThanThreshold",
"DatapointsToAlarm": 8640,
"EvaluationPeriods": 8640,
"Period": 10,
"Statistic": "Average",
"Threshold": 99,
"AlarmDescription": "CPU Utilization of i-01234567890123456 with 60% as threshold",
"AlarmName": "Instance i-0645d6d414dadf9f8 CPU Utilization"
}

```
{% endtab %}
{% endtabs %}
**Potencijalni uticaj**: Nedostatak obaveÅ¡tenja o kritiÄnim dogaÄ‘ajima, potencijalni neotkriveni problemi, laÅ¾na upozorenja, suzbijanje pravih upozorenja i potencijalno propuÅ¡tanje otkrivanja stvarnih incidenata.

### **`cloudwatch:DeleteAlarmActions`,Â `cloudwatch:EnableAlarmActions` , `cloudwatch:SetAlarmState`**

Brisanjem akcija alarma, napadaÄ moÅ¾e spreÄiti kritiÄna upozorenja i automatske odgovore da se aktiviraju kada se dostigne stanje alarma, kao Å¡to je obaveÅ¡tavanje administratora ili pokretanje aktivnosti automatskog skaliranja. Nepravilno omoguÄ‡avanje ili ponovno omoguÄ‡avanje akcija alarma takoÄ‘e moÅ¾e dovesti do neoÄekivanih ponaÅ¡anja, bilo ponovnim aktiviranjem prethodno onemoguÄ‡enih akcija ili izmenom koje akcije se pokreÄ‡u, potencijalno uzrokujuÄ‡i zabunu i pogreÅ¡no usmeravanje u odgovoru na incidente.

Pored toga, napadaÄ sa dozvolom moÅ¾e manipulisati stanjima alarma, moguÄ‡i stvaranje laÅ¾nih alarma radi ometanja i zbunjivanja administratora, ili utiÅ¡avanje pravih alarma radi skrivanja trenutnih zlonamernih aktivnosti ili kritiÄnih sistemskih kvarova.

- Ako koristite **`SetAlarmState`** na kompozitnom alarmu, kompozitni alarm nije garantovan da Ä‡e se vratiti u svoje stvarno stanje. VraÄ‡a se u svoje stvarno stanje samo kada se bilo koji od njegovih deÄijih alarma promeni. TakoÄ‘e se ponovo procenjuje ako aÅ¾urirate njegovu konfiguraciju.
```bash
aws cloudwatch disable-alarm-actions --alarm-names <value>
aws cloudwatch enable-alarm-actions --alarm-names <value>
aws cloudwatch set-alarm-state --alarm-name <value> --state-value <OK | ALARM | INSUFFICIENT_DATA> --state-reason <value> [--state-reason-data <value>]
```
**Potencijalni uticaj**: Nedostatak obaveÅ¡tenja o kritiÄnim dogaÄ‘ajima, potencijalno nedetektovani problemi, laÅ¾na upozorenja, suzbijanje pravih upozorenja i potencijalno propuÅ¡tanje otkrivanja stvarnih incidenata.

### **`cloudwatch:DeleteAnomalyDetector`,Â `cloudwatch:PutAnomalyDetector`**

NapadaÄ bi mogao da ugrozi sposobnost detekcije i odgovora na neobiÄne obrasce ili anomalije u metriÄkim podacima. Brisanjem postojeÄ‡ih detektora anomalija, napadaÄ bi mogao da onemoguÄ‡i kritiÄne mehanizme upozoravanja; a kreiranjem ili modifikovanjem istih, mogao bi ili da pogreÅ¡no konfiguriÅ¡e ili stvori laÅ¾ne pozitivne rezultate kako bi ometali ili preplavili nadgledanje.
```bash
aws cloudwatch delete-anomaly-detector [--cli-input-json <value> | --namespace <value> --metric-name <value> --dimensions <value> --stat <value>]
aws cloudwatch put-anomaly-detector [--cli-input-json <value> | --namespace <value> --metric-name <value> --dimensions <value> --stat <value> --configuration <value> --metric-characteristics <value>]
```
Primer u nastavku pokazuje kako uÄiniti detektor anomalija u metrikama neefikasnim. Ovaj detektor anomalija u metrikama prati proseÄnu iskoriÅ¡Ä‡enost CPU-a odreÄ‘ene EC2 instance, i samo dodavanjem parametra "ExcludedTimeRanges" sa Å¾eljenim vremenskim opsegom, bilo bi dovoljno osigurati da detektor anomalija ne analizira ili ne upozorava na bilo kakve relevantne podatke tokom tog perioda.

{% tabs %}
{% tab title="Original Metric Anomaly Detector" %}
```json
{
"SingleMetricAnomalyDetector": {
"Namespace": "AWS/EC2",
"MetricName": "CPUUtilization",
"Stat": "Average",
"Dimensions": [
{
"Name": "InstanceId",
"Value": "i-0123456789abcdefg"
}
]
}
}
```
{% endtab %}
{% tab title="Modifikovani detektor anomalija metrika" %}
```json
{
"SingleMetricAnomalyDetector": {
"Namespace": "AWS/EC2",
"MetricName": "CPUUtilization",
"Stat": "Average",
"Dimensions": [
{
"Name": "InstanceId",
"Value": "i-0123456789abcdefg"
}
]
},
"Configuration": {
"ExcludedTimeRanges": [
{
"StartTime": "2023-01-01T00:00:00Z",
"EndTime": "2053-01-01T23:59:59Z"
}
],
"Timezone": "Europe/Madrid"
}
}
```
{% endtab %}
{% endtabs %}
**Potencijalni uticaj**: Direktan efekat u otkrivanju neobiÄnih obrazaca ili sigurnosnih pretnji.

### **`cloudwatch:DeleteDashboards`,Â `cloudwatch:PutDashboard`**

NapadaÄ bi mogao da ugrozi moguÄ‡nosti praÄ‡enja i vizualizacije organizacije tako Å¡to bi kreirao, modifikovao ili brisao njene kontrolne table. Ova dozvola moÅ¾e biti iskoriÅ¡Ä‡ena da se ukloni kritiÄna vidljivost u performansama i zdravlju sistema, izmeni kontrolne table da prikaÅ¾u netaÄne podatke ili sakriju zlonamerne aktivnosti.
```bash
aws cloudwatch delete-dashboards --dashboard-names <value>
aws cloudwatch put-dashboard --dashboard-name <value> --dashboard-body <value>
```
**Potencijalni uticaj**: Gubitak vidljivosti nad praÄ‡enjem i pogreÅ¡ne informacije.

### **`cloudwatch:DeleteInsightRules`,Â `cloudwatch:PutInsightRule` ,`cloudwatch:PutManagedInsightRule`**

Pravila uvida se koriste za otkrivanje anomalija, optimizaciju performansi i efikasno upravljanje resursima. Brisanjem postojeÄ‡ih pravila uvida, napadaÄ bi mogao ukloniti kljuÄne moguÄ‡nosti praÄ‡enja, ostavljajuÄ‡i sistem slepim za probleme performansi i sigurnosne pretnje. Dodatno, napadaÄ bi mogao kreirati ili modifikovati pravila uvida kako bi generisao pogreÅ¡ne podatke ili sakrio zlonamerne aktivnosti, Å¡to dovodi do netaÄne dijagnostike i neadekvatnih odgovora od strane operativnog tima.
```bash
aws cloudwatch delete-insight-rules --rule-names <value>
aws cloudwatch put-insight-rule --rule-name <value> --rule-definition <value> [--rule-state <value>]
aws cloudwatch put-managed-insight-rules --managed-rules <value>
```
**Potencijalni uticaj**: TeÅ¡koÄ‡e u otkrivanju i reagovanju na probleme performansi i anomalije, dezinformisano donoÅ¡enje odluka i potencijalno skrivanje zlonamernih aktivnosti ili sistemskih kvarova.

### **`cloudwatch:DisableInsightRules`,Â `cloudwatch:EnableInsightRules`**

OnemoguÄ‡avanjem kljuÄnih pravila za uvid, napadaÄ bi efikasno mogao oslepiti organizaciju za kljuÄne performanse i sigurnosne metrike. Obrnuto, omoguÄ‡avanjem ili konfigurisanjem obmanjujuÄ‡ih pravila, moguÄ‡e je generisati laÅ¾ne podatke, stvarati buku ili sakriti zlonamerne aktivnosti.
```bash
aws cloudwatch disable-insight-rules --rule-names <value>
aws cloudwatch enable-insight-rules --rule-names <value>
```
**Potencijalni uticaj**: Konfuzija meÄ‘u operativnim timom, Å¡to dovodi do kaÅ¡njenja u reagovanju na stvarne probleme i nepotrebnih akcija zasnovanih na laÅ¾nim upozorenjima.

### **`cloudwatch:DeleteMetricStream` ,Â `cloudwatch:PutMetricStream` , `cloudwatch:PutMetricData`**

NapadaÄ sa dozvolama **`cloudwatch:DeleteMetricStream`** ,Â **`cloudwatch:PutMetricStream`** bi mogao da kreira i obriÅ¡e tokove metriÄkih podataka, ugroÅ¾avajuÄ‡i bezbednost, praÄ‡enje i celovitost podataka:

- **Kreiranje zlonamernih tokova**: Kreiranje metriÄkih tokova radi slanja osetljivih podataka neovlaÅ¡Ä‡enim odrediÅ¡tima.
- **Manipulacija resursima**: Kreiranje novih metriÄkih tokova sa prekomernim podacima moÅ¾e proizvesti mnogo buke, uzrokujuÄ‡i netaÄna upozorenja, maskiranje pravih problema.
- **PoremeÄ‡aj praÄ‡enja**: Brisanjem metriÄkih tokova, napadaÄi bi poremetili kontinuirani tok podataka za praÄ‡enje. Na ovaj naÄin, njihove zlonamerne aktivnosti bi bile efikasno sakrivene.

SliÄno, sa dozvolom **`cloudwatch:PutMetricData`**, bilo bi moguÄ‡e dodati podatke u metriÄki tok. Ovo bi moglo dovesti do DoS napada zbog velike koliÄine nepravilnih podataka dodatih, ÄineÄ‡i ga potpuno beskorisnim.
```bash
aws cloudwatch delete-metric-stream --name <value>
aws cloudwatch put-metric-stream --name <value> [--include-filters <value>] [--exclude-filters <value>] --firehose-arn <value> --role-arn <value> --output-format <value>
aws cloudwatch put-metric-data --namespace <value> [--metric-data <value>] [--metric-name <value>] [--timestamp <value>] [--unit <value>] [--value <value>] [--dimensions <value>]
```
Primer dodavanja podataka koji odgovaraju 70% iskoriÅ¡Ä‡enja CPU-a na odreÄ‘enoj EC2 instanci:
```bash
aws cloudwatch put-metric-data --namespace "AWS/EC2" --metric-name "CPUUtilization" --value 70 --unit "Percent" --dimensions "InstanceId=i-0123456789abcdefg"
```
**Potencijalni uticaj**: Prekid u protoku podataka za praÄ‡enje, utiÄuÄ‡i na otkrivanje anomalija i incidenata, manipulaciju resursima i poveÄ‡anje troÅ¡kova zbog kreiranja prekomernih tokova metrika.

### **`cloudwatch:StopMetricStreams`, `cloudwatch:StartMetricStreams`**

NapadaÄ bi kontrolisao protok pogoÄ‘enih tokova podataka metrika (svaki tok podataka ako nema ograniÄenja resursa). Sa dozvolom **`cloudwatch:StopMetricStreams`**, napadaÄi bi mogli sakriti svoje zlonamerne aktivnosti zaustavljanjem kritiÄnih tokova metrika.
```bash
aws cloudwatch stop-metric-streams --names <value>
aws cloudwatch start-metric-streams --names <value>
```
**Potencijalni uticaj**: Prekid u protoku podataka za praÄ‡enje, utiÄuÄ‡i na otkrivanje anomalija i incidenata.

### **`cloudwatch:TagResource`,Â `cloudwatch:UntagResource`**

NapadaÄ bi mogao da dodaje, menja ili uklanja oznake sa CloudWatch resursa (trenutno samo alarma i pravila Contributor Insights). Ovo bi moglo da poremeti politike kontrole pristupa vaÅ¡e organizacije zasnovane na oznakama.
```bash
aws cloudwatch tag-resource --resource-arn <value> --tags <value>
aws cloudwatch untag-resource --resource-arn <value> --tag-keys <value>
```
**Potencijalni uticaj**: PoremecÌaj politika kontrole pristupa zasnovanih na oznakama.

## Reference

* [https://cloudsecdocs.com/aws/services/logging/cloudwatch/](https://cloudsecdocs.com/aws/services/logging/cloudwatch/#general-info)
* [https://docs.aws.amazon.com/service-authorization/latest/reference/list_amazoncloudwatch.html](https://docs.aws.amazon.com/service-authorization/latest/reference/list_amazoncloudwatch.html)
* [https://docs.aws.amazon.com/es_es/AmazonCloudWatch/latest/monitoring/cloudwatch_concepts.html#Metric](https://docs.aws.amazon.com/es_es/AmazonCloudWatch/latest/monitoring/cloudwatch_concepts.html#Metric)

<details>

<summary><strong>NauÄite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi naÄini podrÅ¡ke HackTricks-u:

* Ako Å¾elite da vidite **vaÅ¡u kompaniju reklamiranu na HackTricks-u** ili **preuzmete HackTricks u PDF formatu** proverite [**PLANOVE ZA PRETPLATU**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvaniÄni PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), naÅ¡u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **PridruÅ¾ite se** ğŸ’¬ [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitteru** ğŸ¦ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
