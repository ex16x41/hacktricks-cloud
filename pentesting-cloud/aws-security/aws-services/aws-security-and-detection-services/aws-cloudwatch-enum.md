# AWS - CloudWatch Enum

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## CloudWatch

**CloudWatch** **collecte** des donn√©es de surveillance et op√©rationnelles sous forme de journaux/m√©triques/√©v√©nements fournissant une **vue unifi√©e des ressources AWS**, des applications et des services.\
Les √©v√©nements de journal CloudWatch ont une **limite de taille de 256 Ko par ligne de journal**.\
Il peut d√©finir des **alarmes √† haute r√©solution**, visualiser **les journaux** et **les m√©triques** c√¥te √† c√¥te, prendre des actions automatis√©es, r√©soudre des probl√®mes et d√©couvrir des informations pour optimiser les applications.

Vous pouvez surveiller par exemple les journaux de CloudTrail. Les √©v√©nements qui sont surveill√©s :

* Changements dans les groupes de s√©curit√© et les NACL
* D√©marrage, arr√™t, red√©marrage et terminaison des instances EC2
* Changements dans les politiques de s√©curit√© au sein de IAM et S3
* Tentatives de connexion √©chou√©es √† la console de gestion AWS
* Appels API ayant entra√Æn√© un √©chec d'autorisation
* Filtres pour rechercher dans CloudWatch : [https://docs.aws.amazon.com/AmazonCloudWatch/latest/logs/FilterAndPatternSyntax.html](https://docs.aws.amazon.com/AmazonCloudWatch/latest/logs/FilterAndPatternSyntax.html)

## Concepts cl√©s

### Espaces de noms

Un espace de noms est un conteneur pour les m√©triques CloudWatch. Il aide √† cat√©goriser et isoler les m√©triques, facilitant leur gestion et leur analyse.

* **Exemples** : AWS/EC2 pour les m√©triques li√©es √† EC2, AWS/RDS pour les m√©triques RDS.

### M√©triques

Les m√©triques sont des points de donn√©es collect√©s au fil du temps qui repr√©sentent la performance ou l'utilisation des ressources AWS. Les m√©triques peuvent √™tre collect√©es √† partir des services AWS, des applications personnalis√©es ou des int√©grations tierces.

* **Exemple** : CPUUtilization, NetworkIn, DiskReadOps.

### Dimensions

Les dimensions sont des paires cl√©-valeur qui font partie des m√©triques. Elles aident √† identifier de mani√®re unique une m√©trique et fournissent un contexte suppl√©mentaire, avec un maximum de 30 dimensions pouvant √™tre associ√©es √† une m√©trique. Les dimensions permettent √©galement de filtrer et d'agr√©ger les m√©triques en fonction d'attributs sp√©cifiques.

* **Exemple** : Pour les instances EC2, les dimensions peuvent inclure InstanceId, InstanceType et AvailabilityZone.

### Statistiques

Les statistiques sont des calculs math√©matiques effectu√©s sur les donn√©es de m√©triques pour les r√©sumer au fil du temps. Les statistiques courantes incluent Moyenne, Somme, Minimum, Maximum et Compte d'√©chantillons.

* **Exemple** : Calculer la moyenne d'utilisation du CPU sur une p√©riode d'une heure.

### Unit√©s

Les unit√©s sont le type de mesure associ√© √† une m√©trique. Les unit√©s aident √† fournir un contexte et une signification aux donn√©es de m√©triques. Les unit√©s courantes incluent Pourcentage, Octets, Secondes, Compte.

* **Exemple** : CPUUtilization peut √™tre mesur√© en Pourcentage, tandis que NetworkIn peut √™tre mesur√© en Octets.

## Fonctionnalit√©s de CloudWatch

### Tableau de bord

**Les tableaux de bord CloudWatch** fournissent des **vues personnalisables de vos m√©triques AWS CloudWatch**. Il est possible de cr√©er et de configurer des tableaux de bord pour visualiser les donn√©es et surveiller les ressources dans une vue unique, combinant diff√©rentes m√©triques de divers services AWS.

**Fonctionnalit√©s cl√©s** :

* **Widgets** : √âl√©ments constitutifs des tableaux de bord, y compris des graphiques, du texte, des alarmes, et plus encore.
* **Personnalisation** : La mise en page et le contenu peuvent √™tre personnalis√©s pour r√©pondre √† des besoins de surveillance sp√©cifiques.

**Exemple de cas d'utilisation** :

* Un tableau de bord unique affichant les m√©triques cl√©s pour l'ensemble de votre environnement AWS, y compris les instances EC2, les bases de donn√©es RDS et les compartiments S3.

### Flux de m√©triques et donn√©es de m√©triques

**Les flux de m√©triques** dans AWS CloudWatch vous permettent de diffuser en continu les m√©triques CloudWatch vers une destination de votre choix en quasi temps r√©el. Cela est particuli√®rement utile pour la surveillance avanc√©e, l'analyse et les tableaux de bord personnalis√©s utilisant des outils en dehors d'AWS.

**Les donn√©es de m√©triques** √† l'int√©rieur des flux de m√©triques font r√©f√©rence aux mesures r√©elles ou aux points de donn√©es qui sont diffus√©s. Ces points de donn√©es repr√©sentent diverses m√©triques comme l'utilisation du CPU, l'utilisation de la m√©moire, etc., pour les ressources AWS.

**Exemple de cas d'utilisation** :

* Envoi de m√©triques en temps r√©el √† un service de surveillance tiers pour une analyse avanc√©e.
* Archivage des m√©triques dans un compartiment Amazon S3 pour un stockage √† long terme et la conformit√©.

### Alarme

**Les alarmes CloudWatch** surveillent vos m√©triques et effectuent des actions bas√©es sur des seuils pr√©d√©finis. Lorsqu'une m√©trique d√©passe un seuil, l'alarme peut effectuer une ou plusieurs actions telles que l'envoi de notifications via SNS, le d√©clenchement d'une politique d'auto-scaling ou l'ex√©cution d'une fonction AWS Lambda.

**Composants cl√©s** :

* **Seuil** : La valeur √† laquelle l'alarme se d√©clenche.
* **P√©riodes d'√©valuation** : Le nombre de p√©riodes sur lesquelles les donn√©es sont √©valu√©es.
* **Points de donn√©es √† alerter** : Le nombre de p√©riodes avec un seuil atteint n√©cessaire pour d√©clencher l'alarme.
* **Actions** : Ce qui se passe lorsqu'un √©tat d'alarme est d√©clench√© (par exemple, notifier via SNS).

**Exemple de cas d'utilisation** :

* Surveiller l'utilisation du CPU d'une instance EC2 et envoyer une notification via SNS si elle d√©passe 80 % pendant 5 minutes cons√©cutives.

### D√©tecteurs d'anomalies

**Les d√©tecteurs d'anomalies** utilisent l'apprentissage automatique pour d√©tecter automatiquement les anomalies dans vos m√©triques. Vous pouvez appliquer la d√©tection d'anomalies √† n'importe quelle m√©trique CloudWatch pour identifier les √©carts par rapport aux mod√®les normaux qui pourraient indiquer des probl√®mes.

**Composants cl√©s** :

* **Entra√Ænement du mod√®le** : CloudWatch utilise des donn√©es historiques pour entra√Æner un mod√®le et √©tablir √† quoi ressemble un comportement normal.
* **Bande de d√©tection d'anomalies** : Une repr√©sentation visuelle de la plage de valeurs attendue pour une m√©trique.

**Exemple de cas d'utilisation** :

* D√©tecter des mod√®les d'utilisation du CPU inhabituels dans une instance EC2 qui pourraient indiquer une violation de s√©curit√© ou un probl√®me d'application.

### R√®gles d'insight et r√®gles d'insight g√©r√©es

**Les r√®gles d'insight** vous permettent d'identifier des tendances, de d√©tecter des pics ou d'autres mod√®les d'int√©r√™t dans vos donn√©es de m√©triques en utilisant **des expressions math√©matiques puissantes** pour d√©finir les conditions sous lesquelles des actions doivent √™tre prises. Ces r√®gles peuvent vous aider √† identifier des anomalies ou des comportements inhabituels dans la performance et l'utilisation de vos ressources.

**Les r√®gles d'insight g√©r√©es** sont des **r√®gles d'insight pr√©configur√©es fournies par AWS**. Elles sont con√ßues pour surveiller des services AWS sp√©cifiques ou des cas d'utilisation courants et peuvent √™tre activ√©es sans n√©cessiter de configuration d√©taill√©e.

**Exemple de cas d'utilisation** :

* Surveillance des performances RDS : Activer une r√®gle d'insight g√©r√©e pour Amazon RDS qui surveille les indicateurs de performance cl√©s tels que l'utilisation du CPU, l'utilisation de la m√©moire et les I/O de disque. Si l'une de ces m√©triques d√©passe des seuils op√©rationnels s√ªrs, la r√®gle peut d√©clencher une alerte ou une action d'att√©nuation automatis√©e.

### Journaux CloudWatch <a href="#cloudwatch-logs" id="cloudwatch-logs"></a>

Permet de **regrouper et surveiller les journaux des applications** et des syst√®mes des **services AWS** (y compris CloudTrail) et **des applications/syst√®mes** (**L'agent CloudWatch** peut √™tre install√© sur un h√¥te). Les journaux peuvent √™tre **stock√©s ind√©finiment** (selon les param√®tres du groupe de journaux) et peuvent √™tre export√©s.

**√âl√©ments** :

| **Groupe de journaux**   | Une **collection de flux de journaux** qui partagent les m√™mes param√®tres de conservation, de surveillance et de contr√¥le d'acc√®s                                                     |
| ------------------------ | ---------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **Flux de journaux**     | Une s√©quence d'**√©v√©nements de journaux** qui partagent la **m√™me source**                                                                                                |
| **Filtres d'abonnement** | D√©finissent un **mod√®le de filtre qui correspond aux √©v√©nements** dans un groupe de journaux particulier, les envoient √† un flux Kinesis Data Firehose, un flux Kinesis ou une fonction Lambda |

### Surveillance et √©v√©nements CloudWatch

CloudWatch **de base** agr√®ge les donn√©es **toutes les 5 minutes** (la **d√©taill√©e** le fait **toutes les 1 minute**). Apr√®s l'agr√©gation, il **v√©rifie les seuils des alarmes** au cas o√π il faudrait en d√©clencher une.\
Dans ce cas, CloudWatch peut √™tre pr√©par√© √† envoyer un √©v√©nement et √† effectuer certaines actions automatiques (fonctions AWS lambda, sujets SNS, files d'attente SQS, flux Kinesis)

### Installation de l'agent

Vous pouvez installer des agents √† l'int√©rieur de vos machines/conteneurs pour envoyer automatiquement les journaux √† CloudWatch.

* **Cr√©er** un **r√¥le** et **l'attacher** √† l'**instance** avec des autorisations permettant √† CloudWatch de collecter des donn√©es des instances en plus d'interagir avec AWS Systems Manager SSM (CloudWatchAgentAdminPolicy & AmazonEC2RoleforSSM)
* **T√©l√©charger** et **installer** l'**agent** sur l'instance EC2 ([https://s3.amazonaws.com/amazoncloudwatch-agent/linux/amd64/latest/AmazonCloudWatchAgent.zip](https://s3.amazonaws.com/amazoncloudwatch-agent/linux/amd64/latest/AmazonCloudWatchAgent.zip)). Vous pouvez le t√©l√©charger depuis l'int√©rieur de l'EC2 ou l'installer automatiquement en utilisant AWS Systems Manager en s√©lectionnant le package AWS-ConfigureAWSPackage
* **Configurer** et **d√©marrer** l'agent CloudWatch

Un groupe de journaux a plusieurs flux. Un flux a plusieurs √©v√©nements. Et √† l'int√©rieur de chaque flux, les √©v√©nements sont garantis d'√™tre dans l'ordre.

## √ânum√©ration
```bash
# Dashboards #

## Returns a list of the dashboards of your account
aws cloudwatch list-dashboards

## Retrieves the details of the specified dashboard
aws cloudwatch get-dashboard --dashboard-name <value>

# Metrics #

## Returns a list of the specified metric
aws cloudwatch list-metrics [--namespace <value>] [--metric-name <value>] [--dimensions <value>] [--include-linked-accounts | --no-include-linked-accounts]

## Retrieves metric data (this operation can include a CloudWatch Metrics Insights query, and one or more metric math functions)
aws cloudwatch get-metric-data --metric-data-queries <value> --start-time <value> --end-time <value>

## Retrieves statistics for the specified metric and namespace over a range of time
aws cloudwatch get-metric-statistics --namespace <value> --metric-name <value> [--dimensions <value>] --start-time <value> --end-time <value> --period <value>

## Returns a list of the metric streams of your account
aws cloudwatch list-metric-streams

## Retrieves information about the specified metric stream
aws cloudwatch get-metric-stream --name <value>

## Retrieve snapshots of the specified metric widgets
aws cloudwatch get-metric-widget-image --metric-widget <value>

# Alarms #

## Retrieves the specified alarm
aws cloudwatch describe-alarms [--alarm-names <value>] [--alarm-name-prefix <value>] [--alarm-types <value>] [--state-value <value>]

## Retrieves the alarms history, even for deleted alarms
aws cloudwatch describe-alarm-history [--alarm-name <value>] [--alarm-types <value>] [--history-item-type <ConfigurationUpdate | StateUpdate | Action>] [--start-date <value>] [--end-date <value>]

## Retrieves standard alarms based on the specified metric
aws cloudwatch escribe-alarms-for-metric --metric-name <value> --namespace <value> [--dimensions <value>]

# Anomaly Detections #

## Lists the anomaly detection models that you have created in your account
aws cloudwatch describe-anomaly-detectors [--namespace <value>] [--metric-name <value>] [--dimensions <value>]

## Lists all the Contributor Insight rules in your account
aws cloudwatch describe-insight-rules

## Retrieves the data collected over a time range for a given Contributor Insight rule
aws cloudwatch get-insight-rule-report --rule-name <value> --start-time <value> --end-time <value> --period <value>

## Lists managed Contributor Insights rules in your account for a specified resource
aws cloudwatch list-managed-insight-rules --resource-arn <value>

# Tags #

## Lists the tags associated with the specified CloudWatch resources
aws cloudwatch list-tags-for-resource --resource-arn <value>

# CloudWatch Logs #
aws logs tail "<log_group_name>" --followaws logs get-log-events --log-group-name "<log_group_name>" --log-stream-name "<log_stream_name>" --output text > <output_file>

# CloudWatch Events #
aws events list-rules
aws events describe-rule --name <name>aws events list-targets-by-rule --rule <name>aws events list-archives
aws events describe-archive --archive-name <name>aws events list-connections
aws events describe-connection --name <name>aws events list-endpoints
aws events describe-endpoint --name <name>aws events list-event-sources
aws events describe-event-source --name <name>aws events list-replays
aws events list-api-destinations
aws events list-event-buses
```
## Post-Exploitation / Bypass

### **`cloudwatch:DeleteAlarms`,`cloudwatch:PutMetricAlarm` , `cloudwatch:PutCompositeAlarm`**

Un attaquant avec ces permissions pourrait consid√©rablement compromettre l'infrastructure de surveillance et d'alerte d'une organisation. En supprimant des alarmes existantes, un attaquant pourrait d√©sactiver des alertes cruciales qui notifient les administrateurs de probl√®mes de performance critiques, de violations de s√©curit√© ou de pannes op√©rationnelles. De plus, en cr√©ant ou en modifiant des alarmes m√©triques, l'attaquant pourrait √©galement induire les administrateurs en erreur avec de fausses alertes ou faire taire des alarmes l√©gitimes, masquant ainsi efficacement des activit√©s malveillantes et emp√™chant des r√©ponses rapides √† des incidents r√©els.

De plus, avec la permission **`cloudwatch:PutCompositeAlarm`**, un attaquant serait en mesure de cr√©er une boucle ou un cycle d'alarmes composites, o√π l'alarme composite A d√©pend de l'alarme composite B, et l'alarme composite B d√©pend √©galement de l'alarme composite A. Dans ce sc√©nario, il n'est pas possible de supprimer une alarme composite qui fait partie du cycle car il y a toujours une alarme composite qui d√©pend de cette alarme que vous souhaitez supprimer.
```bash
aws cloudwatch put-metric-alarm --cli-input-json <value> | --alarm-name <value> --comparison-operator <value> --evaluation-periods <value> [--datapoints-to-alarm <value>] [--threshold <value>] [--alarm-description <value>] [--alarm-actions <value>] [--metric-name <value>] [--namespace <value>] [--statistic <value>] [--dimensions <value>] [--period <value>]
aws cloudwatch delete-alarms --alarm-names <value>
aws cloudwatch put-composite-alarm --alarm-name <value> --alarm-rule <value> [--no-actions-enabled | --actions-enabled [--alarm-actions <value>] [--insufficient-data-actions <value>] [--ok-actions <value>] ]
```
L'exemple suivant montre comment rendre une alarme de m√©trique inefficace :

* Cette alarme de m√©trique surveille l'utilisation moyenne du CPU d'une instance EC2 sp√©cifique, √©value la m√©trique toutes les 300 secondes et n√©cessite 6 p√©riodes d'√©valuation (30 minutes au total). Si l'utilisation moyenne du CPU d√©passe 60 % pendant au moins 4 de ces p√©riodes, l'alarme se d√©clenchera et enverra une notification au sujet SNS sp√©cifi√©.
* En modifiant le seuil pour qu'il soit sup√©rieur √† 99 %, en r√©glant la p√©riode √† 10 secondes, les p√©riodes d'√©valuation √† 8640 (puisque 8640 p√©riodes de 10 secondes √©quivalent √† 1 jour), et les points de donn√©es √† alarme √† 8640 √©galement, il serait n√©cessaire que l'utilisation du CPU soit sup√©rieure √† 99 % toutes les 10 secondes pendant toute la p√©riode de 24 heures pour d√©clencher une alarme.

{% tabs %}
{% tab title="Original Metric Alarm" %}
```json
{
"Namespace": "AWS/EC2",
"MetricName": "CPUUtilization",
"Dimensions": [
{
"Name": "InstanceId",
"Value": "i-01234567890123456"
}
],
"AlarmActions": [
"arn:aws:sns:us-east-1:123456789012:example_sns"
],
"ComparisonOperator": "GreaterThanThreshold",
"DatapointsToAlarm": 4,
"EvaluationPeriods": 6,
"Period": 300,
"Statistic": "Average",
"Threshold": 60,
"AlarmDescription": "CPU Utilization of i-01234567890123456 over 60%",
"AlarmName": "EC2 instance i-01234567890123456 CPU Utilization"
}
```
{% endtab %}

{% tab title="Alarme de m√©trique modifi√©e" %}
```json
{
"Namespace": "AWS/EC2",
"MetricName": "CPUUtilization",
"Dimensions": [
{
"Name": "InstanceId",
"Value": "i-0645d6d414dadf9f8"
}
],
"AlarmActions": [],
"ComparisonOperator": "GreaterThanThreshold",
"DatapointsToAlarm": 8640,
"EvaluationPeriods": 8640,
"Period": 10,
"Statistic": "Average",
"Threshold": 99,
"AlarmDescription": "CPU Utilization of i-01234567890123456 with 60% as threshold",
"AlarmName": "Instance i-0645d6d414dadf9f8 CPU Utilization"
}

```
{% endtab %}
{% endtabs %}

**Impact potentiel** : Manque de notifications pour des √©v√©nements critiques, probl√®mes potentiellement non d√©tect√©s, fausses alertes, suppression d'alertes authentiques et d√©tections potentiellement manqu√©es d'incidents r√©els.

### **`cloudwatch:DeleteAlarmActions`, `cloudwatch:EnableAlarmActions`, `cloudwatch:SetAlarmState`**

En supprimant les actions d'alarme, l'attaquant pourrait emp√™cher des alertes critiques et des r√©ponses automatis√©es d'√™tre d√©clench√©es lorsqu'un √©tat d'alarme est atteint, comme notifier les administrateurs ou d√©clencher des activit√©s d'auto-scaling. Activer ou r√©activer des actions d'alarme de mani√®re inappropri√©e pourrait √©galement entra√Æner des comportements inattendus, soit en r√©activant des actions pr√©c√©demment d√©sactiv√©es, soit en modifiant les actions qui sont d√©clench√©es, ce qui pourrait causer de la confusion et une mauvaise orientation dans la r√©ponse aux incidents.

De plus, un attaquant ayant la permission pourrait manipuler les √©tats d'alarme, √©tant capable de cr√©er de fausses alarmes pour distraire et confondre les administrateurs, ou de faire taire de v√©ritables alarmes pour cacher des activit√©s malveillantes en cours ou des pannes critiques du syst√®me.

* Si vous utilisez **`SetAlarmState`** sur une alarme composite, l'alarme composite n'est pas garantie de revenir √† son √©tat r√©el. Elle ne revient √† son √©tat r√©el que lorsque l'un de ses alarmes enfants change d'√©tat. Elle est √©galement r√©√©valu√©e si vous mettez √† jour sa configuration.
```bash
aws cloudwatch disable-alarm-actions --alarm-names <value>
aws cloudwatch enable-alarm-actions --alarm-names <value>
aws cloudwatch set-alarm-state --alarm-name <value> --state-value <OK | ALARM | INSUFFICIENT_DATA> --state-reason <value> [--state-reason-data <value>]
```
**Impact potentiel** : Manque de notifications pour des √©v√©nements critiques, probl√®mes potentiellement non d√©tect√©s, fausses alertes, suppression d'alertes authentiques et d√©tections potentiellement manqu√©es d'incidents r√©els.

### **`cloudwatch:DeleteAnomalyDetector`, `cloudwatch:PutAnomalyDetector`**

Un attaquant pourrait compromettre la capacit√© de d√©tection et de r√©ponse √† des mod√®les ou des anomalies inhabituels dans les donn√©es m√©triques. En supprimant des d√©tecteurs d'anomalies existants, un attaquant pourrait d√©sactiver des m√©canismes d'alerte critiques ; et en les cr√©ant ou en les modifiant, il pourrait soit mal configurer, soit cr√©er de faux positifs afin de distraire ou de submerger la surveillance.
```bash
aws cloudwatch delete-anomaly-detector [--cli-input-json <value> | --namespace <value> --metric-name <value> --dimensions <value> --stat <value>]
aws cloudwatch put-anomaly-detector [--cli-input-json <value> | --namespace <value> --metric-name <value> --dimensions <value> --stat <value> --configuration <value> --metric-characteristics <value>]
```
L'exemple suivant montre comment rendre un d√©tecteur d'anomalies de m√©triques inefficace. Ce d√©tecteur d'anomalies de m√©triques surveille l'utilisation moyenne du CPU d'une instance EC2 sp√©cifique, et il suffirait d'ajouter le param√®tre ‚ÄúExcludedTimeRanges‚Äù avec la plage horaire souhait√©e pour s'assurer que le d√©tecteur d'anomalies n'analyse ni n'alerte sur des donn√©es pertinentes pendant cette p√©riode.

{% tabs %}
{% tab title="Original Metric Anomaly Detector" %}
```json
{
"SingleMetricAnomalyDetector": {
"Namespace": "AWS/EC2",
"MetricName": "CPUUtilization",
"Stat": "Average",
"Dimensions": [
{
"Name": "InstanceId",
"Value": "i-0123456789abcdefg"
}
]
}
}
```
{% endtab %}

{% tab title="D√©tecteur d'anomalies de m√©triques modifi√©es" %}
```json
{
"SingleMetricAnomalyDetector": {
"Namespace": "AWS/EC2",
"MetricName": "CPUUtilization",
"Stat": "Average",
"Dimensions": [
{
"Name": "InstanceId",
"Value": "i-0123456789abcdefg"
}
]
},
"Configuration": {
"ExcludedTimeRanges": [
{
"StartTime": "2023-01-01T00:00:00Z",
"EndTime": "2053-01-01T23:59:59Z"
}
],
"Timezone": "Europe/Madrid"
}
}
```
{% endtab %}
{% endtabs %}

**Impact potentiel** : Effet direct sur la d√©tection de mod√®les inhabituels ou de menaces √† la s√©curit√©.

### **`cloudwatch:DeleteDashboards`, `cloudwatch:PutDashboard`**

Un attaquant pourrait compromettre les capacit√©s de surveillance et de visualisation d'une organisation en cr√©ant, modifiant ou supprimant ses tableaux de bord. Ces autorisations pourraient √™tre utilis√©es pour supprimer une visibilit√© critique sur la performance et la sant√© des syst√®mes, modifier les tableaux de bord pour afficher des donn√©es incorrectes ou cacher des activit√©s malveillantes.
```bash
aws cloudwatch delete-dashboards --dashboard-names <value>
aws cloudwatch put-dashboard --dashboard-name <value> --dashboard-body <value>
```
**Impact potentiel** : Perte de visibilit√© de surveillance et informations trompeuses.

### **`cloudwatch:DeleteInsightRules`, `cloudwatch:PutInsightRule`, `cloudwatch:PutManagedInsightRule`**

Les r√®gles d'insight sont utilis√©es pour d√©tecter des anomalies, optimiser les performances et g√©rer les ressources efficacement. En supprimant les r√®gles d'insight existantes, un attaquant pourrait √©liminer des capacit√©s de surveillance critiques, laissant le syst√®me aveugle aux probl√®mes de performance et aux menaces de s√©curit√©. De plus, un attaquant pourrait cr√©er ou modifier des r√®gles d'insight pour g√©n√©rer des donn√©es trompeuses ou cacher des activit√©s malveillantes, entra√Ænant des diagnostics incorrects et des r√©ponses inappropri√©es de l'√©quipe des op√©rations.
```bash
aws cloudwatch delete-insight-rules --rule-names <value>
aws cloudwatch put-insight-rule --rule-name <value> --rule-definition <value> [--rule-state <value>]
aws cloudwatch put-managed-insight-rules --managed-rules <value>
```
**Impact potentiel** : Difficult√© √† d√©tecter et √† r√©pondre aux probl√®mes de performance et aux anomalies, prise de d√©cision mal inform√©e et potentiel dissimulation d'activit√©s malveillantes ou de pannes syst√®me.

### **`cloudwatch:DisableInsightRules`, `cloudwatch:EnableInsightRules`**

En d√©sactivant des r√®gles d'insight critiques, un attaquant pourrait effectivement aveugler l'organisation sur des m√©triques cl√©s de performance et de s√©curit√©. Inversement, en activant ou en configurant des r√®gles trompeuses, il pourrait √™tre possible de g√©n√©rer des donn√©es fausses, de cr√©er du bruit ou de cacher une activit√© malveillante.
```bash
aws cloudwatch disable-insight-rules --rule-names <value>
aws cloudwatch enable-insight-rules --rule-names <value>
```
**Impact potentiel** : Confusion au sein de l'√©quipe des op√©rations, entra√Ænant des r√©ponses retard√©es aux probl√®mes r√©els et des actions inutiles bas√©es sur de fausses alertes.

### **`cloudwatch:DeleteMetricStream` , `cloudwatch:PutMetricStream` , `cloudwatch:PutMetricData`**

Un attaquant avec les permissions **`cloudwatch:DeleteMetricStream`**, **`cloudwatch:PutMetricStream`** serait capable de cr√©er et de supprimer des flux de donn√©es m√©triques, compromettant la s√©curit√©, la surveillance et l'int√©grit√© des donn√©es :

* **Cr√©er des flux malveillants** : Cr√©er des flux m√©triques pour envoyer des donn√©es sensibles vers des destinations non autoris√©es.
* **Manipulation des ressources** : La cr√©ation de nouveaux flux m√©triques avec des donn√©es excessives pourrait produire beaucoup de bruit, entra√Ænant des alertes incorrectes, masquant de v√©ritables probl√®mes.
* **Perturbation de la surveillance** : En supprimant des flux m√©triques, les attaquants perturberaient le flux continu de donn√©es de surveillance. De cette mani√®re, leurs activit√©s malveillantes seraient efficacement cach√©es.

De m√™me, avec la permission **`cloudwatch:PutMetricData`**, il serait possible d'ajouter des donn√©es √† un flux m√©trique. Cela pourrait entra√Æner un DoS en raison de la quantit√© de donn√©es inappropri√©es ajout√©es, le rendant compl√®tement inutile.
```bash
aws cloudwatch delete-metric-stream --name <value>
aws cloudwatch put-metric-stream --name <value> [--include-filters <value>] [--exclude-filters <value>] --firehose-arn <value> --role-arn <value> --output-format <value>
aws cloudwatch put-metric-data --namespace <value> [--metric-data <value>] [--metric-name <value>] [--timestamp <value>] [--unit <value>] [--value <value>] [--dimensions <value>]
```
Exemple d'ajout de donn√©es correspondant √† 70 % d'utilisation du CPU sur une instance EC2 donn√©e :
```bash
aws cloudwatch put-metric-data --namespace "AWS/EC2" --metric-name "CPUUtilization" --value 70 --unit "Percent" --dimensions "InstanceId=i-0123456789abcdefg"
```
**Impact potentiel** : Disruption dans le flux de donn√©es de surveillance, impactant la d√©tection des anomalies et des incidents, manipulation des ressources et augmentation des co√ªts en raison de la cr√©ation de flux de m√©triques excessifs.

### **`cloudwatch:StopMetricStreams`, `cloudwatch:StartMetricStreams`**

Un attaquant contr√¥lerait le flux des flux de donn√©es de m√©triques affect√©s (chaque flux de donn√©es s'il n'y a pas de restriction de ressource). Avec la permission **`cloudwatch:StopMetricStreams`**, les attaquants pourraient cacher leurs activit√©s malveillantes en arr√™tant des flux de m√©triques critiques.
```bash
aws cloudwatch stop-metric-streams --names <value>
aws cloudwatch start-metric-streams --names <value>
```
**Impact potentiel** : Perturbation du flux de donn√©es de surveillance, impactant la d√©tection des anomalies et des incidents.

### **`cloudwatch:TagResource`, `cloudwatch:UntagResource`**

Un attaquant pourrait ajouter, modifier ou supprimer des balises des ressources CloudWatch (actuellement uniquement des alarmes et des r√®gles Contributor Insights). Cela pourrait perturber les politiques de contr√¥le d'acc√®s de votre organisation bas√©es sur des balises.
```bash
aws cloudwatch tag-resource --resource-arn <value> --tags <value>
aws cloudwatch untag-resource --resource-arn <value> --tag-keys <value>
```
**Impact potentiel** : Perturbation des politiques de contr√¥le d'acc√®s bas√©es sur des balises.

## R√©f√©rences

* [https://cloudsecdocs.com/aws/services/logging/cloudwatch/](https://cloudsecdocs.com/aws/services/logging/cloudwatch/#general-info)
* [https://docs.aws.amazon.com/service-authorization/latest/reference/list\_amazoncloudwatch.html](https://docs.aws.amazon.com/service-authorization/latest/reference/list\_amazoncloudwatch.html)
* [https://docs.aws.amazon.com/es\_es/AmazonCloudWatch/latest/monitoring/cloudwatch\_concepts.html#Metric](https://docs.aws.amazon.com/es\_es/AmazonCloudWatch/latest/monitoring/cloudwatch\_concepts.html#Metric)

{% hint style="success" %}
Apprenez et pratiquez le hacking AWS :<img src="../../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Apprenez et pratiquez le hacking GCP : <img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Soutenir HackTricks</summary>

* Consultez les [**plans d'abonnement**](https://github.com/sponsors/carlospolop) !
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez-nous sur** **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Partagez des astuces de hacking en soumettant des PRs aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) d√©p√¥ts github.

</details>
{% endhint %}
