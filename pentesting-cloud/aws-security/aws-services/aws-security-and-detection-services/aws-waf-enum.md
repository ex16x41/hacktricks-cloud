# AWS - WAF Enum

## AWS - WAF Enum

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ЁЯТм [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ЁЯРж [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## AWS WAF

AWS WAF рдПрдХ **рд╡реЗрдм рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдлрд╝рд╛рдпрд░рд╡реЙрд▓** рд╣реИ рдЬрд┐рд╕реЗ **рд╡реЗрдм рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдпрд╛ APIs** рдХреЛ рд╡рд┐рднрд┐рдиреНрди рд╡реЗрдм рд╣рдорд▓реЛрдВ рд╕реЗ рд╕реБрд░рдХреНрд╖рд┐рдд рд░рдЦрдиреЗ рдХреЗ рд▓рд┐рдП рдбрд┐рдЬрд╝рд╛рдЗрди рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ рдЬреЛ рдЙрдирдХреА рдЙрдкрд▓рдмреНрдзрддрд╛, рд╕реБрд░рдХреНрд╖рд╛ рдпрд╛ рд╕рдВрд╕рд╛рдзрди рдЦрдкрдд рдХреЛ рдкреНрд░рднрд╛рд╡рд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред рдпрд╣ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЛ **рд╕реБрд░рдХреНрд╖рд╛ рдирд┐рдпрдо** рд╕реНрдерд╛рдкрд┐рдд рдХрд░рдХреЗ рдЖрдиреЗ рд╡рд╛рд▓реЗ рдЯреНрд░реИрдлрд╝рд┐рдХ рдХреЛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░рдиреЗ рдХреА рд╢рдХреНрддрд┐ рджреЗрддрд╛ рд╣реИ рдЬреЛ SQL рдЗрдВрдЬреЗрдХреНрд╢рди рдпрд╛ рдХреНрд░реЙрд╕-рд╕рд╛рдЗрдЯ рд╕реНрдХреНрд░рд┐рдкреНрдЯрд┐рдВрдЧ рдЬреИрд╕реЗ рд╕рд╛рдорд╛рдиреНрдп рд╣рдорд▓реЗ рдХреЗ рд╡реЗрдХреНрдЯрд░ рдХреЛ рдХрдо рдХрд░рддрд╛ рд╣реИ рдФрд░ рдХрд╕реНрдЯрдо рдлрд╝рд┐рд▓реНрдЯрд░рд┐рдВрдЧ рдирд┐рдпрдореЛрдВ рдХреЛ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд░рдХреЗ рднреАред

### Key concepts

#### Web ACL (Access Control List)

Web ACL рдирд┐рдпрдореЛрдВ рдХрд╛ рдПрдХ рд╕рдВрдЧреНрд░рд╣ рд╣реИ рдЬрд┐рд╕реЗ рдЖрдк рдЕрдкрдиреЗ рд╡реЗрдм рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдпрд╛ APIs рдкрд░ рд▓рд╛рдЧреВ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред рдЬрдм рдЖрдк рдПрдХ рд╕рдВрд╕рд╛рдзрди рдХреЗ рд╕рд╛рде Web ACL рдХреЛ рдЬреЛрдбрд╝рддреЗ рд╣реИрдВ, рддреЛ AWS WAF рдЖрдиреЗ рд╡рд╛рд▓реЗ рдЕрдиреБрд░реЛрдзреЛрдВ рдХрд╛ рдирд┐рд░реАрдХреНрд╖рдг рдХрд░рддрд╛ рд╣реИ рдЬреЛ Web ACL рдореЗрдВ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдирд┐рдпрдореЛрдВ рдХреЗ рдЖрдзрд╛рд░ рдкрд░ рд╣реЛрддреЗ рд╣реИрдВ рдФрд░ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХреНрд░рд┐рдпрд╛рдПрдБ рдХрд░рддрд╛ рд╣реИред

#### Rule Group

Rule Group рдирд┐рдпрдореЛрдВ рдХрд╛ рдПрдХ рдкреБрди: рдкреНрд░рдпреЛрдЬреНрдп рд╕рдВрдЧреНрд░рд╣ рд╣реИ рдЬрд┐рд╕реЗ рдЖрдк рдХрдИ Web ACLs рдкрд░ рд▓рд╛рдЧреВ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред рдирд┐рдпрдо рд╕рдореВрд╣ рд╡рд┐рднрд┐рдиреНрди рд╡реЗрдм рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдпрд╛ APIs рдХреЗ рдмреАрдЪ рд▓рдЧрд╛рддрд╛рд░ рдирд┐рдпрдо рд╕реЗрдЯ рдХреЛ рдкреНрд░рдмрдВрдзрд┐рдд рдФрд░ рдмрдирд╛рдП рд░рдЦрдиреЗ рдореЗрдВ рдорджрдж рдХрд░рддреЗ рд╣реИрдВред

рдкреНрд░рддреНрдпреЗрдХ рдирд┐рдпрдо рд╕рдореВрд╣ рдХрд╛ рдЕрдкрдирд╛ рд╕рдВрдмрдВрдзрд┐рдд **рдХреНрд╖рдорддрд╛** рд╣реЛрддреА рд╣реИ, рдЬреЛ рдЖрдкрдХреЗ рдирд┐рдпрдореЛрдВ, рдирд┐рдпрдо рд╕рдореВрд╣реЛрдВ рдФрд░ рд╡реЗрдм ACLs рдХреЛ рдЪрд▓рд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдЬрд╛рдиреЗ рд╡рд╛рд▓реЗ рд╕рдВрдЪрд╛рд▓рди рд╕рдВрд╕рд╛рдзрдиреЛрдВ рдХреА рдЧрдгрдирд╛ рдФрд░ рдирд┐рдпрдВрддреНрд░рдг рдореЗрдВ рдорджрдж рдХрд░рддреА рд╣реИред рдПрдХ рдмрд╛рд░ рдЬрдм рдЗрд╕рдХрд╛ рдорд╛рди рдирд┐рд░реНрдорд╛рдг рдХреЗ рджреМрд░рд╛рди рд╕реЗрдЯ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рдЗрд╕реЗ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░рдирд╛ рд╕рдВрднрд╡ рдирд╣реАрдВ рд╣реЛрддрд╛ред

#### Rule

рдПрдХ рдирд┐рдпрдо рдЙрди рд╢рд░реНрддреЛрдВ рдХрд╛ рдПрдХ рд╕реЗрдЯ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд░рддрд╛ рд╣реИ рдЬрд┐рд╕рдХрд╛ рдЙрдкрдпреЛрдЧ AWS WAF рдЖрдиреЗ рд╡рд╛рд▓реЗ рд╡реЗрдм рдЕрдиреБрд░реЛрдзреЛрдВ рдХрд╛ рдирд┐рд░реАрдХреНрд╖рдг рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд░рддрд╛ рд╣реИред рдирд┐рдпрдореЛрдВ рдХреЗ рджреЛ рдореБрдЦреНрдп рдкреНрд░рдХрд╛рд░ рд╣реИрдВ:

1. **Regular Rule**: рдпрд╣ рдирд┐рдпрдо рдкреНрд░рдХрд╛рд░ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рд╢рд░реНрддреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИ рдпрд╣ рддрдп рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐ рд╡реЗрдм рдЕрдиреБрд░реЛрдзреЛрдВ рдХреЛ рдЕрдиреБрдорддрд┐ рджреА рдЬрд╛рдП, рдЕрд╡рд░реБрджреНрдз рдХрд┐рдпрд╛ рдЬрд╛рдП, рдпрд╛ рдЧрд┐рдирд╛ рдЬрд╛рдПред
2. **Rate-Based Rule**: рдПрдХ рд╡рд┐рд╢реЗрд╖ IP рдкрддреЗ рд╕реЗ рдкрд╛рдВрдЪ рдорд┐рдирдЯ рдХреА рдЕрд╡рдзрд┐ рдореЗрдВ рдЕрдиреБрд░реЛрдзреЛрдВ рдХреА рдЧрд┐рдирддреА рдХрд░рддрд╛ рд╣реИред рдпрд╣рд╛рдВ, рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдПрдХ рд╕реАрдорд╛ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░рддреЗ рд╣реИрдВ, рдФрд░ рдпрджрд┐ рдХрд┐рд╕реА IP рд╕реЗ рдЕрдиреБрд░реЛрдзреЛрдВ рдХреА рд╕рдВрдЦреНрдпрд╛ рдЗрд╕ рд╕реАрдорд╛ рдХреЛ рдкрд╛рдВрдЪ рдорд┐рдирдЯ рдХреЗ рднреАрддрд░ рдкрд╛рд░ рдХрд░ рдЬрд╛рддреА рд╣реИ, рддреЛ рдЙрд╕ IP рд╕реЗ рдЖрдиреЗ рд╡рд╛рд▓реЗ рдмрд╛рдж рдХреЗ рдЕрдиреБрд░реЛрдзреЛрдВ рдХреЛ рдЕрд╡рд░реБрджреНрдз рдХрд░ рджрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдЬрдм рддрдХ рдХрд┐ рдЕрдиреБрд░реЛрдз рджрд░ рд╕реАрдорд╛ рдХреЗ рдиреАрдЪреЗ рдирд╣реАрдВ рдЧрд┐рд░рддреАред рджрд░-рдЖрдзрд╛рд░рд┐рдд рдирд┐рдпрдореЛрдВ рдХреЗ рд▓рд┐рдП рдиреНрдпреВрдирддрдо рд╕реАрдорд╛ **2000 рдЕрдиреБрд░реЛрдз** рд╣реИред

#### Managed Rules

AWS WAF рдкреВрд░реНрд╡-рдирд┐рд░реНрдзрд╛рд░рд┐рдд, рдкреНрд░рдмрдВрдзрд┐рдд рдирд┐рдпрдо рд╕реЗрдЯ рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИ рдЬреЛ AWS рдФрд░ AWS Marketplace рд╡рд┐рдХреНрд░реЗрддрд╛рдУрдВ рджреНрд╡рд╛рд░рд╛ рдмрдирд╛рдП рд░рдЦреЗ рдЬрд╛рддреЗ рд╣реИрдВред рдпреЗ рдирд┐рдпрдо рд╕реЗрдЯ рд╕рд╛рдорд╛рдиреНрдп рдЦрддрд░реЛрдВ рдХреЗ рдЦрд┐рд▓рд╛рдл рд╕реБрд░рдХреНрд╖рд╛ рдкреНрд░рджрд╛рди рдХрд░рддреЗ рд╣реИрдВ рдФрд░ рдирдП рдХрдордЬреЛрд░рд┐рдпреЛрдВ рдХреЛ рд╕рдВрдмреЛрдзрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдирд┐рдпрдорд┐рдд рд░реВрдк рд╕реЗ рдЕрдкрдбреЗрдЯ рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВред

#### IP Set

рдПрдХ IP Set рдЙрди IP рдкрддреЗ рдпрд╛ IP рдкрддреЗ рдХреА рд░реЗрдВрдЬ рдХреА рд╕реВрдЪреА рд╣реИ рдЬрд┐рдиреНрд╣реЗрдВ рдЖрдк рдЕрдиреБрдорддрд┐ рджреЗрдирд╛ рдпрд╛ рдЕрд╡рд░реБрджреНрдз рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВред IP рд╕реЗрдЯ IP-рдЖрдзрд╛рд░рд┐рдд рдирд┐рдпрдореЛрдВ рдХреЛ рдкреНрд░рдмрдВрдзрд┐рдд рдХрд░рдиреЗ рдХреА рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЛ рд╕рд░рд▓ рдмрдирд╛рддреЗ рд╣реИрдВред

#### Regex Pattern Set

рдПрдХ Regex Pattern Set рдореЗрдВ рдПрдХ рдпрд╛ рдПрдХ рд╕реЗ рдЕрдзрд┐рдХ рдирд┐рдпрдорд┐рдд рдЕрднрд┐рд╡реНрдпрдХреНрддрд┐рдпрд╛рдБ (regex) рд╣реЛрддреА рд╣реИрдВ рдЬреЛ рд╡реЗрдм рдЕрдиреБрд░реЛрдзреЛрдВ рдореЗрдВ рдЦреЛрдЬрдиреЗ рдХреЗ рд▓рд┐рдП рдкреИрдЯрд░реНрди рдХреЛ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд░рддреА рд╣реИрдВред рдпрд╣ рдЕрдзрд┐рдХ рдЬрдЯрд┐рд▓ рдорд┐рд▓рд╛рди рдкрд░рд┐рджреГрд╢реНрдпреЛрдВ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧреА рд╣реИ, рдЬреИрд╕реЗ рдХрд┐ рд╡рд┐рд╢реЗрд╖ рд╡рд░реНрдгреЛрдВ рдХреЗ рдЕрдиреБрдХреНрд░рдо рдХреЛ рдлрд╝рд┐рд▓реНрдЯрд░ рдХрд░рдирд╛ред

#### Lock Token

рдПрдХ Lock Token WAF рд╕рдВрд╕рд╛рдзрдиреЛрдВ рдХреЛ рдЕрдкрдбреЗрдЯ рдХрд░рддреЗ рд╕рдордп рд╕рдорд╡рд░реНрддреА рдирд┐рдпрдВрддреНрд░рдг рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред рдпрд╣ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рддрд╛ рд╣реИ рдХрд┐ рдкрд░рд┐рд╡рд░реНрддрди рдЧрд▓рддреА рд╕реЗ рдПрдХ рд╣реА рд╕рдВрд╕рд╛рдзрди рдХреЛ рдПрдХ рд╕рд╛рде рдЕрдкрдбреЗрдЯ рдХрд░рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рдХрдИ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдпрд╛ рдкреНрд░рдХреНрд░рд┐рдпрд╛рдУрдВ рджреНрд╡рд╛рд░рд╛ рдЕрдзрд┐рд▓реЗрдЦрд┐рдд рдирд╣реАрдВ рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВред

#### API Keys

AWS WAF рдореЗрдВ API Keys рдХрд╛ рдЙрдкрдпреЛрдЧ рдХреБрдЫ API рд╕рдВрдЪрд╛рд▓рди рдХреЗ рд▓рд┐рдП рдЕрдиреБрд░реЛрдзреЛрдВ рдХреЛ рдкреНрд░рдорд╛рдгрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред рдпреЗ рдХреБрдВрдЬреА рдПрдиреНрдХреНрд░рд┐рдкреНрдЯреЗрдб рд╣реЛрддреА рд╣реИрдВ рдФрд░ рд╕реБрд░рдХреНрд╖рд┐рдд рд░реВрдк рд╕реЗ рдкреНрд░рдмрдВрдзрд┐рдд рдХреА рдЬрд╛рддреА рд╣реИрдВ рддрд╛рдХрд┐ рдкрд╣реБрдВрдЪ рдХреЛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗ рдФрд░ рдпрд╣ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗ рдХрд┐ рдХреЗрд╡рд▓ рдЕрдзрд┐рдХреГрдд рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ WAF рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдореЗрдВ рдкрд░рд┐рд╡рд░реНрддрди рдХрд░ рд╕рдХреЗрдВред

* **Example**: CAPTCHA API рдХрд╛ рдПрдХреАрдХрд░рдгред

#### Permission Policy

рдПрдХ Permission Policy рдПрдХ IAM рдиреАрддрд┐ рд╣реИ рдЬреЛ рдпрд╣ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░рддреА рд╣реИ рдХрд┐ рдХреМрди AWS WAF рд╕рдВрд╕рд╛рдзрдиреЛрдВ рдкрд░ рдХреНрд░рд┐рдпрд╛рдПрдБ рдХрд░ рд╕рдХрддрд╛ рд╣реИред рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХреЛ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд░рдХреЗ, рдЖрдк WAF рд╕рдВрд╕рд╛рдзрдиреЛрдВ рддрдХ рдкрд╣реБрдВрдЪ рдХреЛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдпрд╣ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ рдХреЗрд╡рд▓ рдЕрдзрд┐рдХреГрдд рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдмрдирд╛, рдЕрдкрдбреЗрдЯ рдпрд╛ рд╣рдЯрд╛ рд╕рдХреЗрдВред

#### Scope

AWS WAF рдореЗрдВ рд╕реНрдХреЛрдк рдкреИрд░рд╛рдореАрдЯрд░ рдпрд╣ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░рддрд╛ рд╣реИ рдХрд┐ рдХреНрдпрд╛ WAF рдирд┐рдпрдо рдФрд░ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдХреНрд╖реЗрддреНрд░реАрдп рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдпрд╛ Amazon CloudFront рд╡рд┐рддрд░рдг рдкрд░ рд▓рд╛рдЧреВ рд╣реЛрддреЗ рд╣реИрдВред

* **REGIONAL**: рдХреНрд╖реЗрддреНрд░реАрдп рд╕реЗрд╡рд╛рдУрдВ рдкрд░ рд▓рд╛рдЧреВ рд╣реЛрддрд╛ рд╣реИ рдЬреИрд╕реЗ рдХрд┐ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рд▓реЛрдб рдмреИрд▓реЗрдВрд╕рд░ (ALB), Amazon API рдЧреЗрдЯрд╡реЗ REST API, AWS AppSync GraphQL API, Amazon Cognito рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдкреВрд▓, AWS App Runner рд╕реЗрд╡рд╛ рдФрд░ AWS Verified Access рдЙрджрд╛рд╣рд░рдгред рдЖрдк рдЙрд╕ AWS рдХреНрд╖реЗрддреНрд░ рдХреЛ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░рддреЗ рд╣реИрдВ рдЬрд╣рд╛рдВ рдпреЗ рд╕рдВрд╕рд╛рдзрди рд╕реНрдерд┐рдд рд╣реИрдВред
* **CLOUDFRONT**: Amazon CloudFront рд╡рд┐рддрд░рдг рдкрд░ рд▓рд╛рдЧреВ рд╣реЛрддрд╛ рд╣реИ, рдЬреЛ рд╡реИрд╢реНрд╡рд┐рдХ рд╣реЛрддреЗ рд╣реИрдВред CloudFront рдХреЗ рд▓рд┐рдП WAF рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди `us-east-1` рдХреНрд╖реЗрддреНрд░ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдкреНрд░рдмрдВрдзрд┐рдд рд╣реЛрддреЗ рд╣реИрдВ рдЪрд╛рд╣реЗ рд╕рд╛рдордЧреНрд░реА рдХрд╣реАрдВ рднреА рд╕реЗрд╡рд╛ рдХреА рдЬрд╛рдПред

### Key features

#### Monitoring Criteria (Conditions)

**Conditions** рдЙрди рддрддреНрд╡реЛрдВ рдХреЛ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░рддреЗ рд╣реИрдВ рдЬрд┐рдирдХрд╛ AWS WAF рдЖрдиреЗ рд╡рд╛рд▓реЗ HTTP/HTTPS рдЕрдиреБрд░реЛрдзреЛрдВ рдХреА рдирд┐рдЧрд░рд╛рдиреА рдХрд░рддрд╛ рд╣реИ, рдЬрд┐рд╕рдореЗрдВ XSS, рднреМрдЧреЛрд▓рд┐рдХ рд╕реНрдерд╛рди (GEO), IP рдкрддреЗ, рдЖрдХрд╛рд░ рдХреА рд╕реАрдорд╛рдПрдБ, SQL рдЗрдВрдЬреЗрдХреНрд╢рди, рдФрд░ рдкреИрдЯрд░реНрди (рд╕реНрдЯреНрд░рд┐рдВрдЧ рдФрд░ regex рдорд┐рд▓рд╛рди) рд╢рд╛рдорд┐рд▓ рд╣реИрдВред рдпрд╣ рдзреНрдпрд╛рди рд░рдЦрдирд╛ рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣реИ рдХрд┐ **рджреЗрд╢ рдХреЗ рдЖрдзрд╛рд░ рдкрд░ CloudFront рд╕реНрддрд░ рдкрд░ рдкреНрд░рддрд┐рдмрдВрдзрд┐рдд рдЕрдиреБрд░реЛрдз WAF рддрдХ рдирд╣реАрдВ рдкрд╣реБрдБрдЪреЗрдВрдЧреЗ**ред

рдкреНрд░рддреНрдпреЗрдХ AWS рдЦрд╛рддрд╛ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░ рд╕рдХрддрд╛ рд╣реИ:

* **100 рд╢рд░реНрддреЗрдВ** рдкреНрд░рддреНрдпреЗрдХ рдкреНрд░рдХрд╛рд░ рдХреЗ рд▓рд┐рдП (Regex рдХреЗ рд▓рд┐рдП, рдХреЗрд╡рд▓ **10 рд╢рд░реНрддреЗрдВ** рдЕрдиреБрдорддрд┐ рд╣реИ, рд▓реЗрдХрд┐рди рдЗрд╕ рд╕реАрдорд╛ рдХреЛ рдмрдврд╝рд╛рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ)ред
* **100 рдирд┐рдпрдо** рдФрд░ **50 Web ACLs**ред
* рдЕрдзрд┐рдХрддрдо **5 рджрд░-рдЖрдзрд╛рд░рд┐рдд рдирд┐рдпрдо**ред
* рдЬрдм WAF рдХреЛ рдПрдХ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рд▓реЛрдб рдмреИрд▓реЗрдВрд╕рд░ рдХреЗ рд╕рд╛рде рд▓рд╛рдЧреВ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ **10,000 рдЕрдиреБрд░реЛрдз рдкреНрд░рддрд┐ рд╕реЗрдХрдВрдб** рдХреА рдереНрд░реВрдкреБрдЯред

#### Rule actions

рдХреНрд░рд┐рдпрд╛рдПрдБ рдкреНрд░рддреНрдпреЗрдХ рдирд┐рдпрдо рдХреЛ рд╕реМрдВрдкрд┐рдд рдХреА рдЬрд╛рддреА рд╣реИрдВ, рд╡рд┐рдХрд▓реНрдк рд╣реЛрддреЗ рд╣реИрдВ:

* **Allow**: рдЕрдиреБрд░реЛрдз рдХреЛ рдЙрдЪрд┐рдд CloudFront рд╡рд┐рддрд░рдг рдпрд╛ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рд▓реЛрдб рдмреИрд▓реЗрдВрд╕рд░ рдкрд░ рдЕрдЧреНрд░реЗрд╖рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред
* **Block**: рдЕрдиреБрд░реЛрдз рдХреЛ рддреБрд░рдВрдд рд╕рдорд╛рдкреНрдд рдХрд░ рджрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред
* **Count**: рдирд┐рдпрдо рдХреА рд╢рд░реНрддреЛрдВ рдХреЛ рдкреВрд░рд╛ рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рдЕрдиреБрд░реЛрдзреЛрдВ рдХреА рдЧрд┐рдирддреА рдХрд░рддрд╛ рд╣реИред рдпрд╣ рдирд┐рдпрдо рдкрд░реАрдХреНрд╖рдг рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧреА рд╣реИ, рдирд┐рдпрдо рдХреА рд╕рдЯреАрдХрддрд╛ рдХреА рдкреБрд╖реНрдЯрд┐ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЗрд╕реЗ Allow рдпрд╛ Block рдкрд░ рд╕реЗрдЯ рдХрд░рдиреЗ рд╕реЗ рдкрд╣рд▓реЗред
* **CAPTCHA and Challenge:** рдпрд╣ рд╕рддреНрдпрд╛рдкрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдХрд┐ рдЕрдиреБрд░реЛрдз рдмреЙрдЯ рд╕реЗ рдирд╣реАрдВ рдЖ рд░рд╣рд╛ рд╣реИ CAPTCHA рдкрд╣реЗрд▓рд┐рдпреЛрдВ рдФрд░ рдЪреБрдкрдЪрд╛рдк рдЪреБрдиреМрддрд┐рдпреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗред

рдпрджрд┐ рдХреЛрдИ рдЕрдиреБрд░реЛрдз Web ACL рдХреЗ рднреАрддрд░ рдХрд┐рд╕реА рднреА рдирд┐рдпрдо рд╕реЗ рдореЗрд▓ рдирд╣реАрдВ рдЦрд╛рддрд╛ рд╣реИ, рддреЛ рдпрд╣ **рдбрд┐рдлрд╝реЙрд▓реНрдЯ рдХреНрд░рд┐рдпрд╛** (Allow рдпрд╛ Block) рдХрд╛ рдкрд╛рд▓рди рдХрд░рддрд╛ рд╣реИред рдирд┐рдпрдо рдирд┐рд╖реНрдкрд╛рджрди рдХрд╛ рдХреНрд░рдо, рдЬреЛ Web ACL рдХреЗ рднреАрддрд░ рдкрд░рд┐рднрд╛рд╖рд┐рдд рд╣реЛрддрд╛ рд╣реИ, рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣реИ рдФрд░ рдЖрдорддреМрд░ рдкрд░ рдЗрд╕ рдЕрдиреБрдХреНрд░рдо рдХрд╛ рдкрд╛рд▓рди рдХрд░рддрд╛ рд╣реИ:

1. Whitelisted IPs рдХреЛ рдЕрдиреБрдорддрд┐ рджреЗрдВред
2. Blacklisted IPs рдХреЛ рдЕрд╡рд░реБрджреНрдз рдХрд░реЗрдВред
3. рдХрд┐рд╕реА рднреА рд╣рд╛рдирд┐рдХрд╛рд░рдХ рд╣рд╕реНрддрд╛рдХреНрд╖рд░реЛрдВ рд╕реЗ рдореЗрд▓ рдЦрд╛рдиреЗ рд╡рд╛рд▓реЗ рдЕрдиреБрд░реЛрдзреЛрдВ рдХреЛ рдЕрд╡рд░реБрджреНрдз рдХрд░реЗрдВред

#### CloudWatch Integration

AWS WAF CloudWatch рдХреЗ рд╕рд╛рде рдПрдХреАрдХреГрдд рд╣реЛрддрд╛ рд╣реИ, рдирд┐рдЧрд░рд╛рдиреА рдХреЗ рд▓рд┐рдП, рдЬреИрд╕реЗ AllowedRequests, BlockedRequests, CountedRequests, рдФрд░ PassedRequests рдЬреИрд╕реЗ рдореИрдЯреНрд░рд┐рдХреНрд╕ рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИред рдпреЗ рдореИрдЯреНрд░рд┐рдХреНрд╕ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ рд╣рд░ рдорд┐рдирдЯ рд░рд┐рдкреЛрд░реНрдЯ рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВ рдФрд░ рджреЛ рд╕рдкреНрддрд╛рд╣ рдХреА рдЕрд╡рдзрд┐ рдХреЗ рд▓рд┐рдП рдмрдирд╛рдП рд░рдЦреЗ рдЬрд╛рддреЗ рд╣реИрдВред

### Enumeration

CloudFront рд╡рд┐рддрд░рдг рдХреЗ рд╕рд╛рде рдмрд╛рддрдЪреАрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдЖрдкрдХреЛ рдХреНрд╖реЗрддреНрд░ US East (N. Virginia) рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░рдирд╛ рд╣реЛрдЧрд╛:

* CLI - рдЬрдм рдЖрдк CloudFront рд╕реНрдХреЛрдк рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВ рддреЛ рдХреНрд╖реЗрддреНрд░ US East рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░реЗрдВ: `--scope CLOUDFRONT --region=us-east-1`ред
* API рдФрд░ SDKs - рд╕рднреА рдХреЙрд▓ рдХреЗ рд▓рд┐рдП, рдХреНрд╖реЗрддреНрд░ рдЕрдВрдд рдмрд┐рдВрджреБ us-east-1 рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВред

рдХреНрд╖реЗрддреНрд░реАрдп рд╕реЗрд╡рд╛рдУрдВ рдХреЗ рд╕рд╛рде рдмрд╛рддрдЪреАрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдЖрдкрдХреЛ рдХреНрд╖реЗрддреНрд░ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдП:

* рдХреНрд╖реЗрддреНрд░ рдпреВрд░реЛрдк (рд╕реНрдкреЗрди) рдХреЗ рд╕рд╛рде рдЙрджрд╛рд╣рд░рдг: `--scope REGIONAL --region=eu-south-2`
```bash
# Web ACLs #

## Retrieve a list of web access control lists (Web ACLs) available in your AWS account
aws wafv2 list-web-acls --scope <REGIONAL --region=<value> | CLOUDFRONT --region=us-east-1>
## Retrieve details about the specified Web ACL
aws wafv2 get-web-acl --name <value> --id <value> --scope <REGIONAL --region=<value> | CLOUDFRONT --region=us-east-1>

## Retrieve a list of resources associated with a specific web access control list (Web ACL)
aws wafv2 list-resources-for-web-acl --web-acl-arn <value> # Additional permissions needed depending on the protected resource type: cognito-idp:ListResourcesForWebACL, ec2:DescribeVerifiedAccessInstanceWebAclAssociations or apprunner:ListAssociatedServicesForWebAcl
## Retrieve the Web ACL associated with the specified AWS resource
aws wafv2 get-web-acl-for-resource --resource-arn <arn> # Additional permissions needed depending on the protected resource type: cognito-idp:GetWebACLForResource, ec2:GetVerifiedAccessInstanceWebAcl, wafv2:GetWebACL or apprunner:DescribeWebAclForService

# Rule groups #

## List of the rule groups available in your AWS account
aws wafv2 list-rule-groups --scope <REGIONAL --region=<value> | CLOUDFRONT --region=us-east-1>
## Retrieve the details of a specific rule group
aws wafv2 get-rule-group [--name <value>] [--id <value>] [--arn <value>] [--scope <REGIONAL --region=<value> | CLOUDFRONT --region=us-east-1>]
## Retrieve the IAM policy attached to the specified rule group
aws wafv2 get-permission-policy --resource-arn <rule-group-arn> # Just the owner of the Rule Group can do this operation

# Managed rule groups (by AWS or by a third-party) #

## List the managed rule groups that are available
aws wafv2 list-available-managed-rule-groups --scope <REGIONAL --region=<value> | CLOUDFRONT --region=us-east-1>
## List the available versions of the specified managed rule group
aws wafv2 list-available-managed-rule-group-versions --vendor-name <value> --name <value> --scope <REGIONAL --region=<value> | CLOUDFRONT --region=us-east-1>
## Retrieve high-level information about a specific managed rule group
aws wafv2 describe-managed-rule-group --vendor-name <value> --name <value> --scope <REGIONAL --region=<value> | CLOUDFRONT --region=us-east-1> [--version-name <value>]
## Retrieve high-level information about all managed rule groups
aws wafv2 describe-all-managed-products --scope <REGIONAL --region=<value> | CLOUDFRONT --region=us-east-1>
## Retrieve high-level information about all managed rule groups from a specific vendor
aws wafv2 describe-managed-products-by-vendor --vendor-name <value> --scope <REGIONAL --region=<value> | CLOUDFRONT --region=us-east-1>

# IP sets #

## List the IP sets that are available in your AWS account
aws wafv2 list-ip-sets --scope <REGIONAL --region=<value> | CLOUDFRONT --region=us-east-1>
## Retrieve the specific IP set
aws wafv2 get-ip-set --name <value> --id <value> --scope <REGIONAL --region=<value> | CLOUDFRONT --region=us-east-1>
## Retrieve the keys that are currently being managed by a rate-based rule.
aws wafv2 get-rate-based-statement-managed-keys --scope <REGIONAL --region=<value> | CLOUDFRONT --region=us-east-1>\
--web-acl-name <value> --web-acl-id <value> --rule-name <value> [--rule-group-rule-name <value>]

# Regex pattern sets #

## List all the regex pattern sets that you manage
aws wafv2 list-regex-pattern-sets --scope <REGIONAL --region=<value> | CLOUDFRONT --region=us-east-1>
## Retrieves the specified regex pattern sets
aws wafv2 get-regex-pattern-set --name <value> --id <value> --scope <REGIONAL --region=<value> | CLOUDFRONT --region=us-east-1>

# API Keys #

## List API keys for the specified scope
aws wafv2 list-api-keys --scope <REGIONAL --region=<value> | CLOUDFRONT --region=us-east-1>
## Retrieve decrypted API key
aws wafv2 get-decrypted-api-key --scope <REGIONAL --region=<value> | CLOUDFRONT --region=us-east-1> --api-key <value>

# Logs #

## List of logging configurations (storage location of the logs)
aws wafv2 list-logging-configurations --scope <REGIONAL --region=<value> | CLOUDFRONT --region=us-east-1> [--log-scope <value>]
## Retrieve the logging configuration settings associated with a specific web ACL
aws wafv2 get-logging-configuration --resource-arn <value> [--log-scope <CUSTOMER | SECURITY_LAKE>] [--log-type <value>]

# Miscelaneous #

## Retrieve a list of the tags associated to the specified resource
aws wafv2 list-tags-for-resource resource-arn <value>

## Retrieve a sample of web requests that match a specified rule within a WebACL during a specified time range
aws wafv2 get-sampled-requests --web-acl-arn <value> --rule-metric-name <value> --time-window <value> --max-items <1-500> --scope <value>

## Obtains the web ACL capacity unit (WCU) requirements for a specified scope and ruleset
aws wafv2 check-capacity --scope <REGIONAL --region=<value> | CLOUDFRONT --region=us-east-1> --rules <value>

## List of available releases for the AWS WAFv2 mobile SDK
aws wafv2 list-mobile-sdk-releases --platform <IOS | ANDROID>
## Retrieves information for the specified mobile SDK release
aws wafv2 get-mobile-sdk-release --platform <value> --release-version <value>

```
### Post Exploitation / Bypass

{% hint style="success" %}
рд╣рдорд▓рд╛рд╡рд░ рдХреЗ рджреГрд╖реНрдЯрд┐рдХреЛрдг рд╕реЗ, рдпрд╣ рд╕реЗрд╡рд╛ рд╣рдорд▓рд╛рд╡рд░ рдХреЛ WAF рд╕реБрд░рдХреНрд╖рд╛ рдФрд░ рдиреЗрдЯрд╡рд░реНрдХ рдПрдХреНрд╕рдкреЛрдЬрд░ рдХреА рдкрд╣рдЪрд╛рди рдХрд░рдиреЗ рдореЗрдВ рдорджрдж рдХрд░ рд╕рдХрддреА рд╣реИ рдЬреЛ рдЙрд╕реЗ рдЕрдиреНрдп рд╡реЗрдм рдХреЛ рд╕рдордЭреМрддрд╛ рдХрд░рдиреЗ рдореЗрдВ рдорджрдж рдХрд░ рд╕рдХрддреА рд╣реИред

рд╣рд╛рд▓рд╛рдВрдХрд┐, рдПрдХ рд╣рдорд▓рд╛рд╡рд░ рдЗрд╕ рд╕реЗрд╡рд╛ рдХреЛ рдмрд╛рдзрд┐рдд рдХрд░рдиреЗ рдореЗрдВ рднреА рд░реБрдЪрд┐ рд░рдЦ рд╕рдХрддрд╛ рд╣реИ рддрд╛рдХрд┐ рд╡реЗрдм WAF рджреНрд╡рд╛рд░рд╛ рд╕реБрд░рдХреНрд╖рд┐рдд рди рд╣реЛрдВред
{% endhint %}

рдХрдИ Delete рдФрд░ Update рдСрдкрд░реЗрд╢рдиреЛрдВ рдореЗрдВ **lock token** рдкреНрд░рджрд╛рди рдХрд░рдирд╛ рдЖрд╡рд╢реНрдпрдХ рд╣реЛрдЧрд╛ред рдпрд╣ рдЯреЛрдХрди рд╕рдВрд╕рд╛рдзрдиреЛрдВ рдкрд░ рд╕рдорд╡рд░реНрддреА рдирд┐рдпрдВрддреНрд░рдг рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдпрд╣ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рддреЗ рд╣реБрдП рдХрд┐ рдкрд░рд┐рд╡рд░реНрддрди рдХрдИ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдпрд╛ рдкреНрд░рдХреНрд░рд┐рдпрд╛рдУрдВ рджреНрд╡рд╛рд░рд╛ рдПрдХ рд╣реА рд╕рдВрд╕рд╛рдзрди рдХреЛ рдПрдХ рд╕рд╛рде рдЕрдкрдбреЗрдЯ рдХрд░рдиреЗ рдХреЗ рдкреНрд░рдпрд╛рд╕ рдореЗрдВ рдЧрд▓рддреА рд╕реЗ рдЕрдзрд┐рд▓реЗрдЦрд┐рдд рдирд╣реАрдВ рд╣реЛрддреЗ рд╣реИрдВред рдЗрд╕ рдЯреЛрдХрди рдХреЛ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдк рд╡рд┐рд╢реЗрд╖ рд╕рдВрд╕рд╛рдзрди рдкрд░ рд╕рдВрдмрдВрдзрд┐рдд **list** рдпрд╛ **get** рдСрдкрд░реЗрд╢рдиреЛрдВ рдХреЛ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

#### **`wafv2:CreateRuleGroup`, `wafv2:UpdateRuleGroup`, `wafv2:DeleteRuleGroup`**

рдПрдХ рд╣рдорд▓рд╛рд╡рд░ рдкреНрд░рднрд╛рд╡рд┐рдд рд╕рдВрд╕рд╛рдзрди рдХреА рд╕реБрд░рдХреНрд╖рд╛ рдХреЛ рд╕рдордЭреМрддрд╛ рдХрд░ рд╕рдХрддрд╛ рд╣реИ:

* рдирд┐рдпрдо рд╕рдореВрд╣ рдмрдирд╛рдХрд░ рдЬреЛ, рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рд╡реИрдз IP рдкрддреЗ рд╕реЗ рд╡реИрдз рдЯреНрд░реИрдлрд╝рд┐рдХ рдХреЛ рдмреНрд▓реЙрдХ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдЬрд┐рд╕рд╕реЗ рд╕реЗрд╡рд╛ рдХрд╛ рдЗрдирдХрд╛рд░ рд╣реЛ рд╕рдХрддрд╛ рд╣реИред
* рдирд┐рдпрдо рд╕рдореВрд╣реЛрдВ рдХреЛ рдЕрдкрдбреЗрдЯ рдХрд░рдХреЗ, рдЗрд╕рдХреЗ рдХрд╛рд░реНрдпреЛрдВ рдХреЛ **Block** рд╕реЗ **Allow** рдореЗрдВ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░рдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рд╣реЛрдирд╛ред
* рдЙрди рдирд┐рдпрдо рд╕рдореВрд╣реЛрдВ рдХреЛ рд╣рдЯрд╛рдирд╛ рдЬреЛ рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╕реБрд░рдХреНрд╖рд╛ рдЙрдкрд╛рдп рдкреНрд░рджрд╛рди рдХрд░рддреЗ рд╣реИрдВред
```bash
# Create Rule Group
aws wafv2 create-rule-group --name <value> --capacity <value> --visibility-config <value> \
--scope <REGIONAL --region=<value> | CLOUDFRONT --region=us-east-1> [--rules <value>] [--description <value>]
# Update Rule Group
aws wafv2 update-rule-group --name <value> --id <value> --visibility-config <value> --lock-token <value>\
--scope <REGIONAL --region=<value> | CLOUDFRONT --region=us-east-1> [--rules <value>] [--description <value>]
# Delete Rule Group
aws wafv2 delete-rule-group --name <value> --id <value> --lock-token <value> --scope <REGIONAL --region=<value> | CLOUDFRONT --region=us-east-1>
```
рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдЙрджрд╛рд╣рд░рдг рдПрдХ рдирд┐рдпрдо рд╕рдореВрд╣ рдХреЛ рджрд┐рдЦрд╛рддрд╛ рд╣реИ рдЬреЛ рд╡рд┐рд╢рд┐рд╖реНрдЯ IP рдкрддреЛрдВ рд╕реЗ рд╡реИрдз рдЯреНрд░реИрдлрд╝рд┐рдХ рдХреЛ рдмреНрд▓реЙрдХ рдХрд░реЗрдЧрд╛:
```bash
aws wafv2 create-rule-group --name BlockLegitimateIPsRuleGroup --capacity 1 --visibility-config SampledRequestsEnabled=false,CloudWatchMetricsEnabled=false,MetricName=BlockLegitimateIPsRuleGroup --scope CLOUDFRONT --region us-east-1 --rules file://rule.json
```
**rule.json** рдлрд╝рд╛рдЗрд▓ рдЗрд╕ рддрд░рд╣ рджрд┐рдЦреЗрдЧреА:
```json
[
{
"Name":"BlockLegitimateIPsRule",
"Priority":0,
"Statement": {
"IPSetReferenceStatement": {
"ARN": "arn:aws:wafv2:us-east-1:123456789012:global/ipset/legitIPv4/1a2b3c4d-1a2b-1a2b-1a2b-1a2b3c4d5e6f"
}
},
"Action":{
"Block":{}
},
"VisibilityConfig":{
"SampledRequestsEnabled":false,
"CloudWatchMetricsEnabled":false,
"MetricName":"BlockLegitimateIPsRule"
}
}
]
```
**рд╕рдВрднрд╛рд╡рд┐рдд рдкреНрд░рднрд╛рд╡**: рдЕрдирдзрд┐рдХреГрдд рдкрд╣реБрдВрдЪ, рдбреЗрдЯрд╛ рдЙрд▓реНрд▓рдВрдШрди, рдФрд░ рд╕рдВрднрд╛рд╡рд┐рдд DoS рд╣рдорд▓реЗред

#### **`wafv2:CreateWebACL`, `wafv2:UpdateWebACL`, `wafv2:DeleteWebACL`**

рдЗрди рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХреЗ рд╕рд╛рде, рдПрдХ рд╣рдорд▓рд╛рд╡рд░ рд╕рдХреНрд╖рдо рд╣реЛрдЧрд╛:

* рдПрдХ рдирдпрд╛ Web ACL рдмрдирд╛рдирд╛, рдРрд╕реЗ рдирд┐рдпрдо рдкреЗрд╢ рдХрд░рдирд╛ рдЬреЛ рдпрд╛ рддреЛ рджреБрд░реНрднрд╛рд╡рдирд╛рдкреВрд░реНрдг рдЯреНрд░реИрдлрд╝рд┐рдХ рдХреЛ рдЕрдиреБрдорддрд┐ рджреЗрддреЗ рд╣реИрдВ рдпрд╛ рд╡реИрдз рдЯреНрд░реИрдлрд╝рд┐рдХ рдХреЛ рдмреНрд▓реЙрдХ рдХрд░рддреЗ рд╣реИрдВ, рдЬрд┐рд╕рд╕реЗ WAF рдмреЗрдХрд╛рд░ рд╣реЛ рдЬрд╛рддрд╛ рд╣реИ рдпрд╛ рд╕реЗрд╡рд╛ рдХрд╛ рдЗрдирдХрд╛рд░ рд╣реЛрддрд╛ рд╣реИред
* рдореМрдЬреВрджрд╛ Web ACLs рдХреЛ рдЕрдкрдбреЗрдЯ рдХрд░рдирд╛, рд╣рдорд▓реЛрдВ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрдиреЗ рдХреЗ рд▓рд┐рдП рдирд┐рдпрдореЛрдВ рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░рдирд╛ рдЬреИрд╕реЗ SQL рдЗрдВрдЬреЗрдХреНрд╢рди рдпрд╛ рдХреНрд░реЙрд╕-рд╕рд╛рдЗрдЯ рд╕реНрдХреНрд░рд┐рдкреНрдЯрд┐рдВрдЧ, рдЬрд┐рдиреНрд╣реЗрдВ рдкрд╣рд▓реЗ рдмреНрд▓реЙрдХ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛, рдпрд╛ рд╡реИрдз рдЕрдиреБрд░реЛрдзреЛрдВ рдХреЛ рдмреНрд▓реЙрдХ рдХрд░рдХреЗ рд╕рд╛рдорд╛рдиреНрдп рдЯреНрд░реИрдлрд╝рд┐рдХ рдкреНрд░рд╡рд╛рд╣ рдХреЛ рдмрд╛рдзрд┐рдд рдХрд░рдирд╛ред
* рдПрдХ Web ACL рдХреЛ рд╣рдЯрд╛рдирд╛, рдкреНрд░рднрд╛рд╡рд┐рдд рд╕рдВрд╕рд╛рдзрдиреЛрдВ рдХреЛ рдкреВрд░реА рддрд░рд╣ рд╕реЗ рдЕрд╕реБрд░рдХреНрд╖рд┐рдд рдЫреЛрдбрд╝рдирд╛, рдЬрд┐рд╕рд╕реЗ рдЗрд╕реЗ рд╡реЗрдм рд╣рдорд▓реЛрдВ рдХреА рдПрдХ рд╡рд┐рд╕реНрддреГрдд рд╢реНрд░реГрдВрдЦрд▓рд╛ рдХреЗ рд▓рд┐рдП рдЙрдЬрд╛рдЧрд░ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗред

{% hint style="info" %}
рдЖрдк рдХреЗрд╡рд▓ рдирд┐рд░реНрджрд┐рд╖реНрдЯ **WebACL** рдХреЛ рд╣рдЯрд╛ рд╕рдХрддреЗ рд╣реИрдВ рдпрджрд┐ **ManagedByFirewallManager** рдЧрд▓рдд рд╣реИред
{% endhint %}
```bash
# Create Web ACL
aws wafv2 create-web-acl --name <value> --default-action <value> --visibility-config <value> \
--scope <REGIONAL --region=<value> | CLOUDFRONT --region=us-east-1> [--rules <value>] [--captcha-config <value>] [--description <value>]
# Update Web ACL
aws wafv2 update-web-acl --name <value> --id <value> --default-action <value> --visibility-config <value> --lock-token <value>\
--scope <REGIONAL --region=<value> | CLOUDFRONT --region=us-east-1> [--rules <value>] [--captcha-config <value>] [--description <value>]
# Delete Web ACL
aws wafv2 delete-web-acl --name <value> --id <value> --lock-token <value> --scope <REGIONAL --region=<value> | CLOUDFRONT --region=us-east-1>
```
рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдЙрджрд╛рд╣рд░рдг рджрд┐рдЦрд╛рддрд╛ рд╣реИ рдХрд┐ рдПрдХ рд╡реЗрдм ACL рдХреЛ рдХреИрд╕реЗ рдЕрдкрдбреЗрдЯ рдХрд┐рдпрд╛ рдЬрд╛рдП рддрд╛рдХрд┐ рдПрдХ рд╡рд┐рд╢рд┐рд╖реНрдЯ IP рд╕реЗрдЯ рд╕реЗ рд╡реИрдз рдЯреНрд░реИрдлрд╝рд┐рдХ рдХреЛ рдмреНрд▓реЙрдХ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗред рдпрджрд┐ рдореВрд▓ IP рдЙрди IPs рдореЗрдВ рд╕реЗ рдХрд┐рд╕реА рд╕реЗ рдореЗрд▓ рдирд╣реАрдВ рдЦрд╛рддрд╛ рд╣реИ, рддреЛ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рдХреНрд░рд┐рдпрд╛ рднреА рдЗрд╕реЗ рдмреНрд▓реЙрдХ рдХрд░рдирд╛ рд╣реЛрдЧрд╛, рдЬрд┐рд╕рд╕реЗ DoS рд╣реЛрдЧрд╛ред

**Original Web ACL**:
```json
{
"WebACL": {
"Name": "AllowLegitimateIPsWebACL",
"Id": "1a2b3c4d-1a2b-1a2b-1a2b-1a2b3c4d5e6f",
"ARN": "arn:aws:wafv2:us-east-1:123456789012:regional/webacl/AllowLegitimateIPsWebACL/1a2b3c4d-1a2b-1a2b-1a2b-1a2b3c4d5e6f",
"DefaultAction": {
"Allow": {}
},
"Description": "",
"Rules": [
{
"Name": "AllowLegitimateIPsRule",
"Priority": 0,
"Statement": {
"IPSetReferenceStatement": {
"ARN": "arn:aws:wafv2:us-east-1:123456789012:regional/ipset/LegitimateIPv4/1a2b3c4d-1a2b-1a2b-1a2b-1a2b3c4d5e6f"
}
},
"Action": {
"Allow": {}
},
"VisibilityConfig": {
"SampledRequestsEnabled": false,
"CloudWatchMetricsEnabled": false,
"MetricName": "AllowLegitimateIPsRule"
}
}
],
"VisibilityConfig": {
"SampledRequestsEnabled": false,
"CloudWatchMetricsEnabled": false,
"MetricName": "AllowLegitimateIPsWebACL"
},
"Capacity": 1,
"ManagedByFirewallManager": false,
"LabelNamespace": "awswaf:123456789012:webacl:AllowLegitimateIPsWebACL:"
},
"LockToken": "1a2b3c4d-1a2b-1a2b-1a2b-1a2b3c4d5e6f"
}

```
Web ACL рдХреЛ рдЕрдкрдбреЗрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрдорд╛рдВрдб:
```json
aws wafv2 update-web-acl --name AllowLegitimateIPsWebACL --scope REGIONAL --id 1a2b3c4d-1a2b-1a2b-1a2b-1a2b3c4d5e6f --lock-token 1a2b3c4d-1a2b-1a2b-1a2b-1a2b3c4d5e6f --default-action Block={} --visibility-config SampledRequestsEnabled=false,CloudWatchMetricsEnabled=false,MetricName=AllowLegitimateIPsWebACL --rules file://rule.json --region us-east-1
```
**rule.json** рдлрд╝рд╛рдЗрд▓ рдЗрд╕ рддрд░рд╣ рджрд┐рдЦреЗрдЧреА:
```json
[
{
"Name": "BlockLegitimateIPsRule",
"Priority": 0,
"Statement": {
"IPSetReferenceStatement": {
"ARN": "arn:aws:wafv2:us-east-1:123456789012:regional/ipset/LegitimateIPv4/1a2b3c4d-1a2b-1a2b-1a2b-1a2b3c4d5e6f"
}
},
"Action": {
"Block": {}
},
"VisibilityConfig": {
"SampledRequestsEnabled": false,
"CloudWatchMetricsEnabled": false,
"MetricName": "BlockLegitimateIPRule"
}
}
]
```
**рд╕рдВрднрд╛рд╡рд┐рдд рдкреНрд░рднрд╛рд╡**: рдЕрдирдзрд┐рдХреГрдд рдкрд╣реБрдВрдЪ, рдбреЗрдЯрд╛ рдЙрд▓реНрд▓рдВрдШрди, рдФрд░ рд╕рдВрднрд╛рд╡рд┐рдд DoS рд╣рдорд▓реЗред

#### **`wafv2:AssociateWebACL`, `wafv2:DisassociateWebACL`**

**`wafv2:AssociateWebACL`** рдЕрдиреБрдорддрд┐ рдПрдХ рд╣рдорд▓рд╛рд╡рд░ рдХреЛ рд╡реЗрдм ACLs (рдПрдХреНрд╕реЗрд╕ рдХрдВрдЯреНрд░реЛрд▓ рд▓рд┐рд╕реНрдЯ) рдХреЛ рд╕рдВрд╕рд╛рдзрдиреЛрдВ рдХреЗ рд╕рд╛рде рдЬреЛрдбрд╝рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрдЧреА, рдЬрд┐рд╕рд╕реЗ рд╕реБрд░рдХреНрд╖рд╛ рдирд┐рдпрдВрддреНрд░рдгреЛрдВ рдХреЛ рдмрд╛рдпрдкрд╛рд╕ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗрдЧрд╛, рдЕрдирдзрд┐рдХреГрдд рдЯреНрд░реИрдлрд╝рд┐рдХ рдХреЛ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рддрдХ рдкрд╣реБрдБрдЪрдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рдорд┐рд▓реЗрдЧреА, рдЬреЛ рд╕рдВрднрд╛рд╡рд┐рдд рд░реВрдк рд╕реЗ SQL рдЗрдВрдЬреЗрдХреНрд╢рди рдпрд╛ рдХреНрд░реЙрд╕-рд╕рд╛рдЗрдЯ рд╕реНрдХреНрд░рд┐рдкреНрдЯрд┐рдВрдЧ (XSS) рдЬреИрд╕реЗ рд╢реЛрд╖рдгреЛрдВ рдХреА рдУрд░ рд▓реЗ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред рдЗрд╕рдХреЗ рд╡рд┐рдкрд░реАрдд, **`wafv2:DisassociateWebACL`** рдЕрдиреБрдорддрд┐ рдХреЗ рд╕рд╛рде, рд╣рдорд▓рд╛рд╡рд░ рдЕрд╕реНрдерд╛рдпреА рд░реВрдк рд╕реЗ рд╕реБрд░рдХреНрд╖рд╛ рд╕реБрд░рдХреНрд╖рд╛ рдХреЛ рдирд┐рд╖реНрдХреНрд░рд┐рдп рдХрд░ рд╕рдХрддрд╛ рд╣реИ, рд╕рдВрд╕рд╛рдзрдиреЛрдВ рдХреЛ рдмрд┐рдирд╛ рдкрд╣рдЪрд╛рди рдХреЗ рдХрдордЬреЛрд░рд┐рдпреЛрдВ рдХреЗ рд▓рд┐рдП рдЙрдЬрд╛рдЧрд░ рдХрд░ рд╕рдХрддрд╛ рд╣реИред

рд╕рдВрд░рдХреНрд╖рд┐рдд рд╕рдВрд╕рд╛рдзрди рдкреНрд░рдХрд╛рд░ рдХреЗ рдЖрдзрд╛рд░ рдкрд░ рдЕрддрд┐рд░рд┐рдХреНрдд рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрдЧреА:

* **Associate**
* apigateway:SetWebACL
* apprunner:AssociateWebAcl
* appsync:SetWebACL
* cognito-idp:AssociateWebACL
* ec2:AssociateVerifiedAccessInstanceWebAcl
* elasticloadbalancing:SetWebAcl
* **Disassociate**
* apigateway:SetWebACL
* apprunner:DisassociateWebAcl
* appsync:SetWebACL
* cognito-idp:DisassociateWebACL
* ec2:DisassociateVerifiedAccessInstanceWebAcl
* elasticloadbalancing:SetWebAcl
```bash
# Associate
aws wafv2 associate-web-acl --web-acl-arn <value> --resource-arn <value>
# Disassociate
aws wafv2 disassociate-web-acl --resource-arn <value>
```
**рд╕рдВрднрд╛рд╡рд┐рдд рдкреНрд░рднрд╛рд╡**: рд╕рдВрд╕рд╛рдзрдиреЛрдВ рдХреА рд╕реБрд░рдХреНрд╖рд╛ рдХрд╛ рд╕рдордЭреМрддрд╛, рд╢реЛрд╖рдг рдХрд╛ рдмрдврд╝рд╛ рд╣реБрдЖ рдЬреЛрдЦрд┐рдо, рдФрд░ AWS WAF рджреНрд╡рд╛рд░рд╛ рд╕рдВрд░рдХреНрд╖рд┐рдд AWS рд╡рд╛рддрд╛рд╡рд░рдг рдореЗрдВ рд╕рдВрднрд╛рд╡рд┐рдд рд╕реЗрд╡рд╛ рд╡реНрдпрд╡рдзрд╛рдиред

#### **`wafv2:CreateIPSet` , `wafv2:UpdateIPSet`, `wafv2:DeleteIPSet`**

рдПрдХ рд╣рдорд▓рд╛рд╡рд░ AWS WAF рджреНрд╡рд╛рд░рд╛ рдкреНрд░рдмрдВрдзрд┐рдд IP рд╕реЗрдЯ рдмрдирд╛рдиреЗ, рдЕрдкрдбреЗрдЯ рдХрд░рдиреЗ рдФрд░ рд╣рдЯрд╛рдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рд╣реЛрдЧрд╛ред рдпрд╣ рдЦрддрд░рдирд╛рдХ рд╣реЛ рд╕рдХрддрд╛ рд╣реИ рдХреНрдпреЛрдВрдХрд┐ рдпрд╣ рджреБрд░реНрднрд╛рд╡рдирд╛рдкреВрд░реНрдг рдЯреНрд░реИрдлрд╝рд┐рдХ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрдиреЗ рдХреЗ рд▓рд┐рдП рдирдП IP рд╕реЗрдЯ рдмрдирд╛ рд╕рдХрддрд╛ рд╣реИ, рд╡реИрдз рдЯреНрд░реИрдлрд╝рд┐рдХ рдХреЛ рдмреНрд▓реЙрдХ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП IP рд╕реЗрдЯ рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░ рд╕рдХрддрд╛ рд╣реИ, рджреБрд░реНрднрд╛рд╡рдирд╛рдкреВрд░реНрдг IP рдкрддреЗ рд╢рд╛рдорд┐рд▓ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдореМрдЬреВрджрд╛ IP рд╕реЗрдЯ рдХреЛ рдЕрдкрдбреЗрдЯ рдХрд░ рд╕рдХрддрд╛ рд╣реИ, рд╡рд┐рд╢реНрд╡рд╕рдиреАрдп IP рдкрддреЗ рд╣рдЯрд╛ рд╕рдХрддрд╛ рд╣реИ рдпрд╛ рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╕рдВрд╕рд╛рдзрдиреЛрдВ рдХреА рд╕реБрд░рдХреНрд╖рд╛ рдХреЗ рд▓рд┐рдП рдмрдирд╛рдП рдЧрдП рдорд╣рддреНрд╡рдкреВрд░реНрдг IP рд╕реЗрдЯ рдХреЛ рд╣рдЯрд╛ рд╕рдХрддрд╛ рд╣реИред
```bash
# Create IP set
aws wafv2 create-ip-set --name <value> --ip-address-version <IPV4 | IPV6> --addresses <value> --scope <REGIONAL --region=<value> | CLOUDFRONT --region=us-east-1>
# Update IP set
aws wafv2 update-ip-set --name <value> --id <value> --addresses <value> --lock-token <value> --scope <REGIONAL --region=<value> | CLOUDFRONT --region=us-east-1>
# Delete IP set
aws wafv2 delete-ip-set --name <value> --id <value> --lock-token <value> --scope <REGIONAL --region=<value> | CLOUDFRONT --region=us-east-1>
```
рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдЙрджрд╛рд╣рд░рдг рджрд┐рдЦрд╛рддрд╛ рд╣реИ рдХрд┐ **рдЗрдЪреНрдЫрд┐рдд IP рд╕реЗрдЯ рджреНрд╡рд╛рд░рд╛ рдореМрдЬреВрджрд╛ IP рд╕реЗрдЯ рдХреЛ рдХреИрд╕реЗ рдУрд╡рд░рд░рд╛рдЗрдЯ рдХрд░реЗрдВ**:
```bash
aws wafv2 update-ip-set --name LegitimateIPv4Set --id 1a2b3c4d-1a2b-1a2b-1a2b-1a2b3c4d5e6f --addresses 99.99.99.99/32 --lock-token 1a2b3c4d-1a2b-1a2b-1a2b-1a2b3c4d5e6f --scope CLOUDFRONT --region us-east-1
```
**рд╕рдВрднрд╛рд╡рд┐рдд рдкреНрд░рднрд╛рд╡**: рдЕрдирдзрд┐рдХреГрдд рдкрд╣реБрдВрдЪ рдФрд░ рд╡реИрдз рдЯреНрд░реИрдлрд╝рд┐рдХ рдХрд╛ рдЕрд╡рд░реЛрдзред

#### **`wafv2:CreateRegexPatternSet`** , **`wafv2:UpdateRegexPatternSet`**, **`wafv2:DeleteRegexPatternSet`**

рдЗрди рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХреЗ рд╕рд╛рде рдПрдХ рд╣рдорд▓рд╛рд╡рд░ AWS WAF рджреНрд╡рд╛рд░рд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдЬрд╛рдиреЗ рд╡рд╛рд▓реЗ рдирд┐рдпрдорд┐рдд рдЕрднрд┐рд╡реНрдпрдХреНрддрд┐ рдкреИрдЯрд░реНрди рд╕реЗрдЯ рдХреЛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдФрд░ рдлрд╝рд┐рд▓реНрдЯрд░ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╣реЗрд░рдлреЗрд░ рдХрд░ рд╕рдХреЗрдЧрд╛ред

* рдирдП regex рдкреИрдЯрд░реНрди рдмрдирд╛рдирд╛ рдПрдХ рд╣рдорд▓рд╛рд╡рд░ рдХреЛ рд╣рд╛рдирд┐рдХрд╛рд░рдХ рд╕рд╛рдордЧреНрд░реА рдХреА рдЕрдиреБрдорддрд┐ рджреЗрдиреЗ рдореЗрдВ рдорджрдж рдХрд░реЗрдЧрд╛
* рдореМрдЬреВрджрд╛ рдкреИрдЯрд░реНрди рдХреЛ рдЕрдкрдбреЗрдЯ рдХрд░рддреЗ рд╕рдордп, рдПрдХ рд╣рдорд▓рд╛рд╡рд░ рд╕реБрд░рдХреНрд╖рд╛ рдирд┐рдпрдореЛрдВ рдХреЛ рдмрд╛рдпрдкрд╛рд╕ рдХрд░ рд╕рдХреЗрдЧрд╛
* рдЙрди рдкреИрдЯрд░реНрди рдХреЛ рд╣рдЯрд╛рдирд╛ рдЬреЛ рджреБрд░реНрднрд╛рд╡рдирд╛рдкреВрд░реНрдг рдЧрддрд┐рд╡рд┐рдзрд┐рдпреЛрдВ рдХреЛ рдЕрд╡рд░реБрджреНрдз рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдбрд┐рдЬрд╝рд╛рдЗрди рдХрд┐рдП рдЧрдП рд╣реИрдВ, рдПрдХ рд╣рдорд▓рд╛рд╡рд░ рдХреЛ рджреБрд░реНрднрд╛рд╡рдирд╛рдкреВрд░реНрдг рдкреЗрд▓реЛрдб рднреЗрдЬрдиреЗ рдФрд░ рд╕реБрд░рдХреНрд╖рд╛ рдЙрдкрд╛рдпреЛрдВ рдХреЛ рдмрд╛рдпрдкрд╛рд╕ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗ рд╕рдХрддрд╛ рд╣реИред
```bash
# Create regex pattern set
aws wafv2 create-regex-pattern-set --name <value> --regular-expression-list <value> --scope <REGIONAL --region=<value> | CLOUDFRONT --region=us-east-1> [--description <value>]
# Update regex pattern set
aws wafv2 update-regex-pattern-set --name <value> --id <value> --regular-expression-list <value> --lock-token <value> --scope <REGIONAL --region=<value> | CLOUDFRONT --region=us-east-1>
# Delete regex pattern set
aws wafv2 delete-regex-pattern-set --name <value> --scope <REGIONAL --region=<value> | CLOUDFRONT --region=us-east-1> --id <value> --lock-token <value>
```
**рд╕рдВрднрд╛рд╡рд┐рдд рдкреНрд░рднрд╛рд╡**: рд╕реБрд░рдХреНрд╖рд╛ рдирд┐рдпрдВрддреНрд░рдгреЛрдВ рдХреЛ рдмрд╛рдпрдкрд╛рд╕ рдХрд░рдирд╛, рджреБрд░реНрднрд╛рд╡рдирд╛рдкреВрд░реНрдг рд╕рд╛рдордЧреНрд░реА рдХреА рдЕрдиреБрдорддрд┐ рджреЗрдирд╛ рдФрд░ рд╕рдВрднрд╛рд╡рд┐рдд рд░реВрдк рд╕реЗ рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рдбреЗрдЯрд╛ рдХреЛ рдЙрдЬрд╛рдЧрд░ рдХрд░рдирд╛ рдпрд╛ AWS WAF рджреНрд╡рд╛рд░рд╛ рд╕рдВрд░рдХреНрд╖рд┐рдд рд╕реЗрд╡рд╛рдУрдВ рдФрд░ рд╕рдВрд╕рд╛рдзрдиреЛрдВ рдХреЛ рдмрд╛рдзрд┐рдд рдХрд░рдирд╛ред

#### **(`wavf2:PutLoggingConfiguration` &** `iam:CreateServiceLinkedRole`), **`wafv2:DeleteLoggingConfiguration`**

рдПрдХ рд╣рдорд▓рд╛рд╡рд░ рдХреЗ рдкрд╛рд╕ **`wafv2:DeleteLoggingConfiguration`** рд╣реЛрдиреЗ рдкрд░ рд╡рд╣ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рд╡реЗрдм ACL рд╕реЗ рд▓реЙрдЧрд┐рдВрдЧ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдХреЛ рд╣рдЯрд╛ рд╕рдХреЗрдЧрд╛ред рдЗрд╕рдХреЗ рдмрд╛рдж, **`wavf2:PutLoggingConfiguration`** рдФрд░ **`iam:CreateServiceLinkedRole`** рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХреЗ рд╕рд╛рде, рдПрдХ рд╣рдорд▓рд╛рд╡рд░ рд▓реЙрдЧрд┐рдВрдЧ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдмрдирд╛ рдпрд╛ рдмрджрд▓ рд╕рдХрддрд╛ рд╣реИ (рдЗрд╕реЗ рд╣рдЯрд╛рдиреЗ рдХреЗ рдмрд╛рдж) рддрд╛рдХрд┐ рдпрд╛ рддреЛ рд▓реЙрдЧрд┐рдВрдЧ рдХреЛ рдкреВрд░реА рддрд░рд╣ рд╕реЗ рд░реЛрдХрд╛ рдЬрд╛ рд╕рдХреЗ рдпрд╛ рд▓реЙрдЧ рдХреЛ рдЕрдирдзрд┐рдХреГрдд рд╕реНрдерд▓реЛрдВ рдкрд░ рдкреБрдирд░реНрдирд┐рд░реНрджреЗрд╢рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗ, рдЬреИрд╕реЗ рдХрд┐ Amazon S3 рдмрдХреЗрдЯ, Amazon CloudWatch Logs рд▓реЙрдЧ рд╕рдореВрд╣ рдпрд╛ Amazon Kinesis Data Firehose рдХреЗ рддрд╣рдд рдирд┐рдпрдВрддреНрд░рдгред

рдирд┐рд░реНрдорд╛рдг рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЗ рджреМрд░рд╛рди, рд╕реЗрд╡рд╛ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рд▓реЙрдЧрд┐рдВрдЧ рдЧрдВрддрд╡реНрдп рдкрд░ рд▓реЙрдЧ рд▓рд┐рдЦрдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрдиреЗ рдХреЗ рд▓рд┐рдП рдЖрд╡рд╢реНрдпрдХ рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХреЛ рд╕реЗрдЯ рдХрд░рддреА рд╣реИ:

* **Amazon CloudWatch Logs:** AWS WAF рдирд┐рд░реНрджрд┐рд╖реНрдЯ CloudWatch Logs рд▓реЙрдЧ рд╕рдореВрд╣ рдкрд░ рдПрдХ рд╕рдВрд╕рд╛рдзрди рдиреАрддрд┐ рдмрдирд╛рддрд╛ рд╣реИред рдпрд╣ рдиреАрддрд┐ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рддреА рд╣реИ рдХрд┐ AWS WAF рдХреЗ рдкрд╛рд╕ рд▓реЙрдЧ рд╕рдореВрд╣ рдореЗрдВ рд▓реЙрдЧ рд▓рд┐рдЦрдиреЗ рдХреЗ рд▓рд┐рдП рдЖрд╡рд╢реНрдпрдХ рдЕрдиреБрдорддрд┐рдпрд╛рдБ рд╣реИрдВред
* **Amazon S3 рдмрдХреЗрдЯ:** AWS WAF рдирд┐рд░реНрджрд┐рд╖реНрдЯ S3 рдмрдХреЗрдЯ рдкрд░ рдПрдХ рдмрдХреЗрдЯ рдиреАрддрд┐ рдмрдирд╛рддрд╛ рд╣реИред рдпрд╣ рдиреАрддрд┐ AWS WAF рдХреЛ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдмрдХреЗрдЯ рдореЗрдВ рд▓реЙрдЧ рдЕрдкрд▓реЛрдб рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрд╡рд╢реНрдпрдХ рдЕрдиреБрдорддрд┐рдпрд╛рдБ рдкреНрд░рджрд╛рди рдХрд░рддреА рд╣реИред
* **Amazon Kinesis Data Firehose:** AWS WAF Kinesis Data Firehose рдХреЗ рд╕рд╛рде рдмрд╛рддрдЪреАрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ рдПрдХ рд╕реЗрд╡рд╛-рд▓рд┐рдВрдХреНрдб рднреВрдорд┐рдХрд╛ рдмрдирд╛рддрд╛ рд╣реИред рдпрд╣ рднреВрдорд┐рдХрд╛ AWS WAF рдХреЛ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХреА рдЧрдИ Firehose рд╕реНрдЯреНрд░реАрдо рдореЗрдВ рд▓реЙрдЧ рд╡рд┐рддрд░рд┐рдд рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддреА рд╣реИред

{% hint style="info" %}
рдпрд╣ рд╕рдВрднрд╡ рд╣реИ рдХрд┐ рдкреНрд░рддрд┐ рд╡реЗрдм ACL рдХреЗрд╡рд▓ рдПрдХ рд▓реЙрдЧрд┐рдВрдЧ рдЧрдВрддрд╡реНрдп рдХреЛ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рдПред
{% endhint %}
```bash
# Put logging configuration
aws wafv2 put-logging-configuration --logging-configuration <value>
# Delete logging configuration
aws wafv2 delete-logging-configuration --resource-arn <value> [--log-scope <CUSTOMER | SECURITY_LAKE>] [--log-type <value>]
```
**рд╕рдВрднрд╛рд╡рд┐рдд рдкреНрд░рднрд╛рд╡:** рд╕реБрд░рдХреНрд╖рд╛ рдШрдЯрдирд╛рдУрдВ рдореЗрдВ рдЕрд╕реНрдкрд╖реНрдЯ рджреГрд╢реНрдпрддрд╛, рдШрдЯрдирд╛ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЛ рдХрдард┐рди рдмрдирд╛рдирд╛, рдФрд░ AWS WAF-рд╕реБрд░рдХреНрд╖рд┐рдд рд╡рд╛рддрд╛рд╡рд░рдг рдореЗрдВ рдЧреБрдкреНрдд рджреБрд░реНрднрд╛рд╡рдирд╛рдкреВрд░реНрдг рдЧрддрд┐рд╡рд┐рдзрд┐рдпреЛрдВ рдХреЛ рд╕реБрд╡рд┐рдзрд╛рдЬрдирдХ рдмрдирд╛рдирд╛ред

#### **`wafv2:DeleteAPIKey`**

рдЗрд╕ рдЕрдиреБрдорддрд┐ рдХреЗ рд╕рд╛рде рдПрдХ рд╣рдорд▓рд╛рд╡рд░ рдореМрдЬреВрджрд╛ API рдХреБрдВрдЬрд┐рдпреЛрдВ рдХреЛ рд╣рдЯрд╛ рд╕рдХрддрд╛ рд╣реИ, рдЬрд┐рд╕рд╕реЗ CAPTCHA рдЕрдкреНрд░рднрд╛рд╡реА рд╣реЛ рдЬрд╛рддрд╛ рд╣реИ рдФрд░ рдЗрд╕рдХреЗ рдЖрдзрд╛рд░ рдкрд░ рдХрд╛рд░реНрдпрдХреНрд╖рдорддрд╛ рдмрд╛рдзрд┐рдд рд╣реЛрддреА рд╣реИ, рдЬреИрд╕реЗ рдХрд┐ рдлреЙрд░реНрдо рд╕рдмрдорд┐рд╢рди рдФрд░ рдПрдХреНрд╕реЗрд╕ рдирд┐рдпрдВрддреНрд░рдгред рдЗрд╕ CAPTCHA рдХреЗ рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди рдХреЗ рдЖрдзрд╛рд░ рдкрд░, рдпрд╣ рдпрд╛ рддреЛ CAPTCHA рдмрд╛рдпрдкрд╛рд╕ рдХреА рдУрд░ рд▓реЗ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдпрд╛ рдпрджрд┐ рд╕рдВрд╕рд╛рдзрди рдореЗрдВ рддреНрд░реБрдЯрд┐ рдкреНрд░рдмрдВрдзрди рд╕рд╣реА рддрд░реАрдХреЗ рд╕реЗ рд╕реЗрдЯ рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ рддреЛ DoS рдХреА рдУрд░ред
```bash
# Delete API key
aws wafv2 delete-api-key --api-key <value> --scope <REGIONAL --region=<value> | CLOUDFRONT --region=us-east-1>
```
**рд╕рдВрднрд╛рд╡рд┐рдд рдкреНрд░рднрд╛рд╡**: CAPTCHA рд╕реБрд░рдХреНрд╖рд╛ рдХреЛ рдирд┐рд╖реНрдХреНрд░рд┐рдп рдХрд░рдирд╛ рдпрд╛ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреА рдХрд╛рд░реНрдпрдХреНрд╖рдорддрд╛ рдХреЛ рдмрд╛рдзрд┐рдд рдХрд░рдирд╛, рдЬрд┐рд╕рд╕реЗ рд╕реБрд░рдХреНрд╖рд╛ рдЙрд▓реНрд▓рдВрдШрди рдФрд░ рд╕рдВрднрд╛рд╡рд┐рдд рдбреЗрдЯрд╛ рдЪреЛрд░реА рд╣реЛ рд╕рдХрддреА рд╣реИред

#### **`wafv2:TagResource`, `wafv2:UntagResource`**

рдПрдХ рд╣рдорд▓рд╛рд╡рд░ AWS WAFv2 рд╕рдВрд╕рд╛рдзрдиреЛрдВ, рдЬреИрд╕реЗ рдХрд┐ рд╡реЗрдм ACLs, рдирд┐рдпрдо рд╕рдореВрд╣, IP рд╕реЗрдЯ, regex рдкреИрдЯрд░реНрди рд╕реЗрдЯ, рдФрд░ рд▓реЙрдЧрд┐рдВрдЧ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рд╕реЗ рдЯреИрдЧ рдЬреЛрдбрд╝рдиреЗ, рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░рдиреЗ рдпрд╛ рд╣рдЯрд╛рдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рд╣реЛрдЧрд╛ред
```bash
# Tag
aws wafv2 tag-resource --resource-arn <value> --tags <value>
# Untag
aws wafv2 untag-resource --resource-arn <value> --tag-keys <value>
```
**рд╕рдВрднрд╛рд╡рд┐рдд рдкреНрд░рднрд╛рд╡**: рд╕рдВрд╕рд╛рдзрди рдЫреЗрдбрд╝рдЫрд╛рдбрд╝, рдЬрд╛рдирдХрд╛рд░реА рдХрд╛ рд░рд┐рд╕рд╛рд╡, рд▓рд╛рдЧрдд рдореЗрдВ рд╣реЗрд░рдлреЗрд░ рдФрд░ рд╕рдВрдЪрд╛рд▓рди рдореЗрдВ рдмрд╛рдзрд╛ред

## рд╕рдВрджрд░реНрдн

* [https://www.citrusconsulting.com/aws-web-application-firewall-waf/#:\~:text=Conditions%20allow%20you%20to%20specify,user%20via%20a%20web%20application](https://www.citrusconsulting.com/aws-web-application-firewall-waf/)
* [https://docs.aws.amazon.com/service-authorization/latest/reference/list\_awswafv2.html](https://docs.aws.amazon.com/service-authorization/latest/reference/list\_awswafv2.html)

{% hint style="success" %}
AWS рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ рдФрд░ рдЕрднреНрдпрд╛рд╕ рдХрд░реЗрдВ:<img src="../../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">\
GCP рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ рдФрд░ рдЕрднреНрдпрд╛рд╕ рдХрд░реЗрдВ: <img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░реЗрдВ</summary>

* [**рд╕рджрд╕реНрдпрддрд╛ рдпреЛрдЬрдирд╛рдПрдБ**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* **ЁЯТм [**Discord рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**telegram рд╕рдореВрд╣**](https://t.me/peass) рдореЗрдВ рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ рдпрд╛ **Twitter** ЁЯРж рдкрд░ рд╣рдореЗрдВ **рдлреЙрд▓реЛ** рдХрд░реЗрдВ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ рдФрд░ [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) рдЧрд┐рдЯрд╣рдм рд░рд┐рдкреЛрдЬрд┐рдЯрд░реА рдореЗрдВ PR рд╕рдмрдорд┐рдЯ рдХрд░реЗрдВред**

</details>
{% endhint %}
