# AWS - WAF Enum

<details>

<summary><strong>SÄ±fÄ±rdan kahraman olacak ÅŸekilde AWS hackleme Ã¶ÄŸrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ±)</strong></a><strong>!</strong></summary>

HackTricks'Ä± desteklemenin diÄŸer yollarÄ±:

* **Åirketinizi HackTricks'te reklamÄ±nÄ± gÃ¶rmek istiyorsanÄ±z** veya **HackTricks'i PDF olarak indirmek istiyorsanÄ±z** [**ABONELÄ°K PLANLARI**](https://github.com/sponsors/carlospolop)'na gÃ¶z atÄ±n!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nleri**](https://peass.creator-spring.com)'ni edinin
* [**PEASS Ailesi'ni**](https://opensea.io/collection/the-peass-family) keÅŸfedin, Ã¶zel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuz
* **KatÄ±lÄ±n** ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) veya bizi **Twitter** ğŸ¦ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**'da takip edin.**
* **Hacking pÃ¼f noktalarÄ±nÄ±zÄ± paylaÅŸarak PR'lar gÃ¶ndererek** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na katkÄ±da bulunun.

</details>

# AWS WAF

AWS WAF, web uygulamalarÄ±nÄ± veya API'leri Ã§eÅŸitli web saldÄ±rÄ±larÄ±na karÅŸÄ± korumak amacÄ±yla tasarlanmÄ±ÅŸ bir **web uygulamasÄ± gÃ¼venlik duvarÄ±dÄ±r**. KullanÄ±cÄ±larÄ±n gelen trafiÄŸi kontrol etmelerini saÄŸlar ve SQL enjeksiyonu veya cross-site scripting gibi tipik saldÄ±rÄ± vektÃ¶rlerini hafifleten **gÃ¼venlik kurallarÄ±** oluÅŸturarak Ã¶zelleÅŸtirilmiÅŸ filtreleme kurallarÄ± tanÄ±mlayarak Ã§alÄ±ÅŸÄ±r.

## Ana kavramlar

### Web ACL (EriÅŸim Kontrol Listesi)

Web ACL, web uygulamalarÄ±nÄ±z veya API'lerinize uygulayabileceÄŸiniz kurallar koleksiyonudur. Bir Web ACL'yi bir kaynakla iliÅŸkilendirdiÄŸinizde, AWS WAF, Web ACL'de tanÄ±mlanan kurallara gÃ¶re gelen istekleri denetler ve belirtilen iÅŸlemleri gerÃ§ekleÅŸtirir.

### Kural Grubu

Kural Grubu, birden fazla Web ACL'sine uygulayabileceÄŸiniz yeniden kullanÄ±labilir bir kural koleksiyonudur. Kural gruplarÄ±, farklÄ± web uygulamalarÄ± veya API'ler arasÄ±nda tutarlÄ± kural setlerini yÃ¶netmeye ve sÃ¼rdÃ¼rmeye yardÄ±mcÄ± olur.

Her kural grubunun iliÅŸkili **kapasitesi** vardÄ±r ve bu, kurallarÄ±nÄ±zÄ±, kural gruplarÄ±nÄ±zÄ± ve web ACL'lerinizi Ã§alÄ±ÅŸtÄ±rmak iÃ§in kullanÄ±lan iÅŸletim kaynaklarÄ±nÄ± hesaplamaya ve kontrol etmeye yardÄ±mcÄ± olur. OluÅŸturulurken deÄŸeri belirlendikten sonra deÄŸiÅŸtirilemez.

### Kural

Bir kural, AWS WAF'Ä±n gelen web isteklerini denetlemek iÃ§in kullandÄ±ÄŸÄ± koÅŸullar kÃ¼mesini tanÄ±mlar. Ä°ki ana kural tÃ¼rÃ¼ vardÄ±r:

1. **Normal Kural**: Bu kural tÃ¼rÃ¼, web isteklerini izin vermek, engellemek veya saymak iÃ§in belirli koÅŸullarÄ± kullanÄ±r.
2. **Oran TabanlÄ± Kural**: Belirli bir IP adresinden gelen istekleri beÅŸ dakikalÄ±k bir sÃ¼re iÃ§inde sayar. KullanÄ±cÄ±lar burada bir eÅŸik belirler ve IP'den gelen istek sayÄ±sÄ± bu sÄ±nÄ±ra ulaÅŸÄ±rsa, IP'den gelen sonraki istekler eÅŸik altÄ±na dÃ¼ÅŸene kadar engellenir. Oran tabanlÄ± kurallar iÃ§in minimum eÅŸik **2000 istek**tir.

### YÃ¶netilen Kurallar

AWS WAF, AWS ve AWS Marketplace satÄ±cÄ±larÄ± tarafÄ±ndan sÃ¼rdÃ¼rÃ¼len Ã¶nceden yapÄ±landÄ±rÄ±lmÄ±ÅŸ, yÃ¶netilen kural setleri sunar. Bu kural setleri, yaygÄ±n tehditlere karÅŸÄ± koruma saÄŸlar ve yeni gÃ¼venlik aÃ§Ä±klarÄ±nÄ± ele almak iÃ§in dÃ¼zenli olarak gÃ¼ncellenir.

### IP KÃ¼mesi

Bir IP KÃ¼mesi, izin vermek veya engellemek istediÄŸiniz IP adreslerinin veya IP adresi aralÄ±klarÄ±nÄ±n bir listesidir. IP kÃ¼meleri, IP tabanlÄ± kurallarÄ± yÃ¶netmeyi basitleÅŸtirir.

### Regex Deseni KÃ¼mesi

Bir Regex Deseni KÃ¼mesi, web isteklerinde aranacak desenleri tanÄ±mlayan bir veya daha fazla dÃ¼zenli ifade (regex) iÃ§erir. Bu, belirli karakter dizilerini filtrelemek gibi daha karmaÅŸÄ±k eÅŸleme senaryolarÄ± iÃ§in kullanÄ±ÅŸlÄ±dÄ±r.

### Kilit Belirteci

Kilit Belirteci, WAF kaynaklarÄ±na gÃ¼ncelleme yaparken eÅŸ zamanlÄ±lÄ±k kontrolÃ¼ iÃ§in kullanÄ±lÄ±r. DeÄŸiÅŸikliklerin aynÄ± anda aynÄ± kaynaÄŸÄ± gÃ¼ncellemeye Ã§alÄ±ÅŸan birden fazla kullanÄ±cÄ± veya iÅŸlem tarafÄ±ndan yanlÄ±ÅŸlÄ±kla Ã¼zerine yazÄ±lmamasÄ±nÄ± saÄŸlar.

### API AnahtarlarÄ±

AWS WAF'daki API AnahtarlarÄ±, belirli API iÅŸlemlerine kimlik doÄŸrulamasÄ± yapmak iÃ§in kullanÄ±lÄ±r. Bu anahtarlar ÅŸifrelenir ve gÃ¼venli bir ÅŸekilde yÃ¶netilir, eriÅŸimi kontrol etmek ve yalnÄ±zca yetkili kullanÄ±cÄ±larÄ±n WAF yapÄ±landÄ±rmalarÄ±nÄ± deÄŸiÅŸtirebilmesini saÄŸlamak iÃ§in.

- **Ã–rnek**: CAPTCHA API'sinin entegrasyonu.

### Ä°zin PolitikasÄ±

Bir Ä°zin PolitikasÄ±, AWS WAF kaynaklarÄ±nda hangi iÅŸlemleri gerÃ§ekleÅŸtirebileceÄŸini belirten bir IAM politikasÄ±dÄ±r. Ä°zinleri tanÄ±mlayarak, WAF kaynaklarÄ±na eriÅŸimi kontrol edebilir ve yalnÄ±zca yetkili kullanÄ±cÄ±larÄ±n yapÄ±landÄ±rmalar oluÅŸturmasÄ±na, gÃ¼ncelleÅŸtirmesine veya silmesine izin verebilirsiniz.

### Kapsam

AWS WAF'daki kapsam parametresi, WAF kurallarÄ±nÄ±n ve yapÄ±landÄ±rmalarÄ±nÄ±n bÃ¶lgesel bir uygulamaya mÄ± yoksa Amazon CloudFront daÄŸÄ±tÄ±mÄ±na mÄ± uygulandÄ±ÄŸÄ±nÄ± belirtir.

- **BÃ–LGESEL**: UygulamalarÄ±n olduÄŸu AWS bÃ¶lgesini belirttiÄŸiniz bÃ¶lgesel hizmetlere uygulanÄ±r, Ã¶rneÄŸin Uygulama YÃ¼k Dengeleyicileri (ALB), Amazon API Gateway REST API, AWS AppSync GraphQL API, Amazon Cognito kullanÄ±cÄ± havuzu, AWS App Runner hizmeti ve AWS OnaylÄ± EriÅŸim Ã¶rneÄŸi. Bu kaynaklarÄ±n bulunduÄŸu AWS bÃ¶lgesini belirtirsiniz.
- **CLOUDFRONT**: KÃ¼resel olan Amazon CloudFront daÄŸÄ±tÄ±mlarÄ±na uygulanÄ±r. CloudFront iÃ§in WAF yapÄ±landÄ±rmalarÄ±, iÃ§eriÄŸin sunulduÄŸu yere bakÄ±lmaksÄ±zÄ±n `us-east-1` bÃ¶lgesi Ã¼zerinden yÃ¶netilir.

## Ana Ã¶zellikler

### Ä°zleme Kriterleri (KoÅŸullar)

**KoÅŸullar**, AWS WAF'Ä±n izlediÄŸi gelen HTTP/HTTPS isteklerinin unsurlarÄ±nÄ± belirtir; XSS, coÄŸrafi konum (GEO), IP adresleri, Boyut kÄ±sÄ±tlamalarÄ±, SQL Enjeksiyonu ve desenler (diziler ve regex eÅŸleÅŸmesi) gibi. **Ãœlkeye gÃ¶re CloudFront seviyesinde kÄ±sÄ±tlanan isteklerin WAF'a ulaÅŸmayacaÄŸÄ±nÄ±** unutmak Ã¶nemlidir.

Her AWS hesabÄ± ÅŸunlarÄ± yapÄ±landÄ±rabilir:

- Her tÃ¼r iÃ§in **100 koÅŸul** (yalnÄ±zca Regex iÃ§in sadece **10 koÅŸul** izin verilir, ancak bu sÄ±nÄ±rlama artÄ±rÄ±labilir).
- **100 kural** ve **50 Web ACL**.
- Maksimum **5 oran tabanlÄ± kural**.
- Bir uygulama yÃ¼k dengeleyici ile uygulandÄ±ÄŸÄ±nda **saniyede 10.000 istek** geÃ§iÅŸi.

### Kural iÅŸlemleri

Her kurala atanan iÅŸlemler ÅŸunlardÄ±r:

- **Ä°zin Ver**: Ä°stek uygun CloudFront daÄŸÄ±tÄ±mÄ±na veya Uygulama YÃ¼k Dengeleyicisine iletilir.
- **Engelle**: Ä°stek hemen sonlandÄ±rÄ±lÄ±r.
- **Say**: KuralÄ±n koÅŸullarÄ±nÄ± karÅŸÄ±layan istekleri sayar. Bu, kuralÄ± Ä°zin Ver veya Engelle olarak ayarlamadan Ã¶nce kuralÄ±n doÄŸruluÄŸunu test etmek iÃ§in yararlÄ±dÄ±r.
- **CAPTCHA ve Zorluk**: Ä°stekin bir bot tarafÄ±ndan gelmediÄŸinden emin olmak iÃ§in CAPTCHA bulmacalarÄ± ve sessiz zorluklar kullanÄ±lÄ±r.

Bir istek, Web ACL iÃ§indeki herhangi bir kurala uymazsa, **varsayÄ±lan iÅŸlem** (Ä°zin Ver veya Engelle) uygulanÄ±r. Bir Web ACL iÃ§inde tanÄ±mlanan kuralÄ±n yÃ¼rÃ¼tme sÄ±rasÄ± Ã¶nemlidir ve genellikle ÅŸu sÄ±rayÄ± takip eder:

1. Beyaz Listelenen IP'ler Ä°zin Ver.
2. Kara Listelenen IP'ler Engelle.
3. ZararlÄ± imzalarÄ± eÅŸleÅŸtiren istekleri Engelle.

### CloudWatch Entegrasyonu

AWS WAF, izleme iÃ§in CloudWatch ile entegre olur ve Ä°zin Verilen Ä°stekler, Engellenen Ä°stekler, SayÄ±lan Ä°stekler ve GeÃ§en Ä°stekler gibi metrikler sunar. Bu metrikler varsayÄ±lan olarak her dakika raporlanÄ±r ve iki hafta boyunca saklanÄ±r.

## NumaralandÄ±rma

CloudFront daÄŸÄ±tÄ±mlarÄ±yla etkileÅŸime geÃ§mek iÃ§in, BÃ¶lgeyi US East (Kuzey Virginia) olarak belirtmelisiniz:

- CLI - CloudFront kapsamÄ±nÄ± kullanÄ±rken BÃ¶lgeyi US East olarak belirtin:Â `--scope CLOUDFRONT --region=us-east-1`Â .
- API ve SDK'lar - TÃ¼m Ã§aÄŸrÄ±lar iÃ§in, BÃ¶lge uÃ§ noktasÄ±nÄ± us-east-1 olarak kullanÄ±n.

BÃ¶lgesel hizmetlerle etkileÅŸime geÃ§mek iÃ§in bÃ¶lgeyi belirtmelisiniz:

- Ã–rnek olarak Avrupa (Ä°spanya) bÃ¶lgesi: `--scope REGIONAL --region=eu-south-2`
```bash
# Web ACLs #

## Retrieve a list of web access control lists (Web ACLs) available in your AWS account
aws wafv2 list-web-acls --scope <REGIONAL --region=<value> | CLOUDFRONT --region=us-east-1>
## Retrieve details about the specified Web ACL
aws wafv2 get-web-acl --name <value> --id <value> --scope <REGIONAL --region=<value> | CLOUDFRONT --region=us-east-1>

## Retrieve a list of resources associated with a specific web access control list (Web ACL)
aws wafv2 list-resources-for-web-acl --web-acl-arn <value> # Additional permissions needed depending on the protected resource type: cognito-idp:ListResourcesForWebACL, ec2:DescribeVerifiedAccessInstanceWebAclAssociations or apprunner:ListAssociatedServicesForWebAcl
## Retrieve the Web ACL associated with the specified AWS resource
aws wafv2 get-web-acl-for-resource --resource-arn <arn> # Additional permissions needed depending on the protected resource type: cognito-idp:GetWebACLForResource, ec2:GetVerifiedAccessInstanceWebAcl, wafv2:GetWebACL or apprunner:DescribeWebAclForService

# Rule groups #

## List of the rule groups available in your AWS account
aws wafv2 list-rule-groups --scope <REGIONAL --region=<value> | CLOUDFRONT --region=us-east-1>
## Retrieve the details of a specific rule group
aws wafv2 get-rule-group [--name <value>] [--id <value>] [--arn <value>] [--scope <REGIONAL --region=<value> | CLOUDFRONT --region=us-east-1>]
## Retrieve the IAM policy attached to the specified rule group
aws wafv2 get-permission-policy --resource-arn <rule-group-arn> # Just the owner of the Rule Group can do this operation

# Managed rule groups (by AWS or by a third-party) #

## List the managed rule groups that are available
aws wafv2 list-available-managed-rule-groups --scope <REGIONAL --region=<value> | CLOUDFRONT --region=us-east-1>
## List the available versions of the specified managed rule group
aws wafv2 list-available-managed-rule-group-versions --vendor-name <value> --name <value> --scope <REGIONAL --region=<value> | CLOUDFRONT --region=us-east-1>
## Retrieve high-level information about a specific managed rule group
aws wafv2 describe-managed-rule-group --vendor-name <value> --name <value> --scope <REGIONAL --region=<value> | CLOUDFRONT --region=us-east-1> [--version-name <value>]
## Retrieve high-level information about all managed rule groups
aws wafv2 describe-all-managed-products --scope <REGIONAL --region=<value> | CLOUDFRONT --region=us-east-1>
## Retrieve high-level information about all managed rule groups from a specific vendor
aws wafv2 describe-managed-products-by-vendor --vendor-name <value> --scope <REGIONAL --region=<value> | CLOUDFRONT --region=us-east-1>

# IP sets #

## List the IP sets that are available in your AWS account
aws wafv2 list-ip-sets --scope <REGIONAL --region=<value> | CLOUDFRONT --region=us-east-1>
## Retrieve the specific IP set
aws wafv2 get-ip-set --name <value> --id <value> --scope <REGIONAL --region=<value> | CLOUDFRONT --region=us-east-1>
## Retrieve the keys that are currently being managed by a rate-based rule.
aws wafv2 get-rate-based-statement-managed-keys --scope <REGIONAL --region=<value> | CLOUDFRONT --region=us-east-1>\
--web-acl-name <value> --web-acl-id <value> --rule-name <value> [--rule-group-rule-name <value>]

# Regex pattern sets #

## List all the regex pattern sets that you manage
aws wafv2 list-regex-pattern-sets --scope <REGIONAL --region=<value> | CLOUDFRONT --region=us-east-1>
## Retrieves the specified regex pattern sets
aws wafv2 get-regex-pattern-set --name <value> --id <value> --scope <REGIONAL --region=<value> | CLOUDFRONT --region=us-east-1>

# API Keys #

## List API keys for the specified scope
aws wafv2 list-api-keys --scope <REGIONAL --region=<value> | CLOUDFRONT --region=us-east-1>
## Retrieve decrypted API key
aws wafv2 get-decrypted-api-key --scope <REGIONAL --region=<value> | CLOUDFRONT --region=us-east-1> --api-key <value>

# Logs #

## List of logging configurations (storage location of the logs)
aws wafv2 list-logging-configurations --scope <REGIONAL --region=<value> | CLOUDFRONT --region=us-east-1> [--log-scope <value>]
## Retrieve the logging configuration settings associated with a specific web ACL
aws wafv2 get-logging-configuration --resource-arn <value> [--log-scope <CUSTOMER | SECURITY_LAKE>] [--log-type <value>]

# Miscelaneous #

## Retrieve a list of the tags associated to the specified resource
aws wafv2 list-tags-for-resource resource-arn <value>

## Retrieve a sample of web requests that match a specified rule within a WebACL during a specified time range
aws wafv2 get-sampled-requests --web-acl-arn <value> --rule-metric-name <value> --time-window <value> --max-items <1-500> --scope <value>

## Obtains the web ACL capacity unit (WCU) requirements for a specified scope and ruleset
aws wafv2 check-capacity --scope <REGIONAL --region=<value> | CLOUDFRONT --region=us-east-1> --rules <value>

## List of available releases for the AWS WAFv2 mobile SDK
aws wafv2 list-mobile-sdk-releases --platform <IOS | ANDROID>
## Retrieves information for the specified mobile SDK release
aws wafv2 get-mobile-sdk-release --platform <value> --release-version <value>

```
## Sonraki SaldÄ±rÄ± / Atlatma

{% hint style="success" %}
SaldÄ±rganÄ±n bakÄ±ÅŸ aÃ§Ä±sÄ±ndan, bu hizmet saldÄ±rganÄ±n WAF korumalarÄ±nÄ± ve aÄŸ maruziyetlerini belirlemesine yardÄ±mcÄ± olabilir, bu da ona diÄŸer web sitelerini tehlikeye atmasÄ±na yardÄ±mcÄ± olabilir.

Ancak, bir saldÄ±rgan bu hizmeti de engellemek isteyebilir, bÃ¶ylece web siteleri WAF tarafÄ±ndan korunmaz.
{% endhint %}

Ã‡oÄŸu Silme ve GÃ¼ncelleme iÅŸleminde **kilit belirteci** saÄŸlamak gerekebilir. Bu belirteÃ§, kaynaklar Ã¼zerinde eÅŸ zamanlÄ± olarak gÃ¼ncelleme yapmaya Ã§alÄ±ÅŸan birden fazla kullanÄ±cÄ± veya iÅŸlem tarafÄ±ndan deÄŸiÅŸikliklerin kazara Ã¼zerine yazÄ±lmasÄ±nÄ± Ã¶nlemek iÃ§in kullanÄ±lÄ±r. Bu belirteci elde etmek iÃ§in ilgili kaynak Ã¼zerinde ilgili **listeleme** veya **alma** iÅŸlemlerini gerÃ§ekleÅŸtirebilirsiniz.

### **`wafv2:CreateRuleGroup`, `wafv2:UpdateRuleGroup`, `wafv2:DeleteRuleGroup`**

Bir saldÄ±rgan, etkilenen kaynaÄŸÄ±n gÃ¼venliÄŸini tehlikeye atabilir:

- Ã–rneÄŸin, meÅŸru IP adreslerinden gelen meÅŸru trafiÄŸi engelleyebilecek kural gruplarÄ± oluÅŸturmak ve bu durumda hizmet dÄ±ÅŸÄ± bÄ±rakma oluÅŸturabilir.
- Kural gruplarÄ±nÄ± gÃ¼ncelleyerek, Ã¶rneÄŸin **Engelle**'den **Ä°zin Ver**'e gibi eylemlerini deÄŸiÅŸtirebilir.
- Kritik gÃ¼venlik Ã¶nlemleri saÄŸlayan kural gruplarÄ±nÄ± silerek.
```bash
# Create Rule Group
aws wafv2 create-rule-group --name <value> --capacity <value> --visibility-config <value> \
--scope <REGIONAL --region=<value> | CLOUDFRONT --region=us-east-1> [--rules <value>] [--description <value>]
# Update Rule Group
aws wafv2 update-rule-group --name <value> --id <value> --visibility-config <value> --lock-token <value>\
--scope <REGIONAL --region=<value> | CLOUDFRONT --region=us-east-1> [--rules <value>] [--description <value>]
# Delete Rule Group
aws wafv2 delete-rule-group --name <value> --id <value> --lock-token <value> --scope <REGIONAL --region=<value> | CLOUDFRONT --region=us-east-1>
```
AÅŸaÄŸÄ±daki Ã¶rnekler, belirli IP adreslerinden gelen meÅŸru trafiÄŸi engelleyecek bir kural grubunu gÃ¶stermektedir:
```bash
aws wafv2 create-rule-group --name BlockLegitimateIPsRuleGroup --capacity 1 --visibility-config SampledRequestsEnabled=false,CloudWatchMetricsEnabled=false,MetricName=BlockLegitimateIPsRuleGroup --scope CLOUDFRONT --region us-east-1 --rules file://rule.json
```
**rule.json** dosyasÄ± ÅŸu ÅŸekilde gÃ¶rÃ¼necektir:
```json
[
{
"Name":"BlockLegitimateIPsRule",
"Priority":0,
"Statement": {
"IPSetReferenceStatement": {
"ARN": "arn:aws:wafv2:us-east-1:123456789012:global/ipset/legitIPv4/1a2b3c4d-1a2b-1a2b-1a2b-1a2b3c4d5e6f"
}
},
"Action":{
"Block":{}
},
"VisibilityConfig":{
"SampledRequestsEnabled":false,
"CloudWatchMetricsEnabled":false,
"MetricName":"BlockLegitimateIPsRule"
}
}
]
```
**Potansiyel Etki**: Yetkisiz eriÅŸim, veri sÄ±zÄ±ntÄ±larÄ± ve potansiyel DoS saldÄ±rÄ±larÄ±.

### **`wafv2:CreateWebACL`, `wafv2:UpdateWebACL`, `wafv2:DeleteWebACL`**

Bu izinlerle, bir saldÄ±rgan ÅŸunlarÄ± yapabilir:

- Yeni bir Web ACL oluÅŸturabilir, ya kÃ¶tÃ¼ niyetli trafiÄŸin geÃ§mesine izin veren kurallar ekler ya da meÅŸru trafiÄŸi engeller, bu da WAF'Ä± etkisiz hale getirir veya hizmet reddine neden olur.
- Mevcut Web ACL'leri gÃ¼ncelleyebilir, Ã¶nceden engellenen SQL enjeksiyonu veya cross-site scripting gibi saldÄ±rÄ±lara izin vermek iÃ§in kurallarÄ± deÄŸiÅŸtirebilir veya geÃ§erli istekleri engelleyerek normal trafik akÄ±ÅŸÄ±nÄ± bozabilir.
- Bir Web ACL'sini silebilir, etkilenen kaynaklarÄ± tamamen korumasÄ±z bÄ±rakarak geniÅŸ bir web saldÄ±rÄ±larÄ± yelpazesine maruz bÄ±rakabilir.

{% hint style="info" %}

BelirtilenÂ **WebACL**'yi yalnÄ±zcaÂ **ManagedByFirewallManager**Â false ise silebilirsiniz.

{% endhint %}
```bash
# Create Web ACL
aws wafv2 create-web-acl --name <value> --default-action <value> --visibility-config <value> \
--scope <REGIONAL --region=<value> | CLOUDFRONT --region=us-east-1> [--rules <value>] [--captcha-config <value>] [--description <value>]
# Update Web ACL
aws wafv2 update-web-acl --name <value> --id <value> --default-action <value> --visibility-config <value> --lock-token <value>\
--scope <REGIONAL --region=<value> | CLOUDFRONT --region=us-east-1> [--rules <value>] [--captcha-config <value>] [--description <value>]
# Delete Web ACL
aws wafv2 delete-web-acl --name <value> --id <value> --lock-token <value> --scope <REGIONAL --region=<value> | CLOUDFRONT --region=us-east-1>
```
**Orijinal Web ACL**:
```json
{
"WebACL": {
"Name": "AllowLegitimateIPsWebACL",
"Id": "1a2b3c4d-1a2b-1a2b-1a2b-1a2b3c4d5e6f",
"ARN": "arn:aws:wafv2:us-east-1:123456789012:regional/webacl/AllowLegitimateIPsWebACL/1a2b3c4d-1a2b-1a2b-1a2b-1a2b3c4d5e6f",
"DefaultAction": {
"Allow": {}
},
"Description": "",
"Rules": [
{
"Name": "AllowLegitimateIPsRule",
"Priority": 0,
"Statement": {
"IPSetReferenceStatement": {
"ARN": "arn:aws:wafv2:us-east-1:123456789012:regional/ipset/LegitimateIPv4/1a2b3c4d-1a2b-1a2b-1a2b-1a2b3c4d5e6f"
}
},
"Action": {
"Allow": {}
},
"VisibilityConfig": {
"SampledRequestsEnabled": false,
"CloudWatchMetricsEnabled": false,
"MetricName": "AllowLegitimateIPsRule"
}
}
],
"VisibilityConfig": {
"SampledRequestsEnabled": false,
"CloudWatchMetricsEnabled": false,
"MetricName": "AllowLegitimateIPsWebACL"
},
"Capacity": 1,
"ManagedByFirewallManager": false,
"LabelNamespace": "awswaf:123456789012:webacl:AllowLegitimateIPsWebACL:"
},
"LockToken": "1a2b3c4d-1a2b-1a2b-1a2b-1a2b3c4d5e6f"
}

```
Web ACL'yi gÃ¼ncelleme komutu:

```bash
aws waf update-web-acl --web-acl-id <value> --updates <value>
```
```json
aws wafv2 update-web-acl --name AllowLegitimateIPsWebACL --scope REGIONAL --id 1a2b3c4d-1a2b-1a2b-1a2b-1a2b3c4d5e6f --lock-token 1a2b3c4d-1a2b-1a2b-1a2b-1a2b3c4d5e6f --default-action Block={} --visibility-config SampledRequestsEnabled=false,CloudWatchMetricsEnabled=false,MetricName=AllowLegitimateIPsWebACL --rules file://rule.json --region us-east-1
```
Dosya **rule.json** ÅŸu ÅŸekilde gÃ¶rÃ¼necektir:
```json
[
{
"Name": "BlockLegitimateIPsRule",
"Priority": 0,
"Statement": {
"IPSetReferenceStatement": {
"ARN": "arn:aws:wafv2:us-east-1:123456789012:regional/ipset/LegitimateIPv4/1a2b3c4d-1a2b-1a2b-1a2b-1a2b3c4d5e6f"
}
},
"Action": {
"Block": {}
},
"VisibilityConfig": {
"SampledRequestsEnabled": false,
"CloudWatchMetricsEnabled": false,
"MetricName": "BlockLegitimateIPRule"
}
}
]
```
**Potansiyel Etki**: Yetkisiz eriÅŸim, veri sÄ±zÄ±ntÄ±larÄ± ve potansiyel DoS saldÄ±rÄ±larÄ±.

### **`wafv2:AssociateWebACL`, `wafv2:DisassociateWebACL`**

**`wafv2:AssociateWebACL`** izni, bir saldÄ±rganÄ±n web ACL'leri (EriÅŸim Kontrol Listeleri) kaynaklarla iliÅŸkilendirmesine izin verir, gÃ¼venlik kontrollerini atlayarak yetkisiz trafiÄŸin uygulamaya ulaÅŸmasÄ±na olanak tanÄ±r, bu da SQL enjeksiyonu veya cross-site scripting (XSS) gibi istismarlara yol aÃ§abilir. Benzer ÅŸekilde, **`wafv2:DisassociateWebACL`** izni ile saldÄ±rgan geÃ§ici olarak gÃ¼venlik Ã¶nlemlerini devre dÄ±ÅŸÄ± bÄ±rakabilir, kaynaklarÄ± algÄ±lanmadan zafiyetlere maruz bÄ±rakabilir.

Korunan kaynak tÃ¼rÃ¼ne baÄŸlÄ± olarak ek izinlere ihtiyaÃ§ duyulacaktÄ±r:

- **Ä°liÅŸkilendirme**
- apigateway:SetWebACL
- apprunner:AssociateWebAcl
- appsync:SetWebACL
- cognito-idp:AssociateWebACL
- ec2:AssociateVerifiedAccessInstanceWebAcl
- elasticloadbalancing:SetWebAcl
- **Ä°liÅŸkilendirmeyi KaldÄ±rma**
- apigateway:SetWebACL
- apprunner:DisassociateWebAcl
- appsync:SetWebACL
- cognito-idp:DisassociateWebACL
- ec2:DisassociateVerifiedAccessInstanceWebAcl
- elasticloadbalancing:SetWebAcl
```bash
# Associate
aws wafv2 associate-web-acl --web-acl-arn <value> --resource-arn <value>
# Disassociate
aws wafv2 disassociate-web-acl --resource-arn <value>
```
**Potansiyel Etki**: AWS WAF tarafÄ±ndan korunan AWS ortamlarÄ±nda gÃ¼venlik ihlali, artan istismar riski ve potansiyel hizmet kesintileri.

### **`wafv2:CreateIPSet`, `wafv2:UpdateIPSet`, `wafv2:DeleteIPSet`**

Bir saldÄ±rgan, AWS WAF tarafÄ±ndan yÃ¶netilen IP setlerini oluÅŸturabilir, gÃ¼ncelleÅŸtirebilir ve silebilir. Bu tehlikeli olabilir Ã§Ã¼nkÃ¼ kÃ¶tÃ¼ niyetli trafiÄŸi izin vermek iÃ§in yeni IP setleri oluÅŸturabilir, meÅŸru trafiÄŸi engellemek iÃ§in IP setlerini deÄŸiÅŸtirebilir, mevcut IP setlerini kÃ¶tÃ¼ niyetli IP adreslerini iÃ§erecek ÅŸekilde gÃ¼ncelleÅŸtirebilir, gÃ¼venilir IP adreslerini kaldÄ±rabilir veya kritik kaynaklarÄ± korumak amacÄ±yla oluÅŸturulan kritik IP setlerini silebilir.
```bash
# Create IP set
aws wafv2 create-ip-set --name <value> --ip-address-version <IPV4 | IPV6> --addresses <value> --scope <REGIONAL --region=<value> | CLOUDFRONT --region=us-east-1>
# Update IP set
aws wafv2 update-ip-set --name <value> --id <value> --addresses <value> --lock-token <value> --scope <REGIONAL --region=<value> | CLOUDFRONT --region=us-east-1>
# Delete IP set
aws wafv2 delete-ip-set --name <value> --id <value> --lock-token <value> --scope <REGIONAL --region=<value> | CLOUDFRONT --region=us-east-1>
```
AÅŸaÄŸÄ±daki Ã¶rnek, mevcut IP kÃ¼mesini istenen IP kÃ¼mesiyle **Ã¼zerine yazmanÄ±n** nasÄ±l yapÄ±ldÄ±ÄŸÄ±nÄ± gÃ¶sterir:
```bash
aws wafv2 update-ip-set --name LegitimateIPv4Set --id 1a2b3c4d-1a2b-1a2b-1a2b-1a2b3c4d5e6f --addresses 99.99.99.99/32 --lock-token 1a2b3c4d-1a2b-1a2b-1a2b-1a2b3c4d5e6f --scope CLOUDFRONT --region us-east-1
```
**Potansiyel Etki**: Yetkisiz eriÅŸim ve meÅŸru trafiÄŸin engellenmesi.

### **`wafv2:CreateRegexPatternSet`**, **`wafv2:UpdateRegexPatternSet`**, **`wafv2:DeleteRegexPatternSet`**

Bu izinlere sahip bir saldÄ±rgan, AWS WAF tarafÄ±ndan belirli desenlere dayalÄ± gelen trafiÄŸi kontrol etmek ve filtrelemek iÃ§in kullanÄ±lan dÃ¼zenli ifade desen setlerini manipÃ¼le edebilir.

- Yeni regex desenlerinin oluÅŸturulmasÄ±, bir saldÄ±rganÄ±n zararlÄ± iÃ§eriÄŸe izin vermesine yardÄ±mcÄ± olabilir
- Mevcut desenleri gÃ¼ncellemek, bir saldÄ±rganÄ±n gÃ¼venlik kurallarÄ±nÄ± atlamasÄ±na olanak tanÄ±r
- KÃ¶tÃ¼ amaÃ§lÄ± faaliyetleri engellemek iÃ§in tasarlanmÄ±ÅŸ desenleri silmek, bir saldÄ±rganÄ±n kÃ¶tÃ¼ amaÃ§lÄ± yÃ¼kleri gÃ¶ndermesine ve gÃ¼venlik Ã¶nlemlerini atlamasÄ±na neden olabilir.
```bash
# Create regex pattern set
aws wafv2 create-regex-pattern-set --name <value> --regular-expression-list <value> --scope <REGIONAL --region=<value> | CLOUDFRONT --region=us-east-1> [--description <value>]
# Update regex pattern set
aws wafv2 update-regex-pattern-set --name <value> --id <value> --regular-expression-list <value> --lock-token <value> --scope <REGIONAL --region=<value> | CLOUDFRONT --region=us-east-1>
# Delete regex pattern set
aws wafv2 delete-regex-pattern-set --name <value> --scope <REGIONAL --region=<value> | CLOUDFRONT --region=us-east-1> --id <value> --lock-token <value>
```
**Potansiyel Etki**: AWS WAF tarafÄ±ndan korunan hizmetler ve kaynaklar Ã¼zerindeki hassas verilerin ifÅŸa edilmesi veya hizmetlerin kesintiye uÄŸramasÄ± gibi kÃ¶tÃ¼ niyetli iÃ§eriklerin geÃ§mesine izin vererek gÃ¼venlik kontrollerini atlamak.

### **(`wavf2:PutLoggingConfiguration` &** `iam:CreateServiceLinkedRole`), **`wafv2:DeleteLoggingConfiguration`**

Bir saldÄ±rgan **`wafv2:DeleteLoggingConfiguration`** iznine sahipse belirtilen Web ACL'den gÃ¼nlÃ¼ÄŸe kayÄ±t konfigÃ¼rasyonunu kaldÄ±rabilir. Daha sonra, **`wavf2:PutLoggingConfiguration`** ve **`iam:CreateServiceLinkedRole`** izinleriyle, saldÄ±rgan, gÃ¼nlÃ¼ÄŸe kayÄ±t konfigÃ¼rasyonu oluÅŸturabilir veya deÄŸiÅŸtirebilir (bunu sildikten sonra) ve ya gÃ¼nlÃ¼ÄŸÃ¼ hiÃ§ kaydetmemek veya yetkisiz hedeflere yÃ¶nlendirmek iÃ§in, Ã¶rneÄŸin Amazon S3 kovalarÄ±, Amazon CloudWatch Logs gÃ¼nlÃ¼k grubu veya Amazon Kinesis Data Firehose.

OluÅŸturma sÃ¼recinde, hizmet otomatik olarak belirtilen gÃ¼nlÃ¼kleme hedefine kayÄ±tlarÄ±n yazÄ±lmasÄ±na izin vermek iÃ§in gerekli izinleri kurar:

- **Amazon CloudWatch Logs:** AWS WAF, belirlenen CloudWatch Logs gÃ¼nlÃ¼k grubunda bir kaynak politikasÄ± oluÅŸturur. Bu politika, AWS WAF'Ä±n gÃ¼nlÃ¼kleri gÃ¼nlÃ¼k grubuna yazmak iÃ§in gereken izinlere sahip olduÄŸundan emin olur.
- **Amazon S3 Kova:** AWS WAF, belirlenen S3 kovasÄ±nda bir kova politikasÄ± oluÅŸturur. Bu politika, AWS WAF'a belirtilen kovaya gÃ¼nlÃ¼kleri yÃ¼klemek iÃ§in gerekli izinleri verir.
- **Amazon Kinesis Data Firehose:** AWS WAF, Kinesis Data Firehose ile etkileÅŸim iÃ§in Ã¶zel bir hizmet baÄŸlantÄ±lÄ± rol oluÅŸturur. Bu rol, AWS WAF'Ä±n yapÄ±landÄ±rÄ±lmÄ±ÅŸ Firehose akÄ±ÅŸÄ±na gÃ¼nlÃ¼kleri iletebilmesine izin verir.

{% hint style="info" %}

Her web ACL iÃ§in yalnÄ±zca bir gÃ¼nlÃ¼kleme hedefi tanÄ±mlamak mÃ¼mkÃ¼ndÃ¼r.

{% endhint %}
```bash
# Put logging configuration
aws wafv2 put-logging-configuration --logging-configuration <value>
# Delete logging configuration
aws wafv2 delete-logging-configuration --resource-arn <value> [--log-scope <CUSTOMER | SECURITY_LAKE>] [--log-type <value>]
```
**Potansiyel Etki:** GÃ¼venlik olaylarÄ±na dair gÃ¶rÃ¼nÃ¼rlÃ¼ÄŸÃ¼ zorlaÅŸtÄ±rabilir, olay yanÄ±t sÃ¼recini engelleyebilir ve AWS WAF korumalÄ± ortamlarda gizli kÃ¶tÃ¼ niyetli faaliyetleri kolaylaÅŸtÄ±rabilir.

### **`wafv2:DeleteAPIKey`**

Bu izinlere sahip bir saldÄ±rgan, mevcut API anahtarlarÄ±nÄ± silebilir, CAPTCHA'yÄ± etkisiz hale getirebilir ve form gÃ¶nderimleri ve eriÅŸim kontrolleri gibi ona baÄŸlÄ± iÅŸlevselliÄŸi bozabilir. Bu CAPTCHA'nÄ±n uygulanmasÄ±na baÄŸlÄ± olarak, bu ya bir CAPTCHA atlatma ya da kaynakta hata yÃ¶netiminin dÃ¼zgÃ¼n ÅŸekilde ayarlanmamÄ±ÅŸ olmasÄ± durumunda bir DoS'a yol aÃ§abilir.
```bash
# Delete API key
aws wafv2 delete-api-key --api-key <value> --scope <REGIONAL --region=<value> | CLOUDFRONT --region=us-east-1>
```
**Potansiyel Etki**: CAPTCHA korumalarÄ±nÄ± devre dÄ±ÅŸÄ± bÄ±rakma veya uygulama iÅŸlevselliÄŸini bozma, gÃ¼venlik ihlallerine ve potansiyel veri hÄ±rsÄ±zlÄ±ÄŸÄ±na yol aÃ§abilir.

### **`wafv2:TagResource`,Â `wafv2:UntagResource`**

SaldÄ±rgan, Web ACL'leri, kural gruplarÄ±, IP setleri, regex desen setleri ve gÃ¼nlÃ¼kleme yapÄ±landÄ±rmalarÄ± gibi AWS WAFv2 kaynaklarÄ±ndan etiket ekleyebilir, deÄŸiÅŸtirebilir veya kaldÄ±rabilir.
```bash
# Tag
aws wafv2 tag-resource --resource-arn <value> --tags <value>
# Untag
aws wafv2 untag-resource --resource-arn <value> --tag-keys <value>
```
**Potansiyel Etki**: Kaynak deÄŸiÅŸtirme, bilgi sÄ±zdÄ±rma, maliyet manipÃ¼lasyonu ve operasyonel kesinti.

# Referanslar
* [https://www.citrusconsulting.com/aws-web-application-firewall-waf/#:~:text=Conditions%20allow%20you%20to%20specify,user%20via%20a%20web%20application](https://www.citrusconsulting.com/aws-web-application-firewall-waf/#:~:text=Conditions%20allow%20you%20to%20specify,user%20via%20a%20web%20application)
* [https://docs.aws.amazon.com/service-authorization/latest/reference/list_awswafv2.html](https://docs.aws.amazon.com/service-authorization/latest/reference/list_awswafv2.html)

<details>

<summary><strong>SÄ±fÄ±rdan kahraman olacak ÅŸekilde AWS hacklemeyi Ã¶ÄŸrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

HackTricks'Ä± desteklemenin diÄŸer yollarÄ±:

* **Åirketinizi HackTricks'te reklamÄ±nÄ± gÃ¶rmek istiyorsanÄ±z** veya **HackTricks'i PDF olarak indirmek istiyorsanÄ±z** [**ABONELÄ°K PLANLARI**]'na gÃ¶z atÄ±n(https://github.com/sponsors/carlospolop)!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) koleksiyonumuzu keÅŸfedin, Ã¶zel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family)
* **ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n veya bizi **Twitter** ğŸ¦ [**@hacktricks_live**](https://twitter.com/hacktricks_live)** adresinden takip edin.**
* **Hacking pÃ¼f noktalarÄ±nÄ±zÄ± paylaÅŸarak PR'lar gÃ¶ndererek** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na katkÄ±da bulunun.

</details>
