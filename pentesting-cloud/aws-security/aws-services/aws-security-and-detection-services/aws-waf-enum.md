# AWS - WAF Enum

{% hint style="success" %}
Leer & oefen AWS Hack:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Opleiding AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Leer & oefen GCP Hack: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Opleiding GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Ondersteun HackTricks</summary>

* Controleer die [**inskrywingsplanne**](https://github.com/sponsors/carlospolop)!
* **Sluit aan by die** üí¨ [**Discord-groep**](https://discord.gg/hRep4RUj7f) of die [**telegram-groep**](https://t.me/peass) of **volg** ons op **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Deel hacktruuks deur PR's in te dien by die** [**HackTricks**](https://github.com/carlospolop/hacktricks) en [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github-opslag.

</details>
{% endhint %}

# AWS WAF

AWS WAF is 'n **webtoepassingsmuur** wat ontwerp is om **webtoepassings of API's** teen verskeie webbedreigings te beskerm wat hul beskikbaarheid, veiligheid of hulpbrongebruik kan be√Ønvloed. Dit gee gebruikers die mag om inkomende verkeer te beheer deur **sekuriteitsre√´ls** op te stel wat tipiese aanvalvektore soos SQL-inspuiting of kruisskripsing mitigeer en ook deur aangepaste filterre√´ls te definieer.

## Sleutelkonsepte

### Web ACL (Toegangsbeheerlys)

'n Web ACL is 'n versameling re√´ls wat jy op jou webtoepassings of API's kan toepas. Wanneer jy 'n Web ACL met 'n hulpbron assosieer, ondersoek AWS WAF inkomende versoek gebaseer op die re√´ls wat in die Web ACL gedefinieer is en neem die gespesifiseerde aksies.

### Re√´lsgroep

'n Re√´lsgroep is 'n herbruikbare versameling re√´ls wat jy op verskeie Web ACL's kan toepas. Re√´lsgroepe help om konsekwente re√´lreeks oor verskillende webtoepassings of API's te bestuur en te handhaaf.

Elke re√´lsgroep het sy geassosieerde **kapasiteit**, wat help om die bedryfsbronne wat gebruik word om jou re√´ls, re√´lsgroepe en web ACL's uit te voer, te bereken en te beheer. Nadat sy waarde tydens skepping ingestel is, is dit nie moontlik om dit te wysig nie.

### Re√´l

'n Re√´l definieer 'n stel voorwaardes wat AWS WAF gebruik om inkomende webversoeke te ondersoek. Daar is twee hooftipes re√´ls:

1. **Gewone Re√´l**: Hierdie re√´l tipe gebruik gespesifiseerde voorwaardes om te bepaal of dit webversoeke moet toelaat, blokkeer of tel.
2. **Snelheidsgebaseerde Re√´l**: Tel versoek vanaf 'n spesifieke IP-adres oor 'n vyfminute-periode. Hier stel gebruikers 'n drempel vas, en as die aantal versoek vanaf 'n IP hierdie limiet binne vyf minute oorskry, word daaropvolgende versoek van daardie IP geblokkeer totdat die versoektempo onder die drempel daal. Die minimumdrempel vir snelheidsgebaseerde re√´ls is **2000 versoek**.

### Bestuurde Re√´ls

AWS WAF bied vooraf geconfigureerde, bestuurde re√´lreeks wat deur AWS en AWS Marketplace-verkopers onderhou word. Hierdie re√´lreeks bied beskerming teen algemene bedreigings en word gereeld opgedateer om nuwe kwesbaarhede aan te spreek.

### IP-stel

'n IP-stel is 'n lys IP-adresse of IP-adresreeks wat jy wil toelaat of blokkeer. IP-stelle vereenvoudig die proses om IP-gebaseerde re√´ls te bestuur.

### Regex-patroonstel

'n Regex-patroonstel bevat een of meer regul√™re uitdrukkings (regex) wat patrone definieer om in webversoeke te soek. Dit is nuttig vir meer komplekse koppelingscenarios, soos die filter van spesifieke karakterreeks.

### Slotteken

'n Slotteken word gebruik vir gelyktydige beheer wanneer updates aan WAF-hulpbronne gemaak word. Dit verseker dat veranderinge nie per ongeluk deur verskeie gebruikers of prosesse wat probeer om dieselfde hulpbron gelyktydig op te dateer, oorskryf word nie.

### API-sleutels

API-sleutels in AWS WAF word gebruik om versoek na sekere API-operasies te verifieer. Hierdie sleutels is versleutel en veilig bestuur om toegang te beheer en te verseker dat slegs gemagtigde gebruikers veranderinge aan WAF-konfigurasies kan maak.

- **Voorbeeld**: Integrasie van die CAPTCHA-API.

### Toestemmingsbeleid

'n Toestemmingsbeleid is 'n IAM-beleid wat spesifiseer wie aksies op AWS WAF-hulpbronne kan uitvoer. Deur toestemmings te definieer, kan jy toegang tot WAF-hulpbronne beheer en verseker dat slegs gemagtigde gebruikers konfigurasies kan skep, opdateer of verwyder.

### Reikwydte

Die reikwydteparameter in AWS WAF spesifiseer of die WAF-re√´ls en -konfigurasies van toepassing is op 'n streeksaansoek of 'n Amazon CloudFront-verspreiding.

- **REGIONAAL**: Van toepassing op streeksdienste soos Toepassingslaaibalansers (ALB), Amazon API Gateway REST API, AWS AppSync GraphQL API, Amazon Cognito-gebruikerspoel, AWS App Runner-diens en AWS Verified Access-instansie. Jy spesifiseer die AWS-streek waar hierdie hulpbronne gele√´ is.
- **CLOUDFRONT**: Van toepassing op Amazon CloudFront-verspreidings, wat globaal is. WAF-konfigurasies vir CloudFront word deur die `us-east-1`-streek bestuur, ongeag waar die inhoud bedien word.

## Sleutelkenmerke

### Moniteringskriteria (Voorwaardes)

**Voorwaardes** spesifiseer die elemente van inkomende HTTP/HTTPS-versoeke wat AWS WAF monitor, wat insluit XSS, geografiese ligging (GEO), IP-adresse, Groottebeperkings, SQL-inspuiting, en patrone (strings en regex-koppelings). Dit is belangrik om te let dat **versoeke wat op CloudFront-vlak beperk is op land nie WAF sal bereik nie**.

Elke AWS-rekening kan konfigureer:

- **100 voorwaardes** vir elke tipe (behalwe vir Regex, waar slegs **10 voorwaardes** toegelaat word, maar hierdie limiet kan verhoog word).
- **100 re√´ls** en **50 Web ACL's**.
- 'n maksimum van **5 snelheidsgebaseerde re√´ls**.
- 'n deurset van **10,000 versoek per sekonde** wanneer WAF ge√Ømplementeer word met 'n toepassingslaaibalanser.

### Re√´laksies

Aksies word aan elke re√´l toegewys, met opsies wat:

- **Toelaat**: Die versoek word na die toepaslike CloudFront-verspreiding of Toepassingslaaibalanser gestuur.
- **Blok**: Die versoek word onmiddellik be√´indig.
- **Tel**: Tel die versoek wat aan die re√´l se voorwaardes voldoen. Dit is nuttig vir re√´ltoetsing, om die re√´l se akkuraatheid te bevestig voordat dit na Toelaat of Blok ingestel word.
- **CAPTCHA en Uitdaging:** Dit word geverifieer dat die versoek nie van 'n robot afkomstig is deur CAPTCHA-raaisels en stille uitdagings te gebruik.

As 'n versoek nie aan enige re√´l binne die Web ACL voldoen nie, ondergaan dit die **standaardaksie** (Toelaat of Blok). Die volgorde van re√´luitvoering, gedefinieer binne 'n Web ACL, is noodsaaklik en volg tipies hierdie volgorde:

1. Toelaat Witlys-IP's.
2. Blokkeer Swartlys-IP's.
3. Blokkeer versoek wat enige nadelige handtekeninge pas.

### CloudWatch-integrasie

AWS WAF integreer met CloudWatch vir monitering, wat metriek soos ToegelateVersoeke, GeblokkeerdeVersoeke, GeteldeVersoeke, en VerbygegaanVersoeke bied. Hierdie metriek word standaard elke minuut gerapporteer en vir 'n tydperk van twee weke behou. 

## Enumerasie

Om met CloudFront-verspreidings te interaksie, moet jy die Streek US Oos (N. Virginia) spesifiseer:

- CLI - Spesifiseer die Streek US Oos wanneer jy die CloudFront-reikwydte gebruik:¬†`--reikwydte CLOUDFRONT --streek=us-east-1`¬†.
- API en SDK's - Vir alle oproepe, gebruik die Streek-eindpunt us-east-1.

Om met streeksdienste te interaksie, moet jy die streek spesifiseer:

- Voorbeeld met die streek Europa (Spanje): `--reikwydte REGIONAAL --streek=eu-south-2`
```bash
# Web ACLs #

## Retrieve a list of web access control lists (Web ACLs) available in your AWS account
aws wafv2 list-web-acls --scope <REGIONAL --region=<value> | CLOUDFRONT --region=us-east-1>
## Retrieve details about the specified Web ACL
aws wafv2 get-web-acl --name <value> --id <value> --scope <REGIONAL --region=<value> | CLOUDFRONT --region=us-east-1>

## Retrieve a list of resources associated with a specific web access control list (Web ACL)
aws wafv2 list-resources-for-web-acl --web-acl-arn <value> # Additional permissions needed depending on the protected resource type: cognito-idp:ListResourcesForWebACL, ec2:DescribeVerifiedAccessInstanceWebAclAssociations or apprunner:ListAssociatedServicesForWebAcl
## Retrieve the Web ACL associated with the specified AWS resource
aws wafv2 get-web-acl-for-resource --resource-arn <arn> # Additional permissions needed depending on the protected resource type: cognito-idp:GetWebACLForResource, ec2:GetVerifiedAccessInstanceWebAcl, wafv2:GetWebACL or apprunner:DescribeWebAclForService

# Rule groups #

## List of the rule groups available in your AWS account
aws wafv2 list-rule-groups --scope <REGIONAL --region=<value> | CLOUDFRONT --region=us-east-1>
## Retrieve the details of a specific rule group
aws wafv2 get-rule-group [--name <value>] [--id <value>] [--arn <value>] [--scope <REGIONAL --region=<value> | CLOUDFRONT --region=us-east-1>]
## Retrieve the IAM policy attached to the specified rule group
aws wafv2 get-permission-policy --resource-arn <rule-group-arn> # Just the owner of the Rule Group can do this operation

# Managed rule groups (by AWS or by a third-party) #

## List the managed rule groups that are available
aws wafv2 list-available-managed-rule-groups --scope <REGIONAL --region=<value> | CLOUDFRONT --region=us-east-1>
## List the available versions of the specified managed rule group
aws wafv2 list-available-managed-rule-group-versions --vendor-name <value> --name <value> --scope <REGIONAL --region=<value> | CLOUDFRONT --region=us-east-1>
## Retrieve high-level information about a specific managed rule group
aws wafv2 describe-managed-rule-group --vendor-name <value> --name <value> --scope <REGIONAL --region=<value> | CLOUDFRONT --region=us-east-1> [--version-name <value>]
## Retrieve high-level information about all managed rule groups
aws wafv2 describe-all-managed-products --scope <REGIONAL --region=<value> | CLOUDFRONT --region=us-east-1>
## Retrieve high-level information about all managed rule groups from a specific vendor
aws wafv2 describe-managed-products-by-vendor --vendor-name <value> --scope <REGIONAL --region=<value> | CLOUDFRONT --region=us-east-1>

# IP sets #

## List the IP sets that are available in your AWS account
aws wafv2 list-ip-sets --scope <REGIONAL --region=<value> | CLOUDFRONT --region=us-east-1>
## Retrieve the specific IP set
aws wafv2 get-ip-set --name <value> --id <value> --scope <REGIONAL --region=<value> | CLOUDFRONT --region=us-east-1>
## Retrieve the keys that are currently being managed by a rate-based rule.
aws wafv2 get-rate-based-statement-managed-keys --scope <REGIONAL --region=<value> | CLOUDFRONT --region=us-east-1>\
--web-acl-name <value> --web-acl-id <value> --rule-name <value> [--rule-group-rule-name <value>]

# Regex pattern sets #

## List all the regex pattern sets that you manage
aws wafv2 list-regex-pattern-sets --scope <REGIONAL --region=<value> | CLOUDFRONT --region=us-east-1>
## Retrieves the specified regex pattern sets
aws wafv2 get-regex-pattern-set --name <value> --id <value> --scope <REGIONAL --region=<value> | CLOUDFRONT --region=us-east-1>

# API Keys #

## List API keys for the specified scope
aws wafv2 list-api-keys --scope <REGIONAL --region=<value> | CLOUDFRONT --region=us-east-1>
## Retrieve decrypted API key
aws wafv2 get-decrypted-api-key --scope <REGIONAL --region=<value> | CLOUDFRONT --region=us-east-1> --api-key <value>

# Logs #

## List of logging configurations (storage location of the logs)
aws wafv2 list-logging-configurations --scope <REGIONAL --region=<value> | CLOUDFRONT --region=us-east-1> [--log-scope <value>]
## Retrieve the logging configuration settings associated with a specific web ACL
aws wafv2 get-logging-configuration --resource-arn <value> [--log-scope <CUSTOMER | SECURITY_LAKE>] [--log-type <value>]

# Miscelaneous #

## Retrieve a list of the tags associated to the specified resource
aws wafv2 list-tags-for-resource resource-arn <value>

## Retrieve a sample of web requests that match a specified rule within a WebACL during a specified time range
aws wafv2 get-sampled-requests --web-acl-arn <value> --rule-metric-name <value> --time-window <value> --max-items <1-500> --scope <value>

## Obtains the web ACL capacity unit (WCU) requirements for a specified scope and ruleset
aws wafv2 check-capacity --scope <REGIONAL --region=<value> | CLOUDFRONT --region=us-east-1> --rules <value>

## List of available releases for the AWS WAFv2 mobile SDK
aws wafv2 list-mobile-sdk-releases --platform <IOS | ANDROID>
## Retrieves information for the specified mobile SDK release
aws wafv2 get-mobile-sdk-release --platform <value> --release-version <value>

```
## Na-eksploitasi / Deurlooppad

{% hint style="success" %}
Vanuit 'n aanvaller se perspektief kan hierdie diens die aanvaller help om WAF-beskerming en netwerk blootstellings te identifiseer wat hom kan help om ander webwerwe te compromitteer.

Nietemin kan 'n aanvaller ook belangstel daarin om hierdie diens te ontwrig sodat die webwerwe nie deur die WAF beskerm word nie.
{% endhint %}

In baie van die Verwyder en Opdateer operasies sou dit nodig wees om die **sluitingsteken** te voorsien. Hierdie teken word gebruik vir gelyktydige beheer oor die hulpbronne, wat verseker dat veranderinge nie per ongeluk deur verskeie gebruikers of prosesse wat probeer om dieselfde hulpbron gelyktydig op te dateer, oorskryf word nie. Om hierdie teken te verkry, kan jy die ooreenstemmende **lys** of **kry** operasies oor die spesifieke hulpbron uitvoer.

### **`wafv2:SkepRe√´lGroep`, `wafv2:OpdateerRe√´lGroep`, `wafv2:VerwyderRe√´lGroep`**

'n Aanvaller sou die veiligheid van die geaffekteerde hulpbron kan compromitteer deur:

- Re√´l groepe te skep wat byvoorbeeld legitieme verkeer van legitieme IP-adresse kan blokkeer, wat 'n diensverlening kan veroorsaak.
- Re√´l groepe op te dateer, wat in staat sou wees om sy aksies te wysig, byvoorbeeld van **Blokkeer** na **Toelaat**.
- Re√´l groepe te verwyder wat kritieke veiligheidsmaatre√´ls bied.
```bash
# Create Rule Group
aws wafv2 create-rule-group --name <value> --capacity <value> --visibility-config <value> \
--scope <REGIONAL --region=<value> | CLOUDFRONT --region=us-east-1> [--rules <value>] [--description <value>]
# Update Rule Group
aws wafv2 update-rule-group --name <value> --id <value> --visibility-config <value> --lock-token <value>\
--scope <REGIONAL --region=<value> | CLOUDFRONT --region=us-east-1> [--rules <value>] [--description <value>]
# Delete Rule Group
aws wafv2 delete-rule-group --name <value> --id <value> --lock-token <value> --scope <REGIONAL --region=<value> | CLOUDFRONT --region=us-east-1>
```
Die volgende voorbeelde toon 'n reelgroep wat legitieme verkeer van spesifieke IP-adresse sou blokkeer:
```bash
aws wafv2 create-rule-group --name BlockLegitimateIPsRuleGroup --capacity 1 --visibility-config SampledRequestsEnabled=false,CloudWatchMetricsEnabled=false,MetricName=BlockLegitimateIPsRuleGroup --scope CLOUDFRONT --region us-east-1 --rules file://rule.json
```
Die **rule.json** l√™er sal lyk soos:
```json
[
{
"Name":"BlockLegitimateIPsRule",
"Priority":0,
"Statement": {
"IPSetReferenceStatement": {
"ARN": "arn:aws:wafv2:us-east-1:123456789012:global/ipset/legitIPv4/1a2b3c4d-1a2b-1a2b-1a2b-1a2b3c4d5e6f"
}
},
"Action":{
"Block":{}
},
"VisibilityConfig":{
"SampledRequestsEnabled":false,
"CloudWatchMetricsEnabled":false,
"MetricName":"BlockLegitimateIPsRule"
}
}
]
```
**Potensi√´le Impak**: Onbevoegde toegang, data-oortredings, en potensi√´le DoS-aanvalle.

### **`wafv2:CreateWebACL`, `wafv2:UpdateWebACL`, `wafv2:DeleteWebACL`**

Met hierdie regte, sal 'n aanvaller in staat wees om:

- 'n Nuwe Web ACL skep, wat reels invoer wat ofwel skadelike verkeer deurlaat of legitieme verkeer blokkeer, wat die WAF effektief nutteloos maak of 'n ontkenning van diens veroorsaak.
- Bestaande Web ACL's opdateer, waardeur hy re√´ls kan wysig om aanvalle soos SQL-inspuiting of kruissite-skripskryf toe te laat, wat voorheen geblokkeer was, of normale verkeersvloei kan ontwrig deur geldige versoek te blokkeer.
- 'n Web ACL verwyder, wat die geaffekteerde bronne heeltemal onbeskerm agterlaat, wat dit blootstel aan 'n wye reeks webaanvalle.

{% hint style="info" %}

Jy kan slegs die gespesifiseerde **WebACL** verwyder as **ManagedByFirewallManager** vals is.

{% endhint %}
```bash
# Create Web ACL
aws wafv2 create-web-acl --name <value> --default-action <value> --visibility-config <value> \
--scope <REGIONAL --region=<value> | CLOUDFRONT --region=us-east-1> [--rules <value>] [--captcha-config <value>] [--description <value>]
# Update Web ACL
aws wafv2 update-web-acl --name <value> --id <value> --default-action <value> --visibility-config <value> --lock-token <value>\
--scope <REGIONAL --region=<value> | CLOUDFRONT --region=us-east-1> [--rules <value>] [--captcha-config <value>] [--description <value>]
# Delete Web ACL
aws wafv2 delete-web-acl --name <value> --id <value> --lock-token <value> --scope <REGIONAL --region=<value> | CLOUDFRONT --region=us-east-1>
```
Die volgende voorbeelde toon hoe om 'n Web ACL by te werk om die legitieme verkeer vanaf 'n spesifieke IP-stel te blokkeer. As die oorsprong IP nie ooreenstem met enige van daardie IP's nie, sal die verstekaksie dit ook blokkeer, wat 'n DoS veroorsaak.

**Oorspronklike Web ACL**:
```json
{
"WebACL": {
"Name": "AllowLegitimateIPsWebACL",
"Id": "1a2b3c4d-1a2b-1a2b-1a2b-1a2b3c4d5e6f",
"ARN": "arn:aws:wafv2:us-east-1:123456789012:regional/webacl/AllowLegitimateIPsWebACL/1a2b3c4d-1a2b-1a2b-1a2b-1a2b3c4d5e6f",
"DefaultAction": {
"Allow": {}
},
"Description": "",
"Rules": [
{
"Name": "AllowLegitimateIPsRule",
"Priority": 0,
"Statement": {
"IPSetReferenceStatement": {
"ARN": "arn:aws:wafv2:us-east-1:123456789012:regional/ipset/LegitimateIPv4/1a2b3c4d-1a2b-1a2b-1a2b-1a2b3c4d5e6f"
}
},
"Action": {
"Allow": {}
},
"VisibilityConfig": {
"SampledRequestsEnabled": false,
"CloudWatchMetricsEnabled": false,
"MetricName": "AllowLegitimateIPsRule"
}
}
],
"VisibilityConfig": {
"SampledRequestsEnabled": false,
"CloudWatchMetricsEnabled": false,
"MetricName": "AllowLegitimateIPsWebACL"
},
"Capacity": 1,
"ManagedByFirewallManager": false,
"LabelNamespace": "awswaf:123456789012:webacl:AllowLegitimateIPsWebACL:"
},
"LockToken": "1a2b3c4d-1a2b-1a2b-1a2b-1a2b3c4d5e6f"
}

```
### Command to update the Web ACL:

### Opdrag om die Web ACL op te dateer:
```json
aws wafv2 update-web-acl --name AllowLegitimateIPsWebACL --scope REGIONAL --id 1a2b3c4d-1a2b-1a2b-1a2b-1a2b3c4d5e6f --lock-token 1a2b3c4d-1a2b-1a2b-1a2b-1a2b3c4d5e6f --default-action Block={} --visibility-config SampledRequestsEnabled=false,CloudWatchMetricsEnabled=false,MetricName=AllowLegitimateIPsWebACL --rules file://rule.json --region us-east-1
```
Die **rule.json** l√™er sou lyk soos:
```json
[
{
"Name": "BlockLegitimateIPsRule",
"Priority": 0,
"Statement": {
"IPSetReferenceStatement": {
"ARN": "arn:aws:wafv2:us-east-1:123456789012:regional/ipset/LegitimateIPv4/1a2b3c4d-1a2b-1a2b-1a2b-1a2b3c4d5e6f"
}
},
"Action": {
"Block": {}
},
"VisibilityConfig": {
"SampledRequestsEnabled": false,
"CloudWatchMetricsEnabled": false,
"MetricName": "BlockLegitimateIPRule"
}
}
]
```
**Potensi√´le Impak**: Onbevoegde toegang, data-oortredings, en potensi√´le DoS-aanvalle.

### **`wafv2:AssociateWebACL`, `wafv2:DisassociateWebACL`**

Die **`wafv2:AssociateWebACL`** toestemming sou 'n aanvaller toelaat om web ACL's (Toegangsbeheerlyste) met bronne te assosieer, wat hulle in staat sou stel om sekuriteitskontroles te omseil, onbevoegde verkeer toe te laat om die aansoek te bereik, wat moontlik kan lei tot uitbuitings soos SQL-inspuiting of kruissite-skripsing (XSS). Omgekeerd, met die **`wafv2:DisassociateWebACL`** toestemming, sou die aanvaller sekuriteitsbeskerming tydelik kon deaktiveer, wat die bronne aan kwesbaarhede blootstel sonder opsporing.

Die addisionele toestemmings sal benodig word afhangende van die beskermde brontipe:

- **Assosieer**
- apigateway:SetWebACL
- apprunner:AssociateWebAcl
- appsync:SetWebACL
- cognito-idp:AssociateWebACL
- ec2:AssociateVerifiedAccessInstanceWebAcl
- elasticloadbalancing:SetWebAcl
- **Dissosieer**
- apigateway:SetWebACL
- apprunner:DisassociateWebAcl
- appsync:SetWebACL
- cognito-idp:DisassociateWebACL
- ec2:DisassociateVerifiedAccessInstanceWebAcl
- elasticloadbalancing:SetWebAcl
```bash
# Associate
aws wafv2 associate-web-acl --web-acl-arn <value> --resource-arn <value>
# Disassociate
aws wafv2 disassociate-web-acl --resource-arn <value>
```
**Potensi√´le Impak**: Kompromittering van hulpbronne sekerheid, verhoogde risiko van uitbuiting, en potensi√´le diens-onderbrekings binne AWS-omgewings beskerm deur AWS WAF.

### **`wafv2:SkepIPStel`, `wafv2:WerkByIPStel`, `wafv2:VerwyderIPStel`**

'n Aanvaller sou in staat wees om die IP-stelle wat deur AWS WAF bestuur word, te skep, by te werk en te verwyder. Dit kan gevaarlik wees aangesien dit nuwe IP-stelle kan skep om skadelike verkeer toe te laat, IP-stelle kan wysig om legitieme verkeer te blokkeer, bestaande IP-stelle kan opdateer om skadelike IP-adresse in te sluit, vertroude IP-adresse kan verwyder of kritieke IP-stelle kan verwyder wat bedoel is om kritieke hulpbronne te beskerm.
```bash
# Create IP set
aws wafv2 create-ip-set --name <value> --ip-address-version <IPV4 | IPV6> --addresses <value> --scope <REGIONAL --region=<value> | CLOUDFRONT --region=us-east-1>
# Update IP set
aws wafv2 update-ip-set --name <value> --id <value> --addresses <value> --lock-token <value> --scope <REGIONAL --region=<value> | CLOUDFRONT --region=us-east-1>
# Delete IP set
aws wafv2 delete-ip-set --name <value> --id <value> --lock-token <value> --scope <REGIONAL --region=<value> | CLOUDFRONT --region=us-east-1>
```
Die volgende voorbeeld wys hoe om die bestaande IP-stel te **owerwrite met die gewenste IP-stel**:
```bash
aws wafv2 update-ip-set --name LegitimateIPv4Set --id 1a2b3c4d-1a2b-1a2b-1a2b-1a2b3c4d5e6f --addresses 99.99.99.99/32 --lock-token 1a2b3c4d-1a2b-1a2b-1a2b-1a2b3c4d5e6f --scope CLOUDFRONT --region us-east-1
```
**Potensi√´le Impak**: Onbevoegde toegang en blokkering van legitieme verkeer.

### **`wafv2:CreateRegexPatternSet`**, **`wafv2:UpdateRegexPatternSet`**, **`wafv2:DeleteRegexPatternSet`**

'n Aanvaller met hierdie regte sal in staat wees om die regul√™re uitdrukkingspatroonstelle wat deur AWS WAF gebruik word om inkomende verkeer te beheer en te filter op grond van spesifieke patrone, te manipuleer.

- Die skep van nuwe regex-patrone sal 'n aanvaller help om skadelike inhoud toe te laat
- Deur die bestaande patrone op te dateer, sou 'n aanvaller sekuriteitsre√´ls kon omseil
- Die verwydering van patrone wat ontwerp is om skadelike aktiwiteite te blokkeer, kan 'n aanvaller lei om skadelike lading te stuur en die sekuriteitsmaatre√´ls te omseil.
```bash
# Create regex pattern set
aws wafv2 create-regex-pattern-set --name <value> --regular-expression-list <value> --scope <REGIONAL --region=<value> | CLOUDFRONT --region=us-east-1> [--description <value>]
# Update regex pattern set
aws wafv2 update-regex-pattern-set --name <value> --id <value> --regular-expression-list <value> --lock-token <value> --scope <REGIONAL --region=<value> | CLOUDFRONT --region=us-east-1>
# Delete regex pattern set
aws wafv2 delete-regex-pattern-set --name <value> --scope <REGIONAL --region=<value> | CLOUDFRONT --region=us-east-1> --id <value> --lock-token <value>
```
**Potensi√´le Impak**: Omgang sekuriteitsbeheer, wat kwaadwillige inhoud toelaat en moontlik sensitiewe data blootstel of dienste en bronne wat deur AWS WAF beskerm word, ontwrig.

### **(`wavf2:PutLoggingConfiguration` &** `iam:CreateServiceLinkedRole`), **`wafv2:DeleteLoggingConfiguration`**

'n Aanvaller met die **`wafv2:DeleteLoggingConfiguration`** sou die logging konfigurasie van die gespesifiseerde Web ACL kan verwyder. Daarna, met die **`wavf2:PutLoggingConfiguration`** en **`iam:CreateServiceLinkedRole`** toestemmings, sou 'n aanvaller die logging konfigurasies kon skep of vervang (nadat dit verwyder is) om √≥f logging heeltemal te voorkom √≥f logboeke na ongemagtigde bestemmings te stuur, soos Amazon S3 emmers, Amazon CloudWatch Logs log groep of 'n Amazon Kinesis Data Firehose onder beheer.

Tydens die skeppingsproses stel die diens outomaties die nodige toestemmings op om toe te laat dat logboeke na die gespesifiseerde logging-bestemming geskryf kan word:

- **Amazon CloudWatch Logs:** AWS WAF skep 'n hulpbronbeleid op die aangewese CloudWatch Logs log groep. Hierdie beleid verseker dat AWS WAF die nodige toestemmings het om logboeke na die log groep te skryf.
- **Amazon S3 Emmers:** AWS WAF skep 'n emmerbeleid op die aangewese S3 emmer. Hierdie beleid verleen AWS WAF die nodige toestemmings om logboeke na die gespesifiseerde emmer te laai.
- **Amazon Kinesis Data Firehose:** AWS WAF skep 'n diensgekoppelde rol spesifiek vir interaksie met Kinesis Data Firehose. Hierdie rol laat AWS WAF toe om logboeke na die gekonfigureerde Firehose stroom te stuur.

{% hint style="info" %}

Dit is moontlik om slegs een logging-bestemming per web ACL te definieer.

{% endhint %}
```bash
# Put logging configuration
aws wafv2 put-logging-configuration --logging-configuration <value>
# Delete logging configuration
aws wafv2 delete-logging-configuration --resource-arn <value> [--log-scope <CUSTOMER | SECURITY_LAKE>] [--log-type <value>]
```
**Potensi√´le Impak:** Verduister sigbaarheid in sekuriteitsgebeure, bemoeilik die insidentreaksieproses, en fasiliteer verborge skadelike aktiwiteite binne AWS WAF-beskermde omgewings.

### **`wafv2:DeleteAPIKey`**

'n Aanvaller met hierdie regte sal in staat wees om bestaande API-sleutels te verwyder, wat die CAPTCHA ondoeltreffend maak en die funksionaliteit wat daarop staatmaak, soos vormindiening en toegangsbeheer, ontwrig. Afhangende van die implementering van hierdie CAPTCHA, kan dit lei tot √≥f 'n CAPTCHA-omleiding √≥f tot 'n DoS as die foutbestuur nie behoorlik ingestel is in die hulpbron nie.
```bash
# Delete API key
aws wafv2 delete-api-key --api-key <value> --scope <REGIONAL --region=<value> | CLOUDFRONT --region=us-east-1>
```
**Potensi√´le Impak**: Deaktiveer CAPTCHA-beskerming of ontwrig toepassingsfunksionaliteit, wat kan lei tot sekuriteitskendings en potensi√´le datadiefstal.

### **`wafv2:TagResource`,¬†`wafv2:UntagResource`**

'n Aanvaller sou in staat wees om etikette by te voeg, te wysig, of te verwyder van AWS WAFv2-bronne, soos Web ACL's, re√´l groepe, IP-stelle, regex-patroon stelle, en logkonfigurasies.
```bash
# Tag
aws wafv2 tag-resource --resource-arn <value> --tags <value>
# Untag
aws wafv2 untag-resource --resource-arn <value> --tag-keys <value>
```
**Potensi√´le Impak**: Bronmanipulasie, informasie lekkasie, koste manipulasie en operasionele ontwrigting.

# Verwysings
* [https://www.citrusconsulting.com/aws-web-application-firewall-waf/#:~:text=Conditions%20allow%20you%20to%20specify,user%20via%20a%20web%20application](https://www.citrusconsulting.com/aws-web-application-firewall-waf/#:~:text=Conditions%20allow%20you%20to%20specify,user%20via%20a%20web%20application)
* [https://docs.aws.amazon.com/service-authorization/latest/reference/list_awswafv2.html](https://docs.aws.amazon.com/service-authorization/latest/reference/list_awswafv2.html)

{% hint style="success" %}
Leer & oefen AWS Hack:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Opleiding AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Leer & oefen GCP Hack: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Opleiding GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Ondersteun HackTricks</summary>

* Kontroleer die [**inskrywingsplanne**](https://github.com/sponsors/carlospolop)!
* **Sluit aan by die** üí¨ [**Discord groep**](https://discord.gg/hRep4RUj7f) of die [**telegram groep**](https://t.me/peass) of **volg** ons op **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Deel hacktruuks deur PRs in te dien by die** [**HackTricks**](https://github.com/carlospolop/hacktricks) en [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
