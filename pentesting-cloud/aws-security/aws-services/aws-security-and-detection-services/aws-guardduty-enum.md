# AWS - GuardDuty Enum

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## GuardDuty

Î£ÏÎ¼Ï†Ï‰Î½Î± Î¼Îµ Ï„Î± [**docs**](https://aws.amazon.com/guardduty/features/): Î¤Î¿ GuardDuty ÏƒÏ…Î½Î´Ï…Î¬Î¶ÎµÎ¹ **Î¼Î·Ï‡Î±Î½Î¹ÎºÎ® Î¼Î¬Î¸Î·ÏƒÎ·, Î±Î½Î¯Ï‡Î½ÎµÏ…ÏƒÎ· Î±Î½Ï‰Î¼Î±Î»Î¹ÏÎ½, Ï€Î±ÏÎ±ÎºÎ¿Î»Î¿ÏÎ¸Î·ÏƒÎ· Î´Î¹ÎºÏ„ÏÎ¿Ï… ÎºÎ±Î¹ Î±Î½Î±ÎºÎ¬Î»Ï…ÏˆÎ· ÎºÎ±ÎºÏŒÎ²Î¿Ï…Î»Ï‰Î½ Î±ÏÏ‡ÎµÎ¯Ï‰Î½**, Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÏÎ½Ï„Î±Ï‚ Ï„ÏŒÏƒÎ¿ Ï„Î¿ AWS ÏŒÏƒÎ¿ ÎºÎ±Î¹ ÎºÎ¿ÏÏ…Ï†Î±Î¯ÎµÏ‚ Ï€Î·Î³Î­Ï‚ Ï„ÏÎ¯Ï„Ï‰Î½ Î³Î¹Î± Î½Î± Î²Î¿Î·Î¸Î®ÏƒÎµÎ¹ ÏƒÏ„Î·Î½ Ï€ÏÎ¿ÏƒÏ„Î±ÏƒÎ¯Î± Ï„Ï‰Î½ Ï†Î¿ÏÏ„Î¯Ï‰Î½ ÎµÏÎ³Î±ÏƒÎ¯Î±Ï‚ ÎºÎ±Î¹ Ï„Ï‰Î½ Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½ ÏƒÏ„Î¿ AWS. Î¤Î¿ GuardDuty ÎµÎ¯Î½Î±Î¹ Î¹ÎºÎ±Î½ÏŒ Î½Î± Î±Î½Î±Î»ÏÎµÎ¹ Î´ÎµÎºÎ¬Î´ÎµÏ‚ Î´Î¹ÏƒÎµÎºÎ±Ï„Î¿Î¼Î¼ÏÏÎ¹Î± Î³ÎµÎ³Î¿Î½ÏŒÏ„Î± ÏƒÎµ Ï€Î¿Î»Î»Î­Ï‚ Ï€Î·Î³Î­Ï‚ Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½ AWS, ÏŒÏ€Ï‰Ï‚ Ï„Î± Î±ÏÏ‡ÎµÎ¯Î± ÎºÎ±Ï„Î±Î³ÏÎ±Ï†Î®Ï‚ Î³ÎµÎ³Î¿Î½ÏŒÏ„Ï‰Î½ AWS CloudTrail, Ï„Î± Î±ÏÏ‡ÎµÎ¯Î± ÎºÎ±Ï„Î±Î³ÏÎ±Ï†Î®Ï‚ ÏÎ¿Î®Ï‚ Amazon Virtual Private Cloud (VPC), Ï„Î± Î±ÏÏ‡ÎµÎ¯Î± ÎºÎ±Ï„Î±Î³ÏÎ±Ï†Î®Ï‚ ÎµÎ»Î­Î³Ï‡Î¿Ï… ÎºÎ±Î¹ ÏƒÏ…ÏƒÏ„Î®Î¼Î±Ï„Î¿Ï‚ Amazon Elastic Kubernetes Service (EKS) ÎºÎ±Î¹ Ï„Î± Î±ÏÏ‡ÎµÎ¯Î± ÎºÎ±Ï„Î±Î³ÏÎ±Ï†Î®Ï‚ ÎµÏÏ‰Ï„Î·Î¼Î¬Ï„Ï‰Î½ DNS.

Î¤Î¿ Amazon GuardDuty **ÎµÎ½Ï„Î¿Ï€Î¯Î¶ÎµÎ¹ Î±ÏƒÏ…Î½Î®Î¸Î¹ÏƒÏ„Î· Î´ÏÎ±ÏƒÏ„Î·ÏÎ¹ÏŒÏ„Î·Ï„Î± ÏƒÏ„Î¿Ï…Ï‚ Î»Î¿Î³Î±ÏÎ¹Î±ÏƒÎ¼Î¿ÏÏ‚ ÏƒÎ±Ï‚**, Î±Î½Î±Î»ÏÎµÎ¹ Ï„Î· **ÏƒÏ‡ÎµÏ„Î¹ÎºÏŒÏ„Î·Ï„Î± Î±ÏƒÏ†Î±Î»ÎµÎ¯Î±Ï‚** Ï„Î·Ï‚ Î´ÏÎ±ÏƒÏ„Î·ÏÎ¹ÏŒÏ„Î·Ï„Î±Ï‚ ÎºÎ±Î¹ Ï€Î±ÏÎ­Ï‡ÎµÎ¹ Ï„Î¿ **Ï€Î»Î±Î¯ÏƒÎ¹Î¿** ÏƒÏ„Î¿ Î¿Ï€Î¿Î¯Î¿ ÎºÎ»Î®Î¸Î·ÎºÎµ. Î‘Ï…Ï„ÏŒ ÎµÏ€Î¹Ï„ÏÎ­Ï€ÎµÎ¹ ÏƒÎµ Î­Î½Î±Î½ Î±Î½Ï„Î±Ï€Î¿ÎºÏÎ¹Ï„Î® Î½Î± ÎºÎ±Î¸Î¿ÏÎ¯ÏƒÎµÎ¹ Î±Î½ Î¸Î± Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± Î±Ï†Î¹ÎµÏÏÏƒÎµÎ¹ Ï‡ÏÏŒÎ½Î¿ Î³Î¹Î± Ï€ÎµÏÎ±Î¹Ï„Î­ÏÏ‰ Î­ÏÎµÏ…Î½Î±.

ÎŸÎ¹ ÎµÎ¹Î´Î¿Ï€Î¿Î¹Î®ÏƒÎµÎ¹Ï‚ **ÎµÎ¼Ï†Î±Î½Î¯Î¶Î¿Î½Ï„Î±Î¹ ÏƒÏ„Î·Î½ ÎºÎ¿Î½ÏƒÏŒÎ»Î± GuardDuty (90 Î·Î¼Î­ÏÎµÏ‚)** ÎºÎ±Î¹ ÏƒÏ„Î± CloudWatch Events.

{% hint style="warning" %}
ÎŒÏ„Î±Î½ Î­Î½Î±Ï‚ Ï‡ÏÎ®ÏƒÏ„Î·Ï‚ **Î±Ï€ÎµÎ½ÎµÏÎ³Î¿Ï€Î¿Î¹Î®ÏƒÎµÎ¹ Ï„Î¿ GuardDuty**, Î¸Î± ÏƒÏ„Î±Î¼Î±Ï„Î®ÏƒÎµÎ¹ Î½Î± Ï€Î±ÏÎ±ÎºÎ¿Î»Î¿Ï…Î¸ÎµÎ¯ Ï„Î¿ Ï€ÎµÏÎ¹Î²Î¬Î»Î»Î¿Î½ AWS ÏƒÎ±Ï‚ ÎºÎ±Î¹ Î´ÎµÎ½ Î¸Î± Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î®ÏƒÎµÎ¹ ÎºÎ±Î¸ÏŒÎ»Î¿Ï… Î½Î­ÎµÏ‚ ÎµÏ…ÏÎ®Î¼Î±Ï„Î±, ÎºÎ±Î¹ Ï„Î± **Ï…Ï€Î¬ÏÏ‡Î¿Î½Ï„Î± ÎµÏ…ÏÎ®Î¼Î±Ï„Î± Î¸Î± Ï‡Î±Î¸Î¿ÏÎ½**.\
Î‘Î½ Ï„Î¿ ÏƒÏ„Î±Î¼Î±Ï„Î®ÏƒÎµÏ„Îµ Î±Ï€Î»ÏÏ‚, Ï„Î± Ï…Ï€Î¬ÏÏ‡Î¿Î½Ï„Î± ÎµÏ…ÏÎ®Î¼Î±Ï„Î± Î¸Î± Ï€Î±ÏÎ±Î¼ÎµÎ¯Î½Î¿Ï…Î½.
{% endhint %}

### Findings Example

* **Reconnaissance**: Î”ÏÎ±ÏƒÏ„Î·ÏÎ¹ÏŒÏ„Î·Ï„Î± Ï€Î¿Ï… Ï…Ï€Î¿Î´Î·Î»ÏÎ½ÎµÎ¹ Î±Î½Î±Î³Î½ÏÏÎ¹ÏƒÎ· Î±Ï€ÏŒ Î­Î½Î±Î½ ÎµÏ€Î¹Ï„Î¹Î¸Î­Î¼ÎµÎ½Î¿, ÏŒÏ€Ï‰Ï‚ **Î±ÏƒÏ…Î½Î®Î¸Î¹ÏƒÏ„Î· Î´ÏÎ±ÏƒÏ„Î·ÏÎ¹ÏŒÏ„Î·Ï„Î± API**, ÏÏ€Î¿Ï€Ï„ÎµÏ‚ Ï€ÏÎ¿ÏƒÏ€Î¬Î¸ÎµÎ¹ÎµÏ‚ **ÏƒÏÎ½Î´ÎµÏƒÎ·Ï‚** ÏƒÎµ Î²Î¬ÏƒÎ· Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½, ÎµÏƒÏ‰Ï„ÎµÏÎ¹ÎºÎ® ÏƒÎ¬ÏÏ‰ÏƒÎ· **Î¸Ï…ÏÏÎ½** VPC, Î±ÏƒÏ…Î½Î®Î¸Î¹ÏƒÏ„Î¿Î¹ Ï„ÏÏ€Î¿Î¹ Î±Ï€Î¿Ï„Ï…Ï‡Î·Î¼Î­Î½Ï‰Î½ Î±Î¹Ï„Î·Î¼Î¬Ï„Ï‰Î½ ÏƒÏÎ½Î´ÎµÏƒÎ·Ï‚ Î® ÏƒÎ¬ÏÏ‰ÏƒÎ· Î¸Ï…ÏÏÎ½ Î±Ï€ÏŒ Î³Î½Ï‰ÏƒÏ„Î® ÎºÎ±ÎºÎ® IP.
* **Instance compromise**: Î”ÏÎ±ÏƒÏ„Î·ÏÎ¹ÏŒÏ„Î·Ï„Î± Ï€Î¿Ï… Ï…Ï€Î¿Î´Î·Î»ÏÎ½ÎµÎ¹ Ï€Î±ÏÎ±Î²Î¯Î±ÏƒÎ· Î¼Î¹Î±Ï‚ Ï€Î±ÏÎ¿Ï…ÏƒÎ¯Î±Ï‚, ÏŒÏ€Ï‰Ï‚ **ÎµÎ¾ÏŒÏÏ…Î¾Î· ÎºÏÏ…Ï€Ï„Î¿Î½Î¿Î¼Î¹ÏƒÎ¼Î¬Ï„Ï‰Î½, Î´ÏÎ±ÏƒÏ„Î·ÏÎ¹ÏŒÏ„Î·Ï„Î± backdoor command and control (C\&C)**, ÎºÎ±ÎºÏŒÎ²Î¿Ï…Î»Î¿ Î»Î¿Î³Î¹ÏƒÎ¼Î¹ÎºÏŒ Ï€Î¿Ï… Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÎµÎ¯ Î±Î»Î³Î¿ÏÎ¯Î¸Î¼Î¿Ï…Ï‚ Î³ÎµÎ½Î½Î®Ï„ÏÎ¹Î±Ï‚ Ï„Î¿Î¼Î­Ï‰Î½ (DGA), Î´ÏÎ±ÏƒÏ„Î·ÏÎ¹ÏŒÏ„Î·Ï„Î± Î¬ÏÎ½Î·ÏƒÎ·Ï‚ Ï…Ï€Î·ÏÎµÏƒÎ¯Î±Ï‚ ÎµÎ¾ÏŒÎ´Î¿Ï…, Î±ÏƒÏ…Î½Î®Î¸Î¹ÏƒÏ„Î± **Ï…ÏˆÎ·Î»ÏŒÏ‚ ÏŒÎ³ÎºÎ¿Ï‚** Î´Î¹ÎºÏ„Ï…Î±ÎºÎ®Ï‚ ÎºÎ¯Î½Î·ÏƒÎ·Ï‚, Î±ÏƒÏ…Î½Î®Î¸Î¹ÏƒÏ„Î¿Î¹ Î´Î¹ÎºÏ„Ï…Î±ÎºÎ¿Î¯ Ï€ÏÏ‰Ï„ÏŒÎºÎ¿Î»Î»Î¿Î¹, ÎµÏ€Î¹ÎºÎ¿Î¹Î½Ï‰Î½Î¯Î± ÎµÎ¾ÏŒÎ´Î¿Ï… Ï€Î±ÏÎ¿Ï…ÏƒÎ¯Î±Ï‚ Î¼Îµ Î³Î½Ï‰ÏƒÏ„Î® ÎºÎ±ÎºÏŒÎ²Î¿Ï…Î»Î· IP, Ï€ÏÎ¿ÏƒÏ‰ÏÎ¹Î½Î­Ï‚ Î´Î¹Î±Ï€Î¹ÏƒÏ„ÎµÏÏƒÎµÎ¹Ï‚ Amazon EC2 Ï€Î¿Ï… Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î¿ÏÎ½Ï„Î±Î¹ Î±Ï€ÏŒ Î¼Î¹Î± ÎµÎ¾Ï‰Ï„ÎµÏÎ¹ÎºÎ® Î´Î¹ÎµÏÎ¸Ï…Î½ÏƒÎ· IP ÎºÎ±Î¹ ÎµÎ¾Î±Î³Ï‰Î³Î® Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½ Î¼Î­ÏƒÏ‰ DNS.
* **Account compromise**: ÎšÎ¿Î¹Î½Î¬ Î¼Î¿Ï„Î¯Î²Î± Ï€Î¿Ï… Ï…Ï€Î¿Î´Î·Î»ÏÎ½Î¿Ï…Î½ Ï€Î±ÏÎ±Î²Î¯Î±ÏƒÎ· Î»Î¿Î³Î±ÏÎ¹Î±ÏƒÎ¼Î¿Ï Ï€ÎµÏÎ¹Î»Î±Î¼Î²Î¬Î½Î¿Ï…Î½ ÎºÎ»Î®ÏƒÎµÎ¹Ï‚ API Î±Ï€ÏŒ Î±ÏƒÏ…Î½Î®Î¸Î¹ÏƒÏ„Î· Î³ÎµÏ‰Î³ÏÎ±Ï†Î¹ÎºÎ® Ï„Î¿Ï€Î¿Î¸ÎµÏƒÎ¯Î± Î® Î±Î½ÏÎ½Ï…Î¼Î¿ proxy, Ï€ÏÎ¿ÏƒÏ€Î¬Î¸ÎµÎ¹ÎµÏ‚ Î±Ï€ÎµÎ½ÎµÏÎ³Î¿Ï€Î¿Î¯Î·ÏƒÎ·Ï‚ Ï„Î·Ï‚ ÎºÎ±Ï„Î±Î³ÏÎ±Ï†Î®Ï‚ AWS CloudTrail, Î±Î»Î»Î±Î³Î­Ï‚ Ï€Î¿Ï… Î±Ï€Î¿Î´Ï…Î½Î±Î¼ÏÎ½Î¿Ï…Î½ Ï„Î·Î½ Ï€Î¿Î»Î¹Ï„Î¹ÎºÎ® ÎºÏ‰Î´Î¹ÎºÏÎ½ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ·Ï‚ Ï„Î¿Ï… Î»Î¿Î³Î±ÏÎ¹Î±ÏƒÎ¼Î¿Ï, Î±ÏƒÏ…Î½Î®Î¸Î¹ÏƒÏ„ÎµÏ‚ ÎµÎºÎºÎ¹Î½Î®ÏƒÎµÎ¹Ï‚ Ï€Î±ÏÎ¿Ï…ÏƒÎ¯Î±Ï‚ Î® Ï…Ï€Î¿Î´Î¿Î¼Î®Ï‚, Î±Î½Î±Ï€Ï„ÏÎ¾ÎµÎ¹Ï‚ Ï…Ï€Î¿Î´Î¿Î¼Î®Ï‚ ÏƒÎµ Î±ÏƒÏ…Î½Î®Î¸Î¹ÏƒÏ„Î· Ï€ÎµÏÎ¹Î¿Ï‡Î®, ÎºÎ»Î¿Ï€Î® Î´Î¹Î±Ï€Î¹ÏƒÏ„ÎµÏÏƒÎµÏ‰Î½, ÏÏ€Î¿Ï€Ï„Î· Î´ÏÎ±ÏƒÏ„Î·ÏÎ¹ÏŒÏ„Î·Ï„Î± ÏƒÏÎ½Î´ÎµÏƒÎ·Ï‚ ÏƒÎµ Î²Î¬ÏƒÎ· Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½ ÎºÎ±Î¹ ÎºÎ»Î®ÏƒÎµÎ¹Ï‚ API Î±Ï€ÏŒ Î³Î½Ï‰ÏƒÏ„Î­Ï‚ ÎºÎ±ÎºÏŒÎ²Î¿Ï…Î»ÎµÏ‚ Î´Î¹ÎµÏ…Î¸ÏÎ½ÏƒÎµÎ¹Ï‚ IP.
* **Bucket compromise**: Î”ÏÎ±ÏƒÏ„Î·ÏÎ¹ÏŒÏ„Î·Ï„Î± Ï€Î¿Ï… Ï…Ï€Î¿Î´Î·Î»ÏÎ½ÎµÎ¹ Ï€Î±ÏÎ±Î²Î¯Î±ÏƒÎ· ÎµÎ½ÏŒÏ‚ bucket, ÏŒÏ€Ï‰Ï‚ ÏÏ€Î¿Ï€Ï„Î± Î¼Î¿Ï„Î¯Î²Î± Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ·Ï‚ ÏƒÎµ Î´ÎµÎ´Î¿Î¼Î­Î½Î± Ï€Î¿Ï… Ï…Ï€Î¿Î´Î·Î»ÏÎ½Î¿Ï…Î½ ÎºÎ±ÎºÎ® Ï‡ÏÎ®ÏƒÎ· Î´Î¹Î±Ï€Î¹ÏƒÏ„ÎµÏÏƒÎµÏ‰Î½, Î±ÏƒÏ…Î½Î®Î¸Î¹ÏƒÏ„Î· Î´ÏÎ±ÏƒÏ„Î·ÏÎ¹ÏŒÏ„Î·Ï„Î± API Amazon S3 Î±Ï€ÏŒ Î±Ï€Î¿Î¼Î±ÎºÏÏ…ÏƒÎ¼Î­Î½Î¿ host, Î¼Î· ÎµÎ¾Î¿Ï…ÏƒÎ¹Î¿Î´Î¿Ï„Î·Î¼Î­Î½Î· Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ· S3 Î±Ï€ÏŒ Î³Î½Ï‰ÏƒÏ„Î­Ï‚ ÎºÎ±ÎºÏŒÎ²Î¿Ï…Î»ÎµÏ‚ Î´Î¹ÎµÏ…Î¸ÏÎ½ÏƒÎµÎ¹Ï‚ IP ÎºÎ±Î¹ ÎºÎ»Î®ÏƒÎµÎ¹Ï‚ API Î³Î¹Î± Î±Î½Î¬ÎºÏ„Î·ÏƒÎ· Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½ ÏƒÎµ S3 buckets Î±Ï€ÏŒ Ï‡ÏÎ®ÏƒÏ„Î· Ï‡Ï‰ÏÎ¯Ï‚ Ï€ÏÎ¿Î·Î³Î¿ÏÎ¼ÎµÎ½Î¿ Î¹ÏƒÏ„Î¿ÏÎ¹ÎºÏŒ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ·Ï‚ ÏƒÏ„Î¿ bucket Î® Ï€Î¿Ï… ÎºÎ»Î®Î¸Î·ÎºÎµ Î±Ï€ÏŒ Î±ÏƒÏ…Î½Î®Î¸Î¹ÏƒÏ„Î· Ï„Î¿Ï€Î¿Î¸ÎµÏƒÎ¯Î±. Î¤Î¿ Amazon GuardDuty Ï€Î±ÏÎ±ÎºÎ¿Î»Î¿Ï…Î¸ÎµÎ¯ ÎºÎ±Î¹ Î±Î½Î±Î»ÏÎµÎ¹ ÏƒÏ…Î½ÎµÏ‡ÏÏ‚ Ï„Î± Î³ÎµÎ³Î¿Î½ÏŒÏ„Î± Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½ S3 Ï„Î¿Ï… AWS CloudTrail (Ï€.Ï‡. GetObject, ListObjects, DeleteObject) Î³Î¹Î± Î½Î± Î±Î½Î¹Ï‡Î½ÎµÏÏƒÎµÎ¹ ÏÏ€Î¿Ï€Ï„Î· Î´ÏÎ±ÏƒÏ„Î·ÏÎ¹ÏŒÏ„Î·Ï„Î± ÏƒÎµ ÏŒÎ»Î± Ï„Î± Amazon S3 buckets ÏƒÎ±Ï‚.

<details>

<summary>Finding Information</summary>

Î ÎµÏÎ¯Î»Î·ÏˆÎ· ÎµÏ…ÏÎ®Î¼Î±Ï„Î¿Ï‚:

* Î¤ÏÏ€Î¿Ï‚ ÎµÏ…ÏÎ®Î¼Î±Ï„Î¿Ï‚
* Î£Î¿Î²Î±ÏÏŒÏ„Î·Ï„Î±: 7-8.9 Î¥ÏˆÎ·Î»Î®, 4-6.9 ÎœÎµÏƒÎ±Î¯Î±, 01-3.9 Î§Î±Î¼Î·Î»Î®
* Î ÎµÏÎ¹Î¿Ï‡Î®
* ID Î›Î¿Î³Î±ÏÎ¹Î±ÏƒÎ¼Î¿Ï
* ID Î ÏŒÏÎ¿Ï…
* Î§ÏÏŒÎ½Î¿Ï‚ Î±Î½Î¯Ï‡Î½ÎµÏ…ÏƒÎ·Ï‚
* Î Î¿Î¹Î± Î»Î¯ÏƒÏ„Î± Î±Ï€ÎµÎ¹Î»ÏÎ½ Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î®Î¸Î·ÎºÎµ

Î¤Î¿ ÏƒÏÎ¼Î± Î­Ï‡ÎµÎ¹ Î±Ï…Ï„Î­Ï‚ Ï„Î¹Ï‚ Ï€Î»Î·ÏÎ¿Ï†Î¿ÏÎ¯ÎµÏ‚:

* Î ÏŒÏÎ¿Ï‚ Ï€Î¿Ï… ÎµÏ€Î·ÏÎµÎ¬ÏƒÏ„Î·ÎºÎµ
* Î”ÏÎ¬ÏƒÎ·
* Î—Î¸Î¿Ï€Î¿Î¹ÏŒÏ‚: Î”Î¹ÎµÏÎ¸Ï…Î½ÏƒÎ· IP, Î¸ÏÏÎ± ÎºÎ±Î¹ Ï„Î¿Î¼Î­Î±Ï‚
* Î ÏÏŒÏƒÎ¸ÎµÏ„ÎµÏ‚ Î Î»Î·ÏÎ¿Ï†Î¿ÏÎ¯ÎµÏ‚

</details>

### All Findings

Î‘Ï€Î¿ÎºÏ„Î®ÏƒÏ„Îµ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ· ÏƒÎµ Î¼Î¹Î± Î»Î¯ÏƒÏ„Î± Î¼Îµ ÏŒÎ»Î± Ï„Î± ÎµÏ…ÏÎ®Î¼Î±Ï„Î± Ï„Î¿Ï… GuardDuty ÏƒÏ„Î¿: [https://docs.aws.amazon.com/guardduty/latest/ug/guardduty\_finding-types-active.html](https://docs.aws.amazon.com/guardduty/latest/ug/guardduty\_finding-types-active.html)

### Multi Accounts

#### By Invitation

ÎœÏ€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± **ÎºÎ±Î»Î­ÏƒÎµÏ„Îµ Î¬Î»Î»Î¿Ï…Ï‚ Î»Î¿Î³Î±ÏÎ¹Î±ÏƒÎ¼Î¿ÏÏ‚** ÏƒÎµ Î­Î½Î±Î½ Î´Î¹Î±Ï†Î¿ÏÎµÏ„Î¹ÎºÏŒ Î»Î¿Î³Î±ÏÎ¹Î±ÏƒÎ¼ÏŒ GuardDuty AWS ÏÏƒÏ„Îµ **ÎºÎ¬Î¸Îµ Î»Î¿Î³Î±ÏÎ¹Î±ÏƒÎ¼ÏŒÏ‚ Î½Î± Ï€Î±ÏÎ±ÎºÎ¿Î»Î¿Ï…Î¸ÎµÎ¯Ï„Î±Î¹ Î±Ï€ÏŒ Ï„Î¿ Î¯Î´Î¹Î¿ GuardDuty**. ÎŸ ÎºÏÏÎ¹Î¿Ï‚ Î»Î¿Î³Î±ÏÎ¹Î±ÏƒÎ¼ÏŒÏ‚ Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± Ï€ÏÎ¿ÏƒÎºÎ±Î»Î­ÏƒÎµÎ¹ Ï„Î¿Ï…Ï‚ Î»Î¿Î³Î±ÏÎ¹Î±ÏƒÎ¼Î¿ÏÏ‚ Î¼Î­Î»Î· ÎºÎ±Î¹ ÏƒÏ„Î· ÏƒÏ…Î½Î­Ï‡ÎµÎ¹Î± Î¿ ÎµÎºÏ€ÏÏŒÏƒÏ‰Ï€Î¿Ï‚ Ï„Î¿Ï… Î»Î¿Î³Î±ÏÎ¹Î±ÏƒÎ¼Î¿Ï Î¼Î­Î»Î¿Ï…Ï‚ Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± Î±Ï€Î¿Î´ÎµÏ‡Ï„ÎµÎ¯ Ï„Î·Î½ Ï€ÏÏŒÏƒÎºÎ»Î·ÏƒÎ·.

#### Via Organization

ÎœÏ€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Î¿ÏÎ¯ÏƒÎµÏ„Îµ Î¿Ï€Î¿Î¹Î¿Î½Î´Î®Ï€Î¿Ï„Îµ Î»Î¿Î³Î±ÏÎ¹Î±ÏƒÎ¼ÏŒ ÎµÎ½Ï„ÏŒÏ‚ Ï„Î·Ï‚ Î¿ÏÎ³Î¬Î½Ï‰ÏƒÎ·Ï‚ Ï‰Ï‚ **ÎµÎ¾Î¿Ï…ÏƒÎ¹Î¿Î´Î¿Ï„Î·Î¼Î­Î½Î¿ Î´Î¹Î±Ï‡ÎµÎ¹ÏÎ¹ÏƒÏ„Î® GuardDuty**. ÎœÏŒÎ½Î¿ Î¿ Î»Î¿Î³Î±ÏÎ¹Î±ÏƒÎ¼ÏŒÏ‚ Î´Î¹Î±Ï‡ÎµÎ¯ÏÎ¹ÏƒÎ·Ï‚ Ï„Î·Ï‚ Î¿ÏÎ³Î¬Î½Ï‰ÏƒÎ·Ï‚ Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Î¿ÏÎ¯ÏƒÎµÎ¹ Î­Î½Î±Î½ ÎµÎ¾Î¿Ï…ÏƒÎ¹Î¿Î´Î¿Ï„Î·Î¼Î­Î½Î¿ Î´Î¹Î±Ï‡ÎµÎ¹ÏÎ¹ÏƒÏ„Î®.

ÎˆÎ½Î±Ï‚ Î»Î¿Î³Î±ÏÎ¹Î±ÏƒÎ¼ÏŒÏ‚ Ï€Î¿Ï… Î¿ÏÎ¯Î¶ÎµÏ„Î±Î¹ Ï‰Ï‚ ÎµÎ¾Î¿Ï…ÏƒÎ¹Î¿Î´Î¿Ï„Î·Î¼Î­Î½Î¿Ï‚ Î´Î¹Î±Ï‡ÎµÎ¹ÏÎ¹ÏƒÏ„Î®Ï‚ Î³Î¯Î½ÎµÏ„Î±Î¹ Î»Î¿Î³Î±ÏÎ¹Î±ÏƒÎ¼ÏŒÏ‚ Î´Î¹Î±Ï‡ÎµÎ¹ÏÎ¹ÏƒÏ„Î® GuardDuty, Î­Ï‡ÎµÎ¹ Ï„Î¿ GuardDuty ÎµÎ½ÎµÏÎ³Î¿Ï€Î¿Î¹Î·Î¼Î­Î½Î¿ Î±Ï…Ï„ÏŒÎ¼Î±Ï„Î± ÏƒÏ„Î·Î½ ÎºÎ±Î¸Î¿ÏÎ¹ÏƒÎ¼Î­Î½Î· Ï€ÎµÏÎ¹Î¿Ï‡Î® AWS ÎºÎ±Î¹ Î­Ï‡ÎµÎ¹ ÎµÏ€Î¯ÏƒÎ·Ï‚ **Î¬Î´ÎµÎ¹Î± Î½Î± ÎµÎ½ÎµÏÎ³Î¿Ï€Î¿Î¹ÎµÎ¯ ÎºÎ±Î¹ Î½Î± Î´Î¹Î±Ï‡ÎµÎ¹ÏÎ¯Î¶ÎµÏ„Î±Î¹ Ï„Î¿ GuardDuty Î³Î¹Î± ÏŒÎ»Î¿Ï…Ï‚ Ï„Î¿Ï…Ï‚ Î»Î¿Î³Î±ÏÎ¹Î±ÏƒÎ¼Î¿ÏÏ‚ ÏƒÏ„Î·Î½ Î¿ÏÎ³Î¬Î½Ï‰ÏƒÎ· ÎµÎ½Ï„ÏŒÏ‚ Î±Ï…Ï„Î®Ï‚ Ï„Î·Ï‚ Ï€ÎµÏÎ¹Î¿Ï‡Î®Ï‚**. ÎŸÎ¹ Î¬Î»Î»Î¿Î¹ Î»Î¿Î³Î±ÏÎ¹Î±ÏƒÎ¼Î¿Î¯ ÏƒÏ„Î·Î½ Î¿ÏÎ³Î¬Î½Ï‰ÏƒÎ· Î¼Ï€Î¿ÏÎ¿ÏÎ½ Î½Î± Ï€ÏÎ¿Î²Î»Î·Î¸Î¿ÏÎ½ ÎºÎ±Î¹ Î½Î± Ï€ÏÎ¿ÏƒÏ„ÎµÎ¸Î¿ÏÎ½ Ï‰Ï‚ Î»Î¿Î³Î±ÏÎ¹Î±ÏƒÎ¼Î¿Î¯ Î¼ÎµÎ»ÏÎ½ GuardDuty Ï€Î¿Ï… ÏƒÏ‡ÎµÏ„Î¯Î¶Î¿Î½Ï„Î±Î¹ Î¼Îµ Î±Ï…Ï„ÏŒÎ½ Ï„Î¿Î½ ÎµÎ¾Î¿Ï…ÏƒÎ¹Î¿Î´Î¿Ï„Î·Î¼Î­Î½Î¿ Î´Î¹Î±Ï‡ÎµÎ¹ÏÎ¹ÏƒÏ„Î® Î»Î¿Î³Î±ÏÎ¹Î±ÏƒÎ¼Î¿Ï.

## Enumeration

{% code overflow="wrap" %}
```bash
# Get Org config
aws guardduty list-organization-admin-accounts #Get Delegated Administrator
aws guardduty describe-organization-configuration --detector-id <id>

# Check external invitations
aws guardduty list-invitations
aws guardduty get-invitations-count

# Detector Information
aws guardduty list-detectors # 1 detector per account with GuardDuty
aws guardduty get-detector --detector-id <id> # Get detector info
aws guardduty get-master-account --detector-id <id>

# Get filters
aws guardduty list-filters --detector-id <id> # Check filters
aws guardduty get-filter --detector-id <id> --filter-name <name>

# Findings
aws guardduty list-findings --detector-id <id> # List findings
aws guardduty get-findings --detector-id <id> --finding-ids <id> # Get details about the finding
aws guardduty get-findings-statistics --detector-id <id> --finding-statistic-types <types>

# Get trusted IP addresses
aws guardduty list-ip-sets --detector-id <id>
aws guardduty get-ip-set --detector-id <id>

# Member accounts of the current AWS GuardDuty master account
aws guardduty list-members --detector-id <id>
aws guardduty get-members --detector-id <id> --account-ids <id>
aws guardduty get-member-detectors --detector-id <id> --account-ids <id>

# Continuously export its findings to an Amazon S3 bucket
aws guardduty list-publishing-destinations --detector-id <id>

# Intelligence sets that you have uploaded to GuardDuty
aws guardduty list-threat-intel-sets --detector-id <id>
aws guardduty get-threat-intel-set --detector-id <id> --threat-intel-set-id <id>
```
{% endcode %}

## GuardDuty Bypass

### Î“ÎµÎ½Î¹ÎºÎ­Ï‚ ÎŸÎ´Î·Î³Î¯ÎµÏ‚

Î ÏÎ¿ÏƒÏ€Î±Î¸Î®ÏƒÏ„Îµ Î½Î± Î¼Î¬Î¸ÎµÏ„Îµ ÏŒÏƒÎ¿ Ï„Î¿ Î´Ï…Î½Î±Ï„ÏŒÎ½ Ï€ÎµÏÎ¹ÏƒÏƒÏŒÏ„ÎµÏÎ± Î³Î¹Î± Ï„Î· ÏƒÏ…Î¼Ï€ÎµÏÎ¹Ï†Î¿ÏÎ¬ Ï„Ï‰Î½ Î´Î¹Î±Ï€Î¹ÏƒÏ„ÎµÏ…Ï„Î·ÏÎ¯Ï‰Î½ Ï€Î¿Ï… Ï€ÏÏŒÎºÎµÎ¹Ï„Î±Î¹ Î½Î± Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î®ÏƒÎµÏ„Îµ:

* ÎÏÎµÏ‚ Ï€Î¿Ï… Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î¿ÏÎ½Ï„Î±Î¹
* Î¤Î¿Ï€Î¿Î¸ÎµÏƒÎ¯ÎµÏ‚
* User Agents / Î¥Ï€Î·ÏÎµÏƒÎ¯ÎµÏ‚ (ÎœÏ€Î¿ÏÎµÎ¯ Î½Î± Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î·Î¸ÎµÎ¯ Î±Ï€ÏŒ awscli, webconsole, lambda...)
* Î†Î´ÎµÎ¹ÎµÏ‚ Ï€Î¿Ï… Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î¿ÏÎ½Ï„Î±Î¹ Ï„Î±ÎºÏ„Î¹ÎºÎ¬

ÎœÎµ Î±Ï…Ï„Î­Ï‚ Ï„Î¹Ï‚ Ï€Î»Î·ÏÎ¿Ï†Î¿ÏÎ¯ÎµÏ‚, Î±Î½Î±Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î®ÏƒÏ„Îµ ÏŒÏƒÎ¿ Ï„Î¿ Î´Ï…Î½Î±Ï„ÏŒÎ½ Ï€ÎµÏÎ¹ÏƒÏƒÏŒÏ„ÎµÏÎ¿ Ï„Î¿ Î¯Î´Î¹Î¿ ÏƒÎµÎ½Î¬ÏÎ¹Î¿ Î³Î¹Î± Î½Î± Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î®ÏƒÎµÏ„Îµ Ï„Î·Î½ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ·:

* Î‘Î½ ÎµÎ¯Î½Î±Î¹ **Ï‡ÏÎ®ÏƒÏ„Î·Ï‚ Î® ÏÏŒÎ»Î¿Ï‚ Ï€Î¿Ï… Ï€ÏÎ¿ÏƒÏ€ÎµÎ»Î¬ÏƒÏ„Î·ÎºÎµ Î±Ï€ÏŒ Ï‡ÏÎ®ÏƒÏ„Î·**, Ï€ÏÎ¿ÏƒÏ€Î±Î¸Î®ÏƒÏ„Îµ Î½Î± Ï„Î¿ Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î®ÏƒÎµÏ„Îµ Ï„Î¹Ï‚ Î¯Î´Î¹ÎµÏ‚ ÏÏÎµÏ‚, Î±Ï€ÏŒ Ï„Î·Î½ Î¯Î´Î¹Î± Î³ÎµÏ‰Î³ÏÎ±Ï†Î¹ÎºÎ® Ï„Î¿Ï€Î¿Î¸ÎµÏƒÎ¯Î± (Î±ÎºÏŒÎ¼Î± ÎºÎ±Î¹ Ï„Î¿Î½ Î¯Î´Î¹Î¿ ISP ÎºÎ±Î¹ IP Î±Î½ ÎµÎ¯Î½Î±Î¹ Î´Ï…Î½Î±Ï„ÏŒÎ½)
* Î‘Î½ ÎµÎ¯Î½Î±Î¹ **ÏÏŒÎ»Î¿Ï‚ Ï€Î¿Ï… Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÎµÎ¯Ï„Î±Î¹ Î±Ï€ÏŒ Ï…Ï€Î·ÏÎµÏƒÎ¯Î±**, Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î®ÏƒÏ„Îµ Ï„Î·Î½ Î¯Î´Î¹Î± Ï…Ï€Î·ÏÎµÏƒÎ¯Î± ÏƒÏ„Î·Î½ Î¯Î´Î¹Î± Ï€ÎµÏÎ¹Î¿Ï‡Î® ÎºÎ±Î¹ Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î®ÏƒÏ„Îµ Ï„Î·Î½ Î±Ï€ÏŒ ÎµÎºÎµÎ¯ ÏƒÏ„Î¹Ï‚ Î¯Î´Î¹ÎµÏ‚ Ï‡ÏÎ¿Î½Î¹ÎºÎ­Ï‚ Ï€ÎµÏÎ¹ÏŒÎ´Î¿Ï…Ï‚
* Î ÏÎ¿ÏƒÏ€Î±Î¸Î®ÏƒÏ„Îµ Ï€Î¬Î½Ï„Î± Î½Î± Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÎµÎ¯Ï„Îµ Ï„Î¹Ï‚ **Î¯Î´Î¹ÎµÏ‚ Î¬Î´ÎµÎ¹ÎµÏ‚** Ï€Î¿Ï… Î­Ï‡ÎµÎ¹ Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î®ÏƒÎµÎ¹ Î±Ï…Ï„ÏŒÏ‚ Î¿ Ï†Î¿ÏÎ­Î±Ï‚
* Î‘Î½ Ï‡ÏÎµÎ¹Î±ÏƒÏ„ÎµÎ¯ Î½Î± **Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î®ÏƒÎµÏ„Îµ Î¬Î»Î»ÎµÏ‚ Î¬Î´ÎµÎ¹ÎµÏ‚ Î® Î½Î± ÎºÎ±Ï„Î±Ï‡ÏÎ±ÏƒÏ„ÎµÎ¯Ï„Îµ Î¼Î¹Î± Î¬Î´ÎµÎ¹Î±** (Î³Î¹Î± Ï€Î±ÏÎ¬Î´ÎµÎ¹Î³Î¼Î±, Î½Î± ÎºÎ±Ï„ÎµÎ²Î¬ÏƒÎµÏ„Îµ 1.000.000 Î±ÏÏ‡ÎµÎ¯Î± ÎºÎ±Ï„Î±Î³ÏÎ±Ï†Î®Ï‚ cloudtrail) ÎºÎ¬Î½Ï„Îµ Ï„Î¿ **Î±ÏÎ³Î¬** ÎºÎ±Î¹ Î¼Îµ Ï„Î¿Î½ **ÎµÎ»Î¬Ï‡Î¹ÏƒÏ„Î¿ Î±ÏÎ¹Î¸Î¼ÏŒ Î±Î»Î»Î·Î»ÎµÏ€Î¹Î´ÏÎ¬ÏƒÎµÏ‰Î½** Î¼Îµ Ï„Î¿ AWS (Ï„Î¿ awscli ÎºÎ±Î»ÎµÎ¯ Î¼ÎµÏÎ¹ÎºÎ­Ï‚ Ï†Î¿ÏÎ­Ï‚ Ï€Î¿Î»Î»Î­Ï‚ APIs Î±Î½Î¬Î³Î½Ï‰ÏƒÎ·Ï‚ Ï€ÏÎ¹Î½ Î±Ï€ÏŒ Ï„Î·Î½ ÎµÎ³Î³ÏÎ±Ï†Î®)

### Î£Ï€Î¬Î¶Î¿Î½Ï„Î±Ï‚ Ï„Î¿ GuardDuty

#### `guardduty:UpdateDetector`

ÎœÎµ Î±Ï…Ï„Î® Ï„Î·Î½ Î¬Î´ÎµÎ¹Î± Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Î±Ï€ÎµÎ½ÎµÏÎ³Î¿Ï€Î¿Î¹Î®ÏƒÎµÏ„Îµ Ï„Î¿ GuardDuty Î³Î¹Î± Î½Î± Î±Ï€Î¿Ï†ÏÎ³ÎµÏ„Îµ Ï„Î·Î½ ÎµÎ½ÎµÏÎ³Î¿Ï€Î¿Î¯Î·ÏƒÎ· ÎµÎ¹Î´Î¿Ï€Î¿Î¹Î®ÏƒÎµÏ‰Î½.

{% code overflow="wrap" %}
```bash
aws guardduty update-detector --detector-id <detector-id> --no-enable
aws guardduty update-detector --detector-id <detector-id> --data-sources S3Logs={Enable=false}
```
{% endcode %}

#### `guardduty:CreateFilter`

ÎŸÎ¹ ÎµÏ€Î¹Ï„Î¹Î¸Î­Î¼ÎµÎ½Î¿Î¹ Î¼Îµ Î±Ï…Ï„Î® Ï„Î·Î½ Î¬Î´ÎµÎ¹Î± Î­Ï‡Î¿Ï…Î½ Ï„Î· Î´Ï…Î½Î±Ï„ÏŒÏ„Î·Ï„Î± Î½Î± **Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î¿ÏÎ½ Ï†Î¯Î»Ï„ÏÎ± Î³Î¹Î± Ï„Î·Î½ Î±Ï…Ï„ÏŒÎ¼Î±Ï„Î·** Î±ÏÏ‡ÎµÎ¹Î¿Î¸Î­Ï„Î·ÏƒÎ· ÎµÏ…ÏÎ·Î¼Î¬Ï„Ï‰Î½:

{% code overflow="wrap" %}
```bash
aws guardduty create-filter  --detector-id <detector-id> --name <filter-name> --finding-criteria file:///tmp/criteria.json --action ARCHIVE
```
{% endcode %}

#### `iam:PutRolePolicy`, (`guardduty:CreateIPSet`|`guardduty:UpdateIPSet`)

ÎŸÎ¹ ÎµÏ€Î¹Ï„Î¹Î¸Î­Î¼ÎµÎ½Î¿Î¹ Î¼Îµ Ï„Î± Ï€ÏÎ¿Î·Î³Î¿ÏÎ¼ÎµÎ½Î± Î´Î¹ÎºÎ±Î¹ÏÎ¼Î±Ï„Î± Î¸Î± Î¼Ï€Î¿ÏÎ¿ÏÏƒÎ±Î½ Î½Î± Ï„ÏÎ¿Ï€Î¿Ï€Î¿Î¹Î®ÏƒÎ¿Ï…Î½ Ï„Î· [**Î›Î¯ÏƒÏ„Î± Î•Î¼Ï€Î¹ÏƒÏ„ÎµÏ…Î¼Î­Î½Ï‰Î½ IP**](https://docs.aws.amazon.com/guardduty/latest/ug/guardduty\_upload-lists.html) Ï„Î¿Ï… GuardDuty Ï€ÏÎ¿ÏƒÎ¸Î­Ï„Î¿Î½Ï„Î±Ï‚ Ï„Î· Î´Î¹ÎµÏÎ¸Ï…Î½ÏƒÎ· IP Ï„Î¿Ï…Ï‚ ÏƒÎµ Î±Ï…Ï„Î®Î½ ÎºÎ±Î¹ Î½Î± Î±Ï€Î¿Ï†ÏÎ³Î¿Ï…Î½ Ï„Î· Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± ÎµÎ¹Î´Î¿Ï€Î¿Î¹Î®ÏƒÎµÏ‰Î½.

{% code overflow="wrap" %}
```bash
aws guardduty update-ip-set --detector-id <detector-id> --activate --ip-set-id <ip-set-id> --location https://some-bucket.s3-eu-west-1.amazonaws.com/attacker.csv
```
{% endcode %}

#### `guardduty:DeletePublishingDestination`

ÎŸÎ¹ ÎµÏ€Î¹Ï„Î¹Î¸Î­Î¼ÎµÎ½Î¿Î¹ Î¸Î± Î¼Ï€Î¿ÏÎ¿ÏÏƒÎ±Î½ Î½Î± Î±Ï†Î±Î¹ÏÎ­ÏƒÎ¿Ï…Î½ Ï„Î¿Î½ Ï€ÏÎ¿Î¿ÏÎ¹ÏƒÎ¼ÏŒ Î³Î¹Î± Î½Î± Î±Ï€Î¿Ï„ÏÎ­ÏˆÎ¿Ï…Î½ Ï„Î·Î½ ÎµÎ¹Î´Î¿Ï€Î¿Î¯Î·ÏƒÎ·:

{% code overflow="wrap" %}
```bash
aws guardduty delete-publishing-destination --detector-id <detector-id> --destination-id <dest-id>
```
{% endcode %}

{% hint style="danger" %}
Î— Î´Î¹Î±Î³ÏÎ±Ï†Î® Î±Ï…Ï„Î¿Ï Ï„Î¿Ï… Ï€ÏÎ¿Î¿ÏÎ¹ÏƒÎ¼Î¿Ï Î´Î·Î¼Î¿ÏƒÎ¯ÎµÏ…ÏƒÎ·Ï‚ **Î´ÎµÎ½ Î¸Î± ÎµÏ€Î·ÏÎµÎ¬ÏƒÎµÎ¹ Ï„Î· Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Î® Ï„Î·Î½ Î¿ÏÎ±Ï„ÏŒÏ„Î·Ï„Î± Ï„Ï‰Î½ ÎµÏ…ÏÎ·Î¼Î¬Ï„Ï‰Î½ Î¼Î­ÏƒÎ± ÏƒÏ„Î·Î½ ÎºÎ¿Î½ÏƒÏŒÎ»Î± GuardDuty**. Î¤Î¿ GuardDuty Î¸Î± ÏƒÏ…Î½ÎµÏ‡Î¯ÏƒÎµÎ¹ Î½Î± Î±Î½Î±Î»ÏÎµÎ¹ Î³ÎµÎ³Î¿Î½ÏŒÏ„Î± ÏƒÏ„Î¿ Ï€ÎµÏÎ¹Î²Î¬Î»Î»Î¿Î½ AWS ÏƒÎ±Ï‚, Î½Î± ÎµÎ½Ï„Î¿Ï€Î¯Î¶ÎµÎ¹ ÏÏ€Î¿Ï€Ï„Î· Î® Î±Ï€ÏÎ¿ÏƒÎ´ÏŒÎºÎ·Ï„Î· ÏƒÏ…Î¼Ï€ÎµÏÎ¹Ï†Î¿ÏÎ¬ ÎºÎ±Î¹ Î½Î± Î´Î·Î¼Î¹Î¿Ï…ÏÎ³ÎµÎ¯ ÎµÏ…ÏÎ®Î¼Î±Ï„Î±.
{% endhint %}

### Î Î±ÏÎ±Î´ÎµÎ¯Î³Î¼Î±Ï„Î± Î Î±ÏÎ¬ÎºÎ±Î¼ÏˆÎ·Ï‚ Î£Ï…Î³ÎºÎµÎºÏÎ¹Î¼Î­Î½Ï‰Î½ Î•Ï…ÏÎ·Î¼Î¬Ï„Ï‰Î½

Î£Î·Î¼ÎµÎ¹ÏÏƒÏ„Îµ ÏŒÏ„Î¹ Ï…Ï€Î¬ÏÏ‡Î¿Ï…Î½ Î´ÎµÎºÎ¬Î´ÎµÏ‚ ÎµÏ…ÏÎ®Î¼Î±Ï„Î± Ï„Î¿Ï… GuardDuty, Ï‰ÏƒÏ„ÏŒÏƒÎ¿, **Ï‰Ï‚ Red Teamer, Î´ÎµÎ½ Î¸Î± ÏƒÎ±Ï‚ ÎµÏ€Î·ÏÎµÎ¬ÏƒÎ¿Ï…Î½ ÏŒÎ»Î±**, ÎºÎ±Î¹ Ï„Î¿ ÎºÎ±Î»ÏÏ„ÎµÏÎ¿ ÎµÎ¯Î½Î±Î¹ ÏŒÏ„Î¹ Î­Ï‡ÎµÏ„Îµ Ï„Î·Î½ **Ï€Î»Î®ÏÎ· Ï„ÎµÎºÎ¼Î·ÏÎ¯Ï‰ÏƒÎ· ÎºÎ±Î¸ÎµÎ½ÏŒÏ‚ Î±Ï€ÏŒ Î±Ï…Ï„Î¬** ÏƒÏ„Î¿ [https://docs.aws.amazon.com/guardduty/latest/ug/guardduty\_finding-types-active.html](https://docs.aws.amazon.com/guardduty/latest/ug/guardduty\_finding-types-active.html) Î¿Ï€ÏŒÏ„Îµ ÏÎ¯Î¾Ï„Îµ Î¼Î¹Î± Î¼Î±Ï„Î¹Î¬ Ï€ÏÎ¹Î½ ÎºÎ¬Î½ÎµÏ„Îµ Î¿Ï€Î¿Î¹Î±Î´Î®Ï€Î¿Ï„Îµ ÎµÎ½Î­ÏÎ³ÎµÎ¹Î± Î³Î¹Î± Î½Î± Î¼Î·Î½ Ï€Î¹Î±ÏƒÏ„ÎµÎ¯Ï„Îµ.

Î•Î´Ï Î­Ï‡ÎµÏ„Îµ Î¼ÎµÏÎ¹ÎºÎ¬ Ï€Î±ÏÎ±Î´ÎµÎ¯Î³Î¼Î±Ï„Î± Ï€Î±ÏÎ¬ÎºÎ±Î¼ÏˆÎ·Ï‚ ÏƒÏ…Î³ÎºÎµÎºÏÎ¹Î¼Î­Î½Ï‰Î½ ÎµÏ…ÏÎ·Î¼Î¬Ï„Ï‰Î½ Ï„Î¿Ï… GuardDuty:

#### [PenTest:IAMUser/KaliLinux](https://docs.aws.amazon.com/guardduty/latest/ug/guardduty\_finding-types-iam.html#pentest-iam-kalilinux) <a href="#pentest-iam-kalilinux" id="pentest-iam-kalilinux"></a>

Î¤Î¿ GuardDuty Î±Î½Î¹Ï‡Î½ÎµÏÎµÎ¹ Î±Î¹Ï„Î®Î¼Î±Ï„Î± API AWS Î±Ï€ÏŒ ÎºÎ¿Î¹Î½Î¬ ÎµÏÎ³Î±Î»ÎµÎ¯Î± Î´Î¿ÎºÎ¹Î¼Î®Ï‚ Î´Î¹ÎµÎ¯ÏƒÎ´Ï…ÏƒÎ·Ï‚ ÎºÎ±Î¹ ÎµÎ½ÎµÏÎ³Î¿Ï€Î¿Î¹ÎµÎ¯ Î­Î½Î± [PenTest Finding](https://docs.aws.amazon.com/guardduty/latest/ug/guardduty\_finding-types-iam.html#pentest-iam-kalilinux).\
Î‘Î½Î¹Ï‡Î½ÎµÏÎµÏ„Î±Î¹ Î±Ï€ÏŒ Ï„Î¿ **ÏŒÎ½Î¿Î¼Î± Ï„Î¿Ï… user agent** Ï€Î¿Ï… Î¼ÎµÏ„Î±Ï†Î­ÏÎµÏ„Î±Î¹ ÏƒÏ„Î¿ Î±Î¯Ï„Î·Î¼Î± API.\
Î•Ï€Î¿Î¼Î­Î½Ï‰Ï‚, **Î· Ï„ÏÎ¿Ï€Î¿Ï€Î¿Î¯Î·ÏƒÎ· Ï„Î¿Ï… user agent** ÎµÎ¯Î½Î±Î¹ Î´Ï…Î½Î±Ï„Î® Î³Î¹Î± Î½Î± Î±Ï€Î¿Ï„ÏÎ±Ï€ÎµÎ¯ Î· Î±Î½Î¯Ï‡Î½ÎµÏ…ÏƒÎ· Ï„Î·Ï‚ ÎµÏ€Î¯Î¸ÎµÏƒÎ·Ï‚ Î±Ï€ÏŒ Ï„Î¿ GuardDuty.

Î“Î¹Î± Î½Î± Ï„Î¿ Î±Ï€Î¿Ï„ÏÎ­ÏˆÎµÏ„Îµ Î±Ï…Ï„ÏŒ, Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Î±Î½Î±Î¶Î·Ï„Î®ÏƒÎµÏ„Îµ Ï„Î¿ ÏƒÎµÎ½Î¬ÏÎ¹Î¿ `session.py` ÏƒÏ„Î¿ Ï€Î±ÎºÎ­Ï„Î¿ `botocore` ÎºÎ±Î¹ Î½Î± Ï„ÏÎ¿Ï€Î¿Ï€Î¿Î¹Î®ÏƒÎµÏ„Îµ Ï„Î¿Î½ user agent, Î® Î½Î± Î¿ÏÎ¯ÏƒÎµÏ„Îµ Ï„Î¿ Burp Suite Ï‰Ï‚ proxy AWS CLI ÎºÎ±Î¹ Î½Î± Î±Î»Î»Î¬Î¾ÎµÏ„Îµ Ï„Î¿Î½ user-agent Î¼Îµ Ï„Î¿ MitM Î® Î±Ï€Î»Î¬ Î½Î± Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î®ÏƒÎµÏ„Îµ Î­Î½Î± Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¹ÎºÏŒ ÏƒÏÏƒÏ„Î·Î¼Î± ÏŒÏ€Ï‰Ï‚ Ï„Î¿ Ubuntu, Mac Î® Windows Ï€Î¿Ï… Î¸Î± Î±Ï€Î¿Ï„ÏÎ­ÏˆÎµÎ¹ Ï„Î·Î½ ÎµÎ½ÎµÏÎ³Î¿Ï€Î¿Î¯Î·ÏƒÎ· Î±Ï…Ï„Î®Ï‚ Ï„Î·Ï‚ ÎµÎ¹Î´Î¿Ï€Î¿Î¯Î·ÏƒÎ·Ï‚.

#### UnauthorizedAccess:IAMUser/InstanceCredentialExfiltration

Î— ÎµÎ¾Î±Î³Ï‰Î³Î® Î´Î¹Î±Ï€Î¹ÏƒÏ„ÎµÏ…Ï„Î·ÏÎ¯Ï‰Î½ EC2 Î±Ï€ÏŒ Ï„Î·Î½ Ï…Ï€Î·ÏÎµÏƒÎ¯Î± Î¼ÎµÏ„Î±Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½ ÎºÎ±Î¹ **Î· Ï‡ÏÎ®ÏƒÎ· Ï„Î¿Ï…Ï‚ ÎµÎºÏ„ÏŒÏ‚** Ï„Î¿Ï… Ï€ÎµÏÎ¹Î²Î¬Î»Î»Î¿Î½Ï„Î¿Ï‚ AWS ÎµÎ½ÎµÏÎ³Î¿Ï€Î¿Î¹ÎµÎ¯ Ï„Î·Î½ ÎµÎ¹Î´Î¿Ï€Î¿Î¯Î·ÏƒÎ· [**`UnauthorizedAccess:IAMUser/InstanceCredentialExfiltration.OutsideAWS`**](https://docs.aws.amazon.com/guardduty/latest/ug/guardduty\_finding-types-iam.html#unauthorizedaccess-iam-instancecredentialexfiltrationoutsideaws). Î‘Î½Ï„Î¯Î¸ÎµÏ„Î±, Î· Ï‡ÏÎ®ÏƒÎ· Î±Ï…Ï„ÏÎ½ Ï„Ï‰Î½ Î´Î¹Î±Ï€Î¹ÏƒÏ„ÎµÏ…Ï„Î·ÏÎ¯Ï‰Î½ Î±Ï€ÏŒ Ï„Î·Î½ EC2 instance ÏƒÎ±Ï‚ ÎµÎ½ÎµÏÎ³Î¿Ï€Î¿Î¹ÎµÎ¯ Ï„Î·Î½ ÎµÎ¹Î´Î¿Ï€Î¿Î¯Î·ÏƒÎ· [**`UnauthorizedAccess:IAMUser/InstanceCredentialExfiltration.InsideAWS`**](https://docs.aws.amazon.com/guardduty/latest/ug/guardduty\_finding-types-iam.html#unauthorizedaccess-iam-instancecredentialexfiltrationinsideaws). Î©ÏƒÏ„ÏŒÏƒÎ¿, **Î· Ï‡ÏÎ®ÏƒÎ· Ï„Ï‰Î½ Î´Î¹Î±Ï€Î¹ÏƒÏ„ÎµÏ…Ï„Î·ÏÎ¯Ï‰Î½ ÏƒÎµ Î¬Î»Î»Î· ÏƒÏ…Î¼Î²Î¹Î²Î±ÏƒÎ¼Î­Î½Î· EC2 instance ÎµÎ½Ï„ÏŒÏ‚ Ï„Î¿Ï… Î¯Î´Î¹Î¿Ï… Î»Î¿Î³Î±ÏÎ¹Î±ÏƒÎ¼Î¿Ï Ï€Î±ÏÎ±Î¼Î­Î½ÎµÎ¹ Î±Ï€Î±ÏÎ±Ï„Î®ÏÎ·Ï„Î·**, Ï‡Ï‰ÏÎ¯Ï‚ Î½Î± ÎµÎ½ÎµÏÎ³Î¿Ï€Î¿Î¹Î®ÏƒÎµÎ¹ ÎºÎ±Î¼Î¯Î± ÎµÎ¹Î´Î¿Ï€Î¿Î¯Î·ÏƒÎ·.

{% hint style="success" %}
Î•Ï€Î¿Î¼Î­Î½Ï‰Ï‚, **Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î®ÏƒÏ„Îµ Ï„Î± ÎµÎ¾Î±Î³ÏŒÎ¼ÎµÎ½Î± Î´Î¹Î±Ï€Î¹ÏƒÏ„ÎµÏ…Ï„Î®ÏÎ¹Î± Î±Ï€ÏŒ Î¼Î­ÏƒÎ± ÏƒÏ„Î· Î¼Î·Ï‡Î±Î½Î®** ÏŒÏ€Î¿Ï… Ï„Î± Î²ÏÎ®ÎºÎ±Ï„Îµ Î³Î¹Î± Î½Î± Î¼Î·Î½ ÎµÎ½ÎµÏÎ³Î¿Ï€Î¿Î¹Î·Î¸ÎµÎ¯ Î±Ï…Ï„Î® Î· ÎµÎ¹Î´Î¿Ï€Î¿Î¯Î·ÏƒÎ·.
{% endhint %}

## Î‘Î½Î±Ï†Î¿ÏÎ­Ï‚

* [https://docs.aws.amazon.com/guardduty/latest/ug/guardduty\_finding-types-active.html](https://docs.aws.amazon.com/guardduty/latest/ug/guardduty\_finding-types-active.html)
* [https://docs.aws.amazon.com/guardduty/latest/ug/findings\_suppression-rule.html](https://docs.aws.amazon.com/guardduty/latest/ug/findings\_suppression-rule.html)
* [https://docs.aws.amazon.com/guardduty/latest/ug/guardduty\_upload-lists.html](https://docs.aws.amazon.com/guardduty/latest/ug/guardduty\_upload-lists.html)
* [https://docs.aws.amazon.com/cli/latest/reference/guardduty/delete-publishing-destination.html](https://docs.aws.amazon.com/cli/latest/reference/guardduty/delete-publishing-destination.html)
* [https://docs.aws.amazon.com/guardduty/latest/ug/guardduty\_finding-types-ec2.html#unauthorizedaccess-ec2-torclient](https://docs.aws.amazon.com/guardduty/latest/ug/guardduty\_finding-types-ec2.html#unauthorizedaccess-ec2-torclient)
* [https://docs.aws.amazon.com/guardduty/latest/ug/guardduty\_finding-types-iam.html#unauthorizedaccess-iam-instancecredentialexfiltrationoutsideaws](https://docs.aws.amazon.com/guardduty/latest/ug/guardduty\_finding-types-iam.html#unauthorizedaccess-iam-instancecredentialexfiltrationoutsideaws)
* [https://docs.aws.amazon.com/guardduty/latest/ug/guardduty\_finding-types-iam.html#unauthorizedaccess-iam-instancecredentialexfiltrationinsideaws](https://docs.aws.amazon.com/guardduty/latest/ug/guardduty\_finding-types-iam.html#unauthorizedaccess-iam-instancecredentialexfiltrationinsideaws)
* [https://docs.aws.amazon.com/whitepapers/latest/aws-privatelink/what-are-vpc-endpoints.html](https://docs.aws.amazon.com/whitepapers/latest/aws-privatelink/what-are-vpc-endpoints.html)

{% hint style="success" %}
ÎœÎ¬Î¸ÎµÏ„Îµ & ÎµÎ¾Î±ÏƒÎºÎ·Î¸ÎµÎ¯Ï„Îµ ÏƒÏ„Î¿ AWS Hacking:<img src="../../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">\
ÎœÎ¬Î¸ÎµÏ„Îµ & ÎµÎ¾Î±ÏƒÎºÎ·Î¸ÎµÎ¯Ï„Îµ ÏƒÏ„Î¿ GCP Hacking: <img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Î¥Ï€Î¿ÏƒÏ„Î®ÏÎ¹Î¾Î· HackTricks</summary>

* Î•Î»Î­Î³Î¾Ï„Îµ Ï„Î± [**ÏƒÏ‡Î­Î´Î¹Î± ÏƒÏ…Î½Î´ÏÎ¿Î¼Î®Ï‚**](https://github.com/sponsors/carlospolop)!
* **Î•Î³Î³ÏÎ±Ï†ÎµÎ¯Ï„Îµ ÏƒÏ„Î·Î½** ğŸ’¬ [**Î¿Î¼Î¬Î´Î± Discord**](https://discord.gg/hRep4RUj7f) Î® ÏƒÏ„Î·Î½ [**Î¿Î¼Î¬Î´Î± telegram**](https://t.me/peass) Î® **Î±ÎºÎ¿Î»Î¿Ï…Î¸Î®ÏƒÏ„Îµ** Î¼Î±Ï‚ ÏƒÏ„Î¿ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **ÎœÎ¿Î¹ÏÎ±ÏƒÏ„ÎµÎ¯Ï„Îµ ÎºÏŒÎ»Ï€Î± hacking Ï…Ï€Î¿Î²Î¬Î»Î»Î¿Î½Ï„Î±Ï‚ PRs ÏƒÏ„Î±** [**HackTricks**](https://github.com/carlospolop/hacktricks) ÎºÎ±Î¹ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
