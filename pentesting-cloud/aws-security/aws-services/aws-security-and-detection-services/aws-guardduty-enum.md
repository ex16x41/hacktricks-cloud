# AWS - GuardDuty Enum

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## GuardDuty

According to the [**docs**](https://aws.amazon.com/guardduty/features/): GuardDutyã¯ã€**æ©Ÿæ¢°å­¦ç¿’ã€ç•°å¸¸æ¤œå‡ºã€ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ç›£è¦–ã€æ‚ªæ„ã®ã‚ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ç™ºè¦‹**ã‚’çµ„ã¿åˆã‚ã›ã€AWSãŠã‚ˆã³æ¥­ç•Œã®ä¸»è¦ãªã‚µãƒ¼ãƒ‰ãƒ‘ãƒ¼ãƒ†ã‚£ã‚½ãƒ¼ã‚¹ã‚’ä½¿ç”¨ã—ã¦ã€AWSä¸Šã®ãƒ¯ãƒ¼ã‚¯ãƒ­ãƒ¼ãƒ‰ã¨ãƒ‡ãƒ¼ã‚¿ã‚’ä¿è­·ã—ã¾ã™ã€‚GuardDutyã¯ã€AWS CloudTrailã‚¤ãƒ™ãƒ³ãƒˆãƒ­ã‚°ã€Amazon Virtual Private Cloud (VPC)ãƒ•ãƒ­ãƒ¼ãƒ­ã‚°ã€Amazon Elastic Kubernetes Service (EKS)ç›£æŸ»ãŠã‚ˆã³ã‚·ã‚¹ãƒ†ãƒ ãƒ¬ãƒ™ãƒ«ã®ãƒ­ã‚°ã€DNSã‚¯ã‚¨ãƒªãƒ­ã‚°ãªã©ã€è¤‡æ•°ã®AWSãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹ã«ã‚ãŸã£ã¦æ•°åå„„ã®ã‚¤ãƒ™ãƒ³ãƒˆã‚’åˆ†æã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

Amazon GuardDutyã¯ã€**ã‚¢ã‚«ã‚¦ãƒ³ãƒˆå†…ã®ç•°å¸¸ãªæ´»å‹•ã‚’ç‰¹å®š**ã—ã€ãã®æ´»å‹•ã®**ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£é–¢é€£æ€§**ã‚’åˆ†æã—ã€å‘¼ã³å‡ºã•ã‚ŒãŸ**ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ**ã‚’æä¾›ã—ã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€å¿œç­”è€…ã¯ã•ã‚‰ãªã‚‹èª¿æŸ»ã«æ™‚é–“ã‚’è²»ã‚„ã™ã¹ãã‹ã©ã†ã‹ã‚’åˆ¤æ–­ã§ãã¾ã™ã€‚

ã‚¢ãƒ©ãƒ¼ãƒˆã¯**GuardDutyã‚³ãƒ³ã‚½ãƒ¼ãƒ«ï¼ˆ90æ—¥é–“ï¼‰**ãŠã‚ˆã³CloudWatch Eventsã«è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚

{% hint style="warning" %}
ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒ**GuardDutyã‚’ç„¡åŠ¹ã«ã™ã‚‹ã¨**ã€AWSç’°å¢ƒã®ç›£è¦–ãŒåœæ­¢ã—ã€æ–°ã—ã„ç™ºè¦‹ã¯ä¸€åˆ‡ç”Ÿæˆã•ã‚Œãšã€**æ—¢å­˜ã®ç™ºè¦‹ã¯å¤±ã‚ã‚Œã¾ã™**ã€‚\
ãŸã åœæ­¢ã™ã‚‹ã ã‘ã®å ´åˆã€æ—¢å­˜ã®ç™ºè¦‹ã¯æ®‹ã‚Šã¾ã™ã€‚
{% endhint %}

### Findings Example

* **åµå¯Ÿ**: æ”»æ’ƒè€…ã«ã‚ˆã‚‹åµå¯Ÿã‚’ç¤ºå”†ã™ã‚‹æ´»å‹•ã€ä¾‹ãˆã°**ç•°å¸¸ãªAPIæ´»å‹•**ã€ç–‘ã‚ã—ã„ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹**ãƒ­ã‚°ã‚¤ãƒ³**è©¦è¡Œã€VPCå†…ã®**ãƒãƒ¼ãƒˆã‚¹ã‚­ãƒ£ãƒ³**ã€ç•°å¸¸ãªå¤±æ•—ã—ãŸãƒ­ã‚°ã‚¤ãƒ³è¦æ±‚ãƒ‘ã‚¿ãƒ¼ãƒ³ã€ã¾ãŸã¯æ—¢çŸ¥ã®æ‚ªæ„ã®ã‚ã‚‹IPã‹ã‚‰ã®ãƒ–ãƒ­ãƒƒã‚¯ã•ã‚Œã¦ã„ãªã„ãƒãƒ¼ãƒˆã®ãƒ—ãƒ­ãƒ¼ãƒ“ãƒ³ã‚°ã€‚
* **ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®ä¾µå®³**: ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®ä¾µå®³ã‚’ç¤ºã™æ´»å‹•ã€ä¾‹ãˆã°**æš—å·é€šè²¨ãƒã‚¤ãƒ‹ãƒ³ã‚°ã€ãƒãƒƒã‚¯ãƒ‰ã‚¢ã‚³ãƒãƒ³ãƒ‰ãŠã‚ˆã³ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ï¼ˆC\&Cï¼‰**æ´»å‹•ã€ãƒ‰ãƒ¡ã‚¤ãƒ³ç”Ÿæˆã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ï¼ˆDGAï¼‰ã‚’ä½¿ç”¨ã™ã‚‹ãƒãƒ«ã‚¦ã‚§ã‚¢ã€å¤–å‘ãã®ã‚µãƒ¼ãƒ“ã‚¹æ‹’å¦æ´»å‹•ã€ç•°å¸¸ã«**é«˜ã„ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯**ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯é‡ã€ç•°å¸¸ãªãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã€æ—¢çŸ¥ã®æ‚ªæ„ã®ã‚ã‚‹IPã¨ã®å¤–å‘ãã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹é€šä¿¡ã€å¤–éƒ¨IPã‚¢ãƒ‰ãƒ¬ã‚¹ã«ã‚ˆã£ã¦ä½¿ç”¨ã•ã‚Œã‚‹ä¸€æ™‚çš„ãªAmazon EC2è³‡æ ¼æƒ…å ±ã€DNSã‚’ä½¿ç”¨ã—ãŸãƒ‡ãƒ¼ã‚¿ã®æµå‡ºã€‚
* **ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®ä¾µå®³**: ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®ä¾µå®³ã‚’ç¤ºã™ä¸€èˆ¬çš„ãªãƒ‘ã‚¿ãƒ¼ãƒ³ã«ã¯ã€ç•°å¸¸ãªåœ°ç†çš„ä½ç½®ã¾ãŸã¯åŒ¿åãƒ—ãƒ­ã‚­ã‚·ã‹ã‚‰ã®APIå‘¼ã³å‡ºã—ã€AWS CloudTrailãƒ­ã‚°ã®ç„¡åŠ¹åŒ–ã®è©¦ã¿ã€ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒãƒªã‚·ãƒ¼ã‚’å¼±ã‚ã‚‹å¤‰æ›´ã€ç•°å¸¸ãªã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã¾ãŸã¯ã‚¤ãƒ³ãƒ•ãƒ©ã®èµ·å‹•ã€ç•°å¸¸ãªåœ°åŸŸã§ã®ã‚¤ãƒ³ãƒ•ãƒ©ã®å±•é–‹ã€è³‡æ ¼æƒ…å ±ã®ç›—é›£ã€ç–‘ã‚ã—ã„ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ­ã‚°ã‚¤ãƒ³æ´»å‹•ã€æ—¢çŸ¥ã®æ‚ªæ„ã®ã‚ã‚‹IPã‚¢ãƒ‰ãƒ¬ã‚¹ã‹ã‚‰ã®APIå‘¼ã³å‡ºã—ãŒå«ã¾ã‚Œã¾ã™ã€‚
* **ãƒã‚±ãƒƒãƒˆã®ä¾µå®³**: è³‡æ ¼æƒ…å ±ã®èª¤ç”¨ã‚’ç¤ºã™ç–‘ã‚ã—ã„ãƒ‡ãƒ¼ã‚¿ã‚¢ã‚¯ã‚»ã‚¹ãƒ‘ã‚¿ãƒ¼ãƒ³ã€ãƒªãƒ¢ãƒ¼ãƒˆãƒ›ã‚¹ãƒˆã‹ã‚‰ã®ç•°å¸¸ãªAmazon S3 APIæ´»å‹•ã€æ—¢çŸ¥ã®æ‚ªæ„ã®ã‚ã‚‹IPã‚¢ãƒ‰ãƒ¬ã‚¹ã‹ã‚‰ã®ç„¡è¨±å¯ã®S3ã‚¢ã‚¯ã‚»ã‚¹ã€ã¾ãŸã¯ãƒã‚±ãƒƒãƒˆã«ã‚¢ã‚¯ã‚»ã‚¹ã—ãŸå‰æ­´ã®ãªã„ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‹ã‚‰ã®S3ãƒã‚±ãƒƒãƒˆå†…ã®ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã™ã‚‹ãŸã‚ã®APIå‘¼ã³å‡ºã—ã‚’ç¤ºã™æ´»å‹•ã€‚Amazon GuardDutyã¯ã€ã™ã¹ã¦ã®Amazon S3ãƒã‚±ãƒƒãƒˆã«ã‚ãŸã£ã¦ç–‘ã‚ã—ã„æ´»å‹•ã‚’æ¤œå‡ºã™ã‚‹ãŸã‚ã«ã€AWS CloudTrail S3ãƒ‡ãƒ¼ã‚¿ã‚¤ãƒ™ãƒ³ãƒˆï¼ˆä¾‹ï¼šGetObjectã€ListObjectsã€DeleteObjectï¼‰ã‚’ç¶™ç¶šçš„ã«ç›£è¦–ãŠã‚ˆã³åˆ†æã—ã¾ã™ã€‚

<details>

<summary>Finding Information</summary>

Finding summary:

* Finding type
* Severity: 7-8.9 é«˜, 4-6.9 ä¸­, 01-3.9 ä½
* Region
* Account ID
* Resource ID
* Time of detection
* Which threat list was used

The body has this information:

* Resource affected
* Action
* Actor: Ip address, port and domain
* Additional Information

</details>

### All Findings

Access a list of all the GuardDuty findings in: [https://docs.aws.amazon.com/guardduty/latest/ug/guardduty\_finding-types-active.html](https://docs.aws.amazon.com/guardduty/latest/ug/guardduty\_finding-types-active.html)

### Multi Accounts

#### By Invitation

ä»–ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ç•°ãªã‚‹AWS GuardDutyã‚¢ã‚«ã‚¦ãƒ³ãƒˆã«**æ‹›å¾…**ã™ã‚‹ã“ã¨ãŒã§ãã€**ã™ã¹ã¦ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãŒåŒã˜GuardDutyã‹ã‚‰ç›£è¦–ã•ã‚Œã¾ã™**ã€‚ãƒã‚¹ã‚¿ãƒ¼ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãŒãƒ¡ãƒ³ãƒãƒ¼ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’æ‹›å¾…ã—ã€ãƒ¡ãƒ³ãƒãƒ¼ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®ä»£è¡¨è€…ãŒæ‹›å¾…ã‚’å—ã‘å…¥ã‚Œã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

#### Via Organization

çµ„ç¹”å†…ã®ä»»æ„ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’**GuardDutyã®å§”ä»»ç®¡ç†è€…**ã¨ã—ã¦æŒ‡å®šã§ãã¾ã™ã€‚å§”ä»»ç®¡ç†è€…ã‚’æŒ‡å®šã§ãã‚‹ã®ã¯ã€çµ„ç¹”ã®ç®¡ç†ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®ã¿ã§ã™ã€‚

å§”ä»»ç®¡ç†è€…ã¨ã—ã¦æŒ‡å®šã•ã‚ŒãŸã‚¢ã‚«ã‚¦ãƒ³ãƒˆã¯ã€GuardDutyç®¡ç†è€…ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã¨ãªã‚Šã€æŒ‡å®šã•ã‚ŒãŸAWSãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã§GuardDutyãŒè‡ªå‹•çš„ã«æœ‰åŠ¹ã«ãªã‚Šã€ãã®ãƒªãƒ¼ã‚¸ãƒ§ãƒ³å†…ã®ã™ã¹ã¦ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã«å¯¾ã—ã¦GuardDutyã‚’æœ‰åŠ¹ã«ã—ã€ç®¡ç†ã™ã‚‹**æ¨©é™ã‚’æŒã¡ã¾ã™**ã€‚çµ„ç¹”å†…ã®ä»–ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã¯ã€ã“ã®å§”ä»»ç®¡ç†è€…ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã«é–¢é€£ä»˜ã‘ã‚‰ã‚ŒãŸGuardDutyãƒ¡ãƒ³ãƒãƒ¼ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã¨ã—ã¦è¡¨ç¤ºãŠã‚ˆã³è¿½åŠ ã§ãã¾ã™ã€‚

## Enumeration

{% code overflow="wrap" %}
```bash
# Get Org config
aws guardduty list-organization-admin-accounts #Get Delegated Administrator
aws guardduty describe-organization-configuration --detector-id <id>

# Check external invitations
aws guardduty list-invitations
aws guardduty get-invitations-count

# Detector Information
aws guardduty list-detectors # 1 detector per account with GuardDuty
aws guardduty get-detector --detector-id <id> # Get detector info
aws guardduty get-master-account --detector-id <id>

# Get filters
aws guardduty list-filters --detector-id <id> # Check filters
aws guardduty get-filter --detector-id <id> --filter-name <name>

# Findings
aws guardduty list-findings --detector-id <id> # List findings
aws guardduty get-findings --detector-id <id> --finding-ids <id> # Get details about the finding
aws guardduty get-findings-statistics --detector-id <id> --finding-statistic-types <types>

# Get trusted IP addresses
aws guardduty list-ip-sets --detector-id <id>
aws guardduty get-ip-set --detector-id <id>

# Member accounts of the current AWS GuardDuty master account
aws guardduty list-members --detector-id <id>
aws guardduty get-members --detector-id <id> --account-ids <id>
aws guardduty get-member-detectors --detector-id <id> --account-ids <id>

# Continuously export its findings to an Amazon S3 bucket
aws guardduty list-publishing-destinations --detector-id <id>

# Intelligence sets that you have uploaded to GuardDuty
aws guardduty list-threat-intel-sets --detector-id <id>
aws guardduty get-threat-intel-set --detector-id <id> --threat-intel-set-id <id>
```
{% endcode %}

## GuardDuty ãƒã‚¤ãƒ‘ã‚¹

### ä¸€èˆ¬çš„ãªã‚¬ã‚¤ãƒ€ãƒ³ã‚¹

ä½¿ç”¨ã™ã‚‹è³‡æ ¼æƒ…å ±ã®å‹•ä½œã«ã¤ã„ã¦ã§ãã‚‹ã ã‘å¤šãã®æƒ…å ±ã‚’åé›†ã—ã¦ãã ã•ã„ï¼š

* ä½¿ç”¨ã•ã‚Œã‚‹æ™‚é–“
* å ´æ‰€
* ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ / ã‚µãƒ¼ãƒ“ã‚¹ï¼ˆawscliã€webconsoleã€lambda ãªã©ã‹ã‚‰ä½¿ç”¨ã•ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ï¼‰
* å®šæœŸçš„ã«ä½¿ç”¨ã•ã‚Œã‚‹æ¨©é™

ã“ã®æƒ…å ±ã‚’ã‚‚ã¨ã«ã€ã‚¢ã‚¯ã‚»ã‚¹ã‚’ä½¿ç”¨ã™ã‚‹ãŸã‚ã«ã§ãã‚‹ã ã‘åŒã˜ã‚·ãƒŠãƒªã‚ªã‚’å†ç¾ã—ã¦ãã ã•ã„ï¼š

* **ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã‚ˆã£ã¦ã‚¢ã‚¯ã‚»ã‚¹ã•ã‚Œã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¾ãŸã¯ãƒ­ãƒ¼ãƒ«**ã®å ´åˆã€åŒã˜æ™‚é–“å¸¯ã€åŒã˜åœ°ç†çš„ä½ç½®ï¼ˆå¯èƒ½ã§ã‚ã‚Œã°åŒã˜ISPã¨IPï¼‰ã‹ã‚‰ä½¿ç”¨ã—ã¦ãã ã•ã„
* **ã‚µãƒ¼ãƒ“ã‚¹ã«ã‚ˆã£ã¦ä½¿ç”¨ã•ã‚Œã‚‹ãƒ­ãƒ¼ãƒ«**ã®å ´åˆã€åŒã˜ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã«åŒã˜ã‚µãƒ¼ãƒ“ã‚¹ã‚’ä½œæˆã—ã€åŒã˜æ™‚é–“ç¯„å›²ã‹ã‚‰ãã“ã‹ã‚‰ä½¿ç”¨ã—ã¦ãã ã•ã„
* ã“ã®ãƒ—ãƒªãƒ³ã‚·ãƒ‘ãƒ«ãŒä½¿ç”¨ã—ãŸ**åŒã˜æ¨©é™**ã‚’å¸¸ã«ä½¿ç”¨ã™ã‚‹ã‚ˆã†ã«ã—ã¦ãã ã•ã„
* **ä»–ã®æ¨©é™ã‚’ä½¿ç”¨ã™ã‚‹å¿…è¦ãŒã‚ã‚‹å ´åˆã‚„æ¨©é™ã‚’æ‚ªç”¨ã™ã‚‹å ´åˆ**ï¼ˆä¾‹ãˆã°ã€1,000,000ã®cloudtrailãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ãªã©ï¼‰ã€**ã‚†ã£ãã‚Š**è¡Œã„ã€AWSã¨ã®**æœ€å°é™ã®ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³**ã§è¡Œã£ã¦ãã ã•ã„ï¼ˆawscliã¯æ™‚ã€…ã€æ›¸ãè¾¼ã¿ã®å‰ã«ã„ãã¤ã‹ã®èª­ã¿å–ã‚ŠAPIã‚’å‘¼ã³å‡ºã—ã¾ã™ï¼‰

### GuardDutyã®ç ´å£Š

#### `guardduty:UpdateDetector`

ã“ã®æ¨©é™ã‚’ä½¿ç”¨ã™ã‚‹ã¨ã€ã‚¢ãƒ©ãƒ¼ãƒˆã‚’ãƒˆãƒªã‚¬ãƒ¼ã—ãªã„ã‚ˆã†ã«GuardDutyã‚’ç„¡åŠ¹ã«ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

{% code overflow="wrap" %}
```bash
aws guardduty update-detector --detector-id <detector-id> --no-enable
aws guardduty update-detector --detector-id <detector-id> --data-sources S3Logs={Enable=false}
```
{% endcode %}

#### `guardduty:CreateFilter`

ã“ã®æ¨©é™ã‚’æŒã¤æ”»æ’ƒè€…ã¯ã€**ç™ºè¦‹ã®è‡ªå‹•**ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ã®ãŸã‚ã®ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚’**ä½¿ç”¨ã™ã‚‹**èƒ½åŠ›ãŒã‚ã‚Šã¾ã™ï¼š

{% code overflow="wrap" %}
```bash
aws guardduty create-filter  --detector-id <detector-id> --name <filter-name> --finding-criteria file:///tmp/criteria.json --action ARCHIVE
```
{% endcode %}

#### `iam:PutRolePolicy`, (`guardduty:CreateIPSet`|`guardduty:UpdateIPSet`)

ä»¥å‰ã®æ¨©é™ã‚’æŒã¤æ”»æ’ƒè€…ã¯ã€GuardDutyã®[**ä¿¡é ¼ã•ã‚ŒãŸIPãƒªã‚¹ãƒˆ**](https://docs.aws.amazon.com/guardduty/latest/ug/guardduty\_upload-lists.html)ã‚’å¤‰æ›´ã—ã€è‡ªåˆ†ã®IPã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’è¿½åŠ ã™ã‚‹ã“ã¨ã§ã‚¢ãƒ©ãƒ¼ãƒˆã®ç”Ÿæˆã‚’å›é¿ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

{% code overflow="wrap" %}
```bash
aws guardduty update-ip-set --detector-id <detector-id> --activate --ip-set-id <ip-set-id> --location https://some-bucket.s3-eu-west-1.amazonaws.com/attacker.csv
```
{% endcode %}

#### `guardduty:DeletePublishingDestination`

æ”»æ’ƒè€…ã¯ã‚¢ãƒ©ãƒ¼ãƒˆã‚’é˜²ããŸã‚ã«å®›å…ˆã‚’å‰Šé™¤ã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ï¼š

{% code overflow="wrap" %}
```bash
aws guardduty delete-publishing-destination --detector-id <detector-id> --destination-id <dest-id>
```
{% endcode %}

{% hint style="danger" %}
ã“ã®å…¬é–‹å…ˆã‚’å‰Šé™¤ã—ã¦ã‚‚ã€**GuardDutyã‚³ãƒ³ã‚½ãƒ¼ãƒ«å†…ã®ç™ºè¦‹ã®ç”Ÿæˆã‚„å¯è¦–æ€§ã«ã¯å½±éŸ¿ã—ã¾ã›ã‚“**ã€‚GuardDutyã¯å¼•ãç¶šãã€AWSç’°å¢ƒå†…ã®ã‚¤ãƒ™ãƒ³ãƒˆã‚’åˆ†æã—ã€ç–‘ã‚ã—ã„ã¾ãŸã¯äºˆæœŸã—ãªã„å‹•ä½œã‚’ç‰¹å®šã—ã€ç™ºè¦‹ã‚’ç”Ÿæˆã—ã¾ã™ã€‚
{% endhint %}

### ç‰¹å®šã®ç™ºè¦‹ãƒã‚¤ãƒ‘ã‚¹ã®ä¾‹

GuardDutyã®ç™ºè¦‹ã¯æ•°åç¨®é¡ã‚ã‚Šã¾ã™ãŒã€**Red Teamerã¨ã—ã¦ã¯ã™ã¹ã¦ãŒã‚ãªãŸã«å½±éŸ¿ã™ã‚‹ã‚ã‘ã§ã¯ã‚ã‚Šã¾ã›ã‚“**ã€‚ã•ã‚‰ã«è‰¯ã„ã“ã¨ã«ã€å„ç™ºè¦‹ã®**å®Œå…¨ãªãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãŒ** [https://docs.aws.amazon.com/guardduty/latest/ug/guardduty\_finding-types-active.html](https://docs.aws.amazon.com/guardduty/latest/ug/guardduty\_finding-types-active.html) ã«ã‚ã‚‹ã®ã§ã€è¡Œå‹•ã‚’èµ·ã“ã™å‰ã«ç¢ºèªã—ã¦æ•ã¾ã‚‰ãªã„ã‚ˆã†ã«ã—ã¦ãã ã•ã„ã€‚

ã“ã“ã«ç‰¹å®šã®GuardDutyç™ºè¦‹ã®ãƒã‚¤ãƒ‘ã‚¹ã®ã„ãã¤ã‹ã®ä¾‹ãŒã‚ã‚Šã¾ã™ï¼š

#### [PenTest:IAMUser/KaliLinux](https://docs.aws.amazon.com/guardduty/latest/ug/guardduty\_finding-types-iam.html#pentest-iam-kalilinux) <a href="#pentest-iam-kalilinux" id="pentest-iam-kalilinux"></a>

GuardDutyã¯ä¸€èˆ¬çš„ãªãƒšãƒãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ†ã‚¹ãƒˆãƒ„ãƒ¼ãƒ«ã‹ã‚‰ã®AWS APIãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’æ¤œå‡ºã—ã€[PenTest Finding](https://docs.aws.amazon.com/guardduty/latest/ug/guardduty\_finding-types-iam.html#pentest-iam-kalilinux)ã‚’ãƒˆãƒªã‚¬ãƒ¼ã—ã¾ã™ã€‚\
ã“ã‚Œã¯APIãƒªã‚¯ã‚¨ã‚¹ãƒˆã«æ¸¡ã•ã‚Œã‚‹**ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå**ã«ã‚ˆã£ã¦æ¤œå‡ºã•ã‚Œã¾ã™ã€‚\
ã—ãŸãŒã£ã¦ã€**ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’å¤‰æ›´ã™ã‚‹ã“ã¨ã§**ã€GuardDutyãŒæ”»æ’ƒã‚’æ¤œå‡ºã™ã‚‹ã®ã‚’é˜²ãã“ã¨ãŒå¯èƒ½ã§ã™ã€‚

ã“ã‚Œã‚’é˜²ããŸã‚ã«ã€`botocore`ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸å†…ã®`session.py`ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’æ¤œç´¢ã—ã¦ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’å¤‰æ›´ã™ã‚‹ã‹ã€Burp Suiteã‚’AWS CLIãƒ—ãƒ­ã‚­ã‚·ã¨ã—ã¦è¨­å®šã—ã€MitMã§ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’å¤‰æ›´ã™ã‚‹ã‹ã€ã¾ãŸã¯Ubuntuã€Macã€Windowsã®ã‚ˆã†ãªOSã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã§ã€ã“ã®ã‚¢ãƒ©ãƒ¼ãƒˆãŒãƒˆãƒªã‚¬ãƒ¼ã•ã‚Œã‚‹ã®ã‚’é˜²ãã“ã¨ãŒã§ãã¾ã™ã€‚

#### UnauthorizedAccess:IAMUser/InstanceCredentialExfiltration

EC2ã®è³‡æ ¼æƒ…å ±ã‚’ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚µãƒ¼ãƒ“ã‚¹ã‹ã‚‰æŠ½å‡ºã—ã€**AWSç’°å¢ƒå¤–ã§åˆ©ç”¨ã™ã‚‹**ã¨ã€[**`UnauthorizedAccess:IAMUser/InstanceCredentialExfiltration.OutsideAWS`**](https://docs.aws.amazon.com/guardduty/latest/ug/guardduty\_finding-types-iam.html#unauthorizedaccess-iam-instancecredentialexfiltrationoutsideaws)ã‚¢ãƒ©ãƒ¼ãƒˆãŒç™ºå‹•ã—ã¾ã™ã€‚é€†ã«ã€ã“ã‚Œã‚‰ã®è³‡æ ¼æƒ…å ±ã‚’EC2ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‹ã‚‰ä½¿ç”¨ã™ã‚‹ã¨ã€[**`UnauthorizedAccess:IAMUser/InstanceCredentialExfiltration.InsideAWS`**](https://docs.aws.amazon.com/guardduty/latest/ug/guardduty\_finding-types-iam.html#unauthorizedaccess-iam-instancecredentialexfiltrationinsideaws)ã‚¢ãƒ©ãƒ¼ãƒˆãŒãƒˆãƒªã‚¬ãƒ¼ã•ã‚Œã¾ã™ã€‚ã—ã‹ã—ã€**åŒã˜ã‚¢ã‚«ã‚¦ãƒ³ãƒˆå†…ã®åˆ¥ã®ä¾µå®³ã•ã‚ŒãŸEC2ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã§è³‡æ ¼æƒ…å ±ã‚’ä½¿ç”¨ã™ã‚‹ã¨ã€æ¤œå‡ºã•ã‚Œãšã€ã‚¢ãƒ©ãƒ¼ãƒˆã¯ç™ºç”Ÿã—ã¾ã›ã‚“**ã€‚

{% hint style="success" %}
ã—ãŸãŒã£ã¦ã€**è¦‹ã¤ã‘ãŸãƒã‚·ãƒ³å†…ã‹ã‚‰æŠ½å‡ºã•ã‚ŒãŸè³‡æ ¼æƒ…å ±ã‚’ä½¿ç”¨ã—ã¦ã€ã“ã®ã‚¢ãƒ©ãƒ¼ãƒˆã‚’ãƒˆãƒªã‚¬ãƒ¼ã—ãªã„ã‚ˆã†ã«ã—ã¦ãã ã•ã„**ã€‚
{% endhint %}

## å‚è€ƒæ–‡çŒ®

* [https://docs.aws.amazon.com/guardduty/latest/ug/guardduty\_finding-types-active.html](https://docs.aws.amazon.com/guardduty/latest/ug/guardduty\_finding-types-active.html)
* [https://docs.aws.amazon.com/guardduty/latest/ug/findings\_suppression-rule.html](https://docs.aws.amazon.com/guardduty/latest/ug/findings\_suppression-rule.html)
* [https://docs.aws.amazon.com/guardduty/latest/ug/guardduty\_upload-lists.html](https://docs.aws.amazon.com/guardduty/latest/ug/guardduty\_upload-lists.html)
* [https://docs.aws.amazon.com/cli/latest/reference/guardduty/delete-publishing-destination.html](https://docs.aws.amazon.com/cli/latest/reference/guardduty/delete-publishing-destination.html)
* [https://docs.aws.amazon.com/guardduty/latest/ug/guardduty\_finding-types-ec2.html#unauthorizedaccess-ec2-torclient](https://docs.aws.amazon.com/guardduty/latest/ug/guardduty\_finding-types-ec2.html#unauthorizedaccess-ec2-torclient)
* [https://docs.aws.amazon.com/guardduty/latest/ug/guardduty\_finding-types-iam.html#unauthorizedaccess-iam-instancecredentialexfiltrationoutsideaws](https://docs.aws.amazon.com/guardduty/latest/ug/guardduty\_finding-types-iam.html#unauthorizedaccess-iam-instancecredentialexfiltrationoutsideaws)
* [https://docs.aws.amazon.com/guardduty/latest/ug/guardduty\_finding-types-iam.html#unauthorizedaccess-iam-instancecredentialexfiltrationinsideaws](https://docs.aws.amazon.com/guardduty/latest/ug/guardduty\_finding-types-iam.html#unauthorizedaccess-iam-instancecredentialexfiltrationinsideaws)
* [https://docs.aws.amazon.com/whitepapers/latest/aws-privatelink/what-are-vpc-endpoints.html](https://docs.aws.amazon.com/whitepapers/latest/aws-privatelink/what-are-vpc-endpoints.html)

{% hint style="success" %}
AWSãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã³ã€å®Ÿè·µã™ã‚‹ï¼š<img src="../../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">\
GCPãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã³ã€å®Ÿè·µã™ã‚‹ï¼š<img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricksã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹</summary>

* [**ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³**](https://github.com/sponsors/carlospolop)ã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼
* **ğŸ’¬ [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã¾ãŸã¯[**ãƒ†ãƒ¬ã‚°ãƒ©ãƒ ã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«å‚åŠ ã™ã‚‹ã‹ã€**Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**ã‚’ãƒ•ã‚©ãƒ­ãƒ¼ã—ã¦ãã ã•ã„ã€‚**
* **ãƒãƒƒã‚­ãƒ³ã‚°ã®ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã™ã‚‹ãŸã‚ã«ã€[**HackTricks**](https://github.com/carlospolop/hacktricks)ãŠã‚ˆã³[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)ã®GitHubãƒªãƒã‚¸ãƒˆãƒªã«PRã‚’æå‡ºã—ã¦ãã ã•ã„ã€‚**

</details>
{% endhint %}
