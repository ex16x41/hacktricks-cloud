# AWS - Macie Enum

{% hint style="success" %}
Ucz si i praktykuj Hacking w AWS:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Ucz si i praktykuj Hacking w GCP: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Wesprzyj HackTricks</summary>

* Sprawd藕 [**plany subskrypcyjne**](https://github.com/sponsors/carlospolop)!
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **led藕** nas na **Twitterze**  [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Dziel si trikami hakerskimi, przesyajc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) na githubie.

</details>
{% endhint %}

# Macie

Amazon Macie wyr贸偶nia si jako usuga zaprojektowana do **automatycznego wykrywania, klasyfikowania i identyfikowania danych** w ramach konta AWS. Wykorzystuje **uczenie maszynowe** do cigego monitorowania i analizowania danych, g贸wnie skupiajc si na wykrywaniu i alarmowaniu w przypadku nietypowych lub podejrzanych dziaa poprzez analiz danych z **cloud trail event** oraz wzorce zachowa u偶ytkownik贸w.

G贸wne funkcje Amazon Macie:

1. **Aktywne Przegldanie Danych**: Wykorzystuje uczenie maszynowe do aktywnego przegldania danych w miar r贸偶nych akcji zachodzcych w koncie AWS.
2. **Wykrywanie Anomalii**: Identyfikuje nieregularne dziaania lub wzorce dostpu, generujc alerty w celu zmniejszenia potencjalnych ryzyk zwizanych z ujawnieniem danych.
3. **Monitorowanie Cige**: Automatycznie monitoruje i wykrywa nowe dane w Amazon S3, wykorzystujc uczenie maszynowe i sztuczn inteligencj do dostosowywania si do wzorc贸w dostpu do danych w czasie.
4. **Klasyfikacja Danych z NLP**: Wykorzystuje przetwarzanie jzyka naturalnego (NLP) do klasyfikowania i interpretowania r贸偶nych typ贸w danych, przypisujc wynikom punktacje ryzyka w celu priorytetyzacji wynik贸w.
5. **Monitorowanie Bezpieczestwa**: Identyfikuje dane wra偶liwe pod wzgldem bezpieczestwa, w tym klucze API, klucze prywatne i dane osobowe, pomagajc zapobiega wyciekom danych.

Amazon Macie jest usug **regionaln** i wymaga roli IAM 'AWSMacieServiceCustomerSetupRole' oraz wczonego AWS CloudTrail do funkcjonowania.

## System Alert贸w

Macie kategoryzuje alerty na predefiniowane kategorie, takie jak:

- Anonimowy dostp
- Zgodno danych
- Utrata powiadcze
- Eskalacja uprawnie
- Ransomware
- Podejrzany dostp, itp.

Te alerty zapewniaj szczeg贸owe opisy i podziay wynik贸w dla skutecznej reakcji i rozwizania.

## Funkcje Dashboardu

Dashboard kategoryzuje dane na r贸偶ne sekcje, w tym:

- Obiekty S3 (wedug zakresu czasu, ACL, PII)
- Wydarzenia/U偶ytkownicy o wysokim ryzyku w CloudTrail
- Lokalizacje aktywnoci
- Typy to偶samoci u偶ytkownik贸w CloudTrail, i inne.

## Kategoryzacja U偶ytkownik贸w

U偶ytkownicy s klasyfikowani na poziomy na podstawie poziomu ryzyka ich wywoa API:

- **Platynowy**: Wywoania API o wysokim ryzyku, czsto z uprawnieniami administratora.
- **Zoty**: Wywoania API zwizane z infrastruktur.
- **Srebrny**: Wywoania API o rednim ryzyku.
- **Brzowy**: Wywoania API o niskim ryzyku.

## Typy To偶samoci

Typy to偶samoci obejmuj Root, U偶ytkownik IAM, Przyjta Rola, U偶ytkownik Federowany, Konto AWS i Usug AWS, wskazujc 藕r贸do 偶da.

## Klasyfikacja Danych

Klasyfikacja danych obejmuje:

- Typ Zawartoci: Na podstawie wykrytego typu zawartoci.
- Rozszerzenie Pliku: Na podstawie rozszerzenia pliku.
- Temat: Kategoryzowane wedug s贸w kluczowych w plikach.
- Regex: Kategoryzowane na podstawie okrelonych wzorc贸w regex.

Najwy偶sze ryzyko wr贸d tych kategorii okrela ostateczny poziom ryzyka pliku.

## Badania i Analizy

Funkcja badawcza Amazon Macie pozwala na niestandardowe zapytania we wszystkich danych Macie w celu gbokiej analizy. Filtry obejmuj Dane CloudTrail, Waciwoci Kuba S3 i Obiekty S3. Ponadto obsuguje zapraszanie innych kont do udostpniania Amazon Macie, uatwiajc wsp贸lne zarzdzanie danymi i monitorowanie bezpieczestwa.


## Wyliczenie
```
# Get buckets
aws macie2 describe-buckets

# Org config
aws macie2 describe-organization-configuration

# Get admin account (if any)
aws macie2 get-administrator-account
aws macie2 list-organization-admin-accounts # Run from the management account of the org

# Get macie account members (run this form the admin account)
aws macie2 list-members

# Check if automated sensitive data discovey is enabled
aws macie2 get-automated-discovery-configuration

# Get findings
aws macie2 list-findings
aws macie2 get-findings --finding-ids <ids>
aws macie2 list-findings-filters
aws macie2 get -findings-filters --id <id>

# Get allow lists
aws macie2 list-allow-lists
aws macie2 get-allow-list --id <id>

# Get different info
aws macie2 list-classification-jobs
aws macie2 list-classification-scopes
aws macie2 list-custom-data-identifiers
```
### Post Eksploatacja

{% hint style="success" %}
Z perspektywy atakujcego, usuga ta nie jest przeznaczona do wykrywania atakujcego, ale do wykrywania wra偶liwych informacji w przechowywanych plikach. Dlatego ta usuga mo偶e **pom贸c atakujcemu znale藕 wra偶liwe informacje** wewntrz kubek贸w.\
Jednak atakujcy mo偶e tak偶e by zainteresowany zak贸ceniem jej dziaania, aby uniemo偶liwi ofierze otrzymywanie alert贸w i atwiej ukra te informacje.
{% endhint %}

TODO: PRy s mile widziane!

# Odnoniki
* [https://cloudacademy.com/blog/introducing-aws-security-hub/](https://cloudacademy.com/blog/introducing-aws-security-hub/)

{% hint style="success" %}
Dowiedz si i wicz Hacking AWS:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Dowiedz si i wicz Hacking GCP: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Wesprzyj HackTricks</summary>

* Sprawd藕 [**plany subskrypcyjne**](https://github.com/sponsors/carlospolop)!
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **led藕** nas na **Twitterze**  [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podziel si trikami hakerskimi, przesyajc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
