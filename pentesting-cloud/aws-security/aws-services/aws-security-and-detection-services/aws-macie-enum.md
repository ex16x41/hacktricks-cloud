# AWS - Macie Enum

## AWS - Macie Enum

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Macie

Amazon Macie hebt sich als ein Dienst hervor, der **automatisch Daten innerhalb eines AWS-Kontos erkennen, klassifizieren und identifizieren** kann. Er nutzt **maschinelles Lernen**, um Daten kontinuierlich zu √ºberwachen und zu analysieren, wobei der Schwerpunkt auf der Erkennung und Alarmierung bei ungew√∂hnlichen oder verd√§chtigen Aktivit√§ten liegt, indem **CloudTrail-Ereignisdaten** und Benutzerverhaltensmuster untersucht werden.

Wichtige Funktionen von Amazon Macie:

1. **Aktive Daten√ºberpr√ºfung**: Nutzt maschinelles Lernen, um Daten aktiv zu √ºberpr√ºfen, w√§hrend verschiedene Aktionen im AWS-Konto stattfinden.
2. **Anomalieerkennung**: Identifiziert unregelm√§√üige Aktivit√§ten oder Zugriffsverhalten und generiert Alarme, um potenzielle Risiken f√ºr die Datensicherheit zu mindern.
3. **Kontinuierliche √úberwachung**: √úberwacht und erkennt automatisch neue Daten in Amazon S3 und verwendet maschinelles Lernen und k√ºnstliche Intelligenz, um sich im Laufe der Zeit an Zugriffsverhalten anzupassen.
4. **Datenklassifizierung mit NLP**: Nutzt die Verarbeitung nat√ºrlicher Sprache (NLP), um verschiedene Datentypen zu klassifizieren und zu interpretieren, wobei Risikopunkte zugewiesen werden, um die Ergebnisse zu priorisieren.
5. **Sicherheits√ºberwachung**: Identifiziert sicherheitsrelevante Daten, einschlie√ülich API-Schl√ºssel, geheimer Schl√ºssel und pers√∂nlicher Informationen, um Datenlecks zu verhindern.

Amazon Macie ist ein **regionaler Dienst** und erfordert die IAM-Rolle 'AWSMacieServiceCustomerSetupRole' sowie einen aktivierten AWS CloudTrail f√ºr die Funktionalit√§t.

### Alarmsystem

Macie kategorisiert Alarme in vordefinierte Kategorien wie:

* Anonymisierter Zugriff
* Datenkonformit√§t
* Verlust von Anmeldeinformationen
* Privilegieneskalation
* Ransomware
* Verd√§chtiger Zugriff usw.

Diese Alarme bieten detaillierte Beschreibungen und Ergebnisanalysen f√ºr eine effektive Reaktion und L√∂sung.

### Dashboard-Funktionen

Das Dashboard kategorisiert Daten in verschiedene Abschnitte, einschlie√ülich:

* S3-Objekte (nach Zeitbereich, ACL, PII)
* Hochrisiko-CloudTrail-Ereignisse/-Benutzer
* Aktivit√§tsstandorte
* CloudTrail-Benutzeridentit√§tstypen und mehr.

### Benutzerkategorisierung

Benutzer werden basierend auf dem Risikoniveau ihrer API-Aufrufe in Stufen klassifiziert:

* **Platin**: Hochrisiko-API-Aufrufe, oft mit Administratorrechten.
* **Gold**: Infrastrukturbezogene API-Aufrufe.
* **Silber**: Mittelrisiko-API-Aufrufe.
* **Bronze**: Niedrigrisiko-API-Aufrufe.

### Identit√§tstypen

Identit√§tstypen umfassen Root, IAM-Benutzer, Angenommene Rolle, F√∂derierter Benutzer, AWS-Konto und AWS-Dienst, die die Quelle der Anfragen anzeigen.

### Datenklassifizierung

Die Datenklassifizierung umfasst:

* Inhaltstyp: Basierend auf dem erkannten Inhaltstyp.
* Dateierweiterung: Basierend auf der Dateierweiterung.
* Thema: Kategorisiert nach Schl√ºsselw√∂rtern innerhalb von Dateien.
* Regex: Kategorisiert basierend auf spezifischen Regex-Mustern.

Das h√∂chste Risiko unter diesen Kategorien bestimmt das endg√ºltige Risikoniveau der Datei.

### Forschung und Analyse

Die Forschungsfunktion von Amazon Macie erm√∂glicht benutzerdefinierte Abfragen √ºber alle Macie-Daten f√ºr eine eingehende Analyse. Filter umfassen CloudTrail-Daten, S3-Bucket-Eigenschaften und S3-Objekte. Dar√ºber hinaus unterst√ºtzt es die Einladung anderer Konten zur gemeinsamen Nutzung von Amazon Macie, um die gemeinsame Datenverwaltung und Sicherheits√ºberwachung zu erleichtern.

### Enumeration
```
# Get buckets
aws macie2 describe-buckets

# Org config
aws macie2 describe-organization-configuration

# Get admin account (if any)
aws macie2 get-administrator-account
aws macie2 list-organization-admin-accounts # Run from the management account of the org

# Get macie account members (run this form the admin account)
aws macie2 list-members

# Check if automated sensitive data discovey is enabled
aws macie2 get-automated-discovery-configuration

# Get findings
aws macie2 list-findings
aws macie2 get-findings --finding-ids <ids>
aws macie2 list-findings-filters
aws macie2 get -findings-filters --id <id>

# Get allow lists
aws macie2 list-allow-lists
aws macie2 get-allow-list --id <id>

# Get different info
aws macie2 list-classification-jobs
aws macie2 list-classification-scopes
aws macie2 list-custom-data-identifiers
```
#### Post Exploitation

{% hint style="success" %}
Aus der Perspektive eines Angreifers ist dieser Dienst nicht dazu gedacht, den Angreifer zu erkennen, sondern um sensible Informationen in den gespeicherten Dateien zu erkennen. Daher k√∂nnte dieser Dienst **einem Angreifer helfen, sensible Informationen** in den Buckets zu finden.\
Vielleicht k√∂nnte ein Angreifer jedoch auch daran interessiert sein, ihn zu st√∂ren, um zu verhindern, dass das Opfer Warnungen erh√§lt und diese Informationen leichter stehlen kann.
{% endhint %}

TODO: PRs sind willkommen!

## References

* [https://cloudacademy.com/blog/introducing-aws-security-hub/](https://cloudacademy.com/blog/introducing-aws-security-hub/)

{% hint style="success" %}
Lerne & √ºbe AWS Hacking:<img src="../../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
Lerne & √ºbe GCP Hacking: <img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* √úberpr√ºfe die [**Abonnementpl√§ne**](https://github.com/sponsors/carlospolop)!
* **Tritt der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folge** uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Teile Hacking-Tricks, indem du PRs zu den** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repos einreichst.

</details>
{% endhint %}
