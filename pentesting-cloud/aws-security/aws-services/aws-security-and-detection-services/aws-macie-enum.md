# AWS - Macie Enum

## AWS - Macie Enum

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** 游눫 [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** 游냕 [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Macie

Amazon Macie se destaca como un servicio dise침ado para **detectar, clasificar e identificar datos** autom치ticamente dentro de una cuenta de AWS. Aprovecha **el aprendizaje autom치tico** para monitorear y analizar continuamente los datos, enfoc치ndose principalmente en detectar y alertar sobre actividades inusuales o sospechosas al examinar los **datos de eventos de CloudTrail** y los patrones de comportamiento del usuario.

Caracter칤sticas clave de Amazon Macie:

1. **Revisi칩n activa de datos**: Emplea aprendizaje autom치tico para revisar datos activamente a medida que ocurren diversas acciones dentro de la cuenta de AWS.
2. **Detecci칩n de anomal칤as**: Identifica actividades irregulares o patrones de acceso, generando alertas para mitigar posibles riesgos de exposici칩n de datos.
3. **Monitoreo continuo**: Monitorea y detecta autom치ticamente nuevos datos en Amazon S3, empleando aprendizaje autom치tico e inteligencia artificial para adaptarse a los patrones de acceso a los datos a lo largo del tiempo.
4. **Clasificaci칩n de datos con NLP**: Utiliza procesamiento de lenguaje natural (NLP) para clasificar e interpretar diferentes tipos de datos, asignando puntajes de riesgo para priorizar hallazgos.
5. **Monitoreo de seguridad**: Identifica datos sensibles a la seguridad, incluidos claves API, claves secretas e informaci칩n personal, ayudando a prevenir filtraciones de datos.

Amazon Macie es un **servicio regional** y requiere el rol IAM 'AWSMacieServiceCustomerSetupRole' y un AWS CloudTrail habilitado para su funcionalidad.

### Sistema de Alertas

Macie categoriza las alertas en categor칤as predefinidas como:

* Acceso anonimizado
* Cumplimiento de datos
* P칠rdida de credenciales
* Escalaci칩n de privilegios
* Ransomware
* Acceso sospechoso, etc.

Estas alertas proporcionan descripciones detalladas y desgloses de resultados para una respuesta y resoluci칩n efectivas.

### Caracter칤sticas del Panel

El panel categoriza los datos en varias secciones, incluyendo:

* Objetos S3 (por rango de tiempo, ACL, PII)
* Eventos/usuarios de CloudTrail de alto riesgo
* Ubicaciones de actividad
* Tipos de identidad de usuario de CloudTrail, y m치s.

### Clasificaci칩n de Usuarios

Los usuarios se clasifican en niveles seg칰n el nivel de riesgo de sus llamadas a la API:

* **Platino**: Llamadas a la API de alto riesgo, a menudo con privilegios de administrador.
* **Oro**: Llamadas a la API relacionadas con la infraestructura.
* **Plata**: Llamadas a la API de riesgo medio.
* **Bronce**: Llamadas a la API de bajo riesgo.

### Tipos de Identidad

Los tipos de identidad incluyen Root, usuario IAM, Rol Asumido, Usuario Federado, Cuenta AWS y Servicio AWS, indicando la fuente de las solicitudes.

### Clasificaci칩n de Datos

La clasificaci칩n de datos abarca:

* Tipo de Contenido: Basado en el tipo de contenido detectado.
* Extensi칩n de Archivo: Basado en la extensi칩n del archivo.
* Tema: Clasificado por palabras clave dentro de los archivos.
* Regex: Clasificado seg칰n patrones regex espec칤ficos.

El mayor riesgo entre estas categor칤as determina el nivel de riesgo final del archivo.

### Investigaci칩n y An치lisis

La funci칩n de investigaci칩n de Amazon Macie permite consultas personalizadas en todos los datos de Macie para un an치lisis profundo. Los filtros incluyen datos de CloudTrail, propiedades de Bucket S3 y Objetos S3. Adem치s, admite invitar a otras cuentas a compartir Amazon Macie, facilitando la gesti칩n colaborativa de datos y el monitoreo de seguridad.

### Enumeraci칩n
```
# Get buckets
aws macie2 describe-buckets

# Org config
aws macie2 describe-organization-configuration

# Get admin account (if any)
aws macie2 get-administrator-account
aws macie2 list-organization-admin-accounts # Run from the management account of the org

# Get macie account members (run this form the admin account)
aws macie2 list-members

# Check if automated sensitive data discovey is enabled
aws macie2 get-automated-discovery-configuration

# Get findings
aws macie2 list-findings
aws macie2 get-findings --finding-ids <ids>
aws macie2 list-findings-filters
aws macie2 get -findings-filters --id <id>

# Get allow lists
aws macie2 list-allow-lists
aws macie2 get-allow-list --id <id>

# Get different info
aws macie2 list-classification-jobs
aws macie2 list-classification-scopes
aws macie2 list-custom-data-identifiers
```
#### Post Explotaci칩n

{% hint style="success" %}
Desde la perspectiva de un atacante, este servicio no est치 dise침ado para detectar al atacante, sino para detectar informaci칩n sensible en los archivos almacenados. Por lo tanto, este servicio podr칤a **ayudar a un atacante a encontrar informaci칩n sensible** dentro de los buckets.\
Sin embargo, tal vez un atacante tambi칠n podr칤a estar interesado en interrumpirlo para evitar que la v칤ctima reciba alertas y robar esa informaci칩n m치s f치cilmente.
{% endhint %}

TODO: 춰Se aceptan PRs!

## Referencias

* [https://cloudacademy.com/blog/introducing-aws-security-hub/](https://cloudacademy.com/blog/introducing-aws-security-hub/)

{% hint style="success" %}
Aprende y practica Hacking en AWS:<img src="../../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
Aprende y practica Hacking en GCP: <img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Apoya a HackTricks</summary>

* Revisa los [**planes de suscripci칩n**](https://github.com/sponsors/carlospolop)!
* **칔nete al** 游눫 [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s칤guenos** en **Twitter** 游냕 [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Comparte trucos de hacking enviando PRs a los** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repositorios de github.

</details>
{% endhint %}
