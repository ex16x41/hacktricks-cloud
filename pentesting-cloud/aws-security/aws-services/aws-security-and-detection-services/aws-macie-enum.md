# AWS - Macie Enum

## AWS - Macie Enum

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the**  [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter**  [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Macie

Amazon Macie wyr贸偶nia si jako usuga zaprojektowana do **automatycznego wykrywania, klasyfikowania i identyfikowania danych** w ramach konta AWS. Wykorzystuje **uczenie maszynowe** do cigego monitorowania i analizowania danych, koncentrujc si g贸wnie na wykrywaniu i ostrzeganiu przed nietypowymi lub podejrzanymi dziaaniami poprzez badanie danych **cloud trail event** oraz wzorc贸w zachowa u偶ytkownik贸w.

Kluczowe funkcje Amazon Macie:

1. **Aktywna recenzja danych**: Wykorzystuje uczenie maszynowe do aktywnej recenzji danych w miar wystpowania r贸偶nych dziaa w ramach konta AWS.
2. **Wykrywanie anomalii**: Identyfikuje nieregularne dziaania lub wzorce dostpu, generujc alerty w celu zagodzenia potencjalnych ryzyk zwizanych z ujawnieniem danych.
3. **Cige monitorowanie**: Automatycznie monitoruje i wykrywa nowe dane w Amazon S3, wykorzystujc uczenie maszynowe i sztuczn inteligencj do dostosowywania si do wzorc贸w dostpu do danych w czasie.
4. **Klasyfikacja danych z NLP**: Wykorzystuje przetwarzanie jzyka naturalnego (NLP) do klasyfikacji i interpretacji r贸偶nych typ贸w danych, przypisujc wyniki ryzyka w celu priorytetyzacji ustale.
5. **Monitorowanie bezpieczestwa**: Identyfikuje dane wra偶liwe na bezpieczestwo, w tym klucze API, klucze tajne i informacje osobiste, pomagajc zapobiega wyciekom danych.

Amazon Macie jest **usug regionaln** i wymaga roli IAM 'AWSMacieServiceCustomerSetupRole' oraz wczonego AWS CloudTrail do dziaania.

### System powiadomie

Macie klasyfikuje alerty w predefiniowane kategorie, takie jak:

* Anonimizowany dostp
* Zgodno z danymi
* Utrata powiadcze
* Eskalacja uprawnie
* Ransomware
* Podejrzany dostp, itd.

Te alerty dostarczaj szczeg贸owych opis贸w i analiz wynik贸w dla skutecznej reakcji i rozwizania problemu.

### Funkcje pulpitu nawigacyjnego

Pulpit nawigacyjny klasyfikuje dane w r贸偶nych sekcjach, w tym:

* Obiekty S3 (wedug zakresu czasowego, ACL, PII)
* Wydarzenia/u偶ytkownicy CloudTrail o wysokim ryzyku
* Lokalizacje aktywnoci
* Typy to偶samoci u偶ytkownik贸w CloudTrail i inne.

### Klasyfikacja u偶ytkownik贸w

U偶ytkownicy s klasyfikowani w kategorie na podstawie poziomu ryzyka ich wywoa API:

* **Platinum**: Wywoania API o wysokim ryzyku, czsto z uprawnieniami administratora.
* **Gold**: Wywoania API zwizane z infrastruktur.
* **Silver**: Wywoania API o rednim ryzyku.
* **Bronze**: Wywoania API o niskim ryzyku.

### Typy to偶samoci

Typy to偶samoci obejmuj Root, u偶ytkownik IAM, przyjta rola, u偶ytkownik federowany, konto AWS i usuga AWS, wskazujc 藕r贸do 偶da.

### Klasyfikacja danych

Klasyfikacja danych obejmuje:

* Typ zawartoci: Na podstawie wykrytego typu zawartoci.
* Rozszerzenie pliku: Na podstawie rozszerzenia pliku.
* Temat: Klasyfikowane wedug s贸w kluczowych w plikach.
* Regex: Klasyfikowane na podstawie okrelonych wzorc贸w regex.

Najwy偶sze ryzyko wr贸d tych kategorii okrela ostateczny poziom ryzyka pliku.

### Badania i analiza

Funkcja badawcza Amazon Macie umo偶liwia niestandardowe zapytania w caych danych Macie w celu przeprowadzenia dogbnej analizy. Filtry obejmuj dane CloudTrail, waciwoci koszyk贸w S3 i obiekty S3. Ponadto wspiera zapraszanie innych kont do wsp贸dzielenia Amazon Macie, uatwiajc wsp贸prac w zarzdzaniu danymi i monitorowaniu bezpieczestwa.

### Enumeration
```
# Get buckets
aws macie2 describe-buckets

# Org config
aws macie2 describe-organization-configuration

# Get admin account (if any)
aws macie2 get-administrator-account
aws macie2 list-organization-admin-accounts # Run from the management account of the org

# Get macie account members (run this form the admin account)
aws macie2 list-members

# Check if automated sensitive data discovey is enabled
aws macie2 get-automated-discovery-configuration

# Get findings
aws macie2 list-findings
aws macie2 get-findings --finding-ids <ids>
aws macie2 list-findings-filters
aws macie2 get -findings-filters --id <id>

# Get allow lists
aws macie2 list-allow-lists
aws macie2 get-allow-list --id <id>

# Get different info
aws macie2 list-classification-jobs
aws macie2 list-classification-scopes
aws macie2 list-custom-data-identifiers
```
#### Post Exploitation

{% hint style="success" %}
Z perspektywy atakujcego, ta usuga nie jest stworzona do wykrywania atakujcego, ale do wykrywania wra偶liwych informacji w przechowywanych plikach. Dlatego ta usuga mo偶e **pom贸c atakujcemu w znalezieniu wra偶liwych informacji** w bucketach.\
Jednak偶e, by mo偶e atakujcy m贸gby by r贸wnie偶 zainteresowany zak贸ceniem jej dziaania, aby uniemo偶liwi ofierze otrzymywanie powiadomie i atwiej ukra te informacje.
{% endhint %}

TODO: PRs are welcome!

## References

* [https://cloudacademy.com/blog/introducing-aws-security-hub/](https://cloudacademy.com/blog/introducing-aws-security-hub/)

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the**  [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter**  [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
