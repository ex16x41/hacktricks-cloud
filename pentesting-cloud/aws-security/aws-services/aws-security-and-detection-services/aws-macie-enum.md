# AWS - Macie Enum

## AWS - Macie Enum

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ЁЯТм [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ЁЯРж [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Macie

Amazon Macie рдПрдХ рд╕реЗрд╡рд╛ рдХреЗ рд░реВрдк рдореЗрдВ рдЙрднрд░рддрд╛ рд╣реИ рдЬреЛ **AWS рдЦрд╛рддреЗ** рдХреЗ рднреАрддрд░ рдбреЗрдЯрд╛ рдХреЛ **рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ рдкрд╣рдЪрд╛рдирдиреЗ, рд╡рд░реНрдЧреАрдХреГрдд рдХрд░рдиреЗ рдФрд░ рдкрд╣рдЪрд╛рдирдиреЗ** рдХреЗ рд▓рд┐рдП рдбрд┐рдЬрд╝рд╛рдЗрди рдХреА рдЧрдИ рд╣реИред рдпрд╣ **рдорд╢реАрди рд▓рд░реНрдирд┐рдВрдЧ** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИ рддрд╛рдХрд┐ рдбреЗрдЯрд╛ рдХреА рдирд┐рд░рдВрддрд░ рдирд┐рдЧрд░рд╛рдиреА рдФрд░ рд╡рд┐рд╢реНрд▓реЗрд╖рдг рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗ, рдореБрдЦреНрдп рд░реВрдк рд╕реЗ **рдХреНрд▓рд╛рдЙрдб рдЯреНрд░реЗрд▓ рдЗрд╡реЗрдВрдЯ** рдбреЗрдЯрд╛ рдФрд░ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рд╡реНрдпрд╡рд╣рд╛рд░ рдкреИрдЯрд░реНрди рдХреА рдЬрд╛рдВрдЪ рдХрд░рдХреЗ рдЕрд╕рд╛рдорд╛рдиреНрдп рдпрд╛ рд╕рдВрджрд┐рдЧреНрдз рдЧрддрд┐рд╡рд┐рдзрд┐рдпреЛрдВ рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛рдиреЗ рдФрд░ рдЕрд▓рд░реНрдЯ рдХрд░рдиреЗ рдкрд░ рдзреНрдпрд╛рди рдХреЗрдВрджреНрд░рд┐рдд рдХрд░рддрд╛ рд╣реИред

Amazon Macie рдХреА рдкреНрд░рдореБрдЦ рд╡рд┐рд╢реЗрд╖рддрд╛рдПрдБ:

1. **рд╕рдХреНрд░рд┐рдп рдбреЗрдЯрд╛ рд╕рдореАрдХреНрд╖рд╛**: AWS рдЦрд╛рддреЗ рдХреЗ рднреАрддрд░ рд╡рд┐рднрд┐рдиреНрди рдХреНрд░рд┐рдпрд╛рдУрдВ рдХреЗ рджреМрд░рд╛рди рдбреЗрдЯрд╛ рдХреА рд╕рдХреНрд░рд┐рдп рд░реВрдк рд╕реЗ рд╕рдореАрдХреНрд╖рд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдорд╢реАрди рд▓рд░реНрдирд┐рдВрдЧ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИред
2. **рдЕрд╕рд╛рдорд╛рдиреНрдп рдЧрддрд┐рд╡рд┐рдзрд┐ рдкрд╣рдЪрд╛рди**: рдЕрд╕рд╛рдорд╛рдиреНрдп рдЧрддрд┐рд╡рд┐рдзрд┐рдпреЛрдВ рдпрд╛ рдкрд╣реБрдВрдЪ рдкреИрдЯрд░реНрди рдХреА рдкрд╣рдЪрд╛рди рдХрд░рддрд╛ рд╣реИ, рд╕рдВрднрд╛рд╡рд┐рдд рдбреЗрдЯрд╛ рдПрдХреНрд╕рдкреЛрдЬрд╝рд░ рдЬреЛрдЦрд┐рдореЛрдВ рдХреЛ рдХрдо рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЕрд▓рд░реНрдЯ рдЙрддреНрдкрдиреНрди рдХрд░рддрд╛ рд╣реИред
3. **рдирд┐рд░рдВрддрд░ рдирд┐рдЧрд░рд╛рдиреА**: Amazon S3 рдореЗрдВ рдирдП рдбреЗрдЯрд╛ рдХреА рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ рдирд┐рдЧрд░рд╛рдиреА рдФрд░ рдкрд╣рдЪрд╛рди рдХрд░рддрд╛ рд╣реИ, рд╕рдордп рдХреЗ рд╕рд╛рде рдбреЗрдЯрд╛ рдПрдХреНрд╕реЗрд╕ рдкреИрдЯрд░реНрди рдХреЗ рдЕрдиреБрдХреВрд▓рди рдХреЗ рд▓рд┐рдП рдорд╢реАрди рд▓рд░реНрдирд┐рдВрдЧ рдФрд░ рдЖрд░реНрдЯрд┐рдлрд┐рд╢рд┐рдпрд▓ рдЗрдВрдЯреЗрд▓рд┐рдЬреЗрдВрд╕ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИред
4. **NLP рдХреЗ рд╕рд╛рде рдбреЗрдЯрд╛ рд╡рд░реНрдЧреАрдХрд░рдг**: рд╡рд┐рднрд┐рдиреНрди рдбреЗрдЯрд╛ рдкреНрд░рдХрд╛рд░реЛрдВ рдХреЛ рд╡рд░реНрдЧреАрдХреГрдд рдФрд░ рд╡реНрдпрд╛рдЦреНрдпрд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдкреНрд░рд╛рдХреГрддрд┐рдХ рднрд╛рд╖рд╛ рдкреНрд░рд╕рдВрд╕реНрдХрд░рдг (NLP) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИ, рдЦреЛрдЬреЛрдВ рдХреЛ рдкреНрд░рд╛рдердорд┐рдХрддрд╛ рджреЗрдиреЗ рдХреЗ рд▓рд┐рдП рдЬреЛрдЦрд┐рдо рд╕реНрдХреЛрд░ рдЕрд╕рд╛рдЗрди рдХрд░рддрд╛ рд╣реИред
5. **рд╕реБрд░рдХреНрд╖рд╛ рдирд┐рдЧрд░рд╛рдиреА**: API рдХреБрдВрдЬреА, рдЧреБрдкреНрдд рдХреБрдВрдЬреА, рдФрд░ рд╡реНрдпрдХреНрддрд┐рдЧрдд рдЬрд╛рдирдХрд╛рд░реА рд╕рд╣рд┐рдд рд╕реБрд░рдХреНрд╖рд╛-рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рдбреЗрдЯрд╛ рдХреА рдкрд╣рдЪрд╛рди рдХрд░рддрд╛ рд╣реИ, рдбреЗрдЯрд╛ рд▓реАрдХ рдХреЛ рд░реЛрдХрдиреЗ рдореЗрдВ рдорджрдж рдХрд░рддрд╛ рд╣реИред

Amazon Macie рдПрдХ **рдХреНрд╖реЗрддреНрд░реАрдп рд╕реЗрд╡рд╛** рд╣реИ рдФрд░ рдХрд╛рд░реНрдпрдХреНрд╖рдорддрд╛ рдХреЗ рд▓рд┐рдП 'AWSMacieServiceCustomerSetupRole' IAM рднреВрдорд┐рдХрд╛ рдФрд░ рд╕рдХреНрд╖рдо AWS CloudTrail рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИред

### рдЕрд▓рд░реНрдЯ рдкреНрд░рдгрд╛рд▓реА

Macie рдЕрд▓рд░реНрдЯ рдХреЛ рдкреВрд░реНрд╡рдирд┐рд░реНрдзрд╛рд░рд┐рдд рд╢реНрд░реЗрдгрд┐рдпреЛрдВ рдореЗрдВ рд╡рд░реНрдЧреАрдХреГрдд рдХрд░рддрд╛ рд╣реИ рдЬреИрд╕реЗ:

* рдЕрдирд╛рдорд┐рдд рдкрд╣реБрдВрдЪ
* рдбреЗрдЯрд╛ рдЕрдиреБрдкрд╛рд▓рди
* рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓ рд╣рд╛рдирд┐
* рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рд╡реГрджреНрдзрд┐
* рд░реИрдВрд╕рдорд╡реЗрдпрд░
* рд╕рдВрджрд┐рдЧреНрдз рдкрд╣реБрдВрдЪ, рдЖрджрд┐ред

рдпреЗ рдЕрд▓рд░реНрдЯ рдкреНрд░рднрд╛рд╡реА рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдФрд░ рд╕рдорд╛рдзрд╛рди рдХреЗ рд▓рд┐рдП рд╡рд┐рд╕реНрддреГрдд рд╡рд┐рд╡рд░рдг рдФрд░ рдкрд░рд┐рдгрд╛рдо рд╡рд┐рднрд╛рдЬрди рдкреНрд░рджрд╛рди рдХрд░рддреЗ рд╣реИрдВред

### рдбреИрд╢рдмреЛрд░реНрдб рд╡рд┐рд╢реЗрд╖рддрд╛рдПрдБ

рдбреИрд╢рдмреЛрд░реНрдб рдбреЗрдЯрд╛ рдХреЛ рд╡рд┐рднрд┐рдиреНрди рдЕрдиреБрднрд╛рдЧреЛрдВ рдореЗрдВ рд╡рд░реНрдЧреАрдХреГрдд рдХрд░рддрд╛ рд╣реИ, рдЬрд┐рд╕рдореЗрдВ рд╢рд╛рдорд┐рд▓ рд╣реИрдВ:

* S3 рдСрдмреНрдЬреЗрдХреНрдЯ (рд╕рдордп рд╕реАрдорд╛, ACL, PII рджреНрд╡рд╛рд░рд╛)
* рдЙрдЪреНрдЪ-рдЬреЛрдЦрд┐рдо рдХреНрд▓рд╛рдЙрдбрдЯреНрд░реЗрд▓ рдШрдЯрдирд╛рдПрдБ/рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛
* рдЧрддрд┐рд╡рд┐рдзрд┐ рд╕реНрдерд╛рди
* рдХреНрд▓рд╛рдЙрдбрдЯреНрд░реЗрд▓ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдкрд╣рдЪрд╛рди рдкреНрд░рдХрд╛рд░, рдФрд░ рдЕрдзрд┐рдХред

### рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рд╡рд░реНрдЧреАрдХрд░рдг

рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЛ рдЙрдирдХреЗ API рдХреЙрд▓ рдХреЗ рдЬреЛрдЦрд┐рдо рд╕реНрддрд░ рдХреЗ рдЖрдзрд╛рд░ рдкрд░ рд╕реНрддрд░реЛрдВ рдореЗрдВ рд╡рд░реНрдЧреАрдХреГрдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ:

* **рдкреНрд▓реИрдЯрд┐рдирдо**: рдЙрдЪреНрдЪ-рдЬреЛрдЦрд┐рдо API рдХреЙрд▓, рдЕрдХреНрд╕рд░ рдкреНрд░рд╢рд╛рд╕рдирд┐рдХ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдХреЗ рд╕рд╛рдеред
* **рдЧреЛрд▓реНрдб**: рдЕрд╡рд╕рдВрд░рдЪрдирд╛ рд╕реЗ рд╕рдВрдмрдВрдзрд┐рдд API рдХреЙрд▓ред
* **рд╕рд┐рд▓реНрд╡рд░**: рдордзреНрдпрдо-рдЬреЛрдЦрд┐рдо API рдХреЙрд▓ред
* **рдмреНрд░реЙрдиреНрдЬ**: рдирд┐рдореНрди-рдЬреЛрдЦрд┐рдо API рдХреЙрд▓ред

### рдкрд╣рдЪрд╛рди рдкреНрд░рдХрд╛рд░

рдкрд╣рдЪрд╛рди рдкреНрд░рдХрд╛рд░реЛрдВ рдореЗрдВ рд░реВрдЯ, IAM рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛, рдЕрдиреБрдореЛрджрд┐рдд рднреВрдорд┐рдХрд╛, рд╕рдВрдШреАрдп рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛, AWS рдЦрд╛рддрд╛, рдФрд░ AWS рд╕реЗрд╡рд╛ рд╢рд╛рдорд┐рд▓ рд╣реИрдВ, рдЬреЛ рдЕрдиреБрд░реЛрдзреЛрдВ рдХреЗ рд╕реНрд░реЛрдд рдХреЛ рдЗрдВрдЧрд┐рдд рдХрд░рддреЗ рд╣реИрдВред

### рдбреЗрдЯрд╛ рд╡рд░реНрдЧреАрдХрд░рдг

рдбреЗрдЯрд╛ рд╡рд░реНрдЧреАрдХрд░рдг рдореЗрдВ рд╢рд╛рдорд┐рд▓ рд╣реИрдВ:

* рд╕рд╛рдордЧреНрд░реА-рдкреНрд░рдХрд╛рд░: рдкрд╣рдЪрд╛рди рдХреА рдЧрдИ рд╕рд╛рдордЧреНрд░реА рдкреНрд░рдХрд╛рд░ рдХреЗ рдЖрдзрд╛рд░ рдкрд░ред
* рдлрд╝рд╛рдЗрд▓ рдПрдХреНрд╕рдЯреЗрдВрд╢рди: рдлрд╝рд╛рдЗрд▓ рдПрдХреНрд╕рдЯреЗрдВрд╢рди рдХреЗ рдЖрдзрд╛рд░ рдкрд░ред
* рд╡рд┐рд╖рдп: рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреЗ рднреАрддрд░ рдХреАрд╡рд░реНрдб рджреНрд╡рд╛рд░рд╛ рд╡рд░реНрдЧреАрдХреГрддред
* Regex: рд╡рд┐рд╢рд┐рд╖реНрдЯ regex рдкреИрдЯрд░реНрди рдХреЗ рдЖрдзрд╛рд░ рдкрд░ рд╡рд░реНрдЧреАрдХреГрддред

рдЗрди рд╢реНрд░реЗрдгрд┐рдпреЛрдВ рдореЗрдВ рд╕рдмрд╕реЗ рдЙрдЪреНрдЪ рдЬреЛрдЦрд┐рдо рдлрд╝рд╛рдЗрд▓ рдХреЗ рдЕрдВрддрд┐рдо рдЬреЛрдЦрд┐рдо рд╕реНрддрд░ рдХреЛ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░рддрд╛ рд╣реИред

### рдЕрдиреБрд╕рдВрдзрд╛рди рдФрд░ рд╡рд┐рд╢реНрд▓реЗрд╖рдг

Amazon Macie рдХрд╛ рдЕрдиреБрд╕рдВрдзрд╛рди рдХрд╛рд░реНрдп рд╕рднреА Macie рдбреЗрдЯрд╛ рдХреЗ рд▓рд┐рдП рдЧрд╣рди рд╡рд┐рд╢реНрд▓реЗрд╖рдг рдХреЗ рд▓рд┐рдП рдХрд╕реНрдЯрдо рдХреНрд╡реЗрд░реА рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИред рдлрд╝рд┐рд▓реНрдЯрд░ рдореЗрдВ рдХреНрд▓рд╛рдЙрдбрдЯреНрд░реЗрд▓ рдбреЗрдЯрд╛, S3 рдмрдХреЗрдЯ рдЧреБрдг, рдФрд░ S3 рдСрдмреНрдЬреЗрдХреНрдЯ рд╢рд╛рдорд┐рд▓ рд╣реИрдВред рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдпрд╣ рдЕрдиреНрдп рдЦрд╛рддреЛрдВ рдХреЛ Amazon Macie рд╕рд╛рдЭрд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдордВрддреНрд░рд┐рдд рдХрд░рдиреЗ рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рддрд╛ рд╣реИ, рд╕рд╣рдпреЛрдЧрд╛рддреНрдордХ рдбреЗрдЯрд╛ рдкреНрд░рдмрдВрдзрди рдФрд░ рд╕реБрд░рдХреНрд╖рд╛ рдирд┐рдЧрд░рд╛рдиреА рдХреЛ рд╕реБрд╡рд┐рдзрд╛рдЬрдирдХ рдмрдирд╛рддрд╛ рд╣реИред

### Enumeration
```
# Get buckets
aws macie2 describe-buckets

# Org config
aws macie2 describe-organization-configuration

# Get admin account (if any)
aws macie2 get-administrator-account
aws macie2 list-organization-admin-accounts # Run from the management account of the org

# Get macie account members (run this form the admin account)
aws macie2 list-members

# Check if automated sensitive data discovey is enabled
aws macie2 get-automated-discovery-configuration

# Get findings
aws macie2 list-findings
aws macie2 get-findings --finding-ids <ids>
aws macie2 list-findings-filters
aws macie2 get -findings-filters --id <id>

# Get allow lists
aws macie2 list-allow-lists
aws macie2 get-allow-list --id <id>

# Get different info
aws macie2 list-classification-jobs
aws macie2 list-classification-scopes
aws macie2 list-custom-data-identifiers
```
#### Post Exploitation

{% hint style="success" %}
рд╣рдорд▓рд╛рд╡рд░ рдХреЗ рджреГрд╖реНрдЯрд┐рдХреЛрдг рд╕реЗ, рдпрд╣ рд╕реЗрд╡рд╛ рд╣рдорд▓рд╛рд╡рд░ рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдирд╣реАрдВ рдмрдирд╛рдИ рдЧрдИ рд╣реИ, рдмрд▓реНрдХрд┐ рд╕рдВрдЧреНрд░рд╣реАрдд рдлрд╝рд╛рдЗрд▓реЛрдВ рдореЗрдВ рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рдЬрд╛рдирдХрд╛рд░реА рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛рдиреЗ рдХреЗ рд▓рд┐рдП рд╣реИред рдЗрд╕рд▓рд┐рдП, рдпрд╣ рд╕реЗрд╡рд╛ **рд╣рдорд▓рд╛рд╡рд░ рдХреЛ рдмрдХреЗрдЯ рдХреЗ рдЕрдВрджрд░ рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рдЬрд╛рдирдХрд╛рд░реА рдЦреЛрдЬрдиреЗ рдореЗрдВ рдорджрдж рдХрд░ рд╕рдХрддреА рд╣реИ**ред\
рд╣рд╛рд▓рд╛рдВрдХрд┐, рд╢рд╛рдпрдж рдПрдХ рд╣рдорд▓рд╛рд╡рд░ рдЗрд╕реЗ рдмрд╛рдзрд┐рдд рдХрд░рдиреЗ рдореЗрдВ рднреА рд░реБрдЪрд┐ рд░рдЦ рд╕рдХрддрд╛ рд╣реИ рддрд╛рдХрд┐ рдкреАрдбрд╝рд┐рдд рдХреЛ рдЕрд▓рд░реНрдЯ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рд╕реЗ рд░реЛрдХрд╛ рдЬрд╛ рд╕рдХреЗ рдФрд░ рдЙрд╕ рдЬрд╛рдирдХрд╛рд░реА рдХреЛ рдЪреБрд░рд╛рдирд╛ рдЖрд╕рд╛рди рд╣реЛ рдЬрд╛рдПред
{% endhint %}

TODO: PRs are welcome!

## References

* [https://cloudacademy.com/blog/introducing-aws-security-hub/](https://cloudacademy.com/blog/introducing-aws-security-hub/)

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ЁЯТм [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ЁЯРж [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
