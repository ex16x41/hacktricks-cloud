# AWS - Enumeraci칩n de Macie

{% hint style="success" %}
Aprende y practica Hacking en AWS:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Aprende y practica Hacking en GCP: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Apoya a HackTricks</summary>

* Revisa los [**planes de suscripci칩n**](https://github.com/sponsors/carlospolop)!
* **칔nete al** 游눫 [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s칤guenos** en **Twitter** 游냕 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Comparte trucos de hacking enviando PRs a los** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repositorios de github.

</details>
{% endhint %}

# Macie

Amazon Macie destaca como un servicio dise침ado para **detectar, clasificar e identificar datos** dentro de una cuenta de AWS. Utiliza **aprendizaje autom치tico** para monitorear y analizar continuamente datos, centr치ndose principalmente en detectar y alertar sobre actividades inusuales o sospechosas al examinar datos de eventos de **cloud trail** y patrones de comportamiento de usuarios.

Caracter칤sticas clave de Amazon Macie:

1. **Revisi칩n activa de datos**: Emplea aprendizaje autom치tico para revisar activamente los datos a medida que ocurren diversas acciones dentro de la cuenta de AWS.
2. **Detecci칩n de anomal칤as**: Identifica actividades irregulares o patrones de acceso, generando alertas para mitigar posibles riesgos de exposici칩n de datos.
3. **Monitoreo continuo**: Monitorea y detecta autom치ticamente nuevos datos en Amazon S3, utilizando aprendizaje autom치tico e inteligencia artificial para adaptarse a los patrones de acceso a datos con el tiempo.
4. **Clasificaci칩n de datos con NLP**: Utiliza procesamiento de lenguaje natural (NLP) para clasificar e interpretar diferentes tipos de datos, asignando puntajes de riesgo para priorizar hallazgos.
5. **Monitoreo de seguridad**: Identifica datos sensibles en cuanto a seguridad, incluidas claves API, claves secretas e informaci칩n personal, ayudando a prevenir fugas de datos.

Amazon Macie es un **servicio regional** y requiere el Rol IAM 'AWSMacieServiceCustomerSetupRole' y un AWS CloudTrail habilitado para su funcionalidad.

## Sistema de Alerta

Macie categoriza las alertas en categor칤as predefinidas como:

- Acceso anonimizado
- Cumplimiento de datos
- P칠rdida de credenciales
- Escalada de privilegios
- Ransomware
- Acceso sospechoso, etc.

Estas alertas proporcionan descripciones detalladas y desgloses de resultados para una respuesta y resoluci칩n efectivas.

## Caracter칤sticas del Panel de Control

El panel de control categoriza los datos en varias secciones, incluyendo:

- Objetos de S3 (por rango de tiempo, ACL, PII)
- Eventos/usuarios de CloudTrail de alto riesgo
- Ubicaciones de actividad
- Tipos de identidad de usuario de CloudTrail, y m치s.

## Categorizaci칩n de Usuarios

Los usuarios se clasifican en niveles seg칰n el nivel de riesgo de sus llamadas API:

- **Platino**: Llamadas API de alto riesgo, a menudo con privilegios de administrador.
- **Oro**: Llamadas API relacionadas con la infraestructura.
- **Plata**: Llamadas API de riesgo medio.
- **Bronce**: Llamadas API de bajo riesgo.

## Tipos de Identidad

Los tipos de identidad incluyen Ra칤z, Usuario IAM, Rol Asumido, Usuario Federado, Cuenta de AWS y Servicio de AWS, indicando la fuente de las solicitudes.

## Clasificaci칩n de Datos

La clasificaci칩n de datos abarca:

- Tipo de contenido: Basado en el tipo de contenido detectado.
- Extensi칩n de archivo: Basado en la extensi칩n de archivo.
- Tema: Categorizado por palabras clave dentro de los archivos.
- Regex: Categorizado en funci칩n de patrones regex espec칤ficos.

El mayor riesgo entre estas categor칤as determina el nivel de riesgo final del archivo.

## Investigaci칩n y An치lisis

La funci칩n de investigaci칩n de Amazon Macie permite realizar consultas personalizadas en todos los datos de Macie para un an치lisis detallado. Los filtros incluyen Datos de CloudTrail, propiedades de cubo de S3 y Objetos de S3. Adem치s, admite invitar a otras cuentas para compartir Amazon Macie, facilitando la gesti칩n colaborativa de datos y el monitoreo de seguridad. 

## Enumeraci칩n
```
# Get buckets
aws macie2 describe-buckets

# Org config
aws macie2 describe-organization-configuration

# Get admin account (if any)
aws macie2 get-administrator-account
aws macie2 list-organization-admin-accounts # Run from the management account of the org

# Get macie account members (run this form the admin account)
aws macie2 list-members

# Check if automated sensitive data discovey is enabled
aws macie2 get-automated-discovery-configuration

# Get findings
aws macie2 list-findings
aws macie2 get-findings --finding-ids <ids>
aws macie2 list-findings-filters
aws macie2 get -findings-filters --id <id>

# Get allow lists
aws macie2 list-allow-lists
aws macie2 get-allow-list --id <id>

# Get different info
aws macie2 list-classification-jobs
aws macie2 list-classification-scopes
aws macie2 list-custom-data-identifiers
```
### Post Explotaci칩n

{% hint style="success" %}
Desde la perspectiva de un atacante, este servicio no est치 dise침ado para detectar al atacante, sino para detectar informaci칩n sensible en los archivos almacenados. Por lo tanto, este servicio podr칤a **ayudar a un atacante a encontrar informaci칩n sensible** dentro de los buckets.\
Sin embargo, tal vez a un atacante tambi칠n le interese interrumpirlo para evitar que la v칤ctima reciba alertas y robar esa informaci칩n m치s f치cilmente.
{% endhint %}

TODO: 춰Se aceptan solicitudes de extracci칩n!

# Referencias
* [https://cloudacademy.com/blog/introducing-aws-security-hub/](https://cloudacademy.com/blog/introducing-aws-security-hub/)

{% hint style="success" %}
Aprende y practica Hacking en AWS:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Aprende y practica Hacking en GCP: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Apoya a HackTricks</summary>

* 춰Consulta los [**planes de suscripci칩n**](https://github.com/sponsors/carlospolop)!
* **칔nete al** 游눫 [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s칤guenos** en **Twitter** 游냕 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Comparte trucos de hacking enviando PRs a los repositorios de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
{% endhint %}
