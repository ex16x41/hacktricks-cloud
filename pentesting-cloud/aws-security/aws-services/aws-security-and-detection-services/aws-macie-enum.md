# AWS - Macie Enum

## AWS - Macie Enum

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Macie

Amazon Macie se distingue comme un service con√ßu pour **d√©tecter, classer et identifier automatiquement les donn√©es** au sein d'un compte AWS. Il utilise **l'apprentissage automatique** pour surveiller et analyser en continu les donn√©es, se concentrant principalement sur la d√©tection et l'alerte contre des activit√©s inhabituelles ou suspectes en examinant les **donn√©es des √©v√©nements CloudTrail** et les mod√®les de comportement des utilisateurs.

Caract√©ristiques cl√©s d'Amazon Macie :

1. **Revue active des donn√©es** : Utilise l'apprentissage automatique pour examiner activement les donn√©es √† mesure que diverses actions se produisent au sein du compte AWS.
2. **D√©tection d'anomalies** : Identifie les activit√©s ou les mod√®les d'acc√®s irr√©guliers, g√©n√©rant des alertes pour att√©nuer les risques potentiels d'exposition des donn√©es.
3. **Surveillance continue** : Surveille et d√©tecte automatiquement les nouvelles donn√©es dans Amazon S3, utilisant l'apprentissage automatique et l'intelligence artificielle pour s'adapter aux mod√®les d'acc√®s aux donn√©es au fil du temps.
4. **Classification des donn√©es avec le NLP** : Utilise le traitement du langage naturel (NLP) pour classer et interpr√©ter diff√©rents types de donn√©es, attribuant des scores de risque pour prioriser les r√©sultats.
5. **Surveillance de la s√©curit√©** : Identifie les donn√©es sensibles √† la s√©curit√©, y compris les cl√©s API, les cl√©s secr√®tes et les informations personnelles, aidant √† pr√©venir les fuites de donn√©es.

Amazon Macie est un **service r√©gional** et n√©cessite le r√¥le IAM 'AWSMacieServiceCustomerSetupRole' et un AWS CloudTrail activ√© pour fonctionner.

### Syst√®me d'alerte

Macie cat√©gorise les alertes en cat√©gories pr√©d√©finies telles que :

* Acc√®s anonymis√©
* Conformit√© des donn√©es
* Perte d'identifiants
* Escalade de privil√®ges
* Ransomware
* Acc√®s suspect, etc.

Ces alertes fournissent des descriptions d√©taill√©es et des analyses des r√©sultats pour une r√©ponse et une r√©solution efficaces.

### Fonctionnalit√©s du tableau de bord

Le tableau de bord cat√©gorise les donn√©es en diff√©rentes sections, y compris :

* Objets S3 (par plage de temps, ACL, PII)
* √âv√©nements/utilisateurs CloudTrail √† haut risque
* Lieux d'activit√©
* Types d'identit√© des utilisateurs CloudTrail, et plus encore.

### Cat√©gorisation des utilisateurs

Les utilisateurs sont class√©s en niveaux en fonction du niveau de risque de leurs appels API :

* **Platine** : Appels API √† haut risque, souvent avec des privil√®ges d'administrateur.
* **Or** : Appels API li√©s √† l'infrastructure.
* **Argent** : Appels API √† risque moyen.
* **Bronze** : Appels API √† faible risque.

### Types d'identit√©

Les types d'identit√© incluent Root, utilisateur IAM, r√¥le assum√©, utilisateur f√©d√©r√©, compte AWS et service AWS, indiquant la source des demandes.

### Classification des donn√©es

La classification des donn√©es englobe :

* Type de contenu : Bas√© sur le type de contenu d√©tect√©.
* Extension de fichier : Bas√© sur l'extension de fichier.
* Th√®me : Cat√©goris√© par des mots-cl√©s dans les fichiers.
* Regex : Cat√©goris√© en fonction de mod√®les regex sp√©cifiques.

Le risque le plus √©lev√© parmi ces cat√©gories d√©termine le niveau de risque final du fichier.

### Recherche et analyse

La fonction de recherche d'Amazon Macie permet des requ√™tes personnalis√©es sur toutes les donn√©es Macie pour une analyse approfondie. Les filtres incluent les donn√©es CloudTrail, les propri√©t√©s des buckets S3 et les objets S3. De plus, elle prend en charge l'invitation d'autres comptes √† partager Amazon Macie, facilitant la gestion collaborative des donn√©es et la surveillance de la s√©curit√©.

### Enumeration
```
# Get buckets
aws macie2 describe-buckets

# Org config
aws macie2 describe-organization-configuration

# Get admin account (if any)
aws macie2 get-administrator-account
aws macie2 list-organization-admin-accounts # Run from the management account of the org

# Get macie account members (run this form the admin account)
aws macie2 list-members

# Check if automated sensitive data discovey is enabled
aws macie2 get-automated-discovery-configuration

# Get findings
aws macie2 list-findings
aws macie2 get-findings --finding-ids <ids>
aws macie2 list-findings-filters
aws macie2 get -findings-filters --id <id>

# Get allow lists
aws macie2 list-allow-lists
aws macie2 get-allow-list --id <id>

# Get different info
aws macie2 list-classification-jobs
aws macie2 list-classification-scopes
aws macie2 list-custom-data-identifiers
```
#### Post Exploitation

{% hint style="success" %}
Du point de vue d'un attaquant, ce service n'est pas con√ßu pour d√©tecter l'attaquant, mais pour d√©tecter des informations sensibles dans les fichiers stock√©s. Par cons√©quent, ce service pourrait **aider un attaquant √† trouver des informations sensibles** √† l'int√©rieur des buckets.\
Cependant, peut-√™tre qu'un attaquant pourrait √©galement √™tre int√©ress√© √† le perturber afin d'emp√™cher la victime de recevoir des alertes et de voler ces informations plus facilement.
{% endhint %}

TODO: Les PRs sont les bienvenus !

## R√©f√©rences

* [https://cloudacademy.com/blog/introducing-aws-security-hub/](https://cloudacademy.com/blog/introducing-aws-security-hub/)

{% hint style="success" %}
Apprenez et pratiquez le Hacking AWS :<img src="../../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">\
Apprenez et pratiquez le Hacking GCP : <img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Soutenir HackTricks</summary>

* Consultez les [**plans d'abonnement**](https://github.com/sponsors/carlospolop) !
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez-nous sur** **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Partagez des astuces de hacking en soumettant des PRs aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) d√©p√¥ts github.

</details>
{% endhint %}
