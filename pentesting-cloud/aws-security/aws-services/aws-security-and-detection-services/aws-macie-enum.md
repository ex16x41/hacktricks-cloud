# AWS - Macie Enum

## AWS - Macie Enum

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Macie

Amazon MacieëŠ” **AWS ê³„ì • ë‚´ ë°ì´í„°ë¥¼ ìë™ìœ¼ë¡œ ê°ì§€, ë¶„ë¥˜ ë° ì‹ë³„**í•˜ë„ë¡ ì„¤ê³„ëœ ì„œë¹„ìŠ¤ë¡œ ë‘ë“œëŸ¬ì§‘ë‹ˆë‹¤. ì´ëŠ” **ê¸°ê³„ í•™ìŠµ**ì„ í™œìš©í•˜ì—¬ ë°ì´í„°ë¥¼ ì§€ì†ì ìœ¼ë¡œ ëª¨ë‹ˆí„°ë§í•˜ê³  ë¶„ì„í•˜ë©°, ì£¼ë¡œ **í´ë¼ìš°ë“œ íŠ¸ë ˆì¼ ì´ë²¤íŠ¸** ë°ì´í„°ì™€ ì‚¬ìš©ì í–‰ë™ íŒ¨í„´ì„ ê²€í† í•˜ì—¬ ë¹„ì •ìƒì ì´ê±°ë‚˜ ì˜ì‹¬ìŠ¤ëŸ¬ìš´ í™œë™ì„ ê°ì§€í•˜ê³  ê²½ê³ í•˜ëŠ” ë° ì¤‘ì ì„ ë‘¡ë‹ˆë‹¤.

Amazon Macieì˜ ì£¼ìš” ê¸°ëŠ¥:

1. **í™œì„± ë°ì´í„° ê²€í† **: AWS ê³„ì • ë‚´ì—ì„œ ë‹¤ì–‘í•œ ì‘ì—…ì´ ë°œìƒí•  ë•Œ ê¸°ê³„ í•™ìŠµì„ ì‚¬ìš©í•˜ì—¬ ë°ì´í„°ë¥¼ ì ê·¹ì ìœ¼ë¡œ ê²€í† í•©ë‹ˆë‹¤.
2. **ì´ìƒ íƒì§€**: ë¹„ì •ìƒì ì¸ í™œë™ì´ë‚˜ ì ‘ê·¼ íŒ¨í„´ì„ ì‹ë³„í•˜ì—¬ ì ì¬ì ì¸ ë°ì´í„° ë…¸ì¶œ ìœ„í—˜ì„ ì™„í™”í•˜ê¸° ìœ„í•œ ê²½ê³ ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.
3. **ì§€ì†ì ì¸ ëª¨ë‹ˆí„°ë§**: Amazon S3ì˜ ìƒˆë¡œìš´ ë°ì´í„°ë¥¼ ìë™ìœ¼ë¡œ ëª¨ë‹ˆí„°ë§í•˜ê³  ê°ì§€í•˜ë©°, ê¸°ê³„ í•™ìŠµê³¼ ì¸ê³µì§€ëŠ¥ì„ ì‚¬ìš©í•˜ì—¬ ì‹œê°„ì— ë”°ë¼ ë°ì´í„° ì ‘ê·¼ íŒ¨í„´ì— ì ì‘í•©ë‹ˆë‹¤.
4. **NLPë¥¼ í†µí•œ ë°ì´í„° ë¶„ë¥˜**: ìì—°ì–´ ì²˜ë¦¬(NLP)ë¥¼ í™œìš©í•˜ì—¬ ë‹¤ì–‘í•œ ë°ì´í„° ìœ í˜•ì„ ë¶„ë¥˜í•˜ê³  í•´ì„í•˜ë©°, ìœ„í—˜ ì ìˆ˜ë¥¼ ë¶€ì—¬í•˜ì—¬ ë°œê²¬ ì‚¬í•­ì˜ ìš°ì„  ìˆœìœ„ë¥¼ ë§¤ê¹ë‹ˆë‹¤.
5. **ë³´ì•ˆ ëª¨ë‹ˆí„°ë§**: API í‚¤, ë¹„ë°€ í‚¤ ë° ê°œì¸ ì •ë³´ë¥¼ í¬í•¨í•œ ë³´ì•ˆ ë¯¼ê° ë°ì´í„°ë¥¼ ì‹ë³„í•˜ì—¬ ë°ì´í„° ìœ ì¶œì„ ë°©ì§€í•˜ëŠ” ë° ë„ì›€ì„ ì¤ë‹ˆë‹¤.

Amazon MacieëŠ” **ì§€ì—­ ì„œë¹„ìŠ¤**ì´ë©°, ê¸°ëŠ¥ì„ ìœ„í•´ 'AWSMacieServiceCustomerSetupRole' IAM ì—­í• ê³¼ í™œì„±í™”ëœ AWS CloudTrailì´ í•„ìš”í•©ë‹ˆë‹¤.

### ê²½ê³  ì‹œìŠ¤í…œ

MacieëŠ” ê²½ê³ ë¥¼ ë‹¤ìŒê³¼ ê°™ì€ ë¯¸ë¦¬ ì •ì˜ëœ ë²”ì£¼ë¡œ ë¶„ë¥˜í•©ë‹ˆë‹¤:

* ìµëª…í™”ëœ ì ‘ê·¼
* ë°ì´í„° ì¤€ìˆ˜
* ìê²© ì¦ëª… ì†ì‹¤
* ê¶Œí•œ ìƒìŠ¹
* ëœì„¬ì›¨ì–´
* ì˜ì‹¬ìŠ¤ëŸ¬ìš´ ì ‘ê·¼ ë“±

ì´ ê²½ê³ ëŠ” íš¨ê³¼ì ì¸ ëŒ€ì‘ ë° í•´ê²°ì„ ìœ„í•œ ìì„¸í•œ ì„¤ëª…ê³¼ ê²°ê³¼ ë¶„ì„ì„ ì œê³µí•©ë‹ˆë‹¤.

### ëŒ€ì‹œë³´ë“œ ê¸°ëŠ¥

ëŒ€ì‹œë³´ë“œëŠ” ë°ì´í„°ë¥¼ ë‹¤ì–‘í•œ ì„¹ì…˜ìœ¼ë¡œ ë¶„ë¥˜í•©ë‹ˆë‹¤:

* S3 ê°ì²´ (ì‹œê°„ ë²”ìœ„, ACL, PII ê¸°ì¤€)
* ê³ ìœ„í—˜ CloudTrail ì´ë²¤íŠ¸/ì‚¬ìš©ì
* í™œë™ ìœ„ì¹˜
* CloudTrail ì‚¬ìš©ì ì‹ ì› ìœ í˜• ë“±.

### ì‚¬ìš©ì ë¶„ë¥˜

ì‚¬ìš©ìëŠ” API í˜¸ì¶œì˜ ìœ„í—˜ ìˆ˜ì¤€ì— ë”°ë¼ ê³„ì¸µìœ¼ë¡œ ë¶„ë¥˜ë©ë‹ˆë‹¤:

* **í”Œë˜í‹°ë„˜**: ë†’ì€ ìœ„í—˜ì˜ API í˜¸ì¶œ, ì¢…ì¢… ê´€ë¦¬ì ê¶Œí•œì„ ê°€ì§„ ê²½ìš°.
* **ê³¨ë“œ**: ì¸í”„ë¼ ê´€ë ¨ API í˜¸ì¶œ.
* **ì‹¤ë²„**: ì¤‘ê°„ ìœ„í—˜ì˜ API í˜¸ì¶œ.
* **ë¸Œë¡ ì¦ˆ**: ë‚®ì€ ìœ„í—˜ì˜ API í˜¸ì¶œ.

### ì‹ ì› ìœ í˜•

ì‹ ì› ìœ í˜•ì—ëŠ” Root, IAM ì‚¬ìš©ì, ê°€ì •ëœ ì—­í• , ì—°í•© ì‚¬ìš©ì, AWS ê³„ì • ë° AWS ì„œë¹„ìŠ¤ê°€ í¬í•¨ë˜ì–´ ìš”ì²­ì˜ ì¶œì²˜ë¥¼ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤.

### ë°ì´í„° ë¶„ë¥˜

ë°ì´í„° ë¶„ë¥˜ëŠ” ë‹¤ìŒì„ í¬í•¨í•©ë‹ˆë‹¤:

* ì½˜í…ì¸  ìœ í˜•: ê°ì§€ëœ ì½˜í…ì¸  ìœ í˜•ì— ë”°ë¼.
* íŒŒì¼ í™•ì¥ì: íŒŒì¼ í™•ì¥ìì— ë”°ë¼.
* ì£¼ì œ: íŒŒì¼ ë‚´ í‚¤ì›Œë“œì— ë”°ë¼ ë¶„ë¥˜.
* ì •ê·œ í‘œí˜„ì‹: íŠ¹ì • ì •ê·œ í‘œí˜„ì‹ íŒ¨í„´ì— ë”°ë¼ ë¶„ë¥˜.

ì´ ì¹´í…Œê³ ë¦¬ ì¤‘ ê°€ì¥ ë†’ì€ ìœ„í—˜ì´ íŒŒì¼ì˜ ìµœì¢… ìœ„í—˜ ìˆ˜ì¤€ì„ ê²°ì •í•©ë‹ˆë‹¤.

### ì—°êµ¬ ë° ë¶„ì„

Amazon Macieì˜ ì—°êµ¬ ê¸°ëŠ¥ì€ ëª¨ë“  Macie ë°ì´í„°ì— ëŒ€í•œ ì‚¬ìš©ì ì •ì˜ ì¿¼ë¦¬ë¥¼ í—ˆìš©í•˜ì—¬ ì‹¬ì¸µ ë¶„ì„ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤. í•„í„°ì—ëŠ” CloudTrail ë°ì´í„°, S3 ë²„í‚· ì†ì„± ë° S3 ê°ì²´ê°€ í¬í•¨ë©ë‹ˆë‹¤. ë˜í•œ, ë‹¤ë¥¸ ê³„ì •ì„ ì´ˆëŒ€í•˜ì—¬ Amazon Macieë¥¼ ê³µìœ í•  ìˆ˜ ìˆì–´ í˜‘ë ¥ì ì¸ ë°ì´í„° ê´€ë¦¬ ë° ë³´ì•ˆ ëª¨ë‹ˆí„°ë§ì„ ì´‰ì§„í•©ë‹ˆë‹¤.

### Enumeration
```
# Get buckets
aws macie2 describe-buckets

# Org config
aws macie2 describe-organization-configuration

# Get admin account (if any)
aws macie2 get-administrator-account
aws macie2 list-organization-admin-accounts # Run from the management account of the org

# Get macie account members (run this form the admin account)
aws macie2 list-members

# Check if automated sensitive data discovey is enabled
aws macie2 get-automated-discovery-configuration

# Get findings
aws macie2 list-findings
aws macie2 get-findings --finding-ids <ids>
aws macie2 list-findings-filters
aws macie2 get -findings-filters --id <id>

# Get allow lists
aws macie2 list-allow-lists
aws macie2 get-allow-list --id <id>

# Get different info
aws macie2 list-classification-jobs
aws macie2 list-classification-scopes
aws macie2 list-custom-data-identifiers
```
#### Post Exploitation

{% hint style="success" %}
ê³µê²©ìì˜ ê´€ì ì—ì„œ ì´ ì„œë¹„ìŠ¤ëŠ” ê³µê²©ìë¥¼ íƒì§€í•˜ê¸° ìœ„í•´ ë§Œë“¤ì–´ì§„ ê²ƒì´ ì•„ë‹ˆë¼ ì €ì¥ëœ íŒŒì¼ì—ì„œ ë¯¼ê°í•œ ì •ë³´ë¥¼ íƒì§€í•˜ê¸° ìœ„í•´ ë§Œë“¤ì–´ì¡ŒìŠµë‹ˆë‹¤. ë”°ë¼ì„œ ì´ ì„œë¹„ìŠ¤ëŠ” **ê³µê²©ìê°€ ë²„í‚· ë‚´ì—ì„œ ë¯¼ê°í•œ ì •ë³´ë¥¼ ì°¾ëŠ” ë° ë„ì›€ì„ ì¤„ ìˆ˜ ìˆìŠµë‹ˆë‹¤**.\
ê·¸ëŸ¬ë‚˜ ê³µê²©ìëŠ” í”¼í•´ìê°€ ê²½ê³ ë¥¼ ë°›ì§€ ëª»í•˜ë„ë¡ ë°©í•´í•˜ì—¬ ì •ë³´ë¥¼ ë” ì‰½ê²Œ í›”ì¹˜ë ¤ í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.
{% endhint %}

TODO: PRs are welcome!

## References

* [https://cloudacademy.com/blog/introducing-aws-security-hub/](https://cloudacademy.com/blog/introducing-aws-security-hub/)

{% hint style="success" %}
AWS í•´í‚¹ ë°°ìš°ê¸° ë° ì—°ìŠµí•˜ê¸°:<img src="../../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
GCP í•´í‚¹ ë°°ìš°ê¸° ë° ì—°ìŠµí•˜ê¸°: <img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks ì§€ì›í•˜ê¸°</summary>

* [**êµ¬ë… ê³„íš**](https://github.com/sponsors/carlospolop) í™•ì¸í•˜ê¸°!
* **ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— ì°¸ì—¬í•˜ê±°ë‚˜ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**ë¥¼ íŒ”ë¡œìš°í•˜ì„¸ìš”.**
* **[**HackTricks**](https://github.com/carlospolop/hacktricks) ë° [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) ê¹ƒí—ˆë¸Œ ë¦¬í¬ì§€í† ë¦¬ì— PRì„ ì œì¶œí•˜ì—¬ í•´í‚¹ íŒì„ ê³µìœ í•˜ì„¸ìš”.**

</details>
{% endhint %}
