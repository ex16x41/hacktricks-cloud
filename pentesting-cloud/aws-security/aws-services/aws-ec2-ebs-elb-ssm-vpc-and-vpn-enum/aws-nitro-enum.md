# AWS - Nitro Enum

{% hint style="success" %}
ÎœÎ¬Î¸ÎµÏ„Îµ ÎºÎ±Î¹ ÎµÎ¾Î±ÏƒÎºÎ·Î¸ÎµÎ¯Ï„Îµ ÏƒÏ„Î¿ AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
ÎœÎ¬Î¸ÎµÏ„Îµ ÎºÎ±Î¹ ÎµÎ¾Î±ÏƒÎºÎ·Î¸ÎµÎ¯Ï„Îµ ÏƒÏ„Î¿ GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Î¥Ï€Î¿ÏƒÏ„Î·ÏÎ¯Î¾Ï„Îµ Ï„Î¿ HackTricks</summary>

* Î•Î»Î­Î³Î¾Ï„Îµ Ï„Î± [**ÏƒÏ‡Î­Î´Î¹Î± ÏƒÏ…Î½Î´ÏÎ¿Î¼Î®Ï‚**](https://github.com/sponsors/carlospolop)!
* **Î•Î³Î³ÏÎ±Ï†ÎµÎ¯Ï„Îµ ÏƒÏ„Î·Î½** ğŸ’¬ [**Î¿Î¼Î¬Î´Î± Discord**](https://discord.gg/hRep4RUj7f) Î® ÏƒÏ„Î·Î½ [**Î¿Î¼Î¬Î´Î± telegram**](https://t.me/peass) Î® **Î±ÎºÎ¿Î»Î¿Ï…Î¸Î®ÏƒÏ„Îµ** Î¼Î±Ï‚ ÏƒÏ„Î¿ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **ÎœÎ¿Î¹ÏÎ±ÏƒÏ„ÎµÎ¯Ï„Îµ hacking tricks Ï…Ï€Î¿Î²Î¬Î»Î»Î¿Î½Ï„Î±Ï‚ PRs ÏƒÏ„Î±** [**HackTricks**](https://github.com/carlospolop/hacktricks) ÎºÎ±Î¹ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) Î±Ï€Î¿Î¸ÎµÏ„Î®ÏÎ¹Î± ÏƒÏ„Î¿ github.

</details>
{% endhint %}

## Î’Î±ÏƒÎ¹ÎºÎ­Ï‚ Î Î»Î·ÏÎ¿Ï†Î¿ÏÎ¯ÎµÏ‚

Î¤Î¿ AWS Nitro ÎµÎ¯Î½Î±Î¹ Î¼Î¹Î± ÏƒÎ¿Ï…Î¯Ï„Î± Î±Ï€ÏŒ **ÎºÎ±Î¹Î½Î¿Ï„ÏŒÎ¼ÎµÏ‚ Ï„ÎµÏ‡Î½Î¿Î»Î¿Î³Î¯ÎµÏ‚** Ï€Î¿Ï… Î±Ï€Î¿Ï„ÎµÎ»Î¿ÏÎ½ Ï„Î·Î½ Ï…Ï€Î¿ÎºÎµÎ¯Î¼ÎµÎ½Î· Ï€Î»Î±Ï„Ï†ÏŒÏÎ¼Î± Î³Î¹Î± Ï„Î¹Ï‚ EC2 instances Ï„Î¿Ï… AWS. Î•Î¹ÏƒÎ®Ï‡Î¸Î· Î±Ï€ÏŒ Ï„Î·Î½ Amazon Î³Î¹Î± Î½Î± **ÎµÎ½Î¹ÏƒÏ‡ÏÏƒÎµÎ¹ Ï„Î·Î½ Î±ÏƒÏ†Î¬Î»ÎµÎ¹Î±, Ï„Î·Î½ Î±Ï€ÏŒÎ´Î¿ÏƒÎ· ÎºÎ±Î¹ Ï„Î·Î½ Î±Î¾Î¹Î¿Ï€Î¹ÏƒÏ„Î¯Î±**, Ï„Î¿ Nitro Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÎµÎ¯ Ï€ÏÎ¿ÏƒÎ±ÏÎ¼Î¿ÏƒÎ¼Î­Î½Î± **Ï…Î»Î¹ÎºÎ¬ ÎµÎ¾Î±ÏÏ„Î®Î¼Î±Ï„Î± ÎºÎ±Î¹ Î­Î½Î±Î½ ÎµÎ»Î±Ï†ÏÏ hypervisor**. Î‘Ï†Î±Î¹ÏÎµÎ¯ Î¼ÎµÎ³Î¬Î»Î¿ Î¼Î­ÏÎ¿Ï‚ Ï„Î·Ï‚ Ï€Î±ÏÎ±Î´Î¿ÏƒÎ¹Î±ÎºÎ®Ï‚ Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¹ÎºÏŒÏ„Î·Ï„Î±Ï‚ ÎµÎ¹ÎºÎ¿Î½Î¹ÎºÎ¿Ï€Î¿Î¯Î·ÏƒÎ·Ï‚ ÏƒÎµ ÎµÎ¹Î´Î¹ÎºÏŒ Ï…Î»Î¹ÎºÏŒ ÎºÎ±Î¹ Î»Î¿Î³Î¹ÏƒÎ¼Î¹ÎºÏŒ, **ÎµÎ»Î±Ï‡Î¹ÏƒÏ„Î¿Ï€Î¿Î¹ÏÎ½Ï„Î±Ï‚ Ï„Î·Î½ ÎµÏ€Î¹Ï†Î¬Î½ÎµÎ¹Î± ÎµÏ€Î¯Î¸ÎµÏƒÎ·Ï‚** ÎºÎ±Î¹ Î²ÎµÎ»Ï„Î¹ÏÎ½Î¿Î½Ï„Î±Ï‚ Ï„Î·Î½ Î±Ï€Î¿Î´Î¿Ï„Î¹ÎºÏŒÏ„Î·Ï„Î± Ï„Ï‰Î½ Ï€ÏŒÏÏ‰Î½. ÎœÎµ Ï„Î·Î½ ÎµÎºÏ†ÏŒÏÏ„Ï‰ÏƒÎ· Ï„Ï‰Î½ Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¹ÏÎ½ ÎµÎ¹ÎºÎ¿Î½Î¹ÎºÎ¿Ï€Î¿Î¯Î·ÏƒÎ·Ï‚, Ï„Î¿ Nitro ÎµÏ€Î¹Ï„ÏÎ­Ï€ÎµÎ¹ ÏƒÏ„Î¹Ï‚ EC2 instances Î½Î± Ï€Î±ÏÎ­Ï‡Î¿Ï…Î½ **ÏƒÏ‡ÎµÎ´ÏŒÎ½ Î±Ï€ÏŒÎ´Î¿ÏƒÎ· Î³Ï…Î¼Î½Î¿Ï Î¼ÎµÏ„Î¬Î»Î»Î¿Ï…**, ÎºÎ±Î¸Î¹ÏƒÏ„ÏÎ½Ï„Î±Ï‚ Ï„Î¿ Î¹Î´Î¹Î±Î¯Ï„ÎµÏÎ± ÎµÏ€Ï‰Ï†ÎµÎ»Î­Ï‚ Î³Î¹Î± ÎµÏ†Î±ÏÎ¼Î¿Î³Î­Ï‚ Ï€Î¿Ï… Î±Ï€Î±Î¹Ï„Î¿ÏÎ½ Ï€Î¿Î»Î»Î¿ÏÏ‚ Ï€ÏŒÏÎ¿Ï…Ï‚. Î•Ï€Î¹Ï€Î»Î­Î¿Î½, Ï„Î¿ Nitro Security Chip Î´Î¹Î±ÏƒÏ†Î±Î»Î¯Î¶ÎµÎ¹ ÎµÎ¹Î´Î¹ÎºÎ¬ Ï„Î·Î½ **Î±ÏƒÏ†Î¬Î»ÎµÎ¹Î± Ï„Î¿Ï… Ï…Î»Î¹ÎºÎ¿Ï ÎºÎ±Î¹ Ï„Î¿Ï… firmware**, ÎµÎ½Î¹ÏƒÏ‡ÏÎ¿Î½Ï„Î±Ï‚ Ï€ÎµÏÎ±Î¹Ï„Î­ÏÏ‰ Ï„Î·Î½ Î¹ÏƒÏ‡Ï…ÏÎ® Î±ÏÏ‡Î¹Ï„ÎµÎºÏ„Î¿Î½Î¹ÎºÎ® Ï„Î¿Ï….

### Nitro Enclaves

Î¤Î¿ **AWS Nitro Enclaves** Ï€Î±ÏÎ­Ï‡ÎµÎ¹ Î­Î½Î± Î±ÏƒÏ†Î±Î»Î­Ï‚, **Î±Ï€Î¿Î¼Î¿Î½Ï‰Î¼Î­Î½Î¿ Ï€ÎµÏÎ¹Î²Î¬Î»Î»Î¿Î½ Ï…Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼Î¿Ï ÎµÎ½Ï„ÏŒÏ‚ Ï„Ï‰Î½ Amazon EC2 instances**, ÎµÎ¹Î´Î¹ÎºÎ¬ ÏƒÏ‡ÎµÎ´Î¹Î±ÏƒÎ¼Î­Î½Î¿ Î³Î¹Î± Ï„Î·Î½ ÎµÏ€ÎµÎ¾ÎµÏÎ³Î±ÏƒÎ¯Î± ÎµÎ¾Î±Î¹ÏÎµÏ„Î¹ÎºÎ¬ ÎµÏ…Î±Î¯ÏƒÎ¸Î·Ï„Ï‰Î½ Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½. Î§ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÏÎ½Ï„Î±Ï‚ Ï„Î¿ AWS Nitro System, Î±Ï…Ï„Î¬ Ï„Î± enclaves Î´Î¹Î±ÏƒÏ†Î±Î»Î¯Î¶Î¿Ï…Î½ Î¹ÏƒÏ‡Ï…ÏÎ® **Î±Ï€Î¿Î¼ÏŒÎ½Ï‰ÏƒÎ· ÎºÎ±Î¹ Î±ÏƒÏ†Î¬Î»ÎµÎ¹Î±**, Î¹Î´Î±Î½Î¹ÎºÎ¬ Î³Î¹Î± **Ï‡ÎµÎ¹ÏÎ¹ÏƒÎ¼ÏŒ ÎµÎ¼Ï€Î¹ÏƒÏ„ÎµÏ…Ï„Î¹ÎºÏÎ½ Ï€Î»Î·ÏÎ¿Ï†Î¿ÏÎ¹ÏÎ½** ÏŒÏ€Ï‰Ï‚ PII Î® Î¿Î¹ÎºÎ¿Î½Î¿Î¼Î¹ÎºÎ¬ Î±ÏÏ‡ÎµÎ¯Î±. Î”Î¹Î±Î¸Î­Ï„Î¿Ï…Î½ Î­Î½Î± Î¼Î¹Î½Î¹Î¼Î±Î»Î¹ÏƒÏ„Î¹ÎºÏŒ Ï€ÎµÏÎ¹Î²Î¬Î»Î»Î¿Î½, Î¼ÎµÎ¹ÏÎ½Î¿Î½Ï„Î±Ï‚ ÏƒÎ·Î¼Î±Î½Ï„Î¹ÎºÎ¬ Ï„Î¿Î½ ÎºÎ¯Î½Î´Ï…Î½Î¿ Î´Î¹Î±ÏÏÎ¿Î®Ï‚ Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½. Î•Ï€Î¹Ï€Î»Î­Î¿Î½, Ï„Î± Nitro Enclaves Ï…Ï€Î¿ÏƒÏ„Î·ÏÎ¯Î¶Î¿Ï…Î½ ÎºÏÏ…Ï€Ï„Î¿Î³ÏÎ±Ï†Î¹ÎºÎ® Ï€Î¹ÏƒÏ„Î¿Ï€Î¿Î¯Î·ÏƒÎ·, ÎµÏ€Î¹Ï„ÏÎ­Ï€Î¿Î½Ï„Î±Ï‚ ÏƒÏ„Î¿Ï…Ï‚ Ï‡ÏÎ®ÏƒÏ„ÎµÏ‚ Î½Î± ÎµÏ€Î±Î»Î·Î¸ÎµÏÎ¿Ï…Î½ ÏŒÏ„Î¹ ÎµÎºÏ„ÎµÎ»ÎµÎ¯Ï„Î±Î¹ Î¼ÏŒÎ½Î¿ ÎµÎ¾Î¿Ï…ÏƒÎ¹Î¿Î´Î¿Ï„Î·Î¼Î­Î½Î¿Ï‚ ÎºÏÎ´Î¹ÎºÎ±Ï‚, ÎºÏÎ¯ÏƒÎ¹Î¼Î¿ Î³Î¹Î± Ï„Î· Î´Î¹Î±Ï„Î®ÏÎ·ÏƒÎ· Î±Ï…ÏƒÏ„Î·ÏÏÎ½ Ï€ÏÎ¿Ï„ÏÏ€Ï‰Î½ ÏƒÏ…Î¼Î¼ÏŒÏÏ†Ï‰ÏƒÎ·Ï‚ ÎºÎ±Î¹ Ï€ÏÎ¿ÏƒÏ„Î±ÏƒÎ¯Î±Ï‚ Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½.

{% hint style="danger" %}
ÎŸÎ¹ ÎµÎ¹ÎºÏŒÎ½ÎµÏ‚ Nitro Enclave **ÎµÎºÏ„ÎµÎ»Î¿ÏÎ½Ï„Î±Î¹ Î±Ï€ÏŒ Î¼Î­ÏƒÎ± ÏƒÏ„Î¹Ï‚ EC2 instances** ÎºÎ±Î¹ Î´ÎµÎ½ Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Î´ÎµÎ¯Ï„Îµ Î±Ï€ÏŒ Ï„Î·Î½ ÎºÎ¿Î½ÏƒÏŒÎ»Î± web Ï„Î¿Ï… AWS Î±Î½ Î¼Î¹Î± EC2 instance ÎµÎºÏ„ÎµÎ»ÎµÎ¯ ÎµÎ¹ÎºÏŒÎ½ÎµÏ‚ ÏƒÎµ Nitro Enclave Î® ÏŒÏ‡Î¹.
{% endhint %}

## Î•Î³ÎºÎ±Ï„Î¬ÏƒÏ„Î±ÏƒÎ· Nitro Enclave CLI

Î‘ÎºÎ¿Î»Î¿Ï…Î¸Î®ÏƒÏ„Îµ ÏŒÎ»ÎµÏ‚ Ï„Î¹Ï‚ Î¿Î´Î·Î³Î¯ÎµÏ‚ [**Î±Ï€ÏŒ Ï„Î·Î½ Ï„ÎµÎºÎ¼Î·ÏÎ¯Ï‰ÏƒÎ·**](https://catalog.us-east-1.prod.workshops.aws/event/dashboard/en-US/workshop/1-my-first-enclave/1-1-nitro-enclaves-cli#run-connect-and-terminate-the-enclave). Î©ÏƒÏ„ÏŒÏƒÎ¿, Î±Ï…Ï„Î­Ï‚ ÎµÎ¯Î½Î±Î¹ Î¿Î¹ Ï€Î¹Î¿ ÏƒÎ·Î¼Î±Î½Ï„Î¹ÎºÎ­Ï‚:
```bash
# Install tools
sudo amazon-linux-extras install aws-nitro-enclaves-cli -y
sudo yum install aws-nitro-enclaves-cli-devel -y

# Config perms
sudo usermod -aG ne $USER
sudo usermod -aG docker $USER

# Check installation
nitro-cli --version

# Start and enable the Nitro Enclaves allocator service.
sudo systemctl start nitro-enclaves-allocator.service && sudo systemctl enable nitro-enclaves-allocator.service
```
## Nitro Enclave Images

ÎŸÎ¹ ÎµÎ¹ÎºÏŒÎ½ÎµÏ‚ Ï€Î¿Ï… Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± ÎµÎºÏ„ÎµÎ»Î­ÏƒÎµÏ„Îµ ÏƒÏ„Î¿ Nitro Enclave Î²Î±ÏƒÎ¯Î¶Î¿Î½Ï„Î±Î¹ ÏƒÎµ ÎµÎ¹ÎºÏŒÎ½ÎµÏ‚ docker, Î¿Ï€ÏŒÏ„Îµ Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î®ÏƒÎµÏ„Îµ Ï„Î¹Ï‚ ÎµÎ¹ÎºÏŒÎ½ÎµÏ‚ Nitro Enclave Î±Ï€ÏŒ ÎµÎ¹ÎºÏŒÎ½ÎµÏ‚ docker ÏŒÏ€Ï‰Ï‚:
```bash
# You need to have the docker image accesible in your running local registry
# Or indicate the full docker image URL to access the image
nitro-cli build-enclave --docker-uri <docker-img>:<tag> --output-file nitro-img.eif
```
ÎŒÏ€Ï‰Ï‚ Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Î´ÎµÎ¯Ï„Îµ, Î¿Î¹ ÎµÎ¹ÎºÏŒÎ½ÎµÏ‚ Nitro Enclave Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î¿ÏÎ½ Ï„Î·Î½ ÎµÏ€Î­ÎºÏ„Î±ÏƒÎ· **`eif`** (Enclave Image File).

Î— Î­Î¾Î¿Î´Î¿Ï‚ Î¸Î± Î¼Î¿Î¹Î¬Î¶ÎµÎ¹ Î¼Îµ:
```
Using the locally available Docker image...
Enclave Image successfully created.
{
"Measurements": {
"HashAlgorithm": "Sha384 { ... }",
"PCR0": "e199261541a944a93129a52a8909d29435dd89e31299b59c371158fc9ab3017d9c450b0a580a487e330b4ac691943284",
"PCR1": "bcdf05fefccaa8e55bf2c8d6dee9e79bbff31e34bf28a99aa19e6b29c37ee80b214a414b7607236edf26fcb78654e63f",
"PCR2": "2e1fca1dbb84622ec141557dfa971b4f8ea2127031b264136a20278c43d1bba6c75fea286cd4de9f00450b6a8db0e6d3"
}
}
```
### Î•ÎºÏ„Î­Î»ÎµÏƒÎ· Î¼Î¹Î±Ï‚ Î•Î¹ÎºÏŒÎ½Î±Ï‚

Î£ÏÎ¼Ï†Ï‰Î½Î± Î¼Îµ [**Ï„Î·Î½ Ï„ÎµÎºÎ¼Î·ÏÎ¯Ï‰ÏƒÎ·**](https://catalog.us-east-1.prod.workshops.aws/event/dashboard/en-US/workshop/1-my-first-enclave/1-1-nitro-enclaves-cli#run-connect-and-terminate-the-enclave), Î³Î¹Î± Î½Î± ÎµÎºÏ„ÎµÎ»Î­ÏƒÎµÏ„Îµ Î¼Î¹Î± ÎµÎ¹ÎºÏŒÎ½Î± enclave Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± Ï„Î·Ï‚ ÎµÎºÏ‡Ï‰ÏÎ®ÏƒÎµÏ„Îµ Î¼Î½Î®Î¼Î· **Ï„Î¿Ï…Î»Î¬Ï‡Î¹ÏƒÏ„Î¿Î½ 4 Ï†Î¿ÏÎ­Ï‚ Ï„Î¿ Î¼Î­Î³ÎµÎ¸Î¿Ï‚ Ï„Î¿Ï… Î±ÏÏ‡ÎµÎ¯Î¿Ï… `eif`**. Î•Î¯Î½Î±Î¹ Î´Ï…Î½Î±Ï„ÏŒÎ½ Î½Î± Î´Î¹Î±Î¼Î¿ÏÏ†ÏÏƒÎµÏ„Îµ Ï„Î¿Ï…Ï‚ Ï€ÏÎ¿ÎµÏ€Î¹Î»ÎµÎ³Î¼Î­Î½Î¿Ï…Ï‚ Ï€ÏŒÏÎ¿Ï…Ï‚ Ï€Î¿Ï… Î¸Î± Ï„Î·Ï‚ Î´Î¿Î¸Î¿ÏÎ½ ÏƒÏ„Î¿ Î±ÏÏ‡ÎµÎ¯Î¿
```shell
/etc/nitro_enclaves/allocator.yaml
```
{% hint style="danger" %}
Î Î¬Î½Ï„Î± Î½Î± Î¸Ï…Î¼Î¬ÏƒÏ„Îµ ÏŒÏ„Î¹ Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± **ÎºÏÎ±Ï„Î®ÏƒÎµÏ„Îµ ÎºÎ¬Ï€Î¿Î¹Î¿Ï…Ï‚ Ï€ÏŒÏÎ¿Ï…Ï‚ Î³Î¹Î± Ï„Î¿ Î³Î¿Î½Î¹ÎºÏŒ EC2** instance ÎµÏ€Î¯ÏƒÎ·Ï‚!
{% endhint %}

Î‘Ï†Î¿Ï Î³Î½Ï‰ÏÎ¯Î¶ÎµÏ„Îµ Ï„Î¿Ï…Ï‚ Ï€ÏŒÏÎ¿Ï…Ï‚ Ï€Î¿Ï… Î¸Î± Î´ÏÏƒÎµÏ„Îµ ÏƒÎµ Î¼Î¹Î± ÎµÎ¹ÎºÏŒÎ½Î± ÎºÎ±Î¹ Î­Ï‡Î¿Î½Ï„Î±Ï‚ Ï„ÏÎ¿Ï€Î¿Ï€Î¿Î¹Î®ÏƒÎµÎ¹ Ï„Î¿ Î±ÏÏ‡ÎµÎ¯Î¿ ÏÏ…Î¸Î¼Î¯ÏƒÎµÏ‰Î½, ÎµÎ¯Î½Î±Î¹ Î´Ï…Î½Î±Ï„ÏŒ Î½Î± ÎµÎºÏ„ÎµÎ»Î­ÏƒÎµÏ„Îµ Î¼Î¹Î± ÎµÎ¹ÎºÏŒÎ½Î± enclave Î¼Îµ:

{% code overflow="wrap" %}
```shell
# Restart the service so the new default values apply
sudo systemctl start nitro-enclaves-allocator.service && sudo systemctl enable nitro-enclaves-allocator.service

# Indicate the CPUs and memory to give
nitro-cli run-enclave --cpu-count 2 --memory 3072 --eif-path hello.eif --debug-mode --enclave-cid 16
```
{% endcode %}

### ÎšÎ±Ï„Î±Î¼Î­Ï„ÏÎ·ÏƒÎ· Enclaves

Î•Î¬Î½ Ï€Î±ÏÎ±Î²Î¹Î¬ÏƒÎµÏ„Îµ Î­Î½Î±Î½ EC2 host, ÎµÎ¯Î½Î±Î¹ Î´Ï…Î½Î±Ï„ÏŒ Î½Î± Î»Î¬Î²ÎµÏ„Îµ Î¼Î¹Î± Î»Î¯ÏƒÏ„Î± Î¼Îµ Ï„Î¹Ï‚ Ï„ÏÎ­Ï‡Î¿Ï…ÏƒÎµÏ‚ ÎµÎ¹ÎºÏŒÎ½ÎµÏ‚ enclave Î¼Îµ:
```bash
nitro-cli describe-enclaves
```
Î•Î¯Î½Î±Î¹ **Î±Î´ÏÎ½Î±Ï„Î¿ Î½Î± Î±Ï€Î¿ÎºÏ„Î®ÏƒÎµÏ„Îµ Î­Î½Î± shell** Î¼Î­ÏƒÎ± ÏƒÎµ Î¼Î¹Î± Ï„ÏÎ­Ï‡Î¿Ï…ÏƒÎ± ÎµÎ¹ÎºÏŒÎ½Î± enclave Î³Î¹Î±Ï„Î¯ Î±Ï…Ï„ÏŒÏ‚ ÎµÎ¯Î½Î±Î¹ Î¿ ÎºÏÏÎ¹Î¿Ï‚ ÏƒÎºÎ¿Ï€ÏŒÏ‚ Ï„Î¿Ï… enclave, Ï‰ÏƒÏ„ÏŒÏƒÎ¿, Î±Î½ Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î®ÏƒÎµÏ„Îµ Ï„Î·Î½ Ï€Î±ÏÎ¬Î¼ÎµÏ„ÏÎ¿ **`--debug-mode`**, ÎµÎ¯Î½Î±Î¹ Î´Ï…Î½Î±Ï„ÏŒ Î½Î± Î±Ï€Î¿ÎºÏ„Î®ÏƒÎµÏ„Îµ Ï„Î¿ **stdout** Ï„Î¿Ï… Î¼Îµ:
```shell
ENCLAVE_ID=$(nitro-cli describe-enclaves | jq -r ".[0].EnclaveID")
nitro-cli console --enclave-id ${ENCLAVE_ID}
```
### Terminate Enclaves

Î‘Î½ Î­Î½Î±Ï‚ ÎµÏ€Î¹Ï„Î¹Î¸Î­Î¼ÎµÎ½Î¿Ï‚ Ï€Î±ÏÎ±Î²Î¹Î¬ÏƒÎµÎ¹ Î­Î½Î± EC2 instance Î±Ï€ÏŒ Ï€ÏÎ¿ÎµÏ€Î¹Î»Î¿Î³Î® Î´ÎµÎ½ Î¸Î± Î¼Ï€Î¿ÏÎ­ÏƒÎµÎ¹ Î½Î± Î±Ï€Î¿ÎºÏ„Î®ÏƒÎµÎ¹ Î­Î½Î± shell Î¼Î­ÏƒÎ± ÏƒÎµ Î±Ï…Ï„Î¬, Î±Î»Î»Î¬ Î¸Î± Î¼Ï€Î¿ÏÎ­ÏƒÎµÎ¹ Î½Î± Ï„Î± **Ï„ÎµÏÎ¼Î±Ï„Î¯ÏƒÎµÎ¹** Î¼Îµ:
```shell
nitro-cli terminate-enclave --enclave-id ${ENCLAVE_ID}
```
## Vsocks

ÎŸ Î¼ÏŒÎ½Î¿Ï‚ Ï„ÏÏŒÏ€Î¿Ï‚ ÎµÏ€Î¹ÎºÎ¿Î¹Î½Ï‰Î½Î¯Î±Ï‚ Î¼Îµ Î¼Î¹Î± ÎµÎ¹ÎºÏŒÎ½Î± Ï€Î¿Ï… ÎµÎºÏ„ÎµÎ»ÎµÎ¯Ï„Î±Î¹ ÏƒÎµ **enclave** ÎµÎ¯Î½Î±Î¹ Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÏÎ½Ï„Î±Ï‚ **vsocks**.

**Virtual Socket (vsock)** ÎµÎ¯Î½Î±Î¹ Î¼Î¹Î± Î¿Î¹ÎºÎ¿Î³Î­Î½ÎµÎ¹Î± socket ÏƒÏ„Î¿ Linux Ï€Î¿Ï… Î­Ï‡ÎµÎ¹ ÏƒÏ‡ÎµÎ´Î¹Î±ÏƒÏ„ÎµÎ¯ ÎµÎ¹Î´Î¹ÎºÎ¬ Î³Î¹Î± Î½Î± Î´Î¹ÎµÏ…ÎºÎ¿Î»ÏÎ½ÎµÎ¹ Ï„Î·Î½ **ÎµÏ€Î¹ÎºÎ¿Î¹Î½Ï‰Î½Î¯Î±** Î¼ÎµÏ„Î±Î¾Ï ÎµÎ¹ÎºÎ¿Î½Î¹ÎºÏÎ½ Î¼Î·Ï‡Î±Î½ÏÎ½ (**VMs**) ÎºÎ±Î¹ Ï„Ï‰Î½ **hypervisors** Ï„Î¿Ï…Ï‚, Î® Î¼ÎµÏ„Î±Î¾Ï Ï„Ï‰Î½ Î¯Î´Î¹Ï‰Î½ Ï„Ï‰Î½ VMs. Î¤Î¿ Vsock ÎµÏ€Î¹Ï„ÏÎ­Ï€ÎµÎ¹ Î±Ï€Î¿Î´Î¿Ï„Î¹ÎºÎ®, **Î±Î¼Ï†Î¯Î´ÏÎ¿Î¼Î· ÎµÏ€Î¹ÎºÎ¿Î¹Î½Ï‰Î½Î¯Î±** Ï‡Ï‰ÏÎ¯Ï‚ Î½Î± Î²Î±ÏƒÎ¯Î¶ÎµÏ„Î±Î¹ ÏƒÏ„Î¿ Î´Î¯ÎºÏ„Ï…Î¿ Ï„Î¿Ï… host. Î‘Ï…Ï„ÏŒ ÎºÎ±Î¸Î¹ÏƒÏ„Î¬ Î´Ï…Î½Î±Ï„Î® Ï„Î·Î½ ÎµÏ€Î¹ÎºÎ¿Î¹Î½Ï‰Î½Î¯Î± Ï„Ï‰Î½ VMs Î±ÎºÏŒÎ¼Î· ÎºÎ±Î¹ Ï‡Ï‰ÏÎ¯Ï‚ ÏÏ…Î¸Î¼Î¯ÏƒÎµÎ¹Ï‚ Î´Î¹ÎºÏ„ÏÎ¿Ï…, **Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÏÎ½Ï„Î±Ï‚ Î­Î½Î± 32-bit Context ID (CID) ÎºÎ±Î¹ Î±ÏÎ¹Î¸Î¼Î¿ÏÏ‚ Î¸Ï…ÏÏÎ½** Î³Î¹Î± Ï„Î·Î½ Î±Î½Î±Î³Î½ÏÏÎ¹ÏƒÎ· ÎºÎ±Î¹ Î´Î¹Î±Ï‡ÎµÎ¯ÏÎ¹ÏƒÎ· Ï„Ï‰Î½ ÏƒÏ…Î½Î´Î­ÏƒÎµÏ‰Î½. Î¤Î¿ vsock API Ï…Ï€Î¿ÏƒÏ„Î·ÏÎ¯Î¶ÎµÎ¹ Ï„ÏŒÏƒÎ¿ Ï„ÏÏ€Î¿Ï…Ï‚ socket ÏÎ¿Î®Ï‚ ÏŒÏƒÎ¿ ÎºÎ±Î¹ datagram, Ï€Î±ÏÏŒÎ¼Î¿Î¹Î± Î¼Îµ Ï„Î± TCP ÎºÎ±Î¹ UDP, Ï€Î±ÏÎ­Ï‡Î¿Î½Ï„Î±Ï‚ Î­Î½Î± ÎµÏ…Î­Î»Î¹ÎºÏ„Î¿ ÎµÏÎ³Î±Î»ÎµÎ¯Î¿ Î³Î¹Î± ÎµÏ†Î±ÏÎ¼Î¿Î³Î­Ï‚ ÎµÏ€Î¹Ï€Î­Î´Î¿Ï… Ï‡ÏÎ®ÏƒÏ„Î· ÏƒÎµ ÎµÎ¹ÎºÎ¿Î½Î¹ÎºÎ¬ Ï€ÎµÏÎ¹Î²Î¬Î»Î»Î¿Î½Ï„Î±.

{% hint style="success" %}
Î•Ï€Î¿Î¼Î­Î½Ï‰Ï‚, Î¼Î¹Î± Î´Î¹ÎµÏÎ¸Ï…Î½ÏƒÎ· vsock Î¼Î¿Î¹Î¬Î¶ÎµÎ¹ Î¼Îµ Î±Ï…Ï„Î®: `<CID>:<Port>`
{% endhint %}

Î“Î¹Î± Î½Î± Î²ÏÎµÎ¯Ï„Îµ Ï„Î± **CIDs** Ï„Ï‰Î½ ÎµÎ¹ÎºÏŒÎ½Ï‰Î½ Ï€Î¿Ï… ÎµÎºÏ„ÎµÎ»Î¿ÏÎ½Ï„Î±Î¹ ÏƒÎµ enclave, Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î±Ï€Î»Î¬ Î½Î± ÎµÎºÏ„ÎµÎ»Î­ÏƒÎµÏ„Îµ Ï„Î·Î½ Î±ÎºÏŒÎ»Î¿Ï…Î¸Î· ÎµÎ½Ï„Î¿Î»Î® ÎºÎ±Î¹ Î½Î± Ï€Î¬ÏÎµÏ„Îµ Ï„Î¿ **`EnclaveCID`**:

<pre class="language-bash"><code class="lang-bash">nitro-cli describe-enclaves

[
{
"EnclaveName": "secure-channel-example",
"EnclaveID": "i-0bc274f83ade02a62-enc18ef3d09c886748",
"ProcessID": 10131,
<strong>    "EnclaveCID": 16,
</strong>    "NumberOfCPUs": 2,
"CPUIDs": [
1,
3
],
"MemoryMiB": 1024,
"State": "RUNNING",
"Flags": "DEBUG_MODE",
"Measurements": {
"HashAlgorithm": "Sha384 { ... }",
"PCR0": "e199261541a944a93129a52a8909d29435dd89e31299b59c371158fc9ab3017d9c450b0a580a487e330b4ac691943284",
"PCR1": "bcdf05fefccaa8e55bf2c8d6dee9e79bbff31e34bf28a99aa19e6b29c37ee80b214a414b7607236edf26fcb78654e63f",
"PCR2": "2e1fca1dbb84622ec141557dfa971b4f8ea2127031b264136a20278c43d1bba6c75fea286cd4de9f00450b6a8db0e6d3"
}
}
]
</code></pre>

{% hint style="warning" %}
Î£Î·Î¼ÎµÎ¹ÏÏƒÏ„Îµ ÏŒÏ„Î¹ Î±Ï€ÏŒ Ï„Î¿Î½ host Î´ÎµÎ½ Ï…Ï€Î¬ÏÏ‡ÎµÎ¹ Ï„ÏÏŒÏ€Î¿Ï‚ Î½Î± Î³Î½Ï‰ÏÎ¯Î¶ÎµÏ„Îµ Î±Î½ Î­Î½Î± CID ÎµÎºÎ¸Î­Ï„ÎµÎ¹ Î¿Ï€Î¿Î¹Î±Î´Î®Ï€Î¿Ï„Îµ Î¸ÏÏÎ±! Î•ÎºÏ„ÏŒÏ‚ Î±Î½ Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î®ÏƒÎµÏ„Îµ ÎºÎ¬Ï€Î¿Î¹Î¿ **vsock port scanner ÏŒÏ€Ï‰Ï‚** [**https://github.com/carlospolop/Vsock-scanner**](https://github.com/carlospolop/Vsock-scanner).
{% endhint %}

### Vsock Server/Listener

Î’ÏÎµÎ¯Ï„Îµ ÎµÎ´Ï Î¼ÎµÏÎ¹ÎºÎ¬ Ï€Î±ÏÎ±Î´ÎµÎ¯Î³Î¼Î±Ï„Î±:

* [https://github.com/aws-samples/aws-nitro-enclaves-workshop/blob/main/resources/code/my-first-enclave/secure-local-channel/server.py](https://github.com/aws-samples/aws-nitro-enclaves-workshop/blob/main/resources/code/my-first-enclave/secure-local-channel/server.py)

<details>

<summary>Î‘Ï€Î»ÏŒÏ‚ Python Listener</summary>
```python
#!/usr/bin/env python3

# From
https://medium.com/@F.DL/understanding-vsock-684016cf0eb0

import socket

CID = socket.VMADDR_CID_HOST
PORT = 9999

s = socket.socket(socket.AF_VSOCK, socket.SOCK_STREAM)
s.bind((CID, PORT))
s.listen()
(conn, (remote_cid, remote_port)) = s.accept()

print(f"Connection opened by cid={remote_cid} port={remote_port}")

while True:
buf = conn.recv(64)
if not buf:
break

print(f"Received bytes: {buf}")
```
</details>
```bash
# Using socat
socat VSOCK-LISTEN:<port>,fork EXEC:"echo Hello from server!"
```
### Vsock Client

Î Î±ÏÎ±Î´ÎµÎ¯Î³Î¼Î±Ï„Î±:

* [https://github.com/aws-samples/aws-nitro-enclaves-workshop/blob/main/resources/code/my-first-enclave/secure-local-channel/client.py](https://github.com/aws-samples/aws-nitro-enclaves-workshop/blob/main/resources/code/my-first-enclave/secure-local-channel/client.py)

<details>

<summary>Î‘Ï€Î»ÏŒÏ‚ Python Client</summary>
```python
#!/usr/bin/env python3

#From https://medium.com/@F.DL/understanding-vsock-684016cf0eb0

import socket

CID = socket.VMADDR_CID_HOST
PORT = 9999

s = socket.socket(socket.AF_VSOCK, socket.SOCK_STREAM)
s.connect((CID, PORT))
s.sendall(b"Hello, world!")
s.close()
```
</details>
```bash
# Using socat
echo "Hello, vsock!" | socat - VSOCK-CONNECT:3:5000
```
### Vsock Proxy

Î¤Î¿ ÎµÏÎ³Î±Î»ÎµÎ¯Î¿ vsock-proxy ÎµÏ€Î¹Ï„ÏÎ­Ï€ÎµÎ¹ Ï„Î·Î½ Ï€ÏÎ¿ÏÎ¸Î·ÏƒÎ· ÎµÎ½ÏŒÏ‚ vsock proxy Î¼Îµ Î¬Î»Î»Î· Î´Î¹ÎµÏÎ¸Ï…Î½ÏƒÎ·, Î³Î¹Î± Ï€Î±ÏÎ¬Î´ÎµÎ¹Î³Î¼Î±:
```bash
vsock-proxy 8001 ip-ranges.amazonaws.com 443 --config your-vsock-proxy.yaml
```
Î‘Ï…Ï„ÏŒ Î¸Î± Ï€ÏÎ¿Ï‰Î¸Î®ÏƒÎµÎ¹ Ï„Î·Î½ **Ï„Î¿Ï€Î¹ÎºÎ® Î¸ÏÏÎ± 8001 ÏƒÏ„Î¿ vsock** ÏƒÏ„Î¿ `ip-ranges.amazonaws.com:443` ÎºÎ±Î¹ Ï„Î¿ Î±ÏÏ‡ÎµÎ¯Î¿ **`your-vsock-proxy.yaml`** Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Î­Ï‡ÎµÎ¹ Î±Ï…Ï„ÏŒ Ï„Î¿ Ï€ÎµÏÎ¹ÎµÏ‡ÏŒÎ¼ÎµÎ½Î¿ ÎµÏ€Î¹Ï„ÏÎ­Ï€Î¿Î½Ï„Î±Ï‚ Ï„Î·Î½ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ· ÏƒÏ„Î¿ `ip-ranges.amazonaws.com:443`:
```yaml
allowlist:
- {address: ip-ranges.amazonaws.com, port: 443}
```
Î•Î¯Î½Î±Î¹ Î´Ï…Î½Î±Ï„ÏŒ Î½Î± Î´ÎµÎ¯Ï„Îµ Ï„Î¹Ï‚ Î´Î¹ÎµÏ…Î¸ÏÎ½ÏƒÎµÎ¹Ï‚ vsock (**`<CID>:<Port>`**) Ï€Î¿Ï… Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î¿ÏÎ½Ï„Î±Î¹ Î±Ï€ÏŒ Ï„Î¿Î½ EC2 host Î¼Îµ (ÏƒÎ·Î¼ÎµÎ¹ÏÏƒÏ„Îµ Ï„Î¿ `3:8001`, 3 ÎµÎ¯Î½Î±Î¹ Ï„Î¿ CID ÎºÎ±Î¹ 8001 Ï„Î¿ port):

{% code overflow="wrap" %}
```bash
sudo ss -l -p -n | grep v_str
v_str LISTEN 0      0                                                                              3:8001                   *:*     users:(("vsock-proxy",pid=9458,fd=3))
```
{% endcode %}

## Nitro Enclave Atestation & KMS

Î¤Î¿ Nitro Enclaves SDK ÎµÏ€Î¹Ï„ÏÎ­Ï€ÎµÎ¹ ÏƒÎµ Î­Î½Î± enclave Î½Î± Î¶Î·Ï„Î®ÏƒÎµÎ¹ Î­Î½Î± **ÎºÏÏ…Ï€Ï„Î¿Î³ÏÎ±Ï†Î¹ÎºÎ¬ Ï…Ï€Î¿Î³ÎµÎ³ÏÎ±Î¼Î¼Î­Î½Î¿ Î­Î³Î³ÏÎ±Ï†Î¿ Ï€Î¹ÏƒÏ„Î¿Ï€Î¿Î¯Î·ÏƒÎ·Ï‚** Î±Ï€ÏŒ Ï„Î¿ Nitro **Hypervisor**, Ï„Î¿ Î¿Ï€Î¿Î¯Î¿ Ï€ÎµÏÎ¹Î»Î±Î¼Î²Î¬Î½ÎµÎ¹ **Î¼Î¿Î½Î±Î´Î¹ÎºÎ­Ï‚ Î¼ÎµÏ„ÏÎ®ÏƒÎµÎ¹Ï‚** ÏƒÏ…Î³ÎºÎµÎºÏÎ¹Î¼Î­Î½ÎµÏ‚ Î³Î¹Î± Î±Ï…Ï„ÏŒ Ï„Î¿ enclave. Î‘Ï…Ï„Î­Ï‚ Î¿Î¹ Î¼ÎµÏ„ÏÎ®ÏƒÎµÎ¹Ï‚, Ï€Î¿Ï… Ï€ÎµÏÎ¹Î»Î±Î¼Î²Î¬Î½Î¿Ï…Î½ **hashes ÎºÎ±Î¹ platform configuration registers (PCRs)**, Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î¿ÏÎ½Ï„Î±Î¹ ÎºÎ±Ï„Î¬ Ï„Î· Î´Î¹Î±Î´Î¹ÎºÎ±ÏƒÎ¯Î± Ï€Î¹ÏƒÏ„Î¿Ï€Î¿Î¯Î·ÏƒÎ·Ï‚ Î³Î¹Î± Î½Î± **Î±Ï€Î¿Î´ÎµÎ¯Î¾Î¿Ï…Î½ Ï„Î·Î½ Ï„Î±Ï…Ï„ÏŒÏ„Î·Ï„Î± Ï„Î¿Ï… enclave** ÎºÎ±Î¹ Î½Î± **Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î®ÏƒÎ¿Ï…Î½ ÎµÎ¼Ï€Î¹ÏƒÏ„Î¿ÏƒÏÎ½Î· Î¼Îµ ÎµÎ¾Ï‰Ï„ÎµÏÎ¹ÎºÎ­Ï‚ Ï…Ï€Î·ÏÎµÏƒÎ¯ÎµÏ‚**. Î¤Î¿ Î­Î³Î³ÏÎ±Ï†Î¿ Ï€Î¹ÏƒÏ„Î¿Ï€Î¿Î¯Î·ÏƒÎ·Ï‚ ÏƒÏ…Î½Î®Î¸Ï‰Ï‚ Ï€ÎµÏÎ¹Î­Ï‡ÎµÎ¹ Ï„Î¹Î¼Î­Ï‚ ÏŒÏ€Ï‰Ï‚ PCR0, PCR1 ÎºÎ±Î¹ PCR2, Ï„Î¹Ï‚ Î¿Ï€Î¿Î¯ÎµÏ‚ Î­Ï‡ÎµÏ„Îµ ÏƒÏ…Î½Î±Î½Ï„Î®ÏƒÎµÎ¹ Ï€ÏÎ¿Î·Î³Î¿Ï…Î¼Î­Î½Ï‰Ï‚ ÎºÎ±Ï„Î¬ Ï„Î·Î½ ÎºÎ±Ï„Î±ÏƒÎºÎµÏ…Î® ÎºÎ±Î¹ Î±Ï€Î¿Î¸Î®ÎºÎµÏ…ÏƒÎ· ÎµÎ½ÏŒÏ‚ enclave EIF.

Î‘Ï€ÏŒ Ï„Î± [**docs**](https://catalog.us-east-1.prod.workshops.aws/event/dashboard/en-US/workshop/1-my-first-enclave/1-3-cryptographic-attestation#a-unique-feature-on-nitro-enclaves), Î±Ï…Ï„Î­Ï‚ ÎµÎ¯Î½Î±Î¹ Î¿Î¹ Ï„Î¹Î¼Î­Ï‚ PCR:

<table><thead><tr><th width="97">PCR</th><th width="221">Hash of ...</th><th>Description</th></tr></thead><tbody><tr><td>PCR0</td><td>Enclave image file</td><td>A contiguous measure of the contents of the image file, without the section data.</td></tr><tr><td>PCR1</td><td>Linux kernel and bootstrap</td><td>A contiguous measurement of the kernel and boot ramfs data.</td></tr><tr><td>PCR2</td><td>Application</td><td>A contiguous, in-order measurement of the user applications, without the boot ramfs.</td></tr><tr><td>PCR3</td><td>IAM role assigned to the parent instance</td><td>A contiguous measurement of the IAM role assigned to the parent instance. Ensures that the attestation process succeeds only when the parent instance has the correct IAM role.</td></tr><tr><td>PCR4</td><td>Instance ID of the parent instance</td><td>A contiguous measurement of the ID of the parent instance. Ensures that the attestation process succeeds only when the parent instance has a specific instance ID.</td></tr><tr><td>PCR8</td><td>Enclave image file signing certificate</td><td>A measure of the signing certificate specified for the enclave image file. Ensures that the attestation process succeeds only when the enclave was booted from an enclave image file signed by a specific certificate.</td></tr></tbody></table>

ÎœÏ€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± ÎµÎ½ÏƒÏ‰Î¼Î±Ï„ÏÏƒÎµÏ„Îµ Ï„Î·Î½ **ÎºÏÏ…Ï€Ï„Î¿Î³ÏÎ±Ï†Î¹ÎºÎ® Ï€Î¹ÏƒÏ„Î¿Ï€Î¿Î¯Î·ÏƒÎ·** ÏƒÏ„Î¹Ï‚ ÎµÏ†Î±ÏÎ¼Î¿Î³Î­Ï‚ ÏƒÎ±Ï‚ ÎºÎ±Î¹ Î½Î± Î±Î¾Î¹Î¿Ï€Î¿Î¹Î®ÏƒÎµÏ„Îµ Ï„Î¹Ï‚ Ï€ÏÎ¿-ÎµÎ½ÏƒÏ‰Î¼Î±Ï„Ï‰Î¼Î­Î½ÎµÏ‚ ÎµÎ½ÏƒÏ‰Î¼Î±Ï„ÏÏƒÎµÎ¹Ï‚ Î¼Îµ Ï…Ï€Î·ÏÎµÏƒÎ¯ÎµÏ‚ ÏŒÏ€Ï‰Ï‚ Ï„Î¿ **AWS KMS**. Î¤Î¿ AWS KMS Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± **ÎµÏ€Î±Î»Î·Î¸ÎµÏÏƒÎµÎ¹ Ï„Î¹Ï‚ Ï€Î¹ÏƒÏ„Î¿Ï€Î¿Î¹Î®ÏƒÎµÎ¹Ï‚ Ï„Ï‰Î½ enclaves** ÎºÎ±Î¹ Ï€ÏÎ¿ÏƒÏ†Î­ÏÎµÎ¹ ÎºÎ»ÎµÎ¹Î´Î¹Î¬ ÏƒÏ…Î½Î¸Î·ÎºÏÎ½ Î²Î±ÏƒÎ¹ÏƒÎ¼Î­Î½Î± ÏƒÏ„Î·Î½ Ï€Î¹ÏƒÏ„Î¿Ï€Î¿Î¯Î·ÏƒÎ· (`kms:RecipientAttestation:ImageSha384` ÎºÎ±Î¹ `kms:RecipientAttestation:PCR`) ÏƒÏ„Î¹Ï‚ Ï€Î¿Î»Î¹Ï„Î¹ÎºÎ­Ï‚ ÎºÎ»ÎµÎ¹Î´Î¹ÏÎ½ Ï„Î¿Ï…. Î‘Ï…Ï„Î­Ï‚ Î¿Î¹ Ï€Î¿Î»Î¹Ï„Î¹ÎºÎ­Ï‚ Î´Î¹Î±ÏƒÏ†Î±Î»Î¯Î¶Î¿Ï…Î½ ÏŒÏ„Î¹ Ï„Î¿ AWS KMS ÎµÏ€Î¹Ï„ÏÎ­Ï€ÎµÎ¹ Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¯ÎµÏ‚ Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÏÎ½Ï„Î±Ï‚ Ï„Î¿ ÎºÎ»ÎµÎ¹Î´Î¯ KMS **Î¼ÏŒÎ½Î¿ ÎµÎ¬Î½ Ï„Î¿ Î­Î³Î³ÏÎ±Ï†Î¿ Ï€Î¹ÏƒÏ„Î¿Ï€Î¿Î¯Î·ÏƒÎ·Ï‚ Ï„Î¿Ï… enclave ÎµÎ¯Î½Î±Î¹ Î­Î³ÎºÏ…ÏÎ¿** ÎºÎ±Î¹ Ï€Î»Î·ÏÎ¿Î¯ Ï„Î¹Ï‚ **ÎºÎ±Î¸Î¿ÏÎ¹ÏƒÎ¼Î­Î½ÎµÏ‚ ÏƒÏ…Î½Î¸Î®ÎºÎµÏ‚**.

{% hint style="success" %}
Î£Î·Î¼ÎµÎ¹ÏÏƒÏ„Îµ ÏŒÏ„Î¹ Ï„Î± Enclaves ÏƒÎµ Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¯Î± debug (--debug) Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î¿ÏÎ½ Î­Î³Î³ÏÎ±Ï†Î± Ï€Î¹ÏƒÏ„Î¿Ï€Î¿Î¯Î·ÏƒÎ·Ï‚ Î¼Îµ PCRs Ï€Î¿Ï… Î±Ï€Î¿Ï„ÎµÎ»Î¿ÏÎ½Ï„Î±Î¹ Î±Ï€ÏŒ Î¼Î·Î´ÎµÎ½Î¹ÎºÎ¬ (`000000000000000000000000000000000000000000000000`). Î•Ï€Î¿Î¼Î­Î½Ï‰Ï‚, Î¿Î¹ Ï€Î¿Î»Î¹Ï„Î¹ÎºÎ­Ï‚ KMS Ï€Î¿Ï… ÎµÎ»Î­Î³Ï‡Î¿Ï…Î½ Î±Ï…Ï„Î­Ï‚ Ï„Î¹Ï‚ Ï„Î¹Î¼Î­Ï‚ Î¸Î± Î±Ï€Î¿Ï„ÏÏ‡Î¿Ï…Î½.
{% endhint %}

### PCR Bypass

Î‘Ï€ÏŒ Ï„Î·Î½ Ï€ÏÎ¿Î¿Ï€Ï„Î¹ÎºÎ® ÎµÎ½ÏŒÏ‚ ÎµÏ€Î¹Ï„Î¹Î¸Î­Î¼ÎµÎ½Î¿Ï…, Ï€Î±ÏÎ±Ï„Î·ÏÎ®ÏƒÏ„Îµ ÏŒÏ„Î¹ Î¿ÏÎ¹ÏƒÎ¼Î­Î½Î± PCRs Î¸Î± ÎµÏ€Î­Ï„ÏÎµÏ€Î±Î½ Ï„Î·Î½ Ï„ÏÎ¿Ï€Î¿Ï€Î¿Î¯Î·ÏƒÎ· Î¿ÏÎ¹ÏƒÎ¼Î­Î½Ï‰Î½ Î¼ÎµÏÏÎ½ Î® Î¿Î»ÏŒÎºÎ»Î·ÏÎ¿Ï… Ï„Î¿Ï… Î±ÏÏ‡ÎµÎ¯Î¿Ï… ÎµÎ¹ÎºÏŒÎ½Î±Ï‚ Ï„Î¿Ï… enclave ÎºÎ±Î¹ Î¸Î± ÎµÎ¾Î±ÎºÎ¿Î»Î¿Ï…Î¸Î¿ÏÏƒÎ±Î½ Î½Î± ÎµÎ¯Î½Î±Î¹ Î­Î³ÎºÏ…ÏÎ± (Î³Î¹Î± Ï€Î±ÏÎ¬Î´ÎµÎ¹Î³Î¼Î±, Ï„Î¿ PCR4 ÎµÎ»Î­Î³Ï‡ÎµÎ¹ Î¼ÏŒÎ½Î¿ Ï„Î¿ ID Ï„Î¿Ï… Î³Î¿Î½Î¹ÎºÎ¿Ï instance, Î¿Ï€ÏŒÏ„Îµ Î· ÎµÎºÏ„Î­Î»ÎµÏƒÎ· Î¿Ï€Î¿Î¹Î¿Ï…Î´Î®Ï€Î¿Ï„Îµ Î±ÏÏ‡ÎµÎ¯Î¿Ï… ÎµÎ¹ÎºÏŒÎ½Î±Ï‚ enclave ÏƒÎµ Î±Ï…Ï„ÏŒ Ï„Î¿ EC2 Î¸Î± ÎµÏ€Î¹Ï„ÏÎ­ÏˆÎµÎ¹ Ï„Î·Î½ ÎµÎºÏ€Î»Î®ÏÏ‰ÏƒÎ· Î±Ï…Ï„Î®Ï‚ Ï„Î·Ï‚ Ï€Î¹Î¸Î±Î½Î®Ï‚ Î±Ï€Î±Î¯Ï„Î·ÏƒÎ·Ï‚ PCR).

Î•Ï€Î¿Î¼Î­Î½Ï‰Ï‚, Î­Î½Î±Ï‚ ÎµÏ€Î¹Ï„Î¹Î¸Î­Î¼ÎµÎ½Î¿Ï‚ Ï€Î¿Ï… Î¸Î± Ï€Î±ÏÎ±Î²Î¹Î¬ÏƒÎµÎ¹ Ï„Î¿ EC2 instance Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± ÎµÎ¯Î½Î±Î¹ ÏƒÎµ Î¸Î­ÏƒÎ· Î½Î± ÎµÎºÏ„ÎµÎ»Î­ÏƒÎµÎ¹ Î¬Î»Î»ÎµÏ‚ ÎµÎ¹ÎºÏŒÎ½ÎµÏ‚ enclave Î³Î¹Î± Î½Î± Ï€Î±ÏÎ±ÎºÎ¬Î¼ÏˆÎµÎ¹ Î±Ï…Ï„Î­Ï‚ Ï„Î¹Ï‚ Ï€ÏÎ¿ÏƒÏ„Î±ÏƒÎ¯ÎµÏ‚.

Î— Î­ÏÎµÏ…Î½Î± Î³Î¹Î± Ï„Î¿ Ï€ÏÏ‚ Î½Î± Ï„ÏÎ¿Ï€Î¿Ï€Î¿Î¹Î®ÏƒÎµÏ„Îµ/Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î®ÏƒÎµÏ„Îµ Î½Î­ÎµÏ‚ ÎµÎ¹ÎºÏŒÎ½ÎµÏ‚ Î³Î¹Î± Î½Î± Ï€Î±ÏÎ±ÎºÎ¬Î¼ÏˆÎµÏ„Îµ ÎºÎ¬Î¸Îµ Ï€ÏÎ¿ÏƒÏ„Î±ÏƒÎ¯Î± (ÎµÎ¹Î´Î¹ÎºÎ¬ Ï„Î¹Ï‚ ÏŒÏ‡Î¹ Ï„ÏŒÏƒÎ¿ Ï€ÏÎ¿Ï†Î±Î½ÎµÎ¯Ï‚) ÎµÎ¯Î½Î±Î¹ Î±ÎºÏŒÎ¼Î± ÏƒÎµ ÎµÎ¾Î­Î»Î¹Î¾Î·.

## References

* [https://medium.com/@F.DL/understanding-vsock-684016cf0eb0](https://medium.com/@F.DL/understanding-vsock-684016cf0eb0)
* ÎŒÎ»Î± Ï„Î± Î¼Î­ÏÎ· Ï„Î¿Ï… Nitro tutorial Î±Ï€ÏŒ Ï„Î¿ AWS: [https://catalog.us-east-1.prod.workshops.aws/event/dashboard/en-US/workshop/1-my-first-enclave/1-1-nitro-enclaves-cli](https://catalog.us-east-1.prod.workshops.aws/event/dashboard/en-US/workshop/1-my-first-enclave/1-1-nitro-enclaves-cli)

{% hint style="success" %}
ÎœÎ¬Î¸ÎµÏ„Îµ & ÎµÎ¾Î±ÏƒÎºÎ·Î¸ÎµÎ¯Ï„Îµ ÏƒÏ„Î¿ AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
ÎœÎ¬Î¸ÎµÏ„Îµ & ÎµÎ¾Î±ÏƒÎºÎ·Î¸ÎµÎ¯Ï„Îµ ÏƒÏ„Î¿ GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Î•Î»Î­Î³Î¾Ï„Îµ Ï„Î± [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Î•Î³Î³ÏÎ±Ï†ÎµÎ¯Ï„Îµ ÏƒÏ„Î·Î½** ğŸ’¬ [**Î¿Î¼Î¬Î´Î± Discord**](https://discord.gg/hRep4RUj7f) Î® ÏƒÏ„Î·Î½ [**Î¿Î¼Î¬Î´Î± telegram**](https://t.me/peass) Î® **Î±ÎºÎ¿Î»Î¿Ï…Î¸Î®ÏƒÏ„Îµ** Î¼Î±Ï‚ ÏƒÏ„Î¿ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **ÎœÎ¿Î¹ÏÎ±ÏƒÏ„ÎµÎ¯Ï„Îµ hacking tricks Ï…Ï€Î¿Î²Î¬Î»Î»Î¿Î½Ï„Î±Ï‚ PRs ÏƒÏ„Î±** [**HackTricks**](https://github.com/carlospolop/hacktricks) ÎºÎ±Î¹ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
