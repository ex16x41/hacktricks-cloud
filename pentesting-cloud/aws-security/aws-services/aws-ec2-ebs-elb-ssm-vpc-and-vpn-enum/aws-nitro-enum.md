# AWS - Nitro Enum

{% hint style="success" %}
å­¦ä¹ å’Œç»ƒä¹  AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
å­¦ä¹ å’Œç»ƒä¹  GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>æ”¯æŒ HackTricks</summary>

* æŸ¥çœ‹ [**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**telegram ç¾¤ç»„**](https://t.me/peass) æˆ– **å…³æ³¨** æˆ‘ä»¬çš„ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **é€šè¿‡æäº¤ PRs åˆ†äº«é»‘å®¢æŠ€å·§åˆ°** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ä»“åº“ã€‚

</details>
{% endhint %}

## åŸºæœ¬ä¿¡æ¯

AWS Nitro æ˜¯ä¸€å¥—**åˆ›æ–°æŠ€æœ¯**ï¼Œæ„æˆäº† AWS EC2 å®ä¾‹çš„åŸºç¡€å¹³å°ã€‚ç”± Amazon æ¨å‡ºä»¥**å¢å¼ºå®‰å…¨æ€§ã€æ€§èƒ½å’Œå¯é æ€§**ï¼ŒNitro åˆ©ç”¨å®šåˆ¶çš„**ç¡¬ä»¶ç»„ä»¶å’Œè½»é‡çº§çš„ hypervisor**ã€‚å®ƒå°†ä¼ ç»Ÿè™šæ‹ŸåŒ–åŠŸèƒ½çš„å¤§éƒ¨åˆ†æŠ½è±¡åˆ°ä¸“ç”¨ç¡¬ä»¶å’Œè½¯ä»¶ä¸­ï¼Œ**æœ€å°åŒ–æ”»å‡»é¢**å¹¶æé«˜èµ„æºæ•ˆç‡ã€‚é€šè¿‡å¸è½½è™šæ‹ŸåŒ–åŠŸèƒ½ï¼ŒNitro ä½¿ EC2 å®ä¾‹èƒ½å¤Ÿæä¾›**æ¥è¿‘è£¸æœºçš„æ€§èƒ½**ï¼Œè¿™å¯¹èµ„æºå¯†é›†å‹åº”ç”¨ç‰¹åˆ«æœ‰åˆ©ã€‚æ­¤å¤–ï¼ŒNitro å®‰å…¨èŠ¯ç‰‡ä¸“é—¨ç¡®ä¿**ç¡¬ä»¶å’Œå›ºä»¶çš„å®‰å…¨æ€§**ï¼Œè¿›ä¸€æ­¥å·©å›ºå…¶å¼ºå¤§çš„æ¶æ„ã€‚

### Nitro Enclaves

**AWS Nitro Enclaves** æä¾›ä¸€ä¸ªå®‰å…¨çš„ã€**éš”ç¦»çš„è®¡ç®—ç¯å¢ƒ**ï¼Œä½äº Amazon EC2 å®ä¾‹å†…ï¼Œä¸“ä¸ºå¤„ç†é«˜åº¦æ•æ„Ÿçš„æ•°æ®è€Œè®¾è®¡ã€‚åˆ©ç”¨ AWS Nitro ç³»ç»Ÿï¼Œè¿™äº› enclaves ç¡®ä¿äº†å¼ºå¤§çš„**éš”ç¦»å’Œå®‰å…¨æ€§**ï¼Œéå¸¸é€‚åˆ**å¤„ç†æœºå¯†ä¿¡æ¯**ï¼Œå¦‚ PII æˆ–è´¢åŠ¡è®°å½•ã€‚å®ƒä»¬å…·æœ‰æç®€ç¯å¢ƒï¼Œæ˜¾è‘—é™ä½äº†æ•°æ®æš´éœ²çš„é£é™©ã€‚æ­¤å¤–ï¼ŒNitro Enclaves æ”¯æŒåŠ å¯†è®¤è¯ï¼Œå…è®¸ç”¨æˆ·éªŒè¯åªæœ‰æˆæƒä»£ç åœ¨è¿è¡Œï¼Œè¿™å¯¹äºä¿æŒä¸¥æ ¼çš„åˆè§„æ€§å’Œæ•°æ®ä¿æŠ¤æ ‡å‡†è‡³å…³é‡è¦ã€‚

{% hint style="danger" %}
Nitro Enclave é•œåƒ**ä» EC2 å®ä¾‹å†…éƒ¨è¿è¡Œ**ï¼Œä½ æ— æ³•ä» AWS web æ§åˆ¶å°çœ‹åˆ° EC2 å®ä¾‹æ˜¯å¦åœ¨ Nitro Enclave ä¸­è¿è¡Œé•œåƒã€‚
{% endhint %}

## Nitro Enclave CLI å®‰è£…

æŒ‰ç…§[**æ–‡æ¡£**](https://catalog.us-east-1.prod.workshops.aws/event/dashboard/en-US/workshop/1-my-first-enclave/1-1-nitro-enclaves-cli#run-connect-and-terminate-the-enclave)ä¸­çš„æ‰€æœ‰è¯´æ˜è¿›è¡Œæ“ä½œã€‚ç„¶è€Œï¼Œä»¥ä¸‹æ˜¯æœ€é‡è¦çš„éƒ¨åˆ†ï¼š
```bash
# Install tools
sudo amazon-linux-extras install aws-nitro-enclaves-cli -y
sudo yum install aws-nitro-enclaves-cli-devel -y

# Config perms
sudo usermod -aG ne $USER
sudo usermod -aG docker $USER

# Check installation
nitro-cli --version

# Start and enable the Nitro Enclaves allocator service.
sudo systemctl start nitro-enclaves-allocator.service && sudo systemctl enable nitro-enclaves-allocator.service
```
## Nitro Enclave Images

ä½ å¯ä»¥åœ¨ Nitro Enclave ä¸­è¿è¡Œçš„é•œåƒæ˜¯åŸºäº docker é•œåƒçš„ï¼Œæ‰€ä»¥ä½ å¯ä»¥ä» docker é•œåƒåˆ›å»ºä½ çš„ Nitro Enclave é•œåƒï¼Œå¦‚ï¼š
```bash
# You need to have the docker image accesible in your running local registry
# Or indicate the full docker image URL to access the image
nitro-cli build-enclave --docker-uri <docker-img>:<tag> --output-file nitro-img.eif
```
å¦‚ä½ æ‰€è§ï¼ŒNitro Enclave é•œåƒä½¿ç”¨æ‰©å±•å **`eif`**ï¼ˆEnclave Image Fileï¼‰ã€‚

è¾“å‡ºå°†ç±»ä¼¼äºï¼š
```
Using the locally available Docker image...
Enclave Image successfully created.
{
"Measurements": {
"HashAlgorithm": "Sha384 { ... }",
"PCR0": "e199261541a944a93129a52a8909d29435dd89e31299b59c371158fc9ab3017d9c450b0a580a487e330b4ac691943284",
"PCR1": "bcdf05fefccaa8e55bf2c8d6dee9e79bbff31e34bf28a99aa19e6b29c37ee80b214a414b7607236edf26fcb78654e63f",
"PCR2": "2e1fca1dbb84622ec141557dfa971b4f8ea2127031b264136a20278c43d1bba6c75fea286cd4de9f00450b6a8db0e6d3"
}
}
```
### è¿è¡Œä¸€ä¸ªé•œåƒ

æ ¹æ®[**æ–‡æ¡£**](https://catalog.us-east-1.prod.workshops.aws/event/dashboard/en-US/workshop/1-my-first-enclave/1-1-nitro-enclaves-cli#run-connect-and-terminate-the-enclave)ï¼Œä¸ºäº†è¿è¡Œä¸€ä¸ªenclaveé•œåƒï¼Œä½ éœ€è¦åˆ†é…**è‡³å°‘æ˜¯`eif`æ–‡ä»¶å¤§å°4å€çš„å†…å­˜**ã€‚å¯ä»¥åœ¨æ–‡ä»¶ä¸­é…ç½®é»˜è®¤èµ„æºç»™å®ƒ
```shell
/etc/nitro_enclaves/allocator.yaml
```
{% hint style="danger" %}
è¯·åŠ¡å¿…è®°ä½ï¼Œæ‚¨è¿˜éœ€è¦ä¸º**çˆ¶ EC2 å®ä¾‹ä¿ç•™ä¸€äº›èµ„æº**ï¼
{% endhint %}

åœ¨äº†è§£äº†è¦åˆ†é…ç»™é•œåƒçš„èµ„æºå¹¶ä¿®æ”¹äº†é…ç½®æ–‡ä»¶åï¼Œå¯ä»¥è¿è¡Œä¸€ä¸ª enclave é•œåƒï¼š

{% code overflow="wrap" %}
```shell
# Restart the service so the new default values apply
sudo systemctl start nitro-enclaves-allocator.service && sudo systemctl enable nitro-enclaves-allocator.service

# Indicate the CPUs and memory to give
nitro-cli run-enclave --cpu-count 2 --memory 3072 --eif-path hello.eif --debug-mode --enclave-cid 16
```
{% endcode %}

### æšä¸¾ Enclaves

å¦‚æœä½ æ”»ç ´äº†ä¸€ä¸ª EC2 ä¸»æœºï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è·å–æ­£åœ¨è¿è¡Œçš„ enclave é•œåƒåˆ—è¡¨ï¼š
```bash
nitro-cli describe-enclaves
```
åœ¨è¿è¡Œçš„enclaveé•œåƒä¸­**æ— æ³•è·å–shell**ï¼Œå› ä¸ºè¿™æ˜¯enclaveçš„ä¸»è¦ç›®çš„ï¼Œä½†æ˜¯ï¼Œå¦‚æœä½ ä½¿ç”¨äº†å‚æ•°**`--debug-mode`**ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼è·å–å®ƒçš„**stdout**ï¼š
```shell
ENCLAVE_ID=$(nitro-cli describe-enclaves | jq -r ".[0].EnclaveID")
nitro-cli console --enclave-id ${ENCLAVE_ID}
```
### Terminate Enclaves

å¦‚æœæ”»å‡»è€…é»˜è®¤æƒ…å†µä¸‹æ”»é™·äº†ä¸€ä¸ªEC2å®ä¾‹ï¼Œä»–å°†æ— æ³•åœ¨å…¶ä¸­è·å–shellï¼Œä½†ä»–å°†èƒ½å¤Ÿ**ç»ˆæ­¢å®ƒä»¬**ï¼Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š
```shell
nitro-cli terminate-enclave --enclave-id ${ENCLAVE_ID}
```
## Vsocks

ä¸è¿è¡Œä¸­çš„**enclave**é•œåƒé€šä¿¡çš„å”¯ä¸€æ–¹å¼æ˜¯ä½¿ç”¨**vsocks**ã€‚

**Virtual Socket (vsock)** æ˜¯ Linux ä¸­ä¸“é—¨è®¾è®¡ç”¨äºä¿ƒè¿›è™šæ‹Ÿæœºï¼ˆ**VMs**ï¼‰ä¸å…¶**hypervisors**ä¹‹é—´æˆ–è™šæ‹Ÿæœº**ä¹‹é—´**é€šä¿¡çš„å¥—æ¥å­—å®¶æ—ã€‚Vsock ä½¿å¾—åœ¨ä¸ä¾èµ–ä¸»æœºç½‘ç»œå †æ ˆçš„æƒ…å†µä¸‹å®ç°é«˜æ•ˆçš„**åŒå‘é€šä¿¡**æˆä¸ºå¯èƒ½ã€‚è¿™ä½¿å¾—å³ä½¿æ²¡æœ‰ç½‘ç»œé…ç½®ï¼Œè™šæ‹Ÿæœºä¹Ÿå¯ä»¥é€šä¿¡ï¼Œ**ä½¿ç”¨ 32 ä½ä¸Šä¸‹æ–‡ ID (CID) å’Œç«¯å£å·**æ¥è¯†åˆ«å’Œç®¡ç†è¿æ¥ã€‚Vsock API æ”¯æŒæµå’Œæ•°æ®æŠ¥å¥—æ¥å­—ç±»å‹ï¼Œç±»ä¼¼äº TCP å’Œ UDPï¼Œä¸ºè™šæ‹Ÿç¯å¢ƒä¸­çš„ç”¨æˆ·çº§åº”ç”¨ç¨‹åºæä¾›äº†å¤šåŠŸèƒ½å·¥å…·ã€‚

{% hint style="success" %}
å› æ­¤ï¼Œvsock åœ°å€çœ‹èµ·æ¥åƒè¿™æ ·ï¼š`<CID>:<Port>`
{% endhint %}

è¦æŸ¥æ‰¾è¿è¡Œä¸­çš„ enclave é•œåƒçš„ **CIDs**ï¼Œåªéœ€æ‰§è¡Œä»¥ä¸‹å‘½ä»¤å¹¶è·å– **`EnclaveCID`**ï¼š

<pre class="language-bash"><code class="lang-bash">nitro-cli describe-enclaves

[
{
"EnclaveName": "secure-channel-example",
"EnclaveID": "i-0bc274f83ade02a62-enc18ef3d09c886748",
"ProcessID": 10131,
<strong>    "EnclaveCID": 16,
</strong>    "NumberOfCPUs": 2,
"CPUIDs": [
1,
3
],
"MemoryMiB": 1024,
"State": "RUNNING",
"Flags": "DEBUG_MODE",
"Measurements": {
"HashAlgorithm": "Sha384 { ... }",
"PCR0": "e199261541a944a93129a52a8909d29435dd89e31299b59c371158fc9ab3017d9c450b0a580a487e330b4ac691943284",
"PCR1": "bcdf05fefccaa8e55bf2c8d6dee9e79bbff31e34bf28a99aa19e6b29c37ee80b214a414b7607236edf26fcb78654e63f",
"PCR2": "2e1fca1dbb84622ec141557dfa971b4f8ea2127031b264136a20278c43d1bba6c75fea286cd4de9f00450b6a8db0e6d3"
}
}
]
</code></pre>

{% hint style="warning" %}
è¯·æ³¨æ„ï¼Œä»ä¸»æœºä¸Šæ— æ³•çŸ¥é“ CID æ˜¯å¦æš´éœ²äº†ä»»ä½•ç«¯å£ï¼é™¤éä½¿ç”¨ä¸€äº›**vsock ç«¯å£æ‰«æå™¨ï¼Œå¦‚** [**https://github.com/carlospolop/Vsock-scanner**](https://github.com/carlospolop/Vsock-scanner)ã€‚
{% endhint %}

### Vsock Server/Listener

è¿™é‡Œæœ‰å‡ ä¸ªç¤ºä¾‹ï¼š

* [https://github.com/aws-samples/aws-nitro-enclaves-workshop/blob/main/resources/code/my-first-enclave/secure-local-channel/server.py](https://github.com/aws-samples/aws-nitro-enclaves-workshop/blob/main/resources/code/my-first-enclave/secure-local-channel/server.py)

<details>

<summary>Simple Python Listener</summary>
```python
#!/usr/bin/env python3

# From
https://medium.com/@F.DL/understanding-vsock-684016cf0eb0

import socket

CID = socket.VMADDR_CID_HOST
PORT = 9999

s = socket.socket(socket.AF_VSOCK, socket.SOCK_STREAM)
s.bind((CID, PORT))
s.listen()
(conn, (remote_cid, remote_port)) = s.accept()

print(f"Connection opened by cid={remote_cid} port={remote_port}")

while True:
buf = conn.recv(64)
if not buf:
break

print(f"Received bytes: {buf}")
```
</details>
```bash
# Using socat
socat VSOCK-LISTEN:<port>,fork EXEC:"echo Hello from server!"
```
### Vsock Client

ç¤ºä¾‹:

* [https://github.com/aws-samples/aws-nitro-enclaves-workshop/blob/main/resources/code/my-first-enclave/secure-local-channel/client.py](https://github.com/aws-samples/aws-nitro-enclaves-workshop/blob/main/resources/code/my-first-enclave/secure-local-channel/client.py)

<details>

<summary>ç®€å•çš„Pythonå®¢æˆ·ç«¯</summary>
```python
#!/usr/bin/env python3

#From https://medium.com/@F.DL/understanding-vsock-684016cf0eb0

import socket

CID = socket.VMADDR_CID_HOST
PORT = 9999

s = socket.socket(socket.AF_VSOCK, socket.SOCK_STREAM)
s.connect((CID, PORT))
s.sendall(b"Hello, world!")
s.close()
```
</details>
```bash
# Using socat
echo "Hello, vsock!" | socat - VSOCK-CONNECT:3:5000
```
### Vsock Proxy

å·¥å…· vsock-proxy å…è®¸å°† vsock ä»£ç†ä¸å¦ä¸€ä¸ªåœ°å€ä»£ç†ï¼Œä¾‹å¦‚ï¼š
```bash
vsock-proxy 8001 ip-ranges.amazonaws.com 443 --config your-vsock-proxy.yaml
```
è¿™å°†æŠŠ**vsockä¸­çš„æœ¬åœ°ç«¯å£8001**è½¬å‘åˆ°`ip-ranges.amazonaws.com:443`ï¼Œæ–‡ä»¶**`your-vsock-proxy.yaml`**å¯èƒ½åŒ…å«ä»¥ä¸‹å†…å®¹ï¼Œå…è®¸è®¿é—®`ip-ranges.amazonaws.com:443`ï¼š
```yaml
allowlist:
- {address: ip-ranges.amazonaws.com, port: 443}
```
å¯ä»¥æŸ¥çœ‹ EC2 ä¸»æœºä½¿ç”¨çš„ vsock åœ°å€ï¼ˆ**`<CID>:<Port>`**ï¼‰ï¼ˆæ³¨æ„ `3:8001`ï¼Œ3 æ˜¯ CIDï¼Œ8001 æ˜¯ç«¯å£ï¼‰ï¼š

{% code overflow="wrap" %}
```bash
sudo ss -l -p -n | grep v_str
v_str LISTEN 0      0                                                                              3:8001                   *:*     users:(("vsock-proxy",pid=9458,fd=3))
```
{% endcode %}

## Nitro Enclave è¯æ˜ä¸ KMS

Nitro Enclaves SDK å…è®¸ enclave ä» Nitro **Hypervisor** è¯·æ±‚ä¸€ä¸ª**åŠ å¯†ç­¾åçš„è¯æ˜æ–‡æ¡£**ï¼Œå…¶ä¸­åŒ…æ‹¬ç‰¹å®šäºè¯¥ enclave çš„**å”¯ä¸€æµ‹é‡å€¼**ã€‚è¿™äº›æµ‹é‡å€¼åŒ…æ‹¬**å“ˆå¸Œå’Œå¹³å°é…ç½®å¯„å­˜å™¨ (PCRs)**ï¼Œåœ¨è¯æ˜è¿‡ç¨‹ä¸­ç”¨äº**è¯æ˜ enclave çš„èº«ä»½**å¹¶**ä¸å¤–éƒ¨æœåŠ¡å»ºç«‹ä¿¡ä»»**ã€‚è¯æ˜æ–‡æ¡£é€šå¸¸åŒ…å«åƒ PCR0ã€PCR1 å’Œ PCR2 è¿™æ ·çš„å€¼ï¼Œè¿™äº›å€¼åœ¨æ„å»ºå’Œä¿å­˜ enclave EIF æ—¶å·²ç»é‡åˆ°è¿‡ã€‚

ä»[**æ–‡æ¡£**](https://catalog.us-east-1.prod.workshops.aws/event/dashboard/en-US/workshop/1-my-first-enclave/1-3-cryptographic-attestation#a-unique-feature-on-nitro-enclaves)ä¸­ï¼Œè¿™äº›æ˜¯ PCR å€¼ï¼š

<table><thead><tr><th width="97">PCR</th><th width="221">å“ˆå¸Œçš„å†…å®¹</th><th>æè¿°</th></tr></thead><tbody><tr><td>PCR0</td><td>Enclave é•œåƒæ–‡ä»¶</td><td>é•œåƒæ–‡ä»¶å†…å®¹çš„è¿ç»­æµ‹é‡ï¼Œä¸åŒ…æ‹¬èŠ‚æ•°æ®ã€‚</td></tr><tr><td>PCR1</td><td>Linux å†…æ ¸å’Œå¼•å¯¼ç¨‹åº</td><td>å†…æ ¸å’Œå¼•å¯¼ ramfs æ•°æ®çš„è¿ç»­æµ‹é‡ã€‚</td></tr><tr><td>PCR2</td><td>åº”ç”¨ç¨‹åº</td><td>ç”¨æˆ·åº”ç”¨ç¨‹åºçš„è¿ç»­ã€æœ‰åºæµ‹é‡ï¼Œä¸åŒ…æ‹¬å¼•å¯¼ ramfsã€‚</td></tr><tr><td>PCR3</td><td>åˆ†é…ç»™çˆ¶å®ä¾‹çš„ IAM è§’è‰²</td><td>åˆ†é…ç»™çˆ¶å®ä¾‹çš„ IAM è§’è‰²çš„è¿ç»­æµ‹é‡ã€‚ç¡®ä¿åªæœ‰å½“çˆ¶å®ä¾‹å…·æœ‰æ­£ç¡®çš„ IAM è§’è‰²æ—¶ï¼Œè¯æ˜è¿‡ç¨‹æ‰ä¼šæˆåŠŸã€‚</td></tr><tr><td>PCR4</td><td>çˆ¶å®ä¾‹çš„å®ä¾‹ ID</td><td>çˆ¶å®ä¾‹ ID çš„è¿ç»­æµ‹é‡ã€‚ç¡®ä¿åªæœ‰å½“çˆ¶å®ä¾‹å…·æœ‰ç‰¹å®šå®ä¾‹ ID æ—¶ï¼Œè¯æ˜è¿‡ç¨‹æ‰ä¼šæˆåŠŸã€‚</td></tr><tr><td>PCR8</td><td>Enclave é•œåƒæ–‡ä»¶ç­¾åè¯ä¹¦</td><td>æŒ‡å®šç»™ enclave é•œåƒæ–‡ä»¶çš„ç­¾åè¯ä¹¦çš„æµ‹é‡ã€‚ç¡®ä¿åªæœ‰å½“ enclave ä»ç”±ç‰¹å®šè¯ä¹¦ç­¾åçš„ enclave é•œåƒæ–‡ä»¶å¯åŠ¨æ—¶ï¼Œè¯æ˜è¿‡ç¨‹æ‰ä¼šæˆåŠŸã€‚</td></tr></tbody></table>

ä½ å¯ä»¥å°†**åŠ å¯†è¯æ˜**é›†æˆåˆ°ä½ çš„åº”ç”¨ç¨‹åºä¸­ï¼Œå¹¶åˆ©ç”¨ä¸**AWS KMS**ç­‰æœåŠ¡çš„é¢„æ„å»ºé›†æˆã€‚AWS KMS å¯ä»¥**éªŒè¯ enclave è¯æ˜**ï¼Œå¹¶åœ¨å…¶å¯†é’¥ç­–ç•¥ä¸­æä¾›åŸºäºè¯æ˜çš„æ¡ä»¶é”® (`kms:RecipientAttestation:ImageSha384` å’Œ `kms:RecipientAttestation:PCR`)ã€‚è¿™äº›ç­–ç•¥ç¡®ä¿ AWS KMS ä»…åœ¨ enclave çš„è¯æ˜æ–‡æ¡£æœ‰æ•ˆå¹¶æ»¡è¶³**æŒ‡å®šæ¡ä»¶**æ—¶å…è®¸ä½¿ç”¨ KMS å¯†é’¥è¿›è¡Œæ“ä½œã€‚

{% hint style="success" %}
è¯·æ³¨æ„ï¼Œè°ƒè¯•æ¨¡å¼ï¼ˆ--debugï¼‰ä¸‹çš„ Enclaves ç”Ÿæˆçš„è¯æ˜æ–‡æ¡£ä¸­çš„ PCR å€¼å…¨ä¸ºé›¶ (`000000000000000000000000000000000000000000000000`)ã€‚å› æ­¤ï¼Œæ£€æŸ¥è¿™äº›å€¼çš„ KMS ç­–ç•¥å°†ä¼šå¤±è´¥ã€‚
{% endhint %}

### PCR ç»•è¿‡

ä»æ”»å‡»è€…çš„è§’åº¦æ¥çœ‹ï¼Œæ³¨æ„åˆ°æŸäº› PCR å…è®¸ä¿®æ”¹éƒ¨åˆ†æˆ–å…¨éƒ¨ enclave é•œåƒå¹¶ä»ç„¶æœ‰æ•ˆï¼ˆä¾‹å¦‚ï¼ŒPCR4 åªæ£€æŸ¥çˆ¶å®ä¾‹çš„ IDï¼Œå› æ­¤åœ¨è¯¥ EC2 ä¸Šè¿è¡Œä»»ä½• enclave é•œåƒéƒ½å¯ä»¥æ»¡è¶³è¿™ä¸ªæ½œåœ¨çš„ PCR è¦æ±‚ï¼‰ã€‚

å› æ­¤ï¼Œæ”»å‡»è€…å¦‚æœæ”»é™·äº† EC2 å®ä¾‹ï¼Œå¯èƒ½èƒ½å¤Ÿè¿è¡Œå…¶ä»– enclave é•œåƒä»¥ç»•è¿‡è¿™äº›ä¿æŠ¤ã€‚

å…³äºå¦‚ä½•ä¿®æ”¹/åˆ›å»ºæ–°é•œåƒä»¥ç»•è¿‡æ¯ä¸ªä¿æŠ¤ï¼ˆç‰¹åˆ«æ˜¯é‚£äº›ä¸å¤ªæ˜æ˜¾çš„ä¿æŠ¤ï¼‰çš„ç ”ç©¶ä»åœ¨è¿›è¡Œä¸­ã€‚

## å‚è€ƒèµ„æ–™

* [https://medium.com/@F.DL/understanding-vsock-684016cf0eb0](https://medium.com/@F.DL/understanding-vsock-684016cf0eb0)
* AWS çš„ Nitro æ•™ç¨‹çš„æ‰€æœ‰éƒ¨åˆ†ï¼š[https://catalog.us-east-1.prod.workshops.aws/event/dashboard/en-US/workshop/1-my-first-enclave/1-1-nitro-enclaves-cli](https://catalog.us-east-1.prod.workshops.aws/event/dashboard/en-US/workshop/1-my-first-enclave/1-1-nitro-enclaves-cli)

{% hint style="success" %}
å­¦ä¹ å’Œå®è·µ AWS Hackingï¼š<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
å­¦ä¹ å’Œå®è·µ GCP Hackingï¼š<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>æ”¯æŒ HackTricks</summary>

* æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**telegram ç¾¤ç»„**](https://t.me/peass) æˆ– **å…³æ³¨** æˆ‘ä»¬çš„ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**ã€‚**
* **é€šè¿‡æäº¤ PRs åˆ°** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **github ä»“åº“æ¥åˆ†äº«é»‘å®¢æŠ€å·§**ã€‚

</details>
{% endhint %}
