# AWS - EC2, EBS, ELB, SSM, VPC & VPN Enum

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## VPC & Networking

VPCê°€ ë¬´ì—‡ì¸ì§€ ë° ê·¸ êµ¬ì„± ìš”ì†Œì— ëŒ€í•´ ì•Œì•„ë³´ì„¸ìš”:

{% content-ref url="aws-vpc-and-networking-basic-information.md" %}
[aws-vpc-and-networking-basic-information.md](aws-vpc-and-networking-basic-information.md)
{% endcontent-ref %}

## EC2

Amazon EC2ëŠ” **ê°€ìƒ ì„œë²„**ë¥¼ ì‹œì‘í•˜ëŠ” ë° ì‚¬ìš©ë©ë‹ˆë‹¤. **ë³´ì•ˆ** ë° **ë„¤íŠ¸ì›Œí‚¹** êµ¬ì„±ê³¼ **ìŠ¤í† ë¦¬ì§€** ê´€ë¦¬ë¥¼ í—ˆìš©í•©ë‹ˆë‹¤. Amazon EC2ì˜ ìœ ì—°ì„±ì€ ìì›ì„ ìœ„ì•„ë˜ë¡œ í™•ì¥í•  ìˆ˜ ìˆëŠ” ëŠ¥ë ¥ì—ì„œ ë¶„ëª…íˆ ë‚˜íƒ€ë‚˜ë©°, ì´ëŠ” ë‹¤ì–‘í•œ ìš”êµ¬ ë³€í™”ë‚˜ ì¸ê¸° ê¸‰ì¦ì— íš¨ê³¼ì ìœ¼ë¡œ ì ì‘í•©ë‹ˆë‹¤. ì´ ê¸°ëŠ¥ì€ ì •í™•í•œ íŠ¸ë˜í”½ ì˜ˆì¸¡ì˜ í•„ìš”ì„±ì„ ì¤„ì…ë‹ˆë‹¤.

EC2ì—ì„œ ì—´ê±°í•  í¥ë¯¸ë¡œìš´ í•­ëª©ë“¤:

* ê°€ìƒ ë¨¸ì‹ 
* SSH í‚¤
* ì‚¬ìš©ì ë°ì´í„°
* ê¸°ì¡´ EC2/AMI/ìŠ¤ëƒ…ìƒ·
* ë„¤íŠ¸ì›Œí‚¹
* ë„¤íŠ¸ì›Œí¬
* ì„œë¸Œë„¤íŠ¸ì›Œí¬
* ê³µì¸ IP
* ì—´ë¦° í¬íŠ¸
* AWS ì™¸ë¶€ì˜ ë‹¤ë¥¸ ë„¤íŠ¸ì›Œí¬ì™€ì˜ í†µí•© ì—°ê²°

### Instance Profiles

**EC2 ì¸ìŠ¤í„´ìŠ¤**ì—ì„œ ì‹¤í–‰ë˜ëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜ì— ê¶Œí•œì„ ë¶€ì—¬í•˜ê¸° ìœ„í•´ **ì—­í• **ì„ ì‚¬ìš©í•˜ëŠ” ê²ƒì€ ì•½ê°„ì˜ ì¶”ê°€ êµ¬ì„±ì´ í•„ìš”í•©ë‹ˆë‹¤. EC2 ì¸ìŠ¤í„´ìŠ¤ì—ì„œ ì‹¤í–‰ë˜ëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜ì€ ê°€ìƒí™”ëœ ìš´ì˜ ì²´ì œì— ì˜í•´ AWSë¡œë¶€í„° ì¶”ìƒí™”ë©ë‹ˆë‹¤. ì´ëŸ¬í•œ ì¶”ê°€ ë¶„ë¦¬ë¡œ ì¸í•´, EC2 ì¸ìŠ¤í„´ìŠ¤ì— AWS ì—­í• ê³¼ ê´€ë ¨ëœ ê¶Œí•œì„ í• ë‹¹í•˜ê³  ì´ë¥¼ ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ í•˜ë ¤ë©´ ì¶”ê°€ ë‹¨ê³„ê°€ í•„ìš”í•©ë‹ˆë‹¤.

ì´ ì¶”ê°€ ë‹¨ê³„ëŠ” ì¸ìŠ¤í„´ìŠ¤ì— ì—°ê²°ëœ [_**ì¸ìŠ¤í„´ìŠ¤ í”„ë¡œí•„**_](https://docs.aws.amazon.com/IAM/latest/UserGuide/id\_roles\_use\_switch-role-ec2\_instance-profiles.html)ì˜ **ìƒì„±**ì…ë‹ˆë‹¤. **ì¸ìŠ¤í„´ìŠ¤ í”„ë¡œí•„ì€ ì—­í• ì„ í¬í•¨í•˜ë©°** ì¸ìŠ¤í„´ìŠ¤ì—ì„œ ì‹¤í–‰ë˜ëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜ì— ì—­í• ì˜ ì„ì‹œ ìê²© ì¦ëª…ì„ ì œê³µí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ëŸ¬í•œ ì„ì‹œ ìê²© ì¦ëª…ì€ ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ API í˜¸ì¶œì—ì„œ ìì›ì— ì ‘ê·¼í•˜ê³  ì—­í• ì´ ì§€ì •í•œ ìì›ì—ë§Œ ì ‘ê·¼ì„ ì œí•œí•˜ëŠ” ë° ì‚¬ìš©ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤. **EC2 ì¸ìŠ¤í„´ìŠ¤ì—ëŠ” í•œ ë²ˆì— í•˜ë‚˜ì˜ ì—­í• ë§Œ í• ë‹¹ë  ìˆ˜ ìˆìœ¼ë©°**, ì¸ìŠ¤í„´ìŠ¤ì˜ ëª¨ë“  ì• í”Œë¦¬ì¼€ì´ì…˜ì€ ë™ì¼í•œ ì—­í• ê³¼ ê¶Œí•œì„ ê³µìœ í•©ë‹ˆë‹¤.

### Metadata Endpoint

AWS EC2 ë©”íƒ€ë°ì´í„°ëŠ” Amazon Elastic Compute Cloud (EC2) ì¸ìŠ¤í„´ìŠ¤ì— ëŒ€í•œ ì •ë³´ë¡œ, ì¸ìŠ¤í„´ìŠ¤ê°€ ì‹¤í–‰ ì¤‘ì¼ ë•Œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ ë©”íƒ€ë°ì´í„°ëŠ” ì¸ìŠ¤í„´ìŠ¤ ID, ì‹¤í–‰ ì¤‘ì¸ ê°€ìš© ì˜ì—­, ì¸ìŠ¤í„´ìŠ¤ì™€ ê´€ë ¨ëœ IAM ì—­í• , ì¸ìŠ¤í„´ìŠ¤ì˜ í˜¸ìŠ¤íŠ¸ ì´ë¦„ê³¼ ê°™ì€ ì¸ìŠ¤í„´ìŠ¤ì— ëŒ€í•œ ì •ë³´ë¥¼ ì œê³µí•˜ëŠ” ë° ì‚¬ìš©ë©ë‹ˆë‹¤.

{% embed url="https://book.hacktricks.xyz/pentesting-web/ssrf-server-side-request-forgery/cloud-ssrf" %}

### Enumeration
```bash
# Get EC2 instances
aws ec2 describe-instances
aws ec2 describe-instance-status #Get status from running instances

# Get user data from each ec2 instance
for instanceid in $(aws ec2 describe-instances --profile <profile> --region us-west-2 | grep -Eo '"i-[a-zA-Z0-9]+' | tr -d '"'); do
echo "Instance ID: $instanceid"
aws ec2 describe-instance-attribute --profile <profile> --region us-west-2 --instance-id "$instanceid" --attribute userData | jq ".UserData.Value" | tr -d '"' | base64 -d
echo ""
echo "-------------------"
done

# Instance profiles
aws iam list-instance-profiles
aws iam list-instance-profiles-for-role --role-name <name>

# Get tags
aws ec2 describe-tags

# Get volumes
aws ec2 describe-volume-status
aws ec2 describe-volumes

# Get snapshots
aws ec2 describe-snapshots --owner-ids self

# Scheduled instances
aws ec2 describe-scheduled-instances

# Get custom images
aws ec2 describe-images --owners self

# Get Elastic IPs
aws ec2 describe-addresses

# Get current output
aws ec2 get-console-output --instance-id [id]

# Get VPN customer gateways
aws ec2 describe-customer-gateways
aws ec2 describe-vpn-gateways
aws ec2 describe-vpn-connections

# List conversion tasks to upload/download VMs
aws ec2 describe-conversion-tasks
aws ec2 describe-import-image-tasks

# Get Bundle Tasks
aws ec2 describe-bundle-tasks

# Get Classic Instances
aws ec2 describe-classic-link-instances

# Get Dedicated Hosts
aws ec2 describe-hosts

# Get SSH Key Pairs
aws ec2 describe-key-pairs

# Get Internet Gateways
aws ec2 describe-internet-gateways

# Get NAT Gateways
aws ec2 describe-nat-gateways

# Get subnetworks
aws ec2 describe-subnets

# Get FW rules
aws ec2 describe-network-acls

# Get security groups
aws ec2 describe-security-groups

# Get interfaces
aws ec2 describe-network-interfaces

# Get routes table
aws ec2 describe-route-tables

# Get VPCs
aws ec2 describe-vpcs
aws ec2 describe-vpc-peering-connections
```
### ì¸ì¦ë˜ì§€ ì•Šì€ ì ‘ê·¼

{% content-ref url="../../aws-unauthenticated-enum-access/aws-ec2-unauthenticated-enum.md" %}
[aws-ec2-unauthenticated-enum.md](../../aws-unauthenticated-enum-access/aws-ec2-unauthenticated-enum.md)
{% endcontent-ref %}

### ê¶Œí•œ ìƒìŠ¹

ë‹¤ìŒ í˜ì´ì§€ì—ì„œ **EC2 ê¶Œí•œì„ ì•…ìš©í•˜ì—¬ ê¶Œí•œì„ ìƒìŠ¹ì‹œí‚¤ëŠ” ë°©ë²•**ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

{% content-ref url="../../aws-privilege-escalation/aws-ec2-privesc.md" %}
[aws-ec2-privesc.md](../../aws-privilege-escalation/aws-ec2-privesc.md)
{% endcontent-ref %}

### ì‚¬í›„ í™œìš©

{% content-ref url="../../aws-post-exploitation/aws-ec2-ebs-ssm-and-vpc-post-exploitation/" %}
[aws-ec2-ebs-ssm-and-vpc-post-exploitation](../../aws-post-exploitation/aws-ec2-ebs-ssm-and-vpc-post-exploitation/)
{% endcontent-ref %}

## EBS

Amazon **EBS** (Elastic Block Store) **ìŠ¤ëƒ…ìƒ·**ì€ ê¸°ë³¸ì ìœ¼ë¡œ AWS EBS ë³¼ë¥¨ì˜ ì •ì  **ë°±ì—…**ì…ë‹ˆë‹¤. ë‹¤ì‹œ ë§í•´, íŠ¹ì • ì‹œì ì— **EC2** ì¸ìŠ¤í„´ìŠ¤ì— ì—°ê²°ëœ **ë””ìŠ¤í¬**ì˜ **ë³µì‚¬ë³¸**ì…ë‹ˆë‹¤. EBS ìŠ¤ëƒ…ìƒ·ì€ ì§€ì—­ ë° ê³„ì • ê°„ì— ë³µì‚¬ë˜ê±°ë‚˜, ë‹¤ìš´ë¡œë“œí•˜ì—¬ ë¡œì»¬ì—ì„œ ì‹¤í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ìŠ¤ëƒ…ìƒ·ì—ëŠ” **ì†ŒìŠ¤ ì½”ë“œë‚˜ API í‚¤**ì™€ ê°™ì€ **ë¯¼ê°í•œ ì •ë³´**ê°€ í¬í•¨ë  ìˆ˜ ìˆìœ¼ë¯€ë¡œ, ê¸°íšŒê°€ ìˆë‹¤ë©´ í™•ì¸í•˜ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤.

### AMIì™€ EBSì˜ ì°¨ì´

**AMI**ëŠ” **EC2 ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì‹œì‘í•˜ëŠ” ë° ì‚¬ìš©**ë˜ë©°, EC2 **ìŠ¤ëƒ…ìƒ·**ì€ **EBS ë³¼ë¥¨ì— ì €ì¥ëœ ë°ì´í„°ë¥¼ ë°±ì—…í•˜ê³  ë³µêµ¬í•˜ëŠ” ë° ì‚¬ìš©**ë©ë‹ˆë‹¤. EC2 ìŠ¤ëƒ…ìƒ·ì€ ìƒˆë¡œìš´ AMIë¥¼ ìƒì„±í•˜ëŠ” ë° ì‚¬ìš©í•  ìˆ˜ ìˆì§€ë§Œ, AMIì™€ ë™ì¼í•˜ì§€ ì•Šìœ¼ë©°, ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ì‹¤í–‰í•˜ëŠ” ë° í•„ìš”í•œ ìš´ì˜ ì²´ì œ, ì• í”Œë¦¬ì¼€ì´ì…˜ ì„œë²„ ë˜ëŠ” ê¸°íƒ€ ì†Œí”„íŠ¸ì›¨ì–´ì— ëŒ€í•œ ì •ë³´ëŠ” í¬í•¨ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.

### ê¶Œí•œ ìƒìŠ¹

ë‹¤ìŒ í˜ì´ì§€ì—ì„œ **EBS ê¶Œí•œì„ ì•…ìš©í•˜ì—¬ ê¶Œí•œì„ ìƒìŠ¹ì‹œí‚¤ëŠ” ë°©ë²•**ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

{% content-ref url="../../aws-privilege-escalation/aws-ebs-privesc.md" %}
[aws-ebs-privesc.md](../../aws-privilege-escalation/aws-ebs-privesc.md)
{% endcontent-ref %}

## SSM

**Amazon Simple Systems Manager (SSM)**ì€ EC2 ì¸ìŠ¤í„´ìŠ¤ì˜ í”Œë¡œíŠ¸ë¥¼ ì›ê²©ìœ¼ë¡œ ê´€ë¦¬í•˜ì—¬ ê´€ë¦¬ ì‘ì—…ì„ í›¨ì”¬ ë” ì‰½ê²Œ ë§Œë“¤ì–´ ì¤ë‹ˆë‹¤. ì´ëŸ¬í•œ ê° ì¸ìŠ¤í„´ìŠ¤ëŠ” **SSM ì—ì´ì „íŠ¸ ì„œë¹„ìŠ¤ê°€ ì‹¤í–‰ ì¤‘ì´ì–´ì•¼ í•˜ë©°, ì´ ì„œë¹„ìŠ¤ê°€ AWS APIì—ì„œ ì‘ì—…ì„ ìˆ˜í–‰í•˜ê³  ì‹¤í–‰í•˜ëŠ” ì—­í• ì„ í•©ë‹ˆë‹¤.**

**SSM ì—ì´ì „íŠ¸**ëŠ” ì‹œìŠ¤í…œ ê´€ë¦¬ìê°€ ì´ëŸ¬í•œ ë¦¬ì†ŒìŠ¤ë¥¼ ì—…ë°ì´íŠ¸, ê´€ë¦¬ ë° êµ¬ì„±í•  ìˆ˜ ìˆë„ë¡ í•©ë‹ˆë‹¤. ì—ì´ì „íŠ¸ëŠ” **AWS í´ë¼ìš°ë“œì˜ ì‹œìŠ¤í…œ ê´€ë¦¬ì ì„œë¹„ìŠ¤ë¡œë¶€í„° ìš”ì²­ì„ ì²˜ë¦¬**í•˜ê³ , ìš”ì²­ì— ì§€ì •ëœ ëŒ€ë¡œ ì‹¤í–‰í•©ë‹ˆë‹¤.

**SSM ì—ì´ì „íŠ¸ëŠ”**[ **ì¼ë¶€ AMIì— ì‚¬ì „ ì„¤ì¹˜ë˜ì–´ ìˆìŠµë‹ˆë‹¤**](https://docs.aws.amazon.com/systems-manager/latest/userguide/ami-preinstalled-agent.html) ë˜ëŠ” ì¸ìŠ¤í„´ìŠ¤ì— [**ìˆ˜ë™ìœ¼ë¡œ ì„¤ì¹˜í•´ì•¼ í•©ë‹ˆë‹¤**](https://docs.aws.amazon.com/systems-manager/latest/userguide/sysman-manual-agent-install.html). ë˜í•œ, ì¸ìŠ¤í„´ìŠ¤ ë‚´ì—ì„œ ì‚¬ìš©ë˜ëŠ” IAM ì—­í• ì€ í†µì‹ í•  ìˆ˜ ìˆë„ë¡ **AmazonEC2RoleforSSM** ì •ì±…ì´ ì—°ê²°ë˜ì–´ ìˆì–´ì•¼ í•©ë‹ˆë‹¤.

### ì—´ê±°
```bash
aws ssm describe-instance-information
aws ssm describe-parameters
aws ssm describe-sessions --state [Active|History]
aws ssm describe-instance-patches --instance-id <id>
aws ssm describe-instance-patch-states --instance-ids <id>
aws ssm describe-instance-associations-status --instance-id <id>
```
EC2 ì¸ìŠ¤í„´ìŠ¤ì—ì„œ Systems Managerê°€ ì‹¤í–‰ ì¤‘ì¸ì§€ í™•ì¸í•˜ë ¤ë©´ ë‹¤ìŒì„ ì‹¤í–‰í•˜ë©´ ë©ë‹ˆë‹¤:
```bash
ps aux | grep amazon-ssm
```
### Privesc

ë‹¤ìŒ í˜ì´ì§€ì—ì„œ **SSM ê¶Œí•œì„ ì•…ìš©í•˜ì—¬ ê¶Œí•œ ìƒìŠ¹**í•˜ëŠ” ë°©ë²•ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

{% content-ref url="../../aws-privilege-escalation/aws-ssm-privesc.md" %}
[aws-ssm-privesc.md](../../aws-privilege-escalation/aws-ssm-privesc.md)
{% endcontent-ref %}

## ELB

**Elastic Load Balancing** (ELB)ëŠ” **Amazon Web Services** (AWS) ë°°í¬ë¥¼ ìœ„í•œ **ë¡œë“œ ë°¸ëŸ°ì‹± ì„œë¹„ìŠ¤**ì…ë‹ˆë‹¤. ELBëŠ” ìë™ìœ¼ë¡œ **ë“¤ì–´ì˜¤ëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜ íŠ¸ë˜í”½ì„ ë¶„ì‚°**í•˜ê³  íŠ¸ë˜í”½ ìˆ˜ìš”ë¥¼ ì¶©ì¡±í•˜ê¸° ìœ„í•´ ë¦¬ì†ŒìŠ¤ë¥¼ í™•ì¥í•©ë‹ˆë‹¤.

### Enumeration
```bash
# List internet-facing ELBs
aws elb describe-load-balancers
aws elb describe-load-balancers | jq '.LoadBalancerDescriptions[]| select( .Scheme | contains("internet-facing"))|.DNSName'

# DONT FORGET TO CHECK VERSION 2
aws elbv2 describe-load-balancers
aws elbv2 describe-load-balancers | jq '.LoadBalancers[].DNSName'
aws elbv2 describe-listeners --load-balancer-arn <load_balancer_arn>
```
## ëŸ°ì¹˜ í…œí”Œë¦¿ ë° ì˜¤í† ìŠ¤ì¼€ì¼ë§ ê·¸ë£¹

### ì—´ê±°

{% code overflow="wrap" %}
```bash
# Launch templates
aws ec2 describe-launch-templates
aws ec2 describe-launch-templates --launch-template-id <launch_template_id>
## Get details, like user data
aws ec2 describe-launch-template-versions --launch-template-id <launch_template_id>

# Autoscaling
aws autoscaling describe-auto-scaling-groups
aws autoscaling describe-auto-scaling-instances
aws autoscaling describe-launch-configurations
aws autoscaling describe-load-balancer-target-groups
aws autoscaling describe-load-balancers
```
{% endcode %}

## Nitro

AWS NitroëŠ” AWS EC2 ì¸ìŠ¤í„´ìŠ¤ì˜ ê¸°ë³¸ í”Œë«í¼ì„ í˜•ì„±í•˜ëŠ” **í˜ì‹ ì ì¸ ê¸°ìˆ ** ëª¨ìŒì…ë‹ˆë‹¤. Amazonì— ì˜í•´ **ë³´ì•ˆ, ì„±ëŠ¥ ë° ì‹ ë¢°ì„±**ì„ í–¥ìƒì‹œí‚¤ê¸° ìœ„í•´ ë„ì…ëœ NitroëŠ” ë§ì¶¤í˜• **í•˜ë“œì›¨ì–´ êµ¬ì„± ìš”ì†Œì™€ ê²½ëŸ‰ í•˜ì´í¼ë°”ì´ì €**ë¥¼ í™œìš©í•©ë‹ˆë‹¤. ì „í†µì ì¸ ê°€ìƒí™” ê¸°ëŠ¥ì˜ ë§ì€ ë¶€ë¶„ì„ ì „ìš© í•˜ë“œì›¨ì–´ì™€ ì†Œí”„íŠ¸ì›¨ì–´ë¡œ ì¶”ìƒí™”í•˜ì—¬ **ê³µê²© í‘œë©´ì„ ìµœì†Œí™”**í•˜ê³  ìì› íš¨ìœ¨ì„±ì„ ê°œì„ í•©ë‹ˆë‹¤. ê°€ìƒí™” ê¸°ëŠ¥ì„ ì˜¤í”„ë¡œë“œí•¨ìœ¼ë¡œì¨ NitroëŠ” EC2 ì¸ìŠ¤í„´ìŠ¤ê°€ **ê±°ì˜ ë² ì–´ ë©”íƒˆ ì„±ëŠ¥**ì„ ì œê³µí•  ìˆ˜ ìˆê²Œ í•˜ì—¬, ìì› ì§‘ì•½ì ì¸ ì• í”Œë¦¬ì¼€ì´ì…˜ì— íŠ¹íˆ ìœ ë¦¬í•©ë‹ˆë‹¤. ë˜í•œ, Nitro ë³´ì•ˆ ì¹©ì€ **í•˜ë“œì›¨ì–´ì™€ íŒì›¨ì–´ì˜ ë³´ì•ˆ**ì„ ë³´ì¥í•˜ì—¬ ê·¸ ê°•ë ¥í•œ ì•„í‚¤í…ì²˜ë¥¼ ë”ìš± ê°•í™”í•©ë‹ˆë‹¤.

ìì„¸í•œ ì •ë³´ì™€ ì´ë¥¼ ì—´ê±°í•˜ëŠ” ë°©ë²•ì€ ë‹¤ìŒì—ì„œ í™•ì¸í•˜ì„¸ìš”:

{% content-ref url="aws-nitro-enum.md" %}
[aws-nitro-enum.md](aws-nitro-enum.md)
{% endcontent-ref %}

## VPN

VPNì€ **ì˜¨í”„ë ˆë¯¸ìŠ¤ ë„¤íŠ¸ì›Œí¬(ì‚¬ì´íŠ¸ ê°„ VPN)** ë˜ëŠ” **ì‘ì—…ì ë…¸íŠ¸ë¶(í´ë¼ì´ì–¸íŠ¸ VPN)**ì„ **AWS VPC**ì™€ ì—°ê²°í•˜ì—¬ ì„œë¹„ìŠ¤ë¥¼ ì¸í„°ë„·ì— ë…¸ì¶œí•˜ì§€ ì•Šê³ ë„ ì ‘ê·¼í•  ìˆ˜ ìˆê²Œ í•©ë‹ˆë‹¤.

#### ê¸°ë³¸ AWS VPN êµ¬ì„± ìš”ì†Œ

1. **ê³ ê° ê²Œì´íŠ¸ì›¨ì´**:
* ê³ ê° ê²Œì´íŠ¸ì›¨ì´ëŠ” VPN ì—°ê²°ì˜ ê·€í•˜ ì¸¡ì„ ë‚˜íƒ€ë‚´ê¸° ìœ„í•´ AWSì—ì„œ ìƒì„±í•˜ëŠ” ë¦¬ì†ŒìŠ¤ì…ë‹ˆë‹¤.
* ë³¸ì§ˆì ìœ¼ë¡œ ì‚¬ì´íŠ¸ ê°„ VPN ì—°ê²°ì˜ ê·€í•˜ ì¸¡ì— ìˆëŠ” ë¬¼ë¦¬ì  ì¥ì¹˜ ë˜ëŠ” ì†Œí”„íŠ¸ì›¨ì–´ ì• í”Œë¦¬ì¼€ì´ì…˜ì…ë‹ˆë‹¤.
* ê³ ê° ê²Œì´íŠ¸ì›¨ì´ë¥¼ ìƒì„±í•˜ê¸° ìœ„í•´ ë¼ìš°íŒ… ì •ë³´ì™€ ë„¤íŠ¸ì›Œí¬ ì¥ì¹˜(ì˜ˆ: ë¼ìš°í„° ë˜ëŠ” ë°©í™”ë²½)ì˜ ê³µìš© IP ì£¼ì†Œë¥¼ AWSì— ì œê³µí•©ë‹ˆë‹¤.
* VPN ì—°ê²° ì„¤ì •ì„ ìœ„í•œ ì°¸ì¡° ì§€ì  ì—­í• ì„ í•˜ë©° ì¶”ê°€ ìš”ê¸ˆì´ ë°œìƒí•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
2. **ê°€ìƒ ì‚¬ì„¤ ê²Œì´íŠ¸ì›¨ì´**:
* ê°€ìƒ ì‚¬ì„¤ ê²Œì´íŠ¸ì›¨ì´(VPG)ëŠ” ì‚¬ì´íŠ¸ ê°„ VPN ì—°ê²°ì˜ Amazon ì¸¡ VPN ì§‘ì¤‘ê¸°ì…ë‹ˆë‹¤.
* ê·€í•˜ì˜ VPCì— ì—°ê²°ë˜ì–´ ìˆìœ¼ë©° VPN ì—°ê²°ì˜ ëŒ€ìƒ ì—­í• ì„ í•©ë‹ˆë‹¤.
* VPGëŠ” VPN ì—°ê²°ì˜ AWS ì¸¡ ì—”ë“œí¬ì¸íŠ¸ì…ë‹ˆë‹¤.
* ê·€í•˜ì˜ VPCì™€ ì˜¨í”„ë ˆë¯¸ìŠ¤ ë„¤íŠ¸ì›Œí¬ ê°„ì˜ ì•ˆì „í•œ í†µì‹ ì„ ì²˜ë¦¬í•©ë‹ˆë‹¤.
3. **ì‚¬ì´íŠ¸ ê°„ VPN ì—°ê²°**:
* ì‚¬ì´íŠ¸ ê°„ VPN ì—°ê²°ì€ ê·€í•˜ì˜ ì˜¨í”„ë ˆë¯¸ìŠ¤ ë„¤íŠ¸ì›Œí¬ë¥¼ ì•ˆì „í•œ IPsec VPN í„°ë„ì„ í†µí•´ VPCì— ì—°ê²°í•©ë‹ˆë‹¤.
* ì´ ìœ í˜•ì˜ ì—°ê²°ì€ ê³ ê° ê²Œì´íŠ¸ì›¨ì´ì™€ ê°€ìƒ ì‚¬ì„¤ ê²Œì´íŠ¸ì›¨ì´ê°€ í•„ìš”í•©ë‹ˆë‹¤.
* ë°ì´í„° ì„¼í„° ë˜ëŠ” ë„¤íŠ¸ì›Œí¬ì™€ AWS í™˜ê²½ ê°„ì˜ ì•ˆì „í•˜ê³  ì•ˆì •ì ì´ë©° ì¼ê´€ëœ í†µì‹ ì„ ìœ„í•´ ì‚¬ìš©ë©ë‹ˆë‹¤.
* ì¼ë°˜ì ìœ¼ë¡œ ì •ê¸°ì ì´ê³  ì¥ê¸°ì ì¸ ì—°ê²°ì— ì‚¬ìš©ë˜ë©° ì—°ê²°ì„ í†µí•´ ì „ì†¡ëœ ë°ì´í„° ì–‘ì— ë”°ë¼ ìš”ê¸ˆì´ ì²­êµ¬ë©ë‹ˆë‹¤.
4. **í´ë¼ì´ì–¸íŠ¸ VPN ì—”ë“œí¬ì¸íŠ¸**:
* í´ë¼ì´ì–¸íŠ¸ VPN ì—”ë“œí¬ì¸íŠ¸ëŠ” í´ë¼ì´ì–¸íŠ¸ VPN ì„¸ì…˜ì„ í™œì„±í™”í•˜ê³  ê´€ë¦¬í•˜ê¸° ìœ„í•´ AWSì—ì„œ ìƒì„±í•˜ëŠ” ë¦¬ì†ŒìŠ¤ì…ë‹ˆë‹¤.
* ê°œë³„ ì¥ì¹˜(ë…¸íŠ¸ë¶, ìŠ¤ë§ˆíŠ¸í° ë“±)ê°€ AWS ë¦¬ì†ŒìŠ¤ ë˜ëŠ” ì˜¨í”„ë ˆë¯¸ìŠ¤ ë„¤íŠ¸ì›Œí¬ì— ì•ˆì „í•˜ê²Œ ì—°ê²°í•  ìˆ˜ ìˆë„ë¡ ì‚¬ìš©ë©ë‹ˆë‹¤.
* ì „ì²´ ë„¤íŠ¸ì›Œí¬ë¥¼ ì—°ê²°í•˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼ ê°œë³„ í´ë¼ì´ì–¸íŠ¸ë¥¼ ìœ„í•´ ì„¤ê³„ë˜ì—ˆë‹¤ëŠ” ì ì—ì„œ ì‚¬ì´íŠ¸ ê°„ VPNê³¼ ë‹¤ë¦…ë‹ˆë‹¤.
* í´ë¼ì´ì–¸íŠ¸ VPNì„ ì‚¬ìš©í•˜ë©´ ê° í´ë¼ì´ì–¸íŠ¸ ì¥ì¹˜ê°€ VPN í´ë¼ì´ì–¸íŠ¸ ì†Œí”„íŠ¸ì›¨ì–´ë¥¼ ì‚¬ìš©í•˜ì—¬ ì•ˆì „í•œ ì—°ê²°ì„ ì„¤ì •í•©ë‹ˆë‹¤.

[**AWS VPNì˜ ì´ì ê³¼ êµ¬ì„± ìš”ì†Œì— ëŒ€í•œ ìì„¸í•œ ì •ë³´ëŠ” ì—¬ê¸°ì—ì„œ í™•ì¸í•˜ì„¸ìš”**](aws-vpc-and-networking-basic-information.md#vpn).

### Enumeration
```bash
# VPN endpoints
## Check used subnetwork, authentication, SGs, connected...
aws ec2 describe-client-vpn-endpoints

## Get AWS network info related to the vpn endpoint
aws ec2 describe-client-vpn-target-networks --client-vpn-endpoint-id <id>

## Get AWS subnet & ip range the VPN iconnected to
aws ec2 describe-client-vpn-routes --client-vpn-endpoint-id <id>

## Check authorization rules
aws ec2 describe-client-vpn-authorization-rules --client-vpn-endpoint-id <id>

## Get current connections to the VPN endpoint
aws ec2 describe-client-vpn-connections --client-vpn-endpoint-id <id>

# Get VPN gateways and check with which VPC each is connected
aws ec2 describe-vpn-gateways

# Get VPN site-to-site connections
aws ec2 describe-vpn-connections
```
### Local Enumeration

**Local Temporary Credentials**

AWS VPN Clientë¥¼ ì‚¬ìš©í•˜ì—¬ VPNì— ì—°ê²°í•  ë•Œ, ì‚¬ìš©ìëŠ” ì¼ë°˜ì ìœ¼ë¡œ **AWSì— ë¡œê·¸ì¸**í•˜ì—¬ VPNì— ì ‘ê·¼í•©ë‹ˆë‹¤. ê·¸ëŸ° ë‹¤ìŒ, VPN ì—°ê²°ì„ ì„¤ì •í•˜ê¸° ìœ„í•´ ì¼ë¶€ **AWS ìê²© ì¦ëª…ì´ ìƒì„±ë˜ì–´ ë¡œì»¬ì— ì €ì¥ë©ë‹ˆë‹¤**. ì´ëŸ¬í•œ ìê²© ì¦ëª…ì€ **`$HOME/.config/AWSVPNClient/TemporaryCredentials/<region>/temporary-credentials.txt`**ì— ì €ì¥ë˜ë©°, **AccessKey**, **SecretKey** ë° **Token**ì„ í¬í•¨í•©ë‹ˆë‹¤.

ìê²© ì¦ëª…ì€ ì‚¬ìš©ì `arn:aws:sts::<acc-id>:assumed-role/aws-vpn-client-metrics-analytics-access-role/CognitoIdentityCredentials`ì— ì†í•©ë‹ˆë‹¤ (TODO: ì´ ìê²© ì¦ëª…ì˜ ê¶Œí•œì— ëŒ€í•´ ë” ì¡°ì‚¬í•˜ê¸°).

**opvn config files**

**VPN ì—°ê²°ì´ ì„¤ì •ë˜ì—ˆë‹¤ë©´**, ì‹œìŠ¤í…œì—ì„œ **`.opvn`** êµ¬ì„± íŒŒì¼ì„ ê²€ìƒ‰í•´ì•¼ í•©ë‹ˆë‹¤. ë˜í•œ, **êµ¬ì„±**ì„ ì°¾ì„ ìˆ˜ ìˆëŠ” í•œ ê³³ì€ **`$HOME/.config/AWSVPNClient/OpenVpnConfigs`**ì…ë‹ˆë‹¤.

#### **Post Exploitaiton**

{% content-ref url="../../aws-post-exploitation/aws-vpn-post-exploitation.md" %}
[aws-vpn-post-exploitation.md](../../aws-post-exploitation/aws-vpn-post-exploitation.md)
{% endcontent-ref %}

## References

* [https://docs.aws.amazon.com/batch/latest/userguide/getting-started-ec2.html](https://docs.aws.amazon.com/batch/latest/userguide/getting-started-ec2.html)

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
