# AWS - EC2, EBS, ELB, SSM, VPC & VPN Enum

{% hint style="success" %}
ÎœÎ¬Î¸ÎµÏ„Îµ ÎºÎ±Î¹ ÎµÎ¾Î±ÏƒÎºÎ·Î¸ÎµÎ¯Ï„Îµ ÏƒÏ„Î¿ AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
ÎœÎ¬Î¸ÎµÏ„Îµ ÎºÎ±Î¹ ÎµÎ¾Î±ÏƒÎºÎ·Î¸ÎµÎ¯Ï„Îµ ÏƒÏ„Î¿ GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Î¥Ï€Î¿ÏƒÏ„Î·ÏÎ¯Î¾Ï„Îµ Ï„Î¿ HackTricks</summary>

* Î•Î»Î­Î³Î¾Ï„Îµ Ï„Î± [**ÏƒÏ‡Î­Î´Î¹Î± ÏƒÏ…Î½Î´ÏÎ¿Î¼Î®Ï‚**](https://github.com/sponsors/carlospolop)!
* **Î“Î¯Î½ÎµÏ„Îµ Î¼Î­Î»Î¿Ï‚ Ï„Î·Ï‚** ğŸ’¬ [**Î¿Î¼Î¬Î´Î±Ï‚ Discord**](https://discord.gg/hRep4RUj7f) Î® Ï„Î·Ï‚ [**Î¿Î¼Î¬Î´Î±Ï‚ telegram**](https://t.me/peass) Î® **Î±ÎºÎ¿Î»Î¿Ï…Î¸Î®ÏƒÏ„Îµ** Î¼Î±Ï‚ ÏƒÏ„Î¿ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **ÎœÎ¿Î¹ÏÎ±ÏƒÏ„ÎµÎ¯Ï„Îµ hacking tricks Ï…Ï€Î¿Î²Î¬Î»Î»Î¿Î½Ï„Î±Ï‚ PRs ÏƒÏ„Î±** [**HackTricks**](https://github.com/carlospolop/hacktricks) ÎºÎ±Î¹ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) Î±Ï€Î¿Î¸ÎµÏ„Î®ÏÎ¹Î± ÏƒÏ„Î¿ github.

</details>
{% endhint %}

## VPC & Î”Î¹ÎºÏ„ÏÏ‰ÏƒÎ·

ÎœÎ¬Î¸ÎµÏ„Îµ Ï„Î¹ ÎµÎ¯Î½Î±Î¹ Î­Î½Î± VPC ÎºÎ±Î¹ Î³Î¹Î± Ï„Î± ÏƒÏ…ÏƒÏ„Î±Ï„Î¹ÎºÎ¬ Ï„Î¿Ï… ÏƒÏ„Î¿:

{% content-ref url="aws-vpc-and-networking-basic-information.md" %}
[aws-vpc-and-networking-basic-information.md](aws-vpc-and-networking-basic-information.md)
{% endcontent-ref %}

## EC2

Î¤Î¿ Amazon EC2 Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÎµÎ¯Ï„Î±Î¹ Î³Î¹Î± Ï„Î·Î½ ÎµÎºÎºÎ¯Î½Î·ÏƒÎ· **ÎµÎ¹ÎºÎ¿Î½Î¹ÎºÏÎ½ Î´Î¹Î±ÎºÎ¿Î¼Î¹ÏƒÏ„ÏÎ½**. Î•Ï€Î¹Ï„ÏÎ­Ï€ÎµÎ¹ Ï„Î· Î´Î¹Î±Î¼ÏŒÏÏ†Ï‰ÏƒÎ· Ï„Î·Ï‚ **Î±ÏƒÏ†Î¬Î»ÎµÎ¹Î±Ï‚** ÎºÎ±Î¹ Ï„Î·Ï‚ **Î´Î¹ÎºÏ„ÏÏ‰ÏƒÎ·Ï‚** ÎºÎ±Î¹ Ï„Î· Î´Î¹Î±Ï‡ÎµÎ¯ÏÎ¹ÏƒÎ· Ï„Î·Ï‚ **Î±Ï€Î¿Î¸Î®ÎºÎµÏ…ÏƒÎ·Ï‚**. Î— ÎµÏ…ÎµÎ»Î¹Î¾Î¯Î± Ï„Î¿Ï… Amazon EC2 ÎµÎ¯Î½Î±Î¹ ÎµÎ¼Ï†Î±Î½Î®Ï‚ ÏƒÏ„Î·Î½ Î¹ÎºÎ±Î½ÏŒÏ„Î·Ï„Î¬ Ï„Î¿Ï… Î½Î± ÎºÎ»Î¹Î¼Î±ÎºÏÎ½ÎµÎ¹ Ï€ÏŒÏÎ¿Ï…Ï‚ Ï„ÏŒÏƒÎ¿ Ï€ÏÎ¿Ï‚ Ï„Î± Ï€Î¬Î½Ï‰ ÏŒÏƒÎ¿ ÎºÎ±Î¹ Ï€ÏÎ¿Ï‚ Ï„Î± ÎºÎ¬Ï„Ï‰, Ï€ÏÎ¿ÏƒÎ±ÏÎ¼Î¿Î¶ÏŒÎ¼ÎµÎ½Î· Î±Ï€Î¿Ï„ÎµÎ»ÎµÏƒÎ¼Î±Ï„Î¹ÎºÎ¬ ÏƒÎµ Î¼ÎµÏ„Î±Î²Î±Î»Î»ÏŒÎ¼ÎµÎ½ÎµÏ‚ Î±Ï€Î±Î¹Ï„Î®ÏƒÎµÎ¹Ï‚ Î® Î±Ï…Î¾Î®ÏƒÎµÎ¹Ï‚ Î´Î·Î¼Î¿Ï„Î¹ÎºÏŒÏ„Î·Ï„Î±Ï‚. Î‘Ï…Ï„ÏŒ Ï„Î¿ Ï‡Î±ÏÎ±ÎºÏ„Î·ÏÎ¹ÏƒÏ„Î¹ÎºÏŒ Î¼ÎµÎ¹ÏÎ½ÎµÎ¹ Ï„Î·Î½ Î±Î½Î¬Î³ÎºÎ· Î³Î¹Î± Î±ÎºÏÎ¹Î²ÎµÎ¯Ï‚ Ï€ÏÎ¿Î²Î»Î­ÏˆÎµÎ¹Ï‚ ÎºÎ¯Î½Î·ÏƒÎ·Ï‚.

Î•Î½Î´Î¹Î±Ï†Î­ÏÎ¿Î½Ï„Î± Ï€ÏÎ¬Î³Î¼Î±Ï„Î± Î³Î¹Î± Î±Ï€Î±ÏÎ¯Î¸Î¼Î·ÏƒÎ· ÏƒÏ„Î¿ EC2:

* Î•Î¹ÎºÎ¿Î½Î¹ÎºÎ­Ï‚ ÎœÎ·Ï‡Î±Î½Î­Ï‚
* SSH Keys
* User Data
* Î¥Ï€Î¬ÏÏ‡Î¿Î½Ï„Î± EC2s/AMIs/Snapshots
* Î”Î¹ÎºÏ„ÏÏ‰ÏƒÎ·
* Î”Î¯ÎºÏ„Ï…Î±
* Î¥Ï€Î¿Î´Î¯ÎºÏ„Ï…Î±
* Î”Î·Î¼ÏŒÏƒÎ¹ÎµÏ‚ IPs
* Î‘Î½Î¿Î¹Ï‡Ï„Î­Ï‚ Î¸ÏÏÎµÏ‚
* Î•Î½ÏƒÏ‰Î¼Î±Ï„Ï‰Î¼Î­Î½ÎµÏ‚ ÏƒÏ…Î½Î´Î­ÏƒÎµÎ¹Ï‚ Î¼Îµ Î¬Î»Î»Î± Î´Î¯ÎºÏ„Ï…Î± ÎµÎºÏ„ÏŒÏ‚ AWS

### Instance Profiles

Î— Ï‡ÏÎ®ÏƒÎ· **ÏÏŒÎ»Ï‰Î½** Î³Î¹Î± Ï„Î·Î½ Ï€Î±ÏÎ¿Ï‡Î® Î´Î¹ÎºÎ±Î¹Ï‰Î¼Î¬Ï„Ï‰Î½ ÏƒÎµ ÎµÏ†Î±ÏÎ¼Î¿Î³Î­Ï‚ Ï€Î¿Ï… ÎµÎºÏ„ÎµÎ»Î¿ÏÎ½Ï„Î±Î¹ ÏƒÎµ **EC2 instances** Î±Ï€Î±Î¹Ï„ÎµÎ¯ Î»Î¯Î³Î· ÎµÏ€Î¹Ï€Î»Î­Î¿Î½ Î´Î¹Î±Î¼ÏŒÏÏ†Ï‰ÏƒÎ·. ÎœÎ¹Î± ÎµÏ†Î±ÏÎ¼Î¿Î³Î® Ï€Î¿Ï… ÎµÎºÏ„ÎµÎ»ÎµÎ¯Ï„Î±Î¹ ÏƒÎµ Î­Î½Î± EC2 instance ÎµÎ¯Î½Î±Î¹ Î±Ï€Î¿Î¼Î¿Î½Ï‰Î¼Î­Î½Î· Î±Ï€ÏŒ Ï„Î¿ AWS Î±Ï€ÏŒ Ï„Î¿ ÎµÎ¹ÎºÎ¿Î½Î¹ÎºÎ¿Ï€Î¿Î¹Î·Î¼Î­Î½Î¿ Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¹ÎºÏŒ ÏƒÏÏƒÏ„Î·Î¼Î±. Î›ÏŒÎ³Ï‰ Î±Ï…Ï„Î®Ï‚ Ï„Î·Ï‚ ÎµÏ€Î¹Ï€Î»Î­Î¿Î½ Î±Ï€Î¿Î¼ÏŒÎ½Ï‰ÏƒÎ·Ï‚, Ï‡ÏÎµÎ¹Î¬Î¶ÎµÏƒÏ„Îµ Î­Î½Î± ÎµÏ€Î¹Ï€Î»Î­Î¿Î½ Î²Î®Î¼Î± Î³Î¹Î± Î½Î± Î±Î½Î±Î¸Î­ÏƒÎµÏ„Îµ Î­Î½Î±Î½ AWS ÏÏŒÎ»Î¿ ÎºÎ±Î¹ Ï„Î± ÏƒÏ…Î½Î´ÎµÎ´ÎµÎ¼Î­Î½Î± Î´Î¹ÎºÎ±Î¹ÏÎ¼Î±Ï„Î¬ Ï„Î¿Ï… ÏƒÎµ Î­Î½Î± EC2 instance ÎºÎ±Î¹ Î½Î± Ï„Î± ÎºÎ¬Î½ÎµÏ„Îµ Î´Î¹Î±Î¸Î­ÏƒÎ¹Î¼Î± ÏƒÏ„Î¹Ï‚ ÎµÏ†Î±ÏÎ¼Î¿Î³Î­Ï‚ Ï„Î¿Ï….

Î‘Ï…Ï„ÏŒ Ï„Î¿ ÎµÏ€Î¹Ï€Î»Î­Î¿Î½ Î²Î®Î¼Î± ÎµÎ¯Î½Î±Î¹ Î· **Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± ÎµÎ½ÏŒÏ‚** [_**instance profile**_](https://docs.aws.amazon.com/IAM/latest/UserGuide/id\_roles\_use\_switch-role-ec2\_instance-profiles.html) Ï€Î¿Ï… ÏƒÏ…Î½Î´Î­ÎµÏ„Î±Î¹ Î¼Îµ Ï„Î¿ instance. Î¤Î¿ **instance profile Ï€ÎµÏÎ¹Î­Ï‡ÎµÎ¹ Ï„Î¿Î½ ÏÏŒÎ»Î¿ ÎºÎ±Î¹** Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Ï€Î±ÏÎ­Ï‡ÎµÎ¹ Ï„Î± Ï€ÏÎ¿ÏƒÏ‰ÏÎ¹Î½Î¬ Î´Î¹Î±Ï€Î¹ÏƒÏ„ÎµÏ…Ï„Î®ÏÎ¹Î± Ï„Î¿Ï… ÏÏŒÎ»Î¿Ï… ÏƒÎµ Î¼Î¹Î± ÎµÏ†Î±ÏÎ¼Î¿Î³Î® Ï€Î¿Ï… ÎµÎºÏ„ÎµÎ»ÎµÎ¯Ï„Î±Î¹ ÏƒÏ„Î¿ instance. Î‘Ï…Ï„Î¬ Ï„Î± Ï€ÏÎ¿ÏƒÏ‰ÏÎ¹Î½Î¬ Î´Î¹Î±Ï€Î¹ÏƒÏ„ÎµÏ…Ï„Î®ÏÎ¹Î± Î¼Ï€Î¿ÏÎ¿ÏÎ½ ÏƒÏ„Î· ÏƒÏ…Î½Î­Ï‡ÎµÎ¹Î± Î½Î± Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î·Î¸Î¿ÏÎ½ ÏƒÏ„Î¹Ï‚ ÎºÎ»Î®ÏƒÎµÎ¹Ï‚ API Ï„Î·Ï‚ ÎµÏ†Î±ÏÎ¼Î¿Î³Î®Ï‚ Î³Î¹Î± Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ· ÏƒÎµ Ï€ÏŒÏÎ¿Ï…Ï‚ ÎºÎ±Î¹ Î³Î¹Î± Ï€ÎµÏÎ¹Î¿ÏÎ¹ÏƒÎ¼ÏŒ Ï„Î·Ï‚ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ·Ï‚ Î¼ÏŒÎ½Î¿ ÏƒÎµ Î±Ï…Ï„Î¿ÏÏ‚ Ï„Î¿Ï…Ï‚ Ï€ÏŒÏÎ¿Ï…Ï‚ Ï€Î¿Ï… ÎºÎ±Î¸Î¿ÏÎ¯Î¶ÎµÎ¹ Î¿ ÏÏŒÎ»Î¿Ï‚. Î£Î·Î¼ÎµÎ¹ÏÏƒÏ„Îµ ÏŒÏ„Î¹ **Î¼ÏŒÎ½Î¿ Î­Î½Î±Ï‚ ÏÏŒÎ»Î¿Ï‚ Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Î±Î½Î±Ï„ÎµÎ¸ÎµÎ¯ ÏƒÎµ Î­Î½Î± EC2 instance** ÎºÎ¬Î¸Îµ Ï†Î¿ÏÎ¬, ÎºÎ±Î¹ ÏŒÎ»ÎµÏ‚ Î¿Î¹ ÎµÏ†Î±ÏÎ¼Î¿Î³Î­Ï‚ ÏƒÏ„Î¿ instance Î¼Î¿Î¹ÏÎ¬Î¶Î¿Î½Ï„Î±Î¹ Ï„Î¿Î½ Î¯Î´Î¹Î¿ ÏÏŒÎ»Î¿ ÎºÎ±Î¹ Î´Î¹ÎºÎ±Î¹ÏÎ¼Î±Ï„Î±.

### Metadata Endpoint

Î¤Î¿ AWS EC2 metadata ÎµÎ¯Î½Î±Î¹ Ï€Î»Î·ÏÎ¿Ï†Î¿ÏÎ¯ÎµÏ‚ Î³Î¹Î± Î­Î½Î± Amazon Elastic Compute Cloud (EC2) instance Ï€Î¿Ï… ÎµÎ¯Î½Î±Î¹ Î´Î¹Î±Î¸Î­ÏƒÎ¹Î¼ÎµÏ‚ ÏƒÏ„Î¿ instance ÎºÎ±Ï„Î¬ Ï„Î·Î½ ÎµÎºÏ„Î­Î»ÎµÏƒÎ·. Î‘Ï…Ï„Î¬ Ï„Î± metadata Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î¿ÏÎ½Ï„Î±Î¹ Î³Î¹Î± Ï„Î·Î½ Ï€Î±ÏÎ¿Ï‡Î® Ï€Î»Î·ÏÎ¿Ï†Î¿ÏÎ¹ÏÎ½ Î³Î¹Î± Ï„Î¿ instance, ÏŒÏ€Ï‰Ï‚ Ï„Î¿ instance ID, Î· Î¶ÏÎ½Î· Î´Î¹Î±Î¸ÎµÏƒÎ¹Î¼ÏŒÏ„Î·Ï„Î±Ï‚ ÏƒÏ„Î·Î½ Î¿Ï€Î¿Î¯Î± ÎµÎºÏ„ÎµÎ»ÎµÎ¯Ï„Î±Î¹, Î¿ IAM ÏÏŒÎ»Î¿Ï‚ Ï€Î¿Ï… ÏƒÏ…Î½Î´Î­ÎµÏ„Î±Î¹ Î¼Îµ Ï„Î¿ instance ÎºÎ±Î¹ Ï„Î¿ hostname Ï„Î¿Ï… instance.

{% embed url="https://book.hacktricks.xyz/pentesting-web/ssrf-server-side-request-forgery/cloud-ssrf" %}

### Enumeration
```bash
# Get EC2 instances
aws ec2 describe-instances
aws ec2 describe-instance-status #Get status from running instances

# Get user data from each ec2 instance
for instanceid in $(aws ec2 describe-instances --profile <profile> --region us-west-2 | grep -Eo '"i-[a-zA-Z0-9]+' | tr -d '"'); do
echo "Instance ID: $instanceid"
aws ec2 describe-instance-attribute --profile <profile> --region us-west-2 --instance-id "$instanceid" --attribute userData | jq ".UserData.Value" | tr -d '"' | base64 -d
echo ""
echo "-------------------"
done

# Instance profiles
aws iam list-instance-profiles
aws iam list-instance-profiles-for-role --role-name <name>

# Get tags
aws ec2 describe-tags

# Get volumes
aws ec2 describe-volume-status
aws ec2 describe-volumes

# Get snapshots
aws ec2 describe-snapshots --owner-ids self

# Scheduled instances
aws ec2 describe-scheduled-instances

# Get custom images
aws ec2 describe-images --owners self

# Get Elastic IPs
aws ec2 describe-addresses

# Get current output
aws ec2 get-console-output --instance-id [id]

# Get VPN customer gateways
aws ec2 describe-customer-gateways
aws ec2 describe-vpn-gateways
aws ec2 describe-vpn-connections

# List conversion tasks to upload/download VMs
aws ec2 describe-conversion-tasks
aws ec2 describe-import-image-tasks

# Get Bundle Tasks
aws ec2 describe-bundle-tasks

# Get Classic Instances
aws ec2 describe-classic-link-instances

# Get Dedicated Hosts
aws ec2 describe-hosts

# Get SSH Key Pairs
aws ec2 describe-key-pairs

# Get Internet Gateways
aws ec2 describe-internet-gateways

# Get NAT Gateways
aws ec2 describe-nat-gateways

# Get subnetworks
aws ec2 describe-subnets

# Get FW rules
aws ec2 describe-network-acls

# Get security groups
aws ec2 describe-security-groups

# Get interfaces
aws ec2 describe-network-interfaces

# Get routes table
aws ec2 describe-route-tables

# Get VPCs
aws ec2 describe-vpcs
aws ec2 describe-vpc-peering-connections
```
### ÎœÎ· Î•Î¾Î¿Ï…ÏƒÎ¹Î¿Î´Î¿Ï„Î·Î¼Î­Î½Î· Î ÏÏŒÏƒÎ²Î±ÏƒÎ·

{% content-ref url="../../aws-unauthenticated-enum-access/aws-ec2-unauthenticated-enum.md" %}
[aws-ec2-unauthenticated-enum.md](../../aws-unauthenticated-enum-access/aws-ec2-unauthenticated-enum.md)
{% endcontent-ref %}

### Î‘ÏÎ¾Î·ÏƒÎ· Î ÏÎ¿Î½Î¿Î¼Î¯Ï‰Î½

Î£Ï„Î·Î½ Î±ÎºÏŒÎ»Î¿Ï…Î¸Î· ÏƒÎµÎ»Î¯Î´Î± Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Î´ÎµÎ¯Ï„Îµ Ï€ÏÏ‚ Î½Î± **ÎµÎºÎ¼ÎµÏ„Î±Î»Î»ÎµÏ…Ï„ÎµÎ¯Ï„Îµ Ï„Î± Î´Î¹ÎºÎ±Î¹ÏÎ¼Î±Ï„Î± EC2 Î³Î¹Î± Î½Î± Î±Ï…Î¾Î®ÏƒÎµÏ„Îµ Ï„Î± Ï€ÏÎ¿Î½ÏŒÎ¼Î¹Î±**:

{% content-ref url="../../aws-privilege-escalation/aws-ec2-privesc.md" %}
[aws-ec2-privesc.md](../../aws-privilege-escalation/aws-ec2-privesc.md)
{% endcontent-ref %}

### ÎœÎµÏ„Î±-Î•ÎºÎ¼ÎµÏ„Î¬Î»Î»ÎµÏ…ÏƒÎ·

{% content-ref url="../../aws-post-exploitation/aws-ec2-ebs-ssm-and-vpc-post-exploitation/" %}
[aws-ec2-ebs-ssm-and-vpc-post-exploitation](../../aws-post-exploitation/aws-ec2-ebs-ssm-and-vpc-post-exploitation/)
{% endcontent-ref %}

## EBS

Î¤Î± **snapshots** Ï„Î¿Ï… Amazon **EBS** (Elastic Block Store) ÎµÎ¯Î½Î±Î¹ Î²Î±ÏƒÎ¹ÎºÎ¬ ÏƒÏ„Î±Ï„Î¹ÎºÎ¬ **Î±Î½Ï„Î¯Î³ÏÎ±Ï†Î± Î±ÏƒÏ†Î±Î»ÎµÎ¯Î±Ï‚** Ï„Ï‰Î½ ÏŒÎ³ÎºÏ‰Î½ EBS Ï„Î¿Ï… AWS. ÎœÎµ Î¬Î»Î»Î± Î»ÏŒÎ³Î¹Î±, ÎµÎ¯Î½Î±Î¹ **Î±Î½Ï„Î¯Î³ÏÎ±Ï†Î±** Ï„Ï‰Î½ **Î´Î¯ÏƒÎºÏ‰Î½** Ï€Î¿Ï… ÎµÎ¯Î½Î±Î¹ ÏƒÏ…Î½Î´ÎµÎ´ÎµÎ¼Î­Î½Î¿Î¹ ÏƒÎµ Î¼Î¹Î± **EC2** Instance ÏƒÎµ Î¼Î¹Î± ÏƒÏ…Î³ÎºÎµÎºÏÎ¹Î¼Î­Î½Î· Ï‡ÏÎ¿Î½Î¹ÎºÎ® ÏƒÏ„Î¹Î³Î¼Î®. Î¤Î± snapshots Ï„Î¿Ï… EBS Î¼Ï€Î¿ÏÎ¿ÏÎ½ Î½Î± Î±Î½Ï„Î¹Î³ÏÎ±Ï†Î¿ÏÎ½ Î¼ÎµÏ„Î±Î¾Ï Ï€ÎµÏÎ¹Î¿Ï‡ÏÎ½ ÎºÎ±Î¹ Î»Î¿Î³Î±ÏÎ¹Î±ÏƒÎ¼ÏÎ½, Î® Î±ÎºÏŒÎ¼Î± ÎºÎ±Î¹ Î½Î± ÎºÎ±Ï„ÎµÎ²Î¿ÏÎ½ ÎºÎ±Î¹ Î½Î± ÎµÎºÏ„ÎµÎ»ÎµÏƒÏ„Î¿ÏÎ½ Ï„Î¿Ï€Î¹ÎºÎ¬.

Î¤Î± Snapshots Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Ï€ÎµÏÎ¹Î­Ï‡Î¿Ï…Î½ **ÎµÏ…Î±Î¯ÏƒÎ¸Î·Ï„ÎµÏ‚ Ï€Î»Î·ÏÎ¿Ï†Î¿ÏÎ¯ÎµÏ‚** ÏŒÏ€Ï‰Ï‚ **Ï€Î·Î³Î±Î¯Î¿ ÎºÏÎ´Î¹ÎºÎ± Î® ÎºÎ»ÎµÎ¹Î´Î¹Î¬ API**, ÎµÏ€Î¿Î¼Î­Î½Ï‰Ï‚, Î±Î½ Î­Ï‡ÎµÏ„Îµ Ï„Î·Î½ ÎµÏ…ÎºÎ±Î¹ÏÎ¯Î±, ÏƒÏ…Î½Î¹ÏƒÏ„Î¬Ï„Î±Î¹ Î½Î± Ï„Î± ÎµÎ»Î­Î³Î¾ÎµÏ„Îµ.

### Î”Î¹Î±Ï†Î¿ÏÎ¬ AMI & EBS

ÎˆÎ½Î± **AMI** Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÎµÎ¯Ï„Î±Î¹ Î³Î¹Î± Î½Î± **ÎµÎºÎºÎ¹Î½Î®ÏƒÎµÎ¹ Î¼Î¹Î± EC2 instance**, ÎµÎ½Ï Î­Î½Î± **Snapshot** EC2 Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÎµÎ¯Ï„Î±Î¹ Î³Î¹Î± Î½Î± **Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î®ÏƒÎµÎ¹ Î±Î½Ï„Î¯Î³ÏÎ±Ï†Î± Î±ÏƒÏ†Î±Î»ÎµÎ¯Î±Ï‚ ÎºÎ±Î¹ Î½Î± Î±Î½Î±ÎºÏ„Î®ÏƒÎµÎ¹ Î´ÎµÎ´Î¿Î¼Î­Î½Î± Î±Ï€Î¿Î¸Î·ÎºÎµÏ…Î¼Î­Î½Î± ÏƒÎµ Î­Î½Î±Î½ ÏŒÎ³ÎºÎ¿ EBS**. Î•Î½Ï Î­Î½Î± Snapshot EC2 Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î·Î¸ÎµÎ¯ Î³Î¹Î± Î½Î± Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î®ÏƒÎµÎ¹ Î­Î½Î± Î½Î­Î¿ AMI, Î´ÎµÎ½ ÎµÎ¯Î½Î±Î¹ Ï„Î¿ Î¯Î´Î¹Î¿ Ï€ÏÎ¬Î³Î¼Î± Î¼Îµ Î­Î½Î± AMI ÎºÎ±Î¹ Î´ÎµÎ½ Ï€ÎµÏÎ¹Î»Î±Î¼Î²Î¬Î½ÎµÎ¹ Ï€Î»Î·ÏÎ¿Ï†Î¿ÏÎ¯ÎµÏ‚ Î³Î¹Î± Ï„Î¿ Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¹ÎºÏŒ ÏƒÏÏƒÏ„Î·Î¼Î±, Ï„Î¿Î½ Î´Î¹Î±ÎºÎ¿Î¼Î¹ÏƒÏ„Î® ÎµÏ†Î±ÏÎ¼Î¿Î³ÏÎ½ Î® Î¬Î»Î»Î¿ Î»Î¿Î³Î¹ÏƒÎ¼Î¹ÎºÏŒ Ï€Î¿Ï… Î±Ï€Î±Î¹Ï„ÎµÎ¯Ï„Î±Î¹ Î³Î¹Î± Ï„Î·Î½ ÎµÎºÏ„Î­Î»ÎµÏƒÎ· Î¼Î¹Î±Ï‚ ÎµÏ†Î±ÏÎ¼Î¿Î³Î®Ï‚.

### Î‘ÏÎ¾Î·ÏƒÎ· Î ÏÎ¿Î½Î¿Î¼Î¯Ï‰Î½

Î£Ï„Î·Î½ Î±ÎºÏŒÎ»Î¿Ï…Î¸Î· ÏƒÎµÎ»Î¯Î´Î± Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Î´ÎµÎ¯Ï„Îµ Ï€ÏÏ‚ Î½Î± **ÎµÎºÎ¼ÎµÏ„Î±Î»Î»ÎµÏ…Ï„ÎµÎ¯Ï„Îµ Ï„Î± Î´Î¹ÎºÎ±Î¹ÏÎ¼Î±Ï„Î± EBS Î³Î¹Î± Î½Î± Î±Ï…Î¾Î®ÏƒÎµÏ„Îµ Ï„Î± Ï€ÏÎ¿Î½ÏŒÎ¼Î¹Î±**:

{% content-ref url="../../aws-privilege-escalation/aws-ebs-privesc.md" %}
[aws-ebs-privesc.md](../../aws-privilege-escalation/aws-ebs-privesc.md)
{% endcontent-ref %}

## SSM

Î¤Î¿ **Amazon Simple Systems Manager (SSM)** ÎµÏ€Î¹Ï„ÏÎ­Ï€ÎµÎ¹ Ï„Î·Î½ Î±Ï€Î¿Î¼Î±ÎºÏÏ…ÏƒÎ¼Î­Î½Î· Î´Î¹Î±Ï‡ÎµÎ¯ÏÎ¹ÏƒÎ· ÏƒÏ„ÏŒÎ»Ï‰Î½ EC2 instances Î³Î¹Î± Î½Î± ÎºÎ¬Î½ÎµÎ¹ Ï„Î· Î´Î¹Î±Ï‡ÎµÎ¯ÏÎ¹ÏƒÎ® Ï„Î¿Ï…Ï‚ Ï€Î¿Î»Ï Ï€Î¹Î¿ ÎµÏÎºÎ¿Î»Î·. ÎšÎ¬Î¸Îµ Î¼Î¯Î± Î±Ï€ÏŒ Î±Ï…Ï„Î­Ï‚ Ï„Î¹Ï‚ instances Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± ÎµÎºÏ„ÎµÎ»ÎµÎ¯ Ï„Î·Î½ **Ï…Ï€Î·ÏÎµÏƒÎ¯Î± SSM Agent ÎºÎ±Î¸ÏÏ‚ Î· Ï…Ï€Î·ÏÎµÏƒÎ¯Î± Î¸Î± ÎµÎ¯Î½Î±Î¹ Î±Ï…Ï„Î® Ï€Î¿Ï… Î¸Î± Î»Î±Î¼Î²Î¬Î½ÎµÎ¹ Ï„Î¹Ï‚ ÎµÎ½Î­ÏÎ³ÎµÎ¹ÎµÏ‚ ÎºÎ±Î¹ Î¸Î± Ï„Î¹Ï‚ ÎµÎºÏ„ÎµÎ»ÎµÎ¯** Î±Ï€ÏŒ Ï„Î¿ AWS API.

ÎŸ **SSM Agent** ÎºÎ±Î¸Î¹ÏƒÏ„Î¬ Î´Ï…Î½Î±Ï„Î® Ï„Î·Î½ ÎµÎ½Î·Î¼Î­ÏÏ‰ÏƒÎ·, Î´Î¹Î±Ï‡ÎµÎ¯ÏÎ¹ÏƒÎ· ÎºÎ±Î¹ Î´Î¹Î±Î¼ÏŒÏÏ†Ï‰ÏƒÎ· Î±Ï…Ï„ÏÎ½ Ï„Ï‰Î½ Ï€ÏŒÏÏ‰Î½ Î±Ï€ÏŒ Ï„Î¿ Systems Manager. ÎŸ agent **ÎµÏ€ÎµÎ¾ÎµÏÎ³Î¬Î¶ÎµÏ„Î±Î¹ Î±Î¹Ï„Î®Î¼Î±Ï„Î± Î±Ï€ÏŒ Ï„Î·Î½ Ï…Ï€Î·ÏÎµÏƒÎ¯Î± Systems Manager ÏƒÏ„Î¿ AWS Cloud**, ÎºÎ±Î¹ ÏƒÏ„Î· ÏƒÏ…Î½Î­Ï‡ÎµÎ¹Î± Ï„Î± ÎµÎºÏ„ÎµÎ»ÎµÎ¯ ÏŒÏ€Ï‰Ï‚ ÎºÎ±Î¸Î¿ÏÎ¯Î¶ÎµÏ„Î±Î¹ ÏƒÏ„Î¿ Î±Î¯Ï„Î·Î¼Î±.

ÎŸ **SSM Agent Î­ÏÏ‡ÎµÏ„Î±Î¹**[ **Ï€ÏÎ¿ÎµÎ³ÎºÎ±Ï„ÎµÏƒÏ„Î·Î¼Î­Î½Î¿Ï‚ ÏƒÎµ Î¿ÏÎ¹ÏƒÎ¼Î­Î½Î± AMIs**](https://docs.aws.amazon.com/systems-manager/latest/userguide/ami-preinstalled-agent.html) Î® Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± Ï„Î¿Î½ [**ÎµÎ³ÎºÎ±Ï„Î±ÏƒÏ„Î®ÏƒÎµÏ„Îµ Ï‡ÎµÎ¹ÏÎ¿ÎºÎ¯Î½Î·Ï„Î±**](https://docs.aws.amazon.com/systems-manager/latest/userguide/sysman-manual-agent-install.html) ÏƒÏ„Î¹Ï‚ instances. Î•Ï€Î¯ÏƒÎ·Ï‚, Î¿ IAM Role Ï€Î¿Ï… Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÎµÎ¯Ï„Î±Î¹ Î¼Î­ÏƒÎ± ÏƒÏ„Î·Î½ instance Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± Î­Ï‡ÎµÎ¹ Ï„Î·Î½ Ï€Î¿Î»Î¹Ï„Î¹ÎºÎ® **AmazonEC2RoleforSSM** ÏƒÏ…Î½Î´ÎµÎ´ÎµÎ¼Î­Î½Î· Î³Î¹Î± Î½Î± Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± ÎµÏ€Î¹ÎºÎ¿Î¹Î½Ï‰Î½ÎµÎ¯.

### ÎšÎ±Ï„Î±Î¼Î­Ï„ÏÎ·ÏƒÎ·
```bash
aws ssm describe-instance-information
aws ssm describe-parameters
aws ssm describe-sessions --state [Active|History]
aws ssm describe-instance-patches --instance-id <id>
aws ssm describe-instance-patch-states --instance-ids <id>
aws ssm describe-instance-associations-status --instance-id <id>
```
ÎœÏ€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± ÎµÎ»Î­Î³Î¾ÎµÏ„Îµ ÏƒÎµ Î­Î½Î± EC2 instance Î±Î½ Ï„Î¿ Systems Manager ÎµÎºÏ„ÎµÎ»ÎµÎ¯Ï„Î±Î¹ Î±Ï€Î»Î¬ ÎµÎºÏ„ÎµÎ»ÏÎ½Ï„Î±Ï‚:
```bash
ps aux | grep amazon-ssm
```
### Privesc

Î£Ï„Î·Î½ Î±ÎºÏŒÎ»Î¿Ï…Î¸Î· ÏƒÎµÎ»Î¯Î´Î± Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Î´ÎµÎ¯Ï„Îµ Ï€ÏÏ‚ Î½Î± **ÎµÎºÎ¼ÎµÏ„Î±Î»Î»ÎµÏ…Ï„ÎµÎ¯Ï„Îµ Ï„Î± Î´Î¹ÎºÎ±Î¹ÏÎ¼Î±Ï„Î± SSM Î³Î¹Î± Î½Î± ÎºÎ»Î¹Î¼Î±ÎºÏÏƒÎµÏ„Îµ Ï€ÏÎ¿Î½ÏŒÎ¼Î¹Î±**:

{% content-ref url="../../aws-privilege-escalation/aws-ssm-privesc.md" %}
[aws-ssm-privesc.md](../../aws-privilege-escalation/aws-ssm-privesc.md)
{% endcontent-ref %}

## ELB

**Elastic Load Balancing** (ELB) ÎµÎ¯Î½Î±Î¹ Î¼Î¹Î± **Ï…Ï€Î·ÏÎµÏƒÎ¯Î± ÎµÎ¾Î¹ÏƒÎ¿ÏÏÏŒÏ€Î·ÏƒÎ·Ï‚ Ï†Î¿ÏÏ„Î¯Î¿Ï… Î³Î¹Î± Î±Î½Î±Ï€Ï„ÏÎ¾ÎµÎ¹Ï‚ Amazon Web Services** (AWS). Î¤Î¿ ELB Î±Ï…Ï„ÏŒÎ¼Î±Ï„Î± **Î´Î¹Î±Î½Î­Î¼ÎµÎ¹ Ï„Î·Î½ ÎµÎ¹ÏƒÎµÏÏ‡ÏŒÎ¼ÎµÎ½Î· ÎºÎ¯Î½Î·ÏƒÎ· ÎµÏ†Î±ÏÎ¼Î¿Î³ÏÎ½** ÎºÎ±Î¹ ÎºÎ»Î¹Î¼Î±ÎºÏÎ½ÎµÎ¹ Ï„Î¿Ï…Ï‚ Ï€ÏŒÏÎ¿Ï…Ï‚ Î³Î¹Î± Î½Î± Î±Î½Ï„Î±Ï€Î¿ÎºÏÎ¹Î¸ÎµÎ¯ ÏƒÏ„Î¹Ï‚ Î±Ï€Î±Î¹Ï„Î®ÏƒÎµÎ¹Ï‚ Ï„Î·Ï‚ ÎºÎ¯Î½Î·ÏƒÎ·Ï‚.

### Enumeration
```bash
# List internet-facing ELBs
aws elb describe-load-balancers
aws elb describe-load-balancers | jq '.LoadBalancerDescriptions[]| select( .Scheme | contains("internet-facing"))|.DNSName'

# DONT FORGET TO CHECK VERSION 2
aws elbv2 describe-load-balancers
aws elbv2 describe-load-balancers | jq '.LoadBalancers[].DNSName'
aws elbv2 describe-listeners --load-balancer-arn <load_balancer_arn>
```
## Launch Templates & Autoscaling Groups

### ÎšÎ±Ï„Î±Î¼Î­Ï„ÏÎ·ÏƒÎ·

{% code overflow="wrap" %}
```bash
# Launch templates
aws ec2 describe-launch-templates
aws ec2 describe-launch-templates --launch-template-id <launch_template_id>
## Get details, like user data
aws ec2 describe-launch-template-versions --launch-template-id <launch_template_id>

# Autoscaling
aws autoscaling describe-auto-scaling-groups
aws autoscaling describe-auto-scaling-instances
aws autoscaling describe-launch-configurations
aws autoscaling describe-load-balancer-target-groups
aws autoscaling describe-load-balancers
```
{% endcode %}

## Nitro

Î¤Î¿ AWS Nitro ÎµÎ¯Î½Î±Î¹ Î¼Î¹Î± ÏƒÎ¿Ï…Î¯Ï„Î± Î±Ï€ÏŒ **ÎºÎ±Î¹Î½Î¿Ï„ÏŒÎ¼ÎµÏ‚ Ï„ÎµÏ‡Î½Î¿Î»Î¿Î³Î¯ÎµÏ‚** Ï€Î¿Ï… Î±Ï€Î¿Ï„ÎµÎ»Î¿ÏÎ½ Ï„Î·Î½ Ï…Ï€Î¿ÎºÎµÎ¯Î¼ÎµÎ½Î· Ï€Î»Î±Ï„Ï†ÏŒÏÎ¼Î± Î³Î¹Î± Ï„Î¹Ï‚ AWS EC2 instances. Î•Î¹ÏƒÎ®Ï‡Î¸Î· Î±Ï€ÏŒ Ï„Î·Î½ Amazon Î³Î¹Î± Î½Î± **ÎµÎ½Î¹ÏƒÏ‡ÏÏƒÎµÎ¹ Ï„Î·Î½ Î±ÏƒÏ†Î¬Î»ÎµÎ¹Î±, Ï„Î·Î½ Î±Ï€ÏŒÎ´Î¿ÏƒÎ· ÎºÎ±Î¹ Ï„Î·Î½ Î±Î¾Î¹Î¿Ï€Î¹ÏƒÏ„Î¯Î±**, Ï„Î¿ Nitro Î±Î¾Î¹Î¿Ï€Î¿Î¹ÎµÎ¯ Ï€ÏÎ¿ÏƒÎ±ÏÎ¼Î¿ÏƒÎ¼Î­Î½Î± **Ï…Î»Î¹ÎºÎ¬ ÎµÎ¾Î±ÏÏ„Î®Î¼Î±Ï„Î± ÎºÎ±Î¹ Î­Î½Î±Î½ ÎµÎ»Î±Ï†ÏÏ hypervisor**. Î‘Ï†Î±Î¹ÏÎµÎ¯ Î¼ÎµÎ³Î¬Î»Î¿ Î¼Î­ÏÎ¿Ï‚ Ï„Î·Ï‚ Ï€Î±ÏÎ±Î´Î¿ÏƒÎ¹Î±ÎºÎ®Ï‚ Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¹ÎºÏŒÏ„Î·Ï„Î±Ï‚ ÎµÎ¹ÎºÎ¿Î½Î¹ÎºÎ¿Ï€Î¿Î¯Î·ÏƒÎ·Ï‚ ÏƒÎµ ÎµÎ¹Î´Î¹ÎºÏŒ Ï…Î»Î¹ÎºÏŒ ÎºÎ±Î¹ Î»Î¿Î³Î¹ÏƒÎ¼Î¹ÎºÏŒ, **ÎµÎ»Î±Ï‡Î¹ÏƒÏ„Î¿Ï€Î¿Î¹ÏÎ½Ï„Î±Ï‚ Ï„Î·Î½ ÎµÏ€Î¹Ï†Î¬Î½ÎµÎ¹Î± ÎµÏ€Î¯Î¸ÎµÏƒÎ·Ï‚** ÎºÎ±Î¹ Î²ÎµÎ»Ï„Î¹ÏÎ½Î¿Î½Ï„Î±Ï‚ Ï„Î·Î½ Î±Ï€Î¿Î´Î¿Ï„Î¹ÎºÏŒÏ„Î·Ï„Î± Ï„Ï‰Î½ Ï€ÏŒÏÏ‰Î½. ÎœÎµ Ï„Î·Î½ ÎµÎºÏ†ÏŒÏÏ„Ï‰ÏƒÎ· Ï„Ï‰Î½ Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¹ÏÎ½ ÎµÎ¹ÎºÎ¿Î½Î¹ÎºÎ¿Ï€Î¿Î¯Î·ÏƒÎ·Ï‚, Ï„Î¿ Nitro ÎµÏ€Î¹Ï„ÏÎ­Ï€ÎµÎ¹ ÏƒÏ„Î¹Ï‚ EC2 instances Î½Î± Ï€Î±ÏÎ­Ï‡Î¿Ï…Î½ **ÏƒÏ‡ÎµÎ´ÏŒÎ½ Î±Ï€ÏŒÎ´Î¿ÏƒÎ· Î³Ï…Î¼Î½Î¿Ï Î¼ÎµÏ„Î¬Î»Î»Î¿Ï…**, ÎºÎ±Î¸Î¹ÏƒÏ„ÏÎ½Ï„Î±Ï‚ Ï„Î¿ Î¹Î´Î¹Î±Î¯Ï„ÎµÏÎ± ÎµÏ€Ï‰Ï†ÎµÎ»Î­Ï‚ Î³Î¹Î± ÎµÏ†Î±ÏÎ¼Î¿Î³Î­Ï‚ Ï€Î¿Ï… Î±Ï€Î±Î¹Ï„Î¿ÏÎ½ Ï€Î¿Î»Î»Î¿ÏÏ‚ Ï€ÏŒÏÎ¿Ï…Ï‚. Î•Ï€Î¹Ï€Î»Î­Î¿Î½, Ï„Î¿ Nitro Security Chip Î´Î¹Î±ÏƒÏ†Î±Î»Î¯Î¶ÎµÎ¹ ÎµÎ¹Î´Î¹ÎºÎ¬ Ï„Î·Î½ **Î±ÏƒÏ†Î¬Î»ÎµÎ¹Î± Ï„Î¿Ï… Ï…Î»Î¹ÎºÎ¿Ï ÎºÎ±Î¹ Ï„Î¿Ï… firmware**, ÎµÎ½Î¹ÏƒÏ‡ÏÎ¿Î½Ï„Î±Ï‚ Ï€ÎµÏÎ±Î¹Ï„Î­ÏÏ‰ Ï„Î·Î½ Î¹ÏƒÏ‡Ï…ÏÎ® Î±ÏÏ‡Î¹Ï„ÎµÎºÏ„Î¿Î½Î¹ÎºÎ® Ï„Î¿Ï….

Î ÎµÏÎ¹ÏƒÏƒÏŒÏ„ÎµÏÎµÏ‚ Ï€Î»Î·ÏÎ¿Ï†Î¿ÏÎ¯ÎµÏ‚ ÎºÎ±Î¹ Ï€ÏÏ‚ Î½Î± Ï„Î¿ Î±Ï€Î±ÏÎ¹Î¸Î¼Î®ÏƒÎµÏ„Îµ Î±Ï€ÏŒ:

{% content-ref url="aws-nitro-enum.md" %}
[aws-nitro-enum.md](aws-nitro-enum.md)
{% endcontent-ref %}

## VPN

ÎˆÎ½Î± VPN ÎµÏ€Î¹Ï„ÏÎ­Ï€ÎµÎ¹ Ï„Î· ÏƒÏÎ½Î´ÎµÏƒÎ· Ï„Î¿Ï… **Î´Î¹ÎºÏ„ÏÎ¿Ï… ÏƒÎ±Ï‚ ÏƒÏ„Î¹Ï‚ ÎµÎ³ÎºÎ±Ï„Î±ÏƒÏ„Î¬ÏƒÎµÎ¹Ï‚ (site-to-site VPN)** Î® Ï„Ï‰Î½ **Ï†Î¿ÏÎ·Ï„ÏÎ½ Ï…Ï€Î¿Î»Î¿Î³Î¹ÏƒÏ„ÏÎ½ Ï„Ï‰Î½ ÎµÏÎ³Î±Î¶Î¿Î¼Î­Î½Ï‰Î½ (Client VPN)** Î¼Îµ Î­Î½Î± **AWS VPC** ÏÏƒÏ„Îµ Î¿Î¹ Ï…Ï€Î·ÏÎµÏƒÎ¯ÎµÏ‚ Î½Î± Î¼Ï€Î¿ÏÎ¿ÏÎ½ Î½Î± Ï€ÏÎ¿ÏƒÏ€ÎµÎ»Î±ÏƒÏ„Î¿ÏÎ½ Ï‡Ï‰ÏÎ¯Ï‚ Î½Î± Ï‡ÏÎµÎ¹Î¬Î¶ÎµÏ„Î±Î¹ Î½Î± ÎµÎºÏ„ÎµÎ¸Î¿ÏÎ½ ÏƒÏ„Î¿ Î´Î¹Î±Î´Î¯ÎºÏ„Ï…Î¿.

#### Î’Î±ÏƒÎ¹ÎºÎ¬ Î£Ï…ÏƒÏ„Î±Ï„Î¹ÎºÎ¬ Ï„Î¿Ï… AWS VPN

1. **Customer Gateway**:
* ÎˆÎ½Î± Customer Gateway ÎµÎ¯Î½Î±Î¹ Î­Î½Î±Ï‚ Ï€ÏŒÏÎ¿Ï‚ Ï€Î¿Ï… Î´Î·Î¼Î¹Î¿Ï…ÏÎ³ÎµÎ¯Ï„Îµ ÏƒÏ„Î¿ AWS Î³Î¹Î± Î½Î± Î±Î½Ï„Î¹Ï€ÏÎ¿ÏƒÏ‰Ï€ÎµÏÎµÎ¹ Ï„Î·Î½ Ï€Î»ÎµÏ…ÏÎ¬ ÏƒÎ±Ï‚ Î¼Î¹Î±Ï‚ ÏƒÏÎ½Î´ÎµÏƒÎ·Ï‚ VPN.
* Î•Î¯Î½Î±Î¹ Î¿Ï…ÏƒÎ¹Î±ÏƒÏ„Î¹ÎºÎ¬ Î¼Î¹Î± Ï†Ï…ÏƒÎ¹ÎºÎ® ÏƒÏ…ÏƒÎºÎµÏ…Î® Î® ÎµÏ†Î±ÏÎ¼Î¿Î³Î® Î»Î¿Î³Î¹ÏƒÎ¼Î¹ÎºÎ¿Ï ÏƒÏ„Î·Î½ Ï€Î»ÎµÏ…ÏÎ¬ ÏƒÎ±Ï‚ Ï„Î·Ï‚ ÏƒÏÎ½Î´ÎµÏƒÎ·Ï‚ Site-to-Site VPN.
* Î Î±ÏÎ­Ï‡ÎµÏ„Îµ Ï€Î»Î·ÏÎ¿Ï†Î¿ÏÎ¯ÎµÏ‚ Î´ÏÎ¿Î¼Î¿Î»ÏŒÎ³Î·ÏƒÎ·Ï‚ ÎºÎ±Î¹ Ï„Î· Î´Î·Î¼ÏŒÏƒÎ¹Î± Î´Î¹ÎµÏÎ¸Ï…Î½ÏƒÎ· IP Ï„Î·Ï‚ Î´Î¹ÎºÏ„Ï…Î±ÎºÎ®Ï‚ ÏƒÎ±Ï‚ ÏƒÏ…ÏƒÎºÎµÏ…Î®Ï‚ (ÏŒÏ€Ï‰Ï‚ Î­Î½Î±Ï‚ Î´ÏÎ¿Î¼Î¿Î»Î¿Î³Î·Ï„Î®Ï‚ Î® Î­Î½Î± firewall) ÏƒÏ„Î¿ AWS Î³Î¹Î± Î½Î± Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î®ÏƒÎµÏ„Îµ Î­Î½Î± Customer Gateway.
* Î›ÎµÎ¹Ï„Î¿Ï…ÏÎ³ÎµÎ¯ Ï‰Ï‚ ÏƒÎ·Î¼ÎµÎ¯Î¿ Î±Î½Î±Ï†Î¿ÏÎ¬Ï‚ Î³Î¹Î± Ï„Î· ÏÏÎ¸Î¼Î¹ÏƒÎ· Ï„Î·Ï‚ ÏƒÏÎ½Î´ÎµÏƒÎ·Ï‚ VPN ÎºÎ±Î¹ Î´ÎµÎ½ ÎµÏ€Î¹Ï†Î­ÏÎµÎ¹ ÎµÏ€Î¹Ï€Î»Î­Î¿Î½ Ï‡ÏÎµÏÏƒÎµÎ¹Ï‚.
2. **Virtual Private Gateway**:
* ÎˆÎ½Î± Virtual Private Gateway (VPG) ÎµÎ¯Î½Î±Î¹ Î¿ ÏƒÏ…Î³ÎºÎµÎ½Ï„ÏÏ‰Ï„Î®Ï‚ VPN ÏƒÏ„Î·Î½ Ï€Î»ÎµÏ…ÏÎ¬ Ï„Î·Ï‚ Amazon Ï„Î·Ï‚ ÏƒÏÎ½Î´ÎµÏƒÎ·Ï‚ Site-to-Site VPN.
* Î•Î¯Î½Î±Î¹ ÏƒÏ…Î½Î´ÎµÎ´ÎµÎ¼Î­Î½Î¿ Î¼Îµ Ï„Î¿ VPC ÏƒÎ±Ï‚ ÎºÎ±Î¹ Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³ÎµÎ¯ Ï‰Ï‚ ÏƒÏ„ÏŒÏ‡Î¿Ï‚ Î³Î¹Î± Ï„Î· ÏƒÏÎ½Î´ÎµÏƒÎ· VPN ÏƒÎ±Ï‚.
* Î¤Î¿ VPG ÎµÎ¯Î½Î±Î¹ Ï„Î¿ ÏƒÎ·Î¼ÎµÎ¯Î¿ Ï„ÎµÏÎ¼Î±Ï„Î¹ÏƒÎ¼Î¿Ï Ï„Î·Ï‚ Ï€Î»ÎµÏ…ÏÎ¬Ï‚ Ï„Î¿Ï… AWS Î³Î¹Î± Ï„Î· ÏƒÏÎ½Î´ÎµÏƒÎ· VPN.
* Î”Î¹Î±Ï‡ÎµÎ¹ÏÎ¯Î¶ÎµÏ„Î±Î¹ Ï„Î·Î½ Î±ÏƒÏ†Î±Î»Î® ÎµÏ€Î¹ÎºÎ¿Î¹Î½Ï‰Î½Î¯Î± Î¼ÎµÏ„Î±Î¾Ï Ï„Î¿Ï… VPC ÏƒÎ±Ï‚ ÎºÎ±Î¹ Ï„Î¿Ï… Î´Î¹ÎºÏ„ÏÎ¿Ï… ÏƒÎ±Ï‚ ÏƒÏ„Î¹Ï‚ ÎµÎ³ÎºÎ±Ï„Î±ÏƒÏ„Î¬ÏƒÎµÎ¹Ï‚.
3. **Site-to-Site VPN Connection**:
* ÎœÎ¹Î± ÏƒÏÎ½Î´ÎµÏƒÎ· Site-to-Site VPN ÏƒÏ…Î½Î´Î­ÎµÎ¹ Ï„Î¿ Î´Î¯ÎºÏ„Ï…ÏŒ ÏƒÎ±Ï‚ ÏƒÏ„Î¹Ï‚ ÎµÎ³ÎºÎ±Ï„Î±ÏƒÏ„Î¬ÏƒÎµÎ¹Ï‚ Î¼Îµ Î­Î½Î± VPC Î¼Î­ÏƒÏ‰ ÎµÎ½ÏŒÏ‚ Î±ÏƒÏ†Î±Î»Î¿ÏÏ‚, IPsec VPN Ï„Î¿ÏÎ½ÎµÎ».
* Î‘Ï…Ï„ÏŒÏ‚ Î¿ Ï„ÏÏ€Î¿Ï‚ ÏƒÏÎ½Î´ÎµÏƒÎ·Ï‚ Î±Ï€Î±Î¹Ï„ÎµÎ¯ Î­Î½Î± Customer Gateway ÎºÎ±Î¹ Î­Î½Î± Virtual Private Gateway.
* Î§ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÎµÎ¯Ï„Î±Î¹ Î³Î¹Î± Î±ÏƒÏ†Î±Î»Î®, ÏƒÏ„Î±Î¸ÎµÏÎ® ÎºÎ±Î¹ ÏƒÏ…Î½ÎµÏ€Î® ÎµÏ€Î¹ÎºÎ¿Î¹Î½Ï‰Î½Î¯Î± Î¼ÎµÏ„Î±Î¾Ï Ï„Î¿Ï… ÎºÎ­Î½Ï„ÏÎ¿Ï… Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½ Î® Ï„Î¿Ï… Î´Î¹ÎºÏ„ÏÎ¿Ï… ÏƒÎ±Ï‚ ÎºÎ±Î¹ Ï„Î¿Ï… Ï€ÎµÏÎ¹Î²Î¬Î»Î»Î¿Î½Ï„Î¿Ï‚ AWS ÏƒÎ±Ï‚.
* Î£Ï…Î½Î®Î¸Ï‰Ï‚ Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÎµÎ¯Ï„Î±Î¹ Î³Î¹Î± Ï„Î±ÎºÏ„Î¹ÎºÎ­Ï‚, Î¼Î±ÎºÏÎ¿Ï‡ÏÏŒÎ½Î¹ÎµÏ‚ ÏƒÏ…Î½Î´Î­ÏƒÎµÎ¹Ï‚ ÎºÎ±Î¹ Ï‡ÏÎµÏÎ½ÎµÏ„Î±Î¹ Î¼Îµ Î²Î¬ÏƒÎ· Ï„Î·Î½ Ï€Î¿ÏƒÏŒÏ„Î·Ï„Î± Ï„Ï‰Î½ Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½ Ï€Î¿Ï… Î¼ÎµÏ„Î±Ï†Î­ÏÎ¿Î½Ï„Î±Î¹ Î¼Î­ÏƒÏ‰ Ï„Î·Ï‚ ÏƒÏÎ½Î´ÎµÏƒÎ·Ï‚.
4. **Client VPN Endpoint**:
* ÎˆÎ½Î± Client VPN endpoint ÎµÎ¯Î½Î±Î¹ Î­Î½Î±Ï‚ Ï€ÏŒÏÎ¿Ï‚ Ï€Î¿Ï… Î´Î·Î¼Î¹Î¿Ï…ÏÎ³ÎµÎ¯Ï„Îµ ÏƒÏ„Î¿ AWS Î³Î¹Î± Î½Î± ÎµÏ€Î¹Ï„ÏÎ­ÏˆÎµÏ„Îµ ÎºÎ±Î¹ Î½Î± Î´Î¹Î±Ï‡ÎµÎ¹ÏÎ¹ÏƒÏ„ÎµÎ¯Ï„Îµ Ï„Î¹Ï‚ ÏƒÏ…Î½ÎµÎ´ÏÎ¯ÎµÏ‚ VPN Ï€ÎµÎ»Î±Ï„ÏÎ½.
* Î§ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÎµÎ¯Ï„Î±Î¹ Î³Î¹Î± Î½Î± ÎµÏ€Î¹Ï„ÏÎ­Ï€ÎµÎ¹ ÏƒÎµ Î¼ÎµÎ¼Î¿Î½Ï‰Î¼Î­Î½ÎµÏ‚ ÏƒÏ…ÏƒÎºÎµÏ…Î­Ï‚ (ÏŒÏ€Ï‰Ï‚ Ï†Î¿ÏÎ·Ï„Î¿ÏÏ‚ Ï…Ï€Î¿Î»Î¿Î³Î¹ÏƒÏ„Î­Ï‚, smartphones, Îº.Î»Ï€.) Î½Î± ÏƒÏ…Î½Î´Î­Î¿Î½Ï„Î±Î¹ Î¼Îµ Î±ÏƒÏ†Î¬Î»ÎµÎ¹Î± Î¼Îµ Ï€ÏŒÏÎ¿Ï…Ï‚ Ï„Î¿Ï… AWS Î® Ï„Î¿ Î´Î¯ÎºÏ„Ï…ÏŒ ÏƒÎ±Ï‚ ÏƒÏ„Î¹Ï‚ ÎµÎ³ÎºÎ±Ï„Î±ÏƒÏ„Î¬ÏƒÎµÎ¹Ï‚.
* Î”Î¹Î±Ï†Î­ÏÎµÎ¹ Î±Ï€ÏŒ Ï„Î¿ Site-to-Site VPN ÏƒÏ„Î¿ ÏŒÏ„Î¹ ÎµÎ¯Î½Î±Î¹ ÏƒÏ‡ÎµÎ´Î¹Î±ÏƒÎ¼Î­Î½Î¿ Î³Î¹Î± Î¼ÎµÎ¼Î¿Î½Ï‰Î¼Î­Î½Î¿Ï…Ï‚ Ï€ÎµÎ»Î¬Ï„ÎµÏ‚ ÎºÎ±Î¹ ÏŒÏ‡Î¹ Î³Î¹Î± Ï„Î· ÏƒÏÎ½Î´ÎµÏƒÎ· Î¿Î»ÏŒÎºÎ»Î·ÏÏ‰Î½ Î´Î¹ÎºÏ„ÏÏ‰Î½.
* ÎœÎµ Ï„Î¿ Client VPN, ÎºÎ¬Î¸Îµ ÏƒÏ…ÏƒÎºÎµÏ…Î® Ï€ÎµÎ»Î¬Ï„Î· Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÎµÎ¯ Î»Î¿Î³Î¹ÏƒÎ¼Î¹ÎºÏŒ VPN Ï€ÎµÎ»Î¬Ï„Î· Î³Î¹Î± Î½Î± Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î®ÏƒÎµÎ¹ Î¼Î¹Î± Î±ÏƒÏ†Î±Î»Î® ÏƒÏÎ½Î´ÎµÏƒÎ·.

ÎœÏ€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± [**Î²ÏÎµÎ¯Ï„Îµ Ï€ÎµÏÎ¹ÏƒÏƒÏŒÏ„ÎµÏÎµÏ‚ Ï€Î»Î·ÏÎ¿Ï†Î¿ÏÎ¯ÎµÏ‚ ÏƒÏ‡ÎµÏ„Î¹ÎºÎ¬ Î¼Îµ Ï„Î± Î¿Ï†Î­Î»Î· ÎºÎ±Î¹ Ï„Î± ÏƒÏ…ÏƒÏ„Î±Ï„Î¹ÎºÎ¬ Ï„Ï‰Î½ AWS VPNs ÎµÎ´Ï**](aws-vpc-and-networking-basic-information.md#vpn).

### Enumeration
```bash
# VPN endpoints
## Check used subnetwork, authentication, SGs, connected...
aws ec2 describe-client-vpn-endpoints

## Get AWS network info related to the vpn endpoint
aws ec2 describe-client-vpn-target-networks --client-vpn-endpoint-id <id>

## Get AWS subnet & ip range the VPN iconnected to
aws ec2 describe-client-vpn-routes --client-vpn-endpoint-id <id>

## Check authorization rules
aws ec2 describe-client-vpn-authorization-rules --client-vpn-endpoint-id <id>

## Get current connections to the VPN endpoint
aws ec2 describe-client-vpn-connections --client-vpn-endpoint-id <id>

# Get VPN gateways and check with which VPC each is connected
aws ec2 describe-vpn-gateways

# Get VPN site-to-site connections
aws ec2 describe-vpn-connections
```
### Î¤Î¿Ï€Î¹ÎºÎ® Î‘Ï€Î±ÏÎ¯Î¸Î¼Î·ÏƒÎ·

**Î¤Î¿Ï€Î¹ÎºÎ¬ Î ÏÎ¿ÏƒÏ‰ÏÎ¹Î½Î¬ Î”Î¹Î±Ï€Î¹ÏƒÏ„ÎµÏ…Ï„Î®ÏÎ¹Î±**

ÎŒÏ„Î±Î½ Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÎµÎ¯Ï„Î±Î¹ Î¿ AWS VPN Client Î³Î¹Î± ÏƒÏÎ½Î´ÎµÏƒÎ· ÏƒÎµ VPN, Î¿ Ï‡ÏÎ®ÏƒÏ„Î·Ï‚ ÏƒÏ…Î½Î®Î¸Ï‰Ï‚ **ÏƒÏ…Î½Î´Î­ÎµÏ„Î±Î¹ ÏƒÏ„Î¿ AWS** Î³Î¹Î± Î½Î± Î±Ï€Î¿ÎºÏ„Î®ÏƒÎµÎ¹ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ· ÏƒÏ„Î¿ VPN. Î£Ï„Î· ÏƒÏ…Î½Î­Ï‡ÎµÎ¹Î±, ÎºÎ¬Ï€Î¿Î¹Î± **AWS Î´Î¹Î±Ï€Î¹ÏƒÏ„ÎµÏ…Ï„Î®ÏÎ¹Î± Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î¿ÏÎ½Ï„Î±Î¹ ÎºÎ±Î¹ Î±Ï€Î¿Î¸Î·ÎºÎµÏÎ¿Î½Ï„Î±Î¹** Ï„Î¿Ï€Î¹ÎºÎ¬ Î³Î¹Î± Î½Î± ÎºÎ±Î¸Î¹ÎµÏÏ‰Î¸ÎµÎ¯ Î· ÏƒÏÎ½Î´ÎµÏƒÎ· VPN. Î‘Ï…Ï„Î¬ Ï„Î± Î´Î¹Î±Ï€Î¹ÏƒÏ„ÎµÏ…Ï„Î®ÏÎ¹Î± **Î±Ï€Î¿Î¸Î·ÎºÎµÏÎ¿Î½Ï„Î±Î¹ ÏƒÏ„Î¿** `$HOME/.config/AWSVPNClient/TemporaryCredentials/<region>/temporary-credentials.txt` ÎºÎ±Î¹ Ï€ÎµÏÎ¹Î­Ï‡Î¿Ï…Î½ Î­Î½Î± **AccessKey**, Î­Î½Î± **SecretKey** ÎºÎ±Î¹ Î­Î½Î± **Token**.

Î¤Î± Î´Î¹Î±Ï€Î¹ÏƒÏ„ÎµÏ…Ï„Î®ÏÎ¹Î± Î±Î½Î®ÎºÎ¿Ï…Î½ ÏƒÏ„Î¿Î½ Ï‡ÏÎ®ÏƒÏ„Î· `arn:aws:sts::<acc-id>:assumed-role/aws-vpn-client-metrics-analytics-access-role/CognitoIdentityCredentials` (TODO: Î­ÏÎµÏ…Î½Î± Ï€ÎµÏÎ¹ÏƒÏƒÏŒÏ„ÎµÏÎ± Î³Î¹Î± Ï„Î± Î´Î¹ÎºÎ±Î¹ÏÎ¼Î±Ï„Î± Î±Ï…Ï„ÏÎ½ Ï„Ï‰Î½ Î´Î¹Î±Ï€Î¹ÏƒÏ„ÎµÏ…Ï„Î·ÏÎ¯Ï‰Î½).

**opvn config files**

Î•Î¬Î½ Î¼Î¹Î± **ÏƒÏÎ½Î´ÎµÏƒÎ· VPN Î­Ï‡ÎµÎ¹ ÎºÎ±Î¸Î¹ÎµÏÏ‰Î¸ÎµÎ¯** Î¸Î± Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± Î±Î½Î±Î¶Î·Ï„Î®ÏƒÎµÏ„Îµ **`.opvn`** Î±ÏÏ‡ÎµÎ¯Î± ÏÏ…Î¸Î¼Î¯ÏƒÎµÏ‰Î½ ÏƒÏ„Î¿ ÏƒÏÏƒÏ„Î·Î¼Î±. Î•Ï€Î¹Ï€Î»Î­Î¿Î½, Î­Î½Î± Î¼Î­ÏÎ¿Ï‚ ÏŒÏ€Î¿Ï… Î¸Î± Î¼Ï€Î¿ÏÎ¿ÏÏƒÎ±Ï„Îµ Î½Î± Î²ÏÎµÎ¯Ï„Îµ Ï„Î¹Ï‚ **ÏÏ…Î¸Î¼Î¯ÏƒÎµÎ¹Ï‚** ÎµÎ¯Î½Î±Î¹ ÏƒÏ„Î¿ **`$HOME/.config/AWSVPNClient/OpenVpnConfigs`**

#### **ÎœÎµÏ„Î¬ Ï„Î·Î½ Î•ÎºÎ¼ÎµÏ„Î¬Î»Î»ÎµÏ…ÏƒÎ·**

{% content-ref url="../../aws-post-exploitation/aws-vpn-post-exploitation.md" %}
[aws-vpn-post-exploitation.md](../../aws-post-exploitation/aws-vpn-post-exploitation.md)
{% endcontent-ref %}

## Î‘Î½Î±Ï†Î¿ÏÎ­Ï‚

* [https://docs.aws.amazon.com/batch/latest/userguide/getting-started-ec2.html](https://docs.aws.amazon.com/batch/latest/userguide/getting-started-ec2.html)

{% hint style="success" %}
ÎœÎ¬Î¸ÎµÏ„Îµ & ÎµÎ¾Î±ÏƒÎºÎ·Î¸ÎµÎ¯Ï„Îµ ÏƒÏ„Î¿ AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
ÎœÎ¬Î¸ÎµÏ„Îµ & ÎµÎ¾Î±ÏƒÎºÎ·Î¸ÎµÎ¯Ï„Îµ ÏƒÏ„Î¿ GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Î¥Ï€Î¿ÏƒÏ„Î·ÏÎ¯Î¾Ï„Îµ Ï„Î¿ HackTricks</summary>

* Î•Î»Î­Î³Î¾Ï„Îµ Ï„Î± [**ÏƒÏ‡Î­Î´Î¹Î± ÏƒÏ…Î½Î´ÏÎ¿Î¼Î®Ï‚**](https://github.com/sponsors/carlospolop)!
* **Î£Ï…Î¼Î¼ÎµÏ„Î¬ÏƒÏ‡ÎµÏ„Îµ ÏƒÏ„Î·Î½** ğŸ’¬ [**Î¿Î¼Î¬Î´Î± Discord**](https://discord.gg/hRep4RUj7f) Î® Ï„Î·Î½ [**Î¿Î¼Î¬Î´Î± telegram**](https://t.me/peass) Î® **Î±ÎºÎ¿Î»Î¿Ï…Î¸Î®ÏƒÏ„Îµ** Î¼Î±Ï‚ ÏƒÏ„Î¿ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **ÎœÎ¿Î¹ÏÎ±ÏƒÏ„ÎµÎ¯Ï„Îµ hacking tricks Ï…Ï€Î¿Î²Î¬Î»Î»Î¿Î½Ï„Î±Ï‚ PRs ÏƒÏ„Î±** [**HackTricks**](https://github.com/carlospolop/hacktricks) ÎºÎ±Î¹ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) Î±Ï€Î¿Î¸ÎµÏ„Î®ÏÎ¹Î± ÏƒÏ„Î¿ github.

</details>
{% endhint %}
