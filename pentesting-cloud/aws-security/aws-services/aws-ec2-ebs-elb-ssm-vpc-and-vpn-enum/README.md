# AWS - EC2, EBS, ELB, SSM, VPC & VPN Enum

{% hint style="success" %}
å­¦ä¹ å’Œç»ƒä¹  AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
å­¦ä¹ å’Œç»ƒä¹  GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>æ”¯æŒ HackTricks</summary>

* æŸ¥çœ‹ [**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**telegram ç¾¤ç»„**](https://t.me/peass) æˆ– **å…³æ³¨** æˆ‘ä»¬çš„ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **é€šè¿‡æäº¤ PRs åˆ†äº« hacking æŠ€å·§åˆ°** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ä»“åº“ã€‚

</details>
{% endhint %}

## VPC & Networking

äº†è§£ä»€ä¹ˆæ˜¯ VPC åŠå…¶ç»„ä»¶ï¼š

{% content-ref url="aws-vpc-and-networking-basic-information.md" %}
[aws-vpc-and-networking-basic-information.md](aws-vpc-and-networking-basic-information.md)
{% endcontent-ref %}

## EC2

Amazon EC2 ç”¨äºå¯åŠ¨**è™šæ‹ŸæœåŠ¡å™¨**ã€‚å®ƒå…è®¸é…ç½®**å®‰å…¨æ€§**å’Œ**ç½‘ç»œ**ä»¥åŠç®¡ç†**å­˜å‚¨**ã€‚Amazon EC2 çš„çµæ´»æ€§ä½“ç°åœ¨å…¶èƒ½å¤Ÿä¸Šä¸‹æ‰©å±•èµ„æºï¼Œæœ‰æ•ˆé€‚åº”ä¸åŒçš„éœ€æ±‚å˜åŒ–æˆ–æµè¡Œåº¦æ¿€å¢ã€‚è¿™ä¸€ç‰¹æ€§å‡å°‘äº†å¯¹ç²¾ç¡®æµé‡é¢„æµ‹çš„å¿…è¦æ€§ã€‚

åœ¨ EC2 ä¸­æœ‰è¶£çš„æšä¸¾å†…å®¹ï¼š

* è™šæ‹Ÿæœº
* SSH å¯†é’¥
* ç”¨æˆ·æ•°æ®
* ç°æœ‰çš„ EC2s/AMIs/å¿«ç…§
* ç½‘ç»œ
* ç½‘ç»œ
* å­ç½‘
* å…¬å…± IP
* å¼€æ”¾ç«¯å£
* ä¸ AWS ä¹‹å¤–çš„å…¶ä»–ç½‘ç»œçš„é›†æˆè¿æ¥

### å®ä¾‹é…ç½®æ–‡ä»¶

ä½¿ç”¨**è§’è‰²**æˆäºˆåœ¨**EC2 å®ä¾‹**ä¸Šè¿è¡Œçš„åº”ç”¨ç¨‹åºæƒé™éœ€è¦ä¸€äº›é¢å¤–çš„é…ç½®ã€‚åœ¨ EC2 å®ä¾‹ä¸Šè¿è¡Œçš„åº”ç”¨ç¨‹åºé€šè¿‡è™šæ‹ŸåŒ–æ“ä½œç³»ç»Ÿä¸ AWS éš”ç¦»ã€‚å› æ­¤ï¼Œéœ€è¦é¢å¤–çš„æ­¥éª¤å°† AWS è§’è‰²åŠå…¶ç›¸å…³æƒé™åˆ†é…ç»™ EC2 å®ä¾‹ï¼Œå¹¶ä½¿å…¶å¯ç”¨äºåº”ç”¨ç¨‹åºã€‚

è¿™ä¸€æ­¥æ˜¯**åˆ›å»ºä¸€ä¸ª** [_**å®ä¾‹é…ç½®æ–‡ä»¶**_](https://docs.aws.amazon.com/IAM/latest/UserGuide/id\_roles\_use\_switch-role-ec2\_instance-profiles.html) å¹¶é™„åŠ åˆ°å®ä¾‹ä¸Šã€‚**å®ä¾‹é…ç½®æ–‡ä»¶åŒ…å«è§’è‰²**ï¼Œå¹¶å¯ä»¥ä¸ºåœ¨å®ä¾‹ä¸Šè¿è¡Œçš„åº”ç”¨ç¨‹åºæä¾›è§’è‰²çš„ä¸´æ—¶å‡­è¯ã€‚è¿™äº›ä¸´æ—¶å‡­è¯å¯ä»¥åœ¨åº”ç”¨ç¨‹åºçš„ API è°ƒç”¨ä¸­ä½¿ç”¨ï¼Œä»¥è®¿é—®èµ„æºå¹¶é™åˆ¶è®¿é—®ä»…é™äºè§’è‰²æŒ‡å®šçš„èµ„æºã€‚è¯·æ³¨æ„ï¼Œ**ä¸€æ¬¡åªèƒ½ä¸ºä¸€ä¸ª EC2 å®ä¾‹åˆ†é…ä¸€ä¸ªè§’è‰²**ï¼Œå®ä¾‹ä¸Šçš„æ‰€æœ‰åº”ç”¨ç¨‹åºå…±äº«ç›¸åŒçš„è§’è‰²å’Œæƒé™ã€‚

### å…ƒæ•°æ®ç«¯ç‚¹

AWS EC2 å…ƒæ•°æ®æ˜¯å…³äº Amazon Elastic Compute Cloud (EC2) å®ä¾‹çš„ä¿¡æ¯ï¼Œåœ¨è¿è¡Œæ—¶å¯ä¾›å®ä¾‹ä½¿ç”¨ã€‚æ­¤å…ƒæ•°æ®ç”¨äºæä¾›æœ‰å…³å®ä¾‹çš„ä¿¡æ¯ï¼Œä¾‹å¦‚å…¶å®ä¾‹ IDã€è¿è¡Œæ‰€åœ¨çš„å¯ç”¨åŒºã€ä¸å®ä¾‹å…³è”çš„ IAM è§’è‰²ä»¥åŠå®ä¾‹çš„ä¸»æœºåã€‚

{% embed url="https://book.hacktricks.xyz/pentesting-web/ssrf-server-side-request-forgery/cloud-ssrf" %}

### æšä¸¾
```bash
# Get EC2 instances
aws ec2 describe-instances
aws ec2 describe-instance-status #Get status from running instances

# Get user data from each ec2 instance
for instanceid in $(aws ec2 describe-instances --profile <profile> --region us-west-2 | grep -Eo '"i-[a-zA-Z0-9]+' | tr -d '"'); do
echo "Instance ID: $instanceid"
aws ec2 describe-instance-attribute --profile <profile> --region us-west-2 --instance-id "$instanceid" --attribute userData | jq ".UserData.Value" | tr -d '"' | base64 -d
echo ""
echo "-------------------"
done

# Instance profiles
aws iam list-instance-profiles
aws iam list-instance-profiles-for-role --role-name <name>

# Get tags
aws ec2 describe-tags

# Get volumes
aws ec2 describe-volume-status
aws ec2 describe-volumes

# Get snapshots
aws ec2 describe-snapshots --owner-ids self

# Scheduled instances
aws ec2 describe-scheduled-instances

# Get custom images
aws ec2 describe-images --owners self

# Get Elastic IPs
aws ec2 describe-addresses

# Get current output
aws ec2 get-console-output --instance-id [id]

# Get VPN customer gateways
aws ec2 describe-customer-gateways
aws ec2 describe-vpn-gateways
aws ec2 describe-vpn-connections

# List conversion tasks to upload/download VMs
aws ec2 describe-conversion-tasks
aws ec2 describe-import-image-tasks

# Get Bundle Tasks
aws ec2 describe-bundle-tasks

# Get Classic Instances
aws ec2 describe-classic-link-instances

# Get Dedicated Hosts
aws ec2 describe-hosts

# Get SSH Key Pairs
aws ec2 describe-key-pairs

# Get Internet Gateways
aws ec2 describe-internet-gateways

# Get NAT Gateways
aws ec2 describe-nat-gateways

# Get subnetworks
aws ec2 describe-subnets

# Get FW rules
aws ec2 describe-network-acls

# Get security groups
aws ec2 describe-security-groups

# Get interfaces
aws ec2 describe-network-interfaces

# Get routes table
aws ec2 describe-route-tables

# Get VPCs
aws ec2 describe-vpcs
aws ec2 describe-vpc-peering-connections
```
### æœªç»èº«ä»½éªŒè¯çš„è®¿é—®

{% content-ref url="../../aws-unauthenticated-enum-access/aws-ec2-unauthenticated-enum.md" %}
[aws-ec2-unauthenticated-enum.md](../../aws-unauthenticated-enum-access/aws-ec2-unauthenticated-enum.md)
{% endcontent-ref %}

### æƒé™æå‡

åœ¨ä»¥ä¸‹é¡µé¢ä¸­ï¼Œæ‚¨å¯ä»¥æŸ¥çœ‹å¦‚ä½•**æ»¥ç”¨EC2æƒé™æ¥æå‡æƒé™**ï¼š

{% content-ref url="../../aws-privilege-escalation/aws-ec2-privesc.md" %}
[aws-ec2-privesc.md](../../aws-privilege-escalation/aws-ec2-privesc.md)
{% endcontent-ref %}

### åæœŸåˆ©ç”¨

{% content-ref url="../../aws-post-exploitation/aws-ec2-ebs-ssm-and-vpc-post-exploitation/" %}
[aws-ec2-ebs-ssm-and-vpc-post-exploitation](../../aws-post-exploitation/aws-ec2-ebs-ssm-and-vpc-post-exploitation/)
{% endcontent-ref %}

## EBS

Amazon **EBS**ï¼ˆå¼¹æ€§å—å­˜å‚¨ï¼‰**å¿«ç…§**åŸºæœ¬ä¸Šæ˜¯AWS EBSå·çš„é™æ€**å¤‡ä»½**ã€‚æ¢å¥è¯è¯´ï¼Œå®ƒä»¬æ˜¯é™„åŠ åˆ°**EC2**å®ä¾‹çš„**ç£ç›˜**åœ¨ç‰¹å®šæ—¶é—´ç‚¹çš„**å‰¯æœ¬**ã€‚EBSå¿«ç…§å¯ä»¥è·¨åŒºåŸŸå’Œè´¦æˆ·å¤åˆ¶ï¼Œç”šè‡³å¯ä»¥ä¸‹è½½å¹¶åœ¨æœ¬åœ°è¿è¡Œã€‚

å¿«ç…§å¯èƒ½åŒ…å«**æ•æ„Ÿä¿¡æ¯**ï¼Œå¦‚**æºä»£ç æˆ–APIå¯†é’¥**ï¼Œå› æ­¤ï¼Œå¦‚æœæœ‰æœºä¼šï¼Œå»ºè®®æ£€æŸ¥å®ƒã€‚

### AMIä¸EBSçš„åŒºåˆ«

**AMI**ç”¨äº**å¯åŠ¨EC2å®ä¾‹**ï¼Œè€ŒEC2**å¿«ç…§**ç”¨äº**å¤‡ä»½å’Œæ¢å¤å­˜å‚¨åœ¨EBSå·ä¸Šçš„æ•°æ®**ã€‚è™½ç„¶EC2å¿«ç…§å¯ä»¥ç”¨æ¥åˆ›å»ºæ–°çš„AMIï¼Œä½†å®ƒä¸AMIä¸åŒï¼Œä¸åŒ…æ‹¬æ“ä½œç³»ç»Ÿã€åº”ç”¨æœåŠ¡å™¨æˆ–è¿è¡Œåº”ç”¨æ‰€éœ€çš„å…¶ä»–è½¯ä»¶ä¿¡æ¯ã€‚

### æƒé™æå‡

åœ¨ä»¥ä¸‹é¡µé¢ä¸­ï¼Œæ‚¨å¯ä»¥æŸ¥çœ‹å¦‚ä½•**æ»¥ç”¨EBSæƒé™æ¥æå‡æƒé™**ï¼š

{% content-ref url="../../aws-privilege-escalation/aws-ebs-privesc.md" %}
[aws-ebs-privesc.md](../../aws-privilege-escalation/aws-ebs-privesc.md)
{% endcontent-ref %}

## SSM

**Amazon Simple Systems Manager (SSM)** å…è®¸è¿œç¨‹ç®¡ç†EC2å®ä¾‹ç¾¤ï¼Œä½¿å…¶ç®¡ç†æ›´åŠ å®¹æ˜“ã€‚æ¯ä¸ªå®ä¾‹éœ€è¦è¿è¡Œ**SSM AgentæœåŠ¡ï¼Œå› ä¸ºè¯¥æœåŠ¡å°†ä»AWS APIè·å–å¹¶æ‰§è¡Œæ“ä½œ**ã€‚

**SSM Agent**ä½¿ç³»ç»Ÿç®¡ç†å™¨èƒ½å¤Ÿæ›´æ–°ã€ç®¡ç†å’Œé…ç½®è¿™äº›èµ„æºã€‚ä»£ç†**å¤„ç†æ¥è‡ªAWSäº‘ä¸­ç³»ç»Ÿç®¡ç†å™¨æœåŠ¡çš„è¯·æ±‚**ï¼Œç„¶åæŒ‰è¯·æ±‚ä¸­æŒ‡å®šçš„æ–¹å¼è¿è¡Œå®ƒä»¬ã€‚

**SSM Agent**[**é¢„è£…åœ¨æŸäº›AMIsä¸­**](https://docs.aws.amazon.com/systems-manager/latest/userguide/ami-preinstalled-agent.html)ï¼Œæˆ–è€…æ‚¨éœ€è¦åœ¨å®ä¾‹ä¸Š[**æ‰‹åŠ¨å®‰è£…å®ƒä»¬**](https://docs.aws.amazon.com/systems-manager/latest/userguide/sysman-manual-agent-install.html)ã€‚æ­¤å¤–ï¼Œå®ä¾‹ä¸­ä½¿ç”¨çš„IAMè§’è‰²éœ€è¦é™„åŠ **AmazonEC2RoleforSSM**ç­–ç•¥æ‰èƒ½è¿›è¡Œé€šä¿¡ã€‚

### æšä¸¾
```bash
aws ssm describe-instance-information
aws ssm describe-parameters
aws ssm describe-sessions --state [Active|History]
aws ssm describe-instance-patches --instance-id <id>
aws ssm describe-instance-patch-states --instance-ids <id>
aws ssm describe-instance-associations-status --instance-id <id>
```
ä½ å¯ä»¥é€šè¿‡æ‰§è¡Œä»¥ä¸‹å‘½ä»¤æ£€æŸ¥EC2å®ä¾‹ä¸­æ˜¯å¦è¿è¡Œäº†Systems Managerï¼š
```bash
ps aux | grep amazon-ssm
```
### Privesc

åœ¨ä»¥ä¸‹é¡µé¢ä¸­ï¼Œæ‚¨å¯ä»¥æŸ¥çœ‹å¦‚ä½•**æ»¥ç”¨SSMæƒé™æ¥æå‡æƒé™**ï¼š

{% content-ref url="../../aws-privilege-escalation/aws-ssm-privesc.md" %}
[aws-ssm-privesc.md](../../aws-privilege-escalation/aws-ssm-privesc.md)
{% endcontent-ref %}

## ELB

**Elastic Load Balancing** (ELB) æ˜¯ä¸€ä¸ª**ç”¨äºAmazon Web Services** (AWS) éƒ¨ç½²çš„**è´Ÿè½½å‡è¡¡æœåŠ¡**ã€‚ELB è‡ªåŠ¨**åˆ†é…ä¼ å…¥çš„åº”ç”¨ç¨‹åºæµé‡**å¹¶æ ¹æ®æµé‡éœ€æ±‚æ‰©å±•èµ„æºã€‚

### Enumeration
```bash
# List internet-facing ELBs
aws elb describe-load-balancers
aws elb describe-load-balancers | jq '.LoadBalancerDescriptions[]| select( .Scheme | contains("internet-facing"))|.DNSName'

# DONT FORGET TO CHECK VERSION 2
aws elbv2 describe-load-balancers
aws elbv2 describe-load-balancers | jq '.LoadBalancers[].DNSName'
aws elbv2 describe-listeners --load-balancer-arn <load_balancer_arn>
```
## Launch Templates & Autoscaling Groups

### æšä¸¾

{% code overflow="wrap" %}
```bash
# Launch templates
aws ec2 describe-launch-templates
aws ec2 describe-launch-templates --launch-template-id <launch_template_id>
## Get details, like user data
aws ec2 describe-launch-template-versions --launch-template-id <launch_template_id>

# Autoscaling
aws autoscaling describe-auto-scaling-groups
aws autoscaling describe-auto-scaling-instances
aws autoscaling describe-launch-configurations
aws autoscaling describe-load-balancer-target-groups
aws autoscaling describe-load-balancers
```
{% endcode %}

## Nitro

AWS Nitro æ˜¯ä¸€å¥—**åˆ›æ–°æŠ€æœ¯**ï¼Œæ„æˆäº† AWS EC2 å®ä¾‹çš„åŸºç¡€å¹³å°ã€‚ç”± Amazon æ¨å‡ºä»¥**å¢å¼ºå®‰å…¨æ€§ã€æ€§èƒ½å’Œå¯é æ€§**ï¼ŒNitro åˆ©ç”¨å®šåˆ¶çš„**ç¡¬ä»¶ç»„ä»¶å’Œè½»é‡çº§çš„ hypervisor**ã€‚å®ƒå°†è®¸å¤šä¼ ç»Ÿçš„è™šæ‹ŸåŒ–åŠŸèƒ½æŠ½è±¡åˆ°ä¸“ç”¨çš„ç¡¬ä»¶å’Œè½¯ä»¶ä¸­ï¼Œ**æœ€å°åŒ–æ”»å‡»é¢**å¹¶æé«˜èµ„æºæ•ˆç‡ã€‚é€šè¿‡å¸è½½è™šæ‹ŸåŒ–åŠŸèƒ½ï¼ŒNitro ä½¿ EC2 å®ä¾‹èƒ½å¤Ÿæä¾›**æ¥è¿‘è£¸æœºçš„æ€§èƒ½**ï¼Œè¿™å¯¹èµ„æºå¯†é›†å‹åº”ç”¨ç¨‹åºç‰¹åˆ«æœ‰åˆ©ã€‚æ­¤å¤–ï¼ŒNitro å®‰å…¨èŠ¯ç‰‡ä¸“é—¨ç¡®ä¿**ç¡¬ä»¶å’Œå›ºä»¶çš„å®‰å…¨æ€§**ï¼Œè¿›ä¸€æ­¥å·©å›ºäº†å…¶å¼ºå¤§çš„æ¶æ„ã€‚

è·å–æ›´å¤šä¿¡æ¯åŠå¦‚ä½•æšä¸¾å®ƒï¼š

{% content-ref url="aws-nitro-enum.md" %}
[aws-nitro-enum.md](aws-nitro-enum.md)
{% endcontent-ref %}

## VPN

VPN å…è®¸å°†æ‚¨çš„**æœ¬åœ°ç½‘ç»œï¼ˆç«™ç‚¹åˆ°ç«™ç‚¹ VPNï¼‰**æˆ–**å‘˜å·¥çš„ç¬”è®°æœ¬ç”µè„‘ï¼ˆå®¢æˆ·ç«¯ VPNï¼‰**ä¸**AWS VPC**è¿æ¥ï¼Œä»¥ä¾¿æ— éœ€å°†æœåŠ¡æš´éœ²åœ¨äº’è”ç½‘ä¸Šå³å¯è®¿é—®å®ƒä»¬ã€‚

#### åŸºæœ¬çš„ AWS VPN ç»„ä»¶

1. **Customer Gateway**:
* Customer Gateway æ˜¯æ‚¨åœ¨ AWS ä¸­åˆ›å»ºçš„èµ„æºï¼Œç”¨äºè¡¨ç¤º VPN è¿æ¥çš„æ‚¨è¿™ä¸€ä¾§ã€‚
* å®ƒæœ¬è´¨ä¸Šæ˜¯æ‚¨ç«™ç‚¹åˆ°ç«™ç‚¹ VPN è¿æ¥è¿™ä¸€ä¾§çš„ç‰©ç†è®¾å¤‡æˆ–è½¯ä»¶åº”ç”¨ç¨‹åºã€‚
* æ‚¨å‘ AWS æä¾›è·¯ç”±ä¿¡æ¯å’Œç½‘ç»œè®¾å¤‡ï¼ˆå¦‚è·¯ç”±å™¨æˆ–é˜²ç«å¢™ï¼‰çš„å…¬å…± IP åœ°å€ï¼Œä»¥åˆ›å»º Customer Gatewayã€‚
* å®ƒä½œä¸ºè®¾ç½® VPN è¿æ¥çš„å‚è€ƒç‚¹ï¼Œä¸ä¼šäº§ç”Ÿé¢å¤–è´¹ç”¨ã€‚
2. **Virtual Private Gateway**:
* Virtual Private Gateway (VPG) æ˜¯ç«™ç‚¹åˆ°ç«™ç‚¹ VPN è¿æ¥ä¸­ Amazon è¿™ä¸€ä¾§çš„ VPN é›†ä¸­å™¨ã€‚
* å®ƒé™„åŠ åˆ°æ‚¨çš„ VPCï¼Œå¹¶ä½œä¸ºæ‚¨çš„ VPN è¿æ¥çš„ç›®æ ‡ã€‚
* VPG æ˜¯ VPN è¿æ¥ä¸­ AWS è¿™ä¸€ä¾§çš„ç«¯ç‚¹ã€‚
* å®ƒå¤„ç†æ‚¨çš„ VPC å’Œæœ¬åœ°ç½‘ç»œä¹‹é—´çš„å®‰å…¨é€šä¿¡ã€‚
3. **Site-to-Site VPN Connection**:
* Site-to-Site VPN è¿æ¥é€šè¿‡å®‰å…¨çš„ IPsec VPN éš§é“å°†æ‚¨çš„æœ¬åœ°ç½‘ç»œè¿æ¥åˆ° VPCã€‚
* è¿™ç§ç±»å‹çš„è¿æ¥éœ€è¦ Customer Gateway å’Œ Virtual Private Gatewayã€‚
* å®ƒç”¨äºæ‚¨çš„æ•°æ®ä¸­å¿ƒæˆ–ç½‘ç»œä¸ AWS ç¯å¢ƒä¹‹é—´çš„å®‰å…¨ã€ç¨³å®šå’Œä¸€è‡´çš„é€šä¿¡ã€‚
* é€šå¸¸ç”¨äºå¸¸è§„çš„ã€é•¿æœŸçš„è¿æ¥ï¼Œå¹¶æ ¹æ®é€šè¿‡è¿æ¥ä¼ è¾“çš„æ•°æ®é‡è®¡è´¹ã€‚
4. **Client VPN Endpoint**:
* Client VPN endpoint æ˜¯æ‚¨åœ¨ AWS ä¸­åˆ›å»ºçš„èµ„æºï¼Œç”¨äºå¯ç”¨å’Œç®¡ç†å®¢æˆ·ç«¯ VPN ä¼šè¯ã€‚
* å®ƒç”¨äºå…è®¸å•ä¸ªè®¾å¤‡ï¼ˆå¦‚ç¬”è®°æœ¬ç”µè„‘ã€æ™ºèƒ½æ‰‹æœºç­‰ï¼‰å®‰å…¨è¿æ¥åˆ° AWS èµ„æºæˆ–æ‚¨çš„æœ¬åœ°ç½‘ç»œã€‚
* å®ƒä¸ç«™ç‚¹åˆ°ç«™ç‚¹ VPN ä¸åŒï¼Œè®¾è®¡ç”¨äºå•ä¸ªå®¢æˆ·ç«¯è€Œä¸æ˜¯è¿æ¥æ•´ä¸ªç½‘ç»œã€‚
* ä½¿ç”¨ Client VPNï¼Œæ¯ä¸ªå®¢æˆ·ç«¯è®¾å¤‡ä½¿ç”¨ VPN å®¢æˆ·ç«¯è½¯ä»¶å»ºç«‹å®‰å…¨è¿æ¥ã€‚

æ‚¨å¯ä»¥[**åœ¨è¿™é‡Œæ‰¾åˆ°æœ‰å…³ AWS VPN çš„å¥½å¤„å’Œç»„ä»¶çš„æ›´å¤šä¿¡æ¯**](aws-vpc-and-networking-basic-information.md#vpn)ã€‚

### Enumeration
```bash
# VPN endpoints
## Check used subnetwork, authentication, SGs, connected...
aws ec2 describe-client-vpn-endpoints

## Get AWS network info related to the vpn endpoint
aws ec2 describe-client-vpn-target-networks --client-vpn-endpoint-id <id>

## Get AWS subnet & ip range the VPN iconnected to
aws ec2 describe-client-vpn-routes --client-vpn-endpoint-id <id>

## Check authorization rules
aws ec2 describe-client-vpn-authorization-rules --client-vpn-endpoint-id <id>

## Get current connections to the VPN endpoint
aws ec2 describe-client-vpn-connections --client-vpn-endpoint-id <id>

# Get VPN gateways and check with which VPC each is connected
aws ec2 describe-vpn-gateways

# Get VPN site-to-site connections
aws ec2 describe-vpn-connections
```
### æœ¬åœ°æšä¸¾

**æœ¬åœ°ä¸´æ—¶å‡­è¯**

å½“ä½¿ç”¨ AWS VPN Client è¿æ¥åˆ° VPN æ—¶ï¼Œç”¨æˆ·é€šå¸¸ä¼š**ç™»å½• AWS**ä»¥è·å– VPN è®¿é—®æƒé™ã€‚ç„¶åï¼Œä¸€äº›**AWS å‡­è¯ä¼šè¢«åˆ›å»ºå¹¶å­˜å‚¨**åœ¨æœ¬åœ°ä»¥å»ºç«‹ VPN è¿æ¥ã€‚è¿™äº›å‡­è¯**å­˜å‚¨åœ¨** `$HOME/.config/AWSVPNClient/TemporaryCredentials/<region>/temporary-credentials.txt`ï¼ŒåŒ…å«ä¸€ä¸ª**AccessKey**ã€ä¸€ä¸ª**SecretKey**å’Œä¸€ä¸ª**Token**ã€‚

è¿™äº›å‡­è¯å±äºç”¨æˆ· `arn:aws:sts::<acc-id>:assumed-role/aws-vpn-client-metrics-analytics-access-role/CognitoIdentityCredentials`ï¼ˆTODOï¼šç ”ç©¶æ›´å¤šå…³äºè¿™äº›å‡­è¯çš„æƒé™ï¼‰ã€‚

**opvn é…ç½®æ–‡ä»¶**

å¦‚æœ**VPN è¿æ¥å·²å»ºç«‹**ï¼Œä½ åº”è¯¥åœ¨ç³»ç»Ÿä¸­æœç´¢**`.opvn`**é…ç½®æ–‡ä»¶ã€‚æ­¤å¤–ï¼Œä½ å¯ä»¥åœ¨**`$HOME/.config/AWSVPNClient/OpenVpnConfigs`**æ‰¾åˆ°**é…ç½®**ã€‚

#### **åæœŸåˆ©ç”¨**

{% content-ref url="../../aws-post-exploitation/aws-vpn-post-exploitation.md" %}
[aws-vpn-post-exploitation.md](../../aws-post-exploitation/aws-vpn-post-exploitation.md)
{% endcontent-ref %}

## å‚è€ƒèµ„æ–™

* [https://docs.aws.amazon.com/batch/latest/userguide/getting-started-ec2.html](https://docs.aws.amazon.com/batch/latest/userguide/getting-started-ec2.html)

{% hint style="success" %}
å­¦ä¹ å’Œå®è·µ AWS Hackingï¼š<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
å­¦ä¹ å’Œå®è·µ GCP Hackingï¼š<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>æ”¯æŒ HackTricks</summary>

* æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)ï¼
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**telegram ç¾¤ç»„**](https://t.me/peass) æˆ–åœ¨ **Twitter** ğŸ¦ ä¸Š**å…³æ³¨**æˆ‘ä»¬ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**ã€‚**
* **é€šè¿‡æäº¤ PR åˆ†äº«é»‘å®¢æŠ€å·§åˆ°** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ä»“åº“ã€‚

</details>
{% endhint %}
