# AWS - Lambda Enum

{% hint style="success" %}
AWS Hacking Ã¶ÄŸrenin ve pratik yapÄ±n:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCP Hacking Ã¶ÄŸrenin ve pratik yapÄ±n: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**abonelik planlarÄ±nÄ±**](https://github.com/sponsors/carlospolop) kontrol edin!
* **ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n veya bizi **Twitter**'da takip edin ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **HackTricks'e PR gÃ¶ndererek hacking ipuÃ§larÄ±nÄ± paylaÅŸÄ±n** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na.

</details>
{% endhint %}

## Lambda

Amazon Web Services (AWS) Lambda, **sunucu saÄŸlama veya yÃ¶netme gereksinimi olmadan kod Ã§alÄ±ÅŸtÄ±rmayÄ±** saÄŸlayan bir **hesaplama hizmeti** olarak tanÄ±mlanÄ±r. Kod Ã§alÄ±ÅŸtÄ±rmak iÃ§in gereken kaynak tahsisini **otomatik olarak yÃ¶netme** yeteneÄŸi ile karakterize edilir ve yÃ¼ksek kullanÄ±labilirlik, Ã¶lÃ§eklenebilirlik ve gÃ¼venlik gibi Ã¶zellikleri saÄŸlar. Lambda'nÄ±n Ã¶nemli bir yÃ¶nÃ¼, **yalnÄ±zca kullanÄ±lan hesaplama sÃ¼resine gÃ¶re Ã¼cretlendirilmesi**, baÅŸlangÄ±Ã§ yatÄ±rÄ±mlarÄ± veya uzun vadeli taahhÃ¼tler gerektirmemesidir.

Bir lambda'yÄ± Ã§aÄŸÄ±rmak iÃ§in **istediÄŸiniz sÄ±klÄ±kta** (Cloudwatch ile) Ã§aÄŸÄ±rabilir, bir **URL** uÃ§ noktasÄ± aÃ§abilir ve Ã§aÄŸÄ±rabilir, **API Gateway** Ã¼zerinden Ã§aÄŸÄ±rabilir veya **S3** kovasÄ±nda veri deÄŸiÅŸiklikleri veya **DynamoDB** tablosundaki gÃ¼ncellemeler gibi **olaylara** dayalÄ± olarak Ã§aÄŸÄ±rabilirsiniz.

Bir lambda'nÄ±n **kodu** **`/var/task`** iÃ§inde saklanÄ±r.

### Lambda Aliases Weights

Bir Lambda'nÄ±n **birden fazla versiyonu** olabilir.\
Ve **birden fazla** versiyon **aliases** aracÄ±lÄ±ÄŸÄ±yla aÃ§Ä±ÄŸa Ã§Ä±kabilir. **Aliases** iÃ§indeki **her** bir versiyonun **aÄŸÄ±rlÄ±klarÄ±**, **hangi alias'Ä±n Ã§aÄŸrÄ±yÄ± alacaÄŸÄ±nÄ±** belirler (Ã¶rneÄŸin %90-%10 olabilir).\
**Aliases**'lardan birinin kodu **savunmasÄ±z** ise, **savunmasÄ±z** versiyonun **exploit** alana kadar **istekler gÃ¶nderebilirsiniz**.

![](<../../../.gitbook/assets/image (223).png>)

### Resource Policies

Lambda kaynak politikalarÄ±, Ã¶rneÄŸin **diÄŸer hizmetlerin/hesaplarÄ±n lambda'yÄ± Ã§aÄŸÄ±rmasÄ±na izin vermek** iÃ§in kullanÄ±lÄ±r.\
Ã–rneÄŸin, **URL Ã¼zerinden aÃ§Ä±ÄŸa Ã§Ä±kan bir lambda'ya herkesin eriÅŸmesine izin veren** politika ÅŸu ÅŸekildedir:

<figure><img src="https://lh4.googleusercontent.com/4PNFKBdzr3nMrPqeKkTslgwWDKxkXMdQ1SNdv7NPHykj3GX8wODrQyXOFbjk4fxHfZ8pDm5ijWgk2Vq2EGXiPRT3TQfZf1fHycvdEKBuDxJDYos1CJeMHXSeg86ZB-Ol7CNtten6xkVFQj6AhDUEWNQJrQ=s2048" alt=""><figcaption></figcaption></figure>

Veya bir API Gateway'in Ã§aÄŸÄ±rmasÄ±na izin vermek iÃ§in ÅŸu ÅŸekildedir:

<figure><img src="https://lh3.googleusercontent.com/Su0JlR0wBqb-99Z4N_2-_kMlX0Xzx2n_GpZuOPW5IeXR3FYbm8OHFDM3Ora1BpXiSjHpDVUlq4yEyXwaI3nBuze6DJ-wRf2ATsCuWbq0wuBCd34E9uIpqwheE6Cc_PopviI_93O_j2ZKXc1-AJtsBoLVUw=s2048" alt=""><figcaption></figcaption></figure>

### Lambda Database Proxies

**YÃ¼zlerce** **eÅŸzamanlÄ± lambda isteÄŸi** olduÄŸunda, her birinin **bir veritabanÄ±na baÄŸlanmasÄ± ve baÄŸlantÄ±yÄ± kapatmasÄ±** gerekiyorsa, bu iÅŸe yaramaz (lambdalar durumsuzdur, aÃ§Ä±k baÄŸlantÄ±larÄ± sÃ¼rdÃ¼remez).\
Bu durumda, **Lambda fonksiyonlarÄ±nÄ±z veritabanÄ± Ã¶rneÄŸiniz yerine RDS Proxy ile etkileÅŸime girerse**. Bu, eÅŸzamanlÄ± Lambda fonksiyonlarÄ± tarafÄ±ndan oluÅŸturulan birÃ§ok eÅŸzamanlÄ± baÄŸlantÄ±yÄ± Ã¶lÃ§eklendirmek iÃ§in gerekli baÄŸlantÄ± havuzlamasÄ±nÄ± yÃ¶netir. Bu, Lambda uygulamalarÄ±nÄ±zÄ±n **mevcut baÄŸlantÄ±larÄ± yeniden kullanmasÄ±na** olanak tanÄ±r, her fonksiyon Ã§aÄŸrÄ±sÄ± iÃ§in yeni baÄŸlantÄ±lar oluÅŸturmaktan ziyade.

### Lambda EFS Filesystems

Verileri korumak ve hatta paylaÅŸmak iÃ§in **Lambdalar EFS'ye eriÅŸebilir ve onlarÄ± monte edebilir**, bÃ¶ylece Lambda ondan okuyabilir ve yazabilir.

### Lambda Layers

Bir Lambda _katmanÄ±_, **ek kod** veya baÅŸka iÃ§erik iÃ§erebilen bir .zip dosya arÅŸividir. Bir katman, kÃ¼tÃ¼phaneler, bir [Ã¶zel Ã§alÄ±ÅŸma zamanÄ±](https://docs.aws.amazon.com/lambda/latest/dg/runtimes-custom.html), veri veya yapÄ±landÄ±rma dosyalarÄ± iÃ§erebilir.

Bir fonksiyon baÅŸÄ±na **beÅŸ katmana kadar** dahil etmek mÃ¼mkÃ¼ndÃ¼r. Bir fonksiyona bir katman eklediÄŸinizde, **iÃ§erikler Ã§alÄ±ÅŸma ortamÄ±ndaki `/opt`** dizinine Ã§Ä±karÄ±lÄ±r.

**VarsayÄ±lan olarak**, oluÅŸturduÄŸunuz **katmanlar** AWS hesabÄ±nÄ±za **Ã¶zeldir**. Bir katmanÄ± diÄŸer hesaplarla **paylaÅŸmayÄ±** veya katmanÄ± **genel** yapmayÄ± seÃ§ebilirsiniz. FonksiyonlarÄ±nÄ±z, farklÄ± bir hesabÄ±n yayÄ±nladÄ±ÄŸÄ± bir katmanÄ± tÃ¼ketiyorsa, katman sÃ¼rÃ¼mÃ¼ silindikten veya katmana eriÅŸim izniniz iptal edildikten sonra bile fonksiyonlarÄ±nÄ±z katman sÃ¼rÃ¼mÃ¼nÃ¼ **kullanmaya devam edebilir**. Ancak, silinmiÅŸ bir katman sÃ¼rÃ¼mÃ¼nÃ¼ kullanarak yeni bir fonksiyon oluÅŸturamaz veya fonksiyonlarÄ± gÃ¼ncelleyemezsiniz.

Bir konteyner gÃ¶rÃ¼ntÃ¼sÃ¼ olarak daÄŸÄ±tÄ±lan fonksiyonlar katmanlarÄ± kullanmaz. Bunun yerine, tercih ettiÄŸiniz Ã§alÄ±ÅŸma zamanÄ±nÄ±, kÃ¼tÃ¼phaneleri ve diÄŸer baÄŸÄ±mlÄ±lÄ±klarÄ± konteyner gÃ¶rÃ¼ntÃ¼sÃ¼nÃ¼ oluÅŸtururken paketlersiniz.

### Lambda Extensions

Lambda uzantÄ±larÄ±, fonksiyonlarÄ± Ã§eÅŸitli **izleme, gÃ¶zlemlenebilirlik, gÃ¼venlik ve yÃ¶netim araÃ§larÄ±yla** entegre ederek geliÅŸtirir. Bu uzantÄ±lar, [.zip arÅŸivleri kullanarak Lambda katmanlarÄ±](https://docs.aws.amazon.com/lambda/latest/dg/configuration-layers.html) veya [konteyner gÃ¶rÃ¼ntÃ¼ daÄŸÄ±tÄ±mlarÄ±](https://aws.amazon.com/blogs/compute/working-with-lambda-layers-and-extensions-in-container-images/) aracÄ±lÄ±ÄŸÄ±yla eklenir ve iki modda Ã§alÄ±ÅŸÄ±r: **dahili** ve **harici**.

* **Dahili uzantÄ±lar**, Ã§alÄ±ÅŸma zamanÄ± sÃ¼recine birleÅŸir, **dil-spesifik ortam deÄŸiÅŸkenleri** ve **sarmalayÄ±cÄ± betikler** kullanarak baÅŸlatma sÃ¼recini manipÃ¼le eder. Bu Ã¶zelleÅŸtirme, **Java Correto 8 ve 11, Node.js 10 ve 12, ve .NET Core 3.1** gibi Ã§eÅŸitli Ã§alÄ±ÅŸma zamanlarÄ±na uygulanÄ±r.
* **Harici uzantÄ±lar**, Lambda fonksiyonunun yaÅŸam dÃ¶ngÃ¼sÃ¼ ile uyumlu olarak ayrÄ± sÃ¼reÃ§ler olarak Ã§alÄ±ÅŸÄ±r. **Node.js 10 ve 12, Python 3.7 ve 3.8, Ruby 2.5 ve 2.7, Java Corretto 8 ve 11, .NET Core 3.1** ve **Ã¶zel Ã§alÄ±ÅŸma zamanlarÄ±** gibi Ã§eÅŸitli Ã§alÄ±ÅŸma zamanlarÄ±yla uyumludur.

### Enumeration
```bash
aws lambda get-account-settings

# List functions and get extra config info
aws lambda list-functions
aws lambda get-function --function-name <function_name>
aws lambda get-function-configuration --function-name <function_name>
aws lambda list-function-event-invoke-configs --function-name <function_name>
## Check for creds in env vars
aws lambda list-functions | jq '.Functions[].Environment'
## Download & check the source code
aws lambda get-function --function-name "<func_name>" --query 'Code.Location'
wget -O lambda-function.zip <url-from-previous-query>

# Get Lambda URL (if any)
aws lambda list-function-url-configs --function-name <function_name>
aws lambda get-function-url-config --function-name <function_name>

# Get who has permissions to invoke the Lambda
aws lambda get-policy --function-name <function_name>

# Versions and Aliases
aws lambda list-versions-by-function --function-name <func_name>
aws lambda list-aliases --function-name <func_name>

# List layers
aws lambda list-layers
aws lambda list-layer-versions --layer-name <name>
aws lambda get-layer-version --layer-name <name> --version-number <ver>
aws lambda get-layer-version-by-arn --arn <name> #Get external ARNs

# List other metadata
aws lambda list-event-source-mappings
aws lambda list-code-signing-configs
aws lambda list-functions-by-code-signing-config --code-signing-config-arn <arn>
```
### Bir lambda Ã§aÄŸÄ±r

#### Manuel
```bash
# Invoke function
aws lambda invoke --function-name FUNCTION_NAME /tmp/out
## Some functions will expect parameters, they will access them with something like:
## target_policys = event['policy_names']
## user_name = event['user_name']
aws lambda invoke --function-name <name> --cli-binary-format raw-in-base64-out --payload '{"policy_names": ["AdministratorAccess], "user_name": "sdf"}' out.txt
```
#### Exposed URL Ãœzerinden

AWS Lambda iÅŸlevleri, genellikle bir URL aracÄ±lÄ±ÄŸÄ±yla tetiklenir. Bu URL'ler, iÅŸlevin tetiklenmesi iÃ§in kullanÄ±labilir ve bazen yanlÄ±ÅŸ yapÄ±landÄ±rÄ±lmÄ±ÅŸ olabilir. Bu URL'leri keÅŸfetmek ve test etmek iÃ§in aÅŸaÄŸÄ±daki adÄ±mlarÄ± izleyebilirsiniz:

1. **URL'yi KeÅŸfetme**: AWS Lambda iÅŸlevlerinin URL'lerini keÅŸfetmek iÃ§in Ã§eÅŸitli araÃ§lar ve teknikler kullanabilirsiniz. Bu URL'ler genellikle API Gateway veya baÅŸka bir hizmet aracÄ±lÄ±ÄŸÄ±yla sunulur.
2. **URL'yi Test Etme**: KeÅŸfettiÄŸiniz URL'leri test ederek, iÅŸlevin nasÄ±l Ã§alÄ±ÅŸtÄ±ÄŸÄ±nÄ± ve hangi verileri dÃ¶ndÃ¼rdÃ¼ÄŸÃ¼nÃ¼ anlayabilirsiniz. Bu, iÅŸlevin gÃ¼venliÄŸini deÄŸerlendirmek iÃ§in Ã¶nemlidir.
3. **YanÄ±tlarÄ± Analiz Etme**: Ä°ÅŸlevin yanÄ±tlarÄ±nÄ± analiz ederek, potansiyel gÃ¼venlik aÃ§Ä±klarÄ±nÄ± ve yanlÄ±ÅŸ yapÄ±landÄ±rmalarÄ± tespit edebilirsiniz.

Bu adÄ±mlarÄ± izleyerek, AWS Lambda iÅŸlevlerinin gÃ¼venliÄŸini deÄŸerlendirebilir ve potansiyel gÃ¼venlik aÃ§Ä±klarÄ±nÄ± tespit edebilirsiniz.
```bash
aws lambda list-function-url-configs --function-name <function_name> #Get lambda URL
aws lambda get-function-url-config   --function-name <function_name> #Get lambda URL
```
#### URL ile Lambda fonksiyonunu Ã§aÄŸÄ±rma

Åimdi Ã§alÄ±ÅŸtÄ±rÄ±labilecek olasÄ± lambda fonksiyonlarÄ±nÄ± bulma zamanÄ±:
```
aws --region us-west-2 --profile level6 lambda list-functions
```
![](<../../../.gitbook/assets/image (262).png>)

"Level6" adlÄ± bir lambda fonksiyonu mevcut. NasÄ±l Ã§aÄŸrÄ±lacaÄŸÄ±nÄ± bulalÄ±m:
```bash
aws --region us-west-2 --profile level6 lambda get-policy --function-name Level6
```
![](<../../../.gitbook/assets/image (102).png>)

ArtÄ±k adÄ± ve kimliÄŸi bildiÄŸinize gÃ¶re, AdÄ± alabilirsiniz:
```bash
aws --profile level6 --region us-west-2 apigateway get-stages --rest-api-id "s33ppypa75"
```
![](<../../../.gitbook/assets/image (237).png>)

Ve son olarak fonksiyonu Ã§aÄŸÄ±rarak eriÅŸin (URL'de ID, Name ve function-name'in gÃ¶rÃ¼ndÃ¼ÄŸÃ¼ne dikkat edin): [https://s33ppypa75.execute-api.us-west-2.amazonaws.com/Prod/level6](https://s33ppypa75.execute-api.us-west-2.amazonaws.com/Prod/level6)

`URL:`**`https://<rest-api-id>.execute-api.<region>.amazonaws.com/<stageName>/<funcName>`**

#### DiÄŸer Tetikleyiciler

Bir lambda'yÄ± tetikleyebilecek birÃ§ok baÅŸka kaynak vardÄ±r

<figure><img src="../../../.gitbook/assets/image (167).png" alt=""><figcaption></figcaption></figure>

### Privesc

AÅŸaÄŸÄ±daki sayfada **Lambda izinlerini kÃ¶tÃ¼ye kullanarak ayrÄ±calÄ±klarÄ± yÃ¼kseltme** yÃ¶ntemlerini kontrol edebilirsiniz:

{% content-ref url="../aws-privilege-escalation/aws-lambda-privesc.md" %}
[aws-lambda-privesc.md](../aws-privilege-escalation/aws-lambda-privesc.md)
{% endcontent-ref %}

### Kimlik DoÄŸrulamasÄ± Olmayan EriÅŸim

{% content-ref url="../aws-unauthenticated-enum-access/aws-lambda-unauthenticated-access.md" %}
[aws-lambda-unauthenticated-access.md](../aws-unauthenticated-enum-access/aws-lambda-unauthenticated-access.md)
{% endcontent-ref %}

### SÃ¶mÃ¼rÃ¼ SonrasÄ±

{% content-ref url="../aws-post-exploitation/aws-lambda-post-exploitation/" %}
[aws-lambda-post-exploitation](../aws-post-exploitation/aws-lambda-post-exploitation/)
{% endcontent-ref %}

### KalÄ±cÄ±lÄ±k

{% content-ref url="../aws-persistence/aws-lambda-persistence/" %}
[aws-lambda-persistence](../aws-persistence/aws-lambda-persistence/)
{% endcontent-ref %}

## Referanslar

* [https://docs.aws.amazon.com/lambda/latest/dg/gettingstarted-concepts.html#gettingstarted-concepts-layer](https://docs.aws.amazon.com/lambda/latest/dg/gettingstarted-concepts.html#gettingstarted-concepts-layer)
* [https://aws.amazon.com/blogs/compute/building-extensions-for-aws-lambda-in-preview/](https://aws.amazon.com/blogs/compute/building-extensions-for-aws-lambda-in-preview/)

{% hint style="success" %}
AWS Hacking Ã¶ÄŸrenin ve pratik yapÄ±n:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCP Hacking Ã¶ÄŸrenin ve pratik yapÄ±n: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**abonelik planlarÄ±nÄ±**](https://github.com/sponsors/carlospolop) kontrol edin!
* **ğŸ’¬ Discord grubuna** [**katÄ±lÄ±n**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n ya da **Twitter'da** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks_live) **bizi takip edin.**
* **HackTricks'e** [**PR gÃ¶ndererek**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na katkÄ±da bulunarak **hacking ipuÃ§larÄ±nÄ± paylaÅŸÄ±n.**

</details>
{% endhint %}
