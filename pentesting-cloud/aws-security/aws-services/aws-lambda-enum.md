# AWS - Lambda Enum

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Lambda

Amazon Web Services (AWS) Lambda ã¯ã€ã‚µãƒ¼ãƒãƒ¼ã®ãƒ—ãƒ­ãƒ“ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°ã‚„ç®¡ç†ã®å¿…è¦ãªãã‚³ãƒ¼ãƒ‰ã‚’å®Ÿè¡Œã§ãã‚‹ **ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ãƒˆã‚µãƒ¼ãƒ“ã‚¹** ã¨ã—ã¦èª¬æ˜ã•ã‚Œã¦ã„ã¾ã™ã€‚ã“ã‚Œã¯ã€ã‚³ãƒ¼ãƒ‰å®Ÿè¡Œã«å¿…è¦ãªãƒªã‚½ãƒ¼ã‚¹ã®å‰²ã‚Šå½“ã¦ã‚’ **è‡ªå‹•çš„ã«å‡¦ç†** ã—ã€é«˜å¯ç”¨æ€§ã€ã‚¹ã‚±ãƒ¼ãƒ©ãƒ“ãƒªãƒ†ã‚£ã€ãŠã‚ˆã³ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãªã©ã®æ©Ÿèƒ½ã‚’ç¢ºä¿ã™ã‚‹ã“ã¨ãŒç‰¹å¾´ã§ã™ã€‚Lambda ã®é‡è¦ãªå´é¢ã¯ã€ãã®ä¾¡æ ¼ãƒ¢ãƒ‡ãƒ«ã§ã‚ã‚Šã€**ä½¿ç”¨ã—ãŸã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ãƒˆæ™‚é–“ã«åŸºã¥ã„ã¦ã®ã¿èª²é‡‘** ã•ã‚Œã€åˆæœŸæŠ•è³‡ã‚„é•·æœŸçš„ãªç¾©å‹™ãŒä¸è¦ã§ã™ã€‚

Lambda ã‚’å‘¼ã³å‡ºã™ã«ã¯ã€**å¥½ããªã ã‘é »ç¹ã«**ï¼ˆCloudwatch ã‚’ä½¿ç”¨ã—ã¦ï¼‰å‘¼ã³å‡ºã™ã“ã¨ãŒå¯èƒ½ã§ã‚ã‚Šã€**URL** ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’å…¬é–‹ã—ã¦å‘¼ã³å‡ºã—ãŸã‚Šã€**API Gateway** çµŒç”±ã§å‘¼ã³å‡ºã—ãŸã‚Šã€**S3** ãƒã‚±ãƒƒãƒˆã®ãƒ‡ãƒ¼ã‚¿ã® **å¤‰æ›´** ã‚„ **DynamoDB** ãƒ†ãƒ¼ãƒ–ãƒ«ã®æ›´æ–°ãªã©ã® **ã‚¤ãƒ™ãƒ³ãƒˆ** ã«åŸºã¥ã„ã¦å‘¼ã³å‡ºã™ã“ã¨ãŒã§ãã¾ã™ã€‚

Lambda ã® **ã‚³ãƒ¼ãƒ‰** ã¯ **`/var/task`** ã«ä¿å­˜ã•ã‚Œã¾ã™ã€‚

### Lambda Aliases Weights

Lambda ã«ã¯ **è¤‡æ•°ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³** ãŒå­˜åœ¨ã™ã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚\
ã¾ãŸã€**ã‚¨ã‚¤ãƒªã‚¢ã‚¹** ã‚’ä»‹ã—ã¦ **è¤‡æ•°ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³** ã‚’å…¬é–‹ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ã‚¨ã‚¤ãƒªã‚¢ã‚¹å†…ã§å…¬é–‹ã•ã‚Œã¦ã„ã‚‹ **å„ãƒãƒ¼ã‚¸ãƒ§ãƒ³** ã® **é‡ã¿** ã«ã‚ˆã£ã¦ã€**ã©ã®ã‚¨ã‚¤ãƒªã‚¢ã‚¹ãŒå‘¼ã³å‡ºã—ã‚’å—ã‘ã‚‹ã‹** ãŒæ±ºã¾ã‚Šã¾ã™ï¼ˆä¾‹ãˆã°ã€90%-10% ãªã©ï¼‰ã€‚\
ã‚¨ã‚¤ãƒªã‚¢ã‚¹ã® **1ã¤** ã®ã‚³ãƒ¼ãƒ‰ãŒ **è„†å¼±** ã§ã‚ã‚‹å ´åˆã€**è„†å¼±ãª** ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒã‚¨ã‚¯ã‚¹ãƒ—ãƒ­ã‚¤ãƒˆã‚’å—ã‘å–ã‚‹ã¾ã§ **ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡** ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

![](<../../../.gitbook/assets/image (223).png>)

### Resource Policies

Lambda ãƒªã‚½ãƒ¼ã‚¹ãƒãƒªã‚·ãƒ¼ã¯ã€ä»–ã®ã‚µãƒ¼ãƒ“ã‚¹/ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã« Lambda ã‚’å‘¼ã³å‡ºã™ã‚¢ã‚¯ã‚»ã‚¹æ¨©ã‚’ä¸ãˆã‚‹ã“ã¨ã‚’å¯èƒ½ã«ã—ã¾ã™ã€‚\
ä¾‹ãˆã°ã€**URL ã‚’ä»‹ã—ã¦å…¬é–‹ã•ã‚ŒãŸ Lambda ã«èª°ã§ã‚‚ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹** ãƒãƒªã‚·ãƒ¼ã¯æ¬¡ã®ã¨ãŠã‚Šã§ã™ï¼š

<figure><img src="https://lh4.googleusercontent.com/4PNFKBdzr3nMrPqeKkTslgwWDKxkXMdQ1SNdv7NPHykj3GX8wODrQyXOFbjk4fxHfZ8pDm5ijWgk2Vq2EGXiPRT3TQfZf1fHycvdEKBuDxJDYos1CJeMHXSeg86ZB-Ol7CNtten6xkVFQj6AhDUEWNQJrQ=s2048" alt=""><figcaption></figcaption></figure>

ã¾ãŸã€API Gateway ãŒãã‚Œã‚’å‘¼ã³å‡ºã™ã“ã¨ã‚’è¨±å¯ã™ã‚‹ãƒãƒªã‚·ãƒ¼ã¯æ¬¡ã®ã¨ãŠã‚Šã§ã™ï¼š

<figure><img src="https://lh3.googleusercontent.com/Su0JlR0wBqb-99Z4N_2-_kMlX0Xzx2n_GpZuOPW5IeXR3FYbm8OHFDM3Ora1BpXiSjHpDVUlq4yEyXwaI3nBuze6DJ-wRf2ATsCuWbq0wuBCd34E9uIpqwheE6Cc_PopviI_93O_j2ZKXc1-AJtsBoLVUw=s2048" alt=""><figcaption></figcaption></figure>

### Lambda Database Proxies

**æ•°ç™¾** ã® **åŒæ™‚ Lambda ãƒªã‚¯ã‚¨ã‚¹ãƒˆ** ãŒã‚ã‚‹å ´åˆã€ãã‚Œãã‚ŒãŒ **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«æ¥ç¶šã—ã¦æ¥ç¶šã‚’é–‰ã˜ã‚‹** å¿…è¦ãŒã‚ã‚‹ã¨ã€ã†ã¾ãæ©Ÿèƒ½ã—ã¾ã›ã‚“ï¼ˆLambda ã¯ã‚¹ãƒ†ãƒ¼ãƒˆãƒ¬ã‚¹ã§ã‚ã‚Šã€æ¥ç¶šã‚’ç¶­æŒã§ãã¾ã›ã‚“ï¼‰ã€‚\
ãã®ãŸã‚ã€**Lambda é–¢æ•°ãŒãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã§ã¯ãªã RDS Proxy ã¨å¯¾è©±ã™ã‚‹** å ´åˆã€å¤šãã®åŒæ™‚æ¥ç¶šã‚’ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°ã™ã‚‹ãŸã‚ã«å¿…è¦ãªæ¥ç¶šãƒ—ãƒ¼ãƒªãƒ³ã‚°ã‚’å‡¦ç†ã—ã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€Lambda ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¯ **æ—¢å­˜ã®æ¥ç¶šã‚’å†åˆ©ç”¨** ã§ãã€æ–°ã—ã„æ¥ç¶šã‚’ä½œæˆã™ã‚‹å¿…è¦ãŒãªããªã‚Šã¾ã™ã€‚

### Lambda EFS Filesystems

ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜ãŠã‚ˆã³å…±æœ‰ã™ã‚‹ãŸã‚ã«ã€**Lambda ã¯ EFS ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ãƒã‚¦ãƒ³ãƒˆ** ã™ã‚‹ã“ã¨ãŒã§ãã€Lambda ã¯ãã‚Œã‚’èª­ã¿æ›¸ãã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

### Lambda Layers

Lambda _ãƒ¬ã‚¤ãƒ¤ãƒ¼_ ã¯ã€**è¿½åŠ ã®ã‚³ãƒ¼ãƒ‰** ã‚„ãã®ä»–ã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’å«ã‚€ã“ã¨ãŒã§ãã‚‹ .zip ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ã§ã™ã€‚ãƒ¬ã‚¤ãƒ¤ãƒ¼ã«ã¯ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã€[ã‚«ã‚¹ã‚¿ãƒ ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ](https://docs.aws.amazon.com/lambda/latest/dg/runtimes-custom.html)ã€ãƒ‡ãƒ¼ã‚¿ã€ã¾ãŸã¯è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’å«ã‚ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

1ã¤ã®é–¢æ•°ã«æœ€å¤§ **5ã¤ã®ãƒ¬ã‚¤ãƒ¤ãƒ¼** ã‚’å«ã‚ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚é–¢æ•°ã«ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’å«ã‚ã‚‹ã¨ã€ãã® **å†…å®¹ã¯å®Ÿè¡Œç’°å¢ƒã® `/opt` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«æŠ½å‡º** ã•ã‚Œã¾ã™ã€‚

**ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ** ã§ã¯ã€ä½œæˆã—ãŸ **ãƒ¬ã‚¤ãƒ¤ãƒ¼** ã¯ **AWS ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã«å¯¾ã—ã¦ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆ** ã§ã™ã€‚ä»–ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã¨ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’ **å…±æœ‰** ã™ã‚‹ã‹ã€ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’ **å…¬é–‹** ã™ã‚‹ã“ã¨ã‚’é¸æŠã§ãã¾ã™ã€‚åˆ¥ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãŒå…¬é–‹ã—ãŸãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’é–¢æ•°ãŒä½¿ç”¨ã™ã‚‹å ´åˆã€ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒå‰Šé™¤ã•ã‚ŒãŸå¾Œã‚„ã‚¢ã‚¯ã‚»ã‚¹æ¨©ãŒå–ã‚Šæ¶ˆã•ã‚ŒãŸå¾Œã§ã‚‚ã€é–¢æ•°ã¯ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ä½¿ç”¨ã—ç¶šã‘ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ãŸã ã—ã€å‰Šé™¤ã•ã‚ŒãŸãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ä½¿ç”¨ã—ã¦æ–°ã—ã„é–¢æ•°ã‚’ä½œæˆã—ãŸã‚Šã€é–¢æ•°ã‚’æ›´æ–°ã—ãŸã‚Šã™ã‚‹ã“ã¨ã¯ã§ãã¾ã›ã‚“ã€‚

ã‚³ãƒ³ãƒ†ãƒŠã‚¤ãƒ¡ãƒ¼ã‚¸ã¨ã—ã¦ãƒ‡ãƒ—ãƒ­ã‚¤ã•ã‚ŒãŸé–¢æ•°ã¯ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’ä½¿ç”¨ã—ã¾ã›ã‚“ã€‚ä»£ã‚ã‚Šã«ã€ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ãƒ“ãƒ«ãƒ‰ã™ã‚‹éš›ã«ã€å¥½ã¿ã®ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã€ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã€ãŠã‚ˆã³ãã®ä»–ã®ä¾å­˜é–¢ä¿‚ã‚’ã‚³ãƒ³ãƒ†ãƒŠã‚¤ãƒ¡ãƒ¼ã‚¸ã«ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸åŒ–ã—ã¾ã™ã€‚

### Lambda Extensions

Lambda æ‹¡å¼µæ©Ÿèƒ½ã¯ã€ã•ã¾ã–ã¾ãª **ç›£è¦–ã€å¯è¦³æ¸¬æ€§ã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã€ãŠã‚ˆã³ã‚¬ãƒãƒŠãƒ³ã‚¹ãƒ„ãƒ¼ãƒ«** ã¨çµ±åˆã™ã‚‹ã“ã¨ã§é–¢æ•°ã‚’å¼·åŒ–ã—ã¾ã™ã€‚ã“ã‚Œã‚‰ã®æ‹¡å¼µæ©Ÿèƒ½ã¯ã€[Lambda ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’ä½¿ç”¨ã—ã¦ .zip ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ã¨ã—ã¦è¿½åŠ ](https://docs.aws.amazon.com/lambda/latest/dg/configuration-layers.html) ã™ã‚‹ã‹ã€[ã‚³ãƒ³ãƒ†ãƒŠã‚¤ãƒ¡ãƒ¼ã‚¸ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆã«å«ã‚ã‚‹](https://aws.amazon.com/blogs/compute/working-with-lambda-layers-and-extensions-in-container-images/) ã“ã¨ã§å‹•ä½œã—ã¾ã™ã€‚æ‹¡å¼µæ©Ÿèƒ½ã¯ **å†…éƒ¨** ã¨ **å¤–éƒ¨** ã®2ã¤ã®ãƒ¢ãƒ¼ãƒ‰ã§å‹•ä½œã—ã¾ã™ã€‚

* **å†…éƒ¨æ‹¡å¼µæ©Ÿèƒ½** ã¯ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ãƒ—ãƒ­ã‚»ã‚¹ã¨çµ±åˆã—ã€**è¨€èªå›ºæœ‰ã®ç’°å¢ƒå¤‰æ•°** ã‚„ **ãƒ©ãƒƒãƒ‘ãƒ¼ã‚¹ã‚¯ãƒªãƒ—ãƒˆ** ã‚’ä½¿ç”¨ã—ã¦ãã®èµ·å‹•ã‚’æ“ä½œã—ã¾ã™ã€‚ã“ã®ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã¯ã€**Java Correto 8 ãŠã‚ˆã³ 11ã€Node.js 10 ãŠã‚ˆã³ 12ã€.NET Core 3.1** ãªã©ã®ã•ã¾ã–ã¾ãªãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã«é©ç”¨ã•ã‚Œã¾ã™ã€‚
* **å¤–éƒ¨æ‹¡å¼µæ©Ÿèƒ½** ã¯åˆ¥å€‹ã®ãƒ—ãƒ­ã‚»ã‚¹ã¨ã—ã¦å®Ÿè¡Œã•ã‚Œã€Lambda é–¢æ•°ã®ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ã¨æ“ä½œã®æ•´åˆæ€§ã‚’ç¶­æŒã—ã¾ã™ã€‚ã“ã‚Œã‚‰ã¯ã€**Node.js 10 ãŠã‚ˆã³ 12ã€Python 3.7 ãŠã‚ˆã³ 3.8ã€Ruby 2.5 ãŠã‚ˆã³ 2.7ã€Java Corretto 8 ãŠã‚ˆã³ 11ã€.NET Core 3.1**ã€ãŠã‚ˆã³ **ã‚«ã‚¹ã‚¿ãƒ ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ** ãªã©ã®ã•ã¾ã–ã¾ãªãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã¨äº’æ›æ€§ãŒã‚ã‚Šã¾ã™ã€‚

### Enumeration
```bash
aws lambda get-account-settings

# List functions and get extra config info
aws lambda list-functions
aws lambda get-function --function-name <function_name>
aws lambda get-function-configuration --function-name <function_name>
aws lambda list-function-event-invoke-configs --function-name <function_name>
## Check for creds in env vars
aws lambda list-functions | jq '.Functions[].Environment'
## Download & check the source code
aws lambda get-function --function-name "<func_name>" --query 'Code.Location'
wget -O lambda-function.zip <url-from-previous-query>

# Get Lambda URL (if any)
aws lambda list-function-url-configs --function-name <function_name>
aws lambda get-function-url-config --function-name <function_name>

# Get who has permissions to invoke the Lambda
aws lambda get-policy --function-name <function_name>

# Versions and Aliases
aws lambda list-versions-by-function --function-name <func_name>
aws lambda list-aliases --function-name <func_name>

# List layers
aws lambda list-layers
aws lambda list-layer-versions --layer-name <name>
aws lambda get-layer-version --layer-name <name> --version-number <ver>
aws lambda get-layer-version-by-arn --arn <name> #Get external ARNs

# List other metadata
aws lambda list-event-source-mappings
aws lambda list-code-signing-configs
aws lambda list-functions-by-code-signing-config --code-signing-config-arn <arn>
```
### Invoke a lambda

#### Manual

Lambdaé–¢æ•°ã‚’æ‰‹å‹•ã§å‘¼ã³å‡ºã™ã«ã¯ã€aws-cliã‚’ä½¿ç”¨ã—ã¾ã™ã€‚ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚

```bash
aws lambda invoke --function-name <function_name> output.txt
```

ã“ã®ã‚³ãƒãƒ³ãƒ‰ã¯ã€æŒ‡å®šã—ãŸLambdaé–¢æ•°ã‚’å‘¼ã³å‡ºã—ã€ãã®å‡ºåŠ›ã‚’`output.txt`ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜ã—ã¾ã™ã€‚
```bash
# Invoke function
aws lambda invoke --function-name FUNCTION_NAME /tmp/out
## Some functions will expect parameters, they will access them with something like:
## target_policys = event['policy_names']
## user_name = event['user_name']
aws lambda invoke --function-name <name> --cli-binary-format raw-in-base64-out --payload '{"policy_names": ["AdministratorAccess], "user_name": "sdf"}' out.txt
```
#### å…¬é–‹ã•ã‚ŒãŸURLã‚’ä»‹ã—ã¦

AWS Lambdaé–¢æ•°ãŒAPI Gatewayã¾ãŸã¯Application Load Balancerã‚’ä»‹ã—ã¦å…¬é–‹ã•ã‚Œã¦ã„ã‚‹å ´åˆã€URLã‚’é€šã˜ã¦é–¢æ•°ã‚’å‘¼ã³å‡ºã™ã“ã¨ãŒã§ãã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€é–¢æ•°ã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆãŒå¤–éƒ¨ã«éœ²å‡ºã—ã€æ½œåœ¨çš„ãªæ”»æ’ƒãƒ™ã‚¯ãƒˆãƒ«ã¨ãªã‚Šã¾ã™ã€‚

#### Via AWS CLI

AWS CLIã‚’ä½¿ç”¨ã—ã¦Lambdaé–¢æ•°ã‚’åˆ—æŒ™ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ç”¨ã—ã¦ã€Lambdaé–¢æ•°ã®ãƒªã‚¹ãƒˆã‚’å–å¾—ã—ã¾ã™ã€‚

```bash
aws lambda list-functions --region <region>
```

#### Via AWS SDK

AWS SDKã‚’ä½¿ç”¨ã—ã¦Lambdaé–¢æ•°ã‚’åˆ—æŒ™ã™ã‚‹ã“ã¨ã‚‚å¯èƒ½ã§ã™ã€‚ä»¥ä¸‹ã¯Pythonã‚’ä½¿ç”¨ã—ãŸä¾‹ã§ã™ã€‚

```python
import boto3

client = boto3.client('lambda', region_name='<region>')
response = client.list_functions()

for function in response['Functions']:
    print(function['FunctionName'])
```

#### Permissions

Lambdaé–¢æ•°ã®åˆ—æŒ™ã«ã¯é©åˆ‡ãªæ¨©é™ãŒå¿…è¦ã§ã™ã€‚ä»¥ä¸‹ã®IAMãƒãƒªã‚·ãƒ¼ã‚’æŒã¤ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¾ãŸã¯ãƒ­ãƒ¼ãƒ«ãŒå¿…è¦ã§ã™ã€‚

```json
{
    "Version": "2012-10-17",
    "Statement": [
        {
            "Effect": "Allow",
            "Action": "lambda:ListFunctions",
            "Resource": "*"
        }
    ]
}
```

#### Summary

Lambdaé–¢æ•°ã®åˆ—æŒ™ã¯ã€å…¬é–‹ã•ã‚ŒãŸURLã€AWS CLIã€ã¾ãŸã¯AWS SDKã‚’ä½¿ç”¨ã—ã¦å®Ÿè¡Œã§ãã¾ã™ã€‚é©åˆ‡ãªæ¨©é™ãŒå¿…è¦ã§ã‚ã‚Šã€é–¢æ•°ã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆãŒå¤–éƒ¨ã«éœ²å‡ºã—ã¦ã„ã‚‹å ´åˆã¯æ³¨æ„ãŒå¿…è¦ã§ã™ã€‚
```bash
aws lambda list-function-url-configs --function-name <function_name> #Get lambda URL
aws lambda get-function-url-config   --function-name <function_name> #Get lambda URL
```
#### Call Lambda function via URL

æ¬¡ã«ã€å®Ÿè¡Œå¯èƒ½ãªlambdaé–¢æ•°ã‚’è¦‹ã¤ã‘ã‚‹æ™‚ãŒæ¥ã¾ã—ãŸ:
```
aws --region us-west-2 --profile level6 lambda list-functions
```
![](<../../../.gitbook/assets/image (262).png>)

"Level6" ã¨ã„ã†åå‰ã® lambda é–¢æ•°ãŒåˆ©ç”¨å¯èƒ½ã§ã™ã€‚ã“ã‚Œã‚’å‘¼ã³å‡ºã™æ–¹æ³•ã‚’è¦‹ã¤ã‘ã¾ã—ã‚‡ã†:
```bash
aws --region us-west-2 --profile level6 lambda get-policy --function-name Level6
```
![](<../../../.gitbook/assets/image (102).png>)

åå‰ã¨IDãŒã‚ã‹ã£ãŸã®ã§ã€åå‰ã‚’å–å¾—ã§ãã¾ã™:
```bash
aws --profile level6 --region us-west-2 apigateway get-stages --rest-api-id "s33ppypa75"
```
![](<../../../.gitbook/assets/image (237).png>)

ãã—ã¦æœ€å¾Œã«é–¢æ•°ã‚’å‘¼ã³å‡ºã—ã¾ã™ï¼ˆURLã«IDã€Nameã€function-nameãŒè¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨ã«æ³¨æ„ã—ã¦ãã ã•ã„ï¼‰ï¼š[https://s33ppypa75.execute-api.us-west-2.amazonaws.com/Prod/level6](https://s33ppypa75.execute-api.us-west-2.amazonaws.com/Prod/level6)

`URL:`**`https://<rest-api-id>.execute-api.<region>.amazonaws.com/<stageName>/<funcName>`**

#### ä»–ã®ãƒˆãƒªã‚¬ãƒ¼

lambdaã‚’ãƒˆãƒªã‚¬ãƒ¼ã§ãã‚‹ä»–ã®å¤šãã®ã‚½ãƒ¼ã‚¹ãŒã‚ã‚Šã¾ã™

<figure><img src="../../../.gitbook/assets/image (167).png" alt=""><figcaption></figcaption></figure>

### Privesc

æ¬¡ã®ãƒšãƒ¼ã‚¸ã§ã€**Lambdaã®æ¨©é™ã‚’æ‚ªç”¨ã—ã¦ç‰¹æ¨©ã‚’ã‚¨ã‚¹ã‚«ãƒ¬ãƒ¼ãƒˆã™ã‚‹**æ–¹æ³•ã‚’ç¢ºèªã§ãã¾ã™ï¼š

{% content-ref url="../aws-privilege-escalation/aws-lambda-privesc.md" %}
[aws-lambda-privesc.md](../aws-privilege-escalation/aws-lambda-privesc.md)
{% endcontent-ref %}

### èªè¨¼ã•ã‚Œã¦ã„ãªã„ã‚¢ã‚¯ã‚»ã‚¹

{% content-ref url="../aws-unauthenticated-enum-access/aws-lambda-unauthenticated-access.md" %}
[aws-lambda-unauthenticated-access.md](../aws-unauthenticated-enum-access/aws-lambda-unauthenticated-access.md)
{% endcontent-ref %}

### ãƒã‚¹ãƒˆã‚¨ã‚¯ã‚¹ãƒ—ãƒ­ã‚¤ãƒˆ

{% content-ref url="../aws-post-exploitation/aws-lambda-post-exploitation/" %}
[aws-lambda-post-exploitation](../aws-post-exploitation/aws-lambda-post-exploitation/)
{% endcontent-ref %}

### æ°¸ç¶šæ€§

{% content-ref url="../aws-persistence/aws-lambda-persistence/" %}
[aws-lambda-persistence](../aws-persistence/aws-lambda-persistence/)
{% endcontent-ref %}

## å‚è€ƒæ–‡çŒ®

* [https://docs.aws.amazon.com/lambda/latest/dg/gettingstarted-concepts.html#gettingstarted-concepts-layer](https://docs.aws.amazon.com/lambda/latest/dg/gettingstarted-concepts.html#gettingstarted-concepts-layer)
* [https://aws.amazon.com/blogs/compute/building-extensions-for-aws-lambda-in-preview/](https://aws.amazon.com/blogs/compute/building-extensions-for-aws-lambda-in-preview/)

{% hint style="success" %}
AWS Hackingã‚’å­¦ã³ã€ç·´ç¿’ã™ã‚‹:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCP Hackingã‚’å­¦ã³ã€ç·´ç¿’ã™ã‚‹: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricksã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹</summary>

* [**ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³**](https://github.com/sponsors/carlospolop)ã‚’ãƒã‚§ãƒƒã‚¯ï¼
* ğŸ’¬ [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã¾ãŸã¯[**telegramã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«å‚åŠ ã™ã‚‹ã‹ã€**Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)ã‚’ãƒ•ã‚©ãƒ­ãƒ¼ã—ã¦ãã ã•ã„ã€‚
* **ãƒãƒƒã‚­ãƒ³ã‚°ã®ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã™ã‚‹ã«ã¯ã€** [**HackTricks**](https://github.com/carlospolop/hacktricks)ãŠã‚ˆã³[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)ã®githubãƒªãƒã‚¸ãƒˆãƒªã«PRã‚’æå‡ºã—ã¦ãã ã•ã„ã€‚

</details>
{% endhint %}
