# AWS - Lambda Enum

{% hint style="success" %}
å­¦ä¹ ä¸å®è·µ AWS é»‘å®¢æŠ€æœ¯ï¼š<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks åŸ¹è®­ AWS çº¢é˜Ÿä¸“å®¶ (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
å­¦ä¹ ä¸å®è·µ GCP é»‘å®¢æŠ€æœ¯ï¼š<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks åŸ¹è®­ GCP çº¢é˜Ÿä¸“å®¶ (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>æ”¯æŒ HackTricks</summary>

* æŸ¥çœ‹ [**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**Telegram ç¾¤ç»„**](https://t.me/peass) æˆ– **åœ¨ Twitter ä¸Šå…³æ³¨** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub ä»“åº“æäº¤ PR åˆ†äº«é»‘å®¢æŠ€å·§ã€‚

</details>
{% endhint %}

## Lambda

äºšé©¬é€Šç½‘ç»œæœåŠ¡ (AWS) Lambda è¢«æè¿°ä¸ºä¸€ç§ **è®¡ç®—æœåŠ¡**ï¼Œä½¿å¾—ä»£ç çš„æ‰§è¡Œæ— éœ€æœåŠ¡å™¨çš„æä¾›æˆ–ç®¡ç†ã€‚å®ƒçš„ç‰¹ç‚¹æ˜¯èƒ½å¤Ÿ **è‡ªåŠ¨å¤„ç†ä»£ç æ‰§è¡Œæ‰€éœ€çš„èµ„æºåˆ†é…**ï¼Œç¡®ä¿é«˜å¯ç”¨æ€§ã€å¯æ‰©å±•æ€§å’Œå®‰å…¨æ€§ç­‰ç‰¹æ€§ã€‚Lambda çš„ä¸€ä¸ªé‡è¦æ–¹é¢æ˜¯å…¶å®šä»·æ¨¡å‹ï¼Œ**è´¹ç”¨ä»…åŸºäºæ‰€ä½¿ç”¨çš„è®¡ç®—æ—¶é—´**ï¼Œæ¶ˆé™¤äº†åˆå§‹æŠ•èµ„æˆ–é•¿æœŸä¹‰åŠ¡çš„éœ€è¦ã€‚

è¦è°ƒç”¨ Lambdaï¼Œå¯ä»¥ **éšæ—¶è°ƒç”¨**ï¼ˆä½¿ç”¨ Cloudwatchï¼‰ï¼Œ**æš´éœ²**ä¸€ä¸ª **URL** ç«¯ç‚¹å¹¶è°ƒç”¨å®ƒï¼Œé€šè¿‡ **API Gateway** è°ƒç”¨ï¼Œç”šè‡³åŸºäº **äº‹ä»¶** è¿›è¡Œè°ƒç”¨ï¼Œä¾‹å¦‚ **S3** å­˜å‚¨æ¡¶ä¸­çš„æ•°æ® **æ›´æ”¹** æˆ– **DynamoDB** è¡¨çš„æ›´æ–°ã€‚

Lambda çš„ **ä»£ç ** å­˜å‚¨åœ¨ **`/var/task`** ä¸­ã€‚

### Lambda åˆ«åæƒé‡

ä¸€ä¸ª Lambda å¯ä»¥æœ‰ **å¤šä¸ªç‰ˆæœ¬**ã€‚\
å®ƒå¯ä»¥é€šè¿‡ **åˆ«å** æš´éœ² **å¤šä¸ªç‰ˆæœ¬**ã€‚åœ¨åˆ«åä¸­æš´éœ²çš„ **æ¯ä¸ªç‰ˆæœ¬** çš„ **æƒé‡** å°†å†³å®š **å“ªä¸ªåˆ«åæ¥æ”¶è°ƒç”¨**ï¼ˆä¾‹å¦‚å¯ä»¥æ˜¯ 90%-10%ï¼‰ã€‚\
å¦‚æœ **ä¸€ä¸ª** åˆ«åçš„ä»£ç æ˜¯ **è„†å¼±çš„**ï¼Œä½ å¯ä»¥å‘é€ **è¯·æ±‚ï¼Œç›´åˆ°è„†å¼±çš„** ç‰ˆæœ¬æ¥æ”¶åˆ°åˆ©ç”¨ã€‚

![](<../../../.gitbook/assets/image (223).png>)

### èµ„æºç­–ç•¥

Lambda èµ„æºç­–ç•¥å…è®¸ **æˆäºˆå…¶ä»–æœåŠ¡/è´¦æˆ·è°ƒç”¨** Lambda çš„æƒé™ã€‚\
ä¾‹å¦‚ï¼Œè¿™æ˜¯å…è®¸ **ä»»ä½•äººé€šè¿‡ URL è®¿é—® Lambda** çš„ç­–ç•¥ï¼š

<figure><img src="https://lh4.googleusercontent.com/4PNFKBdzr3nMrPqeKkTslgwWDKxkXMdQ1SNdv7NPHykj3GX8wODrQyXOFbjk4fxHfZ8pDm5ijWgk2Vq2EGXiPRT3TQfZf1fHycvdEKBuDxJDYos1CJeMHXSeg86ZB-Ol7CNtten6xkVFQj6AhDUEWNQJrQ=s2048" alt=""><figcaption></figcaption></figure>

æˆ–è€…è¿™æ˜¯å…è®¸ API Gateway è°ƒç”¨å®ƒçš„ç­–ç•¥ï¼š

<figure><img src="https://lh3.googleusercontent.com/Su0JlR0wBqb-99Z4N_2-_kMlX0Xzx2n_GpZuOPW5IeXR3FYbm8OHFDM3Ora1BpXiSjHpDVUlq4yEyXwaI3nBuze6DJ-wRf2ATsCuWbq0wuBCd34E9uIpqwheE6Cc_PopviI_93O_j2ZKXc1-AJtsBoLVUw=s2048" alt=""><figcaption></figcaption></figure>

### Lambda æ•°æ®åº“ä»£ç†

å½“æœ‰ **æ•°ç™¾ä¸ª** **å¹¶å‘çš„ Lambda è¯·æ±‚** æ—¶ï¼Œå¦‚æœæ¯ä¸ªè¯·æ±‚éƒ½éœ€è¦ **è¿æ¥å¹¶å…³é—­ä¸æ•°æ®åº“çš„è¿æ¥**ï¼Œè¿™æ ¹æœ¬è¡Œä¸é€šï¼ˆLambda æ˜¯æ— çŠ¶æ€çš„ï¼Œæ— æ³•ä¿æŒè¿æ¥æ‰“å¼€ï¼‰ã€‚\
å› æ­¤ï¼Œå¦‚æœä½ çš„ **Lambda å‡½æ•°ä¸ RDS Proxy äº¤äº’** è€Œä¸æ˜¯ä¸æ•°æ®åº“å®ä¾‹äº¤äº’ã€‚å®ƒå¤„ç†å¹¶å‘ Lambda å‡½æ•°åˆ›å»ºçš„è®¸å¤šåŒæ—¶è¿æ¥æ‰€éœ€çš„è¿æ¥æ± ã€‚è¿™ä½¿å¾—ä½ çš„ Lambda åº”ç”¨ç¨‹åºèƒ½å¤Ÿ **é‡ç”¨ç°æœ‰è¿æ¥**ï¼Œè€Œä¸æ˜¯ä¸ºæ¯æ¬¡å‡½æ•°è°ƒç”¨åˆ›å»ºæ–°è¿æ¥ã€‚

### Lambda EFS æ–‡ä»¶ç³»ç»Ÿ

ä¸ºäº†ä¿ç•™ç”šè‡³å…±äº«æ•°æ®ï¼Œ**Lambdas å¯ä»¥è®¿é—® EFS å¹¶æŒ‚è½½å®ƒä»¬**ï¼Œè¿™æ · Lambda å°±èƒ½å¤Ÿä»ä¸­è¯»å–å’Œå†™å…¥ã€‚

### Lambda å±‚

Lambda _å±‚_ æ˜¯ä¸€ä¸ª .zip æ–‡ä»¶å½’æ¡£ï¼Œ**å¯ä»¥åŒ…å«é¢å¤–çš„ä»£ç ** æˆ–å…¶ä»–å†…å®¹ã€‚ä¸€ä¸ªå±‚å¯ä»¥åŒ…å«åº“ã€[è‡ªå®šä¹‰è¿è¡Œæ—¶](https://docs.aws.amazon.com/lambda/latest/dg/runtimes-custom.html)ã€æ•°æ®æˆ–é…ç½®æ–‡ä»¶ã€‚

æ¯ä¸ªå‡½æ•°æœ€å¤šå¯ä»¥åŒ…å« **äº”ä¸ªå±‚**ã€‚å½“ä½ åœ¨å‡½æ•°ä¸­åŒ…å«ä¸€ä¸ªå±‚æ—¶ï¼Œ**å†…å®¹ä¼šè¢«æå–åˆ°æ‰§è¡Œç¯å¢ƒä¸­çš„ `/opt`** ç›®å½•ã€‚

é»˜è®¤æƒ…å†µä¸‹ï¼Œä½ åˆ›å»ºçš„ **å±‚** æ˜¯ **ç§æœ‰** çš„ï¼Œå±äºä½ çš„ AWS è´¦æˆ·ã€‚ä½ å¯ä»¥é€‰æ‹© **ä¸å…¶ä»–è´¦æˆ·å…±äº«** ä¸€ä¸ªå±‚æˆ– **å°†** è¯¥å±‚ **å…¬å¼€**ã€‚å¦‚æœä½ çš„å‡½æ•°ä½¿ç”¨äº†ä¸åŒè´¦æˆ·å‘å¸ƒçš„å±‚ï¼Œå³ä½¿è¯¥å±‚è¢«åˆ é™¤æˆ–ä½ è¢«æ’¤é”€è®¿é—®æƒé™ï¼Œä½ çš„å‡½æ•°ä»ç„¶å¯ä»¥ **ç»§ç»­ä½¿ç”¨è¯¥å±‚ç‰ˆæœ¬**ã€‚ä½†æ˜¯ï¼Œä½ ä¸èƒ½ä½¿ç”¨å·²åˆ é™¤çš„å±‚ç‰ˆæœ¬åˆ›å»ºæ–°å‡½æ•°æˆ–æ›´æ–°å‡½æ•°ã€‚

ä½œä¸ºå®¹å™¨é•œåƒéƒ¨ç½²çš„å‡½æ•°ä¸ä½¿ç”¨å±‚ã€‚ç›¸åï¼Œä½ åœ¨æ„å»ºé•œåƒæ—¶å°†æ‰€éœ€çš„è¿è¡Œæ—¶ã€åº“å’Œå…¶ä»–ä¾èµ–é¡¹æ‰“åŒ…åˆ°å®¹å™¨é•œåƒä¸­ã€‚

### Lambda æ‰©å±•

Lambda æ‰©å±•é€šè¿‡ä¸å„ç§ **ç›‘æ§ã€å¯è§‚å¯Ÿæ€§ã€å®‰å…¨æ€§å’Œæ²»ç†å·¥å…·** é›†æˆæ¥å¢å¼ºå‡½æ•°ã€‚è¿™äº›æ‰©å±•é€šè¿‡ [.zip å½’æ¡£ä½¿ç”¨ Lambda å±‚](https://docs.aws.amazon.com/lambda/latest/dg/configuration-layers.html) æ·»åŠ ï¼Œæˆ–åŒ…å«åœ¨ [å®¹å™¨é•œåƒéƒ¨ç½²ä¸­](https://aws.amazon.com/blogs/compute/working-with-lambda-layers-and-extensions-in-container-images/)ï¼Œä»¥ä¸¤ç§æ¨¡å¼è¿è¡Œï¼š**å†…éƒ¨** å’Œ **å¤–éƒ¨**ã€‚

* **å†…éƒ¨æ‰©å±•** ä¸è¿è¡Œæ—¶è¿›ç¨‹åˆå¹¶ï¼Œä½¿ç”¨ **ç‰¹å®šè¯­è¨€çš„ç¯å¢ƒå˜é‡** å’Œ **åŒ…è£…è„šæœ¬** æ“ä½œå…¶å¯åŠ¨ã€‚æ­¤è‡ªå®šä¹‰é€‚ç”¨äºå¤šç§è¿è¡Œæ—¶ï¼ŒåŒ…æ‹¬ **Java Correto 8 å’Œ 11ã€Node.js 10 å’Œ 12ï¼Œä»¥åŠ .NET Core 3.1**ã€‚
* **å¤–éƒ¨æ‰©å±•** ä½œä¸ºå•ç‹¬çš„è¿›ç¨‹è¿è¡Œï¼Œä¸ Lambda å‡½æ•°çš„ç”Ÿå‘½å‘¨æœŸä¿æŒæ“ä½œä¸€è‡´ã€‚å®ƒä»¬ä¸å¤šç§è¿è¡Œæ—¶å…¼å®¹ï¼Œå¦‚ **Node.js 10 å’Œ 12ã€Python 3.7 å’Œ 3.8ã€Ruby 2.5 å’Œ 2.7ã€Java Corretto 8 å’Œ 11ã€.NET Core 3.1** ä»¥åŠ **è‡ªå®šä¹‰è¿è¡Œæ—¶**ã€‚

### æšä¸¾
```bash
aws lambda get-account-settings

# List functions and get extra config info
aws lambda list-functions
aws lambda get-function --function-name <function_name>
aws lambda get-function-configuration --function-name <function_name>
aws lambda list-function-event-invoke-configs --function-name <function_name>
## Check for creds in env vars
aws lambda list-functions | jq '.Functions[].Environment'
## Download & check the source code
aws lambda get-function --function-name "<func_name>" --query 'Code.Location'
wget -O lambda-function.zip <url-from-previous-query>

# Get Lambda URL (if any)
aws lambda list-function-url-configs --function-name <function_name>
aws lambda get-function-url-config --function-name <function_name>

# Get who has permissions to invoke the Lambda
aws lambda get-policy --function-name <function_name>

# Versions and Aliases
aws lambda list-versions-by-function --function-name <func_name>
aws lambda list-aliases --function-name <func_name>

# List layers
aws lambda list-layers
aws lambda list-layer-versions --layer-name <name>
aws lambda get-layer-version --layer-name <name> --version-number <ver>
aws lambda get-layer-version-by-arn --arn <name> #Get external ARNs

# List other metadata
aws lambda list-event-source-mappings
aws lambda list-code-signing-configs
aws lambda list-functions-by-code-signing-config --code-signing-config-arn <arn>
```
### è°ƒç”¨ä¸€ä¸ª lambda

#### æ‰‹åŠ¨
```bash
# Invoke function
aws lambda invoke --function-name FUNCTION_NAME /tmp/out
## Some functions will expect parameters, they will access them with something like:
## target_policys = event['policy_names']
## user_name = event['user_name']
aws lambda invoke --function-name <name> --cli-binary-format raw-in-base64-out --payload '{"policy_names": ["AdministratorAccess], "user_name": "sdf"}' out.txt
```
#### é€šè¿‡æš´éœ²çš„ URL
```bash
aws lambda list-function-url-configs --function-name <function_name> #Get lambda URL
aws lambda get-function-url-config   --function-name <function_name> #Get lambda URL
```
#### é€šè¿‡ URL è°ƒç”¨ Lambda å‡½æ•°

ç°åœ¨æ˜¯æ—¶å€™æ‰¾å‡ºå¯ä»¥æ‰§è¡Œçš„å¯èƒ½çš„ lambda å‡½æ•°äº†ï¼š
```
aws --region us-west-2 --profile level6 lambda list-functions
```
![](<../../../.gitbook/assets/image (262).png>)

ä¸€ä¸ªåä¸º "Level6" çš„ lambda å‡½æ•°å¯ç”¨ã€‚è®©æˆ‘ä»¬æ‰¾å‡ºå¦‚ä½•è°ƒç”¨å®ƒï¼š
```bash
aws --region us-west-2 --profile level6 lambda get-policy --function-name Level6
```
![](<../../../.gitbook/assets/image (102).png>)

ç°åœ¨ï¼Œæ‚¨çŸ¥é“åç§°å’ŒIDåï¼Œå¯ä»¥è·å–åç§°ï¼š
```bash
aws --profile level6 --region us-west-2 apigateway get-stages --rest-api-id "s33ppypa75"
```
![](<../../../.gitbook/assets/image (237).png>)

æœ€åè°ƒç”¨å‡½æ•°è®¿é—®ï¼ˆæ³¨æ„IDã€åç§°å’Œå‡½æ•°åç§°å‡ºç°åœ¨URLä¸­ï¼‰ï¼š [https://s33ppypa75.execute-api.us-west-2.amazonaws.com/Prod/level6](https://s33ppypa75.execute-api.us-west-2.amazonaws.com/Prod/level6)

`URL:`**`https://<rest-api-id>.execute-api.<region>.amazonaws.com/<stageName>/<funcName>`**

#### å…¶ä»–è§¦å‘å™¨

è¿˜æœ‰å¾ˆå¤šå…¶ä»–æ¥æºå¯ä»¥è§¦å‘lambda

<figure><img src="../../../.gitbook/assets/image (167).png" alt=""><figcaption></figcaption></figure>

### æƒé™æå‡

åœ¨ä»¥ä¸‹é¡µé¢ä¸­ï¼Œæ‚¨å¯ä»¥æŸ¥çœ‹å¦‚ä½•**æ»¥ç”¨Lambdaæƒé™ä»¥æå‡æƒé™**ï¼š

{% content-ref url="../aws-privilege-escalation/aws-lambda-privesc.md" %}
[aws-lambda-privesc.md](../aws-privilege-escalation/aws-lambda-privesc.md)
{% endcontent-ref %}

### æœªç»èº«ä»½éªŒè¯çš„è®¿é—®

{% content-ref url="../aws-unauthenticated-enum-access/aws-lambda-unauthenticated-access.md" %}
[aws-lambda-unauthenticated-access.md](../aws-unauthenticated-enum-access/aws-lambda-unauthenticated-access.md)
{% endcontent-ref %}

### åˆ©ç”¨å

{% content-ref url="../aws-post-exploitation/aws-lambda-post-exploitation/" %}
[aws-lambda-post-exploitation](../aws-post-exploitation/aws-lambda-post-exploitation/)
{% endcontent-ref %}

### æŒä¹…æ€§

{% content-ref url="../aws-persistence/aws-lambda-persistence/" %}
[aws-lambda-persistence](../aws-persistence/aws-lambda-persistence/)
{% endcontent-ref %}

## å‚è€ƒ

* [https://docs.aws.amazon.com/lambda/latest/dg/gettingstarted-concepts.html#gettingstarted-concepts-layer](https://docs.aws.amazon.com/lambda/latest/dg/gettingstarted-concepts.html#gettingstarted-concepts-layer)
* [https://aws.amazon.com/blogs/compute/building-extensions-for-aws-lambda-in-preview/](https://aws.amazon.com/blogs/compute/building-extensions-for-aws-lambda-in-preview/)

{% hint style="success" %}
å­¦ä¹ å’Œå®è·µAWSé»‘å®¢æŠ€æœ¯ï¼š<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricksåŸ¹è®­AWSçº¢é˜Ÿä¸“å®¶ï¼ˆARTEï¼‰**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
å­¦ä¹ å’Œå®è·µGCPé»‘å®¢æŠ€æœ¯ï¼š <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricksåŸ¹è®­GCPçº¢é˜Ÿä¸“å®¶ï¼ˆGRTEï¼‰**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>æ”¯æŒHackTricks</summary>

* æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f)æˆ–[**ç”µæŠ¥ç¾¤ç»„**](https://t.me/peass)æˆ–**åœ¨** **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**ä¸Šå…³æ³¨æˆ‘ä»¬ã€‚**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks)å’Œ[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) githubåº“æäº¤PRåˆ†äº«é»‘å®¢æŠ€å·§ã€‚

</details>
{% endhint %}
