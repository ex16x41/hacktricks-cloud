# AWS - Lambda Enum

{% hint style="success" %}
AWS Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n:<img src="../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">\
GCP Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**abonelik planlarÄ±nÄ±**](https://github.com/sponsors/carlospolop) kontrol edin!
* **ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n ya da **Twitter**'da **bizi takip edin** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Hacking ipuÃ§larÄ±nÄ± paylaÅŸmak iÃ§in** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna PR gÃ¶nderin.

</details>
{% endhint %}

## Lambda

Amazon Web Services (AWS) Lambda, **sunucu saÄŸlama veya yÃ¶netim gerektirmeden kodun yÃ¼rÃ¼tÃ¼lmesini** saÄŸlayan bir **hesaplama hizmeti** olarak tanÄ±mlanÄ±r. **Kod yÃ¼rÃ¼tme iÃ§in gerekli kaynak tahsisini otomatik olarak yÃ¶netme** yeteneÄŸi ile karakterizedir ve yÃ¼ksek kullanÄ±labilirlik, Ã¶lÃ§eklenebilirlik ve gÃ¼venlik gibi Ã¶zellikler saÄŸlar. Lambda'nÄ±n Ã¶nemli bir yÃ¶nÃ¼, **Ã¼cretlerin yalnÄ±zca kullanÄ±lan hesaplama sÃ¼resine dayandÄ±ÄŸÄ±** fiyatlandÄ±rma modelidir; bu da baÅŸlangÄ±Ã§ yatÄ±rÄ±mlarÄ± veya uzun vadeli yÃ¼kÃ¼mlÃ¼lÃ¼kler gerektirmez.

Bir lambda Ã§aÄŸÄ±rmak iÃ§in, **istediÄŸiniz sÄ±klÄ±kta** (Cloudwatch ile) Ã§aÄŸÄ±rmak, bir **URL** uÃ§ noktasÄ± aÃ§mak ve Ã§aÄŸÄ±rmak, **API Gateway** Ã¼zerinden Ã§aÄŸÄ±rmak veya **S3** kovasÄ±ndaki verilere yapÄ±lan **deÄŸiÅŸiklikler** veya **DynamoDB** tablosundaki gÃ¼ncellemeler gibi **olaylara** dayalÄ± olarak Ã§aÄŸÄ±rmak mÃ¼mkÃ¼ndÃ¼r.

Bir lambdanÄ±n **kod**'u **`/var/task`** dizininde saklanÄ±r.

### Lambda Alias AÄŸÄ±rlÄ±klarÄ±

Bir Lambda'nÄ±n **birden fazla versiyonu** olabilir.\
Ve **alias**'lar aracÄ±lÄ±ÄŸÄ±yla **1'den fazla** versiyon aÃ§Ä±ÄŸa Ã§Ä±karÄ±labilir. **Alias** iÃ§indeki **her** versiyonun **aÄŸÄ±rlÄ±klarÄ±**, **hangi alias'Ä±n Ã§aÄŸrÄ±yÄ± alacaÄŸÄ±nÄ±** belirleyecektir (Ã¶rneÄŸin 90%-10% olabilir).\
EÄŸer **bir** alias'Ä±n kodu **aÃ§Ä±k** ise, **aÃ§Ä±k** versiyonun istismarÄ± almasÄ± iÃ§in **istekler gÃ¶nderebilirsiniz**.

![](<../../../.gitbook/assets/image (223).png>)

### Kaynak PolitikalarÄ±

Lambda kaynak politikalarÄ±, Ã¶rneÄŸin, **baÅŸka hizmetlerin/hesaplarÄ±n lambdayÄ± Ã§aÄŸÄ±rmasÄ±na eriÅŸim vermek** iÃ§in kullanÄ±lÄ±r.\
Ã–rneÄŸin, **URL aracÄ±lÄ±ÄŸÄ±yla aÃ§Ä±ÄŸa Ã§Ä±karÄ±lan bir lambdaya herkesin eriÅŸmesine izin veren** politika:

<figure><img src="https://lh4.googleusercontent.com/4PNFKBdzr3nMrPqeKkTslgwWDKxkXMdQ1SNdv7NPHykj3GX8wODrQyXOFbjk4fxHfZ8pDm5ijWgk2Vq2EGXiPRT3TQfZf1fHycvdEKBuDxJDYos1CJeMHXSeg86ZB-Ol7CNtten6xkVFQj6AhDUEWNQJrQ=s2048" alt=""><figcaption></figcaption></figure>

Veya bir API Gateway'in bunu Ã§aÄŸÄ±rmasÄ±na izin veren bu:

<figure><img src="https://lh3.googleusercontent.com/Su0JlR0wBqb-99Z4N_2-_kMlX0Xzx2n_GpZuOPW5IeXR3FYbm8OHFDM3Ora1BpXiSjHpDVUlq4yEyXwaI3nBuze6DJ-wRf2ATsCuWbq0wuBCd34E9uIpqwheE6Cc_PopviI_93O_j2ZKXc1-AJtsBoLVUw=s2048" alt=""><figcaption></figcaption></figure>

### Lambda VeritabanÄ± Proxy'leri

**YÃ¼zlerce** **eÅŸzamanlÄ± lambda isteÄŸi** olduÄŸunda, her birinin bir veritabanÄ±na **baÄŸlanmasÄ± ve baÄŸlantÄ±yÄ± kapatmasÄ±** gerekiyorsa, bu Ã§alÄ±ÅŸmayacaktÄ±r (lambdalar durumsuzdur, aÃ§Ä±k baÄŸlantÄ±larÄ± sÃ¼rdÃ¼remezler).\
O zaman, eÄŸer **Lambda fonksiyonlarÄ±nÄ±z RDS Proxy ile etkileÅŸime geÃ§iyorsa**, veritabanÄ± Ã¶rneÄŸiniz yerine. Bu, eÅŸzamanlÄ± Lambda fonksiyonlarÄ± tarafÄ±ndan oluÅŸturulan birÃ§ok eÅŸzamanlÄ± baÄŸlantÄ±nÄ±n Ã¶lÃ§eklenmesi iÃ§in gerekli baÄŸlantÄ± havuzlamasÄ±nÄ± yÃ¶netir. Bu, Lambda uygulamalarÄ±nÄ±zÄ±n **mevcut baÄŸlantÄ±larÄ± yeniden kullanmasÄ±na** olanak tanÄ±r; her fonksiyon Ã§aÄŸrÄ±sÄ± iÃ§in yeni baÄŸlantÄ±lar oluÅŸturmak yerine.

### Lambda EFS Dosya Sistemleri

Verileri korumak ve hatta paylaÅŸmak iÃ§in **Lambdalar EFS'ye eriÅŸebilir ve bunlarÄ± monte edebilir**, bÃ¶ylece Lambda ondan okuma ve yazma yapabilir.

### Lambda KatmanlarÄ±

Bir Lambda _katmanÄ±_, **ekstra kod** veya diÄŸer iÃ§erikleri iÃ§erebilen bir .zip dosyasÄ± arÅŸividir. Bir katman, kÃ¼tÃ¼phaneler, [Ã¶zel Ã§alÄ±ÅŸma zamanÄ±](https://docs.aws.amazon.com/lambda/latest/dg/runtimes-custom.html), veri veya yapÄ±landÄ±rma dosyalarÄ± iÃ§erebilir.

Her fonksiyon iÃ§in en fazla **beÅŸ katman** dahil etmek mÃ¼mkÃ¼ndÃ¼r. Bir fonksiyona bir katman dahil ettiÄŸinizde, **iÃ§erikler yÃ¼rÃ¼tme ortamÄ±ndaki `/opt`** dizinine Ã§Ä±karÄ±lÄ±r.

**VarsayÄ±lan olarak**, oluÅŸturduÄŸunuz **katmanlar** AWS hesabÄ±nÄ±za **Ã¶zel**'dir. Bir katmanÄ± diÄŸer hesaplarla **paylaÅŸmayÄ±** veya katmanÄ± **genel** hale getirmeyi seÃ§ebilirsiniz. FonksiyonlarÄ±nÄ±z, farklÄ± bir hesap tarafÄ±ndan yayÄ±mlanan bir katmanÄ± tÃ¼ketirse, fonksiyonlarÄ±nÄ±z **katman silindikten sonra veya katmana eriÅŸim izniniz geri alÄ±ndÄ±ktan sonra katman sÃ¼rÃ¼mÃ¼nÃ¼ kullanmaya devam edebilir**. Ancak, silinmiÅŸ bir katman sÃ¼rÃ¼mÃ¼nÃ¼ kullanarak yeni bir fonksiyon oluÅŸturamaz veya fonksiyonlarÄ± gÃ¼ncelleyemezsiniz.

Bir konteyner gÃ¶rÃ¼ntÃ¼sÃ¼ olarak daÄŸÄ±tÄ±lan fonksiyonlar katmanlarÄ± kullanmaz. Bunun yerine, gÃ¶rÃ¼ntÃ¼yÃ¼ oluÅŸturduÄŸunuzda tercih ettiÄŸiniz Ã§alÄ±ÅŸma zamanÄ±, kÃ¼tÃ¼phaneler ve diÄŸer baÄŸÄ±mlÄ±lÄ±klarÄ± konteyner gÃ¶rÃ¼ntÃ¼sÃ¼ne paketlersiniz.

### Lambda UzantÄ±larÄ±

Lambda uzantÄ±larÄ±, Ã§eÅŸitli **izleme, gÃ¶zlemlenebilirlik, gÃ¼venlik ve yÃ¶netiÅŸim araÃ§larÄ±** ile entegre ederek fonksiyonlarÄ± geliÅŸtirir. Bu uzantÄ±lar, [.zip arÅŸivleri kullanarak Lambda katmanlarÄ±](https://docs.aws.amazon.com/lambda/latest/dg/configuration-layers.html) aracÄ±lÄ±ÄŸÄ±yla veya [konteyner gÃ¶rÃ¼ntÃ¼sÃ¼ daÄŸÄ±tÄ±mlarÄ±nda](https://aws.amazon.com/blogs/compute/working-with-lambda-layers-and-extensions-in-container-images/) dahil edilerek iki modda Ã§alÄ±ÅŸÄ±r: **iÃ§sel** ve **dÄ±ÅŸsal**.

* **Ä°Ã§sel uzantÄ±lar**, Ã§alÄ±ÅŸma zamanÄ± sÃ¼reci ile birleÅŸir, **dil spesifik ortam deÄŸiÅŸkenleri** ve **sarmalayÄ±cÄ± betikler** kullanarak baÅŸlangÄ±cÄ±nÄ± manipÃ¼le eder. Bu Ã¶zelleÅŸtirme, **Java Correto 8 ve 11, Node.js 10 ve 12, ve .NET Core 3.1** dahil olmak Ã¼zere Ã§eÅŸitli Ã§alÄ±ÅŸma zamanlarÄ±na uygulanÄ±r.
* **DÄ±ÅŸsal uzantÄ±lar**, ayrÄ± sÃ¼reÃ§ler olarak Ã§alÄ±ÅŸÄ±r ve Lambda fonksiyonunun yaÅŸam dÃ¶ngÃ¼sÃ¼ ile operasyon uyumunu sÃ¼rdÃ¼rÃ¼r. **Node.js 10 ve 12, Python 3.7 ve 3.8, Ruby 2.5 ve 2.7, Java Corretto 8 ve 11, .NET Core 3.1** ve **Ã¶zel Ã§alÄ±ÅŸma zamanlarÄ±** gibi Ã§eÅŸitli Ã§alÄ±ÅŸma zamanlarÄ±yla uyumludur.

### Enumeration
```bash
aws lambda get-account-settings

# List functions and get extra config info
aws lambda list-functions
aws lambda get-function --function-name <function_name>
aws lambda get-function-configuration --function-name <function_name>
aws lambda list-function-event-invoke-configs --function-name <function_name>
## Check for creds in env vars
aws lambda list-functions | jq '.Functions[].Environment'
## Download & check the source code
aws lambda get-function --function-name "<func_name>" --query 'Code.Location'
wget -O lambda-function.zip <url-from-previous-query>

# Get Lambda URL (if any)
aws lambda list-function-url-configs --function-name <function_name>
aws lambda get-function-url-config --function-name <function_name>

# Get who has permissions to invoke the Lambda
aws lambda get-policy --function-name <function_name>

# Versions and Aliases
aws lambda list-versions-by-function --function-name <func_name>
aws lambda list-aliases --function-name <func_name>

# List layers
aws lambda list-layers
aws lambda list-layer-versions --layer-name <name>
aws lambda get-layer-version --layer-name <name> --version-number <ver>
aws lambda get-layer-version-by-arn --arn <name> #Get external ARNs

# List other metadata
aws lambda list-event-source-mappings
aws lambda list-code-signing-configs
aws lambda list-functions-by-code-signing-config --code-signing-config-arn <arn>
```
### Bir lambda Ã§aÄŸÄ±r

#### Manuel
```bash
# Invoke function
aws lambda invoke --function-name FUNCTION_NAME /tmp/out
## Some functions will expect parameters, they will access them with something like:
## target_policys = event['policy_names']
## user_name = event['user_name']
aws lambda invoke --function-name <name> --cli-binary-format raw-in-base64-out --payload '{"policy_names": ["AdministratorAccess], "user_name": "sdf"}' out.txt
```
#### AÃ§Ä±k URL aracÄ±lÄ±ÄŸÄ±yla
```bash
aws lambda list-function-url-configs --function-name <function_name> #Get lambda URL
aws lambda get-function-url-config   --function-name <function_name> #Get lambda URL
```
#### URL Ã¼zerinden Lambda fonksiyonunu Ã§aÄŸÄ±r

ArtÄ±k Ã§alÄ±ÅŸtÄ±rÄ±labilecek olasÄ± lambda fonksiyonlarÄ±nÄ± bulma zamanÄ±:
```
aws --region us-west-2 --profile level6 lambda list-functions
```
![](<../../../.gitbook/assets/image (262).png>)

"Level6" adÄ±nda bir lambda fonksiyonu mevcut. Onu nasÄ±l Ã§aÄŸÄ±racaÄŸÄ±mÄ±zÄ± bulalÄ±m:
```bash
aws --region us-west-2 --profile level6 lambda get-policy --function-name Level6
```
![](<../../../.gitbook/assets/image (102).png>)

ArtÄ±k ismi ve kimliÄŸi bildiÄŸinize gÃ¶re, ismi alabilirsiniz:
```bash
aws --profile level6 --region us-west-2 apigateway get-stages --rest-api-id "s33ppypa75"
```
![](<../../../.gitbook/assets/image (237).png>)

Ve sonunda iÅŸlevi Ã§aÄŸÄ±rÄ±n (ID, Ad ve iÅŸlev adÄ± URL'de gÃ¶rÃ¼ndÃ¼ÄŸÃ¼ne dikkat edin): [https://s33ppypa75.execute-api.us-west-2.amazonaws.com/Prod/level6](https://s33ppypa75.execute-api.us-west-2.amazonaws.com/Prod/level6)

`URL:`**`https://<rest-api-id>.execute-api.<region>.amazonaws.com/<stageName>/<funcName>`**

#### DiÄŸer Tetikleyiciler

Bir lambda'yÄ± tetikleyebilecek birÃ§ok baÅŸka kaynak vardÄ±r.

<figure><img src="../../../.gitbook/assets/image (167).png" alt=""><figcaption></figcaption></figure>

### Privesc

AÅŸaÄŸÄ±daki sayfada **Lambda izinlerini kÃ¶tÃ¼ye kullanarak ayrÄ±calÄ±klarÄ± artÄ±rma** yÃ¶ntemini kontrol edebilirsiniz:

{% content-ref url="../aws-privilege-escalation/aws-lambda-privesc.md" %}
[aws-lambda-privesc.md](../aws-privilege-escalation/aws-lambda-privesc.md)
{% endcontent-ref %}

### Kimlik DoÄŸrulamasÄ± Olmayan EriÅŸim

{% content-ref url="../aws-unauthenticated-enum-access/aws-lambda-unauthenticated-access.md" %}
[aws-lambda-unauthenticated-access.md](../aws-unauthenticated-enum-access/aws-lambda-unauthenticated-access.md)
{% endcontent-ref %}

### Ä°stismar SonrasÄ±

{% content-ref url="../aws-post-exploitation/aws-lambda-post-exploitation/" %}
[aws-lambda-post-exploitation](../aws-post-exploitation/aws-lambda-post-exploitation/)
{% endcontent-ref %}

### SÃ¼reklilik

{% content-ref url="../aws-persistence/aws-lambda-persistence/" %}
[aws-lambda-persistence](../aws-persistence/aws-lambda-persistence/)
{% endcontent-ref %}

## Referanslar

* [https://docs.aws.amazon.com/lambda/latest/dg/gettingstarted-concepts.html#gettingstarted-concepts-layer](https://docs.aws.amazon.com/lambda/latest/dg/gettingstarted-concepts.html#gettingstarted-concepts-layer)
* [https://aws.amazon.com/blogs/compute/building-extensions-for-aws-lambda-in-preview/](https://aws.amazon.com/blogs/compute/building-extensions-for-aws-lambda-in-preview/)

{% hint style="success" %}
AWS Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n:<img src="../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">\
GCP Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**abonelik planlarÄ±nÄ±**](https://github.com/sponsors/carlospolop) kontrol edin!
* **ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n ya da **Twitter'da** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**'i takip edin.**
* **Hacking ipuÃ§larÄ±nÄ± paylaÅŸmak iÃ§in** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna PR gÃ¶nderin.

</details>
{% endhint %}
