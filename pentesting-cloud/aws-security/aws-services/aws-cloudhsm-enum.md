# AWS - CloudHSM Enum

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## HSM - Hardware Security Module

Cloud HSM je FIPS 140 nivo dva validirani **hardverski ureÄ‘aj** za sigurno skladiÅ¡tenje kriptografskih kljuÄeva (napomena da je CloudHSM hardverski ureÄ‘aj, nije virtuelizovana usluga). To je SafeNetLuna 7000 ureÄ‘aj sa preinstaliranim 5.3.13. Postoje dve verzije firmvera i koja Ä‡ete izabrati zavisi od vaÅ¡ih taÄnih potreba. Jedna je za FIPS 140-2 usklaÄ‘enost, a postoji i novija verzija koja se moÅ¾e koristiti.

NeobiÄna karakteristika CloudHSM-a je to Å¡to je fiziÄki ureÄ‘aj, i stoga **nije deljen sa drugim korisnicima**, ili kako se to obiÄno naziva, multi-tenant. To je posveÄ‡en ureÄ‘aj za jednog korisnika koji je iskljuÄivo dostupan vaÅ¡im radnim optereÄ‡enjima.

ObiÄno, ureÄ‘aj je dostupan u roku od 15 minuta pod pretpostavkom da postoji kapacitet, ali u nekim zonama to moÅ¾da neÄ‡e biti sluÄaj.

PoÅ¡to je ovo fiziÄki ureÄ‘aj posveÄ‡en vama, **kljuÄevi se Äuvaju na ureÄ‘aju**. KljuÄevi treba da budu **replicirani na drugi ureÄ‘aj**, saÄuvani na offline skladiÅ¡tu, ili eksportovani na rezervni ureÄ‘aj. **Ovaj ureÄ‘aj nije podrÅ¾an** od strane S3 ili bilo koje druge usluge na AWS-u kao Å¡to je KMS.

U **CloudHSM-u**, morate **sami skalirati uslugu**. Morate obezbediti dovoljno CloudHSM ureÄ‘aja da biste zadovoljili svoje potrebe za enkripcijom na osnovu kriptografskih algoritama koje ste izabrali da implementirate za svoje reÅ¡enje.\
Skaliranje usluge za upravljanje kljuÄevima vrÅ¡i AWS i automatski se skalira na zahtev, tako da kako se vaÅ¡a upotreba poveÄ‡ava, tako se moÅ¾e poveÄ‡ati i broj CloudHSM ureÄ‘aja koji su potrebni. Imajte ovo na umu dok skalirate svoje reÅ¡enje i ako vaÅ¡e reÅ¡enje ima automatsko skaliranje, uverite se da je vaÅ¡ maksimalni kapacitet uzet u obzir sa dovoljno CloudHSM ureÄ‘aja da podrÅ¾e reÅ¡enje.

BaÅ¡ kao Å¡to je skaliranje, **performanse su na vama sa CloudHSM**. Performanse variraju u zavisnosti od toga koji se kriptografski algoritam koristi i koliko Äesto treba da pristupite ili preuzmete kljuÄeve za enkripciju podataka. Performanse usluge za upravljanje kljuÄevima se obezbeÄ‘uju od strane Amazona i automatski se skaliraju kako to zahteva potraÅ¾nja. Performanse CloudHSM-a se postiÅ¾u dodavanjem viÅ¡e ureÄ‘aja i ako vam je potrebna veÄ‡a performansa, ili dodajete ureÄ‘aje ili menjate metodu enkripcije na algoritam koji je brÅ¾i.

Ako je vaÅ¡e reÅ¡enje **multi-region**, trebali biste dodati nekoliko **CloudHSM ureÄ‘aja u drugoj regiji i reÅ¡iti meÄ‘uregionalnu povezanost putem privatne VPN veze** ili nekog metoda kako biste osigurali da je saobraÄ‡aj uvek zaÅ¡tiÄ‡en izmeÄ‘u ureÄ‘aja na svakom sloju veze. Ako imate reÅ¡enje koje se proteÅ¾e na viÅ¡e regija, morate razmisliti o tome kako da **replicirate kljuÄeve i postavite dodatne CloudHSM ureÄ‘aje u regijama u kojima poslujete**. MoÅ¾ete vrlo brzo doÄ‡i u situaciju gde imate Å¡est ili osam ureÄ‘aja rasporeÄ‘enih po viÅ¡e regija, omoguÄ‡avajuÄ‡i potpunu redundanciju vaÅ¡ih kriptografskih kljuÄeva.

**CloudHSM** je usluga klase preduzeÄ‡a za sigurno skladiÅ¡tenje kljuÄeva i moÅ¾e se koristiti kao **root of trust za preduzeÄ‡e**. MoÅ¾e Äuvati privatne kljuÄeve u PKI i kljuÄeve sertifikacione vlasti u X509 implementacijama. Pored simetriÄnih kljuÄeva koji se koriste u simetriÄnim algoritmima kao Å¡to je AES, **KMS skladiÅ¡ti i fiziÄki Å¡titi samo simetriÄne kljuÄeve (ne moÅ¾e delovati kao sertifikaciona vlast)**, tako da ako trebate da skladiÅ¡tite PKI i CA kljuÄeve, jedan ili dva ili tri CloudHSM-a mogli bi biti vaÅ¡e reÅ¡enje.

**CloudHSM je znatno skuplji od usluge za upravljanje kljuÄevima**. CloudHSM je hardverski ureÄ‘aj, tako da imate fiksne troÅ¡kove za obezbeÄ‘ivanje CloudHSM ureÄ‘aja, a zatim satni troÅ¡ak za rad ureÄ‘aja. TroÅ¡ak se mnoÅ¾i sa onoliko CloudHSM ureÄ‘aja koliko je potrebno da se postignu vaÅ¡i specifiÄni zahtevi.\
Pored toga, treba razmotriti i kupovinu softvera treÄ‡ih strana kao Å¡to su SafeNet ProtectV softverski paketi i vreme i trud potrebni za integraciju. Usluga za upravljanje kljuÄevima je zasnovana na upotrebi i zavisi od broja kljuÄeva koje imate i operacija ulaza i izlaza. Kako usluga za upravljanje kljuÄevima pruÅ¾a besprekornu integraciju sa mnogim AWS uslugama, troÅ¡kovi integracije bi trebali biti znatno niÅ¾i. TroÅ¡kovi bi trebali biti sekundarni faktor u reÅ¡enjima za enkripciju. Enkripcija se obiÄno koristi za sigurnost i usklaÄ‘enost.

**Sa CloudHSM-om samo vi imate pristup kljuÄevima** i bez previÅ¡e detalja, sa CloudHSM-om upravljate svojim kljuÄevima. **Sa KMS-om, vi i Amazon zajedniÄki upravljate vaÅ¡im kljuÄevima**. AWS ima mnoge politike zaÅ¡tite od zloupotrebe i **i dalje ne moÅ¾e pristupiti vaÅ¡im kljuÄevima u bilo kojem reÅ¡enju**. Glavna razlika je usklaÄ‘enost u vezi sa vlasniÅ¡tvom i upravljanjem kljuÄevima, a sa CloudHSM-om, ovo je hardverski ureÄ‘aj koji vi upravljate i odrÅ¾avate sa iskljuÄivim pristupom samo vama.

### CloudHSM Suggestions

1. Uvek implementirajte CloudHSM u **HA postavci** sa najmanje dva ureÄ‘aja u **odvojenim dostupnim zonama**, a ako je moguÄ‡e, implementirajte treÄ‡i ili na lokaciji ili u drugoj regiji na AWS-u.
2. Budite oprezni kada **inicijalizujete** **CloudHSM**. Ova akcija **Ä‡e uniÅ¡titi kljuÄeve**, tako da ili imajte drugu kopiju kljuÄeva ili budite apsolutno sigurni da ih neÄ‡ete i nikada neÄ‡ete trebati za dekripciju bilo kojih podataka.
3. CloudHSM samo **podrÅ¾ava odreÄ‘ene verzije firmvera** i softvera. Pre nego Å¡to izvrÅ¡ite bilo kakvo aÅ¾uriranje, uverite se da je firmver i/ili softver podrÅ¾an od strane AWS-a. Uvek moÅ¾ete kontaktirati AWS podrÅ¡ku da proverite ako je vodiÄ za nadogradnju nejasan.
4. **Konfiguracija mreÅ¾e nikada ne bi trebala biti promenjena.** Zapamtite, to je u AWS data centru i AWS prati osnovni hardver za vas. To znaÄi da ako hardver otkaÅ¾e, oni Ä‡e ga zameniti za vas, ali samo ako znaju da je otkazao.
5. **SysLog prosleÄ‘ivanje ne bi trebalo biti uklonjeno ili promenjeno**. Uvek moÅ¾ete **dodati** SysLog prosleÄ‘ivaÄ da usmerite logove na vaÅ¡ vlastiti alat za prikupljanje.
6. **SNMP** konfiguracija ima iste osnovne restrikcije kao mreÅ¾a i SysLog folder. Ovo **ne bi trebalo biti promenjeno ili uklonjeno**. Dodatna SNMP konfiguracija je u redu, samo se uverite da ne menjate onu koja je veÄ‡ na ureÄ‘aju.
7. JoÅ¡ jedna zanimljiva najbolja praksa od AWS-a je **da ne menjate NTP konfiguraciju**. Nije jasno Å¡ta bi se desilo ako to uradite, tako da imajte na umu da ako ne koristite istu NTP konfiguraciju za ostatak vaÅ¡eg reÅ¡enja, mogli biste imati dva izvora vremena. Samo budite svesni toga i znajte da CloudHSM mora ostati sa postojeÄ‡im NTP izvorom.

PoÄetni troÅ¡ak za CloudHSM je 5,000 dolara za dodeljivanje hardverskog ureÄ‘aja posveÄ‡enog vaÅ¡oj upotrebi, a zatim postoji satni troÅ¡ak povezan sa radom CloudHSM-a koji trenutno iznosi 1.88 dolara po satu rada, ili otprilike 1,373 dolara meseÄno.

NajÄeÅ¡Ä‡i razlog za koriÅ¡Ä‡enje CloudHSM-a su standardi usklaÄ‘enosti koje morate ispuniti iz regulatornih razloga. **KMS ne nudi podrÅ¡ku za asimetriÄne kljuÄeve. CloudHSM vam omoguÄ‡ava da sigurno skladiÅ¡tite asimetriÄne kljuÄeve**.

**Javni kljuÄ se instalira na HSM ureÄ‘aju tokom dodeljivanja** tako da moÅ¾ete pristupiti CloudHSM instanci putem SSH.

### Å ta je hardverski sigurnosni modul

Hardverski sigurnosni modul (HSM) je posveÄ‡en kriptografski ureÄ‘aj koji se koristi za generisanje, skladiÅ¡tenje i upravljanje kriptografskim kljuÄevima i zaÅ¡titu osetljivih podataka. Dizajniran je da pruÅ¾i visok nivo sigurnosti fiziÄkim i elektronskim izolovanjem kriptografskih funkcija od ostatka sistema.

NaÄin na koji HSM funkcioniÅ¡e moÅ¾e varirati u zavisnosti od specifiÄnog modela i proizvoÄ‘aÄa, ali generalno, sledeÄ‡i koraci se deÅ¡avaju:

1. **Generisanje kljuÄeva**: HSM generiÅ¡e nasumiÄni kriptografski kljuÄ koristeÄ‡i siguran generator nasumiÄnih brojeva.
2. **SkladiÅ¡tenje kljuÄeva**: KljuÄ se **sigurno skladiÅ¡ti unutar HSM-a, gde mu mogu pristupiti samo ovlaÅ¡Ä‡eni korisnici ili procesi**.
3. **Upravljanje kljuÄevima**: HSM pruÅ¾a niz funkcija upravljanja kljuÄevima, ukljuÄujuÄ‡i rotaciju kljuÄeva, rezervnu kopiju i opoziv.
4. **Kriptografske operacije**: HSM obavlja niz kriptografskih operacija, ukljuÄujuÄ‡i enkripciju, dekripciju, digitalni potpis i razmenu kljuÄeva. Ove operacije se **izvode unutar sigurnog okruÅ¾enja HSM-a**, Å¡to Å¡titi od neovlaÅ¡Ä‡enog pristupa i manipulacije.
5. **Audit logovanje**: HSM beleÅ¾i sve kriptografske operacije i pokuÅ¡aje pristupa, Å¡to se moÅ¾e koristiti za usklaÄ‘enost i svrhe bezbednosnog audita.

HSM-ovi se mogu koristiti za Å¡irok spektar aplikacija, ukljuÄujuÄ‡i sigurne online transakcije, digitalne sertifikate, sigurnu komunikaciju i enkripciju podataka. ÄŒesto se koriste u industrijama koje zahtevaju visok nivo sigurnosti, kao Å¡to su finansije, zdravstvo i vlada.

Sve u svemu, visok nivo sigurnosti koji pruÅ¾aju HSM-ovi Äini **veoma teÅ¡kim da se sirovi kljuÄevi izvade iz njih, a pokuÅ¡aj da se to uradi Äesto se smatra krÅ¡enjem sigurnosti**. MeÄ‘utim, moÅ¾e postojati **odreÄ‘eni scenariji** u kojima bi **sirovi kljuÄ mogao biti izvuÄen** od strane ovlaÅ¡Ä‡enog osoblja za specifiÄne svrhe, kao Å¡to je sluÄaj postupka oporavka kljuÄeva.

### Enumeracija
```
TODO
```
{% hint style="success" %}
UÄite i veÅ¾bajte AWS Hacking:<img src="../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">\
UÄite i veÅ¾bajte GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>PodrÅ¾ite HackTricks</summary>

* Proverite [**planove pretplate**](https://github.com/sponsors/carlospolop)!
* **PridruÅ¾ite se** ğŸ’¬ [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili **pratite** nas na **Twitteru** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podelite hakerske trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
{% endhint %}
