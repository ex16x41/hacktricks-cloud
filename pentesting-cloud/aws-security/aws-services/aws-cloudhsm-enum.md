# AWS - CloudHSM Enum

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## HSM - Module de S√©curit√© Mat√©rielle

Cloud HSM est un **dispositif mat√©riel** valid√© FIPS 140 niveau deux pour le stockage s√©curis√© des cl√©s cryptographiques (notez que CloudHSM est un appareil mat√©riel, ce n'est pas un service virtualis√©). C'est un appareil SafeNetLuna 7000 avec 5.3.13 pr√©charg√©. Il existe deux versions de firmware et le choix d√©pend vraiment de vos besoins exacts. L'une est pour la conformit√© FIPS 140-2 et il y avait une version plus r√©cente qui peut √™tre utilis√©e.

La caract√©ristique inhabituelle de CloudHSM est qu'il s'agit d'un dispositif physique, et donc il **n'est pas partag√© avec d'autres clients**, ou comme on l'appelle couramment, multi-locataire. C'est un appareil d√©di√© √† un seul locataire exclusivement mis √† disposition pour vos charges de travail.

Typiquement, un appareil est disponible dans les 15 minutes, √† condition qu'il y ait de la capacit√©, mais dans certaines zones, cela pourrait ne pas √™tre le cas.

Puisqu'il s'agit d'un dispositif physique d√©di√© √† vous, **les cl√©s sont stock√©es sur l'appareil**. Les cl√©s doivent soit √™tre **r√©pliqu√©es sur un autre appareil**, sauvegard√©es sur un stockage hors ligne, ou export√©es vers un appareil de secours. **Cet appareil n'est pas soutenu** par S3 ou tout autre service d'AWS comme KMS.

Dans **CloudHSM**, vous devez **scaler le service vous-m√™me**. Vous devez provisionner suffisamment d'appareils CloudHSM pour g√©rer vos besoins de cryptage en fonction des algorithmes de cryptage que vous avez choisis d'impl√©menter pour votre solution.\
Le service de gestion des cl√©s est √©volu√© par AWS et s'adapte automatiquement √† la demande, donc √† mesure que votre utilisation augmente, le nombre d'appareils CloudHSM requis peut √©galement augmenter. Gardez cela √† l'esprit lorsque vous √©voluez votre solution et si votre solution a un auto-scaling, assurez-vous que votre √©chelle maximale est prise en compte avec suffisamment d'appareils CloudHSM pour servir la solution.

Tout comme le scaling, **la performance d√©pend de vous avec CloudHSM**. La performance varie en fonction de l'algorithme de cryptage utilis√© et de la fr√©quence √† laquelle vous devez acc√©der ou r√©cup√©rer les cl√©s pour chiffrer les donn√©es. La performance du service de gestion des cl√©s est g√©r√©e par Amazon et s'adapte automatiquement √† la demande. La performance de CloudHSM est obtenue en ajoutant plus d'appareils et si vous avez besoin de plus de performance, vous ajoutez des dispositifs ou modifiez la m√©thode de cryptage vers l'algorithme qui est plus rapide.

Si votre solution est **multi-r√©gion**, vous devriez ajouter plusieurs **appareils CloudHSM dans la deuxi√®me r√©gion et √©tablir la connectivit√© inter-r√©gionale avec une connexion VPN priv√©e** ou une m√©thode pour garantir que le trafic est toujours prot√©g√© entre l'appareil √† chaque couche de la connexion. Si vous avez une solution multi-r√©gion, vous devez r√©fl√©chir √† la mani√®re de **r√©pliquer les cl√©s et de configurer des appareils CloudHSM suppl√©mentaires dans les r√©gions o√π vous op√©rez**. Vous pouvez rapidement vous retrouver dans un sc√©nario o√π vous avez six ou huit appareils r√©partis sur plusieurs r√©gions, permettant une redondance compl√®te de vos cl√©s de cryptage.

**CloudHSM** est un service de classe entreprise pour le stockage s√©curis√© des cl√©s et peut √™tre utilis√© comme un **racine de confiance pour une entreprise**. Il peut stocker des cl√©s priv√©es dans PKI et des cl√©s d'autorit√© de certification dans des impl√©mentations X509. En plus des cl√©s sym√©triques utilis√©es dans des algorithmes sym√©triques tels que AES, **KMS stocke et prot√®ge physiquement uniquement les cl√©s sym√©triques (ne peut pas agir en tant qu'autorit√© de certification)**, donc si vous devez stocker des cl√©s PKI et CA, un ou deux ou trois CloudHSM pourraient √™tre votre solution.

**CloudHSM est consid√©rablement plus co√ªteux que le service de gestion des cl√©s**. CloudHSM est un appareil mat√©riel, donc vous avez des co√ªts fixes pour provisionner l'appareil CloudHSM, puis un co√ªt horaire pour faire fonctionner l'appareil. Le co√ªt est multipli√© par le nombre d'appareils CloudHSM n√©cessaires pour atteindre vos exigences sp√©cifiques.\
De plus, une consid√©ration crois√©e doit √™tre faite lors de l'achat de logiciels tiers tels que les suites logicielles SafeNet ProtectV et le temps et l'effort d'int√©gration. Le service de gestion des cl√©s est bas√© sur l'utilisation et d√©pend du nombre de cl√©s que vous avez et des op√©rations d'entr√©e et de sortie. Comme la gestion des cl√©s fournit une int√©gration transparente avec de nombreux services AWS, les co√ªts d'int√©gration devraient √™tre consid√©rablement inf√©rieurs. Les co√ªts doivent √™tre consid√©r√©s comme un facteur secondaire dans les solutions de cryptage. Le cryptage est g√©n√©ralement utilis√© pour la s√©curit√© et la conformit√©.

**Avec CloudHSM, vous seul avez acc√®s aux cl√©s** et sans entrer dans trop de d√©tails, avec CloudHSM, vous g√©rez vos propres cl√©s. **Avec KMS, vous et Amazon co-gestionez vos cl√©s**. AWS a de nombreuses protections politiques contre les abus et **ne peut toujours pas acc√©der √† vos cl√©s dans l'une ou l'autre solution**. La principale distinction est la conformit√© en ce qui concerne la propri√©t√© et la gestion des cl√©s, et avec CloudHSM, il s'agit d'un appareil mat√©riel que vous g√©rez et maintenez avec un acc√®s exclusif √† vous et seulement √† vous.

### Suggestions CloudHSM

1. D√©ployez toujours CloudHSM dans une **configuration HA** avec au moins deux appareils dans **des zones de disponibilit√© s√©par√©es**, et si possible, d√©ployez un troisi√®me soit sur site soit dans une autre r√©gion chez AWS.
2. Faites attention lors de **l'initialisation** d'un **CloudHSM**. Cette action **d√©truira les cl√©s**, donc soit ayez une autre copie des cl√©s, soit soyez absolument s√ªr que vous n'en aurez pas besoin pour d√©chiffrer des donn√©es.
3. CloudHSM ne **supporte que certaines versions de firmware** et de logiciels. Avant d'effectuer une mise √† jour, assurez-vous que le firmware et/ou le logiciel est support√© par AWS. Vous pouvez toujours contacter le support AWS pour v√©rifier si le guide de mise √† niveau n'est pas clair.
4. La **configuration r√©seau ne doit jamais √™tre chang√©e.** Rappelez-vous, c'est dans un centre de donn√©es AWS et AWS surveille le mat√©riel de base pour vous. Cela signifie que si le mat√©riel √©choue, ils le remplaceront pour vous, mais seulement s'ils savent qu'il a √©chou√©.
5. Le **SysLog forward ne doit pas √™tre supprim√© ou modifi√©**. Vous pouvez toujours **ajouter** un forwarder SysLog pour diriger les journaux vers votre propre outil de collecte.
6. La configuration **SNMP** a les m√™mes restrictions de base que le r√©seau et le dossier SysLog. Cela **ne doit pas √™tre chang√© ou supprim√©**. Une configuration SNMP **suppl√©mentaire** est acceptable, assurez-vous simplement de ne pas changer celle qui est d√©j√† sur l'appareil.
7. Une autre bonne pratique int√©ressante d'AWS est **de ne pas changer la configuration NTP**. Il n'est pas clair ce qui se passerait si vous le faisiez, donc gardez √† l'esprit que si vous n'utilisez pas la m√™me configuration NTP pour le reste de votre solution, vous pourriez avoir deux sources de temps. Soyez simplement conscient de cela et sachez que le CloudHSM doit rester avec la source NTP existante.

Le co√ªt initial de lancement pour CloudHSM est de 5 000 $ pour allouer l'appareil mat√©riel d√©di√© √† votre usage, puis il y a un co√ªt horaire associ√© √† l'ex√©cution de CloudHSM qui est actuellement de 1,88 $ par heure d'op√©ration, ou environ 1 373 $ par mois.

La raison la plus courante d'utiliser CloudHSM est les normes de conformit√© que vous devez respecter pour des raisons r√©glementaires. **KMS n'offre pas de support de donn√©es pour les cl√©s asym√©triques. CloudHSM vous permet de stocker des cl√©s asym√©triques en toute s√©curit√©**.

La **cl√© publique est install√©e sur l'appareil HSM lors du provisionnement** afin que vous puissiez acc√©der √† l'instance CloudHSM via SSH.

### Qu'est-ce qu'un Module de S√©curit√© Mat√©rielle

Un module de s√©curit√© mat√©rielle (HSM) est un dispositif cryptographique d√©di√© qui est utilis√© pour g√©n√©rer, stocker et g√©rer des cl√©s cryptographiques et prot√©ger des donn√©es sensibles. Il est con√ßu pour fournir un niveau √©lev√© de s√©curit√© en isolant physiquement et √©lectroniquement les fonctions cryptographiques du reste du syst√®me.

Le fonctionnement d'un HSM peut varier en fonction du mod√®le et du fabricant sp√©cifiques, mais g√©n√©ralement, les √©tapes suivantes se produisent :

1. **G√©n√©ration de cl√©s** : Le HSM g√©n√®re une cl√© cryptographique al√©atoire √† l'aide d'un g√©n√©rateur de nombres al√©atoires s√©curis√©.
2. **Stockage de cl√©s** : La cl√© est **stock√©e en toute s√©curit√© dans le HSM, o√π elle ne peut √™tre accessible que par des utilisateurs ou des processus autoris√©s**.
3. **Gestion des cl√©s** : Le HSM fournit une gamme de fonctions de gestion des cl√©s, y compris la rotation des cl√©s, la sauvegarde et la r√©vocation.
4. **Op√©rations cryptographiques** : Le HSM effectue une gamme d'op√©rations cryptographiques, y compris le chiffrement, le d√©chiffrement, la signature num√©rique et l'√©change de cl√©s. Ces op√©rations sont **effectu√©es dans l'environnement s√©curis√© du HSM**, ce qui prot√®ge contre l'acc√®s non autoris√© et la falsification.
5. **Journalisation des audits** : Le HSM enregistre toutes les op√©rations cryptographiques et les tentatives d'acc√®s, qui peuvent √™tre utilis√©es √† des fins de conformit√© et d'audit de s√©curit√©.

Les HSM peuvent √™tre utilis√©s pour une large gamme d'applications, y compris les transactions en ligne s√©curis√©es, les certificats num√©riques, les communications s√©curis√©es et le chiffrement des donn√©es. Ils sont souvent utilis√©s dans des secteurs qui n√©cessitent un niveau √©lev√© de s√©curit√©, tels que la finance, la sant√© et le gouvernement.

Dans l'ensemble, le niveau √©lev√© de s√©curit√© fourni par les HSM rend **tr√®s difficile l'extraction de cl√©s brutes d'eux, et tenter de le faire est souvent consid√©r√© comme une violation de la s√©curit√©**. Cependant, il peut y avoir **certaines situations** o√π une **cl√© brute pourrait √™tre extraite** par du personnel autoris√© √† des fins sp√©cifiques, comme dans le cas d'une proc√©dure de r√©cup√©ration de cl√©s.

### √ânum√©ration
```
TODO
```
{% hint style="success" %}
Apprenez et pratiquez le hacking AWS :<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks Formation Expert Red Team AWS (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
Apprenez et pratiquez le hacking GCP : <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Formation Expert Red Team GCP (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Soutenir HackTricks</summary>

* Consultez les [**plans d'abonnement**](https://github.com/sponsors/carlospolop)!
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez** nous sur **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Partagez des astuces de hacking en soumettant des PRs aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) d√©p√¥ts github.

</details>
{% endhint %}
