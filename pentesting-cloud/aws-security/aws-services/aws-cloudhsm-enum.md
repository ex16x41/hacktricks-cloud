# AWS - CloudHSM Enum

{% hint style="success" %}
Lernen & √ºben Sie AWS Hacking:<img src="../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">\
Lernen & √ºben Sie GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* √úberpr√ºfen Sie die [**Abonnementpl√§ne**](https://github.com/sponsors/carlospolop)!
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teilen Sie Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repos senden.

</details>
{% endhint %}

## HSM - Hardware Security Module

Cloud HSM ist ein FIPS 140 Level zwei validiertes **Hardwareger√§t** zur sicheren Speicherung kryptografischer Schl√ºssel (beachten Sie, dass CloudHSM ein Hardwareger√§t ist, es ist kein virtualisierter Dienst). Es handelt sich um ein SafeNetLuna 7000 Ger√§t mit 5.3.13 vorinstalliert. Es gibt zwei Firmware-Versionen, und welche Sie w√§hlen, h√§ngt wirklich von Ihren genauen Bed√ºrfnissen ab. Eine ist f√ºr die FIPS 140-2-Konformit√§t und es gab eine neuere Version, die verwendet werden kann.

Das ungew√∂hnliche Merkmal von CloudHSM ist, dass es ein physisches Ger√§t ist und daher **nicht mit anderen Kunden geteilt wird**, oder wie es allgemein genannt wird, multi-tenant. Es ist ein dediziertes Single-Tenant-Ger√§t, das ausschlie√ülich f√ºr Ihre Workloads zur Verf√ºgung steht.

Typischerweise ist ein Ger√§t innerhalb von 15 Minuten verf√ºgbar, vorausgesetzt, es gibt Kapazit√§t, aber in einigen Zonen k√∂nnte dies nicht der Fall sein.

Da dies ein physisches Ger√§t ist, das Ihnen gewidmet ist, **werden die Schl√ºssel auf dem Ger√§t gespeichert**. Schl√ºssel m√ºssen entweder **auf ein anderes Ger√§t repliziert**, in Offline-Speicher gesichert oder auf ein Standby-Ger√§t exportiert werden. **Dieses Ger√§t wird nicht** von S3 oder einem anderen Dienst bei AWS wie KMS unterst√ºtzt.

In **CloudHSM** m√ºssen Sie **den Dienst selbst skalieren**. Sie m√ºssen gen√ºgend CloudHSM-Ger√§te bereitstellen, um Ihre Verschl√ºsselungsbed√ºrfnisse basierend auf den Verschl√ºsselungsalgorithmen, die Sie f√ºr Ihre L√∂sung implementieren m√∂chten, zu erf√ºllen.\
Die Skalierung des Key Management Service erfolgt durch AWS und skaliert automatisch nach Bedarf, sodass mit dem Wachstum Ihrer Nutzung m√∂glicherweise auch die Anzahl der ben√∂tigten CloudHSM-Ger√§te steigt. Behalten Sie dies im Hinterkopf, w√§hrend Sie Ihre L√∂sung skalieren, und wenn Ihre L√∂sung Auto-Scaling hat, stellen Sie sicher, dass Ihre maximale Skalierung mit gen√ºgend CloudHSM-Ger√§ten ber√ºcksichtigt wird, um die L√∂sung zu bedienen.

Genau wie bei der Skalierung liegt die **Leistung bei Ihnen mit CloudHSM**. Die Leistung variiert je nach verwendetem Verschl√ºsselungsalgorithmus und wie oft Sie auf die Schl√ºssel zugreifen oder sie abrufen m√ºssen, um die Daten zu verschl√ºsseln. Die Leistung des Key Management Service wird von Amazon verwaltet und skaliert automatisch, wenn die Nachfrage es erfordert. Die Leistung von CloudHSM wird durch das Hinzuf√ºgen weiterer Ger√§te erreicht, und wenn Sie mehr Leistung ben√∂tigen, f√ºgen Sie entweder Ger√§te hinzu oder √§ndern die Verschl√ºsselungsmethode auf den schnelleren Algorithmus.

Wenn Ihre L√∂sung **multi-region** ist, sollten Sie mehrere **CloudHSM-Ger√§te in der zweiten Region hinzuf√ºgen und die interregionale Konnektivit√§t mit einer privaten VPN-Verbindung** oder einer Methode sicherstellen, um den Datenverkehr auf jeder Ebene der Verbindung immer zu sch√ºtzen. Wenn Sie eine Multi-Region-L√∂sung haben, m√ºssen Sie dar√ºber nachdenken, wie Sie **Schl√ºssel replizieren und zus√§tzliche CloudHSM-Ger√§te in den Regionen einrichten, in denen Sie t√§tig sind**. Sie k√∂nnen sehr schnell in ein Szenario geraten, in dem Sie sechs oder acht Ger√§te √ºber mehrere Regionen verteilt haben, was eine vollst√§ndige Redundanz Ihrer Verschl√ºsselungsschl√ºssel erm√∂glicht.

**CloudHSM** ist ein Unternehmensdienst f√ºr die sichere Speicherung von Schl√ºsseln und kann als **Root of Trust f√ºr ein Unternehmen** verwendet werden. Es kann private Schl√ºssel in PKI und Schl√ºssel von Zertifizierungsstellen in X509-Implementierungen speichern. Neben symmetrischen Schl√ºsseln, die in symmetrischen Algorithmen wie AES verwendet werden, **speichert und sch√ºtzt KMS nur symmetrische Schl√ºssel physisch (kann nicht als Zertifizierungsstelle fungieren)**, sodass, wenn Sie PKI- und CA-Schl√ºssel speichern m√ºssen, ein oder zwei oder drei CloudHSM Ihre L√∂sung sein k√∂nnten.

**CloudHSM ist erheblich teurer als der Key Management Service**. CloudHSM ist ein Hardwareger√§t, sodass Sie feste Kosten f√ºr die Bereitstellung des CloudHSM-Ger√§ts haben, dann gibt es eine st√ºndliche Geb√ºhr f√ºr den Betrieb des Ger√§ts, die derzeit bei 1,88 USD pro Betriebsstunde liegt, oder etwa 1.373 USD pro Monat.

Der h√§ufigste Grund f√ºr die Verwendung von CloudHSM sind Compliance-Standards, die Sie aus regulatorischen Gr√ºnden erf√ºllen m√ºssen. **KMS bietet keine Unterst√ºtzung f√ºr asymmetrische Schl√ºssel. CloudHSM erm√∂glicht es Ihnen, asymmetrische Schl√ºssel sicher zu speichern**.

Der **√∂ffentliche Schl√ºssel wird w√§hrend der Bereitstellung auf dem HSM-Ger√§t installiert**, sodass Sie auf die CloudHSM-Instanz √ºber SSH zugreifen k√∂nnen.

### Was ist ein Hardware Security Module

Ein Hardware-Sicherheitsmodul (HSM) ist ein dediziertes kryptografisches Ger√§t, das zur Generierung, Speicherung und Verwaltung kryptografischer Schl√ºssel und zum Schutz sensibler Daten verwendet wird. Es ist so konzipiert, dass es ein hohes Ma√ü an Sicherheit bietet, indem es die kryptografischen Funktionen physisch und elektronisch vom Rest des Systems isoliert.

Die Funktionsweise eines HSM kann je nach spezifischem Modell und Hersteller variieren, aber im Allgemeinen treten die folgenden Schritte auf:

1. **Schl√ºsselgenerierung**: Das HSM generiert einen zuf√§lligen kryptografischen Schl√ºssel mit einem sicheren Zufallszahlengenerator.
2. **Schl√ºsselspeicherung**: Der Schl√ºssel wird **sicher innerhalb des HSM gespeichert, wo er nur von autorisierten Benutzern oder Prozessen** abgerufen werden kann.
3. **Schl√ºsselverwaltung**: Das HSM bietet eine Reihe von Funktionen zur Schl√ºsselverwaltung, einschlie√ülich Schl√ºsselrotation, Backup und Widerruf.
4. **Kryptografische Operationen**: Das HSM f√ºhrt eine Reihe von kryptografischen Operationen durch, einschlie√ülich Verschl√ºsselung, Entschl√ºsselung, digitale Signatur und Schl√ºsselaustausch. Diese Operationen werden **innerhalb der sicheren Umgebung des HSM** durchgef√ºhrt, die unbefugten Zugriff und Manipulation sch√ºtzt.
5. **Audit-Protokollierung**: Das HSM protokolliert alle kryptografischen Operationen und Zugriffsversuche, die f√ºr Compliance- und Sicherheitspr√ºfungszwecke verwendet werden k√∂nnen.

HSMs k√∂nnen f√ºr eine Vielzahl von Anwendungen verwendet werden, einschlie√ülich sicherer Online-Transaktionen, digitaler Zertifikate, sicherer Kommunikation und Datenverschl√ºsselung. Sie werden h√§ufig in Branchen eingesetzt, die ein hohes Ma√ü an Sicherheit erfordern, wie z.B. Finanzen, Gesundheitswesen und Regierung.

Insgesamt macht das hohe Ma√ü an Sicherheit, das HSMs bieten, es **sehr schwierig, rohe Schl√ºssel von ihnen zu extrahieren, und der Versuch, dies zu tun, wird oft als Sicherheitsverletzung angesehen**. Es kann jedoch **bestimmte Szenarien** geben, in denen ein **roher Schl√ºssel** von autorisiertem Personal f√ºr spezifische Zwecke extrahiert werden k√∂nnte, wie im Falle eines Schl√ºsselwiederherstellungsverfahrens.

### Enumeration
```
TODO
```
{% hint style="success" %}
Lerne & √ºbe AWS Hacking:<img src="../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">\
Lerne & √ºbe GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Unterst√ºtze HackTricks</summary>

* √úberpr√ºfe die [**Abonnementpl√§ne**](https://github.com/sponsors/carlospolop)!
* **Tritt der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folge** uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teile Hacking-Tricks, indem du PRs zu den** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repos einreichst.

</details>
{% endhint %}
