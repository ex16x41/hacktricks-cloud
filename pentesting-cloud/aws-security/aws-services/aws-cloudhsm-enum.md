# AWS - CloudHSM Enum

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the**  [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter**  [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## HSM - Hardware Security Module

Cloud HSM to zweryfikowane urzdzenie **sprztowe** na poziomie FIPS 140, przeznaczone do bezpiecznego przechowywania kluczy kryptograficznych (zauwa偶, 偶e CloudHSM to urzdzenie sprztowe, a nie usuga wirtualizowana). Jest to urzdzenie SafeNetLuna 7000 z wstpnie zaadowanym oprogramowaniem 5.3.13. Istniej dwie wersje oprogramowania ukadowego, a wyb贸r zale偶y od Twoich dokadnych potrzeb. Jedna jest zgodna z FIPS 140-2, a druga to nowsza wersja, kt贸ra mo偶e by u偶ywana.

Niezwyk cech CloudHSM jest to, 偶e jest to fizyczne urzdzenie, a zatem **nie jest dzielone z innymi klientami**, lub jak to si powszechnie okrela, jest wielo-tenantowe. Jest to dedykowane urzdzenie dla jednego klienta, dostpne wycznie dla Twoich obci偶e.

Zazwyczaj urzdzenie jest dostpne w cigu 15 minut, zakadajc, 偶e jest dostpna pojemno, ale w niekt贸rych strefach mo偶e jej nie by.

Poniewa偶 jest to fizyczne urzdzenie dedykowane dla Ciebie, **klucze s przechowywane na urzdzeniu**. Klucze musz by **replikowane na inne urzdzenie**, archiwizowane w pamici offline lub eksportowane do urzdzenia zapasowego. **To urzdzenie nie jest wspierane** przez S3 ani 偶adn inn usug w AWS, tak jak KMS.

W **CloudHSM** musisz **samodzielnie skalowa usug**. Musisz przydzieli wystarczajc liczb urzdze CloudHSM, aby obsu偶y Twoje potrzeby zwizane z szyfrowaniem, w zale偶noci od algorytm贸w szyfrowania, kt贸re wybrae do wdro偶enia w swoim rozwizaniu.\
Skalowanie usugi zarzdzania kluczami jest realizowane przez AWS i automatycznie dostosowuje si do potrzeb, wic w miar wzrostu u偶ycia mo偶e wzrosn r贸wnie偶 liczba wymaganych urzdze CloudHSM. Pamitaj o tym, gdy skalujesz swoje rozwizanie, a jeli Twoje rozwizanie ma automatyczne skalowanie, upewnij si, 偶e maksymalna skala uwzgldnia wystarczajc liczb urzdze CloudHSM do obsugi rozwizania.

Podobnie jak w przypadku skalowania, **wydajno zale偶y od Ciebie w CloudHSM**. Wydajno r贸偶ni si w zale偶noci od u偶ywanego algorytmu szyfrowania oraz od tego, jak czsto musisz uzyskiwa dostp do kluczy lub je pobiera, aby zaszyfrowa dane. Wydajno usugi zarzdzania kluczami jest obsugiwana przez Amazon i automatycznie dostosowuje si do wymaga. Wydajno CloudHSM osiga si poprzez dodawanie kolejnych urzdze, a jeli potrzebujesz wikszej wydajnoci, dodajesz urzdzenia lub zmieniasz metod szyfrowania na szybszy algorytm.

Jeli Twoje rozwizanie jest **wieloregionowe**, powiniene doda kilka **urzdze CloudHSM w drugim regionie i ustali czno midzyregionow za pomoc prywatnego poczenia VPN** lub innej metody, aby zapewni, 偶e ruch jest zawsze chroniony na ka偶dym poziomie poczenia. Jeli masz rozwizanie wieloregionowe, musisz pomyle o tym, jak **replikowa klucze i skonfigurowa dodatkowe urzdzenia CloudHSM w regionach, w kt贸rych dziaasz**. Mo偶esz szybko znale藕 si w sytuacji, w kt贸rej masz sze lub osiem urzdze rozo偶onych w wielu regionach, co umo偶liwia pen redundancj Twoich kluczy szyfrowania.

**CloudHSM** to usuga klasy enterprise do bezpiecznego przechowywania kluczy i mo偶e by u偶ywana jako **punkt zaufania dla przedsibiorstwa**. Mo偶e przechowywa klucze prywatne w PKI oraz klucze urzd贸w certyfikacji w implementacjach X509. Opr贸cz kluczy symetrycznych u偶ywanych w algorytmach symetrycznych, takich jak AES, **KMS przechowuje i fizycznie chroni tylko klucze symetryczne (nie mo偶e dziaa jako urzd certyfikacji)**, wic jeli potrzebujesz przechowywa klucze PKI i CA, jedno lub dwa urzdzenia CloudHSM mog by Twoim rozwizaniem.

**CloudHSM jest znacznie dro偶szy ni偶 usuga zarzdzania kluczami**. CloudHSM to urzdzenie sprztowe, wic masz stae koszty zwizane z przydzieleniem urzdzenia CloudHSM, a nastpnie koszt godzinowy za dziaanie urzdzenia. Koszt jest mno偶ony przez liczb wymaganych urzdze CloudHSM, aby osign Twoje specyficzne wymagania.\
Dodatkowo, nale偶y uwzgldni koszty zakupu oprogramowania firm trzecich, takich jak zestawy oprogramowania SafeNet ProtectV oraz czas i wysiek zwizany z integracj. Usuga zarzdzania kluczami jest oparta na u偶yciu i zale偶y od liczby kluczy, kt贸re posiadasz, oraz operacji wejcia i wyjcia. Poniewa偶 zarzdzanie kluczami zapewnia bezproblemow integracj z wieloma usugami AWS, koszty integracji powinny by znacznie ni偶sze. Koszty powinny by traktowane jako czynnik drugorzdny w rozwizaniach szyfrowania. Szyfrowanie jest zazwyczaj u偶ywane w celu zapewnienia bezpieczestwa i zgodnoci.

**Tylko Ty masz dostp do kluczy w CloudHSM** i nie wchodzc w zbyt wiele szczeg贸贸w, w CloudHSM zarzdzasz swoimi wasnymi kluczami. **W KMS Ty i Amazon wsp贸zarzdzacie swoimi kluczami**. AWS ma wiele zabezpiecze politycznych przeciwko nadu偶yciom i **nadal nie mo偶e uzyska dostpu do Twoich kluczy w 偶adnym z rozwiza**. G贸wna r贸偶nica polega na zgodnoci, jeli chodzi o wasno i zarzdzanie kluczami, a w CloudHSM jest to urzdzenie sprztowe, kt贸rym zarzdzasz i utrzymujesz z wycznym dostpem tylko dla Ciebie.

### CloudHSM Suggestions

1. Zawsze wdra偶aj CloudHSM w **konfiguracji HA** z co najmniej dwoma urzdzeniami w **oddzielnych strefach dostpnoci**, a jeli to mo偶liwe, wdro偶 trzeci, albo lokalnie, albo w innym regionie AWS.
2. Bd藕 ostro偶ny podczas **inicjalizacji** **CloudHSM**. Ta akcja **zniszczy klucze**, wic albo miej inn kopi kluczy, albo bd藕 absolutnie pewny, 偶e nie bdziesz ich potrzebowa do odszyfrowania jakichkolwiek danych.
3. CloudHSM obsuguje tylko **okrelone wersje oprogramowania ukadowego** i oprogramowania. Przed wykonaniem jakiejkolwiek aktualizacji upewnij si, 偶e oprogramowanie ukadowe i/lub oprogramowanie jest obsugiwane przez AWS. Zawsze mo偶esz skontaktowa si z pomoc techniczn AWS, aby zweryfikowa, czy przewodnik aktualizacji jest niejasny.
4. **Konfiguracja sieciowa nigdy nie powinna by zmieniana.** Pamitaj, 偶e znajduje si w centrum danych AWS, a AWS monitoruje podstawowy sprzt za Ciebie. Oznacza to, 偶e jeli sprzt zawiedzie, wymieni go za Ciebie, ale tylko jeli bd wiedzie, 偶e zawi贸d.
5. **Przekazywanie SysLog nie powinno by usuwane ani zmieniane**. Zawsze mo偶esz **doda** przekaznik SysLog, aby skierowa logi do swojego narzdzia zbierajcego.
6. Konfiguracja **SNMP** ma te same podstawowe ograniczenia co sie i folder SysLog. To **nie powinno by zmieniane ani usuwane**. Dodatkowa konfiguracja SNMP jest w porzdku, po prostu upewnij si, 偶e nie zmieniasz tej, kt贸ra ju偶 znajduje si na urzdzeniu.
7. Inn interesujc najlepsz praktyk od AWS jest **niezmienianie konfiguracji NTP**. Nie jest jasne, co by si stao, gdyby to zrobi, wic pamitaj, 偶e jeli nie u偶ywasz tej samej konfiguracji NTP dla reszty swojego rozwizania, mo偶esz mie dwa 藕r贸da czasu. Bd藕 tego wiadomy i wiedz, 偶e CloudHSM musi pozosta przy istniejcym 藕r贸dle NTP.

Pocztkowa opata za uruchomienie CloudHSM wynosi 5 000 USD za przydzielenie sprztowego urzdzenia dedykowanego do Twojego u偶ytku, a nastpnie jest opata godzinowa zwizana z dziaaniem CloudHSM, kt贸ra obecnie wynosi 1,88 USD za godzin dziaania, czyli okoo 1 373 USD miesicznie.

Najczstszym powodem korzystania z CloudHSM s standardy zgodnoci, kt贸re musisz speni z powod贸w regulacyjnych. **KMS nie oferuje wsparcia dla kluczy asymetrycznych. CloudHSM pozwala na bezpieczne przechowywanie kluczy asymetrycznych**.

**Klucz publiczny jest instalowany na urzdzeniu HSM podczas przydzielania**, aby m贸g uzyska dostp do instancji CloudHSM za pomoc SSH.

### What is a Hardware Security Module

Modu bezpieczestwa sprztowego (HSM) to dedykowane urzdzenie kryptograficzne, kt贸re su偶y do generowania, przechowywania i zarzdzania kluczami kryptograficznymi oraz ochrony wra偶liwych danych. Zostao zaprojektowane w celu zapewnienia wysokiego poziomu bezpieczestwa poprzez fizyczne i elektroniczne izolowanie funkcji kryptograficznych od reszty systemu.

Spos贸b dziaania HSM mo偶e si r贸偶ni w zale偶noci od konkretnego modelu i producenta, ale og贸lnie wystpuj nastpujce kroki:

1. **Generowanie kluczy**: HSM generuje losowy klucz kryptograficzny za pomoc bezpiecznego generatora liczb losowych.
2. **Przechowywanie kluczy**: Klucz jest **bezpiecznie przechowywany w HSM, gdzie mo偶e by dostpny tylko dla autoryzowanych u偶ytkownik贸w lub proces贸w**.
3. **Zarzdzanie kluczami**: HSM zapewnia szereg funkcji zarzdzania kluczami, w tym rotacj kluczy, kopie zapasowe i uniewa偶nianie.
4. **Operacje kryptograficzne**: HSM wykonuje szereg operacji kryptograficznych, w tym szyfrowanie, deszyfrowanie, podpis cyfrowy i wymian kluczy. Operacje te s **wykonywane w bezpiecznym rodowisku HSM**, co chroni przed nieautoryzowanym dostpem i manipulacj.
5. **Rejestrowanie audyt贸w**: HSM rejestruje wszystkie operacje kryptograficzne i pr贸by dostpu, kt贸re mog by u偶ywane do cel贸w zgodnoci i audytu bezpieczestwa.

HSM mog by u偶ywane w szerokim zakresie zastosowa, w tym w bezpiecznych transakcjach online, certyfikatach cyfrowych, bezpiecznej komunikacji i szyfrowaniu danych. Czsto s stosowane w bran偶ach, kt贸re wymagaj wysokiego poziomu bezpieczestwa, takich jak finanse, opieka zdrowotna i rzd.

Og贸lnie rzecz biorc, wysoki poziom bezpieczestwa zapewniany przez HSM sprawia, 偶e **bardzo trudno jest wydoby surowe klucze z nich, a pr贸ba ich wydobycia jest czsto uwa偶ana za naruszenie bezpieczestwa**. Jednak mog wystpi **pewne scenariusze**, w kt贸rych **surowy klucz m贸gby zosta wydobyty** przez upowa偶niony personel w okrelonych celach, na przykad w przypadku procedury odzyskiwania kluczy.

### Enumeration
```
TODO
```
{% hint style="success" %}
Ucz si i wicz Hacking AWS:<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
Ucz si i wicz Hacking GCP: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Wsparcie HackTricks</summary>

* Sprawd藕 [**plany subskrypcyjne**](https://github.com/sponsors/carlospolop)!
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegram**](https://t.me/peass) lub **led藕** nas na **Twitterze**  [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Dziel si sztuczkami hackingowymi, przesyajc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repozytori贸w github.

</details>
{% endhint %}
