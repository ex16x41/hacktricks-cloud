# AWS - KMS Enum

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ЁЯТм [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ЁЯРж [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## KMS - Key Management Service

AWS Key Management Service (AWS KMS) рдХреЛ рдПрдХ рдкреНрд░рдмрдВрдзрд┐рдд рд╕реЗрд╡рд╛ рдХреЗ рд░реВрдк рдореЗрдВ рдкреНрд░рд╕реНрддреБрдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рдЬреЛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЗ рд▓рд┐рдП **рдЧреНрд░рд╛рд╣рдХ рдорд╛рд╕реНрдЯрд░ рдХреБрдВрдЬреА** (CMKs) **рдмрдирд╛рдиреЗ рдФрд░ рдкреНрд░рдмрдВрдзрд┐рдд рдХрд░рдиреЗ** рдХреА рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЛ рд╕рд░рд▓ рдмрдирд╛рддрд╛ рд╣реИред рдпреЗ CMKs рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдбреЗрдЯрд╛ рдХреЗ рдПрдиреНрдХреНрд░рд┐рдкреНрд╢рди рдореЗрдВ рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣реИрдВред AWS KMS рдХреА рдПрдХ рдЙрд▓реНрд▓реЗрдЦрдиреАрдп рд╡рд┐рд╢реЗрд╖рддрд╛ рдпрд╣ рд╣реИ рдХрд┐ CMKs рдореБрдЦреНрдп рд░реВрдк рд╕реЗ **рд╣рд╛рд░реНрдбрд╡реЗрдпрд░ рд╕реБрд░рдХреНрд╖рд╛ рдореЙрдбреНрдпреВрд▓** (HSMs) рджреНрд╡рд╛рд░рд╛ **рд╕реБрд░рдХреНрд╖рд┐рдд** рд╣реЛрддреЗ рд╣реИрдВ, рдЬреЛ рдПрдиреНрдХреНрд░рд┐рдкреНрд╢рди рдХреБрдВрдЬрд┐рдпреЛрдВ рдХреА рд╕реБрд░рдХреНрд╖рд╛ рдХреЛ рдмрдврд╝рд╛рддреЗ рд╣реИрдВред

KMS **рд╕рдорд╛рдирд╛рдВрддрд░ рдХреНрд░рд┐рдкреНрдЯреЛрдЧреНрд░рд╛рдлреА** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИред рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ **рдЬрд╛рдирдХрд╛рд░реА рдХреЛ рдЖрд░рд╛рдо рдореЗрдВ рдПрдиреНрдХреНрд░рд┐рдкреНрдЯ рдХрд░рдиреЗ** рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ (рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, S3 рдХреЗ рдЕрдВрджрд░)ред рдпрджрд┐ рдЖрдкрдХреЛ **рдЬрд╛рдирдХрд╛рд░реА рдХреЛ рдЯреНрд░рд╛рдВрдЬрд┐рдЯ рдореЗрдВ рдПрдиреНрдХреНрд░рд┐рдкреНрдЯ рдХрд░рдиреЗ** рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ, рддреЛ рдЖрдкрдХреЛ рдХреБрдЫ рдРрд╕рд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рд╣реЛрдЧрд╛ рдЬреИрд╕реЗ **TLS**ред

KMS рдПрдХ **рдХреНрд╖реЗрддреНрд░ рд╡рд┐рд╢реЗрд╖ рд╕реЗрд╡рд╛** рд╣реИред

**рдЕрдореЗрдЬрд╝рди рдХреЗ рдкреНрд░рд╢рд╛рд╕рдХреЛрдВ рдХреЗ рдкрд╛рд╕ рдЖрдкрдХреА рдХреБрдВрдЬрд┐рдпреЛрдВ рддрдХ рдкрд╣реБрдВрдЪ рдирд╣реАрдВ рд╣реИ**ред рд╡реЗ рдЖрдкрдХреА рдХреБрдВрдЬрд┐рдпреЛрдВ рдХреЛ рдкреБрдирд░реНрдкреНрд░рд╛рдкреНрдд рдирд╣реАрдВ рдХрд░ рд╕рдХрддреЗ рдФрд░ рд╡реЗ рдЖрдкрдХреА рдХреБрдВрдЬрд┐рдпреЛрдВ рдХреЗ рдПрдиреНрдХреНрд░рд┐рдкреНрд╢рди рдореЗрдВ рдЖрдкрдХреА рдорджрдж рдирд╣реАрдВ рдХрд░рддреЗред AWS рдХреЗрд╡рд▓ рдСрдкрд░реЗрдЯрд┐рдВрдЧ рд╕рд┐рд╕реНрдЯрдо рдФрд░ рдЗрд╕рдХреЗ рдЕрдВрддрд░реНрдирд┐рд╣рд┐рдд рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХрд╛ рдкреНрд░рдмрдВрдзрди рдХрд░рддрд╛ рд╣реИ, рдпрд╣ рд╣рдорд╛рд░реЗ рдКрдкрд░ рд╣реИ рдХрд┐ рд╣рдо рдЕрдкрдиреА рдПрдиреНрдХреНрд░рд┐рдкреНрд╢рди рдХреБрдВрдЬрд┐рдпреЛрдВ рдХрд╛ рдкреНрд░рдмрдВрдзрди рдХрд░реЗрдВ рдФрд░ рдпрд╣ рдкреНрд░рдмрдВрдзрд┐рдд рдХрд░реЗрдВ рдХрд┐ рдЙрди рдХреБрдВрдЬрд┐рдпреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХреИрд╕реЗ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред

**рдЧреНрд░рд╛рд╣рдХ рдорд╛рд╕реНрдЯрд░ рдХреБрдВрдЬреА** (CMK): 4KB рддрдХ рдХреЗ рдЖрдХрд╛рд░ рдХреЗ рдбреЗрдЯрд╛ рдХреЛ рдПрдиреНрдХреНрд░рд┐рдкреНрдЯ рдХрд░ рд╕рдХрддреА рд╣реИрдВред рдЗрдирдХрд╛ рдЙрдкрдпреЛрдЧ рдЖрдорддреМрд░ рдкрд░ DEKs (рдбреЗрдЯрд╛ рдПрдиреНрдХреНрд░рд┐рдкреНрд╢рди рдХреБрдВрдЬреА) рдмрдирд╛рдиреЗ, рдПрдиреНрдХреНрд░рд┐рдкреНрдЯ рдХрд░рдиреЗ рдФрд░ рдбрд┐рдХреНрд░рд┐рдкреНрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред рдлрд┐рд░ DEKs рдХрд╛ рдЙрдкрдпреЛрдЧ рдбреЗрдЯрд╛ рдХреЛ рдПрдиреНрдХреНрд░рд┐рдкреНрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред

рдПрдХ рдЧреНрд░рд╛рд╣рдХ рдорд╛рд╕реНрдЯрд░ рдХреБрдВрдЬреА (CMK) AWS KMS рдореЗрдВ рдПрдХ рдорд╛рд╕реНрдЯрд░ рдХреБрдВрдЬреА рдХрд╛ рддрд╛рд░реНрдХрд┐рдХ рдкреНрд░рддрд┐рдирд┐рдзрд┐рддреНрд╡ рд╣реИред рдорд╛рд╕реНрдЯрд░ рдХреБрдВрдЬреА рдХреЗ рдкрд╣рдЪрд╛рдирдХрд░реНрддрд╛рдУрдВ рдФрд░ рдЕрдиреНрдп рдореЗрдЯрд╛рдбреЗрдЯрд╛, рдЬрд┐рд╕рдореЗрдВ рдЗрд╕рдХреА рдирд┐рд░реНрдорд╛рдг рддрд┐рдерд┐, рд╡рд┐рд╡рд░рдг рдФрд░ рдХреБрдВрдЬреА рд╕реНрдерд┐рддрд┐ рд╢рд╛рдорд┐рд▓ рд╣реИ, рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдПрдХ **CMK рдореЗрдВ рд╡рд╣ рдХреБрдВрдЬреА рд╕рд╛рдордЧреНрд░реА рд╣реЛрддреА рд╣реИ рдЬрд┐рд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдбреЗрдЯрд╛ рдХреЛ рдПрдиреНрдХреНрд░рд┐рдкреНрдЯ рдФрд░ рдбрд┐рдХреНрд░рд┐рдкреНрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ**ред рдЬрдм рдЖрдк рдПрдХ CMK рдмрдирд╛рддреЗ рд╣реИрдВ, рддреЛ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ, AWS KMS рдЙрд╕ CMK рдХреЗ рд▓рд┐рдП рдХреБрдВрдЬреА рд╕рд╛рдордЧреНрд░реА рдЙрддреНрдкрдиреНрди рдХрд░рддрд╛ рд╣реИред рд╣рд╛рд▓рд╛рдБрдХрд┐, рдЖрдк рдмрд┐рдирд╛ рдХреБрдВрдЬреА рд╕рд╛рдордЧреНрд░реА рдХреЗ CMK рдмрдирд╛рдиреЗ рдХрд╛ рд╡рд┐рдХрд▓реНрдк рдЪреБрди рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдлрд┐рд░ рдЙрд╕ CMK рдореЗрдВ рдЕрдкрдиреА рд╕реНрд╡рдпрдВ рдХреА рдХреБрдВрдЬреА рд╕рд╛рдордЧреНрд░реА рдЖрдпрд╛рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

рдорд╛рд╕реНрдЯрд░ рдХреБрдВрдЬрд┐рдпреЛрдВ рдХреЗ 2 рдкреНрд░рдХрд╛рд░ рд╣реИрдВ:

* **AWS рдкреНрд░рдмрдВрдзрд┐рдд CMKs: рдЕрдиреНрдп рд╕реЗрд╡рд╛рдУрдВ рджреНрд╡рд╛рд░рд╛ рдбреЗрдЯрд╛ рдХреЛ рдПрдиреНрдХреНрд░рд┐рдкреНрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ**ред рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдЙрд╕ рд╕реЗрд╡рд╛ рджреНрд╡рд╛рд░рд╛ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдЬрд┐рд╕рдиреЗ рдЗрд╕реЗ рдПрдХ рдХреНрд╖реЗрддреНрд░ рдореЗрдВ рдмрдирд╛рдпрд╛ред рдпреЗ рдкрд╣рд▓реА рдмрд╛рд░ рддрдм рдмрдирд╛рдП рдЬрд╛рддреЗ рд╣реИрдВ рдЬрдм рдЖрдк рдЙрд╕ рд╕реЗрд╡рд╛ рдореЗрдВ рдПрдиреНрдХреНрд░рд┐рдкреНрд╢рди рд▓рд╛рдЧреВ рдХрд░рддреЗ рд╣реИрдВред рд╣рд░ 3 рд╕рд╛рд▓ рдореЗрдВ рд░реЛрдЯреЗрдЯ рд╣реЛрддрд╛ рд╣реИ рдФрд░ рдЗрд╕реЗ рдмрджрд▓рдирд╛ рд╕рдВрднрд╡ рдирд╣реАрдВ рд╣реИред
* **рдЧреНрд░рд╛рд╣рдХ рдкреНрд░рдмрдВрдзрдХ CMKs**: рд▓рдЪреАрд▓рд╛рдкрди, рд░реЛрдЯреЗрд╢рди, рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░рдиреЗ рдпреЛрдЧреНрдп рдкрд╣реБрдВрдЪ рдФрд░ рдХреБрдВрдЬреА рдиреАрддрд┐ред рдХреБрдВрдЬрд┐рдпреЛрдВ рдХреЛ рд╕рдХреНрд╖рдо рдФрд░ рдЕрдХреНрд╖рдо рдХрд░реЗрдВред

**рдПрдирд╡реЗрд▓рдк рдПрдиреНрдХреНрд░рд┐рдкреНрд╢рди** рдХреА рд╕рдВрджрд░реНрдн рдореЗрдВ рдХреБрдВрдЬреА рдкреНрд░рдмрдВрдзрди рд╕реЗрд╡рд╛ (KMS): **рдбреЗрдЯрд╛ рдХреБрдВрдЬреА рдХреЗ рд╕рд╛рде рдбреЗрдЯрд╛ рдХреЛ рдПрдиреНрдХреНрд░рд┐рдкреНрдЯ рдХрд░рдиреЗ рдФрд░ рдлрд┐рд░ рдорд╛рд╕реНрдЯрд░ рдХреБрдВрдЬреА рдХреЗ рд╕рд╛рде рдбреЗрдЯрд╛ рдХреБрдВрдЬреА рдХреЛ рдПрдиреНрдХреНрд░рд┐рдкреНрдЯ рдХрд░рдиреЗ** рдХреЗ рд▓рд┐рдП рджреЛ-рд╕реНрддрд░реАрдп рдкрджрд╛рдиреБрдХреНрд░рдо рдкреНрд░рдгрд╛рд▓реАред

### рдХреБрдВрдЬреА рдиреАрддрд┐рдпрд╛рдБ

рдпреЗ **рдпрд╣ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд░рддреА рд╣реИрдВ рдХрд┐ KMS рдореЗрдВ рдХреБрдВрдЬреА рдХрд╛ рдЙрдкрдпреЛрдЧ рдФрд░ рдкрд╣реБрдВрдЪ рдХреМрди рдХрд░ рд╕рдХрддрд╛ рд╣реИ**ред

**рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ:**

* рдпрд╣ **KMS рдХреБрдВрдЬреА рдХреЗ рдорд╛рд▓рд┐рдХ AWS рдЦрд╛рддреЗ рдХреЗ IAM рдХреЛ KMS рдХреБрдВрдЬреА рддрдХ рдкрд╣реБрдВрдЪ рдкреНрд░рдмрдВрдзрд┐рдд рдХрд░рдиреЗ** рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИред

рдЕрдиреНрдп AWS рд╕рдВрд╕рд╛рдзрди рдиреАрддрд┐рдпреЛрдВ рдХреЗ рд╡рд┐рдкрд░реАрдд, AWS **KMS рдХреБрдВрдЬреА рдиреАрддрд┐ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ рдЦрд╛рддреЗ рдХреЗ рдХрд┐рд╕реА рднреА рдкреНрд░рд┐рдВрд╕рд┐рдкрд▓ рдХреЛ рдЕрдиреБрдорддрд┐ рдирд╣реАрдВ рджреЗрддреА рд╣реИ**ред рдЦрд╛рддрд╛ рдкреНрд░рд╢рд╛рд╕рдХреЛрдВ рдХреЛ рдЕрдиреБрдорддрд┐ рджреЗрдиреЗ рдХреЗ рд▓рд┐рдП, **рдХреБрдВрдЬреА рдиреАрддрд┐ рдореЗрдВ рдПрдХ рд╕реНрдкрд╖реНрдЯ рдХрдерди рд╢рд╛рдорд┐рд▓ рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП** рдЬреЛ рдЗрд╕ рдЕрдиреБрдорддрд┐ рдХреЛ рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИ, рдЬреИрд╕реЗ рдХрд┐ рдпрд╣ред

* рдмрд┐рдирд╛ рдЦрд╛рддреЗ рдХреА рдЕрдиреБрдорддрд┐ рджрд┐рдП (`"AWS": "arn:aws:iam::111122223333:root"`) IAM рдЕрдиреБрдорддрд┐рдпрд╛рдБ рдХрд╛рдо рдирд╣реАрдВ рдХрд░реЗрдВрдЧреАред
* рдпрд╣ **IAM рдиреАрддрд┐рдпреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЦрд╛рддреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ** рддрд╛рдХрд┐ рдХреБрдВрдЬреА рдиреАрддрд┐ рдХреЗ рдЕрд▓рд╛рд╡рд╛ KMS рдХреБрдВрдЬреА рддрдХ рдкрд╣реБрдВрдЪ рдХреА рдЕрдиреБрдорддрд┐ рджреА рдЬрд╛ рд╕рдХреЗред

**рдЗрд╕ рдЕрдиреБрдорддрд┐ рдХреЗ рдмрд┐рдирд╛, рдХреБрдВрдЬреА рддрдХ рдкрд╣реБрдВрдЪ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрдиреЗ рд╡рд╛рд▓реА IAM рдиреАрддрд┐рдпрд╛рдБ рдЕрдкреНрд░рднрд╛рд╡реА рд╣реИрдВ**, рд╣рд╛рд▓рд╛рдБрдХрд┐ рдХреБрдВрдЬреА рддрдХ рдкрд╣реБрдВрдЪ рдХреЛ рдЕрд╕реНрд╡реАрдХрд╛рд░ рдХрд░рдиреЗ рд╡рд╛рд▓реА IAM рдиреАрддрд┐рдпрд╛рдБ рдЕрднреА рднреА рдкреНрд░рднрд╛рд╡реА рд╣реИрдВред
* рдпрд╣ **рдХреБрдВрдЬреА рдХреЗ рдЕрдкреНрд░рдмрдВрдзрдиреАрдп рд╣реЛрдиреЗ рдХреЗ рдЬреЛрдЦрд┐рдо рдХреЛ рдХрдо рдХрд░рддрд╛ рд╣реИ** рдЦрд╛рддреЗ рдХреЗ рдкреНрд░рд╢рд╛рд╕рдХреЛрдВ, рдЬрд┐рд╕рдореЗрдВ рдЦрд╛рддрд╛ рд░реВрдЯ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рд╢рд╛рдорд┐рд▓ рд╣реИ, рдХреЛ рдкрд╣реБрдВрдЪ рдирд┐рдпрдВрддреНрд░рдг рдЕрдиреБрдорддрд┐ рджреЗрдХрд░, рдЬрд┐рд╕реЗ рд╣рдЯрд╛рдпрд╛ рдирд╣реАрдВ рдЬрд╛ рд╕рдХрддрд╛ред

**рдбрд┐рдлрд╝реЙрд▓реНрдЯ рдиреАрддрд┐** рдЙрджрд╛рд╣рд░рдг:
```json
{
"Sid": "Enable IAM policies",
"Effect": "Allow",
"Principal": {
"AWS": "arn:aws:iam::111122223333:root"
},
"Action": "kms:*",
"Resource": "*"
}
```
{% hint style="warning" %}
рдпрджрд┐ **рдЦрд╛рддрд╛ рдЕрдиреБрдорддрд┐ рджреА рдЧрдИ рд╣реИ** (`"arn:aws:iam::111122223333:root"`), рддреЛ рдЦрд╛рддреЗ рд╕реЗ рдПрдХ **рдкреНрд░рд┐рдВрд╕рд┐рдкрд▓** рдХреЛ KMS рдХреБрдВрдЬреА рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП **IAM рдЕрдиреБрдорддрд┐рдпреЛрдВ** рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрдЧреАред рд╣рд╛рд▓рд╛рдБрдХрд┐, рдпрджрд┐ рдХрд┐рд╕реА рднреВрдорд┐рдХрд╛ рдХрд╛ **ARN** рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП **рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ рдЕрдиреБрдорддрд┐ рджреА рдЧрдИ рд╣реИ** **рдХреБрдВрдЬреА рдиреАрддрд┐** рдореЗрдВ, рддреЛ рдЙрд╕ рднреВрдорд┐рдХрд╛ рдХреЛ **IAM рдЕрдиреБрдорддрд┐рдпреЛрдВ** рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реИред
{% endhint %}

<details>

<summary>рдиреАрддрд┐ рд╡рд┐рд╡рд░рдг</summary>

рдиреАрддрд┐ рдХреЗ рдЧреБрдг:

* JSON рдЖрдзрд╛рд░рд┐рдд рджрд╕реНрддрд╛рд╡реЗрдЬрд╝
* рд╕рдВрд╕рд╛рдзрди --> рдкреНрд░рднрд╛рд╡рд┐рдд рд╕рдВрд╕рд╛рдзрди (рд╣реЛ рд╕рдХрддрд╛ рд╣реИ "\*")
* рдХреНрд░рд┐рдпрд╛ --> kms:Encrypt, kms:Decrypt, kms:CreateGrant ... (рдЕрдиреБрдорддрд┐рдпрд╛рдБ)
* рдкреНрд░рднрд╛рд╡ --> рдЕрдиреБрдорддрд┐/рдЕрд╕реНрд╡реАрдХреГрддрд┐
* рдкреНрд░рд┐рдВрд╕рд┐рдкрд▓ --> рдкреНрд░рднрд╛рд╡рд┐рдд arn
* рд╢рд░реНрддреЗрдВ (рд╡реИрдХрд▓реНрдкрд┐рдХ) --> рдЕрдиреБрдорддрд┐рдпрд╛рдБ рджреЗрдиреЗ рдХреЗ рд▓рд┐рдП рд╢рд░реНрдд

рдЕрдиреБрджрд╛рди:

* рдЕрдкрдиреЗ рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХреЛ рдЕрдкрдиреЗ AWS рдЦрд╛рддреЗ рдХреЗ рднреАрддрд░ рдХрд┐рд╕реА рдЕрдиреНрдп AWS рдкреНрд░рд┐рдВрд╕рд┐рдкрд▓ рдХреЛ рд╕реМрдВрдкрдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИред рдЖрдкрдХреЛ рдЙрдиреНрд╣реЗрдВ AWS KMS APIs рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдмрдирд╛рдирд╛ рд╣реЛрдЧрд╛ред рдЗрд╕рдореЗрдВ CMK рдкрд╣рдЪрд╛рдирдХрд░реНрддрд╛, рдЕрдиреБрджрд╛рди рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рд╡рд╛рд▓рд╛ рдкреНрд░рд┐рдВрд╕рд┐рдкрд▓ рдФрд░ рдЖрд╡рд╢реНрдпрдХ рд╕рдВрдЪрд╛рд▓рди рдХрд╛ рд╕реНрддрд░ (Decrypt, Encrypt, GenerateDataKey...) рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред
* рдЕрдиреБрджрд╛рди рдмрдирд╛рдиреЗ рдХреЗ рдмрд╛рдж рдПрдХ GrantToken рдФрд░ рдПрдХ GratID рдЬрд╛рд░реА рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред

**рдкрд╣реБрдБрдЪ**:

* **рдХреБрдВрдЬреА рдиреАрддрд┐** рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ -- рдпрджрд┐ рдпрд╣ рдореМрдЬреВрдж рд╣реИ, рддреЛ рдпрд╣ IAM рдиреАрддрд┐ рдкрд░ **рдкреНрд░рд╛рдердорд┐рдХрддрд╛** рд▓реЗрддрд╛ рд╣реИред
* **IAM рдиреАрддрд┐** рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ
* **рдЕрдиреБрджрд╛рдиреЛрдВ** рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ

</details>

### рдХреБрдВрдЬреА рдкреНрд░рд╢рд╛рд╕рдХ

рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ рдХреБрдВрдЬреА рдкреНрд░рд╢рд╛рд╕рдХ:

* KMS рдкреНрд░рдмрдВрдзрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдкрд╣реБрдБрдЪ рд░рдЦрддреЗ рд╣реИрдВ рд▓реЗрдХрд┐рди рдбреЗрдЯрд╛ рдХреЛ рдПрдиреНрдХреНрд░рд┐рдкреНрдЯ рдпрд╛ рдбрд┐рдХреНрд░рд┐рдкреНрдЯ рдирд╣реАрдВ рдХрд░ рд╕рдХрддреЗред
* рдХреЗрд╡рд▓ IAM рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдФрд░ рднреВрдорд┐рдХрд╛рдУрдВ рдХреЛ рдХреБрдВрдЬреА рдкреНрд░рд╢рд╛рд╕рдХреЛрдВ рдХреА рд╕реВрдЪреА рдореЗрдВ рдЬреЛрдбрд╝рд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ (рд╕рдореВрд╣ рдирд╣реАрдВ)ред
* рдпрджрд┐ рдмрд╛рд╣рд░реА CMK рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рдХреБрдВрдЬреА рдкреНрд░рд╢рд╛рд╕рдХреЛрдВ рдХреЛ рдХреБрдВрдЬреА рд╕рд╛рдордЧреНрд░реА рдЖрдпрд╛рдд рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рд╣реЛрддреА рд╣реИред

### CMKs рдХрд╛ рдШреБрдорд╛рд╡

* рдЬрд┐рддрдирд╛ рдЕрдзрд┐рдХ рд╕рдордп рдПрдХ рд╣реА рдХреБрдВрдЬреА рдХреЛ рд░рдЦрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЙрддрдирд╛ рдЕрдзрд┐рдХ рдбреЗрдЯрд╛ рдЙрд╕ рдХреБрдВрдЬреА рдХреЗ рд╕рд╛рде рдПрдиреНрдХреНрд░рд┐рдкреНрдЯ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдФрд░ рдпрджрд┐ рд╡рд╣ рдХреБрдВрдЬреА рднрдВрдЧ рд╣реЛ рдЬрд╛рддреА рд╣реИ, рддреЛ рдбреЗрдЯрд╛ рдХрд╛ рд╡рд┐рд╕реНрдлреЛрдЯ рдХреНрд╖реЗрддреНрд░ рдЙрддрдирд╛ рд╣реА рдмрдбрд╝рд╛ рд╣реЛрддрд╛ рд╣реИред рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдЬрд┐рддрдирд╛ рдЕрдзрд┐рдХ рд╕рдордп рдХреБрдВрдЬреА рд╕рдХреНрд░рд┐рдп рд░рд╣рддреА рд╣реИ, рдЙрд╕рдХреЗ рднрдВрдЧ рд╣реЛрдиреЗ рдХреА рд╕рдВрднрд╛рд╡рдирд╛ рдмрдврд╝рддреА рд╣реИред
* **KMS рд╣рд░ 365 рджрд┐рдиреЛрдВ рдореЗрдВ рдЧреНрд░рд╛рд╣рдХ рдХреБрдВрдЬреА рдШреБрдорд╛рддрд╛ рд╣реИ** (рдпрд╛ рдЖрдк рдЬрдм рдЪрд╛рд╣реЗрдВ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЛ рдореИрдиреНрдпреБрдЕрд▓ рд░реВрдк рд╕реЗ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ) рдФрд░ **AWS рджреНрд╡рд╛рд░рд╛ рдкреНрд░рдмрдВрдзрд┐рдд рдХреБрдВрдЬреА рд╣рд░ 3 рд╡рд░реНрд╖реЛрдВ рдореЗрдВ** рд╣реЛрддреА рд╣реИ рдФрд░ рдЗрд╕ рдмрд╛рд░ рдЗрд╕реЗ рдирд╣реАрдВ рдмрджрд▓рд╛ рдЬрд╛ рд╕рдХрддрд╛ред
* **рдкреБрд░рд╛рдиреА рдХреБрдВрдЬрд┐рдпрд╛рдБ рд░рдЦреА рдЬрд╛рддреА рд╣реИрдВ** рддрд╛рдХрд┐ рдШреБрдорд╛рд╡ рд╕реЗ рдкрд╣рд▓реЗ рдПрдиреНрдХреНрд░рд┐рдкреНрдЯ рдХрд┐рдП рдЧрдП рдбреЗрдЯрд╛ рдХреЛ рдбрд┐рдХреНрд░рд┐рдкреНрдЯ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗред
* рдПрдХ рдмреНрд░реЗрдХ рдореЗрдВ, рдХреБрдВрдЬреА рдХреЛ рдШреБрдорд╛рдиреЗ рд╕реЗ рдЦрддрд░рд╛ рд╕рдорд╛рдкреНрдд рдирд╣реАрдВ рд╣реЛрдЧрд╛ рдХреНрдпреЛрдВрдХрд┐ рдпрд╣ рднрдВрдЧ рдХреА рдЧрдИ рдХреБрдВрдЬреА рдХреЗ рд╕рд╛рде рдПрдиреНрдХреНрд░рд┐рдкреНрдЯ рдХрд┐рдП рдЧрдП рд╕рднреА рдбреЗрдЯрд╛ рдХреЛ рдбрд┐рдХреНрд░рд┐рдкреНрдЯ рдХрд░рдирд╛ рд╕рдВрднрд╡ рд╣реЛрдЧрд╛ред рд╣рд╛рд▓рд╛рдБрдХрд┐, **рдирдпрд╛ рдбреЗрдЯрд╛ рдирдИ рдХреБрдВрдЬреА рдХреЗ рд╕рд╛рде рдПрдиреНрдХреНрд░рд┐рдкреНрдЯ рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛**ред
* рдпрджрд┐ **CMK** **рдЕрдХреНрд╖рдо** рдпрд╛ **рд╣рдЯрд╛рдиреЗ рдХреЗ рд▓рд┐рдП рд▓рдВрдмрд┐рдд** рд╕реНрдерд┐рддрд┐ рдореЗрдВ рд╣реИ, рддреЛ KMS **рдХреБрдВрдЬреА рдШреБрдорд╛рд╡** рдирд╣реАрдВ рдХрд░реЗрдЧрд╛ рдЬрдм рддрдХ рдХрд┐ CMK рдХреЛ рдлрд┐рд░ рд╕реЗ рд╕рдХреНрд╖рдо рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рдпрд╛ рд╣рдЯрд╛рдиреЗ рдХреЛ рд░рджреНрдж рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ред

#### рдореИрдиреНрдпреБрдЕрд▓ рдШреБрдорд╛рд╡

* рдПрдХ **рдирдИ CMK рдмрдирд╛рдиреА рд╣реЛрдЧреА**, рдлрд┐рд░, рдПрдХ рдирдИ CMK-ID рдмрдирд╛рдИ рдЬрд╛рддреА рд╣реИ, рдЗрд╕рд▓рд┐рдП рдЖрдкрдХреЛ **рдХреЛрдИ рднреА рдЖрд╡реЗрджрди** рдХреЛ **рдирд╡реАрдирддрдо CMK-ID** рдХреЛ **рд╕рдВрджрд░реНрднрд┐рдд** рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП **рдЕрдкрдбреЗрдЯ** рдХрд░рдирд╛ рд╣реЛрдЧрд╛ред
* рдЗрд╕ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЛ рдЖрд╕рд╛рди рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдк **рдХреБрдВрдЬреА-рдЖрдИрдбреА рдХреЛ рд╕рдВрджрд░реНрднрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдирд╛рдореЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ** рдФрд░ рдлрд┐рд░ рдХреЗрд╡рд▓ рдЙрд╕ рдХреБрдВрдЬреА рдХреЛ рдЕрдкрдбреЗрдЯ рдХрд░реЗрдВ рдЬрд┐рд╕ рдкрд░ рдЙрдкрдирд╛рдо рд╕рдВрджрд░реНрднрд┐рдд рдХрд░ рд░рд╣рд╛ рд╣реИред
* рдЖрдкрдХреЛ **рдкреБрд░рд╛рдиреА рдХреБрдВрдЬрд┐рдпрд╛рдБ рд░рдЦрдиреА рд╣реЛрдВрдЧреА** рддрд╛рдХрд┐ рдЗрд╕рдХреЗ рд╕рд╛рде рдПрдиреНрдХреНрд░рд┐рдкреНрдЯ рдХреА рдЧрдИ рдкреБрд░рд╛рдиреА рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреЛ рдбрд┐рдХреНрд░рд┐рдкреНрдЯ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗред

рдЖрдк рдЕрдкрдиреЗ рдСрди-рдкреНрд░рд┐рдорд╛рдЗрд╕реЗрд╕ рдХреБрдВрдЬреА рдЕрд╡рд╕рдВрд░рдЪрдирд╛ рд╕реЗ рдХреБрдВрдЬрд┐рдпрд╛рдБ рдЖрдпрд╛рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

### рдЕрдиреНрдп рдкреНрд░рд╛рд╕рдВрдЧрд┐рдХ KMS рдЬрд╛рдирдХрд╛рд░реА

KMS рдХреА рдХреАрдордд рд╕рднреА рд╕реЗрд╡рд╛рдУрдВ рд╕реЗ рдкреНрд░рд╛рдкреНрдд рдПрдиреНрдХреНрд░рд┐рдкреНрд╢рди/рдбрд┐рдХреНрд░рд┐рдкреНрд╢рди рдЕрдиреБрд░реЛрдзреЛрдВ рдХреА рд╕рдВрдЦреНрдпрд╛ рдХреЗ рдЖрдзрд╛рд░ рдкрд░ рд╣реЛрддреА рд╣реИред

KMS рдореЗрдВ рдкреВрд░реНрдг рдСрдбрд┐рдЯ рдФрд░ рдЕрдиреБрдкрд╛рд▓рди **CloudTrail рдХреЗ рд╕рд╛рде рдПрдХреАрдХрд░рдг** рд╣реИ; рдпрд╣рд╛рдБ рдЖрдк KMS рдкрд░ рдХрд┐рдП рдЧрдП рд╕рднреА рдкрд░рд┐рд╡рд░реНрддрдиреЛрдВ рдХрд╛ рдСрдбрд┐рдЯ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

KMS рдиреАрддрд┐ рдХреЗ рд╕рд╛рде рдЖрдк рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:

* рдпрд╣ рд╕реАрдорд┐рдд рдХрд░реЗрдВ рдХрд┐ рдХреМрди рдбреЗрдЯрд╛ рдХреБрдВрдЬреА рдмрдирд╛ рд╕рдХрддрд╛ рд╣реИ рдФрд░ рдХреМрди рд╕реА рд╕реЗрд╡рд╛рдПрдБ рдЗрди рдХреБрдВрдЬрд┐рдпреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдкрд╣реБрдБрдЪ рд░рдЦрддреА рд╣реИрдВред
* рд╕рд┐рд╕реНрдЯрдо рдХреА рдкрд╣реБрдБрдЪ рдХреЛ рдХреЗрд╡рд▓ рдПрдиреНрдХреНрд░рд┐рдкреНрдЯ, рдХреЗрд╡рд▓ рдбрд┐рдХреНрд░рд┐рдкреНрдЯ рдпрд╛ рджреЛрдиреЛрдВ рддрдХ рд╕реАрдорд┐рдд рдХрд░реЗрдВред
* рдпрд╣ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд░реЗрдВ рдХрд┐ рд╕рд┐рд╕реНрдЯрдо рдХреЛ рдХреНрд╖реЗрддреНрд░реЛрдВ рдХреЗ рдмреАрдЪ рдХреБрдВрдЬрд┐рдпреЛрдВ рддрдХ рдкрд╣реБрдБрдЪрдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреА рдЬрд╛рдП (рд╣рд╛рд▓рд╛рдБрдХрд┐ рдпрд╣ рдЕрдиреБрд╢рдВрд╕рд┐рдд рдирд╣реАрдВ рд╣реИ рдХреНрдпреЛрдВрдХрд┐ KMS рдХреЛ рд╣реЛрд╕реНрдЯ рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рдХреНрд╖реЗрддреНрд░ рдореЗрдВ рд╡рд┐рдлрд▓рддрд╛ рдЕрдиреНрдп рдХреНрд╖реЗрддреНрд░реЛрдВ рдореЗрдВ рд╕рд┐рд╕реНрдЯрдо рдХреА рдЙрдкрд▓рдмреНрдзрддрд╛ рдХреЛ рдкреНрд░рднрд╛рд╡рд┐рдд рдХрд░реЗрдЧреА)ред

рдЖрдк рдХреНрд╖реЗрддреНрд░реЛрдВ рдХреЗ рдмреАрдЪ рдХреБрдВрдЬрд┐рдпреЛрдВ рдХреЛ рд╕рдордиреНрд╡рдпрд┐рдд рдпрд╛ рд╕реНрдерд╛рдирд╛рдВрддрд░рд┐рдд/рдХреЙрдкреА рдирд╣реАрдВ рдХрд░ рд╕рдХрддреЗ; рдЖрдк рдХреЗрд╡рд▓ рдХреНрд╖реЗрддреНрд░ рдХреЗ рдмреАрдЪ рдкрд╣реБрдБрдЪ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрдиреЗ рдХреЗ рд▓рд┐рдП рдирд┐рдпрдо рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

### рдЧрдгрдирд╛
```bash
aws kms list-keys
aws kms list-key-policies --key-id <id>
aws kms list-grants --key-id <id>
aws kms describe-key --key-id <id>
aws kms get-key-policy --key-id <id> --policy-name <name> # Default policy name is "default"
aws kms describe-custom-key-stores
```
### Privesc

{% content-ref url="../aws-privilege-escalation/aws-kms-privesc.md" %}
[aws-kms-privesc.md](../aws-privilege-escalation/aws-kms-privesc.md)
{% endcontent-ref %}

### Post Exploitation

{% content-ref url="../aws-post-exploitation/aws-kms-post-exploitation.md" %}
[aws-kms-post-exploitation.md](../aws-post-exploitation/aws-kms-post-exploitation.md)
{% endcontent-ref %}

### Persistence

{% content-ref url="../aws-persistence/aws-kms-persistence.md" %}
[aws-kms-persistence.md](../aws-persistence/aws-kms-persistence.md)
{% endcontent-ref %}

## References

* [https://docs.aws.amazon.com/kms/latest/developerguide/key-policy-default.html](https://docs.aws.amazon.com/kms/latest/developerguide/key-policy-default.html)

{% hint style="success" %}
AWS рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ рдФрд░ рдЕрднреНрдпрд╛рд╕ рдХрд░реЗрдВ:<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
GCP рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ рдФрд░ рдЕрднреНрдпрд╛рд╕ рдХрд░реЗрдВ: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░реЗрдВ</summary>

* [**рд╕рджрд╕реНрдпрддрд╛ рдпреЛрдЬрдирд╛рдПрдБ**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* **ЁЯТм [**Discord рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**telegram рд╕рдореВрд╣**](https://t.me/peass) рдореЗрдВ рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ рдпрд╛ **Twitter** рдкрд░ рд╣рдореЗрдВ **рдлреЙрд▓реЛ** рдХрд░реЗрдВ ЁЯРж [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **HackTricks** рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos рдореЗрдВ PRs рдЬрдорд╛ рдХрд░рдХреЗ рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВред

</details>
{% endhint %}
