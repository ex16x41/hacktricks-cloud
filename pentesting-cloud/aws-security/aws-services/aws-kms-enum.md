# AWS - KMS Enum

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## KMS - Key Management Service

AWS Key Management Service (AWS KMS) –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–π —è–∫ –∫–µ—Ä–æ–≤–∞–Ω–∞ —Å–ª—É–∂–±–∞, —â–æ —Å–ø—Ä–æ—â—É—î –ø—Ä–æ—Ü–µ—Å –¥–ª—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ **—Å—Ç–≤–æ—Ä—é–≤–∞—Ç–∏ —Ç–∞ –∫–µ—Ä—É–≤–∞—Ç–∏ –æ—Å–Ω–æ–≤–Ω–∏–º–∏ –∫–ª—é—á–∞–º–∏ –∑–∞–º–æ–≤–Ω–∏–∫–∞** (CMKs). –¶—ñ CMKs —î –Ω–µ–≤—ñ–¥'—î–º–Ω–æ—é —á–∞—Å—Ç–∏–Ω–æ—é —à–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è –¥–∞–Ω–∏—Ö –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤. –ü–æ–º—ñ—Ç–Ω–æ—é –æ—Å–æ–±–ª–∏–≤—ñ—Å—Ç—é AWS KMS —î —Ç–µ, —â–æ CMKs –ø–µ—Ä–µ–≤–∞–∂–Ω–æ **–∑–∞—Ö–∏—â–µ–Ω—ñ –∞–ø–∞—Ä–∞—Ç–Ω–∏–º–∏ –º–æ–¥—É–ª—è–º–∏ –±–µ–∑–ø–µ–∫–∏** (HSMs), —â–æ –ø—ñ–¥–≤–∏—â—É—î –∑–∞—Ö–∏—Å—Ç —à–∏—Ñ—Ä—É–≤–∞–ª—å–Ω–∏—Ö –∫–ª—é—á—ñ–≤.

KMS –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î **—Å–∏–º–µ—Ç—Ä–∏—á–Ω—É –∫—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ—ñ—é**. –¶–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –¥–ª—è **—à–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó –≤ —Å–ø–æ–∫–æ—ó** (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ S3). –Ø–∫—â–æ –≤–∞–º –ø–æ—Ç—Ä—ñ–±–Ω–æ **—à–∏—Ñ—Ä—É–≤–∞—Ç–∏ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –≤ —Ä—É—Å—ñ**, –≤–∞–º –ø–æ—Ç—Ä—ñ–±–Ω–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ —â–æ—Å—å –Ω–∞ –∑—Ä–∞–∑–æ–∫ **TLS**.

KMS —î **—Å–µ—Ä–≤—ñ—Å–æ–º, —Å–ø–µ—Ü–∏—Ñ—ñ—á–Ω–∏–º –¥–ª—è —Ä–µ–≥—ñ–æ–Ω—É**.

**–ê–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∏ Amazon –Ω–µ –º–∞—é—Ç—å –¥–æ—Å—Ç—É–ø—É –¥–æ –≤–∞—à–∏—Ö –∫–ª—é—á—ñ–≤**. –í–æ–Ω–∏ –Ω–µ –º–æ–∂—É—Ç—å –≤—ñ–¥–Ω–æ–≤–∏—Ç–∏ –≤–∞—à—ñ –∫–ª—é—á—ñ —ñ –Ω–µ –¥–æ–ø–æ–º–∞–≥–∞—é—Ç—å –≤–∞–º –∑ —à–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è–º –≤–∞—à–∏—Ö –∫–ª—é—á—ñ–≤. AWS –ø—Ä–æ—Å—Ç–æ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä—É—î –æ–ø–µ—Ä–∞—Ü—ñ–π–Ω—É —Å–∏—Å—Ç–µ–º—É —Ç–∞ –æ—Å–Ω–æ–≤–Ω–∏–π –¥–æ–¥–∞—Ç–æ–∫, –Ω–∞–º –ø–æ—Ç—Ä—ñ–±–Ω–æ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä—É–≤–∞—Ç–∏ –Ω–∞—à—ñ —à–∏—Ñ—Ä—É–≤–∞–ª—å–Ω—ñ –∫–ª—é—á—ñ —Ç–∞ –∫–µ—Ä—É–≤–∞—Ç–∏ —Ç–∏–º, —è–∫ —Ü—ñ –∫–ª—é—á—ñ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å—Å—è.

**–û—Å–Ω–æ–≤–Ω—ñ –∫–ª—é—á—ñ –∑–∞–º–æ–≤–Ω–∏–∫–∞** (CMK): –ú–æ–∂—É—Ç—å —à–∏—Ñ—Ä—É–≤–∞—Ç–∏ –¥–∞–Ω—ñ —Ä–æ–∑–º—ñ—Ä–æ–º –¥–æ 4KB. –í–æ–Ω–∏ –∑–∞–∑–≤–∏—á–∞–π –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å—Å—è –¥–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è, —à–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è —Ç–∞ –¥–µ—à–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è DEK (–ö–ª—é—á—ñ —à–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è –¥–∞–Ω–∏—Ö). –ü–æ—Ç—ñ–º DEK –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å—Å—è –¥–ª—è —à–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è –¥–∞–Ω–∏—Ö.

–û—Å–Ω–æ–≤–Ω–∏–π –∫–ª—é—á –∑–∞–º–æ–≤–Ω–∏–∫–∞ (CMK) —î –ª–æ–≥—ñ—á–Ω–∏–º –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–Ω—è–º –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –∫–ª—é—á–∞ –≤ AWS KMS. –ù–∞ –¥–æ–¥–∞—Ç–æ–∫ –¥–æ —ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ç–æ—Ä—ñ–≤ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –∫–ª—é—á–∞ —Ç–∞ —ñ–Ω—à–æ—ó –º–µ—Ç–∞–¥–∞–Ω–∏—Ö, –≤–∫–ª—é—á–∞—é—á–∏ –¥–∞—Ç—É —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è, –æ–ø–∏—Å —Ç–∞ —Å—Ç–∞–Ω –∫–ª—é—á–∞, **CMK –º—ñ—Å—Ç–∏—Ç—å –º–∞—Ç–µ—Ä—ñ–∞–ª –∫–ª—é—á–∞, —è–∫–∏–π –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –¥–ª—è —à–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è —Ç–∞ –¥–µ—à–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è –¥–∞–Ω–∏—Ö**. –ö–æ–ª–∏ –≤–∏ —Å—Ç–≤–æ—Ä—é—î—Ç–µ CMK, –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º AWS KMS –≥–µ–Ω–µ—Ä—É—î –º–∞—Ç–µ—Ä—ñ–∞–ª –∫–ª—é—á–∞ –¥–ª—è —Ü—å–æ–≥–æ CMK. –û–¥–Ω–∞–∫ –≤–∏ –º–æ–∂–µ—Ç–µ –≤–∏–±—Ä–∞—Ç–∏ —Å—Ç–≤–æ—Ä–∏—Ç–∏ CMK –±–µ–∑ –º–∞—Ç–µ—Ä—ñ–∞–ª—É –∫–ª—é—á–∞, –∞ –ø–æ—Ç—ñ–º —ñ–º–ø–æ—Ä—Ç—É–≤–∞—Ç–∏ —Å–≤—ñ–π –≤–ª–∞—Å–Ω–∏–π –º–∞—Ç–µ—Ä—ñ–∞–ª –∫–ª—é—á–∞ –≤ —Ü–µ–π CMK.

–Ü—Å–Ω—É—î 2 —Ç–∏–ø–∏ –æ—Å–Ω–æ–≤–Ω–∏—Ö –∫–ª—é—á—ñ–≤:

* **CMK, –∫–µ—Ä–æ–≤–∞–Ω—ñ AWS: –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å—Å—è —ñ–Ω—à–∏–º–∏ —Å–ª—É–∂–±–∞–º–∏ –¥–ª—è —à–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è –¥–∞–Ω–∏—Ö**. –í–æ–Ω–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å—Å—è —Å–ª—É–∂–±–æ—é, —è–∫–∞ —ó—Ö —Å—Ç–≤–æ—Ä–∏–ª–∞ –≤ —Ä–µ–≥—ñ–æ–Ω—ñ. –í–æ–Ω–∏ —Å—Ç–≤–æ—Ä—é—é—Ç—å—Å—è –ø–µ—Ä—à–∏–π —Ä–∞–∑, –∫–æ–ª–∏ –≤–∏ —Ä–µ–∞–ª—ñ–∑—É—î—Ç–µ —à–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è –≤ —Ü—ñ–π —Å–ª—É–∂–±—ñ. –û–±–µ—Ä—Ç–∞—é—Ç—å—Å—è –∫–æ–∂–Ω—ñ 3 —Ä–æ–∫–∏, —ñ –∑–º—ñ–Ω–∏—Ç–∏ —ó—Ö –Ω–µ–º–æ–∂–ª–∏–≤–æ.
* **CMK, –∫–µ—Ä–æ–≤–∞–Ω—ñ –∑–∞–º–æ–≤–Ω–∏–∫–æ–º**: –ì–Ω—É—á–∫—ñ—Å—Ç—å, –æ–±–µ—Ä—Ç–∞–Ω–Ω—è, –Ω–∞–ª–∞—à—Ç–æ–≤—É–≤–∞–Ω–∏–π –¥–æ—Å—Ç—É–ø —ñ –ø–æ–ª—ñ—Ç–∏–∫–∞ –∫–ª—é—á—ñ–≤. –£–≤—ñ–º–∫–Ω–µ–Ω–Ω—è —Ç–∞ –≤–∏–º–∫–Ω–µ–Ω–Ω—è –∫–ª—é—á—ñ–≤.

**–®–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è –∫–æ–Ω–≤–µ—Ä—Ç—ñ–≤** –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç—ñ –°–ª—É–∂–±–∏ —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –∫–ª—é—á–∞–º–∏ (KMS): –°–∏—Å—Ç–µ–º–∞ —ñ—î—Ä–∞—Ä—Ö—ñ—ó –∑ –¥–≤–æ—Ö —Ä—ñ–≤–Ω—ñ–≤ –¥–ª—è **—à–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è –¥–∞–Ω–∏—Ö –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –∫–ª—é—á–∞ –¥–∞–Ω–∏—Ö, –∞ –ø–æ—Ç—ñ–º —à–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è –∫–ª—é—á–∞ –¥–∞–Ω–∏—Ö –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –∫–ª—é—á–∞**.

### –ü–æ–ª—ñ—Ç–∏–∫–∏ –∫–ª—é—á—ñ–≤

–¶—ñ –ø–æ–ª—ñ—Ç–∏–∫–∏ –≤–∏–∑–Ω–∞—á–∞—é—Ç—å **—Ö—Ç–æ –º–æ–∂–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ —Ç–∞ –æ—Ç—Ä–∏–º—É–≤–∞—Ç–∏ –¥–æ—Å—Ç—É–ø –¥–æ –∫–ª—é—á–∞ –≤ KMS**.

–ó–∞ **–∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º:**

*   –í–æ–Ω–∞ –Ω–∞–¥–∞—î **IAM –æ–±–ª—ñ–∫–æ–≤–æ–≥–æ –∑–∞–ø–∏—Å—É AWS, —è–∫–∏–π –≤–æ–ª–æ–¥—ñ—î –∫–ª—é—á–µ–º KMS –¥–æ—Å—Ç—É–ø** –¥–ª—è —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –¥–æ—Å—Ç—É–ø–æ–º –¥–æ –∫–ª—é—á–∞ KMS —á–µ—Ä–µ–∑ IAM.

–ù–∞ –≤—ñ–¥–º—ñ–Ω—É –≤—ñ–¥ —ñ–Ω—à–∏—Ö –ø–æ–ª—ñ—Ç–∏–∫ —Ä–µ—Å—É—Ä—Å—ñ–≤ AWS, –ø–æ–ª—ñ—Ç–∏–∫–∞ **–∫–ª—é—á–∞ AWS KMS –Ω–µ –Ω–∞–¥–∞—î –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –¥–æ–∑–≤–æ–ª—É –∂–æ–¥–Ω–æ–º—É –∑ –ø—Ä–∏–Ω—Ü–∏–ø–∞–ª—ñ–≤ –æ–±–ª—ñ–∫–æ–≤–æ–≥–æ –∑–∞–ø–∏—Å—É**. –©–æ–± –Ω–∞–¥–∞—Ç–∏ –¥–æ–∑–≤—ñ–ª –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞–º –æ–±–ª—ñ–∫–æ–≤–æ–≥–æ –∑–∞–ø–∏—Å—É, **–ø–æ–ª—ñ—Ç–∏–∫–∞ –∫–ª—é—á–∞ –ø–æ–≤–∏–Ω–Ω–∞ –º—ñ—Å—Ç–∏—Ç–∏ —è–≤–Ω—É –∑–∞—è–≤—É**, —è–∫–∞ –Ω–∞–¥–∞—î —Ü–µ–π –¥–æ–∑–≤—ñ–ª, —è–∫ —Ü—è.

* –ë–µ–∑ –¥–æ–∑–≤–æ–ª—É –æ–±–ª—ñ–∫–æ–≤–æ–≥–æ –∑–∞–ø–∏—Å—É(`"AWS": "arn:aws:iam::111122223333:root"`) –¥–æ–∑–≤–æ–ª–∏ IAM –Ω–µ –ø—Ä–∞—Ü—é–≤–∞—Ç–∏–º—É—Ç—å.
*   –í–æ–Ω–∞ **–¥–æ–∑–≤–æ–ª—è—î –æ–±–ª—ñ–∫–æ–≤–æ–º—É –∑–∞–ø–∏—Å—É –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –ø–æ–ª—ñ—Ç–∏–∫–∏ IAM** –¥–ª—è –Ω–∞–¥–∞–Ω–Ω—è –¥–æ—Å—Ç—É–ø—É –¥–æ –∫–ª—é—á–∞ KMS, –Ω–∞ –¥–æ–¥–∞—Ç–æ–∫ –¥–æ –ø–æ–ª—ñ—Ç–∏–∫–∏ –∫–ª—é—á–∞.

**–ë–µ–∑ —Ü—å–æ–≥–æ –¥–æ–∑–≤–æ–ª—É –ø–æ–ª—ñ—Ç–∏–∫–∏ IAM, —è–∫—ñ –¥–æ–∑–≤–æ–ª—è—é—Ç—å –¥–æ—Å—Ç—É–ø –¥–æ –∫–ª—é—á–∞, —î –Ω–µ–µ—Ñ–µ–∫—Ç–∏–≤–Ω–∏–º–∏**, —Ö–æ—á–∞ –ø–æ–ª—ñ—Ç–∏–∫–∏ IAM, —è–∫—ñ –∑–∞–±–æ—Ä–æ–Ω—è—é—Ç—å –¥–æ—Å—Ç—É–ø –¥–æ –∫–ª—é—á–∞, –≤—Å–µ —â–µ —î –µ—Ñ–µ–∫—Ç–∏–≤–Ω–∏–º–∏.
* –í–æ–Ω–∞ **–∑–º–µ–Ω—à—É—î —Ä–∏–∑–∏–∫ —Ç–æ–≥–æ, —â–æ –∫–ª—é—á —Å—Ç–∞–Ω–µ –Ω–µ–∫–µ—Ä–æ–≤–∞–Ω–∏–º**, –Ω–∞–¥–∞—é—á–∏ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø—É –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞–º –æ–±–ª—ñ–∫–æ–≤–æ–≥–æ –∑–∞–ø–∏—Å—É, –≤–∫–ª—é—á–∞—é—á–∏ –∫–æ—Ä–µ–Ω–µ–≤–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –æ–±–ª—ñ–∫–æ–≤–æ–≥–æ –∑–∞–ø–∏—Å—É, —è–∫–∏–π –Ω–µ –º–æ–∂–µ –±—É—Ç–∏ –≤–∏–¥–∞–ª–µ–Ω–∏–π.

**–ü—Ä–∏–∫–ª–∞–¥ –ø–æ–ª—ñ—Ç–∏–∫–∏ –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º**:
```json
{
"Sid": "Enable IAM policies",
"Effect": "Allow",
"Principal": {
"AWS": "arn:aws:iam::111122223333:root"
},
"Action": "kms:*",
"Resource": "*"
}
```
{% hint style="warning" %}
–Ø–∫—â–æ **–æ–±–ª—ñ–∫–æ–≤–∏–π –∑–∞–ø–∏—Å –¥–æ–∑–≤–æ–ª–µ–Ω–æ** (`"arn:aws:iam::111122223333:root"`), **—Å—É–±'—î–∫—Ç** –∑ –æ–±–ª—ñ–∫–æ–≤–æ–≥–æ –∑–∞–ø–∏—Å—É **–≤—Å–µ —â–µ –ø–æ—Ç—Ä–µ–±—É—î IAM –¥–æ–∑–≤–æ–ª—ñ–≤** –¥–ª—è –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è KMS –∫–ª—é—á–∞. –û–¥–Ω–∞–∫, —è–∫—â–æ **ARN** —Ä–æ–ª—ñ, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥, **—Å–ø–µ—Ü—ñ–∞–ª—å–Ω–æ –¥–æ–∑–≤–æ–ª–µ–Ω–æ** –≤ **–ü–æ–ª—ñ—Ç–∏—Ü—ñ –∫–ª—é—á–∞**, —Ü—è —Ä–æ–ª—å **–Ω–µ –ø–æ—Ç—Ä–µ–±—É—î IAM –¥–æ–∑–≤–æ–ª—ñ–≤**.
{% endhint %}

<details>

<summary>–î–µ—Ç–∞–ª—ñ –ø–æ–ª—ñ—Ç–∏–∫–∏</summary>

–í–ª–∞—Å—Ç–∏–≤–æ—Å—Ç—ñ –ø–æ–ª—ñ—Ç–∏–∫–∏:

* –î–æ–∫—É–º–µ–Ω—Ç –Ω–∞ –æ—Å–Ω–æ–≤—ñ JSON
* –†–µ—Å—É—Ä—Å --> –ü—ñ–¥–ª—è–≥–∞—é—á—ñ —Ä–µ—Å—É—Ä—Å–∏ (–º–æ–∂–µ –±—É—Ç–∏ "\*")
* –î—ñ—è --> kms:Encrypt, kms:Decrypt, kms:CreateGrant ... (–¥–æ–∑–≤–æ–ª–∏)
* –ï—Ñ–µ–∫—Ç --> –î–æ–∑–≤–æ–ª–∏—Ç–∏/–í—ñ–¥–º–æ–≤–∏—Ç–∏
* –°—É–±'—î–∫—Ç --> arn, —â–æ –ø—ñ–¥–ª—è–≥–∞—î
* –£–º–æ–≤–∏ (–Ω–µ–æ–±–æ–≤'—è–∑–∫–æ–≤–æ) --> –£–º–æ–≤–∞ –¥–ª—è –Ω–∞–¥–∞–Ω–Ω—è –¥–æ–∑–≤–æ–ª—ñ–≤

–ì—Ä–∞–Ω—Ç–∏:

* –î–æ–∑–≤–æ–ª—è—î –¥–µ–ª–µ–≥—É–≤–∞—Ç–∏ –≤–∞—à—ñ –¥–æ–∑–≤–æ–ª–∏ —ñ–Ω—à–æ–º—É AWS —Å—É–±'—î–∫—Ç—É —É –≤–∞—à–æ–º—É –æ–±–ª—ñ–∫–æ–≤–æ–º—É –∑–∞–ø–∏—Å—ñ AWS. –í–∞–º –ø–æ—Ç—Ä—ñ–±–Ω–æ —Å—Ç–≤–æ—Ä–∏—Ç–∏ —ó—Ö –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é AWS KMS API. –ú–æ–∂–Ω–∞ –≤–∫–∞–∑–∞—Ç–∏ —ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ç–æ—Ä CMK, —Å—É–±'—î–∫—Ç –≥—Ä–∞–Ω—Ç—É —Ç–∞ –Ω–µ–æ–±—Ö—ñ–¥–Ω–∏–π —Ä—ñ–≤–µ–Ω—å –æ–ø–µ—Ä–∞—Ü—ñ—ó (Decrypt, Encrypt, GenerateDataKey...)
* –ü—ñ—Å–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –≥—Ä–∞–Ω—Ç—É –≤–∏–¥–∞—é—Ç—å—Å—è GrantToken —Ç–∞ GrantID

**–î–æ—Å—Ç—É–ø**:

* –ß–µ—Ä–µ–∑ **–ø–æ–ª—ñ—Ç–∏–∫—É –∫–ª—é—á–∞** -- –Ø–∫—â–æ —Ü–µ —ñ—Å–Ω—É—î, —Ü–µ –º–∞—î **–ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç** –Ω–∞–¥ –ø–æ–ª—ñ—Ç–∏–∫–æ—é IAM
* –ß–µ—Ä–µ–∑ **–ø–æ–ª—ñ—Ç–∏–∫—É IAM**
* –ß–µ—Ä–µ–∑ **–≥—Ä–∞–Ω—Ç–∏**

</details>

### –ê–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∏ –∫–ª—é—á—ñ–≤

–ê–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∏ –∫–ª—é—á—ñ–≤ –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º:

* –ú–∞—é—Ç—å –¥–æ—Å—Ç—É–ø –¥–ª—è —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è KMS, –∞–ª–µ –Ω–µ –¥–ª—è —à–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è –∞–±–æ –¥–µ—à–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è –¥–∞–Ω–∏—Ö
* –¢—ñ–ª—å–∫–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ —Ç–∞ —Ä–æ–ª—ñ IAM –º–æ–∂—É—Ç—å –±—É—Ç–∏ –¥–æ–¥–∞–Ω—ñ –¥–æ —Å–ø–∏—Å–∫—É –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä—ñ–≤ –∫–ª—é—á—ñ–≤ (–Ω–µ –≥—Ä—É–ø–∏)
* –Ø–∫—â–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –∑–æ–≤–Ω—ñ—à–Ω—ñ–π CMK, –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∏ –∫–ª—é—á—ñ–≤ –º–∞—é—Ç—å –¥–æ–∑–≤—ñ–ª –Ω–∞ —ñ–º–ø–æ—Ä—Ç –º–∞—Ç–µ—Ä—ñ–∞–ª—ñ–≤ –∫–ª—é—á–∞

### –†–æ—Ç–∞—Ü—ñ—è CMK

* –ß–∏–º –¥–æ–≤—à–µ —Ç–æ–π —Å–∞–º–∏–π –∫–ª—é—á –∑–∞–ª–∏—à–∞—î—Ç—å—Å—è –Ω–∞ –º—ñ—Å—Ü—ñ, —Ç–∏–º –±—ñ–ª—å—à–µ –¥–∞–Ω–∏—Ö —à–∏—Ñ—Ä—É—î—Ç—å—Å—è —Ü–∏–º –∫–ª—é—á–µ–º, —ñ —è–∫—â–æ —Ü–µ–π –∫–ª—é—á –±—É–¥–µ –∑–ª–∞–º–∞–Ω–æ, —Ç–æ —à–∏—Ä—à–∞ –∑–æ–Ω–∞ —Ä–∏–∑–∏–∫—É –¥–∞–Ω–∏—Ö. –ö—Ä—ñ–º —Ç–æ–≥–æ, —á–∏–º –¥–æ–≤—à–µ –∫–ª—é—á –∞–∫—Ç–∏–≤–Ω–∏–π, —Ç–∏–º –±—ñ–ª—å—à–µ –π–º–æ–≤—ñ—Ä–Ω—ñ—Å—Ç—å –π–æ–≥–æ –∑–ª–∞–º—É.
* **KMS —Ä–æ—Ç—É—î –∫–ª—é—á—ñ –∫–ª—ñ—î–Ω—Ç—ñ–≤ –∫–æ–∂–Ω—ñ 365 –¥–Ω—ñ–≤** (–∞–±–æ –≤–∏ –º–æ–∂–µ—Ç–µ –≤–∏–∫–æ–Ω–∞—Ç–∏ –ø—Ä–æ—Ü–µ—Å –≤—Ä—É—á–Ω—É, –∫–æ–ª–∏ –∑–∞—Ö–æ—á–µ—Ç–µ) —ñ **–∫–ª—é—á—ñ, —â–æ —É–ø—Ä–∞–≤–ª—è—é—Ç—å—Å—è AWS, –∫–æ–∂–Ω—ñ 3 —Ä–æ–∫–∏**, —ñ —Ü—å–æ–≥–æ —Ä–∞–∑—É –Ω–µ –º–æ–∂–Ω–∞ –∑–º—ñ–Ω–∏—Ç–∏.
* **–°—Ç–∞—Ä—ñ –∫–ª—é—á—ñ –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è** –¥–ª—è –¥–µ—à–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è –¥–∞–Ω–∏—Ö, —è–∫—ñ –±—É–ª–∏ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω—ñ –¥–æ —Ä–æ—Ç–∞—Ü—ñ—ó
* –£ —Ä–∞–∑—ñ –∑–ª–∞–º—É, —Ä–æ—Ç–∞—Ü—ñ—è –∫–ª—é—á–∞ –Ω–µ —É—Å—É–Ω–µ –∑–∞–≥—Ä–æ–∑—É, –æ—Å–∫—ñ–ª—å–∫–∏ –±—É–¥–µ –º–æ–∂–ª–∏–≤—ñ—Å—Ç—å –¥–µ—à–∏—Ñ—Ä—É–≤–∞—Ç–∏ –≤—Å—ñ –¥–∞–Ω—ñ, –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω—ñ –∑–ª–∞–º–∞–Ω–∏–º –∫–ª—é—á–µ–º. –û–¥–Ω–∞–∫, **–Ω–æ–≤—ñ –¥–∞–Ω—ñ –±—É–¥—É—Ç—å –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω—ñ –Ω–æ–≤–∏–º –∫–ª—é—á–µ–º**.
* –Ø–∫—â–æ **CMK** –∑–Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è –≤ —Å—Ç–∞–Ω—ñ **–≤–∏–º–∫–Ω–µ–Ω–æ** –∞–±–æ **–≤ –æ—á—ñ–∫—É–≤–∞–Ω–Ω—ñ** **–≤–∏–¥–∞–ª–µ–Ω–Ω—è**, KMS **–Ω–µ –±—É–¥–µ –≤–∏–∫–æ–Ω—É–≤–∞—Ç–∏ —Ä–æ—Ç–∞—Ü—ñ—é –∫–ª—é—á–∞**, –ø–æ–∫–∏ CMK –Ω–µ –±—É–¥–µ –ø–æ–≤—Ç–æ—Ä–Ω–æ –∞–∫—Ç–∏–≤–æ–≤–∞–Ω–æ –∞–±–æ –≤–∏–¥–∞–ª–µ–Ω–Ω—è –Ω–µ –±—É–¥–µ —Å–∫–∞—Å–æ–≤–∞–Ω–æ.

#### –†—É—á–Ω–∞ —Ä–æ—Ç–∞—Ü—ñ—è

* –ü–æ—Ç—Ä—ñ–±–Ω–æ **—Å—Ç–≤–æ—Ä–∏—Ç–∏ –Ω–æ–≤–∏–π CMK**, –ø–æ—Ç—ñ–º —Å—Ç–≤–æ—Ä—é—î—Ç—å—Å—è –Ω–æ–≤–∏–π CMK-ID, —Ç–æ–º—É –≤–∞–º –ø–æ—Ç—Ä—ñ–±–Ω–æ –±—É–¥–µ **–æ–Ω–æ–≤–∏—Ç–∏** –±—É–¥—å-—è–∫—É **–∑–∞—Å—Ç–æ—Å—É–Ω–æ–∫**, —â–æ–± **–ø–æ—Å–∏–ª–∞—Ç–∏—Å—è** –Ω–∞ –Ω–æ–≤–∏–π CMK-ID.
* –©–æ–± —Å–ø—Ä–æ—Å—Ç–∏—Ç–∏ —Ü–µ–π –ø—Ä–æ—Ü–µ—Å, –≤–∏ –º–æ–∂–µ—Ç–µ **–≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –ø—Å–µ–≤–¥–æ–Ω—ñ–º–∏ –¥–ª—è –ø–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ key-id** —ñ –ø–æ—Ç—ñ–º –ø—Ä–æ—Å—Ç–æ –æ–Ω–æ–≤–∏—Ç–∏ –∫–ª—é—á, –Ω–∞ —è–∫–∏–π –ø–æ—Å–∏–ª–∞—î—Ç—å—Å—è –ø—Å–µ–≤–¥–æ–Ω—ñ–º.
* –í–∞–º –ø–æ—Ç—Ä—ñ–±–Ω–æ **–∑–±–µ—Ä—ñ–≥–∞—Ç–∏ —Å—Ç–∞—Ä—ñ –∫–ª—é—á—ñ –¥–ª—è –¥–µ—à–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è —Å—Ç–∞—Ä–∏—Ö —Ñ–∞–π–ª—ñ–≤**, –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—Ö –∑ —ó—Ö –¥–æ–ø–æ–º–æ–≥–æ—é.

–í–∏ –º–æ–∂–µ—Ç–µ —ñ–º–ø–æ—Ä—Ç—É–≤–∞—Ç–∏ –∫–ª—é—á—ñ –∑ –≤–∞—à–æ—ó –ª–æ–∫–∞–ª—å–Ω–æ—ó —ñ–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∏ –∫–ª—é—á—ñ–≤.

### –Ü–Ω—à–∞ –≤–∞–∂–ª–∏–≤–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è KMS

KMS –æ—Ü—ñ–Ω—é—î—Ç—å—Å—è –∑–∞ –∫—ñ–ª—å–∫—ñ—Å—Ç—é –∑–∞–ø–∏—Ç—ñ–≤ –Ω–∞ —à–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è/–¥–µ—à–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è, –æ—Ç—Ä–∏–º–∞–Ω–∏—Ö –≤—ñ–¥ —É—Å—ñ—Ö —Å–ª—É–∂–± –∑–∞ –º—ñ—Å—è—Ü—å.

KMS –º–∞—î –ø–æ–≤–Ω—É –∞—É–¥–∏—Ç–æ—Ä—Å—å–∫—É —Ç–∞ –∫–æ–º–ø–ª–∞—î–Ω—Å **—ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—é –∑ CloudTrail**; —Ç—É—Ç –≤–∏ –º–æ–∂–µ—Ç–µ –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –≤—Å—ñ –∑–º—ñ–Ω–∏, –≤–∏–∫–æ–Ω–∞–Ω—ñ –≤ KMS.

–ó –ø–æ–ª—ñ—Ç–∏–∫–æ—é KMS –≤–∏ –º–æ–∂–µ—Ç–µ –∑—Ä–æ–±–∏—Ç–∏ –Ω–∞—Å—Ç—É–ø–Ω–µ:

* –û–±–º–µ–∂–∏—Ç–∏, —Ö—Ç–æ –º–æ–∂–µ —Å—Ç–≤–æ—Ä—é–≤–∞—Ç–∏ –∫–ª—é—á—ñ –¥–∞–Ω–∏—Ö —ñ —è–∫—ñ —Å–ª—É–∂–±–∏ –º–∞—é—Ç—å –¥–æ—Å—Ç—É–ø –¥–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è —Ü–∏—Ö –∫–ª—é—á—ñ–≤
* –û–±–º–µ–∂–∏—Ç–∏ –¥–æ—Å—Ç—É–ø —Å–∏—Å—Ç–µ–º –¥–æ —à–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è –ª–∏—à–µ, –¥–µ—à–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è –ª–∏—à–µ –∞–±–æ –æ–±–æ—Ö
* –í–∏–∑–Ω–∞—á–∏—Ç–∏, —â–æ–± —Å–∏—Å—Ç–µ–º–∏ –º–æ–≥–ª–∏ –æ—Ç—Ä–∏–º—É–≤–∞—Ç–∏ –¥–æ—Å—Ç—É–ø –¥–æ –∫–ª—é—á—ñ–≤ —á–µ—Ä–µ–∑ —Ä–µ–≥—ñ–æ–Ω–∏ (—Ö–æ—á–∞ —Ü–µ –Ω–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É—î—Ç—å—Å—è, –æ—Å–∫—ñ–ª—å–∫–∏ –∑–±—ñ–π —É —Ä–µ–≥—ñ–æ–Ω—ñ, –¥–µ —Ä–æ–∑–º—ñ—â–µ–Ω–æ KMS, –≤–ø–ª–∏–Ω–µ –Ω–∞ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å —Å–∏—Å—Ç–µ–º –≤ —ñ–Ω—à–∏—Ö —Ä–µ–≥—ñ–æ–Ω–∞—Ö).

–í–∏ –Ω–µ –º–æ–∂–µ—Ç–µ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑—É–≤–∞—Ç–∏ –∞–±–æ –ø–µ—Ä–µ–º—ñ—â–∞—Ç–∏/–∫–æ–ø—ñ—é–≤–∞—Ç–∏ –∫–ª—é—á—ñ –º—ñ–∂ —Ä–µ–≥—ñ–æ–Ω–∞–º–∏; –≤–∏ –º–æ–∂–µ—Ç–µ –ª–∏—à–µ –≤–∏–∑–Ω–∞—á–∏—Ç–∏ –ø—Ä–∞–≤–∏–ª–∞ –¥–ª—è –¥–æ–∑–≤–æ–ª—É –¥–æ—Å—Ç—É–ø—É –º—ñ–∂ —Ä–µ–≥—ñ–æ–Ω–∞–º–∏.

### –ü–µ—Ä–µ—Ä–∞—Ö—É–≤–∞–Ω–Ω—è
```bash
aws kms list-keys
aws kms list-key-policies --key-id <id>
aws kms list-grants --key-id <id>
aws kms describe-key --key-id <id>
aws kms get-key-policy --key-id <id> --policy-name <name> # Default policy name is "default"
aws kms describe-custom-key-stores
```
### Privesc

{% content-ref url="../aws-privilege-escalation/aws-kms-privesc.md" %}
[aws-kms-privesc.md](../aws-privilege-escalation/aws-kms-privesc.md)
{% endcontent-ref %}

### Post Exploitation

{% content-ref url="../aws-post-exploitation/aws-kms-post-exploitation.md" %}
[aws-kms-post-exploitation.md](../aws-post-exploitation/aws-kms-post-exploitation.md)
{% endcontent-ref %}

### Persistence

{% content-ref url="../aws-persistence/aws-kms-persistence.md" %}
[aws-kms-persistence.md](../aws-persistence/aws-kms-persistence.md)
{% endcontent-ref %}

## References

* [https://docs.aws.amazon.com/kms/latest/developerguide/key-policy-default.html](https://docs.aws.amazon.com/kms/latest/developerguide/key-policy-default.html)

{% hint style="success" %}
–í–∏–≤—á–∞–π—Ç–µ —Ç–∞ –ø—Ä–∞–∫—Ç–∏–∫—É–π—Ç–µ AWS Hacking:<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
–í–∏–≤—á–∞–π—Ç–µ —Ç–∞ –ø—Ä–∞–∫—Ç–∏–∫—É–π—Ç–µ GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>–ü—ñ–¥—Ç—Ä–∏–º–∞—Ç–∏ HackTricks</summary>

* –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ [**–ø–ª–∞–Ω–∏ –ø—ñ–¥–ø–∏—Å–∫–∏**](https://github.com/sponsors/carlospolop)!
* **–ü—Ä–∏—î–¥–Ω—É–π—Ç–µ—Å—å –¥–æ** üí¨ [**–≥—Ä—É–ø–∏ Discord**](https://discord.gg/hRep4RUj7f) –∞–±–æ [**–≥—Ä—É–ø–∏ Telegram**](https://t.me/peass) –∞–±–æ **—Å–ª—ñ–¥–∫—É–π—Ç–µ** –∑–∞ –Ω–∞–º–∏ –≤ **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **–î—ñ–ª—ñ—Ç—å—Å—è —Ö–∞–∫–µ—Ä—Å—å–∫–∏–º–∏ —Ç—Ä—é–∫–∞–º–∏, –Ω–∞–¥—Å–∏–ª–∞—é—á–∏ PR –¥–æ** [**HackTricks**](https://github.com/carlospolop/hacktricks) —Ç–∞ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—ó–≤ –Ω–∞ github.

</details>
{% endhint %}
