# AWS - DynamoDB Enum

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the**  [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter**  [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## DynamoDB

### Basic Information

Amazon DynamoDB es presentado por AWS como una **base de datos NoSQL de clave-valor, completamente gestionada y sin servidor**, dise帽ada para impulsar aplicaciones de alto rendimiento sin importar su tama帽o. El servicio garantiza caracter铆sticas robustas que incluyen medidas de seguridad inherentes, copias de seguridad ininterrumpidas, replicaci贸n automatizada en m煤ltiples regiones, almacenamiento en cach茅 en memoria integrado y 煤tiles utilidades de exportaci贸n de datos.

En el contexto de DynamoDB, en lugar de establecer una base de datos tradicional, **se crean tablas**. Cada tabla requiere la especificaci贸n de una **clave de partici贸n** como un componente integral de la **clave primaria de la tabla**. Esta clave de partici贸n, esencialmente un **valor hash**, juega un papel cr铆tico tanto en la recuperaci贸n de elementos como en la distribuci贸n de datos a trav茅s de varios hosts. Esta distribuci贸n es fundamental para mantener tanto la escalabilidad como la disponibilidad de la base de datos. Adem谩s, hay una opci贸n para incorporar una **clave de ordenaci贸n** para refinar a煤n m谩s la organizaci贸n de los datos.

### Encryption

Por defecto, DynamoDB utiliza una clave KMS que \*\*pertenece a Amazon DynamoDB,\*\* ni siquiera la clave gestionada por AWS que al menos pertenece a tu cuenta.

<figure><img src="https://lh4.googleusercontent.com/JjtNS7aA-_GRMgZb4v93jWEQJi6DQdUPq0FEpzZPdeyCeNoG05p0NJiV9Zs-ULs_-Tfjmx0W1ZgsE2Ui2ljo7D-1a87Xny-gpLVQO0XmXdFoph9ci1RepbVNwaCe9oPruEZSEDxGTxF5dIv6pW1WpT6kWA=s2048" alt=""><figcaption></figcaption></figure>

### Backups & Export to S3

Es posible **programar** la generaci贸n de **copias de seguridad de tablas** o crearlas **a demanda**. Adem谩s, tambi茅n es posible habilitar **la recuperaci贸n en el tiempo (PITR) para una tabla.** La recuperaci贸n en el tiempo proporciona **copias de seguridad** continuas de tus datos de DynamoDB durante **35 d铆as** para ayudarte a protegerte contra operaciones de escritura o eliminaci贸n accidentales.

Tambi茅n es posible exportar **los datos de una tabla a S3**, pero la tabla debe tener **PITR habilitado**.

### GUI

Hay una GUI para servicios locales de Dynamo como [DynamoDB Local](https://aws.amazon.com/blogs/aws/dynamodb-local-for-desktop-development/), [dynalite](https://github.com/mhart/dynalite), [localstack](https://github.com/localstack/localstack), etc., que podr铆a ser 煤til: [https://github.com/aaronshaf/dynamodb-admin](https://github.com/aaronshaf/dynamodb-admin)

### Enumeration
```bash
# Tables
aws dynamodb list-tables
aws dynamodb describe-table --table-name <t_name> #Get metadata info
## The primary key and sort key will appear inside the KeySchema field

#Check if point in time recovery is enabled
aws dynamodb describe-continuous-backups \
--table-name tablename

# Backups
aws dynamodb list-backups
aws dynamodb describe-backup --backup-arn <arn>
aws dynamodb describe-continuous-backups --table-name <t_name>

# Global tables
aws dynamodb list-global-tables
aws dynamodb describe-global-table --global-table-name <name>

# Exports
aws dynamodb list-exports
aws dynamodb describe-export --export-arn <arn>

# Misc
aws dynamodb describe-endpoints #Dynamodb endpoints
```
### Acceso No Autenticado

{% content-ref url="../aws-unauthenticated-enum-access/aws-dynamodb-unauthenticated-access.md" %}
[aws-dynamodb-unauthenticated-access.md](../aws-unauthenticated-enum-access/aws-dynamodb-unauthenticated-access.md)
{% endcontent-ref %}

### Escalaci贸n de Privilegios

{% content-ref url="../aws-privilege-escalation/aws-dynamodb-privesc.md" %}
[aws-dynamodb-privesc.md](../aws-privilege-escalation/aws-dynamodb-privesc.md)
{% endcontent-ref %}

### Post Explotaci贸n

{% content-ref url="../aws-post-exploitation/aws-dynamodb-post-exploitation.md" %}
[aws-dynamodb-post-exploitation.md](../aws-post-exploitation/aws-dynamodb-post-exploitation.md)
{% endcontent-ref %}

### Persistencia

{% content-ref url="../aws-persistence/aws-dynamodb-persistence.md" %}
[aws-dynamodb-persistence.md](../aws-persistence/aws-dynamodb-persistence.md)
{% endcontent-ref %}

## Inyecci贸n en DynamoDB

### Inyecci贸n SQL

Hay formas de acceder a los datos de DynamoDB con **sintaxis SQL**, por lo tanto, **inyecciones SQL t铆picas tambi茅n son posibles**.

{% embed url="https://book.hacktricks.xyz/pentesting-web/sql-injection" %}

### Inyecci贸n NoSQL

En DynamoDB se pueden usar diferentes **condiciones** para recuperar datos, como en una inyecci贸n NoSQL com煤n, si es posible **encadenar m谩s condiciones para recuperar** datos, podr铆as obtener datos ocultos (o volcar toda la tabla).\
Puedes encontrar aqu铆 las condiciones soportadas por DynamoDB: [https://docs.aws.amazon.com/amazondynamodb/latest/APIReference/API\_Condition.html](https://docs.aws.amazon.com/amazondynamodb/latest/APIReference/API_Condition.html)

Ten en cuenta que **diferentes condiciones** son soportadas si los datos se acceden a trav茅s de **`query`** o a trav茅s de **`scan`**.

{% hint style="info" %}
De hecho, las acciones de **Query** necesitan especificar la **condici贸n "EQ" (igual)** en la clave **primaria** para funcionar, lo que las hace mucho **menos propensas a inyecciones NoSQL** (y tambi茅n limita mucho la operaci贸n).
{% endhint %}

Si puedes **cambiar la comparaci贸n** realizada o agregar nuevas, podr铆as recuperar m谩s datos.
```bash
# Comparators to dump the database
"NE": "a123" #Get everything that doesn't equal "a123"
"NOT_CONTAINS": "a123" #What you think
"GT": " " #All strings are greater than a space
```
{% embed url="https://book.hacktricks.xyz/pentesting-web/nosql-injection" %}

### Inyecci贸n de Json en bruto

{% hint style="danger" %}
**隆Esta vulnerabilidad se basa en el Filtro de Escaneo de dynamodb que ahora est谩 obsoleto!**
{% endhint %}

**DynamoDB** acepta objetos **Json** para **buscar** datos dentro de la base de datos. Si descubres que puedes escribir en el objeto json enviado para buscar, podr铆as hacer un volcado de la base de datos, todo el contenido.

Por ejemplo, inyectando en una solicitud como:

{% code overflow="wrap" %}
```bash
'{"Id": {"ComparisonOperator": "EQ","AttributeValueList": [{"N": "' + user_input + '"}]}}'
```
{% endcode %}

un atacante podr铆a inyectar algo como:

`1000"}],"ComparisonOperator": "GT","AttributeValueList": [{"N": "0`

arreglar la condici贸n "EQ" buscando el ID 1000 y luego buscando todos los datos con una cadena de Id mayor que 0, que es todo.

Otro **ejemplo vulnerable usando un inicio de sesi贸n** podr铆a ser:
```python
scan_filter = """{
"username": {
"ComparisonOperator": "EQ",
"AttributeValueList": [{"S": "%s"}]
},
"password": {
"ComparisonOperator": "EQ",
"AttributeValueList": [{"S": "%s"}]
}
}
""" % (user_data['username'], user_data['password'])

dynamodb.scan(TableName="table-name", ScanFilter=json.loads(scan_filter))
```
Esto ser铆a vulnerable a:
```
username: none"}],"ComparisonOperator": "NE","AttributeValueList": [{"S": "none
password: none"}],"ComparisonOperator": "NE","AttributeValueList": [{"S": "none
```
### :property Injection

Algunos SDKs permiten usar una cadena que indica el filtrado que se debe realizar, como: 

{% code overflow="wrap" %}
```java
new ScanSpec().withProjectionExpression("UserName").withFilterExpression(user_input+" = :username and Password = :password").withValueMap(valueMap)
```
{% endcode %}

Debes saber que al buscar en DynamoDB para **sustituir** un **valor** de atributo en **expresiones de filtro** mientras se escanean los elementos, los tokens deben **comenzar** con el car谩cter **`:`**. Tales tokens ser谩n **reemplazados** con el **valor de atributo real en tiempo de ejecuci贸n**.

Por lo tanto, un inicio de sesi贸n como el anterior puede ser eludido con algo como:
```bash
:username = :username or :username
# This will generate the query:
# :username = :username or :username = :username and Password = :password
# which is always true
```
{% hint style="success" %}
Aprende y practica Hacking en AWS:<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
Aprende y practica Hacking en GCP: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Apoya a HackTricks</summary>

* Revisa los [**planes de suscripci贸n**](https://github.com/sponsors/carlospolop)!
* **nete al**  [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s铆guenos** en **Twitter**  [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Comparte trucos de hacking enviando PRs a los** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repositorios de github.

</details>
{% endhint %}
