# AWS - DynamoDB Enum

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## DynamoDB

### Basic Information

Amazon DynamoDBëŠ” AWSì—ì„œ **ì™„ì „ ê´€ë¦¬í˜•, ì„œë²„ë¦¬ìŠ¤, í‚¤-ê°’ NoSQL ë°ì´í„°ë² ì´ìŠ¤**ë¡œ ì œê³µë˜ë©°, í¬ê¸°ì— ê´€ê³„ì—†ì´ ê³ ì„±ëŠ¥ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ì§€ì›í•˜ë„ë¡ ì„¤ê³„ë˜ì—ˆìŠµë‹ˆë‹¤. ì´ ì„œë¹„ìŠ¤ëŠ” ë‚´ì¬ëœ ë³´ì•ˆ ì¡°ì¹˜, ì¤‘ë‹¨ ì—†ëŠ” ë°±ì—…, ì—¬ëŸ¬ ì§€ì—­ì— ê±¸ì¹œ ìë™ ë³µì œ, í†µí•© ì¸ë©”ëª¨ë¦¬ ìºì‹± ë° í¸ë¦¬í•œ ë°ì´í„° ë‚´ë³´ë‚´ê¸° ìœ í‹¸ë¦¬í‹°ë¥¼ í¬í•¨í•œ ê°•ë ¥í•œ ê¸°ëŠ¥ì„ ë³´ì¥í•©ë‹ˆë‹¤.

DynamoDBì˜ ë§¥ë½ì—ì„œ ì „í†µì ì¸ ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ì„¤ì •í•˜ëŠ” ëŒ€ì‹  **í…Œì´ë¸”ì´ ìƒì„±ë©ë‹ˆë‹¤**. ê° í…Œì´ë¸”ì€ **í…Œì´ë¸”ì˜ ê¸°ë³¸ í‚¤**ì˜ í•„ìˆ˜ êµ¬ì„± ìš”ì†Œë¡œ **íŒŒí‹°ì…˜ í‚¤**ì˜ ì§€ì •ì„ ìš”êµ¬í•©ë‹ˆë‹¤. ì´ íŒŒí‹°ì…˜ í‚¤ëŠ” ë³¸ì§ˆì ìœ¼ë¡œ **í•´ì‹œ ê°’**ìœ¼ë¡œ, í•­ëª© ê²€ìƒ‰ ë° ë‹¤ì–‘í•œ í˜¸ìŠ¤íŠ¸ ê°„ ë°ì´í„° ë¶„ë°°ì—ì„œ ì¤‘ìš”í•œ ì—­í• ì„ í•©ë‹ˆë‹¤. ì´ ë¶„ë°°ëŠ” ë°ì´í„°ë² ì´ìŠ¤ì˜ í™•ì¥ì„±ê³¼ ê°€ìš©ì„±ì„ ìœ ì§€í•˜ëŠ” ë° í•„ìˆ˜ì ì…ë‹ˆë‹¤. ë˜í•œ, ë°ì´í„° ì¡°ì§ì„ ë”ìš± ì„¸ë¶„í™”í•˜ê¸° ìœ„í•´ **ì •ë ¬ í‚¤**ë¥¼ ì¶”ê°€í•  ìˆ˜ ìˆëŠ” ì˜µì…˜ì´ ìˆìŠµë‹ˆë‹¤.

### Encryption

ê¸°ë³¸ì ìœ¼ë¡œ DynamoDBëŠ” **Amazon DynamoDBì— ì†í•˜ëŠ”** KMS í‚¤ë¥¼ ì‚¬ìš©í•˜ë©°, ê·€í•˜ì˜ ê³„ì •ì— ìµœì†Œí•œ ì†í•˜ëŠ” AWS ê´€ë¦¬ í‚¤ì¡°ì°¨ ì‚¬ìš©í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.

<figure><img src="https://lh4.googleusercontent.com/JjtNS7aA-_GRMgZb4v93jWEQJi6DQdUPq0FEpzZPdeyCeNoG05p0NJiV9Zs-ULs_-Tfjmx0W1ZgsE2Ui2ljo7D-1a87Xny-gpLVQO0XmXdFoph9ci1RepbVNwaCe9oPruEZSEDxGTxF5dIv6pW1WpT6kWA=s2048" alt=""><figcaption></figcaption></figure>

### Backups & Export to S3

**í…Œì´ë¸” ë°±ì—…** ìƒì„±ì„ **ì˜ˆì•½**í•˜ê±°ë‚˜ **ìš”ì²­**ì— ë”°ë¼ ìƒì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë˜í•œ, **í…Œì´ë¸”ì— ëŒ€í•œ ì‹œì  ë³µêµ¬(PITR)**ë¥¼ í™œì„±í™”í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤. ì‹œì  ë³µêµ¬ëŠ” ìš°ë°œì ì¸ ì“°ê¸° ë˜ëŠ” ì‚­ì œ ì‘ì—…ìœ¼ë¡œë¶€í„° ë³´í˜¸í•˜ê¸° ìœ„í•´ DynamoDB ë°ì´í„°ì˜ **35ì¼** ë™ì•ˆ ì§€ì†ì ì¸ **ë°±ì—…**ì„ ì œê³µí•©ë‹ˆë‹¤.

**í…Œì´ë¸”ì˜ ë°ì´í„°ë¥¼ S3ë¡œ ë‚´ë³´ë‚´ëŠ”** ê²ƒë„ ê°€ëŠ¥í•˜ì§€ë§Œ, í…Œì´ë¸”ì— **PITRì´ í™œì„±í™”ë˜ì–´ ìˆì–´ì•¼** í•©ë‹ˆë‹¤.

### GUI

[**DynamoDB Local**](https://aws.amazon.com/blogs/aws/dynamodb-local-for-desktop-development/), [**dynalite**](https://github.com/mhart/dynalite), [**localstack**](https://github.com/localstack/localstack) ë“±ê³¼ ê°™ì€ ë¡œì»¬ Dynamo ì„œë¹„ìŠ¤ì— ëŒ€í•œ GUIê°€ ìˆìœ¼ë©°, ìœ ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤: [https://github.com/aaronshaf/dynamodb-admin](https://github.com/aaronshaf/dynamodb-admin)

### Enumeration
```bash
# Tables
aws dynamodb list-tables
aws dynamodb describe-table --table-name <t_name> #Get metadata info
## The primary key and sort key will appear inside the KeySchema field

#Check if point in time recovery is enabled
aws dynamodb describe-continuous-backups \
--table-name tablename

# Backups
aws dynamodb list-backups
aws dynamodb describe-backup --backup-arn <arn>
aws dynamodb describe-continuous-backups --table-name <t_name>

# Global tables
aws dynamodb list-global-tables
aws dynamodb describe-global-table --global-table-name <name>

# Exports
aws dynamodb list-exports
aws dynamodb describe-export --export-arn <arn>

# Misc
aws dynamodb describe-endpoints #Dynamodb endpoints
```
### ì¸ì¦ë˜ì§€ ì•Šì€ ì ‘ê·¼

{% content-ref url="../aws-unauthenticated-enum-access/aws-dynamodb-unauthenticated-access.md" %}
[aws-dynamodb-unauthenticated-access.md](../aws-unauthenticated-enum-access/aws-dynamodb-unauthenticated-access.md)
{% endcontent-ref %}

### ê¶Œí•œ ìƒìŠ¹

{% content-ref url="../aws-privilege-escalation/aws-dynamodb-privesc.md" %}
[aws-dynamodb-privesc.md](../aws-privilege-escalation/aws-dynamodb-privesc.md)
{% endcontent-ref %}

### í¬ìŠ¤íŠ¸ ìµìŠ¤í”Œë¡œì‡

{% content-ref url="../aws-post-exploitation/aws-dynamodb-post-exploitation.md" %}
[aws-dynamodb-post-exploitation.md](../aws-post-exploitation/aws-dynamodb-post-exploitation.md)
{% endcontent-ref %}

### ì§€ì†ì„±

{% content-ref url="../aws-persistence/aws-dynamodb-persistence.md" %}
[aws-dynamodb-persistence.md](../aws-persistence/aws-dynamodb-persistence.md)
{% endcontent-ref %}

## DynamoDB ì¸ì ì…˜

### SQL ì¸ì ì…˜

DynamoDB ë°ì´í„°ì— **SQL êµ¬ë¬¸**ìœ¼ë¡œ ì ‘ê·¼í•  ìˆ˜ ìˆëŠ” ë°©ë²•ì´ ìˆìœ¼ë¯€ë¡œ, ì¼ë°˜ì ì¸ **SQL ì¸ì ì…˜ë„ ê°€ëŠ¥í•©ë‹ˆë‹¤**.

{% embed url="https://book.hacktricks.xyz/pentesting-web/sql-injection" %}

### NoSQL ì¸ì ì…˜

DynamoDBì—ì„œëŠ” ë°ì´í„°ë¥¼ ê²€ìƒ‰í•˜ê¸° ìœ„í•´ ë‹¤ì–‘í•œ **ì¡°ê±´**ì„ ì‚¬ìš©í•  ìˆ˜ ìˆìœ¼ë©°, ì¼ë°˜ì ì¸ NoSQL ì¸ì ì…˜ì—ì„œ **ë” ë§ì€ ì¡°ê±´ì„ ì—°ê²°í•˜ì—¬** ë°ì´í„°ë¥¼ ê²€ìƒ‰í•  ìˆ˜ ìˆë‹¤ë©´ ìˆ¨ê²¨ì§„ ë°ì´í„°(ë˜ëŠ” ì „ì²´ í…Œì´ë¸”ì„ ë¤í”„í•  ìˆ˜ ìˆìŒ)ë¥¼ ì–»ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.\
ì—¬ê¸°ì—ì„œ DynamoDBì—ì„œ ì§€ì›í•˜ëŠ” ì¡°ê±´ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤: [https://docs.aws.amazon.com/amazondynamodb/latest/APIReference/API\_Condition.html](https://docs.aws.amazon.com/amazondynamodb/latest/APIReference/API\_Condition.html)

**`query`** ë˜ëŠ” **`scan`**ì„ í†µí•´ ë°ì´í„°ì— ì ‘ê·¼í•  ê²½ìš° **ë‹¤ë¥¸ ì¡°ê±´**ì´ ì§€ì›ëœë‹¤ëŠ” ì ì— ìœ ì˜í•˜ì„¸ìš”.

{% hint style="info" %}
ì‹¤ì œë¡œ, **Query** ì‘ì—…ì€ ì‘ë™í•˜ê¸° ìœ„í•´ **ê¸°ë³¸** í‚¤ì—ì„œ **ì¡°ê±´ "EQ" (ê°™ìŒ)**ì„ ì§€ì •í•´ì•¼ í•˜ë¯€ë¡œ, **NoSQL ì¸ì ì…˜ì— ëœ ì·¨ì•½**í•©ë‹ˆë‹¤(ë˜í•œ ì‘ì—…ì´ ë§¤ìš° ì œí•œì ì…ë‹ˆë‹¤).
{% endhint %}

ë¹„êµë¥¼ **ë³€ê²½**í•˜ê±°ë‚˜ ìƒˆë¡œìš´ ë¹„êµë¥¼ ì¶”ê°€í•  ìˆ˜ ìˆë‹¤ë©´, ë” ë§ì€ ë°ì´í„°ë¥¼ ê²€ìƒ‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
```bash
# Comparators to dump the database
"NE": "a123" #Get everything that doesn't equal "a123"
"NOT_CONTAINS": "a123" #What you think
"GT": " " #All strings are greater than a space
```
{% embed url="https://book.hacktricks.xyz/pentesting-web/nosql-injection" %}

### Raw Json injection

{% hint style="danger" %}
**ì´ ì·¨ì•½ì ì€ í˜„ì¬ ì‚¬ìš© ì¤‘ì§€ëœ dynamodb Scan Filterì— ê¸°ë°˜í•©ë‹ˆë‹¤!**
{% endhint %}

**DynamoDB**ëŠ” DB ë‚´ì—ì„œ ë°ì´í„°ë¥¼ **ê²€ìƒ‰**í•˜ê¸° ìœ„í•´ **Json** ê°ì²´ë¥¼ ìˆ˜ë½í•©ë‹ˆë‹¤. ê²€ìƒ‰ì„ ìœ„í•´ ì „ì†¡ëœ json ê°ì²´ì— ì“¸ ìˆ˜ ìˆë‹¤ëŠ” ê²ƒì„ ë°œê²¬í•˜ë©´, DB ë¤í”„ë¥¼ ë§Œë“¤ì–´ ëª¨ë“  ë‚´ìš©ì„ ê°€ì ¸ì˜¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì˜ˆë¥¼ ë“¤ì–´, ë‹¤ìŒê³¼ ê°™ì€ ìš”ì²­ì— ì£¼ì…í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤:

{% code overflow="wrap" %}
```bash
'{"Id": {"ComparisonOperator": "EQ","AttributeValueList": [{"N": "' + user_input + '"}]}}'
```
{% endcode %}

ê³µê²©ìëŠ” ë‹¤ìŒê³¼ ê°™ì€ ê²ƒì„ ì£¼ì…í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

`1000"}],"ComparisonOperator": "GT","AttributeValueList": [{"N": "0`

ID 1000ì„ ê²€ìƒ‰í•˜ëŠ” "EQ" ì¡°ê±´ì„ ìˆ˜ì •í•œ ë‹¤ìŒ, 0ë³´ë‹¤ í° ëª¨ë“  Id ë¬¸ìì—´ì„ ì°¾ëŠ” ê²ƒì…ë‹ˆë‹¤. ì´ëŠ” ëª¨ë“  ë°ì´í„°ì…ë‹ˆë‹¤.

ë˜ ë‹¤ë¥¸ **ë¡œê·¸ì¸ì„ ì‚¬ìš©í•˜ëŠ” ì·¨ì•½í•œ ì˜ˆ**ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤:
```python
scan_filter = """{
"username": {
"ComparisonOperator": "EQ",
"AttributeValueList": [{"S": "%s"}]
},
"password": {
"ComparisonOperator": "EQ",
"AttributeValueList": [{"S": "%s"}]
}
}
""" % (user_data['username'], user_data['password'])

dynamodb.scan(TableName="table-name", ScanFilter=json.loads(scan_filter))
```
ì´ê²ƒì€ ë‹¤ìŒê³¼ ê°™ì€ ì·¨ì•½ì ì´ ìˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```
username: none"}],"ComparisonOperator": "NE","AttributeValueList": [{"S": "none
password: none"}],"ComparisonOperator": "NE","AttributeValueList": [{"S": "none
```
### :property Injection

ì¼ë¶€ SDKëŠ” ìˆ˜í–‰í•  í•„í„°ë§ì„ ë‚˜íƒ€ë‚´ëŠ” ë¬¸ìì—´ì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´: 

{% code overflow="wrap" %}
```java
new ScanSpec().withProjectionExpression("UserName").withFilterExpression(user_input+" = :username and Password = :password").withValueMap(valueMap)
```
{% endcode %}

DynamoDBì—ì„œ í•­ëª©ì„ ìŠ¤ìº”í•  ë•Œ **í•„í„° í‘œí˜„ì‹**ì—ì„œ ì†ì„± **ê°’**ì„ **ëŒ€ì²´**í•˜ê¸° ìœ„í•´ ê²€ìƒ‰í•  ë•Œ, í† í°ì€ **`:`** ë¬¸ìë¡œ **ì‹œì‘í•´ì•¼** í•©ë‹ˆë‹¤. ì´ëŸ¬í•œ í† í°ì€ **ì‹¤í–‰ ì‹œê°„ì— ì‹¤ì œ ì†ì„± ê°’ìœ¼ë¡œ ëŒ€ì²´**ë©ë‹ˆë‹¤.

ë”°ë¼ì„œ ì´ì „ê³¼ ê°™ì€ ë¡œê·¸ì¸ì„ ìš°íšŒí•  ìˆ˜ ìˆëŠ” ë°©ë²•ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤:
```bash
:username = :username or :username
# This will generate the query:
# :username = :username or :username = :username and Password = :password
# which is always true
```
{% hint style="success" %}
AWS í•´í‚¹ ë°°ìš°ê¸° ë° ì—°ìŠµí•˜ê¸°:<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
GCP í•´í‚¹ ë°°ìš°ê¸° ë° ì—°ìŠµí•˜ê¸°: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks ì§€ì›í•˜ê¸°</summary>

* [**êµ¬ë… ê³„íš**](https://github.com/sponsors/carlospolop) í™•ì¸í•˜ê¸°!
* **ğŸ’¬ [**ë””ìŠ¤ì½”ë“œ ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— ì°¸ì—¬í•˜ê±°ë‚˜ **íŠ¸ìœ„í„°** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**ë¥¼ íŒ”ë¡œìš°í•˜ì„¸ìš”.**
* **[**HackTricks**](https://github.com/carlospolop/hacktricks) ë° [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) ê¹ƒí—ˆë¸Œ ë¦¬í¬ì§€í† ë¦¬ì— PRì„ ì œì¶œí•˜ì—¬ í•´í‚¹ íŠ¸ë¦­ì„ ê³µìœ í•˜ì„¸ìš”.**

</details>
{% endhint %}
