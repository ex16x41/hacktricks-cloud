# AWS - MQ Enum

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** 💬 [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Amazon MQ

### Introduction to Message Brokers

**Message brokers** serve as intermediaries, facilitating communication between different software systems, which may be built on varied platforms and programmed in different languages. **Amazon MQ** απλοποιεί την ανάπτυξη, λειτουργία και συντήρηση των message brokers στο AWS. Παρέχει διαχειριζόμενες υπηρεσίες για **Apache ActiveMQ** και **RabbitMQ**, εξασφαλίζοντας απρόσκοπτη προμήθεια και αυτόματες ενημερώσεις λογισμικού.

### AWS - RabbitMQ

RabbitMQ είναι ένα εξέχον **message-queueing software**, επίσης γνωστό ως _message broker_ ή _queue manager_. Είναι θεμελιωδώς ένα σύστημα όπου οι ουρές είναι ρυθμισμένες. Οι εφαρμογές αλληλεπιδρούν με αυτές τις ουρές για να **στείλουν και να λάβουν μηνύματα**. Τα μηνύματα σε αυτό το πλαίσιο μπορούν να μεταφέρουν μια ποικιλία πληροφοριών, από εντολές για την εκκίνηση διαδικασιών σε άλλες εφαρμογές (πιθανώς σε διαφορετικούς διακομιστές) έως απλά κείμενα. Τα μηνύματα κρατούνται από το λογισμικό του queue-manager μέχρι να ανακτηθούν και να επεξεργαστούν από μια εφαρμογή λήψης. Το AWS παρέχει μια εύχρηστη λύση για τη φιλοξενία και τη διαχείριση των διακομιστών RabbitMQ.

### AWS - ActiveMQ

Apache ActiveMQ® είναι ένας κορυφαίος ανοιχτού κώδικα, Java-based **message broker** γνωστός για την ευελιξία του. Υποστηρίζει πολλαπλά βιομηχανικά πρότυπα πρωτοκόλλων, προσφέροντας εκτενή συμβατότητα πελατών σε μια ευρεία γκάμα γλωσσών και πλατφορμών. Οι χρήστες μπορούν να:

* Συνδεθούν με πελάτες γραμμένους σε JavaScript, C, C++, Python, .Net και άλλα.
* Εκμεταλλευτούν το πρωτόκολλο **AMQP** για την ενσωμάτωση εφαρμογών από διαφορετικές πλατφόρμες.
* Χρησιμοποιήσουν **STOMP** μέσω websockets για ανταλλαγές μηνυμάτων σε διαδικτυακές εφαρμογές.
* Διαχειριστούν συσκευές IoT με **MQTT**.
* Διατηρήσουν την υπάρχουσα υποδομή **JMS** και επεκτείνουν τις δυνατότητές της.

Η ανθεκτικότητα και η ευελιξία του ActiveMQ το καθιστούν κατάλληλο για μια πληθώρα απαιτήσεων μηνυμάτων.

## Enumeration
```bash
# List brokers
aws mq list-brokers

# Get broker info
aws mq describe-broker --broker-id <broker-id>
## Find endpoints in .BrokerInstances
## Find if public accessible in .PubliclyAccessible

# List usernames (only for ActiveMQ)
aws mq list-users --broker-id <broker-id>

# Get user info (PASSWORD NOT INCLUDED)
aws mq describe-user --broker-id <broker-id> --username <username>

# Lits configurations (only for ActiveMQ)
aws mq list-configurations
## Here you can find if simple or LDAP authentication is used

# Creacte Active MQ user
aws mq create-user --broker-id <value> --password <value> --username <value> --console-access
```
{% hint style="warning" %}
TODO: Υποδείξτε πώς να καταμετρήσετε το RabbitMQ και το ActiveMQ εσωτερικά και πώς να ακούσετε σε όλες τις ουρές και να στείλετε δεδομένα (στείλτε PR αν ξέρετε πώς να το κάνετε αυτό)
{% endhint %}

## Privesc

{% content-ref url="../aws-privilege-escalation/aws-mq-privesc.md" %}
[aws-mq-privesc.md](../aws-privilege-escalation/aws-mq-privesc.md)
{% endcontent-ref %}

## Unauthenticated Access

{% content-ref url="../aws-unauthenticated-enum-access/aws-mq-unauthenticated-enum.md" %}
[aws-mq-unauthenticated-enum.md](../aws-unauthenticated-enum-access/aws-mq-unauthenticated-enum.md)
{% endcontent-ref %}

## Persistence

Αν γνωρίζετε τα διαπιστευτήρια για να αποκτήσετε πρόσβαση στην κονσόλα ιστού RabbitMQ, μπορείτε να δημιουργήσετε έναν νέο χρήστη με δικαιώματα διαχειριστή.

## References

* [https://www.cloudamqp.com/blog/part1-rabbitmq-for-beginners-what-is-rabbitmq.html](https://www.cloudamqp.com/blog/part1-rabbitmq-for-beginners-what-is-rabbitmq.html)
* [https://activemq.apache.org/](https://activemq.apache.org/)

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** 💬 [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
