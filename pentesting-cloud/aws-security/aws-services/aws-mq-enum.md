# AWS - MQ Enum

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Amazon MQ

### Introduction to Message Brokers

**Message brokers** serve as intermediaries, facilitating communication between different software systems, which may be built on varied platforms and programmed in different languages. **Amazon MQ** Î±Ï€Î»Î¿Ï€Î¿Î¹ÎµÎ¯ Ï„Î·Î½ Î±Î½Î¬Ï€Ï„Ï…Î¾Î·, Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¯Î± ÎºÎ±Î¹ ÏƒÏ…Î½Ï„Î®ÏÎ·ÏƒÎ· Ï„Ï‰Î½ message brokers ÏƒÏ„Î¿ AWS. Î Î±ÏÎ­Ï‡ÎµÎ¹ Î´Î¹Î±Ï‡ÎµÎ¹ÏÎ¹Î¶ÏŒÎ¼ÎµÎ½ÎµÏ‚ Ï…Ï€Î·ÏÎµÏƒÎ¯ÎµÏ‚ Î³Î¹Î± **Apache ActiveMQ** ÎºÎ±Î¹ **RabbitMQ**, ÎµÎ¾Î±ÏƒÏ†Î±Î»Î¯Î¶Î¿Î½Ï„Î±Ï‚ Î±Ï€ÏÏŒÏƒÎºÎ¿Ï€Ï„Î· Ï€ÏÎ¿Î¼Î®Î¸ÎµÎ¹Î± ÎºÎ±Î¹ Î±Ï…Ï„ÏŒÎ¼Î±Ï„ÎµÏ‚ ÎµÎ½Î·Î¼ÎµÏÏÏƒÎµÎ¹Ï‚ Î»Î¿Î³Î¹ÏƒÎ¼Î¹ÎºÎ¿Ï.

### AWS - RabbitMQ

RabbitMQ ÎµÎ¯Î½Î±Î¹ Î­Î½Î± ÎµÎ¾Î­Ï‡Î¿Î½ **message-queueing software**, ÎµÏ€Î¯ÏƒÎ·Ï‚ Î³Î½Ï‰ÏƒÏ„ÏŒ Ï‰Ï‚ _message broker_ Î® _queue manager_. Î•Î¯Î½Î±Î¹ Î¸ÎµÎ¼ÎµÎ»Î¹Ï‰Î´ÏÏ‚ Î­Î½Î± ÏƒÏÏƒÏ„Î·Î¼Î± ÏŒÏ€Î¿Ï… Î¿Î¹ Î¿Ï…ÏÎ­Ï‚ ÎµÎ¯Î½Î±Î¹ ÏÏ…Î¸Î¼Î¹ÏƒÎ¼Î­Î½ÎµÏ‚. ÎŸÎ¹ ÎµÏ†Î±ÏÎ¼Î¿Î³Î­Ï‚ Î±Î»Î»Î·Î»ÎµÏ€Î¹Î´ÏÎ¿ÏÎ½ Î¼Îµ Î±Ï…Ï„Î­Ï‚ Ï„Î¹Ï‚ Î¿Ï…ÏÎ­Ï‚ Î³Î¹Î± Î½Î± **ÏƒÏ„ÎµÎ¯Î»Î¿Ï…Î½ ÎºÎ±Î¹ Î½Î± Î»Î¬Î²Î¿Ï…Î½ Î¼Î·Î½ÏÎ¼Î±Ï„Î±**. Î¤Î± Î¼Î·Î½ÏÎ¼Î±Ï„Î± ÏƒÎµ Î±Ï…Ï„ÏŒ Ï„Î¿ Ï€Î»Î±Î¯ÏƒÎ¹Î¿ Î¼Ï€Î¿ÏÎ¿ÏÎ½ Î½Î± Î¼ÎµÏ„Î±Ï†Î­ÏÎ¿Ï…Î½ Î¼Î¹Î± Ï€Î¿Î¹ÎºÎ¹Î»Î¯Î± Ï€Î»Î·ÏÎ¿Ï†Î¿ÏÎ¹ÏÎ½, Î±Ï€ÏŒ ÎµÎ½Ï„Î¿Î»Î­Ï‚ Î³Î¹Î± Ï„Î·Î½ ÎµÎºÎºÎ¯Î½Î·ÏƒÎ· Î´Î¹Î±Î´Î¹ÎºÎ±ÏƒÎ¹ÏÎ½ ÏƒÎµ Î¬Î»Î»ÎµÏ‚ ÎµÏ†Î±ÏÎ¼Î¿Î³Î­Ï‚ (Ï€Î¹Î¸Î±Î½ÏÏ‚ ÏƒÎµ Î´Î¹Î±Ï†Î¿ÏÎµÏ„Î¹ÎºÎ¿ÏÏ‚ Î´Î¹Î±ÎºÎ¿Î¼Î¹ÏƒÏ„Î­Ï‚) Î­Ï‰Ï‚ Î±Ï€Î»Î¬ ÎºÎµÎ¯Î¼ÎµÎ½Î±. Î¤Î± Î¼Î·Î½ÏÎ¼Î±Ï„Î± ÎºÏÎ±Ï„Î¿ÏÎ½Ï„Î±Î¹ Î±Ï€ÏŒ Ï„Î¿ Î»Î¿Î³Î¹ÏƒÎ¼Î¹ÎºÏŒ Ï„Î¿Ï… queue-manager Î¼Î­Ï‡ÏÎ¹ Î½Î± Î±Î½Î±ÎºÏ„Î·Î¸Î¿ÏÎ½ ÎºÎ±Î¹ Î½Î± ÎµÏ€ÎµÎ¾ÎµÏÎ³Î±ÏƒÏ„Î¿ÏÎ½ Î±Ï€ÏŒ Î¼Î¹Î± ÎµÏ†Î±ÏÎ¼Î¿Î³Î® Î»Î®ÏˆÎ·Ï‚. Î¤Î¿ AWS Ï€Î±ÏÎ­Ï‡ÎµÎ¹ Î¼Î¹Î± ÎµÏÏ‡ÏÎ·ÏƒÏ„Î· Î»ÏÏƒÎ· Î³Î¹Î± Ï„Î· Ï†Î¹Î»Î¿Î¾ÎµÎ½Î¯Î± ÎºÎ±Î¹ Ï„Î· Î´Î¹Î±Ï‡ÎµÎ¯ÏÎ¹ÏƒÎ· Ï„Ï‰Î½ Î´Î¹Î±ÎºÎ¿Î¼Î¹ÏƒÏ„ÏÎ½ RabbitMQ.

### AWS - ActiveMQ

Apache ActiveMQÂ® ÎµÎ¯Î½Î±Î¹ Î­Î½Î±Ï‚ ÎºÎ¿ÏÏ…Ï†Î±Î¯Î¿Ï‚ Î±Î½Î¿Î¹Ï‡Ï„Î¿Ï ÎºÏÎ´Î¹ÎºÎ±, Java-based **message broker** Î³Î½Ï‰ÏƒÏ„ÏŒÏ‚ Î³Î¹Î± Ï„Î·Î½ ÎµÏ…ÎµÎ»Î¹Î¾Î¯Î± Ï„Î¿Ï…. Î¥Ï€Î¿ÏƒÏ„Î·ÏÎ¯Î¶ÎµÎ¹ Ï€Î¿Î»Î»Î±Ï€Î»Î¬ Î²Î¹Î¿Î¼Î·Ï‡Î±Î½Î¹ÎºÎ¬ Ï€ÏÏŒÏ„Ï…Ï€Î± Ï€ÏÏ‰Ï„Î¿ÎºÏŒÎ»Î»Ï‰Î½, Ï€ÏÎ¿ÏƒÏ†Î­ÏÎ¿Î½Ï„Î±Ï‚ ÎµÎºÏ„ÎµÎ½Î® ÏƒÏ…Î¼Î²Î±Ï„ÏŒÏ„Î·Ï„Î± Ï€ÎµÎ»Î±Ï„ÏÎ½ ÏƒÎµ Î¼Î¹Î± ÎµÏ…ÏÎµÎ¯Î± Î³ÎºÎ¬Î¼Î± Î³Î»Ï‰ÏƒÏƒÏÎ½ ÎºÎ±Î¹ Ï€Î»Î±Ï„Ï†Î¿ÏÎ¼ÏÎ½. ÎŸÎ¹ Ï‡ÏÎ®ÏƒÏ„ÎµÏ‚ Î¼Ï€Î¿ÏÎ¿ÏÎ½ Î½Î±:

* Î£Ï…Î½Î´ÎµÎ¸Î¿ÏÎ½ Î¼Îµ Ï€ÎµÎ»Î¬Ï„ÎµÏ‚ Î³ÏÎ±Î¼Î¼Î­Î½Î¿Ï…Ï‚ ÏƒÎµ JavaScript, C, C++, Python, .Net ÎºÎ±Î¹ Î¬Î»Î»Î±.
* Î•ÎºÎ¼ÎµÏ„Î±Î»Î»ÎµÏ…Ï„Î¿ÏÎ½ Ï„Î¿ Ï€ÏÏ‰Ï„ÏŒÎºÎ¿Î»Î»Î¿ **AMQP** Î³Î¹Î± Ï„Î·Î½ ÎµÎ½ÏƒÏ‰Î¼Î¬Ï„Ï‰ÏƒÎ· ÎµÏ†Î±ÏÎ¼Î¿Î³ÏÎ½ Î±Ï€ÏŒ Î´Î¹Î±Ï†Î¿ÏÎµÏ„Î¹ÎºÎ­Ï‚ Ï€Î»Î±Ï„Ï†ÏŒÏÎ¼ÎµÏ‚.
* Î§ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î®ÏƒÎ¿Ï…Î½ **STOMP** Î¼Î­ÏƒÏ‰ websockets Î³Î¹Î± Î±Î½Ï„Î±Î»Î»Î±Î³Î­Ï‚ Î¼Î·Î½Ï…Î¼Î¬Ï„Ï‰Î½ ÏƒÎµ Î´Î¹Î±Î´Î¹ÎºÏ„Ï…Î±ÎºÎ­Ï‚ ÎµÏ†Î±ÏÎ¼Î¿Î³Î­Ï‚.
* Î”Î¹Î±Ï‡ÎµÎ¹ÏÎ¹ÏƒÏ„Î¿ÏÎ½ ÏƒÏ…ÏƒÎºÎµÏ…Î­Ï‚ IoT Î¼Îµ **MQTT**.
* Î”Î¹Î±Ï„Î·ÏÎ®ÏƒÎ¿Ï…Î½ Ï„Î·Î½ Ï…Ï€Î¬ÏÏ‡Î¿Ï…ÏƒÎ± Ï…Ï€Î¿Î´Î¿Î¼Î® **JMS** ÎºÎ±Î¹ ÎµÏ€ÎµÎºÏ„ÎµÎ¯Î½Î¿Ï…Î½ Ï„Î¹Ï‚ Î´Ï…Î½Î±Ï„ÏŒÏ„Î·Ï„Î­Ï‚ Ï„Î·Ï‚.

Î— Î±Î½Î¸ÎµÎºÏ„Î¹ÎºÏŒÏ„Î·Ï„Î± ÎºÎ±Î¹ Î· ÎµÏ…ÎµÎ»Î¹Î¾Î¯Î± Ï„Î¿Ï… ActiveMQ Ï„Î¿ ÎºÎ±Î¸Î¹ÏƒÏ„Î¿ÏÎ½ ÎºÎ±Ï„Î¬Î»Î»Î·Î»Î¿ Î³Î¹Î± Î¼Î¹Î± Ï€Î»Î·Î¸ÏÏÎ± Î±Ï€Î±Î¹Ï„Î®ÏƒÎµÏ‰Î½ Î¼Î·Î½Ï…Î¼Î¬Ï„Ï‰Î½.

## Enumeration
```bash
# List brokers
aws mq list-brokers

# Get broker info
aws mq describe-broker --broker-id <broker-id>
## Find endpoints in .BrokerInstances
## Find if public accessible in .PubliclyAccessible

# List usernames (only for ActiveMQ)
aws mq list-users --broker-id <broker-id>

# Get user info (PASSWORD NOT INCLUDED)
aws mq describe-user --broker-id <broker-id> --username <username>

# Lits configurations (only for ActiveMQ)
aws mq list-configurations
## Here you can find if simple or LDAP authentication is used

# Creacte Active MQ user
aws mq create-user --broker-id <value> --password <value> --username <value> --console-access
```
{% hint style="warning" %}
TODO: Î¥Ï€Î¿Î´ÎµÎ¯Î¾Ï„Îµ Ï€ÏÏ‚ Î½Î± ÎºÎ±Ï„Î±Î¼ÎµÏ„ÏÎ®ÏƒÎµÏ„Îµ Ï„Î¿ RabbitMQ ÎºÎ±Î¹ Ï„Î¿ ActiveMQ ÎµÏƒÏ‰Ï„ÎµÏÎ¹ÎºÎ¬ ÎºÎ±Î¹ Ï€ÏÏ‚ Î½Î± Î±ÎºÎ¿ÏÏƒÎµÏ„Îµ ÏƒÎµ ÏŒÎ»ÎµÏ‚ Ï„Î¹Ï‚ Î¿Ï…ÏÎ­Ï‚ ÎºÎ±Î¹ Î½Î± ÏƒÏ„ÎµÎ¯Î»ÎµÏ„Îµ Î´ÎµÎ´Î¿Î¼Î­Î½Î± (ÏƒÏ„ÎµÎ¯Î»Ï„Îµ PR Î±Î½ Î¾Î­ÏÎµÏ„Îµ Ï€ÏÏ‚ Î½Î± Ï„Î¿ ÎºÎ¬Î½ÎµÏ„Îµ Î±Ï…Ï„ÏŒ)
{% endhint %}

## Privesc

{% content-ref url="../aws-privilege-escalation/aws-mq-privesc.md" %}
[aws-mq-privesc.md](../aws-privilege-escalation/aws-mq-privesc.md)
{% endcontent-ref %}

## Unauthenticated Access

{% content-ref url="../aws-unauthenticated-enum-access/aws-mq-unauthenticated-enum.md" %}
[aws-mq-unauthenticated-enum.md](../aws-unauthenticated-enum-access/aws-mq-unauthenticated-enum.md)
{% endcontent-ref %}

## Persistence

Î‘Î½ Î³Î½Ï‰ÏÎ¯Î¶ÎµÏ„Îµ Ï„Î± Î´Î¹Î±Ï€Î¹ÏƒÏ„ÎµÏ…Ï„Î®ÏÎ¹Î± Î³Î¹Î± Î½Î± Î±Ï€Î¿ÎºÏ„Î®ÏƒÎµÏ„Îµ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ· ÏƒÏ„Î·Î½ ÎºÎ¿Î½ÏƒÏŒÎ»Î± Î¹ÏƒÏ„Î¿Ï RabbitMQ, Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î®ÏƒÎµÏ„Îµ Î­Î½Î±Î½ Î½Î­Î¿ Ï‡ÏÎ®ÏƒÏ„Î· Î¼Îµ Î´Î¹ÎºÎ±Î¹ÏÎ¼Î±Ï„Î± Î´Î¹Î±Ï‡ÎµÎ¹ÏÎ¹ÏƒÏ„Î®.

## References

* [https://www.cloudamqp.com/blog/part1-rabbitmq-for-beginners-what-is-rabbitmq.html](https://www.cloudamqp.com/blog/part1-rabbitmq-for-beginners-what-is-rabbitmq.html)
* [https://activemq.apache.org/](https://activemq.apache.org/)

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
