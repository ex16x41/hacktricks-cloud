# AWS - STS Enum

{% hint style="success" %}
AWS Hacking Ã¶ÄŸrenin ve pratik yapÄ±n:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCP Hacking Ã¶ÄŸrenin ve pratik yapÄ±n: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**abonelik planlarÄ±nÄ±**](https://github.com/sponsors/carlospolop) kontrol edin!
* **ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n ya da **Twitter'da** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** takip edin.**
* **HackTricks'e PR gÃ¶ndererek hacking ipuÃ§larÄ±nÄ± paylaÅŸÄ±n** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na.

</details>
{% endhint %}

## STS

**AWS Security Token Service (STS)** Ã¶ncelikle **geÃ§ici, sÄ±nÄ±rlÄ± ayrÄ±calÄ±klÄ± kimlik bilgileri** saÄŸlamak iÃ§in tasarlanmÄ±ÅŸtÄ±r. Bu kimlik bilgileri, **AWS Identity and Access Management (IAM)** kullanÄ±cÄ±larÄ± veya kimliÄŸi doÄŸrulanmÄ±ÅŸ kullanÄ±cÄ±lar (federasyon kullanÄ±cÄ±larÄ±) iÃ§in talep edilebilir.

STS'nin amacÄ± **kimlik taklidi iÃ§in kimlik bilgileri saÄŸlamak** olduÄŸundan, hizmet **ayrÄ±calÄ±klarÄ±n yÃ¼kseltilmesi ve kalÄ±cÄ±lÄ±ÄŸÄ±n saÄŸlanmasÄ±** iÃ§in son derece deÄŸerlidir, ancak Ã§ok geniÅŸ bir seÃ§enek yelpazesine sahip olmayabilir.

### Assume Role Taklidi

AWS STS tarafÄ±ndan saÄŸlanan [AssumeRole](https://docs.aws.amazon.com/STS/latest/APIReference/API\_AssumeRole.html) eylemi, bir prensipin baÅŸka bir prensip iÃ§in kimlik bilgileri edinmesine izin verdiÄŸi iÃ§in kritik Ã¶neme sahiptir, esasen onlarÄ± taklit eder. Ã‡aÄŸrÄ±ldÄ±ÄŸÄ±nda, belirtilen ARN'ye karÅŸÄ±lÄ±k gelen bir eriÅŸim anahtarÄ± kimliÄŸi, bir gizli anahtar ve bir oturum belirteci ile yanÄ±t verir.

Penetrasyon TestÃ§ileri veya Red Team Ã¼yeleri iÃ§in, bu teknik ayrÄ±calÄ±klarÄ±n yÃ¼kseltilmesi iÃ§in (daha fazla bilgi [**burada**](../aws-privilege-escalation/aws-sts-privesc.md#sts-assumerole)) Ã§ok Ã¶nemlidir. Ancak, bu tekniÄŸin oldukÃ§a belirgin olduÄŸunu ve bir saldÄ±rganÄ± ÅŸaÅŸÄ±rtmayabileceÄŸini belirtmek gerekir.

#### Assume Role MantÄ±ÄŸÄ±

**Rol ARN'sini Ã¶zel olarak izin veren bir rolÃ¼** aynÄ± hesapta Ã¼stlenmek iÃ§in:
```json
{
"Version": "2012-10-17",
"Statement": [
{
"Effect": "Allow",
"Principal": {
"AWS": "arn:aws:iam::<acc_id>:role/priv-role"
},
"Action": "sts:AssumeRole",
"Condition": {}
}
]
}
```
Rol **`priv-role`** bu durumda, **Ã¶zellikle izin verilmesine gerek yoktur** o rolÃ¼ Ã¼stlenmek iÃ§in (bu izin yeterlidir).

Ancak, bir rol bir hesabÄ±n onu Ã¼stlenmesine izin veriyorsa, ÅŸu ÅŸekilde:
```json
{
"Version": "2012-10-17",
"Statement": [
{
"Effect": "Allow",
"Principal": {
"AWS": "arn:aws:iam::<acc_id>:root"
},
"Action": "sts:AssumeRole",
"Condition": {}
}
]
}
```
RolÃ¼ Ã¼stlenmeye Ã§alÄ±ÅŸan rolÃ¼n, o rolÃ¼ **Ã¼stlenmek iÃ§in belirli bir `sts:AssumeRole` iznine** sahip olmasÄ± gerekecektir.

**FarklÄ± bir hesaptan** bir **rolÃ¼ Ã¼stlenmeye** Ã§alÄ±ÅŸÄ±rsanÄ±z, **Ã¼stlenilen rol bunu izin vermelidir** (rol **ARN**'ini veya **harici hesabÄ±** belirterek) ve diÄŸerini **Ã¼stlenmeye Ã§alÄ±ÅŸan rolÃ¼n** onu **Ã¼stlenmek iÃ§in izinlere sahip olmasÄ± GEREKÄ°R** (bu durumda, Ã¼stlenilen rol bir ARN belirtiyor olsa bile bu isteÄŸe baÄŸlÄ± deÄŸildir).

### Enumeration
```bash
# Get basic info of the creds
aws sts get-caller-identity
aws sts get-access-key-info --access-key-id <AccessKeyID>

# Get CLI a session token with current creds
## Using CLI creds
## You cannot get session creds using session creds
aws sts get-session-token
## MFA
aws sts get-session-token --serial-number <arn_device> --token-code <otp_code>
```
### Privesc

AÅŸaÄŸÄ±daki sayfada **STS izinlerini kÃ¶tÃ¼ye kullanarak ayrÄ±calÄ±klarÄ± nasÄ±l yÃ¼kseltebileceÄŸinizi** kontrol edebilirsiniz:

{% content-ref url="../aws-privilege-escalation/aws-sts-privesc.md" %}
[aws-sts-privesc.md](../aws-privilege-escalation/aws-sts-privesc.md)
{% endcontent-ref %}

### Post Exploitation

{% content-ref url="../aws-post-exploitation/aws-sts-post-exploitation.md" %}
[aws-sts-post-exploitation.md](../aws-post-exploitation/aws-sts-post-exploitation.md)
{% endcontent-ref %}

### Persistence

{% content-ref url="../aws-persistence/aws-sts-persistence.md" %}
[aws-sts-persistence.md](../aws-persistence/aws-sts-persistence.md)
{% endcontent-ref %}

## References

* [https://blog.christophetd.fr/retrieving-aws-security-credentials-from-the-aws-console/?utm\_source=pocket\_mylist](https://blog.christophetd.fr/retrieving-aws-security-credentials-from-the-aws-console/?utm\_source=pocket\_mylist)

{% hint style="success" %}
AWS Hacking Ã¶ÄŸrenin ve pratik yapÄ±n:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCP Hacking Ã¶ÄŸrenin ve pratik yapÄ±n: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**abonelik planlarÄ±nÄ±**](https://github.com/sponsors/carlospolop) kontrol edin!
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n ya da **Twitter'da** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live) bizi takip edin.
* **HackTricks** ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na PR gÃ¶ndererek hacking ipuÃ§larÄ±nÄ± paylaÅŸÄ±n.

</details>
{% endhint %}
