# AWS - Redshift Enum

{% hint style="success" %}
AWS Hacking Ã¶ÄŸrenin ve uygulayÄ±n:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks EÄŸitim AWS KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ± (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCP Hacking Ã¶ÄŸrenin ve uygulayÄ±n: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks EÄŸitim GCP KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ± (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**Abonelik planlarÄ±nÄ±**](https://github.com/sponsors/carlospolop) kontrol edin!
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) katÄ±lÄ±n veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n veya **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**'Ä± takip edin.**
* **Hacking pÃ¼f noktalarÄ±nÄ± paylaÅŸarak PR'ler gÃ¶ndererek** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na katkÄ±da bulunun.

</details>
{% endhint %}

## Amazon Redshift

Redshift, **bÃ¼yÃ¼k veri Ã§Ã¶zÃ¼mleri iÃ§in veri ambarÄ±** olarak kullanÄ±lan, **bir petabaytÄ±n Ã¼zerine Ã¶lÃ§eklenebilen tamamen yÃ¶netilen bir hizmettir**. Redshift kÃ¼meleme kullanarak, veri kÃ¼meleriniz Ã¼zerinde hÄ±zlÄ±, SQL tabanlÄ± sorgu araÃ§larÄ± ve iÅŸ zekasÄ± uygulamalarÄ± kullanarak analiz Ã§alÄ±ÅŸtÄ±rabilir ve iÅŸletmeniz iÃ§in daha iyi bir anlayÄ±ÅŸ elde edebilirsiniz.

**Redshift, dinlenme sÄ±rasÄ±nda ÅŸifreleme sunar ve Ã¼st dÃ¼zey anahtarlarÄ± yÃ¶netmek iÃ§in KMS veya CloudHSM kullanarak dÃ¶rt katmanlÄ± bir ÅŸifreleme anahtarlarÄ± hiyerarÅŸisi kullanÄ±r**. **KÃ¼meniz iÃ§in ÅŸifreleme etkinleÅŸtirildiÄŸinde devre dÄ±ÅŸÄ± bÄ±rakÄ±lamaz ve tam tersi de geÃ§erlidir**. ÅifrelenmemiÅŸ bir kÃ¼meniz olduÄŸunda ÅŸifrelenemez.

KÃ¼meniz iÃ§in ÅŸifreleme yalnÄ±zca oluÅŸturulurken gerÃ§ekleÅŸtirilebilir ve bir kez ÅŸifrelenirse, veriler, meta veriler ve herhangi bir anlÄ±k gÃ¶rÃ¼ntÃ¼ de ÅŸifrelenir. Åifreleme anahtarlarÄ±nÄ±n katman seviyesi ÅŸu ÅŸekildedir, **birinci katman anahtar, ikinci katman kÃ¼me ÅŸifreleme anahtarÄ± (CEK), Ã¼Ã§Ã¼ncÃ¼ katman veritabanÄ± ÅŸifreleme anahtarÄ± (DEK) ve son olarak dÃ¶rdÃ¼ncÃ¼ katman veri ÅŸifreleme anahtarlarÄ±dÄ±r**.

### KMS

KÃ¼menizin oluÅŸturulmasÄ± sÄ±rasÄ±nda, Redshift iÃ§in **varsayÄ±lan KMS anahtarÄ±nÄ±** seÃ§ebilir veya **kendi CMK'nÄ±zÄ±** seÃ§ebilirsiniz, bu da anahtarÄ± denetleme aÃ§Ä±sÄ±ndan daha fazla esneklik saÄŸlar.

Redshift iÃ§in varsayÄ±lan KMS anahtarÄ±, ilk kez seÃ§ildiÄŸinde ve kullanÄ±ldÄ±ÄŸÄ±nda Redshift tarafÄ±ndan otomatik olarak oluÅŸturulur ve AWS tarafÄ±ndan tamamen yÃ¶netilir.

Bu KMS anahtarÄ± daha sonra CMK anahtarÄ±nÄ±, yani birinci katmanÄ± ÅŸifreler. Bu ÅŸifrelenmiÅŸ KMS veri anahtarÄ± daha sonra kÃ¼me ÅŸifreleme anahtarÄ± (CEK), yani ikinci katman olarak kullanÄ±lÄ±r. Bu CEK daha sonra KMS tarafÄ±ndan Redshift'e gÃ¶nderilir ve kÃ¼meden ayrÄ± bir ÅŸekilde depolanÄ±r. Redshift daha sonra bu ÅŸifrelenmiÅŸ CEK'i gÃ¼venli bir kanal Ã¼zerinden kÃ¼melere gÃ¶nderir ve bellekte depolar.

Redshift daha sonra KMS'ten CEK'i, yani ikinci katmanÄ± ÅŸifrelemesini ister. Bu ÅŸifrelenmiÅŸ CEK daha sonra bellekte de depolanÄ±r. Redshift daha sonra rastgele bir veritabanÄ± ÅŸifreleme anahtarÄ± (DEK), yani Ã¼Ã§Ã¼ncÃ¼ katman oluÅŸturur ve bunu kÃ¼menin belleÄŸine yÃ¼kler. Bellekteki ÅŸifrelenmiÅŸ CEK, DEK'i ÅŸifreler ve bu da bellekte depolanÄ±r.

Bu ÅŸifrelenmiÅŸ DEK daha sonra gÃ¼venli bir kanal Ã¼zerinden gÃ¶nderilir ve kÃ¼meden ayrÄ± bir ÅŸekilde Redshift'te depolanÄ±r. Hem CEK hem de DEK artÄ±k kÃ¼menin belleÄŸinde hem ÅŸifrelenmiÅŸ hem de ÅŸifresiz olarak depolanÄ±r. Åifresiz DEK, veritabanÄ±ndaki her veri bloÄŸu iÃ§in Redshift tarafÄ±ndan rastgele oluÅŸturulan veri anahtarlarÄ±nÄ± ÅŸifrelemek iÃ§in kullanÄ±lÄ±r.

Amazon S3 kovalarÄ±nÄ±zÄ±n yapÄ±landÄ±rmasÄ±nÄ± izlemek ve kovalarÄ±n gÃ¼nlÃ¼ÄŸÃ¼nÃ¼n etkinleÅŸtirilip etkinleÅŸtirilmediÄŸinden emin olmak iÃ§in AWS Trusted Advisor'Ä± kullanabilirsiniz, bu, gÃ¼venlik denetimleri gerÃ§ekleÅŸtirmek ve S3'te kullanÄ±m modellerini izlemek iÃ§in faydalÄ± olabilir.

### CloudHSM

<details>

<summary>CloudHSM ile Redshift KullanÄ±mÄ±</summary>

Åifrelemenizi gerÃ§ekleÅŸtirmek iÃ§in CloudHSM ile Ã§alÄ±ÅŸÄ±rken, Ã¶ncelikle HSM istemciniz ile Redshift arasÄ±nda gÃ¼venilir bir baÄŸlantÄ± kurmanÄ±z gerekmektedir ve istemci ve sunucu sertifikalarÄ±nÄ± kullanmanÄ±z gerekmektedir.

Bu baÄŸlantÄ±, ÅŸifreleme anahtarlarÄ±nÄ±n HSM istemciniz ile Redshift kÃ¼meniz arasÄ±nda gÃ¶nderilmesine izin veren gÃ¼venli iletiÅŸimi saÄŸlamak iÃ§in gereklidir. Rastgele oluÅŸturulan Ã¶zel ve genel anahtar Ã§ifti kullanarak, Redshift, ÅŸifrelenmiÅŸ ve depolanan bir genel istemci sertifikasÄ± oluÅŸturur. Bu indirilip HSM istemcinize kaydedilmeli ve doÄŸru HSM bÃ¶lÃ¼mÃ¼ne atanmalÄ±dÄ±r.

Daha sonra Redshift'i HSM istemcinizin aÅŸaÄŸÄ±daki detaylarla yapÄ±landÄ±rmanÄ±z gerekmektedir: HSM IP adresi, HSM bÃ¶lÃ¼m adÄ±, HSM bÃ¶lÃ¼m ÅŸifresi ve CloudHSM tarafÄ±ndan iÃ§sel bir anahtar kullanÄ±larak ÅŸifrelenen genel HSM sunucu sertifikasÄ±. Bu bilgiler saÄŸlandÄ±ktan sonra, Redshift baÄŸlantÄ±yÄ± doÄŸrular ve geliÅŸtirme bÃ¶lÃ¼mÃ¼ne eriÅŸebileceÄŸini onaylar.

Dahili gÃ¼venlik politikalarÄ±nÄ±z veya yÃ¶netiÅŸim kontrolleriniz, ÅŸifreleme anahtarlarÄ±nÄ± dÃ¶ndÃ¼rmeniz gerektiÄŸini belirtiyorsa, bu, ÅŸifrelenmiÅŸ kÃ¼meler iÃ§in ÅŸifreleme anahtarlarÄ±nÄ± dÃ¶ndÃ¼rmenizi saÄŸlar, ancak dikkat etmeniz gereken bir nokta, anahtar dÃ¶ndÃ¼rme sÃ¼reci sÄ±rasÄ±nda kÃ¼menin Ã§ok kÄ±sa bir sÃ¼re iÃ§in kullanÄ±lamaz hale gelmesidir, bu nedenle anahtarlarÄ± sadece ihtiyaÃ§ duyduÄŸunuzda veya bunlarÄ±n tehlikeye girdiÄŸini dÃ¼ÅŸÃ¼ndÃ¼ÄŸÃ¼nÃ¼zde dÃ¶ndÃ¼rmek en iyisidir.

DÃ¶ndÃ¼rme sÄ±rasÄ±nda, Redshift kÃ¼meniz iÃ§in CEK'i ve o kÃ¼menin yedeklerini dÃ¶ndÃ¼recektir. KÃ¼me iÃ§in bir DEK dÃ¶ndÃ¼recektir ancak DEK kullanÄ±larak ÅŸifrelenmiÅŸ S3'de depolanan anlÄ±k gÃ¶rÃ¼ntÃ¼ler iÃ§in bir DEK dÃ¶ndÃ¼rmek mÃ¼mkÃ¼n deÄŸildir. Ä°ÅŸlem tamamlandÄ±ÄŸÄ±nda durum 'kullanÄ±labilir' olarak geri dÃ¶necektir.

</details>

### NumaralandÄ±rma
```bash
# Get clusters
aws redshift describe-clusters
## Get if publicly accessible
aws redshift describe-clusters | jq -r ".Clusters[].PubliclyAccessible"
## Get DB username to login
aws redshift describe-clusters | jq -r ".Clusters[].MasterUsername"
## Get endpoint
aws redshift describe-clusters | jq -r ".Clusters[].Endpoint"
## Public addresses of the nodes
aws redshift describe-clusters | jq -r ".Clusters[].ClusterNodes[].PublicIPAddress"
## Get IAM roles of the clusters
aws redshift describe-clusters | jq -r ".Clusters[].IamRoles"

# Endpoint access & authorization
aws redshift describe-endpoint-access
aws redshift describe-endpoint-authorization

# Get credentials
aws redshift get-cluster-credentials --db-user <username> --cluster-identifier <cluster-id>
## By default, the temporary credentials expire in 900 seconds. You can optionally specify a duration between 900 seconds (15 minutes) and 3600 seconds (60 minutes).
aws redshift get-cluster-credentials-with-iam --cluster-identifier <cluster-id>
## Gives creds to access redshift with the IAM redshift permissions given to the current AWS account
## More in https://docs.aws.amazon.com/redshift/latest/mgmt/redshift-iam-access-control-identity-based.html

# Authentication profiles
aws redshift describe-authentication-profiles

# Snapshots
aws redshift describe-cluster-snapshots

# Scheduled actions
aws redshift describe-scheduled-actions

# Connect
# The redshift instance must be publicly available (not by default), the sg need to allow inbounds connections to the port and you need creds
psql -h redshift-cluster-1.sdflju3jdfkfg.us-east-1.redshift.amazonaws.com -U admin -d dev -p 5439
```
## Ä°st Privileges

{% content-ref url="../../aws-privilege-escalation/aws-redshift-privesc.md" %}
[aws-redshift-privesc.md](../../aws-privilege-escalation/aws-redshift-privesc.md)
{% endcontent-ref %}

## KalÄ±cÄ±lÄ±k

AÅŸaÄŸÄ±daki eylemler kÃ¼melere diÄŸer AWS hesaplarÄ±na eriÅŸim izni vermek iÃ§in kullanÄ±labilir:

* [authorize-endpoint-access](https://docs.aws.amazon.com/cli/latest/reference/redshift/authorize-endpoint-access.html)
* [authorize-snapshot-access](https://docs.aws.amazon.com/cli/latest/reference/redshift/authorize-snapshot-access.html)

{% hint style="success" %}
AWS Hacking'i Ã¶ÄŸrenin ve uygulayÄ±n:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks EÄŸitim AWS KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ± (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCP Hacking'i Ã¶ÄŸrenin ve uygulayÄ±n: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks EÄŸitim GCP KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ± (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**Abonelik planlarÄ±nÄ±**](https://github.com/sponsors/carlospolop) kontrol edin!
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) katÄ±lÄ±n veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n veya bizi **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** takip edin.**
* Hacking pÃ¼f noktalarÄ±nÄ± paylaÅŸarak PR'ler gÃ¶ndererek [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na katkÄ±da bulunun.

</details>
{% endhint %}
