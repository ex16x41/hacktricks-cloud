# AWS - Baza danych relacyjnych (RDS) Enum

{% hint style="success" %}
Dowiedz si i wicz Hacking AWS:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Dowiedz si i wicz Hacking GCP: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Wesprzyj HackTricks</summary>

* Sprawd藕 [**plany subskrypcyjne**](https://github.com/sponsors/carlospolop)!
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **led藕** nas na **Twitterze**  [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podziel si trikami hakerskimi, przesyajc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repozytori贸w na githubie.

</details>
{% endhint %}

## Podstawowe informacje

**Relational Database Service (RDS)** oferowany przez AWS zosta zaprojektowany w celu usprawnienia wdra偶ania, dziaania i skalowania **bazy danych relacyjnej w chmurze**. Usuga ta oferuje korzyci zwizane z efektywnoci koszt贸w i skalowalnoci, automatyzujc pracochonne zadania takie jak dostarczanie sprztu, konfiguracj bazy danych, atanie i tworzenie kopii zapasowych.

AWS RDS obsuguje r贸偶ne powszechnie u偶ywane silniki baz danych relacyjnych, w tym MySQL, PostgreSQL, MariaDB, Oracle Database, Microsoft SQL Server i Amazon Aurora, z kompatybilnoci zar贸wno z MySQL, jak i PostgreSQL.

G贸wne funkcje RDS obejmuj:

- **Uproszczenie zarzdzania instancjami bazy danych**.
- Tworzenie **replik odczytu** w celu zwikszenia wydajnoci odczytu.
- Konfiguracj **wielostrefowych wdro偶e (AZ)** w celu zapewnienia wysokiej dostpnoci i mechanizm贸w awaryjnych.
- **Integracj** z innymi usugami AWS, takimi jak:
- AWS Identity and Access Management (**IAM**) dla solidnej kontroli dostpu.
- AWS **CloudWatch** dla kompleksowego monitorowania i metryk.
- AWS Key Management Service (**KMS**) w celu zapewnienia szyfrowania w spoczynku.


## Dane uwierzytelniajce

Podczas tworzenia klastra bazy danych g贸wny **nazwa u偶ytkownika** mo偶e by skonfigurowana (domylnie **`admin`**). Aby wygenerowa haso tego u偶ytkownika, mo偶na:

* **Wskaza** haso **samodzielnie**
* Powiedz RDS, aby je **automatycznie wygenerowa**
* Powiedz RDS, aby zarzdza nim w **AWS Secret Manager** zaszyfrowanym kluczem KMS

<figure><img src="../../../../.gitbook/assets/image (18) (1).png" alt=""><figcaption></figcaption></figure>

### Uwierzytelnianie

Istniej 3 rodzaje opcji uwierzytelniania, ale zawsze jest dozwolone korzystanie z **hasa g贸wnego**:

<figure><img src="../../../../.gitbook/assets/image (19) (2).png" alt=""><figcaption></figcaption></figure>

### Dostp publiczny i VPC

Domylnie **nie udzielany jest dostp publiczny** do baz danych, jednak **mo偶e by udzielony**. Dlatego domylnie tylko maszyny z tego samego VPC bd miay do niej dostp, jeli wybrana **grupa zabezpiecze** (przechowywane s w EC2 SG) na to pozwala.

Zamiast wystawiania instancji bazy danych, mo偶na utworzy **RDS Proxy**, kt贸ry **poprawia** **skalowalno** i **dostpno** klastra bazy danych.

Co wicej, **port bazy danych mo偶na r贸wnie偶 zmodyfikowa**.

### Szyfrowanie

**Szyfrowanie jest domylnie wczone** za pomoc zarzdzanego klucza AWS (zamiast tego mo偶na wybra CMK).

Wczajc swoje szyfrowanie, wczasz **szyfrowanie w spoczynku dla swojego magazynu, migawek, replik odczytu i kopii zapasowych**. Klucze do zarzdzania tym szyfrowaniem mo偶na wyda, korzystajc z **KMS**.\
Nie mo偶na doda tego poziomu szyfrowania po utworzeniu bazy danych. **Musisz to zrobi podczas jej tworzenia**.

Jednak istnieje **spos贸b obejcia, kt贸ry pozwala na zaszyfrowanie niezaszyfrowanej bazy danych w nastpujcy spos贸b**. Mo偶esz utworzy migawk swojej niezaszyfrowanej bazy danych, utworzy zaszyfrowan kopi tej migawki, u偶y tej zaszyfrowanej migawki do utworzenia nowej bazy danych, a nastpnie, w kocu, twoja baza danych bdzie zaszyfrowana.

#### Szyfrowanie danych transparentnych (TDE)

Opr贸cz mo偶liwoci szyfrowania inherentnych dla RDS na poziomie aplikacji, RDS obsuguje r贸wnie偶 **dodatkowe mechanizmy szyfrowania na poziomie platformy** w celu zabezpieczenia danych w spoczynku. Obejmuje to **Transparentne Szyfrowanie Danych (TDE)** dla Oracle i SQL Server. Jednak wa偶ne jest zauwa偶enie, 偶e podczas gdy TDE zwiksza bezpieczestwo poprzez szyfrowanie danych w spoczynku, mo偶e to r贸wnie偶 **wpyn na wydajno bazy danych**. Ten wpyw na wydajno jest szczeg贸lnie zauwa偶alny przy u偶yciu funkcji kryptograficznych MySQL lub funkcji kryptograficznych Microsoft Transact-SQL.

Aby skorzysta z TDE, konieczne s pewne kroki wstpne:

1. **Powizanie grupy opcji**:
- Baza danych musi by powizana z grup opcji. Grupy opcji su偶 jako kontenery dla ustawie i funkcji, uatwiajc zarzdzanie baz danych, w tym ulepszenia zwizane z bezpieczestwem.
- Jednak wa偶ne jest zauwa偶enie, 偶e grupy opcji s dostpne tylko dla okrelonych silnik贸w baz danych i wersji.

2. **Wczenie TDE w grupie opcji**:
- Po powizaniu z grup opcji, opcja Oracle Transparent Data Encryption musi zosta uwzgldniona w tej grupie.
- Istotne jest zrozumienie, 偶e po dodaniu opcji TDE do grupy opcji staje si ona staym elementem i nie mo偶na jej usun.

3. **Tryby szyfrowania TDE**:
- TDE oferuje dwa r贸偶ne tryby szyfrowania:
- **Szyfrowanie przestrzeni tabel TDE**: Ten tryb szyfruje cae tabele, zapewniajc szerszy zakres ochrony danych.
- **Szyfrowanie kolumn TDE**: Ten tryb koncentruje si na szyfrowaniu konkretnych, indywidualnych element贸w w bazie danych, umo偶liwiajc bardziej szczeg贸ow kontrol nad tym, kt贸re dane s szyfrowane.

Zrozumienie tych wymaga wstpnych i operacyjnych zo偶onoci TDE jest kluczowe dla skutecznego wdra偶ania i zarzdzania szyfrowaniem w RDS, zapewniajc zar贸wno bezpieczestwo danych, jak i zgodno z niezbdnymi standardami.

### Wyliczanie

{% code overflow="wrap" %}
```bash
# Clusters info
## Get Endpoints, username, port, iam auth enabled, attached roles, SG
aws rds describe-db-clusters
aws rds describe-db-cluster-endpoints #Cluster URLs
aws rds describe-db-cluster-backtracks --db-cluster-identifier <cluster-name>

## Cluster snapshots
aws rds describe-db-cluster-snapshots

# Get DB instances info
aws rds describe-db-instances #username, url, port, vpc, SG, is public?
aws rds describe-db-security-groups

## Find automated backups
aws rds describe-db-instance-automated-backups

## Find snapshots
aws rds describe-db-snapshots
aws rds describe-db-snapshots --include-public --snapshot-type public
## Restore snapshot as new instance
aws rds restore-db-instance-from-db-snapshot --db-instance-identifier <ID> --db-snapshot-identifier <ID> --availability-zone us-west-2a

# Any public snapshot in the account
aws rds describe-db-snapshots --snapshot-type public

# Proxies
aws rds describe-db-proxy-endpoints
aws rds describe-db-proxy-target-groups
aws rds describe-db-proxy-targets

## reset credentials of MasterUsername
aws rds modify-db-instance --db-instance-identifier <ID> --master-user-password <NewPassword> --apply-immediately
```
{% endcode %}

### Nieuwierzytelniony dostp

{% content-ref url="../../aws-unauthenticated-enum-access/aws-rds-unauthenticated-enum.md" %}
[aws-rds-unauthenticated-enum.md](../../aws-unauthenticated-enum-access/aws-rds-unauthenticated-enum.md)
{% endcontent-ref %}

### Przywaszczenie uprawnie

{% content-ref url="../../aws-privilege-escalation/aws-rds-privesc.md" %}
[aws-rds-privesc.md](../../aws-privilege-escalation/aws-rds-privesc.md)
{% endcontent-ref %}

### Po eksploatacji

{% content-ref url="../../aws-post-exploitation/aws-rds-post-exploitation.md" %}
[aws-rds-post-exploitation.md](../../aws-post-exploitation/aws-rds-post-exploitation.md)
{% endcontent-ref %}

### Trwao

{% content-ref url="../../aws-persistence/aws-rds-persistence.md" %}
[aws-rds-persistence.md](../../aws-persistence/aws-rds-persistence.md)
{% endcontent-ref %}

### Wstrzykiwanie SQL

Istniej sposoby na dostp do danych DynamoDB za pomoc **skadni SQL**, dlatego te偶 typowe **wstrzykiwania SQL s r贸wnie偶 mo偶liwe**.

{% embed url="https://book.hacktricks.xyz/pentesting-web/sql-injection" %}

{% hint style="success" %}
Dowiedz si i wicz Hacking AWS:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Dowiedz si i wicz Hacking GCP: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Wesprzyj HackTricks</summary>

* Sprawd藕 [**plany subskrypcyjne**](https://github.com/sponsors/carlospolop)!
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **led藕** nas na **Twitterze**  [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podziel si trikami hakerskimi, przesyajc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
