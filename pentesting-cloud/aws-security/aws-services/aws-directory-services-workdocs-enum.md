# AWS - ç›®å½•æœåŠ¡ / WorkDocs æšä¸¾

{% hint style="success" %}
å­¦ä¹ å¹¶ç»ƒä¹  AWS é»‘å®¢æŠ€æœ¯ï¼š<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks åŸ¹è®­ AWS çº¢é˜Ÿä¸“å®¶ (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
å­¦ä¹ å¹¶ç»ƒä¹  GCP é»‘å®¢æŠ€æœ¯ï¼š<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks åŸ¹è®­ GCP çº¢é˜Ÿä¸“å®¶ (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>æ”¯æŒ HackTricks</summary>

* æ£€æŸ¥ [**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**ç”µæŠ¥ç¾¤ç»„**](https://t.me/peass) æˆ– **å…³æ³¨** æˆ‘ä»¬çš„ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* é€šè¿‡å‘ [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ä»“åº“æäº¤ PR æ¥åˆ†äº«é»‘å®¢æŠ€å·§ã€‚

</details>
{% endhint %}

## ç›®å½•æœåŠ¡

AWS Directory Service for Microsoft Active Directory æ˜¯ä¸€é¡¹æ‰˜ç®¡æœåŠ¡ï¼Œå¯å¸®åŠ©æ‚¨åœ¨ AWS äº‘ä¸­è½»æ¾**è®¾ç½®ã€è¿è¡Œå’Œæ‰©å±•ç›®å½•**ã€‚å®ƒæ„å»ºåœ¨å®é™…çš„ **Microsoft Active Directory** ä¸Šï¼Œå¹¶ä¸å…¶ä»– AWS æœåŠ¡ç´§å¯†é›†æˆï¼Œä½¿å¾—ç®¡ç†ç›®å½•æ„ŸçŸ¥çš„å·¥ä½œè´Ÿè½½å’Œ AWS èµ„æºå˜å¾—ç®€å•ã€‚é€šè¿‡ AWS æ‰˜ç®¡çš„ Microsoft ADï¼Œæ‚¨å¯ä»¥**ä½¿ç”¨ç°æœ‰çš„** Active Directory ç”¨æˆ·ã€ç»„å’Œç­–ç•¥æ¥ç®¡ç†å¯¹ AWS èµ„æºçš„è®¿é—®ã€‚è¿™æœ‰åŠ©äºç®€åŒ–èº«ä»½ç®¡ç†ï¼Œå¹¶å‡å°‘å¯¹é¢å¤–èº«ä»½è§£å†³æ–¹æ¡ˆçš„éœ€æ±‚ã€‚AWS æ‰˜ç®¡çš„ Microsoft AD è¿˜æä¾›è‡ªåŠ¨å¤‡ä»½å’Œç¾éš¾æ¢å¤åŠŸèƒ½ï¼Œæœ‰åŠ©äºç¡®ä¿ç›®å½•çš„å¯ç”¨æ€§å’Œè€ä¹…æ€§ã€‚æ€»ä½“è€Œè¨€ï¼ŒAWS Directory Service for Microsoft Active Directory å¯ä»¥é€šè¿‡åœ¨ AWS äº‘ä¸­æä¾›æ‰˜ç®¡ã€é«˜å¯ç”¨æ€§å’Œå¯æ‰©å±•çš„ Active Directory æœåŠ¡æ¥å¸®åŠ©æ‚¨èŠ‚çœæ—¶é—´å’Œèµ„æºã€‚

### é€‰é¡¹

ç›®å½•æœåŠ¡å…è®¸åˆ›å»º 5 ç§ç±»å‹çš„ç›®å½•ï¼š

* **AWS æ‰˜ç®¡çš„ Microsoft AD**ï¼šå°†åœ¨ AWS ä¸­è¿è¡Œä¸€ä¸ªæ–°çš„ **Microsoft AD**ã€‚æ‚¨å°†èƒ½å¤Ÿè®¾ç½®ç®¡ç†å‘˜å¯†ç å¹¶è®¿é—® VPC ä¸­çš„ DCã€‚
* **Simple AD**ï¼šå°†æ˜¯ä¸€ä¸ª **Linux-Samba** Active Directory å…¼å®¹æœåŠ¡å™¨ã€‚æ‚¨å°†èƒ½å¤Ÿè®¾ç½®ç®¡ç†å‘˜å¯†ç å¹¶è®¿é—® VPC ä¸­çš„ DCã€‚
* **AD è¿æ¥å™¨**ï¼šç”¨äº**å°†ç›®å½•è¯·æ±‚é‡å®šå‘åˆ°ç°æœ‰çš„ Microsoft Active Directory**ï¼Œè€Œä¸åœ¨äº‘ä¸­ç¼“å­˜ä»»ä½•ä¿¡æ¯ã€‚å®ƒå°†åœ¨ä¸€ä¸ª **VPC** ä¸­ç›‘å¬ï¼Œå¹¶ä¸”æ‚¨éœ€è¦æä¾›**è®¿é—®ç°æœ‰ AD çš„å‡­æ®**ã€‚
* **Amazon Cognito ç”¨æˆ·æ± **ï¼šä¸ Cognito ç”¨æˆ·æ± ç›¸åŒã€‚
* **Cloud Directory**ï¼šè¿™æ˜¯**æœ€ç®€å•**çš„ä¸€ä¸ªã€‚ä¸€ä¸ª**æ— æœåŠ¡å™¨**ç›®å½•ï¼Œæ‚¨æŒ‡å®šè¦ä½¿ç”¨çš„**æ¨¡å¼**ï¼Œå¹¶æ ¹æ®ä½¿ç”¨é‡**è®¡è´¹**ã€‚

AWS ç›®å½•æœåŠ¡å…è®¸ä¸æ‚¨ç°æœ‰çš„**æœ¬åœ°** Microsoft AD åŒæ­¥ï¼Œ**åœ¨ AWS ä¸­è¿è¡Œæ‚¨è‡ªå·±çš„** AD æˆ–ä¸**å…¶ä»–ç›®å½•ç±»å‹**åŒæ­¥ã€‚

### å®éªŒå®¤

åœ¨è¿™é‡Œï¼Œæ‚¨å¯ä»¥æ‰¾åˆ°ä¸€ä¸ªåˆ›å»ºæ‚¨è‡ªå·±çš„ Microsoft AD åœ¨ AWS ä¸­çš„è¯¦ç»†æ•™ç¨‹ï¼š[https://docs.aws.amazon.com/directoryservice/latest/admin-guide/ms\_ad\_tutorial\_test\_lab\_base.html](https://docs.aws.amazon.com/directoryservice/latest/admin-guide/ms\_ad\_tutorial\_test\_lab\_base.html)

### æšä¸¾
```bash
# Get directories and DCs
aws ds describe-directories
aws ds describe-domain-controllers --directory-id <id>
# Get directory settings
aws ds describe-trusts
aws ds describe-ldaps-settings --directory-id <id>
aws ds describe-shared-directories --owner-directory-id <id>
aws ds get-directory-limits
aws ds list-certificates --directory-id <id>
aws ds describe-certificate --directory-id <id> --certificate-id <id>
```
### ç™»å½•

è¯·æ³¨æ„ï¼Œå¦‚æœç›®å½•çš„**æè¿°**å­—æ®µä¸­åŒ…å«**`AccessUrl`**ä¸­çš„**åŸŸ**ï¼Œé‚£æ˜¯å› ä¸º**ç”¨æˆ·**å¯èƒ½å¯ä»¥ä½¿ç”¨å…¶**ADå‡­æ®**ç™»å½•åˆ°ä¸€äº›**AWSæœåŠ¡**ä¸­ï¼š

- `<name>.awsapps.com/connect`ï¼ˆAmazon Connectï¼‰
- `<name>.awsapps.com/workdocs`ï¼ˆAmazon WorkDocsï¼‰
- `<name>.awsapps.com/workmail`ï¼ˆAmazon WorkMailï¼‰
- `<name>.awsapps.com/console`ï¼ˆAmazonç®¡ç†æ§åˆ¶å°ï¼‰
- `<name>.awsapps.com/start`ï¼ˆIAMèº«ä»½ä¸­å¿ƒï¼‰

### ç‰¹æƒå‡çº§

{% content-ref url="../../aws-security/aws-privilege-escalation/aws-directory-services-privesc.md" %}
[aws-directory-services-privesc.md](../../aws-security/aws-privilege-escalation/aws-directory-services-privesc.md)
{% endcontent-ref %}

## æŒä¹…æ€§

### ä½¿ç”¨ADç”¨æˆ·

**ADç”¨æˆ·**å¯ä»¥é€šè¿‡æ‰®æ¼”è§’è‰²è·å¾—å¯¹AWSç®¡ç†æ§åˆ¶å°çš„è®¿é—®æƒé™ã€‚**é»˜è®¤ç”¨æˆ·åä¸ºAdmin**ï¼Œå¯ä»¥ä»AWSæ§åˆ¶å°**æ›´æ”¹å…¶å¯†ç **ã€‚

å› æ­¤ï¼Œå¯ä»¥**æ›´æ”¹Adminçš„å¯†ç **ï¼Œ**åˆ›å»ºæ–°ç”¨æˆ·**æˆ–**æ›´æ”¹ç”¨æˆ·çš„å¯†ç **å¹¶æˆäºˆè¯¥ç”¨æˆ·ä¸€ä¸ªè§’è‰²ä»¥ä¿æŒè®¿é—®æƒé™ã€‚\
è¿˜å¯ä»¥**å°†ç”¨æˆ·æ·»åŠ åˆ°ADå†…çš„ç»„ä¸­**ï¼Œå¹¶**æˆäºˆè¯¥ADç»„è®¿é—®æƒé™**ï¼ˆä»¥ä½¿æ­¤æŒä¹…æ€§æ›´åŠ éšè”½ï¼‰ã€‚

### å…±äº«ADï¼ˆä»å—å®³è€…åˆ°æ”»å‡»è€…ï¼‰

å¯ä»¥å°†ADç¯å¢ƒä»å—å®³è€…å…±äº«ç»™æ”»å‡»è€…ã€‚è¿™æ ·ï¼Œæ”»å‡»è€…å°†èƒ½å¤Ÿç»§ç»­è®¿é—®ADç¯å¢ƒã€‚\
ä½†æ˜¯ï¼Œè¿™æ„å‘³ç€å…±äº«æ‰˜ç®¡çš„ADå¹¶åˆ›å»ºVPCå¯¹ç­‰è¿æ¥ã€‚

æ‚¨å¯ä»¥åœ¨è¿™é‡Œæ‰¾åˆ°æŒ‡å—ï¼š[https://docs.aws.amazon.com/directoryservice/latest/admin-guide/step1\_setup\_networking.html](https://docs.aws.amazon.com/directoryservice/latest/admin-guide/step1\_setup\_networking.html)

### ~~å…±äº«ADï¼ˆä»æ”»å‡»è€…åˆ°å—å®³è€…ï¼‰~~

çœ‹èµ·æ¥ä¸å¯èƒ½å°†AWSè®¿é—®æƒé™æˆäºˆæ¥è‡ªä¸åŒADç¯å¢ƒçš„ç”¨æˆ·ä»¥è®¿é—®ä¸€ä¸ªAWSè´¦æˆ·ã€‚

## WorkDocs

Amazon Web Servicesï¼ˆAWSï¼‰WorkDocsæ˜¯ä¸€ç§åŸºäºäº‘çš„**æ–‡ä»¶å­˜å‚¨å’Œå…±äº«æœåŠ¡**ã€‚å®ƒæ˜¯AWSäº‘è®¡ç®—æœåŠ¡å¥—ä»¶çš„ä¸€éƒ¨åˆ†ï¼Œæ—¨åœ¨ä¸ºç»„ç»‡æä¾›å®‰å…¨å¯æ‰©å±•çš„è§£å†³æ–¹æ¡ˆï¼Œç”¨äºå­˜å‚¨ã€å…±äº«å’Œåä½œæ–‡ä»¶å’Œæ–‡æ¡£ã€‚

AWS WorkDocsä¸ºç”¨æˆ·æä¾›äº†ä¸€ä¸ªåŸºäºWebçš„ç•Œé¢ï¼Œç”¨äºä¸Šä¼ ã€è®¿é—®å’Œç®¡ç†å…¶æ–‡ä»¶å’Œæ–‡æ¡£ã€‚å®ƒè¿˜æä¾›ç‰ˆæœ¬æ§åˆ¶ã€å®æ—¶åä½œä»¥åŠä¸å…¶ä»–AWSæœåŠ¡å’Œç¬¬ä¸‰æ–¹å·¥å…·çš„é›†æˆç­‰åŠŸèƒ½ã€‚

### æšä¸¾

{% code overflow="wrap" %}
```bash
# Get AD users (Admin not included)
aws workdocs describe-users --organization-id <directory-id>
# Get AD groups (containing "a")
aws workdocs describe-groups --organization-id d-9067a0285c --search-query a

# Create user (created inside the AD)
aws workdocs create-user --username testingasd --given-name testingasd --surname testingasd --password <password> --email-address name@directory.domain --organization-id <directory-id>

# Get what each user has created
aws workdocs describe-activities --user-id "S-1-5-21-377..."

# Get what was created in the directory
aws workdocs describe-activities --organization-id <directory-id>

# Get folder content
aws workdocs describe-folder-contents --folder-id <fold-id>

# Get file (a url to access with the content will be retreived)
aws workdocs get-document --document-id <doc-id>

# Get resource permissions if any
aws workdocs describe-resource-permissions --resource-id <value>

# Add permission so anyway can see the file
aws workdocs add-resource-permissions --resource-id <id> --principals Id=anonymous,Type=ANONYMOUS,Role=VIEWER
## This will give an id, the file will be acesible in: https://<name>.awsapps.com/workdocs/index.html#/share/document/<id>
```
{% endcode %}

### ææƒ

{% content-ref url="../../aws-security/aws-privilege-escalation/aws-workdocs-privesc.md" %}
[aws-workdocs-privesc.md](../../aws-security/aws-privilege-escalation/aws-workdocs-privesc.md)
{% endcontent-ref %}

{% hint style="success" %}
å­¦ä¹ å¹¶ç»ƒä¹ AWSé»‘å®¢æŠ€æœ¯ï¼š<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricksåŸ¹è®­AWSçº¢é˜Ÿä¸“å®¶ï¼ˆARTEï¼‰**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
å­¦ä¹ å¹¶ç»ƒä¹ GCPé»‘å®¢æŠ€æœ¯ï¼š<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricksåŸ¹è®­GCPçº¢é˜Ÿä¸“å®¶ï¼ˆGRTEï¼‰**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>æ”¯æŒHackTricks</summary>

* æ£€æŸ¥[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**ç”µæŠ¥ç¾¤ç»„**](https://t.me/peass) æˆ– **å…³æ³¨**æˆ‘ä»¬çš„**Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* é€šè¿‡å‘[**HackTricks**](https://github.com/carlospolop/hacktricks)å’Œ[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) githubä»“åº“æäº¤PRæ¥åˆ†äº«é»‘å®¢æŠ€å·§ã€‚

</details>
{% endhint %}
