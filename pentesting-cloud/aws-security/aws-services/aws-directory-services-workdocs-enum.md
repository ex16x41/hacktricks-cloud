# AWS - Dizin Hizmetleri / WorkDocs Enum

{% hint style="success" %}
AWS Hacking'Ä± Ã¶ÄŸrenin ve uygulayÄ±n:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks EÄŸitim AWS KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ± (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCP Hacking'ini Ã¶ÄŸrenin ve uygulayÄ±n: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks EÄŸitim GCP KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ± (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**Abonelik planlarÄ±nÄ±**](https://github.com/sponsors/carlospolop) kontrol edin!
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) katÄ±lÄ±n veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n veya bizi **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** takip edin.**
* **Hacking pÃ¼f noktalarÄ±nÄ± paylaÅŸarak PR'ler gÃ¶ndererek** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na katkÄ±da bulunun.

</details>
{% endhint %}

## Dizin Hizmetleri

AWS Directory Service for Microsoft Active Directory, AWS Cloud'da bir dizini **kurmayÄ±, iÅŸletmeyi ve Ã¶lÃ§eklendirmeyi** kolaylaÅŸtÄ±ran yÃ¶netilen bir hizmettir. GerÃ§ek **Microsoft Active Directory** Ã¼zerine inÅŸa edilmiÅŸ olup diÄŸer AWS hizmetleriyle sÄ±kÄ± entegrasyon saÄŸlar, bu da dizin tabanlÄ± iÅŸ yÃ¼klerinizi ve AWS kaynaklarÄ±nÄ± yÃ¶netmeyi kolaylaÅŸtÄ±rÄ±r. AWS YÃ¶netilen Microsoft AD ile **mevcut** Active Directory kullanÄ±cÄ±larÄ±, gruplarÄ± ve politikalarÄ±nÄ± AWS kaynaklarÄ±na eriÅŸimi yÃ¶netmek iÃ§in kullanabilirsiniz. Bu, kimlik yÃ¶netimini basitleÅŸtirmenize ve ek kimlik Ã§Ã¶zÃ¼mlerine duyulan ihtiyacÄ± azaltmanÄ±za yardÄ±mcÄ± olabilir. AWS YÃ¶netilen Microsoft AD ayrÄ±ca otomatik yedekleme ve felaket kurtarma yetenekleri saÄŸlayarak dizininizin kullanÄ±labilirliÄŸini ve dayanÄ±klÄ±lÄ±ÄŸÄ±nÄ± saÄŸlamaya yardÄ±mcÄ± olur. Genel olarak, AWS Directory Service for Microsoft Active Directory, AWS Cloud'da yÃ¶netilen, yÃ¼ksek kullanÄ±labilirlikli ve Ã¶lÃ§eklenebilir bir Active Directory hizmeti saÄŸlayarak zaman ve kaynak tasarrufu yapmanÄ±za yardÄ±mcÄ± olabilir.

### SeÃ§enekler

Dizin Hizmetleri, 5 tÃ¼r dizin oluÅŸturmanÄ±za izin verir:

* **AWS YÃ¶netilen Microsoft AD**: AWS'de yeni bir **Microsoft AD Ã§alÄ±ÅŸtÄ±racak**. YÃ¶netici ÅŸifresini belirleyebilecek ve bir VPC'deki DC'lere eriÅŸebileceksiniz.
* **Basit AD**: Bir **Linux-Samba** Active Directory uyumlu sunucu olacak. YÃ¶netici ÅŸifresini belirleyebilecek ve bir VPC'deki DC'lere eriÅŸebileceksiniz.
* **AD BaÄŸlayÄ±cÄ±**: Bulutta herhangi bir bilgiyi Ã¶nbelleÄŸe almadan **mevcut Microsoft Active Directory'e yÃ¶nlendirme dizin istekleri iÃ§in bir proxy**. Bir **VPC** iÃ§inde dinleyecek ve mevcut AD'ye eriÅŸim vermek iÃ§in **kimlik bilgilerini vermeniz gerekecek**.
* **Amazon Cognito KullanÄ±cÄ± HavuzlarÄ±**: Bu, Cognito KullanÄ±cÄ± HavuzlarÄ± ile aynÄ±dÄ±r.
* **Cloud Dizini**: Bu, **en basit** olanÄ±dÄ±r. KullanÄ±lacak **ÅŸemayÄ± belirttiÄŸiniz ve kullanÄ±ma gÃ¶re faturalandÄ±rÄ±ldÄ±ÄŸÄ±nÄ±z** bir **sunucusuz** dizin.

AWS Dizin hizmetleri, mevcut **yerindeki** Microsoft AD'nizle **senkronize etmenize**, AWS'de **kendi AD'nizi Ã§alÄ±ÅŸtÄ±rmanÄ±za** veya **diÄŸer dizin tÃ¼rleriyle senkronize etmenize** olanak tanÄ±r.

### Laboratuvar

AWS'de kendi Microsoft AD'nizi oluÅŸturmak iÃ§in gÃ¼zel bir Ã¶ÄŸreticiye buradan ulaÅŸabilirsiniz: [https://docs.aws.amazon.com/directoryservice/latest/admin-guide/ms\_ad\_tutorial\_test\_lab\_base.html](https://docs.aws.amazon.com/directoryservice/latest/admin-guide/ms\_ad\_tutorial\_test\_lab\_base.html)

### NumaralandÄ±rma
```bash
# Get directories and DCs
aws ds describe-directories
aws ds describe-domain-controllers --directory-id <id>
# Get directory settings
aws ds describe-trusts
aws ds describe-ldaps-settings --directory-id <id>
aws ds describe-shared-directories --owner-directory-id <id>
aws ds get-directory-limits
aws ds list-certificates --directory-id <id>
aws ds describe-certificate --directory-id <id> --certificate-id <id>
```
### GiriÅŸ

Dikkat edilmesi gereken bir nokta, **dizin**nin **`AccessUrl`** alanÄ±nda bir **alan** iÃ§eriyorsa, bir **kullanÄ±cÄ±nÄ±n** muhtemelen **AD kimlik bilgileriyle giriÅŸ yapabileceÄŸi bazÄ± **AWS hizmetleri**:

- `<name>.awsapps.com/connect` (Amazon Connect)
- `<name>.awsapps.com/workdocs` (Amazon WorkDocs)
- `<name>.awsapps.com/workmail` (Amazon WorkMail)
- `<name>.awsapps.com/console` (Amazon YÃ¶netim Konsolu)
- `<name>.awsapps.com/start` (IAM Kimlik Merkezi)

### Yetki YÃ¼kseltme

{% content-ref url="../../aws-security/aws-privilege-escalation/aws-directory-services-privesc.md" %}
[aws-directory-services-privesc.md](../../aws-security/aws-privilege-escalation/aws-directory-services-privesc.md)
{% endcontent-ref %}

## KalÄ±cÄ±lÄ±k

### Bir AD kullanÄ±cÄ±sÄ± kullanarak

Bir **AD kullanÄ±cÄ±sÄ±na**, bir Rol aracÄ±lÄ±ÄŸÄ±yla **AWS yÃ¶netim konsoluna eriÅŸim verilebilir**. **VarsayÄ±lan kullanÄ±cÄ± adÄ± Admin'dir** ve AWS konsolundan **ÅŸifresi deÄŸiÅŸtirilebilir**.

Bu nedenle, **Admin'in ÅŸifresi deÄŸiÅŸtirilebilir**, **yeni bir kullanÄ±cÄ± oluÅŸturulabilir** veya bir kullanÄ±cÄ±nÄ±n ÅŸifresi deÄŸiÅŸtirilebilir ve bu kullanÄ±cÄ±ya eriÅŸimi sÃ¼rdÃ¼rmesi iÃ§in bir Rol verilebilir.\
AyrÄ±ca, bir kullanÄ±cÄ±yÄ± AD iÃ§inde bir gruba eklemek ve bu AD grubuna bir Rol eriÅŸimi vermek de mÃ¼mkÃ¼ndÃ¼r (bu kalÄ±cÄ±lÄ±ÄŸÄ± daha gizli hale getirmek iÃ§in).

### AD paylaÅŸÄ±mÄ± (kurbandan saldÄ±rgana)

Bir AD ortamÄ±nÄ± kurbandan saldÄ±rgana paylaÅŸmak mÃ¼mkÃ¼ndÃ¼r. Bu ÅŸekilde saldÄ±rgan, AD ortamÄ±na eriÅŸmeye devam edebilecektir.\
Ancak, bu yÃ¶ntem yÃ¶netilen AD'nin paylaÅŸÄ±lmasÄ±nÄ± ve ayrÄ±ca bir VPC eÅŸleme baÄŸlantÄ±sÄ± oluÅŸturulmasÄ±nÄ± gerektirir.

Bir kÄ±lavuz burada bulunabilir: [https://docs.aws.amazon.com/directoryservice/latest/admin-guide/step1\_setup\_networking.html](https://docs.aws.amazon.com/directoryservice/latest/admin-guide/step1\_setup\_networking.html)

### ~~AD paylaÅŸÄ±mÄ± (saldÄ±rgandan kurbandan)~~

FarklÄ± bir AD ortamÄ±ndan kullanÄ±cÄ±lara AWS eriÅŸimi vermek mÃ¼mkÃ¼n gÃ¶rÃ¼nmemektedir.

## WorkDocs

Amazon Web Services (AWS) WorkDocs, bulut tabanlÄ± bir **dosya depolama ve paylaÅŸma hizmetidir**. AWS bulut biliÅŸim hizmetleri paketinin bir parÃ§asÄ±dÄ±r ve organizasyonlarÄ±n dosya ve belgeleri depolamak, paylaÅŸmak ve iÅŸbirliÄŸi yapmak iÃ§in gÃ¼venli ve Ã¶lÃ§eklenebilir bir Ã§Ã¶zÃ¼m sunmak Ã¼zere tasarlanmÄ±ÅŸtÄ±r.

AWS WorkDocs, kullanÄ±cÄ±larÄ±n dosyalarÄ±nÄ± ve belgelerini yÃ¼klemelerine, eriÅŸmelerine ve yÃ¶netmelerine olanak tanÄ±yan web tabanlÄ± bir arayÃ¼z sunar. AyrÄ±ca sÃ¼rÃ¼m kontrolÃ¼, gerÃ§ek zamanlÄ± iÅŸbirliÄŸi ve diÄŸer AWS hizmetleri ile ve Ã¼Ã§Ã¼ncÃ¼ taraf araÃ§larla entegrasyon gibi Ã¶zellikler sunar.

### NumaralandÄ±rma

{% code overflow="wrap" %}
```bash
# Get AD users (Admin not included)
aws workdocs describe-users --organization-id <directory-id>
# Get AD groups (containing "a")
aws workdocs describe-groups --organization-id d-9067a0285c --search-query a

# Create user (created inside the AD)
aws workdocs create-user --username testingasd --given-name testingasd --surname testingasd --password <password> --email-address name@directory.domain --organization-id <directory-id>

# Get what each user has created
aws workdocs describe-activities --user-id "S-1-5-21-377..."

# Get what was created in the directory
aws workdocs describe-activities --organization-id <directory-id>

# Get folder content
aws workdocs describe-folder-contents --folder-id <fold-id>

# Get file (a url to access with the content will be retreived)
aws workdocs get-document --document-id <doc-id>

# Get resource permissions if any
aws workdocs describe-resource-permissions --resource-id <value>

# Add permission so anyway can see the file
aws workdocs add-resource-permissions --resource-id <id> --principals Id=anonymous,Type=ANONYMOUS,Role=VIEWER
## This will give an id, the file will be acesible in: https://<name>.awsapps.com/workdocs/index.html#/share/document/<id>
```
{% endcode %}

### Ä°st Privileges

{% content-ref url="../../aws-security/aws-privilege-escalation/aws-workdocs-privesc.md" %}
[aws-workdocs-privesc.md](../../aws-security/aws-privilege-escalation/aws-workdocs-privesc.md)
{% endcontent-ref %}

{% hint style="success" %}
AWS Hacking'i Ã¶ÄŸrenin ve uygulayÄ±n:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks EÄŸitim AWS KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ± (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCP Hacking'i Ã¶ÄŸrenin ve uygulayÄ±n: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks EÄŸitim GCP KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ± (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**Abonelik planlarÄ±nÄ±**](https://github.com/sponsors/carlospolop) kontrol edin!
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katÄ±lÄ±n** veya bizi **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**'da takip edin.**
* **Hacking pÃ¼f noktalarÄ±nÄ± paylaÅŸarak PR gÃ¶ndererek** [**HackTricks**](https://github.com/carlospolop/hacktricks) **ve** [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **github depolarÄ±na katkÄ±da bulunun.**

</details>
{% endhint %}
