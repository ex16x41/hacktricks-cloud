# AWS - Directory Services / WorkDocs Enum

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** 游눫 [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** 游냕 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Directory Services

AWS Directory Service for Microsoft Active Directory je upravljana usluga koja olak코ava **postavljanje, upravljanje i skaliranje direktorijuma** u AWS Cloud-u. Izgra캠ena je na stvarnom **Microsoft Active Directory** i 캜vrsto se integri코e s drugim AWS uslugama, olak코avaju캖i upravljanje va코im radnim optere캖enjima i AWS resursima koji su svesni direktorijuma. Sa AWS Managed Microsoft AD, mo쬰te **koristiti svoje postoje캖e** Active Directory korisnike, grupe i politike za upravljanje pristupom va코im AWS resursima. Ovo mo쬰 pomo캖i u pojednostavljivanju upravljanja identitetom i smanjenju potrebe za dodatnim re코enjima identiteta. AWS Managed Microsoft AD tako캠e pru쬬 automatske rezervne kopije i mogu캖nosti oporavka od katastrofa, poma쬿캖i da se osigura dostupnost i trajnost va코eg direktorijuma. Sve u svemu, AWS Directory Service for Microsoft Active Directory mo쬰 vam pomo캖i da u코tedite vreme i resurse pru쬬ju캖i upravljanu, visoko dostupnu i skalabilnu Active Directory uslugu u AWS Cloud-u.

### Options

Directory Services omogu캖ava kreiranje 5 tipova direktorijuma:

* **AWS Managed Microsoft AD**: Koji 캖e pokrenuti novi **Microsoft AD u AWS-u**. Mo캖i 캖ete da postavite administratorsku lozinku i pristupite DC-ima u VPC-u.
* **Simple AD**: Koji 캖e biti **Linux-Samba** server kompatibilan sa Active Directory-jem. Mo캖i 캖ete da postavite administratorsku lozinku i pristupite DC-ima u VPC-u.
* **AD Connector**: Proksi za **preusmeravanje zahteva za direktorijumom na va코 postoje캖i Microsoft Active Directory** bez ke코iranja bilo kakvih informacija u oblaku. Bi캖e u re쬴mu slu코anja u **VPC-u** i morate dati **akreditive za pristup postoje캖em AD-u**.
* **Amazon Cognito User Pools**: Ovo je isto 코to i Cognito User Pools.
* **Cloud Directory**: Ovo je **najjednostavnije**. **Serverless** direktorijum gde navodite **코emu** koja 캖e se koristiti i napla캖ujete se prema **kori코캖enju**.

AWS Directory services omogu캖ava **sinhronizaciju** sa va코im postoje캖im **on-premises** Microsoft AD, **pokretanje vlastitog** u AWS-u ili sinhronizaciju sa **drugim tipovima direktorijuma**.

### Lab

Ovde mo쬰te prona캖i lep tutorijal za kreiranje vlastitog Microsoft AD u AWS-u: [https://docs.aws.amazon.com/directoryservice/latest/admin-guide/ms\_ad\_tutorial\_test\_lab\_base.html](https://docs.aws.amazon.com/directoryservice/latest/admin-guide/ms\_ad\_tutorial\_test\_lab\_base.html)

### Enumeration
```bash
# Get directories and DCs
aws ds describe-directories
aws ds describe-domain-controllers --directory-id <id>
# Get directory settings
aws ds describe-trusts
aws ds describe-ldaps-settings --directory-id <id>
aws ds describe-shared-directories --owner-directory-id <id>
aws ds get-directory-limits
aws ds list-certificates --directory-id <id>
aws ds describe-certificate --directory-id <id> --certificate-id <id>
```
### Login

Napomena da ako **opis** direktorijuma sadr쬴 **domen** u polju **`AccessUrl`**, to je zato 코to korisnik verovatno mo쬰 da se **prijavi** sa svojim **AD akreditivima** u nekim **AWS uslugama:**

* `<name>.awsapps.com/connect` (Amazon Connect)
* `<name>.awsapps.com/workdocs` (Amazon WorkDocs)
* `<name>.awsapps.com/workmail` (Amazon WorkMail)
* `<name>.awsapps.com/console` (Amazon Management Console)
* `<name>.awsapps.com/start` (IAM Identity Center)

### Privilege Escalation

{% content-ref url="../aws-privilege-escalation/aws-directory-services-privesc.md" %}
[aws-directory-services-privesc.md](../aws-privilege-escalation/aws-directory-services-privesc.md)
{% endcontent-ref %}

## Persistence

### Using an AD user

**AD korisniku** mo쬰 biti dodeljen **pristup AWS upravlja캜koj konzoli** putem uloge koju treba preuzeti. **Podrazumevano korisni캜ko ime je Admin** i mogu캖e je **promeniti njegovu lozinku** iz AWS konzole.

Stoga, mogu캖e je **promeniti lozinku Admin-a**, **napraviti novog korisnika** ili **promeniti lozinku** korisnika i dodeliti toj korisniku ulogu za odr쬬vanje pristupa.\
Tako캠e je mogu캖e **dodati korisnika u grupu unutar AD** i **dati toj AD grupi pristup ulozi** (da bi se ova postojanost u캜inila manje uo캜ljivom).

### Sharing AD (from victim to attacker)

Mogu캖e je deliti AD okru쬰nje od rtve do napada캜a. Na ovaj na캜in napada캜 캖e mo캖i da nastavi sa pristupom AD okru쬰nju.\
Me캠utim, to podrazumeva deljenje upravljanog AD-a i tako캠e kreiranje VPC peering veze.

Mo쬰te prona캖i vodi캜 ovde: [https://docs.aws.amazon.com/directoryservice/latest/admin-guide/step1\_setup\_networking.html](https://docs.aws.amazon.com/directoryservice/latest/admin-guide/step1\_setup\_networking.html)

### ~~Sharing AD (from attacker to victim)~~

Ne izgleda kao da je mogu캖e dodeliti AWS pristup korisnicima iz razli캜itog AD okru쬰nja jednoj AWS nalogu.

## WorkDocs

Amazon Web Services (AWS) WorkDocs je usluga za **skladi코tenje i deljenje datoteka** zasnovana na oblaku. Deo je AWS paketa usluga ra캜unarstva u oblaku i dizajnirana je da pru쬴 sigurno i skalabilno re코enje za organizacije za skladi코tenje, deljenje i saradnju na datotekama i dokumentima.

AWS WorkDocs pru쬬 web interfejs za korisnike da otpremaju, pristupaju i upravljaju svojim datotekama i dokumentima. Tako캠e nudi funkcije kao 코to su kontrola verzija, saradnja u realnom vremenu i integracija sa drugim AWS uslugama i alatima tre캖ih strana.

### Enumeration

{% code overflow="wrap" %}
```bash
# Get AD users (Admin not included)
aws workdocs describe-users --organization-id <directory-id>
# Get AD groups (containing "a")
aws workdocs describe-groups --organization-id d-9067a0285c --search-query a

# Create user (created inside the AD)
aws workdocs create-user --username testingasd --given-name testingasd --surname testingasd --password <password> --email-address name@directory.domain --organization-id <directory-id>

# Get what each user has created
aws workdocs describe-activities --user-id "S-1-5-21-377..."

# Get what was created in the directory
aws workdocs describe-activities --organization-id <directory-id>

# Get folder content
aws workdocs describe-folder-contents --folder-id <fold-id>

# Get file (a url to access with the content will be retreived)
aws workdocs get-document --document-id <doc-id>

# Get resource permissions if any
aws workdocs describe-resource-permissions --resource-id <value>

# Add permission so anyway can see the file
aws workdocs add-resource-permissions --resource-id <id> --principals Id=anonymous,Type=ANONYMOUS,Role=VIEWER
## This will give an id, the file will be acesible in: https://<name>.awsapps.com/workdocs/index.html#/share/document/<id>
```
{% endcode %}

### Privesc

{% content-ref url="../aws-privilege-escalation/aws-workdocs-privesc.md" %}
[aws-workdocs-privesc.md](../aws-privilege-escalation/aws-workdocs-privesc.md)
{% endcontent-ref %}

{% hint style="success" %}
U캜ite i ve쬭ajte AWS Hacking:<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
U캜ite i ve쬭ajte GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Podr코ka HackTricks</summary>

* Proverite [**planove pretplate**](https://github.com/sponsors/carlospolop)!
* **Pridru쬴te se** 游눫 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili **pratite** nas na **Twitteru** 游냕 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podelite hakerske trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
{% endhint %}
