# AWS - ECR Enum

## AWS - ECR Enum

{% hint style="success" %}
AWS Hacking'i öğrenin ve pratik yapın:<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
GCP Hacking'i öğrenin ve pratik yapın: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**abonelik planlarını**](https://github.com/sponsors/carlospolop) kontrol edin!
* **Bize katılın** 💬 [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) veya **bizi** **Twitter'da** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks_live)** takip edin.**
* **Hacking ipuçlarını paylaşın,** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna PR göndererek.

</details>
{% endhint %}

### ECR

#### Temel Bilgiler

Amazon **Elastic Container Registry** (Amazon ECR), **yönetilen bir konteyner görüntü kayıt hizmetidir**. Müşterilerin konteyner görüntüleriyle tanınmış arayüzler kullanarak etkileşimde bulunabilecekleri bir ortam sağlamak için tasarlanmıştır. Özellikle, Docker CLI veya tercih edilen herhangi bir istemcinin kullanımı desteklenir ve bu, görüntüleri itme, çekme ve yönetme gibi etkinlikleri mümkün kılar.

ECR, 2 tür nesneden oluşur: **Kayıtlar** ve **Depolar**.

**Kayıtlar**

Her AWS hesabının 2 kaydı vardır: **Özel** ve **Halka Açık**.

1. **Özel Kayıtlar**:

* **Varsayılan olarak özel**: Amazon ECR özel kaydında depolanan konteyner görüntüleri, yalnızca AWS hesabınızdaki yetkili kullanıcılar veya izin verilmiş olanlar tarafından **erişilebilir**.
* Bir **özel depo** URI'si `<account_id>.dkr.ecr.<region>.amazonaws.com/<repo-name>` formatını takip eder.
* **Erişim kontrolü**: Özel konteyner görüntülerinize erişimi **IAM politikaları** kullanarak **kontrol edebilirsiniz** ve kullanıcılar veya roller bazında ince ayar izinleri yapılandırabilirsiniz.
* **AWS hizmetleriyle entegrasyon**: Amazon ECR özel kayıtları, EKS, ECS gibi diğer AWS hizmetleriyle kolayca **entegrasyon** sağlayabilir.
* **Diğer özel kayıt seçenekleri**:
* Etiket değişmezliği sütunu, etiket değişmezliği etkinleştirildiğinde, **önceden var olan etiketlerle** görüntü **itmelerinin** üzerine yazılmasını **önleyecektir**.
* **Şifreleme türü** sütunu, deponun şifreleme özelliklerini listeler, varsayılan şifreleme türleri olarak AES-256 gibi veya **KMS** etkin şifrelemeleri gösterir.
* **Önbellek üzerinden çekme** sütunu, durumunu listeler, Önbellek üzerinden çekme durumu Aktif ise, **dış bir halka açık depodaki depoları özel deponuza önbelleğe alır**.
* Farklı **izinler** vermek için belirli **IAM politikaları** yapılandırılabilir.
* **Tarama yapılandırması**, depoda saklanan görüntülerdeki güvenlik açıklarını taramak için olanak tanır.

2. **Halka Açık Kayıtlar**:

* **Halka açık erişim**: ECR Halka Açık kaydında depolanan konteyner görüntüleri, **kimlik doğrulama olmaksızın internetteki herkes tarafından erişilebilir.**
* Bir **halka açık depo** URI'si `public.ecr.aws/<random>/<name>` gibidir. `<random>` kısmı, yönetici tarafından hatırlanması daha kolay başka bir dize ile değiştirilebilir.

**Depolar**

Bunlar, **özel kayıtta** veya **halka açık** olan **görüntülerdir**.

{% hint style="info" %}
Bir görüntüyü bir depoya yüklemek için, **ECR deposunun görüntüyle aynı adı taşıması gerektiğini** unutmayın.
{% endhint %}

#### Kayıt & Depo Politikaları

**Kayıtlar ve depolar**, diğer ilkeler/hesaplar için izin vermek amacıyla kullanılabilecek **politikalar** da taşır. Örneğin, aşağıdaki depo politikası görüntüsünde, tüm organizasyondan herhangi bir kullanıcının görüntüye erişebileceğini görebilirsiniz:

<figure><img src="../../../.gitbook/assets/image (280).png" alt=""><figcaption></figcaption></figure>

#### Sayım

{% code overflow="wrap" %}
```bash
# Get repos
aws ecr describe-repositories
aws ecr describe-registry

# Get image metadata
aws ecr list-images --repository-name <repo_name>
aws ecr describe-images --repository-name <repo_name>
aws ecr describe-image-replication-status --repository-name <repo_name> --image-id <image_id>
aws ecr describe-image-scan-findings --repository-name <repo_name> --image-id <image_id>
aws ecr describe-pull-through-cache-rules --repository-name <repo_name> --image-id <image_id>

# Get public repositories
aws ecr-public describe-repositories

# Get policies
aws ecr get-registry-policy
aws ecr get-repository-policy --repository-name <repo_name>
```
{% endcode %}

#### Kimlik Doğrulamasız Enum

{% content-ref url="../aws-unauthenticated-enum-access/aws-ecr-unauthenticated-enum.md" %}
[aws-ecr-unauthenticated-enum.md](../aws-unauthenticated-enum-access/aws-ecr-unauthenticated-enum.md)
{% endcontent-ref %}

#### Privesc

Aşağıdaki sayfada **ECR izinlerini kötüye kullanarak ayrıcalıkları artırma** yöntemini kontrol edebilirsiniz:

{% content-ref url="../aws-privilege-escalation/aws-ecr-privesc.md" %}
[aws-ecr-privesc.md](../aws-privilege-escalation/aws-ecr-privesc.md)
{% endcontent-ref %}

#### İstismar Sonrası

{% content-ref url="../aws-post-exploitation/aws-ecr-post-exploitation.md" %}
[aws-ecr-post-exploitation.md](../aws-post-exploitation/aws-ecr-post-exploitation.md)
{% endcontent-ref %}

#### Süreklilik

{% content-ref url="../aws-persistence/aws-ecr-persistence.md" %}
[aws-ecr-persistence.md](../aws-persistence/aws-ecr-persistence.md)
{% endcontent-ref %}

## Referanslar

* [https://docs.aws.amazon.com/AmazonECR/latest/APIReference/Welcome.html](https://docs.aws.amazon.com/AmazonECR/latest/APIReference/Welcome.html)

{% hint style="success" %}
AWS Hacking'i öğrenin ve pratik yapın:<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
GCP Hacking'i öğrenin ve pratik yapın: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**abonelik planlarını**](https://github.com/sponsors/carlospolop) kontrol edin!
* **💬 [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katılın ya da **Twitter'da** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**'i takip edin.**
* **Hacking ipuçlarını paylaşmak için** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna PR gönderin.

</details>
{% endhint %}
