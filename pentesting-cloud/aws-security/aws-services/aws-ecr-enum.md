# AWS - ECR Enum

## AWS - ECR Enum

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

### ECR

#### Basic Information

Amazon **Elastic Container Registry** (Amazon ECR) ni **huduma ya usajili wa picha za kontena inayosimamiwa**. Imeundwa ili kutoa mazingira ambapo wateja wanaweza kuingiliana na picha zao za kontena kwa kutumia interfaces zinazojulikana. Kwa hakika, matumizi ya Docker CLI au mteja yeyote anayependelea yanasaidiwa, kuruhusu shughuli kama vile kusukuma, kuvuta, na kusimamia picha za kontena.

ECR inajumuisha aina 2 za vitu: **Usajili** na **Hifadhi**.

**Usajili**

Kila akaunti ya AWS ina usajili 2: **Binafsi** na **Jumla**.

1. **Usajili Binafsi**:

* **Binafsi kwa chaguo-msingi**: Picha za kontena zilizohifadhiwa katika usajili wa binafsi wa Amazon ECR ni **zinapatikana tu kwa watumiaji walioidhinishwa** ndani ya akaunti yako ya AWS au kwa wale ambao wamepewa ruhusa.
* URI ya **hifadhi binafsi** inafuata muundo `<account_id>.dkr.ecr.<region>.amazonaws.com/<repo-name>`
* **Udhibiti wa ufikiaji**: Unaweza **kudhibiti ufikiaji** wa picha zako za kontena binafsi kwa kutumia **sera za IAM**, na unaweza kuunda ruhusa za kina kulingana na watumiaji au majukumu.
* **Ushirikiano na huduma za AWS**: Usajili wa binafsi wa Amazon ECR unaweza kuunganishwa kwa urahisi na **huduma nyingine za AWS**, kama EKS, ECS...
* **Chaguzi nyingine za usajili binafsi**:
* Safu ya uhamasishaji wa lebo inaonyesha hali yake, ikiwa uhamasishaji wa lebo umewezeshwa it **zuia** picha **kusukumwa** na **lebo zilizopo** kutoka kufunika picha hizo.
* Safu ya **aina ya usimbuaji** inaonyesha mali za usimbuaji wa hifadhi, inaonyesha aina za usimbuaji za chaguo-msingi kama AES-256, au ina **KMS** iliyowezeshwa usimbuaji.
* Safu ya **Kuvuta kupitia cache** inaonyesha hali yake, ikiwa hali ya Kuvuta kupitia cache ni Active itahifadhi **hifadhi katika usajili wa umma wa nje ndani ya hifadhi yako binafsi**.
* Sera maalum za **IAM** zinaweza kuundwa ili kutoa ruhusa tofauti.
* **Mikakati ya skanning** inaruhusu kuchunguza udhaifu katika picha zilizohifadhiwa ndani ya hifadhi.

2. **Usajili wa Umma**:

* **Upatikanaji wa umma**: Picha za kontena zilizohifadhiwa katika usajili wa Umma wa ECR ni **zinapatikana kwa mtu yeyote kwenye mtandao bila uthibitisho.**
* URI ya **hifadhi ya umma** ni kama `public.ecr.aws/<random>/<name>`. Ingawa sehemu ya `<random>` inaweza kubadilishwa na msimamizi kuwa string nyingine rahisi kukumbuka.

**Hifadhi**

Hizi ni **picha** ambazo ziko katika **usajili binafsi** au katika **umum**.

{% hint style="info" %}
Kumbuka kwamba ili kupakia picha kwenye hifadhi, **hifadhi ya ECR inahitaji kuwa na jina sawa na picha**.
{% endhint %}

#### Sera za Usajili & Hifadhi

**Usajili & hifadhi** pia zina **sera ambazo zinaweza kutumika kutoa ruhusa kwa wahusika/akaunti nyingine**. Kwa mfano, katika picha ya sera ya hifadhi ifuatayo unaweza kuona jinsi mtumiaji yeyote kutoka shirika zima atavyoweza kufikia picha hiyo:

<figure><img src="../../../.gitbook/assets/image (280).png" alt=""><figcaption></figcaption></figure>

#### Enumeration

{% code overflow="wrap" %}
```bash
# Get repos
aws ecr describe-repositories
aws ecr describe-registry

# Get image metadata
aws ecr list-images --repository-name <repo_name>
aws ecr describe-images --repository-name <repo_name>
aws ecr describe-image-replication-status --repository-name <repo_name> --image-id <image_id>
aws ecr describe-image-scan-findings --repository-name <repo_name> --image-id <image_id>
aws ecr describe-pull-through-cache-rules --repository-name <repo_name> --image-id <image_id>

# Get public repositories
aws ecr-public describe-repositories

# Get policies
aws ecr get-registry-policy
aws ecr get-repository-policy --repository-name <repo_name>
```
{% endcode %}

#### Unauthenticated Enum

{% content-ref url="../aws-unauthenticated-enum-access/aws-ecr-unauthenticated-enum.md" %}
[aws-ecr-unauthenticated-enum.md](../aws-unauthenticated-enum-access/aws-ecr-unauthenticated-enum.md)
{% endcontent-ref %}

#### Privesc

Katika ukurasa ufuatao unaweza kuangalia jinsi ya **kudhulumu ruhusa za ECR ili kupandisha mamlaka**:

{% content-ref url="../aws-privilege-escalation/aws-ecr-privesc.md" %}
[aws-ecr-privesc.md](../aws-privilege-escalation/aws-ecr-privesc.md)
{% endcontent-ref %}

#### Post Exploitation

{% content-ref url="../aws-post-exploitation/aws-ecr-post-exploitation.md" %}
[aws-ecr-post-exploitation.md](../aws-post-exploitation/aws-ecr-post-exploitation.md)
{% endcontent-ref %}

#### Persistence

{% content-ref url="../aws-persistence/aws-ecr-persistence.md" %}
[aws-ecr-persistence.md](../aws-persistence/aws-ecr-persistence.md)
{% endcontent-ref %}

## References

* [https://docs.aws.amazon.com/AmazonECR/latest/APIReference/Welcome.html](https://docs.aws.amazon.com/AmazonECR/latest/APIReference/Welcome.html)

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
