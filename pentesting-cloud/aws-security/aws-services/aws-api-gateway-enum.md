# AWS - API Gateway Enum

{% hint style="success" %}
ÎœÎ¬Î¸ÎµÏ„Îµ & ÎµÎ¾Î±ÏƒÎºÎ·Î¸ÎµÎ¯Ï„Îµ ÏƒÏ„Î¿ AWS Hacking:<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
ÎœÎ¬Î¸ÎµÏ„Îµ & ÎµÎ¾Î±ÏƒÎºÎ·Î¸ÎµÎ¯Ï„Îµ ÏƒÏ„Î¿ GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Î¥Ï€Î¿ÏƒÏ„Î®ÏÎ¹Î¾Î· HackTricks</summary>

* Î•Î»Î­Î³Î¾Ï„Îµ Ï„Î± [**ÏƒÏ‡Î­Î´Î¹Î± ÏƒÏ…Î½Î´ÏÎ¿Î¼Î®Ï‚**](https://github.com/sponsors/carlospolop)!
* **Î•Î³Î³ÏÎ±Ï†ÎµÎ¯Ï„Îµ ÏƒÏ„Î·Î½** ğŸ’¬ [**Î¿Î¼Î¬Î´Î± Discord**](https://discord.gg/hRep4RUj7f) Î® ÏƒÏ„Î·Î½ [**Î¿Î¼Î¬Î´Î± telegram**](https://t.me/peass) Î® **Î±ÎºÎ¿Î»Î¿Ï…Î¸Î®ÏƒÏ„Îµ** Î¼Î±Ï‚ ÏƒÏ„Î¿ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **ÎœÎ¿Î¹ÏÎ±ÏƒÏ„ÎµÎ¯Ï„Îµ ÎºÏŒÎ»Ï€Î± hacking Ï…Ï€Î¿Î²Î¬Î»Î»Î¿Î½Ï„Î±Ï‚ PRs ÏƒÏ„Î±** [**HackTricks**](https://github.com/carlospolop/hacktricks) ÎºÎ±Î¹ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## API Gateway

### Î’Î±ÏƒÎ¹ÎºÎ­Ï‚ Î Î»Î·ÏÎ¿Ï†Î¿ÏÎ¯ÎµÏ‚

Î¤Î¿ AWS API Gateway ÎµÎ¯Î½Î±Î¹ Î¼Î¹Î± Î¿Î»Î¿ÎºÎ»Î·ÏÏ‰Î¼Î­Î½Î· Ï…Ï€Î·ÏÎµÏƒÎ¯Î± Ï€Î¿Ï… Ï€ÏÎ¿ÏƒÏ†Î­ÏÎµÏ„Î±Î¹ Î±Ï€ÏŒ Ï„Î·Î½ Amazon Web Services (AWS) ÏƒÏ‡ÎµÎ´Î¹Î±ÏƒÎ¼Î­Î½Î· Î³Î¹Î± Ï€ÏÎ¿Î³ÏÎ±Î¼Î¼Î±Ï„Î¹ÏƒÏ„Î­Ï‚ Î½Î± **Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î¿ÏÎ½, Î´Î·Î¼Î¿ÏƒÎ¹ÎµÏÎ¿Ï…Î½ ÎºÎ±Î¹ ÎµÏ€Î¹Î²Î»Î­Ï€Î¿Ï…Î½ APIs ÏƒÎµ Î¼ÎµÎ³Î¬Î»Î· ÎºÎ»Î¯Î¼Î±ÎºÎ±**. Î›ÎµÎ¹Ï„Î¿Ï…ÏÎ³ÎµÎ¯ Ï‰Ï‚ ÏƒÎ·Î¼ÎµÎ¯Î¿ ÎµÎ¹ÏƒÏŒÎ´Î¿Ï… ÏƒÎµ Î¼Î¹Î± ÎµÏ†Î±ÏÎ¼Î¿Î³Î®, ÎµÏ€Î¹Ï„ÏÎ­Ï€Î¿Î½Ï„Î±Ï‚ ÏƒÏ„Î¿Ï…Ï‚ Ï€ÏÎ¿Î³ÏÎ±Î¼Î¼Î±Ï„Î¹ÏƒÏ„Î­Ï‚ Î½Î± ÎºÎ±Î¸Î¿ÏÎ¯ÏƒÎ¿Ï…Î½ Î­Î½Î± Ï€Î»Î±Î¯ÏƒÎ¹Î¿ ÎºÎ±Î½ÏŒÎ½Ï‰Î½ ÎºÎ±Î¹ Î´Î¹Î±Î´Î¹ÎºÎ±ÏƒÎ¹ÏÎ½. Î‘Ï…Ï„ÏŒ Ï„Î¿ Ï€Î»Î±Î¯ÏƒÎ¹Î¿ Î´Î¹Î­Ï€ÎµÎ¹ Ï„Î·Î½ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ· Ï€Î¿Ï… Î­Ï‡Î¿Ï…Î½ Î¿Î¹ ÎµÎ¾Ï‰Ï„ÎµÏÎ¹ÎºÎ¿Î¯ Ï‡ÏÎ®ÏƒÏ„ÎµÏ‚ ÏƒÎµ Î¿ÏÎ¹ÏƒÎ¼Î­Î½Î± Î´ÎµÎ´Î¿Î¼Î­Î½Î± Î® Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¯ÎµÏ‚ ÎµÎ½Ï„ÏŒÏ‚ Ï„Î·Ï‚ ÎµÏ†Î±ÏÎ¼Î¿Î³Î®Ï‚.

Î¤Î¿ API Gateway ÏƒÎ±Ï‚ ÎµÏ€Î¹Ï„ÏÎ­Ï€ÎµÎ¹ Î½Î± ÎºÎ±Î¸Î¿ÏÎ¯ÏƒÎµÏ„Îµ **Ï€ÏÏ‚ Î¸Î± Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± Î´Î¹Î±Ï‡ÎµÎ¹ÏÎ¯Î¶Î¿Î½Ï„Î±Î¹ Ï„Î± Î±Î¹Ï„Î®Î¼Î±Ï„Î± Ï€ÏÎ¿Ï‚ Ï„Î± APIs ÏƒÎ±Ï‚**, ÎºÎ±Î¹ Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î®ÏƒÎµÎ¹ Ï€ÏÎ¿ÏƒÎ±ÏÎ¼Î¿ÏƒÎ¼Î­Î½Î± API endpoints Î¼Îµ ÏƒÏ…Î³ÎºÎµÎºÏÎ¹Î¼Î­Î½ÎµÏ‚ Î¼ÎµÎ¸ÏŒÎ´Î¿Ï…Ï‚ (Ï€.Ï‡., GET, POST, PUT, DELETE) ÎºÎ±Î¹ Ï€ÏŒÏÎ¿Ï…Ï‚. ÎœÏ€Î¿ÏÎµÎ¯ ÎµÏ€Î¯ÏƒÎ·Ï‚ Î½Î± Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î®ÏƒÎµÎ¹ SDKs (Software Development Kits) Î³Î¹Î± Î½Î± Î´Î¹ÎµÏ…ÎºÎ¿Î»ÏÎ½ÎµÎ¹ Ï„Î¿Ï…Ï‚ Ï€ÏÎ¿Î³ÏÎ±Î¼Î¼Î±Ï„Î¹ÏƒÏ„Î­Ï‚ Î½Î± ÎºÎ±Î»Î¿ÏÎ½ Ï„Î± APIs ÏƒÎ±Ï‚ Î±Ï€ÏŒ Ï„Î¹Ï‚ ÎµÏ†Î±ÏÎ¼Î¿Î³Î­Ï‚ Ï„Î¿Ï…Ï‚.

### Î¤ÏÏ€Î¿Î¹ API Gateways

* **HTTP API**: Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î®ÏƒÏ„Îµ REST APIs Ï‡Î±Î¼Î·Î»Î®Ï‚ ÎºÎ±Î¸Ï…ÏƒÏ„Î­ÏÎ·ÏƒÎ·Ï‚ ÎºÎ±Î¹ Î¿Î¹ÎºÎ¿Î½Î¿Î¼Î¹ÎºÎ¬ Î±Ï€Î¿Î´Î¿Ï„Î¹ÎºÎ¬ Î¼Îµ ÎµÎ½ÏƒÏ‰Î¼Î±Ï„Ï‰Î¼Î­Î½Î± Ï‡Î±ÏÎ±ÎºÏ„Î·ÏÎ¹ÏƒÏ„Î¹ÎºÎ¬ ÏŒÏ€Ï‰Ï‚ OIDC ÎºÎ±Î¹ OAuth2, ÎºÎ±Î¹ ÎµÎ³Î³ÎµÎ½Î® Ï…Ï€Î¿ÏƒÏ„Î®ÏÎ¹Î¾Î· CORS. Î›ÎµÎ¹Ï„Î¿Ï…ÏÎ³ÎµÎ¯ Î¼Îµ Ï„Î± ÎµÎ¾Î®Ï‚: Lambda, HTTP backends.
* **WebSocket API**: Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î®ÏƒÏ„Îµ Î­Î½Î± WebSocket API Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÏÎ½Ï„Î±Ï‚ Î¼ÏŒÎ½Î¹Î¼ÎµÏ‚ ÏƒÏ…Î½Î´Î­ÏƒÎµÎ¹Ï‚ Î³Î¹Î± Ï€ÎµÏÎ¹Ï€Ï„ÏÏƒÎµÎ¹Ï‚ Ï‡ÏÎ®ÏƒÎ·Ï‚ ÏƒÎµ Ï€ÏÎ±Î³Î¼Î±Ï„Î¹ÎºÏŒ Ï‡ÏÏŒÎ½Î¿ ÏŒÏ€Ï‰Ï‚ ÎµÏ†Î±ÏÎ¼Î¿Î³Î­Ï‚ ÏƒÏ…Î½Î¿Î¼Î¹Î»Î¯Î±Ï‚ Î® Ï€Î¯Î½Î±ÎºÎµÏ‚ ÎµÎ»Î­Î³Ï‡Î¿Ï…. Î›ÎµÎ¹Ï„Î¿Ï…ÏÎ³ÎµÎ¯ Î¼Îµ Ï„Î± ÎµÎ¾Î®Ï‚: Lambda, HTTP, AWS Services.
* **REST API**: Î‘Î½Î±Ï€Ï„ÏÎ¾Ï„Îµ Î­Î½Î± REST API ÏŒÏ€Î¿Ï… Î±Ï€Î¿ÎºÏ„Î¬Ï„Îµ Ï€Î»Î®ÏÎ· Î­Î»ÎµÎ³Ï‡Î¿ Ï€Î¬Î½Ï‰ ÏƒÏ„Î¿ Î±Î¯Ï„Î·Î¼Î± ÎºÎ±Î¹ Ï„Î·Î½ Î±Ï€Î¬Î½Ï„Î·ÏƒÎ· Î¼Î±Î¶Î¯ Î¼Îµ Î´Ï…Î½Î±Ï„ÏŒÏ„Î·Ï„ÎµÏ‚ Î´Î¹Î±Ï‡ÎµÎ¯ÏÎ¹ÏƒÎ·Ï‚ API. Î›ÎµÎ¹Ï„Î¿Ï…ÏÎ³ÎµÎ¯ Î¼Îµ Ï„Î± ÎµÎ¾Î®Ï‚: Lambda, HTTP, AWS Services.
* **Î™Î´Î¹Ï‰Ï„Î¹ÎºÏŒ REST API**: Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î®ÏƒÏ„Îµ Î­Î½Î± REST API Ï€Î¿Ï… ÎµÎ¯Î½Î±Î¹ Ï€ÏÎ¿ÏƒÎ²Î¬ÏƒÎ¹Î¼Î¿ Î¼ÏŒÎ½Î¿ Î±Ï€ÏŒ Î¼Î­ÏƒÎ± ÏƒÎµ Î­Î½Î± VPC.

### ÎšÏÏÎ¹Î± Î£Ï…ÏƒÏ„Î±Ï„Î¹ÎºÎ¬ Ï„Î¿Ï… API Gateway

1. **Î ÏŒÏÎ¿Î¹**: Î£Ï„Î¿ API Gateway, Î¿Î¹ Ï€ÏŒÏÎ¿Î¹ ÎµÎ¯Î½Î±Î¹ Ï„Î± ÏƒÏ…ÏƒÏ„Î±Ï„Î¹ÎºÎ¬ Ï€Î¿Ï… **ÏƒÏ…Î½Î¸Î­Ï„Î¿Ï…Î½ Ï„Î· Î´Î¿Î¼Î® Ï„Î¿Ï… API ÏƒÎ±Ï‚**. Î‘Î½Ï„Î¹Ï€ÏÎ¿ÏƒÏ‰Ï€ÎµÏÎ¿Ï…Î½ **Ï„Î± Î´Î¹Î¬Ï†Î¿ÏÎ± Î¼Î¿Î½Î¿Ï€Î¬Ï„Î¹Î± Î® endpoints** Ï„Î¿Ï… API ÏƒÎ±Ï‚ ÎºÎ±Î¹ Î±Î½Ï„Î¹ÏƒÏ„Î¿Î¹Ï‡Î¿ÏÎ½ ÏƒÏ„Î¹Ï‚ Î´Î¹Î¬Ï†Î¿ÏÎµÏ‚ ÎµÎ½Î­ÏÎ³ÎµÎ¹ÎµÏ‚ Ï€Î¿Ï… Ï…Ï€Î¿ÏƒÏ„Î·ÏÎ¯Î¶ÎµÎ¹ Ï„Î¿ API ÏƒÎ±Ï‚. ÎˆÎ½Î±Ï‚ Ï€ÏŒÏÎ¿Ï‚ ÎµÎ¯Î½Î±Î¹ ÎºÎ¬Î¸Îµ Î¼Î­Î¸Î¿Î´Î¿Ï‚ (Ï€.Ï‡., GET, POST, PUT, DELETE) **Î¼Î­ÏƒÎ± ÏƒÎµ ÎºÎ¬Î¸Îµ Î¼Î¿Î½Î¿Ï€Î¬Ï„Î¹** (/, Î® /users, Î® /user/{id}).
2. **Î£Ï„Î¬Î´Î¹Î±**: Î¤Î± ÏƒÏ„Î¬Î´Î¹Î± ÏƒÏ„Î¿ API Gateway Î±Î½Ï„Î¹Ï€ÏÎ¿ÏƒÏ‰Ï€ÎµÏÎ¿Ï…Î½ **Î´Î¹Î±Ï†Î¿ÏÎµÏ„Î¹ÎºÎ­Ï‚ ÎµÎºÎ´ÏŒÏƒÎµÎ¹Ï‚ Î® Ï€ÎµÏÎ¹Î²Î¬Î»Î»Î¿Î½Ï„Î±** Ï„Î¿Ï… API ÏƒÎ±Ï‚, ÏŒÏ€Ï‰Ï‚ Î±Î½Î¬Ï€Ï„Ï…Î¾Î·, Î´Î¿ÎºÎ¹Î¼Î±ÏƒÏ„Î¹ÎºÎ® Î® Ï€Î±ÏÎ±Î³Ï‰Î³Î®. ÎœÏ€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î®ÏƒÎµÏ„Îµ ÏƒÏ„Î¬Î´Î¹Î± Î³Î¹Î± Î½Î± Î´Î¹Î±Ï‡ÎµÎ¹ÏÎ¹ÏƒÏ„ÎµÎ¯Ï„Îµ ÎºÎ±Î¹ Î½Î± Î±Î½Î±Ï€Ï„ÏÎ¾ÎµÏ„Îµ **Ï€Î¿Î»Î»Î±Ï€Î»Î­Ï‚ ÎµÎºÎ´ÏŒÏƒÎµÎ¹Ï‚ Ï„Î¿Ï… API ÏƒÎ±Ï‚ Ï„Î±Ï…Ï„ÏŒÏ‡ÏÎ¿Î½Î±**, ÎµÏ€Î¹Ï„ÏÎ­Ï€Î¿Î½Ï„Î¬Ï‚ ÏƒÎ±Ï‚ Î½Î± Î´Î¿ÎºÎ¹Î¼Î¬ÏƒÎµÏ„Îµ Î½Î­ÎµÏ‚ Î´Ï…Î½Î±Ï„ÏŒÏ„Î·Ï„ÎµÏ‚ Î® Î´Î¹Î¿ÏÎ¸ÏÏƒÎµÎ¹Ï‚ ÏƒÏ†Î±Î»Î¼Î¬Ï„Ï‰Î½ Ï‡Ï‰ÏÎ¯Ï‚ Î½Î± ÎµÏ€Î·ÏÎµÎ¬ÏƒÎµÏ„Îµ Ï„Î¿ Ï€ÎµÏÎ¹Î²Î¬Î»Î»Î¿Î½ Ï€Î±ÏÎ±Î³Ï‰Î³Î®Ï‚. Î¤Î± ÏƒÏ„Î¬Î´Î¹Î± Ï…Ï€Î¿ÏƒÏ„Î·ÏÎ¯Î¶Î¿Ï…Î½ ÎµÏ€Î¯ÏƒÎ·Ï‚ **Î¼ÎµÏ„Î±Î²Î»Î·Ï„Î­Ï‚ ÏƒÏ„Î±Î´Î¯Î¿Ï…**, Î¿Î¹ Î¿Ï€Î¿Î¯ÎµÏ‚ ÎµÎ¯Î½Î±Î¹ Î¶ÎµÏÎ³Î· ÎºÎ»ÎµÎ¹Î´Î¹Î¿Ï-Ï„Î¹Î¼Î®Ï‚ Ï€Î¿Ï… Î¼Ï€Î¿ÏÎ¿ÏÎ½ Î½Î± Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î·Î¸Î¿ÏÎ½ Î³Î¹Î± Î½Î± ÏÏ…Î¸Î¼Î¯ÏƒÎ¿Ï…Î½ Ï„Î· ÏƒÏ…Î¼Ï€ÎµÏÎ¹Ï†Î¿ÏÎ¬ Ï„Î¿Ï… API ÏƒÎ±Ï‚ Î¼Îµ Î²Î¬ÏƒÎ· Ï„Î¿ Ï„ÏÎ­Ï‡Î¿Î½ ÏƒÏ„Î¬Î´Î¹Î¿. Î“Î¹Î± Ï€Î±ÏÎ¬Î´ÎµÎ¹Î³Î¼Î±, Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î®ÏƒÎµÏ„Îµ Î¼ÎµÏ„Î±Î²Î»Î·Ï„Î­Ï‚ ÏƒÏ„Î±Î´Î¯Î¿Ï… Î³Î¹Î± Î½Î± ÎºÎ±Ï„ÎµÏ…Î¸ÏÎ½ÎµÏ„Îµ Ï„Î± Î±Î¹Ï„Î®Î¼Î±Ï„Î± API ÏƒÎµ Î´Î¹Î±Ï†Î¿ÏÎµÏ„Î¹ÎºÎ­Ï‚ Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¯ÎµÏ‚ Lambda Î® Î¬Î»Î»ÎµÏ‚ Ï…Ï€Î·ÏÎµÏƒÎ¯ÎµÏ‚ backend Î±Î½Î¬Î»Î¿Î³Î± Î¼Îµ Ï„Î¿ ÏƒÏ„Î¬Î´Î¹Î¿.
* Î¤Î¿ ÏƒÏ„Î¬Î´Î¹Î¿ Ï…Ï€Î¿Î´ÎµÎ¹ÎºÎ½ÏÎµÏ„Î±Î¹ ÏƒÏ„Î·Î½ Î±ÏÏ‡Î® Ï„Î¿Ï… URL Ï„Î¿Ï… endpoint Ï„Î¿Ï… API Gateway.
3. **Î•Î¾Î¿Ï…ÏƒÎ¹Î¿Î´Î¿Ï„Î·Ï„Î­Ï‚**: ÎŸÎ¹ ÎµÎ¾Î¿Ï…ÏƒÎ¹Î¿Î´Î¿Ï„Î·Ï„Î­Ï‚ ÏƒÏ„Î¿ API Gateway ÎµÎ¯Î½Î±Î¹ Ï…Ï€ÎµÏÎ¸Ï…Î½Î¿Î¹ Î³Î¹Î± **Ï„Î¿Î½ Î­Î»ÎµÎ³Ï‡Î¿ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ·Ï‚ ÏƒÏ„Î¿ API ÏƒÎ±Ï‚** ÎµÏ€Î±Î»Î·Î¸ÎµÏÎ¿Î½Ï„Î±Ï‚ Ï„Î·Î½ Ï„Î±Ï…Ï„ÏŒÏ„Î·Ï„Î± Ï„Î¿Ï… ÎºÎ±Î»Î¿ÏÎ½Ï„Î¿Ï‚ Ï€ÏÎ¹Î½ ÎµÏ€Î¹Ï„ÏÎ­ÏˆÎ¿Ï…Î½ Ï„Î·Î½ Ï€ÏÎ¿ÏÎ¸Î·ÏƒÎ· Ï„Î¿Ï… Î±Î¹Ï„Î®Î¼Î±Ï„Î¿Ï‚. ÎœÏ€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î®ÏƒÎµÏ„Îµ **Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¯ÎµÏ‚ AWS Lambda** Ï‰Ï‚ Ï€ÏÎ¿ÏƒÎ±ÏÎ¼Î¿ÏƒÎ¼Î­Î½Î¿Ï…Ï‚ ÎµÎ¾Î¿Ï…ÏƒÎ¹Î¿Î´Î¿Ï„Î·Ï„Î­Ï‚, Ï€Î¿Ï… ÏƒÎ±Ï‚ ÎµÏ€Î¹Ï„ÏÎ­Ï€ÎµÎ¹ Î½Î± ÎµÏ†Î±ÏÎ¼ÏŒÏƒÎµÏ„Îµ Ï„Î· Î´Î¹ÎºÎ® ÏƒÎ±Ï‚ Î»Î¿Î³Î¹ÎºÎ® Ï„Î±Ï…Ï„Î¿Ï€Î¿Î¯Î·ÏƒÎ·Ï‚ ÎºÎ±Î¹ ÎµÎ¾Î¿Ï…ÏƒÎ¹Î¿Î´ÏŒÏ„Î·ÏƒÎ·Ï‚. ÎŒÏ„Î±Î½ Î­ÏÏ‡ÎµÏ„Î±Î¹ Î­Î½Î± Î±Î¯Ï„Î·Î¼Î±, Ï„Î¿ API Gateway Ï€ÎµÏÎ½Î¬ Ï„Î¿ Î´Î¹Î±Ï€Î¹ÏƒÏ„ÎµÏ…Ï„Î®ÏÎ¹Î¿ ÎµÎ¾Î¿Ï…ÏƒÎ¹Î¿Î´ÏŒÏ„Î·ÏƒÎ·Ï‚ Ï„Î¿Ï… Î±Î¹Ï„Î®Î¼Î±Ï„Î¿Ï‚ ÏƒÏ„Î¿Î½ ÎµÎ¾Î¿Ï…ÏƒÎ¹Î¿Î´Î¿Ï„Î·Ï„Î® Lambda, Î¿ Î¿Ï€Î¿Î¯Î¿Ï‚ ÎµÏ€ÎµÎ¾ÎµÏÎ³Î¬Î¶ÎµÏ„Î±Î¹ Ï„Î¿ Î´Î¹Î±Ï€Î¹ÏƒÏ„ÎµÏ…Ï„Î®ÏÎ¹Î¿ ÎºÎ±Î¹ ÎµÏ€Î¹ÏƒÏ„ÏÎ­Ï†ÎµÎ¹ Î¼Î¹Î± Ï€Î¿Î»Î¹Ï„Î¹ÎºÎ® IAM Ï€Î¿Ï… ÎºÎ±Î¸Î¿ÏÎ¯Î¶ÎµÎ¹ Ï€Î¿Î¹ÎµÏ‚ ÎµÎ½Î­ÏÎ³ÎµÎ¹ÎµÏ‚ ÎµÏ€Î¹Ï„ÏÎ­Ï€ÎµÏ„Î±Î¹ Î½Î± ÎµÎºÏ„ÎµÎ»Î­ÏƒÎµÎ¹ Î¿ ÎºÎ±Î»ÏÎ½. Î¤Î¿ API Gateway Ï…Ï€Î¿ÏƒÏ„Î·ÏÎ¯Î¶ÎµÎ¹ ÎµÏ€Î¯ÏƒÎ·Ï‚ **ÎµÎ½ÏƒÏ‰Î¼Î±Ï„Ï‰Î¼Î­Î½Î¿Ï…Ï‚ ÎµÎ¾Î¿Ï…ÏƒÎ¹Î¿Î´Î¿Ï„Î·Ï„Î­Ï‚**, ÏŒÏ€Ï‰Ï‚ **AWS Identity and Access Management (IAM)** ÎºÎ±Î¹ **Amazon Cognito**.
4. **Î Î¿Î»Î¹Ï„Î¹ÎºÎ® Î ÏŒÏÎ¿Ï…**: ÎœÎ¹Î± Ï€Î¿Î»Î¹Ï„Î¹ÎºÎ® Ï€ÏŒÏÎ¿Ï… ÏƒÏ„Î¿ API Gateway ÎµÎ¯Î½Î±Î¹ Î­Î½Î± Î­Î³Î³ÏÎ±Ï†Î¿ JSON Ï€Î¿Ï… **ÎºÎ±Î¸Î¿ÏÎ¯Î¶ÎµÎ¹ Ï„Î¹Ï‚ Î¬Î´ÎµÎ¹ÎµÏ‚ Î³Î¹Î± Ï„Î·Î½ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ· ÏƒÏ„Î¿ API ÏƒÎ±Ï‚**. Î•Î¯Î½Î±Î¹ Ï€Î±ÏÏŒÎ¼Î¿Î¹Î± Î¼Îµ Î¼Î¹Î± Ï€Î¿Î»Î¹Ï„Î¹ÎºÎ® IAM Î±Î»Î»Î¬ ÎµÎ¹Î´Î¹ÎºÎ¬ Ï€ÏÎ¿ÏƒÎ±ÏÎ¼Î¿ÏƒÎ¼Î­Î½Î· Î³Î¹Î± Ï„Î¿ API Gateway. ÎœÏ€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î®ÏƒÎµÏ„Îµ Î¼Î¹Î± Ï€Î¿Î»Î¹Ï„Î¹ÎºÎ® Ï€ÏŒÏÎ¿Ï… Î³Î¹Î± Î½Î± ÎµÎ»Î­Î³Î¾ÎµÏ„Îµ Ï€Î¿Î¹Î¿Ï‚ Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Î­Ï‡ÎµÎ¹ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ· ÏƒÏ„Î¿ API ÏƒÎ±Ï‚, Ï€Î¿Î¹ÎµÏ‚ Î¼ÎµÎ¸ÏŒÎ´Î¿Ï…Ï‚ Î¼Ï€Î¿ÏÎ¿ÏÎ½ Î½Î± ÎºÎ±Î»Î­ÏƒÎ¿Ï…Î½ ÎºÎ±Î¹ Î±Ï€ÏŒ Ï€Î¿Î¹ÎµÏ‚ Î´Î¹ÎµÏ…Î¸ÏÎ½ÏƒÎµÎ¹Ï‚ IP Î® VPC Î¼Ï€Î¿ÏÎ¿ÏÎ½ Î½Î± ÏƒÏ…Î½Î´ÎµÎ¸Î¿ÏÎ½. **ÎŸÎ¹ Ï€Î¿Î»Î¹Ï„Î¹ÎºÎ­Ï‚ Ï€ÏŒÏÎ¿Ï… Î¼Ï€Î¿ÏÎ¿ÏÎ½ Î½Î± Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î·Î¸Î¿ÏÎ½ ÏƒÎµ ÏƒÏ…Î½Î´Ï…Î±ÏƒÎ¼ÏŒ Î¼Îµ ÎµÎ¾Î¿Ï…ÏƒÎ¹Î¿Î´Î¿Ï„Î·Ï„Î­Ï‚** Î³Î¹Î± Î½Î± Ï€Î±ÏÎ­Ï‡Î¿Ï…Î½ Î»ÎµÏ€Ï„Î¿Î¼ÎµÏÎ® Î­Î»ÎµÎ³Ï‡Î¿ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ·Ï‚ Î³Î¹Î± Ï„Î¿ API ÏƒÎ±Ï‚.
* Î“Î¹Î± Î½Î± Î­Ï‡ÎµÎ¹ Î±Ï€Î¿Ï„Î­Î»ÎµÏƒÎ¼Î±, Ï„Î¿ API Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± **Î±Î½Î±Ï€Ï„Ï…Ï‡Î¸ÎµÎ¯ Î¾Î±Î½Î¬ Î¼ÎµÏ„Î¬** Ï„Î·Î½ Ï„ÏÎ¿Ï€Î¿Ï€Î¿Î¯Î·ÏƒÎ· Ï„Î·Ï‚ Ï€Î¿Î»Î¹Ï„Î¹ÎºÎ®Ï‚ Ï€ÏŒÏÎ¿Ï….

### ÎšÎ±Ï„Î±Î³ÏÎ±Ï†Î®

Î‘Ï€ÏŒ Ï€ÏÎ¿ÎµÏ€Î¹Î»Î¿Î³Î®, **CloudWatch Logs** ÎµÎ¯Î½Î±Î¹ **Î±Ï€ÎµÎ½ÎµÏÎ³Î¿Ï€Î¿Î¹Î·Î¼Î­Î½Î±**, **Access Logging** ÎµÎ¯Î½Î±Î¹ **Î±Ï€ÎµÎ½ÎµÏÎ³Î¿Ï€Î¿Î¹Î·Î¼Î­Î½Î¿**, ÎºÎ±Î¹ **X-Ray tracing** ÎµÎ¯Î½Î±Î¹ ÎµÏ€Î¯ÏƒÎ·Ï‚ **Î±Ï€ÎµÎ½ÎµÏÎ³Î¿Ï€Î¿Î¹Î·Î¼Î­Î½Î¿**.

### Î‘ÏÎ¹Î¸Î¼Î·Ï„Î¹ÎºÎ®

{% hint style="success" %}
Î£Î·Î¼ÎµÎ¹ÏÏƒÏ„Îµ ÏŒÏ„Î¹ ÎºÎ±Î¹ ÏƒÏ„Î± Î´ÏÎ¿ AWS APIs Î³Î¹Î± Ï„Î·Î½ Î±ÏÎ¯Î¸Î¼Î·ÏƒÎ· Ï€ÏŒÏÏ‰Î½ (**`apigateway`** ÎºÎ±Î¹ **`apigatewayv2`**) Î· Î¼ÏŒÎ½Î· Î¬Î´ÎµÎ¹Î± Ï€Î¿Ï… Ï‡ÏÎµÎ¹Î¬Î¶ÎµÏƒÏ„Îµ ÎºÎ±Î¹ Î· Î¼ÏŒÎ½Î· Î¬Î´ÎµÎ¹Î± Î±Î½Î¬Î³Î½Ï‰ÏƒÎ·Ï‚ Ï€Î¿Ï… Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Ï€Î±ÏÎ±Ï‡Ï‰ÏÎ·Î¸ÎµÎ¯ ÎµÎ¯Î½Î±Î¹ **`apigateway:GET`**, Î¼Îµ Î±Ï…Ï„Î® Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± **Î±ÏÎ¹Î¸Î¼Î®ÏƒÎµÏ„Îµ Ï„Î± Ï€Î¬Î½Ï„Î±.**
{% endhint %}

{% tabs %}
{% tab title="apigateway" %}
```bash
# Generic info
aws apigateway get-account
aws apigateway get-domain-names
aws apigateway get-usage-plans
aws apigateway get-vpc-links
aws apigateway get-client-certificates

# Enumerate APIs
aws apigateway get-rest-apis # This will also show the resource policy (if any)
## Get stages
aws apigateway get-stages --rest-api-id <id>
## Get resources
aws apigateway get-resources --rest-api-id <id>
## Get API resource action per HTTP verb (check authorizers and api key required)
aws apigateway get-method --http-method GET --rest-api-id <api-id> --resource-id <resource-id>

## Call API
https://<api-id>.execute-api.<region>.amazonaws.com/<stage>/<resource>
## API authorizers
aws apigateway get-authorizers --rest-api-id <id>
## Models
aws apigateway get-models --rest-api-id <id>
## More info
aws apigateway get-gateway-responses --rest-api-id <id>
aws apigateway get-request-validators --rest-api-id <id>
aws apigateway get-deployments --rest-api-id <id>

# Get api keys generated
aws apigateway get-api-keys --include-value
aws apigateway get-api-key --api-key <id> --include-value # Get just 1
## Example use API key
curl -X GET -H "x-api-key: AJE&Ygenu4[..]" https://e83uuftdi8.execute-api.us-east-1.amazonaws.com/dev/test
## Usage plans
aws apigateway get-usage-plans #Get limit use info
aws apigateway get-usage-plan-keys --usage-plan-id <plan_id> #Get clear text values of api keys
aws apigateway get-usage-plan-key --usage-plan-id <plan_id> --key-id <key_id>
###Already consumed
aws apigateway get-usage --usage-plan-id <plan_id> --start-date 2023-07-01 --end-date 2023-07-12
```
{% endtab %}

{% tab title="apigatewayv2" %}
```bash
# Generic info
aws apigatewayv2 get-domain-names
aws apigatewayv2 get-domain-name --domain-name <name>
aws apigatewayv2 get-vpc-links

# Enumerate APIs
aws apigatewayv2 get-apis # This will also show the resource policy (if any)
aws apigatewayv2 get-api --api-id <id>

## Get all the info from an api at once
aws apigatewayv2 export-api --api-id <id> --output-type YAML --specification OAS30 /tmp/api.yaml

## Get stages
aws apigatewayv2 get-stages --api-id <id>

## Get routes
aws apigatewayv2 get-routes --api-id <id>
aws apigatewayv2 get-route --api-id <id> --route-id <route-id>

## Get deployments
aws apigatewayv2 get-deployments --api-id <id>
aws apigatewayv2 get-deployment --api-id <id> --deployment-id <dep-id>

## Get integrations
aws apigatewayv2 get-integrations --api-id <id>

## Get authorizers
aws apigatewayv2 get-authorizers --api-id <id>
aws apigatewayv2 get-authorizer --api-id <id> --authorizer-id <uth-id>

## Get domain mappings
aws apigatewayv2 get-api-mappings --api-id <id> --domain-name <dom-name>
aws apigatewayv2 get-api-mapping --api-id <id> --api-mapping-id <map-id> --domain-name <dom-name>

## Get models
aws apigatewayv2 get-models --api-id <id>

## Call API
https://<api-id>.execute-api.<region>.amazonaws.com/<stage>/<resource>
```
{% endtab %}
{% endtabs %}

## Î”Î¹Î¬Ï†Î¿ÏÎµÏ‚ Î•Î¾Î¿Ï…ÏƒÎ¹Î¿Î´Î¿Ï„Î®ÏƒÎµÎ¹Ï‚ Î³Î¹Î± Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ· ÏƒÎµ ÏƒÎ·Î¼ÎµÎ¯Î± Ï„Î­Î»Î¿Ï…Ï‚ API Gateway

### Î Î¿Î»Î¹Ï„Î¹ÎºÎ® Î ÏŒÏÎ¿Ï…

Î•Î¯Î½Î±Î¹ Î´Ï…Î½Î±Ï„ÏŒÎ½ Î½Î± Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î·Î¸Î¿ÏÎ½ Ï€Î¿Î»Î¹Ï„Î¹ÎºÎ­Ï‚ Ï€ÏŒÏÎ¿Ï… Î³Î¹Î± Î½Î± ÎºÎ±Î¸Î¿ÏÎ¹ÏƒÏ„ÎµÎ¯ Ï€Î¿Î¹Î¿Ï‚ Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± ÎºÎ±Î»Î­ÏƒÎµÎ¹ Ï„Î± ÏƒÎ·Î¼ÎµÎ¯Î± Ï„Î­Î»Î¿Ï…Ï‚ API.\
Î£Ï„Î¿ Ï€Î±ÏÎ±ÎºÎ¬Ï„Ï‰ Ï€Î±ÏÎ¬Î´ÎµÎ¹Î³Î¼Î± Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Î´ÎµÎ¯Ï„Îµ ÏŒÏ„Î¹ Î· **Ï…Ï€Î¿Î´ÎµÎ¹ÎºÎ½Ï…ÏŒÎ¼ÎµÎ½Î· IP Î´ÎµÎ½ Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± ÎºÎ±Î»Î­ÏƒÎµÎ¹** Ï„Î¿ ÏƒÎ·Î¼ÎµÎ¯Î¿ Ï„Î­Î»Î¿Ï…Ï‚ `/resource_policy` Î¼Î­ÏƒÏ‰ GET.

<figure><img src="../../../.gitbook/assets/image (256).png" alt=""><figcaption></figcaption></figure>

### Î•Î¾Î¿Ï…ÏƒÎ¹Î¿Î´ÏŒÏ„Î·Ï‚ IAM

Î•Î¯Î½Î±Î¹ Î´Ï…Î½Î±Ï„ÏŒÎ½ Î½Î± Î¿ÏÎ¹ÏƒÏ„ÎµÎ¯ ÏŒÏ„Î¹ Î¼Î¹Î± Î¼Î­Î¸Î¿Î´Î¿Ï‚ Î¼Î­ÏƒÎ± ÏƒÎµ Î¼Î¹Î± Î´Î¹Î±Î´ÏÎ¿Î¼Î® (Ï€ÏŒÏÎ¿Ï‚) Î±Ï€Î±Î¹Ï„ÎµÎ¯ Î±Ï…Î¸ÎµÎ½Ï„Î¹ÎºÎ¿Ï€Î¿Î¯Î·ÏƒÎ· IAM Î³Î¹Î± Î½Î± Ï„Î·Î½ ÎºÎ±Î»Î­ÏƒÎµÎ¹.

<figure><img src="https://lh3.googleusercontent.com/GGx-kfqNXu6zMqGidnO8_eR88fYPpJG-wNuBBnedAJntiRUEPTEScl7OvWthGYRiI_msYCdC6oBFvJc827Tb4-4UogxpOyrEXyst-8IDzP9DC2NOtXSY7w58L0baCAcBQjSyvBhJREvWWCtiboNYPSKuEw=s2048" alt=""><figcaption></figcaption></figure>

ÎŒÏ„Î±Î½ Î±Ï…Ï„ÏŒ Î­Ï‡ÎµÎ¹ Î¿ÏÎ¹ÏƒÏ„ÎµÎ¯, Î¸Î± Î»Î¬Î²ÎµÏ„Îµ Ï„Î¿ ÏƒÏ†Î¬Î»Î¼Î± `{"message":"Missing Authentication Token"}` ÏŒÏ„Î±Î½ Ï€ÏÎ¿ÏƒÏ€Î±Î¸Î®ÏƒÎµÏ„Îµ Î½Î± Ï€ÏÎ¿ÏƒÎµÎ³Î³Î¯ÏƒÎµÏ„Îµ Ï„Î¿ ÏƒÎ·Î¼ÎµÎ¯Î¿ Ï„Î­Î»Î¿Ï…Ï‚ Ï‡Ï‰ÏÎ¯Ï‚ ÎºÎ±Î¼Î¯Î± ÎµÎ¾Î¿Ï…ÏƒÎ¹Î¿Î´ÏŒÏ„Î·ÏƒÎ·.

ÎˆÎ½Î±Ï‚ ÎµÏÎºÎ¿Î»Î¿Ï‚ Ï„ÏÏŒÏ€Î¿Ï‚ Î³Î¹Î± Î½Î± Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î®ÏƒÎµÏ„Îµ Ï„Î¿ Î±Î½Î±Î¼ÎµÎ½ÏŒÎ¼ÎµÎ½Î¿ Î´Î¹Î±ÎºÏÎ¹Ï„Î¹ÎºÏŒ Î±Ï€ÏŒ Ï„Î·Î½ ÎµÏ†Î±ÏÎ¼Î¿Î³Î® ÎµÎ¯Î½Î±Î¹ Î½Î± Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î®ÏƒÎµÏ„Îµ **curl**.
```bash
$ curl -X <method> https://<api-id>.execute-api.<region>.amazonaws.com/<stage>/<resource> --user <AWS_ACCESS_KEY>:<AWS_SECRET_KEY> --aws-sigv4 "aws:amz:<region>:execute-api"
```
ÎˆÎ½Î±Ï‚ Î¬Î»Î»Î¿Ï‚ Ï„ÏÏŒÏ€Î¿Ï‚ ÎµÎ¯Î½Î±Î¹ Î½Î± Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î®ÏƒÎµÏ„Îµ Ï„Î¿Î½ Ï„ÏÏ€Î¿ **`Authorization`** **`AWS Signature`** Î¼Î­ÏƒÎ± ÏƒÏ„Î¿ **Postman**.

<figure><img src="../../../.gitbook/assets/image (168).png" alt=""><figcaption></figcaption></figure>

Î¡Ï…Î¸Î¼Î¯ÏƒÏ„Îµ Ï„Î¿ accessKey ÎºÎ±Î¹ Ï„Î¿ SecretKey Ï„Î¿Ï… Î»Î¿Î³Î±ÏÎ¹Î±ÏƒÎ¼Î¿Ï Ï€Î¿Ï… Î¸Î­Î»ÎµÏ„Îµ Î½Î± Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î®ÏƒÎµÏ„Îµ ÎºÎ±Î¹ Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Î³Î½Ï‰ÏÎ¯Î¶ÎµÏ„Îµ Ï„Î·Î½ Î±Ï…Î¸ÎµÎ½Ï„Î¹ÎºÎ¿Ï€Î¿Î¯Î·ÏƒÎ· ÎºÎ±Ï„Î¬ Ï„Î·Ï‚ API endpoint.

ÎšÎ±Î¹ Î¿Î¹ Î´ÏÎ¿ Î¼Î­Î¸Î¿Î´Î¿Î¹ Î¸Î± Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î®ÏƒÎ¿Ï…Î½ Î­Î½Î± **Authorization** **header** ÏŒÏ€Ï‰Ï‚:
```
AWS4-HMAC-SHA256 Credential=AKIAYY7XU6ECUDOTWB7W/20220726/us-east-1/execute-api/aws4_request, SignedHeaders=host;x-amz-date, Signature=9f35579fa85c0d089c5a939e3d711362e92641e8c14cc571df8c71b4bc62a5c2
```
Î£Î·Î¼ÎµÎ¹ÏÏƒÏ„Îµ ÏŒÏ„Î¹ ÏƒÎµ Î¬Î»Î»ÎµÏ‚ Ï€ÎµÏÎ¹Ï€Ï„ÏÏƒÎµÎ¹Ï‚ Î¿ **Authorizer** Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Î­Ï‡ÎµÎ¹ **ÎºÎ±ÎºÏÏ‚ ÎºÏ‰Î´Î¹ÎºÎ¿Ï€Î¿Î¹Î·Î¸ÎµÎ¯** ÎºÎ±Î¹ Î±Ï€Î»Î¬ Î· Î±Ï€Î¿ÏƒÏ„Î¿Î»Î® **Î¿Ï„Î¹Î´Î®Ï€Î¿Ï„Îµ** Î¼Î­ÏƒÎ± ÏƒÏ„Î·Î½ **Authorization header** Î¸Î± **ÎµÏ€Î¹Ï„ÏÎ­ÏˆÎµÎ¹ Î½Î± Î´ÎµÎ¯Ï„Îµ Ï„Î¿ ÎºÏÏ…Ï†ÏŒ Ï€ÎµÏÎ¹ÎµÏ‡ÏŒÎ¼ÎµÎ½Î¿**.

### Request Signing Using Python
```python

pip install requests
pip install requests-aws4auth
pip install boto3

import boto3
import requests
from requests_aws4auth import AWS4Auth

region = 'us-east-1'  # Region
service = 'execute-api'
access_key = 'YOUR_ACCESS_KEY'
secret_key = 'YOUR_SECRET_KEY'

url = 'https://<apiid>.execute-api.us-east-1.amazonaws.com/<stage>/<resource>'

session = boto3.Session(aws_access_key_id=access_key, aws_secret_access_key=secret_key)
credentials = session.get_credentials()
awsauth = AWS4Auth(credentials.access_key, credentials.secret_key, region, service, session_token=credentials.token)

response = requests.get(url, auth=awsauth)

print(response.text)

```
### Custom Lambda Authorizer

Î•Î¯Î½Î±Î¹ Î´Ï…Î½Î±Ï„ÏŒÎ½ Î½Î± Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î®ÏƒÎµÏ„Îµ Î¼Î¹Î± lambda Ï€Î¿Ï… Î²Î±ÏƒÎ¯Î¶ÎµÏ„Î±Î¹ ÏƒÎµ Î­Î½Î± Î´ÎµÎ´Î¿Î¼Î­Î½Î¿ token Î³Î¹Î± Î½Î± **ÎµÏ€Î¹ÏƒÏ„ÏÎ­ÏˆÎµÎ¹ Î¼Î¹Î± Ï€Î¿Î»Î¹Ï„Î¹ÎºÎ® IAM** Ï€Î¿Ï… Ï…Ï€Î¿Î´ÎµÎ¹ÎºÎ½ÏÎµÎ¹ Î±Î½ Î¿ Ï‡ÏÎ®ÏƒÏ„Î·Ï‚ ÎµÎ¯Î½Î±Î¹ **ÎµÎ¾Î¿Ï…ÏƒÎ¹Î¿Î´Î¿Ï„Î·Î¼Î­Î½Î¿Ï‚ Î½Î± ÎºÎ±Î»Î­ÏƒÎµÎ¹ Ï„Î¿ API endpoint**.\
ÎœÏ€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Î¿ÏÎ¯ÏƒÎµÏ„Îµ ÎºÎ¬Î¸Îµ Î¼Î­Î¸Î¿Î´Î¿ Ï€ÏŒÏÎ¿Ï… Ï€Î¿Ï… Î¸Î± Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÎµÎ¯ Ï„Î¿Î½ ÎµÎ¾Î¿Ï…ÏƒÎ¹Î¿Î´Î¿Ï„Î·Ï„Î®.

<details>

<summary>Î Î±ÏÎ¬Î´ÎµÎ¹Î³Î¼Î± ÎšÏÎ´Î¹ÎºÎ± Lambda Authorizer</summary>
```python
import json

def lambda_handler(event, context):
token = event['authorizationToken']
method_arn = event['methodArn']

if not token:
return {
'statusCode': 401,
'body': 'Unauthorized'
}

try:
# Replace this with your own token validation logic
if token == "your-secret-token":
return generate_policy('user', 'Allow', method_arn)
else:
return generate_policy('user', 'Deny', method_arn)
except Exception as e:
print(e)
return {
'statusCode': 500,
'body': 'Internal Server Error'
}

def generate_policy(principal_id, effect, resource):
policy = {
'principalId': principal_id,
'policyDocument': {
'Version': '2012-10-17',
'Statement': [
{
'Action': 'execute-api:Invoke',
'Effect': effect,
'Resource': resource
}
]
}
}
return policy
```
</details>

ÎšÎ±Î»Î­ÏƒÏ„Îµ Ï„Î¿ Î¼Îµ ÎºÎ¬Ï„Î¹ ÏƒÎ±Î½:

<pre class="language-bash" data-overflow="wrap"><code class="lang-bash"><strong>curl "https://jhhqafgh6f.execute-api.eu-west-1.amazonaws.com/prod/custom_auth" -H 'Authorization: your-secret-token'
</strong></code></pre>

{% hint style="warning" %}
Î‘Î½Î¬Î»Î¿Î³Î± Î¼Îµ Ï„Î¿Î½ ÎºÏÎ´Î¹ÎºÎ± Lambda, Î±Ï…Ï„Î® Î· ÎµÎ¾Î¿Ï…ÏƒÎ¹Î¿Î´ÏŒÏ„Î·ÏƒÎ· Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± ÎµÎ¯Î½Î±Î¹ ÎµÏ…Î¬Î»Ï‰Ï„Î·
{% endhint %}

Î£Î·Î¼ÎµÎ¹ÏÏƒÏ„Îµ ÏŒÏ„Î¹ Î±Î½ **Ï€Î±ÏÎ±Ï‡Î¸ÎµÎ¯ ÎºÎ±Î¹ ÎµÏ€Î¹ÏƒÏ„ÏÎ±Ï†ÎµÎ¯ Î¼Î¹Î± Ï€Î¿Î»Î¹Ï„Î¹ÎºÎ® Î¬ÏÎ½Î·ÏƒÎ·Ï‚**, Ï„Î¿ ÏƒÏ†Î¬Î»Î¼Î± Ï€Î¿Ï… ÎµÏ€Î¹ÏƒÏ„ÏÎ­Ï†ÎµÎ¹ Ï„Î¿ API Gateway ÎµÎ¯Î½Î±Î¹: `{"Message":"User is not authorized to access this resource with an explicit deny"}`

ÎœÎµ Î±Ï…Ï„ÏŒÎ½ Ï„Î¿Î½ Ï„ÏÏŒÏ€Î¿ Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± **ÎµÎ½Ï„Î¿Ï€Î¯ÏƒÎµÏ„Îµ Î±Ï…Ï„Î® Ï„Î·Î½ ÎµÎ¾Î¿Ï…ÏƒÎ¹Î¿Î´ÏŒÏ„Î·ÏƒÎ·** Ï€Î¿Ï… ÎµÎ¯Î½Î±Î¹ ÏƒÎµ Î¹ÏƒÏ‡Ï.

### Î‘Ï€Î±Î¹Ï„Î¿ÏÎ¼ÎµÎ½Î¿ API Key

Î•Î¯Î½Î±Î¹ Î´Ï…Î½Î±Ï„ÏŒÎ½ Î½Î± Î¿ÏÎ¯ÏƒÎµÏ„Îµ API endpoints Ï€Î¿Ï… **Î±Ï€Î±Î¹Ï„Î¿ÏÎ½ Î­Î½Î± Î­Î³ÎºÏ…ÏÎ¿ API key** Î³Î¹Î± Î½Î± ÎµÏ€Î¹ÎºÎ¿Î¹Î½Ï‰Î½Î®ÏƒÎ¿Ï…Î½.

<figure><img src="../../../.gitbook/assets/image (88).png" alt=""><figcaption></figcaption></figure>

Î•Î¯Î½Î±Î¹ Î´Ï…Î½Î±Ï„ÏŒÎ½ Î½Î± Ï€Î±ÏÎ±Ï‡Î¸Î¿ÏÎ½ API keys ÏƒÏ„Î·Î½ Ï€ÏÎ»Î· API Gateway ÎºÎ±Î¹ Î±ÎºÏŒÎ¼Î· ÎºÎ±Î¹ Î½Î± Î¿ÏÎ¹ÏƒÏ„ÎµÎ¯ Ï€ÏŒÏƒÎ¿ Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î·Î¸ÎµÎ¯ (ÏƒÎµ ÏŒÏÎ¿Ï…Ï‚ Î±Î¹Ï„Î·Î¼Î¬Ï„Ï‰Î½ Î±Î½Î¬ Î´ÎµÏ…Ï„ÎµÏÏŒÎ»ÎµÏ€Ï„Î¿ ÎºÎ±Î¹ ÏƒÎµ ÏŒÏÎ¿Ï…Ï‚ Î±Î¹Ï„Î·Î¼Î¬Ï„Ï‰Î½ Î±Î½Î¬ Î¼Î®Î½Î±).

Î“Î¹Î± Î½Î± Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î®ÏƒÎµÎ¹ Î­Î½Î± API key, Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± Ï„Î¿ Ï€ÏÎ¿ÏƒÎ¸Î­ÏƒÎµÏ„Îµ ÏƒÎµ Î­Î½Î± **Usage Plan**, Î±Ï…Ï„ÏŒ Ï„Î¿ ÏƒÏ‡Î­Î´Î¹Î¿ Ï‡ÏÎ®ÏƒÎ·Ï‚ Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± Ï€ÏÎ¿ÏƒÏ„ÎµÎ¸ÎµÎ¯ ÏƒÏ„Î¿ **API Stage** ÎºÎ±Î¹ Î· ÏƒÏ‡ÎµÏ„Î¹ÎºÎ® Ï†Î¬ÏƒÎ· API Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± Î­Ï‡ÎµÎ¹ ÏÏ…Î¸Î¼Î¹ÏƒÎ¼Î­Î½Î¿ **method throttling** ÏƒÏ„Î¿ **endpoint** Ï€Î¿Ï… Î±Ï€Î±Î¹Ï„ÎµÎ¯ Ï„Î¿ API key:

<figure><img src="../../../.gitbook/assets/image (198).png" alt=""><figcaption></figcaption></figure>

## ÎœÎ· Î‘Ï…Î¸ÎµÎ½Ï„Î¹ÎºÎ® Î ÏÏŒÏƒÎ²Î±ÏƒÎ·

{% content-ref url="../aws-unauthenticated-enum-access/aws-api-gateway-unauthenticated-enum.md" %}
[aws-api-gateway-unauthenticated-enum.md](../aws-unauthenticated-enum-access/aws-api-gateway-unauthenticated-enum.md)
{% endcontent-ref %}

## Privesc

{% content-ref url="../aws-privilege-escalation/aws-apigateway-privesc.md" %}
[aws-apigateway-privesc.md](../aws-privilege-escalation/aws-apigateway-privesc.md)
{% endcontent-ref %}

## ÎœÎµÏ„Î¬ Ï„Î·Î½ Î•ÎºÎ¼ÎµÏ„Î¬Î»Î»ÎµÏ…ÏƒÎ·

{% content-ref url="../aws-post-exploitation/aws-api-gateway-post-exploitation.md" %}
[aws-api-gateway-post-exploitation.md](../aws-post-exploitation/aws-api-gateway-post-exploitation.md)
{% endcontent-ref %}

## Î•Ï€Î¹Î¼Î¿Î½Î®

{% content-ref url="../aws-persistence/aws-api-gateway-persistence.md" %}
[aws-api-gateway-persistence.md](../aws-persistence/aws-api-gateway-persistence.md)
{% endcontent-ref %}

{% hint style="success" %}
ÎœÎ¬Î¸ÎµÏ„Îµ & ÎµÎ¾Î±ÏƒÎºÎ·Î¸ÎµÎ¯Ï„Îµ ÏƒÏ„Î¿ AWS Hacking:<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
ÎœÎ¬Î¸ÎµÏ„Îµ & ÎµÎ¾Î±ÏƒÎºÎ·Î¸ÎµÎ¯Ï„Îµ ÏƒÏ„Î¿ GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Î¥Ï€Î¿ÏƒÏ„Î®ÏÎ¹Î¾Î· HackTricks</summary>

* Î•Î»Î­Î³Î¾Ï„Îµ Ï„Î± [**ÏƒÏ‡Î­Î´Î¹Î± ÏƒÏ…Î½Î´ÏÎ¿Î¼Î®Ï‚**](https://github.com/sponsors/carlospolop)!
* **Î•Î³Î³ÏÎ±Ï†ÎµÎ¯Ï„Îµ ÏƒÏ„Î·Î½** ğŸ’¬ [**Î¿Î¼Î¬Î´Î± Discord**](https://discord.gg/hRep4RUj7f) Î® ÏƒÏ„Î·Î½ [**Î¿Î¼Î¬Î´Î± telegram**](https://t.me/peass) Î® **Î±ÎºÎ¿Î»Î¿Ï…Î¸Î®ÏƒÏ„Îµ** Î¼Î±Ï‚ ÏƒÏ„Î¿ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **ÎœÎ¿Î¹ÏÎ±ÏƒÏ„ÎµÎ¯Ï„Îµ ÎºÏŒÎ»Ï€Î± hacking Ï…Ï€Î¿Î²Î¬Î»Î»Î¿Î½Ï„Î±Ï‚ PRs ÏƒÏ„Î±** [**HackTricks**](https://github.com/carlospolop/hacktricks) ÎºÎ±Î¹ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
