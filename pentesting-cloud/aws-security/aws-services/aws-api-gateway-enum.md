# AWS - API Gateway Enum

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## API Gateway

### Basic Information

AWS API GatewayëŠ” ê°œë°œìê°€ **ëŒ€ê·œëª¨ë¡œ APIë¥¼ ìƒì„±, ê²Œì‹œ ë° ê´€ë¦¬**í•  ìˆ˜ ìˆë„ë¡ ì„¤ê³„ëœ Amazon Web Services (AWS)ì—ì„œ ì œê³µí•˜ëŠ” í¬ê´„ì ì¸ ì„œë¹„ìŠ¤ì…ë‹ˆë‹¤. ì´ëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ì§„ì…ì ìœ¼ë¡œ ì‘ìš©í•˜ë©°, ê°œë°œìê°€ ê·œì¹™ ë° ì ˆì°¨ì˜ í”„ë ˆì„ì›Œí¬ë¥¼ ì„¤ì •í•  ìˆ˜ ìˆë„ë¡ í—ˆìš©í•©ë‹ˆë‹¤. ì´ í”„ë ˆì„ì›Œí¬ëŠ” ì™¸ë¶€ ì‚¬ìš©ìê°€ ì• í”Œë¦¬ì¼€ì´ì…˜ ë‚´ì˜ íŠ¹ì • ë°ì´í„° ë˜ëŠ” ê¸°ëŠ¥ì— ì ‘ê·¼í•˜ëŠ” ë°©ì‹ì„ ê´€ë¦¬í•©ë‹ˆë‹¤.

API GatewayëŠ” **APIì— ëŒ€í•œ ìš”ì²­ì„ ì²˜ë¦¬í•˜ëŠ” ë°©ë²•ì„ ì •ì˜**í•  ìˆ˜ ìˆìœ¼ë©°, íŠ¹ì • ë©”ì„œë“œ(ì˜ˆ: GET, POST, PUT, DELETE) ë° ë¦¬ì†ŒìŠ¤ë¥¼ ê°€ì§„ ì‚¬ìš©ì ì§€ì • API ì—”ë“œí¬ì¸íŠ¸ë¥¼ ìƒì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë˜í•œ ê°œë°œìê°€ ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ APIë¥¼ í˜¸ì¶œí•˜ê¸° ì‰½ê²Œ í•˜ê¸° ìœ„í•´ í´ë¼ì´ì–¸íŠ¸ SDK(ì†Œí”„íŠ¸ì›¨ì–´ ê°œë°œ í‚¤íŠ¸)ë¥¼ ìƒì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### API Gateways Types

* **HTTP API**: OIDC ë° OAuth2ì™€ ê°™ì€ ë‚´ì¥ ê¸°ëŠ¥ê³¼ ê¸°ë³¸ CORS ì§€ì›ì„ ê°–ì¶˜ ì €ì§€ì—° ë° ë¹„ìš© íš¨ìœ¨ì ì¸ REST APIë¥¼ êµ¬ì¶•í•©ë‹ˆë‹¤. ë‹¤ìŒê³¼ í•¨ê»˜ ì‘ë™í•©ë‹ˆë‹¤: Lambda, HTTP ë°±ì—”ë“œ.
* **WebSocket API**: ì±„íŒ… ì• í”Œë¦¬ì¼€ì´ì…˜ì´ë‚˜ ëŒ€ì‹œë³´ë“œì™€ ê°™ì€ ì‹¤ì‹œê°„ ì‚¬ìš© ì‚¬ë¡€ë¥¼ ìœ„í•´ ì§€ì†ì ì¸ ì—°ê²°ì„ ì‚¬ìš©í•˜ëŠ” WebSocket APIë¥¼ êµ¬ì¶•í•©ë‹ˆë‹¤. ë‹¤ìŒê³¼ í•¨ê»˜ ì‘ë™í•©ë‹ˆë‹¤: Lambda, HTTP, AWS ì„œë¹„ìŠ¤.
* **REST API**: ìš”ì²­ ë° ì‘ë‹µì— ëŒ€í•œ ì™„ì „í•œ ì œì–´ì™€ API ê´€ë¦¬ ê¸°ëŠ¥ì„ ê°–ì¶˜ REST APIë¥¼ ê°œë°œí•©ë‹ˆë‹¤. ë‹¤ìŒê³¼ í•¨ê»˜ ì‘ë™í•©ë‹ˆë‹¤: Lambda, HTTP, AWS ì„œë¹„ìŠ¤.
* **REST API Private**: VPC ë‚´ì—ì„œë§Œ ì ‘ê·¼í•  ìˆ˜ ìˆëŠ” REST APIë¥¼ ìƒì„±í•©ë‹ˆë‹¤.

### API Gateway Main Components

1. **Resources**: API Gatewayì—ì„œ ë¦¬ì†ŒìŠ¤ëŠ” **APIì˜ êµ¬ì¡°ë¥¼ êµ¬ì„±í•˜ëŠ” ìš”ì†Œ**ì…ë‹ˆë‹¤. ì´ë“¤ì€ **APIì˜ ë‹¤ì–‘í•œ ê²½ë¡œ ë˜ëŠ” ì—”ë“œí¬ì¸íŠ¸**ë¥¼ ë‚˜íƒ€ë‚´ë©°, APIê°€ ì§€ì›í•˜ëŠ” ë‹¤ì–‘í•œ ì‘ì—…ì— í•´ë‹¹í•©ë‹ˆë‹¤. ë¦¬ì†ŒìŠ¤ëŠ” ê° ê²½ë¡œ(/, ë˜ëŠ” /users, ë˜ëŠ” /user/{id}) **ë‚´ì˜ ê° ë©”ì„œë“œ**(ì˜ˆ: GET, POST, PUT, DELETE)ì…ë‹ˆë‹¤.
2. **Stages**: API Gatewayì˜ ìŠ¤í…Œì´ì§€ëŠ” ê°œë°œ, ìŠ¤í…Œì´ì§• ë˜ëŠ” í”„ë¡œë•ì…˜ê³¼ ê°™ì€ **APIì˜ ë‹¤ì–‘í•œ ë²„ì „ ë˜ëŠ” í™˜ê²½**ì„ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤. ìŠ¤í…Œì´ì§€ë¥¼ ì‚¬ìš©í•˜ì—¬ **APIì˜ ì—¬ëŸ¬ ë²„ì „ì„ ë™ì‹œì— ê´€ë¦¬ ë° ë°°í¬**í•  ìˆ˜ ìˆìœ¼ë©°, í”„ë¡œë•ì…˜ í™˜ê²½ì— ì˜í–¥ì„ ì£¼ì§€ ì•Šê³  ìƒˆë¡œìš´ ê¸°ëŠ¥ì´ë‚˜ ë²„ê·¸ ìˆ˜ì •ì„ í…ŒìŠ¤íŠ¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ìŠ¤í…Œì´ì§€ëŠ” ë˜í•œ í˜„ì¬ ìŠ¤í…Œì´ì§€ì— ë”°ë¼ APIì˜ ë™ì‘ì„ êµ¬ì„±í•˜ëŠ” ë° ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” í‚¤-ê°’ ìŒì¸ **ìŠ¤í…Œì´ì§€ ë³€ìˆ˜ë¥¼ ì§€ì›**í•©ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´, ìŠ¤í…Œì´ì§€ ë³€ìˆ˜ë¥¼ ì‚¬ìš©í•˜ì—¬ ìŠ¤í…Œì´ì§€ì— ë”°ë¼ API ìš”ì²­ì„ ë‹¤ë¥¸ Lambda í•¨ìˆ˜ë‚˜ ê¸°íƒ€ ë°±ì—”ë“œ ì„œë¹„ìŠ¤ë¡œ ìœ ë„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
* ìŠ¤í…Œì´ì§€ëŠ” API Gateway ì—”ë“œí¬ì¸íŠ¸ì˜ URL ì‹œì‘ ë¶€ë¶„ì— í‘œì‹œë©ë‹ˆë‹¤.
3. **Authorizers**: API Gatewayì˜ ì¸ì¦ìëŠ” ìš”ì²­ì´ ì§„í–‰ë˜ê¸° ì „ì— í˜¸ì¶œìì˜ ì‹ ì›ì„ í™•ì¸í•˜ì—¬ **APIì— ëŒ€í•œ ì ‘ê·¼ì„ ì œì–´**í•˜ëŠ” ì—­í• ì„ í•©ë‹ˆë‹¤. **AWS Lambda í•¨ìˆ˜**ë¥¼ ì‚¬ìš©ì ì§€ì • ì¸ì¦ìë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆìœ¼ë©°, ì´ë¥¼ í†µí•´ ìì²´ ì¸ì¦ ë° ê¶Œí•œ ë¶€ì—¬ ë…¼ë¦¬ë¥¼ êµ¬í˜„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ìš”ì²­ì´ ë“¤ì–´ì˜¤ë©´ API GatewayëŠ” ìš”ì²­ì˜ ì¸ì¦ í† í°ì„ Lambda ì¸ì¦ìì—ê²Œ ì „ë‹¬í•˜ê³ , ì¸ì¦ìëŠ” í† í°ì„ ì²˜ë¦¬í•˜ì—¬ í˜¸ì¶œìê°€ ìˆ˜í–‰í•  ìˆ˜ ìˆëŠ” ì‘ì—…ì„ ê²°ì •í•˜ëŠ” IAM ì •ì±…ì„ ë°˜í™˜í•©ë‹ˆë‹¤. API GatewayëŠ” ë˜í•œ **AWS Identity and Access Management (IAM)** ë° **Amazon Cognito**ì™€ ê°™ì€ **ë‚´ì¥ ì¸ì¦ì**ë¥¼ ì§€ì›í•©ë‹ˆë‹¤.
4. **Resource Policy**: API Gatewayì˜ ë¦¬ì†ŒìŠ¤ ì •ì±…ì€ **APIì— ëŒ€í•œ ì ‘ê·¼ ê¶Œí•œì„ ì •ì˜í•˜ëŠ” JSON ë¬¸ì„œ**ì…ë‹ˆë‹¤. ì´ëŠ” IAM ì •ì±…ê³¼ ìœ ì‚¬í•˜ì§€ë§Œ API Gatewayì— ë§ê²Œ íŠ¹ë³„íˆ ì¡°ì •ë©ë‹ˆë‹¤. ë¦¬ì†ŒìŠ¤ ì •ì±…ì„ ì‚¬ìš©í•˜ì—¬ APIì— ì ‘ê·¼í•  ìˆ˜ ìˆëŠ” ì‚¬ëŒ, í˜¸ì¶œí•  ìˆ˜ ìˆëŠ” ë©”ì„œë“œ, ì—°ê²°í•  ìˆ˜ ìˆëŠ” IP ì£¼ì†Œ ë˜ëŠ” VPCë¥¼ ì œì–´í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. **ë¦¬ì†ŒìŠ¤ ì •ì±…ì€ ì¸ì¦ìì™€ í•¨ê»˜ ì‚¬ìš©í•˜ì—¬ APIì— ëŒ€í•œ ì„¸ë°€í•œ ì ‘ê·¼ ì œì–´ë¥¼ ì œê³µí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.**
* ë¦¬ì†ŒìŠ¤ ì •ì±…ì´ ìˆ˜ì •ëœ í›„ APIëŠ” **ë‹¤ì‹œ ë°°í¬ë˜ì–´ì•¼** íš¨ê³¼ê°€ ë°œìƒí•©ë‹ˆë‹¤.

### Logging

ê¸°ë³¸ì ìœ¼ë¡œ **CloudWatch Logs**ëŠ” **êº¼ì ¸ ìˆìœ¼ë©°**, **Access Logging**ì€ **êº¼ì ¸ ìˆìœ¼ë©°**, **X-Ray tracing**ë„ **êº¼ì ¸ ìˆìŠµë‹ˆë‹¤.**

### Enumeration

{% hint style="success" %}
AWS APIì—ì„œ ë¦¬ì†ŒìŠ¤ë¥¼ ì—´ê±°í•˜ê¸° ìœ„í•´ í•„ìš”í•œ ìœ ì¼í•œ ê¶Œí•œì´ì ìœ ì¼í•œ ì½ê¸° ê¶Œí•œ ë¶€ì—¬ëŠ” **`apigateway:GET`**ì…ë‹ˆë‹¤. ì´ë¥¼ í†µí•´ **ëª¨ë“  ê²ƒì„ ì—´ê±°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.**
{% endhint %}

{% tabs %}
{% tab title="apigateway" %}
```bash
# Generic info
aws apigateway get-account
aws apigateway get-domain-names
aws apigateway get-usage-plans
aws apigateway get-vpc-links
aws apigateway get-client-certificates

# Enumerate APIs
aws apigateway get-rest-apis # This will also show the resource policy (if any)
## Get stages
aws apigateway get-stages --rest-api-id <id>
## Get resources
aws apigateway get-resources --rest-api-id <id>
## Get API resource action per HTTP verb (check authorizers and api key required)
aws apigateway get-method --http-method GET --rest-api-id <api-id> --resource-id <resource-id>

## Call API
https://<api-id>.execute-api.<region>.amazonaws.com/<stage>/<resource>
## API authorizers
aws apigateway get-authorizers --rest-api-id <id>
## Models
aws apigateway get-models --rest-api-id <id>
## More info
aws apigateway get-gateway-responses --rest-api-id <id>
aws apigateway get-request-validators --rest-api-id <id>
aws apigateway get-deployments --rest-api-id <id>

# Get api keys generated
aws apigateway get-api-keys --include-value
aws apigateway get-api-key --api-key <id> --include-value # Get just 1
## Example use API key
curl -X GET -H "x-api-key: AJE&Ygenu4[..]" https://e83uuftdi8.execute-api.us-east-1.amazonaws.com/dev/test
## Usage plans
aws apigateway get-usage-plans #Get limit use info
aws apigateway get-usage-plan-keys --usage-plan-id <plan_id> #Get clear text values of api keys
aws apigateway get-usage-plan-key --usage-plan-id <plan_id> --key-id <key_id>
###Already consumed
aws apigateway get-usage --usage-plan-id <plan_id> --start-date 2023-07-01 --end-date 2023-07-12
```
{% endtab %}

{% tab title="apigatewayv2" %}
```bash
# Generic info
aws apigatewayv2 get-domain-names
aws apigatewayv2 get-domain-name --domain-name <name>
aws apigatewayv2 get-vpc-links

# Enumerate APIs
aws apigatewayv2 get-apis # This will also show the resource policy (if any)
aws apigatewayv2 get-api --api-id <id>

## Get all the info from an api at once
aws apigatewayv2 export-api --api-id <id> --output-type YAML --specification OAS30 /tmp/api.yaml

## Get stages
aws apigatewayv2 get-stages --api-id <id>

## Get routes
aws apigatewayv2 get-routes --api-id <id>
aws apigatewayv2 get-route --api-id <id> --route-id <route-id>

## Get deployments
aws apigatewayv2 get-deployments --api-id <id>
aws apigatewayv2 get-deployment --api-id <id> --deployment-id <dep-id>

## Get integrations
aws apigatewayv2 get-integrations --api-id <id>

## Get authorizers
aws apigatewayv2 get-authorizers --api-id <id>
aws apigatewayv2 get-authorizer --api-id <id> --authorizer-id <uth-id>

## Get domain mappings
aws apigatewayv2 get-api-mappings --api-id <id> --domain-name <dom-name>
aws apigatewayv2 get-api-mapping --api-id <id> --api-mapping-id <map-id> --domain-name <dom-name>

## Get models
aws apigatewayv2 get-models --api-id <id>

## Call API
https://<api-id>.execute-api.<region>.amazonaws.com/<stage>/<resource>
```
{% endtab %}
{% endtabs %}

## API Gateway ì—”ë“œí¬ì¸íŠ¸ì— ì ‘ê·¼í•˜ê¸° ìœ„í•œ ë‹¤ì–‘í•œ ê¶Œí•œ

### ë¦¬ì†ŒìŠ¤ ì •ì±…

ë¦¬ì†ŒìŠ¤ ì •ì±…ì„ ì‚¬ìš©í•˜ì—¬ API ì—”ë“œí¬ì¸íŠ¸ë¥¼ í˜¸ì¶œí•  ìˆ˜ ìˆëŠ” ëŒ€ìƒì„ ì •ì˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\
ë‹¤ìŒ ì˜ˆì œì—ì„œëŠ” **ì§€ì •ëœ IPê°€** GETì„ í†µí•´ ì—”ë“œí¬ì¸íŠ¸ `/resource_policy`ë¥¼ í˜¸ì¶œí•  ìˆ˜ ì—†ìŒì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

<figure><img src="../../../.gitbook/assets/image (256).png" alt=""><figcaption></figcaption></figure>

### IAM ì¸ì¦ì

ê²½ë¡œ(ë¦¬ì†ŒìŠ¤) ë‚´ì˜ ë©”ì„œë“œê°€ í˜¸ì¶œí•˜ê¸° ìœ„í•´ IAM ì¸ì¦ì„ ìš”êµ¬í•˜ë„ë¡ ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

<figure><img src="https://lh3.googleusercontent.com/GGx-kfqNXu6zMqGidnO8_eR88fYPpJG-wNuBBnedAJntiRUEPTEScl7OvWthGYRiI_msYCdC6oBFvJc827Tb4-4UogxpOyrEXyst-8IDzP9DC2NOtXSY7w58L0baCAcBQjSyvBhJREvWWCtiboNYPSKuEw=s2048" alt=""><figcaption></figcaption></figure>

ì´ ì„¤ì •ì´ ë˜ì–´ ìˆìœ¼ë©´ ì¸ì¦ ì—†ì´ ì—”ë“œí¬ì¸íŠ¸ì— ì ‘ê·¼í•˜ë ¤ê³  í•  ë•Œ `{"message":"Missing Authentication Token"}` ì˜¤ë¥˜ê°€ ë°œìƒí•©ë‹ˆë‹¤.

ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ ì˜ˆìƒë˜ëŠ” í† í°ì„ ìƒì„±í•˜ëŠ” ì‰¬ìš´ ë°©ë²• ì¤‘ í•˜ë‚˜ëŠ” **curl**ì„ ì‚¬ìš©í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤.
```bash
$ curl -X <method> https://<api-id>.execute-api.<region>.amazonaws.com/<stage>/<resource> --user <AWS_ACCESS_KEY>:<AWS_SECRET_KEY> --aws-sigv4 "aws:amz:<region>:execute-api"
```
ë˜ ë‹¤ë¥¸ ë°©ë²•ì€ **Postman** ë‚´ì—ì„œ **`Authorization`** ìœ í˜• **`AWS Signature`**ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤.

<figure><img src="../../../.gitbook/assets/image (168).png" alt=""><figcaption></figcaption></figure>

ì‚¬ìš©í•˜ë ¤ëŠ” ê³„ì •ì˜ accessKeyì™€ SecretKeyë¥¼ ì„¤ì •í•˜ë©´ API ì—”ë“œí¬ì¸íŠ¸ì— ëŒ€í•´ ì¸ì¦í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ë‘ ë°©ë²• ëª¨ë‘ ë‹¤ìŒê³¼ ê°™ì€ **Authorization** **header**ë¥¼ ìƒì„±í•©ë‹ˆë‹¤:
```
AWS4-HMAC-SHA256 Credential=AKIAYY7XU6ECUDOTWB7W/20220726/us-east-1/execute-api/aws4_request, SignedHeaders=host;x-amz-date, Signature=9f35579fa85c0d089c5a939e3d711362e92641e8c14cc571df8c71b4bc62a5c2
```
ë‹¤ë¥¸ ê²½ìš°ì—ëŠ” **Authorizer**ê°€ **ì˜ëª» ì½”ë”©**ë˜ì—ˆì„ ìˆ˜ ìˆìœ¼ë©°, **Authorization header** ì•ˆì— **ë¬´ì—‡ì´ë“ ** ë³´ë‚´ë©´ **ìˆ¨ê²¨ì§„ ì½˜í…ì¸ ë¥¼ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤**.

### Request Signing Using Python
```python

pip install requests
pip install requests-aws4auth
pip install boto3

import boto3
import requests
from requests_aws4auth import AWS4Auth

region = 'us-east-1'  # Region
service = 'execute-api'
access_key = 'YOUR_ACCESS_KEY'
secret_key = 'YOUR_SECRET_KEY'

url = 'https://<apiid>.execute-api.us-east-1.amazonaws.com/<stage>/<resource>'

session = boto3.Session(aws_access_key_id=access_key, aws_secret_access_key=secret_key)
credentials = session.get_credentials()
awsauth = AWS4Auth(credentials.access_key, credentials.secret_key, region, service, session_token=credentials.token)

response = requests.get(url, auth=awsauth)

print(response.text)

```
### Custom Lambda Authorizer

ì£¼ì–´ì§„ í† í°ì„ ê¸°ë°˜ìœ¼ë¡œ í•˜ëŠ” ëŒë‹¤ë¥¼ ì‚¬ìš©í•˜ì—¬ **IAM ì •ì±…ì„ ë°˜í™˜**í•˜ì—¬ ì‚¬ìš©ìê°€ **API ì—”ë“œí¬ì¸íŠ¸ë¥¼ í˜¸ì¶œí•  ìˆ˜ ìˆëŠ” ê¶Œí•œì´ ìˆëŠ”ì§€** í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\
ì €ìëŠ” ì‚¬ìš©í•  ê° ë¦¬ì†ŒìŠ¤ ë©”ì„œë“œë¥¼ ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

<details>

<summary>Lambda Authorizer Code Example</summary>
```python
import json

def lambda_handler(event, context):
token = event['authorizationToken']
method_arn = event['methodArn']

if not token:
return {
'statusCode': 401,
'body': 'Unauthorized'
}

try:
# Replace this with your own token validation logic
if token == "your-secret-token":
return generate_policy('user', 'Allow', method_arn)
else:
return generate_policy('user', 'Deny', method_arn)
except Exception as e:
print(e)
return {
'statusCode': 500,
'body': 'Internal Server Error'
}

def generate_policy(principal_id, effect, resource):
policy = {
'principalId': principal_id,
'policyDocument': {
'Version': '2012-10-17',
'Statement': [
{
'Action': 'execute-api:Invoke',
'Effect': effect,
'Resource': resource
}
]
}
}
return policy
```
</details>

ë‹¤ìŒê³¼ ê°™ì´ í˜¸ì¶œí•˜ì„¸ìš”:

<pre class="language-bash" data-overflow="wrap"><code class="lang-bash"><strong>curl "https://jhhqafgh6f.execute-api.eu-west-1.amazonaws.com/prod/custom_auth" -H 'Authorization: your-secret-token'
</strong></code></pre>

{% hint style="warning" %}
Lambda ì½”ë“œì— ë”°ë¼ ì´ ì¸ì¦ì€ ì·¨ì•½í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
{% endhint %}

**ê±°ë¶€ ì •ì±…ì´ ìƒì„±ë˜ì–´ ë°˜í™˜ë˜ë©´** API Gatewayì—ì„œ ë°˜í™˜ë˜ëŠ” ì˜¤ë¥˜ëŠ”: `{"Message":"User is not authorized to access this resource with an explicit deny"}`ì…ë‹ˆë‹¤.

ì´ë ‡ê²Œ í•˜ë©´ **ì´ ì¸ì¦ì´ ì¡´ì¬í•¨ì„ ì‹ë³„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.**

### í•„ìˆ˜ API í‚¤

**ìœ íš¨í•œ API í‚¤**ê°€ í•„ìš”í•˜ë„ë¡ API ì—”ë“œí¬ì¸íŠ¸ë¥¼ ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

<figure><img src="../../../.gitbook/assets/image (88).png" alt=""><figcaption></figcaption></figure>

API Gateway í¬í„¸ì—ì„œ API í‚¤ë¥¼ ìƒì„±í•  ìˆ˜ ìˆìœ¼ë©°, ì‚¬ìš©ëŸ‰(ì´ˆë‹¹ ìš”ì²­ ìˆ˜ ë° ì›”ê°„ ìš”ì²­ ìˆ˜)ì— ëŒ€í•œ ì„¤ì •ë„ ê°€ëŠ¥í•©ë‹ˆë‹¤.

API í‚¤ë¥¼ ì‘ë™ì‹œí‚¤ë ¤ë©´ **ì‚¬ìš© ê³„íš**ì— ì¶”ê°€í•´ì•¼ í•˜ë©°, ì´ ì‚¬ìš© ê³„íšì€ **API ë‹¨ê³„**ì— ì¶”ê°€ë˜ì–´ì•¼ í•˜ê³ , ê´€ë ¨ëœ API ë‹¨ê³„ëŠ” API í‚¤ê°€ í•„ìš”í•œ **ì—”ë“œí¬ì¸íŠ¸**ì— ëŒ€í•´ **ë©”ì„œë“œ ìŠ¤ë¡œí‹€ë§**ì´ êµ¬ì„±ë˜ì–´ì•¼ í•©ë‹ˆë‹¤:

<figure><img src="../../../.gitbook/assets/image (198).png" alt=""><figcaption></figcaption></figure>

## ì¸ì¦ë˜ì§€ ì•Šì€ ì ‘ê·¼

{% content-ref url="../aws-unauthenticated-enum-access/aws-api-gateway-unauthenticated-enum.md" %}
[aws-api-gateway-unauthenticated-enum.md](../aws-unauthenticated-enum-access/aws-api-gateway-unauthenticated-enum.md)
{% endcontent-ref %}

## ê¶Œí•œ ìƒìŠ¹

{% content-ref url="../aws-privilege-escalation/aws-apigateway-privesc.md" %}
[aws-apigateway-privesc.md](../aws-privilege-escalation/aws-apigateway-privesc.md)
{% endcontent-ref %}

## í¬ìŠ¤íŠ¸ ìµìŠ¤í”Œë¡œì‡

{% content-ref url="../aws-post-exploitation/aws-api-gateway-post-exploitation.md" %}
[aws-api-gateway-post-exploitation.md](../aws-post-exploitation/aws-api-gateway-post-exploitation.md)
{% endcontent-ref %}

## ì§€ì†ì„±

{% content-ref url="../aws-persistence/aws-api-gateway-persistence.md" %}
[aws-api-gateway-persistence.md](../aws-persistence/aws-api-gateway-persistence.md)
{% endcontent-ref %}

{% hint style="success" %}
AWS í•´í‚¹ ë°°ìš°ê¸° ë° ì—°ìŠµí•˜ê¸°:<img src="../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">\
GCP í•´í‚¹ ë°°ìš°ê¸° ë° ì—°ìŠµí•˜ê¸°: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks ì§€ì›í•˜ê¸°</summary>

* [**êµ¬ë… ê³„íš**](https://github.com/sponsors/carlospolop) í™•ì¸í•˜ê¸°!
* ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— ì°¸ì—¬í•˜ê±°ë‚˜ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**ë¥¼ íŒ”ë¡œìš°í•˜ì„¸ìš”.**
* [**HackTricks**](https://github.com/carlospolop/hacktricks) ë° [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub ë¦¬í¬ì§€í† ë¦¬ì— PRì„ ì œì¶œí•˜ì—¬ í•´í‚¹ íŒì„ ê³µìœ í•˜ì„¸ìš”.

</details>
{% endhint %}
