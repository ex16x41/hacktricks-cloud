# AWS - API Gateway Enum

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## API Gateway

### Basic Information

AWS API Gateway - —Ü–µ –∫–æ–º–ø–ª–µ–∫—Å–Ω–∞ —Å–ª—É–∂–±–∞, —â–æ –ø—Ä–æ–ø–æ–Ω—É—î—Ç—å—Å—è Amazon Web Services (AWS), –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–∞ –¥–ª—è —Ä–æ–∑—Ä–æ–±–Ω–∏–∫—ñ–≤, —â–æ–± **—Å—Ç–≤–æ—Ä—é–≤–∞—Ç–∏, –ø—É–±–ª—ñ–∫—É–≤–∞—Ç–∏ —Ç–∞ –∫–æ–Ω—Ç—Ä–æ–ª—é–≤–∞—Ç–∏ API –≤ –º–∞—Å—à—Ç–∞–±–∞—Ö**. –í–æ–Ω–∞ —Ñ—É–Ω–∫—Ü—ñ–æ–Ω—É—î —è–∫ —Ç–æ—á–∫–∞ –≤—Ö–æ–¥—É –¥–æ –ø—Ä–æ–≥—Ä–∞–º–∏, –¥–æ–∑–≤–æ–ª—è—é—á–∏ —Ä–æ–∑—Ä–æ–±–Ω–∏–∫–∞–º –≤—Å—Ç–∞–Ω–æ–≤–ª—é–≤–∞—Ç–∏ –Ω–∞–±—ñ—Ä –ø—Ä–∞–≤–∏–ª —ñ –ø—Ä–æ—Ü–µ–¥—É—Ä. –¶—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ä–µ–≥—É–ª—é—î –¥–æ—Å—Ç—É–ø –∑–æ–≤–Ω—ñ—à–Ω—ñ—Ö –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ –¥–æ –ø–µ–≤–Ω–∏—Ö –¥–∞–Ω–∏—Ö –∞–±–æ —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–µ–π —É –ø—Ä–æ–≥—Ä–∞–º—ñ.

API Gateway –¥–æ–∑–≤–æ–ª—è—î –≤–∞–º –≤–∏–∑–Ω–∞—á–∏—Ç–∏, **—è–∫ –ø–æ–≤–∏–Ω–Ω—ñ –æ–±—Ä–æ–±–ª—è—Ç–∏—Å—è –∑–∞–ø–∏—Ç–∏ –¥–æ –≤–∞—à–∏—Ö API**, —ñ –º–æ–∂–µ —Å—Ç–≤–æ—Ä—é–≤–∞—Ç–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—Ü—å–∫—ñ –∫—ñ–Ω—Ü–µ–≤—ñ —Ç–æ—á–∫–∏ API –∑ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∏–º–∏ –º–µ—Ç–æ–¥–∞–º–∏ (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, GET, POST, PUT, DELETE) —Ç–∞ —Ä–µ—Å—É—Ä—Å–∞–º–∏. –í–æ–Ω–∞ —Ç–∞–∫–æ–∂ –º–æ–∂–µ –≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏ –∫–ª—ñ—î–Ω—Ç—Å—å–∫—ñ SDK (–Ω–∞–±–æ—Ä–∏ –∑–∞—Å–æ–±—ñ–≤ —Ä–æ–∑—Ä–æ–±–∫–∏ –ø—Ä–æ–≥—Ä–∞–º–Ω–æ–≥–æ –∑–∞–±–µ–∑–ø–µ—á–µ–Ω–Ω—è), —â–æ–± –ø–æ–ª–µ–≥—à–∏—Ç–∏ —Ä–æ–∑—Ä–æ–±–Ω–∏–∫–∞–º –≤–∏–∫–ª–∏–∫ –≤–∞—à–∏—Ö API –∑ —ó—Ö–Ω—ñ—Ö –ø—Ä–æ–≥—Ä–∞–º.

### API Gateways Types

* **HTTP API**: –°—Ç–≤–æ—Ä—é–π—Ç–µ API REST –∑ –Ω–∏–∑—å–∫–æ—é –∑–∞—Ç—Ä–∏–º–∫–æ—é —Ç–∞ –µ–∫–æ–Ω–æ–º—ñ—á–Ω–∏–º–∏ –≤–∏—Ç—Ä–∞—Ç–∞–º–∏ –∑ –≤–±—É–¥–æ–≤–∞–Ω–∏–º–∏ —Ñ—É–Ω–∫—Ü—ñ—è–º–∏, —Ç–∞–∫–∏–º–∏ —è–∫ OIDC —Ç–∞ OAuth2, –∞ —Ç–∞–∫–æ–∂ –Ω–∞—Ç–∏–≤–Ω–æ—é –ø—ñ–¥—Ç—Ä–∏–º–∫–æ—é CORS. –ü—Ä–∞—Ü—é—î –∑ –Ω–∞—Å—Ç—É–ø–Ω–∏–º–∏: Lambda, HTTP backends.
* **WebSocket API**: –°—Ç–≤–æ—Ä—é–π—Ç–µ API WebSocket, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ –ø–æ—Å—Ç—ñ–π–Ω—ñ –∑'—î–¥–Ω–∞–Ω–Ω—è –¥–ª—è —Ä–µ–∞–ª—å–Ω–∏—Ö –≤–∏–ø–∞–¥–∫—ñ–≤ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è, —Ç–∞–∫–∏—Ö —è–∫ —á–∞—Ç-–¥–æ–¥–∞—Ç–∫–∏ –∞–±–æ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ–π–Ω—ñ –ø–∞–Ω–µ–ª—ñ. –ü—Ä–∞—Ü—é—î –∑ –Ω–∞—Å—Ç—É–ø–Ω–∏–º–∏: Lambda, HTTP, AWS Services.
* **REST API**: –†–æ–∑—Ä–æ–±–ª—è–π—Ç–µ REST API, –¥–µ –≤–∏ –æ—Ç—Ä–∏–º—É—î—Ç–µ –ø–æ–≤–Ω–∏–π –∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥ –∑–∞–ø–∏—Ç–æ–º —ñ –≤—ñ–¥–ø–æ–≤—ñ–¥–¥—é —Ä–∞–∑–æ–º –∑ –º–æ–∂–ª–∏–≤–æ—Å—Ç—è–º–∏ —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è API. –ü—Ä–∞—Ü—é—î –∑ –Ω–∞—Å—Ç—É–ø–Ω–∏–º–∏: Lambda, HTTP, AWS Services.
* **REST API Private**: –°—Ç–≤–æ—Ä—ñ—Ç—å REST API, —è–∫–∏–π –¥–æ—Å—Ç—É–ø–Ω–∏–π –ª–∏—à–µ –∑—Å–µ—Ä–µ–¥–∏–Ω–∏ VPC.

### API Gateway Main Components

1. **Resources**: –£ API Gateway —Ä–µ—Å—É—Ä—Å–∏ - —Ü–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∏, —è–∫—ñ **—Å–∫–ª–∞–¥–∞—é—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –≤–∞—à–æ–≥–æ API**. –í–æ–Ω–∏ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—é—Ç—å **—Ä—ñ–∑–Ω—ñ —à–ª—è—Ö–∏ –∞–±–æ –∫—ñ–Ω—Ü–µ–≤—ñ —Ç–æ—á–∫–∏** –≤–∞—à–æ–≥–æ API —ñ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—é—Ç—å —Ä—ñ–∑–Ω–∏–º –¥—ñ—è–º, —è–∫—ñ –ø—ñ–¥—Ç—Ä–∏–º—É—î –≤–∞—à API. –†–µ—Å—É—Ä—Å - —Ü–µ –∫–æ–∂–µ–Ω –º–µ—Ç–æ–¥ (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, GET, POST, PUT, DELETE) **–≤—Å–µ—Ä–µ–¥–∏–Ω—ñ –∫–æ–∂–Ω–æ–≥–æ —à–ª—è—Ö—É** (/, –∞–±–æ /users, –∞–±–æ /user/{id}).
2. **Stages**: –°—Ç–∞–¥—ñ—ó –≤ API Gateway –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—é—Ç—å **—Ä—ñ–∑–Ω—ñ –≤–µ—Ä—Å—ñ—ó –∞–±–æ —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞** –≤–∞—à–æ–≥–æ API, —Ç–∞–∫—ñ —è–∫ —Ä–æ–∑—Ä–æ–±–∫–∞, —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è –∞–±–æ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å. –í–∏ –º–æ–∂–µ—Ç–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ —Å—Ç–∞–¥—ñ—ó –¥–ª—è —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è —Ç–∞ —Ä–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è **–¥–µ–∫—ñ–ª—å–∫–æ—Ö –≤–µ—Ä—Å—ñ–π –≤–∞—à–æ–≥–æ API –æ–¥–Ω–æ—á–∞—Å–Ω–æ**, —â–æ –¥–æ–∑–≤–æ–ª—è—î –≤–∞–º —Ç–µ—Å—Ç—É–≤–∞—Ç–∏ –Ω–æ–≤—ñ —Ñ—É–Ω–∫—Ü—ñ—ó –∞–±–æ –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è –ø–æ–º–∏–ª–æ–∫ –±–µ–∑ –≤–ø–ª–∏–≤—É –Ω–∞ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–µ —Å–µ—Ä–µ–¥–æ–≤–∏—â–µ. –°—Ç–∞–¥—ñ—ó —Ç–∞–∫–æ–∂ **–ø—ñ–¥—Ç—Ä–∏–º—É—é—Ç—å –∑–º—ñ–Ω–Ω—ñ —Å—Ç–∞–¥—ñ—ó**, —è–∫—ñ —î –ø–∞—Ä–∞–º–∏ –∫–ª—é—á-–∑–Ω–∞—á–µ–Ω–Ω—è, —â–æ –º–æ–∂—É—Ç—å –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏—Å—è –¥–ª—è –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –ø–æ–≤–µ–¥—ñ–Ω–∫–∏ –≤–∞—à–æ–≥–æ API –∑–∞–ª–µ–∂–Ω–æ –≤—ñ–¥ –ø–æ—Ç–æ—á–Ω–æ—ó —Å—Ç–∞–¥—ñ—ó. –ù–∞–ø—Ä–∏–∫–ª–∞–¥, –≤–∏ –º–æ–∂–µ—Ç–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –∑–º—ñ–Ω–Ω—ñ —Å—Ç–∞–¥—ñ—ó, —â–æ–± –Ω–∞–ø—Ä–∞–≤–ª—è—Ç–∏ –∑–∞–ø–∏—Ç–∏ API –¥–æ —Ä—ñ–∑–Ω–∏—Ö —Ñ—É–Ω–∫—Ü—ñ–π Lambda –∞–±–æ —ñ–Ω—à–∏—Ö —Å–ª—É–∂–± –±–µ–∫–µ–Ω–¥—É –≤ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ –≤—ñ–¥ —Å—Ç–∞–¥—ñ—ó.
* –°—Ç–∞–¥—ñ—è –≤–∫–∞–∑—É—î—Ç—å—Å—è –Ω–∞ –ø–æ—á–∞—Ç–∫—É URL –∫—ñ–Ω—Ü–µ–≤–æ—ó —Ç–æ—á–∫–∏ API Gateway.
3. **Authorizers**: –ê–≤—Ç–æ—Ä–∏–∑–∞—Ç–æ—Ä–∏ –≤ API Gateway –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—é—Ç—å –∑–∞ **–∫–æ–Ω—Ç—Ä–æ–ª—å –¥–æ—Å—Ç—É–ø—É –¥–æ –≤–∞—à–æ–≥–æ API**, –ø–µ—Ä–µ–≤—ñ—Ä—è—é—á–∏ –æ—Å–æ–±—É –≤–∏–∫–ª–∏–∫—É –ø–µ—Ä–µ–¥ —Ç–∏–º, —è–∫ –¥–æ–∑–≤–æ–ª–∏—Ç–∏ –∑–∞–ø–∏—Ç –ø—Ä–æ–¥–æ–≤–∂–∏—Ç–∏. –í–∏ –º–æ–∂–µ—Ç–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ **—Ñ—É–Ω–∫—Ü—ñ—ó AWS Lambda** —è–∫ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—Ü—å–∫—ñ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ç–æ—Ä–∏, —â–æ –¥–æ–∑–≤–æ–ª—è—î –≤–∞–º —Ä–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ –≤–ª–∞—Å–Ω—É –ª–æ–≥—ñ–∫—É –∞—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó —Ç–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó. –ö–æ–ª–∏ –∑–∞–ø–∏—Ç –Ω–∞–¥—Ö–æ–¥–∏—Ç—å, API Gateway –ø–µ—Ä–µ–¥–∞—î —Ç–æ–∫–µ–Ω –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó –∑–∞–ø–∏—Ç—É –∞–≤—Ç–æ—Ä–∏–∑–∞—Ç–æ—Ä—É Lambda, —è–∫–∏–π –æ–±—Ä–æ–±–ª—è—î —Ç–æ–∫–µ–Ω —ñ –ø–æ–≤–µ—Ä—Ç–∞—î –ø–æ–ª—ñ—Ç–∏–∫—É IAM, —â–æ –≤–∏–∑–Ω–∞—á–∞—î, —è–∫—ñ –¥—ñ—ó –¥–æ–∑–≤–æ–ª–µ–Ω–æ –≤–∏–∫–æ–Ω—É–≤–∞—Ç–∏ –≤–∏–∫–ª–∏–∫—É. API Gateway —Ç–∞–∫–æ–∂ –ø—ñ–¥—Ç—Ä–∏–º—É—î **–≤–±—É–¥–æ–≤–∞–Ω—ñ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ç–æ—Ä–∏**, —Ç–∞–∫—ñ —è–∫ **AWS Identity and Access Management (IAM)** —Ç–∞ **Amazon Cognito**.
4. **Resource Policy**: –ü–æ–ª—ñ—Ç–∏–∫–∞ —Ä–µ—Å—É—Ä—Å—É –≤ API Gateway - —Ü–µ –¥–æ–∫—É–º–µ–Ω—Ç JSON, —è–∫–∏–π **–≤–∏–∑–Ω–∞—á–∞—î –¥–æ–∑–≤–æ–ª–∏ –¥–ª—è –¥–æ—Å—Ç—É–ø—É –¥–æ –≤–∞—à–æ–≥–æ API**. –í–æ–Ω–∞ —Å—Ö–æ–∂–∞ –Ω–∞ –ø–æ–ª—ñ—Ç–∏–∫—É IAM, –∞–ª–µ —Å–ø–µ—Ü—ñ–∞–ª—å–Ω–æ –∞–¥–∞–ø—Ç–æ–≤–∞–Ω–∞ –¥–ª—è API Gateway. –í–∏ –º–æ–∂–µ—Ç–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –ø–æ–ª—ñ—Ç–∏–∫—É —Ä–µ—Å—É—Ä—Å—É, —â–æ–± –∫–æ–Ω—Ç—Ä–æ–ª—é–≤–∞—Ç–∏, —Ö—Ç–æ –º–æ–∂–µ –æ—Ç—Ä–∏–º–∞—Ç–∏ –¥–æ—Å—Ç—É–ø –¥–æ –≤–∞—à–æ–≥–æ API, —è–∫—ñ –º–µ—Ç–æ–¥–∏ –≤–æ–Ω–∏ –º–æ–∂—É—Ç—å –≤–∏–∫–ª–∏–∫–∞—Ç–∏ —Ç–∞ –∑ —è–∫–∏—Ö IP-–∞–¥—Ä–µ—Å –∞–±–æ VPC –≤–æ–Ω–∏ –º–æ–∂—É—Ç—å –ø—ñ–¥–∫–ª—é—á–∞—Ç–∏—Å—è. **–ü–æ–ª—ñ—Ç–∏–∫–∏ —Ä–µ—Å—É—Ä—Å—ñ–≤ –º–æ–∂—É—Ç—å –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏—Å—è –≤ –ø–æ—î–¥–Ω–∞–Ω–Ω—ñ –∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ç–æ—Ä–∞–º–∏** –¥–ª—è –Ω–∞–¥–∞–Ω–Ω—è –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –∫–æ–Ω—Ç—Ä–æ–ª—é –¥–æ—Å—Ç—É–ø—É –¥–æ –≤–∞—à–æ–≥–æ API.
* –©–æ–± –∑–º—ñ–Ω–∏ –Ω–∞–±—Ä–∞–ª–∏ —á–∏–Ω–Ω–æ—Å—Ç—ñ, API –ø–æ—Ç—Ä—ñ–±–Ω–æ **–∑–Ω–æ–≤—É —Ä–æ–∑–≥–æ—Ä–Ω—É—Ç–∏ –ø—ñ—Å–ª—è** –∑–º—ñ–Ω–∏ –ø–æ–ª—ñ—Ç–∏–∫–∏ —Ä–µ—Å—É—Ä—Å—É.

### Logging

–ó–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º, **CloudWatch Logs** **–≤–∏–º–∫–Ω–µ–Ω–æ**, **Access Logging** **–≤–∏–º–∫–Ω–µ–Ω–æ**, –∞ **X-Ray tracing** —Ç–∞–∫–æ–∂ **–≤–∏–º–∫–Ω–µ–Ω–æ**.

### Enumeration

{% hint style="success" %}
–ó–≤–µ—Ä–Ω—ñ—Ç—å —É–≤–∞–≥—É, —â–æ –≤ –æ–±–æ—Ö AWS API –¥–ª—è –ø–µ—Ä–µ—Ä–∞—Ö—É–≤–∞–Ω–Ω—è —Ä–µ—Å—É—Ä—Å—ñ–≤ (**`apigateway`** —Ç–∞ **`apigatewayv2`**) —î–¥–∏–Ω–µ –¥–æ–∑–≤–æ–ª–µ–Ω–Ω—è, —è–∫–µ –≤–∞–º –ø–æ—Ç—Ä—ñ–±–Ω–æ, —ñ —î–¥–∏–Ω–µ –¥–æ–∑–≤–æ–ª–µ–Ω–Ω—è –Ω–∞ —á–∏—Ç–∞–Ω–Ω—è, —è–∫–µ –º–æ–∂–Ω–∞ –Ω–∞–¥–∞—Ç–∏, - —Ü–µ **`apigateway:GET`**, –∑ —Ü–∏–º –≤–∏ –º–æ–∂–µ—Ç–µ **–ø–µ—Ä–µ—Ä–∞—Ö—É–≤–∞—Ç–∏ –≤—Å–µ.**
{% endhint %}

{% tabs %}
{% tab title="apigateway" %}
```bash
# Generic info
aws apigateway get-account
aws apigateway get-domain-names
aws apigateway get-usage-plans
aws apigateway get-vpc-links
aws apigateway get-client-certificates

# Enumerate APIs
aws apigateway get-rest-apis # This will also show the resource policy (if any)
## Get stages
aws apigateway get-stages --rest-api-id <id>
## Get resources
aws apigateway get-resources --rest-api-id <id>
## Get API resource action per HTTP verb (check authorizers and api key required)
aws apigateway get-method --http-method GET --rest-api-id <api-id> --resource-id <resource-id>

## Call API
https://<api-id>.execute-api.<region>.amazonaws.com/<stage>/<resource>
## API authorizers
aws apigateway get-authorizers --rest-api-id <id>
## Models
aws apigateway get-models --rest-api-id <id>
## More info
aws apigateway get-gateway-responses --rest-api-id <id>
aws apigateway get-request-validators --rest-api-id <id>
aws apigateway get-deployments --rest-api-id <id>

# Get api keys generated
aws apigateway get-api-keys --include-value
aws apigateway get-api-key --api-key <id> --include-value # Get just 1
## Example use API key
curl -X GET -H "x-api-key: AJE&Ygenu4[..]" https://e83uuftdi8.execute-api.us-east-1.amazonaws.com/dev/test
## Usage plans
aws apigateway get-usage-plans #Get limit use info
aws apigateway get-usage-plan-keys --usage-plan-id <plan_id> #Get clear text values of api keys
aws apigateway get-usage-plan-key --usage-plan-id <plan_id> --key-id <key_id>
###Already consumed
aws apigateway get-usage --usage-plan-id <plan_id> --start-date 2023-07-01 --end-date 2023-07-12
```
{% endtab %}

{% tab title="apigatewayv2" %}
```bash
# Generic info
aws apigatewayv2 get-domain-names
aws apigatewayv2 get-domain-name --domain-name <name>
aws apigatewayv2 get-vpc-links

# Enumerate APIs
aws apigatewayv2 get-apis # This will also show the resource policy (if any)
aws apigatewayv2 get-api --api-id <id>

## Get all the info from an api at once
aws apigatewayv2 export-api --api-id <id> --output-type YAML --specification OAS30 /tmp/api.yaml

## Get stages
aws apigatewayv2 get-stages --api-id <id>

## Get routes
aws apigatewayv2 get-routes --api-id <id>
aws apigatewayv2 get-route --api-id <id> --route-id <route-id>

## Get deployments
aws apigatewayv2 get-deployments --api-id <id>
aws apigatewayv2 get-deployment --api-id <id> --deployment-id <dep-id>

## Get integrations
aws apigatewayv2 get-integrations --api-id <id>

## Get authorizers
aws apigatewayv2 get-authorizers --api-id <id>
aws apigatewayv2 get-authorizer --api-id <id> --authorizer-id <uth-id>

## Get domain mappings
aws apigatewayv2 get-api-mappings --api-id <id> --domain-name <dom-name>
aws apigatewayv2 get-api-mapping --api-id <id> --api-mapping-id <map-id> --domain-name <dom-name>

## Get models
aws apigatewayv2 get-models --api-id <id>

## Call API
https://<api-id>.execute-api.<region>.amazonaws.com/<stage>/<resource>
```
{% endtab %}
{% endtabs %}

## –†—ñ–∑–Ω—ñ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó –¥–ª—è –¥–æ—Å—Ç—É–ø—É –¥–æ –∫—ñ–Ω—Ü–µ–≤–∏—Ö —Ç–æ—á–æ–∫ API Gateway

### –ü–æ–ª—ñ—Ç–∏–∫–∞ —Ä–µ—Å—É—Ä—Å—ñ–≤

–ú–æ–∂–ª–∏–≤–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –ø–æ–ª—ñ—Ç–∏–∫–∏ —Ä–µ—Å—É—Ä—Å—ñ–≤, —â–æ–± –≤–∏–∑–Ω–∞—á–∏—Ç–∏, —Ö—Ç–æ –º–æ–∂–µ –≤–∏–∫–ª–∏–∫–∞—Ç–∏ –∫—ñ–Ω—Ü–µ–≤—ñ —Ç–æ—á–∫–∏ API.\
–£ –Ω–∞—Å—Ç—É–ø–Ω–æ–º—É –ø—Ä–∏–∫–ª–∞–¥—ñ –≤–∏ –º–æ–∂–µ—Ç–µ –ø–æ–±–∞—á–∏—Ç–∏, —â–æ **–≤–∫–∞–∑–∞–Ω–∞ IP-–∞–¥—Ä–µ—Å–∞ –Ω–µ –º–æ–∂–µ –≤–∏–∫–ª–∏–∫–∞—Ç–∏** –∫—ñ–Ω—Ü–µ–≤—É —Ç–æ—á–∫—É `/resource_policy` —á–µ—Ä–µ–∑ GET.

<figure><img src="../../../.gitbook/assets/image (256).png" alt=""><figcaption></figcaption></figure>

### IAM –∞–≤—Ç–æ—Ä–∏–∑–∞—Ç–æ—Ä

–ú–æ–∂–ª–∏–≤–æ –≤—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏, —â–æ –º–µ—Ç–æ–¥–∏ –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ —à–ª—è—Ö—É (—Ä–µ—Å—É—Ä—Å—É) –≤–∏–º–∞–≥–∞—é—Ç—å IAM –∞—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó –¥–ª—è –≤–∏–∫–ª–∏–∫—É.

<figure><img src="https://lh3.googleusercontent.com/GGx-kfqNXu6zMqGidnO8_eR88fYPpJG-wNuBBnedAJntiRUEPTEScl7OvWthGYRiI_msYCdC6oBFvJc827Tb4-4UogxpOyrEXyst-8IDzP9DC2NOtXSY7w58L0baCAcBQjSyvBhJREvWWCtiboNYPSKuEw=s2048" alt=""><figcaption></figcaption></figure>

–ö–æ–ª–∏ —Ü–µ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ, –≤–∏ –æ—Ç—Ä–∏–º–∞—î—Ç–µ –ø–æ–º–∏–ª–∫—É `{"message":"Missing Authentication Token"}`, –∫–æ–ª–∏ —Å–ø—Ä–æ–±—É—î—Ç–µ –¥–æ—Å—è–≥—Ç–∏ –∫—ñ–Ω—Ü–µ–≤–æ—ó —Ç–æ—á–∫–∏ –±–µ–∑ –±—É–¥—å-—è–∫–æ—ó –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó.

–û–¥–∏–Ω –ø—Ä–æ—Å—Ç–∏–π —Å–ø–æ—Å—ñ–± –∑–≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏ –æ—á—ñ–∫—É–≤–∞–Ω–∏–π —Ç–æ–∫–µ–Ω –¥–æ–¥–∞—Ç–∫–æ–º - —Ü–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ **curl**.
```bash
$ curl -X <method> https://<api-id>.execute-api.<region>.amazonaws.com/<stage>/<resource> --user <AWS_ACCESS_KEY>:<AWS_SECRET_KEY> --aws-sigv4 "aws:amz:<region>:execute-api"
```
–Ü–Ω—à–∏–π —Å–ø–æ—Å—ñ–± - –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ —Ç–∏–ø **`Authorization`** **`AWS Signature`** –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ **Postman**.

<figure><img src="../../../.gitbook/assets/image (168).png" alt=""><figcaption></figcaption></figure>

–í—Å—Ç–∞–Ω–æ–≤—ñ—Ç—å accessKey —Ç–∞ SecretKey –æ–±–ª—ñ–∫–æ–≤–æ–≥–æ –∑–∞–ø–∏—Å—É, —è–∫–∏–π –≤–∏ —Ö–æ—á–µ—Ç–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏, —ñ –≤–∏ –∑–º–æ–∂–µ—Ç–µ –∞—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫—É–≤–∞—Ç–∏—Å—è –ø—Ä–æ—Ç–∏ API-—ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å—É.

–û–±–∏–¥–≤–∞ –º–µ—Ç–æ–¥–∏ –∑–≥–µ–Ω–µ—Ä—É—é—Ç—å **Authorization** **header** —Ç–∞–∫–∏–π —è–∫:
```
AWS4-HMAC-SHA256 Credential=AKIAYY7XU6ECUDOTWB7W/20220726/us-east-1/execute-api/aws4_request, SignedHeaders=host;x-amz-date, Signature=9f35579fa85c0d089c5a939e3d711362e92641e8c14cc571df8c71b4bc62a5c2
```
–ó–≤–µ—Ä–Ω—ñ—Ç—å —É–≤–∞–≥—É, —â–æ –≤ —ñ–Ω—à–∏—Ö –≤–∏–ø–∞–¥–∫–∞—Ö **Authorizer** –º—ñ–≥ –±—É—Ç–∏ **–ø–æ–≥–∞–Ω–æ –∑–∞–∫–æ–¥–æ–≤–∞–Ω–∏–π** —ñ –ø—Ä–æ—Å—Ç–æ –≤—ñ–¥–ø—Ä–∞–≤–∫–∞ **–±—É–¥—å-—á–æ–≥–æ** –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ **Authorization header** –¥–æ–∑–≤–æ–ª–∏—Ç—å **–ø–æ–±–∞—á–∏—Ç–∏ –ø—Ä–∏—Ö–æ–≤–∞–Ω–∏–π –∫–æ–Ω—Ç–µ–Ω—Ç**.

### Request Signing Using Python
```python

pip install requests
pip install requests-aws4auth
pip install boto3

import boto3
import requests
from requests_aws4auth import AWS4Auth

region = 'us-east-1'  # Region
service = 'execute-api'
access_key = 'YOUR_ACCESS_KEY'
secret_key = 'YOUR_SECRET_KEY'

url = 'https://<apiid>.execute-api.us-east-1.amazonaws.com/<stage>/<resource>'

session = boto3.Session(aws_access_key_id=access_key, aws_secret_access_key=secret_key)
credentials = session.get_credentials()
awsauth = AWS4Auth(credentials.access_key, credentials.secret_key, region, service, session_token=credentials.token)

response = requests.get(url, auth=awsauth)

print(response.text)

```
### Custom Lambda Authorizer

–ú–æ–∂–ª–∏–≤–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –ª—è–º–±–¥–∞, —è–∫–∞ –Ω–∞ –æ—Å–Ω–æ–≤—ñ –¥–∞–Ω–æ–≥–æ —Ç–æ–∫–µ–Ω–∞ **–ø–æ–≤–µ—Ä–Ω–µ IAM –ø–æ–ª—ñ—Ç–∏–∫—É**, —â–æ –≤–∫–∞–∑—É—î, —á–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á **—É–ø–æ–≤–Ω–æ–≤–∞–∂–µ–Ω–∏–π –≤–∏–∫–ª–∏–∫–∞—Ç–∏ API –∫—ñ–Ω—Ü–µ–≤—É —Ç–æ—á–∫—É**.\
–í–∏ –º–æ–∂–µ—Ç–µ –Ω–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ –∫–æ–∂–µ–Ω –º–µ—Ç–æ–¥ —Ä–µ—Å—É—Ä—Å—É, —è–∫–∏–π –±—É–¥–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ç–æ—Ä.

<details>

<summary>Lambda Authorizer Code Example</summary>
```python
import json

def lambda_handler(event, context):
token = event['authorizationToken']
method_arn = event['methodArn']

if not token:
return {
'statusCode': 401,
'body': 'Unauthorized'
}

try:
# Replace this with your own token validation logic
if token == "your-secret-token":
return generate_policy('user', 'Allow', method_arn)
else:
return generate_policy('user', 'Deny', method_arn)
except Exception as e:
print(e)
return {
'statusCode': 500,
'body': 'Internal Server Error'
}

def generate_policy(principal_id, effect, resource):
policy = {
'principalId': principal_id,
'policyDocument': {
'Version': '2012-10-17',
'Statement': [
{
'Action': 'execute-api:Invoke',
'Effect': effect,
'Resource': resource
}
]
}
}
return policy
```
</details>

–í–∏–∫–ª–∏—á—Ç–µ —Ü–µ –∑ —á–∏–º–æ—Å—å –Ω–∞ –∫—à—Ç–∞–ª—Ç:

<pre class="language-bash" data-overflow="wrap"><code class="lang-bash"><strong>curl "https://jhhqafgh6f.execute-api.eu-west-1.amazonaws.com/prod/custom_auth" -H 'Authorization: your-secret-token'
</strong></code></pre>

{% hint style="warning" %}
–ó–∞–ª–µ–∂–Ω–æ –≤—ñ–¥ –∫–æ–¥—É Lambda, —Ü—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—è –º–æ–∂–µ –±—É—Ç–∏ –≤—Ä–∞–∑–ª–∏–≤–æ—é
{% endhint %}

–ó–≤–µ—Ä–Ω—ñ—Ç—å —É–≤–∞–≥—É, —â–æ —è–∫—â–æ **–≥–µ–Ω–µ—Ä—É—î—Ç—å—Å—è —ñ –ø–æ–≤–µ—Ä—Ç–∞—î—Ç—å—Å—è –ø–æ–ª—ñ—Ç–∏–∫–∞ –≤—ñ–¥–º–æ–≤–∏**, –ø–æ–º–∏–ª–∫–∞, –ø–æ–≤–µ—Ä–Ω–µ–Ω–∞ API Gateway, –≤–∏–≥–ª—è–¥–∞—î —Ç–∞–∫: `{"Message":"User is not authorized to access this resource with an explicit deny"}`

–¢–∞–∫–∏–º —á–∏–Ω–æ–º, –≤–∏ –º–æ–≥–ª–∏ –± **–≤–∏—è–≤–∏—Ç–∏ —Ü—é –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—é**.

### –ù–µ–æ–±—Ö—ñ–¥–Ω–∏–π API –∫–ª—é—á

–ú–æ–∂–ª–∏–≤–æ –Ω–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ API –∫—ñ–Ω—Ü–µ–≤—ñ —Ç–æ—á–∫–∏, —è–∫—ñ **–≤–∏–º–∞–≥–∞—é—Ç—å –¥—ñ–π—Å–Ω–∏–π API –∫–ª—é—á** –¥–ª—è –∫–æ–Ω—Ç–∞–∫—Ç—É –∑ –Ω–∏–º–∏.

<figure><img src="../../../.gitbook/assets/image (88).png" alt=""><figcaption></figcaption></figure>

–ú–æ–∂–ª–∏–≤–æ –≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏ API –∫–ª—é—á—ñ –≤ –ø–æ—Ä—Ç–∞–ª—ñ API Gateway —ñ –Ω–∞–≤—ñ—Ç—å –Ω–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏, —Å–∫—ñ–ª—å–∫–∏ —Ä–∞–∑—ñ–≤ —ó—Ö –º–æ–∂–Ω–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ (–≤ —Ç–µ—Ä–º—ñ–Ω–∞—Ö –∑–∞–ø–∏—Ç—ñ–≤ –Ω–∞ —Å–µ–∫—É–Ω–¥—É —Ç–∞ –≤ —Ç–µ—Ä–º—ñ–Ω–∞—Ö –∑–∞–ø–∏—Ç—ñ–≤ –Ω–∞ –º—ñ—Å—è—Ü—å).

–©–æ–± API –∫–ª—é—á –ø—Ä–∞—Ü—é–≤–∞–≤, –≤–∞–º –ø–æ—Ç—Ä—ñ–±–Ω–æ –¥–æ–¥–∞—Ç–∏ –π–æ–≥–æ –¥–æ **–ü–ª–∞–Ω—É –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è**, —Ü–µ–π –ø–ª–∞–Ω –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –ø–æ–≤–∏–Ω–µ–Ω –±—É—Ç–∏ –¥–æ–¥–∞–Ω–∏–π –¥–æ **API –°—Ç–∞–¥—ñ—ó**, –∞ –∞—Å–æ—Ü—ñ–π–æ–≤–∞–Ω–∞ API —Å—Ç–∞–¥—ñ—è –ø–æ–≤–∏–Ω–Ω–∞ –º–∞—Ç–∏ –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω–µ **–æ–±–º–µ–∂–µ–Ω–Ω—è –º–µ—Ç–æ–¥—ñ–≤** –¥–ª—è **–∫—ñ–Ω—Ü–µ–≤–æ—ó —Ç–æ—á–∫–∏**, —â–æ –≤–∏–º–∞–≥–∞—î API –∫–ª—é—á–∞:

<figure><img src="../../../.gitbook/assets/image (198).png" alt=""><figcaption></figcaption></figure>

## –ù–µ–∞–≤—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–æ–≤–∞–Ω–∏–π –¥–æ—Å—Ç—É–ø

{% content-ref url="../aws-unauthenticated-enum-access/aws-api-gateway-unauthenticated-enum.md" %}
[aws-api-gateway-unauthenticated-enum.md](../aws-unauthenticated-enum-access/aws-api-gateway-unauthenticated-enum.md)
{% endcontent-ref %}

## Privesc

{% content-ref url="../aws-privilege-escalation/aws-apigateway-privesc.md" %}
[aws-apigateway-privesc.md](../aws-privilege-escalation/aws-apigateway-privesc.md)
{% endcontent-ref %}

## –ü–æ—Å—Ç–µ–∫—Å–ø–ª—É–∞—Ç–∞—Ü—ñ—è

{% content-ref url="../aws-post-exploitation/aws-api-gateway-post-exploitation.md" %}
[aws-api-gateway-post-exploitation.md](../aws-post-exploitation/aws-api-gateway-post-exploitation.md)
{% endcontent-ref %}

## –ü–æ—Å—Ç—ñ–π–Ω—ñ—Å—Ç—å

{% content-ref url="../aws-persistence/aws-api-gateway-persistence.md" %}
[aws-api-gateway-persistence.md](../aws-persistence/aws-api-gateway-persistence.md)
{% endcontent-ref %}

{% hint style="success" %}
–í–∏–≤—á–∞–π—Ç–µ —Ç–∞ –ø—Ä–∞–∫—Ç–∏–∫—É–π—Ç–µ AWS Hacking:<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
–í–∏–≤—á–∞–π—Ç–µ —Ç–∞ –ø—Ä–∞–∫—Ç–∏–∫—É–π—Ç–µ GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>–ü—ñ–¥—Ç—Ä–∏–º–∞–π—Ç–µ HackTricks</summary>

* –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ [**–ø–ª–∞–Ω–∏ –ø—ñ–¥–ø–∏—Å–∫–∏**](https://github.com/sponsors/carlospolop)!
* **–ü—Ä–∏—î–¥–Ω—É–π—Ç–µ—Å—å –¥–æ** üí¨ [**–≥—Ä—É–ø–∏ Discord**](https://discord.gg/hRep4RUj7f) –∞–±–æ [**–≥—Ä—É–ø–∏ telegram**](https://t.me/peass) –∞–±–æ **—Å–ª—ñ–¥–∫—É–π—Ç–µ** –∑–∞ –Ω–∞–º–∏ –≤ **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **–î—ñ–ª—ñ—Ç—å—Å—è —Ö–∞–∫–µ—Ä—Å—å–∫–∏–º–∏ —Ç—Ä—é–∫–∞–º–∏, –Ω–∞–¥—Å–∏–ª–∞—é—á–∏ PR –¥–æ** [**HackTricks**](https://github.com/carlospolop/hacktricks) —Ç–∞ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—ó–≤.

</details>
{% endhint %}
