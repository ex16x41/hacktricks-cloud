# AWS - Relational Database (RDS) Enum

{% hint style="success" %}
Aprende y practica AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Aprende y practica GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Apoya HackTricks</summary>

* Revisa los [**planes de suscripci贸n**](https://github.com/sponsors/carlospolop)!
* **nete al**  [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s铆guenos** en **Twitter**  [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Comparte trucos de hacking enviando PRs a los repositorios de github de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
{% endhint %}

## Informaci贸n B谩sica

El **Relational Database Service (RDS)** ofrecido por AWS est谩 dise帽ado para simplificar el despliegue, operaci贸n y escalado de una **base de datos relacional en la nube**. Este servicio ofrece las ventajas de eficiencia de costos y escalabilidad mientras automatiza tareas laboriosas como la provisi贸n de hardware, configuraci贸n de bases de datos, parcheo y copias de seguridad.

AWS RDS soporta varios motores de bases de datos relacionales ampliamente utilizados, incluyendo MySQL, PostgreSQL, MariaDB, Oracle Database, Microsoft SQL Server y Amazon Aurora, con compatibilidad tanto para MySQL como para PostgreSQL.

Las caracter铆sticas clave de RDS incluyen:

* **Gesti贸n de instancias de bases de datos** simplificada.
* Creaci贸n de **r茅plicas de lectura** para mejorar el rendimiento de lectura.
* Configuraci贸n de **despliegues multi-Zona de Disponibilidad (AZ)** para asegurar alta disponibilidad y mecanismos de failover.
* **Integraci贸n** con otros servicios de AWS, tales como:
* AWS Identity and Access Management (**IAM**) para un control de acceso robusto.
* AWS **CloudWatch** para monitoreo y m茅tricas exhaustivas.
* AWS Key Management Service (**KMS**) para asegurar la encriptaci贸n en reposo.

## Credenciales

Al crear el cl煤ster de DB, se puede configurar el **nombre de usuario** maestro (**`admin`** por defecto). Para generar la contrase帽a de este usuario puedes:

* **Indicar** una **contrase帽a** t煤 mismo
* Decirle a RDS que la **genere autom谩ticamente**
* Decirle a RDS que la gestione en **AWS Secret Manager** encriptada con una clave KMS

<figure><img src="../../../.gitbook/assets/image (144).png" alt=""><figcaption></figcaption></figure>

### Autenticaci贸n

Hay 3 tipos de opciones de autenticaci贸n, pero usar la **contrase帽a maestra siempre est谩 permitido**:

<figure><img src="../../../.gitbook/assets/image (227).png" alt=""><figcaption></figcaption></figure>

### Acceso P煤blico y VPC

Por defecto **no se concede acceso p煤blico** a las bases de datos, sin embargo, **podr铆a concederse**. Por lo tanto, por defecto solo las m谩quinas del mismo VPC podr谩n acceder si el **grupo de seguridad** seleccionado (almacenado en EC2 SG) lo permite.

En lugar de exponer una instancia de DB, es posible crear un **RDS Proxy** que **mejora** la **escalabilidad** y **disponibilidad** del cl煤ster de DB.

Adem谩s, el **puerto de la base de datos tambi茅n puede ser modificado**.

### Encriptaci贸n

**La encriptaci贸n est谩 habilitada por defecto** usando una clave gestionada por AWS (se podr铆a elegir una CMK en su lugar).

Al habilitar tu encriptaci贸n, est谩s habilitando **encriptaci贸n en reposo para tu almacenamiento, snapshots, r茅plicas de lectura y tus copias de seguridad**. Las claves para gestionar esta encriptaci贸n pueden ser emitidas usando **KMS**.\
No es posible a帽adir este nivel de encriptaci贸n despu茅s de que tu base de datos haya sido creada. **Debe hacerse durante su creaci贸n**.

Sin embargo, hay una **soluci贸n alternativa que te permite encriptar una base de datos no encriptada de la siguiente manera**. Puedes crear un snapshot de tu base de datos no encriptada, crear una copia encriptada de ese snapshot, usar ese snapshot encriptado para crear una nueva base de datos, y luego, finalmente, tu base de datos estar铆a encriptada.

#### Encriptaci贸n Transparente de Datos (TDE)

Junto con las capacidades de encriptaci贸n inherentes a RDS a nivel de aplicaci贸n, RDS tambi茅n soporta **mecanismos adicionales de encriptaci贸n a nivel de plataforma** para proteger los datos en reposo. Esto incluye **Encriptaci贸n Transparente de Datos (TDE)** para Oracle y SQL Server. Sin embargo, es crucial notar que aunque TDE mejora la seguridad encriptando los datos en reposo, tambi茅n puede **afectar el rendimiento de la base de datos**. Este impacto en el rendimiento es especialmente notable cuando se usa junto con funciones criptogr谩ficas de MySQL o funciones criptogr谩ficas de Microsoft Transact-SQL.

Para utilizar TDE, se requieren ciertos pasos preliminares:

1. **Asociaci贸n de Grupo de Opciones**:
* La base de datos debe estar asociada con un grupo de opciones. Los grupos de opciones sirven como contenedores para configuraciones y caracter铆sticas, facilitando la gesti贸n de la base de datos, incluyendo mejoras de seguridad.
* Sin embargo, es importante notar que los grupos de opciones solo est谩n disponibles para motores de bases de datos y versiones espec铆ficas.
2. **Inclusi贸n de TDE en el Grupo de Opciones**:
* Una vez asociada con un grupo de opciones, la opci贸n de Encriptaci贸n Transparente de Datos de Oracle necesita ser incluida en ese grupo.
* Es esencial reconocer que una vez que la opci贸n TDE se a帽ade a un grupo de opciones, se convierte en una caracter铆stica permanente y no puede ser eliminada.
3. **Modos de Encriptaci贸n TDE**:
* TDE ofrece dos modos distintos de encriptaci贸n:
* **Encriptaci贸n de Tablespace TDE**: Este modo encripta tablas enteras, proporcionando un alcance m谩s amplio de protecci贸n de datos.
* **Encriptaci贸n de Columnas TDE**: Este modo se enfoca en encriptar elementos espec铆ficos e individuales dentro de la base de datos, permitiendo un control m谩s granular sobre qu茅 datos se encriptan.

Entender estos requisitos previos y las complejidades operativas de TDE es crucial para implementar y gestionar efectivamente la encriptaci贸n dentro de RDS, asegurando tanto la seguridad de los datos como el cumplimiento con los est谩ndares necesarios.

### Enumeraci贸n

{% code overflow="wrap" %}
```bash
# Clusters info
## Get Endpoints, username, port, iam auth enabled, attached roles, SG
aws rds describe-db-clusters
aws rds describe-db-cluster-endpoints #Cluster URLs
aws rds describe-db-cluster-backtracks --db-cluster-identifier <cluster-name>

## Cluster snapshots
aws rds describe-db-cluster-snapshots

# Get DB instances info
aws rds describe-db-instances #username, url, port, vpc, SG, is public?
aws rds describe-db-security-groups

## Find automated backups
aws rds describe-db-instance-automated-backups

## Find snapshots
aws rds describe-db-snapshots
aws rds describe-db-snapshots --include-public --snapshot-type public
## Restore snapshot as new instance
aws rds restore-db-instance-from-db-snapshot --db-instance-identifier <ID> --db-snapshot-identifier <ID> --availability-zone us-west-2a

# Any public snapshot in the account
aws rds describe-db-snapshots --snapshot-type public

# Proxies
aws rds describe-db-proxy-endpoints
aws rds describe-db-proxy-target-groups
aws rds describe-db-proxy-targets

## reset credentials of MasterUsername
aws rds modify-db-instance --db-instance-identifier <ID> --master-user-password <NewPassword> --apply-immediately
```
{% endcode %}

### Acceso No Autenticado

{% content-ref url="../aws-unauthenticated-enum-access/aws-rds-unauthenticated-enum.md" %}
[aws-rds-unauthenticated-enum.md](../aws-unauthenticated-enum-access/aws-rds-unauthenticated-enum.md)
{% endcontent-ref %}

### Privesc

{% content-ref url="../aws-privilege-escalation/aws-rds-privesc.md" %}
[aws-rds-privesc.md](../aws-privilege-escalation/aws-rds-privesc.md)
{% endcontent-ref %}

### Post Explotaci贸n

{% content-ref url="../aws-post-exploitation/aws-rds-post-exploitation.md" %}
[aws-rds-post-exploitation.md](../aws-post-exploitation/aws-rds-post-exploitation.md)
{% endcontent-ref %}

### Persistencia

{% content-ref url="../aws-persistence/aws-rds-persistence.md" %}
[aws-rds-persistence.md](../aws-persistence/aws-rds-persistence.md)
{% endcontent-ref %}

### Inyecci贸n SQL

Hay formas de acceder a los datos de DynamoDB con **sintaxis SQL**, por lo tanto, **tambi茅n son posibles las inyecciones SQL t铆picas**.

{% embed url="https://book.hacktricks.xyz/pentesting-web/sql-injection" %}

{% hint style="success" %}
Aprende y practica AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Aprende y practica GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Apoya HackTricks</summary>

* Revisa los [**planes de suscripci贸n**](https://github.com/sponsors/carlospolop)!
* **nete al**  [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s铆guenos** en **Twitter**  [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Comparte trucos de hacking enviando PRs a los repositorios de github de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
{% endhint %}
