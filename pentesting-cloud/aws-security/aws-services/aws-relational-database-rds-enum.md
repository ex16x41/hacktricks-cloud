# AWS - Relational Database (RDS) Enum

{% hint style="success" %}
Ucz si i wicz Hacking AWS:<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Ucz si i wicz Hacking GCP: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Wsparcie dla HackTricks</summary>

* Sprawd藕 [**plany subskrypcyjne**](https://github.com/sponsors/carlospolop)!
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **led藕** nas na **Twitterze**  [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podziel si trikami hackingowymi, przesyajc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repozytori贸w github.

</details>
{% endhint %}

## Podstawowe informacje

**Usuga Relacyjnej Bazy Danych (RDS)** oferowana przez AWS jest zaprojektowana w celu uproszczenia wdra偶ania, obsugi i skalowania **relacyjnej bazy danych w chmurze**. Usuga ta oferuje zalety efektywnoci kosztowej i skalowalnoci, automatyzujc pracochonne zadania, takie jak provisionowanie sprztu, konfiguracja bazy danych, atanie i tworzenie kopii zapasowych.

AWS RDS obsuguje r贸偶ne powszechnie u偶ywane silniki relacyjnych baz danych, w tym MySQL, PostgreSQL, MariaDB, Oracle Database, Microsoft SQL Server i Amazon Aurora, z kompatybilnoci zar贸wno dla MySQL, jak i PostgreSQL.

Kluczowe cechy RDS obejmuj:

* **Zarzdzanie instancjami bazy danych** jest uproszczone.
* Tworzenie **replik odczytu** w celu zwikszenia wydajnoci odczytu.
* Konfiguracja **wdro偶e w wielu strefach dostpnoci (AZ)** w celu zapewnienia wysokiej dostpnoci i mechanizm贸w przeczania awaryjnego.
* **Integracja** z innymi usugami AWS, takimi jak:
* AWS Identity and Access Management (**IAM**) dla solidnej kontroli dostpu.
* AWS **CloudWatch** dla kompleksowego monitorowania i metryk.
* AWS Key Management Service (**KMS**) w celu zapewnienia szyfrowania w spoczynku.

## Powiadczenia

Podczas tworzenia klastra DB g贸wny **nazwa u偶ytkownika** mo偶e by skonfigurowana (**`admin`** domylnie). Aby wygenerowa haso tego u偶ytkownika, mo偶esz:

* **Wskaza** **haso** samodzielnie
* Powiedzie RDS, aby **automatycznie wygenerowa** je
* Powiedzie RDS, aby zarzdza nim w **AWS Secret Manager** zaszyfrowanym kluczem KMS

<figure><img src="../../../.gitbook/assets/image (144).png" alt=""><figcaption></figcaption></figure>

### Uwierzytelnianie

Istniej 3 typy opcji uwierzytelniania, ale u偶ycie **g贸wnego hasa jest zawsze dozwolone**:

<figure><img src="../../../.gitbook/assets/image (227).png" alt=""><figcaption></figcaption></figure>

### Publiczny dostp i VPC

Domylnie **nie przyznaje si publicznego dostpu** do baz danych, jednak **mo偶e by przyznany**. Dlatego domylnie tylko maszyny z tej samej VPC bd mogy uzyska do niej dostp, jeli wybrana **grupa zabezpiecze** (przechowywana w EC2 SG) na to pozwala.

Zamiast nara偶a instancj DB, mo偶na utworzy **RDS Proxy**, kt贸ry **poprawia** **skalowalno** i **dostpno** klastra DB.

Ponadto **port bazy danych mo偶e by r贸wnie偶 modyfikowany**.

### Szyfrowanie

**Szyfrowanie jest wczone domylnie** przy u偶yciu zarzdzanego klucza AWS (mo偶na wybra zamiast tego CMK).

Wczajc swoje szyfrowanie, wczasz **szyfrowanie w spoczynku dla swojego przechowywania, migawk贸w, replik odczytu i kopii zapasowych**. Klucze do zarzdzania tym szyfrowaniem mog by wydawane przy u偶yciu **KMS**.\
Nie mo偶na doda tego poziomu szyfrowania po utworzeniu bazy danych. **Musisz to zrobi podczas jej tworzenia**.

Jednak istnieje **obejcie, kt贸re pozwala na szyfrowanie nieszyfrowanej bazy danych w nastpujcy spos贸b**. Mo偶esz utworzy migawk swojej nieszyfrowanej bazy danych, utworzy zaszyfrowan kopi tej migawki, u偶y tej zaszyfrowanej migawki do utworzenia nowej bazy danych, a nastpnie, w kocu, twoja baza danych bdzie zaszyfrowana.

#### Szyfrowanie danych w trybie przezroczystym (TDE)

Obok mo偶liwoci szyfrowania inherentnych dla RDS na poziomie aplikacji, RDS obsuguje r贸wnie偶 **dodatkowe mechanizmy szyfrowania na poziomie platformy**, aby chroni dane w spoczynku. Obejmuje to **Szyfrowanie Danych w Trybie Przezroczystym (TDE)** dla Oracle i SQL Server. Jednak wa偶ne jest, aby zauwa偶y, 偶e chocia偶 TDE zwiksza bezpieczestwo poprzez szyfrowanie danych w spoczynku, mo偶e r贸wnie偶 **wpywa na wydajno bazy danych**. Ten wpyw na wydajno jest szczeg贸lnie zauwa偶alny, gdy jest u偶ywany w poczeniu z funkcjami kryptograficznymi MySQL lub funkcjami kryptograficznymi Microsoft Transact-SQL.

Aby skorzysta z TDE, wymagane s pewne wstpne kroki:

1. **Stowarzyszenie grupy opcji**:
* Baza danych musi by powizana z grup opcji. Grupy opcji su偶 jako kontenery dla ustawie i funkcji, uatwiajc zarzdzanie baz danych, w tym ulepszenia bezpieczestwa.
* Jednak wa偶ne jest, aby zauwa偶y, 偶e grupy opcji s dostpne tylko dla okrelonych silnik贸w baz danych i wersji.
2. **Wczenie TDE w grupie opcji**:
* Po powizaniu z grup opcji, opcja Oracle Transparent Data Encryption musi by wczona w tej grupie.
* Wa偶ne jest, aby uzna, 偶e po dodaniu opcji TDE do grupy opcji staje si ona staym elementem i nie mo偶e by usunita.
3. **Tryby szyfrowania TDE**:
* TDE oferuje dwa odrbne tryby szyfrowania:
* **Szyfrowanie przestrzeni tabel TDE**: Ten tryb szyfruje cae tabele, zapewniajc szerszy zakres ochrony danych.
* **Szyfrowanie kolumn TDE**: Ten tryb koncentruje si na szyfrowaniu konkretnych, indywidualnych element贸w w bazie danych, co pozwala na bardziej szczeg贸ow kontrol nad tym, jakie dane s szyfrowane.

Zrozumienie tych wymaga wstpnych i operacyjnych zawirowa TDE jest kluczowe dla skutecznego wdra偶ania i zarzdzania szyfrowaniem w RDS, zapewniajc zar贸wno bezpieczestwo danych, jak i zgodno z niezbdnymi standardami.

### Enumeracja

{% code overflow="wrap" %}
```bash
# Clusters info
## Get Endpoints, username, port, iam auth enabled, attached roles, SG
aws rds describe-db-clusters
aws rds describe-db-cluster-endpoints #Cluster URLs
aws rds describe-db-cluster-backtracks --db-cluster-identifier <cluster-name>

## Cluster snapshots
aws rds describe-db-cluster-snapshots

# Get DB instances info
aws rds describe-db-instances #username, url, port, vpc, SG, is public?
aws rds describe-db-security-groups

## Find automated backups
aws rds describe-db-instance-automated-backups

## Find snapshots
aws rds describe-db-snapshots
aws rds describe-db-snapshots --include-public --snapshot-type public
## Restore snapshot as new instance
aws rds restore-db-instance-from-db-snapshot --db-instance-identifier <ID> --db-snapshot-identifier <ID> --availability-zone us-west-2a

# Any public snapshot in the account
aws rds describe-db-snapshots --snapshot-type public

# Proxies
aws rds describe-db-proxy-endpoints
aws rds describe-db-proxy-target-groups
aws rds describe-db-proxy-targets

## reset credentials of MasterUsername
aws rds modify-db-instance --db-instance-identifier <ID> --master-user-password <NewPassword> --apply-immediately
```
{% endcode %}

### Nieautoryzowany dostp

{% content-ref url="../aws-unauthenticated-enum-access/aws-rds-unauthenticated-enum.md" %}
[aws-rds-unauthenticated-enum.md](../aws-unauthenticated-enum-access/aws-rds-unauthenticated-enum.md)
{% endcontent-ref %}

### Privesc

{% content-ref url="../aws-privilege-escalation/aws-rds-privesc.md" %}
[aws-rds-privesc.md](../aws-privilege-escalation/aws-rds-privesc.md)
{% endcontent-ref %}

### Po eksploatacji

{% content-ref url="../aws-post-exploitation/aws-rds-post-exploitation.md" %}
[aws-rds-post-exploitation.md](../aws-post-exploitation/aws-rds-post-exploitation.md)
{% endcontent-ref %}

### Utrzymywanie

{% content-ref url="../aws-persistence/aws-rds-persistence.md" %}
[aws-rds-persistence.md](../aws-persistence/aws-rds-persistence.md)
{% endcontent-ref %}

### SQL Injection

Istniej sposoby na dostp do danych DynamoDB za pomoc **skadni SQL**, dlatego typowe **iniekcje SQL s r贸wnie偶 mo偶liwe**.

{% embed url="https://book.hacktricks.xyz/pentesting-web/sql-injection" %}

{% hint style="success" %}
Ucz si i wicz Hacking AWS:<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Ucz si i wicz Hacking GCP: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Wsparcie HackTricks</summary>

* Sprawd藕 [**plany subskrypcyjne**](https://github.com/sponsors/carlospolop)!
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **led藕** nas na **Twitterze**  [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Dziel si trikami hackingowymi, przesyajc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repozytori贸w na GitHubie.

</details>
{% endhint %}
