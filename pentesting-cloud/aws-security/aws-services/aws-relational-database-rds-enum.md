# AWS - Relational Database (RDS) Enum

{% hint style="success" %}
NauÄite i veÅ¾bajte AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
NauÄite i veÅ¾bajte GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>PodrÅ¾ite HackTricks</summary>

* Pogledajte [**planove pretplate**](https://github.com/sponsors/carlospolop)!
* **PridruÅ¾ite se** ğŸ’¬ [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili **pratite** nas na **Twitteru** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Delite hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
{% endhint %}

## Osnovne Informacije

**Relational Database Service (RDS)** koji nudi AWS je dizajniran da pojednostavi implementaciju, rad i skaliranje **relacione baze podataka u oblaku**. Ova usluga nudi prednosti troÅ¡kovne efikasnosti i skalabilnosti dok automatizuje radno intenzivne zadatke kao Å¡to su obezbeÄ‘ivanje hardvera, konfiguracija baze podataka, primena zakrpa i bekapovi.

AWS RDS podrÅ¾ava razliÄite Å¡iroko koriÅ¡Ä‡ene relacione baze podataka ukljuÄujuÄ‡i MySQL, PostgreSQL, MariaDB, Oracle Database, Microsoft SQL Server i Amazon Aurora, sa kompatibilnoÅ¡Ä‡u za MySQL i PostgreSQL.

KljuÄne karakteristike RDS-a ukljuÄuju:

* **Upravljanje instancama baze podataka** je pojednostavljeno.
* Kreiranje **read replika** za poboljÅ¡anje performansi Äitanja.
* Konfiguracija **multi-Availability Zone (AZ) implementacija** za osiguranje visoke dostupnosti i mehanizama za oporavak.
* **Integracija** sa drugim AWS uslugama, kao Å¡to su:
* AWS Identity and Access Management (**IAM**) za robusnu kontrolu pristupa.
* AWS **CloudWatch** za sveobuhvatno praÄ‡enje i metrike.
* AWS Key Management Service (**KMS**) za osiguranje enkripcije u mirovanju.

## Kredencijali

Kada kreirate DB klaster, master **korisniÄko ime** moÅ¾e biti konfigurisano (**`admin`** po defaultu). Da biste generisali lozinku za ovog korisnika moÅ¾ete:

* **Navesti** **lozinku** sami
* ReÄ‡i RDS-u da je **automatski generiÅ¡e**
* ReÄ‡i RDS-u da je upravlja u **AWS Secret Manager** Å¡ifrovano sa KMS kljuÄem

<figure><img src="../../../.gitbook/assets/image (144).png" alt=""><figcaption></figcaption></figure>

### Autentifikacija

Postoje 3 tipa opcija za autentifikaciju, ali koriÅ¡Ä‡enje **master lozinke je uvek dozvoljeno**:

<figure><img src="../../../.gitbook/assets/image (227).png" alt=""><figcaption></figcaption></figure>

### Javni Pristup & VPC

Po defaultu **nije dozvoljen javni pristup** bazama podataka, meÄ‘utim **moÅ¾e biti dozvoljen**. Dakle, po defaultu samo maÅ¡ine iz istog VPC-a Ä‡e moÄ‡i da pristupe ako odabrana **security group** (su pohranjene u EC2 SG) to dozvoljava.

Umesto izlaganja DB instance, moguÄ‡e je kreirati **RDS Proxy** koji **poboljÅ¡ava** **skalabilnost** i **dostupnost** DB klastera.

Pored toga, **port baze podataka moÅ¾e biti modifikovan** takoÄ‘e.

### Enkripcija

**Enkripcija je omoguÄ‡ena po defaultu** koristeÄ‡i AWS upravljani kljuÄ (moÅ¾e se izabrati CMK umesto toga).

OmoguÄ‡avanjem enkripcije, omoguÄ‡avate **enkripciju u mirovanju za vaÅ¡e skladiÅ¡te, snapshotove, read replike i vaÅ¡e bekapove**. KljuÄevi za upravljanje ovom enkripcijom mogu se izdati koriÅ¡Ä‡enjem **KMS-a**.\
Nije moguÄ‡e dodati ovaj nivo enkripcije nakon Å¡to je vaÅ¡a baza podataka kreirana. **Mora se uraditi tokom njenog kreiranja**.

MeÄ‘utim, postoji **zaobilazno reÅ¡enje koje vam omoguÄ‡ava da Å¡ifrujete neÅ¡ifrovanu bazu podataka na sledeÄ‡i naÄin**. MoÅ¾ete kreirati snapshot vaÅ¡e neÅ¡ifrovane baze podataka, kreirati Å¡ifrovanu kopiju tog snapshot-a, koristiti taj Å¡ifrovani snapshot za kreiranje nove baze podataka, i na kraju, vaÅ¡a baza podataka bi tada bila Å¡ifrovana.

#### Transparent Data Encryption (TDE)

Pored enkripcijskih moguÄ‡nosti inherentnih RDS-u na nivou aplikacije, RDS takoÄ‘e podrÅ¾ava **dodatne mehanizme enkripcije na nivou platforme** za zaÅ¡titu podataka u mirovanju. Ovo ukljuÄuje **Transparent Data Encryption (TDE)** za Oracle i SQL Server. MeÄ‘utim, vaÅ¾no je napomenuti da, iako TDE poboljÅ¡ava sigurnost Å¡ifrovanjem podataka u mirovanju, moÅ¾e takoÄ‘e **uticati na performanse baze podataka**. Ovaj uticaj na performanse je posebno primetan kada se koristi u kombinaciji sa MySQL kriptografskim funkcijama ili Microsoft Transact-SQL kriptografskim funkcijama.

Da biste koristili TDE, potrebni su odreÄ‘eni preliminarni koraci:

1. **Asocijacija sa Option Group**:
* Baza podataka mora biti povezana sa option group. Option group sluÅ¾e kao kontejneri za postavke i funkcije, olakÅ¡avajuÄ‡i upravljanje bazom podataka, ukljuÄujuÄ‡i sigurnosna poboljÅ¡anja.
* MeÄ‘utim, vaÅ¾no je napomenuti da su option group dostupne samo za odreÄ‘ene baze podataka i verzije.
2. **UkljuÄivanje TDE u Option Group**:
* Kada je povezana sa option group, Oracle Transparent Data Encryption opcija mora biti ukljuÄena u tu grupu.
* VaÅ¾no je prepoznati da kada je TDE opcija dodata u option group, postaje trajna i ne moÅ¾e se ukloniti.
3. **TDE Modovi Enkripcije**:
* TDE nudi dva razliÄita moda enkripcije:
* **TDE Tablespace Encryption**: Ovaj mod Å¡ifruje cele tabele, pruÅ¾ajuÄ‡i Å¡iru zaÅ¡titu podataka.
* **TDE Column Encryption**: Ovaj mod se fokusira na Å¡ifrovanje specifiÄnih, pojedinaÄnih elemenata unutar baze podataka, omoguÄ‡avajuÄ‡i detaljniju kontrolu nad time koji podaci su Å¡ifrovani.

Razumevanje ovih preduslova i operativnih sloÅ¾enosti TDE je kljuÄno za efikasno implementiranje i upravljanje enkripcijom unutar RDS-a, osiguravajuÄ‡i i sigurnost podataka i usklaÄ‘enost sa potrebnim standardima.

### Enumeracija

{% code overflow="wrap" %}
```bash
# Clusters info
## Get Endpoints, username, port, iam auth enabled, attached roles, SG
aws rds describe-db-clusters
aws rds describe-db-cluster-endpoints #Cluster URLs
aws rds describe-db-cluster-backtracks --db-cluster-identifier <cluster-name>

## Cluster snapshots
aws rds describe-db-cluster-snapshots

# Get DB instances info
aws rds describe-db-instances #username, url, port, vpc, SG, is public?
aws rds describe-db-security-groups

## Find automated backups
aws rds describe-db-instance-automated-backups

## Find snapshots
aws rds describe-db-snapshots
aws rds describe-db-snapshots --include-public --snapshot-type public
## Restore snapshot as new instance
aws rds restore-db-instance-from-db-snapshot --db-instance-identifier <ID> --db-snapshot-identifier <ID> --availability-zone us-west-2a

# Any public snapshot in the account
aws rds describe-db-snapshots --snapshot-type public

# Proxies
aws rds describe-db-proxy-endpoints
aws rds describe-db-proxy-target-groups
aws rds describe-db-proxy-targets

## reset credentials of MasterUsername
aws rds modify-db-instance --db-instance-identifier <ID> --master-user-password <NewPassword> --apply-immediately
```
{% endcode %}

### Neautentifikovani Pristup

{% content-ref url="../aws-unauthenticated-enum-access/aws-rds-unauthenticated-enum.md" %}
[aws-rds-unauthenticated-enum.md](../aws-unauthenticated-enum-access/aws-rds-unauthenticated-enum.md)
{% endcontent-ref %}

### Privesc

{% content-ref url="../aws-privilege-escalation/aws-rds-privesc.md" %}
[aws-rds-privesc.md](../aws-privilege-escalation/aws-rds-privesc.md)
{% endcontent-ref %}

### Post Eksploatacija

{% content-ref url="../aws-post-exploitation/aws-rds-post-exploitation.md" %}
[aws-rds-post-exploitation.md](../aws-post-exploitation/aws-rds-post-exploitation.md)
{% endcontent-ref %}

### Persistencija

{% content-ref url="../aws-persistence/aws-rds-persistence.md" %}
[aws-rds-persistence.md](../aws-persistence/aws-rds-persistence.md)
{% endcontent-ref %}

### SQL Injekcija

Postoje naÄini za pristup podacima u DynamoDB sa **SQL sintaksom**, stoga su tipiÄne **SQL injekcije takoÄ‘e moguÄ‡e**.

{% embed url="https://book.hacktricks.xyz/pentesting-web/sql-injection" %}

{% hint style="success" %}
NauÄite i veÅ¾bajte AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
NauÄite i veÅ¾bajte GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>PodrÅ¾ite HackTricks</summary>

* Pogledajte [**planove pretplate**](https://github.com/sponsors/carlospolop)!
* **PridruÅ¾ite se** ğŸ’¬ [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili **pratite** nas na **Twitteru** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Delite hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
{% endhint %}
