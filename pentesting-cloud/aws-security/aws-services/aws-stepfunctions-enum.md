# AWS - Step Functions Enum

<details>

<summary><strong>ä»é›¶å¼€å§‹å­¦ä¹ AWSé»‘å®¢æŠ€æœ¯ï¼Œæˆä¸ºä¸“å®¶</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTEï¼ˆHackTricks AWSçº¢é˜Ÿä¸“å®¶ï¼‰</strong></a><strong>ï¼</strong></summary>

æ”¯æŒHackTricksçš„å…¶ä»–æ–¹å¼ï¼š

* å¦‚æœæ‚¨æƒ³çœ‹åˆ°æ‚¨çš„**å…¬å¸åœ¨HackTricksä¸­åšå¹¿å‘Š**æˆ–**ä¸‹è½½PDFæ ¼å¼çš„HackTricks**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* è·å–[**å®˜æ–¹PEASS & HackTrickså‘¨è¾¹äº§å“**](https://peass.creator-spring.com)
* æ¢ç´¢[**PEASSå®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬çš„ç‹¬å®¶[**NFTs**](https://opensea.io/collection/the-peass-family)
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤**](https://discord.gg/hRep4RUj7f) æˆ– [**ç”µæŠ¥ç¾¤**](https://t.me/peass) æˆ–åœ¨**Twitter**ä¸Šå…³æ³¨æˆ‘ä»¬ ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**ã€‚**
* é€šè¿‡å‘[**HackTricks**](https://github.com/carlospolop/hacktricks)å’Œ[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) githubä»“åº“æäº¤PRæ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚

</details>

## Step Functions

AWS Step Functionsæ˜¯ä¸€é¡¹å·¥ä½œæµæœåŠ¡ï¼Œå¯è®©æ‚¨åè°ƒå’Œç¼–æ’å¤šä¸ªAWSæœåŠ¡ä»¥æ„å»ºæ— æœåŠ¡å™¨å·¥ä½œæµã€‚é€šè¿‡ä½¿ç”¨AWS Step Functionsï¼Œæ‚¨å¯ä»¥è®¾è®¡å’Œè¿è¡Œè¿æ¥å„ç§AWSæœåŠ¡ï¼ˆå¦‚AWS Lambdaã€Amazon S3ã€Amazon DynamoDBç­‰ï¼‰çš„å·¥ä½œæµï¼Œä»¥ä¸€ç³»åˆ—æ­¥éª¤çš„æ–¹å¼è¿›è¡Œã€‚è¿™ç§ç¼–æ’æœåŠ¡æä¾›äº†å¯è§†åŒ–å·¥ä½œæµç•Œé¢ï¼Œå¹¶æä¾›**çŠ¶æ€æœº**åŠŸèƒ½ï¼Œå…è®¸æ‚¨ä½¿ç”¨åŸºäºJSONçš„**Amazon States Language**ï¼ˆASLï¼‰ä»¥å£°æ˜æ€§æ–¹å¼å®šä¹‰å·¥ä½œæµçš„æ¯ä¸ªæ­¥éª¤ã€‚

AWS Step Functionsé€šè¿‡è‡ªåŠ¨ç®¡ç†åŸºç¡€æ¶æ„ã€å¤„ç†é‡è¯•ã€é”™è¯¯å’Œå¹¶è¡Œå¤„ç†ï¼Œç®€åŒ–äº†æ„å»ºå…·æœ‰å¼¹æ€§å’Œå¯ä¼¸ç¼©æ€§çš„åº”ç”¨ç¨‹åºçš„è¿‡ç¨‹ã€‚å®ƒç‰¹åˆ«é€‚ç”¨äºåˆ›å»ºæ¶‰åŠå¤šä¸ªæ­¥éª¤å’Œå†³ç­–ç‚¹çš„å¤æ‚å·¥ä½œæµï¼Œå› ä¸ºå®ƒå¯ä»¥è½»æ¾ç®¡ç†æ•°æ®æµå’Œæ‰§è¡ŒçŠ¶æ€è·¨æœåŠ¡çš„æµåŠ¨ã€‚é€šè¿‡è¯¥æœåŠ¡æ‰§è¡Œçš„ä¸»è¦ç”¨ä¾‹å¦‚ä¸‹ï¼š

- **æ•°æ®å¤„ç†**ï¼šæ–‡ä»¶ã€è§†é¢‘å’Œå›¾åƒå¤„ç†ï¼›æŠ½å–ã€è½¬æ¢å’ŒåŠ è½½ï¼ˆETLï¼‰ä½œä¸šï¼›æ‰¹å¤„ç†å’Œé«˜æ€§èƒ½è®¡ç®—ï¼ˆHPCï¼‰å·¥ä½œè´Ÿè½½ã€‚
- **æœºå™¨å­¦ä¹ **ï¼šæ¬ºè¯ˆæ£€æµ‹ã€å®šåˆ¶ã€æ¨èå’Œæ•°æ®å¢å¼ºã€‚
- **å¾®æœåŠ¡ç¼–æ’**ï¼šåŒæ­¥æˆ–å®æ—¶å·¥ä½œæµå’Œå®¹å™¨ç¼–æ’ã€‚
- **ITå’Œå®‰å…¨è‡ªåŠ¨åŒ–**ï¼šè‡ªåŠ¨ä¿®å¤ã€éƒ¨ç½²å’Œå“åº”ï¼›äººå·¥æ‰¹å‡†å’Œå‡çº§ã€‚

## å…³é”®æ¦‚å¿µ

### æ ‡å‡†å·¥ä½œæµä¸å¿«é€Ÿå·¥ä½œæµ

AWS Step Functionsæä¾›ä¸¤ç§**çŠ¶æ€æœºå·¥ä½œæµ**ç±»å‹ï¼šæ ‡å‡†å’Œå¿«é€Ÿã€‚

- **æ ‡å‡†å·¥ä½œæµ**ï¼šè¿™ç§é»˜è®¤å·¥ä½œæµç±»å‹é€‚ç”¨äºé•¿æ—¶é—´è¿è¡Œã€è€ç”¨ä¸”å¯å®¡è®¡çš„æµç¨‹ã€‚å®ƒæ”¯æŒ**ä»…æ‰§è¡Œä¸€æ¬¡**ï¼Œç¡®ä¿ä»»åŠ¡ä»…è¿è¡Œä¸€æ¬¡ï¼Œé™¤éæŒ‡å®šäº†é‡è¯•ã€‚é€‚ç”¨äºéœ€è¦è¯¦ç»†æ‰§è¡Œå†å²è®°å½•ä¸”å¯è¿è¡Œé•¿è¾¾ä¸€å¹´çš„å·¥ä½œæµã€‚
- **å¿«é€Ÿå·¥ä½œæµ**ï¼šè¿™ç§ç±»å‹é€‚ç”¨äºé«˜å®¹é‡ã€çŸ­æ—¶é—´ä»»åŠ¡ï¼Œè¿è¡Œæ—¶é—´é•¿è¾¾äº”åˆ†é’Ÿã€‚å®ƒæ”¯æŒ**è‡³å°‘æ‰§è¡Œä¸€æ¬¡**ï¼Œé€‚ç”¨äºå¹‚ç­‰ä»»åŠ¡ï¼ˆå¦‚æ•°æ®å¤„ç†ï¼‰ã€‚è¿™äº›å·¥ä½œæµé’ˆå¯¹æˆæœ¬å’Œæ€§èƒ½è¿›è¡Œäº†ä¼˜åŒ–ï¼Œæ ¹æ®æ‰§è¡Œæ¬¡æ•°ã€æŒç»­æ—¶é—´å’Œå†…å­˜ä½¿ç”¨é‡æ”¶è´¹ã€‚

### çŠ¶æ€

çŠ¶æ€æ˜¯çŠ¶æ€æœºçš„åŸºæœ¬å•å…ƒã€‚å®ƒä»¬å®šä¹‰å·¥ä½œæµä¸­çš„å„ä¸ªæ­¥éª¤ï¼Œå¯ä»¥æ ¹æ®å…¶ç±»å‹æ‰§è¡Œå„ç§åŠŸèƒ½ï¼š

- **ä»»åŠ¡**ï¼šæ‰§è¡Œä½œä¸šï¼Œé€šå¸¸ä½¿ç”¨AWSæœåŠ¡ï¼ˆå¦‚Lambdaï¼‰ã€‚
- **é€‰æ‹©**ï¼šæ ¹æ®è¾“å…¥è¿›è¡Œå†³ç­–ã€‚
- **å¤±è´¥/æˆåŠŸ**ï¼šä»¥å¤±è´¥æˆ–æˆåŠŸç»“æŸæ‰§è¡Œã€‚
- **ä¼ é€’**ï¼šå°†è¾“å…¥ä¼ é€’ç»™è¾“å‡ºæˆ–æ³¨å…¥æ•°æ®ã€‚
- **ç­‰å¾…**ï¼šå»¶è¿Ÿæ‰§è¡Œä¸€æ®µæ—¶é—´ã€‚
- **å¹¶è¡Œ**ï¼šå¯åŠ¨å¹¶è¡Œåˆ†æ”¯ã€‚
- **æ˜ å°„**ï¼šåŠ¨æ€è¿­ä»£é¡¹ç›®ä¸Šçš„æ­¥éª¤ã€‚

### ä»»åŠ¡

**ä»»åŠ¡**çŠ¶æ€è¡¨ç¤ºçŠ¶æ€æœºæ‰§è¡Œçš„å•ä¸ªå·¥ä½œå•å…ƒã€‚ä»»åŠ¡å¯ä»¥è°ƒç”¨å„ç§èµ„æºï¼ŒåŒ…æ‹¬æ´»åŠ¨ã€Lambdaå‡½æ•°ã€AWSæœåŠ¡æˆ–ç¬¬ä¸‰æ–¹APIã€‚

- **æ´»åŠ¨**ï¼šæ‚¨ç®¡ç†çš„è‡ªå®šä¹‰å·¥ä½œç¨‹åºï¼Œé€‚ç”¨äºé•¿æ—¶é—´è¿è¡Œçš„è¿›ç¨‹ã€‚
- èµ„æºï¼š**`arn:aws:states:region:account:activity:name`**ã€‚
- **Lambdaå‡½æ•°**ï¼šæ‰§è¡ŒAWS Lambdaå‡½æ•°ã€‚
- èµ„æºï¼š**`arn:aws:lambda:region:account:function:function-name`**ã€‚
- **AWSæœåŠ¡**ï¼šç›´æ¥ä¸å…¶ä»–AWSæœåŠ¡é›†æˆï¼Œå¦‚DynamoDBæˆ–S3ã€‚
- èµ„æºï¼š**`arn:partition:states:region:account:servicename:APIname`**ã€‚
- **HTTPä»»åŠ¡**ï¼šè°ƒç”¨ç¬¬ä¸‰æ–¹APIã€‚
- èµ„æºå­—æ®µï¼š**`arn:aws:states:::http:invoke`**ã€‚ç„¶åï¼Œæ‚¨åº”æä¾›APIç«¯ç‚¹é…ç½®è¯¦ç»†ä¿¡æ¯ï¼Œå¦‚API URLã€æ–¹æ³•å’Œèº«ä»½éªŒè¯è¯¦ç»†ä¿¡æ¯ã€‚

ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºäº†è°ƒç”¨åä¸ºHelloWorldçš„Lambdaå‡½æ•°çš„ä»»åŠ¡çŠ¶æ€å®šä¹‰ï¼š
```json
"HelloWorld": {
"Type": "Task",
"Resource": "arn:aws:states:::lambda:invoke",
"Parameters": {
"Payload.$": "$",
"FunctionName": "arn:aws:lambda:<region>:<account-id>:function:HelloWorld"
},
"End": true
}
```
### é€‰æ‹©

**é€‰æ‹©**çŠ¶æ€ä¸ºå·¥ä½œæµæ·»åŠ äº†æ¡ä»¶é€»è¾‘ï¼Œæ ¹æ®è¾“å…¥æ•°æ®è¿›è¡Œå†³ç­–ã€‚å®ƒè¯„ä¼°æŒ‡å®šçš„æ¡ä»¶ï¼Œå¹¶æ ¹æ®ç»“æœè½¬ç§»åˆ°ç›¸åº”çš„çŠ¶æ€ã€‚

- **æ¯”è¾ƒ**ï¼šæ¯ä¸ªé€‰æ‹©è§„åˆ™éƒ½åŒ…æ‹¬ä¸€ä¸ªæ¯”è¾ƒè¿ç®—ç¬¦ï¼ˆä¾‹å¦‚ï¼Œ**`NumericEquals`**ï¼Œ**`StringEquals`**ï¼‰ï¼Œç”¨äºå°†è¾“å…¥å˜é‡ä¸æŒ‡å®šå€¼æˆ–å¦ä¸€ä¸ªå˜é‡è¿›è¡Œæ¯”è¾ƒã€‚
- **ä¸‹ä¸€ä¸ªå­—æ®µ**ï¼šé€‰æ‹©çŠ¶æ€ä¸æ”¯æŒ**`End`**å­—æ®µï¼Œè€Œæ˜¯å®šä¹‰äº†å¦‚æœæ¯”è¾ƒä¸ºçœŸåˆ™è½¬ç§»åˆ°çš„**`Next`**çŠ¶æ€ã€‚

**é€‰æ‹©**çŠ¶æ€ç¤ºä¾‹ï¼š
```json
{
"Variable": "$.timeStamp",
"TimestampEquals": "2000-01-01T00:00:00Z",
"Next": "TimeState"
}
```
### å¤±è´¥/æˆåŠŸ

**`Fail`** çŠ¶æ€ä¼šåœæ­¢çŠ¶æ€æœºçš„æ‰§è¡Œå¹¶å°†å…¶æ ‡è®°ä¸ºå¤±è´¥ã€‚å®ƒç”¨äºæŒ‡å®šé”™è¯¯åç§°å’ŒåŸå› ï¼Œæä¾›æœ‰å…³å¤±è´¥çš„è¯¦ç»†ä¿¡æ¯ã€‚æ­¤çŠ¶æ€æ˜¯ç»ˆç«¯çŠ¶æ€ï¼Œæ„å‘³ç€å®ƒç»“æŸæ‰§è¡Œæµç¨‹ã€‚

**`Succeed`** çŠ¶æ€ä¼šæˆåŠŸåœ°åœæ­¢æ‰§è¡Œã€‚é€šå¸¸ç”¨äºåœ¨å·¥ä½œæµæˆåŠŸå®Œæˆæ—¶ç»ˆæ­¢å·¥ä½œæµç¨‹ã€‚æ­¤çŠ¶æ€ä¸éœ€è¦ **`Next`** å­—æ®µã€‚

{% tabs %}

{% tab title="å¤±è´¥ç¤ºä¾‹" %}
```json
"FailState": {
"Type": "Fail",
"Error": "ErrorName",
"Cause": "Error details"
}
```
{% endtab %}

{% tab title="æˆåŠŸç¤ºä¾‹" %}
```json
"SuccessState": {
"Type": "Succeed"
}
```
### é€šè¿‡

ä¸€ä¸ª**Pass**çŠ¶æ€å°†å…¶è¾“å…¥ä¼ é€’åˆ°è¾“å‡ºï¼Œå¯ä»¥æ˜¯ä¸æ‰§è¡Œä»»ä½•å·¥ä½œï¼Œä¹Ÿå¯ä»¥æ˜¯ä½¿ç”¨è¿‡æ»¤å™¨è½¬æ¢JSONçŠ¶æ€è¾“å…¥ï¼Œç„¶åå°†è½¬æ¢åçš„æ•°æ®ä¼ é€’ç»™ä¸‹ä¸€ä¸ªçŠ¶æ€ã€‚å®ƒå¯¹äºæµ‹è¯•å’Œæ„å»ºçŠ¶æ€æœºéå¸¸æœ‰ç”¨ï¼Œå…è®¸æ‚¨æ³¨å…¥é™æ€æ•°æ®æˆ–å¯¹å…¶è¿›è¡Œè½¬æ¢ã€‚
```json
"PassState": {
"Type": "Pass",
"Result": {"key": "value"},
"ResultPath": "$.newField",
"Next": "NextState"
}
```
### ç­‰å¾…

**ç­‰å¾…** çŠ¶æ€å»¶è¿ŸçŠ¶æ€æœºçš„æ‰§è¡Œä¸€æ®µæŒ‡å®šçš„æ—¶é—´ã€‚æœ‰ä¸‰ç§ä¸»è¦æ–¹æ³•æ¥é…ç½®ç­‰å¾…æ—¶é—´ï¼š

- **X ç§’**: ç­‰å¾…çš„å›ºå®šç§’æ•°ã€‚

```json
"WaitState": {
"Type": "Wait",
"Seconds": 10,
"Next": "NextState"
}
```

- **ç»å¯¹æ—¶é—´æˆ³**: ç­‰å¾…ç›´åˆ°æŒ‡å®šçš„ç¡®åˆ‡æ—¶é—´ã€‚

```json
"WaitState": {
"Type": "Wait",
"Timestamp": "2024-03-14T01:59:00Z",
"Next": "NextState"
}
```

- **åŠ¨æ€ç­‰å¾…**: åŸºäºè¾“å…¥ä½¿ç”¨ **`SecondsPath`** æˆ– **`TimestampPath`**ã€‚

```json
"WaitState": {
"Type": "Wait",
"TimestampPath": "$.expirydate",
"Next": "NextState"
}
```


### å¹¶è¡Œ

**å¹¶è¡Œ** çŠ¶æ€å…è®¸æ‚¨åœ¨å·¥ä½œæµç¨‹ä¸­åŒæ—¶æ‰§è¡Œå¤šä¸ªä»»åŠ¡åˆ†æ”¯ã€‚æ¯ä¸ªåˆ†æ”¯éƒ½ç‹¬ç«‹è¿è¡Œå¹¶å¤„ç†è‡ªå·±çš„çŠ¶æ€åºåˆ—ã€‚æ‰§è¡Œå°†ç­‰å¾…ç›´åˆ°æ‰€æœ‰åˆ†æ”¯å®Œæˆåå†ç»§ç»­åˆ°ä¸‹ä¸€ä¸ªçŠ¶æ€ã€‚å…¶å…³é”®å­—æ®µåŒ…æ‹¬ï¼š

- **åˆ†æ”¯**: å®šä¹‰å¹¶è¡Œæ‰§è¡Œè·¯å¾„çš„æ•°ç»„ã€‚æ¯ä¸ªåˆ†æ”¯æ˜¯ä¸€ä¸ªå•ç‹¬çš„çŠ¶æ€æœºã€‚
- **ResultPath**: å®šä¹‰å°†åˆ†æ”¯çš„ç»„åˆè¾“å‡ºæ”¾ç½®åœ¨è¾“å…¥ä¸­çš„ä½ç½®ã€‚
- **é‡è¯•å’Œæ•è·**: å¹¶è¡ŒçŠ¶æ€çš„é”™è¯¯å¤„ç†é…ç½®ã€‚
```json
"ParallelState": {
"Type": "Parallel",
"Branches": [
{
"StartAt": "Task1",
"States": { ... }
},
{
"StartAt": "Task2",
"States": { ... }
}
],
"Next": "NextState"
}
```
### æ˜ å°„

**æ˜ å°„**çŠ¶æ€ä½¿å¾—å¯ä»¥é’ˆå¯¹æ•°æ®é›†ä¸­çš„æ¯ä¸ªé¡¹ç›®æ‰§è¡Œä¸€ç»„æ­¥éª¤ã€‚å®ƒç”¨äºæ•°æ®çš„å¹¶è¡Œå¤„ç†ã€‚æ ¹æ®æ‚¨æƒ³è¦å¦‚ä½•å¤„ç†æ•°æ®é›†çš„é¡¹ç›®ï¼ŒStep Functionsæä¾›ä»¥ä¸‹æ¨¡å¼ï¼š

- **å†…è”æ¨¡å¼**ï¼šä¸ºæ¯ä¸ªJSONæ•°ç»„é¡¹ç›®æ‰§è¡Œä¸€éƒ¨åˆ†çŠ¶æ€ã€‚é€‚ç”¨äºå…·æœ‰å°‘äº40ä¸ªå¹¶è¡Œè¿­ä»£çš„å°è§„æ¨¡ä»»åŠ¡ï¼Œæ¯ä¸ªè¿­ä»£åœ¨åŒ…å«**`Map`**çŠ¶æ€çš„å·¥ä½œæµä¸Šä¸‹æ–‡ä¸­è¿è¡Œã€‚

```json
"MapState": {
"Type": "Map",
"ItemsPath": "$.arrayItems",
"ItemProcessor": {
"ProcessorConfig": {
"Mode": "INLINE"
},
"StartAt": "AddState",
"States": {
"AddState": {
"Type": "Task",
"Resource": "arn:aws:states:::lambda:invoke",
"OutputPath": "$.Payload",
"Parameters": {
"FunctionName": "arn:aws:lambda:<region>:<account-id>:function:add-function"
},
"End": true
}
}
},
"End": true
"ResultPath": "$.detail.added",
"ItemsPath": "$.added"
}
```

- **åˆ†å¸ƒå¼æ¨¡å¼**ï¼šè®¾è®¡ç”¨äºå…·æœ‰é«˜å¹¶å‘çš„å¤§è§„æ¨¡å¹¶è¡Œå¤„ç†ã€‚æ”¯æŒå¤„ç†å¤§å‹æ•°æ®é›†ï¼Œä¾‹å¦‚å­˜å‚¨åœ¨Amazon S3ä¸­çš„æ•°æ®ï¼Œå®ç°é«˜è¾¾10,000ä¸ªå¹¶è¡Œå­å·¥ä½œæµæ‰§è¡Œï¼Œå°†è¿™äº›å­å·¥ä½œæµä½œä¸ºå•ç‹¬çš„å­æ‰§è¡Œè¿è¡Œã€‚

```json
"DistributedMapState": {
"Type": "Map",
"ItemReader": {
"Resource": "arn:aws:states:::s3:getObject",
"Parameters": {
"Bucket": "my-bucket",
"Key": "data.csv"
}
},
"ItemProcessor": {
"ProcessorConfig": {
"Mode": "DISTRIBUTED",
"ExecutionType": "EXPRESS"
},
"StartAt": "ProcessItem",
"States": {
"ProcessItem": {
"Type": "Task",
"Resource": "arn:aws:lambda:region:account-id:function:my-function",
"End": true
}
}
},
"End": true
"ResultWriter": {
"Resource": "arn:aws:states:::s3:putObject",
"Parameters": {
"Bucket": "myOutputBucket",
"Prefix": "csvProcessJobs"
}
}
}
```


### ç‰ˆæœ¬å’Œåˆ«å

Step Functionsè¿˜å…è®¸é€šè¿‡çŠ¶æ€æœºçš„**ç‰ˆæœ¬**å’Œ**åˆ«å**ç®¡ç†å·¥ä½œæµéƒ¨ç½²ã€‚ç‰ˆæœ¬è¡¨ç¤ºå¯ä»¥æ‰§è¡Œçš„çŠ¶æ€æœºçš„å¿«ç…§ã€‚åˆ«åç”¨ä½œæŒ‡å‘çŠ¶æ€æœºæœ€å¤šä¸¤ä¸ªç‰ˆæœ¬çš„æŒ‡é’ˆã€‚

- **ç‰ˆæœ¬**ï¼šè¿™äº›ä¸å¯å˜çš„çŠ¶æ€æœºå¿«ç…§æ˜¯ä»è¯¥çŠ¶æ€æœºçš„æœ€æ–°ä¿®è®¢ç‰ˆåˆ›å»ºçš„ã€‚æ¯ä¸ªç‰ˆæœ¬ç”±å”¯ä¸€çš„ARNæ ‡è¯†ï¼Œè¯¥ARNå°†çŠ¶æ€æœºARNä¸ç‰ˆæœ¬å·ç»“åˆåœ¨ä¸€èµ·ï¼Œç”¨å†’å·åˆ†éš”ï¼ˆ**`arn:aws:states:region:account-id:stateMachine:StateMachineName:version-number`**ï¼‰ã€‚ç‰ˆæœ¬ä¸å¯ç¼–è¾‘ï¼Œä½†å¯ä»¥æ›´æ–°çŠ¶æ€æœºå¹¶å‘å¸ƒæ–°ç‰ˆæœ¬ï¼Œæˆ–ä½¿ç”¨æ‰€éœ€çš„çŠ¶æ€æœºç‰ˆæœ¬ã€‚
- **åˆ«å**ï¼šè¿™äº›æŒ‡é’ˆå¯ä»¥å¼•ç”¨åŒä¸€çŠ¶æ€æœºçš„æœ€å¤šä¸¤ä¸ªç‰ˆæœ¬ã€‚å¯ä»¥ä¸ºå•ä¸ªçŠ¶æ€æœºåˆ›å»ºå¤šä¸ªåˆ«åï¼Œæ¯ä¸ªåˆ«åç”±å°†çŠ¶æ€æœºARNä¸åˆ«ååç§°ç»“åˆåœ¨ä¸€èµ·æ„æˆçš„å”¯ä¸€ARNæ ‡è¯†ï¼Œç”¨å†’å·åˆ†éš”ï¼ˆ**`arn:aws:states:region:account-id:stateMachine:StateMachineName:aliasName`**ï¼‰ã€‚åˆ«åä½¿å¾—å¯ä»¥åœ¨ä¸¤ä¸ªçŠ¶æ€æœºç‰ˆæœ¬ä¸­çš„ä¸€ä¸ªä¹‹é—´è·¯ç”±æµé‡ã€‚æˆ–è€…ï¼Œåˆ«åå¯ä»¥æŒ‡å‘çŠ¶æ€æœºçš„ç‰¹å®šç‰ˆæœ¬ï¼Œä½†ä¸èƒ½æŒ‡å‘å…¶ä»–åˆ«åã€‚å¯ä»¥æ›´æ–°å®ƒä»¬ä»¥æ ¹æ®éœ€è¦é‡å®šå‘åˆ°çŠ¶æ€æœºçš„ä¸åŒç‰ˆæœ¬ï¼Œä¿ƒè¿›å—æ§éƒ¨ç½²å’Œå·¥ä½œæµç®¡ç†ã€‚

æœ‰å…³**ASL**çš„æ›´è¯¦ç»†ä¿¡æ¯ï¼Œè¯·æŸ¥çœ‹ï¼š[**Amazon States Language**](https://states-language.net/spec.html)ã€‚



## ç”¨äºçŠ¶æ€æœºçš„IAMè§’è‰²

AWS Step Functionsåˆ©ç”¨AWSèº«ä»½å’Œè®¿é—®ç®¡ç†ï¼ˆIAMï¼‰è§’è‰²æ¥æ§åˆ¶çŠ¶æ€æœºå†…èµ„æºå’Œæ“ä½œçš„è®¿é—®ã€‚ä»¥ä¸‹æ˜¯ä¸AWS Step Functionsä¸­çš„å®‰å…¨æ€§å’ŒIAMè§’è‰²ç›¸å…³çš„å…³é”®æ–¹é¢ï¼š

- **æ‰§è¡Œè§’è‰²**ï¼šAWS Step Functionsä¸­çš„æ¯ä¸ªçŠ¶æ€æœºéƒ½ä¸ä¸€ä¸ªIAMæ‰§è¡Œè§’è‰²ç›¸å…³è”ã€‚æ­¤è§’è‰²å®šä¹‰äº†çŠ¶æ€æœºå¯ä»¥ä»£è¡¨æ‚¨æ‰§è¡Œçš„æ“ä½œã€‚å½“çŠ¶æ€æœºåœ¨ä¸AWSæœåŠ¡äº¤äº’çš„çŠ¶æ€ä¹‹é—´è½¬æ¢æ—¶ï¼ˆå¦‚è°ƒç”¨Lambdaå‡½æ•°ã€è®¿é—®DynamoDBç­‰ï¼‰ï¼Œå®ƒä¼šå‡å®šæ­¤æ‰§è¡Œè§’è‰²æ¥æ‰§è¡Œè¿™äº›æ“ä½œã€‚
- **æƒé™**ï¼šIAMæ‰§è¡Œè§’è‰²å¿…é¡»é…ç½®å…·æœ‰å…è®¸åœ¨å…¶ä»–AWSæœåŠ¡ä¸Šæ‰§è¡Œå¿…è¦æ“ä½œçš„æƒé™ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨çš„çŠ¶æ€æœºéœ€è¦è°ƒç”¨AWS Lambdaå‡½æ•°ï¼Œåˆ™IAMè§’è‰²å¿…é¡»å…·æœ‰**`lambda:InvokeFunction`**æƒé™ã€‚åŒæ ·ï¼Œå¦‚æœéœ€è¦å†™å…¥DynamoDBï¼Œåˆ™å¿…é¡»æˆäºˆé€‚å½“çš„æƒé™ï¼ˆ**`dynamodb:PutItem`**ã€**`dynamodb:UpdateItem`**ç­‰ï¼‰ã€‚
- **æœ€å°æƒé™åŸåˆ™**ï¼šå»ºè®®åœ¨ä¸ºStep Functionsé…ç½®IAMè§’è‰²æ—¶éµå¾ªæœ€å°æƒé™åŸåˆ™ã€‚è¿™æ„å‘³ç€ä»…æˆäºˆçŠ¶æ€æœºæ‰§è¡Œå…¶ç‰¹å®šæ“ä½œæ‰€éœ€çš„æƒé™ï¼Œè€Œä¸å¤šä½™ã€‚IAMç­–ç•¥åº”é™å®šäºç‰¹å®šèµ„æºå’Œæ“ä½œï¼Œå‡å°‘æ„å¤–è®¿é—®çš„é£é™©ã€‚

## æšä¸¾

ReadOnlyAccessç­–ç•¥è¶³ä»¥æ‰§è¡Œä»¥ä¸‹æ‰€æœ‰æšä¸¾æ“ä½œã€‚
```bash
# State machines #

## List state machines
aws stepfunctions list-state-machines
## Retrieve informatio about the specified state machine
aws stepfunctions describe-state-machine --state-machine-arn <value>

## List verions for the specified state machine
aws stepfunctions list-state-machine-versions --state-machine-arn <value>
## List aliases for the specified state machine
aws stepfunctions list-state-machine-aliases --state-machine-arn <value>
## Retrieve informatio about the specified state machine alias
aws stepfunctions describe-state-machine-alias --state-machine-alias-arn <value>

## List executions of a state machine
aws stepfunctions list-executions --state-machine-arn <value> [--status-filter <RUNNING | SUCCEEDED | FAILED | TIMED_OUT | ABORTED | PENDING_REDRIVE>] [--redrive-filter <REDRIVEN | NOT_REDRIVEN>]
## Retrieve information and relevant metadata about a state machine execution
aws stepfunctions describe-execution --execution-arn <value>
## Retrieve information about the state machine associated to the specified execution
aws stepfunctions describe-state-machine-for-execution --execution-arn <value>
## Retrieve the history of the specified execution as a list of events
aws stepfunctions get-execution-history --execution-arn <value> [--reverse-order | --no-reverse-order] [--include-execution-data | --no-include-execution-data]

## List tags for the specified Ste Functions resource
aws stepfunctions list-tags-for-resource --resource-arn <value>

## Validate the definition of a state machine without creating the resource
aws stepfunctions validate-state-machine-definition --definition <value> [--type <STANDARD | EXPRESS>]

# Activities #

## List existing activities
aws stepfunctions list-activities
## Retrieve information about the specified activity
aws stepfunctions describe-activity --activity-arn <value>

# Map Runs #

## List map runs of an execution
aws stepfunctions list-map-runs --execution-arn <value>
## Provide information about the configuration, progress and results of a Map Run
aws stepfunctions describe-map-run --map-run-arn <value>
## Lists executions of a Map Run
aws stepfunctions list-executions --map-run-arn <value> [--status-filter <RUNNING | SUCCEEDED | FAILED | TIMED_OUT | ABORTED | PENDING_REDRIVE>] [--redrive-filter <REDRIVEN | NOT_REDRIVEN>]
```
## ææƒ

åœ¨ä¸‹é¢çš„é¡µé¢ä¸­ï¼Œæ‚¨å¯ä»¥æŸ¥çœ‹å¦‚ä½•**æ»¥ç”¨ Step Functions æƒé™ä»¥æå‡ç‰¹æƒ**ï¼š

{% content-ref url="../aws-privilege-escalation/aws-stepfunctions-privesc.md" %}
[aws-stepfunctions-privesc.md](../aws-privilege-escalation/aws-stepfunctions-privesc.md)
{% endcontent-ref %}

## åæ¸—é€

{% content-ref url="../aws-post-exploitation/aws-stepfunctions-post-exploitation/" %}
[aws-stepfunctions-post-exploitation](../aws-post-exploitation/aws-stepfunctions-post-exploitation/)
{% endcontent-ref %}

# å‚è€ƒèµ„æ–™

* [https://docs.aws.amazon.com/service-authorization/latest/reference/list_awsstepfunctions.html](https://docs.aws.amazon.com/service-authorization/latest/reference/list_awsstepfunctions.html)
* [https://docs.aws.amazon.com/step-functions/latest/dg/welcome.html](https://docs.aws.amazon.com/step-functions/latest/dg/welcome.html)
* [https://states-language.net/spec.html](https://states-language.net/spec.html)

<details>

<summary><strong>ä»é›¶å¼€å§‹å­¦ä¹  AWS é»‘å®¢æŠ€æœ¯ï¼Œæˆä¸ºä¸“å®¶</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

æ”¯æŒ HackTricks çš„å…¶ä»–æ–¹å¼ï¼š

* å¦‚æœæ‚¨æƒ³çœ‹åˆ°æ‚¨çš„**å…¬å¸åœ¨ HackTricks ä¸­åšå¹¿å‘Š**æˆ–**ä¸‹è½½ PDF ç‰ˆæœ¬çš„ HackTricks**ï¼Œè¯·æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* è·å–[**å®˜æ–¹ PEASS & HackTricks å•†å“**](https://peass.creator-spring.com)
* æ¢ç´¢[**PEASS å®¶æ—**](https://opensea.io/collection/the-peass-family)ï¼Œæˆ‘ä»¬çš„ç‹¬å®¶[**NFTs**](https://opensea.io/collection/the-peass-family)
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**ç”µæŠ¥ç¾¤ç»„**](https://t.me/peass) æˆ–åœ¨ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** ä¸Šå…³æ³¨æˆ‘ä»¬ã€‚**
* é€šè¿‡å‘ [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ä»“åº“æäº¤ PR æ¥åˆ†äº«æ‚¨çš„é»‘å®¢æŠ€å·§ã€‚

</details>
