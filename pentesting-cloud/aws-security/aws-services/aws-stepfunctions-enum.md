# AWS - Step Functions Enum

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Step Functions

AWS Step FunctionsëŠ” ì—¬ëŸ¬ AWS ì„œë¹„ìŠ¤ë¥¼ ì„œë²„ë¦¬ìŠ¤ ì›Œí¬í”Œë¡œë¡œ ì¡°ì •í•˜ê³  ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜í•  ìˆ˜ ìˆëŠ” ì›Œí¬í”Œë¡œ ì„œë¹„ìŠ¤ì…ë‹ˆë‹¤. AWS Step Functionsë¥¼ ì‚¬ìš©í•˜ë©´ AWS Lambda, Amazon S3, Amazon DynamoDB ë“± ë‹¤ì–‘í•œ AWS ì„œë¹„ìŠ¤ë¥¼ ì—°ê²°í•˜ëŠ” ì›Œí¬í”Œë¡œë¥¼ ì„¤ê³„í•˜ê³  ì‹¤í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜ ì„œë¹„ìŠ¤ëŠ” ì‹œê°ì  ì›Œí¬í”Œë¡œ ì¸í„°í˜ì´ìŠ¤ë¥¼ ì œê³µí•˜ë©°, JSON ê¸°ë°˜ì˜ **Amazon States Language** (ASL)ë¥¼ ì‚¬ìš©í•˜ì—¬ ì›Œí¬í”Œë¡œì˜ ê° ë‹¨ê³„ë¥¼ ì„ ì–¸ì ìœ¼ë¡œ ì •ì˜í•  ìˆ˜ ìˆëŠ” **ìƒíƒœ ê¸°ê³„** ê¸°ëŠ¥ì„ ì œê³µí•©ë‹ˆë‹¤.

AWS Step FunctionsëŠ” ê¸°ë³¸ ì¸í”„ë¼ë¥¼ ê´€ë¦¬í•˜ê³ , ì¬ì‹œë„, ì˜¤ë¥˜ ì²˜ë¦¬ ë° ë³‘ë ¬ ì²˜ë¦¬ë¥¼ ìë™ìœ¼ë¡œ ì²˜ë¦¬í•˜ì—¬ ë³µì›ë ¥ ìˆê³  í™•ì¥ ê°€ëŠ¥í•œ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ êµ¬ì¶•í•˜ëŠ” ê³¼ì •ì„ ë‹¨ìˆœí™”í•©ë‹ˆë‹¤. ì—¬ëŸ¬ ë‹¨ê³„ì™€ ì˜ì‚¬ ê²°ì • ì§€ì ì„ í¬í•¨í•˜ëŠ” ë³µì¡í•œ ì›Œí¬í”Œë¡œë¥¼ ìƒì„±í•˜ëŠ” ë° íŠ¹íˆ ìœ ìš©í•˜ë©°, ì„œë¹„ìŠ¤ ê°„ ë°ì´í„° íë¦„ê³¼ ì‹¤í–‰ ìƒíƒœë¥¼ ì‰½ê²Œ ê´€ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ ì„œë¹„ìŠ¤ê°€ ìˆ˜í–‰í•  ì£¼ìš” ì‚¬ìš© ì‚¬ë¡€ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤:

- **ë°ì´í„° ì²˜ë¦¬**: íŒŒì¼, ë¹„ë””ì˜¤ ë° ì´ë¯¸ì§€ ì²˜ë¦¬; ì‘ì—…ì˜ ì¶”ì¶œ, ë³€í™˜ ë° ë¡œë“œ (ETL); ë°°ì¹˜ ì²˜ë¦¬ ë° ê³ ì„±ëŠ¥ ì»´í“¨íŒ… (HPC) ì›Œí¬ë¡œë“œ.
- **ë¨¸ì‹  ëŸ¬ë‹**: ì‚¬ê¸° íƒì§€, ë§ì¶¤í™”, ì¶”ì²œ ë° ë°ì´í„° ê°•í™”.
- **ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜**: ë™ê¸°ì‹ ë˜ëŠ” ì‹¤ì‹œê°„ ì›Œí¬í”Œë¡œ ë° ì»¨í…Œì´ë„ˆ ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜.
- **IT ë° ë³´ì•ˆ ìë™í™”**: ìë™ ë³µêµ¬, ë°°í¬ ë° ì‘ë‹µ; ì¸ê°„ ìŠ¹ì¸ ë° ì—ìŠ¤ì»¬ë ˆì´ì…˜.

## ì£¼ìš” ê°œë…

### Standard vs. Express Workflows

AWS Step FunctionsëŠ” ë‘ ê°€ì§€ ìœ í˜•ì˜ **ìƒíƒœ ê¸°ê³„ ì›Œí¬í”Œë¡œ**ë¥¼ ì œê³µí•©ë‹ˆë‹¤: Standardì™€ Express.

- **Standard Workflow**: ì´ ê¸°ë³¸ ì›Œí¬í”Œë¡œ ìœ í˜•ì€ ì¥ê¸° ì‹¤í–‰, ë‚´êµ¬ì„± ë° ê°ì‚¬ ê°€ëŠ¥í•œ í”„ë¡œì„¸ìŠ¤ë¥¼ ìœ„í•´ ì„¤ê³„ë˜ì—ˆìŠµë‹ˆë‹¤. **ì •í™•íˆ í•œ ë²ˆ ì‹¤í–‰**ì„ ì§€ì›í•˜ì—¬ ì¬ì‹œë„ê°€ ì§€ì •ë˜ì§€ ì•ŠëŠ” í•œ ì‘ì—…ì´ í•œ ë²ˆë§Œ ì‹¤í–‰ë˜ë„ë¡ ë³´ì¥í•©ë‹ˆë‹¤. ìì„¸í•œ ì‹¤í–‰ ê¸°ë¡ì´ í•„ìš”í•œ ì›Œí¬í”Œë¡œì— ì´ìƒì ì´ë©° ìµœëŒ€ 1ë…„ ë™ì•ˆ ì‹¤í–‰ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- **Express Workflow**: ì´ ìœ í˜•ì€ ìµœëŒ€ 5ë¶„ ë™ì•ˆ ì‹¤í–‰ë˜ëŠ” ê³ ìš©ëŸ‰, ë‹¨ê¸° ì‘ì—…ì— ì´ìƒì ì…ë‹ˆë‹¤. **ìµœì†Œ í•œ ë²ˆ ì‹¤í–‰**ì„ ì§€ì›í•˜ì—¬ ë°ì´í„° ì²˜ë¦¬ì™€ ê°™ì€ ë©±ë“± ì‘ì—…ì— ì í•©í•©ë‹ˆë‹¤. ì´ëŸ¬í•œ ì›Œí¬í”Œë¡œëŠ” ì‹¤í–‰, ì§€ì† ì‹œê°„ ë° ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ì„ ê¸°ì¤€ìœ¼ë¡œ ë¹„ìš©ê³¼ ì„±ëŠ¥ì„ ìµœì í™”í•©ë‹ˆë‹¤.

### States

StatesëŠ” ìƒíƒœ ê¸°ê³„ì˜ ê¸°ë³¸ ë‹¨ìœ„ì…ë‹ˆë‹¤. ì›Œí¬í”Œë¡œ ë‚´ì˜ ê°œë³„ ë‹¨ê³„ë¥¼ ì •ì˜í•˜ë©°, ìœ í˜•ì— ë”°ë¼ ë‹¤ì–‘í•œ ê¸°ëŠ¥ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

- **Task:** ì£¼ë¡œ AWS ì„œë¹„ìŠ¤(Lambda ë“±)ë¥¼ ì‚¬ìš©í•˜ì—¬ ì‘ì—…ì„ ì‹¤í–‰í•©ë‹ˆë‹¤.
- **Choice:** ì…ë ¥ì— ë”°ë¼ ê²°ì •ì„ ë‚´ë¦½ë‹ˆë‹¤.
- **Fail/Succeed:** ì‹¤íŒ¨ ë˜ëŠ” ì„±ê³µìœ¼ë¡œ ì‹¤í–‰ì„ ì¢…ë£Œí•©ë‹ˆë‹¤.
- **Pass:** ì…ë ¥ì„ ì¶œë ¥ìœ¼ë¡œ ì „ë‹¬í•˜ê±°ë‚˜ ë°ì´í„°ë¥¼ ì£¼ì…í•©ë‹ˆë‹¤.
- **Wait:** ì„¤ì •ëœ ì‹œê°„ ë™ì•ˆ ì‹¤í–‰ì„ ì§€ì—°ì‹œí‚µë‹ˆë‹¤.
- **Parallel:** ë³‘ë ¬ ë¶„ê¸°ë¥¼ ì‹œì‘í•©ë‹ˆë‹¤.
- **Map:** í•­ëª©ì„ í†µí•´ ë‹¨ê³„ë¥¼ ë™ì ìœ¼ë¡œ ë°˜ë³µí•©ë‹ˆë‹¤.

### Task

**Task** ìƒíƒœëŠ” ìƒíƒœ ê¸°ê³„ì— ì˜í•´ ì‹¤í–‰ë˜ëŠ” ë‹¨ì¼ ì‘ì—… ë‹¨ìœ„ë¥¼ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤. TasksëŠ” í™œë™, Lambda í•¨ìˆ˜, AWS ì„œë¹„ìŠ¤ ë˜ëŠ” íƒ€ì‚¬ APIë¥¼ í¬í•¨í•œ ë‹¤ì–‘í•œ ë¦¬ì†ŒìŠ¤ë¥¼ í˜¸ì¶œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

- **Activities**: ì¥ê¸° ì‹¤í–‰ í”„ë¡œì„¸ìŠ¤ì— ì í•©í•œ ì‚¬ìš©ì ê´€ë¦¬ ì‘ì—…ì.
- Resource: **`arn:aws:states:region:account:activity:name`**.
- **Lambda Functions**: AWS Lambda í•¨ìˆ˜ë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤.
- Resource: **`arn:aws:lambda:region:account:function:function-name`**.
- **AWS Services**: DynamoDB ë˜ëŠ” S3ì™€ ê°™ì€ ë‹¤ë¥¸ AWS ì„œë¹„ìŠ¤ì™€ ì§ì ‘ í†µí•©í•©ë‹ˆë‹¤.
- Resource: **`arn:partition:states:region:account:servicename:APIname`**.
- **HTTP Task**: íƒ€ì‚¬ APIë¥¼ í˜¸ì¶œí•©ë‹ˆë‹¤.
- Resource field: **`arn:aws:states:::http:invoke`**. ê·¸ëŸ° ë‹¤ìŒ API URL, ë©”ì„œë“œ ë° ì¸ì¦ ì„¸ë¶€ ì •ë³´ì™€ ê°™ì€ API ì—”ë“œí¬ì¸íŠ¸ êµ¬ì„± ì„¸ë¶€ ì •ë³´ë¥¼ ì œê³µí•´ì•¼ í•©ë‹ˆë‹¤.

ë‹¤ìŒ ì˜ˆì œëŠ” HelloWorldë¼ëŠ” Lambda í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ëŠ” Task ìƒíƒœ ì •ì˜ë¥¼ ë³´ì—¬ì¤ë‹ˆë‹¤:
```json
"HelloWorld": {
"Type": "Task",
"Resource": "arn:aws:states:::lambda:invoke",
"Parameters": {
"Payload.$": "$",
"FunctionName": "arn:aws:lambda:<region>:<account-id>:function:HelloWorld"
},
"End": true
}
```
### Choice

**Choice** ìƒíƒœëŠ” ì…ë ¥ ë°ì´í„°ì— ê¸°ë°˜í•œ ê²°ì •ì„ ê°€ëŠ¥í•˜ê²Œ í•˜ì—¬ ì›Œí¬í”Œë¡œì— ì¡°ê±´ë¶€ ë…¼ë¦¬ë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤. ì§€ì •ëœ ì¡°ê±´ì„ í‰ê°€í•˜ê³  ê²°ê³¼ì— ë”°ë¼ í•´ë‹¹ ìƒíƒœë¡œ ì „í™˜í•©ë‹ˆë‹¤.

- **Comparison**: ê° ì„ íƒ ê·œì¹™ì—ëŠ” ì…ë ¥ ë³€ìˆ˜ë¥¼ ì§€ì •ëœ ê°’ ë˜ëŠ” ë‹¤ë¥¸ ë³€ìˆ˜ì™€ ë¹„êµí•˜ëŠ” ë¹„êµ ì—°ì‚°ì(ì˜ˆ: **`NumericEquals`**, **`StringEquals`**)ê°€ í¬í•¨ë©ë‹ˆë‹¤.
- **Next Field**: Choice ìƒíƒœëŠ” **`End`** í•„ë“œë¥¼ ì§€ì›í•˜ì§€ ì•Šìœ¼ë©°, ëŒ€ì‹  ë¹„êµê°€ ì°¸ì¼ ê²½ìš° ì „í™˜í•  **`Next`** ìƒíƒœë¥¼ ì •ì˜í•©ë‹ˆë‹¤.

**Choice** ìƒíƒœì˜ ì˜ˆ:
```json
{
"Variable": "$.timeStamp",
"TimestampEquals": "2000-01-01T00:00:00Z",
"Next": "TimeState"
}
```
### Fail/Succeed

**`Fail`** ìƒíƒœëŠ” ìƒíƒœ ë¨¸ì‹ ì˜ ì‹¤í–‰ì„ ì¤‘ì§€í•˜ê³  ì‹¤íŒ¨ë¡œ í‘œì‹œí•©ë‹ˆë‹¤. ì´ëŠ” ì˜¤ë¥˜ ì´ë¦„ê³¼ ì›ì¸ì„ ì§€ì •í•˜ì—¬ ì‹¤íŒ¨ì— ëŒ€í•œ ì„¸ë¶€ ì •ë³´ë¥¼ ì œê³µí•©ë‹ˆë‹¤. ì´ ìƒíƒœëŠ” ì¢…ë£Œ ìƒíƒœë¡œ, ì‹¤í–‰ íë¦„ì„ ëëƒ…ë‹ˆë‹¤.

**`Succeed`** ìƒíƒœëŠ” ì‹¤í–‰ì„ ì„±ê³µì ìœ¼ë¡œ ì¤‘ì§€í•©ë‹ˆë‹¤. ì¼ë°˜ì ìœ¼ë¡œ ì›Œí¬í”Œë¡œê°€ ì„±ê³µì ìœ¼ë¡œ ì™„ë£Œë  ë•Œ ì¢…ë£Œí•˜ëŠ” ë° ì‚¬ìš©ë©ë‹ˆë‹¤. ì´ ìƒíƒœëŠ” **`Next`** í•„ë“œë¥¼ í•„ìš”ë¡œ í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.

{% tabs %}

{% tab title="Fail example" %}
```json
"FailState": {
"Type": "Fail",
"Error": "ErrorName",
"Cause": "Error details"
}
```
{% endtab %}

{% tab title="Succeed example" %}
```json
"SuccessState": {
"Type": "Succeed"
}
```
{% endtab %}

{% endtabs %}

### Pass

**Pass** ìƒíƒœëŠ” ì‘ì—…ì„ ìˆ˜í–‰í•˜ì§€ ì•Šê±°ë‚˜ JSON ìƒíƒœ ì…ë ¥ì„ í•„í„°ë¥¼ ì‚¬ìš©í•˜ì—¬ ë³€í™˜í•œ í›„ ì…ë ¥ì„ ì¶œë ¥ìœ¼ë¡œ ì „ë‹¬í•©ë‹ˆë‹¤. ê·¸ëŸ° ë‹¤ìŒ ë³€í™˜ëœ ë°ì´í„°ë¥¼ ë‹¤ìŒ ìƒíƒœë¡œ ì „ë‹¬í•©ë‹ˆë‹¤. ì´ëŠ” ìƒíƒœ ë¨¸ì‹ ì„ í…ŒìŠ¤íŠ¸í•˜ê³  êµ¬ì„±í•˜ëŠ” ë° ìœ ìš©í•˜ë©°, ì •ì  ë°ì´í„°ë¥¼ ì£¼ì…í•˜ê±°ë‚˜ ë³€í™˜í•  ìˆ˜ ìˆê²Œ í•´ì¤ë‹ˆë‹¤.
```json
"PassState": {
"Type": "Pass",
"Result": {"key": "value"},
"ResultPath": "$.newField",
"Next": "NextState"
}
```
### Wait

**Wait** ìƒíƒœëŠ” ìƒíƒœ ë¨¸ì‹ ì˜ ì‹¤í–‰ì„ ì§€ì •ëœ ê¸°ê°„ ë™ì•ˆ ì§€ì—°ì‹œí‚µë‹ˆë‹¤. ëŒ€ê¸° ì‹œê°„ì„ êµ¬ì„±í•˜ëŠ” ì£¼ìš” ë°©ë²•ì€ ì„¸ ê°€ì§€ê°€ ìˆìŠµë‹ˆë‹¤:

- **X Seconds**: ê³ ì •ëœ ì´ˆ ë‹¨ìœ„ ëŒ€ê¸° ì‹œê°„.

```json
"WaitState": {
"Type": "Wait",
"Seconds": 10,
"Next": "NextState"
}
```

- **Absolute Timestamp**: ì •í™•í•œ ëŒ€ê¸° ì‹œê°„.

```json
"WaitState": {
"Type": "Wait",
"Timestamp": "2024-03-14T01:59:00Z",
"Next": "NextState"
}
```

- **Dynamic Wait**: **`SecondsPath`** ë˜ëŠ” **`TimestampPath`**ë¥¼ ì‚¬ìš©í•˜ì—¬ ì…ë ¥ì— ê¸°ë°˜í•œ ëŒ€ê¸° ì‹œê°„.

```json
jsonCopiar cÃ³digo
"WaitState": {
"Type": "Wait",
"TimestampPath": "$.expirydate",
"Next": "NextState"
}
```


### Parallel

**Parallel** ìƒíƒœëŠ” ì›Œí¬í”Œë¡œ ë‚´ì—ì„œ ì—¬ëŸ¬ ì‘ì—… ë¶„ê¸°ë¥¼ ë™ì‹œì— ì‹¤í–‰í•  ìˆ˜ ìˆê²Œ í•©ë‹ˆë‹¤. ê° ë¶„ê¸°ëŠ” ë…ë¦½ì ìœ¼ë¡œ ì‹¤í–‰ë˜ë©° ìì²´ ìƒíƒœ ì‹œí€€ìŠ¤ë¥¼ ì²˜ë¦¬í•©ë‹ˆë‹¤. ëª¨ë“  ë¶„ê¸°ê°€ ì™„ë£Œë  ë•Œê¹Œì§€ ì‹¤í–‰ì´ ëŒ€ê¸°í•œ í›„ ë‹¤ìŒ ìƒíƒœë¡œ ì§„í–‰í•©ë‹ˆë‹¤. ì£¼ìš” í•„ë“œëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤:

- **Branches**: ë³‘ë ¬ ì‹¤í–‰ ê²½ë¡œë¥¼ ì •ì˜í•˜ëŠ” ë°°ì—´. ê° ë¶„ê¸°ëŠ” ë³„ë„ì˜ ìƒíƒœ ë¨¸ì‹ ì…ë‹ˆë‹¤.
- **ResultPath**: ë¶„ê¸°ì˜ ê²°í•©ëœ ì¶œë ¥ì„ ì…ë ¥ì˜ ì–´ë””ì— ë°°ì¹˜í• ì§€ ì •ì˜í•©ë‹ˆë‹¤.
- **Retry and Catch**: ë³‘ë ¬ ìƒíƒœì— ëŒ€í•œ ì˜¤ë¥˜ ì²˜ë¦¬ êµ¬ì„±.
```json
"ParallelState": {
"Type": "Parallel",
"Branches": [
{
"StartAt": "Task1",
"States": { ... }
},
{
"StartAt": "Task2",
"States": { ... }
}
],
"Next": "NextState"
}
```
### Map

**Map** ìƒíƒœëŠ” ë°ì´í„°ì…‹ì˜ ê° í•­ëª©ì— ëŒ€í•´ ì¼ë ¨ì˜ ë‹¨ê³„ë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆê²Œ í•©ë‹ˆë‹¤. ì´ëŠ” ë°ì´í„°ì˜ ë³‘ë ¬ ì²˜ë¦¬ë¥¼ ìœ„í•´ ì‚¬ìš©ë©ë‹ˆë‹¤. ë°ì´í„°ì…‹ì˜ í•­ëª©ì„ ì²˜ë¦¬í•˜ëŠ” ë°©ë²•ì— ë”°ë¼ Step FunctionsëŠ” ë‹¤ìŒ ëª¨ë“œë¥¼ ì œê³µí•©ë‹ˆë‹¤:

- **Inline Mode**: ê° JSON ë°°ì—´ í•­ëª©ì— ëŒ€í•´ ìƒíƒœì˜ í•˜ìœ„ ì§‘í•©ì„ ì‹¤í–‰í•©ë‹ˆë‹¤. 40ê°œ ë¯¸ë§Œì˜ ë³‘ë ¬ ë°˜ë³µì´ ìˆëŠ” ì†Œê·œëª¨ ì‘ì—…ì— ì í•©í•˜ë©°, **`Map`** ìƒíƒœë¥¼ í¬í•¨í•˜ëŠ” ì›Œí¬í”Œë¡œì˜ ì»¨í…ìŠ¤íŠ¸ì—ì„œ ê°ê°ì„ ì‹¤í–‰í•©ë‹ˆë‹¤.

```json
"MapState": {
"Type": "Map",
"ItemsPath": "$.arrayItems",
"ItemProcessor": {
"ProcessorConfig": {
"Mode": "INLINE"
},
"StartAt": "AddState",
"States": {
"AddState": {
"Type": "Task",
"Resource": "arn:aws:states:::lambda:invoke",
"OutputPath": "$.Payload",
"Parameters": {
"FunctionName": "arn:aws:lambda:<region>:<account-id>:function:add-function"
},
"End": true
}
}
},
"End": true
"ResultPath": "$.detail.added",
"ItemsPath": "$.added"
}
```

- **Distributed Mode**: ë†’ì€ ë™ì‹œì„±ì„ ê°€ì§„ ëŒ€ê·œëª¨ ë³‘ë ¬ ì²˜ë¦¬ë¥¼ ìœ„í•´ ì„¤ê³„ë˜ì—ˆìŠµë‹ˆë‹¤. Amazon S3ì— ì €ì¥ëœ ëŒ€ê·œëª¨ ë°ì´í„°ì…‹ì„ ì²˜ë¦¬í•  ìˆ˜ ìˆìœ¼ë©°, ìµœëŒ€ 10,000ê°œì˜ ë³‘ë ¬ ìì‹ ì›Œí¬í”Œë¡œ ì‹¤í–‰ì„ ì§€ì›í•˜ì—¬ ì´ ìì‹ì„ ë³„ë„ì˜ ìì‹ ì‹¤í–‰ìœ¼ë¡œ ì‹¤í–‰í•©ë‹ˆë‹¤.

```json
"DistributedMapState": {
"Type": "Map",
"ItemReader": {
"Resource": "arn:aws:states:::s3:getObject",
"Parameters": {
"Bucket": "my-bucket",
"Key": "data.csv"
}
},
"ItemProcessor": {
"ProcessorConfig": {
"Mode": "DISTRIBUTED",
"ExecutionType": "EXPRESS"
},
"StartAt": "ProcessItem",
"States": {
"ProcessItem": {
"Type": "Task",
"Resource": "arn:aws:lambda:region:account-id:function:my-function",
"End": true
}
}
},
"End": true
"ResultWriter": {
"Resource": "arn:aws:states:::s3:putObject",
"Parameters": {
"Bucket": "myOutputBucket",
"Prefix": "csvProcessJobs"
}
}
}
```


### Versions and aliases

Step FunctionsëŠ” ìƒíƒœ ë¨¸ì‹ ì˜ **ë²„ì „** ë° **ë³„ì¹­**ì„ í†µí•´ ì›Œí¬í”Œë¡œ ë°°í¬ë¥¼ ê´€ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë²„ì „ì€ ì‹¤í–‰í•  ìˆ˜ ìˆëŠ” ìƒíƒœ ë¨¸ì‹ ì˜ ìŠ¤ëƒ…ìƒ·ì„ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤. ë³„ì¹­ì€ ìƒíƒœ ë¨¸ì‹ ì˜ ìµœëŒ€ ë‘ ê°œ ë²„ì „ì— ëŒ€í•œ í¬ì¸í„° ì—­í• ì„ í•©ë‹ˆë‹¤.

- **Versions**: ìƒíƒœ ë¨¸ì‹ ì˜ ìµœì‹  ìˆ˜ì •ë³¸ì—ì„œ ìƒì„±ëœ ë¶ˆë³€ì˜ ìŠ¤ëƒ…ìƒ·ì…ë‹ˆë‹¤. ê° ë²„ì „ì€ ê³ ìœ í•œ ARNìœ¼ë¡œ ì‹ë³„ë˜ë©°, ìƒíƒœ ë¨¸ì‹  ARNê³¼ ë²„ì „ ë²ˆí˜¸ê°€ ì½œë¡ (**`arn:aws:states:region:account-id:stateMachine:StateMachineName:version-number`**)ìœ¼ë¡œ êµ¬ë¶„ë©ë‹ˆë‹¤. ë²„ì „ì€ í¸ì§‘í•  ìˆ˜ ì—†ì§€ë§Œ ìƒíƒœ ë¨¸ì‹ ì„ ì—…ë°ì´íŠ¸í•˜ê³  ìƒˆ ë²„ì „ì„ ê²Œì‹œí•˜ê±°ë‚˜ ì›í•˜ëŠ” ìƒíƒœ ë¨¸ì‹  ë²„ì „ì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- **Aliases**: ë™ì¼í•œ ìƒíƒœ ë¨¸ì‹ ì˜ ìµœëŒ€ ë‘ ê°œ ë²„ì „ì„ ì°¸ì¡°í•  ìˆ˜ ìˆëŠ” í¬ì¸í„°ì…ë‹ˆë‹¤. ë‹¨ì¼ ìƒíƒœ ë¨¸ì‹ ì— ëŒ€í•´ ì—¬ëŸ¬ ë³„ì¹­ì„ ìƒì„±í•  ìˆ˜ ìˆìœ¼ë©°, ê° ë³„ì¹­ì€ ìƒíƒœ ë¨¸ì‹  ARNê³¼ ë³„ì¹­ ì´ë¦„ì´ ì½œë¡ (**`arn:aws:states:region:account-id:stateMachine:StateMachineName:aliasName`**)ìœ¼ë¡œ êµ¬ë¶„ëœ ê³ ìœ í•œ ARNìœ¼ë¡œ ì‹ë³„ë©ë‹ˆë‹¤. ë³„ì¹­ì€ ìƒíƒœ ë¨¸ì‹ ì˜ ë‘ ë²„ì „ ì¤‘ í•˜ë‚˜ë¡œ íŠ¸ë˜í”½ì„ ë¼ìš°íŒ…í•  ìˆ˜ ìˆê²Œ í•©ë‹ˆë‹¤. ë˜ëŠ” ë³„ì¹­ì€ ìƒíƒœ ë¨¸ì‹ ì˜ íŠ¹ì • ë²„ì „ í•˜ë‚˜ë¥¼ ê°€ë¦¬í‚¬ ìˆ˜ ìˆì§€ë§Œ ë‹¤ë¥¸ ë³„ì¹­ì„ ê°€ë¦¬í‚¬ ìˆ˜ëŠ” ì—†ìŠµë‹ˆë‹¤. í•„ìš”ì— ë”°ë¼ ë‹¤ë¥¸ ìƒíƒœ ë¨¸ì‹  ë²„ì „ìœ¼ë¡œ ë¦¬ë””ë ‰ì…˜í•˜ë„ë¡ ì—…ë°ì´íŠ¸í•  ìˆ˜ ìˆì–´, ì œì–´ëœ ë°°í¬ ë° ì›Œí¬í”Œë¡œ ê´€ë¦¬ë¥¼ ìš©ì´í•˜ê²Œ í•©ë‹ˆë‹¤.

**ASL**ì— ëŒ€í•œ ìì„¸í•œ ì •ë³´ëŠ” ë‹¤ìŒì„ ì°¸ì¡°í•˜ì‹­ì‹œì˜¤: [**Amazon States Language**](https://states-language.net/spec.html).



## IAM Roles for State machines

AWS Step FunctionsëŠ” AWS Identity and Access Management (IAM) ì—­í• ì„ ì‚¬ìš©í•˜ì—¬ ìƒíƒœ ë¨¸ì‹  ë‚´ ë¦¬ì†ŒìŠ¤ ë° ì‘ì—…ì— ëŒ€í•œ ì•¡ì„¸ìŠ¤ë¥¼ ì œì–´í•©ë‹ˆë‹¤. AWS Step Functionsì˜ ë³´ì•ˆ ë° IAM ì—­í• ê³¼ ê´€ë ¨ëœ ì£¼ìš” ì¸¡ë©´ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤:

- **Execution Role**: AWS Step Functionsì˜ ê° ìƒíƒœ ë¨¸ì‹ ì€ IAM ì‹¤í–‰ ì—­í• ê³¼ ì—°ê²°ë©ë‹ˆë‹¤. ì´ ì—­í• ì€ ìƒíƒœ ë¨¸ì‹ ì´ ì‚¬ìš©ìë¥¼ ëŒ€ì‹ í•˜ì—¬ ìˆ˜í–‰í•  ìˆ˜ ìˆëŠ” ì‘ì—…ì„ ì •ì˜í•©ë‹ˆë‹¤. ìƒíƒœ ë¨¸ì‹ ì´ AWS ì„œë¹„ìŠ¤ì™€ ìƒí˜¸ ì‘ìš©í•˜ëŠ” ìƒíƒœë¡œ ì „í™˜í•  ë•Œ(ì˜ˆ: Lambda í•¨ìˆ˜ í˜¸ì¶œ, DynamoDB ì•¡ì„¸ìŠ¤ ë“±), ì´ ì‹¤í–‰ ì—­í• ì„ ê°€ì •í•˜ì—¬ í•´ë‹¹ ì‘ì—…ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤.
- **Permissions**: IAM ì‹¤í–‰ ì—­í• ì€ ë‹¤ë¥¸ AWS ì„œë¹„ìŠ¤ì— í•„ìš”í•œ ì‘ì—…ì„ í—ˆìš©í•˜ëŠ” ê¶Œí•œìœ¼ë¡œ êµ¬ì„±ë˜ì–´ì•¼ í•©ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´, ìƒíƒœ ë¨¸ì‹ ì´ AWS Lambda í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•´ì•¼ í•˜ëŠ” ê²½ìš°, IAM ì—­í• ì€ **`lambda:InvokeFunction`** ê¶Œí•œì„ ê°€ì ¸ì•¼ í•©ë‹ˆë‹¤. ë§ˆì°¬ê°€ì§€ë¡œ, DynamoDBì— ì“°ê¸° ìœ„í•´ì„œëŠ” ì ì ˆí•œ ê¶Œí•œ(**`dynamodb:PutItem`**, **`dynamodb:UpdateItem`** ë“±)ì´ ë¶€ì—¬ë˜ì–´ì•¼ í•©ë‹ˆë‹¤.
- **Least Privilege**: Step Functionsì— ëŒ€í•œ IAM ì—­í• ì„ êµ¬ì„±í•  ë•Œ ìµœì†Œ ê¶Œí•œ ì›ì¹™ì„ ë”°ë¥´ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤. ì´ëŠ” ìƒíƒœ ë¨¸ì‹ ì´ íŠ¹ì • ì‘ì—…ì„ ìˆ˜í–‰í•˜ëŠ” ë° í•„ìš”í•œ ê¶Œí•œë§Œ ë¶€ì—¬í•˜ê³  ê·¸ ì´ìƒì€ ë¶€ì—¬í•˜ì§€ ì•ŠëŠ” ê²ƒì„ ì˜ë¯¸í•©ë‹ˆë‹¤. IAM ì •ì±…ì€ íŠ¹ì • ë¦¬ì†ŒìŠ¤ ë° ì‘ì—…ì— ë²”ìœ„ê°€ ì§€ì •ë˜ì–´ì•¼ í•˜ë©°, ì˜ë„í•˜ì§€ ì•Šì€ ì•¡ì„¸ìŠ¤ì˜ ìœ„í—˜ì„ ì¤„ì…ë‹ˆë‹¤.

## Enumeration

ë‹¤ìŒ ë‚˜ì—´ ì‘ì—…ì— ëŒ€í•´ ReadOnlyAccess ì •ì±…ë§Œìœ¼ë¡œ ì¶©ë¶„í•©ë‹ˆë‹¤.
```bash
# State machines #

## List state machines
aws stepfunctions list-state-machines
## Retrieve informatio about the specified state machine
aws stepfunctions describe-state-machine --state-machine-arn <value>

## List verions for the specified state machine
aws stepfunctions list-state-machine-versions --state-machine-arn <value>
## List aliases for the specified state machine
aws stepfunctions list-state-machine-aliases --state-machine-arn <value>
## Retrieve informatio about the specified state machine alias
aws stepfunctions describe-state-machine-alias --state-machine-alias-arn <value>

## List executions of a state machine
aws stepfunctions list-executions --state-machine-arn <value> [--status-filter <RUNNING | SUCCEEDED | FAILED | TIMED_OUT | ABORTED | PENDING_REDRIVE>] [--redrive-filter <REDRIVEN | NOT_REDRIVEN>]
## Retrieve information and relevant metadata about a state machine execution
aws stepfunctions describe-execution --execution-arn <value>
## Retrieve information about the state machine associated to the specified execution
aws stepfunctions describe-state-machine-for-execution --execution-arn <value>
## Retrieve the history of the specified execution as a list of events
aws stepfunctions get-execution-history --execution-arn <value> [--reverse-order | --no-reverse-order] [--include-execution-data | --no-include-execution-data]

## List tags for the specified Ste Functions resource
aws stepfunctions list-tags-for-resource --resource-arn <value>

## Validate the definition of a state machine without creating the resource
aws stepfunctions validate-state-machine-definition --definition <value> [--type <STANDARD | EXPRESS>]

# Activities #

## List existing activities
aws stepfunctions list-activities
## Retrieve information about the specified activity
aws stepfunctions describe-activity --activity-arn <value>

# Map Runs #

## List map runs of an execution
aws stepfunctions list-map-runs --execution-arn <value>
## Provide information about the configuration, progress and results of a Map Run
aws stepfunctions describe-map-run --map-run-arn <value>
## Lists executions of a Map Run
aws stepfunctions list-executions --map-run-arn <value> [--status-filter <RUNNING | SUCCEEDED | FAILED | TIMED_OUT | ABORTED | PENDING_REDRIVE>] [--redrive-filter <REDRIVEN | NOT_REDRIVEN>]
```
## Privesc

ë‹¤ìŒ í˜ì´ì§€ì—ì„œ **Step Functions ê¶Œí•œì„ ì•…ìš©í•˜ì—¬ ê¶Œí•œì„ ìƒìŠ¹ì‹œí‚¤ëŠ” ë°©ë²•**ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

{% content-ref url="../aws-privilege-escalation/aws-stepfunctions-privesc.md" %}
[aws-stepfunctions-privesc.md](../aws-privilege-escalation/aws-stepfunctions-privesc.md)
{% endcontent-ref %}

## Post Exploitation

{% content-ref url="../aws-post-exploitation/aws-stepfunctions-post-exploitation/" %}
[aws-stepfunctions-post-exploitation](../aws-post-exploitation/aws-stepfunctions-post-exploitation/)
{% endcontent-ref %}

# References

* [https://docs.aws.amazon.com/service-authorization/latest/reference/list_awsstepfunctions.html](https://docs.aws.amazon.com/service-authorization/latest/reference/list_awsstepfunctions.html)
* [https://docs.aws.amazon.com/step-functions/latest/dg/welcome.html](https://docs.aws.amazon.com/step-functions/latest/dg/welcome.html)
* [https://states-language.net/spec.html](https://states-language.net/spec.html)

{% hint style="success" %}
AWS Hacking ë°°ìš°ê¸° ë° ì—°ìŠµí•˜ê¸°:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCP Hacking ë°°ìš°ê¸° ë° ì—°ìŠµí•˜ê¸°: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks ì§€ì›í•˜ê¸°</summary>

* [**êµ¬ë… í”Œëœ**](https://github.com/sponsors/carlospolop)ì„ í™•ì¸í•˜ì„¸ìš”!
* ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**telegram ê·¸ë£¹**](https://t.me/peass)ì— ê°€ì…í•˜ê±°ë‚˜ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)ì„ íŒ”ë¡œìš°í•˜ì„¸ìš”.
* **PRì„ ì œì¶œí•˜ì—¬** [**HackTricks**](https://github.com/carlospolop/hacktricks) ë° [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ì €ì¥ì†Œì— í•´í‚¹ íŠ¸ë¦­ì„ ê³µìœ í•˜ì„¸ìš”.

</details>
{% endhint %}
