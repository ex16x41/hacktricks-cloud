# AWS - Step Functions Enum

{% hint style="success" %}
å­¦ä¹ ä¸å®è·µ AWS é»‘å®¢æŠ€æœ¯ï¼š<img src="../../../.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks åŸ¹è®­ AWS çº¢é˜Ÿä¸“å®¶ (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image.png" alt="" data-size="line">\
å­¦ä¹ ä¸å®è·µ GCP é»‘å®¢æŠ€æœ¯ï¼š<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks åŸ¹è®­ GCP çº¢é˜Ÿä¸“å®¶ (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>æ”¯æŒ HackTricks</summary>

* æŸ¥çœ‹ [**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**Telegram ç¾¤ç»„**](https://t.me/peass) æˆ– **å…³æ³¨** æˆ‘ä»¬çš„ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub ä»“åº“æäº¤ PR åˆ†äº«é»‘å®¢æŠ€å·§ã€‚

</details>
{% endhint %}

## Step Functions

AWS Step Functions æ˜¯ä¸€ç§å·¥ä½œæµæœåŠ¡ï¼Œä½¿æ‚¨èƒ½å¤Ÿåè°ƒå’Œç¼–æ’å¤šä¸ª AWS æœåŠ¡åˆ°æ— æœåŠ¡å™¨å·¥ä½œæµä¸­ã€‚é€šè¿‡ä½¿ç”¨ AWS Step Functionsï¼Œæ‚¨å¯ä»¥è®¾è®¡å’Œè¿è¡Œè¿æ¥å„ç§ AWS æœåŠ¡ï¼ˆå¦‚ AWS Lambdaã€Amazon S3ã€Amazon DynamoDB ç­‰ï¼‰çš„å·¥ä½œæµï¼ŒæŒ‰æ­¥éª¤é¡ºåºè¿›è¡Œã€‚è¿™ç§ç¼–æ’æœåŠ¡æä¾›äº†å¯è§†åŒ–å·¥ä½œæµç•Œé¢ï¼Œå¹¶æä¾› **çŠ¶æ€æœº** åŠŸèƒ½ï¼Œå…è®¸æ‚¨ä½¿ç”¨åŸºäº JSON çš„ **Amazon States Language** (ASL) ä»¥å£°æ˜æ–¹å¼å®šä¹‰å·¥ä½œæµçš„æ¯ä¸ªæ­¥éª¤ã€‚

## å…³é”®æ¦‚å¿µ

### æ ‡å‡†ä¸å¿«é€Ÿå·¥ä½œæµ

AWS Step Functions æä¾›ä¸¤ç§ç±»å‹çš„ **çŠ¶æ€æœºå·¥ä½œæµ**ï¼šæ ‡å‡†å’Œå¿«é€Ÿã€‚

* **æ ‡å‡†å·¥ä½œæµ**ï¼šè¿™ç§é»˜è®¤å·¥ä½œæµç±»å‹æ—¨åœ¨ç”¨äºé•¿æ—¶é—´è¿è¡Œã€æŒä¹…å’Œå¯å®¡è®¡çš„è¿‡ç¨‹ã€‚å®ƒæ”¯æŒ **ç²¾ç¡®ä¸€æ¬¡æ‰§è¡Œ**ï¼Œç¡®ä¿ä»»åŠ¡ä»…è¿è¡Œä¸€æ¬¡ï¼Œé™¤éæŒ‡å®šé‡è¯•ã€‚å®ƒéå¸¸é€‚åˆéœ€è¦è¯¦ç»†æ‰§è¡Œå†å²çš„å·¥ä½œæµï¼Œå¹¶ä¸”å¯ä»¥è¿è¡Œé•¿è¾¾ä¸€å¹´ã€‚
* **å¿«é€Ÿå·¥ä½œæµ**ï¼šè¿™ç§ç±»å‹éå¸¸é€‚åˆé«˜å®¹é‡ã€çŸ­æ—¶ä»»åŠ¡ï¼Œè¿è¡Œæ—¶é—´æœ€é•¿å¯è¾¾äº”åˆ†é’Ÿã€‚å®ƒä»¬æ”¯æŒ **è‡³å°‘ä¸€æ¬¡æ‰§è¡Œ**ï¼Œé€‚åˆå¹‚ç­‰ä»»åŠ¡ï¼Œå¦‚æ•°æ®å¤„ç†ã€‚è¿™äº›å·¥ä½œæµé’ˆå¯¹æˆæœ¬å’Œæ€§èƒ½è¿›è¡Œäº†ä¼˜åŒ–ï¼ŒæŒ‰æ‰§è¡Œæ¬¡æ•°ã€æŒç»­æ—¶é—´å’Œå†…å­˜ä½¿ç”¨é‡æ”¶è´¹ã€‚

### çŠ¶æ€

çŠ¶æ€æ˜¯çŠ¶æ€æœºçš„åŸºæœ¬å•å…ƒã€‚å®ƒä»¬å®šä¹‰å·¥ä½œæµä¸­çš„å„ä¸ªæ­¥éª¤ï¼Œèƒ½å¤Ÿæ ¹æ®å…¶ç±»å‹æ‰§è¡Œå¤šç§åŠŸèƒ½ï¼š

* **ä»»åŠ¡ï¼š** æ‰§è¡Œä½œä¸šï¼Œé€šå¸¸ä½¿ç”¨ AWS æœåŠ¡ï¼Œå¦‚ Lambdaã€‚
* **é€‰æ‹©ï¼š** æ ¹æ®è¾“å…¥åšå‡ºå†³ç­–ã€‚
* **å¤±è´¥/æˆåŠŸï¼š** ä»¥å¤±è´¥æˆ–æˆåŠŸç»“æŸæ‰§è¡Œã€‚
* **ä¼ é€’ï¼š** å°†è¾“å…¥ä¼ é€’åˆ°è¾“å‡ºæˆ–æ³¨å…¥æ•°æ®ã€‚
* **ç­‰å¾…ï¼š** å»¶è¿Ÿæ‰§è¡Œä¸€æ®µæ—¶é—´ã€‚
* **å¹¶è¡Œï¼š** å¯åŠ¨å¹¶è¡Œåˆ†æ”¯ã€‚
* **æ˜ å°„ï¼š** åŠ¨æ€è¿­ä»£æ­¥éª¤ã€‚

### ä»»åŠ¡

**ä»»åŠ¡** çŠ¶æ€è¡¨ç¤ºç”±çŠ¶æ€æœºæ‰§è¡Œçš„å•ä¸ªå·¥ä½œå•å…ƒã€‚ä»»åŠ¡å¯ä»¥è°ƒç”¨å„ç§èµ„æºï¼ŒåŒ…æ‹¬æ´»åŠ¨ã€Lambda å‡½æ•°ã€AWS æœåŠ¡æˆ–ç¬¬ä¸‰æ–¹ APIã€‚

* **æ´»åŠ¨**ï¼šæ‚¨ç®¡ç†çš„è‡ªå®šä¹‰å·¥ä½œè€…ï¼Œé€‚åˆé•¿æ—¶é—´è¿è¡Œçš„è¿‡ç¨‹ã€‚
* èµ„æºï¼š**`arn:aws:states:region:account:activity:name`**ã€‚
* **Lambda å‡½æ•°**ï¼šæ‰§è¡Œ AWS Lambda å‡½æ•°ã€‚
* èµ„æºï¼š**`arn:aws:lambda:region:account:function:function-name`**ã€‚
* **AWS æœåŠ¡**ï¼šç›´æ¥ä¸å…¶ä»– AWS æœåŠ¡é›†æˆï¼Œå¦‚ DynamoDB æˆ– S3ã€‚
* èµ„æºï¼š**`arn:partition:states:region:account:servicename:APIname`**ã€‚
* **HTTP ä»»åŠ¡**ï¼šè°ƒç”¨ç¬¬ä¸‰æ–¹ APIã€‚
* èµ„æºå­—æ®µï¼š**`arn:aws:states:::http:invoke`**ã€‚ç„¶åï¼Œæ‚¨åº”æä¾› API ç«¯ç‚¹é…ç½®è¯¦ç»†ä¿¡æ¯ï¼Œå¦‚ API URLã€æ–¹æ³•å’Œèº«ä»½éªŒè¯è¯¦ç»†ä¿¡æ¯ã€‚

ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºäº†ä¸€ä¸ªè°ƒç”¨åä¸º HelloWorld çš„ Lambda å‡½æ•°çš„ä»»åŠ¡çŠ¶æ€å®šä¹‰ï¼š
```json
"HelloWorld": {
"Type": "Task",
"Resource": "arn:aws:states:::lambda:invoke",
"Parameters": {
"Payload.$": "$",
"FunctionName": "arn:aws:lambda:<region>:<account-id>:function:HelloWorld"
},
"End": true
}
```
### Choice

ä¸€ä¸ª **Choice** çŠ¶æ€ä¸ºå·¥ä½œæµæ·»åŠ æ¡ä»¶é€»è¾‘ï¼Œä½¿å…¶èƒ½å¤Ÿæ ¹æ®è¾“å…¥æ•°æ®åšå‡ºå†³ç­–ã€‚å®ƒè¯„ä¼°æŒ‡å®šçš„æ¡ä»¶ï¼Œå¹¶æ ¹æ®ç»“æœè½¬æ¢åˆ°ç›¸åº”çš„çŠ¶æ€ã€‚

* **Comparison**: æ¯ä¸ªé€‰æ‹©è§„åˆ™åŒ…æ‹¬ä¸€ä¸ªæ¯”è¾ƒè¿ç®—ç¬¦ï¼ˆä¾‹å¦‚ï¼Œ**`NumericEquals`**ï¼Œ**`StringEquals`**ï¼‰ï¼Œç”¨äºå°†è¾“å…¥å˜é‡ä¸æŒ‡å®šå€¼æˆ–å¦ä¸€ä¸ªå˜é‡è¿›è¡Œæ¯”è¾ƒã€‚
* **Next Field**: Choice çŠ¶æ€ä¸æ”¯æŒ **`End`** å­—æ®µï¼Œè€Œæ˜¯å®šä¹‰ **`Next`** çŠ¶æ€ï¼Œä»¥ä¾¿åœ¨æ¯”è¾ƒä¸ºçœŸæ—¶è¿›è¡Œè½¬æ¢ã€‚

**Choice** çŠ¶æ€çš„ç¤ºä¾‹ï¼š
```json
{
"Variable": "$.timeStamp",
"TimestampEquals": "2000-01-01T00:00:00Z",
"Next": "TimeState"
}
```
### Fail/Succeed

ä¸€ä¸ª **`Fail`** çŠ¶æ€åœæ­¢çŠ¶æ€æœºçš„æ‰§è¡Œå¹¶å°†å…¶æ ‡è®°ä¸ºå¤±è´¥ã€‚å®ƒç”¨äºæŒ‡å®šé”™è¯¯åç§°å’ŒåŸå› ï¼Œæä¾›æœ‰å…³å¤±è´¥çš„è¯¦ç»†ä¿¡æ¯ã€‚æ­¤çŠ¶æ€æ˜¯ç»ˆç«¯çŠ¶æ€ï¼Œæ„å‘³ç€å®ƒç»“æŸæ‰§è¡Œæµç¨‹ã€‚

ä¸€ä¸ª **`Succeed`** çŠ¶æ€æˆåŠŸåœ°åœæ­¢æ‰§è¡Œã€‚å®ƒé€šå¸¸ç”¨äºåœ¨å·¥ä½œæµæˆåŠŸå®Œæˆæ—¶ç»ˆæ­¢å·¥ä½œæµã€‚æ­¤çŠ¶æ€ä¸éœ€è¦ **`Next`** å­—æ®µã€‚

{% tabs %}
{% tab title="Fail example" %}
```json
"FailState": {
"Type": "Fail",
"Error": "ErrorName",
"Cause": "Error details"
}
```
{% endtab %}

{% tab title="æˆåŠŸç¤ºä¾‹" %}
```json
"SuccessState": {
"Type": "Succeed"
}
```
{% endtab %}
{% endtabs %}

### Pass

ä¸€ä¸ª **Pass** çŠ¶æ€å°†å…¶è¾“å…¥ä¼ é€’ç»™è¾“å‡ºï¼Œæ—¢ä¸æ‰§è¡Œä»»ä½•å·¥ä½œï¼Œä¹Ÿä¸ä½¿ç”¨è¿‡æ»¤å™¨è½¬æ¢ JSON çŠ¶æ€è¾“å…¥ï¼Œç„¶åå°†è½¬æ¢åçš„æ•°æ®ä¼ é€’ç»™ä¸‹ä¸€ä¸ªçŠ¶æ€ã€‚å®ƒå¯¹äºæµ‹è¯•å’Œæ„å»ºçŠ¶æ€æœºéå¸¸æœ‰ç”¨ï¼Œå…è®¸æ‚¨æ³¨å…¥é™æ€æ•°æ®æˆ–å¯¹å…¶è¿›è¡Œè½¬æ¢ã€‚
```json
"PassState": {
"Type": "Pass",
"Result": {"key": "value"},
"ResultPath": "$.newField",
"Next": "NextState"
}
```
### Wait

ä¸€ä¸ª **Wait** çŠ¶æ€ä¼šå»¶è¿ŸçŠ¶æ€æœºçš„æ‰§è¡Œï¼Œç›´åˆ°æŒ‡å®šçš„æŒç»­æ—¶é—´ã€‚é…ç½®ç­‰å¾…æ—¶é—´çš„ä¸»è¦æ–¹æ³•æœ‰ä¸‰ç§ï¼š

*   **X Seconds**: å›ºå®šçš„ç­‰å¾…ç§’æ•°ã€‚

```json
"WaitState": {
"Type": "Wait",
"Seconds": 10,
"Next": "NextState"
}
```
*   **Absolute Timestamp**: ç­‰å¾…ç›´åˆ°çš„ç¡®åˆ‡æ—¶é—´ã€‚

```json
"WaitState": {
"Type": "Wait",
"Timestamp": "2024-03-14T01:59:00Z",
"Next": "NextState"
}
```
*   **Dynamic Wait**: åŸºäºè¾“å…¥ä½¿ç”¨ **`SecondsPath`** æˆ– **`TimestampPath`**ã€‚

```json
"WaitState": {
"Type": "Wait",
"TimestampPath": "$.expirydate",
"Next": "NextState"
}
```

### Parallel

ä¸€ä¸ª **Parallel** çŠ¶æ€å…è®¸æ‚¨åœ¨å·¥ä½œæµä¸­å¹¶å‘æ‰§è¡Œå¤šä¸ªä»»åŠ¡åˆ†æ”¯ã€‚æ¯ä¸ªåˆ†æ”¯ç‹¬ç«‹è¿è¡Œå¹¶å¤„ç†è‡ªå·±çš„çŠ¶æ€åºåˆ—ã€‚æ‰§è¡Œä¼šç­‰å¾…æ‰€æœ‰åˆ†æ”¯å®Œæˆåå†ç»§ç»­åˆ°ä¸‹ä¸€ä¸ªçŠ¶æ€ã€‚å…¶å…³é”®å­—æ®µåŒ…æ‹¬ï¼š

* **Branches**: å®šä¹‰å¹¶è¡Œæ‰§è¡Œè·¯å¾„çš„æ•°ç»„ã€‚æ¯ä¸ªåˆ†æ”¯æ˜¯ä¸€ä¸ªå•ç‹¬çš„çŠ¶æ€æœºã€‚
* **ResultPath**: å®šä¹‰å°†åˆ†æ”¯çš„åˆå¹¶è¾“å‡ºæ”¾ç½®åœ¨è¾“å…¥ä¸­çš„ä½ç½®ã€‚
* **Retry and Catch**: å¹¶è¡ŒçŠ¶æ€çš„é”™è¯¯å¤„ç†é…ç½®ã€‚
```json
"ParallelState": {
"Type": "Parallel",
"Branches": [
{
"StartAt": "Task1",
"States": { ... }
},
{
"StartAt": "Task2",
"States": { ... }
}
],
"Next": "NextState"
}
```
### Map

ä¸€ä¸ª **Map** çŠ¶æ€å…è®¸å¯¹æ•°æ®é›†ä¸­çš„æ¯ä¸ªé¡¹ç›®æ‰§è¡Œä¸€ç»„æ­¥éª¤ã€‚å®ƒç”¨äºæ•°æ®çš„å¹¶è¡Œå¤„ç†ã€‚æ ¹æ®æ‚¨å¸Œæœ›å¦‚ä½•å¤„ç†æ•°æ®é›†ä¸­çš„é¡¹ç›®ï¼ŒStep Functions æä¾›ä»¥ä¸‹æ¨¡å¼ï¼š

*   **Inline Mode**: å¯¹æ¯ä¸ª JSON æ•°ç»„é¡¹æ‰§è¡Œä¸€ç»„çŠ¶æ€çš„å­é›†ã€‚é€‚ç”¨äºå¹¶è¡Œè¿­ä»£å°‘äº 40 çš„å°è§„æ¨¡ä»»åŠ¡ï¼Œåœ¨åŒ…å« **`Map`** çŠ¶æ€çš„å·¥ä½œæµä¸Šä¸‹æ–‡ä¸­è¿è¡Œæ¯ä¸ªä»»åŠ¡ã€‚

```json
"MapState": {
"Type": "Map",
"ItemsPath": "$.arrayItems",
"ItemProcessor": {
"ProcessorConfig": {
"Mode": "INLINE"
},
"StartAt": "AddState",
"States": {
"AddState": {
"Type": "Task",
"Resource": "arn:aws:states:::lambda:invoke",
"OutputPath": "$.Payload",
"Parameters": {
"FunctionName": "arn:aws:lambda:<region>:<account-id>:function:add-function"
},
"End": true
}
}
},
"End": true
"ResultPath": "$.detail.added",
"ItemsPath": "$.added"
}
```
*   **Distributed Mode**: è®¾è®¡ç”¨äºå¤§è§„æ¨¡å¹¶è¡Œå¤„ç†ï¼Œå…·æœ‰é«˜å¹¶å‘æ€§ã€‚æ”¯æŒå¤„ç†å¤§å‹æ•°æ®é›†ï¼Œä¾‹å¦‚å­˜å‚¨åœ¨ Amazon S3 ä¸­çš„æ•°æ®é›†ï¼Œå…è®¸é«˜è¾¾ 10,000 ä¸ªå¹¶è¡Œå­å·¥ä½œæµæ‰§è¡Œï¼Œè¿™äº›å­å·¥ä½œæµä½œä¸ºå•ç‹¬çš„å­æ‰§è¡Œè¿è¡Œã€‚

```json
"DistributedMapState": {
"Type": "Map",
"ItemReader": {
"Resource": "arn:aws:states:::s3:getObject",
"Parameters": {
"Bucket": "my-bucket",
"Key": "data.csv"
}
},
"ItemProcessor": {
"ProcessorConfig": {
"Mode": "DISTRIBUTED",
"ExecutionType": "EXPRESS"
},
"StartAt": "ProcessItem",
"States": {
"ProcessItem": {
"Type": "Task",
"Resource": "arn:aws:lambda:region:account-id:function:my-function",
"End": true
}
}
},
"End": true
"ResultWriter": {
"Resource": "arn:aws:states:::s3:putObject",
"Parameters": {
"Bucket": "myOutputBucket",
"Prefix": "csvProcessJobs"
}
}
}
```

### Versions and aliases

Step Functions è¿˜å…è®¸æ‚¨é€šè¿‡çŠ¶æ€æœºçš„ **versions** å’Œ **aliases** ç®¡ç†å·¥ä½œæµéƒ¨ç½²ã€‚ç‰ˆæœ¬è¡¨ç¤ºå¯ä»¥æ‰§è¡Œçš„çŠ¶æ€æœºå¿«ç…§ã€‚åˆ«åä½œä¸ºæŒ‡å‘æœ€å¤šä¸¤ä¸ªç‰ˆæœ¬çš„çŠ¶æ€æœºçš„æŒ‡é’ˆã€‚

* **Versions**: è¿™äº›ä¸å¯å˜çš„çŠ¶æ€æœºå¿«ç…§æ˜¯ä»è¯¥çŠ¶æ€æœºçš„æœ€æ–°ä¿®è®¢ç‰ˆåˆ›å»ºçš„ã€‚æ¯ä¸ªç‰ˆæœ¬ç”±ä¸€ä¸ªå”¯ä¸€çš„ ARN æ ‡è¯†ï¼Œè¯¥ ARN å°†çŠ¶æ€æœº ARN ä¸ç‰ˆæœ¬å·ç»„åˆï¼Œä½¿ç”¨å†’å·åˆ†éš”ï¼ˆ**`arn:aws:states:region:account-id:stateMachine:StateMachineName:version-number`**ï¼‰ã€‚ç‰ˆæœ¬ä¸èƒ½è¢«ç¼–è¾‘ï¼Œä½†æ‚¨å¯ä»¥æ›´æ–°çŠ¶æ€æœºå¹¶å‘å¸ƒæ–°ç‰ˆæœ¬ï¼Œæˆ–ä½¿ç”¨æ‰€éœ€çš„çŠ¶æ€æœºç‰ˆæœ¬ã€‚
* **Aliases**: è¿™äº›æŒ‡é’ˆå¯ä»¥å¼•ç”¨åŒä¸€çŠ¶æ€æœºçš„æœ€å¤šä¸¤ä¸ªç‰ˆæœ¬ã€‚å¯ä»¥ä¸ºå•ä¸ªçŠ¶æ€æœºåˆ›å»ºå¤šä¸ªåˆ«åï¼Œæ¯ä¸ªåˆ«åç”±ä¸€ä¸ªå”¯ä¸€çš„ ARN æ ‡è¯†ï¼Œè¯¥ ARN é€šè¿‡å°†çŠ¶æ€æœº ARN ä¸åˆ«ååç§°ç»„åˆï¼Œä½¿ç”¨å†’å·åˆ†éš”ï¼ˆ**`arn:aws:states:region:account-id:stateMachine:StateMachineName:aliasName`**ï¼‰ã€‚åˆ«åä½¿å¾—åœ¨çŠ¶æ€æœºçš„ä¸¤ä¸ªç‰ˆæœ¬ä¹‹é—´è·¯ç”±æµé‡æˆä¸ºå¯èƒ½ã€‚æˆ–è€…ï¼Œåˆ«åå¯ä»¥æŒ‡å‘çŠ¶æ€æœºçš„å•ä¸ªç‰¹å®šç‰ˆæœ¬ï¼Œä½†ä¸èƒ½æŒ‡å‘å…¶ä»–åˆ«åã€‚å®ƒä»¬å¯ä»¥æ ¹æ®éœ€è¦æ›´æ–°ä»¥é‡å®šå‘åˆ°çŠ¶æ€æœºçš„ä¸åŒç‰ˆæœ¬ï¼Œä»è€Œä¿ƒè¿›å—æ§éƒ¨ç½²å’Œå·¥ä½œæµç®¡ç†ã€‚

æœ‰å…³ **ASL** çš„æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·æŸ¥çœ‹ï¼š[**Amazon States Language**](https://states-language.net/spec.html)ã€‚

## IAM Roles for State machines

AWS Step Functions åˆ©ç”¨ AWS èº«ä»½å’Œè®¿é—®ç®¡ç† (IAM) è§’è‰²æ¥æ§åˆ¶å¯¹çŠ¶æ€æœºå†…èµ„æºå’Œæ“ä½œçš„è®¿é—®ã€‚ä»¥ä¸‹æ˜¯ä¸ AWS Step Functions ä¸­çš„å®‰å…¨æ€§å’Œ IAM è§’è‰²ç›¸å…³çš„å…³é”®æ–¹é¢ï¼š

* **Execution Role**: AWS Step Functions ä¸­çš„æ¯ä¸ªçŠ¶æ€æœºéƒ½ä¸ä¸€ä¸ª IAM æ‰§è¡Œè§’è‰²ç›¸å…³è”ã€‚è¯¥è§’è‰²å®šä¹‰äº†çŠ¶æ€æœºå¯ä»¥ä»£è¡¨æ‚¨æ‰§è¡Œçš„æ“ä½œã€‚å½“çŠ¶æ€æœºåœ¨ä¸ AWS æœåŠ¡äº¤äº’çš„çŠ¶æ€ä¹‹é—´è½¬æ¢æ—¶ï¼ˆä¾‹å¦‚è°ƒç”¨ Lambda å‡½æ•°ã€è®¿é—® DynamoDB ç­‰ï¼‰ï¼Œå®ƒä¼šå‡å®šæ­¤æ‰§è¡Œè§’è‰²ä»¥æ‰§è¡Œè¿™äº›æ“ä½œã€‚
* **Permissions**: IAM æ‰§è¡Œè§’è‰²å¿…é¡»é…ç½®å…·æœ‰å…è®¸å¯¹å…¶ä»– AWS æœåŠ¡æ‰§è¡Œå¿…è¦æ“ä½œçš„æƒé™ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨çš„çŠ¶æ€æœºéœ€è¦è°ƒç”¨ AWS Lambda å‡½æ•°ï¼Œåˆ™ IAM è§’è‰²å¿…é¡»å…·æœ‰ **`lambda:InvokeFunction`** æƒé™ã€‚åŒæ ·ï¼Œå¦‚æœå®ƒéœ€è¦å†™å…¥ DynamoDBï¼Œåˆ™å¿…é¡»æˆäºˆé€‚å½“çš„æƒé™ï¼ˆ**`dynamodb:PutItem`**ã€**`dynamodb:UpdateItem`** ç­‰ï¼‰ã€‚

## Enumeration

ReadOnlyAccess ç­–ç•¥è¶³ä»¥æ»¡è¶³ä»¥ä¸‹æ‰€æœ‰æšä¸¾æ“ä½œã€‚
```bash
# State machines #

## List state machines
aws stepfunctions list-state-machines
## Retrieve informatio about the specified state machine
aws stepfunctions describe-state-machine --state-machine-arn <value>

## List versions for the specified state machine
aws stepfunctions list-state-machine-versions --state-machine-arn <value>
## List aliases for the specified state machine
aws stepfunctions list-state-machine-aliases --state-machine-arn <value>
## Retrieve information about the specified state machine alias
aws stepfunctions describe-state-machine-alias --state-machine-alias-arn <value>

## List executions of a state machine
aws stepfunctions list-executions --state-machine-arn <value> [--status-filter <RUNNING | SUCCEEDED | FAILED | TIMED_OUT | ABORTED | PENDING_REDRIVE>] [--redrive-filter <REDRIVEN | NOT_REDRIVEN>]
## Retrieve information and relevant metadata about a state machine execution (output included)
aws stepfunctions describe-execution --execution-arn <value>
## Retrieve information about the state machine associated to the specified execution
aws stepfunctions describe-state-machine-for-execution --execution-arn <value>
## Retrieve the history of the specified execution as a list of events
aws stepfunctions get-execution-history --execution-arn <value> [--reverse-order | --no-reverse-order] [--include-execution-data | --no-include-execution-data]

## List tags for the specified step Functions resource
aws stepfunctions list-tags-for-resource --resource-arn <value>

## Validate the definition of a state machine without creating the resource
aws stepfunctions validate-state-machine-definition --definition <value> [--type <STANDARD | EXPRESS>]

# Activities #

## List existing activities
aws stepfunctions list-activities
## Retrieve information about the specified activity
aws stepfunctions describe-activity --activity-arn <value>

# Map Runs #

## List map runs of an execution
aws stepfunctions list-map-runs --execution-arn <value>
## Provide information about the configuration, progress and results of a Map Run
aws stepfunctions describe-map-run --map-run-arn <value>
## Lists executions of a Map Run
aws stepfunctions list-executions --map-run-arn <value> [--status-filter <RUNNING | SUCCEEDED | FAILED | TIMED_OUT | ABORTED | PENDING_REDRIVE>] [--redrive-filter <REDRIVEN | NOT_REDRIVEN>]
```
## Privesc

åœ¨ä»¥ä¸‹é¡µé¢ä¸­ï¼Œæ‚¨å¯ä»¥æŸ¥çœ‹å¦‚ä½•**æ»¥ç”¨ Step Functions æƒé™ä»¥æå‡æƒé™**ï¼š

{% content-ref url="../aws-privilege-escalation/aws-stepfunctions-privesc.md" %}
[aws-stepfunctions-privesc.md](../aws-privilege-escalation/aws-stepfunctions-privesc.md)
{% endcontent-ref %}

## Post Exploitation

{% content-ref url="../aws-post-exploitation/aws-stepfunctions-post-exploitation.md" %}
[aws-stepfunctions-post-exploitation.md](../aws-post-exploitation/aws-stepfunctions-post-exploitation.md)
{% endcontent-ref %}

## Persistence

{% content-ref url="../aws-persistence/aws-step-functions-persistence.md" %}
[aws-step-functions-persistence.md](../aws-persistence/aws-step-functions-persistence.md)
{% endcontent-ref %}

## References

* [https://docs.aws.amazon.com/service-authorization/latest/reference/list\_awsstepfunctions.html](https://docs.aws.amazon.com/service-authorization/latest/reference/list\_awsstepfunctions.html)
* [https://docs.aws.amazon.com/step-functions/latest/dg/welcome.html](https://docs.aws.amazon.com/step-functions/latest/dg/welcome.html)
* [https://states-language.net/spec.html](https://states-language.net/spec.html)

{% hint style="success" %}
å­¦ä¹ å’Œå®è·µ AWS é»‘å®¢æŠ€æœ¯ï¼š<img src="../../../.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks åŸ¹è®­ AWS çº¢é˜Ÿä¸“å®¶ (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image.png" alt="" data-size="line">\
å­¦ä¹ å’Œå®è·µ GCP é»‘å®¢æŠ€æœ¯ï¼š<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks åŸ¹è®­ GCP çº¢é˜Ÿä¸“å®¶ (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>æ”¯æŒ HackTricks</summary>

* æŸ¥çœ‹ [**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**ç”µæŠ¥ç¾¤ç»„**](https://t.me/peass) æˆ– **å…³æ³¨** æˆ‘ä»¬çš„ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ä»“åº“æäº¤ PR æ¥åˆ†äº«é»‘å®¢æŠ€å·§ã€‚

</details>
{% endhint %}
