# AWS - Step Functions Enum

{% hint style="success" %}
AWS í•´í‚¹ ë°°ìš°ê¸° ë° ì—°ìŠµí•˜ê¸°:<img src="../../../.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image.png" alt="" data-size="line">\
GCP í•´í‚¹ ë°°ìš°ê¸° ë° ì—°ìŠµí•˜ê¸°: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks ì§€ì›í•˜ê¸°</summary>

* [**êµ¬ë… ê³„íš**](https://github.com/sponsors/carlospolop) í™•ì¸í•˜ê¸°!
* **ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— ì°¸ì—¬í•˜ê±°ë‚˜ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**ë¥¼ íŒ”ë¡œìš°í•˜ì„¸ìš”.**
* **[**HackTricks**](https://github.com/carlospolop/hacktricks) ë° [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) ê¹ƒí—ˆë¸Œ ë¦¬í¬ì§€í† ë¦¬ì— PRì„ ì œì¶œí•˜ì—¬ í•´í‚¹ íŒì„ ê³µìœ í•˜ì„¸ìš”.**

</details>
{% endhint %}

## Step Functions

AWS Step FunctionsëŠ” ì—¬ëŸ¬ AWS ì„œë¹„ìŠ¤ë¥¼ ì„œë²„ë¦¬ìŠ¤ ì›Œí¬í”Œë¡œë¡œ ì¡°ì •í•˜ê³  ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜í•  ìˆ˜ ìˆëŠ” ì›Œí¬í”Œë¡œ ì„œë¹„ìŠ¤ì…ë‹ˆë‹¤. AWS Step Functionsë¥¼ ì‚¬ìš©í•˜ë©´ AWS Lambda, Amazon S3, Amazon DynamoDB ë“± ë‹¤ì–‘í•œ AWS ì„œë¹„ìŠ¤ë¥¼ ì—°ê²°í•˜ëŠ” ì›Œí¬í”Œë¡œë¥¼ ì„¤ê³„í•˜ê³  ì‹¤í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜ ì„œë¹„ìŠ¤ëŠ” ì‹œê°ì  ì›Œí¬í”Œë¡œ ì¸í„°í˜ì´ìŠ¤ë¥¼ ì œê³µí•˜ë©°, JSON ê¸°ë°˜ì˜ **Amazon States Language** (ASL)ë¥¼ ì‚¬ìš©í•˜ì—¬ ì›Œí¬í”Œë¡œì˜ ê° ë‹¨ê³„ë¥¼ ì„ ì–¸ì ìœ¼ë¡œ ì •ì˜í•  ìˆ˜ ìˆëŠ” **ìƒíƒœ ê¸°ê³„** ê¸°ëŠ¥ì„ ì œê³µí•©ë‹ˆë‹¤.

## ì£¼ìš” ê°œë…

### í‘œì¤€ vs. ìµìŠ¤í”„ë ˆìŠ¤ ì›Œí¬í”Œë¡œ

AWS Step FunctionsëŠ” ë‘ ê°€ì§€ ìœ í˜•ì˜ **ìƒíƒœ ê¸°ê³„ ì›Œí¬í”Œë¡œ**ë¥¼ ì œê³µí•©ë‹ˆë‹¤: í‘œì¤€ ë° ìµìŠ¤í”„ë ˆìŠ¤.

* **í‘œì¤€ ì›Œí¬í”Œë¡œ**: ì´ ê¸°ë³¸ ì›Œí¬í”Œë¡œ ìœ í˜•ì€ ì¥ê¸° ì‹¤í–‰, ë‚´êµ¬ì„± ë° ê°ì‚¬ ê°€ëŠ¥í•œ í”„ë¡œì„¸ìŠ¤ë¥¼ ìœ„í•´ ì„¤ê³„ë˜ì—ˆìŠµë‹ˆë‹¤. **ì •í™•íˆ í•œ ë²ˆ ì‹¤í–‰**ì„ ì§€ì›í•˜ì—¬, ì¬ì‹œë„ê°€ ì§€ì •ë˜ì§€ ì•ŠëŠ” í•œ ì‘ì—…ì´ í•œ ë²ˆë§Œ ì‹¤í–‰ë˜ë„ë¡ ë³´ì¥í•©ë‹ˆë‹¤. ìì„¸í•œ ì‹¤í–‰ ê¸°ë¡ì´ í•„ìš”í•œ ì›Œí¬í”Œë¡œì— ì í•©í•˜ë©° ìµœëŒ€ 1ë…„ê¹Œì§€ ì‹¤í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
* **ìµìŠ¤í”„ë ˆìŠ¤ ì›Œí¬í”Œë¡œ**: ì´ ìœ í˜•ì€ ê³ ìš©ëŸ‰, ë‹¨ê¸° ì‘ì—…ì— ì í•©í•˜ë©° ìµœëŒ€ 5ë¶„ê¹Œì§€ ì‹¤í–‰ë©ë‹ˆë‹¤. **ìµœì†Œ í•œ ë²ˆ ì‹¤í–‰**ì„ ì§€ì›í•˜ë©°, ë°ì´í„° ì²˜ë¦¬ì™€ ê°™ì€ ë©±ë“± ì‘ì—…ì— ì í•©í•©ë‹ˆë‹¤. ì´ëŸ¬í•œ ì›Œí¬í”Œë¡œëŠ” ë¹„ìš© ë° ì„±ëŠ¥ì„ ìµœì í™”í•˜ì—¬ ì‹¤í–‰, ì§€ì† ì‹œê°„ ë° ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ì— ë”°ë¼ ìš”ê¸ˆì´ ë¶€ê³¼ë©ë‹ˆë‹¤.

### ìƒíƒœ

ìƒíƒœëŠ” ìƒíƒœ ê¸°ê³„ì˜ í•„ìˆ˜ ë‹¨ìœ„ì…ë‹ˆë‹¤. ìƒíƒœëŠ” ì›Œí¬í”Œë¡œ ë‚´ì˜ ê°œë³„ ë‹¨ê³„ë¥¼ ì •ì˜í•˜ë©°, ìœ í˜•ì— ë”°ë¼ ë‹¤ì–‘í•œ ê¸°ëŠ¥ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

* **ì‘ì—…:** AWS ì„œë¹„ìŠ¤(ì˜ˆ: Lambda)ë¥¼ ì‚¬ìš©í•˜ì—¬ ì‘ì—…ì„ ì‹¤í–‰í•©ë‹ˆë‹¤.
* **ì„ íƒ:** ì…ë ¥ì— ë”°ë¼ ê²°ì •ì„ ë‚´ë¦½ë‹ˆë‹¤.
* **ì‹¤íŒ¨/ì„±ê³µ:** ì‹¤íŒ¨ ë˜ëŠ” ì„±ê³µìœ¼ë¡œ ì‹¤í–‰ì„ ì¢…ë£Œí•©ë‹ˆë‹¤.
* **í†µê³¼:** ì…ë ¥ì„ ì¶œë ¥ìœ¼ë¡œ ì „ë‹¬í•˜ê±°ë‚˜ ë°ì´í„°ë¥¼ ì£¼ì…í•©ë‹ˆë‹¤.
* **ëŒ€ê¸°:** ì„¤ì •ëœ ì‹œê°„ ë™ì•ˆ ì‹¤í–‰ì„ ì§€ì—°ì‹œí‚µë‹ˆë‹¤.
* **ë³‘ë ¬:** ë³‘ë ¬ ë¶„ê¸°ë¥¼ ì‹œì‘í•©ë‹ˆë‹¤.
* **ë§µ:** í•­ëª©ì— ëŒ€í•´ ë‹¨ê³„ë¥¼ ë™ì ìœ¼ë¡œ ë°˜ë³µí•©ë‹ˆë‹¤.

### ì‘ì—…

**ì‘ì—…** ìƒíƒœëŠ” ìƒíƒœ ê¸°ê³„ì— ì˜í•´ ì‹¤í–‰ë˜ëŠ” ë‹¨ì¼ ì‘ì—… ë‹¨ìœ„ë¥¼ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤. ì‘ì—…ì€ í™œë™, Lambda í•¨ìˆ˜, AWS ì„œë¹„ìŠ¤ ë˜ëŠ” íƒ€ì‚¬ APIë¥¼ í¬í•¨í•œ ë‹¤ì–‘í•œ ë¦¬ì†ŒìŠ¤ë¥¼ í˜¸ì¶œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

* **í™œë™**: ê´€ë¦¬í•˜ëŠ” ì‚¬ìš©ì ì •ì˜ ì‘ì—…ì, ì¥ê¸° ì‹¤í–‰ í”„ë¡œì„¸ìŠ¤ì— ì í•©í•©ë‹ˆë‹¤.
* ë¦¬ì†ŒìŠ¤: **`arn:aws:states:region:account:activity:name`**.
* **Lambda í•¨ìˆ˜**: AWS Lambda í•¨ìˆ˜ë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤.
* ë¦¬ì†ŒìŠ¤: **`arn:aws:lambda:region:account:function:function-name`**.
* **AWS ì„œë¹„ìŠ¤**: DynamoDB ë˜ëŠ” S3ì™€ ê°™ì€ ë‹¤ë¥¸ AWS ì„œë¹„ìŠ¤ì™€ ì§ì ‘ í†µí•©ë©ë‹ˆë‹¤.
* ë¦¬ì†ŒìŠ¤: **`arn:partition:states:region:account:servicename:APIname`**.
* **HTTP ì‘ì—…**: íƒ€ì‚¬ APIë¥¼ í˜¸ì¶œí•©ë‹ˆë‹¤.
* ë¦¬ì†ŒìŠ¤ í•„ë“œ: **`arn:aws:states:::http:invoke`**. ê·¸ëŸ° ë‹¤ìŒ API URL, ë©”ì„œë“œ ë° ì¸ì¦ ì„¸ë¶€ì •ë³´ì™€ ê°™ì€ API ì—”ë“œí¬ì¸íŠ¸ êµ¬ì„± ì„¸ë¶€ì •ë³´ë¥¼ ì œê³µí•´ì•¼ í•©ë‹ˆë‹¤.

ë‹¤ìŒ ì˜ˆì œëŠ” HelloWorldë¼ëŠ” Lambda í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ëŠ” ì‘ì—… ìƒíƒœ ì •ì˜ë¥¼ ë³´ì—¬ì¤ë‹ˆë‹¤:
```json
"HelloWorld": {
"Type": "Task",
"Resource": "arn:aws:states:::lambda:invoke",
"Parameters": {
"Payload.$": "$",
"FunctionName": "arn:aws:lambda:<region>:<account-id>:function:HelloWorld"
},
"End": true
}
```
### Choice

A **Choice** state adds conditional logic to a workflow, enabling decisions based on input data. It evaluates the specified conditions and transitions to the corresponding state based on the results.

* **Comparison**: ê° ì„ íƒ ê·œì¹™ì€ ì…ë ¥ ë³€ìˆ˜ë¥¼ ì§€ì •ëœ ê°’ ë˜ëŠ” ë‹¤ë¥¸ ë³€ìˆ˜ì™€ ë¹„êµí•˜ëŠ” ë¹„êµ ì—°ì‚°ì(ì˜ˆ: **`NumericEquals`**, **`StringEquals`**)ë¥¼ í¬í•¨í•©ë‹ˆë‹¤.
* **Next Field**: Choice ìƒíƒœëŠ” **`End`** í•„ë“œë¥¼ ì§€ì›í•˜ì§€ ì•Šìœ¼ë©°, ëŒ€ì‹  ë¹„êµê°€ ì°¸ì¼ ê²½ìš° ì „í™˜í•  **`Next`** ìƒíƒœë¥¼ ì •ì˜í•©ë‹ˆë‹¤.

Example of **Choice** state:
```json
{
"Variable": "$.timeStamp",
"TimestampEquals": "2000-01-01T00:00:00Z",
"Next": "TimeState"
}
```
### Fail/Succeed

A **`Fail`** state stops the execution of a state machine and marks it as a failure. It is used to specify an error name and a cause, providing details about the failure. This state is terminal, meaning it ends the execution flow.

A **`Succeed`** state stops the execution successfully. It is typically used to terminate the workflow when it completes successfully. This state does not require a **`Next`** field.

{% tabs %}
{% tab title="Fail example" %} ì‹¤íŒ¨ ì˜ˆì œ {% endtab %}
```json
"FailState": {
"Type": "Fail",
"Error": "ErrorName",
"Cause": "Error details"
}
```
{% endtab %}

{% tab title="ì„±ê³µ ì‚¬ë¡€" %}
```json
"SuccessState": {
"Type": "Succeed"
}
```
{% endtab %}
{% endtabs %}

### Pass

**Pass** ìƒíƒœëŠ” ì‘ì—…ì„ ìˆ˜í–‰í•˜ì§€ ì•Šê±°ë‚˜ í•„í„°ë¥¼ ì‚¬ìš©í•˜ì—¬ JSON ìƒíƒœ ì…ë ¥ì„ ë³€í™˜í•œ í›„ ë³€í™˜ëœ ë°ì´í„°ë¥¼ ë‹¤ìŒ ìƒíƒœë¡œ ì „ë‹¬í•˜ì—¬ ì…ë ¥ì„ ì¶œë ¥ìœ¼ë¡œ ì „ë‹¬í•©ë‹ˆë‹¤. ì´ëŠ” ìƒíƒœ ë¨¸ì‹ ì„ í…ŒìŠ¤íŠ¸í•˜ê³  êµ¬ì„±í•˜ëŠ” ë° ìœ ìš©í•˜ë©°, ì •ì  ë°ì´í„°ë¥¼ ì£¼ì…í•˜ê±°ë‚˜ ë³€í™˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
```json
"PassState": {
"Type": "Pass",
"Result": {"key": "value"},
"ResultPath": "$.newField",
"Next": "NextState"
}
```
### Wait

A **Wait** state delays the execution of the state machine for a specified duration. There are three primary methods to configure the wait time:

*   **X Seconds**: ëŒ€ê¸°í•  ê³ ì • ì´ˆ ìˆ˜.

```json
"WaitState": {
"Type": "Wait",
"Seconds": 10,
"Next": "NextState"
}
```
*   **Absolute Timestamp**: ëŒ€ê¸°í•  ì •í™•í•œ ì‹œê°„.

```json
"WaitState": {
"Type": "Wait",
"Timestamp": "2024-03-14T01:59:00Z",
"Next": "NextState"
}
```
*   **Dynamic Wait**: **`SecondsPath`** ë˜ëŠ” **`TimestampPath`**ë¥¼ ì‚¬ìš©í•˜ì—¬ ì…ë ¥ì— ë”°ë¼ ê²°ì •ë¨.

```json
jsonCopiar cÃ³digo
"WaitState": {
"Type": "Wait",
"TimestampPath": "$.expirydate",
"Next": "NextState"
}
```

### Parallel

A **Parallel** state allows you to execute multiple branches of tasks concurrently within your workflow. Each branch runs independently and processes its own sequence of states. The execution waits until all branches complete before proceeding to the next state. Its key fields are:

* **Branches**: ë³‘ë ¬ ì‹¤í–‰ ê²½ë¡œë¥¼ ì •ì˜í•˜ëŠ” ë°°ì—´. ê° ë¸Œëœì¹˜ëŠ” ë³„ë„ì˜ ìƒíƒœ ë¨¸ì‹ ì…ë‹ˆë‹¤.
* **ResultPath**: ë¸Œëœì¹˜ì˜ ê²°í•©ëœ ì¶œë ¥ì„ ì–´ë””ì— (ì…ë ¥ì—ì„œ) ë°°ì¹˜í• ì§€ë¥¼ ì •ì˜í•©ë‹ˆë‹¤.
* **Retry and Catch**: ë³‘ë ¬ ìƒíƒœì— ëŒ€í•œ ì˜¤ë¥˜ ì²˜ë¦¬ êµ¬ì„±ì…ë‹ˆë‹¤.
```json
"ParallelState": {
"Type": "Parallel",
"Branches": [
{
"StartAt": "Task1",
"States": { ... }
},
{
"StartAt": "Task2",
"States": { ... }
}
],
"Next": "NextState"
}
```
### Map

A **Map** state enables the execution of a set of steps for each item in an dataset. It's used for parallel processing of data. Depending on how you want to process the items of the dataset, Step Functions provides the following modes:

*   **Inline Mode**: ê° JSON ë°°ì—´ í•­ëª©ì— ëŒ€í•´ ìƒíƒœì˜ í•˜ìœ„ ì§‘í•©ì„ ì‹¤í–‰í•©ë‹ˆë‹¤. 40ê°œ ë¯¸ë§Œì˜ ë³‘ë ¬ ë°˜ë³µì´ ìˆëŠ” ì†Œê·œëª¨ ì‘ì—…ì— ì í•©í•˜ë©°, **`Map`** ìƒíƒœë¥¼ í¬í•¨í•˜ëŠ” ì›Œí¬í”Œë¡œìš°ì˜ ë§¥ë½ì—ì„œ ê° ì‘ì—…ì„ ì‹¤í–‰í•©ë‹ˆë‹¤.

```json
"MapState": {
"Type": "Map",
"ItemsPath": "$.arrayItems",
"ItemProcessor": {
"ProcessorConfig": {
"Mode": "INLINE"
},
"StartAt": "AddState",
"States": {
"AddState": {
"Type": "Task",
"Resource": "arn:aws:states:::lambda:invoke",
"OutputPath": "$.Payload",
"Parameters": {
"FunctionName": "arn:aws:lambda:<region>:<account-id>:function:add-function"
},
"End": true
}
}
},
"End": true
"ResultPath": "$.detail.added",
"ItemsPath": "$.added"
}
```
*   **Distributed Mode**: ë†’ì€ ë™ì‹œì„±ì„ ê°€ì§„ ëŒ€ê·œëª¨ ë³‘ë ¬ ì²˜ë¦¬ë¥¼ ìœ„í•´ ì„¤ê³„ë˜ì—ˆìŠµë‹ˆë‹¤. Amazon S3ì— ì €ì¥ëœ ëŒ€ëŸ‰ì˜ ë°ì´í„° ì„¸íŠ¸ë¥¼ ì²˜ë¦¬í•  ìˆ˜ ìˆìœ¼ë©°, ìµœëŒ€ 10,000ê°œì˜ ë³‘ë ¬ ìì‹ ì›Œí¬í”Œë¡œìš° ì‹¤í–‰ì„ ì§€ì›í•©ë‹ˆë‹¤. ì´ ìì‹ë“¤ì€ ë³„ë„ì˜ ìì‹ ì‹¤í–‰ìœ¼ë¡œ ì‹¤í–‰ë©ë‹ˆë‹¤.

```json
"DistributedMapState": {
"Type": "Map",
"ItemReader": {
"Resource": "arn:aws:states:::s3:getObject",
"Parameters": {
"Bucket": "my-bucket",
"Key": "data.csv"
}
},
"ItemProcessor": {
"ProcessorConfig": {
"Mode": "DISTRIBUTED",
"ExecutionType": "EXPRESS"
},
"StartAt": "ProcessItem",
"States": {
"ProcessItem": {
"Type": "Task",
"Resource": "arn:aws:lambda:region:account-id:function:my-function",
"End": true
}
}
},
"End": true
"ResultWriter": {
"Resource": "arn:aws:states:::s3:putObject",
"Parameters": {
"Bucket": "myOutputBucket",
"Prefix": "csvProcessJobs"
}
}
}
```

### Versions and aliases

Step Functions also lets you manage workflow deployments through **versions** and **aliases** of state machines. A version represents a snapshot of a state machine that can be executed. Aliases serve as pointers to up to two versions of a state machine.

* **Versions**: ì´ëŸ¬í•œ ë¶ˆë³€ ìŠ¤ëƒ…ìƒ·ì€ í•´ë‹¹ ìƒíƒœ ê¸°ê³„ì˜ ê°€ì¥ ìµœê·¼ ìˆ˜ì •ë³¸ì—ì„œ ìƒì„±ë©ë‹ˆë‹¤. ê° ë²„ì „ì€ ìƒíƒœ ê¸°ê³„ ARNê³¼ ë²„ì „ ë²ˆí˜¸ë¥¼ ì½œë¡ ìœ¼ë¡œ êµ¬ë¶„í•˜ì—¬ ê²°í•©í•œ ê³ ìœ  ARNìœ¼ë¡œ ì‹ë³„ë©ë‹ˆë‹¤ (**`arn:aws:states:region:account-id:stateMachine:StateMachineName:version-number`**). ë²„ì „ì€ í¸ì§‘í•  ìˆ˜ ì—†ì§€ë§Œ, ìƒíƒœ ê¸°ê³„ë¥¼ ì—…ë°ì´íŠ¸í•˜ê³  ìƒˆ ë²„ì „ì„ ê²Œì‹œí•˜ê±°ë‚˜ ì›í•˜ëŠ” ìƒíƒœ ê¸°ê³„ ë²„ì „ì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
* **Aliases**: ì´ëŸ¬í•œ í¬ì¸í„°ëŠ” ë™ì¼í•œ ìƒíƒœ ê¸°ê³„ì˜ ìµœëŒ€ ë‘ ë²„ì „ì„ ì°¸ì¡°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë‹¨ì¼ ìƒíƒœ ê¸°ê³„ì— ëŒ€í•´ ì—¬ëŸ¬ ê°œì˜ ë³„ì¹­ì„ ìƒì„±í•  ìˆ˜ ìˆìœ¼ë©°, ê° ë³„ì¹­ì€ ìƒíƒœ ê¸°ê³„ ARNê³¼ ë³„ì¹­ ì´ë¦„ì„ ì½œë¡ ìœ¼ë¡œ êµ¬ë¶„í•˜ì—¬ ê²°í•©í•œ ê³ ìœ  ARNìœ¼ë¡œ ì‹ë³„ë©ë‹ˆë‹¤ (**`arn:aws:states:region:account-id:stateMachine:StateMachineName:aliasName`**). ë³„ì¹­ì€ ìƒíƒœ ê¸°ê³„ì˜ ë‘ ë²„ì „ ê°„ì˜ íŠ¸ë˜í”½ ë¼ìš°íŒ…ì„ ê°€ëŠ¥í•˜ê²Œ í•©ë‹ˆë‹¤. ë˜ëŠ” ë³„ì¹­ì€ ìƒíƒœ ê¸°ê³„ì˜ íŠ¹ì • ë²„ì „ì„ ê°€ë¦¬í‚¬ ìˆ˜ ìˆì§€ë§Œ ë‹¤ë¥¸ ë³„ì¹­ì„ ê°€ë¦¬í‚¬ ìˆ˜ëŠ” ì—†ìŠµë‹ˆë‹¤. í•„ìš”ì— ë”°ë¼ ë‹¤ë¥¸ ë²„ì „ì˜ ìƒíƒœ ê¸°ê³„ë¡œ ë¦¬ë””ë ‰ì…˜í•˜ë„ë¡ ì—…ë°ì´íŠ¸í•  ìˆ˜ ìˆì–´, ì œì–´ëœ ë°°í¬ ë° ì›Œí¬í”Œë¡œìš° ê´€ë¦¬ë¥¼ ìš©ì´í•˜ê²Œ í•©ë‹ˆë‹¤.

For more detailed information about **ASL**, check: [**Amazon States Language**](https://states-language.net/spec.html).

## IAM Roles for State machines

AWS Step Functions utilizes AWS Identity and Access Management (IAM) roles to control access to resources and actions within state machines. Here are the key aspects related to security and IAM roles in AWS Step Functions:

* **Execution Role**: AWS Step Functionsì˜ ê° ìƒíƒœ ê¸°ê³„ëŠ” IAM ì‹¤í–‰ ì—­í• ê³¼ ì—°ê²°ë˜ì–´ ìˆìŠµë‹ˆë‹¤. ì´ ì—­í• ì€ ìƒíƒœ ê¸°ê³„ê°€ ê·€í•˜ë¥¼ ëŒ€ì‹ í•˜ì—¬ ìˆ˜í–‰í•  ìˆ˜ ìˆëŠ” ì‘ì—…ì„ ì •ì˜í•©ë‹ˆë‹¤. ìƒíƒœ ê¸°ê³„ê°€ AWS ì„œë¹„ìŠ¤ì™€ ìƒí˜¸ ì‘ìš©í•˜ëŠ” ìƒíƒœ ê°„ì— ì „í™˜í•  ë•Œ(ì˜ˆ: Lambda í•¨ìˆ˜ í˜¸ì¶œ, DynamoDB ì ‘ê·¼ ë“±), ì´ ì‹¤í–‰ ì—­í• ì„ ê°€ì •í•˜ì—¬ í•´ë‹¹ ì‘ì—…ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤.
* **Permissions**: IAM ì‹¤í–‰ ì—­í• ì€ ë‹¤ë¥¸ AWS ì„œë¹„ìŠ¤ì—ì„œ í•„ìš”í•œ ì‘ì—…ì„ í—ˆìš©í•˜ëŠ” ê¶Œí•œìœ¼ë¡œ êµ¬ì„±ë˜ì–´ì•¼ í•©ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´, ìƒíƒœ ê¸°ê³„ê°€ AWS Lambda í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•´ì•¼ í•˜ëŠ” ê²½ìš°, IAM ì—­í• ì€ **`lambda:InvokeFunction`** ê¶Œí•œì„ ê°€ì ¸ì•¼ í•©ë‹ˆë‹¤. ë§ˆì°¬ê°€ì§€ë¡œ, DynamoDBì— ì“°ê¸° ìœ„í•´ì„œëŠ” ì ì ˆí•œ ê¶Œí•œ(**`dynamodb:PutItem`**, **`dynamodb:UpdateItem`** ë“±)ì´ ë¶€ì—¬ë˜ì–´ì•¼ í•©ë‹ˆë‹¤.

## Enumeration

ReadOnlyAccess policy is enough for all the following enumeration actions.
```bash
# State machines #

## List state machines
aws stepfunctions list-state-machines
## Retrieve informatio about the specified state machine
aws stepfunctions describe-state-machine --state-machine-arn <value>

## List versions for the specified state machine
aws stepfunctions list-state-machine-versions --state-machine-arn <value>
## List aliases for the specified state machine
aws stepfunctions list-state-machine-aliases --state-machine-arn <value>
## Retrieve information about the specified state machine alias
aws stepfunctions describe-state-machine-alias --state-machine-alias-arn <value>

## List executions of a state machine
aws stepfunctions list-executions --state-machine-arn <value> [--status-filter <RUNNING | SUCCEEDED | FAILED | TIMED_OUT | ABORTED | PENDING_REDRIVE>] [--redrive-filter <REDRIVEN | NOT_REDRIVEN>]
## Retrieve information and relevant metadata about a state machine execution (output included)
aws stepfunctions describe-execution --execution-arn <value>
## Retrieve information about the state machine associated to the specified execution
aws stepfunctions describe-state-machine-for-execution --execution-arn <value>
## Retrieve the history of the specified execution as a list of events
aws stepfunctions get-execution-history --execution-arn <value> [--reverse-order | --no-reverse-order] [--include-execution-data | --no-include-execution-data]

## List tags for the specified step Functions resource
aws stepfunctions list-tags-for-resource --resource-arn <value>

## Validate the definition of a state machine without creating the resource
aws stepfunctions validate-state-machine-definition --definition <value> [--type <STANDARD | EXPRESS>]

# Activities #

## List existing activities
aws stepfunctions list-activities
## Retrieve information about the specified activity
aws stepfunctions describe-activity --activity-arn <value>

# Map Runs #

## List map runs of an execution
aws stepfunctions list-map-runs --execution-arn <value>
## Provide information about the configuration, progress and results of a Map Run
aws stepfunctions describe-map-run --map-run-arn <value>
## Lists executions of a Map Run
aws stepfunctions list-executions --map-run-arn <value> [--status-filter <RUNNING | SUCCEEDED | FAILED | TIMED_OUT | ABORTED | PENDING_REDRIVE>] [--redrive-filter <REDRIVEN | NOT_REDRIVEN>]
```
## Privesc

ë‹¤ìŒ í˜ì´ì§€ì—ì„œ **Step Functions ê¶Œí•œì„ ì•…ìš©í•˜ì—¬ ê¶Œí•œ ìƒìŠ¹í•˜ëŠ” ë°©ë²•**ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

{% content-ref url="../aws-privilege-escalation/aws-stepfunctions-privesc.md" %}
[aws-stepfunctions-privesc.md](../aws-privilege-escalation/aws-stepfunctions-privesc.md)
{% endcontent-ref %}

## Post Exploitation

{% content-ref url="../aws-post-exploitation/aws-stepfunctions-post-exploitation.md" %}
[aws-stepfunctions-post-exploitation.md](../aws-post-exploitation/aws-stepfunctions-post-exploitation.md)
{% endcontent-ref %}

## Persistence

{% content-ref url="../aws-persistence/aws-step-functions-persistence.md" %}
[aws-step-functions-persistence.md](../aws-persistence/aws-step-functions-persistence.md)
{% endcontent-ref %}

## References

* [https://docs.aws.amazon.com/service-authorization/latest/reference/list\_awsstepfunctions.html](https://docs.aws.amazon.com/service-authorization/latest/reference/list\_awsstepfunctions.html)
* [https://docs.aws.amazon.com/step-functions/latest/dg/welcome.html](https://docs.aws.amazon.com/step-functions/latest/dg/welcome.html)
* [https://states-language.net/spec.html](https://states-language.net/spec.html)

{% hint style="success" %}
AWS í•´í‚¹ì„ ë°°ìš°ê³  ì—°ìŠµí•˜ì„¸ìš”:<img src="../../../.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image.png" alt="" data-size="line">\
GCP í•´í‚¹ì„ ë°°ìš°ê³  ì—°ìŠµí•˜ì„¸ìš”: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks ì§€ì›í•˜ê¸°</summary>

* [**êµ¬ë… ê³„íš**](https://github.com/sponsors/carlospolop) í™•ì¸í•˜ê¸°!
* **ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— ì°¸ì—¬í•˜ê±°ë‚˜ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**ë¥¼ íŒ”ë¡œìš°í•˜ì„¸ìš”.**
* **[**HackTricks**](https://github.com/carlospolop/hacktricks) ë° [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) ê¹ƒí—ˆë¸Œ ë¦¬í¬ì— PRì„ ì œì¶œí•˜ì—¬ í•´í‚¹ íŒì„ ê³µìœ í•˜ì„¸ìš”.**

</details>
{% endhint %}
