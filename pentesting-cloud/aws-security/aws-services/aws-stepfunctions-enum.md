# AWS - Step Functions Enum

<details>

<summary><strong>htARTE (HackTricks AWS Red Team ì „ë¬¸ê°€)</strong>ì—ì„œ <strong>ì œë¡œë¶€í„° ì˜ì›…ê¹Œì§€ AWS í•´í‚¹ ë°°ìš°ê¸°</strong>!</summary>

ë‹¤ë¥¸ HackTricks ì§€ì› ë°©ë²•:

* **íšŒì‚¬ë¥¼ HackTricksì—ì„œ ê´‘ê³ í•˜ê±°ë‚˜ HackTricksë¥¼ PDFë¡œ ë‹¤ìš´ë¡œë“œ**í•˜ê³  ì‹¶ë‹¤ë©´ [**êµ¬ë… ìš”ê¸ˆì œ**](https://github.com/sponsors/carlospolop)ë¥¼ í™•ì¸í•˜ì„¸ìš”!
* [**ê³µì‹ PEASS & HackTricks ìŠ¤ì™œê·¸**](https://peass.creator-spring.com)ë¥¼ êµ¬ì…í•˜ì„¸ìš”
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ë¥¼ ë°œê²¬í•˜ì„¸ìš”, ë‹¹ì‚¬ì˜ ë…ì  [**NFTs**](https://opensea.io/collection/the-peass-family) ì»¬ë ‰ì…˜
* **ğŸ’¬ [Discord ê·¸ë£¹](https://discord.gg/hRep4RUj7f)** ë˜ëŠ” [í…”ë ˆê·¸ë¨ ê·¸ë£¹](https://t.me/peass)ì— **ê°€ì…**í•˜ê±°ë‚˜ **íŠ¸ìœ„í„°** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**ë¥¼ íŒ”ë¡œìš°**í•˜ì„¸ìš”.
* **HackTricks** ë° **HackTricks Cloud** github ì €ì¥ì†Œì— PRì„ ì œì¶œí•˜ì—¬ í•´í‚¹ íŠ¸ë¦­ì„ ê³µìœ í•˜ì„¸ìš”.

</details>

## Step Functions

AWS Step Functionsì€ ì—¬ëŸ¬ AWS ì„œë¹„ìŠ¤ë¥¼ ì„œë²„ë¦¬ìŠ¤ ì›Œí¬í”Œë¡œìš°ë¡œ ì¡°ì •í•˜ê³  ì¡°ìœ¨í•  ìˆ˜ ìˆëŠ” ì›Œí¬í”Œë¡œìš° ì„œë¹„ìŠ¤ì…ë‹ˆë‹¤. AWS Step Functionsì„ ì‚¬ìš©í•˜ë©´ AWS Lambda, Amazon S3, Amazon DynamoDB ë“± ë‹¤ì–‘í•œ AWS ì„œë¹„ìŠ¤ë¥¼ ì—°ê²°í•˜ëŠ” ì›Œí¬í”Œë¡œìš°ë¥¼ ì„¤ê³„í•˜ê³  ì‹¤í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ ì¡°ìœ¨ ì„œë¹„ìŠ¤ëŠ” ì‹œê°ì  ì›Œí¬í”Œë¡œìš° ì¸í„°í˜ì´ìŠ¤ë¥¼ ì œê³µí•˜ë©° JSON ê¸°ë°˜ **Amazon States Language** (ASL)ì„ ì‚¬ìš©í•˜ì—¬ ì›Œí¬í”Œë¡œìš°ì˜ ê° ë‹¨ê³„ë¥¼ ì„ ì–¸ì ìœ¼ë¡œ ì •ì˜í•  ìˆ˜ ìˆëŠ” **ìƒíƒœ ê¸°ê³„** ê¸°ëŠ¥ì„ ì œê³µí•©ë‹ˆë‹¤.

AWS Step FunctionsëŠ” ê¸°ë³¸ ì¸í”„ë¼ ê´€ë¦¬, ì¬ì‹œë„, ì˜¤ë¥˜ ì²˜ë¦¬ ë° ë³‘ë ¬ ì²˜ë¦¬ë¥¼ ìë™ìœ¼ë¡œ ì²˜ë¦¬í•¨ìœ¼ë¡œì¨ íƒ„ë ¥ì ì´ê³  í™•ì¥ ê°€ëŠ¥í•œ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ êµ¬ì¶•í•˜ëŠ” í”„ë¡œì„¸ìŠ¤ë¥¼ ê°„ì†Œí™”í•©ë‹ˆë‹¤. ì´ ì„œë¹„ìŠ¤ëŠ” ì—¬ëŸ¬ ë‹¨ê³„ì™€ ì˜ì‚¬ ê²°ì • ì§€ì ì„ í¬í•¨í•˜ëŠ” ë³µì¡í•œ ì›Œí¬í”Œë¡œìš°ë¥¼ ë§Œë“œëŠ” ë° íŠ¹íˆ ìœ ìš©í•˜ë©° ë°ì´í„° ë° ì‹¤í–‰ ìƒíƒœì˜ íë¦„ì„ ì‰½ê²Œ ê´€ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ ì„œë¹„ìŠ¤ì—ì„œ ìˆ˜í–‰í•  ì£¼ìš” ì‚¬ìš© ì‚¬ë¡€ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤:

- **ë°ì´í„° ì²˜ë¦¬**: íŒŒì¼, ë¹„ë””ì˜¤ ë° ì´ë¯¸ì§€ ì²˜ë¦¬; ì¶”ì¶œ, ë³€í™˜ ë° ë¡œë“œ (ETL) ì‘ì—…; ë° ì¼ê´„ ì²˜ë¦¬ ë° ê³ ì„±ëŠ¥ ì»´í“¨íŒ… (HPC) ì›Œí¬ë¡œë“œ.
- **ë¨¸ì‹  ëŸ¬ë‹**: ì‚¬ê¸° íƒì§€, ë§ì¶¤í™”, ì¶”ì²œ ë° ë°ì´í„° í’ë¶€í™”.
- **ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ ì¡°ìœ¨**: ë™ê¸°ì‹ ë˜ëŠ” ì‹¤ì‹œê°„ ì›Œí¬í”Œë¡œìš° ë° ì»¨í…Œì´ë„ˆ ì¡°ìœ¨.
- **IT ë° ë³´ì•ˆ ìë™í™”**: ìë™ ë³µêµ¬, ë°°í¬ ë° ì‘ë‹µ; ê·¸ë¦¬ê³  ì¸ê°„ ìŠ¹ì¸ ë° ìŠ¹ê²©.

## ì£¼ìš” ê°œë…

### í‘œì¤€ vs. Express ì›Œí¬í”Œë¡œìš°

AWS Step Functionsì€ ë‘ ê°€ì§€ ìœ í˜•ì˜ **ìƒíƒœ ê¸°ê³„ ì›Œí¬í”Œë¡œìš°**ë¥¼ ì œê³µí•©ë‹ˆë‹¤: í‘œì¤€ ë° Express.

- **í‘œì¤€ ì›Œí¬í”Œë¡œìš°**: ì´ ê¸°ë³¸ ì›Œí¬í”Œë¡œìš° ìœ í˜•ì€ ì¥ê¸° ì‹¤í–‰, ë‚´êµ¬ì„± ë° ê°ì‚¬ ê°€ëŠ¥í•œ í”„ë¡œì„¸ìŠ¤ë¥¼ ìœ„í•´ ì„¤ê³„ë˜ì—ˆìŠµë‹ˆë‹¤. **ì •í™•íˆ í•œ ë²ˆ ì‹¤í–‰**ì„ ì§€ì›í•˜ì—¬ ì¬ì‹œë„ê°€ ì§€ì •ë˜ì§€ ì•ŠëŠ” í•œ ì‘ì—…ì´ í•œ ë²ˆë§Œ ì‹¤í–‰ë˜ë„ë¡ ë³´ì¥í•©ë‹ˆë‹¤. ìì„¸í•œ ì‹¤í–‰ ì´ë ¥ì´ í•„ìš”í•œ ì›Œí¬í”Œë¡œìš°ì— ì´ìƒì ì´ë©° ìµœëŒ€ 1ë…„ ë™ì•ˆ ì‹¤í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- **Express ì›Œí¬í”Œë¡œìš°**: ì´ ìœ í˜•ì€ ê³ ìš©ëŸ‰, ë‹¨ê¸° ì‘ì—…ì— ì´ìƒì ì´ë©° ìµœëŒ€ 5ë¶„ê¹Œì§€ ì‹¤í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. **ì ì–´ë„ í•œ ë²ˆ ì‹¤í–‰**ì„ ì§€ì›í•˜ë©° ë°ì´í„° ì²˜ë¦¬ì™€ ê°™ì€ ë©±ë“± ì‘ì—…ì— ì í•©í•©ë‹ˆë‹¤. ì´ëŸ¬í•œ ì›Œí¬í”Œë¡œìš°ëŠ” ì‹¤í–‰, ì§€ì† ì‹œê°„ ë° ë©”ëª¨ë¦¬ ì‚¬ìš©ì— ë”°ë¼ ë¹„ìš©ì„ ìµœì í™”í•˜ë©° ì„±ëŠ¥ì„ í–¥ìƒì‹œí‚µë‹ˆë‹¤.

### ìƒíƒœ

ìƒíƒœëŠ” ìƒíƒœ ê¸°ê³„ì˜ í•„ìˆ˜ ë‹¨ìœ„ì…ë‹ˆë‹¤. ìƒíƒœëŠ” ìœ í˜•ì— ë”°ë¼ ë‹¤ì–‘í•œ ê¸°ëŠ¥ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆìœ¼ë©° ì›Œí¬í”Œë¡œìš° ë‚´ì—ì„œ ê°œë³„ ë‹¨ê³„ë¥¼ ì •ì˜í•©ë‹ˆë‹¤.

- **ì‘ì—…(Task)**: ì…ë ¥ì— ë”°ë¼ ê²°ì •ì„ ë‚´ë¦½ë‹ˆë‹¤.
- **ì„ íƒ(Choice)**: ì‘ì—…ì„ ì‹¤í–‰í•˜ëŠ” ìƒíƒœ ê¸°ê³„ì—ì„œ ì‹¤í–‰ë˜ëŠ” ë‹¨ì¼ ì‘ì—…ì„ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤.
- **ì‹¤íŒ¨/ì„±ê³µ(Fail/Succeed)**: ì‹¤íŒ¨ ë˜ëŠ” ì„±ê³µìœ¼ë¡œ ì‹¤í–‰ì„ ì¢…ë£Œí•©ë‹ˆë‹¤.
- **í†µê³¼(Pass)**: ì…ë ¥ì„ ì¶œë ¥ìœ¼ë¡œ ì „ë‹¬í•˜ê±°ë‚˜ ë°ì´í„°ë¥¼ ì‚½ì…í•©ë‹ˆë‹¤.
- **ëŒ€ê¸°(Wait)**: ì¼ì • ì‹œê°„ ë™ì•ˆ ì‹¤í–‰ì„ ì§€ì—°ì‹œí‚µë‹ˆë‹¤.
- **ë³‘ë ¬(Parallel)**: ë³‘ë ¬ ë¶„ê¸°ë¥¼ ì‹œì‘í•©ë‹ˆë‹¤.
- **ë§µ(Map)**: í•­ëª©ì„ í†µí•´ ë‹¨ê³„ë¥¼ ë™ì ìœ¼ë¡œ ë°˜ë³µí•©ë‹ˆë‹¤.

### ì‘ì—…

**ì‘ì—…(Task)** ìƒíƒœëŠ” ìƒíƒœ ê¸°ê³„ì— ì˜í•´ ì‹¤í–‰ë˜ëŠ” ë‹¨ì¼ ì‘ì—… ë‹¨ìœ„ë¥¼ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤. ì‘ì—…ì€ í™œë™, ëŒë‹¤ í•¨ìˆ˜, AWS ì„œë¹„ìŠ¤ ë˜ëŠ” íƒ€ì‚¬ APIë¥¼ í¬í•¨í•œ ë‹¤ì–‘í•œ ë¦¬ì†ŒìŠ¤ë¥¼ í˜¸ì¶œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

- **í™œë™(Activities)**: ì¥ê¸° ì‹¤í–‰ í”„ë¡œì„¸ìŠ¤ì— ì í•©í•œ ì‚¬ìš©ìê°€ ê´€ë¦¬í•˜ëŠ” ì‚¬ìš©ì ì§€ì • ì›Œì»¤ì…ë‹ˆë‹¤.
- ë¦¬ì†ŒìŠ¤: **`arn:aws:states:region:account:activity:name`**.
- **Lambda í•¨ìˆ˜**: AWS Lambda í•¨ìˆ˜ë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤.
- ë¦¬ì†ŒìŠ¤: **`arn:aws:lambda:region:account:function:function-name`**.
- **AWS ì„œë¹„ìŠ¤**: ë‹¤ë¥¸ AWS ì„œë¹„ìŠ¤(ì˜ˆ: DynamoDB ë˜ëŠ” S3)ì™€ ì§ì ‘ í†µí•©í•©ë‹ˆë‹¤.
- ë¦¬ì†ŒìŠ¤: **`arn:partition:states:region:account:servicename:APIname`**.
- **HTTP ì‘ì—…**: íƒ€ì‚¬ APIë¥¼ í˜¸ì¶œí•©ë‹ˆë‹¤.
- ë¦¬ì†ŒìŠ¤ í•„ë“œ: **`arn:aws:states:::http:invoke`**. ê·¸ëŸ° ë‹¤ìŒ API URL, ë©”ì„œë“œ ë° ì¸ì¦ ì„¸ë¶€ ì •ë³´ì™€ ê°™ì€ API ì—”ë“œí¬ì¸íŠ¸ êµ¬ì„± ì„¸ë¶€ ì •ë³´ë¥¼ ì œê³µí•´ì•¼ í•©ë‹ˆë‹¤.

ë‹¤ìŒ ì˜ˆì œëŠ” HelloWorldë¼ëŠ” ëŒë‹¤ í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ëŠ” ì‘ì—… ìƒíƒœ ì •ì˜ë¥¼ ë³´ì—¬ì¤ë‹ˆë‹¤:
```json
"HelloWorld": {
"Type": "Task",
"Resource": "arn:aws:states:::lambda:invoke",
"Parameters": {
"Payload.$": "$",
"FunctionName": "arn:aws:lambda:<region>:<account-id>:function:HelloWorld"
},
"End": true
}
```
### ì„ íƒ

**ì„ íƒ(Choice)** ìƒíƒœëŠ” ì…ë ¥ ë°ì´í„°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ í•œ ê²°ì •ì„ ê°€ëŠ¥í•˜ê²Œ í•˜ëŠ” ì¡°ê±´ë¶€ ë…¼ë¦¬ë¥¼ ì›Œí¬í”Œë¡œì— ì¶”ê°€í•©ë‹ˆë‹¤. ì§€ì •ëœ ì¡°ê±´ì„ í‰ê°€í•˜ê³  ê²°ê³¼ì— ë”°ë¼ í•´ë‹¹ ìƒíƒœë¡œ ì „í™˜í•©ë‹ˆë‹¤.

- **ë¹„êµ(Comparison)**: ê° ì„ íƒ ê·œì¹™ì—ëŠ” ì…ë ¥ ë³€ìˆ˜ë¥¼ ì§€ì •ëœ ê°’ì´ë‚˜ ë‹¤ë¥¸ ë³€ìˆ˜ì™€ ë¹„êµí•˜ëŠ” ë¹„êµ ì—°ì‚°ì(ì˜ˆ: **`NumericEquals`**, **`StringEquals`**)ê°€ í¬í•¨ë©ë‹ˆë‹¤.
- **ë‹¤ìŒ í•„ë“œ(Next Field)**: ì„ íƒ ìƒíƒœëŠ” **`End`** í•„ë“œë¥¼ ì§€ì›í•˜ì§€ ì•Šìœ¼ë©° ëŒ€ì‹ , ë¹„êµê°€ ì°¸ì¼ ê²½ìš° ì „í™˜í•  **`Next`** ìƒíƒœë¥¼ ì •ì˜í•©ë‹ˆë‹¤.

**ì„ íƒ(Choice)** ìƒíƒœì˜ ì˜ˆì‹œ:
```json
{
"Variable": "$.timeStamp",
"TimestampEquals": "2000-01-01T00:00:00Z",
"Next": "TimeState"
}
```
### ì‹¤íŒ¨/ì„±ê³µ

**`Fail`** ìƒíƒœëŠ” ìƒíƒœ ë¨¸ì‹ ì˜ ì‹¤í–‰ì„ ì¤‘ì§€í•˜ê³  ì‹¤íŒ¨ë¡œ í‘œì‹œí•©ë‹ˆë‹¤. ì˜¤ë¥˜ ì´ë¦„ê³¼ ì›ì¸ì„ ì§€ì •í•˜ì—¬ ì‹¤íŒ¨ì— ëŒ€í•œ ì„¸ë¶€ ì •ë³´ë¥¼ ì œê³µí•˜ëŠ” ë° ì‚¬ìš©ë©ë‹ˆë‹¤. ì´ ìƒíƒœëŠ” ì¢…ë‹¨ ìƒíƒœì´ë©° ì‹¤í–‰ íë¦„ì„ ì¢…ë£Œí•©ë‹ˆë‹¤.

**`Succeed`** ìƒíƒœëŠ” ì‹¤í–‰ì„ ì„±ê³µì ìœ¼ë¡œ ì¤‘ì§€í•©ë‹ˆë‹¤. ì¼ë°˜ì ìœ¼ë¡œ ì›Œí¬í”Œë¡œê°€ ì„±ê³µì ìœ¼ë¡œ ì™„ë£Œë  ë•Œ ì¢…ë£Œí•˜ëŠ” ë° ì‚¬ìš©ë©ë‹ˆë‹¤. ì´ ìƒíƒœëŠ” **`Next`** í•„ë“œë¥¼ í•„ìš”ë¡œí•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.

{% tabs %}

{% tab title="ì‹¤íŒ¨ ì˜ˆì‹œ" %}
```json
"FailState": {
"Type": "Fail",
"Error": "ErrorName",
"Cause": "Error details"
}
```
{% endtab %}

{% tab title="ì„±ê³µ ì˜ˆì‹œ" %}
```json
"SuccessState": {
"Type": "Succeed"
}
```
### í†µê³¼

**í†µê³¼** ìƒíƒœëŠ” ì…ë ¥ì„ ì¶œë ¥ìœ¼ë¡œ ì „ë‹¬í•˜ê±°ë‚˜ ì‘ì—…ì„ ìˆ˜í–‰í•˜ì§€ ì•Šê³  JSON ìƒíƒœ ì…ë ¥ì„ í•„í„°ë¥¼ ì‚¬ìš©í•˜ì—¬ ë³€í™˜í•œ ë‹¤ìŒ ë³€í™˜ëœ ë°ì´í„°ë¥¼ ë‹¤ìŒ ìƒíƒœë¡œ ì „ë‹¬í•©ë‹ˆë‹¤. ì´ëŠ” í…ŒìŠ¤íŠ¸ ë° ìƒíƒœ ë¨¸ì‹  êµ¬ì„±ì— ìœ ìš©í•˜ë©° ì •ì  ë°ì´í„°ë¥¼ ì‚½ì…í•˜ê±°ë‚˜ ë³€í™˜í•  ìˆ˜ ìˆë„ë¡ í•©ë‹ˆë‹¤.
```json
"PassState": {
"Type": "Pass",
"Result": {"key": "value"},
"ResultPath": "$.newField",
"Next": "NextState"
}
```
### ëŒ€ê¸°

**ëŒ€ê¸°** ìƒíƒœëŠ” ìƒíƒœ ë¨¸ì‹ ì˜ ì‹¤í–‰ì„ ì§€ì •ëœ ê¸°ê°„ ë™ì•ˆ ì§€ì—°ì‹œí‚µë‹ˆë‹¤. ëŒ€ê¸° ì‹œê°„ì„ êµ¬ì„±í•˜ëŠ” ì£¼ìš” ë°©ë²•ì€ ì„¸ ê°€ì§€ê°€ ìˆìŠµë‹ˆë‹¤:

- **X ì´ˆ**: ê¸°ë‹¤ë¦´ ê³ ì •ëœ ì´ˆ ë‹¨ìœ„ì˜ ì‹œê°„.

```json
"WaitState": {
"Type": "Wait",
"Seconds": 10,
"Next": "NextState"
}
```

- **ì ˆëŒ€ íƒ€ì„ìŠ¤íƒ¬í”„**: ê¸°ë‹¤ë¦´ ì •í™•í•œ ì‹œê°„.

```json
"WaitState": {
"Type": "Wait",
"Timestamp": "2024-03-14T01:59:00Z",
"Next": "NextState"
}
```

- **ë™ì  ëŒ€ê¸°**: **`SecondsPath`** ë˜ëŠ” **`TimestampPath`**ë¥¼ ì‚¬ìš©í•˜ì—¬ ì…ë ¥ì„ ê¸°ë°˜ìœ¼ë¡œ í•©ë‹ˆë‹¤.

```json
"WaitState": {
"Type": "Wait",
"TimestampPath": "$.expirydate",
"Next": "NextState"
}
```


### ë³‘ë ¬

**ë³‘ë ¬** ìƒíƒœëŠ” ì›Œí¬í”Œë¡œ ë‚´ì—ì„œ ì—¬ëŸ¬ ê°€ì§€ ì‘ì—… ë¸Œëœì¹˜ë¥¼ ë™ì‹œì— ì‹¤í–‰í•  ìˆ˜ ìˆê²Œ í•©ë‹ˆë‹¤. ê° ë¸Œëœì¹˜ëŠ” ë…ë¦½ì ìœ¼ë¡œ ì‹¤í–‰ë˜ë©° ìì²´ ìƒíƒœ ì‹œí€€ìŠ¤ë¥¼ ì²˜ë¦¬í•©ë‹ˆë‹¤. ì‹¤í–‰ì€ ëª¨ë“  ë¸Œëœì¹˜ê°€ ì™„ë£Œë  ë•Œê¹Œì§€ ê¸°ë‹¤ë¦° í›„ ë‹¤ìŒ ìƒíƒœë¡œ ì§„í–‰í•©ë‹ˆë‹¤. ì£¼ìš” í•„ë“œëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤:

- **Branches**: ë³‘ë ¬ ì‹¤í–‰ ê²½ë¡œë¥¼ ì •ì˜í•˜ëŠ” ë°°ì—´ì…ë‹ˆë‹¤. ê° ë¸Œëœì¹˜ëŠ” ë³„ë„ì˜ ìƒíƒœ ë¨¸ì‹ ì…ë‹ˆë‹¤.
- **ResultPath**: ë¸Œëœì¹˜ì˜ ê²°í•©ëœ ì¶œë ¥ì„ ì…ë ¥ì—ì„œ ì–´ë””ì— ë°°ì¹˜í• ì§€ ì •ì˜í•©ë‹ˆë‹¤.
- **Retry ë° Catch**: ë³‘ë ¬ ìƒíƒœì˜ ì˜¤ë¥˜ ì²˜ë¦¬ êµ¬ì„±ì…ë‹ˆë‹¤.
```json
"ParallelState": {
"Type": "Parallel",
"Branches": [
{
"StartAt": "Task1",
"States": { ... }
},
{
"StartAt": "Task2",
"States": { ... }
}
],
"Next": "NextState"
}
```
### ë§µ

**ë§µ(Map)** ìƒíƒœëŠ” ë°ì´í„° ì„¸íŠ¸ì˜ ê° í•­ëª©ì— ëŒ€í•´ ì¼ë ¨ì˜ ë‹¨ê³„ë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆê²Œ í•©ë‹ˆë‹¤. ë°ì´í„°ì˜ ë³‘ë ¬ ì²˜ë¦¬ì— ì‚¬ìš©ë©ë‹ˆë‹¤. ë°ì´í„° ì„¸íŠ¸ì˜ í•­ëª©ì„ ì–´ë–»ê²Œ ì²˜ë¦¬í•˜ê³  ì‹¶ì€ì§€ì— ë”°ë¼ Step Functionsì€ ë‹¤ìŒ ëª¨ë“œë¥¼ ì œê³µí•©ë‹ˆë‹¤:

- **ì¸ë¼ì¸ ëª¨ë“œ(Inline Mode)**: ê° JSON ë°°ì—´ í•­ëª©ì— ëŒ€í•´ ì¼ë¶€ ìƒíƒœë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤. 40ê°œ ì´í•˜ì˜ ë³‘ë ¬ ë°˜ë³µ ì‘ì—…ì— ì í•©í•˜ë©°, ê°ê°ì„ **`Map`** ìƒíƒœë¥¼ í¬í•¨í•˜ëŠ” ì›Œí¬í”Œë¡œìš°ì˜ ì»¨í…ìŠ¤íŠ¸ì—ì„œ ì‹¤í–‰í•©ë‹ˆë‹¤.

```json
"MapState": {
"Type": "Map",
"ItemsPath": "$.arrayItems",
"ItemProcessor": {
"ProcessorConfig": {
"Mode": "INLINE"
},
"StartAt": "AddState",
"States": {
"AddState": {
"Type": "Task",
"Resource": "arn:aws:states:::lambda:invoke",
"OutputPath": "$.Payload",
"Parameters": {
"FunctionName": "arn:aws:lambda:<region>:<account-id>:function:add-function"
},
"End": true
}
}
},
"End": true
"ResultPath": "$.detail.added",
"ItemsPath": "$.added"
}
```

- **ë¶„ì‚° ëª¨ë“œ(Distributed Mode)**: ë†’ì€ ë™ì‹œì„±ì„ ê°–ëŠ” ëŒ€ê·œëª¨ ë³‘ë ¬ ì²˜ë¦¬ë¥¼ ìœ„í•´ ì„¤ê³„ë˜ì—ˆìŠµë‹ˆë‹¤. Amazon S3ì— ì €ì¥ëœ ë°ì´í„°ì™€ ê°™ì€ ëŒ€ê·œëª¨ ë°ì´í„° ì„¸íŠ¸ë¥¼ ì²˜ë¦¬í•˜ëŠ” ë° ì‚¬ìš©ë˜ë©°, ìµœëŒ€ 10,000ê°œì˜ ë³‘ë ¬ ìì‹ ì›Œí¬í”Œë¡œìš° ì‹¤í–‰ì„ ì§€ì›í•˜ë©°, ì´ëŸ¬í•œ ìì‹ì„ ë³„ë„ì˜ ìì‹ ì‹¤í–‰ìœ¼ë¡œ ì‹¤í–‰í•©ë‹ˆë‹¤.

```json
"DistributedMapState": {
"Type": "Map",
"ItemReader": {
"Resource": "arn:aws:states:::s3:getObject",
"Parameters": {
"Bucket": "my-bucket",
"Key": "data.csv"
}
},
"ItemProcessor": {
"ProcessorConfig": {
"Mode": "DISTRIBUTED",
"ExecutionType": "EXPRESS"
},
"StartAt": "ProcessItem",
"States": {
"ProcessItem": {
"Type": "Task",
"Resource": "arn:aws:lambda:region:account-id:function:my-function",
"End": true
}
}
},
"End": true
"ResultWriter": {
"Resource": "arn:aws:states:::s3:putObject",
"Parameters": {
"Bucket": "myOutputBucket",
"Prefix": "csvProcessJobs"
}
}
}
```


### ë²„ì „ ë° ë³„ì¹­

Step Functionsì€ ìƒíƒœ ë¨¸ì‹ ì˜ **ë²„ì „(versions)** ë° **ë³„ì¹­(aliases)**ì„ í†µí•´ ì›Œí¬í”Œë¡œìš° ë°°í¬ë¥¼ ê´€ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë²„ì „ì€ ì‹¤í–‰í•  ìˆ˜ ìˆëŠ” ìƒíƒœ ë¨¸ì‹ ì˜ ìŠ¤ëƒ…ìƒ·ì„ ë‚˜íƒ€ë‚´ë©°, ë³„ì¹­ì€ ìµœëŒ€ ë‘ ê°œì˜ ìƒíƒœ ë¨¸ì‹  ë²„ì „ì„ ê°€ë¦¬í‚µë‹ˆë‹¤.

- **ë²„ì „(Versions)**: ìƒíƒœ ë¨¸ì‹ ì˜ ë³€ê²½ ë¶ˆê°€ëŠ¥í•œ ìŠ¤ëƒ…ìƒ·ìœ¼ë¡œ, í•´ë‹¹ ìƒíƒœ ë¨¸ì‹ ì˜ ê°€ì¥ ìµœê·¼ ìˆ˜ì •ì—ì„œ ìƒì„±ë©ë‹ˆë‹¤. ê° ë²„ì „ì€ ìƒíƒœ ë¨¸ì‹  ARNê³¼ ë²„ì „ ë²ˆí˜¸ë¥¼ ì½œë¡ ìœ¼ë¡œ êµ¬ë¶„í•˜ì—¬ ê²°í•©í•œ ê³ ìœ  ARNìœ¼ë¡œ ì‹ë³„ë©ë‹ˆë‹¤(**`arn:aws:states:region:account-id:stateMachine:StateMachineName:version-number`**). ë²„ì „ì€ í¸ì§‘í•  ìˆ˜ ì—†ì§€ë§Œ, ìƒíƒœ ë¨¸ì‹ ì„ ì—…ë°ì´íŠ¸í•˜ê³  ìƒˆ ë²„ì „ì„ ê²Œì‹œí•˜ê±°ë‚˜ ì›í•˜ëŠ” ìƒíƒœ ë¨¸ì‹  ë²„ì „ì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- **ë³„ì¹­(Aliases)**: ì´ëŸ¬í•œ í¬ì¸í„°ëŠ” ë™ì¼í•œ ìƒíƒœ ë¨¸ì‹ ì˜ ìµœëŒ€ ë‘ ê°œ ë²„ì „ì„ ì°¸ì¡°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë‹¨ì¼ ìƒíƒœ ë¨¸ì‹ ì— ëŒ€í•´ ì—¬ëŸ¬ ë³„ì¹­ì„ ìƒì„±í•  ìˆ˜ ìˆìœ¼ë©°, ê°ê°ì€ ìƒíƒœ ë¨¸ì‹  ARNê³¼ ë³„ì¹­ ì´ë¦„ì„ ì½œë¡ ìœ¼ë¡œ êµ¬ë¶„í•˜ì—¬ ê²°í•©í•œ ê³ ìœ  ARNìœ¼ë¡œ ì‹ë³„ë©ë‹ˆë‹¤(**`arn:aws:states:region:account-id:stateMachine:StateMachineName:aliasName`**). ë³„ì¹­ì€ ìƒíƒœ ë¨¸ì‹ ì˜ ë‘ ë²„ì „ ì¤‘ í•˜ë‚˜ë¡œì˜ íŠ¸ë˜í”½ ë¼ìš°íŒ…ì„ ê°€ëŠ¥í•˜ê²Œ í•©ë‹ˆë‹¤. ë˜ëŠ” ë³„ì¹­ì€ ìƒíƒœ ë¨¸ì‹ ì˜ íŠ¹ì • ë²„ì „ì„ ê°€ë¦¬í‚¬ ìˆ˜ ìˆì§€ë§Œ, ë‹¤ë¥¸ ë³„ì¹­ì„ ê°€ë¦¬í‚¬ ìˆ˜ëŠ” ì—†ìŠµë‹ˆë‹¤. í•„ìš”ì— ë”°ë¼ ìƒíƒœ ë¨¸ì‹ ì˜ ë‹¤ë¥¸ ë²„ì „ìœ¼ë¡œ ë¦¬ë””ë ‰ì…˜í•˜ë„ë¡ ì—…ë°ì´íŠ¸í•  ìˆ˜ ìˆì–´ì„œ ì œì–´ëœ ë°°í¬ì™€ ì›Œí¬í”Œë¡œìš° ê´€ë¦¬ë¥¼ ìš©ì´í•˜ê²Œ í•©ë‹ˆë‹¤.

**ASL**ì— ëŒ€í•œ ìì„¸í•œ ì •ë³´ëŠ” ì—¬ê¸°ë¥¼ í™•ì¸í•˜ì„¸ìš”: [**Amazon States Language**](https://states-language.net/spec.html).



## ìƒíƒœ ë¨¸ì‹ ìš© IAM ì—­í• 

AWS Step Functionsì€ AWS Identity and Access Management (IAM) ì—­í• ì„ í™œìš©í•˜ì—¬ ìƒíƒœ ë¨¸ì‹  ë‚´ì˜ ë¦¬ì†ŒìŠ¤ ë° ì‘ì—…ì— ëŒ€í•œ ì•¡ì„¸ìŠ¤ë¥¼ ì œì–´í•©ë‹ˆë‹¤. AWS Step Functionsì˜ ë³´ì•ˆ ë° IAM ì—­í• ê³¼ ê´€ë ¨ëœ ì£¼ìš” ì¸¡ë©´ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤:

- **ì‹¤í–‰ ì—­í• (Execution Role)**: AWS Step Functionsì˜ ê° ìƒíƒœ ë¨¸ì‹ ì€ IAM ì‹¤í–‰ ì—­í• ê³¼ ê´€ë ¨ë˜ì–´ ìˆìŠµë‹ˆë‹¤. ì´ ì—­í• ì€ ìƒíƒœ ë¨¸ì‹ ì´ ì‚¬ìš©ìë¥¼ ëŒ€ì‹ í•˜ì—¬ ìˆ˜í–‰í•  ìˆ˜ ìˆëŠ” ì‘ì—…ì„ ì •ì˜í•©ë‹ˆë‹¤. ìƒíƒœ ë¨¸ì‹ ì´ AWS ì„œë¹„ìŠ¤ì™€ ìƒí˜¸ ì‘ìš©í•˜ëŠ” ìƒíƒœ ê°„ ì „í™˜ ì‹œ (ì˜ˆ: Lambda í•¨ìˆ˜ í˜¸ì¶œ, DynamoDB ì•¡ì„¸ìŠ¤ ë“±) ì´ ì‹¤í–‰ ì—­í• ì„ ê°€ì •í•˜ì—¬ í•´ë‹¹ ì‘ì—…ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤.
- **ê¶Œí•œ(Permissions)**: IAM ì‹¤í–‰ ì—­í• ì€ ë‹¤ë¥¸ AWS ì„œë¹„ìŠ¤ì—ì„œ í•„ìš”í•œ ì‘ì—…ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆëŠ” ê¶Œí•œìœ¼ë¡œ êµ¬ì„±ë˜ì–´ì•¼ í•©ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´, ìƒíƒœ ë¨¸ì‹ ì´ AWS Lambda í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•´ì•¼ í•˜ëŠ” ê²½ìš° IAM ì—­í• ì€ **`lambda:InvokeFunction`** ê¶Œí•œì„ ê°€ì ¸ì•¼ í•©ë‹ˆë‹¤. ë§ˆì°¬ê°€ì§€ë¡œ DynamoDBì— ì“°ê¸° ì‘ì—…ì´ í•„ìš”í•œ ê²½ìš° ì ì ˆí•œ ê¶Œí•œ(**`dynamodb:PutItem`**, **`dynamodb:UpdateItem`** ë“±)ì´ ë¶€ì—¬ë˜ì–´ì•¼ í•©ë‹ˆë‹¤.
- **ìµœì†Œ ê¶Œí•œ(Least Privilege)**: Step Functionsì— ëŒ€í•œ IAM ì—­í• ì„ êµ¬ì„±í•  ë•Œ ìµœì†Œ ê¶Œí•œì˜ ì›ì¹™ì„ ë”°ë¥´ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤. ì´ëŠ” ìƒíƒœ ë¨¸ì‹ ì´ íŠ¹ì • ì‘ì—…ì„ ìˆ˜í–‰í•˜ëŠ” ë° í•„ìš”í•œ ê¶Œí•œë§Œ ë¶€ì—¬í•˜ê³ , ê·¸ ì´ìƒì€ ë¶€ì—¬í•˜ì§€ ì•ŠëŠ” ê²ƒì„ ì˜ë¯¸í•©ë‹ˆë‹¤. IAM ì •ì±…ì€ íŠ¹ì • ë¦¬ì†ŒìŠ¤ ë° ì‘ì—…ìœ¼ë¡œ ë²”ìœ„ë¥¼ ì¢í˜€ ì˜ë„í•˜ì§€ ì•Šì€ ì•¡ì„¸ìŠ¤ì˜ ìœ„í—˜ì„ ì¤„ì…ë‹ˆë‹¤.

## ì—´ê±°(Enumeration)

ëª¨ë“  ë‹¤ìŒ ì—´ê±° ì‘ì—…ì— ëŒ€í•´ ReadOnlyAccess ì •ì±…ì´ ì¶©ë¶„í•©ë‹ˆë‹¤.
```bash
# State machines #

## List state machines
aws stepfunctions list-state-machines
## Retrieve informatio about the specified state machine
aws stepfunctions describe-state-machine --state-machine-arn <value>

## List verions for the specified state machine
aws stepfunctions list-state-machine-versions --state-machine-arn <value>
## List aliases for the specified state machine
aws stepfunctions list-state-machine-aliases --state-machine-arn <value>
## Retrieve informatio about the specified state machine alias
aws stepfunctions describe-state-machine-alias --state-machine-alias-arn <value>

## List executions of a state machine
aws stepfunctions list-executions --state-machine-arn <value> [--status-filter <RUNNING | SUCCEEDED | FAILED | TIMED_OUT | ABORTED | PENDING_REDRIVE>] [--redrive-filter <REDRIVEN | NOT_REDRIVEN>]
## Retrieve information and relevant metadata about a state machine execution
aws stepfunctions describe-execution --execution-arn <value>
## Retrieve information about the state machine associated to the specified execution
aws stepfunctions describe-state-machine-for-execution --execution-arn <value>
## Retrieve the history of the specified execution as a list of events
aws stepfunctions get-execution-history --execution-arn <value> [--reverse-order | --no-reverse-order] [--include-execution-data | --no-include-execution-data]

## List tags for the specified Ste Functions resource
aws stepfunctions list-tags-for-resource --resource-arn <value>

## Validate the definition of a state machine without creating the resource
aws stepfunctions validate-state-machine-definition --definition <value> [--type <STANDARD | EXPRESS>]

# Activities #

## List existing activities
aws stepfunctions list-activities
## Retrieve information about the specified activity
aws stepfunctions describe-activity --activity-arn <value>

# Map Runs #

## List map runs of an execution
aws stepfunctions list-map-runs --execution-arn <value>
## Provide information about the configuration, progress and results of a Map Run
aws stepfunctions describe-map-run --map-run-arn <value>
## Lists executions of a Map Run
aws stepfunctions list-executions --map-run-arn <value> [--status-filter <RUNNING | SUCCEEDED | FAILED | TIMED_OUT | ABORTED | PENDING_REDRIVE>] [--redrive-filter <REDRIVEN | NOT_REDRIVEN>]
```
## ê¶Œí•œ ìƒìŠ¹

ë‹¤ìŒ í˜ì´ì§€ì—ì„œ **Step Functions ê¶Œí•œì„ ë‚¨ìš©í•˜ì—¬ ê¶Œí•œ ìƒìŠ¹**í•˜ëŠ” ë°©ë²•ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

{% content-ref url="../aws-privilege-escalation/aws-stepfunctions-privesc.md" %}
[aws-stepfunctions-privesc.md](../aws-privilege-escalation/aws-stepfunctions-privesc.md)
{% endcontent-ref %}

## ì‚¬í›„ ê³µê²©

{% content-ref url="../aws-post-exploitation/aws-stepfunctions-post-exploitation/" %}
[aws-stepfunctions-post-exploitation](../aws-post-exploitation/aws-stepfunctions-post-exploitation/)
{% endcontent-ref %}

# ì°¸ê³  ìë£Œ

* [https://docs.aws.amazon.com/service-authorization/latest/reference/list_awsstepfunctions.html](https://docs.aws.amazon.com/service-authorization/latest/reference/list_awsstepfunctions.html)
* [https://docs.aws.amazon.com/step-functions/latest/dg/welcome.html](https://docs.aws.amazon.com/step-functions/latest/dg/welcome.html)
* [https://states-language.net/spec.html](https://states-language.net/spec.html)

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>ë¥¼ í†µí•´ **ì œë¡œë¶€í„° ì˜ì›…ì´ ë˜ëŠ” AWS í•´í‚¹ ë°°ìš°ê¸°**!</summary>

HackTricksë¥¼ ì§€ì›í•˜ëŠ” ë‹¤ë¥¸ ë°©ë²•:

* **íšŒì‚¬ë¥¼ HackTricksì—ì„œ í™ë³´**í•˜ê±°ë‚˜ **PDF í˜•ì‹ì˜ HackTricks ë‹¤ìš´ë¡œë“œ**ë¥¼ ì›í•˜ì‹œë©´ [**êµ¬ë… ìš”ê¸ˆì œ**](https://github.com/sponsors/carlospolop)ë¥¼ í™•ì¸í•˜ì„¸ìš”!
* [**ê³µì‹ PEASS & HackTricks êµ¿ì¦ˆ**](https://peass.creator-spring.com)ë¥¼ êµ¬ë§¤í•˜ì„¸ìš”
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)ë¥¼ ë°œê²¬í•˜ì„¸ìš”, ë‹¹ì‚¬ì˜ ë…ì  [**NFTs**](https://opensea.io/collection/the-peass-family) ì»¬ë ‰ì…˜
* ğŸ’¬ [**ë””ìŠ¤ì½”ë“œ ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— **ê°€ì…**í•˜ê±°ë‚˜ **íŠ¸ìœ„í„°** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)ë¥¼ **íŒ”ë¡œìš°**í•˜ì„¸ìš”.
* **HackTricks** ë° **HackTricks Cloud** github ì €ì¥ì†Œì— PRì„ ì œì¶œí•˜ì—¬ **í•´í‚¹ íŠ¸ë¦­ì„ ê³µìœ **í•˜ì„¸ìš”.

</details>
