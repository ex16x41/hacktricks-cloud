# AWS - Elastic Beanstalk Enum

{% hint style="success" %}
Aprende y practica AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Aprende y practica GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Apoya HackTricks</summary>

* Revisa los [**planes de suscripci贸n**](https://github.com/sponsors/carlospolop)!
* **nete al**  [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s铆guenos** en **Twitter**  [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Comparte trucos de hacking enviando PRs a los repositorios de github de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
{% endhint %}

## Elastic Beanstalk

Amazon Elastic Beanstalk proporciona una plataforma simplificada para **desplegar, gestionar y escalar aplicaciones y servicios web**. Soporta una variedad de lenguajes de programaci贸n y frameworks, como Java, .NET, PHP, Node.js, Python, Ruby y Go, as铆 como contenedores Docker. El servicio es compatible con servidores ampliamente utilizados, incluyendo Apache, Nginx, Passenger e IIS.

Elastic Beanstalk proporciona una forma simple y flexible de **desplegar tus aplicaciones en la nube de AWS**, sin necesidad de preocuparse por la infraestructura subyacente. **Autom谩ticamente** maneja los detalles de **provisionamiento** de capacidad, **balanceo** de carga, **escalado** y **monitoreo** de la salud de la aplicaci贸n, permiti茅ndote enfocarte en escribir y desplegar tu c贸digo.

La infraestructura creada por Elastic Beanstalk es gestionada por Grupos de **Autoscaling** en **EC2** (con un balanceador de carga). Lo que significa que al final del d铆a, si **comprometes el host**, deber铆as saber sobre EC2:

{% content-ref url="aws-ec2-ebs-elb-ssm-vpc-and-vpn-enum/" %}
[aws-ec2-ebs-elb-ssm-vpc-and-vpn-enum](aws-ec2-ebs-elb-ssm-vpc-and-vpn-enum/)
{% endcontent-ref %}

Adem谩s, si se usa Docker, es posible usar **ECS**.

{% content-ref url="aws-eks-enum.md" %}
[aws-eks-enum.md](aws-eks-enum.md)
{% endcontent-ref %}

### Aplicaci贸n y Entornos

En AWS Elastic Beanstalk, los conceptos de "aplicaci贸n" y "entorno" tienen diferentes prop贸sitos y roles distintos en el proceso de despliegue.

#### Aplicaci贸n

* Una aplicaci贸n en Elastic Beanstalk es un **contenedor l贸gico para el c贸digo fuente de tu aplicaci贸n, entornos y configuraciones**. Agrupa diferentes versiones de tu c贸digo de aplicaci贸n y te permite gestionarlas como una sola entidad.
* Cuando creas una aplicaci贸n, proporcionas un nombre y una descripci贸n, pero no se provisionan recursos en esta etapa. Es simplemente una forma de organizar y gestionar tu c贸digo y recursos relacionados.
* Puedes tener **m煤ltiples versiones de la aplicaci贸n** dentro de una aplicaci贸n. Cada versi贸n corresponde a una versi贸n espec铆fica de tu c贸digo, que puede ser desplegada en uno o m谩s entornos.

#### Entorno

* Un entorno es una **instancia provisionada de tu aplicaci贸n** que se ejecuta en la infraestructura de AWS. Es **donde se despliega y ejecuta el c贸digo de tu aplicaci贸n**. Elastic Beanstalk provisiona los recursos necesarios (por ejemplo, instancias EC2, balanceadores de carga, grupos de autoescalado, bases de datos) seg煤n la configuraci贸n del entorno.
* **Cada entorno ejecuta una sola versi贸n de tu aplicaci贸n**, y puedes tener m煤ltiples entornos para diferentes prop贸sitos, como desarrollo, pruebas, staging y producci贸n.
* Cuando creas un entorno, eliges una plataforma (por ejemplo, Java, .NET, Node.js, etc.) y un tipo de entorno (por ejemplo, servidor web o trabajador). Tambi茅n puedes personalizar la configuraci贸n del entorno para controlar varios aspectos de la infraestructura y configuraciones de la aplicaci贸n.

### 2 tipos de Entornos

1. **Entorno de Servidor Web**: Est谩 dise帽ado para **alojar y servir aplicaciones web y APIs**. Estas aplicaciones t铆picamente manejan solicitudes HTTP/HTTPS entrantes. El entorno del servidor web provisiona recursos como **instancias EC2, balanceadores de carga y grupos de autoescalado** para manejar el tr谩fico entrante, gestionar la capacidad y asegurar la alta disponibilidad de la aplicaci贸n.
2. **Entorno de Trabajador**: Est谩 dise帽ado para procesar **tareas en segundo plano**, que a menudo son operaciones que consumen tiempo o recursos y que no requieren respuestas inmediatas a los clientes. El entorno de trabajador provisiona recursos como **instancias EC2 y grupos de autoescalado**, pero **no tiene un balanceador de carga** ya que no maneja solicitudes HTTP/HTTPS directamente. En su lugar, consume tareas de una **Amazon Simple Queue Service (SQS) queue**, que act煤a como un buffer entre el entorno de trabajador y las tareas que procesa.

### Seguridad

Al crear una App en Beanstalk hay 3 opciones de seguridad muy importantes a elegir:

* **EC2 key pair**: Esta ser谩 la **clave SSH** que podr谩 acceder a las instancias EC2 que ejecutan la aplicaci贸n.
* **IAM instance profile**: Este es el **perfil de instancia** que tendr谩n las instancias (**privilegios IAM**).
* El rol autogenerado se llama **`aws-elasticbeanstalk-ec2-role`** y tiene algunos accesos interesantes sobre todo ECS, todo SQS, DynamoDB elasticbeanstalk y elasticbeanstalk S3 usando las pol铆ticas gestionadas por AWS: [AWSElasticBeanstalkWebTier](https://us-east-1.console.aws.amazon.com/iam/home#/policies/arn:aws:iam::aws:policy/AWSElasticBeanstalkWebTier), [AWSElasticBeanstalkMulticontainerDocker](https://us-east-1.console.aws.amazon.com/iam/home#/policies/arn:aws:iam::aws:policy/AWSElasticBeanstalkMulticontainerDocker), [AWSElasticBeanstalkWorkerTier](https://us-east-1.console.aws.amazon.com/iam/home#/policies/arn:aws:iam::aws:policy/AWSElasticBeanstalkWorkerTier).
* **Service role**: Este es el **rol que el servicio de AWS** usar谩 para realizar todas las acciones necesarias. Hasta donde s茅, un usuario regular de AWS no puede acceder a ese rol.
* Este rol generado por AWS se llama **`aws-elasticbeanstalk-service-role`** y usa las pol铆ticas gestionadas por AWS [AWSElasticBeanstalkEnhancedHealth](https://us-east-1.console.aws.amazon.com/iam/home#/policies/arn:aws:iam::aws:policy/service-role/AWSElasticBeanstalkEnhancedHealth) y [AWSElasticBeanstalkManagedUpdatesCustomerRolePolicy](https://us-east-1.console.aws.amazon.com/iamv2/home?region=us-east-1#/roles/details/aws-elasticbeanstalk-service-role?section=permissions).

Por defecto, **la versi贸n de metadatos 1 est谩 deshabilitada**:

<figure><img src="../../../.gitbook/assets/image (103).png" alt=""><figcaption></figcaption></figure>

### Exposici贸n

Los datos de Beanstalk se almacenan en un **bucket S3** con el siguiente nombre: **`elasticbeanstalk-<region>-<acc-id>`** (si fue creado en la consola de AWS). Dentro de este bucket encontrar谩s el **c贸digo fuente de la aplicaci贸n** subido.

La **URL** de la p谩gina web creada es **`http://<webapp-name>-env.<random>.<region>.elasticbeanstalk.com/`**

{% hint style="warning" %}
Si obtienes **acceso de lectura** sobre el bucket, puedes **leer el c贸digo fuente** e incluso encontrar **credenciales sensibles** en 茅l.

Si obtienes **acceso de escritura** sobre el bucket, podr铆as **modificar el c贸digo fuente** para **comprometer** el **rol IAM** que la aplicaci贸n est谩 usando la pr贸xima vez que se ejecute.
{% endhint %}

### Enumeraci贸n

{% code overflow="wrap" %}
```bash
# Find S3 bucket
ACCOUNT_NUMBER=<account_number>
for r in us-east-1 us-east-2 us-west-1 us-west-2 ap-south-1 ap-south-2 ap-northeast-1 ap-northeast-2 ap-northeast-3 ap-southeast-1 ap-southeast-2 ap-southeast-3 ca-central-1 eu-central-1 eu-central-2 eu-west-1 eu-west-2 eu-west-3 eu-north-1 sa-east-1 af-south-1 ap-east-1 eu-south-1 eu-south-2 me-south-1 me-central-1; do aws s3 ls elasticbeanstalk-$r-$ACCOUNT_NUMBER 2>/dev/null && echo "Found in: elasticbeanstalk-$r-$ACCOUNT_NUMBER"; done

# Get apps and URLs
aws elasticbeanstalk describe-applications # List apps
aws elasticbeanstalk describe-application-versions # Get apps & bucket name with source code
aws elasticbeanstalk describe-environments # List envs
aws elasticbeanstalk describe-environments | grep -E "EndpointURL|CNAME"
aws elasticbeanstalk describe-configuration-settings --application-name <app_name> --environment-name <env_name>
aws elasticbeanstalk describe-environment-resources --environment-name <env_name> # Get env info such as SQS used queues
aws elasticbeanstalk describe-instances-health --environment-name <env_name> # Get the instances of an environment

# Get events
aws elasticbeanstalk describe-events
```
{% endcode %}

### Acceso No Autenticado

{% content-ref url="../aws-unauthenticated-enum-access/aws-elastic-beanstalk-unauthenticated-enum.md" %}
[aws-elastic-beanstalk-unauthenticated-enum.md](../aws-unauthenticated-enum-access/aws-elastic-beanstalk-unauthenticated-enum.md)
{% endcontent-ref %}

### Persistencia

{% content-ref url="../aws-persistence/aws-elastic-beanstalk-persistence.md" %}
[aws-elastic-beanstalk-persistence.md](../aws-persistence/aws-elastic-beanstalk-persistence.md)
{% endcontent-ref %}

### Privesc

{% content-ref url="../aws-privilege-escalation/aws-elastic-beanstalk-privesc.md" %}
[aws-elastic-beanstalk-privesc.md](../aws-privilege-escalation/aws-elastic-beanstalk-privesc.md)
{% endcontent-ref %}

### Post Explotaci贸n

{% content-ref url="../aws-post-exploitation/aws-elastic-beanstalk-post-exploitation.md" %}
[aws-elastic-beanstalk-post-exploitation.md](../aws-post-exploitation/aws-elastic-beanstalk-post-exploitation.md)
{% endcontent-ref %}

{% hint style="success" %}
Aprende y practica AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Aprende y practica GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Apoya HackTricks</summary>

* Revisa los [**planes de suscripci贸n**](https://github.com/sponsors/carlospolop)!
* **nete al**  [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s铆guenos** en **Twitter**  [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Comparte trucos de hacking enviando PRs a los repositorios de github de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
{% endhint %}
