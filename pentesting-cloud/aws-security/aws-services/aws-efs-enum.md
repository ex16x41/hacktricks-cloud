# AWS - EFS Enum

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## EFS

### Temel Bilgiler

Amazon Elastic File System (EFS), AWS tarafÄ±ndan **tamamen yÃ¶netilen, Ã¶lÃ§eklenebilir ve elastik bir aÄŸ dosya sistemi** olarak sunulmaktadÄ±r. Bu hizmet, birden fazla EC2 Ã¶rneÄŸi ve diÄŸer AWS hizmetleri tarafÄ±ndan eÅŸzamanlÄ± olarak eriÅŸilebilen **dosya sistemlerinin** oluÅŸturulmasÄ±nÄ± ve yapÄ±landÄ±rÄ±lmasÄ±nÄ± kolaylaÅŸtÄ±rÄ±r. EFS'nin ana Ã¶zellikleri arasÄ±nda, manuel mÃ¼dahale olmadan otomatik olarak Ã¶lÃ§eklenebilme, dÃ¼ÅŸÃ¼k gecikme sÃ¼resi eriÅŸimi saÄŸlama, yÃ¼ksek verimlilikteki iÅŸ yÃ¼klerini destekleme, veri dayanÄ±klÄ±lÄ±ÄŸÄ±nÄ± garanti etme ve Ã§eÅŸitli AWS gÃ¼venlik mekanizmalarÄ±yla sorunsuz entegrasyon yer almaktadÄ±r.

**VarsayÄ±lan** olarak, baÄŸlanacak EFS klasÃ¶rÃ¼ **`/`** olacaktÄ±r, ancak **farklÄ± bir adÄ±** olabilir.

### AÄŸ EriÅŸimi

Bir EFS, bir VPC iÃ§inde oluÅŸturulur ve **varsayÄ±lan olarak tÃ¼m VPC alt aÄŸlarÄ±nda eriÅŸilebilir** olacaktÄ±r. Ancak, EFS'nin bir GÃ¼venlik Grubu olacaktÄ±r. EFS'yi baÄŸlamak iÃ§in bir EC2'ye (veya baÅŸka bir AWS hizmetine) **eriÅŸim vermek iÃ§in, EFS gÃ¼venlik grubunda EC2 GÃ¼venlik Grubundan gelen bir NFS** (2049 portu) **kuralÄ±nÄ±n izin verilmesi gerekir**.

Bunu yapmadan, **NFS hizmetiyle iletiÅŸim kuramazsÄ±nÄ±z**.

Bunu nasÄ±l yapacaÄŸÄ±nÄ±z hakkÄ±nda daha fazla bilgi iÃ§in kontrol edin: [https://stackoverflow.com/questions/38632222/aws-efs-connection-timeout-at-mount](https://stackoverflow.com/questions/38632222/aws-efs-connection-timeout-at-mount)

### Enumeration
```bash
# Get filesystems and access policies (if any)
aws efs describe-file-systems
aws efs describe-file-system-policy --file-system-id <id>

# Get subnetworks and IP addresses where you can find the file system
aws efs describe-mount-targets --file-system-id <id>
aws efs describe-mount-target-security-groups --mount-target-id <id>
aws ec2 describe-security-groups --group-ids <sg_id>

# Get other access points
aws efs describe-access-points

# Get replication configurations
aws efs describe-replication-configurations

# Search for NFS in EC2 networks
sudo nmap -T4 -Pn -p 2049 --open 10.10.10.0/20 # or /16 to be sure
```
{% hint style="danger" %}
EFS montaj noktasÄ± aynÄ± VPC iÃ§inde ancak farklÄ± bir alt aÄŸda olabilir. TÃ¼m **EFS noktalarÄ±nÄ± bulduÄŸunuzdan emin olmak istiyorsanÄ±z, `/16` aÄŸ maskesini taramak daha iyi olacaktÄ±r**.
{% endhint %}

### EFS'yi Montajla

{% code overflow="wrap" %}
```bash
sudo mkdir /efs

## Mount found
sudo apt install nfs-common
sudo mount -t nfs4 -o nfsvers=4.1,rsize=1048576,wsize=1048576,hard,timeo=600,retrans=2,noresvport <IP>:/ /efs

## Mount with efs type
## You need to have installed the package amazon-efs-utils
sudo yum install amazon-efs-utils # If centos
sudo apt-get install amazon-efs-utils # If ubuntu
sudo mount -t efs <file-system-id/EFS DNS name>:/ /efs/
```
{% endcode %}

### IAM EriÅŸimi

**VarsayÄ±lan olarak**, EFS'ye **aÄŸ eriÅŸimi olan herkes**, **kÃ¶k kullanÄ±cÄ± olarak bile onu baÄŸlayabilir, okuyabilir ve yazabilir**. Ancak, Dosya Sistemi politikalarÄ±, **sadece belirli izinlere sahip olan ilkelerin** eriÅŸimine izin verecek ÅŸekilde uygulanabilir.\
Ã–rneÄŸin, bu Dosya Sistemi politikasÄ±, **IAM izniniz yoksa** dosya sistemini **baÄŸlamanÄ±za bile izin vermeyecektir**:
```json
{
"Version": "2012-10-17",
"Id": "efs-policy-wizard-2ca2ba76-5d83-40be-8557-8f6c19eaa797",
"Statement": [
{
"Sid": "efs-statement-e7f4b04c-ad75-4a7f-a316-4e5d12f0dbf5",
"Effect": "Allow",
"Principal": {
"AWS": "*"
},
"Action": "",
"Resource": "arn:aws:elasticfilesystem:us-east-1:318142138553:file-system/fs-0ab66ad201b58a018",
"Condition": {
"Bool": {
"elasticfilesystem:AccessedViaMountTarget": "true"
}
}
}
]
}
```
Veya bu **anonim eriÅŸimi engelleyecektir**:

<figure><img src="../../../.gitbook/assets/image (278).png" alt=""><figcaption></figcaption></figure>

IAM ile korunan dosya sistemlerini baÄŸlamak iÃ§in mount komutunda "efs" tÃ¼rÃ¼nÃ¼ KESÄ°NLÄ°KLE kullanmalÄ±sÄ±nÄ±z:
```bash
sudo mkdir /efs
sudo mount -t efs -o tls,iam  <file-system-id/EFS DNS name>:/ /efs/
# To use a different pforile from ~/.aws/credentials
# You can use: -o tls,iam,awsprofile=namedprofile
```
### EriÅŸim NoktalarÄ±

**EriÅŸim noktalarÄ±**, **paylaÅŸÄ±lan veri setlerine** uygulama eriÅŸimini yÃ¶netmeyi kolaylaÅŸtÄ±ran **EFS dosya sistemine** uygulama Ã¶zel giriÅŸ noktalarÄ±dÄ±r.

Bir eriÅŸim noktasÄ± oluÅŸturduÄŸunuzda, eriÅŸim noktasÄ± aracÄ±lÄ±ÄŸÄ±yla oluÅŸturulan dosyalar ve dizinler iÃ§in **sahibi ve POSIX izinlerini** **belirtebilirsiniz**. AyrÄ±ca, eriÅŸim noktasÄ± iÃ§in **Ã¶zel bir kÃ¶k dizin tanÄ±mlayabilirsiniz**, ya mevcut bir dizini belirterek ya da istenen izinlerle yeni bir tane oluÅŸturarak. Bu, **EFS dosya sisteminize uygulama veya kullanÄ±cÄ± bazÄ±nda eriÅŸimi kontrol etmenizi** saÄŸlar ve paylaÅŸÄ±lan dosya verilerinizi yÃ¶netmeyi ve gÃ¼vence altÄ±na almayÄ± kolaylaÅŸtÄ±rÄ±r.

**EriÅŸim noktasÄ±ndan dosya sistemini ÅŸu ÅŸekilde baÄŸlayabilirsiniz:**
```bash
# Use IAM if you need to use iam permissions
sudo mount -t efs -o tls,[iam],accesspoint=<access-point-id> \
<file-system-id/EFS DNS> /efs/
```
{% hint style="warning" %}
EriÅŸim noktasÄ±nÄ± baÄŸlamaya Ã§alÄ±ÅŸsanÄ±z bile, **aÄŸ Ã¼zerinden NFS hizmeti ile iletiÅŸim kurabilmeniz** gerektiÄŸini ve EFS'nin bir dosya sistemi **politikasÄ±** varsa, onu baÄŸlamak iÃ§in **yeterli IAM izinlerine** sahip olmanÄ±z gerektiÄŸini unutmayÄ±n.
{% endhint %}

EriÅŸim noktalarÄ± aÅŸaÄŸÄ±daki amaÃ§lar iÃ§in kullanÄ±labilir:

* **Ä°zin yÃ¶netimini basitleÅŸtirme**: Her eriÅŸim noktasÄ± iÃ§in bir POSIX kullanÄ±cÄ± ve grubu tanÄ±mlayarak, temel dosya sisteminin izinlerini deÄŸiÅŸtirmeden farklÄ± uygulamalar veya kullanÄ±cÄ±lar iÃ§in eriÅŸim izinlerini kolayca yÃ¶netebilirsiniz.
* **KÃ¶k dizini zorunlu kÄ±lma**: EriÅŸim noktalarÄ±, EFS dosya sistemi iÃ§inde belirli bir dizine eriÅŸimi kÄ±sÄ±tlayabilir, bÃ¶ylece her uygulama veya kullanÄ±cÄ± kendi belirlenen klasÃ¶rÃ¼ iÃ§inde Ã§alÄ±ÅŸÄ±r. Bu, kazara veri ifÅŸasÄ± veya deÄŸiÅŸikliÄŸini Ã¶nlemeye yardÄ±mcÄ± olur.
* **Dosya sistemi eriÅŸimini kolaylaÅŸtÄ±rma**: EriÅŸim noktalarÄ±, bir AWS Lambda iÅŸlevi veya bir AWS Fargate gÃ¶revi ile iliÅŸkilendirilebilir, bu da sunucusuz ve konteynerleÅŸtirilmiÅŸ uygulamalar iÃ§in dosya sistemi eriÅŸimini basitleÅŸtirir.

## Privesc

{% content-ref url="../aws-privilege-escalation/aws-efs-privesc.md" %}
[aws-efs-privesc.md](../aws-privilege-escalation/aws-efs-privesc.md)
{% endcontent-ref %}

## Post Exploitation

{% content-ref url="../aws-post-exploitation/aws-efs-post-exploitation.md" %}
[aws-efs-post-exploitation.md](../aws-post-exploitation/aws-efs-post-exploitation.md)
{% endcontent-ref %}

## Persistence

{% content-ref url="../aws-persistence/aws-efs-persistence.md" %}
[aws-efs-persistence.md](../aws-persistence/aws-efs-persistence.md)
{% endcontent-ref %}

{% hint style="success" %}
AWS Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n:<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
GCP Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**abonelik planlarÄ±nÄ±**](https://github.com/sponsors/carlospolop) kontrol edin!
* **ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n ya da **Twitter'da** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**'i takip edin.**
* **Hacking ipuÃ§larÄ±nÄ± paylaÅŸmak iÃ§in** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna PR gÃ¶nderin.

</details>
{% endhint %}
