# AWS - EFS Enum

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## EFS

### Basic Information

Amazon Elastic File System (EFS)ëŠ” AWSì— ì˜í•´ **ì™„ì „ ê´€ë¦¬í˜•, í™•ì¥ ê°€ëŠ¥ ë° íƒ„ë ¥ì ì¸ ë„¤íŠ¸ì›Œí¬ íŒŒì¼ ì‹œìŠ¤í…œ**ìœ¼ë¡œ ì œê³µë©ë‹ˆë‹¤. ì´ ì„œë¹„ìŠ¤ëŠ” ì—¬ëŸ¬ EC2 ì¸ìŠ¤í„´ìŠ¤ ë° ê¸°íƒ€ AWS ì„œë¹„ìŠ¤ê°€ ë™ì‹œì— ì ‘ê·¼í•  ìˆ˜ ìˆëŠ” **íŒŒì¼ ì‹œìŠ¤í…œ**ì˜ ìƒì„± ë° êµ¬ì„±ì„ ìš©ì´í•˜ê²Œ í•©ë‹ˆë‹¤. EFSì˜ ì£¼ìš” ê¸°ëŠ¥ì—ëŠ” ìˆ˜ë™ ê°œì… ì—†ì´ ìë™ìœ¼ë¡œ í™•ì¥í•  ìˆ˜ ìˆëŠ” ëŠ¥ë ¥, ì €ì§€ì—° ì ‘ê·¼ ì œê³µ, ê³ ì²˜ë¦¬ëŸ‰ ì‘ì—… ë¶€í•˜ ì§€ì›, ë°ì´í„° ë‚´êµ¬ì„± ë³´ì¥, ë‹¤ì–‘í•œ AWS ë³´ì•ˆ ë©”ì»¤ë‹ˆì¦˜ê³¼ì˜ ì›í™œí•œ í†µí•©ì´ í¬í•¨ë©ë‹ˆë‹¤.

**ê¸°ë³¸ì ìœ¼ë¡œ**, ë§ˆìš´íŠ¸í•  EFS í´ë”ëŠ” **`/`**ì´ì§€ë§Œ **ë‹¤ë¥¸ ì´ë¦„**ì„ ê°€ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### Network Access

EFSëŠ” VPCì—ì„œ ìƒì„±ë˜ë©° **ê¸°ë³¸ì ìœ¼ë¡œ ëª¨ë“  VPC ì„œë¸Œë„¤íŠ¸ì›Œí¬ì—ì„œ ì ‘ê·¼ ê°€ëŠ¥**í•©ë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ EFSëŠ” ë³´ì•ˆ ê·¸ë£¹ì„ ê°€ì§‘ë‹ˆë‹¤. EFSë¥¼ ë§ˆìš´íŠ¸í•˜ê¸° ìœ„í•´ **EC2**(ë˜ëŠ” ë‹¤ë¥¸ AWS ì„œë¹„ìŠ¤)ì— ì ‘ê·¼ì„ í—ˆìš©í•˜ë ¤ë©´, **EFS ë³´ì•ˆ ê·¸ë£¹ì—ì„œ EC2 ë³´ì•ˆ ê·¸ë£¹ìœ¼ë¡œë¶€í„°ì˜ ì¸ë°”ìš´ë“œ NFS**(2049 í¬íŠ¸) **ê·œì¹™ì„ í—ˆìš©í•´ì•¼ í•©ë‹ˆë‹¤**.

ì´ ì—†ì´ëŠ” **NFS ì„œë¹„ìŠ¤ì— ì—°ë½í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤**.

ì´ ì‘ì—…ì„ ìˆ˜í–‰í•˜ëŠ” ë°©ë²•ì— ëŒ€í•œ ìì„¸í•œ ì •ë³´ëŠ” ë‹¤ìŒì„ í™•ì¸í•˜ì„¸ìš”: [https://stackoverflow.com/questions/38632222/aws-efs-connection-timeout-at-mount](https://stackoverflow.com/questions/38632222/aws-efs-connection-timeout-at-mount)

### Enumeration
```bash
# Get filesystems and access policies (if any)
aws efs describe-file-systems
aws efs describe-file-system-policy --file-system-id <id>

# Get subnetworks and IP addresses where you can find the file system
aws efs describe-mount-targets --file-system-id <id>
aws efs describe-mount-target-security-groups --mount-target-id <id>
aws ec2 describe-security-groups --group-ids <sg_id>

# Get other access points
aws efs describe-access-points

# Get replication configurations
aws efs describe-replication-configurations

# Search for NFS in EC2 networks
sudo nmap -T4 -Pn -p 2049 --open 10.10.10.0/20 # or /16 to be sure
```
{% hint style="danger" %}
EFS ë§ˆìš´íŠ¸ í¬ì¸íŠ¸ê°€ ê°™ì€ VPC ë‚´ì— ìˆì§€ë§Œ ë‹¤ë¥¸ ì„œë¸Œë„·ì— ìˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ëª¨ë“  **EFS í¬ì¸íŠ¸ë¥¼ ì°¾ê³  ì‹¶ë‹¤ë©´ `/16` ë„·ë§ˆìŠ¤í¬ë¥¼ ìŠ¤ìº”í•˜ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤**.
{% endhint %}

### EFS ë§ˆìš´íŠ¸

{% code overflow="wrap" %}
```bash
sudo mkdir /efs

## Mount found
sudo apt install nfs-common
sudo mount -t nfs4 -o nfsvers=4.1,rsize=1048576,wsize=1048576,hard,timeo=600,retrans=2,noresvport <IP>:/ /efs

## Mount with efs type
## You need to have installed the package amazon-efs-utils
sudo yum install amazon-efs-utils # If centos
sudo apt-get install amazon-efs-utils # If ubuntu
sudo mount -t efs <file-system-id/EFS DNS name>:/ /efs/
```
{% endcode %}

### IAM ì ‘ê·¼

ê¸°ë³¸ì ìœ¼ë¡œ EFSì— ëŒ€í•œ ë„¤íŠ¸ì›Œí¬ ì ‘ê·¼ ê¶Œí•œì´ ìˆëŠ” ëˆ„êµ¬ë‚˜ **ë£¨íŠ¸ ì‚¬ìš©ìë¡œì„œë„ ë§ˆìš´íŠ¸í•˜ê³ , ì½ê³  ì“¸ ìˆ˜ ìˆìŠµë‹ˆë‹¤**. ê·¸ëŸ¬ë‚˜ íŒŒì¼ ì‹œìŠ¤í…œ ì •ì±…ì´ ì„¤ì •ë˜ì–´ **íŠ¹ì • ê¶Œí•œì„ ê°€ì§„ ì£¼ì²´ë§Œ ì ‘ê·¼í•  ìˆ˜ ìˆë„ë¡** í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\
ì˜ˆë¥¼ ë“¤ì–´, ì´ íŒŒì¼ ì‹œìŠ¤í…œ ì •ì±…ì€ **IAM ê¶Œí•œì´ ì—†ìœ¼ë©´** íŒŒì¼ ì‹œìŠ¤í…œì„ **ë§ˆìš´íŠ¸í•˜ëŠ” ê²ƒë„ í—ˆìš©í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤**:
```json
{
"Version": "2012-10-17",
"Id": "efs-policy-wizard-2ca2ba76-5d83-40be-8557-8f6c19eaa797",
"Statement": [
{
"Sid": "efs-statement-e7f4b04c-ad75-4a7f-a316-4e5d12f0dbf5",
"Effect": "Allow",
"Principal": {
"AWS": "*"
},
"Action": "",
"Resource": "arn:aws:elasticfilesystem:us-east-1:318142138553:file-system/fs-0ab66ad201b58a018",
"Condition": {
"Bool": {
"elasticfilesystem:AccessedViaMountTarget": "true"
}
}
}
]
}
```
ë˜í•œ ì´ëŠ” **ìµëª… ì ‘ê·¼ì„ ë°©ì§€**í•©ë‹ˆë‹¤:

<figure><img src="../../../.gitbook/assets/image (278).png" alt=""><figcaption></figcaption></figure>

IAMìœ¼ë¡œ ë³´í˜¸ëœ íŒŒì¼ ì‹œìŠ¤í…œì„ ë§ˆìš´íŠ¸í•˜ë ¤ë©´ ë§ˆìš´íŠ¸ ëª…ë ¹ì—ì„œ ë°˜ë“œì‹œ "efs" ìœ í˜•ì„ ì‚¬ìš©í•´ì•¼ í•©ë‹ˆë‹¤:
```bash
sudo mkdir /efs
sudo mount -t efs -o tls,iam  <file-system-id/EFS DNS name>:/ /efs/
# To use a different pforile from ~/.aws/credentials
# You can use: -o tls,iam,awsprofile=namedprofile
```
### Access Points

**ì•¡ì„¸ìŠ¤ í¬ì¸íŠ¸**ëŠ” **EFS íŒŒì¼ ì‹œìŠ¤í…œ**ì— ëŒ€í•œ **ì• í”Œë¦¬ì¼€ì´ì…˜**-íŠ¹ì • ì§„ì…ì ìœ¼ë¡œ, ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ê³µìœ  ë°ì´í„° ì„¸íŠ¸ì— ì ‘ê·¼í•˜ëŠ” ê²ƒì„ ë” ì‰½ê²Œ ê´€ë¦¬í•  ìˆ˜ ìˆê²Œ í•´ì¤ë‹ˆë‹¤.

ì•¡ì„¸ìŠ¤ í¬ì¸íŠ¸ë¥¼ ìƒì„±í•  ë•Œ, ì•¡ì„¸ìŠ¤ í¬ì¸íŠ¸ë¥¼ í†µí•´ ìƒì„±ëœ íŒŒì¼ ë° ë””ë ‰í† ë¦¬ì— ëŒ€í•œ **ì†Œìœ ì ë° POSIX ê¶Œí•œ**ì„ **ì§€ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤**. ë˜í•œ, **ê¸°ì¡´ ë””ë ‰í† ë¦¬ë¥¼ ì§€ì •í•˜ê±°ë‚˜ ì›í•˜ëŠ” ê¶Œí•œìœ¼ë¡œ ìƒˆ ë””ë ‰í† ë¦¬ë¥¼ ìƒì„±í•˜ì—¬** ì•¡ì„¸ìŠ¤ í¬ì¸íŠ¸ì— ëŒ€í•œ **ì‚¬ìš©ì ì •ì˜ ë£¨íŠ¸ ë””ë ‰í† ë¦¬**ë¥¼ **ì •ì˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤**. ì´ë¥¼ í†µí•´ **ì• í”Œë¦¬ì¼€ì´ì…˜ ë˜ëŠ” ì‚¬ìš©ìë³„ë¡œ EFS íŒŒì¼ ì‹œìŠ¤í…œì— ëŒ€í•œ ì ‘ê·¼ì„ ì œì–´**í•  ìˆ˜ ìˆì–´, ê³µìœ  íŒŒì¼ ë°ì´í„°ë¥¼ ë” ì‰½ê²Œ ê´€ë¦¬í•˜ê³  ë³´í˜¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

**ì•¡ì„¸ìŠ¤ í¬ì¸íŠ¸ì—ì„œ íŒŒì¼ ì‹œìŠ¤í…œì„ ë‹¤ìŒê³¼ ê°™ì´ ë§ˆìš´íŠ¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:**
```bash
# Use IAM if you need to use iam permissions
sudo mount -t efs -o tls,[iam],accesspoint=<access-point-id> \
<file-system-id/EFS DNS> /efs/
```
{% hint style="warning" %}
ë„¤íŠ¸ì›Œí¬ë¥¼ í†µí•´ **NFS ì„œë¹„ìŠ¤ì— ì—°ë½í•  ìˆ˜ ìˆì–´ì•¼** í•˜ë©°, EFSì— íŒŒì¼ ì‹œìŠ¤í…œ **ì •ì±…**ì´ ìˆëŠ” ê²½ìš°, ì´ë¥¼ ë§ˆìš´íŠ¸í•˜ê¸° ìœ„í•´ **ì¶©ë¶„í•œ IAM ê¶Œí•œ**ì´ í•„ìš”í•©ë‹ˆë‹¤.
{% endhint %}

ì•¡ì„¸ìŠ¤ í¬ì¸íŠ¸ëŠ” ë‹¤ìŒê³¼ ê°™ì€ ëª©ì ìœ¼ë¡œ ì‚¬ìš©ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

* **ê¶Œí•œ ê´€ë¦¬ ë‹¨ìˆœí™”**: ê° ì•¡ì„¸ìŠ¤ í¬ì¸íŠ¸ì— ëŒ€í•´ POSIX ì‚¬ìš©ì ë° ê·¸ë£¹ì„ ì •ì˜í•¨ìœ¼ë¡œì¨, ê¸°ë³¸ íŒŒì¼ ì‹œìŠ¤í…œì˜ ê¶Œí•œì„ ìˆ˜ì •í•˜ì§€ ì•Šê³ ë„ ë‹¤ì–‘í•œ ì• í”Œë¦¬ì¼€ì´ì…˜ì´ë‚˜ ì‚¬ìš©ìì— ëŒ€í•œ ì ‘ê·¼ ê¶Œí•œì„ ì‰½ê²Œ ê´€ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
* **ë£¨íŠ¸ ë””ë ‰í† ë¦¬ ê°•ì œí™”**: ì•¡ì„¸ìŠ¤ í¬ì¸íŠ¸ëŠ” EFS íŒŒì¼ ì‹œìŠ¤í…œ ë‚´ì˜ íŠ¹ì • ë””ë ‰í† ë¦¬ì— ëŒ€í•œ ì ‘ê·¼ì„ ì œí•œí•  ìˆ˜ ìˆì–´, ê° ì• í”Œë¦¬ì¼€ì´ì…˜ì´ë‚˜ ì‚¬ìš©ìê°€ ì§€ì •ëœ í´ë” ë‚´ì—ì„œ ì‘ì—…í•˜ë„ë¡ ë³´ì¥í•©ë‹ˆë‹¤. ì´ëŠ” ìš°ë°œì ì¸ ë°ì´í„° ë…¸ì¶œì´ë‚˜ ìˆ˜ì •ì„ ë°©ì§€í•˜ëŠ” ë° ë„ì›€ì´ ë©ë‹ˆë‹¤.
* **íŒŒì¼ ì‹œìŠ¤í…œ ì ‘ê·¼ ìš©ì´ì„±**: ì•¡ì„¸ìŠ¤ í¬ì¸íŠ¸ëŠ” AWS Lambda í•¨ìˆ˜ë‚˜ AWS Fargate ì‘ì—…ê³¼ ì—°ê²°ë  ìˆ˜ ìˆì–´, ì„œë²„ë¦¬ìŠ¤ ë° ì»¨í…Œì´ë„ˆí™”ëœ ì• í”Œë¦¬ì¼€ì´ì…˜ì— ëŒ€í•œ íŒŒì¼ ì‹œìŠ¤í…œ ì ‘ê·¼ì„ ë‹¨ìˆœí™”í•©ë‹ˆë‹¤.

## Privesc

{% content-ref url="../aws-privilege-escalation/aws-efs-privesc.md" %}
[aws-efs-privesc.md](../aws-privilege-escalation/aws-efs-privesc.md)
{% endcontent-ref %}

## Post Exploitation

{% content-ref url="../aws-post-exploitation/aws-efs-post-exploitation.md" %}
[aws-efs-post-exploitation.md](../aws-post-exploitation/aws-efs-post-exploitation.md)
{% endcontent-ref %}

## Persistence

{% content-ref url="../aws-persistence/aws-efs-persistence.md" %}
[aws-efs-persistence.md](../aws-persistence/aws-efs-persistence.md)
{% endcontent-ref %}

{% hint style="success" %}
AWS í•´í‚¹ ë°°ìš°ê¸° ë° ì—°ìŠµí•˜ê¸°:<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
GCP í•´í‚¹ ë°°ìš°ê¸° ë° ì—°ìŠµí•˜ê¸°: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks ì§€ì›í•˜ê¸°</summary>

* [**êµ¬ë… ê³„íš**](https://github.com/sponsors/carlospolop) í™•ì¸í•˜ê¸°!
* **ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— ì°¸ì—¬í•˜ê±°ë‚˜, **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**ë¥¼ íŒ”ë¡œìš°í•˜ì„¸ìš”.**
* **[**HackTricks**](https://github.com/carlospolop/hacktricks) ë° [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) ê¹ƒí—ˆë¸Œ ë¦¬í¬ì— PRì„ ì œì¶œí•˜ì—¬ í•´í‚¹ íŒì„ ê³µìœ í•˜ì„¸ìš”.**

</details>
{% endhint %}
