# Cognito User Pools

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ЁЯТм [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ЁЯРж [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Basic Information

рдПрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдкреВрд▓ Amazon Cognito рдореЗрдВ рдПрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рд╣реИред рдПрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдкреВрд▓ рдХреЗ рд╕рд╛рде, рдЖрдкрдХреЗ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ **Amazon Cognito рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдЖрдкрдХреЗ рд╡реЗрдм рдпрд╛ рдореЛрдмрд╛рдЗрд▓ рдРрдк рдореЗрдВ рд╕рд╛рдЗрди рдЗрди рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ**, **рдпрд╛ рдПрдХ рддреГрддреАрдп-рдкрдХреНрд╖** рдкрд╣рдЪрд╛рди рдкреНрд░рджрд╛рддрд╛ (IdP) рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд╕рдВрдШрдирд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред рдЪрд╛рд╣реЗ рдЖрдкрдХреЗ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рд╕реАрдзреЗ рд╕рд╛рдЗрди рдЗрди рдХрд░реЗрдВ рдпрд╛ рдПрдХ рддреГрддреАрдп рдкрдХреНрд╖ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ, рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдкреВрд▓ рдХреЗ рд╕рднреА рд╕рджрд╕реНрдп рдПрдХ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдкреНрд░реЛрдлрд╝рд╛рдЗрд▓ рд░рдЦрддреЗ рд╣реИрдВ рдЬрд┐рд╕реЗ рдЖрдк рдПрдХ SDK рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдПрдХреНрд╕реЗрд╕ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдкреВрд▓ рдкреНрд░рджрд╛рди рдХрд░рддреЗ рд╣реИрдВ:

* рд╕рд╛рдЗрди-рдЕрдк рдФрд░ рд╕рд╛рдЗрди-рдЗрди рд╕реЗрд╡рд╛рдПрдБред
* рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЛ рд╕рд╛рдЗрди рдЗрди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдЕрдВрддрд░реНрдирд┐рд╣рд┐рдд, рдЕрдиреБрдХреВрд▓рди рдпреЛрдЧреНрдп рд╡реЗрдм UIред
* рдлреЗрд╕рдмреБрдХ, рдЧреВрдЧрд▓, рдЕрдореЗрдЬрд╝рди рдХреЗ рд╕рд╛рде рд▓реЙрдЧрд┐рди, рдФрд░ рдПрдкреНрдкрд▓ рдХреЗ рд╕рд╛рде рд╕рд╛рдЗрди рдЗрди, рдФрд░ рдЖрдкрдХреЗ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдкреВрд▓ рд╕реЗ SAML рдФрд░ OIDC рдкрд╣рдЪрд╛рди рдкреНрд░рджрд╛рддрд╛рдУрдВ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд╕рд╛рдорд╛рдЬрд┐рдХ рд╕рд╛рдЗрди-рдЗрдиред
* рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдкреНрд░рдмрдВрдзрди рдФрд░ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдкреНрд░реЛрдлрд╛рдЗрд▓ред
* рд╕реБрд░рдХреНрд╖рд╛ рд╕реБрд╡рд┐рдзрд╛рдПрдБ рдЬреИрд╕реЗ рдмрд╣реБ-рдХрд╛рд░рдХ рдкреНрд░рдорд╛рдгреАрдХрд░рдг (MFA), рд╕рдордЭреМрддрд╛ рдХрд┐рдП рдЧрдП рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдХреЗ рд▓рд┐рдП рдЬрд╛рдВрдЪ, рдЦрд╛рддрд╛ рдЕрдзрд┐рдЧреНрд░рд╣рдг рд╕реБрд░рдХреНрд╖рд╛, рдФрд░ рдлреЛрди рдФрд░ рдИрдореЗрд▓ рд╕рддреНрдпрд╛рдкрдиред
* AWS Lambda рдЯреНрд░рд┐рдЧрд░реНрд╕ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдЕрдиреБрдХреВрд▓рд┐рдд рд╡рд░реНрдХрдлрд╝реНрд▓реЛ рдФрд░ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдорд╛рдЗрдЧреНрд░реЗрд╢рдиред

**рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХрд╛ рд╕реНрд░реЛрдд рдХреЛрдб** рдЖрдорддреМрд░ рдкрд░ **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдкреВрд▓ ID** рдФрд░ **рдХреНрд▓рд╛рдЗрдВрдЯ рдПрдкреНрд▓рд┐рдХреЗрд╢рди ID** (рдФрд░ рдХрднреА-рдХрднреА **рдПрдкреНрд▓рд┐рдХреЗрд╢рди рд╕реАрдХреНрд░реЗрдЯ**?) рднреА рд╢рд╛рдорд┐рд▓ рдХрд░реЗрдЧрд╛, рдЬреЛ рдПрдХ **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ Cognito рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдкреВрд▓ рдореЗрдВ рд▓реЙрдЧрд┐рди рдХрд░рдиреЗ** рдХреЗ рд▓рд┐рдП рдЖрд╡рд╢реНрдпрдХ рд╣реИрдВред

### Potential attacks

* **рдкрдВрдЬреАрдХрд░рдг**: рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ рдПрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рд╕реНрд╡рдпрдВ рдХреЛ рдкрдВрдЬреАрдХреГрдд рдХрд░ рд╕рдХрддрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рд╡рд╣ рдЕрдкрдиреЗ рд▓рд┐рдП рдПрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдмрдирд╛ рд╕рдХрддрд╛ рд╣реИред
* **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЧрдгрдирд╛**: рдкрдВрдЬреАрдХрд░рдг рдХрд╛рд░реНрдпрдХреНрд╖рдорддрд╛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдЙрди рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд╛рдореЛрдВ рдХреЛ рдЦреЛрдЬрдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдЬреЛ рдкрд╣рд▓реЗ рд╕реЗ рдореМрдЬреВрдж рд╣реИрдВред рдпрд╣ рдЬрд╛рдирдХрд╛рд░реА рдмреНрд░реВрдЯ-рдлреЛрд░реНрд╕ рд╣рдорд▓реЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧреА рд╣реЛ рд╕рдХрддреА рд╣реИред
* **рд▓реЙрдЧрд┐рди рдмреНрд░реВрдЯ-рдлреЛрд░реНрд╕**: [**Authentication**](cognito-user-pools.md#authentication) рдЕрдиреБрднрд╛рдЧ рдореЗрдВ рдЖрдкрдХреЗ рдкрд╛рд╕ рд╕рднреА **рд╡рд┐рдзрд┐рдпрд╛рдБ** рд╣реИрдВ рдЬрд┐рдирдХрд╛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ **рд▓реЙрдЧрд┐рди** рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рд╣реИ, рдЖрдк рдЙрдиреНрд╣реЗрдВ **рдорд╛рдиреНрдп рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕** рдЦреЛрдЬрдиреЗ рдХреЗ рд▓рд┐рдП рдмреНрд░реВрдЯ-рдлреЛрд░реНрд╕ рдХрд░рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

### Tools for pentesting

* [Pacu](https://github.com/RhinoSecurityLabs/pacu), рдЕрдм `cognito__enum` рдФрд░ `cognito__attack` рдореЙрдбреНрдпреВрд▓ рд╢рд╛рдорд┐рд▓ рдХрд░рддрд╛ рд╣реИ рдЬреЛ рдПрдХ рдЦрд╛рддреЗ рдореЗрдВ рд╕рднреА Cognito рд╕рдВрдкрддреНрддрд┐рдпреЛрдВ рдХреА рдЧрдгрдирд╛ рдХреЛ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рдХрд░рддрд╛ рд╣реИ рдФрд░ рдХрдордЬреЛрд░ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди, рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рд╡рд┐рд╢реЗрд╖рддрд╛рдУрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдЬреЛ рдкрд╣реБрдБрдЪ рдирд┐рдпрдВрддреНрд░рдг рдХреЗ рд▓рд┐рдП рд╣реИрдВ, рдЖрджрд┐ рдХреЛ рдЪрд┐рд╣реНрдирд┐рдд рдХрд░рддрд╛ рд╣реИ, рдФрд░ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд┐рд░реНрдорд╛рдг (MFA рд╕рдорд░реНрдерди рд╕рд╣рд┐рдд) рдФрд░ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░рдиреЗ рдпреЛрдЧреНрдп рдХрд╕реНрдЯрдо рд╡рд┐рд╢реЗрд╖рддрд╛рдУрдВ, рдЙрдкрдпреЛрдЧ рдпреЛрдЧреНрдп рдкрд╣рдЪрд╛рди рдкреВрд▓ рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕, рдЖрдИрдбреА рдЯреЛрдХрди рдореЗрдВ рдЕрд╕реБрдореЗрдмрд▓ рднреВрдорд┐рдХрд╛рдУрдВ рдХреЗ рдЖрдзрд╛рд░ рдкрд░ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рд╡реГрджреНрдзрд┐ рдХреЛ рднреА рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рдХрд░рддрд╛ рд╣реИред\
рдореЙрдбреНрдпреВрд▓ рдХреЗ рдХрд╛рд░реНрдпреЛрдВ рдХрд╛ рд╡рд┐рд╡рд░рдг [рдмреНрд▓реЙрдЧ рдкреЛрд╕реНрдЯ](https://rhinosecuritylabs.com/aws/attacking-aws-cognito-with-pacu-p2) рдХреЗ рднрд╛рдЧ 2 рдореЗрдВ рджреЗрдЦреЗрдВред рд╕реНрдерд╛рдкрдирд╛ рдирд┐рд░реНрджреЗрд╢реЛрдВ рдХреЗ рд▓рд┐рдП рдореБрдЦреНрдп [Pacu](https://github.com/RhinoSecurityLabs/pacu) рдкреГрд╖реНрда рджреЗрдЦреЗрдВред
```bash
# Run cognito__enum usage to gather all user pools, user pool clients, identity pools, users, etc. visible in the current AWS account
Pacu (new:test) > run cognito__enum

# cognito__attack usage to attempt user creation and all privesc vectors against a given identity pool and user pool client:
Pacu (new:test) > run cognito__attack --username randomuser --email XX+sdfs2@gmail.com --identity_pools
us-east-2:a06XXXXX-c9XX-4aXX-9a33-9ceXXXXXXXXX --user_pool_clients
59f6tuhfXXXXXXXXXXXXXXXXXX@us-east-2_0aXXXXXXX
```
* [Cognito Scanner](https://github.com/padok-team/cognito-scanner) рдПрдХ CLI рдЯреВрд▓ рд╣реИ рдЬреЛ рдкрд╛рдпрдерди рдореЗрдВ рд▓рд┐рдЦрд╛ рдЧрдпрд╛ рд╣реИ рдФрд░ рдпрд╣ Cognito рдкрд░ рд╡рд┐рднрд┐рдиреНрди рд╣рдорд▓реЛрдВ рдХреЛ рд▓рд╛рдЧреВ рдХрд░рддрд╛ рд╣реИ, рдЬрд┐рд╕рдореЗрдВ рдЕрдирдЪрд╛рд╣реА рдЦрд╛рддрд╛ рдирд┐рд░реНрдорд╛рдг рдФрд░ рдЦрд╛рддрд╛ рдУрд░реЗрдХрд▓ рд╢рд╛рдорд┐рд▓ рд╣реИрдВред рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП [рдЗрд╕ рд▓рд┐рдВрдХ](https://github.com/padok-team/cognito-scanner) рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВред
```bash
# Install
pip install cognito-scanner
# Run
cognito-scanner --help
```
* [CognitoAttributeEnum](https://github.com/punishell/CognitoAttributeEnum): рдпрд╣ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЗ рд▓рд┐рдП рдорд╛рдиреНрдп рд╡рд┐рд╢реЗрд╖рддрд╛рдУрдВ рдХреЛ рд╕реВрдЪреАрдмрджреНрдз рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддреА рд╣реИред
```bash
python cognito-attribute-enu.py -client_id 16f1g98bfuj9i0g3f8be36kkrl
```
## Registration

User Pools **рдбрд┐рдлрд╝реЙрд▓реНрдЯ** рджреНрд╡рд╛рд░рд╛ **рдирдП рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ** рдХреЛ **рдкрдВрдЬреАрдХрд░рдг** рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИред
```bash
aws cognito-idp sign-up --client-id <client-id> \
--username <username> --password <password> \
--region <region> --no-sign-request
```
#### рдпрджрд┐ рдХреЛрдИ рднреА рдкрдВрдЬреАрдХрд░рдг рдХрд░ рд╕рдХрддрд╛ рд╣реИ

рдЖрдкрдХреЛ рдПрдХ рддреНрд░реБрдЯрд┐ рдорд┐рд▓ рд╕рдХрддреА рд╣реИ рдЬреЛ рдЖрдкрдХреЛ рдмрддрд╛рддреА рд╣реИ рдХрд┐ рдЖрдкрдХреЛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ **рдЕрдзрд┐рдХ рд╡рд┐рд╡рд░рдг рдкреНрд░рджрд╛рди рдХрд░рдиреЗ** рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ:
```
An error occurred (InvalidParameterException) when calling the SignUp operation: Attributes did not conform to the schema: address: The attribute is required
```
рдЖрдк рдЖрд╡рд╢реНрдпрдХ рд╡рд┐рд╡рд░рдг рдПрдХ JSON рдХреЗ рд╕рд╛рде рдкреНрд░рджрд╛рди рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдЬреИрд╕реЗ:
```json
--user-attributes '[{"Name": "email", "Value": "carlospolop@gmail.com"}, {"Name":"gender", "Value": "M"}, {"Name": "address", "Value": "street"}, {"Name": "custom:custom_name", "Value":"supername&\"*$"}]'
```
рдЖрдк рдЗрд╕ рдХрд╛рд░реНрдпрдХреНрд╖рдорддрд╛ рдХрд╛ рдЙрдкрдпреЛрдЧ **рдореМрдЬреВрджрд╛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреА рдЧрдгрдирд╛** рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рднреА рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред рдЬрдм рдЙрд╕ рдирд╛рдо рдХреЗ рд╕рд╛рде рдПрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдкрд╣рд▓реЗ рд╕реЗ рдореМрдЬреВрдж рд╣реЛрддрд╛ рд╣реИ, рддреЛ рдпрд╣ рддреНрд░реБрдЯрд┐ рд╕рдВрджреЗрд╢ рд╣реИ:
```
An error occurred (UsernameExistsException) when calling the SignUp operation: User already exists
```
{% hint style="info" %}
рдкрд┐рдЫрд▓реЗ рдХрдорд╛рдВрдб рдореЗрдВ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ **рдХрд╕реНрдЯрдо рд╡рд┐рд╢реЗрд╖рддрд╛рдПрдБ "custom:" рд╕реЗ рд╢реБрд░реВ рд╣реЛрддреА рд╣реИрдВ**ред\
рдпрд╣ рднреА рдЬрд╛рдиреЗрдВ рдХрд┐ рдкрдВрдЬреАрдХрд░рдг рдХрд░рддреЗ рд╕рдордп рдЖрдк **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рд▓рд┐рдП рдирдИ рдХрд╕реНрдЯрдо рд╡рд┐рд╢реЗрд╖рддрд╛рдПрдБ рдирд╣реАрдВ рдмрдирд╛ рд╕рдХрддреЗ**ред рдЖрдк рдХреЗрд╡рд▓ **рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд╡рд┐рд╢реЗрд╖рддрд╛рдУрдВ** (рднрд▓реЗ рд╣реА рд╡реЗ рдЖрд╡рд╢реНрдпрдХ рди рд╣реЛрдВ) рдФрд░ **рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд╕реНрдЯрдо рд╡рд┐рд╢реЗрд╖рддрд╛рдУрдВ** рдХреЛ рдорд╛рди рджреЗ рд╕рдХрддреЗ рд╣реИрдВред
{% endhint %}

рдпрд╛ рдмрд╕ рдпрд╣ рдкрд░реАрдХреНрд╖рдг рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐ рдХреНрдпрд╛ рдПрдХ рдХреНрд▓рд╛рдЗрдВрдЯ рдЖрдИрдбреА рдореМрдЬреВрдж рд╣реИред рдпрджрд┐ рдХреНрд▓рд╛рдЗрдВрдЯ-рдЖрдИрдбреА рдореМрдЬреВрдж рдирд╣реАрдВ рд╣реИ рддреЛ рдпрд╣ рддреНрд░реБрдЯрд┐ рд╣реИ:
```
An error occurred (ResourceNotFoundException) when calling the SignUp operation: User pool client 3ig612gjm56p1ljls1prq2miut does not exist.
```
#### рдпрджрд┐ рдХреЗрд╡рд▓ рд╡реНрдпрд╡рд╕реНрдерд╛рдкрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЛ рдкрдВрдЬреАрдХреГрдд рдХрд░ рд╕рдХрддрд╛ рд╣реИ

рдЖрдк рдЗрд╕ рддреНрд░реБрдЯрд┐ рдХреЛ рдкрд╛рдПрдВрдЧреЗ рдФрд░ рдЖрдк рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЛ рдкрдВрдЬреАрдХреГрдд рдпрд╛ рд╕реВрдЪреАрдмрджреНрдз рдирд╣реАрдВ рдХрд░ рдкрд╛рдПрдВрдЧреЗ:
```
An error occurred (NotAuthorizedException) when calling the SignUp operation: SignUp is not permitted for this user pool
```
### рдкрдВрдЬреАрдХрд░рдг рдХреА рдкреБрд╖реНрдЯрд┐ рдХрд░рдирд╛

Cognito **рдПрдХ рдирдП рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреА рдкреБрд╖реНрдЯрд┐ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрд╕рдХреЗ рдИрдореЗрд▓ рдпрд╛ рдлреЛрди рдирдВрдмрд░ рдХреА рдкреБрд╖реНрдЯрд┐ рдХрд░рдиреЗ** рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИред рдЗрд╕рд▓рд┐рдП, рдЬрдм рдЖрдк рдПрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдмрдирд╛ рд░рд╣реЗ рд╣реЛрддреЗ рд╣реИрдВ, рддреЛ рдЖрдорддреМрд░ рдкрд░ рдЖрдкрдХреЛ рдХрдо рд╕реЗ рдХрдо рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд╛рдо рдФрд░ рдкрд╛рд╕рд╡рд░реНрдб рдФрд░ **рдИрдореЗрд▓ рдФрд░/рдпрд╛ рдлреЛрди рдирдВрдмрд░** рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрдЧреАред рдмрд╕ рдПрдХ рдРрд╕рд╛ **рд╕реЗрдЯ рдХрд░реЗрдВ рдЬрд┐рд╕реЗ рдЖрдк рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░рддреЗ рд╣реИрдВ** рддрд╛рдХрд┐ рдЖрдк **рдЕрдкрдиреЗ** рдирдП рдмрдирд╛рдП рдЧрдП рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ **рдЦрд╛рддреЗ** рдХреА рдкреБрд╖реНрдЯрд┐ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХреЛрдб рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХреЗрдВ рдЬреИрд╕реЗ:
```bash
aws cognito-idp confirm-sign-up --client-id <cliet_id> \
--username aasdasd2 --confirmation-code <conf_code> \
--no-sign-request --region us-east-1
```
{% hint style="warning" %}
рдпрд╣рд╛рдВ рддрдХ рдХрд┐ **рдРрд╕рд╛ рд▓рдЧрддрд╛ рд╣реИ рдХрд┐ рдЖрдк рд╡рд╣реА рдИрдореЗрд▓** рдФрд░ рдлреЛрди рдирдВрдмрд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдЬрдм рдЖрдкрдХреЛ рдмрдирд╛рдП рдЧрдП рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ рд╕рддреНрдпрд╛рдкрд┐рдд рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ, рддреЛ Cognito рд╕рдорд╛рди рдЬрд╛рдирдХрд╛рд░реА рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рд╢рд┐рдХрд╛рдпрдд рдХрд░реЗрдЧрд╛ рдФрд░ **рдЖрдкрдХреЛ рдЦрд╛рддрд╛ рд╕рддреНрдпрд╛рдкрд┐рдд рдХрд░рдиреЗ рдирд╣реАрдВ рджреЗрдЧрд╛**ред
{% endhint %}

### рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рд╡реГрджреНрдзрд┐ / рдЧреБрдг рдЕрдкрдбреЗрдЯ рдХрд░рдирд╛

рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ, рдПрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ **рдЕрдкрдиреЗ рдЧреБрдгреЛрдВ рдХреЗ рдорд╛рди рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░ рд╕рдХрддрд╛ рд╣реИ** рдХреБрдЫ рдЗрд╕ рддрд░рд╣:
```bash
aws cognito-idp update-user-attributes \
--region us-east-1 --no-sign-request \
--user-attributes Name=address,Value=street \
--access-token <access token>
```
#### рдХрд╕реНрдЯрдо рд╡рд┐рд╢реЗрд╖рддрд╛ рдкреНрд░рд┐рд╡реЗрд╕реНрдХ

{% hint style="danger" %}
рдЖрдкрдХреЛ **рдХрд╕реНрдЯрдо рд╡рд┐рд╢реЗрд╖рддрд╛рдУрдВ** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реБрдП рдорд┐рд▓ рд╕рдХрддрд╛ рд╣реИ (рдЬреИрд╕реЗ `isAdmin`), рдХреНрдпреЛрдВрдХрд┐ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ рдЖрдк **рдЕрдкрдиреА рд╡рд┐рд╢реЗрд╖рддрд╛рдУрдВ рдХреЗ рдорд╛рди рдмрджрд▓ рд╕рдХрддреЗ рд╣реИрдВ**, рдЖрдк **рдЕрдзрд┐рдХрд╛рд░ рдмрдврд╝рд╛рдиреЗ** рдХреЗ рд▓рд┐рдП рдорд╛рди рд╕реНрд╡рдпрдВ рдмрджрд▓ рд╕рдХрддреЗ рд╣реИрдВ!
{% endhint %}

#### рдИрдореЗрд▓/рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд╛рдо рд╕рдВрд╢реЛрдзрди рдкреНрд░рд┐рд╡реЗрд╕реНрдХ

рдЖрдк рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ **рдХрд┐рд╕реА рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХрд╛ рдИрдореЗрд▓ рдФрд░ рдлреЛрди рдирдВрдмрд░** **рд╕рдВрд╢реЛрдзрд┐рдд** рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рд▓реЗрдХрд┐рди рдлрд┐рд░, рднрд▓реЗ рд╣реА рдЦрд╛рддрд╛ рд╕рддреНрдпрд╛рдкрд┐рдд рд░рд╣реЗ, рдЙрди рд╡рд┐рд╢реЗрд╖рддрд╛рдУрдВ рдХреЛ **рдЕрд╕рддреНрдпрд╛рдкрд┐рдд рд╕реНрдерд┐рддрд┐ рдореЗрдВ рд╕реЗрдЯ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ** (рдЖрдкрдХреЛ рдЙрдиреНрд╣реЗрдВ рдлрд┐рд░ рд╕реЗ рд╕рддреНрдпрд╛рдкрд┐рдд рдХрд░рдирд╛ рд╣реЛрдЧрд╛)ред

{% hint style="warning" %}
рдЖрдк **рдИрдореЗрд▓ рдпрд╛ рдлреЛрди рдирдВрдмрд░** рдХреЗ рд╕рд╛рде рд▓реЙрдЧрд┐рди рдирд╣реАрдВ рдХрд░ рдкрд╛рдПрдВрдЧреЗ рдЬрдм рддрдХ рдХрд┐ рдЖрдк рдЙрдиреНрд╣реЗрдВ рд╕рддреНрдпрд╛рдкрд┐рдд рдирд╣реАрдВ рдХрд░рддреЗ, рд▓реЗрдХрд┐рди рдЖрдк **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд╛рдо** рдХреЗ рд╕рд╛рде рд▓реЙрдЧрд┐рди рдХрд░рдиреЗ рдореЗрдВ **рд╕рдХреНрд╖рдо рд╣реЛрдВрдЧреЗ**ред\
рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рднрд▓реЗ рд╣реА рдИрдореЗрд▓ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реЛ рдФрд░ рд╕рддреНрдпрд╛рдкрд┐рдд рди рд╣реЛ, рдпрд╣ **`email`** **рдХреНрд╖реЗрддреНрд░** рдХреЗ рдЕрдВрджрд░ ID Token рдореЗрдВ рджрд┐рдЦрд╛рдИ рджреЗрдЧрд╛ рдФрд░ **`email_verified`** рдлрд╝реАрд▓реНрдб **false** рд╣реЛрдЧреА, рд▓реЗрдХрд┐рди рдпрджрд┐ рдРрдк **рдпрд╣ рдирд╣реАрдВ рджреЗрдЦ рд░рд╣рд╛ рд╣реИ рддреЛ рдЖрдк рдЕрдиреНрдп рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХрд╛ рдЕрдиреБрдХрд░рдг рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ**ред

рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдЖрдк **рдирд╛рдо рд╡рд┐рд╢реЗрд╖рддрд╛** рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░рдХреЗ **`name`** рдлрд╝реАрд▓реНрдб рдХреЗ рдЕрдВрджрд░ рдХреБрдЫ рднреА рдбрд╛рд▓ рд╕рдХрддреЗ рд╣реИрдВред рдпрджрд┐ рдХреЛрдИ рдРрдк рдХрд┐рд╕реА рдХрд╛рд░рдг рд╕реЗ **`email`** (рдпрд╛ рдХрд┐рд╕реА рдЕрдиреНрдп рд╡рд┐рд╢реЗрд╖рддрд╛) рдХреЗ рдмрдЬрд╛рдп рдЙрд╕ рдлрд╝реАрд▓реНрдб рдХреА **рдЬрд╛рдВрдЪ рдХрд░ рд░рд╣рд╛ рд╣реИ** рддреЛ рдЖрдк **рдЕрдиреНрдп рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХрд╛ рдЕрдиреБрдХрд░рдг рдХрд░рдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВ**ред
{% endhint %}

рдЦреИрд░, рдпрджрд┐ рдХрд┐рд╕реА рдХрд╛рд░рдг рд╕реЗ рдЖрдкрдиреЗ рдЕрдкрдирд╛ рдИрдореЗрд▓, рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдПрдХ рдирдП рдИрдореЗрд▓ рдореЗрдВ рдмрджрд▓ рджрд┐рдпрд╛ рд╣реИ рдЬрд┐рд╕реЗ рдЖрдк рдПрдХреНрд╕реЗрд╕ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рддреЛ рдЖрдк **рдЙрд╕ рдИрдореЗрд▓ рдкрддреЗ рдкрд░ рдкреНрд░рд╛рдкреНрдд рдХреЛрдб рдХреЗ рд╕рд╛рде рдИрдореЗрд▓ рдХреА рдкреБрд╖реНрдЯрд┐ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ**:
```bash
aws cognito-idp verify-user-attribute \
--access-token <access_token> \
--attribute-name email --code <code> \
--region <region> --no-sign-request
```
**`рдлреЛрди_рдирдВрдмрд░`** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ **`рдИрдореЗрд▓`** рдХреЗ рдмрдЬрд╛рдп **рдирдП рдлреЛрди рдирдВрдмрд░** рдХреЛ рдмрджрд▓рдиреЗ/рд╕рддреНрдпрд╛рдкрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдПред

{% hint style="info" %}
рд╡реНрдпрд╡рд╕реНрдерд╛рдкрдХ рдЗрд╕ рд╡рд┐рдХрд▓реНрдк рдХреЛ рд╕рдХреНрд╖рдо рдХрд░ рд╕рдХрддрд╛ рд╣реИ рдХрд┐ **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рджреНрд╡рд╛рд░рд╛ рдкрд╕рдВрдж рдХрд┐рдпрд╛ рдЧрдпрд╛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд╛рдо** рд╕реЗ рд▓реЙрдЧрд┐рди рдХрд░реЗрдВред рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдЖрдк рдЗрд╕ рдорд╛рди рдХреЛ **рдХрд┐рд╕реА рднреА рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд╛рдо рдпрд╛ рдкрд╕рдВрджреАрджрд╛_рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд╛рдо** рдореЗрдВ рдирд╣реАрдВ рдмрджрд▓ рдкрд╛рдПрдВрдЧреЗ рдЬреЛ рдкрд╣рд▓реЗ рд╕реЗ рдХрд┐рд╕реА рдЕрдиреНрдп рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреА рдирдХрд▓ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛ рд░рд╣рд╛ рд╣реИред
{% endhint %}

### рдкрд╛рд╕рд╡рд░реНрдб рдкреБрдирд░реНрдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ/рдмрджрд▓реЗрдВ

рдпрд╣ рд╕рдВрднрд╡ рд╣реИ рдХрд┐ рдХреЗрд╡рд▓ **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд╛рдо** (рдпрд╛ рдИрдореЗрд▓ рдпрд╛ рдлреЛрди рд╕реНрд╡реАрдХрд╛рд░ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ) рдХреЛ рдЬрд╛рдирдХрд░ рдкрд╛рд╕рд╡рд░реНрдб рдХреЛ рдкреБрдирд░реНрдкреНрд░рд╛рдкреНрдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗ рдФрд░ рд╡рд╣рд╛рдВ рдПрдХ рдХреЛрдб рднреЗрдЬрд╛ рдЬрд╛рдПрдЧрд╛:
```bash
aws cognito-idp forgot-password \
--client-id <client_id> \
--username <username/email/phone> --region <region>
```
{% hint style="info" %}
рд╕рд░реНрд╡рд░ рдХреА рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рд╣рдореЗрд╢рд╛ рд╕рдХрд╛рд░рд╛рддреНрдордХ рд╣реЛрдЧреА, рдЬреИрд╕реЗ рдХрд┐ рдпрджрд┐ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд╛рдо рдореМрдЬреВрдж рд╣реИред рдЖрдк рдЗрд╕ рд╡рд┐рдзрд┐ рдХрд╛ рдЙрдкрдпреЛрдЧ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреА рдЧрдгрдирд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдирд╣реАрдВ рдХрд░ рд╕рдХрддреЗ
{% endhint %}

With the code you can change the password with:
```bash
aws cognito-idp confirm-forgot-password \
--client-id <client_id> \
--username <username> \
--confirmation-code <conf_code> \
--password <pwd> --region <region>
```
рдкрд╛рд╕рд╡рд░реНрдб рдмрджрд▓рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдкрдХреЛ **рдкрд┐рдЫрд▓рд╛ рдкрд╛рд╕рд╡рд░реНрдб рдЬрд╛рдирдирд╛ рд╣реЛрдЧрд╛**:
```bash
aws cognito-idp change-password \
--previous-password <value> \
--proposed-password <value> \
--access-token <value>
```
## Authentication

рдПрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдкреВрд▓ **рдкреНрд░рдорд╛рдгрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╡рд┐рднрд┐рдиреНрди рддрд░реАрдХреЛрдВ** рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рддрд╛ рд╣реИред рдпрджрд┐ рдЖрдкрдХреЗ рдкрд╛рд╕ рдПрдХ **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд╛рдо рдФрд░ рдкрд╛рд╕рд╡рд░реНрдб** рд╣реИ, рддреЛ рд▓реЙрдЧрд┐рди рдХреЗ рд▓рд┐рдП рднреА **рд╡рд┐рднрд┐рдиреНрди рд╡рд┐рдзрд┐рдпрд╛рдБ** рд╕рдорд░реНрдерд┐рдд рд╣реИрдВред\
рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдЬрдм рдПрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдкреВрд▓ рдореЗрдВ рдкреНрд░рдорд╛рдгрд┐рдд рд╣реЛрддрд╛ рд╣реИ, рддреЛ **3 рдкреНрд░рдХрд╛рд░ рдХреЗ рдЯреЛрдХрди рджрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВ**: **ID рдЯреЛрдХрди**, **рдПрдХреНрд╕реЗрд╕ рдЯреЛрдХрди** рдФрд░ **рд░реАрдлреНрд░реЗрд╢ рдЯреЛрдХрди**ред

* [**ID Token**](https://docs.aws.amazon.com/cognito/latest/developerguide/amazon-cognito-user-pools-using-the-id-token.html): рдЗрд╕рдореЗрдВ **рдкреНрд░рдорд╛рдгрд┐рдд рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреА рдкрд╣рдЪрд╛рди** рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рджрд╛рд╡реЗ рд╣реЛрддреЗ рд╣реИрдВ, рдЬреИрд╕реЗ `name`, `email`, рдФрд░ `phone_number`ред ID рдЯреЛрдХрди рдХрд╛ рдЙрдкрдпреЛрдЧ **рдЖрдкрдХреЗ рд╕рдВрд╕рд╛рдзрди рд╕рд░реНрд╡рд░реЛрдВ рдпрд╛ рд╕рд░реНрд╡рд░ рдЕрдиреБрдкреНрд░рдпреЛрдЧреЛрдВ рдореЗрдВ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЛ рдкреНрд░рдорд╛рдгрд┐рдд рдХрд░рдиреЗ** рдХреЗ рд▓рд┐рдП рднреА рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред рдпрджрд┐ рдЖрдк рдЗрд╕реЗ рдмрд╛рд╣рд░реА рдЕрдиреБрдкреНрд░рдпреЛрдЧреЛрдВ рдореЗрдВ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВ, рддреЛ рдЖрдкрдХреЛ ID рдЯреЛрдХрди рдХреЗ рдЕрдВрджрд░ рдХрд┐рд╕реА рднреА рджрд╛рд╡реЗ рдкрд░ рднрд░реЛрд╕рд╛ рдХрд░рдиреЗ рд╕реЗ рдкрд╣рд▓реЗ **рд╣рд╕реНрддрд╛рдХреНрд╖рд░** рдХреА **рд╕рддреНрдпрд╛рдкрди** рдХрд░рдиреА рдЪрд╛рд╣рд┐рдПред
* ID рдЯреЛрдХрди рд╡рд╣ рдЯреЛрдХрди рд╣реИ рдЬреЛ **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рдЧреБрдгреЛрдВ рдХреЗ рдорд╛рди** рдХреЛ **рд╢рд╛рдорд┐рд▓ рдХрд░рддрд╛ рд╣реИ**, рдпрд╣рд╛рдВ рддрдХ рдХрд┐ рдХрд╕реНрдЯрдо рд╡рд╛рд▓реЗ рднреАред
* [**Access Token**](https://docs.aws.amazon.com/cognito/latest/developerguide/amazon-cognito-user-pools-using-the-access-token.html): рдЗрд╕рдореЗрдВ рдкреНрд░рдорд╛рдгрд┐рдд рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рджрд╛рд╡реЗ, **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рд╕рдореВрд╣реЛрдВ рдХреА рд╕реВрдЪреА**, рдФрд░ **рд╕реНрдХреЛрдк рдХреА рд╕реВрдЪреА** рд╣реЛрддреА рд╣реИред рдПрдХреНрд╕реЗрд╕ рдЯреЛрдХрди рдХрд╛ рдЙрджреНрджреЗрд╢реНрдп рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдкреВрд▓ рдореЗрдВ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рд╕рдВрджрд░реНрдн рдореЗрдВ **API рд╕рдВрдЪрд╛рд▓рди рдХреЛ рдЕрдзрд┐рдХреГрдд рдХрд░рдирд╛** рд╣реИред рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдЖрдк рдПрдХреНрд╕реЗрд╕ рдЯреЛрдХрди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ **рдЕрдкрдиреЗ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЧреБрдгреЛрдВ рдХреЛ рдЬреЛрдбрд╝рдиреЗ, рдмрджрд▓рдиреЗ рдпрд╛ рд╣рдЯрд╛рдиреЗ** рдХреА рдЕрдиреБрдорддрд┐ рджреЗ рд╕рдХрддреЗ рд╣реИрдВред
* [**Refresh Token**](https://docs.aws.amazon.com/cognito/latest/developerguide/amazon-cognito-user-pools-using-the-refresh-token.html): рд░реАрдлреНрд░реЗрд╢ рдЯреЛрдХрдиреЛрдВ рдХреЗ рд╕рд╛рде рдЖрдк рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рд▓рд┐рдП **рдирдП ID рдЯреЛрдХрди рдФрд░ рдПрдХреНрд╕реЗрд╕ рдЯреЛрдХрди рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ** рдЬрдм рддрдХ рдХрд┐ **рд░реАрдлреНрд░реЗрд╢ рдЯреЛрдХрди рдЕрдорд╛рдиреНрдп** рди рд╣реЛ рдЬрд╛рдПред **рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ**, рд░реАрдлреНрд░реЗрд╢ рдЯреЛрдХрди **30 рджрд┐рдиреЛрдВ рдХреЗ рдмрд╛рдж рд╕рдорд╛рдкреНрдд рд╣реЛ рдЬрд╛рддрд╛ рд╣реИ** рдЬрдм рдЖрдкрдХрд╛ рдЕрдиреБрдкреНрд░рдпреЛрдЧ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЖрдкрдХреЗ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдкреВрд▓ рдореЗрдВ рд╕рд╛рдЗрди рдЗрди рдХрд░рддрд╛ рд╣реИред рдЬрдм рдЖрдк рдЕрдкрдиреЗ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдкреВрд▓ рдХреЗ рд▓рд┐рдП рдПрдХ рдЕрдиреБрдкреНрд░рдпреЛрдЧ рдмрдирд╛рддреЗ рд╣реИрдВ, рддреЛ рдЖрдк рдЕрдиреБрдкреНрд░рдпреЛрдЧ рдХреЗ рд░реАрдлреНрд░реЗрд╢ рдЯреЛрдХрди рдХреА рд╕рдорд╛рдкреНрддрд┐ рдХреЛ **60 рдорд┐рдирдЯ рд╕реЗ 10 рд╡рд░реНрд╖реЛрдВ рдХреЗ рдмреАрдЪ рдХрд┐рд╕реА рднреА рдорд╛рди** рдкрд░ рд╕реЗрдЯ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

### ADMIN\_NO\_SRP\_AUTH & ADMIN\_USER\_PASSWORD\_AUTH

рдпрд╣ рд╕рд░реНрд╡рд░ рд╕рд╛рдЗрдб рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдкреНрд░рд╡рд╛рд╣ рд╣реИ:

* рд╕рд░реНрд╡рд░-рд╕рд╛рдЗрдб рдРрдк **`AdminInitiateAuth` API рдСрдкрд░реЗрд╢рди** рдХреЛ рдХреЙрд▓ рдХрд░рддрд╛ рд╣реИ ( `InitiateAuth` рдХреЗ рдмрдЬрд╛рдп)ред рдЗрд╕ рдСрдкрд░реЗрд╢рди рдХреЗ рд▓рд┐рдП AWS рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ рдЬрд┐рдирдореЗрдВ **`cognito-idp:AdminInitiateAuth`** рдФрд░ **`cognito-idp:AdminRespondToAuthChallenge`** рд╢рд╛рдорд┐рд▓ рд╣реИрдВред рдпрд╣ рдСрдкрд░реЗрд╢рди рдЖрд╡рд╢реНрдпрдХ рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдкреИрд░рд╛рдореАрдЯрд░ рд▓реМрдЯрд╛рддрд╛ рд╣реИред
* рдЬрдм рд╕рд░реНрд╡рд░-рд╕рд╛рдЗрдб рдРрдк рдХреЗ рдкрд╛рд╕ **рдкреНрд░рдорд╛рдгрди рдкреИрд░рд╛рдореАрдЯрд░** рд╣реЛрддреЗ рд╣реИрдВ, рддреЛ рдпрд╣ **`AdminRespondToAuthChallenge` API рдСрдкрд░реЗрд╢рди** рдХреЛ рдХреЙрд▓ рдХрд░рддрд╛ рд╣реИред `AdminRespondToAuthChallenge` API рдСрдкрд░реЗрд╢рди рдХреЗрд╡рд▓ рддрднреА рд╕рдлрд▓ рд╣реЛрддрд╛ рд╣реИ рдЬрдм рдЖрдк AWS рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдкреНрд░рджрд╛рди рдХрд░рддреЗ рд╣реИрдВред

рдпрд╣ **рд╡рд┐рдзрд┐ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ рд╕рдХреНрд╖рдо рдирд╣реАрдВ рд╣реИ**ред

**рд▓реЙрдЧрд┐рди** рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдкрдХреЛ **рдЬрд╛рдирдирд╛ рдЖрд╡рд╢реНрдпрдХ рд╣реИ**:

* рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдкреВрд▓ рдЖрдИрдбреА
* рдХреНрд▓рд╛рдЗрдВрдЯ рдЖрдИрдбреА
* рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд╛рдо
* рдкрд╛рд╕рд╡рд░реНрдб
* рдХреНрд▓рд╛рдЗрдВрдЯ рд╕реАрдХреНрд░реЗрдЯ (рдХреЗрд╡рд▓ рдпрджрд┐ рдРрдк рдХреЛ рдПрдХ рд╕реАрдХреНрд░реЗрдЯ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ)

{% hint style="info" %}
рдЗрд╕ рд╡рд┐рдзрд┐ рдХреЗ рд╕рд╛рде **рд▓реЙрдЧрд┐рди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП** рдЙрд╕ рдЕрдиреБрдкреНрд░рдпреЛрдЧ рдХреЛ `ALLOW_ADMIN_USER_PASSWORD_AUTH` рдХреЗ рд╕рд╛рде рд▓реЙрдЧрд┐рди рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрдиреА рдЪрд╛рд╣рд┐рдПред\
рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдЗрд╕ рдХреНрд░рд┐рдпрд╛ рдХреЛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдкрдХреЛ **`cognito-idp:AdminInitiateAuth`** рдФрд░ **`cognito-idp:AdminRespondToAuthChallenge`** рдХреЗ рд╕рд╛рде рдЕрдиреБрдорддрд┐рдпреЛрдВ рд╡рд╛рд▓реЗ рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред
{% endhint %}
```python
aws cognito-idp admin-initiate-auth \
--client-id <client-id> \
--auth-flow ADMIN_USER_PASSWORD_AUTH \
--region <region> \
--auth-parameters 'USERNAME=<username>,PASSWORD=<password>,SECRET_HASH=<hash_if_needed>'
--user-pool-id "<pool-id>"

# Check the python code to learn how to generate the hsecret_hash
```
<details>

<summary>рд▓реЙрдЧрд┐рди рдХреЗ рд▓рд┐рдП рдХреЛрдб</summary>
```python
import boto3
import botocore
import hmac
import hashlib
import base64


client_id = "<client-id>"
user_pool_id = "<user-pool-id>"
client_secret = "<client-secret>"
username = "<username>"
password = "<pwd>"

boto_client = boto3.client('cognito-idp', region_name='us-east-1')

def get_secret_hash(username, client_id, client_secret):
key = bytes(client_secret, 'utf-8')
message = bytes(f'{username}{client_id}', 'utf-8')
return base64.b64encode(hmac.new(key, message, digestmod=hashlib.sha256).digest()).decode()

# If the Client App isn't configured to use a secret
## just delete the line setting the SECRET_HASH
def login_user(username_or_alias, password, client_id, client_secret, user_pool_id):
try:
return boto_client.admin_initiate_auth(
UserPoolId=user_pool_id,
ClientId=client_id,
AuthFlow='ADMIN_USER_PASSWORD_AUTH',
AuthParameters={
'USERNAME': username_or_alias,
'PASSWORD': password,
'SECRET_HASH': get_secret_hash(username_or_alias, client_id, client_secret)
}
)
except botocore.exceptions.ClientError as e:
return e.response

print(login_user(username, password, client_id, client_secret, user_pool_id))
```
</details>

### USER\_PASSWORD\_AUTH

рдпрд╣ рд╡рд┐рдзрд┐ рдПрдХ рдФрд░ рд╕рд░рд▓ рдФрд░ **рдкрд╛рд░рдВрдкрд░рд┐рдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдФрд░ рдкрд╛рд╕рд╡рд░реНрдб рдкреНрд░рдорд╛рдгреАрдХрд░рдг** рдкреНрд░рд╡рд╛рд╣ рд╣реИред рдЗрд╕реЗ **Cognito** рдореЗрдВ **рдкрд╛рд░рдВрдкрд░рд┐рдХ** рдкреНрд░рдорд╛рдгреАрдХрд░рдг рд╡рд┐рдзрд┐ **рд╕реНрдерд╛рдирд╛рдВрддрд░рд┐рдд** рдХрд░рдиреЗ рдХреА рд╕рд┐рдлрд╛рд░рд┐рд╢ рдХреА рдЬрд╛рддреА рд╣реИ рдФрд░ рдлрд┐рд░ рдЗрд╕реЗ **рдЕрдХреНрд╖рдо** рдХрд░рдиреЗ рдФрд░ рдЗрд╕рдХреЗ рдмрдЬрд╛рдп **ALLOW\_USER\_SRP\_AUTH** рд╡рд┐рдзрд┐ рдХрд╛ **рдЙрдкрдпреЛрдЧ** рдХрд░рдиреЗ рдХреА рд╕рд┐рдлрд╛рд░рд┐рд╢ рдХреА рдЬрд╛рддреА рд╣реИ (рдХреНрдпреЛрдВрдХрд┐ рдпрд╣ рдХрднреА рднреА рдкрд╛рд╕рд╡рд░реНрдб рдХреЛ рдиреЗрдЯрд╡рд░реНрдХ рдкрд░ рдирд╣реАрдВ рднреЗрдЬрддрд╛)ред\
рдпрд╣ **рд╡рд┐рдзрд┐ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ рд╕рдХреНрд╖рдо рдирд╣реАрдВ рд╣реИ**ред

рдХреЛрдб рдХреЗ рдЕрдВрджрд░ **рдкрд┐рдЫрд▓реА рдкреНрд░рдорд╛рдгреАрдХрд░рдг рд╡рд┐рдзрд┐** рдХреЗ рд╕рд╛рде рдореБрдЦреНрдп **рдЕрдВрддрд░** рдпрд╣ рд╣реИ рдХрд┐ рдЖрдкрдХреЛ **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдкреВрд▓ рдЖрдИрдбреА** рдЬрд╛рдирдиреЗ рдХреА **рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реИ** рдФрд░ рдЖрдкрдХреЛ Cognito рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдкреВрд▓ рдореЗрдВ **рдЕрддрд┐рд░рд┐рдХреНрдд рдЕрдиреБрдорддрд┐рдпреЛрдВ** рдХреА **рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реИ**ред

**рд▓реЙрдЧрд┐рди** рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдкрдХреЛ **рдЬрд╛рдирдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ**:

* рдХреНрд▓рд╛рдЗрдВрдЯ рдЖрдИрдбреА
* рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд╛рдо
* рдкрд╛рд╕рд╡рд░реНрдб
* рдХреНрд▓рд╛рдЗрдВрдЯ рд╕реАрдХреНрд░реЗрдЯ (рдХреЗрд╡рд▓ рдпрджрд┐ рдРрдк рдХреЛ рдПрдХ рд╕реАрдХреНрд░реЗрдЯ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ)

{% hint style="info" %}
рдЗрд╕ рд╡рд┐рдзрд┐ рдХреЗ рд╕рд╛рде **рд▓реЙрдЧрд┐рди рдХрд░рдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рд╣реЛрдиреЗ рдХреЗ рд▓рд┐рдП** рдЙрд╕ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЛ ALLOW\_USER\_PASSWORD\_AUTH рдХреЗ рд╕рд╛рде рд▓реЙрдЧрд┐рди рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрдиреА рдЪрд╛рд╣рд┐рдПред
{% endhint %}
```python
aws cognito-idp initiate-auth  --client-id <client-id> \
--auth-flow USER_PASSWORD_AUTH --region <region> \
--auth-parameters 'USERNAME=<username>,PASSWORD=<password>,SECRET_HASH=<hash_if_needed>'

# Check the python code to learn how to generate the secret_hash
```
<details>

<summary>рд▓реЙрдЧрд┐рди рдХреЗ рд▓рд┐рдП Python рдХреЛрдб</summary>
```python
import boto3
import botocore
import hmac
import hashlib
import base64


client_id = "<client-id>"
user_pool_id = "<user-pool-id>"
client_secret = "<client-secret>"
username = "<username>"
password = "<pwd>"

boto_client = boto3.client('cognito-idp', region_name='us-east-1')

def get_secret_hash(username, client_id, client_secret):
key = bytes(client_secret, 'utf-8')
message = bytes(f'{username}{client_id}', 'utf-8')
return base64.b64encode(hmac.new(key, message, digestmod=hashlib.sha256).digest()).decode()

# If the Client App isn't configured to use a secret
## just delete the line setting the SECRET_HASH
def login_user(username_or_alias, password, client_id, client_secret, user_pool_id):
try:
return boto_client.initiate_auth(
ClientId=client_id,
AuthFlow='ADMIN_USER_PASSWORD_AUTH',
AuthParameters={
'USERNAME': username_or_alias,
'PASSWORD': password,
'SECRET_HASH': get_secret_hash(username_or_alias, client_id, client_secret)
}
)
except botocore.exceptions.ClientError as e:
return e.response

print(login_user(username, password, client_id, client_secret, user_pool_id))
```
</details>

### USER\_SRP\_AUTH

рдпрд╣ рдкрд░рд┐рджреГрд╢реНрдп рдкрд┐рдЫрд▓реЗ рд╡рд╛рд▓реЗ рдХреЗ рд╕рдорд╛рди рд╣реИ рд▓реЗрдХрд┐рди **рдкрд╛рд╕рд╡рд░реНрдб рднреЗрдЬрдиреЗ рдХреЗ рдмрдЬрд╛рдп** рдиреЗрдЯрд╡рд░реНрдХ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд▓реЙрдЧрд┐рди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП **рдЪреБрдиреМрддреА рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ** (рдЗрд╕рд▓рд┐рдП рдХреЛрдИ рдкрд╛рд╕рд╡рд░реНрдб рдиреЗрдЯрд╡рд░реНрдХ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдПрдиреНрдХреНрд░рд┐рдкреНрдЯреЗрдб рднреА рдирд╣реАрдВ рдЬрд╛рддрд╛)ред\
рдпрд╣ **рд╡рд┐рдзрд┐ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ рд╕рдХреНрд╖рдо** рд╣реИред

рд▓реЙрдЧрд┐рди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдкрдХреЛ **рдЬрд╛рдирдирд╛ рдЖрд╡рд╢реНрдпрдХ рд╣реИ**:

* рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдкреВрд▓ рдЖрдИрдбреА
* рдХреНрд▓рд╛рдЗрдВрдЯ рдЖрдИрдбреА
* рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд╛рдо
* рдкрд╛рд╕рд╡рд░реНрдб
* рдХреНрд▓рд╛рдЗрдВрдЯ рд╕реАрдХреНрд░реЗрдЯ (рдХреЗрд╡рд▓ рдпрджрд┐ рдРрдк рдХреЛ рд╕реАрдХреНрд░реЗрдЯ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ)

<details>

<summary>Code to login</summary>
```python
from warrant.aws_srp import AWSSRP
import os

USERNAME='xxx'
PASSWORD='yyy'
POOL_ID='us-east-1_zzzzz'
CLIENT_ID = '12xxxxxxxxxxxxxxxxxxxxxxx'
CLIENT_SECRET = 'secreeeeet'
os.environ["AWS_DEFAULT_REGION"] = "<region>"

aws = AWSSRP(username=USERNAME, password=PASSWORD, pool_id=POOL_ID,
client_id=CLIENT_ID, client_secret=CLIENT_SECRET)
tokens = aws.authenticate_user()
id_token = tokens['AuthenticationResult']['IdToken']
refresh_token = tokens['AuthenticationResult']['RefreshToken']
access_token = tokens['AuthenticationResult']['AccessToken']
token_type = tokens['AuthenticationResult']['TokenType']
```
</details>

### REFRESH\_TOKEN\_AUTH & REFRESH\_TOKEN

рдпрд╣ **рд╡рд┐рдзрд┐ рд╣рдореЗрд╢рд╛ рдорд╛рдиреНрдп рд░рд╣рдиреЗ рд╡рд╛рд▓реА рд╣реИ** (рдЗрд╕реЗ рдмрдВрдж рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛) рд▓реЗрдХрд┐рди рдЖрдкрдХреЗ рдкрд╛рд╕ рдПрдХ рдорд╛рдиреНрдп рд░рд┐рдлреНрд░реЗрд╢ рдЯреЛрдХрди рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдПред
```bash
aws cognito-idp initiate-auth \
--client-id 3ig6h5gjm56p1ljls1prq2miut \
--auth-flow REFRESH_TOKEN_AUTH \
--region us-east-1 \
--auth-parameters 'REFRESH_TOKEN=<token>'
```
<details>

<summary>рдХреЛрдб рдХреЛ рддрд╛рдЬрд╝рд╛ рдХрд░реЗрдВ</summary>
```python
import boto3
import botocore
import hmac
import hashlib
import base64

client_id = "<client-id>"
token = '<token>'

boto_client = boto3.client('cognito-idp', region_name='<region>')

def refresh(client_id, refresh_token):
try:
return boto_client.initiate_auth(
ClientId=client_id,
AuthFlow='REFRESH_TOKEN_AUTH',
AuthParameters={
'REFRESH_TOKEN': refresh_token
}
)
except botocore.exceptions.ClientError as e:
return e.response


print(refresh(client_id, token))
```
</details>

### CUSTOM\_AUTH

рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ **рдкреНрд░рдорд╛рдгреАрдХрд░рдг** **рд▓реИрдореНрдмреНрдбрд╛ рдлрд╝рдВрдХреНрд╢рди** рдХреЗ **рдирд┐рд╖реНрдкрд╛рджрди** рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред

## рдЕрддрд┐рд░рд┐рдХреНрдд рд╕реБрд░рдХреНрд╖рд╛

### рдЙрдиреНрдирдд рд╕реБрд░рдХреНрд╖рд╛

рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ рдпрд╣ рдмрдВрдж рд╣реИ, рд▓реЗрдХрд┐рди рдпрджрд┐ рд╕рдХреНрд╖рдо рдХрд┐рдпрд╛ рдЧрдпрд╛, рддреЛ Cognito **рдЦрд╛рддрд╛ рдЕрдзрд┐рдЧреНрд░рд╣рдг** рдХреЛ **рдЦреЛрдЬрдиреЗ** рдореЗрдВ рд╕рдХреНрд╖рдо рд╣реЛ рд╕рдХрддрд╛ рд╣реИред рд╕рдВрднрд╛рд╡рдирд╛ рдХреЛ рдХрдо рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдЖрдкрдХреЛ **рдПрдХ рд╣реА рд╢рд╣рд░ рдХреЗ рдЕрдВрджрд░ рдПрдХ рдиреЗрдЯрд╡рд░реНрдХ рд╕реЗ рд▓реЙрдЧрд┐рди рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдП, рдЙрд╕реА рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдПрдЬреЗрдВрдЯ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реБрдП** (рдФрд░ рдпрджрд┐ рд╕рдВрднрд╡ рд╣реЛ рддреЛ IP)**ред**

### **MFA рдпрд╛рдж рд░рдЦреЗрдВ рдбрд┐рд╡рд╛рдЗрд╕**

рдпрджрд┐ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЙрд╕реА рдбрд┐рд╡рд╛рдЗрд╕ рд╕реЗ рд▓реЙрдЧрд┐рди рдХрд░рддрд╛ рд╣реИ, рддреЛ MFA рдХреЛ рдмрд╛рдпрдкрд╛рд╕ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП MFA рд╕реБрд░рдХреНрд╖рд╛ рдХреЛ рдмрд╛рдпрдкрд╛рд╕ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрд╕реА рдореЗрдЯрд╛рдбреЗрдЯрд╛ (IP?) рдХреЗ рд╕рд╛рде рдЙрд╕реА рдмреНрд░рд╛рдЙрдЬрд╝рд░ рд╕реЗ рд▓реЙрдЧрд┐рди рдХрд░рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░реЗрдВред

## рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдкреВрд▓ рд╕рдореВрд╣ IAM рднреВрдорд┐рдХрд╛рдПрдБ

рдпрд╣ рд╕рдВрднрд╡ рд╣реИ рдХрд┐ **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдкреВрд▓** рд╕рдореВрд╣реЛрдВ рдореЗрдВ рдЬреЛрдбрд╝рд╛ рдЬрд╛рдП рдЬреЛ рдПрдХ **IAM рднреВрдорд┐рдХрд╛** рд╕реЗ рд╕рдВрдмрдВрдзрд┐рдд рд╣реИрдВред\
рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ** рдХреЛ **рд╡рд┐рднрд┐рдиреНрди IAM рднреВрдорд┐рдХрд╛рдУрдВ** рдХреЗ рд╕рд╛рде **1 рд╕реЗ рдЕрдзрд┐рдХ рд╕рдореВрд╣реЛрдВ** рдореЗрдВ рдЕрд╕рд╛рдЗрди рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред

рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рднрд▓реЗ рд╣реА рдПрдХ рд╕рдореВрд╣ рдореЗрдВ рдПрдХ IAM рднреВрдорд┐рдХрд╛ рд╕рдВрд▓рдЧреНрди рд╣реЛ, рдЙрд╕ рд╕рдореВрд╣ рдХреЗ IAM рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рддрдХ рдкрд╣реБрдБрдЪрдиреЗ рдХреЗ рд▓рд┐рдП рдЖрд╡рд╢реНрдпрдХ рд╣реИ рдХрд┐ **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдкреВрд▓ рдХреЛ рдПрдХ рдкрд╣рдЪрд╛рди рдкреВрд▓ рджреНрд╡рд╛рд░рд╛ рд╡рд┐рд╢реНрд╡рд╕рдиреАрдп рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП** (рдФрд░ рдЙрд╕ рдкрд╣рдЪрд╛рди рдкреВрд▓ рдХреЗ рд╡рд┐рд╡рд░рдг рдХреЛ рдЬрд╛рдирдирд╛ рдЪрд╛рд╣рд┐рдП)ред

рдЬрдм рдПрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдкреВрд▓ рдореЗрдВ рдкреНрд░рдорд╛рдгрд┐рдд рд╣реЛрддрд╛ рд╣реИ (`aws cognito-idp initiate-auth...`), рддреЛ **IdToken рдореЗрдВ рдирд┐рд░реНрджрд┐рд╖реНрдЯ IAM рднреВрдорд┐рдХрд╛** рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдФрд░ рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ рдХрд┐ **рдкрд╣рдЪрд╛рди рдкреНрд░рджрд╛рддрд╛ рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдкреНрд░рджрд╛рддрд╛** рдХреЛ рдпрд╣ рд╕рдВрдХреЗрдд рджреЗрдирд╛ рдЪрд╛рд╣рд┐рдП рдХрд┐ **рднреВрдорд┐рдХрд╛ рдХреЛ рдЯреЛрдХрди рд╕реЗ рдЪреБрдирд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдПред**

<figure><img src="../../../../.gitbook/assets/image (250).png" alt=""><figcaption></figcaption></figure>

рдПрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рдкрд╛рд╕ рдкрд╣реБрдБрдЪрдиреЗ рдХреЗ рд▓рд┐рдП **рднреВрдорд┐рдХрд╛рдПрдБ** **`IdToken`** рдХреЗ рдЕрдВрджрд░ рд╣реЛрддреА рд╣реИрдВ, рдФрд░ рдПрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ **`--custom-role-arn`** рдХреЗ рд╕рд╛рде **рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдХреЗ рд▓рд┐рдП рдЬрд┐рд╕ рднреВрдорд┐рдХрд╛ рдХреЛ рд╡рд╣ рдкрд╕рдВрдж рдХрд░рддрд╛ рд╣реИ рдЙрд╕реЗ рдЪреБрди рд╕рдХрддрд╛ рд╣реИ** `aws cognito-identity get-credentials-for-identity` рд╕реЗред\
рд╣рд╛рд▓рд╛рдВрдХрд┐, рдпрджрд┐ **рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд╡рд┐рдХрд▓реНрдк** рд╡рд╣ рд╣реИ рдЬреЛ **рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ** (`рдбрд┐рдлрд╝реЙрд▓реНрдЯ рднреВрдорд┐рдХрд╛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ`), рдФрд░ рдЖрдк IdToken рд╕реЗ рдПрдХ рднреВрдорд┐рдХрд╛ рддрдХ рдкрд╣реБрдБрдЪрдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░рддреЗ рд╣реИрдВ, рддреЛ рдЖрдкрдХреЛ **рддреНрд░реБрдЯрд┐** рдорд┐рд▓реЗрдЧреА (рдЗрд╕рд▓рд┐рдП рдкрд┐рдЫрд▓реЗ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ):

{% code overflow="wrap" %}
```
An error occurred (InvalidParameterException) when calling the GetCredentialsForIdentity operation: Only SAML providers and providers with RoleMappings support custom role ARN.
```
{% endcode %}

{% hint style="warning" %}
рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ **рдпреВрдЬрд░ рдкреВрд▓ рдЧреНрд░реБрдк** рдХреЛ рд╕реМрдВрдкрд╛ рдЧрдпрд╛ рднреВрдорд┐рдХрд╛ рдЙрд╕ **рдкрд╣рдЪрд╛рди рдкреНрд░рджрд╛рддрд╛ рджреНрд╡рд╛рд░рд╛ рдкрд╣реБрдБрдЪ рдпреЛрдЧреНрдп рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП** рдЬреЛ **рдпреВрдЬрд░ рдкреВрд▓ рдкрд░ рднрд░реЛрд╕рд╛ рдХрд░рддрд╛ рд╣реИ** (рдХреНрдпреЛрдВрдХрд┐ IAM рднреВрдорд┐рдХрд╛ **рд╕рддреНрд░ рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдЗрд╕реЗ рдкреНрд░рд╛рдкреНрдд рдХрд┐рдП рдЬрд╛рдиреЗ рд╡рд╛рд▓реЗ рд╣реИрдВ**).
{% endhint %}
```json
{
"Version": "2012-10-17",
"Statement": [
{
"Effect": "Allow",
"Principal": {
"Federated": "cognito-identity.amazonaws.com"
},
"Action": "sts:AssumeRoleWithWebIdentity",
"Condition": {
"StringEquals": {
"cognito-identity.amazonaws.com:aud": "us-east-1:2361092e-9db6-a876-1027-10387c9de439"
},
"ForAnyValue:StringLike": {
"cognito-identity.amazonaws.com:amr": "authenticated"
}
}
}
]
}js
```
{% hint style="success" %}
AWS рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ рдФрд░ рдЕрднреНрдпрд╛рд╕ рдХрд░реЗрдВ:<img src="../../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
GCP рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ рдФрд░ рдЕрднреНрдпрд╛рд╕ рдХрд░реЗрдВ: <img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░реЗрдВ</summary>

* [**рд╕рджрд╕реНрдпрддрд╛ рдпреЛрдЬрдирд╛рдПрдБ**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* **рд╣рдорд╛рд░реЗ** ЁЯТм [**Discord рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**telegram рд╕рдореВрд╣**](https://t.me/peass) рдореЗрдВ рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ рдпрд╛ **рд╣рдорд╛рд░рд╛ рдЕрдиреБрд╕рд░рдг рдХрд░реЗрдВ** **Twitter** ЁЯРж [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ рдФрд░** [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github рд░рд┐рдкреЛрдЬрд┐рдЯрд░реА рдореЗрдВ PRs рд╕рдмрдорд┐рдЯ рдХрд░реЗрдВред

</details>
{% endhint %}
