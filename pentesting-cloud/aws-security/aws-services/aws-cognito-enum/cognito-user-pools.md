# Cognito User Pools

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Basic Information

ì‚¬ìš©ì í’€ì€ Amazon Cognitoì˜ ì‚¬ìš©ì ë””ë ‰í† ë¦¬ì…ë‹ˆë‹¤. ì‚¬ìš©ì í’€ì„ ì‚¬ìš©í•˜ë©´ ì‚¬ìš©ìê°€ Amazon Cognitoë¥¼ í†µí•´ ì›¹ ë˜ëŠ” ëª¨ë°”ì¼ ì•±ì— **ë¡œê·¸ì¸**í•˜ê±°ë‚˜ **íƒ€ì‚¬** ID ê³µê¸‰ì(IdP)ë¥¼ í†µí•´ **ì—°í•©**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì‚¬ìš©ìê°€ ì§ì ‘ ë¡œê·¸ì¸í•˜ë“  íƒ€ì‚¬ë¥¼ í†µí•´ ë¡œê·¸ì¸í•˜ë“ , ì‚¬ìš©ì í’€ì˜ ëª¨ë“  êµ¬ì„±ì›ì€ SDKë¥¼ í†µí•´ ì•¡ì„¸ìŠ¤í•  ìˆ˜ ìˆëŠ” ë””ë ‰í† ë¦¬ í”„ë¡œí•„ì„ ê°–ìŠµë‹ˆë‹¤.

ì‚¬ìš©ì í’€ì€ ë‹¤ìŒì„ ì œê³µí•©ë‹ˆë‹¤:

* ê°€ì… ë° ë¡œê·¸ì¸ ì„œë¹„ìŠ¤.
* ì‚¬ìš©ìë¥¼ ë¡œê·¸ì¸ì‹œí‚¤ê¸° ìœ„í•œ ë‚´ì¥í˜• ë§ì¶¤í˜• ì›¹ UI.
* Facebook, Google, Amazon ë¡œê·¸ì¸ ë° Apple ë¡œê·¸ì¸, SAML ë° OIDC ID ê³µê¸‰ìë¥¼ í†µí•œ ì†Œì…œ ë¡œê·¸ì¸.
* ì‚¬ìš©ì ë””ë ‰í† ë¦¬ ê´€ë¦¬ ë° ì‚¬ìš©ì í”„ë¡œí•„.
* ë‹¤ì¤‘ ì¸ì¦(MFA), ì†ìƒëœ ìê²© ì¦ëª… í™•ì¸, ê³„ì • íƒˆì·¨ ë°©ì§€, ì „í™” ë° ì´ë©”ì¼ í™•ì¸ê³¼ ê°™ì€ ë³´ì•ˆ ê¸°ëŠ¥.
* AWS Lambda íŠ¸ë¦¬ê±°ë¥¼ í†µí•œ ë§ì¶¤í˜• ì›Œí¬í”Œë¡œìš° ë° ì‚¬ìš©ì ë§ˆì´ê·¸ë ˆì´ì…˜.

ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ **ì†ŒìŠ¤ ì½”ë“œ**ì—ëŠ” ì¼ë°˜ì ìœ¼ë¡œ **ì‚¬ìš©ì í’€ ID**ì™€ **í´ë¼ì´ì–¸íŠ¸ ì• í”Œë¦¬ì¼€ì´ì…˜ ID**(ë•Œë¡œëŠ” **ì• í”Œë¦¬ì¼€ì´ì…˜ ë¹„ë°€**ë„ í¬í•¨ë  ìˆ˜ ìˆìŒ)ê°€ í¬í•¨ë˜ì–´ ìˆìœ¼ë©°, ì´ëŠ” ì‚¬ìš©ìê°€ Cognito ì‚¬ìš©ì í’€ì— **ë¡œê·¸ì¸**í•˜ëŠ” ë° í•„ìš”í•©ë‹ˆë‹¤.

### Potential attacks

* **Registration**: ê¸°ë³¸ì ìœ¼ë¡œ ì‚¬ìš©ìëŠ” ìŠ¤ìŠ¤ë¡œ ë“±ë¡í•  ìˆ˜ ìˆìœ¼ë¯€ë¡œ ìì‹ ì„ ìœ„í•œ ì‚¬ìš©ìë¥¼ ìƒì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
* **User enumeration**: ë“±ë¡ ê¸°ëŠ¥ì„ ì‚¬ìš©í•˜ì—¬ ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ì‚¬ìš©ì ì´ë¦„ì„ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ ì •ë³´ëŠ” ë¬´ì°¨ë³„ ëŒ€ì… ê³µê²©ì— ìœ ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
* **Login brute-force**: [**Authentication**](cognito-user-pools.md#authentication) ì„¹ì…˜ì—ëŠ” ì‚¬ìš©ìê°€ **ë¡œê·¸ì¸**í•˜ëŠ” ëª¨ë“  **ë°©ë²•**ì´ ë‚˜ì™€ ìˆìœ¼ë©°, ì´ë¥¼ í†µí•´ ë¬´ì°¨ë³„ ëŒ€ì… ê³µê²©ì„ ì‹œë„í•˜ì—¬ **ìœ íš¨í•œ ìê²© ì¦ëª…**ì„ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### Tools for pentesting

* [Pacu](https://github.com/RhinoSecurityLabs/pacu), AWS ìµìŠ¤í”Œë¡œì‡ í”„ë ˆì„ì›Œí¬ëŠ” ì´ì œ ê³„ì •ì˜ ëª¨ë“  Cognito ìì‚°ì„ ìë™ìœ¼ë¡œ ì—´ê±°í•˜ê³  ì•½í•œ êµ¬ì„±, ì•¡ì„¸ìŠ¤ ì œì–´ì— ì‚¬ìš©ë˜ëŠ” ì‚¬ìš©ì ì†ì„± ë“±ì„ í”Œë˜ê·¸í•˜ëŠ” "cognito\_\_enum" ë° "cognito\_\_attack" ëª¨ë“ˆì„ í¬í•¨í•˜ë©°, ì‚¬ìš©ì ìƒì„±(MFA ì§€ì› í¬í•¨) ë° ìˆ˜ì • ê°€ëŠ¥í•œ ì‚¬ìš©ì ì •ì˜ ì†ì„±, ì‚¬ìš© ê°€ëŠ¥í•œ ID í’€ ìê²© ì¦ëª…, id í† í°ì—ì„œ ê°€ì •í•  ìˆ˜ ìˆëŠ” ì—­í•  ë“±ì„ ê¸°ë°˜ìœ¼ë¡œ í•œ ê¶Œí•œ ìƒìŠ¹ë„ ìë™í™”í•©ë‹ˆë‹¤.

ëª¨ë“ˆ ê¸°ëŠ¥ì— ëŒ€í•œ ì„¤ëª…ì€ [ë¸”ë¡œê·¸ ê²Œì‹œë¬¼](https://rhinosecuritylabs.com/aws/attacking-aws-cognito-with-pacu-p2) 2ë¶€ë¥¼ ì°¸ì¡°í•˜ì‹­ì‹œì˜¤. ì„¤ì¹˜ ì§€ì¹¨ì€ [Pacu](https://github.com/RhinoSecurityLabs/pacu) ë©”ì¸ í˜ì´ì§€ë¥¼ ì°¸ì¡°í•˜ì‹­ì‹œì˜¤.

#### Usage

ì£¼ì–´ì§„ ID í’€ ë° ì‚¬ìš©ì í’€ í´ë¼ì´ì–¸íŠ¸ì— ëŒ€í•´ ì‚¬ìš©ì ìƒì„± ë° ëª¨ë“  ê¶Œí•œ ìƒìŠ¹ ë²¡í„°ë¥¼ ì‹œë„í•˜ëŠ” ìƒ˜í”Œ cognito\_\_attack ì‚¬ìš©ë²•:
```bash
Pacu (new:test) > run cognito__attack --username randomuser --email XX+sdfs2@gmail.com --identity_pools
us-east-2:a06XXXXX-c9XX-4aXX-9a33-9ceXXXXXXXXX --user_pool_clients
59f6tuhfXXXXXXXXXXXXXXXXXX@us-east-2_0aXXXXXXX
```
í˜„ì¬ AWS ê³„ì •ì—ì„œ ë³¼ ìˆ˜ ìˆëŠ” ëª¨ë“  ì‚¬ìš©ì í’€, ì‚¬ìš©ì í’€ í´ë¼ì´ì–¸íŠ¸, ID í’€, ì‚¬ìš©ì ë“±ì„ ìˆ˜ì§‘í•˜ê¸° ìœ„í•œ cognito\_\_enum ì‚¬ìš© ì˜ˆì‹œ:
```bash
Pacu (new:test) > run cognito__enum
```
* [Cognito Scanner](https://github.com/padok-team/cognito-scanner)ëŠ” ì›í•˜ì§€ ì•ŠëŠ” ê³„ì • ìƒì„± ë° ê³„ì • ì˜¤ë¼í´ì„ í¬í•¨í•œ ë‹¤ì–‘í•œ ê³µê²©ì„ êµ¬í˜„í•˜ëŠ” pythonì˜ CLI ë„êµ¬ì…ë‹ˆë‹¤.

#### Installation (ì„¤ì¹˜)
```bash
$ pip install cognito-scanner
```
#### ì‚¬ìš©ë²•
```bash
$ cognito-scanner --help
```
For more information check https://github.com/padok-team/cognito-scanner

## Registration

User PoolsëŠ” **ê¸°ë³¸ì ìœ¼ë¡œ** **ìƒˆ ì‚¬ìš©ì ë“±ë¡**ì„ í—ˆìš©í•©ë‹ˆë‹¤.
```bash
aws cognito-idp sign-up --client-id <client-id> \
--username <username> --password <password> \
--region <region> --no-sign-request
```
#### ëˆ„êµ¬ë‚˜ ë“±ë¡í•  ìˆ˜ ìˆëŠ” ê²½ìš°

ì‚¬ìš©ìì— ëŒ€í•œ **ë” ë§ì€ ì„¸ë¶€ ì •ë³´ë¥¼ ì œê³µ**í•´ì•¼ í•œë‹¤ëŠ” ì˜¤ë¥˜ê°€ ë°œìƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```
An error occurred (InvalidParameterException) when calling the SignUp operation: Attributes did not conform to the schema: address: The attribute is required
```
```markdown
í•„ìš”í•œ ì„¸ë¶€ ì •ë³´ë¥¼ JSONìœ¼ë¡œ ì œê³µí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```
```json
--user-attributes '[{"Name": "email", "Value": "carlospolop@gmail.com"}, {"Name":"gender", "Value": "M"}, {"Name": "address", "Value": "street"}, {"Name": "custom:custom_name", "Value":"supername&\"*$"}]'
```
ì´ ê¸°ëŠ¥ì„ ì‚¬ìš©í•˜ì—¬ **ê¸°ì¡´ ì‚¬ìš©ìë¥¼ ì—´ê±°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.** ë‹¤ìŒì€ í•´ë‹¹ ì´ë¦„ìœ¼ë¡œ ì‚¬ìš©ìê°€ ì´ë¯¸ ì¡´ì¬í•  ë•Œì˜ ì˜¤ë¥˜ ë©”ì‹œì§€ì…ë‹ˆë‹¤:
```
An error occurred (UsernameExistsException) when calling the SignUp operation: User already exists
```
{% hint style="info" %}
ì´ì „ ëª…ë ¹ì—ì„œ **ì‚¬ìš©ì ì§€ì • ì†ì„±ì€ "custom:"ìœ¼ë¡œ ì‹œì‘**í•˜ëŠ” ê²ƒì„ ì£¼ëª©í•˜ì‹­ì‹œì˜¤.\
ë˜í•œ ë“±ë¡í•  ë•Œ **ì‚¬ìš©ìì—ê²Œ ìƒˆë¡œìš´ ì‚¬ìš©ì ì§€ì • ì†ì„±ì„ ìƒì„±í•  ìˆ˜ ì—†ë‹¤ëŠ” ê²ƒ**ì„ ì•Œì•„ë‘ì‹­ì‹œì˜¤. **ê¸°ë³¸ ì†ì„±**(í•„ìˆ˜ ì‚¬í•­ì´ ì•„ë‹ˆë”ë¼ë„)ê³¼ **ì§€ì •ëœ ì‚¬ìš©ì ì§€ì • ì†ì„±**ì—ë§Œ ê°’ì„ ë¶€ì—¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
{% endhint %}

ë˜ëŠ” í´ë¼ì´ì–¸íŠ¸ IDê°€ ì¡´ì¬í•˜ëŠ”ì§€ í…ŒìŠ¤íŠ¸í•˜ê¸° ìœ„í•´ì„œì…ë‹ˆë‹¤. í´ë¼ì´ì–¸íŠ¸ IDê°€ ì¡´ì¬í•˜ì§€ ì•Šì„ ê²½ìš°ì˜ ì˜¤ë¥˜ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤:
```
An error occurred (ResourceNotFoundException) when calling the SignUp operation: User pool client 3ig612gjm56p1ljls1prq2miut does not exist.
```
#### If only admin can register users

ê´€ë¦¬ìë§Œ ì‚¬ìš©ìë¥¼ ë“±ë¡í•  ìˆ˜ ìˆëŠ” ê²½ìš°, ë‹¤ìŒê³¼ ê°™ì€ ì˜¤ë¥˜ê°€ ë°œìƒí•˜ë©° ì‚¬ìš©ìë¥¼ ë“±ë¡í•˜ê±°ë‚˜ ì—´ê±°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤:
```
An error occurred (NotAuthorizedException) when calling the SignUp operation: SignUp is not permitted for this user pool
```
### Verifying Registration

CognitoëŠ” **ì´ë©”ì¼ ë˜ëŠ” ì „í™”ë²ˆí˜¸ë¥¼ í™•ì¸í•˜ì—¬ ìƒˆ ì‚¬ìš©ìë¥¼ ê²€ì¦**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë”°ë¼ì„œ ì‚¬ìš©ìë¥¼ ìƒì„±í•  ë•Œ ì¼ë°˜ì ìœ¼ë¡œ ìµœì†Œí•œ ì‚¬ìš©ì ì´ë¦„ê³¼ ë¹„ë°€ë²ˆí˜¸, ê·¸ë¦¬ê³  **ì´ë©”ì¼ ë°/ë˜ëŠ” ì „í™”ë²ˆí˜¸**ê°€ í•„ìš”í•©ë‹ˆë‹¤. **ì œì–´í•  ìˆ˜ ìˆëŠ”** í•˜ë‚˜ë¥¼ ì„¤ì •í•˜ì—¬ ìƒˆë¡œ ìƒì„±ëœ ì‚¬ìš©ì **ê³„ì •ì„** ë‹¤ìŒê³¼ ê°™ì´ **ê²€ì¦**í•  ìˆ˜ ìˆëŠ” ì½”ë“œë¥¼ ë°›ê²Œ ë©ë‹ˆë‹¤:
```bash
aws cognito-idp confirm-sign-up --client-id <cliet_id> \
--username aasdasd2 --confirmation-code <conf_code> \
--no-sign-request --region us-east-1
```
{% hint style="warning" %}
**ê°™ì€ ì´ë©”ì¼**ê³¼ ì „í™”ë²ˆí˜¸ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆì„ ê²ƒì²˜ëŸ¼ ë³´ì´ë”ë¼ë„, ìƒì„±ëœ ì‚¬ìš©ìë¥¼ í™•ì¸í•´ì•¼ í•  ë•Œ CognitoëŠ” ë™ì¼í•œ ì •ë³´ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì— ëŒ€í•´ ë¶ˆí‰í•˜ë©° **ê³„ì •ì„ í™•ì¸í•  ìˆ˜ ì—†ê²Œ í•©ë‹ˆë‹¤**.
{% endhint %}

### Privilege Escalation / Updating Attributes

ê¸°ë³¸ì ìœ¼ë¡œ ì‚¬ìš©ìëŠ” ë‹¤ìŒê³¼ ê°™ì´ **ìì‹ ì˜ ì†ì„± ê°’ì„ ìˆ˜ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤**:
```bash
aws cognito-idp update-user-attributes \
--region us-east-1 --no-sign-request \
--user-attributes Name=address,Value=street \
--access-token <access token>
```
#### Custom attribute privesc

{% hint style="danger" %}
**ì»¤ìŠ¤í…€ ì†ì„±**ì´ ì‚¬ìš©ë˜ê³  ìˆëŠ” ê²ƒì„ ë°œê²¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤ (ì˜ˆ: `isAdmin`). ê¸°ë³¸ì ìœ¼ë¡œ ìì‹ ì˜ ì†ì„± ê°’ì„ **ë³€ê²½í•  ìˆ˜ ìˆê¸° ë•Œë¬¸ì—** ê°’ì„ ë³€ê²½í•˜ì—¬ **ê¶Œí•œì„ ìƒìŠ¹**ì‹œí‚¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤!
{% endhint %}

#### Email/username modification privesc

ì´ë¥¼ ì‚¬ìš©í•˜ì—¬ ì‚¬ìš©ìì˜ **ì´ë©”ì¼ê³¼ ì „í™”ë²ˆí˜¸ë¥¼ ìˆ˜ì •**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ ê³„ì •ì´ ê²€ì¦ëœ ìƒíƒœë¡œ ë‚¨ì•„ ìˆë”ë¼ë„, í•´ë‹¹ ì†ì„±ì€ **ë¯¸ê²€ì¦ ìƒíƒœ**ë¡œ ì„¤ì •ë©ë‹ˆë‹¤ (ë‹¤ì‹œ ê²€ì¦í•´ì•¼ í•©ë‹ˆë‹¤).

{% hint style="warning" %}
ì´ë©”ì¼ì´ë‚˜ ì „í™”ë²ˆí˜¸ë¥¼ ê²€ì¦í•˜ê¸° ì „ê¹Œì§€ëŠ” **ì´ë©”ì¼ì´ë‚˜ ì „í™”ë²ˆí˜¸ë¡œ ë¡œê·¸ì¸í•  ìˆ˜ ì—†ì§€ë§Œ**, **ì‚¬ìš©ì ì´ë¦„ìœ¼ë¡œëŠ” ë¡œê·¸ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤**.\
ì´ë©”ì¼ì´ ìˆ˜ì •ë˜ê³  ê²€ì¦ë˜ì§€ ì•Šì•˜ë”ë¼ë„ **ID í† í°**ì˜ **`email`** **í•„ë“œ**ì— ë‚˜íƒ€ë‚˜ë©°, **`email_verified`** í•„ë“œëŠ” **false**ë¡œ ì„¤ì •ë©ë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ ì•±ì´ ì´ë¥¼ í™•ì¸í•˜ì§€ ì•ŠëŠ”ë‹¤ë©´ **ë‹¤ë¥¸ ì‚¬ìš©ìë¥¼ ê°€ì¥í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤**.

ë˜í•œ, **`name`** í•„ë“œì— **ì´ë¦„ ì†ì„±**ì„ ìˆ˜ì •í•˜ì—¬ ì•„ë¬´ ê²ƒì´ë‚˜ ë„£ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì•±ì´ **ì´ë©”ì¼** (ë˜ëŠ” ë‹¤ë¥¸ ì†ì„±) ëŒ€ì‹  **ê·¸** í•„ë“œë¥¼ **í™•ì¸**í•˜ëŠ” ê²½ìš°, **ë‹¤ë¥¸ ì‚¬ìš©ìë¥¼ ê°€ì¥í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤**.
{% endhint %}

ì–´ì¨Œë“ , ì˜ˆë¥¼ ë“¤ì–´ ìƒˆë¡œìš´ ì´ë©”ì¼ë¡œ ë³€ê²½í•œ ê²½ìš°, í•´ë‹¹ ì´ë©”ì¼ ì£¼ì†Œë¡œ ë°›ì€ ì½”ë“œë¥¼ ì‚¬ìš©í•˜ì—¬ **ì´ë©”ì¼ì„ í™•ì¸**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```bash
aws cognito-idp verify-user-attribute \
--access-token <access_token> \
--attribute-name email --code <code> \
--region <region> --no-sign-request
```
**`phone_number`**ë¥¼ **`email`** ëŒ€ì‹  ì‚¬ìš©í•˜ì—¬ **ìƒˆ ì „í™”ë²ˆí˜¸**ë¥¼ ë³€ê²½/í™•ì¸í•˜ì„¸ìš”.

{% hint style="info" %}
ê´€ë¦¬ìëŠ” **ì‚¬ìš©ìê°€ ì„ í˜¸í•˜ëŠ” ì‚¬ìš©ì ì´ë¦„ìœ¼ë¡œ ë¡œê·¸ì¸**í•˜ëŠ” ì˜µì…˜ì„ í™œì„±í™”í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤. ë‹¤ë¥¸ ì‚¬ìš©ìë¥¼ ê°€ì¥í•˜ê¸° ìœ„í•´ **ì´ë¯¸ ì‚¬ìš© ì¤‘ì¸ ì‚¬ìš©ì ì´ë¦„ ë˜ëŠ” ì„ í˜¸í•˜ëŠ” ì‚¬ìš©ì ì´ë¦„**ìœ¼ë¡œ ì´ ê°’ì„ ë³€ê²½í•  ìˆ˜ ì—†ë‹¤ëŠ” ì ì— ìœ ì˜í•˜ì„¸ìš”.
{% endhint %}

### ë¹„ë°€ë²ˆí˜¸ ë³µêµ¬/ë³€ê²½

ì‚¬ìš©ì ì´ë¦„(ë˜ëŠ” ì´ë©”ì¼ ë˜ëŠ” ì „í™”ë²ˆí˜¸ê°€ í—ˆìš©ë¨)ì„ ì•Œê³  ìˆê³  í•´ë‹¹ ì½”ë“œê°€ ì „ì†¡ë  ê³³ì— ì ‘ê·¼í•  ìˆ˜ ìˆë‹¤ë©´ ë¹„ë°€ë²ˆí˜¸ë¥¼ ë³µêµ¬í•˜ëŠ” ê²ƒì´ ê°€ëŠ¥í•©ë‹ˆë‹¤:
```bash
aws cognito-idp forgot-password \
--client-id <client_id> \
--username <username/email/phone> --region <region>
```
{% hint style="info" %}
ì„œë²„ì˜ ì‘ë‹µì€ í•­ìƒ ê¸ì •ì ì¼ ê²ƒì…ë‹ˆë‹¤. ë§ˆì¹˜ ì‚¬ìš©ìê°€ ì¡´ì¬í•˜ëŠ” ê²ƒì²˜ëŸ¼ ë³´ì…ë‹ˆë‹¤. ì´ ë°©ë²•ì„ ì‚¬ìš©í•˜ì—¬ ì‚¬ìš©ìë¥¼ ì—´ê±°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.
{% endhint %}

ì½”ë“œë¥¼ ì‚¬ìš©í•˜ì—¬ ë¹„ë°€ë²ˆí˜¸ë¥¼ ë³€ê²½í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```bash
aws cognito-idp confirm-forgot-password \
--client-id <client_id> \
--username <username> \
--confirmation-code <conf_code> \
--password <pwd> --region <region>
```
ë¹„ë°€ë²ˆí˜¸ë¥¼ ë³€ê²½í•˜ë ¤ë©´ **ì´ì „ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì•Œì•„ì•¼ í•©ë‹ˆë‹¤**:
```bash
aws cognito-idp change-password \
--previous-password <value> \
--proposed-password <value> \
--access-token <value>
```
## Authentication

ì‚¬ìš©ì í’€ì€ **ë‹¤ì–‘í•œ ì¸ì¦ ë°©ë²•**ì„ ì§€ì›í•©ë‹ˆë‹¤. **ì‚¬ìš©ì ì´ë¦„ê³¼ ë¹„ë°€ë²ˆí˜¸**ê°€ ìˆëŠ” ê²½ìš°ì—ë„ **ë‹¤ì–‘í•œ ë¡œê·¸ì¸ ë°©ë²•**ì´ ì§€ì›ë©ë‹ˆë‹¤.\
ë˜í•œ, ì‚¬ìš©ìê°€ í’€ì—ì„œ ì¸ì¦ë˜ë©´ **3ê°€ì§€ ìœ í˜•ì˜ í† í°ì´ ì œê³µ**ë©ë‹ˆë‹¤: **ID í† í°**, **ì•¡ì„¸ìŠ¤ í† í°** ë° **ë¦¬í”„ë ˆì‹œ í† í°**.

* [**ID Token**](https://docs.aws.amazon.com/cognito/latest/developerguide/amazon-cognito-user-pools-using-the-id-token.html): **ì¸ì¦ëœ ì‚¬ìš©ìì˜ ì‹ ì›**ì— ëŒ€í•œ í´ë ˆì„ì„ í¬í•¨í•©ë‹ˆë‹¤, ì˜ˆë¥¼ ë“¤ì–´ `name`, `email`, `phone_number` ë“±ì´ ìˆìŠµë‹ˆë‹¤. ID í† í°ì€ **ë¦¬ì†ŒìŠ¤ ì„œë²„ë‚˜ ì„œë²„ ì• í”Œë¦¬ì¼€ì´ì…˜ì— ì‚¬ìš©ìë¥¼ ì¸ì¦**í•˜ëŠ” ë° ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì™¸ë¶€ ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ ID í† í°ì„ ì‚¬ìš©í•  ê²½ìš°, ID í† í° ë‚´ë¶€ì˜ í´ë ˆì„ì„ ì‹ ë¢°í•˜ê¸° ì „ì— **ID í† í°ì˜ ì„œëª…ì„ ê²€ì¦**í•´ì•¼ í•©ë‹ˆë‹¤.
* ID í† í°ì€ **ì‚¬ìš©ìì˜ ì†ì„± ê°’ì„ í¬í•¨**í•˜ëŠ” í† í°ì…ë‹ˆë‹¤, ì‚¬ìš©ì ì •ì˜ ì†ì„±ê¹Œì§€ë„ í¬í•¨ë©ë‹ˆë‹¤.
* [**Access Token**](https://docs.aws.amazon.com/cognito/latest/developerguide/amazon-cognito-user-pools-using-the-access-token.html): ì¸ì¦ëœ ì‚¬ìš©ìì— ëŒ€í•œ í´ë ˆì„, **ì‚¬ìš©ì ê·¸ë£¹ ëª©ë¡ ë° ë²”ìœ„ ëª©ë¡**ì„ í¬í•¨í•©ë‹ˆë‹¤. ì•¡ì„¸ìŠ¤ í† í°ì˜ ëª©ì ì€ ì‚¬ìš©ì í’€ ë‚´ì—ì„œ **API ì‘ì—…ì„ ìŠ¹ì¸**í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´, ì•¡ì„¸ìŠ¤ í† í°ì„ ì‚¬ìš©í•˜ì—¬ ì‚¬ìš©ìê°€ ì‚¬ìš©ì ì†ì„±ì„ ì¶”ê°€, ë³€ê²½ ë˜ëŠ” ì‚­ì œí•  ìˆ˜ ìˆëŠ” **ê¶Œí•œì„ ë¶€ì—¬**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
* [**Refresh Token**](https://docs.aws.amazon.com/cognito/latest/developerguide/amazon-cognito-user-pools-using-the-refresh-token.html): ë¦¬í”„ë ˆì‹œ í† í°ì„ ì‚¬ìš©í•˜ë©´ **ìƒˆë¡œìš´ ID í† í° ë° ì•¡ì„¸ìŠ¤ í† í°ì„** ë¦¬í”„ë ˆì‹œ í† í°ì´ **ìœ íš¨í•˜ì§€ ì•Šì„ ë•Œê¹Œì§€** ì–»ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. **ê¸°ë³¸ì ìœ¼ë¡œ**, ë¦¬í”„ë ˆì‹œ í† í°ì€ **ì‚¬ìš©ìê°€ ì‚¬ìš©ì í’€ì— ë¡œê·¸ì¸í•œ í›„ 30ì¼ í›„ì— ë§Œë£Œ**ë©ë‹ˆë‹¤. ì‚¬ìš©ì í’€ì— ëŒ€í•œ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ë§Œë“¤ ë•Œ, ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ë¦¬í”„ë ˆì‹œ í† í° ë§Œë£Œ ì‹œê°„ì„ **60ë¶„ì—ì„œ 10ë…„ ì‚¬ì´ì˜ ê°’ìœ¼ë¡œ ì„¤ì •**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### ADMIN\_NO\_SRP\_AUTH & ADMIN\_USER\_PASSWORD\_AUTH

ì´ê²ƒì€ ì„œë²„ ì¸¡ ì¸ì¦ íë¦„ì…ë‹ˆë‹¤:

* ì„œë²„ ì¸¡ ì•±ì´ **`AdminInitiateAuth` API ì‘ì—…**ì„ í˜¸ì¶œí•©ë‹ˆë‹¤ (`InitiateAuth` ëŒ€ì‹ ). ì´ ì‘ì—…ì€ **`cognito-idp:AdminInitiateAuth`** ë° **`cognito-idp:AdminRespondToAuthChallenge`** ê¶Œí•œì„ í¬í•¨í•˜ëŠ” AWS ìê²© ì¦ëª…ì´ í•„ìš”í•©ë‹ˆë‹¤. ì´ ì‘ì—…ì€ í•„ìš”í•œ ì¸ì¦ ë§¤ê°œë³€ìˆ˜ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤.
* ì„œë²„ ì¸¡ ì•±ì´ **ì¸ì¦ ë§¤ê°œë³€ìˆ˜**ë¥¼ ì–»ì€ í›„, **`AdminRespondToAuthChallenge` API ì‘ì—…**ì„ í˜¸ì¶œí•©ë‹ˆë‹¤. `AdminRespondToAuthChallenge` API ì‘ì—…ì€ AWS ìê²© ì¦ëª…ì„ ì œê³µí•  ë•Œë§Œ ì„±ê³µí•©ë‹ˆë‹¤.

ì´ **ë°©ë²•ì€ ê¸°ë³¸ì ìœ¼ë¡œ í™œì„±í™”ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤**.

**ë¡œê·¸ì¸**í•˜ë ¤ë©´ ë‹¤ìŒì´ **í•„ìš”**í•©ë‹ˆë‹¤:

* ì‚¬ìš©ì í’€ ID
* í´ë¼ì´ì–¸íŠ¸ ID
* ì‚¬ìš©ì ì´ë¦„
* ë¹„ë°€ë²ˆí˜¸
* í´ë¼ì´ì–¸íŠ¸ ë¹„ë°€ (ì•±ì´ ë¹„ë°€ì„ ì‚¬ìš©í•˜ë„ë¡ êµ¬ì„±ëœ ê²½ìš°ì—ë§Œ)

{% hint style="info" %}
ì´ ë°©ë²•ìœ¼ë¡œ **ë¡œê·¸ì¸í•  ìˆ˜ ìˆìœ¼ë ¤ë©´** ì• í”Œë¦¬ì¼€ì´ì…˜ì´ `ALLOW_ADMIN_USER_PASSWORD_AUTH`ë¡œ ë¡œê·¸ì¸í•  ìˆ˜ ìˆì–´ì•¼ í•©ë‹ˆë‹¤.\
ë˜í•œ, ì´ ì‘ì—…ì„ ìˆ˜í–‰í•˜ë ¤ë©´ **`cognito-idp:AdminInitiateAuth`** ë° **`cognito-idp:AdminRespondToAuthChallenge`** ê¶Œí•œì´ ìˆëŠ” ìê²© ì¦ëª…ì´ í•„ìš”í•©ë‹ˆë‹¤.
{% endhint %}
```python
aws cognito-idp admin-initiate-auth \
--client-id <client-id> \
--auth-flow ADMIN_USER_PASSWORD_AUTH \
--region <region> \
--auth-parameters 'USERNAME=<username>,PASSWORD=<password>,SECRET_HASH=<hash_if_needed>'
--user-pool-id "<pool-id>"

# Check the python code to learn how to generate the hsecret_hash
```
<details>

<summary>ë¡œê·¸ì¸ ì½”ë“œ</summary>
```python
import boto3
import botocore
import hmac
import hashlib
import base64


client_id = "<client-id>"
user_pool_id = "<user-pool-id>"
client_secret = "<client-secret>"
username = "<username>"
password = "<pwd>"

boto_client = boto3.client('cognito-idp', region_name='us-east-1')

def get_secret_hash(username, client_id, client_secret):
key = bytes(client_secret, 'utf-8')
message = bytes(f'{username}{client_id}', 'utf-8')
return base64.b64encode(hmac.new(key, message, digestmod=hashlib.sha256).digest()).decode()

# If the Client App isn't configured to use a secret
## just delete the line setting the SECRET_HASH
def login_user(username_or_alias, password, client_id, client_secret, user_pool_id):
try:
return boto_client.admin_initiate_auth(
UserPoolId=user_pool_id,
ClientId=client_id,
AuthFlow='ADMIN_USER_PASSWORD_AUTH',
AuthParameters={
'USERNAME': username_or_alias,
'PASSWORD': password,
'SECRET_HASH': get_secret_hash(username_or_alias, client_id, client_secret)
}
)
except botocore.exceptions.ClientError as e:
return e.response

print(login_user(username, password, client_id, client_secret, user_pool_id))
```
</details>

### USER\_PASSWORD\_AUTH

ì´ ë°©ë²•ì€ ë˜ ë‹¤ë¥¸ ê°„ë‹¨í•˜ê³  **ì „í†µì ì¸ ì‚¬ìš©ì & ë¹„ë°€ë²ˆí˜¸ ì¸ì¦** íë¦„ì…ë‹ˆë‹¤. **ì „í†µì ì¸** ì¸ì¦ ë°©ë²•ì„ **Cognitoë¡œ ë§ˆì´ê·¸ë ˆì´ì…˜**í•˜ê³ , ê·¸ í›„ì— ì´ë¥¼ **ë¹„í™œì„±í™”**í•˜ê³  **ALLOW\_USER\_SRP\_AUTH** ë°©ë²•ì„ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ **ê¶Œì¥**ë©ë‹ˆë‹¤ (ì´ ë°©ë²•ì€ ë¹„ë°€ë²ˆí˜¸ë¥¼ ë„¤íŠ¸ì›Œí¬ë¥¼ í†µí•´ ì „ì†¡í•˜ì§€ ì•Šê¸° ë•Œë¬¸ì…ë‹ˆë‹¤).\
ì´ **ë°©ë²•ì€ ê¸°ë³¸ì ìœ¼ë¡œ í™œì„±í™”ë˜ì–´ ìˆì§€ ì•ŠìŠµë‹ˆë‹¤**.

ì½”ë“œ ë‚´ì—ì„œ **ì´ì „ ì¸ì¦ ë°©ë²•**ê³¼ì˜ **ì£¼ìš” ì°¨ì´ì **ì€ **ì‚¬ìš©ì í’€ IDë¥¼ ì•Œ í•„ìš”ê°€ ì—†ê³ **, Cognito ì‚¬ìš©ì í’€ì—ì„œ **ì¶”ê°€ ê¶Œí•œì´ í•„ìš”í•˜ì§€ ì•Šë‹¤ëŠ” ê²ƒ**ì…ë‹ˆë‹¤.

**ë¡œê·¸ì¸**í•˜ë ¤ë©´ ë‹¤ìŒì„ **ì•Œì•„ì•¼ í•©ë‹ˆë‹¤**:

* client id
* username
* password
* client secret (ì•±ì´ ë¹„ë°€ì„ ì‚¬ìš©í•˜ë„ë¡ êµ¬ì„±ëœ ê²½ìš°ì—ë§Œ)

{% hint style="info" %}
ì´ ë°©ë²•ìœ¼ë¡œ **ë¡œê·¸ì¸í•  ìˆ˜ ìˆìœ¼ë ¤ë©´** í•´ë‹¹ ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ALLOW\_USER\_PASSWORD\_AUTHë¡œ ë¡œê·¸ì¸í•  ìˆ˜ ìˆë„ë¡ í—ˆìš©í•´ì•¼ í•©ë‹ˆë‹¤.
{% endhint %}
```python
aws cognito-idp initiate-auth  --client-id <client-id> \
--auth-flow USER_PASSWORD_AUTH --region <region> \
--auth-parameters 'USERNAME=<username>,PASSWORD=<password>,SECRET_HASH=<hash_if_needed>'

# Check the python code to learn how to generate the secret_hash
```
<details>

<summary>ë¡œê·¸ì¸í•˜ëŠ” Python ì½”ë“œ</summary>
```python
import boto3
import botocore
import hmac
import hashlib
import base64


client_id = "<client-id>"
user_pool_id = "<user-pool-id>"
client_secret = "<client-secret>"
username = "<username>"
password = "<pwd>"

boto_client = boto3.client('cognito-idp', region_name='us-east-1')

def get_secret_hash(username, client_id, client_secret):
key = bytes(client_secret, 'utf-8')
message = bytes(f'{username}{client_id}', 'utf-8')
return base64.b64encode(hmac.new(key, message, digestmod=hashlib.sha256).digest()).decode()

# If the Client App isn't configured to use a secret
## just delete the line setting the SECRET_HASH
def login_user(username_or_alias, password, client_id, client_secret, user_pool_id):
try:
return boto_client.initiate_auth(
ClientId=client_id,
AuthFlow='ADMIN_USER_PASSWORD_AUTH',
AuthParameters={
'USERNAME': username_or_alias,
'PASSWORD': password,
'SECRET_HASH': get_secret_hash(username_or_alias, client_id, client_secret)
}
)
except botocore.exceptions.ClientError as e:
return e.response

print(login_user(username, password, client_id, client_secret, user_pool_id))
```
</details>

### USER\_SRP\_AUTH

ì´ ì‹œë‚˜ë¦¬ì˜¤ëŠ” ì´ì „ ê²ƒê³¼ ìœ ì‚¬í•˜ì§€ë§Œ **ë¹„ë°€ë²ˆí˜¸ë¥¼ ë„¤íŠ¸ì›Œí¬ë¥¼ í†µí•´ ë³´ë‚´ëŠ” ëŒ€ì‹ ** **ì±Œë¦°ì§€ ì¸ì¦ì´ ìˆ˜í–‰**ë©ë‹ˆë‹¤ (ë”°ë¼ì„œ ë¹„ë°€ë²ˆí˜¸ê°€ ì•”í˜¸í™”ë˜ì–´ ë„¤íŠ¸ì›Œí¬ë¥¼ í†µí•´ ì´ë™í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤).\
ì´ **ë°©ë²•ì€ ê¸°ë³¸ì ìœ¼ë¡œ í™œì„±í™”**ë˜ì–´ ìˆìŠµë‹ˆë‹¤.

**ë¡œê·¸ì¸**í•˜ë ¤ë©´ ë‹¤ìŒì„ **ì•Œì•„ì•¼** í•©ë‹ˆë‹¤:

* user pool id
* client id
* username
* password
* client secret (ì•±ì´ secretì„ ì‚¬ìš©í•˜ë„ë¡ êµ¬ì„±ëœ ê²½ìš°ì—ë§Œ)

<details>

<summary>ë¡œê·¸ì¸ ì½”ë“œ</summary>
```python
from warrant.aws_srp import AWSSRP
import os

USERNAME='xxx'
PASSWORD='yyy'
POOL_ID='us-east-1_zzzzz'
CLIENT_ID = '12xxxxxxxxxxxxxxxxxxxxxxx'
CLIENT_SECRET = 'secreeeeet'
os.environ["AWS_DEFAULT_REGION"] = "<region>"

aws = AWSSRP(username=USERNAME, password=PASSWORD, pool_id=POOL_ID,
client_id=CLIENT_ID, client_secret=CLIENT_SECRET)
tokens = aws.authenticate_user()
id_token = tokens['AuthenticationResult']['IdToken']
refresh_token = tokens['AuthenticationResult']['RefreshToken']
access_token = tokens['AuthenticationResult']['AccessToken']
token_type = tokens['AuthenticationResult']['TokenType']
```
</details>

### REFRESH\_TOKEN\_AUTH & REFRESH\_TOKEN

ì´ **ë°©ë²•ì€ í•­ìƒ ìœ íš¨**í•©ë‹ˆë‹¤ (ë¹„í™œì„±í™”í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤) í•˜ì§€ë§Œ ìœ íš¨í•œ refresh tokenì´ í•„ìš”í•©ë‹ˆë‹¤.
```bash
aws cognito-idp initiate-auth \
--client-id 3ig6h5gjm56p1ljls1prq2miut \
--auth-flow REFRESH_TOKEN_AUTH \
--region us-east-1 \
--auth-parameters 'REFRESH_TOKEN=<token>'
```
<details>

<summary>ì½”ë“œ ìƒˆë¡œ ê³ ì¹¨</summary>
```python
import boto3
import botocore
import hmac
import hashlib
import base64

client_id = "<client-id>"
token = '<token>'

boto_client = boto3.client('cognito-idp', region_name='<region>')

def refresh(client_id, refresh_token):
try:
return boto_client.initiate_auth(
ClientId=client_id,
AuthFlow='REFRESH_TOKEN_AUTH',
AuthParameters={
'REFRESH_TOKEN': refresh_token
}
)
except botocore.exceptions.ClientError as e:
return e.response


print(refresh(client_id, token))
```
</details>

### CUSTOM\_AUTH

ì´ ê²½ìš° **ì¸ì¦**ì€ **ëŒë‹¤ í•¨ìˆ˜ ì‹¤í–‰**ì„ í†µí•´ ìˆ˜í–‰ë©ë‹ˆë‹¤.

## ì¶”ê°€ ë³´ì•ˆ

### ê³ ê¸‰ ë³´ì•ˆ

ê¸°ë³¸ì ìœ¼ë¡œ ë¹„í™œì„±í™”ë˜ì–´ ìˆì§€ë§Œ, í™œì„±í™”í•˜ë©´ CognitoëŠ” **ê³„ì • íƒˆì·¨ë¥¼ ë°œê²¬**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. í™•ë¥ ì„ ìµœì†Œí™”í•˜ë ¤ë©´ **ê°™ì€ ë„ì‹œ ë‚´ì˜ ë„¤íŠ¸ì›Œí¬ì—ì„œ ë™ì¼í•œ ì‚¬ìš©ì ì—ì´ì „íŠ¸**(ê°€ëŠ¥í•˜ë©´ IPë„ ì‚¬ìš©)ë¡œ ë¡œê·¸ì¸í•´ì•¼ í•©ë‹ˆë‹¤.

### **MFA ì¥ì¹˜ ê¸°ì–µ**

ì‚¬ìš©ìê°€ ë™ì¼í•œ ì¥ì¹˜ì—ì„œ ë¡œê·¸ì¸í•˜ë©´ MFAê°€ ìš°íšŒë  ìˆ˜ ìˆìœ¼ë¯€ë¡œ, ë™ì¼í•œ ë¸Œë¼ìš°ì €ì™€ ë™ì¼í•œ ë©”íƒ€ë°ì´í„°(IP?)ë¥¼ ì‚¬ìš©í•˜ì—¬ ë¡œê·¸ì¸í•˜ì—¬ MFA ë³´í˜¸ë¥¼ ìš°íšŒí•´ ë³´ì‹­ì‹œì˜¤.

## ì‚¬ìš©ì í’€ ê·¸ë£¹ IAM ì—­í• 

**IAM ì—­í• **ê³¼ ê´€ë ¨ëœ **ì‚¬ìš©ì í’€** ê·¸ë£¹ì— **ì‚¬ìš©ìë¥¼ ì¶”ê°€**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\
ë˜í•œ, **ì‚¬ìš©ì**ëŠ” **ë‹¤ë¥¸ IAM ì—­í• **ì´ ì²¨ë¶€ëœ **1ê°œ ì´ìƒì˜ ê·¸ë£¹**ì— í• ë‹¹ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ê·¸ë£¹ì´ IAM ì—­í• ì´ ì²¨ë¶€ëœ ê·¸ë£¹ ë‚´ì— ìˆë”ë¼ë„, í•´ë‹¹ ê·¸ë£¹ì˜ IAM ìê²© ì¦ëª…ì— ì ‘ê·¼í•˜ë ¤ë©´ **ì‚¬ìš©ì í’€ì´ ì‹ ì› í’€ì— ì˜í•´ ì‹ ë¢°ë°›ì•„ì•¼** í•©ë‹ˆë‹¤(ê·¸ë¦¬ê³  í•´ë‹¹ ì‹ ì› í’€ì˜ ì„¸ë¶€ ì •ë³´ë¥¼ ì•Œì•„ì•¼ í•©ë‹ˆë‹¤).

ì‚¬ìš©ìê°€ ì‚¬ìš©ì í’€ì—ì„œ ì¸ì¦ë  ë•Œ(`aws cognito-idp initiate-auth...`) **IdTokenì— ëª…ì‹œëœ IAM ì—­í• **ì„ ì–»ê¸° ìœ„í•œ ë˜ ë‹¤ë¥¸ ìš”ê±´ì€ **Identity Provider Authentication provider**ê°€ **í† í°ì—ì„œ ì—­í• ì„ ì„ íƒí•´ì•¼ í•œë‹¤ê³  ëª…ì‹œ**í•´ì•¼ í•œë‹¤ëŠ” ê²ƒì…ë‹ˆë‹¤.

<figure><img src="../../../../.gitbook/assets/image (250).png" alt=""><figcaption></figcaption></figure>

ì‚¬ìš©ìê°€ ì ‘ê·¼í•  ìˆ˜ ìˆëŠ” **ì—­í• **ì€ **`IdToken` ë‚´ì—** ìˆìœ¼ë©°, ì‚¬ìš©ìëŠ” **`aws cognito-identity get-credentials-for-identity`ì˜ `--custom-role-arn`**ì„ ì‚¬ìš©í•˜ì—¬ **ìê²© ì¦ëª…ì„ ì›í•˜ëŠ” ì—­í• ì„ ì„ íƒ**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\
ê·¸ëŸ¬ë‚˜ **ê¸°ë³¸ ì˜µì…˜**ì´ **êµ¬ì„±ëœ**(`ê¸°ë³¸ ì—­í•  ì‚¬ìš©`) ìƒíƒœì—ì„œ IdTokenì˜ ì—­í• ì— ì ‘ê·¼í•˜ë ¤ê³  í•˜ë©´ **ì˜¤ë¥˜**ê°€ ë°œìƒí•©ë‹ˆë‹¤(ë”°ë¼ì„œ ì´ì „ êµ¬ì„±ì´ í•„ìš”í•©ë‹ˆë‹¤):

{% code overflow="wrap" %}
```
An error occurred (InvalidParameterException) when calling the GetCredentialsForIdentity operation: Only SAML providers and providers with RoleMappings support custom role ARN.
```
{% endcode %}

{% hint style="warning" %}
**User Pool Group**ì— í• ë‹¹ëœ ì—­í• ì€ **User Poolì„ ì‹ ë¢°í•˜ëŠ” Identity Provider**ê°€ **ì•¡ì„¸ìŠ¤í•  ìˆ˜ ìˆì–´ì•¼ í•©ë‹ˆë‹¤** (IAM ì—­í•  **ì„¸ì…˜ ìê²© ì¦ëª…ì€ ì—¬ê¸°ì„œ ì–»ì–´ì§ˆ ê²ƒì…ë‹ˆë‹¤**).
{% endhint %}
```json
{
"Version": "2012-10-17",
"Statement": [
{
"Effect": "Allow",
"Principal": {
"Federated": "cognito-identity.amazonaws.com"
},
"Action": "sts:AssumeRoleWithWebIdentity",
"Condition": {
"StringEquals": {
"cognito-identity.amazonaws.com:aud": "us-east-1:2361092e-9db6-a876-1027-10387c9de439"
},
"ForAnyValue:StringLike": {
"cognito-identity.amazonaws.com:amr": "authenticated"
}
}
}
]
}js
```
{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* [**êµ¬ë… í”Œëœ**](https://github.com/sponsors/carlospolop)ì„ í™•ì¸í•˜ì„¸ìš”!
* ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**telegram ê·¸ë£¹**](https://t.me/peass)ì— ê°€ì…í•˜ê±°ë‚˜ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)ë¥¼ íŒ”ë¡œìš°í•˜ì„¸ìš”.
* PRì„ ì œì¶œí•˜ì—¬ [**HackTricks**](https://github.com/carlospolop/hacktricks) ë° [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ì €ì¥ì†Œì— í•´í‚¹ íŠ¸ë¦­ì„ ê³µìœ í•˜ì„¸ìš”.

</details>
{% endhint %}
