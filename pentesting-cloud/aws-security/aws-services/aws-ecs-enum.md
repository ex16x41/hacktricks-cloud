# AWS - ECS Enum

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## ECS

### Informaci√≥n B√°sica

Amazon **Elastic Container Services** o ECS proporciona una plataforma para **alojar aplicaciones en contenedores en la nube**. ECS tiene dos **m√©todos de implementaci√≥n**, tipo de instancia **EC2** y una opci√≥n **sin servidor**, **Fargate**. El servicio **hace que ejecutar contenedores en la nube sea muy f√°cil y sin complicaciones**.

ECS opera utilizando los siguientes tres bloques de construcci√≥n: **Clusters**, **Services** y **Task Definitions**.

* **Clusters** son **grupos de contenedores** que se est√°n ejecutando en la nube. Como se mencion√≥ anteriormente, hay dos tipos de lanzamiento para contenedores, EC2 y Fargate. AWS define el tipo de lanzamiento **EC2** como permitir a los clientes ‚Äúejecutar \[sus] aplicaciones en contenedores en un cl√∫ster de instancias de Amazon EC2 que \[ellos] **gestionan**‚Äù. **Fargate** es similar y se define como ‚Äú\[permitiendo] ejecutar sus aplicaciones en contenedores **sin necesidad de aprovisionar y gestionar** la infraestructura de backend‚Äù.
* **Services** se crean dentro de un cl√∫ster y son responsables de **ejecutar las tareas**. Dentro de una definici√≥n de servicio **se define el n√∫mero de tareas a ejecutar, escalado autom√°tico, proveedor de capacidad (Fargate/EC2/Externo),** informaci√≥n de **red** como VPC, subredes y grupos de seguridad.
* Hay **2 tipos de aplicaciones**:
* **Service**: Un grupo de tareas que manejan un trabajo computacional de larga duraci√≥n que puede ser detenido y reiniciado. Por ejemplo, una aplicaci√≥n web.
* **Task**: Una tarea independiente que se ejecuta y termina. Por ejemplo, un trabajo por lotes.
* Entre las aplicaciones de servicio, hay **2 tipos de programadores de servicio**:
* [**REPLICA**](https://docs.aws.amazon.com/AmazonECS/latest/developerguide/ecs_services.html): La estrategia de programaci√≥n de r√©plicas coloca y **mantiene el n√∫mero deseado** de tareas en su cl√∫ster. Si por alguna raz√≥n una tarea se apaga, se lanza una nueva en el mismo o diferente nodo.
* [**DAEMON**](https://docs.aws.amazon.com/AmazonECS/latest/developerguide/ecs_services.html): Despliega exactamente una tarea en cada instancia de contenedor activa que tenga los requisitos necesarios. No es necesario especificar un n√∫mero deseado de tareas, una estrategia de colocaci√≥n de tareas, o usar pol√≠ticas de escalado autom√°tico de servicios.
* **Task Definitions** son responsables de **definir qu√© contenedores se ejecutar√°n** y los varios par√°metros que se configurar√°n con los contenedores, como **mapeos de puertos** con el host, **variables de entorno**, **entrypoint** de Docker...
* ¬°Verifique **variables de entorno para informaci√≥n sensible**!

### Datos Sensibles en Definiciones de Tareas

Las definiciones de tareas son responsables de **configurar los contenedores reales que se ejecutar√°n en ECS**. Dado que las definiciones de tareas definen c√≥mo se ejecutar√°n los contenedores, se puede encontrar una gran cantidad de informaci√≥n dentro.

Pacu puede enumerar ECS (list-clusters, list-container-instances, list-services, list-task-definitions), tambi√©n puede volcar definiciones de tareas.

### Enumeraci√≥n
```bash
# Clusters info
aws ecs list-clusters
aws ecs describe-clusters --clusters <cluster>

# Container instances
## An Amazon ECS container instance is an Amazon EC2 instance that is running the Amazon ECS container agent and has been registered into an Amazon ECS cluster.
aws ecs list-container-instances --cluster <cluster>
aws ecs describe-container-instances --cluster <cluster> --container-instances <container_instance_arn>

# Services info
aws ecs list-services --cluster <cluster>
aws ecs describe-services --cluster <cluster> --services <services>
aws ecs describe-task-sets --cluster <cluster> --service <service>

# Task definitions
aws ecs list-task-definition-families
aws ecs list-task-definitions
aws ecs list-tasks --cluster <cluster>
aws ecs describe-tasks --cluster <cluster> --tasks <tasks>
## Look for env vars and secrets used from the task definition
aws ecs describe-task-definition --task-definition <TASK_NAME>:<VERSION>
```
### Acceso No Autenticado

{% content-ref url="../aws-unauthenticated-enum-access/aws-ecs-unauthenticated-enum.md" %}
[aws-ecs-unauthenticated-enum.md](../aws-unauthenticated-enum-access/aws-ecs-unauthenticated-enum.md)
{% endcontent-ref %}

### Escalaci√≥n de Privilegios

En la siguiente p√°gina puedes verificar c√≥mo **abusar de los permisos de ECS para escalar privilegios**:

{% content-ref url="../aws-privilege-escalation/aws-ecs-privesc.md" %}
[aws-ecs-privesc.md](../aws-privilege-escalation/aws-ecs-privesc.md)
{% endcontent-ref %}

### Post Explotaci√≥n

{% content-ref url="../aws-post-exploitation/aws-ecs-post-exploitation.md" %}
[aws-ecs-post-exploitation.md](../aws-post-exploitation/aws-ecs-post-exploitation.md)
{% endcontent-ref %}

### Persistencia

{% content-ref url="../aws-persistence/aws-ecs-persistence.md" %}
[aws-ecs-persistence.md](../aws-persistence/aws-ecs-persistence.md)
{% endcontent-ref %}

{% hint style="success" %}
Aprende y practica Hacking en AWS:<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
Aprende y practica Hacking en GCP: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Apoya a HackTricks</summary>

* Revisa los [**planes de suscripci√≥n**](https://github.com/sponsors/carlospolop)!
* **√önete al** üí¨ [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s√≠guenos** en **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Comparte trucos de hacking enviando PRs a los** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repos de github.

</details>
{% endhint %}
