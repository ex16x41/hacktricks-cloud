# AWS - ECS Enum

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## ECS

### Informations de base

Amazon **Elastic Container Services** ou ECS fournit une plateforme pour **h√©berger des applications conteneuris√©es dans le cloud**. ECS a deux m√©thodes de **d√©ploiement**, le type d'instance **EC2** et une option **sans serveur**, **Fargate**. Le service **facilite grandement l'ex√©cution de conteneurs dans le cloud**.

ECS fonctionne en utilisant les trois √©l√©ments de base suivants : **Clusters**, **Services** et **D√©finitions de t√¢ches**.

* **Clusters** sont des **groupes de conteneurs** qui s'ex√©cutent dans le cloud. Comme mentionn√© pr√©c√©demment, il existe deux types de lancement pour les conteneurs, EC2 et Fargate. AWS d√©finit le type de lancement **EC2** comme permettant aux clients ‚Äúd'ex√©cuter \[leurs] applications conteneuris√©es sur un cluster d'instances Amazon EC2 que \[ils] **g√®rent**‚Äù. **Fargate** est similaire et est d√©fini comme ‚Äú\[permettant] d'ex√©cuter vos applications conteneuris√©es **sans avoir besoin de provisionner et de g√©rer** l'infrastructure backend‚Äù.
* **Services** sont cr√©√©s √† l'int√©rieur d'un cluster et sont responsables de **l'ex√©cution des t√¢ches**. Dans une d√©finition de service, **vous d√©finissez le nombre de t√¢ches √† ex√©cuter, l'auto-scaling, le fournisseur de capacit√© (Fargate/EC2/Externe),** les informations de **r√©seau** telles que les VPC, sous-r√©seaux et groupes de s√©curit√©.
* Il y a **2 types d'applications** :
* **Service** : Un groupe de t√¢ches g√©rant un travail informatique de longue dur√©e qui peut √™tre arr√™t√© et red√©marr√©. Par exemple, une application web.
* **T√¢che** : Une t√¢che autonome qui s'ex√©cute et se termine. Par exemple, un travail par lots.
* Parmi les applications de service, il y a **2 types de planificateurs de service** :
* [**REPLICA**](https://docs.aws.amazon.com/AmazonECS/latest/developerguide/ecs\_services.html) : La strat√©gie de planification des r√©pliques place et **maintient le nombre d√©sir√©** de t√¢ches dans votre cluster. Si pour une raison quelconque une t√¢che s'arr√™te, une nouvelle est lanc√©e sur le m√™me ou un autre n≈ìud.
* [**DAEMON**](https://docs.aws.amazon.com/AmazonECS/latest/developerguide/ecs\_services.html) : D√©ploie exactement une t√¢che sur chaque instance de conteneur active qui a les exigences n√©cessaires. Il n'est pas n√©cessaire de sp√©cifier un nombre d√©sir√© de t√¢ches, une strat√©gie de placement de t√¢ches, ou d'utiliser des politiques d'auto-scaling de service.
* **D√©finitions de t√¢ches** sont responsables de **d√©finir quels conteneurs seront ex√©cut√©s** et les divers param√®tres qui seront configur√©s avec les conteneurs tels que **mappages de ports** avec l'h√¥te, **variables d'environnement**, Docker **entrypoint**...
* V√©rifiez **les variables d'environnement pour des informations sensibles** !

### Donn√©es sensibles dans les d√©finitions de t√¢ches

Les d√©finitions de t√¢ches sont responsables de **configurer les conteneurs r√©els qui seront ex√©cut√©s dans ECS**. √âtant donn√© que les d√©finitions de t√¢ches d√©finissent comment les conteneurs s'ex√©cuteront, une pl√©thore d'informations peut y √™tre trouv√©e.

Pacu peut √©num√©rer ECS (list-clusters, list-container-instances, list-services, list-task-definitions), il peut √©galement extraire les d√©finitions de t√¢ches.

### √ânum√©ration
```bash
# Clusters info
aws ecs list-clusters
aws ecs describe-clusters --clusters <cluster>

# Container instances
## An Amazon ECS container instance is an Amazon EC2 instance that is running the Amazon ECS container agent and has been registered into an Amazon ECS cluster.
aws ecs list-container-instances --cluster <cluster>
aws ecs describe-container-instances --cluster <cluster> --container-instances <container_instance_arn>

# Services info
aws ecs list-services --cluster <cluster>
aws ecs describe-services --cluster <cluster> --services <services>
aws ecs describe-task-sets --cluster <cluster> --service <service>

# Task definitions
aws ecs list-task-definition-families
aws ecs list-task-definitions
aws ecs list-tasks --cluster <cluster>
aws ecs describe-tasks --cluster <cluster> --tasks <tasks>
## Look for env vars and secrets used from the task definition
aws ecs describe-task-definition --task-definition <TASK_NAME>:<VERSION>
```
### Acc√®s non authentifi√©

{% content-ref url="../aws-unauthenticated-enum-access/aws-ecs-unauthenticated-enum.md" %}
[aws-ecs-unauthenticated-enum.md](../aws-unauthenticated-enum-access/aws-ecs-unauthenticated-enum.md)
{% endcontent-ref %}

### Privesc

Dans la page suivante, vous pouvez v√©rifier comment **abuser des permissions ECS pour √©lever les privil√®ges** :

{% content-ref url="../aws-privilege-escalation/aws-ecs-privesc.md" %}
[aws-ecs-privesc.md](../aws-privilege-escalation/aws-ecs-privesc.md)
{% endcontent-ref %}

### Post Exploitation

{% content-ref url="../aws-post-exploitation/aws-ecs-post-exploitation.md" %}
[aws-ecs-post-exploitation.md](../aws-post-exploitation/aws-ecs-post-exploitation.md)
{% endcontent-ref %}

### Persistance

{% content-ref url="../aws-persistence/aws-ecs-persistence.md" %}
[aws-ecs-persistence.md](../aws-persistence/aws-ecs-persistence.md)
{% endcontent-ref %}

{% hint style="success" %}
Apprenez et pratiquez le hacking AWS :<img src="../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">\
Apprenez et pratiquez le hacking GCP : <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Soutenir HackTricks</summary>

* Consultez les [**plans d'abonnement**](https://github.com/sponsors/carlospolop) !
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez-nous sur** **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Partagez des astuces de hacking en soumettant des PRs aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) d√©p√¥ts github.

</details>
{% endhint %}
