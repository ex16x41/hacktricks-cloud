# AWS - Osnovne Informacije

{% hint style="success" %}
U캜ite i ve쬭ajte AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
U캜ite i ve쬭ajte GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Podr코ka HackTricks</summary>

* Proverite [**planove pretplate**](https://github.com/sponsors/carlospolop)!
* **Pridru쬴te se** 游눫 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili **pratite** nas na **Twitteru** 游냕 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podelite hakerske trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
{% endhint %}

## Hijerarhija Organizacije

![](<../../../.gitbook/assets/image (151).png>)

### Ra캜uni

U AWS postoji **root ra캜un**, koji je **glavni kontejner za sve ra캜une** va코e **organizacije**. Me캠utim, ne morate koristiti taj ra캜un za postavljanje resursa, mo쬰te kreirati **druge ra캜une kako biste odvojili razli캜ite AWS** infrastrukture izme캠u njih.

Ovo je veoma zanimljivo sa **bezbednosnog** stanovi코ta, jer **jedan ra캜un ne캖e mo캖i da pristupi resursima drugog ra캜una** (osim ako su mostovi posebno kreirani), tako da na ovaj na캜in mo쬰te postaviti granice izme캠u implementacija.

Stoga, postoje **dva tipa ra캜una u organizaciji** (govorimo o AWS ra캜unima, a ne o korisni캜kim ra캜unima): jedan ra캜un koji je ozna캜en kao ra캜un za upravljanje, i jedan ili vi코e 캜lanova ra캜una.

*   **Ra캜un za upravljanje (root ra캜un)** je ra캜un koji koristite za kreiranje organizacije. Iz ra캜una za upravljanje organizacijom, mo쬰te uraditi slede캖e:

* Kreirati ra캜une u organizaciji
* Pozvati druge postoje캖e ra캜une u organizaciju
* Ukloniti ra캜une iz organizacije
* Upravljati pozivnicama
* Primeni politike na entitete (root, OU ili ra캜une) unutar organizacije
* Omogu캖iti integraciju sa podr쬬nim AWS uslugama kako bi se obezbedila funkcionalnost usluga 코irom svih ra캜una u organizaciji.
* Mogu캖e je prijaviti se kao root korisnik koriste캖i email i lozinku kori코캖ene za kreiranje ovog root ra캜una/organizacije.

Ra캜un za upravljanje ima **odgovornosti ra캜una za pla캖anje** i odgovoran je za pla캖anje svih tro코kova koje generi코u 캜lanovi ra캜uni. Ne mo쬰te promeniti ra캜un za upravljanje organizacijom.
* **캛lanovi ra캜uni** 캜ine sve ostale ra캜une u organizaciji. Ra캜un mo쬰 biti 캜lan samo jedne organizacije u isto vreme. Mo쬰te prika캜iti politiku na ra캜un kako biste primenili kontrole samo na taj jedan ra캜un.
* 캛lanovi ra캜uni **moraju koristiti va쬰캖u email adresu** i mogu imati **ime**, generalno ne캖e mo캖i da upravljaju naplatom (ali im mo쬰 biti dat pristup).
```
aws organizations create-account --account-name testingaccount --email testingaccount@lalala1233fr.com
```
### **Organizacione jedinice**

Ra캜uni se mogu grupisati u **organizacione jedinice (OU)**. Na ovaj na캜in, mo쬰te kreirati **politike** za organizacionu jedinicu koje 캖e biti **primenjene na sve podra캜une**. Imajte na umu da OU mo쬰 imati druge OU kao decu.
```bash
# You can get the root id from aws organizations list-roots
aws organizations create-organizational-unit --parent-id r-lalala --name TestOU
```
### Service Control Policy (SCP)

**Service control policy (SCP)** je politika koja specificira usluge i akcije koje korisnici i uloge mogu koristiti u nalozima na koje SCP uti캜e. SCP-ovi su **sli캜ni IAM** politikama dozvola osim 코to **ne dodeljuju nikakve dozvole**. Umesto toga, SCP-ovi specificiraju **maksimalne dozvole** za organizaciju, organizacionu jedinicu (OU) ili nalog. Kada prika캜ite SCP na koren va코e organizacije ili na OU, **SCP ograni캜ava dozvole za entitete u 캜lanicama naloga**.

Ovo je JEDINI na캜in na koji **캜ak i korisnik sa root privilegijama mo쬰 biti spre캜en** da ne코to uradi. Na primer, mo쬰 se koristiti da se spre캜i korisnike da onemogu캖e CloudTrail ili obri코u rezervne kopije.\
Jedini na캜in da se to zaobi캠e je da se kompromituje i **glavni nalog** koji konfiguri코e SCP-ove (glavni nalog ne mo쬰 biti blokiran).

{% hint style="warning" %}
Napomena da **SCP-ovi samo ograni캜avaju principe u nalogu**, tako da drugi nalozi nisu pogo캠eni. To zna캜i da imati SCP koji odbija `s3:GetObject` ne캖e spre캜iti ljude da **pristupaju javnom S3 bucket-u** u va코em nalogu.
{% endhint %}

SCP primeri:

* Odbijanje root naloga u potpunosti
* Dozvoliti samo specifi캜ne regione
* Dozvoliti samo usluge sa bele liste
*   Odbijanje GuardDuty, CloudTrail i S3 Public Block Access od

onemogu캖avanja
*   Odbijanje uloga za bezbednost/odgovor na incidente od

brisanja ili modifikacije.
* Odbijanje brisanja rezervnih kopija.
* Odbijanje kreiranja IAM korisnika i pristupnih klju캜eva

Prona캠ite **JSON primere** na [https://docs.aws.amazon.com/organizations/latest/userguide/orgs\_manage\_policies\_scps\_examples.html](https://docs.aws.amazon.com/organizations/latest/userguide/orgs\_manage\_policies\_scps\_examples.html)

### ARN

**Amazon Resource Name** je **jedinstveno ime** koje svaki resurs unutar AWS-a ima, sastoji se ovako:
```
arn:partition:service:region:account-id:resource-type/resource-id
arn:aws:elasticbeanstalk:us-west-1:123456789098:environment/App/Env
```
Napomena da postoje 4 particije u AWS-u, ali samo 3 na캜ina da ih nazovete:

* AWS Standard: `aws`
* AWS China: `aws-cn`
* AWS US public Internet (GovCloud): `aws-us-gov`
* AWS Secret (US Classified): `aws`

## IAM - Upravljanje identitetom i pristupom

IAM je usluga koja 캖e vam omogu캖iti da upravljate **autentifikacijom**, **autorizacijom** i **kontrolom pristupa** unutar va코eg AWS naloga.

* **Autentifikacija** - Proces definisanja identiteta i verifikacije tog identiteta. Ovaj proces se mo쬰 podeliti na: Identifikaciju i verifikaciju.
* **Autorizacija** - Odre캠uje 코ta identitet mo쬰 da pristupi unutar sistema nakon 코to je autentifikovan.
* **Kontrola pristupa** - Metod i proces kako se pristup dodeljuje sigurnom resursu.

IAM se mo쬰 definisati po svojoj sposobnosti da upravlja, kontroli코e i reguli코e mehanizme autentifikacije, autorizacije i kontrole pristupa identiteta va코im resursima unutar va코eg AWS naloga.

### [AWS nalog root korisnika](https://docs.aws.amazon.com/IAM/latest/UserGuide/id\_root-user.html) <a href="#id_root" id="id_root"></a>

Kada prvi put kreirate Amazon Web Services (AWS) nalog, po캜injete sa jednim identitetom za prijavu koji ima **potpun pristup svim** AWS uslugama i resursima u nalogu. Ovo je _**root korisnik**_ AWS naloga i pristupa mu se prijavom sa **email adresom i lozinkom koje ste koristili za kreiranje naloga**.

Napomena da novi **admin korisnik** ima **manje dozvole od root korisnika**.

Sa bezbednosnog stanovi코ta, preporu캜uje se kreiranje drugih korisnika i izbegavanje kori코캖enja ovog.

### [IAM korisnici](https://docs.aws.amazon.com/IAM/latest/UserGuide/id\_users.html) <a href="#id_iam-users" id="id_iam-users"></a>

IAM _korisnik_ je entitet koji kreirate u AWS-u da **predstavlja osobu ili aplikaciju** koja ga koristi za **interakciju sa AWS-om**. Korisnik u AWS-u se sastoji od imena i akreditiva (lozinka i do dva pristupna klju캜a).

Kada kreirate IAM korisnika, dodeljujete mu **dozvole** tako 코to ga 캜inite **캜lanom korisni캜ke grupe** koja ima odgovaraju캖e politike dozvola (preporu캜eno), ili **direktno povezivanjem politika** sa korisnikom.

Korisnici mogu imati **omogu캖en MFA za prijavu** putem konzole. API tokeni korisnika sa omogu캖enim MFA nisu za코ti캖eni MFA. Ako 쬰lite da **ograni캜ite pristup API klju캜evima korisnika koriste캖i MFA**, morate nazna캜iti u politici da je za izvr코avanje odre캠enih radnji MFA potrebno (primer [**ovde**](https://docs.aws.amazon.com/IAM/latest/UserGuide/id\_credentials\_mfa\_configure-api-require.html)).

#### CLI

* **ID pristupnog klju캜a**: 20 nasumi캜nih velikih alfanumeri캜kih karaktera kao 코to su AKHDNAPO86BSHKDIRYT
* **ID tajnog pristupnog klju캜a**: 40 nasumi캜nih velikih i malih karaktera: S836fh/J73yHSb64Ag3Rkdi/jaD6sPl6/antFtU (Nije mogu캖e povratiti izgubljene ID-ove tajnog pristupnog klju캜a).

Kad god trebate **promeniti pristupni klju캜**, ovo je proces koji treba da pratite:\
_Kreirajte novi pristupni klju캜 -> Primijenite novi klju캜 na sistem/aplikaciju -> ozna캜ite originalni kao neaktivan -> Testirajte i verifikujte da novi pristupni klju캜 radi -> Obri코ite stari pristupni klju캜_

### MFA - Vi코efaktorska autentifikacija

Koristi se za **kreiranje dodatnog faktora za autentifikaciju** pored va코ih postoje캖ih metoda, kao 코to je lozinka, 캜ime se stvara vi코efaktorski nivo autentifikacije.\
Mo쬰te koristiti **besplatnu virtuelnu aplikaciju ili fizi캜ki ure캠aj**. Mo쬰te koristiti aplikacije poput Google autentifikacije besplatno za aktivaciju MFA u AWS-u.

Politike sa MFA uslovima mogu se povezati sa slede캖im:

* IAM korisnikom ili grupom
* Resursom kao 코to je Amazon S3 kofa, Amazon SQS red ili Amazon SNS tema
* Politika poverenja IAM uloge koju mo쬰 preuzeti korisnik

Ako 쬰lite da **pristupite putem CLI** resursu koji **proverava MFA**, morate pozvati **`GetSessionToken`**. To 캖e vam dati token sa informacijama o MFA.\
Napomena da **`AssumeRole` akreditivi ne sadr쬰 ove informacije**.
```bash
aws sts get-session-token --serial-number <arn_device> --token-code <code>
```
As [**stated here**](https://docs.aws.amazon.com/IAM/latest/UserGuide/id\_credentials\_mfa\_configure-api-require.html), postoji mnogo razli캜itih slu캜ajeva gde **MFA ne mo쬰 biti kori코캖en**.

### [IAM korisni캜ke grupe](https://docs.aws.amazon.com/IAM/latest/UserGuide/id\_groups.html) <a href="#id_iam-groups" id="id_iam-groups"></a>

IAM [korisni캜ka grupa](https://docs.aws.amazon.com/IAM/latest/UserGuide/id\_groups.html) je na캜in da se **prika캜e politike vi코e korisnika** u isto vreme, 코to mo쬰 olak코ati upravljanje dozvolama za te korisnike. **Uloge i grupe ne mogu biti deo grupe**.

Mo쬰te prika캜iti **politiku zasnovanu na identitetu korisni캜koj grupi** tako da svi **korisnici** u korisni캜koj grupi **dobiju dozvole politike**. **Ne mo쬰te** identifikovati **korisni캜ku grupu** kao **`Principal`** u **politici** (kao 코to je politika zasnovana na resursima) jer se grupe odnose na dozvole, a ne na autentifikaciju, a principi su autentifikovani IAM entiteti.

Evo nekih va쬹ih karakteristika korisni캜kih grupa:

* Korisni캜ka **grupa** mo쬰 **sadr쬬ti mnogo korisnika**, a **korisnik** mo쬰 **pripadati vi코e grupa**.
* **Korisni캜ke grupe ne mogu biti ugnje쬯ene**; mogu sadr쬬ti samo korisnike, ne i druge korisni캜ke grupe.
* Ne postoji **podrazumevana korisni캜ka grupa koja automatski uklju캜uje sve korisnike u AWS nalogu**. Ako 쬰lite da imate takvu korisni캜ku grupu, morate je kreirati i dodeliti svakom novom korisniku.
* Broj i veli캜ina IAM resursa u AWS nalogu, kao 코to su broj grupa i broj grupa kojima korisnik mo쬰 biti 캜lan, su ograni캜eni. Za vi코e informacija, pogledajte [IAM i AWS STS kvote](https://docs.aws.amazon.com/IAM/latest/UserGuide/reference\_iam-quotas.html).

### [IAM uloge](https://docs.aws.amazon.com/IAM/latest/UserGuide/id\_roles.html) <a href="#id_iam-roles" id="id_iam-roles"></a>

IAM **uloga** je veoma **sli캜na** **korisniku**, jer je to **identitet sa politikama dozvola koje odre캠uju 코ta** mo쬰 i ne mo쬰 da radi u AWS-u. Me캠utim, uloga **nema nikakve kredencijale** (lozinku ili pristupne klju캜eve) povezane sa njom. Umesto da bude jedinstveno povezana sa jednom osobom, uloga je namenjena da bude **preuzeta od strane bilo koga ko je treba (i ima dovoljno dozvola)**. **IAM korisnik mo쬰 preuzeti ulogu da privremeno** preuzme razli캜ite dozvole za odre캠eni zadatak. Uloga mo쬰 biti **dodeljena** [**federisanom korisniku**](https://docs.aws.amazon.com/IAM/latest/UserGuide/id\_roles\_providers.html) koji se prijavljuje koriste캖i spoljnog provajdera identiteta umesto IAM-a.

IAM uloga se sastoji od **dvaju tipova politika**: **politika poverenja**, koja ne mo쬰 biti prazna, defini코u캖i **ko mo쬰 preuzeti** ulogu, i **politika dozvola**, koja ne mo쬰 biti prazna, defini코u캖i **코ta mo쬰 da pristupi**.

#### AWS Security Token Service (STS)

AWS Security Token Service (STS) je veb servis koji olak코ava **izdavanje privremenih, ograni캜enih privilegija kredencijala**. Specijalno je prilago캠en za:

### [Privremeni kredencijali u IAM](https://docs.aws.amazon.com/IAM/latest/UserGuide/id\_credentials\_temp.html) <a href="#id_temp-creds" id="id_temp-creds"></a>

**Privremeni kredencijali se prvenstveno koriste sa IAM ulogama**, ali postoje i druge upotrebe. Mo쬰te zatra쬴ti privremene kredencijale koji imaju ograni캜eniji skup dozvola od va코eg standardnog IAM korisnika. Ovo **spre캜ava** vas da **slu캜ajno izvr코avate zadatke koji nisu dozvoljeni** sa ograni캜enim kredencijalima. Prednost privremenih kredencijala je ta 코to automatski isti캜u nakon odre캠enog vremenskog perioda. Imate kontrolu nad trajanjem tokom kojeg su kredencijali validni.

### Politike

#### Dozvole politika

Koriste se za dodeljivanje dozvola. Postoje 2 tipa:

* AWS upravljane politike (prekonfigurisane od strane AWS-a)
* Politike koje upravlja korisnik: Konfiguri코ete ih vi. Mo쬰te kreirati politike zasnovane na AWS upravljanim politikama (modifikuju캖i jednu od njih i kreiraju캖i svoju), koriste캖i generator politika (GUI prikaz koji vam poma쬰 u dodeljivanju i odbijanju dozvola) ili pi코u캖i svoje.

Po **podrazumevanju, pristup** je **odbijen**, pristup 캖e biti odobren ako je eksplicitna uloga navedena.\
Ako **jedna "Odbij" postoji, ona 캖e nadja캜ati "Dozvoli"**, osim za zahteve koji koriste sigurnosne kredencijale root naloga AWS-a (koji su podrazumevano dozvoljeni).
```javascript
{
"Version": "2012-10-17",  //Version of the policy
"Statement": [  //Main element, there can be more than 1 entry in this array
{
"Sid": "Stmt32894y234276923" //Unique identifier (optional)
"Effect": "Allow", //Allow or deny
"Action": [  //Actions that will be allowed or denied
"ec2:AttachVolume",
"ec2:DetachVolume"
],
"Resource": [ //Resource the action and effect will be applied to
"arn:aws:ec2:*:*:volume/*",
"arn:aws:ec2:*:*:instance/*"
],
"Condition": { //Optional element that allow to control when the permission will be effective
"ArnEquals": {"ec2:SourceInstanceARN": "arn:aws:ec2:*:*:instance/instance-id"}
}
}
]
}
```
The [global fields that can be used for conditions in any service are documented here](https://docs.aws.amazon.com/IAM/latest/UserGuide/reference\_policies\_condition-keys.html#condition-keys-resourceaccount).\
The [specific fields that can be used for conditions per service are documented here](https://docs.aws.amazon.com/service-authorization/latest/reference/reference\_policies\_actions-resources-contextkeys.html).

#### Inline Policies

Ova vrsta politika je **direktno dodeljena** korisniku, grupi ili ulozi. Tada se ne pojavljuju na listi politika kao 코to to mo쬰 biti slu캜aj sa drugim.\
Inline politike su korisne ako 쬰lite da **odr쬴te strogu jedan-na-jedan vezu izme캠u politike i identiteta** na koji se primenjuju. Na primer, 쬰lite da budete sigurni da dozvole u politici nisu nenamerno dodeljene identitetu osim onog za koji su namenjene. Kada koristite inline politiku, dozvole u politici ne mogu biti nenamerno povezane sa pogre코nim identitetom. Pored toga, kada koristite AWS Management Console za brisanje tog identiteta, politike ugra캠ene u identitet se tako캠e bri코u. To je zato 코to su deo glavne entiteta.

#### Resource Bucket Policies

Ove su **politike** koje se mogu definisati u **resursima**. **Nisu svi resursi AWS-a podr쬬vaju njih**.

Ako glavni entitet nema eksplicitnu zabranu na njih, a politika resursa im daje pristup, tada su dozvoljeni.

### IAM Boundaries

IAM granice se mogu koristiti za **ograni캜avanje dozvola kojima korisnik ili uloga treba da imaju pristup**. Na ovaj na캜in, 캜ak i ako se korisniku dodeli druga캜iji skup dozvola od **druge politike**, operacija 캖e **neuspeti** ako poku코a da ih koristi.

Granica je samo politika koja je povezana sa korisnikom i **ukazuje na maksimalni nivo dozvola koje korisnik ili uloga mogu imati**. Dakle, **캜ak i ako korisnik ima Administrator pristup**, ako granica ukazuje da mo쬰 samo da 캜ita S췅 kante, to je maksimum 코to mo쬰 da uradi.

**Ovo**, **SCPs** i **pridr쬬vanje principa minimalnih privilegija** su na캜ini da se kontroli코e da korisnici nemaju vi코e dozvola nego 코to im je potrebno.

### Session Policies

Politika sesije je **politika postavljena kada se neka uloga preuzme** na neki na캜in. Ovo 캖e biti kao **IAM granica za tu sesiju**: To zna캜i da politika sesije ne dodeljuje dozvole, ve캖 **ograni캜ava ih na one koje su navedene u politici** (maksimalne dozvole su one koje uloga ima).

Ovo je korisno za **mere bezbednosti**: Kada administrator preuzima veoma privilegovanu ulogu, mogao bi da ograni캜i dozvolu samo na one koje su navedene u politici sesije u slu캜aju da sesija bude kompromitovana.
```bash
aws sts assume-role \
--role-arn <value> \
--role-session-name <value> \
[--policy-arns <arn_custom_policy1> <arn_custom_policy2>]
[--policy <file://policy.json>]
```
Napomena da po defaultu **AWS mo쬰 dodati politike sesije sesijama** koje 캖e biti generisane zbog tre캖ih razloga. Na primer, u [neautentifikovanim cognito pretpostavljenim rolama](../aws-services/aws-cognito-enum/cognito-identity-pools.md#accessing-iam-roles) po defaultu (koriste캖i pobolj코anu autentifikaciju), AWS 캖e generisati **akreditiv sesije sa politikom sesije** koja ograni캜ava usluge kojima sesija mo쬰 pristupiti [**na slede캖u listu**](https://docs.aws.amazon.com/cognito/latest/developerguide/iam-roles.html#access-policies-scope-down-services).

Dakle, ako se u nekom trenutku suo캜ite sa gre코kom "... jer nijedna politika sesije ne dozvoljava ...", a uloga ima pristup za izvr코enje akcije, to je zato 코to **postoji politika sesije koja to spre캜ava**.

### Identitetna federacija

Identitetna federacija **omogu캖ava korisnicima iz identitetskih provajdera koji su eksterni** za AWS da sigurno pristupaju AWS resursima bez potrebe da dostavljaju AWS korisni캜ke akreditive iz va쬰캖eg IAM korisni캜kog naloga.\
Primer identitetskog provajdera mo쬰 biti va코a vlastita korporativna **Microsoft Active Directory** (putem **SAML**) ili **OpenID** usluga (kao 코to je **Google**). Federisani pristup 캖e tada omogu캖iti korisnicima unutar njega da pristupaju AWS-u.

Da biste konfigurisali ovo poverenje, generi코e se **IAM identitetski provajder (SAML ili OAuth)** koji 캖e **verovati** **drugoj platformi**. Zatim, najmanje jedna **IAM uloga se dodeljuje (veruju캖i) identitetskom provajderu**. Ako korisnik iz poverene platforme pristupi AWS-u, pristupa캖e kao pomenuta uloga.

Me캠utim, obi캜no 캖ete 쬰leti da dodelite **razli캜itu ulogu u zavisnosti od grupe korisnika** na tre캖oj strani. Tada, nekoliko **IAM uloga mo쬰 verovati** tre캖em identitetskom provajderu, a tre캖a platforma 캖e biti ta koja omogu캖ava korisnicima da preuzmu jednu ili drugu ulogu.

<figure><img src="../../../.gitbook/assets/image (247).png" alt=""><figcaption></figcaption></figure>

### IAM Identitetni Centar

AWS IAM Identitetni Centar (naslednik AWS Single Sign-On) pro코iruje mogu캖nosti AWS upravljanja identitetom i pristupom (IAM) kako bi pru쬴o **centralno mesto** koje okuplja **administraciju korisnika i njihov pristup AWS** nalozima i cloud aplikacijama.

Domen za prijavu 캖e biti ne코to poput `<user_input>.awsapps.com`.

Da biste prijavili korisnike, postoje 3 izvora identiteta koji se mogu koristiti:

* Identitetni Centar Direktorijum: Redovni AWS korisnici
* Active Directory: Podr쬬va razli캜ite konektore
* Eksterni identitetski provajder: Svi korisnici i grupe dolaze iz eksternog identitetskog provajdera (IdP)

<figure><img src="../../../.gitbook/assets/image (279).png" alt=""><figcaption></figcaption></figure>

U najjednostavnijem slu캜aju direktorijuma Identitetnog Centra, **Identitetni Centar 캖e imati listu korisnika i grupa** i mo캖i 캖e da **dodeli politike** njima za **bilo koji od naloga** organizacije.

Da biste dali pristup korisniku/grupi Identitetnog Centra nalogu, bi캖e kreiran **SAML identitetski provajder koji veruje Identitetnom Centru**, a **uloga koja veruje identitetskom provajderu sa navedenim politikama bi캖e kreirana** u odredi코nom nalogu.

#### AwsSSOInlinePolicy

Mogu캖e je **dati dozvole putem inline politika rolama kreiranim putem IAM Identitetnog Centra**. Uloge kreirane u nalozima koje dobijaju **inline politike u AWS Identitetnom Centru** 캖e imati ove dozvole u inline politici pod nazivom **`AwsSSOInlinePolicy`**.

Dakle, 캜ak i ako vidite 2 uloge sa inline politikom pod nazivom **`AwsSSOInlinePolicy`**, to **ne zna캜i da imaju iste dozvole**.

### Cross Account Trusts and Roles

**Korisnik** (veruju캖i) mo쬰 kreirati Cross Account ulogu sa nekim politikama i zatim **dozvoliti drugom korisniku** (pouzdani) da **pristupi njegovom nalogu** ali samo **imaju캖i pristup nazna캜en u novim politikama uloge**. Da biste to kreirali, jednostavno kreirajte novu ulogu i izaberite Cross Account ulogu. Uloge za pristup izme캠u naloga nude dve opcije. Pru쬬nje pristupa izme캠u AWS naloga koje posedujete, i pru쬬nje pristupa izme캠u naloga koji posedujete i tre캖eg AWS naloga.\
Preporu캜uje se da **precizirate korisnika koji je poveren i ne stavljate neku generi캜ku stvar** jer u suprotnom, drugi autentifikovani korisnici poput federisanih korisnika 캖e tako캠e mo캖i da zloupotrebe ovo poverenje.

### AWS Simple AD

Nije podr쬬no:

* Odnos poverenja
* AD Admin Centar
* Puna PS API podr코ka
* AD Recycle Bin
* Grupa upravljanih servisnih naloga
* Pro코irenja 코eme
* Nema direktan pristup OS-u ili instancama

#### Web Federacija ili OpenID Autentifikacija

Aplikacija koristi AssumeRoleWithWebIdentity za kreiranje privremenih akreditiva. Me캠utim, ovo ne omogu캖ava pristup AWS konzoli, samo pristup resursima unutar AWS-a.

### Druge IAM opcije

* Mo쬰te **postaviti pode코avanje politike lozinke** kao 코to su minimalna du쬴na i zahtevi za lozinku.
* Mo쬰te **preuzeti "Izve코taj o akreditivima"** sa informacijama o trenutnim akreditivima (kao 코to su vreme kreiranja korisnika, da li je lozinka omogu캖ena...). Mo쬰te generisati izve코taj o akreditivima koliko 캜esto 쬰lite, 캜ak i svaka **캜etiri sata**.

AWS upravljanje identitetom i pristupom (IAM) pru쬬 **fino pode코enu kontrolu pristupa** 코irom celog AWS-a. Sa IAM-om, mo쬰te precizirati **ko mo쬰 pristupiti kojim uslugama i resursima**, i pod kojim uslovima. Sa IAM politikama, upravljate dozvolama za va코u radnu snagu i sisteme kako biste **osigurali dozvole sa najmanjim privilegijama**.

### IAM ID Prefiksi

Na [**ovoj stranici**](https://docs.aws.amazon.com/IAM/latest/UserGuide/reference\_identifiers.html#identifiers-unique-ids) mo쬰te prona캖i **IAM ID prefikse** klju캜eva u zavisnosti od njihove prirode:

| ABIA | [AWS STS servisni nosilac tokena](https://docs.aws.amazon.com/IAM/latest/UserGuide/id\_credentials\_bearer.html)                                                                                                         |
| ---- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| ACCA | Kontekst-specifi캜ni akreditiv                                                                                                                                                                                           |
| AGPA | Korisni캜ka grupa                                                                                                                                                                                                            |
| AIDA | IAM korisnik                                                                                                                                                                                                              |
| AIPA | Amazon EC2 profil instance                                                                                                                                                                                           |
| AKIA | Klju캜 pristupa                                                                                                                                                                                                            |
| ANPA | Upravljana politika                                                                                                                                                                                                        |
| ANVA | Verzija u upravljanoj politici                                                                                                                                                                                           |
| APKA | Javni klju캜                                                                                                                                                                                                            |
| AROA | Uloga                                                                                                                                                                                                                  |
| ASCA | Sertifikat                                                                                                                                                                                                           |
| ASIA | [Privremeni (AWS STS) ID klju캜evi za pristup](https://docs.aws.amazon.com/STS/latest/APIReference/API\_Credentials.html) koriste ovaj prefiks, ali su jedinstveni samo u kombinaciji sa tajnim pristupnim klju캜em i tokenom sesije. |

### Preporu캜ene dozvole za reviziju naloga

Slede캖e privilegije daju razli캜it pristup metapodacima:

* `arn:aws:iam::aws:policy/SecurityAudit`
* `arn:aws:iam::aws:policy/job-function/ViewOnlyAccess`
* `codebuild:ListProjects`
* `config:Describe*`
* `cloudformation:ListStacks`
* `logs:DescribeMetricFilters`
* `directconnect:DescribeConnections`
* `dynamodb:ListTables`

## Razno

### CLI Autentifikacija

Da bi regularni korisnik autentifikovao AWS putem CLI, potrebno je imati **lokalne akreditive**. Po defaultu, mo쬰te ih konfigurisati **ru캜no** u `~/.aws/credentials` ili **pokretanjem** `aws configure`.\
U toj datoteci mo쬰te imati vi코e od jednog profila, ako **nije specificiran profil** koriste캖i **aws cli**, koristi캖e se onaj pod nazivom **`[default]`** u toj datoteci.\
Primer datoteke akreditiva sa vi코e od 1 profila:
```
[default]
aws_access_key_id = AKIA5ZDCUJHF83HDTYUT
aws_secret_access_key = uOcdhof683fbOUGFYEQug8fUGIf68greoihef

[Admin]
aws_access_key_id = AKIA8YDCu7TGTR356SHYT
aws_secret_access_key = uOcdhof683fbOUGFYEQuR2EIHG34UY987g6ff7
region = eu-west-2
```
Ako treba da pristupite **razli캜itim AWS nalozima** i va코em profilu je dato pravo da **pretpostavi ulogu unutar tih naloga**, ne morate ru캜no pozivati STS svaki put (`aws sts assume-role --role-arn <role-arn> --role-session-name sessname`) i konfigurisati akreditive.

Mo쬰te koristiti `~/.aws/config` datoteku da **nazna캜ite koje uloge da pretpostavite** i zatim koristiti `--profile` parametar kao i obi캜no (pretpostavljanje uloge 캖e se izvr코iti na transparentan na캜in za korisnika).\
Primer konfiguracione datoteke:
```
[profile acc2]
region=eu-west-2
role_arn=arn:aws:iam::<account-id>:role/<role-path>
role_session_name = <session_name>
source_profile = <profile_with_assume_role>
sts_regional_endpoints = regional
```
Sa ovom konfiguracionom datotekom mo쬰te koristiti aws cli kao:
```
aws --profile acc2 ...
```
Ako tra쬴te ne코to **sli캜no** ovome, ali za **pregleda캜**, mo쬰te proveriti **ekstenziju** [**AWS Extend Switch Roles**](https://chrome.google.com/webstore/detail/aws-extend-switch-roles/jpmkfafbacpgapdghgdpembnojdlgkdl?hl=en).

## Reference

* [https://docs.aws.amazon.com/organizations/latest/userguide/orgs\_getting-started\_concepts.html](https://docs.aws.amazon.com/organizations/latest/userguide/orgs\_getting-started\_concepts.html)
* [https://aws.amazon.com/iam/](https://aws.amazon.com/iam/)
* [https://docs.aws.amazon.com/singlesignon/latest/userguide/what-is.html](https://docs.aws.amazon.com/singlesignon/latest/userguide/what-is.html)

{% hint style="success" %}
U캜ite i ve쬭ajte AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
U캜ite i ve쬭ajte GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Podr쬴te HackTricks</summary>

* Proverite [**planove pretplate**](https://github.com/sponsors/carlospolop)!
* **Pridru쬴te se** 游눫 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili **pratite** nas na **Twitteru** 游냕 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podelite hakerske trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
{% endhint %}
