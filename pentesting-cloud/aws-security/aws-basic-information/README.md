# AWS - рдореВрд▓ рдЬрд╛рдирдХрд╛рд░реА

{% hint style="success" %}
AWS рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ рдФрд░ рдЕрднреНрдпрд╛рд╕ рдХрд░реЗрдВ:<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
GCP рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ рдФрд░ рдЕрднреНрдпрд╛рд╕ рдХрд░реЗрдВ: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░реЗрдВ</summary>

* [**рд╕рджрд╕реНрдпрддрд╛ рдпреЛрдЬрдирд╛рдПрдБ**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* **рд╣рдорд╛рд░реЗ** ЁЯТм [**Discord рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдореЗрдВ рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ рдпрд╛ **Twitter** ЁЯРж рдкрд░ рд╣рдореЗрдВ **рдлреЙрд▓реЛ рдХрд░реЗрдВ** [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ рдФрд░** [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) рдЧрд┐рдЯрд╣рдм рд░рд┐рдкреЛрдЬрд┐рдЯрд░реА рдореЗрдВ PR рд╕рдмрдорд┐рдЯ рдХрд░реЗрдВред

</details>
{% endhint %}

## рд╕рдВрдЧрдарди рдкрджрд╛рдиреБрдХреНрд░рдо

![](<../../../.gitbook/assets/image (151).png>)

### рдЦрд╛рддреЗ

AWS рдореЗрдВ рдПрдХ **рд░реВрдЯ рдЦрд╛рддрд╛** рд╣реЛрддрд╛ рд╣реИ, рдЬреЛ рдЖрдкрдХреЗ **рд╕рдВрдЧрдарди** рдХреЗ рд╕рднреА рдЦрд╛рддреЛрдВ рдХреЗ рд▓рд┐рдП **рдорд╛рддрд╛ рдХрдВрдЯреЗрдирд░** рд╣реИред рд╣рд╛рд▓рд╛рдБрдХрд┐, рдЖрдкрдХреЛ рд╕рдВрд╕рд╛рдзрдиреЛрдВ рдХреЛ рддреИрдирд╛рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрд╕ рдЦрд╛рддреЗ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реИ, рдЖрдк **рд╡рд┐рднрд┐рдиреНрди AWS** рдЕрд╡рд╕рдВрд░рдЪрдирд╛рдУрдВ рдХреЛ рдЕрд▓рдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП **рдЕрдиреНрдп рдЦрд╛рддреЗ рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВ**ред

рдпрд╣ **рд╕реБрд░рдХреНрд╖рд╛** рдХреЗ рджреГрд╖реНрдЯрд┐рдХреЛрдг рд╕реЗ рдмрд╣реБрдд рджрд┐рд▓рдЪрд╕реНрдк рд╣реИ, рдХреНрдпреЛрдВрдХрд┐ **рдПрдХ рдЦрд╛рддрд╛ рдЕрдиреНрдп рдЦрд╛рддреЗ рдХреЗ рд╕рдВрд╕рд╛рдзрдиреЛрдВ рддрдХ рдкрд╣реБрдБрдЪ рдирд╣реАрдВ рдкрд╛рдПрдЧрд╛** (рдЬрдм рддрдХ рдХрд┐ рдкреБрд▓ рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ рдмрдирд╛рдП рдирд╣реАрдВ рдЧрдП рд╣реЛрдВ), рдЗрд╕рд▓рд┐рдП рдЗрд╕ рддрд░рд╣ рдЖрдк рддреИрдирд╛рддрд┐рдпреЛрдВ рдХреЗ рдмреАрдЪ рд╕реАрдорд╛рдПрдБ рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВред

рдЗрд╕рд▓рд┐рдП, рдПрдХ рд╕рдВрдЧрдарди рдореЗрдВ **рджреЛ рдкреНрд░рдХрд╛рд░ рдХреЗ рдЦрд╛рддреЗ** рд╣реЛрддреЗ рд╣реИрдВ (рд╣рдо AWS рдЦрд╛рддреЛрдВ рдХреА рдмрд╛рдд рдХрд░ рд░рд╣реЗ рд╣реИрдВ, рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЦрд╛рддреЛрдВ рдХреА рдирд╣реАрдВ): рдПрдХ рдПрдХрд▓ рдЦрд╛рддрд╛ рдЬрд┐рд╕реЗ рдкреНрд░рдмрдВрдзрди рдЦрд╛рддрд╛ рдХреЗ рд░реВрдк рдореЗрдВ рдирд╛рдорд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рдФрд░ рдПрдХ рдпрд╛ рдЕрдзрд┐рдХ рд╕рджрд╕реНрдп рдЦрд╛рддреЗред

*   **рдкреНрд░рдмрдВрдзрди рдЦрд╛рддрд╛ (рд░реВрдЯ рдЦрд╛рддрд╛)** рд╡рд╣ рдЦрд╛рддрд╛ рд╣реИ рдЬрд┐рд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдЖрдк рд╕рдВрдЧрдарди рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд░рддреЗ рд╣реИрдВред рд╕рдВрдЧрдарди рдХреЗ рдкреНрд░рдмрдВрдзрди рдЦрд╛рддреЗ рд╕реЗ, рдЖрдк рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:

* рд╕рдВрдЧрдарди рдореЗрдВ рдЦрд╛рддреЗ рдмрдирд╛рдирд╛
* рд╕рдВрдЧрдарди рдореЗрдВ рдЕрдиреНрдп рдореМрдЬреВрджрд╛ рдЦрд╛рддреЛрдВ рдХреЛ рдЖрдордВрддреНрд░рд┐рдд рдХрд░рдирд╛
* рд╕рдВрдЧрдарди рд╕реЗ рдЦрд╛рддреЛрдВ рдХреЛ рд╣рдЯрд╛рдирд╛
* рдЖрдордВрддреНрд░рдг рдкреНрд░рдмрдВрдзрд┐рдд рдХрд░рдирд╛
* рд╕рдВрдЧрдарди рдХреЗ рднреАрддрд░ рд╕рдВрд╕реНрдерд╛рдУрдВ (рд░реВрдЯ, OU, рдпрд╛ рдЦрд╛рддреЛрдВ) рдкрд░ рдиреАрддрд┐рдпрд╛рдБ рд▓рд╛рдЧреВ рдХрд░рдирд╛
* рд╕рдВрдЧрдарди рдореЗрдВ рд╕рднреА рдЦрд╛рддреЛрдВ рдХреЗ рд▓рд┐рдП рд╕реЗрд╡рд╛ рдХрд╛рд░реНрдпрдХреНрд╖рдорддрд╛ рдкреНрд░рджрд╛рди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╕рдорд░реНрдерд┐рдд AWS рд╕реЗрд╡рд╛рдУрдВ рдХреЗ рд╕рд╛рде рдПрдХреАрдХрд░рдг рд╕рдХреНрд╖рдо рдХрд░рдирд╛ред
* рдЗрд╕ рд░реВрдЯ рдЦрд╛рддреЗ/рд╕рдВрдЧрдарди рдХреЛ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдЧрдП рдИрдореЗрд▓ рдФрд░ рдкрд╛рд╕рд╡рд░реНрдб рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд░реВрдЯ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рд░реВрдк рдореЗрдВ рд▓реЙрдЧрд┐рди рдХрд░рдирд╛ рд╕рдВрднрд╡ рд╣реИред

рдкреНрд░рдмрдВрдзрди рдЦрд╛рддреЗ рдХреА **рднреБрдЧрддрд╛рдирдХрд░реНрддрд╛ рдЦрд╛рддреЗ рдХреА рдЬрд┐рдореНрдореЗрджрд╛рд░рд┐рдпрд╛рдБ** рд╣реЛрддреА рд╣реИрдВ рдФрд░ рдпрд╣ рд╕рджрд╕реНрдп рдЦрд╛рддреЛрдВ рджреНрд╡рд╛рд░рд╛ рдЙрддреНрдкрдиреНрди рд╕рднреА рд╢реБрд▓реНрдХреЛрдВ рдХрд╛ рднреБрдЧрддрд╛рди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЬрд┐рдореНрдореЗрджрд╛рд░ рд╣реЛрддрд╛ рд╣реИред рдЖрдк рд╕рдВрдЧрдарди рдХреЗ рдкреНрд░рдмрдВрдзрди рдЦрд╛рддреЗ рдХреЛ рдирд╣реАрдВ рдмрджрд▓ рд╕рдХрддреЗред
* **рд╕рджрд╕реНрдп рдЦрд╛рддреЗ** рд╕рдВрдЧрдарди рдореЗрдВ рд╕рднреА рдЕрдиреНрдп рдЦрд╛рддреЛрдВ рдХрд╛ рдирд┐рд░реНрдорд╛рдг рдХрд░рддреЗ рд╣реИрдВред рдПрдХ рдЦрд╛рддрд╛ рдПрдХ рд╕рдордп рдореЗрдВ рдХреЗрд╡рд▓ рдПрдХ рд╕рдВрдЧрдарди рдХрд╛ рд╕рджрд╕реНрдп рд╣реЛ рд╕рдХрддрд╛ рд╣реИред рдЖрдк рдПрдХ рдЦрд╛рддреЗ рдкрд░ рдирд┐рдпрдВрддреНрд░рдг рд▓рд╛рдЧреВ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдиреАрддрд┐ рд╕рдВрд▓рдЧреНрди рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред
* рд╕рджрд╕реНрдп рдЦрд╛рддреЛрдВ рдХреЛ **рдПрдХ рдорд╛рдиреНрдп рдИрдореЗрд▓ рдкрддрд╛** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдП рдФрд░ рдПрдХ **рдирд╛рдо** рд╣реЛ рд╕рдХрддрд╛ рд╣реИ, рд╕рд╛рдорд╛рдиреНрдпрддрдГ рд╡реЗ рдмрд┐рд▓рд┐рдВрдЧ рдХрд╛ рдкреНрд░рдмрдВрдзрди рдирд╣реАрдВ рдХрд░ рдкрд╛рдПрдВрдЧреЗ (рд▓реЗрдХрд┐рди рдЙрдиреНрд╣реЗрдВ рдЗрд╕рдХреЗ рд▓рд┐рдП рдкрд╣реБрдБрдЪ рджреА рдЬрд╛ рд╕рдХрддреА рд╣реИ)ред
```
aws organizations create-account --account-name testingaccount --email testingaccount@lalala1233fr.com
```
### **Organization Units**

рдЦрд╛рддреЛрдВ рдХреЛ **Organization Units (OU)** рдореЗрдВ рд╕рдореВрд╣рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред рдЗрд╕ рддрд░рд╣, рдЖрдк рдЙрд╕ Organization Unit рдХреЗ рд▓рд┐рдП **рдиреАрддрд┐рдпрд╛рдБ** рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВ рдЬреЛ **рд╕рднреА рдмрдЪреНрдЪреЛрдВ рдХреЗ рдЦрд╛рддреЛрдВ рдкрд░ рд▓рд╛рдЧреВ рд╣реЛрдВрдЧреА**ред рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдПрдХ OU рдХреЗ рдкрд╛рд╕ рдЕрдиреНрдп OUs рднреА рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВред
```bash
# You can get the root id from aws organizations list-roots
aws organizations create-organizational-unit --parent-id r-lalala --name TestOU
```
### Service Control Policy (SCP)

рдПрдХ **рд╕реЗрд╡рд╛ рдирд┐рдпрдВрддреНрд░рдг рдиреАрддрд┐ (SCP)** рдПрдХ рдиреАрддрд┐ рд╣реИ рдЬреЛ рдЙрди рд╕реЗрд╡рд╛рдУрдВ рдФрд░ рдХреНрд░рд┐рдпрд╛рдУрдВ рдХреЛ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░рддреА рд╣реИ рдЬрд┐рдиреНрд╣реЗрдВ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдФрд░ рднреВрдорд┐рдХрд╛рдПрдБ рдЙрди рдЦрд╛рддреЛрдВ рдореЗрдВ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдЬрд┐рди рдкрд░ SCP рдкреНрд░рднрд╛рд╡ рдбрд╛рд▓рддреА рд╣реИред SCPs **IAM** рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХреА рдиреАрддрд┐рдпреЛрдВ рдХреЗ рд╕рдорд╛рди рд╣реИрдВ, рд╕рд┐рд╡рд╛рдп рдЗрд╕рдХреЗ рдХрд┐ рд╡реЗ **рдХреЛрдИ рдЕрдиреБрдорддрд┐рдпрд╛рдБ рдирд╣реАрдВ рджреЗрддреАрдВ**ред рдЗрд╕рдХреЗ рдмрдЬрд╛рдп, SCPs рдПрдХ рд╕рдВрдЧрдарди, рд╕рдВрдЧрдардирд╛рддреНрдордХ рдЗрдХрд╛рдИ (OU), рдпрд╛ рдЦрд╛рддреЗ рдХреЗ рд▓рд┐рдП **рдЕрдзрд┐рдХрддрдо рдЕрдиреБрдорддрд┐рдпреЛрдВ** рдХреЛ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░рддреА рд╣реИрдВред рдЬрдм рдЖрдк рдЕрдкрдиреЗ рд╕рдВрдЧрдарди рдХреА рдЬрдбрд╝ рдпрд╛ рдПрдХ OU рдкрд░ SCP рд╕рдВрд▓рдЧреНрди рдХрд░рддреЗ рд╣реИрдВ, рддреЛ **SCP рд╕рджрд╕реНрдп рдЦрд╛рддреЛрдВ рдореЗрдВ рд╕рдВрд╕реНрдерд╛рдУрдВ рдХреЗ рд▓рд┐рдП рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХреЛ рд╕реАрдорд┐рдд рдХрд░рддреА рд╣реИ**ред

рдпрд╣ **рдПрдХрдорд╛рддреНрд░ рддрд░реАрдХрд╛ рд╣реИ рдХрд┐** **рд░реВрдЯ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ рдХреБрдЫ рдХрд░рдиреЗ рд╕реЗ рд░реЛрдХрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ**ред рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЛ CloudTrail рдХреЛ рдирд┐рд╖реНрдХреНрд░рд┐рдп рдХрд░рдиреЗ рдпрд╛ рдмреИрдХрдЕрдк рд╣рдЯрд╛рдиреЗ рд╕реЗ рд░реЛрдХрдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред\
рдЗрд╕рд╕реЗ рдмрдЪрдиреЗ рдХрд╛ рдПрдХрдорд╛рддреНрд░ рддрд░реАрдХрд╛ рдпрд╣ рд╣реИ рдХрд┐ **рдорд╛рд╕реНрдЯрд░ рдЦрд╛рддрд╛** рднреА рд╕рдордЭреМрддрд╛ рдХрд┐рдпрд╛ рдЬрд╛рдП рдЬреЛ SCPs рдХреЛ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░рддрд╛ рд╣реИ (рдорд╛рд╕реНрдЯрд░ рдЦрд╛рддрд╛ рдХреЛ рдЕрд╡рд░реБрджреНрдз рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛)ред

{% hint style="warning" %}
рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ **SCPs рдХреЗрд╡рд▓ рдЦрд╛рддреЗ рдореЗрдВ рдкреНрд░рд┐рдВрд╕рд┐рдкрд▓ рдХреЛ рдкреНрд░рддрд┐рдмрдВрдзрд┐рдд рдХрд░рддреА рд╣реИрдВ**, рдЗрд╕рд▓рд┐рдП рдЕрдиреНрдп рдЦрд╛рддреЗ рдкреНрд░рднрд╛рд╡рд┐рдд рдирд╣реАрдВ рд╣реЛрддреЗред рдЗрд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ `s3:GetObject` рдХреЛ рдЕрд╕реНрд╡реАрдХрд╛рд░ рдХрд░рдиреЗ рд╡рд╛рд▓рд╛ SCP рдЖрдкрдХреЗ рдЦрд╛рддреЗ рдореЗрдВ **рдПрдХ рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ S3 рдмрдХреЗрдЯ** рддрдХ рдкрд╣реБрдБрдЪрдиреЗ рд╕реЗ рд▓реЛрдЧреЛрдВ рдХреЛ рдирд╣реАрдВ рд░реЛрдХреЗрдЧрд╛ред
{% endhint %}

SCP рдЙрджрд╛рд╣рд░рдг:

* рд░реВрдЯ рдЦрд╛рддреЗ рдХреЛ рдкреВрд░реА рддрд░рд╣ рд╕реЗ рдЕрд╕реНрд╡реАрдХрд╛рд░ рдХрд░реЗрдВ
* рдХреЗрд╡рд▓ рд╡рд┐рд╢рд┐рд╖реНрдЯ рдХреНрд╖реЗрддреНрд░реЛрдВ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрдВ
* рдХреЗрд╡рд▓ рд╢реНрд╡реЗрддрд╕реВрдЪреАрдмрджреНрдз рд╕реЗрд╡рд╛рдУрдВ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрдВ
*   GuardDuty, CloudTrail, рдФрд░ S3 рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ рдмреНрд▓реЙрдХ рдПрдХреНрд╕реЗрд╕ рдХреЛ рдирд┐рд╖реНрдХреНрд░рд┐рдп рдХрд░рдиреЗ рд╕реЗ рд░реЛрдХреЗрдВ
*   рд╕реБрд░рдХреНрд╖рд╛/рдШрдЯрдирд╛ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рднреВрдорд┐рдХрд╛рдУрдВ рдХреЛ рд╣рдЯрд╛рдиреЗ рдпрд╛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░рдиреЗ рд╕реЗ рд░реЛрдХреЗрдВред
* рдмреИрдХрдЕрдк рдХреЛ рд╣рдЯрд╛рдиреЗ рд╕реЗ рд░реЛрдХреЗрдВред
* IAM рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдФрд░ рдПрдХреНрд╕реЗрд╕ рдХреБрдВрдЬрд┐рдпреЛрдВ рдХреЛ рдмрдирд╛рдиреЗ рд╕реЗ рд░реЛрдХреЗрдВ

**JSON рдЙрджрд╛рд╣рд░рдг** [https://docs.aws.amazon.com/organizations/latest/userguide/orgs\_manage\_policies\_scps\_examples.html](https://docs.aws.amazon.com/organizations/latest/userguide/orgs_manage_policies_scps_examples.html) рдореЗрдВ рдЦреЛрдЬреЗрдВ

### ARN

**Amazon Resource Name** рд╡рд╣ **рд╡рд┐рд╢рд┐рд╖реНрдЯ рдирд╛рдо** рд╣реИ рдЬреЛ AWS рдХреЗ рдЕрдВрджрд░ рд╣рд░ рд╕рдВрд╕рд╛рдзрди рдХрд╛ рд╣реЛрддрд╛ рд╣реИ, рдпрд╣ рдЗрд╕ рдкреНрд░рдХрд╛рд░ рд╕реЗ рдмрдирд╛ рд╣реЛрддрд╛ рд╣реИ:
```
arn:partition:service:region:account-id:resource-type/resource-id
arn:aws:elasticbeanstalk:us-west-1:123456789098:environment/App/Env
```
Note that there are 4 partitions in AWS but only 3 ways to call them:

* AWS Standard: `aws`
* AWS China: `aws-cn`
* AWS US public Internet (GovCloud): `aws-us-gov`
* AWS Secret (US Classified): `aws`

## IAM - рдкрд╣рдЪрд╛рди рдФрд░ рдкрд╣реБрдБрдЪ рдкреНрд░рдмрдВрдзрди

IAM рд╡рд╣ рд╕реЗрд╡рд╛ рд╣реИ рдЬреЛ рдЖрдкрдХреЛ рдЕрдкрдиреЗ AWS рдЦрд╛рддреЗ рдХреЗ рднреАрддрд░ **рдкреНрд░рдорд╛рдгреАрдХрд░рдг**, **рдЕрдзрд┐рдХрд╛рд░** рдФрд░ **рдкрд╣реБрдБрдЪ рдирд┐рдпрдВрддреНрд░рдг** рдкреНрд░рдмрдВрдзрд┐рдд рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддреА рд╣реИред

* **рдкреНрд░рдорд╛рдгреАрдХрд░рдг** - рдПрдХ рдкрд╣рдЪрд╛рди рдХреЛ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд░рдиреЗ рдФрд░ рдЙрд╕ рдкрд╣рдЪрд╛рди рдХреЗ рд╕рддреНрдпрд╛рдкрди рдХреА рдкреНрд░рдХреНрд░рд┐рдпрд╛ред рдЗрд╕ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЛ рдкрд╣рдЪрд╛рди рдФрд░ рд╕рддреНрдпрд╛рдкрди рдореЗрдВ рд╡рд┐рднрд╛рдЬрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред
* **рдЕрдзрд┐рдХрд╛рд░** - рдпрд╣ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░рддрд╛ рд╣реИ рдХрд┐ рдПрдХ рдкрд╣рдЪрд╛рди рдПрдХ рдкреНрд░рдгрд╛рд▓реА рдХреЗ рднреАрддрд░ рдХреНрдпрд╛ рдкрд╣реБрдБрдЪ рд╕рдХрддреА рд╣реИ рдЬрдм рдЗрд╕реЗ рдкреНрд░рдорд╛рдгрд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реЛред
* **рдкрд╣реБрдБрдЪ рдирд┐рдпрдВрддреНрд░рдг** - рд╕реБрд░рдХреНрд╖рд┐рдд рд╕рдВрд╕рд╛рдзрди рддрдХ рдкрд╣реБрдБрдЪ рдХреИрд╕реЗ рджреА рдЬрд╛рддреА рд╣реИ, рдЗрд╕рдХреА рд╡рд┐рдзрд┐ рдФрд░ рдкреНрд░рдХреНрд░рд┐рдпрд╛ред

IAM рдХреЛ рдЗрд╕рдХреА рдХреНрд╖рдорддрд╛ рджреНрд╡рд╛рд░рд╛ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдХрд┐ рдпрд╣ рдЖрдкрдХреЗ AWS рдЦрд╛рддреЗ рдХреЗ рднреАрддрд░ рдкрд╣рдЪрд╛рди рдХреЗ рдкреНрд░рдорд╛рдгреАрдХрд░рдг, рдЕрдзрд┐рдХрд╛рд░ рдФрд░ рдкрд╣реБрдБрдЪ рдирд┐рдпрдВрддреНрд░рдг рддрдВрддреНрд░реЛрдВ рдХрд╛ рдкреНрд░рдмрдВрдзрди, рдирд┐рдпрдВрддреНрд░рдг рдФрд░ рд╢рд╛рд╕рди рдХреИрд╕реЗ рдХрд░рддрд╛ рд╣реИред

### [AWS рдЦрд╛рддрд╛ рд░реВрдЯ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛](https://docs.aws.amazon.com/IAM/latest/UserGuide/id_root-user.html) <a href="#id_root" id="id_root"></a>

рдЬрдм рдЖрдк рдкрд╣рд▓реА рдмрд╛рд░ рдПрдХ Amazon Web Services (AWS) рдЦрд╛рддрд╛ рдмрдирд╛рддреЗ рд╣реИрдВ, рддреЛ рдЖрдк рдПрдХ рд╕рд┐рдВрдЧрд▓ рд╕рд╛рдЗрди-рдЗрди рдкрд╣рдЪрд╛рди рдХреЗ рд╕рд╛рде рд╢реБрд░реВ рдХрд░рддреЗ рд╣реИрдВ рдЬрд┐рд╕рдХреЗ рдкрд╛рд╕ рдЦрд╛рддреЗ рдореЗрдВ рд╕рднреА AWS рд╕реЗрд╡рд╛рдУрдВ рдФрд░ рд╕рдВрд╕рд╛рдзрдиреЛрдВ рддрдХ **рдкреВрд░реНрдг рдкрд╣реБрдБрдЪ** рд╣реЛрддреА рд╣реИред рдпрд╣ AWS рдЦрд╛рддрд╛ _**рд░реВрдЯ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛**_ рд╣реИ рдФрд░ рдЗрд╕реЗ **рдЙрд╕ рдИрдореЗрд▓ рдкрддреЗ рдФрд░ рдкрд╛рд╕рд╡рд░реНрдб рдХреЗ рд╕рд╛рде рд╕рд╛рдЗрди рдЗрди рдХрд░рдХреЗ рдПрдХреНрд╕реЗрд╕ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдЬрд┐рд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдЖрдкрдиреЗ рдЦрд╛рддрд╛ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдерд╛**ред

рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдПрдХ рдирдпрд╛ **рд╡реНрдпрд╡рд╕реНрдерд╛рдкрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛** рдХреЗ рдкрд╛рд╕ **рд░реВрдЯ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреА рддреБрд▓рдирд╛ рдореЗрдВ рдХрдо рдЕрдиреБрдорддрд┐рдпрд╛рдБ рд╣реЛрдВрдЧреА**ред

рд╕реБрд░рдХреНрд╖рд╛ рдХреЗ рджреГрд╖реНрдЯрд┐рдХреЛрдг рд╕реЗ, рдЕрдиреНрдп рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЛ рдмрдирд╛рдирд╛ рдФрд░ рдЗрд╕ рдПрдХ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рд╕реЗ рдмрдЪрдирд╛ рдЕрдиреБрд╢рдВрд╕рд┐рдд рд╣реИред

### [IAM рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛](https://docs.aws.amazon.com/IAM/latest/UserGuide/id_users.html) <a href="#id_iam-users" id="id_iam-users"></a>

рдПрдХ IAM _рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛_ рдПрдХ рдЗрдХрд╛рдИ рд╣реИ рдЬрд┐рд╕реЗ рдЖрдк AWS рдореЗрдВ **рдЙрд╕ рд╡реНрдпрдХреНрддрд┐ рдпрд╛ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХрд╛ рдкреНрд░рддрд┐рдирд┐рдзрд┐рддреНрд╡ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдмрдирд╛рддреЗ рд╣реИрдВ** рдЬреЛ рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ **AWS рдХреЗ рд╕рд╛рде рдмрд╛рддрдЪреАрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП** рдХрд░рддрд╛ рд╣реИред AWS рдореЗрдВ рдПрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдореЗрдВ рдПрдХ рдирд╛рдо рдФрд░ рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓ (рдкрд╛рд╕рд╡рд░реНрдб рдФрд░ рджреЛ рддрдХ рдкрд╣реБрдБрдЪ рдХреБрдВрдЬреА) рд╣реЛрддреЗ рд╣реИрдВред

рдЬрдм рдЖрдк рдПрдХ IAM рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдмрдирд╛рддреЗ рд╣реИрдВ, рддреЛ рдЖрдк рдЗрд╕реЗ **рдЕрдиреБрдорддрд┐рдпрд╛рдБ** рдкреНрд░рджрд╛рди рдХрд░рддреЗ рд╣реИрдВ, рдЗрд╕реЗ рдПрдХ **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рд╕рдореВрд╣ рдХрд╛ рд╕рджрд╕реНрдп рдмрдирд╛рдХрд░** рдЬреЛ рдЙрдкрдпреБрдХреНрдд рдЕрдиреБрдорддрд┐ рдиреАрддрд┐рдпреЛрдВ рд╕реЗ рдЬреБрдбрд╝рд╛ рд╣реЛрддрд╛ рд╣реИ (рдЕрдиреБрд╢рдВрд╕рд┐рдд), рдпрд╛ **рдкреНрд░рддреНрдпрдХреНрд╖ рд░реВрдк рд╕реЗ рдиреАрддрд┐рдпрд╛рдБ** рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рд╕реЗ рдЬреЛрдбрд╝рдХрд░ред

рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЗ рдкрд╛рд╕ **рдХрдВрд╕реЛрд▓ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд▓реЙрдЧрд┐рди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП MFA рд╕рдХреНрд╖рдо рд╣реЛ рд╕рдХрддрд╛ рд╣реИ**ред MFA рд╕рдХреНрд╖рдо рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЗ API рдЯреЛрдХрди MFA рджреНрд╡рд╛рд░рд╛ рд╕реБрд░рдХреНрд╖рд┐рдд рдирд╣реАрдВ рд╣реЛрддреЗ рд╣реИрдВред рдпрджрд┐ рдЖрдк **MFA рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреА API рдХреБрдВрдЬрд┐рдпреЛрдВ рдХреА рдкрд╣реБрдБрдЪ рдХреЛ рдкреНрд░рддрд┐рдмрдВрдзрд┐рдд рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рддреЛ рдЖрдкрдХреЛ рдиреАрддрд┐ рдореЗрдВ рдпрд╣ рдЗрдВрдЧрд┐рдд рдХрд░рдирд╛ рд╣реЛрдЧрд╛ рдХрд┐ рдХреБрдЫ рдХрд╛рд░реНрдп рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП MFA рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ (рдЙрджрд╛рд╣рд░рдг [**рдпрд╣рд╛рдБ**](https://docs.aws.amazon.com/IAM/latest/UserGuide/id_credentials_mfa_configure-api-require.html))ред

#### CLI

* **рдПрдХреНрд╕реЗрд╕ рдХреБрдВрдЬреА рдЖрдИрдбреА**: 20 рдпрд╛рджреГрдЪреНрдЫрд┐рдХ рдЕрдкрд░рдХреЗрд╕ рдЕрд▓реНрдлрд╝рд╛рдиреНрдпреВрдореЗрд░рд┐рдХ рд╡рд░реНрдг рдЬреИрд╕реЗ AKHDNAPO86BSHKDIRYT
* **рдЧреБрдкреНрдд рдПрдХреНрд╕реЗрд╕ рдХреБрдВрдЬреА рдЖрдИрдбреА**: 40 рдпрд╛рджреГрдЪреНрдЫрд┐рдХ рдЕрдкрд░ рдФрд░ рд▓реЛрдЕрд░рдХреЗрд╕ рд╡рд░реНрдг: S836fh/J73yHSb64Ag3Rkdi/jaD6sPl6/antFtU (рдЦреЛрдИ рд╣реБрдИ рдЧреБрдкреНрдд рдПрдХреНрд╕реЗрд╕ рдХреБрдВрдЬреА рдЖрдИрдбреА рдХреЛ рдкреБрдирдГ рдкреНрд░рд╛рдкреНрдд рдХрд░рдирд╛ рд╕рдВрднрд╡ рдирд╣реАрдВ рд╣реИ)ред

рдЬрдм рднреА рдЖрдкрдХреЛ **рдПрдХреНрд╕реЗрд╕ рдХреБрдВрдЬреА рдмрджрд▓рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛ** рддреЛ рдЖрдкрдХреЛ рдЗрд╕ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХрд╛ рдкрд╛рд▓рди рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдП:\
&#xNAN;_&#x43;reate a new access key -> Apply the new key to system/application -> mark original one as inactive -> Test and verify new access key is working -> Delete old access key_

### MFA - рдорд▓реНрдЯреА рдлреИрдХреНрдЯрд░ рдкреНрд░рдорд╛рдгреАрдХрд░рдг

рдпрд╣ рдЖрдкрдХреЗ рдореМрдЬреВрджрд╛ рддрд░реАрдХреЛрдВ, рдЬреИрд╕реЗ рдкрд╛рд╕рд╡рд░реНрдб рдХреЗ рдЕрддрд┐рд░рд┐рдХреНрдд **рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХреЗ рд▓рд┐рдП рдПрдХ рдЕрддрд┐рд░рд┐рдХреНрдд рдХрд╛рд░рдХ рдмрдирд╛рдиреЗ** рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЗрд╕ рдкреНрд░рдХрд╛рд░, рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХрд╛ рдПрдХ рдорд▓реНрдЯреА-рдлреИрдХреНрдЯрд░ рд╕реНрддрд░ рдмрдирд╛рддрд╛ рд╣реИред\
рдЖрдк рдПрдХ **рдирд┐:рд╢реБрд▓реНрдХ рд╡рд░реНрдЪреБрдЕрд▓ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдпрд╛ рдПрдХ рднреМрддрд┐рдХ рдЙрдкрдХрд░рдг** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред рдЖрдк AWS рдореЗрдВ MFA рд╕рдХреНрд░рд┐рдп рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдореБрдлреНрдд рдореЗрдВ рдЧреВрдЧрд▓ рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдЬреИрд╕реЗ рдРрдкреНрд╕ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

MFA рд╢рд░реНрддреЛрдВ рд╡рд╛рд▓реА рдиреАрддрд┐рдпрд╛рдБ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рд╕реЗ рдЬреЛрдбрд╝реА рдЬрд╛ рд╕рдХрддреА рд╣реИрдВ:

* рдПрдХ IAM рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдпрд╛ рд╕рдореВрд╣
* рдПрдХ рд╕рдВрд╕рд╛рдзрди рдЬреИрд╕реЗ Amazon S3 рдмрдХреЗрдЯ, Amazon SQS рдХрддрд╛рд░, рдпрд╛ Amazon SNS рд╡рд┐рд╖рдп
* рдПрдХ IAM рднреВрдорд┐рдХрд╛ рдХреА рдЯреНрд░рд╕реНрдЯ рдиреАрддрд┐ рдЬрд┐рд╕реЗ рдПрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рджреНрд╡рд╛рд░рд╛ рдЧреНрд░рд╣рдг рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ

рдпрджрд┐ рдЖрдк **CLI рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдкрд╣реБрдБрдЪ** рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдПрдХ рд╕рдВрд╕рд╛рдзрди рдЬреЛ **MFA рдХреА рдЬрд╛рдБрдЪ рдХрд░рддрд╛ рд╣реИ** рддреЛ рдЖрдкрдХреЛ **`GetSessionToken`** рдХреЙрд▓ рдХрд░рдирд╛ рд╣реЛрдЧрд╛ред рдпрд╣ рдЖрдкрдХреЛ MFA рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд╕рд╛рде рдПрдХ рдЯреЛрдХрди рджреЗрдЧрд╛ред\
рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ **`AssumeRole` рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдореЗрдВ рдпрд╣ рдЬрд╛рдирдХрд╛рд░реА рдирд╣реАрдВ рд╣реЛрддреА**ред
```bash
aws sts get-session-token --serial-number <arn_device> --token-code <code>
```
As [**рдпрд╣рд╛рдВ рдХрд╣рд╛ рдЧрдпрд╛ рд╣реИ**](https://docs.aws.amazon.com/IAM/latest/UserGuide/id_credentials_mfa_configure-api-require.html), рдХрдИ рдЕрд▓рдЧ-рдЕрд▓рдЧ рдорд╛рдорд▓реЗ рд╣реИрдВ рдЬрд╣рд╛рдВ **MFA рдХрд╛ рдЙрдкрдпреЛрдЧ рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛**ред

### [IAM рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рд╕рдореВрд╣](https://docs.aws.amazon.com/IAM/latest/UserGuide/id_groups.html) <a href="#id_iam-groups" id="id_iam-groups"></a>

рдПрдХ IAM [рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рд╕рдореВрд╣](https://docs.aws.amazon.com/IAM/latest/UserGuide/id_groups.html) рдПрдХ рдРрд╕рд╛ рддрд░реАрдХрд╛ рд╣реИ рдЬрд┐рд╕рд╕реЗ **рдПрдХ рд╕рдордп рдореЗрдВ рдХрдИ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЗ рд▓рд┐рдП рдиреАрддрд┐рдпреЛрдВ рдХреЛ рд╕рдВрд▓рдЧреНрди рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ**, рдЬрд┐рд╕рд╕реЗ рдЙрди рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЗ рд▓рд┐рдП рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХрд╛ рдкреНрд░рдмрдВрдзрди рдХрд░рдирд╛ рдЖрд╕рд╛рди рд╣реЛ рд╕рдХрддрд╛ рд╣реИред **рднреВрдорд┐рдХрд╛рдПрдБ рдФрд░ рд╕рдореВрд╣ рд╕рдореВрд╣ рдХрд╛ рд╣рд┐рд╕реНрд╕рд╛ рдирд╣реАрдВ рд╣реЛ рд╕рдХрддреЗ**ред

рдЖрдк рдПрдХ **рдкрд╣рдЪрд╛рди-рдЖрдзрд╛рд░рд┐рдд рдиреАрддрд┐ рдХреЛ рдПрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рд╕рдореВрд╣ рдореЗрдВ рд╕рдВрд▓рдЧреНрди рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ** рддрд╛рдХрд┐ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рд╕рдореВрд╣ рдореЗрдВ рд╕рднреА **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЛ рдиреАрддрд┐ рдХреА рдЕрдиреБрдорддрд┐рдпрд╛рдБ рдкреНрд░рд╛рдкреНрдд рд╣реЛрдВ**ред рдЖрдк **рдПрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рд╕рдореВрд╣** рдХреЛ **`Principal`** рдХреЗ рд░реВрдк рдореЗрдВ **рдиреАрддрд┐** (рдЬреИрд╕реЗ рд╕рдВрд╕рд╛рдзрди-рдЖрдзрд╛рд░рд┐рдд рдиреАрддрд┐) рдореЗрдВ рдкрд╣рдЪрд╛рди рдирд╣реАрдВ рд╕рдХрддреЗ рдХреНрдпреЛрдВрдХрд┐ рд╕рдореВрд╣ рдЕрдиреБрдорддрд┐рдпреЛрдВ рд╕реЗ рд╕рдВрдмрдВрдзрд┐рдд рд╣реЛрддреЗ рд╣реИрдВ, рдкреНрд░рдорд╛рдгреАрдХрд░рдг рд╕реЗ рдирд╣реАрдВ, рдФрд░ рдкреНрд░рд┐рдВрд╕рд┐рдкрд▓ рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХрд┐рдП рдЧрдП IAM рд╕рдВрд╕реНрдерд╛рдПрдБ рд╣реЛрддреА рд╣реИрдВред

рдпрд╣рд╛рдБ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рд╕рдореВрд╣реЛрдВ рдХреА рдХреБрдЫ рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╡рд┐рд╢реЗрд╖рддрд╛рдПрдБ рд╣реИрдВ:

* рдПрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ **рд╕рдореВрд╣** **рдХрдИ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ** рдХреЛ **рд╢рд╛рдорд┐рд▓ рдХрд░ рд╕рдХрддрд╛ рд╣реИ**, рдФрд░ рдПрдХ **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛** **рдХрдИ рд╕рдореВрд╣реЛрдВ** рдХрд╛ **рднрд╛рдЧ рд╣реЛ рд╕рдХрддрд╛ рд╣реИ**ред
* **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рд╕рдореВрд╣реЛрдВ рдХреЛ рдиреЗрд╕реНрдЯ рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛**; рд╡реЗ рдХреЗрд╡рд▓ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЛ рд╢рд╛рдорд┐рд▓ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдЕрдиреНрдп рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рд╕рдореВрд╣реЛрдВ рдХреЛ рдирд╣реАрдВред
* **AWS рдЦрд╛рддреЗ рдореЗрдВ рд╕рднреА рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЛ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ рд╢рд╛рдорд┐рд▓ рдХрд░рдиреЗ рд╡рд╛рд▓рд╛ рдХреЛрдИ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рд╕рдореВрд╣ рдирд╣реАрдВ рд╣реИ**ред рдпрджрд┐ рдЖрдк рдРрд╕рд╛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рд╕рдореВрд╣ рд░рдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ, рддреЛ рдЖрдкрдХреЛ рдЗрд╕реЗ рдмрдирд╛рдирд╛ рд╣реЛрдЧрд╛ рдФрд░ рдкреНрд░рддреНрдпреЗрдХ рдирдП рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ рдЗрд╕рдореЗрдВ рдЕрд╕рд╛рдЗрди рдХрд░рдирд╛ рд╣реЛрдЧрд╛ред
* AWS рдЦрд╛рддреЗ рдореЗрдВ IAM рд╕рдВрд╕рд╛рдзрдиреЛрдВ рдХреА рд╕рдВрдЦреНрдпрд╛ рдФрд░ рдЖрдХрд╛рд░, рдЬреИрд╕реЗ рд╕рдореВрд╣реЛрдВ рдХреА рд╕рдВрдЦреНрдпрд╛, рдФрд░ рдПрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЬрд┐рд╕ рд╕рдореВрд╣ рдХрд╛ рд╕рджрд╕реНрдп рд╣реЛ рд╕рдХрддрд╛ рд╣реИ, рд╕реАрдорд┐рдд рд╣реИрдВред рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП, [IAM рдФрд░ AWS STS рдХреЛрдЯрд╛](https://docs.aws.amazon.com/IAM/latest/UserGuide/reference_iam-quotas.html) рджреЗрдЦреЗрдВред

### [IAM рднреВрдорд┐рдХрд╛рдПрдБ](https://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles.html) <a href="#id_iam-roles" id="id_iam-roles"></a>

рдПрдХ IAM **рднреВрдорд┐рдХрд╛** рдПрдХ **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛** рдХреЗ рд╕рдорд╛рди рд╣реИ, рдХреНрдпреЛрдВрдХрд┐ рдпрд╣ рдПрдХ **рдкрд╣рдЪрд╛рди рд╣реИ рдЬрд┐рд╕рдореЗрдВ рдЕрдиреБрдорддрд┐ рдиреАрддрд┐рдпрд╛рдБ рд╣реЛрддреА рд╣реИрдВ рдЬреЛ рдпрд╣ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░рддреА рд╣реИрдВ рдХрд┐** рдпрд╣ AWS рдореЗрдВ рдХреНрдпрд╛ рдХрд░ рд╕рдХрддрд╛ рд╣реИ рдФрд░ рдХреНрдпрд╛ рдирд╣реАрдВред рд╣рд╛рд▓рд╛рдБрдХрд┐, рдПрдХ рднреВрдорд┐рдХрд╛ рдХреЗ рд╕рд╛рде **рдХреЛрдИ рдкреНрд░рдорд╛рдг-рдкрддреНрд░** (рдкрд╛рд╕рд╡рд░реНрдб рдпрд╛ рдПрдХреНрд╕реЗрд╕ рдХреБрдВрдЬреА) рдирд╣реАрдВ рд╣реЛрддрд╛ рд╣реИред рдПрдХ рд╡реНрдпрдХреНрддрд┐ рдХреЗ рд╕рд╛рде рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ рдЬреБрдбрд╝рдиреЗ рдХреЗ рдмрдЬрд╛рдп, рдПрдХ рднреВрдорд┐рдХрд╛ рдХреЛ **рдХрд┐рд╕реА рднреА рд╡реНрдпрдХреНрддрд┐ рджреНрд╡рд╛рд░рд╛ рдЕрдкрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдбрд┐рдЬрд╝рд╛рдЗрди рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ рдЬрд┐рд╕реЗ рдЗрд╕рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ (рдФрд░ рдЬрд┐рд╕рдХреЗ рдкрд╛рд╕ рдкрд░реНрдпрд╛рдкреНрдд рдЕрдиреБрдорддрд┐рдпрд╛рдБ рд╣реИрдВ)**ред рдПрдХ **IAM рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдПрдХ рднреВрдорд┐рдХрд╛ рдХреЛ рдЕрд╕реНрдерд╛рдпреА рд░реВрдк рд╕реЗ** рдПрдХ рд╡рд┐рд╢рд┐рд╖реНрдЯ рдХрд╛рд░реНрдп рдХреЗ рд▓рд┐рдП рд╡рд┐рднрд┐рдиреНрди рдЕрдиреБрдорддрд┐рдпрд╛рдБ рд▓реЗрдиреЗ рдХреЗ рд▓рд┐рдП рдЕрдкрдирд╛ рд╕рдХрддрд╛ рд╣реИред рдПрдХ рднреВрдорд┐рдХрд╛ рдХреЛ рдПрдХ [**рд╕рдВрдШреАрдп рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛**](https://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles_providers.html) рдХреЛ рдЕрд╕рд╛рдЗрди рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдЬреЛ IAM рдХреЗ рдмрдЬрд╛рдп рдПрдХ рдмрд╛рд╣рд░реА рдкрд╣рдЪрд╛рди рдкреНрд░рджрд╛рддрд╛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд╕рд╛рдЗрди рдЗрди рдХрд░рддрд╛ рд╣реИред

рдПрдХ IAM рднреВрдорд┐рдХрд╛ рдореЗрдВ **рджреЛ рдкреНрд░рдХрд╛рд░ рдХреА рдиреАрддрд┐рдпрд╛рдБ** рд╣реЛрддреА рд╣реИрдВ: рдПрдХ **рд╡рд┐рд╢реНрд╡рд╛рд╕ рдиреАрддрд┐**, рдЬреЛ рдЦрд╛рд▓реА рдирд╣реАрдВ рд╣реЛ рд╕рдХрддреА, рдпрд╣ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд░рддреА рд╣реИ рдХрд┐ **рдХреМрди рднреВрдорд┐рдХрд╛ рдХреЛ рдЕрдкрдирд╛рдиреЗ** рдХрд╛ рдЕрдзрд┐рдХрд╛рд░ рд░рдЦрддрд╛ рд╣реИ, рдФрд░ рдПрдХ **рдЕрдиреБрдорддрд┐ рдиреАрддрд┐**, рдЬреЛ рдЦрд╛рд▓реА рдирд╣реАрдВ рд╣реЛ рд╕рдХрддреА, рдпрд╣ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд░рддреА рд╣реИ рдХрд┐ **рдпрд╣ рдХреНрдпрд╛ рдПрдХреНрд╕реЗрд╕ рдХрд░ рд╕рдХрддрд╛ рд╣реИ**ред

#### AWS рд╕реБрд░рдХреНрд╖рд╛ рдЯреЛрдХрди рд╕реЗрд╡рд╛ (STS)

AWS рд╕реБрд░рдХреНрд╖рд╛ рдЯреЛрдХрди рд╕реЗрд╡рд╛ (STS) рдПрдХ рд╡реЗрдм рд╕реЗрд╡рд╛ рд╣реИ рдЬреЛ **рдЕрд╕реНрдерд╛рдпреА, рд╕реАрдорд┐рдд-рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдкреНрд░рдорд╛рдг-рдкрддреНрд░реЛрдВ рдХреЗ рдЬрд╛рд░реА рдХрд░рдиреЗ рдХреА рд╕реБрд╡рд┐рдзрд╛ рдкреНрд░рджрд╛рди рдХрд░рддреА рд╣реИ**ред рдпрд╣ рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХреЗ рд▓рд┐рдП рддреИрдпрд╛рд░ рдХреА рдЧрдИ рд╣реИ:

### [IAM рдореЗрдВ рдЕрд╕реНрдерд╛рдпреА рдкреНрд░рдорд╛рдг-рдкрддреНрд░](https://docs.aws.amazon.com/IAM/latest/UserGuide/id_credentials_temp.html) <a href="#id_temp-creds" id="id_temp-creds"></a>

**рдЕрд╕реНрдерд╛рдпреА рдкреНрд░рдорд╛рдг-рдкрддреНрд░ рдореБрдЦреНрдп рд░реВрдк рд╕реЗ IAM рднреВрдорд┐рдХрд╛рдУрдВ рдХреЗ рд╕рд╛рде рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВ**, рд▓реЗрдХрд┐рди рдЗрд╕рдХреЗ рдЕрдиреНрдп рдЙрдкрдпреЛрдЧ рднреА рд╣реИрдВред рдЖрдк рдЕрд╕реНрдерд╛рдпреА рдкреНрд░рдорд╛рдг-рдкрддреНрд░реЛрдВ рдХреЗ рд▓рд┐рдП рдЕрдиреБрд░реЛрдз рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдЬрд┐рдирдореЗрдВ рдЖрдкрдХреЗ рдорд╛рдирдХ IAM рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреА рддреБрд▓рдирд╛ рдореЗрдВ рдЕрдзрд┐рдХ рд╕реАрдорд┐рдд рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХрд╛ рд╕реЗрдЯ рд╣реЛрддрд╛ рд╣реИред рдпрд╣ **рдЖрдкрдХреЛ** **рдЕрдиреБрдорддрд┐ рдирд╣реАрдВ рджрд┐рдП рдЧрдП рдХрд╛рд░реНрдпреЛрдВ рдХреЛ рдЧрд▓рддреА рд╕реЗ рдХрд░рдиреЗ рд╕реЗ рд░реЛрдХрддрд╛ рд╣реИ**ред рдЕрд╕реНрдерд╛рдпреА рдкреНрд░рдорд╛рдг-рдкрддреНрд░реЛрдВ рдХрд╛ рдПрдХ рд▓рд╛рдн рдпрд╣ рд╣реИ рдХрд┐ рд╡реЗ рдПрдХ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рд╕рдордп рдХреЗ рдмрд╛рдж рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ рд╕рдорд╛рдкреНрдд рд╣реЛ рдЬрд╛рддреЗ рд╣реИрдВред рдЖрдкрдХреЗ рдкрд╛рд╕ рдпрд╣ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░рдиреЗ рдХреА рдХреНрд╖рдорддрд╛ рд╣реИ рдХрд┐ рдкреНрд░рдорд╛рдг-рдкрддреНрд░ рдХрд┐рддрдиреЗ рд╕рдордп рддрдХ рдорд╛рдиреНрдп рд╣реИрдВред

### рдиреАрддрд┐рдпрд╛рдБ

#### рдиреАрддрд┐ рдЕрдиреБрдорддрд┐рдпрд╛рдБ

рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХреЛ рдЕрд╕рд╛рдЗрди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХреА рдЬрд╛рддреА рд╣реИрдВред 2 рдкреНрд░рдХрд╛рд░ рд╣реИрдВ:

* AWS рдкреНрд░рдмрдВрдзрд┐рдд рдиреАрддрд┐рдпрд╛рдБ (AWS рджреНрд╡рд╛рд░рд╛ рдкреВрд░реНрд╡-рдирд┐рд░реНрдзрд╛рд░рд┐рдд)
* рдЧреНрд░рд╛рд╣рдХ рдкреНрд░рдмрдВрдзрд┐рдд рдиреАрддрд┐рдпрд╛рдБ: рдЖрдкрдХреЗ рджреНрд╡рд╛рд░рд╛ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХреА рдЧрдИред рдЖрдк AWS рдкреНрд░рдмрдВрдзрд┐рдд рдиреАрддрд┐рдпреЛрдВ рдХреЗ рдЖрдзрд╛рд░ рдкрд░ рдиреАрддрд┐рдпрд╛рдБ рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВ (рдЙрдирдореЗрдВ рд╕реЗ рдПрдХ рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░рдХреЗ рдФрд░ рдЕрдкрдиреА рдЦреБрдж рдХреА рдмрдирд╛рдХрд░), рдиреАрддрд┐ рдЬрдирд░реЗрдЯрд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ (рдПрдХ GUI рджреГрд╢реНрдп рдЬреЛ рдЖрдкрдХреЛ рдЕрдиреБрдорддрд┐рдпрд╛рдБ рджреЗрдиреЗ рдФрд░ рдЕрд╕реНрд╡реАрдХрд╛рд░ рдХрд░рдиреЗ рдореЗрдВ рдорджрдж рдХрд░рддрд╛ рд╣реИ) рдпрд╛ рдЕрдкрдиреА рдЦреБрдж рдХреА рд▓рд┐рдЦрдХрд░ред

**рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ рдкрд╣реБрдБрдЪ** **рдЕрд╕реНрд╡реАрдХреГрдд** рд╣реИ, рдкрд╣реБрдБрдЪ рддрдм рджреА рдЬрд╛рдПрдЧреА рдЬрдм рдПрдХ рд╕реНрдкрд╖реНрдЯ рднреВрдорд┐рдХрд╛ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХреА рдЧрдИ рд╣реЛред\
рдпрджрд┐ **рдПрдХрд▓ "Deny" рдореМрдЬреВрдж рд╣реИ, рддреЛ рдпрд╣ "Allow" рдХреЛ рдУрд╡рд░рд░рд╛рдЗрдб рдХрд░реЗрдЧрд╛**, рд╕рд┐рд╡рд╛рдп рдЙрди рдЕрдиреБрд░реЛрдзреЛрдВ рдХреЗ рдЬреЛ AWS рдЦрд╛рддреЗ рдХреЗ рд░реВрдЯ рд╕реБрд░рдХреНрд╖рд╛ рдкреНрд░рдорд╛рдг-рдкрддреНрд░реЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВ (рдЬреЛ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ рдЕрдиреБрдорддрд┐ рджреА рдЬрд╛рддреА рд╣реИрдВ)ред
```javascript
{
"Version": "2012-10-17",  //Version of the policy
"Statement": [  //Main element, there can be more than 1 entry in this array
{
"Sid": "Stmt32894y234276923" //Unique identifier (optional)
"Effect": "Allow", //Allow or deny
"Action": [  //Actions that will be allowed or denied
"ec2:AttachVolume",
"ec2:DetachVolume"
],
"Resource": [ //Resource the action and effect will be applied to
"arn:aws:ec2:*:*:volume/*",
"arn:aws:ec2:*:*:instance/*"
],
"Condition": { //Optional element that allow to control when the permission will be effective
"ArnEquals": {"ec2:SourceInstanceARN": "arn:aws:ec2:*:*:instance/instance-id"}
}
}
]
}
```
The [global fields that can be used for conditions in any service are documented here](https://docs.aws.amazon.com/IAM/latest/UserGuide/reference_policies_condition-keys.html#condition-keys-resourceaccount).\
The [specific fields that can be used for conditions per service are documented here](https://docs.aws.amazon.com/service-authorization/latest/reference/reference_policies_actions-resources-contextkeys.html).

#### Inline Policies

рдЗрд╕ рдкреНрд░рдХрд╛рд░ рдХреА рдиреАрддрд┐рдпрд╛рдБ **рдкреНрд░рддреНрдпрдХреНрд╖ рд░реВрдк рд╕реЗ** рдПрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛, рд╕рдореВрд╣ рдпрд╛ рднреВрдорд┐рдХрд╛ рдХреЛ рдЕрд╕рд╛рдЗрди рдХреА рдЬрд╛рддреА рд╣реИрдВред рдлрд┐рд░, рд╡реЗ рдиреАрддрд┐рдпреЛрдВ рдХреА рд╕реВрдЪреА рдореЗрдВ рдирд╣реАрдВ рджрд┐рдЦрд╛рдИ рджреЗрддреАрдВ рдХреНрдпреЛрдВрдХрд┐ рдХреЛрдИ рдЕрдиреНрдп рдЙрдирдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддрд╛ рд╣реИред\
рдЗрдирд▓рд╛рдЗрди рдиреАрддрд┐рдпрд╛рдБ рдЙрдкрдпреЛрдЧреА рд╣реЛрддреА рд╣реИрдВ рдпрджрд┐ рдЖрдк **рдиреАрддрд┐ рдФрд░ рдЙрд╕ рдкрд╣рдЪрд╛рди рдХреЗ рдмреАрдЪ рдПрдХ рд╕рдЦреНрдд рдПрдХ-рд╕реЗ-рдПрдХ рд╕рдВрдмрдВрдз рдмрдирд╛рдП рд░рдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рдЬрд┐рд╕ рдкрд░ рдЗрд╕реЗ рд▓рд╛рдЧреВ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдЖрдк рдпрд╣ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдХрд┐ рдиреАрддрд┐ рдореЗрдВ рдЕрдиреБрдорддрд┐рдпрд╛рдБ рдЕрдирдЬрд╛рдиреЗ рдореЗрдВ рдХрд┐рд╕реА рдЕрдиреНрдп рдкрд╣рдЪрд╛рди рдХреЛ рдЕрд╕рд╛рдЗрди рдирд╣реАрдВ рдХреА рдЧрдИ рд╣реИрдВред рдЬрдм рдЖрдк рдПрдХ рдЗрдирд▓рд╛рдЗрди рдиреАрддрд┐ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВ, рддреЛ рдиреАрддрд┐ рдореЗрдВ рдЕрдиреБрдорддрд┐рдпрд╛рдБ рдЕрдирдЬрд╛рдиреЗ рдореЗрдВ рдЧрд▓рдд рдкрд╣рдЪрд╛рди рд╕реЗ рдирд╣реАрдВ рдЬреБрдбрд╝ рд╕рдХрддреАрдВред рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдЬрдм рдЖрдк AWS рдкреНрд░рдмрдВрдзрди рдХрдВрд╕реЛрд▓ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЙрд╕ рдкрд╣рдЪрд╛рди рдХреЛ рд╣рдЯрд╛рддреЗ рд╣реИрдВ, рддреЛ рдкрд╣рдЪрд╛рди рдореЗрдВ рдирд┐рд╣рд┐рдд рдиреАрддрд┐рдпрд╛рдБ рднреА рд╣рдЯрд╛ рджреА рдЬрд╛рддреА рд╣реИрдВред рдЗрд╕рдХрд╛ рдХрд╛рд░рдг рдпрд╣ рд╣реИ рдХрд┐ рд╡реЗ рдкреНрд░рдореБрдЦ рдЗрдХрд╛рдИ рдХрд╛ рд╣рд┐рд╕реНрд╕рд╛ рд╣реИрдВред

#### Resource Bucket Policies

рдпреЗ **рдиреАрддрд┐рдпрд╛рдБ** рд╣реИрдВ рдЬрд┐рдиреНрд╣реЗрдВ **рд╕рдВрд╕рд╛рдзрдиреЛрдВ** рдореЗрдВ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред **AWS рдХреЗ рд╕рднреА рд╕рдВрд╕рд╛рдзрди рдЙрдирдХрд╛ рд╕рдорд░реНрдерди рдирд╣реАрдВ рдХрд░рддреЗ**ред

рдпрджрд┐ рдПрдХ рдкреНрд░рдореБрдЦ рдХреЗ рдкрд╛рд╕ рдЙрди рдкрд░ рд╕реНрдкрд╖реНрдЯ рдЕрд╕реНрд╡реАрдХреГрддрд┐ рдирд╣реАрдВ рд╣реИ, рдФрд░ рдПрдХ рд╕рдВрд╕рд╛рдзрди рдиреАрддрд┐ рдЙрдиреНрд╣реЗрдВ рдкрд╣реБрдБрдЪ рдкреНрд░рджрд╛рди рдХрд░рддреА рд╣реИ, рддреЛ рдЙрдиреНрд╣реЗрдВ рдЕрдиреБрдорддрд┐ рджреА рдЬрд╛рддреА рд╣реИред

### IAM Boundaries

IAM рд╕реАрдорд╛рдПрдБ **рдПрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдпрд╛ рднреВрдорд┐рдХрд╛ рдХреЛ рдкрд╣реБрдБрдЪ рдХреА рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХреЛ рд╕реАрдорд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП** рдЙрдкрдпреЛрдЧ рдХреА рдЬрд╛ рд╕рдХрддреА рд╣реИрдВред рдЗрд╕ рддрд░рд╣, рднрд▓реЗ рд╣реА рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ **рд╡рд┐рднрд┐рдиреНрди рдиреАрддрд┐** рджреНрд╡рд╛рд░рд╛ рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХрд╛ рдПрдХ рдЕрд▓рдЧ рд╕реЗрдЯ рджрд┐рдпрд╛ рдЧрдпрд╛ рд╣реЛ, рдпрджрд┐ рд╡рд╣ рдЙрдирдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░рддрд╛ рд╣реИ рддреЛ рд╕рдВрдЪрд╛рд▓рди **рд╡рд┐рдлрд▓** рд╣реЛ рдЬрд╛рдПрдЧрд╛ред

рдПрдХ рд╕реАрдорд╛ рдмрд╕ рдПрдХ рдиреАрддрд┐ рд╣реИ рдЬреЛ рдПрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рд╕реЗ рдЬреБрдбрд╝реА рд╣реЛрддреА рд╣реИ рдЬреЛ **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдпрд╛ рднреВрдорд┐рдХрд╛ рдХреЗ рдкрд╛рд╕ рдЕрдзрд┐рдХрддрдо рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХреЗ рд╕реНрддрд░ рдХреЛ рдЗрдВрдЧрд┐рдд рдХрд░рддреА рд╣реИ**ред рдЗрд╕рд▓рд┐рдП, **рднрд▓реЗ рд╣реА рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рдкрд╛рд╕ рд╡реНрдпрд╡рд╕реНрдерд╛рдкрдХ рдкрд╣реБрдБрдЪ рд╣реЛ**, рдпрджрд┐ рд╕реАрдорд╛ рдЗрдВрдЧрд┐рдд рдХрд░рддреА рд╣реИ рдХрд┐ рд╡рд╣ рдХреЗрд╡рд▓ S┬╖ рдмрдХреЗрдЯ рдкрдврд╝ рд╕рдХрддрд╛ рд╣реИ, рддреЛ рдпрд╣реА рдЕрдзрд┐рдХрддрдо рд╣реИ рдЬреЛ рд╡рд╣ рдХрд░ рд╕рдХрддрд╛ рд╣реИред

**рдпрд╣**, **SCPs** рдФрд░ **рдХрдо рд╕реЗ рдХрдо рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░** рд╕рд┐рджреНрдзрд╛рдВрдд рдХрд╛ рдкрд╛рд▓рди рдХрд░рдирд╛ рдЙрди рддрд░реАрдХреЛрдВ рдореЗрдВ рд╕реЗ рд╣реИрдВ рдЬрд┐рдирд╕реЗ рдпрд╣ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдХрд┐ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЗ рдкрд╛рд╕ рдЙрдирдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛рдУрдВ рд╕реЗ рдЕрдзрд┐рдХ рдЕрдиреБрдорддрд┐рдпрд╛рдБ рдирд╣реАрдВ рд╣реИрдВред

### Session Policies

рдПрдХ рд╕рддреНрд░ рдиреАрддрд┐ рдПрдХ **рдиреАрддрд┐ рд╣реИ рдЬреЛ рддрдм рд╕реЗрдЯ рдХреА рдЬрд╛рддреА рд╣реИ рдЬрдм рдХрд┐рд╕реА рднреВрдорд┐рдХрд╛ рдХреЛ рдХрд┐рд╕реА рддрд░рд╣ рд╕реЗ рдЧреНрд░рд╣рдг рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ**ред рдпрд╣ рдЙрд╕ рд╕рддреНрд░ рдХреЗ рд▓рд┐рдП рдПрдХ **IAM рд╕реАрдорд╛** рдХреА рддрд░рд╣ рд╣реЛрдЧреА: рдЗрд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ рд╕рддреНрд░ рдиреАрддрд┐ рдЕрдиреБрдорддрд┐рдпрд╛рдБ рдирд╣реАрдВ рджреЗрддреА рдмрд▓реНрдХрд┐ **рдЙрдиреНрд╣реЗрдВ рдиреАрддрд┐ рдореЗрдВ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдЕрдиреБрдорддрд┐рдпреЛрдВ рддрдХ рд╕реАрдорд┐рдд рдХрд░рддреА рд╣реИ** (рдЕрдзрд┐рдХрддрдо рдЕрдиреБрдорддрд┐рдпрд╛рдБ рд╡реЗ рд╣реЛрддреА рд╣реИрдВ рдЬреЛ рднреВрдорд┐рдХрд╛ рдХреЗ рдкрд╛рд╕ рд╣реЛрддреА рд╣реИрдВ)ред

рдпрд╣ **рд╕реБрд░рдХреНрд╖рд╛ рдЙрдкрд╛рдпреЛрдВ** рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧреА рд╣реИ: рдЬрдм рдПрдХ рд╡реНрдпрд╡рд╕реНрдерд╛рдкрдХ рдПрдХ рдмрд╣реБрдд рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдкреНрд░рд╛рдкреНрдд рднреВрдорд┐рдХрд╛ рдЧреНрд░рд╣рдг рдХрд░рдиреЗ рдЬрд╛ рд░рд╣рд╛ рд╣реИ, рддреЛ рд╡рд╣ рд╕рддреНрд░ рдиреАрддрд┐ рдореЗрдВ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдЕрдиреБрдорддрд┐рдпреЛрдВ рддрдХ рд╣реА рдЕрдиреБрдорддрд┐ рдХреЛ рд╕реАрдорд┐рдд рдХрд░ рд╕рдХрддрд╛ рд╣реИ рдпрджрд┐ рд╕рддреНрд░ рд╕реЗ рд╕рдордЭреМрддрд╛ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред
```bash
aws sts assume-role \
--role-arn <value> \
--role-session-name <value> \
[--policy-arns <arn_custom_policy1> <arn_custom_policy2>]
[--policy <file://policy.json>]
```
Note that by default **AWS might add session policies to sessions** that are going to be generated because of third reasons. For example, in [unauthenticated cognito assumed roles](../aws-services/aws-cognito-enum/cognito-identity-pools.md#accessing-iam-roles) by default (using enhanced authentication), AWS will generate **session credentials with a session policy** that limits the services that session can access [**to the following list**](https://docs.aws.amazon.com/cognito/latest/developerguide/iam-roles.html#access-policies-scope-down-services).

Therefore, if at some point you face the error "... because no session policy allows the ...", and the role has access to perform the action, it's because **there is a session policy preventing it**.

### рдкрд╣рдЪрд╛рди рд╕рдВрдШ

Identity federation **allows users from identity providers which are external** to AWS to access AWS resources securely without having to supply AWS user credentials from a valid IAM user account.\
An example of an identity provider can be your own corporate **Microsoft Active Directory** (via **SAML**) or **OpenID** services (like **Google**). Federated access will then allow the users within it to access AWS.

To configure this trust, an **IAM Identity Provider is generated (SAML or OAuth)** that will **trust** the **other platform**. Then, at least one **IAM role is assigned (trusting) to the Identity Provider**. If a user from the trusted platform access AWS, he will be accessing as the mentioned role.

However, you will usually want to give a **different role depending on the group of the user** in the third party platform. Then, several **IAM roles can trust** the third party Identity Provider and the third party platform will be the one allowing users to assume one role or the other.

<figure><img src="../../../.gitbook/assets/image (247).png" alt=""><figcaption></figcaption></figure>

### IAM рдкрд╣рдЪрд╛рди рдХреЗрдВрджреНрд░

AWS IAM Identity Center (successor to AWS Single Sign-On) expands the capabilities of AWS Identity and Access Management (IAM) to provide a **central plac**e that brings together **administration of users and their access to AWS** accounts and cloud applications.

The login domain is going to be something like `<user_input>.awsapps.com`.

To login users, there are 3 identity sources that can be used:

* Identity Center Directory: Regular AWS users
* Active Directory: Supports different connectors
* External Identity Provider: All users and groups come from an external Identity Provider (IdP)

<figure><img src="../../../.gitbook/assets/image (279).png" alt=""><figcaption></figcaption></figure>

In the simplest case of Identity Center directory, the **Identity Center will have a list of users & groups** and will be able to **assign policies** to them to **any of the accounts** of the organization.

In order to give access to a Identity Center user/group to an account a **SAML Identity Provider trusting the Identity Center will be created**, and a **role trusting the Identity Provider with the indicated policies will be created** in the destination account.

#### AwsSSOInlinePolicy

It's possible to **give permissions via inline policies to roles created via IAM Identity Center**. The roles created in the accounts being given **inline policies in AWS Identity Center** will have these permissions in an inline policy called **`AwsSSOInlinePolicy`**.

Therefore, even if you see 2 roles with an inline policy called **`AwsSSOInlinePolicy`**, it **doesn't mean it has the same permissions**.

### рдХреНрд░реЙрд╕ рдЦрд╛рддрд╛ рд╡рд┐рд╢реНрд╡рд╛рд╕ рдФрд░ рднреВрдорд┐рдХрд╛рдПрдБ

**A user** (trusting) can create a Cross Account Role with some policies and then, **allow another user** (trusted) to **access his account** but only **having the access indicated in the new role policies**. To create this, just create a new Role and select Cross Account Role. Roles for Cross-Account Access offers two options. Providing access between AWS accounts that you own, and providing access between an account that you own and a third party AWS account.\
It's recommended to **specify the user who is trusted and not put some generic thing** because if not, other authenticated users like federated users will be able to also abuse this trust.

### AWS рд╕рд░рд▓ AD

Not supported:

* Trust Relations
* AD Admin Center
* Full PS API support
* AD Recycle Bin
* Group Managed Service Accounts
* Schema Extensions
* No Direct access to OS or Instances

#### рд╡реЗрдм рд╕рдВрдШ рдпрд╛ OpenID рдкреНрд░рдорд╛рдгреАрдХрд░рдг

The app uses the AssumeRoleWithWebIdentity to create temporary credentials. However, this doesn't grant access to the AWS console, just access to resources within AWS.

### рдЕрдиреНрдп IAM рд╡рд┐рдХрд▓реНрдк

* You can **set a password policy setting** options like minimum length and password requirements.
* You can **download "Credential Report"** with information about current credentials (like user creation time, is password enabled...). You can generate a credential report as often as once every **four hours**.

AWS Identity and Access Management (IAM) provides **fine-grained access control** across all of AWS. With IAM, you can specify **who can access which services and resources**, and under which conditions. With IAM policies, you manage permissions to your workforce and systems to **ensure least-privilege permissions**.

### IAM ID рдЙрдкрд╕рд░реНрдЧ

In [**this page**](https://docs.aws.amazon.com/IAM/latest/UserGuide/reference_identifiers.html#identifiers-unique-ids) you can find the **IAM ID prefixe**d of keys depending on their nature:

| ABIA | [AWS STS service bearer token](https://docs.aws.amazon.com/IAM/latest/UserGuide/id_credentials_bearer.html)                                                                                                          |
| ---- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| ACCA | Context-specific credential                                                                                                                                                                                          |
| AGPA | User group                                                                                                                                                                                                           |
| AIDA | IAM user                                                                                                                                                                                                             |
| AIPA | Amazon EC2 instance profile                                                                                                                                                                                          |
| AKIA | Access key                                                                                                                                                                                                           |
| ANPA | Managed policy                                                                                                                                                                                                       |
| ANVA | Version in a managed policy                                                                                                                                                                                          |
| APKA | Public key                                                                                                                                                                                                           |
| AROA | Role                                                                                                                                                                                                                 |
| ASCA | Certificate                                                                                                                                                                                                          |
| ASIA | [Temporary (AWS STS) access key IDs](https://docs.aws.amazon.com/STS/latest/APIReference/API_Credentials.html) use this prefix, but are unique only in combination with the secret access key and the session token. |

### Recommended permissions to audit accounts

The following privileges grant various read access of metadata:

* `arn:aws:iam::aws:policy/SecurityAudit`
* `arn:aws:iam::aws:policy/job-function/ViewOnlyAccess`
* `codebuild:ListProjects`
* `config:Describe*`
* `cloudformation:ListStacks`
* `logs:DescribeMetricFilters`
* `directconnect:DescribeConnections`
* `dynamodb:ListTables`

## рд╡рд┐рд╡рд┐рдз

### CLI рдкреНрд░рдорд╛рдгреАрдХрд░рдг

In order for a regular user authenticate to AWS via CLI you need to have **local credentials**. By default you can configure them **manually** in `~/.aws/credentials` or by **running** `aws configure`.\
In that file you can have more than one profile, if **no profile** is specified using the **aws cli**, the one called **`[default]`** in that file will be used.\
Example of credentials file with more than 1 profile:
```
[default]
aws_access_key_id = AKIA5ZDCUJHF83HDTYUT
aws_secret_access_key = uOcdhof683fbOUGFYEQug8fUGIf68greoihef

[Admin]
aws_access_key_id = AKIA8YDCu7TGTR356SHYT
aws_secret_access_key = uOcdhof683fbOUGFYEQuR2EIHG34UY987g6ff7
region = eu-west-2
```
If you need to access **different AWS accounts** and your profile was given access to **assume a role inside those accounts**, you don't need to call manually STS every time (`aws sts assume-role --role-arn <role-arn> --role-session-name sessname`) and configure the credentials.

рдЖрдк `~/.aws/config` рдлрд╝рд╛рдЗрд▓ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ[ **рдпрд╣ рдЗрдВрдЧрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐ рдХреМрди рд╕реЗ рднреВрдорд┐рдХрд╛рдПрдБ рдЧреНрд░рд╣рдг рдХрд░рдиреА рд╣реИрдВ**](https://docs.aws.amazon.com/cli/latest/userguide/cli-configure-role.html), рдФрд░ рдлрд┐рд░ рд╕рд╛рдорд╛рдиреНрдп рд░реВрдк рд╕реЗ `--profile` рдкреИрд░рд╛рдореАрдЯрд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ (рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рд▓рд┐рдП `assume-role` рдкрд╛рд░рджрд░реНрд╢реА рддрд░реАрдХреЗ рд╕реЗ рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛)ред\
рдПрдХ рдХреЙрдиреНрдлрд╝рд┐рдЧ рдлрд╝рд╛рдЗрд▓ рдХрд╛ рдЙрджрд╛рд╣рд░рдг:
```
[profile acc2]
region=eu-west-2
role_arn=arn:aws:iam::<account-id>:role/<role-path>
role_session_name = <session_name>
source_profile = <profile_with_assume_role>
sts_regional_endpoints = regional
```
рдЗрд╕ рдХреЙрдиреНрдлрд╝рд┐рдЧ рдлрд╝рд╛рдЗрд▓ рдХреЗ рд╕рд╛рде рдЖрдк aws cli рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдЬреИрд╕реЗ:
```
aws --profile acc2 ...
```
рдпрджрд┐ рдЖрдк рдЗрд╕рдХреЗ рд▓рд┐рдП рдХреБрдЫ **рд╕рдорд╛рди** рдЦреЛрдЬ рд░рд╣реЗ рд╣реИрдВ рд▓реЗрдХрд┐рди **рдмреНрд░рд╛рдЙрдЬрд╝рд░** рдХреЗ рд▓рд┐рдП, рддреЛ рдЖрдк **рд╡рд┐рд╕реНрддрд╛рд░** [**AWS Extend Switch Roles**](https://chrome.google.com/webstore/detail/aws-extend-switch-roles/jpmkfafbacpgapdghgdpembnojdlgkdl?hl=en) рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВред

## рд╕рдВрджрд░реНрдн

* [https://docs.aws.amazon.com/organizations/latest/userguide/orgs\_getting-started\_concepts.html](https://docs.aws.amazon.com/organizations/latest/userguide/orgs_getting-started_concepts.html)
* [https://aws.amazon.com/iam/](https://aws.amazon.com/iam/)
* [https://docs.aws.amazon.com/singlesignon/latest/userguide/what-is.html](https://docs.aws.amazon.com/singlesignon/latest/userguide/what-is.html)

{% hint style="success" %}
AWS рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ рдФрд░ рдЕрднреНрдпрд╛рд╕ рдХрд░реЗрдВ:<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
GCP рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ рдФрд░ рдЕрднреНрдпрд╛рд╕ рдХрд░реЗрдВ: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░реЗрдВ</summary>

* [**рд╕рджрд╕реНрдпрддрд╛ рдпреЛрдЬрдирд╛рдПрдБ**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* **рд╣рдорд╛рд░реЗ рд╕рд╛рде рдЬреБрдбрд╝реЗрдВ** ЁЯТм [**Discord рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдпрд╛ **рд╣рдореЗрдВ** **Twitter** ЁЯРж [**@hacktricks\_live**](https://twitter.com/hacktricks_live)** рдкрд░ рдлреЙрд▓реЛ рдХрд░реЗрдВред**
* **рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ, PRs рдХреЛ** [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) рдЧрд┐рдЯрд╣рдм рд░рд┐рдкреЛрдЬрд┐рдЯрд░реА рдореЗрдВ рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗред 

</details>
{% endhint %}
