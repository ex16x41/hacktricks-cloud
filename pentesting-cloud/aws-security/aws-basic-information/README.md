# AWS - Temel Bilgiler

{% hint style="success" %}
AWS Hacking Ã¶ÄŸren ve pratik yap:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCP Hacking Ã¶ÄŸren ve pratik yap: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekle</summary>

* [**abonelik planlarÄ±nÄ±**](https://github.com/sponsors/carlospolop) kontrol et!
* **ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katÄ±l veya bizi **Twitter'da** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** takip et.**
* **HackTricks** ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na PR gÃ¶ndererek hacking ipuÃ§larÄ±nÄ± paylaÅŸ.

</details>
{% endhint %}

## Organizasyon HiyerarÅŸisi

![](<../../../.gitbook/assets/image (151).png>)

### Hesaplar

AWS'de, **tÃ¼m hesaplarÄ±n ana konteyneri olan bir **root hesabÄ±** vardÄ±r. Ancak, kaynaklarÄ± daÄŸÄ±tmak iÃ§in bu hesabÄ± kullanmanÄ±z gerekmez, **farklÄ± AWS** altyapÄ±larÄ±nÄ± birbirinden ayÄ±rmak iÃ§in **baÅŸka hesaplar oluÅŸturabilirsiniz**.

Bu, **gÃ¼venlik** aÃ§Ä±sÄ±ndan Ã§ok ilginÃ§tir, Ã§Ã¼nkÃ¼ **bir hesap diÄŸer hesabÄ±n kaynaklarÄ±na eriÅŸemez** (Ã¶zel kÃ¶prÃ¼ler oluÅŸturulmadÄ±kÃ§a), bu ÅŸekilde daÄŸÄ±tÄ±mlar arasÄ±nda sÄ±nÄ±rlar oluÅŸturabilirsiniz.

Bu nedenle, bir organizasyonda **iki tÃ¼r hesap vardÄ±r** (AWS hesaplarÄ±ndan bahsediyoruz, KullanÄ±cÄ± hesaplarÄ±ndan deÄŸil): yÃ¶netim hesabÄ± olarak belirlenen tek bir hesap ve bir veya daha fazla Ã¼ye hesap.

*   **YÃ¶netim hesabÄ± (root hesap)**, organizasyonu oluÅŸturmak iÃ§in kullandÄ±ÄŸÄ±nÄ±z hesaptÄ±r. Organizasyonun yÃ¶netim hesabÄ±ndan ÅŸunlarÄ± yapabilirsiniz:

* Organizasyonda hesaplar oluÅŸturun
* DiÄŸer mevcut hesaplarÄ± organizasyona davet edin
* HesaplarÄ± organizasyondan Ã§Ä±karÄ±n
* Davetleri yÃ¶netin
* Organizasyon iÃ§indeki varlÄ±klara (kÃ¶kler, OU'lar veya hesaplar) politikalar uygulayÄ±n
* TÃ¼m organizasyon hesaplarÄ±nda hizmet iÅŸlevselliÄŸi saÄŸlamak iÃ§in desteklenen AWS hizmetleriyle entegrasyonu etkinleÅŸtirin.
* Bu root kullanÄ±cÄ± olarak, bu root hesap/organizasyonu oluÅŸturmak iÃ§in kullanÄ±lan e-posta ve ÅŸifre ile giriÅŸ yapmak mÃ¼mkÃ¼ndÃ¼r.

YÃ¶netim hesabÄ±, **Ã¶deme hesabÄ± sorumluluklarÄ±na** sahiptir ve Ã¼ye hesaplar tarafÄ±ndan biriken tÃ¼m Ã¼cretleri Ã¶demekten sorumludur. Bir organizasyonun yÃ¶netim hesabÄ±nÄ± deÄŸiÅŸtiremezsiniz.
* **Ãœye hesaplar**, bir organizasyondaki diÄŸer tÃ¼m hesaplarÄ± oluÅŸturur. Bir hesap aynÄ± anda yalnÄ±zca bir organizasyonun Ã¼yesi olabilir. Bir hesaba yalnÄ±zca o hesaba kontrol uygulamak iÃ§in bir politika ekleyebilirsiniz.
* Ãœye hesaplar **geÃ§erli bir e-posta adresi kullanmalÄ±dÄ±r** ve bir **adÄ±** olabilir, genellikle faturalamayÄ± yÃ¶netemezler (ancak eriÅŸim verilebilir).
```
aws organizations create-account --account-name testingaccount --email testingaccount@lalala1233fr.com
```
### **Organization Units**

Hesaplar **Organization Units (OU)** iÃ§inde gruplanabilir. Bu ÅŸekilde, **Organization Unit** iÃ§in **politikalar** oluÅŸturabilir ve bu politikalar **tÃ¼m alt hesaplara uygulanÄ±r**. Bir OU'nun baÅŸka OUlardan alt birimleri olabileceÄŸini unutmayÄ±n.
```bash
# You can get the root id from aws organizations list-roots
aws organizations create-organizational-unit --parent-id r-lalala --name TestOU
```
### Service Control Policy (SCP)

Bir **service control policy (SCP)**, SCP'nin etkilediÄŸi hesaplarda kullanÄ±cÄ±larÄ±n ve rollerin kullanabileceÄŸi hizmetleri ve eylemleri belirten bir politikadÄ±r. SCP'ler, **IAM izin politikalarÄ±na benzer** ancak **herhangi bir izin vermezler**. Bunun yerine, SCP'ler bir organizasyon, organizasyon birimi (OU) veya hesap iÃ§in **maksimum izinleri** belirler. Bir SCP'yi organizasyon kÃ¶kÃ¼ne veya bir OU'ya eklediÄŸinizde, **SCP Ã¼ye hesaplarÄ±ndaki varlÄ±klarÄ±n izinlerini sÄ±nÄ±rlar**.

Bu, **kÃ¶k kullanÄ±cÄ±nÄ±n bile bir ÅŸey yapmasÄ±nÄ±n durdurulabileceÄŸi** TEK yoldur. Ã–rneÄŸin, kullanÄ±cÄ±larÄ±n CloudTrail'i devre dÄ±ÅŸÄ± bÄ±rakmasÄ±nÄ± veya yedekleri silmesini engellemek iÃ§in kullanÄ±labilir.\
Bunu atlatmanÄ±n tek yolu, SCP'leri yapÄ±landÄ±ran **ana hesabÄ±** da ele geÃ§irmektir (ana hesap engellenemez).

{% hint style="warning" %}
**SCP'lerin yalnÄ±zca hesaptaki ilkeleri kÄ±sÄ±tladÄ±ÄŸÄ±nÄ±** unutmayÄ±n, bu nedenle diÄŸer hesaplar etkilenmez. Bu, bir SCP'nin `s3:GetObject` eriÅŸimini reddetmesinin, hesabÄ±nÄ±zdaki **herkese aÃ§Ä±k bir S3 bucket'Ä±na eriÅŸimi** durdurmayacaÄŸÄ± anlamÄ±na gelir.
{% endhint %}

SCP Ã¶rnekleri:

* KÃ¶k hesabÄ± tamamen reddet
* YalnÄ±zca belirli bÃ¶lgeleri izin ver
* YalnÄ±zca beyaz listeye alÄ±nmÄ±ÅŸ hizmetlere izin ver
* GuardDuty, CloudTrail ve S3 Public Block Access'in devre dÄ±ÅŸÄ± bÄ±rakÄ±lmasÄ±nÄ± reddet
* GÃ¼venlik/olay mÃ¼dahale rollerinin silinmesini veya deÄŸiÅŸtirilmesini reddet
* Yedeklerin silinmesini reddet
* IAM kullanÄ±cÄ±larÄ± ve eriÅŸim anahtarlarÄ± oluÅŸturmayÄ± reddet

**JSON Ã¶rneklerini** [https://docs.aws.amazon.com/organizations/latest/userguide/orgs\_manage\_policies\_scps\_examples.html](https://docs.aws.amazon.com/organizations/latest/userguide/orgs\_manage\_policies\_scps\_examples.html) adresinde bulabilirsiniz.

### ARN

**Amazon Resource Name**, AWS iÃ§indeki her kaynaÄŸÄ±n sahip olduÄŸu **benzersiz isimdir**, ÅŸu ÅŸekilde oluÅŸturulur:
```
arn:partition:service:region:account-id:resource-type/resource-id
arn:aws:elasticbeanstalk:us-west-1:123456789098:environment/App/Env
```
AWS'de 4 bÃ¶lÃ¼m olduÄŸunu, ancak bunlarÄ± Ã§aÄŸÄ±rmanÄ±n sadece 3 yolu olduÄŸunu unutmayÄ±n:

* AWS Standard: `aws`
* AWS China: `aws-cn`
* AWS US public Internet (GovCloud): `aws-us-gov`
* AWS Secret (US Classified): `aws`

## IAM - Kimlik ve EriÅŸim YÃ¶netimi

IAM, AWS hesabÄ±nÄ±z iÃ§inde **Kimlik DoÄŸrulama**, **Yetkilendirme** ve **EriÅŸim KontrolÃ¼** yÃ¶netmenizi saÄŸlayan hizmettir.

* **Kimlik DoÄŸrulama** - Bir kimliÄŸi tanÄ±mlama ve bu kimliÄŸin doÄŸrulanmasÄ± sÃ¼reci. Bu sÃ¼reÃ§, Kimlik TanÄ±mlama ve DoÄŸrulama olarak ikiye ayrÄ±labilir.
* **Yetkilendirme** - Bir kimliÄŸin, sistemde kimlik doÄŸrulamasÄ± yapÄ±ldÄ±ktan sonra neye eriÅŸebileceÄŸini belirler.
* **EriÅŸim KontrolÃ¼** - GÃ¼venli bir kaynaÄŸa eriÅŸimin nasÄ±l verildiÄŸi yÃ¶ntemi ve sÃ¼reci

IAM, AWS hesabÄ±nÄ±zdaki kaynaklarÄ±nÄ±za kimliklerin kimlik doÄŸrulama, yetkilendirme ve eriÅŸim kontrol mekanizmalarÄ±nÄ± yÃ¶netme, kontrol etme ve yÃ¶netme yeteneÄŸi ile tanÄ±mlanabilir.

### [AWS hesap root kullanÄ±cÄ±sÄ±](https://docs.aws.amazon.com/IAM/latest/UserGuide/id\_root-user.html) <a href="#id_root" id="id_root"></a>

Ä°lk kez bir Amazon Web Services (AWS) hesabÄ± oluÅŸturduÄŸunuzda, hesaptaki **tÃ¼m** AWS hizmetlerine ve kaynaklarÄ±na tam eriÅŸimi olan tek bir oturum aÃ§ma kimliÄŸi ile baÅŸlarsÄ±nÄ±z. Bu, AWS hesap _**root kullanÄ±cÄ±sÄ±**_ olup, **hesabÄ± oluÅŸturmak iÃ§in kullandÄ±ÄŸÄ±nÄ±z e-posta adresi ve ÅŸifre ile oturum aÃ§arak** eriÅŸilir.

Yeni bir **admin kullanÄ±cÄ±sÄ±nÄ±n** **root kullanÄ±cÄ±sÄ±ndan daha az izinleri** olacaÄŸÄ±nÄ± unutmayÄ±n.

GÃ¼venlik aÃ§Ä±sÄ±ndan, baÅŸka kullanÄ±cÄ±lar oluÅŸturmak ve bu kullanÄ±cÄ±yÄ± kullanmaktan kaÃ§Ä±nmak Ã¶nerilir.

### [IAM kullanÄ±cÄ±larÄ±](https://docs.aws.amazon.com/IAM/latest/UserGuide/id\_users.html) <a href="#id_iam-users" id="id_iam-users"></a>

Bir IAM _kullanÄ±cÄ±sÄ±_, AWS'de **AWS ile etkileÅŸimde bulunan kiÅŸi veya uygulamayÄ± temsil etmek** iÃ§in oluÅŸturduÄŸunuz bir varlÄ±ktÄ±r. AWS'deki bir kullanÄ±cÄ±, bir ad ve kimlik bilgileri (ÅŸifre ve en fazla iki eriÅŸim anahtarÄ±) iÃ§erir.

Bir IAM kullanÄ±cÄ±sÄ± oluÅŸturduÄŸunuzda, ona uygun izin politikalarÄ± eklenmiÅŸ bir **kullanÄ±cÄ± grubunun Ã¼yesi yaparak** (Ã¶nerilen) veya **doÄŸrudan politikalar ekleyerek** **izinler** verirsiniz.

KullanÄ±cÄ±lar, **konsol Ã¼zerinden oturum aÃ§mak iÃ§in MFA etkinleÅŸtirilebilir**. MFA etkinleÅŸtirilmiÅŸ kullanÄ±cÄ±larÄ±n API tokenlarÄ± MFA tarafÄ±ndan korunmaz. Bir kullanÄ±cÄ±nÄ±n API anahtarlarÄ±nÄ±n eriÅŸimini MFA kullanarak **sÄ±nÄ±rlamak istiyorsanÄ±z**, belirli eylemleri gerÃ§ekleÅŸtirmek iÃ§in MFA'nÄ±n gerekli olduÄŸunu politikada belirtmeniz gerekir (Ã¶rnek [**burada**](https://docs.aws.amazon.com/IAM/latest/UserGuide/id\_credentials\_mfa\_configure-api-require.html)).

#### CLI

* **EriÅŸim AnahtarÄ± KimliÄŸi**: AKHDNAPO86BSHKDIRYT gibi 20 rastgele bÃ¼yÃ¼k harf ve rakam karakteri
* **Gizli eriÅŸim anahtarÄ± kimliÄŸi**: S836fh/J73yHSb64Ag3Rkdi/jaD6sPl6/antFtU gibi 40 rastgele bÃ¼yÃ¼k ve kÃ¼Ã§Ã¼k harf karakteri (Kaybolan gizli eriÅŸim anahtarÄ± kimliklerini geri almak mÃ¼mkÃ¼n deÄŸildir).

EriÅŸim AnahtarÄ±nÄ± **deÄŸiÅŸtirmeniz gerektiÄŸinde** izlemeniz gereken sÃ¼reÃ§ ÅŸudur:\
_Yeni bir eriÅŸim anahtarÄ± oluÅŸtur -> Yeni anahtarÄ± sistem/uygulamaya uygula -> Orijinal anahtarÄ± pasif olarak iÅŸaretle -> Yeni eriÅŸim anahtarÄ±nÄ±n Ã§alÄ±ÅŸtÄ±ÄŸÄ±nÄ± test et ve doÄŸrula -> Eski eriÅŸim anahtarÄ±nÄ± sil_

### MFA - Ã‡ok FaktÃ¶rlÃ¼ Kimlik DoÄŸrulama

Mevcut yÃ¶ntemlerinize, Ã¶rneÄŸin ÅŸifreye ek olarak **ek bir kimlik doÄŸrulama faktÃ¶rÃ¼ oluÅŸturmak** iÃ§in kullanÄ±lÄ±r, bÃ¶ylece Ã§ok faktÃ¶rlÃ¼ bir kimlik doÄŸrulama seviyesi oluÅŸturur.\
**Ãœcretsiz sanal bir uygulama veya fiziksel bir cihaz** kullanabilirsiniz. AWS'de bir MFA etkinleÅŸtirmek iÃ§in google authentication gibi uygulamalarÄ± Ã¼cretsiz olarak kullanabilirsiniz.

MFA koÅŸullarÄ± iÃ§eren politikalar aÅŸaÄŸÄ±dakilere eklenebilir:

* Bir IAM kullanÄ±cÄ±sÄ± veya grubu
* Amazon S3 bucket, Amazon SQS kuyruÄŸu veya Amazon SNS konusu gibi bir kaynak
* Bir kullanÄ±cÄ±nÄ±n Ã¼stlenebileceÄŸi bir IAM rolÃ¼nÃ¼n gÃ¼ven politikasÄ±

MFA kontrolÃ¼ yapan bir kaynaÄŸa **CLI Ã¼zerinden eriÅŸmek** istiyorsanÄ±z, **`GetSessionToken`** Ã§aÄŸÄ±rmanÄ±z gerekir. Bu, size MFA hakkÄ±nda bilgi iÃ§eren bir token verecektir.\
**`AssumeRole` kimlik bilgileri bu bilgiyi iÃ§ermez**.
```bash
aws sts get-session-token --serial-number <arn_device> --token-code <code>
```
[**Burada belirtildiÄŸi gibi**](https://docs.aws.amazon.com/IAM/latest/UserGuide/id\_credentials\_mfa\_configure-api-require.html), **MFA kullanÄ±lamayacak** birÃ§ok farklÄ± durum vardÄ±r.

### [IAM kullanÄ±cÄ± gruplarÄ±](https://docs.aws.amazon.com/IAM/latest/UserGuide/id\_groups.html) <a href="#id_iam-groups" id="id_iam-groups"></a>

Bir IAM [kullanÄ±cÄ± grubu](https://docs.aws.amazon.com/IAM/latest/UserGuide/id\_groups.html), **birden fazla kullanÄ±cÄ±ya aynÄ± anda politikalar eklemenin** bir yoludur, bu da bu kullanÄ±cÄ±larÄ±n izinlerini yÃ¶netmeyi kolaylaÅŸtÄ±rabilir. **Roller ve gruplar bir grubun parÃ§asÄ± olamaz**.

Bir **kimlik tabanlÄ± politikayÄ± bir kullanÄ±cÄ± grubuna ekleyebilirsiniz** bÃ¶ylece kullanÄ±cÄ± grubundaki **tÃ¼m kullanÄ±cÄ±lar** politikanÄ±n **izinlerini alÄ±r**. Bir **kullanÄ±cÄ± grubunu** bir **politika** iÃ§inde (Ã¶rneÄŸin kaynak tabanlÄ± bir politika) **`Principal`** olarak tanÄ±mlayamazsÄ±nÄ±z Ã§Ã¼nkÃ¼ gruplar izinlerle ilgilidir, kimlik doÄŸrulama ile deÄŸil ve principal'lar kimlik doÄŸrulanmÄ±ÅŸ IAM varlÄ±klarÄ±dÄ±r.

KullanÄ±cÄ± gruplarÄ±nÄ±n bazÄ± Ã¶nemli Ã¶zellikleri ÅŸunlardÄ±r:

* Bir kullanÄ±cÄ± **grubu** **birÃ§ok kullanÄ±cÄ± iÃ§erebilir** ve bir **kullanÄ±cÄ±** **birden fazla gruba ait olabilir**.
* **KullanÄ±cÄ± gruplarÄ± iÃ§ iÃ§e olamaz**; sadece kullanÄ±cÄ±larÄ± iÃ§erebilir, diÄŸer kullanÄ±cÄ± gruplarÄ±nÄ± deÄŸil.
* AWS hesabÄ±ndaki tÃ¼m kullanÄ±cÄ±larÄ± otomatik olarak iÃ§eren **varsayÄ±lan bir kullanÄ±cÄ± grubu yoktur**. BÃ¶yle bir kullanÄ±cÄ± grubuna sahip olmak istiyorsanÄ±z, onu oluÅŸturmalÄ± ve her yeni kullanÄ±cÄ±yÄ± ona atamalÄ±sÄ±nÄ±z.
* Bir AWS hesabÄ±ndaki IAM kaynaklarÄ±nÄ±n sayÄ±sÄ± ve boyutu, Ã¶rneÄŸin grup sayÄ±sÄ± ve bir kullanÄ±cÄ±nÄ±n Ã¼ye olabileceÄŸi grup sayÄ±sÄ± sÄ±nÄ±rlÄ±dÄ±r. Daha fazla bilgi iÃ§in [IAM ve AWS STS kotalarÄ±](https://docs.aws.amazon.com/IAM/latest/UserGuide/reference\_iam-quotas.html) bÃ¶lÃ¼mÃ¼ne bakÄ±n.

### [IAM rolleri](https://docs.aws.amazon.com/IAM/latest/UserGuide/id\_roles.html) <a href="#id_iam-roles" id="id_iam-roles"></a>

Bir IAM **rolÃ¼**, **bir kullanÄ±cÄ±nÄ±n** kimliÄŸine Ã§ok **benzer**, Ã§Ã¼nkÃ¼ AWS'de ne yapÄ±p ne yapamayacaÄŸÄ±nÄ± belirleyen **izin politikalarÄ±na sahip bir kimliktir**. Ancak, bir rolÃ¼n **hiÃ§bir kimlik bilgisi** (ÅŸifre veya eriÅŸim anahtarlarÄ±) yoktur. Bir kiÅŸiye Ã¶zgÃ¼ olarak iliÅŸkilendirilmek yerine, bir rol, **ihtiyacÄ± olan herkes tarafÄ±ndan Ã¼stlenilebilir (ve yeterli izinlere sahip)** olacak ÅŸekilde tasarlanmÄ±ÅŸtÄ±r. Bir **IAM kullanÄ±cÄ±sÄ±, belirli bir gÃ¶rev iÃ§in geÃ§ici olarak** farklÄ± izinler almak Ã¼zere bir rolÃ¼ Ã¼stlenebilir. Bir rol, IAM yerine harici bir kimlik saÄŸlayÄ±cÄ± kullanarak oturum aÃ§an bir [**federe kullanÄ±cÄ±ya**](https://docs.aws.amazon.com/IAM/latest/UserGuide/id\_roles\_providers.html) atanabilir.

Bir IAM rolÃ¼ **iki tÃ¼r politikadan** oluÅŸur: **Kimlerin rolÃ¼ Ã¼stlenebileceÄŸini** tanÄ±mlayan ve boÅŸ olamayan bir **gÃ¼ven politikasÄ±** ve **neleri eriÅŸebileceÄŸini** tanÄ±mlayan ve boÅŸ olamayan bir **izin politikasÄ±**.

#### AWS Security Token Service (STS)

AWS Security Token Service (STS), **geÃ§ici, sÄ±nÄ±rlÄ± ayrÄ±calÄ±klÄ± kimlik bilgileri** saÄŸlanmasÄ±nÄ± kolaylaÅŸtÄ±ran bir web hizmetidir. Ã–zellikle ÅŸu amaÃ§lar iÃ§in tasarlanmÄ±ÅŸtÄ±r:

### [IAM'deki geÃ§ici kimlik bilgileri](https://docs.aws.amazon.com/IAM/latest/UserGuide/id\_credentials\_temp.html) <a href="#id_temp-creds" id="id_temp-creds"></a>

**GeÃ§ici kimlik bilgileri Ã¶ncelikle IAM rolleriyle kullanÄ±lÄ±r**, ancak baÅŸka kullanÄ±mlarÄ± da vardÄ±r. Standart IAM kullanÄ±cÄ±nÄ±zdan daha sÄ±nÄ±rlÄ± izinlere sahip geÃ§ici kimlik bilgileri talep edebilirsiniz. Bu, **daha sÄ±nÄ±rlÄ± kimlik bilgileri tarafÄ±ndan izin verilmeyen gÃ¶revleri yanlÄ±ÅŸlÄ±kla yapmanÄ±zÄ±** engeller. GeÃ§ici kimlik bilgilerinin bir avantajÄ±, belirli bir sÃ¼re sonra otomatik olarak sona ermeleridir. Kimlik bilgilerinin geÃ§erli olduÄŸu sÃ¼re Ã¼zerinde kontrol sahibisiniz.

### Politikalar

#### Politika Ä°zinleri

Ä°zinleri atamak iÃ§in kullanÄ±lÄ±r. 2 tÃ¼rÃ¼ vardÄ±r:

* AWS tarafÄ±ndan yÃ¶netilen politikalar (AWS tarafÄ±ndan Ã¶nceden yapÄ±landÄ±rÄ±lmÄ±ÅŸ)
* MÃ¼ÅŸteri TarafÄ±ndan YÃ¶netilen Politikalar: Sizin tarafÄ±nÄ±zdan yapÄ±landÄ±rÄ±lÄ±r. AWS tarafÄ±ndan yÃ¶netilen politikalara dayalÄ± politikalar oluÅŸturabilirsiniz (birini deÄŸiÅŸtirip kendi politikanÄ±zÄ± oluÅŸturmak), politika oluÅŸturucu (izinleri vermenize ve reddetmenize yardÄ±mcÄ± olan bir GUI gÃ¶rÃ¼nÃ¼mÃ¼) kullanarak veya kendi politikanÄ±zÄ± yazarak.

**VarsayÄ±lan olarak eriÅŸim** **reddedilir**, belirli bir rol belirtilmiÅŸse eriÅŸim verilir.\
**Tek bir "Reddetme" varsa, "Ä°zin Verme"yi geÃ§ersiz kÄ±lar**, AWS hesabÄ±nÄ±n kÃ¶k gÃ¼venlik kimlik bilgilerini kullanan istekler hariÃ§ (bunlar varsayÄ±lan olarak izin verilir).
```javascript
{
"Version": "2012-10-17",  //Version of the policy
"Statement": [  //Main element, there can be more than 1 entry in this array
{
"Sid": "Stmt32894y234276923" //Unique identifier (optional)
"Effect": "Allow", //Allow or deny
"Action": [  //Actions that will be allowed or denied
"ec2:AttachVolume",
"ec2:DetachVolume"
],
"Resource": [ //Resource the action and effect will be applied to
"arn:aws:ec2:*:*:volume/*",
"arn:aws:ec2:*:*:instance/*"
],
"Condition": { //Optional element that allow to control when the permission will be effective
"ArnEquals": {"ec2:SourceInstanceARN": "arn:aws:ec2:*:*:instance/instance-id"}
}
}
]
}
```
[Herhangi bir hizmette koÅŸullar iÃ§in kullanÄ±labilecek global alanlar burada belgelenmiÅŸtir](https://docs.aws.amazon.com/IAM/latest/UserGuide/reference\_policies\_condition-keys.html#condition-keys-resourceaccount).\
[Hizmet baÅŸÄ±na koÅŸullar iÃ§in kullanÄ±labilecek belirli alanlar burada belgelenmiÅŸtir](https://docs.aws.amazon.com/service-authorization/latest/reference/reference\_policies\_actions-resources-contextkeys.html).

#### Inline Policies

Bu tÃ¼r politikalar bir kullanÄ±cÄ±ya, gruba veya role **doÄŸrudan atanÄ±r**. Bu nedenle, baÅŸka birinin kullanabileceÄŸi politikalar listesinde gÃ¶rÃ¼nmezler.\
Inline policies, bir politika ile uygulandÄ±ÄŸÄ± kimlik arasÄ±nda **katÄ± bir bire bir iliÅŸki sÃ¼rdÃ¼rmek** istiyorsanÄ±z kullanÄ±ÅŸlÄ±dÄ±r. Ã–rneÄŸin, bir politikadaki izinlerin, amaÃ§landÄ±klarÄ± kimlik dÄ±ÅŸÄ±nda baÅŸka bir kimliÄŸe yanlÄ±ÅŸlÄ±kla atanmadÄ±ÄŸÄ±ndan emin olmak istersiniz. Bir inline policy kullandÄ±ÄŸÄ±nÄ±zda, politikadaki izinler yanlÄ±ÅŸlÄ±kla yanlÄ±ÅŸ kimliÄŸe atanamaz. AyrÄ±ca, AWS Management Console'u kullanarak o kimliÄŸi sildiÄŸinizde, kimliÄŸe gÃ¶mÃ¼lÃ¼ politikalar da silinir. Bunun nedeni, bu politikalarÄ±n ana varlÄ±ÄŸÄ±n bir parÃ§asÄ± olmasÄ±dÄ±r.

#### Resource Bucket Policies

Bunlar **kaynaklarda** tanÄ±mlanabilen **politikalardÄ±r**. **AWS'nin tÃ¼m kaynaklarÄ± bunlarÄ± desteklemez**.

Bir principal Ã¼zerinde aÃ§Ä±k bir reddetme yoksa ve bir kaynak politikasÄ± onlara eriÅŸim veriyorsa, eriÅŸime izin verilir.

### IAM Boundaries

IAM boundaries, bir kullanÄ±cÄ± veya rolÃ¼n **eriÅŸmesi gereken izinleri sÄ±nÄ±rlamak** iÃ§in kullanÄ±labilir. Bu ÅŸekilde, farklÄ± bir politika tarafÄ±ndan kullanÄ±cÄ±ya farklÄ± bir izin seti verilse bile, kullanÄ±cÄ± bu izinleri kullanmaya Ã§alÄ±ÅŸÄ±rsa **baÅŸarÄ±sÄ±z** olur.

Bir boundary, kullanÄ±cÄ±ya eklenmiÅŸ bir politika olup, **kullanÄ±cÄ± veya rolÃ¼n sahip olabileceÄŸi maksimum izin seviyesini belirtir**. Yani, **kullanÄ±cÄ± YÃ¶netici eriÅŸimine sahip olsa bile**, boundary sadece S3 bucket'larÄ±nÄ± okuyabileceÄŸini belirtiyorsa, yapabileceÄŸi maksimum ÅŸey budur.

**Bu**, **SCP'ler** ve **en az ayrÄ±calÄ±k** ilkesini takip etmek, kullanÄ±cÄ±larÄ±n ihtiyaÃ§ duyduklarÄ±ndan daha fazla izne sahip olmamalarÄ±nÄ± kontrol etmenin yollarÄ±dÄ±r.

### Session Policies

Bir session policy, bir rol **bir ÅŸekilde Ã¼stlenildiÄŸinde** ayarlanan bir politikadÄ±r. Bu, o oturum iÃ§in bir **IAM boundary gibi** olacaktÄ±r: Bu, session policy'nin izin vermediÄŸi, ancak **politikada belirtilenlerle sÄ±nÄ±rladÄ±ÄŸÄ±** anlamÄ±na gelir (rolÃ¼n sahip olduÄŸu maksimum izinler).

Bu, **gÃ¼venlik Ã¶nlemleri** iÃ§in kullanÄ±ÅŸlÄ±dÄ±r: Bir yÃ¶netici Ã§ok ayrÄ±calÄ±klÄ± bir rol Ã¼stleneceÄŸinde, oturumun tehlikeye girmesi durumunda izinleri yalnÄ±zca session policy'de belirtilenlerle sÄ±nÄ±rlayabilir.
```bash
aws sts assume-role \
--role-arn <value> \
--role-session-name <value> \
[--policy-arns <arn_custom_policy1> <arn_custom_policy2>]
[--policy <file://policy.json>]
```
AWS'nin varsayÄ±lan olarak **oturum politikalarÄ± ekleyebileceÄŸini** unutmayÄ±n. Ã–rneÄŸin, [kimlik doÄŸrulamasÄ± yapÄ±lmamÄ±ÅŸ cognito varsayÄ±lan rolleri](../aws-services/aws-cognito-enum/cognito-identity-pools.md#accessing-iam-roles) (geliÅŸmiÅŸ kimlik doÄŸrulamasÄ± kullanarak) AWS, **oturum politikasÄ± ile oturum kimlik bilgileri** oluÅŸturacaktÄ±r ve bu oturumun eriÅŸebileceÄŸi hizmetleri [**aÅŸaÄŸÄ±daki listeyle**](https://docs.aws.amazon.com/cognito/latest/developerguide/iam-roles.html#access-policies-scope-down-services) sÄ±nÄ±rlandÄ±racaktÄ±r.

Bu nedenle, bir noktada "... Ã§Ã¼nkÃ¼ hiÃ§bir oturum politikasÄ± ... izin vermiyor" hatasÄ±yla karÅŸÄ±laÅŸÄ±rsanÄ±z ve rolÃ¼n eylemi gerÃ§ekleÅŸtirme izni varsa, **bir oturum politikasÄ±nÄ±n bunu engellediÄŸi** anlamÄ±na gelir.

### Kimlik Federasyonu

Kimlik federasyonu, **AWS dÄ±ÅŸÄ±ndaki kimlik saÄŸlayÄ±cÄ±larÄ±ndan gelen kullanÄ±cÄ±larÄ±n** AWS kaynaklarÄ±na gÃ¼venli bir ÅŸekilde eriÅŸmesini saÄŸlar, geÃ§erli bir IAM kullanÄ±cÄ± hesabÄ±ndan AWS kullanÄ±cÄ± kimlik bilgilerini saÄŸlamalarÄ±na gerek kalmaz.\
Bir kimlik saÄŸlayÄ±cÄ±sÄ±na Ã¶rnek olarak, kendi kurumsal **Microsoft Active Directory**'niz (via **SAML**) veya **OpenID** hizmetleri (Ã¶rneÄŸin **Google**) verilebilir. Federasyonlu eriÅŸim, bu kullanÄ±cÄ±larÄ±n AWS'ye eriÅŸmesini saÄŸlar.

Bu gÃ¼veni yapÄ±landÄ±rmak iÃ§in, **IAM Kimlik SaÄŸlayÄ±cÄ±sÄ± (SAML veya OAuth)** oluÅŸturulur ve bu **diÄŸer platforma gÃ¼ven** saÄŸlar. Daha sonra, en az bir **IAM rolÃ¼ Kimlik SaÄŸlayÄ±cÄ±sÄ±na (gÃ¼venen) atanÄ±r**. GÃ¼venilen platformdan bir kullanÄ±cÄ± AWS'ye eriÅŸirse, belirtilen rol olarak eriÅŸecektir.

Ancak, genellikle **kullanÄ±cÄ±nÄ±n Ã¼Ã§Ã¼ncÃ¼ taraf platformdaki grubuna baÄŸlÄ± olarak farklÄ± bir rol vermek** istersiniz. Bu durumda, birkaÃ§ **IAM rolÃ¼ Ã¼Ã§Ã¼ncÃ¼ taraf Kimlik SaÄŸlayÄ±cÄ±sÄ±na gÃ¼venebilir** ve Ã¼Ã§Ã¼ncÃ¼ taraf platform, kullanÄ±cÄ±larÄ±n hangi rolÃ¼ Ã¼stleneceÄŸine karar verir.

<figure><img src="../../../.gitbook/assets/image (247).png" alt=""><figcaption></figcaption></figure>

### IAM Identity Center

AWS IAM Identity Center (AWS Single Sign-On'un halefi), AWS Kimlik ve EriÅŸim YÃ¶netimi (IAM) yeteneklerini geniÅŸleterek, **kullanÄ±cÄ±larÄ±n ve AWS hesaplarÄ±na ve bulut uygulamalarÄ±na eriÅŸimlerinin yÃ¶netimini** bir araya getiren **merkezi bir yer** saÄŸlar.

GiriÅŸ alanÄ± `<user_input>.awsapps.com` gibi bir ÅŸey olacaktÄ±r.

KullanÄ±cÄ±larÄ± oturum aÃ§tÄ±rmak iÃ§in kullanÄ±labilecek 3 kimlik kaynaÄŸÄ± vardÄ±r:

* Identity Center Directory: Normal AWS kullanÄ±cÄ±larÄ±
* Active Directory: FarklÄ± baÄŸlayÄ±cÄ±larÄ± destekler
* External Identity Provider: TÃ¼m kullanÄ±cÄ±lar ve gruplar dÄ±ÅŸ bir Kimlik SaÄŸlayÄ±cÄ±sÄ±ndan (IdP) gelir

<figure><img src="../../../.gitbook/assets/image (279).png" alt=""><figcaption></figcaption></figure>

En basit Identity Center dizini durumunda, **Identity Center kullanÄ±cÄ±lar ve gruplarÄ±n bir listesini** tutar ve bunlara **organizasyonun herhangi bir hesabÄ±na** **politikalar atayabilir**.

Bir Identity Center kullanÄ±cÄ±/grubuna bir hesaba eriÅŸim vermek iÃ§in, **Identity Center'a gÃ¼venen bir SAML Kimlik SaÄŸlayÄ±cÄ±sÄ± oluÅŸturulacak** ve hedef hesapta **belirtilen politikalarla Kimlik SaÄŸlayÄ±cÄ±sÄ±na gÃ¼venen bir rol oluÅŸturulacaktÄ±r**.

#### AwsSSOInlinePolicy

IAM Identity Center aracÄ±lÄ±ÄŸÄ±yla oluÅŸturulan rollere **inline politikalar aracÄ±lÄ±ÄŸÄ±yla izinler vermek** mÃ¼mkÃ¼ndÃ¼r. AWS Identity Center'da **inline politikalar verilen** hesaplarda oluÅŸturulan roller, bu izinleri **`AwsSSOInlinePolicy`** adlÄ± bir inline politikada bulunduracaktÄ±r.

Bu nedenle, **`AwsSSOInlinePolicy`** adlÄ± bir inline politikaya sahip 2 rol gÃ¶rseniz bile, **aynÄ± izinlere sahip olduÄŸu anlamÄ±na gelmez**.

### Hesaplar ArasÄ± GÃ¼ven ve Roller

**Bir kullanÄ±cÄ±** (gÃ¼venen), bazÄ± politikalarla bir Hesaplar ArasÄ± Rol oluÅŸturabilir ve ardÄ±ndan **baÅŸka bir kullanÄ±cÄ±nÄ±n** (gÃ¼venilen) **hesabÄ±na eriÅŸmesine izin verebilir**, ancak yalnÄ±zca **yeni rol politikalarÄ±nda belirtilen eriÅŸime sahip olarak**. Bunu oluÅŸturmak iÃ§in, sadece yeni bir Rol oluÅŸturun ve Hesaplar ArasÄ± Rol seÃ§in. Hesaplar ArasÄ± EriÅŸim iÃ§in roller iki seÃ§enek sunar. Sahip olduÄŸunuz AWS hesaplarÄ± arasÄ±nda eriÅŸim saÄŸlamak ve sahip olduÄŸunuz bir hesap ile Ã¼Ã§Ã¼ncÃ¼ taraf bir AWS hesabÄ± arasÄ±nda eriÅŸim saÄŸlamak.\
**GÃ¼venilen kullanÄ±cÄ±yÄ± belirtmek ve genel bir ÅŸey koymamak** Ã¶nerilir, Ã§Ã¼nkÃ¼ aksi takdirde federasyonlu kullanÄ±cÄ±lar gibi diÄŸer kimliÄŸi doÄŸrulanmÄ±ÅŸ kullanÄ±cÄ±lar da bu gÃ¼veni kÃ¶tÃ¼ye kullanabilir.

### AWS Simple AD

Desteklenmez:

* GÃ¼ven Ä°liÅŸkileri
* AD YÃ¶netim Merkezi
* Tam PS API desteÄŸi
* AD Geri DÃ¶nÃ¼ÅŸÃ¼m Kutusu
* Grup YÃ¶netilen Hizmet HesaplarÄ±
* Åema UzantÄ±larÄ±
* OS veya Ã–rneklerine DoÄŸrudan EriÅŸim

#### Web Federasyonu veya OpenID Kimlik DoÄŸrulamasÄ±

Uygulama, geÃ§ici kimlik bilgileri oluÅŸturmak iÃ§in AssumeRoleWithWebIdentity kullanÄ±r. Ancak bu, AWS konsoluna eriÅŸim saÄŸlamaz, sadece AWS iÃ§indeki kaynaklara eriÅŸim saÄŸlar.

### DiÄŸer IAM seÃ§enekleri

* Minimum uzunluk ve parola gereksinimleri gibi **parola politikasÄ± ayarlarÄ±nÄ±** belirleyebilirsiniz.
* Mevcut kimlik bilgileri hakkÄ±nda bilgi iÃ§eren **"Kimlik Bilgisi Raporu"nu indirebilirsiniz** (Ã¶rneÄŸin, kullanÄ±cÄ± oluÅŸturma zamanÄ±, parola etkin mi...). Her **dÃ¶rt saatte bir** kimlik bilgisi raporu oluÅŸturabilirsiniz.

AWS Kimlik ve EriÅŸim YÃ¶netimi (IAM), tÃ¼m AWS genelinde **ince taneli eriÅŸim kontrolÃ¼** saÄŸlar. IAM ile, **kimlerin hangi hizmetlere ve kaynaklara eriÅŸebileceÄŸini** ve hangi koÅŸullar altÄ±nda eriÅŸebileceÄŸini belirleyebilirsiniz. IAM politikalarÄ± ile, iÅŸ gÃ¼cÃ¼nÃ¼z ve sistemleriniz iÃ§in izinleri yÃ¶neterek **en az ayrÄ±calÄ±k ilkesini** saÄŸlarsÄ±nÄ±z.

### IAM ID Ã–nekleri

[**Bu sayfada**](https://docs.aws.amazon.com/IAM/latest/UserGuide/reference\_identifiers.html#identifiers-unique-ids) anahtarlarÄ±n doÄŸasÄ±na baÄŸlÄ± olarak **IAM ID Ã¶neklerini** bulabilirsiniz:

| ABIA | [AWS STS hizmet taÅŸÄ±yÄ±cÄ± belirteci](https://docs.aws.amazon.com/IAM/latest/UserGuide/id\_credentials\_bearer.html)                                                                                                         |
| ---- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| ACCA | BaÄŸlama Ã¶zgÃ¼ kimlik bilgisi                                                                                                                                                                                           |
| AGPA | KullanÄ±cÄ± grubu                                                                                                                                                                                                            |
| AIDA | IAM kullanÄ±cÄ±sÄ±                                                                                                                                                                                                              |
| AIPA | Amazon EC2 Ã¶rnek profili                                                                                                                                                                                           |
| AKIA | EriÅŸim anahtarÄ±                                                                                                                                                                                                            |
| ANPA | YÃ¶netilen politika                                                                                                                                                                                                        |
| ANVA | YÃ¶netilen bir politikada sÃ¼rÃ¼m                                                                                                                                                                                           |
| APKA | Genel anahtar                                                                                                                                                                                                            |
| AROA | Rol                                                                                                                                                                                                                  |
| ASCA | Sertifika                                                                                                                                                                                                           |
| ASIA | [GeÃ§ici (AWS STS) eriÅŸim anahtarÄ± kimlikleri](https://docs.aws.amazon.com/STS/latest/APIReference/API\_Credentials.html) bu Ã¶neki kullanÄ±r, ancak yalnÄ±zca gizli eriÅŸim anahtarÄ± ve oturum belirteci ile birlikte benzersizdir. |

### HesaplarÄ± denetlemek iÃ§in Ã¶nerilen izinler

AÅŸaÄŸÄ±daki ayrÄ±calÄ±klar Ã§eÅŸitli meta veri okuma eriÅŸimi saÄŸlar:

* `arn:aws:iam::aws:policy/SecurityAudit`
* `arn:aws:iam::aws:policy/job-function/ViewOnlyAccess`
* `codebuild:ListProjects`
* `config:Describe*`
* `cloudformation:ListStacks`
* `logs:DescribeMetricFilters`
* `directconnect:DescribeConnections`
* `dynamodb:ListTables`

## Ã‡eÅŸitli

### CLI Kimlik DoÄŸrulama

Normal bir kullanÄ±cÄ±nÄ±n CLI aracÄ±lÄ±ÄŸÄ±yla AWS'ye kimlik doÄŸrulamasÄ± yapabilmesi iÃ§in **yerel kimlik bilgilerine** sahip olmasÄ± gerekir. VarsayÄ±lan olarak, bunlarÄ± **manuel olarak** `~/.aws/credentials` dosyasÄ±nda yapÄ±landÄ±rabilir veya **`aws configure`** komutunu Ã§alÄ±ÅŸtÄ±rarak yapÄ±landÄ±rabilirsiniz.\
Bu dosyada birden fazla profil bulundurabilirsiniz, **aws cli** kullanarak **hiÃ§bir profil** belirtilmezse, bu dosyada **`[default]`** olarak adlandÄ±rÄ±lan profil kullanÄ±lacaktÄ±r.\
Birden fazla profile sahip kimlik bilgileri dosyasÄ± Ã¶rneÄŸi:
```
[default]
aws_access_key_id = AKIA5ZDCUJHF83HDTYUT
aws_secret_access_key = uOcdhof683fbOUGFYEQug8fUGIf68greoihef

[Admin]
aws_access_key_id = AKIA8YDCu7TGTR356SHYT
aws_secret_access_key = uOcdhof683fbOUGFYEQuR2EIHG34UY987g6ff7
region = eu-west-2
```
EÄŸer **farklÄ± AWS hesaplarÄ±na** eriÅŸmeniz gerekiyorsa ve profilinize **bu hesaplar iÃ§inde bir rol Ã¼stlenme** izni verildiyse, her seferinde manuel olarak STS Ã§aÄŸÄ±rmanÄ±za (`aws sts assume-role --role-arn <role-arn> --role-session-name sessname`) ve kimlik bilgilerini yapÄ±landÄ±rmanÄ±za gerek yoktur.

Hangi rollerin Ã¼stlenileceÄŸini belirtmek iÃ§in `~/.aws/config` dosyasÄ±nÄ± kullanabilirsiniz ve ardÄ±ndan her zamanki gibi `--profile` parametresini kullanabilirsiniz (kullanÄ±cÄ± iÃ§in `assume-role` iÅŸlemi ÅŸeffaf bir ÅŸekilde gerÃ§ekleÅŸtirilecektir).\
Bir config dosyasÄ± Ã¶rneÄŸi:
```
[profile acc2]
region=eu-west-2
role_arn=arn:aws:iam::<account-id>:role/<role-path>
role_session_name = <session_name>
source_profile = <profile_with_assume_role>
sts_regional_endpoints = regional
```
Bu yapÄ±landÄ±rma dosyasÄ± ile aws cli'yi ÅŸu ÅŸekilde kullanabilirsiniz:
```
aws --profile acc2 ...
```
EÄŸer **tarayÄ±cÄ±** iÃ§in buna **benzer** bir ÅŸey arÄ±yorsanÄ±z, **uzantÄ±** [**AWS Extend Switch Roles**](https://chrome.google.com/webstore/detail/aws-extend-switch-roles/jpmkfafbacpgapdghgdpembnojdlgkdl?hl=en) kontrol edebilirsiniz.

## Referanslar

* [https://docs.aws.amazon.com/organizations/latest/userguide/orgs\_getting-started\_concepts.html](https://docs.aws.amazon.com/organizations/latest/userguide/orgs\_getting-started\_concepts.html)
* [https://aws.amazon.com/iam/](https://aws.amazon.com/iam/)
* [https://docs.aws.amazon.com/singlesignon/latest/userguide/what-is.html](https://docs.aws.amazon.com/singlesignon/latest/userguide/what-is.html)

{% hint style="success" %}
AWS Hacking Ã¶ÄŸrenin ve pratik yapÄ±n:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCP Hacking Ã¶ÄŸrenin ve pratik yapÄ±n: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**abonelik planlarÄ±nÄ±**](https://github.com/sponsors/carlospolop) kontrol edin!
* **ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n ya da **Twitter**'da bizi takip edin ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **HackTricks ve** [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **github depolarÄ±na PR gÃ¶ndererek hacking ipuÃ§larÄ±nÄ± paylaÅŸÄ±n.**

</details>
{% endhint %}
