# AWS Pentesting

{% hint style="success" %}
AWSãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã³ã€ç·´ç¿’ã™ã‚‹:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCPãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã³ã€ç·´ç¿’ã™ã‚‹: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricksã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹</summary>

* [**ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³**](https://github.com/sponsors/carlospolop)ã‚’ãƒã‚§ãƒƒã‚¯ï¼
* **ğŸ’¬ [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã¾ãŸã¯[**telegramã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«å‚åŠ ã™ã‚‹ã‹ã€**Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**ã‚’ãƒ•ã‚©ãƒ­ãƒ¼ã—ã¦ãã ã•ã„ã€‚**
* **PRã‚’æå‡ºã—ã¦ãƒãƒƒã‚­ãƒ³ã‚°ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã™ã‚‹** [**HackTricks**](https://github.com/carlospolop/hacktricks)ãŠã‚ˆã³[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)ã®GitHubãƒªãƒã‚¸ãƒˆãƒªã€‚

</details>
{% endhint %}

## åŸºæœ¬æƒ…å ±

**AWSç’°å¢ƒã®ãƒšãƒ³ãƒ†ã‚¹ãƒˆã‚’é–‹å§‹ã™ã‚‹å‰ã«**ã€AWSã®å‹•ä½œã«ã¤ã„ã¦ã„ãã¤ã‹ã®**åŸºæœ¬çš„ãªã“ã¨ã‚’çŸ¥ã£ã¦ãŠãå¿…è¦ãŒã‚ã‚Šã¾ã™**ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€ä½•ã‚’ã™ã¹ãã‹ã€ã©ã®ã‚ˆã†ã«ãƒŸã‚¹ã‚³ãƒ³ãƒ•ã‚£ã‚®ãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è¦‹ã¤ã‘ã€ãã‚Œã‚’ã©ã®ã‚ˆã†ã«æ‚ªç”¨ã™ã‚‹ã‹ã‚’ç†è§£ã™ã‚‹ã®ã«å½¹ç«‹ã¡ã¾ã™ã€‚

çµ„ç¹”ã®éšå±¤ã€IAMãªã©ã®åŸºæœ¬çš„ãªæ¦‚å¿µã¯ä»¥ä¸‹ã§èª¬æ˜ã•ã‚Œã¦ã„ã¾ã™ï¼š

{% content-ref url="aws-basic-information/" %}
[aws-basic-information](aws-basic-information/)
{% endcontent-ref %}

## å­¦ç¿’ç”¨ãƒ©ãƒœ

* [https://github.com/RhinoSecurityLabs/cloudgoat](https://github.com/RhinoSecurityLabs/cloudgoat)
* [https://github.com/BishopFox/iam-vulnerable](https://github.com/BishopFox/iam-vulnerable)
* [https://github.com/nccgroup/sadcloud](https://github.com/nccgroup/sadcloud)
* [https://github.com/bridgecrewio/terragoat](https://github.com/bridgecrewio/terragoat)
* [https://github.com/ine-labs/AWSGoat](https://github.com/ine-labs/AWSGoat)
* [http://flaws.cloud/](http://flaws.cloud/)
* [http://flaws2.cloud/](http://flaws2.cloud/)

æ”»æ’ƒã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆã™ã‚‹ãƒ„ãƒ¼ãƒ«ï¼š

* [https://github.com/Datadog/stratus-red-team/](https://github.com/Datadog/stratus-red-team/)
* [https://github.com/sbasu7241/AWS-Threat-Simulation-and-Detection/tree/main](https://github.com/sbasu7241/AWS-Threat-Simulation-and-Detection/tree/main)

## AWSãƒšãƒ³ãƒ†ã‚¹ã‚¿ãƒ¼/ãƒ¬ãƒƒãƒ‰ãƒãƒ¼ãƒ ã®æ–¹æ³•è«–

AWSç’°å¢ƒã‚’ç›£æŸ»ã™ã‚‹ãŸã‚ã«ã¯ã€ã©ã®**ã‚µãƒ¼ãƒ“ã‚¹ãŒä½¿ç”¨ã•ã‚Œã¦ã„ã‚‹ã‹**ã€ä½•ãŒ**å…¬é–‹ã•ã‚Œã¦ã„ã‚‹ã‹**ã€èª°ãŒä½•ã«**ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ã‹**ã€å†…éƒ¨AWSã‚µãƒ¼ãƒ“ã‚¹ã¨**å¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹**ãŒã©ã®ã‚ˆã†ã«æ¥ç¶šã•ã‚Œã¦ã„ã‚‹ã‹ã‚’çŸ¥ã‚‹ã“ã¨ãŒéå¸¸ã«é‡è¦ã§ã™ã€‚

ãƒ¬ãƒƒãƒ‰ãƒãƒ¼ãƒ ã®è¦³ç‚¹ã‹ã‚‰ã€**AWSç’°å¢ƒã‚’ä¾µå®³ã™ã‚‹æœ€åˆã®ã‚¹ãƒ†ãƒƒãƒ—**ã¯ã€ã„ãã¤ã‹ã®**ã‚¯ãƒ¬ãƒ‡ãƒ³ã‚·ãƒ£ãƒ«ã‚’å–å¾—ã™ã‚‹ã“ã¨**ã§ã™ã€‚ä»¥ä¸‹ã«ãã®æ–¹æ³•ã®ã„ãã¤ã‹ã‚’ç¤ºã—ã¾ã™ï¼š

* githubï¼ˆã¾ãŸã¯é¡ä¼¼ã®ã‚‚ã®ï¼‰ã§ã®**ãƒªãƒ¼ã‚¯** - OSINT
* **ã‚½ãƒ¼ã‚·ãƒ£ãƒ«ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãƒªãƒ³ã‚°**
* **ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰**ã®å†åˆ©ç”¨ï¼ˆãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒªãƒ¼ã‚¯ï¼‰
* AWSãƒ›ã‚¹ãƒˆã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®è„†å¼±æ€§
* ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’æŒã¤[**Server Side Request Forgery**](https://book.hacktricks.xyz/pentesting-web/ssrf-server-side-request-forgery/cloud-ssrf)
* **ãƒ­ãƒ¼ã‚«ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿å–ã‚Š**
* `/home/USERNAME/.aws/credentials`
* `C:\Users\USERNAME\.aws\credentials`
* ã‚µãƒ¼ãƒ‰ãƒ‘ãƒ¼ãƒ†ã‚£ã®**ä¾µå®³**
* **å†…éƒ¨**å¾“æ¥­å“¡
* [**Cognito** ](aws-services/aws-cognito-enum/#cognito)ã‚¯ãƒ¬ãƒ‡ãƒ³ã‚·ãƒ£ãƒ«

ã¾ãŸã¯ã€å…¬é–‹ã•ã‚Œã¦ã„ã‚‹**èªè¨¼ã•ã‚Œã¦ã„ãªã„ã‚µãƒ¼ãƒ“ã‚¹ã‚’ä¾µå®³**ã™ã‚‹ã“ã¨ã«ã‚ˆã£ã¦ï¼š

{% content-ref url="aws-unauthenticated-enum-access/" %}
[aws-unauthenticated-enum-access](aws-unauthenticated-enum-access/)
{% endcontent-ref %}

ã¾ãŸã¯ã€**ãƒ¬ãƒ“ãƒ¥ãƒ¼**ã‚’è¡Œã£ã¦ã„ã‚‹å ´åˆã¯ã€ã“ã‚Œã‚‰ã®ãƒ­ãƒ¼ãƒ«ã§**ã‚¯ãƒ¬ãƒ‡ãƒ³ã‚·ãƒ£ãƒ«ã‚’è¦æ±‚**ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ï¼š

{% content-ref url="aws-permissions-for-a-pentest.md" %}
[aws-permissions-for-a-pentest.md](aws-permissions-for-a-pentest.md)
{% endcontent-ref %}

{% hint style="info" %}
ã‚¯ãƒ¬ãƒ‡ãƒ³ã‚·ãƒ£ãƒ«ã‚’å–å¾—ã—ãŸå¾Œã€ãã‚Œã‚‰ã®ã‚¯ãƒ¬ãƒ‡ãƒ³ã‚·ãƒ£ãƒ«ãŒ**èª°ã«å±ã—ã¦ã„ã‚‹ã‹**ã€ãŠã‚ˆã³**ä½•ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ã‹**ã‚’çŸ¥ã‚‹å¿…è¦ãŒã‚ã‚‹ãŸã‚ã€åŸºæœ¬çš„ãªåˆ—æŒ™ã‚’è¡Œã†å¿…è¦ãŒã‚ã‚Šã¾ã™ï¼š
{% endhint %}

## åŸºæœ¬çš„ãªåˆ—æŒ™

### SSRF

AWSå†…ã®ãƒã‚·ãƒ³ã§SSRFã‚’è¦‹ã¤ã‘ãŸå ´åˆã€ã“ã®ãƒšãƒ¼ã‚¸ã§ãƒˆãƒªãƒƒã‚¯ã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼š

{% embed url="https://book.hacktricks.xyz/pentesting-web/ssrf-server-side-request-forgery/cloud-ssrf" %}

### Whoami

æœ€åˆã«çŸ¥ã‚‹ã¹ãã“ã¨ã®ä¸€ã¤ã¯ã€è‡ªåˆ†ãŒèª°ã§ã‚ã‚‹ã‹ï¼ˆã©ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã«ã„ã‚‹ã‹ã€AWSç’°å¢ƒã«é–¢ã™ã‚‹ãã®ä»–ã®æƒ…å ±ï¼‰ã§ã™ï¼š
```bash
# Easiest way, but might be monitored?
aws sts get-caller-identity
aws iam get-user # This will get your own user

# If you have a Key ID
aws sts get-access-key-info --access-key-id=ASIA1234567890123456

# Get inside error message
aws sns publish --topic-arn arn:aws:sns:us-east-1:*account id*:aaa --message aaa

# From metadata
TOKEN=`curl -X PUT "http://169.254.169.254/latest/api/token" -H "X-aws-ec2-metadata-token-ttl-seconds: 21600"`
curl -H "X-aws-ec2-metadata-token: $TOKEN" http://169.254.169.254/latest/dynamic/instance-identity/document
```
{% hint style="danger" %}
ä¼æ¥­ã¯**canary tokens**ã‚’ä½¿ç”¨ã—ã¦**ãƒˆãƒ¼ã‚¯ãƒ³ãŒç›—ã¾ã‚Œã¦ä½¿ç”¨ã•ã‚Œã¦ã„ã‚‹**ã“ã¨ã‚’è­˜åˆ¥ã™ã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚ä½¿ç”¨ã™ã‚‹å‰ã«ãƒˆãƒ¼ã‚¯ãƒ³ãŒcanary tokenã‹ã©ã†ã‹ã‚’ç¢ºèªã™ã‚‹ã“ã¨ã‚’ãŠå‹§ã‚ã—ã¾ã™ã€‚\
è©³ç´°ã¯[**ã“ã®ãƒšãƒ¼ã‚¸**](aws-services/aws-security-and-detection-services/aws-cloudtrail-enum.md#honeytokens-bypass)ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚
{% endhint %}

### Org Enumeration

{% content-ref url="aws-services/aws-organizations-enum.md" %}
[aws-organizations-enum.md](aws-services/aws-organizations-enum.md)
{% endcontent-ref %}

### IAM Enumeration

ååˆ†ãªæ¨©é™ãŒã‚ã‚‹å ´åˆã€**AWSã‚¢ã‚«ã‚¦ãƒ³ãƒˆå†…ã®å„ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã®ç‰¹æ¨©ã‚’ç¢ºèªã™ã‚‹**ã“ã¨ã§ã€è‡ªåˆ†ã‚„ä»–ã®ã‚¢ã‚¤ãƒ‡ãƒ³ãƒ†ã‚£ãƒ†ã‚£ãŒä½•ã‚’ã§ãã‚‹ã‹ã€ãã—ã¦**ç‰¹æ¨©ã‚’ã‚¨ã‚¹ã‚«ãƒ¬ãƒ¼ãƒˆã™ã‚‹**æ–¹æ³•ã‚’ç†è§£ã™ã‚‹ã®ã«å½¹ç«‹ã¡ã¾ã™ã€‚

IAMã‚’åˆ—æŒ™ã™ã‚‹ãŸã‚ã®ååˆ†ãªæ¨©é™ãŒãªã„å ´åˆã€**ãƒ–ãƒ«ãƒ¼ãƒˆãƒ•ã‚©ãƒ¼ã‚¹ã§ç›—ã‚€**ã“ã¨ã§ãã‚Œã‚‰ã‚’æŠŠæ¡ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚\
**åˆ—æŒ™ã¨ãƒ–ãƒ«ãƒ¼ãƒˆãƒ•ã‚©ãƒ¼ã‚¹ã®æ–¹æ³•**ã«ã¤ã„ã¦ã¯ä»¥ä¸‹ã‚’å‚ç…§ã—ã¦ãã ã•ã„ï¼š

{% content-ref url="aws-services/aws-iam-enum.md" %}
[aws-iam-enum.md](aws-services/aws-iam-enum.md)
{% endcontent-ref %}

{% hint style="info" %}
ä»Šã€**è‡ªåˆ†ã®è³‡æ ¼æƒ…å ±ã«ã¤ã„ã¦ã®æƒ…å ±ã‚’æŒã£ã¦ã„ã‚‹**ï¼ˆãã—ã¦èµ¤ãƒãƒ¼ãƒ ã§ã‚ã‚Œã°**æ¤œå‡ºã•ã‚Œã¦ã„ãªã„ã“ã¨ã‚’é¡˜ã£ã¦ã„ã¾ã™**ï¼‰ã€‚æ¬¡ã¯ã€ç’°å¢ƒã§ä½¿ç”¨ã•ã‚Œã¦ã„ã‚‹ã‚µãƒ¼ãƒ“ã‚¹ã‚’ç‰¹å®šã™ã‚‹æ™‚ã§ã™ã€‚\
ä»¥ä¸‹ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã§ã¯ã€**ä¸€èˆ¬çš„ãªã‚µãƒ¼ãƒ“ã‚¹ã‚’åˆ—æŒ™ã™ã‚‹æ–¹æ³•**ã‚’ã„ãã¤ã‹ç¢ºèªã§ãã¾ã™ã€‚
{% endhint %}

## Services Enumeration, Post-Exploitation & Persistence

AWSã«ã¯é©šãã»ã©å¤šãã®ã‚µãƒ¼ãƒ“ã‚¹ãŒã‚ã‚Šã¾ã™ã€‚ä»¥ä¸‹ã®ãƒšãƒ¼ã‚¸ã§ã¯ã€**åŸºæœ¬æƒ…å ±ã€åˆ—æŒ™**ãƒãƒ¼ãƒˆã‚·ãƒ¼ãƒˆã€**æ¤œå‡ºã‚’å›é¿ã™ã‚‹æ–¹æ³•**ã€**æŒç¶šæ€§**ã‚’å¾—ã‚‹æ–¹æ³•ã€ãã®ä»–ã®**ãƒã‚¹ãƒˆã‚¨ã‚¯ã‚¹ãƒ—ãƒ­ã‚¤ãƒˆ**ãƒˆãƒªãƒƒã‚¯ã«ã¤ã„ã¦ã„ãã¤ã‹ç´¹ä»‹ã—ã¦ã„ã¾ã™ï¼š

{% content-ref url="aws-services/" %}
[aws-services](aws-services/)
{% endcontent-ref %}

ã™ã¹ã¦ã®ä½œæ¥­ã‚’**æ‰‹å‹•ã§è¡Œã†å¿…è¦ã¯ãªã„**ã“ã¨ã«æ³¨æ„ã—ã¦ãã ã•ã„ã€‚ã“ã®æŠ•ç¨¿ã®ä¸‹éƒ¨ã«**è‡ªå‹•åŒ–ãƒ„ãƒ¼ãƒ«**ã«ã¤ã„ã¦ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ãŒã‚ã‚Šã¾ã™ï¼š[**automatic tools**](./#automated-tools)ã€‚

ã•ã‚‰ã«ã€ã“ã®æ®µéšã§**èªè¨¼ã•ã‚Œã¦ã„ãªã„ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«å…¬é–‹ã•ã‚Œã¦ã„ã‚‹ã‚µãƒ¼ãƒ“ã‚¹**ã‚’ç™ºè¦‹ã—ãŸã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚ãã‚Œã‚‰ã‚’æ‚ªç”¨ã§ãã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ï¼š

{% content-ref url="aws-unauthenticated-enum-access/" %}
[aws-unauthenticated-enum-access](aws-unauthenticated-enum-access/)
{% endcontent-ref %}

## Privilege Escalation

å°‘ãªãã¨ã‚‚è‡ªåˆ†ã®æ¨©é™ã‚’**ã•ã¾ã–ã¾ãªãƒªã‚½ãƒ¼ã‚¹ã«å¯¾ã—ã¦ç¢ºèªã§ãã‚‹å ´åˆ**ã€**ã•ã‚‰ã«æ¨©é™ã‚’å–å¾—ã§ãã‚‹ã‹ã©ã†ã‹ã‚’ç¢ºèªã™ã‚‹**ã“ã¨ãŒã§ãã¾ã™ã€‚å°‘ãªãã¨ã‚‚ä»¥ä¸‹ã®æ¨©é™ã«ç„¦ç‚¹ã‚’å½“ã¦ã‚‹ã¹ãã§ã™ï¼š

{% content-ref url="aws-privilege-escalation/" %}
[aws-privilege-escalation](aws-privilege-escalation/)
{% endcontent-ref %}

## Publicly Exposed Services

AWSã‚µãƒ¼ãƒ“ã‚¹ã‚’åˆ—æŒ™ã—ã¦ã„ã‚‹é–“ã«ã€ã„ãã¤ã‹ã®ã‚µãƒ¼ãƒ“ã‚¹ãŒ**ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã«è¦ç´ ã‚’å…¬é–‹ã—ã¦ã„ã‚‹**ï¼ˆVM/ã‚³ãƒ³ãƒ†ãƒŠã®ãƒãƒ¼ãƒˆã€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚„ã‚­ãƒ¥ãƒ¼ã‚µãƒ¼ãƒ“ã‚¹ã€ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã‚„ãƒã‚±ãƒƒãƒˆãªã©ï¼‰ã“ã¨ã‚’ç™ºè¦‹ã—ãŸã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚\
ãƒšãƒ³ãƒ†ã‚¹ã‚¿ãƒ¼/èµ¤ãƒãƒ¼ãƒ ã¨ã—ã¦ã€å¸¸ã«**æ©Ÿå¯†æƒ…å ±/è„†å¼±æ€§**ã‚’è¦‹ã¤ã‘ã‚‹ã“ã¨ãŒã§ãã‚‹ã‹ã©ã†ã‹ã‚’ç¢ºèªã™ã‚‹ã¹ãã§ã™ã€‚ã“ã‚Œã‚‰ã¯**AWSã‚¢ã‚«ã‚¦ãƒ³ãƒˆã¸ã®ã•ã‚‰ãªã‚‹ã‚¢ã‚¯ã‚»ã‚¹**ã‚’æä¾›ã™ã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚

ã“ã®æœ¬ã§ã¯ã€**å…¬é–‹ã•ã‚Œã¦ã„ã‚‹AWSã‚µãƒ¼ãƒ“ã‚¹ã‚’è¦‹ã¤ã‘ã‚‹æ–¹æ³•ã¨ãã‚Œã‚‰ã‚’ç¢ºèªã™ã‚‹æ–¹æ³•**ã«ã¤ã„ã¦ã®æƒ…å ±ã‚’è¦‹ã¤ã‘ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚å…¬é–‹ã•ã‚Œã¦ã„ã‚‹ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚µãƒ¼ãƒ“ã‚¹ã®**è„†å¼±æ€§ã‚’è¦‹ã¤ã‘ã‚‹æ–¹æ³•**ã«ã¤ã„ã¦ã¯ã€ç‰¹å®šã®**ã‚µãƒ¼ãƒ“ã‚¹**ã‚’**æ¤œç´¢**ã™ã‚‹ã“ã¨ã‚’ãŠå‹§ã‚ã—ã¾ã™ï¼š

{% embed url="https://book.hacktricks.xyz/" %}

## Compromising the Organization

### From the root/management account

ç®¡ç†ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãŒçµ„ç¹”å†…ã«æ–°ã—ã„ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ä½œæˆã™ã‚‹ã¨ã€æ–°ã—ã„ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã«**æ–°ã—ã„ãƒ­ãƒ¼ãƒ«**ãŒä½œæˆã•ã‚Œã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§**`OrganizationAccountAccessRole`**ã¨åä»˜ã‘ã‚‰ã‚Œã€**ç®¡ç†ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ**ãŒæ–°ã—ã„ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ãŸã‚ã®**AdministratorAccess**ãƒãƒªã‚·ãƒ¼ãŒä»˜ä¸ã•ã‚Œã¾ã™ã€‚

<figure><img src="../../.gitbook/assets/image (171).png" alt=""><figcaption></figcaption></figure>

ã—ãŸãŒã£ã¦ã€å­ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã«ç®¡ç†è€…ã¨ã—ã¦ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã«ã¯ã€ä»¥ä¸‹ãŒå¿…è¦ã§ã™ï¼š

* **ç®¡ç†**ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’**ä¾µå®³**ã—ã€**å­ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®ID**ã¨**ãƒ­ãƒ¼ãƒ«ã®åå‰**ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯OrganizationAccountAccessRoleï¼‰ã‚’è¦‹ã¤ã‘ã€ç®¡ç†ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãŒç®¡ç†è€…ã¨ã—ã¦ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚
* å­ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’è¦‹ã¤ã‘ã‚‹ã«ã¯ã€awsã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã®çµ„ç¹”ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã«ç§»å‹•ã™ã‚‹ã‹ã€`aws organizations list-accounts`ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚
* ãƒ­ãƒ¼ãƒ«ã®åå‰ã‚’ç›´æ¥è¦‹ã¤ã‘ã‚‹ã“ã¨ã¯ã§ããªã„ãŸã‚ã€ã™ã¹ã¦ã®ã‚«ã‚¹ã‚¿ãƒ IAMãƒãƒªã‚·ãƒ¼ã‚’ç¢ºèªã—ã€**`sts:AssumeRole`ãŒå‰è¿°ã®å­ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã«å¯¾ã—ã¦è¨±å¯ã•ã‚Œã¦ã„ã‚‹**ã‚‚ã®ã‚’æ¢ã—ã¾ã™ã€‚
* **ç®¡ç†**ã‚¢ã‚«ã‚¦ãƒ³ãƒˆå†…ã®**`sts:AssumeRole`æ¨©é™ã‚’æŒã¤**ãƒ—ãƒªãƒ³ã‚·ãƒ‘ãƒ«ã‚’**ä¾µå®³**ã—ã€å­ã‚¢ã‚«ã‚¦ãƒ³ãƒˆå†…ã®ãƒ­ãƒ¼ãƒ«ã«å¯¾ã—ã¦ï¼ˆç®¡ç†ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‹ã‚‰ã®èª°ã§ã‚‚å½è£…ã‚’è¨±å¯ã—ã¦ã„ã‚‹å ´åˆã§ã‚‚ã€å¤–éƒ¨ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã¨ã—ã¦ç‰¹å®šã®`sts:AssumeRole`æ¨©é™ãŒå¿…è¦ã§ã™ï¼‰ã€‚

## Automated Tools

### Recon

* [**aws-recon**](https://github.com/darkbitio/aws-recon): Rubyã§æ›¸ã‹ã‚ŒãŸãƒãƒ«ãƒã‚¹ãƒ¬ãƒƒãƒ‰ã®AWSã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ã®**ã‚¤ãƒ³ãƒ™ãƒ³ãƒˆãƒªåé›†ãƒ„ãƒ¼ãƒ«**ã€‚
```bash
# Install
gem install aws_recon

# Recon and get json
AWS_PROFILE=<profile> aws_recon \
--services S3,EC2 \
--regions global,us-east-1,us-east-2 \
--verbose
```
* [**cloudlist**](https://github.com/projectdiscovery/cloudlist): Cloudlistã¯ã€Cloud Providersã‹ã‚‰Assetsï¼ˆHostnamesã€IP Addressesï¼‰ã‚’å–å¾—ã™ã‚‹ãŸã‚ã®**ãƒãƒ«ãƒã‚¯ãƒ©ã‚¦ãƒ‰ãƒ„ãƒ¼ãƒ«**ã§ã™ã€‚
* [**cloudmapper**](https://github.com/duo-labs/cloudmapper): CloudMapperã¯ã€Amazon Web Services (AWS) ç’°å¢ƒã‚’åˆ†æã™ã‚‹ã®ã«å½¹ç«‹ã¡ã¾ã™ã€‚ç¾åœ¨ã§ã¯ã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å•é¡Œã®ç›£æŸ»ã‚’å«ã‚€ã€ã•ã‚‰ã«å¤šãã®æ©Ÿèƒ½ãŒå«ã¾ã‚Œã¦ã„ã¾ã™ã€‚
```bash
# Installation steps in github
# Create a config.json file with the aws info, like:
{
"accounts": [
{
"default": true,
"id": "<account id>",
"name": "dev"
}
],
"cidrs":
{
"2.2.2.2/28": {"name": "NY Office"}
}
}

# Enumerate
python3 cloudmapper.py collect --profile dev
## Number of resources discovered
python3 cloudmapper.py stats --accounts dev

# Create HTML report
## In the report you will find all the info already
python3 cloudmapper.py report --accounts dev

# Identify potential issues
python3 cloudmapper.py audit --accounts dev --json > audit.json
python3 cloudmapper.py audit --accounts dev --markdow > audit.md
python3 cloudmapper.py iam_report --accounts dev

# Identify admins
## The permissions search for are in https://github.com/duo-labs/cloudmapper/blob/4df9fd7303e0337ff16a08f5e58f1d46047c4a87/shared/iam_audit.py#L163-L175
python3 cloudmapper.py find_admins --accounts dev

# Identify unused elements
python3 cloudmapper.py find_unused --accounts dev

# Identify publivly exposed resources
python3 cloudmapper.py public --accounts dev

python cloudmapper.py prepare #Prepare webserver
python cloudmapper.py webserver #Show webserver
```
* [**cartography**](https://github.com/lyft/cartography): Cartographyã¯ã€Neo4jãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ã‚ˆã£ã¦å¼·åŒ–ã•ã‚ŒãŸç›´æ„Ÿçš„ãªã‚°ãƒ©ãƒ•ãƒ“ãƒ¥ãƒ¼ã§ã‚¤ãƒ³ãƒ•ãƒ©ã‚¹ãƒˆãƒ©ã‚¯ãƒãƒ£è³‡ç”£ã¨ãã‚Œã‚‰ã®é–¢ä¿‚ã‚’çµ±åˆã™ã‚‹Pythonãƒ„ãƒ¼ãƒ«ã§ã™ã€‚
```bash
# Install
pip install cartography
## At the time of this writting you need neo4j version 3.5.*

# Get AWS info
AWS_PROFILE=dev cartography --neo4j-uri bolt://127.0.0.1:7687 --neo4j-password-prompt  --neo4j-user neo4j
```
* [**starbase**](https://github.com/JupiterOne/starbase): Starbaseã¯ã€ã‚¯ãƒ©ã‚¦ãƒ‰ã‚¤ãƒ³ãƒ•ãƒ©ã‚¹ãƒˆãƒ©ã‚¯ãƒãƒ£ã€SaaSã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãªã©ã®ã‚µãƒ¼ãƒ“ã‚¹ã‚„ã‚·ã‚¹ãƒ†ãƒ ã‹ã‚‰è³‡ç”£ã¨é–¢ä¿‚ã‚’åé›†ã—ã€Neo4jãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«æ”¯ãˆã‚‰ã‚ŒãŸç›´æ„Ÿçš„ãªã‚°ãƒ©ãƒ•ãƒ“ãƒ¥ãƒ¼ã«ã¾ã¨ã‚ã¾ã™ã€‚
* [**aws-inventory**](https://github.com/nccgroup/aws-inventory): (python2ã‚’ä½¿ç”¨) ã“ã‚Œã¯ã€ã‚¢ã‚«ã‚¦ãƒ³ãƒˆå†…ã§ä½œæˆã•ã‚ŒãŸã™ã¹ã¦ã®[**AWSãƒªã‚½ãƒ¼ã‚¹**](https://docs.aws.amazon.com/general/latest/gr/glos-chap.html#resource)ã‚’**ç™ºè¦‹ã—ã‚ˆã†ã¨ã™ã‚‹**ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚
* [**aws\_public\_ips**](https://github.com/arkadiyt/aws\_public\_ips): AWSã‚¢ã‚«ã‚¦ãƒ³ãƒˆã«é–¢é€£ä»˜ã‘ã‚‰ã‚ŒãŸã™ã¹ã¦ã®ãƒ‘ãƒ–ãƒªãƒƒã‚¯IPã‚¢ãƒ‰ãƒ¬ã‚¹ï¼ˆIPv4/IPv6ã®ä¸¡æ–¹ï¼‰ã‚’**å–å¾—ã™ã‚‹**ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚

### Privesc & Exploiting

* [**SkyArk**](https://github.com/cyberark/SkyArk)**:** ã‚¹ã‚­ãƒ£ãƒ³ã•ã‚ŒãŸAWSç’°å¢ƒã§æœ€ã‚‚ç‰¹æ¨©ã®ã‚ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ç™ºè¦‹ã—ã€AWS Shadow Adminsã‚’å«ã¿ã¾ã™ã€‚powershellã‚’ä½¿ç”¨ã—ã¾ã™ã€‚ç‰¹æ¨©ãƒãƒªã‚·ãƒ¼ã®**å®šç¾©**ã¯ã€é–¢æ•°**`Check-PrivilegedPolicy`**å†…ã«ã‚ã‚Šã¾ã™ã€‚[https://github.com/cyberark/SkyArk/blob/master/AWStealth/AWStealth.ps1](https://github.com/cyberark/SkyArk/blob/master/AWStealth/AWStealth.ps1)ã§ç¢ºèªã§ãã¾ã™ã€‚
* [**pacu**](https://github.com/RhinoSecurityLabs/pacu): Pacuã¯ã€ã‚¯ãƒ©ã‚¦ãƒ‰ç’°å¢ƒã«å¯¾ã™ã‚‹æ”»æ’ƒçš„ãªã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ†ã‚¹ãƒˆã®ãŸã‚ã«è¨­è¨ˆã•ã‚ŒãŸã‚ªãƒ¼ãƒ—ãƒ³ã‚½ãƒ¼ã‚¹ã®**AWSã‚¨ã‚¯ã‚¹ãƒ—ãƒ­ã‚¤ãƒˆãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯**ã§ã™ã€‚**åˆ—æŒ™**ã—ã€**ãƒŸã‚¹ã‚³ãƒ³ãƒ•ã‚£ã‚®ãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³**ã‚’è¦‹ã¤ã‘ã¦**ã‚¨ã‚¯ã‚¹ãƒ—ãƒ­ã‚¤ãƒˆ**ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ç‰¹æ¨©æ¨©é™ã®**å®šç¾©**ã¯ã€[https://github.com/RhinoSecurityLabs/pacu/blob/866376cd711666c775bbfcde0524c817f2c5b181/pacu/modules/iam\_\_privesc\_scan/main.py#L134](https://github.com/RhinoSecurityLabs/pacu/blob/866376cd711666c775bbfcde0524c817f2c5b181/pacu/modules/iam\_\_privesc\_scan/main.py#L134)å†…ã®**`user_escalation_methods`**è¾æ›¸ã«ã‚ã‚Šã¾ã™ã€‚
* pacuã¯**è‡ªåˆ†è‡ªèº«ã®privescsãƒ‘ã‚¹ã®ã¿ã‚’ãƒã‚§ãƒƒã‚¯**ã™ã‚‹ã“ã¨ã«æ³¨æ„ã—ã¦ãã ã•ã„ï¼ˆã‚¢ã‚«ã‚¦ãƒ³ãƒˆå…¨ä½“ã§ã¯ã‚ã‚Šã¾ã›ã‚“ï¼‰ã€‚
```bash
# Install
## Feel free to use venvs
pip3 install pacu

# Use pacu CLI
pacu
> import_keys <profile_name> # import 1 profile from .aws/credentials
> import_keys --all # import all profiles
> list # list modules
> exec iam__enum_permissions # Get permissions
> exec iam__privesc_scan # List privileged permissions
```
* [**PMapper**](https://github.com/nccgroup/PMapper): Principal Mapper (PMapper) ã¯ã€AWS ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã¾ãŸã¯ AWS çµ„ç¹”ã® AWS Identity and Access Management (IAM) ã®è¨­å®šã«ãŠã‘ã‚‹ãƒªã‚¹ã‚¯ã‚’ç‰¹å®šã™ã‚‹ãŸã‚ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆãŠã‚ˆã³ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§ã™ã€‚ã‚¢ã‚«ã‚¦ãƒ³ãƒˆå†…ã®ç•°ãªã‚‹ IAM ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¨ãƒ­ãƒ¼ãƒ«ã‚’æœ‰å‘ã‚°ãƒ©ãƒ•ã¨ã—ã¦ãƒ¢ãƒ‡ãƒ«åŒ–ã—ã€**privilege escalation** ã‚„æ”»æ’ƒè€…ãŒ AWS å†…ã®ãƒªã‚½ãƒ¼ã‚¹ã‚„ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ãŸã‚ã«å–ã‚‹å¯èƒ½æ€§ã®ã‚ã‚‹ä»£æ›¿çµŒè·¯ã‚’ãƒã‚§ãƒƒã‚¯ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚**permissions used to find privesc** ãƒ‘ã‚¹ã‚’ç¢ºèªã™ã‚‹ã«ã¯ã€[https://github.com/nccgroup/PMapper/tree/master/principalmapper/graphing](https://github.com/nccgroup/PMapper/tree/master/principalmapper/graphing) ã® `_edges.py` ã§çµ‚ã‚ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«åã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚
```bash
# Install
pip install principalmapper

# Get data
pmapper --profile dev graph create
pmapper --profile dev graph display # Show basic info
# Generate graph
pmapper --profile dev visualize # Generate svg graph file (can also be png, dot and graphml)
pmapper --profile dev visualize --only-privesc # Only privesc permissions

# Generate analysis
pmapper --profile dev analysis
## Run queries
pmapper --profile dev query 'who can do iam:CreateUser'
pmapper --profile dev query 'preset privesc *' # Get privescs with admins

# Get organization hierarchy data
pmapper --profile dev orgs create
pmapper --profile dev orgs display
```
* [**cloudsplaining**](https://github.com/salesforce/cloudsplaining): Cloudsplainingã¯ã€æœ€å°ç‰¹æ¨©ã®é•åã‚’ç‰¹å®šã—ã€ãƒªã‚¹ã‚¯å„ªå…ˆã®HTMLãƒ¬ãƒãƒ¼ãƒˆã‚’ç”Ÿæˆã™ã‚‹AWS IAMã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è©•ä¾¡ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚\
ã“ã‚Œã¯ã€æ½œåœ¨çš„ã«**éå‰°ãªæ¨©é™**ã‚’æŒã¤é¡§å®¢ã€ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ãŠã‚ˆã³awsã®**ãƒãƒªã‚·ãƒ¼**ã€ãŠã‚ˆã³ãã‚Œã‚‰ã«**ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ãƒ—ãƒªãƒ³ã‚·ãƒ‘ãƒ«**ã‚’ç¤ºã—ã¾ã™ã€‚ï¼ˆprivescã ã‘ã§ãªãã€ä»–ã®èˆˆå‘³æ·±ã„æ¨©é™ã‚‚ãƒã‚§ãƒƒã‚¯ã™ã‚‹ãŸã‚ã€ä½¿ç”¨ã‚’æ¨å¥¨ã—ã¾ã™ï¼‰ã€‚
```bash
# Install
pip install cloudsplaining

# Download IAM policies to check
## Only the ones attached with the versions used
cloudsplaining download --profile dev

# Analyze the IAM policies
cloudsplaining scan --input-file /private/tmp/cloudsplaining/dev.json --output /tmp/files/
```
* [**cloudjack**](https://github.com/prevade/cloudjack): CloudJackã¯ã€Route53ã¨CloudFrontã®è¨­å®šãŒåˆ†é›¢ã•ã‚Œã¦ã„ã‚‹ã“ã¨ã«ã‚ˆã‚‹**ã‚µãƒ–ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒã‚¤ã‚¸ãƒ£ãƒƒã‚¯ã®è„†å¼±æ€§**ã«ã¤ã„ã¦AWSã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’è©•ä¾¡ã—ã¾ã™ã€‚
* [**ccat**](https://github.com/RhinoSecurityLabs/ccat): ECRãƒªãƒã‚¸ãƒˆãƒªã‚’ãƒªã‚¹ãƒˆ -> ECRãƒªãƒã‚¸ãƒˆãƒªã‚’ãƒ—ãƒ« -> ãƒãƒƒã‚¯ãƒ‰ã‚¢ã‚’ä»•è¾¼ã‚€ -> ãƒãƒƒã‚¯ãƒ‰ã‚¢ã‚’ä»•è¾¼ã‚“ã ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ãƒ—ãƒƒã‚·ãƒ¥
* [**Dufflebag**](https://github.com/bishopfox/dufflebag): Dufflebagã¯ã€**ç§˜å¯†æƒ…å ±**ãŒèª¤ã£ã¦æ®‹ã•ã‚Œã¦ã„ã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹**å…¬é–‹Elastic Block Storage (EBS)ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆ**ã‚’**æ¤œç´¢**ã™ã‚‹ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚

### ç›£æŸ»

* [**cloudsploit**](https://github.com/aquasecurity/cloudsploit)**:** Aquaã«ã‚ˆã‚‹CloudSploitã¯ã€Amazon Web Services (AWS)ã€Microsoft Azureã€Google Cloud Platform (GCP)ã€Oracle Cloud Infrastructure (OCI)ã€ãŠã‚ˆã³GitHubã‚’å«ã‚€**ã‚¯ãƒ©ã‚¦ãƒ‰ã‚¤ãƒ³ãƒ•ãƒ©ã‚¹ãƒˆãƒ©ã‚¯ãƒãƒ£ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒªã‚¹ã‚¯**ã‚’æ¤œå‡ºã™ã‚‹ãŸã‚ã«è¨­è¨ˆã•ã‚ŒãŸã‚ªãƒ¼ãƒ—ãƒ³ã‚½ãƒ¼ã‚¹ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã™ï¼ˆShadowAdminsã¯æ¤œå‡ºã—ã¾ã›ã‚“ï¼‰ã€‚
```bash
./index.js --csv=file.csv --console=table --config ./config.js

# Compiance options: --compliance {hipaa,cis,cis1,cis2,pci}
## use "cis" for cis level 1 and 2
```
* [**Prowler**](https://github.com/prowler-cloud/prowler): Prowlerã¯ã€AWSã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹è©•ä¾¡ã€ç›£æŸ»ã€ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆå¯¾å¿œã€ç¶™ç¶šçš„ãªç›£è¦–ã€ãƒãƒ¼ãƒ‰ãƒ‹ãƒ³ã‚°ã€ãŠã‚ˆã³ãƒ•ã‚©ãƒ¬ãƒ³ã‚¸ãƒƒã‚¯æº–å‚™ã‚’è¡Œã†ãŸã‚ã®ã‚ªãƒ¼ãƒ—ãƒ³ã‚½ãƒ¼ã‚¹ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚
```bash
# Install python3, jq and git
# Install
pip install prowler
prowler -v

# Run
prowler <provider>
prowler aws --profile custom-profile [-M csv json json-asff html]
```
* [**CloudFox**](https://github.com/BishopFox/cloudfox): CloudFoxã¯ã€æ…£ã‚Œãªã„ã‚¯ãƒ©ã‚¦ãƒ‰ç’°å¢ƒã§ã®çŠ¶æ³èªè­˜ã‚’æ”¯æ´ã—ã¾ã™ã€‚ã“ã‚Œã¯ã€ãƒšãƒãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ†ã‚¹ã‚¿ãƒ¼ã‚„ãã®ä»–ã®æ”»æ’ƒçš„ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å°‚é–€å®¶ãŒã‚¯ãƒ©ã‚¦ãƒ‰ã‚¤ãƒ³ãƒ•ãƒ©ã‚¹ãƒˆãƒ©ã‚¯ãƒãƒ£å†…ã®æ”»æ’ƒå¯èƒ½ãªçµŒè·¯ã‚’è¦‹ã¤ã‘ã‚‹ã®ã‚’æ”¯æ´ã™ã‚‹ãŸã‚ã«ä½œæˆã•ã‚ŒãŸã‚ªãƒ¼ãƒ—ãƒ³ã‚½ãƒ¼ã‚¹ã®ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚
```bash
cloudfox aws --profile [profile-name] all-checks
```
* [**ScoutSuite**](https://github.com/nccgroup/ScoutSuite): Scout Suiteã¯ã€ã‚¯ãƒ©ã‚¦ãƒ‰ç’°å¢ƒã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å§¿å‹¢è©•ä¾¡ã‚’å¯èƒ½ã«ã™ã‚‹ã‚ªãƒ¼ãƒ—ãƒ³ã‚½ãƒ¼ã‚¹ã®ãƒãƒ«ãƒã‚¯ãƒ©ã‚¦ãƒ‰ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç›£æŸ»ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚
```bash
# Install
virtualenv -p python3 venv
source venv/bin/activate
pip install scoutsuite
scout --help

# Get info
scout aws -p dev
```
* [**cs-suite**](https://github.com/SecurityFTW/cs-suite): Cloud Security Suite (uses python2.7 and looks unmaintained)
* [**Zeus**](https://github.com/DenizParlak/Zeus): Zeus is a powerful tool for AWS EC2 / S3 / CloudTrail / CloudWatch / KMS best hardening practices (looks unmaintained). It checks only default configured creds inside the system.

### Constant Audit

* [**cloud-custodian**](https://github.com/cloud-custodian/cloud-custodian): Cloud Custodianã¯ã€ãƒ‘ãƒ–ãƒªãƒƒã‚¯ã‚¯ãƒ©ã‚¦ãƒ‰ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã¨ãƒªã‚½ãƒ¼ã‚¹ã‚’ç®¡ç†ã™ã‚‹ãŸã‚ã®ãƒ«ãƒ¼ãƒ«ã‚¨ãƒ³ã‚¸ãƒ³ã§ã™ã€‚ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒ**ã‚»ã‚­ãƒ¥ã‚¢ã§ã‚³ã‚¹ãƒˆæœ€é©åŒ–ã•ã‚ŒãŸã‚¯ãƒ©ã‚¦ãƒ‰ã‚¤ãƒ³ãƒ•ãƒ©ã‚¹ãƒˆãƒ©ã‚¯ãƒãƒ£ã‚’å®Ÿç¾ã™ã‚‹ãŸã‚ã®ãƒãƒªã‚·ãƒ¼ã‚’å®šç¾©**ã™ã‚‹ã“ã¨ã‚’å¯èƒ½ã«ã—ã¾ã™ã€‚å¤šãã®ã‚¢ãƒ‰ãƒ›ãƒƒã‚¯ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’è»½é‡ã§æŸ”è»Ÿãªãƒ„ãƒ¼ãƒ«ã«çµ±åˆã—ã€çµ±ä¸€ã•ã‚ŒãŸãƒ¡ãƒˆãƒªã‚¯ã‚¹ã¨ãƒ¬ãƒãƒ¼ãƒˆã‚’æä¾›ã—ã¾ã™ã€‚
* [**pacbot**](https://github.com/tmobile/pacbot)**: Policy as Code Bot (PacBot)**ã¯ã€**ã‚¯ãƒ©ã‚¦ãƒ‰ã®ç¶™ç¶šçš„ãªã‚³ãƒ³ãƒ—ãƒ©ã‚¤ã‚¢ãƒ³ã‚¹ç›£è¦–ã€ã‚³ãƒ³ãƒ—ãƒ©ã‚¤ã‚¢ãƒ³ã‚¹ãƒ¬ãƒãƒ¼ãƒˆã€ãŠã‚ˆã³ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è‡ªå‹•åŒ–**ã®ãŸã‚ã®ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã§ã™ã€‚PacBotã§ã¯ã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãŠã‚ˆã³ã‚³ãƒ³ãƒ—ãƒ©ã‚¤ã‚¢ãƒ³ã‚¹ã®ãƒãƒªã‚·ãƒ¼ãŒã‚³ãƒ¼ãƒ‰ã¨ã—ã¦å®Ÿè£…ã•ã‚Œã¦ã„ã¾ã™ã€‚PacBotã«ã‚ˆã£ã¦ç™ºè¦‹ã•ã‚ŒãŸã™ã¹ã¦ã®ãƒªã‚½ãƒ¼ã‚¹ã¯ã€ã“ã‚Œã‚‰ã®ãƒãƒªã‚·ãƒ¼ã«å¯¾ã—ã¦è©•ä¾¡ã•ã‚Œã€ãƒãƒªã‚·ãƒ¼ã®æº–æ‹ åº¦ãŒæ¸¬å®šã•ã‚Œã¾ã™ã€‚PacBotã®**è‡ªå‹•ä¿®æ­£**ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã¯ã€äº‹å‰å®šç¾©ã•ã‚ŒãŸã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨ã§ãƒãƒªã‚·ãƒ¼é•åã«è‡ªå‹•çš„ã«å¯¾å¿œã™ã‚‹æ©Ÿèƒ½ã‚’æä¾›ã—ã¾ã™ã€‚
* [**streamalert**](https://github.com/airbnb/streamalert)**:** StreamAlertã¯ã‚µãƒ¼ãƒãƒ¼ãƒ¬ã‚¹ã®**ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ **ãƒ‡ãƒ¼ã‚¿åˆ†æãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã§ã‚ã‚Šã€**å®šç¾©ã—ãŸãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹ã¨ã‚¢ãƒ©ãƒ¼ãƒˆãƒ­ã‚¸ãƒƒã‚¯ã‚’ä½¿ç”¨ã—ã¦**ã€ä»»æ„ã®ç’°å¢ƒã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’**å–ã‚Šè¾¼ã¿ã€åˆ†æã—ã€ã‚¢ãƒ©ãƒ¼ãƒˆã‚’ç™ºã™ã‚‹**ã“ã¨ãŒã§ãã¾ã™ã€‚ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒãƒ¼ãƒ ã¯ã€StreamAlertã‚’ä½¿ç”¨ã—ã¦æ¯æ—¥ãƒ†ãƒ©ãƒã‚¤ãƒˆã®ãƒ­ã‚°ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¹ã‚­ãƒ£ãƒ³ã—ã€ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆã®æ¤œå‡ºã¨å¯¾å¿œã‚’è¡Œã„ã¾ã™ã€‚

## DEBUG: Capture AWS cli requests
```bash
# Set proxy
export HTTP_PROXY=http://localhost:8080
export HTTPS_PROXY=http://localhost:8080

# Capture with burp nor verifying ssl
aws --no-verify-ssl ...

# Dowload brup cert and transform it to pem
curl http://127.0.0.1:8080/cert --output Downloads/certificate.cer
openssl x509 -inform der -in Downloads/certificate.cer -out Downloads/certificate.pem

# Indicate the ca cert to trust
export AWS_CA_BUNDLE=~/Downloads/certificate.pem

# Run aws cli normally trusting burp cert
aws ...
```
## å‚è€ƒæ–‡çŒ®

* [https://www.youtube.com/watch?v=8ZXRw4Ry3mQ](https://www.youtube.com/watch?v=8ZXRw4Ry3mQ)
* [https://cloudsecdocs.com/aws/defensive/tooling/audit/](https://cloudsecdocs.com/aws/defensive/tooling/audit/)

{% hint style="success" %}
AWS Hackingã‚’å­¦ã³ã€ç·´ç¿’ã™ã‚‹:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCP Hackingã‚’å­¦ã³ã€ç·´ç¿’ã™ã‚‹: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricksã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹</summary>

* [**ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³**](https://github.com/sponsors/carlospolop)ã‚’ãƒã‚§ãƒƒã‚¯ï¼
* **ğŸ’¬ [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã¾ãŸã¯[**telegramã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«å‚åŠ ã™ã‚‹ã‹ã€**Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**ã‚’ãƒ•ã‚©ãƒ­ãƒ¼ã—ã¦ãã ã•ã„ã€‚**
* **PRã‚’æå‡ºã—ã¦** [**HackTricks**](https://github.com/carlospolop/hacktricks)ãŠã‚ˆã³[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)ã®githubãƒªãƒã‚¸ãƒˆãƒªã§ãƒãƒƒã‚­ãƒ³ã‚°ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã—ã¦ãã ã•ã„ã€‚

</details>
{% endhint %}
