# AWS Pentesting

{% hint style="success" %}
å­¦ä¹ ä¸å®è·µ AWS é»‘å®¢æŠ€æœ¯ï¼š<img src="../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">[**HackTricks åŸ¹è®­ AWS çº¢é˜Ÿä¸“å®¶ (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">\
å­¦ä¹ ä¸å®è·µ GCP é»‘å®¢æŠ€æœ¯ï¼š<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks åŸ¹è®­ GCP çº¢é˜Ÿä¸“å®¶ (GRTE)**<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>æ”¯æŒ HackTricks</summary>

* æŸ¥çœ‹ [**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**Telegram ç¾¤ç»„**](https://t.me/peass) æˆ– **åœ¨** **Twitter** ğŸ¦ **ä¸Šå…³æ³¨æˆ‘ä»¬** [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub ä»“åº“æäº¤ PR åˆ†äº«é»‘å®¢æŠ€å·§ã€‚

</details>
{% endhint %}

## åŸºæœ¬ä¿¡æ¯

**åœ¨å¼€å§‹å¯¹ AWS ç¯å¢ƒè¿›è¡Œæ¸—é€æµ‹è¯•ä¹‹å‰ï¼Œæ‚¨éœ€è¦äº†è§£ä¸€äº›å…³äº AWS å·¥ä½œåŸç†çš„åŸºæœ¬çŸ¥è¯†ï¼Œä»¥å¸®åŠ©æ‚¨ç†è§£éœ€è¦åšä»€ä¹ˆã€å¦‚ä½•æŸ¥æ‰¾é”™è¯¯é…ç½®ä»¥åŠå¦‚ä½•åˆ©ç”¨å®ƒä»¬ã€‚**

ç»„ç»‡å±‚çº§ã€IAM å’Œå…¶ä»–åŸºæœ¬æ¦‚å¿µåœ¨ä»¥ä¸‹å†…å®¹ä¸­è¿›è¡Œäº†è¯´æ˜ï¼š

{% content-ref url="aws-basic-information/" %}
[aws-basic-information](aws-basic-information/)
{% endcontent-ref %}

## å­¦ä¹ å®éªŒå®¤

* [https://github.com/RhinoSecurityLabs/cloudgoat](https://github.com/RhinoSecurityLabs/cloudgoat)
* [https://github.com/BishopFox/iam-vulnerable](https://github.com/BishopFox/iam-vulnerable)
* [https://github.com/nccgroup/sadcloud](https://github.com/nccgroup/sadcloud)
* [https://github.com/bridgecrewio/terragoat](https://github.com/bridgecrewio/terragoat)
* [https://github.com/ine-labs/AWSGoat](https://github.com/ine-labs/AWSGoat)
* [http://flaws.cloud/](http://flaws.cloud/)
* [http://flaws2.cloud/](http://flaws2.cloud/)

æ¨¡æ‹Ÿæ”»å‡»çš„å·¥å…·ï¼š

* [https://github.com/Datadog/stratus-red-team/](https://github.com/Datadog/stratus-red-team/)
* [https://github.com/sbasu7241/AWS-Threat-Simulation-and-Detection/tree/main](https://github.com/sbasu7241/AWS-Threat-Simulation-and-Detection/tree/main)

## AWS æ¸—é€æµ‹è¯•/çº¢é˜Ÿæ–¹æ³•è®º

ä¸ºäº†å®¡è®¡ AWS ç¯å¢ƒï¼Œäº†è§£ä»¥ä¸‹å†…å®¹éå¸¸é‡è¦ï¼šå“ªäº› **æœåŠ¡æ­£åœ¨ä½¿ç”¨**ï¼Œä»€ä¹ˆ **è¢«æš´éœ²**ï¼Œè°å¯¹ä»€ä¹ˆ **æœ‰è®¿é—®æƒé™**ï¼Œä»¥åŠå†…éƒ¨ AWS æœåŠ¡ä¸ **å¤–éƒ¨æœåŠ¡** æ˜¯å¦‚ä½•è¿æ¥çš„ã€‚

ä»çº¢é˜Ÿçš„è§’åº¦æ¥çœ‹ï¼Œ**æ”»é™· AWS ç¯å¢ƒçš„ç¬¬ä¸€æ­¥**æ˜¯è®¾æ³•è·å–ä¸€äº› **å‡­è¯**ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›è·å–å‡­è¯çš„æƒ³æ³•ï¼š

* GitHubï¼ˆæˆ–ç±»ä¼¼ï¼‰ä¸­çš„ **æ³„éœ²** - OSINT
* **ç¤¾äº¤** å·¥ç¨‹
* **å¯†ç ** é‡ç”¨ï¼ˆå¯†ç æ³„éœ²ï¼‰
* AWS æ‰˜ç®¡åº”ç”¨ç¨‹åºä¸­çš„æ¼æ´
* [**æœåŠ¡å™¨ç«¯è¯·æ±‚ä¼ªé€ **](https://book.hacktricks.xyz/pentesting-web/ssrf-server-side-request-forgery/cloud-ssrf) è®¿é—®å…ƒæ•°æ®ç«¯ç‚¹
* **æœ¬åœ°æ–‡ä»¶è¯»å–**
* `/home/USERNAME/.aws/credentials`
* `C:\Users\USERNAME\.aws\credentials`
* ç¬¬ä¸‰æ–¹ **æ³„éœ²**
* **å†…éƒ¨** å‘˜å·¥
* [**Cognito** ](aws-services/aws-cognito-enum/#cognito)å‡­è¯

æˆ–è€…é€šè¿‡ **æ”»é™·ä¸€ä¸ªæœªè®¤è¯çš„æœåŠ¡**ï¼š

{% content-ref url="aws-unauthenticated-enum-access/" %}
[aws-unauthenticated-enum-access](aws-unauthenticated-enum-access/)
{% endcontent-ref %}

æˆ–è€…å¦‚æœæ‚¨æ­£åœ¨è¿›è¡Œ **å®¡æŸ¥**ï¼Œæ‚¨å¯ä»¥ç›´æ¥ **è¯·æ±‚å‡­è¯**ï¼Œä½¿ç”¨è¿™äº›è§’è‰²ï¼š

{% content-ref url="aws-permissions-for-a-pentest.md" %}
[aws-permissions-for-a-pentest.md](aws-permissions-for-a-pentest.md)
{% endcontent-ref %}

{% hint style="info" %}
åœ¨æ‚¨æˆåŠŸè·å–å‡­è¯åï¼Œæ‚¨éœ€è¦çŸ¥é“ **è¿™äº›å‡­è¯å±äºè°**ï¼Œä»¥åŠ **ä»–ä»¬å¯ä»¥è®¿é—®ä»€ä¹ˆ**ï¼Œå› æ­¤æ‚¨éœ€è¦è¿›è¡Œä¸€äº›åŸºæœ¬çš„æšä¸¾ï¼š
{% endhint %}

## åŸºæœ¬æšä¸¾

### SSRF

å¦‚æœæ‚¨åœ¨ AWS å†…éƒ¨çš„æœºå™¨ä¸Šå‘ç°äº† SSRFï¼Œè¯·æŸ¥çœ‹æ­¤é¡µé¢ä»¥è·å–æŠ€å·§ï¼š

{% embed url="https://book.hacktricks.xyz/pentesting-web/ssrf-server-side-request-forgery/cloud-ssrf" %}

### Whoami

æ‚¨éœ€è¦äº†è§£çš„ç¬¬ä¸€ä»¶äº‹æ˜¯æ‚¨æ˜¯è°ï¼ˆæ‚¨æ‰€åœ¨çš„è´¦æˆ·ä»¥åŠæœ‰å…³ AWS ç¯å¢ƒçš„å…¶ä»–ä¿¡æ¯ï¼‰ï¼š
```bash
# Easiest way, but might be monitored?
aws sts get-caller-identity
aws iam get-user # This will get your own user

# If you have a Key ID
aws sts get-access-key-info --access-key-id=ASIA1234567890123456

# Get inside error message
aws sns publish --topic-arn arn:aws:sns:us-east-1:*account id*:aaa --message aaa

# From metadata
TOKEN=`curl -X PUT "http://169.254.169.254/latest/api/token" -H "X-aws-ec2-metadata-token-ttl-seconds: 21600"`
curl -H "X-aws-ec2-metadata-token: $TOKEN" http://169.254.169.254/latest/dynamic/instance-identity/document
```
{% hint style="danger" %}
è¯·æ³¨æ„ï¼Œå…¬å¸å¯èƒ½ä¼šä½¿ç”¨ **canary tokens** æ¥è¯†åˆ« **ä»¤ç‰Œè¢«ç›—ç”¨å’Œä½¿ç”¨** çš„æƒ…å†µã€‚åœ¨ä½¿ç”¨ä»¤ç‰Œä¹‹å‰ï¼Œå»ºè®®æ£€æŸ¥è¯¥ä»¤ç‰Œæ˜¯å¦ä¸º canary tokenã€‚\
æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯· [**æŸ¥çœ‹æ­¤é¡µé¢**](aws-services/aws-security-and-detection-services/aws-cloudtrail-enum.md#honeytokens-bypass)ã€‚
{% endhint %}

### ç»„ç»‡æšä¸¾

{% content-ref url="aws-services/aws-organizations-enum.md" %}
[aws-organizations-enum.md](aws-services/aws-organizations-enum.md)
{% endcontent-ref %}

### IAM æšä¸¾

å¦‚æœæ‚¨æ‹¥æœ‰è¶³å¤Ÿçš„æƒé™ï¼Œ**æ£€æŸ¥ AWS è´¦æˆ·å†…æ¯ä¸ªå®ä½“çš„æƒé™** å°†å¸®åŠ©æ‚¨äº†è§£æ‚¨å’Œå…¶ä»–èº«ä»½å¯ä»¥åšä»€ä¹ˆï¼Œä»¥åŠå¦‚ä½• **æå‡æƒé™**ã€‚

å¦‚æœæ‚¨æ²¡æœ‰è¶³å¤Ÿçš„æƒé™æ¥æšä¸¾ IAMï¼Œæ‚¨å¯ä»¥ **é€šè¿‡æš´åŠ›ç ´è§£æ¥è·å–** å®ƒä»¬ã€‚\
è¯·æŸ¥çœ‹ **å¦‚ä½•è¿›è¡Œæšä¸¾å’Œæš´åŠ›ç ´è§£**ï¼š

{% content-ref url="aws-services/aws-iam-enum.md" %}
[aws-iam-enum.md](aws-services/aws-iam-enum.md)
{% endcontent-ref %}

{% hint style="info" %}
ç°åœ¨æ‚¨ **å·²ç»è·å¾—äº†ä¸€äº›å…³äºæ‚¨çš„å‡­æ®çš„ä¿¡æ¯**ï¼ˆå¦‚æœæ‚¨æ˜¯çº¢é˜Ÿï¼Œå¸Œæœ›æ‚¨ **æ²¡æœ‰è¢«æ£€æµ‹åˆ°**ï¼‰ã€‚æ˜¯æ—¶å€™æ‰¾å‡ºç¯å¢ƒä¸­æ­£åœ¨ä½¿ç”¨å“ªäº›æœåŠ¡ã€‚\
åœ¨ä»¥ä¸‹éƒ¨åˆ†ä¸­ï¼Œæ‚¨å¯ä»¥æŸ¥çœ‹ä¸€äº› **æšä¸¾å¸¸è§æœåŠ¡** çš„æ–¹æ³•ã€‚
{% endhint %}

## æœåŠ¡æšä¸¾ã€åæœŸåˆ©ç”¨ä¸æŒä¹…æ€§

AWS æ‹¥æœ‰æƒŠäººçš„æœåŠ¡æ•°é‡ï¼Œåœ¨ä»¥ä¸‹é¡µé¢ä¸­ï¼Œæ‚¨å°†æ‰¾åˆ° **åŸºæœ¬ä¿¡æ¯ã€æšä¸¾** å¤‡å¿˜å•\*\*ã€\*\* å¦‚ä½• **é¿å…æ£€æµ‹**ã€è·å– **æŒä¹…æ€§** ä»¥åŠå…¶ä»–å…³äºå…¶ä¸­ä¸€äº›æœåŠ¡çš„ **åæœŸåˆ©ç”¨** æŠ€å·§ï¼š

{% content-ref url="aws-services/" %}
[aws-services](aws-services/)
{% endcontent-ref %}

è¯·æ³¨æ„ï¼Œæ‚¨ **ä¸** éœ€è¦ **æ‰‹åŠ¨** æ‰§è¡Œæ‰€æœ‰å·¥ä½œï¼Œä¸‹é¢çš„å¸–å­ä¸­æ‚¨å¯ä»¥æ‰¾åˆ°å…³äº [**è‡ªåŠ¨å·¥å…·**](./#automated-tools) çš„ **éƒ¨åˆ†**ã€‚

æ­¤å¤–ï¼Œåœ¨æ­¤é˜¶æ®µï¼Œæ‚¨å¯èƒ½ä¼šå‘ç° **æ›´å¤šæš´éœ²ç»™æœªè®¤è¯ç”¨æˆ·çš„æœåŠ¡ï¼Œ** æ‚¨å¯èƒ½èƒ½å¤Ÿåˆ©ç”¨å®ƒä»¬ï¼š

{% content-ref url="aws-unauthenticated-enum-access/" %}
[aws-unauthenticated-enum-access](aws-unauthenticated-enum-access/)
{% endcontent-ref %}

## æƒé™æå‡

å¦‚æœæ‚¨å¯ä»¥ **æ£€æŸ¥è‡³å°‘è‡ªå·±çš„æƒé™** åœ¨ä¸åŒèµ„æºä¸Šï¼Œæ‚¨å¯ä»¥ **æ£€æŸ¥æ˜¯å¦èƒ½å¤Ÿè·å¾—æ›´å¤šæƒé™**ã€‚æ‚¨åº”è¯¥è‡³å°‘å…³æ³¨ä»¥ä¸‹æƒé™ï¼š

{% content-ref url="aws-privilege-escalation/" %}
[aws-privilege-escalation](aws-privilege-escalation/)
{% endcontent-ref %}

## å…¬å¼€æš´éœ²çš„æœåŠ¡

åœ¨æšä¸¾ AWS æœåŠ¡æ—¶ï¼Œæ‚¨å¯èƒ½å‘ç°å…¶ä¸­ä¸€äº› **å‘äº’è”ç½‘æš´éœ²å…ƒç´ **ï¼ˆè™šæ‹Ÿæœº/å®¹å™¨ç«¯å£ã€æ•°æ®åº“æˆ–é˜Ÿåˆ—æœåŠ¡ã€å¿«ç…§æˆ–å­˜å‚¨æ¡¶...ï¼‰ã€‚\
ä½œä¸ºæ¸—é€æµ‹è¯•è€…/çº¢é˜Ÿæˆå‘˜ï¼Œæ‚¨åº”è¯¥å§‹ç»ˆæ£€æŸ¥æ˜¯å¦å¯ä»¥åœ¨å®ƒä»¬ä¸Šæ‰¾åˆ° **æ•æ„Ÿä¿¡æ¯/æ¼æ´**ï¼Œå› ä¸ºå®ƒä»¬å¯èƒ½ä¸ºæ‚¨æä¾› **è¿›ä¸€æ­¥è®¿é—® AWS è´¦æˆ·** çš„æœºä¼šã€‚

åœ¨æœ¬ä¹¦ä¸­ï¼Œæ‚¨åº”è¯¥æ‰¾åˆ°å…³äºå¦‚ä½•æŸ¥æ‰¾ **æš´éœ²çš„ AWS æœåŠ¡ä»¥åŠå¦‚ä½•æ£€æŸ¥å®ƒä»¬** çš„ **ä¿¡æ¯**ã€‚å…³äºå¦‚ä½•æŸ¥æ‰¾ **æš´éœ²ç½‘ç»œæœåŠ¡ä¸­çš„æ¼æ´**ï¼Œæˆ‘å»ºè®®æ‚¨ **æœç´¢** ç‰¹å®šçš„ **æœåŠ¡** åœ¨ï¼š

{% embed url="https://book.hacktricks.xyz/" %}

## ç ´åç»„ç»‡

### ä»æ ¹/ç®¡ç†è´¦æˆ·

å½“ç®¡ç†è´¦æˆ·åœ¨ç»„ç»‡ä¸­åˆ›å»ºæ–°è´¦æˆ·æ—¶ï¼Œä¼šåœ¨æ–°è´¦æˆ·ä¸­åˆ›å»ºä¸€ä¸ª **æ–°è§’è‰²**ï¼Œé»˜è®¤å‘½åä¸º **`OrganizationAccountAccessRole`**ï¼Œå¹¶ç»™äºˆ **AdministratorAccess** ç­–ç•¥ä»¥ä¾¿ **ç®¡ç†è´¦æˆ·** è®¿é—®æ–°è´¦æˆ·ã€‚

<figure><img src="../../.gitbook/assets/image (171).png" alt=""><figcaption></figcaption></figure>

å› æ­¤ï¼Œè¦ä»¥ç®¡ç†å‘˜èº«ä»½è®¿é—®å­è´¦æˆ·ï¼Œæ‚¨éœ€è¦ï¼š

* **ç ´å** **ç®¡ç†** è´¦æˆ·å¹¶æ‰¾åˆ° **å­è´¦æˆ·çš„ ID** å’Œ **è§’è‰²çš„åç§°**ï¼ˆé»˜è®¤æ˜¯ OrganizationAccountAccessRoleï¼‰ï¼Œä»¥å…è®¸ç®¡ç†è´¦æˆ·ä»¥ç®¡ç†å‘˜èº«ä»½è®¿é—®ã€‚
* è¦æŸ¥æ‰¾å­è´¦æˆ·ï¼Œè¯·è½¬åˆ° AWS æ§åˆ¶å°ä¸­çš„ç»„ç»‡éƒ¨åˆ†æˆ–è¿è¡Œ `aws organizations list-accounts`
* æ‚¨æ— æ³•ç›´æ¥æ‰¾åˆ°è§’è‰²çš„åç§°ï¼Œå› æ­¤è¯·æ£€æŸ¥æ‰€æœ‰è‡ªå®šä¹‰ IAM ç­–ç•¥ï¼Œå¹¶æœç´¢ä»»ä½•å…è®¸ **`sts:AssumeRole` åœ¨ä¹‹å‰å‘ç°çš„å­è´¦æˆ·ä¸Š** çš„ç­–ç•¥ã€‚
* **ç ´å** ç®¡ç†è´¦æˆ·ä¸­çš„ **ä¸»ä½“**ï¼Œä½¿å…¶å…·æœ‰ **`sts:AssumeRole` æƒé™**ï¼Œä»¥ä¾¿åœ¨å­è´¦æˆ·ä¸­ä½¿ç”¨è§’è‰²ï¼ˆå³ä½¿è¯¥è´¦æˆ·å…è®¸ç®¡ç†è´¦æˆ·ä¸­çš„ä»»ä½•äººè¿›è¡Œå†’å……ï¼Œç”±äºè¿™æ˜¯ä¸€ä¸ªå¤–éƒ¨è´¦æˆ·ï¼Œç‰¹å®šçš„ `sts:AssumeRole` æƒé™æ˜¯å¿…è¦çš„ï¼‰ã€‚

## è‡ªåŠ¨åŒ–å·¥å…·

### ä¾¦å¯Ÿ

* [**aws-recon**](https://github.com/darkbitio/aws-recon)ï¼šä¸€ä¸ªå¤šçº¿ç¨‹çš„ AWS å®‰å…¨ä¸“æ³¨çš„ **åº“å­˜æ”¶é›†å·¥å…·**ï¼Œç”¨ Ruby ç¼–å†™ã€‚
```bash
# Install
gem install aws_recon

# Recon and get json
AWS_PROFILE=<profile> aws_recon \
--services S3,EC2 \
--regions global,us-east-1,us-east-2 \
--verbose
```
* [**cloudlist**](https://github.com/projectdiscovery/cloudlist): Cloudlist æ˜¯ä¸€ä¸ª **å¤šäº‘å·¥å…·ï¼Œç”¨äºè·å–èµ„äº§**ï¼ˆä¸»æœºåï¼ŒIP åœ°å€ï¼‰æ¥è‡ªäº‘æœåŠ¡æä¾›å•†ã€‚
* [**cloudmapper**](https://github.com/duo-labs/cloudmapper): CloudMapper å¸®åŠ©æ‚¨åˆ†ææ‚¨çš„äºšé©¬é€Šç½‘ç»œæœåŠ¡ï¼ˆAWSï¼‰ç¯å¢ƒã€‚å®ƒç°åœ¨åŒ…å«æ›´å¤šåŠŸèƒ½ï¼ŒåŒ…æ‹¬å®‰å…¨é—®é¢˜çš„å®¡è®¡ã€‚
```bash
# Installation steps in github
# Create a config.json file with the aws info, like:
{
"accounts": [
{
"default": true,
"id": "<account id>",
"name": "dev"
}
],
"cidrs":
{
"2.2.2.2/28": {"name": "NY Office"}
}
}

# Enumerate
python3 cloudmapper.py collect --profile dev
## Number of resources discovered
python3 cloudmapper.py stats --accounts dev

# Create HTML report
## In the report you will find all the info already
python3 cloudmapper.py report --accounts dev

# Identify potential issues
python3 cloudmapper.py audit --accounts dev --json > audit.json
python3 cloudmapper.py audit --accounts dev --markdow > audit.md
python3 cloudmapper.py iam_report --accounts dev

# Identify admins
## The permissions search for are in https://github.com/duo-labs/cloudmapper/blob/4df9fd7303e0337ff16a08f5e58f1d46047c4a87/shared/iam_audit.py#L163-L175
python3 cloudmapper.py find_admins --accounts dev

# Identify unused elements
python3 cloudmapper.py find_unused --accounts dev

# Identify publivly exposed resources
python3 cloudmapper.py public --accounts dev

python cloudmapper.py prepare #Prepare webserver
python cloudmapper.py webserver #Show webserver
```
* [**cartography**](https://github.com/lyft/cartography): Cartography æ˜¯ä¸€ä¸ª Python å·¥å…·ï¼Œå®ƒå°†åŸºç¡€è®¾æ–½èµ„äº§åŠå…¶ä¹‹é—´çš„å…³ç³»æ•´åˆåœ¨ä¸€ä¸ªç”± Neo4j æ•°æ®åº“é©±åŠ¨çš„ç›´è§‚å›¾å½¢è§†å›¾ä¸­ã€‚
```bash
# Install
pip install cartography
## At the time of this writting you need neo4j version 3.5.*

# Get AWS info
AWS_PROFILE=dev cartography --neo4j-uri bolt://127.0.0.1:7687 --neo4j-password-prompt  --neo4j-user neo4j
```
* [**starbase**](https://github.com/JupiterOne/starbase): Starbase æ”¶é›†æ¥è‡ªæœåŠ¡å’Œç³»ç»Ÿçš„èµ„äº§å’Œå…³ç³»ï¼ŒåŒ…æ‹¬äº‘åŸºç¡€è®¾æ–½ã€SaaS åº”ç”¨ç¨‹åºã€å®‰å…¨æ§åˆ¶ç­‰ï¼Œå½¢æˆä¸€ä¸ªç›´è§‚çš„å›¾å½¢è§†å›¾ï¼Œæ”¯æŒ Neo4j æ•°æ®åº“ã€‚
* [**aws-inventory**](https://github.com/nccgroup/aws-inventory): (ä½¿ç”¨ python2) è¿™æ˜¯ä¸€ä¸ªå·¥å…·ï¼Œå°è¯• **å‘ç°æ‰€æœ‰** [**AWS èµ„æº**](https://docs.aws.amazon.com/general/latest/gr/glos-chap.html#resource) åœ¨ä¸€ä¸ªè´¦æˆ·ä¸­åˆ›å»ºçš„ã€‚
* [**aws\_public\_ips**](https://github.com/arkadiyt/aws\_public\_ips): è¿™æ˜¯ä¸€ä¸ªå·¥å…·ï¼Œç”¨äº **è·å–ä¸ AWS è´¦æˆ·å…³è”çš„æ‰€æœ‰å…¬å…± IP åœ°å€**ï¼ˆåŒ…æ‹¬ IPv4/IPv6ï¼‰ã€‚

### Privesc & Exploiting

* [**SkyArk**](https://github.com/cyberark/SkyArk)**:** å‘ç°æ‰«æçš„ AWS ç¯å¢ƒä¸­æœ€ç‰¹æƒçš„ç”¨æˆ·ï¼ŒåŒ…æ‹¬ AWS Shadow Adminsã€‚å®ƒä½¿ç”¨ powershellã€‚æ‚¨å¯ä»¥åœ¨ [https://github.com/cyberark/SkyArk/blob/master/AWStealth/AWStealth.ps1](https://github.com/cyberark/SkyArk/blob/master/AWStealth/AWStealth.ps1) çš„ **`Check-PrivilegedPolicy`** å‡½æ•°ä¸­æ‰¾åˆ° **ç‰¹æƒç­–ç•¥çš„å®šä¹‰**ã€‚
* [**pacu**](https://github.com/RhinoSecurityLabs/pacu): Pacu æ˜¯ä¸€ä¸ªå¼€æºçš„ **AWS åˆ©ç”¨æ¡†æ¶**ï¼Œæ—¨åœ¨é’ˆå¯¹äº‘ç¯å¢ƒè¿›è¡Œæ”»å‡»æ€§å®‰å…¨æµ‹è¯•ã€‚å®ƒå¯ä»¥ **æšä¸¾**ã€æŸ¥æ‰¾ **é”™è¯¯é…ç½®** å¹¶ **åˆ©ç”¨** å®ƒä»¬ã€‚æ‚¨å¯ä»¥åœ¨ [https://github.com/RhinoSecurityLabs/pacu/blob/866376cd711666c775bbfcde0524c817f2c5b181/pacu/modules/iam\_\_privesc\_scan/main.py#L134](https://github.com/RhinoSecurityLabs/pacu/blob/866376cd711666c775bbfcde0524c817f2c5b181/pacu/modules/iam\_\_privesc\_scan/main.py#L134) çš„ **`user_escalation_methods`** å­—å…¸ä¸­æ‰¾åˆ° **ç‰¹æƒæƒé™çš„å®šä¹‰**ã€‚
* è¯·æ³¨æ„ï¼Œpacu **ä»…æ£€æŸ¥æ‚¨è‡ªå·±çš„ privesc è·¯å¾„**ï¼ˆè€Œä¸æ˜¯è´¦æˆ·èŒƒå›´å†…ï¼‰ã€‚
```bash
# Install
## Feel free to use venvs
pip3 install pacu

# Use pacu CLI
pacu
> import_keys <profile_name> # import 1 profile from .aws/credentials
> import_keys --all # import all profiles
> list # list modules
> exec iam__enum_permissions # Get permissions
> exec iam__privesc_scan # List privileged permissions
```
* [**PMapper**](https://github.com/nccgroup/PMapper): Principal Mapper (PMapper) æ˜¯ä¸€ä¸ªè„šæœ¬å’Œåº“ï¼Œç”¨äºè¯†åˆ« AWS è´¦æˆ·æˆ– AWS ç»„ç»‡ä¸­ AWS èº«ä»½å’Œè®¿é—®ç®¡ç† (IAM) é…ç½®çš„é£é™©ã€‚å®ƒå°†è´¦æˆ·ä¸­çš„ä¸åŒ IAM ç”¨æˆ·å’Œè§’è‰²å»ºæ¨¡ä¸ºæœ‰å‘å›¾ï¼Œä»è€Œèƒ½å¤Ÿæ£€æŸ¥ **æƒé™æå‡** å’Œæ”»å‡»è€…å¯èƒ½é‡‡å–çš„è·å– AWS ä¸­èµ„æºæˆ–æ“ä½œçš„æ›¿ä»£è·¯å¾„ã€‚æ‚¨å¯ä»¥åœ¨ [https://github.com/nccgroup/PMapper/tree/master/principalmapper/graphing](https://github.com/nccgroup/PMapper/tree/master/principalmapper/graphing) ä¸­æ£€æŸ¥ä»¥ `_edges.py` ç»“å°¾çš„æ–‡ä»¶ä¸­ä½¿ç”¨çš„ **æƒé™ä»¥æŸ¥æ‰¾ privesc** è·¯å¾„ã€‚
```bash
# Install
pip install principalmapper

# Get data
pmapper --profile dev graph create
pmapper --profile dev graph display # Show basic info
# Generate graph
pmapper --profile dev visualize # Generate svg graph file (can also be png, dot and graphml)
pmapper --profile dev visualize --only-privesc # Only privesc permissions

# Generate analysis
pmapper --profile dev analysis
## Run queries
pmapper --profile dev query 'who can do iam:CreateUser'
pmapper --profile dev query 'preset privesc *' # Get privescs with admins

# Get organization hierarchy data
pmapper --profile dev orgs create
pmapper --profile dev orgs display
```
* [**cloudsplaining**](https://github.com/salesforce/cloudsplaining): Cloudsplaining æ˜¯ä¸€ä¸ª AWS IAM å®‰å…¨è¯„ä¼°å·¥å…·ï¼Œè¯†åˆ«æœ€å°æƒé™çš„è¿è§„è¡Œä¸ºå¹¶ç”Ÿæˆé£é™©ä¼˜å…ˆçº§çš„ HTML æŠ¥å‘Šã€‚\
å®ƒå°†å‘æ‚¨æ˜¾ç¤ºæ½œåœ¨çš„ **è¿‡åº¦æƒé™** å®¢æˆ·ã€å†…è”å’Œ aws **ç­–ç•¥** ä»¥åŠå“ªäº› **ä¸»ä½“å¯ä»¥è®¿é—®å®ƒä»¬**ã€‚ (å®ƒä¸ä»…æ£€æŸ¥æƒé™æå‡ï¼Œè¿˜æ£€æŸ¥å…¶ä»–æœ‰è¶£çš„æƒé™ï¼Œå»ºè®®ä½¿ç”¨)ã€‚
```bash
# Install
pip install cloudsplaining

# Download IAM policies to check
## Only the ones attached with the versions used
cloudsplaining download --profile dev

# Analyze the IAM policies
cloudsplaining scan --input-file /private/tmp/cloudsplaining/dev.json --output /tmp/files/
```
* [**cloudjack**](https://github.com/prevade/cloudjack): CloudJack è¯„ä¼° AWS è´¦æˆ·çš„ **å­åŸŸåŠ«æŒæ¼æ´**ï¼Œè¿™æ˜¯ç”±äº Route53 å’Œ CloudFront é…ç½®çš„è§£è€¦é€ æˆçš„ã€‚
* [**ccat**](https://github.com/RhinoSecurityLabs/ccat): åˆ—å‡º ECR ä»“åº“ -> æ‹‰å– ECR ä»“åº“ -> åé—¨åŒ– -> æ¨é€åé—¨é•œåƒ
* [**Dufflebag**](https://github.com/bishopfox/dufflebag): Dufflebag æ˜¯ä¸€ä¸ªå·¥å…·ï¼Œ**æœç´¢**å…¬å…±å¼¹æ€§å—å­˜å‚¨ (**EBS**) å¿«ç…§ä¸­çš„ç§˜å¯†ï¼Œè¿™äº›ç§˜å¯†å¯èƒ½è¢«æ„å¤–é—ç•™ã€‚

### å®¡è®¡

* [**cloudsploit**](https://github.com/aquasecurity/cloudsploit)**:** CloudSploit ç”± Aqua å¼€å‘ï¼Œæ˜¯ä¸€ä¸ªå¼€æºé¡¹ç›®ï¼Œæ—¨åœ¨æ£€æµ‹äº‘åŸºç¡€è®¾æ–½è´¦æˆ·ä¸­çš„ **å®‰å…¨é£é™©**ï¼ŒåŒ…æ‹¬ï¼šäºšé©¬é€Šç½‘ç»œæœåŠ¡ (AWS)ã€å¾®è½¯ Azureã€è°·æ­Œäº‘å¹³å° (GCP)ã€ç”²éª¨æ–‡äº‘åŸºç¡€è®¾æ–½ (OCI) å’Œ GitHubï¼ˆå®ƒä¸æŸ¥æ‰¾ ShadowAdminsï¼‰ã€‚
```bash
./index.js --csv=file.csv --console=table --config ./config.js

# Compiance options: --compliance {hipaa,cis,cis1,cis2,pci}
## use "cis" for cis level 1 and 2
```
* [**Prowler**](https://github.com/prowler-cloud/prowler): Prowler æ˜¯ä¸€ä¸ªå¼€æºå®‰å…¨å·¥å…·ï¼Œç”¨äºæ‰§è¡Œ AWS å®‰å…¨æœ€ä½³å®è·µè¯„ä¼°ã€å®¡è®¡ã€äº‹ä»¶å“åº”ã€æŒç»­ç›‘æ§ã€åŠ å›ºå’Œå–è¯å‡†å¤‡ã€‚
```bash
# Install python3, jq and git
# Install
pip install prowler
prowler -v

# Run
prowler <provider>
prowler aws --profile custom-profile [-M csv json json-asff html]
```
* [**CloudFox**](https://github.com/BishopFox/cloudfox): CloudFox å¸®åŠ©æ‚¨åœ¨ä¸ç†Ÿæ‚‰çš„äº‘ç¯å¢ƒä¸­è·å¾—æƒ…å¢ƒæ„è¯†ã€‚å®ƒæ˜¯ä¸€ä¸ªå¼€æºå‘½ä»¤è¡Œå·¥å…·ï¼Œæ—¨åœ¨å¸®åŠ©æ¸—é€æµ‹è¯•äººå‘˜å’Œå…¶ä»–è¿›æ”»æ€§å®‰å…¨ä¸“ä¸šäººå‘˜åœ¨äº‘åŸºç¡€è®¾æ–½ä¸­æ‰¾åˆ°å¯åˆ©ç”¨çš„æ”»å‡»è·¯å¾„ã€‚
```bash
cloudfox aws --profile [profile-name] all-checks
```
* [**ScoutSuite**](https://github.com/nccgroup/ScoutSuite): Scout Suite æ˜¯ä¸€ä¸ªå¼€æºçš„å¤šäº‘å®‰å…¨å®¡è®¡å·¥å…·ï¼Œèƒ½å¤Ÿå¯¹äº‘ç¯å¢ƒè¿›è¡Œå®‰å…¨æ€åŠ¿è¯„ä¼°ã€‚
```bash
# Install
virtualenv -p python3 venv
source venv/bin/activate
pip install scoutsuite
scout --help

# Get info
scout aws -p dev
```
* [**cs-suite**](https://github.com/SecurityFTW/cs-suite): äº‘å®‰å…¨å¥—ä»¶ (ä½¿ç”¨ python2.7ï¼Œä¼¼ä¹æœªç»´æŠ¤)
* [**Zeus**](https://github.com/DenizParlak/Zeus): Zeus æ˜¯ä¸€ä¸ªå¼ºå¤§çš„å·¥å…·ï¼Œç”¨äº AWS EC2 / S3 / CloudTrail / CloudWatch / KMS æœ€ä½³åŠ å›ºå®è·µ (ä¼¼ä¹æœªç»´æŠ¤)ã€‚å®ƒä»…æ£€æŸ¥ç³»ç»Ÿå†…é»˜è®¤é…ç½®çš„å‡­æ®ã€‚

### æŒç»­å®¡è®¡

* [**cloud-custodian**](https://github.com/cloud-custodian/cloud-custodian): Cloud Custodian æ˜¯ä¸€ä¸ªç”¨äºç®¡ç†å…¬å…±äº‘è´¦æˆ·å’Œèµ„æºçš„è§„åˆ™å¼•æ“ã€‚å®ƒå…è®¸ç”¨æˆ· **å®šä¹‰ç­–ç•¥ä»¥å¯ç”¨è‰¯å¥½ç®¡ç†çš„äº‘åŸºç¡€è®¾æ–½**ï¼Œæ—¢å®‰å…¨åˆæˆæœ¬ä¼˜åŒ–ã€‚å®ƒå°†ç»„ç»‡ä¸­è®¸å¤šä¸´æ—¶è„šæœ¬æ•´åˆä¸ºä¸€ä¸ªè½»é‡çº§å’Œçµæ´»çš„å·¥å…·ï¼Œå…·æœ‰ç»Ÿä¸€çš„æŒ‡æ ‡å’ŒæŠ¥å‘Šã€‚
* [**pacbot**](https://github.com/tmobile/pacbot)**: ä»£ç å³æ”¿ç­–æœºå™¨äºº (PacBot)** æ˜¯ä¸€ä¸ªç”¨äº **æŒç»­åˆè§„ç›‘æ§ã€åˆè§„æŠ¥å‘Šå’Œäº‘å®‰å…¨è‡ªåŠ¨åŒ–** çš„å¹³å°ã€‚åœ¨ PacBot ä¸­ï¼Œå®‰å…¨å’Œåˆè§„æ”¿ç­–ä»¥ä»£ç å½¢å¼å®ç°ã€‚PacBot å‘ç°çš„æ‰€æœ‰èµ„æºéƒ½æ ¹æ®è¿™äº›æ”¿ç­–è¿›è¡Œè¯„ä¼°ï¼Œä»¥è¡¡é‡æ”¿ç­–ç¬¦åˆæ€§ã€‚PacBot **è‡ªåŠ¨ä¿®å¤** æ¡†æ¶æä¾›äº†é€šè¿‡é‡‡å–é¢„å®šä¹‰æªæ–½è‡ªåŠ¨å“åº”æ”¿ç­–è¿è§„çš„èƒ½åŠ›ã€‚
* [**streamalert**](https://github.com/airbnb/streamalert)**:** StreamAlert æ˜¯ä¸€ä¸ªæ— æœåŠ¡å™¨çš„ **å®æ—¶** æ•°æ®åˆ†ææ¡†æ¶ï¼Œä½¿æ‚¨èƒ½å¤Ÿ **æ‘„å–ã€åˆ†æå’Œè­¦æŠ¥** æ¥è‡ªä»»ä½•ç¯å¢ƒçš„æ•°æ®ï¼Œ**ä½¿ç”¨æ‚¨å®šä¹‰çš„æ•°æ®æºå’Œè­¦æŠ¥é€»è¾‘**ã€‚è®¡ç®—æœºå®‰å…¨å›¢é˜Ÿä½¿ç”¨ StreamAlert æ¯å¤©æ‰«ææ•° TB çš„æ—¥å¿—æ•°æ®ä»¥è¿›è¡Œäº‹ä»¶æ£€æµ‹å’Œå“åº”ã€‚

## DEBUG: æ•è· AWS cli è¯·æ±‚
```bash
# Set proxy
export HTTP_PROXY=http://localhost:8080
export HTTPS_PROXY=http://localhost:8080

# Capture with burp nor verifying ssl
aws --no-verify-ssl ...

# Dowload brup cert and transform it to pem
curl http://127.0.0.1:8080/cert --output Downloads/certificate.cer
openssl x509 -inform der -in Downloads/certificate.cer -out Downloads/certificate.pem

# Indicate the ca cert to trust
export AWS_CA_BUNDLE=~/Downloads/certificate.pem

# Run aws cli normally trusting burp cert
aws ...
```
## å‚è€ƒæ–‡çŒ®

* [https://www.youtube.com/watch?v=8ZXRw4Ry3mQ](https://www.youtube.com/watch?v=8ZXRw4Ry3mQ)
* [https://cloudsecdocs.com/aws/defensive/tooling/audit/](https://cloudsecdocs.com/aws/defensive/tooling/audit/)

{% hint style="success" %}
å­¦ä¹ å’Œå®è·µ AWS Hackingï¼š<img src="../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">[**HackTricks åŸ¹è®­ AWS çº¢é˜Ÿä¸“å®¶ (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">\
å­¦ä¹ å’Œå®è·µ GCP Hackingï¼š<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks åŸ¹è®­ GCP çº¢é˜Ÿä¸“å®¶ (GRTE)**<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>æ”¯æŒ HackTricks</summary>

* æŸ¥çœ‹ [**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**telegram ç¾¤ç»„**](https://t.me/peass) æˆ– **åœ¨** **Twitter** ğŸ¦ **ä¸Šå…³æ³¨æˆ‘ä»¬** [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ä»“åº“æäº¤ PR æ¥åˆ†äº«é»‘å®¢æŠ€å·§ã€‚

</details>
{% endhint %}
