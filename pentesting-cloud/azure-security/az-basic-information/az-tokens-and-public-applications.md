# Az - –¢–æ–∫–µ–Ω–∏ —Ç–∞ –ü—É–±–ª—ñ—á–Ω—ñ –î–æ–¥–∞—Ç–∫–∏

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## –û—Å–Ω–æ–≤–Ω–∞ –Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è

Entra ID - —Ü–µ —Ö–º–∞—Ä–Ω–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è —ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—î—é —Ç–∞ –¥–æ—Å—Ç—É–ø–æ–º (IAM) –≤—ñ–¥ Microsoft, —è–∫–∞ —Å–ª—É–≥—É—î –æ—Å–Ω–æ–≤–Ω–æ—é —Å–∏—Å—Ç–µ–º–æ—é –∞—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó —Ç–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó –¥–ª—è —Ç–∞–∫–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤, —è–∫ Microsoft 365 —Ç–∞ Azure Resource Manager. Azure AD —Ä–µ–∞–ª—ñ–∑—É—î —Ñ—Ä–µ–π–º–≤–æ—Ä–∫ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó OAuth 2.0 —Ç–∞ –ø—Ä–æ—Ç–æ–∫–æ–ª –∞—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó OpenID Connect (OIDC) –¥–ª—è —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –¥–æ—Å—Ç—É–ø–æ–º –¥–æ —Ä–µ—Å—É—Ä—Å—ñ–≤.

### OAuth

**–ö–ª—é—á–æ–≤—ñ –£—á–∞—Å–Ω–∏–∫–∏ –≤ OAuth 2.0:**

1. **–°–µ—Ä–≤–µ—Ä –†–µ—Å—É—Ä—Å—ñ–≤ (RS):** –ó–∞—Ö–∏—â–∞—î —Ä–µ—Å—É—Ä—Å–∏, —â–æ –Ω–∞–ª–µ–∂–∞—Ç—å –≤–ª–∞—Å–Ω–∏–∫—É —Ä–µ—Å—É—Ä—Å—É.
2. **–í–ª–∞—Å–Ω–∏–∫ –†–µ—Å—É—Ä—Å—É (RO):** –ó–∞–∑–≤–∏—á–∞–π –∫—ñ–Ω—Ü–µ–≤–∏–π –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á, —è–∫–∏–π –≤–æ–ª–æ–¥—ñ—î –∑–∞—Ö–∏—â–µ–Ω–∏–º–∏ —Ä–µ—Å—É—Ä—Å–∞–º–∏.
3. **–ö–ª—ñ—î–Ω—Ç—Å—å–∫–∏–π –î–æ–¥–∞—Ç–æ–∫ (CA):** –î–æ–¥–∞—Ç–æ–∫, —â–æ –Ω–∞–º–∞–≥–∞—î—Ç—å—Å—è –æ—Ç—Ä–∏–º–∞—Ç–∏ –¥–æ—Å—Ç—É–ø –¥–æ —Ä–µ—Å—É—Ä—Å—ñ–≤ –≤—ñ–¥ —ñ–º–µ–Ω—ñ –≤–ª–∞—Å–Ω–∏–∫–∞ —Ä–µ—Å—É—Ä—Å—É.
4. **–°–µ—Ä–≤–µ—Ä –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó (AS):** –í–∏–¥–∞—î —Ç–æ–∫–µ–Ω–∏ –¥–æ—Å—Ç—É–ø—É –∫–ª—ñ—î–Ω—Ç—Å—å–∫–∏–º –¥–æ–¥–∞—Ç–∫–∞–º –ø—ñ—Å–ª—è —ó—Ö –∞—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó —Ç–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó.

**–û–±—Å—è–≥–∏ —Ç–∞ –ó–≥–æ–¥–∞:**

* **–û–±—Å—è–≥–∏:** –î—Ä—ñ–±–Ω—ñ –¥–æ–∑–≤–æ–ª–∏, –≤–∏–∑–Ω–∞—á–µ–Ω—ñ –Ω–∞ —Å–µ—Ä–≤–µ—Ä—ñ —Ä–µ—Å—É—Ä—Å—ñ–≤, —è–∫—ñ –≤–∫–∞–∑—É—é—Ç—å —Ä—ñ–≤–Ω—ñ –¥–æ—Å—Ç—É–ø—É.
* **–ó–≥–æ–¥–∞:** –ü—Ä–æ—Ü–µ—Å, –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é —è–∫–æ–≥–æ –≤–ª–∞—Å–Ω–∏–∫ —Ä–µ—Å—É—Ä—Å—É –Ω–∞–¥–∞—î –∫–ª—ñ—î–Ω—Ç—Å—å–∫–æ–º—É –¥–æ–¥–∞—Ç–∫—É –¥–æ–∑–≤—ñ–ª –Ω–∞ –¥–æ—Å—Ç—É–ø –¥–æ —Ä–µ—Å—É—Ä—Å—ñ–≤ –∑ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∏–º–∏ –æ–±—Å—è–≥–∞–º–∏.

**–Ü–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è –∑ Microsoft 365:**

* Microsoft 365 –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î Azure AD –¥–ª—è IAM —ñ —Å–∫–ª–∞–¥–∞—î—Ç—å—Å—è –∑ –∫—ñ–ª—å–∫–æ—Ö "–ø–µ—Ä–≤–∏–Ω–Ω–∏—Ö" OAuth –¥–æ–¥–∞—Ç–∫—ñ–≤.
* –¶—ñ –¥–æ–¥–∞—Ç–∫–∏ –≥–ª–∏–±–æ–∫–æ —ñ–Ω—Ç–µ–≥—Ä–æ–≤–∞–Ω—ñ —Ç–∞ —á–∞—Å—Ç–æ –º–∞—é—Ç—å –≤–∑–∞—î–º–æ–∑–∞–ª–µ–∂–Ω—ñ –≤—ñ–¥–Ω–æ—Å–∏–Ω–∏ —Å–µ—Ä–≤—ñ—Å—ñ–≤.
* –©–æ–± —Å–ø—Ä–æ—Å—Ç–∏—Ç–∏ –¥–æ—Å–≤—ñ–¥ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ —ñ –ø—ñ–¥—Ç—Ä–∏–º—É–≤–∞—Ç–∏ —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω—ñ—Å—Ç—å, Microsoft –Ω–∞–¥–∞—î "–Ω–µ—è–≤–Ω—É –∑–≥–æ–¥—É" –∞–±–æ "–ø–æ–ø–µ—Ä–µ–¥–Ω—é –∑–≥–æ–¥—É" —Ü–∏–º –ø–µ—Ä–≤–∏–Ω–Ω–∏–º –¥–æ–¥–∞—Ç–∫–∞–º.
* **–ù–µ—è–≤–Ω–∞ –ó–≥–æ–¥–∞:** –î–µ—è–∫–∏–º –¥–æ–¥–∞—Ç–∫–∞–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ **–Ω–∞–¥–∞—î—Ç—å—Å—è –¥–æ—Å—Ç—É–ø –¥–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∏—Ö –æ–±—Å—è–≥—ñ–≤ –±–µ–∑ —è–≤–Ω–æ–≥–æ —Å—Ö–≤–∞–ª–µ–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –∞–±–æ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞**.
* –¶—ñ –ø–æ–ø–µ—Ä–µ–¥–Ω—å–æ –ø–æ–≥–æ–¥–∂–µ–Ω—ñ –æ–±—Å—è–≥–∏ –∑–∞–∑–≤–∏—á–∞–π –ø—Ä–∏—Ö–æ–≤–∞–Ω—ñ —è–∫ –≤—ñ–¥ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤, —Ç–∞–∫ —ñ –≤—ñ–¥ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä—ñ–≤, —â–æ —Ä–æ–±–∏—Ç—å —ó—Ö –º–µ–Ω—à –≤–∏–¥–∏–º–∏–º–∏ –≤ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∏—Ö —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞—Ö —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è.

**–¢–∏–ø–∏ –ö–ª—ñ—î–Ω—Ç—Å—å–∫–∏—Ö –î–æ–¥–∞—Ç–∫—ñ–≤:**

1. **–ö–æ–Ω—Ñ—ñ–¥–µ–Ω—Ü—ñ–π–Ω—ñ –ö–ª—ñ—î–Ω—Ç–∏:**
* –ú–∞—é—Ç—å —Å–≤–æ—ó –≤–ª–∞—Å–Ω—ñ –æ–±–ª—ñ–∫–æ–≤—ñ –¥–∞–Ω—ñ (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, –ø–∞—Ä–æ–ª—ñ –∞–±–æ —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç–∏).
* –ú–æ–∂—É—Ç—å **–Ω–∞–¥—ñ–π–Ω–æ –∞—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫—É–≤–∞—Ç–∏ —Å–µ–±–µ** –Ω–∞ —Å–µ—Ä–≤–µ—Ä—ñ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó.
2. **–ü—É–±–ª—ñ—á–Ω—ñ –ö–ª—ñ—î–Ω—Ç–∏:**
* –ù–µ –º–∞—é—Ç—å —É–Ω—ñ–∫–∞–ª—å–Ω–∏—Ö –æ–±–ª—ñ–∫–æ–≤–∏—Ö –¥–∞–Ω–∏—Ö.
* –ù–µ –º–æ–∂—É—Ç—å –Ω–∞–¥—ñ–π–Ω–æ –∞—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫—É–≤–∞—Ç–∏—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä—ñ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó.
* **–ë–µ–∑–ø–µ–∫–æ–≤–µ –ó–Ω–∞—á–µ–Ω–Ω—è:** –ó–ª–æ–≤–º–∏—Å–Ω–∏–∫ –º–æ–∂–µ –≤–∏–¥–∞–≤–∞—Ç–∏ —Å–µ–±–µ –∑–∞ –ø—É–±–ª—ñ—á–Ω–∏–π –∫–ª—ñ—î–Ω—Ç—Å—å–∫–∏–π –¥–æ–¥–∞—Ç–æ–∫ –ø—Ä–∏ –∑–∞–ø–∏—Ç—ñ —Ç–æ–∫–µ–Ω—ñ–≤, –æ—Å–∫—ñ–ª—å–∫–∏ –Ω–µ–º–∞—î –º–µ—Ö–∞–Ω—ñ–∑–º—É –¥–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –ª–µ–≥—ñ—Ç–∏–º–Ω–æ—Å—Ç—ñ –¥–æ–¥–∞—Ç–∫–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä—ñ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó.

## –ê—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ–π–Ω—ñ –¢–æ–∫–µ–Ω–∏

–Ü—Å–Ω—É—î **—Ç—Ä–∏ —Ç–∏–ø–∏ —Ç–æ–∫–µ–Ω—ñ–≤**, —â–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å—Å—è –≤ OIDC:

* [**–¢–æ–∫–µ–Ω–∏ –î–æ—Å—Ç—É–ø—É**](https://learn.microsoft.com/en-us/azure/active-directory/develop/access-tokens)**:** –ö–ª—ñ—î–Ω—Ç –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—î —Ü–µ–π —Ç–æ–∫–µ–Ω —Å–µ—Ä–≤–µ—Ä—É —Ä–µ—Å—É—Ä—Å—ñ–≤ –¥–ª—è **–¥–æ—Å—Ç—É–ø—É –¥–æ —Ä–µ—Å—É—Ä—Å—ñ–≤**. –í—ñ–Ω –º–æ–∂–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏—Å—è –ª–∏—à–µ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ—ó –∫–æ–º–±—ñ–Ω–∞—Ü—ñ—ó –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞, –∫–ª—ñ—î–Ω—Ç–∞ —Ç–∞ —Ä–µ—Å—É—Ä—Å—É —ñ **–Ω–µ –º–æ–∂–µ –±—É—Ç–∏ –≤—ñ–¥–∫–ª–∏–∫–∞–Ω–∏–π** –¥–æ –∑–∞–∫—ñ–Ω—á–µ–Ω–Ω—è —Ç–µ—Ä–º—ñ–Ω—É –¥—ñ—ó - –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º —Ü–µ 1 –≥–æ–¥–∏–Ω–∞.
* **ID –¢–æ–∫–µ–Ω–∏**: –ö–ª—ñ—î–Ω—Ç –æ—Ç—Ä–∏–º—É—î —Ü–µ–π **—Ç–æ–∫–µ–Ω –≤—ñ–¥ —Å–µ—Ä–≤–µ—Ä–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó**. –í—ñ–Ω –º—ñ—Å—Ç–∏—Ç—å –æ—Å–Ω–æ–≤–Ω—É —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞. –í—ñ–Ω **–ø—Ä–∏–≤'—è–∑–∞–Ω–∏–π –¥–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ—ó –∫–æ–º–±—ñ–Ω–∞—Ü—ñ—ó –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ —Ç–∞ –∫–ª—ñ—î–Ω—Ç–∞**.
* **–¢–æ–∫–µ–Ω–∏ –û–Ω–æ–≤–ª–µ–Ω–Ω—è**: –ù–∞–¥–∞—é—Ç—å—Å—è –∫–ª—ñ—î–Ω—Ç—É —Ä–∞–∑–æ–º –∑ —Ç–æ–∫–µ–Ω–æ–º –¥–æ—Å—Ç—É–ø—É. –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å—Å—è –¥–ª—è **–æ—Ç—Ä–∏–º–∞–Ω–Ω—è –Ω–æ–≤–∏—Ö —Ç–æ–∫–µ–Ω—ñ–≤ –¥–æ—Å—Ç—É–ø—É —Ç–∞ ID —Ç–æ–∫–µ–Ω—ñ–≤**. –í—ñ–Ω –ø—Ä–∏–≤'—è–∑–∞–Ω–∏–π –¥–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ—ó –∫–æ–º–±—ñ–Ω–∞—Ü—ñ—ó –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ —Ç–∞ –∫–ª—ñ—î–Ω—Ç–∞ —ñ –º–æ–∂–µ –±—É—Ç–∏ –≤—ñ–¥–∫–ª–∏–∫–∞–Ω–∏–π. –ó–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º —Ç–µ—Ä–º—ñ–Ω –¥—ñ—ó —Å—Ç–∞–Ω–æ–≤–∏—Ç—å **90 –¥–Ω—ñ–≤** –¥–ª—è –Ω–µ–∞–∫—Ç–∏–≤–Ω–∏—Ö —Ç–æ–∫–µ–Ω—ñ–≤ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è —Ç–∞ **–Ω–µ–º–∞—î —Ç–µ—Ä–º—ñ–Ω—É –¥—ñ—ó –¥–ª—è –∞–∫—Ç–∏–≤–Ω–∏—Ö —Ç–æ–∫–µ–Ω—ñ–≤** (–∑ —Ç–æ–∫–µ–Ω–∞ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –º–æ–∂–ª–∏–≤–æ –æ—Ç—Ä–∏–º–∞—Ç–∏ –Ω–æ–≤—ñ —Ç–æ–∫–µ–Ω–∏ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è).
* –¢–æ–∫–µ–Ω –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –ø–æ–≤–∏–Ω–µ–Ω –±—É—Ç–∏ –ø—Ä–∏–≤'—è–∑–∞–Ω–∏–π –¥–æ **`aud`**, –¥–æ –¥–µ—è–∫–∏—Ö **–æ–±—Å—è–≥—ñ–≤** —Ç–∞ –¥–æ **–æ—Ä–µ–Ω–¥–∞—Ä—è**, —ñ –≤—ñ–Ω –ø–æ–≤–∏–Ω–µ–Ω –º–∞—Ç–∏ –º–æ–∂–ª–∏–≤—ñ—Å—Ç—å –≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏ —Ç–æ–∫–µ–Ω–∏ –¥–æ—Å—Ç—É–ø—É –ª–∏—à–µ –¥–ª—è —Ü—å–æ–≥–æ aud, –æ–±—Å—è–≥—ñ–≤ (—ñ –Ω–µ –±—ñ–ª—å—à–µ) —Ç–∞ –æ—Ä–µ–Ω–¥–∞—Ä—è. –û–¥–Ω–∞–∫ —Ü–µ –Ω–µ —Ç–∞–∫ –¥–ª—è **—Ç–æ–∫–µ–Ω—ñ–≤ –¥–æ–¥–∞—Ç–∫—ñ–≤ FOCI**.
* –¢–æ–∫–µ–Ω –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–π, —ñ –ª–∏—à–µ Microsoft –º–æ–∂–µ –π–æ–≥–æ —Ä–æ–∑—à–∏—Ñ—Ä—É–≤–∞—Ç–∏.
* –û—Ç—Ä–∏–º–∞–Ω–Ω—è –Ω–æ–≤–æ–≥–æ —Ç–æ–∫–µ–Ω–∞ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –Ω–µ –≤—ñ–¥–∫–ª–∏–∫–∞—î –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ–π —Ç–æ–∫–µ–Ω –æ–Ω–æ–≤–ª–µ–Ω–Ω—è.

{% hint style="warning" %}
–Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –¥–ª—è **—É–º–æ–≤–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø—É** **–∑–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è** –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ **JWT**. –¢–æ–º—É, —è–∫—â–æ –≤–∏ –∑–∞–ø–∏—Ç—É—î—Ç–µ **—Ç–æ–∫–µ–Ω –∑ –¥–æ–∑–≤–æ–ª–µ–Ω–æ—ó IP-–∞–¥—Ä–µ—Å–∏**, —Ü—è **IP** –±—É–¥–µ **–∑–±–µ—Ä–µ–∂–µ–Ω–∞** –≤ —Ç–æ–∫–µ–Ω—ñ, —ñ —Ç–æ–¥—ñ –≤–∏ –∑–º–æ–∂–µ—Ç–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ —Ü–µ–π —Ç–æ–∫–µ–Ω –∑ **–Ω–µ–¥–æ–∑–≤–æ–ª–µ–Ω–æ—ó IP –¥–ª—è –¥–æ—Å—Ç—É–ø—É –¥–æ —Ä–µ—Å—É—Ä—Å—ñ–≤**.
{% endhint %}

### –¢–æ–∫–µ–Ω–∏ –î–æ—Å—Ç—É–ø—É "aud"

–ü–æ–ª–µ, –≤–∫–∞–∑–∞–Ω–µ –≤ –ø–æ–ª—ñ "aud", —î **—Å–µ—Ä–≤–µ—Ä–æ–º —Ä–µ—Å—É—Ä—Å—ñ–≤** (–¥–æ–¥–∞—Ç–∫–æ–º), —â–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –¥–ª—è –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –≤—Ö–æ–¥—É.

–ö–æ–º–∞–Ω–¥–∞ `az account get-access-token --resource-type [...]` –ø—ñ–¥—Ç—Ä–∏–º—É—î —Ç–∞–∫—ñ —Ç–∏–ø–∏, —ñ –∫–æ–∂–µ–Ω –∑ –Ω–∏—Ö –¥–æ–¥–∞—Å—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∏–π "aud" —É —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏–≤–Ω–∏–π —Ç–æ–∫–µ–Ω –¥–æ—Å—Ç—É–ø—É:

{% hint style="danger" %}
–ó–≤–µ—Ä–Ω—ñ—Ç—å —É–≤–∞–≥—É, —â–æ –Ω–∞—Å—Ç—É–ø–Ω—ñ —î –ª–∏—à–µ API, –ø—ñ–¥—Ç—Ä–∏–º—É–≤–∞–Ω–∏–º–∏ `az account get-access-token`, –∞–ª–µ —ó—Ö –±—ñ–ª—å—à–µ.
{% endhint %}

<details>

<summary>–ø—Ä–∏–∫–ª–∞–¥–∏ aud</summary>

* **aad-graph (Azure Active Directory Graph API)**: –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –¥–ª—è –¥–æ—Å—Ç—É–ø—É –¥–æ –∑–∞—Å—Ç–∞—Ä—ñ–ª–æ–≥–æ Azure AD Graph API (–¥–µ–ø—Ä–µ—Ü–æ–≤–∞–Ω–∏–π), —è–∫–∏–π –¥–æ–∑–≤–æ–ª—è—î –¥–æ–¥–∞—Ç–∫–∞–º —á–∏—Ç–∞—Ç–∏ —Ç–∞ –∑–∞–ø–∏—Å—É–≤–∞—Ç–∏ –¥–∞–Ω—ñ –∫–∞—Ç–∞–ª–æ–≥—É –≤ Azure Active Directory (Azure AD).
* `https://graph.windows.net/`

- **arm (Azure Resource Manager)**: –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –¥–ª—è —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è —Ä–µ—Å—É—Ä—Å–∞–º–∏ Azure —á–µ—Ä–µ–∑ API Azure Resource Manager. –¶–µ –≤–∫–ª—é—á–∞—î –æ–ø–µ—Ä–∞—Ü—ñ—ó, —Ç–∞–∫—ñ —è–∫ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è, –æ–Ω–æ–≤–ª–µ–Ω–Ω—è —Ç–∞ –≤–∏–¥–∞–ª–µ–Ω–Ω—è —Ä–µ—Å—É—Ä—Å—ñ–≤, —Ç–∞–∫–∏—Ö —è–∫ –≤—ñ—Ä—Ç—É–∞–ª—å–Ω—ñ –º–∞—à–∏–Ω–∏, –æ–±–ª—ñ–∫–æ–≤—ñ –∑–∞–ø–∏—Å–∏ –∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è —Ç–æ—â–æ.
* `https://management.core.windows.net/ or https://management.azure.com/`

* **batch (Azure Batch Services)**: –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –¥–ª—è –¥–æ—Å—Ç—É–ø—É –¥–æ Azure Batch, —Å–µ—Ä–≤—ñ—Å—É, —è–∫–∏–π –¥–æ–∑–≤–æ–ª—è—î –µ—Ñ–µ–∫—Ç–∏–≤–Ω–æ –≤–∏–∫–æ–Ω—É–≤–∞—Ç–∏ –≤–µ–ª–∏–∫–æ–º–∞—Å—à—Ç–∞–±–Ω—ñ –ø–∞—Ä–∞–ª–µ–ª—å–Ω—ñ —Ç–∞ –≤–∏—Å–æ–∫–æ–ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ñ –æ–±—á–∏—Å–ª—é–≤–∞–ª—å–Ω—ñ –ø—Ä–æ–≥—Ä–∞–º–∏ –≤ —Ö–º–∞—Ä—ñ.
* `https://batch.core.windows.net/`

- **data-lake (Azure Data Lake Storage)**: –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –¥–ª—è –≤–∑–∞—î–º–æ–¥—ñ—ó –∑ Azure Data Lake Storage Gen1, —è–∫–∏–π —î –º–∞—Å—à—Ç–∞–±–æ–≤–∞–Ω–∏–º —Å–µ—Ä–≤—ñ—Å–æ–º –∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è –¥–∞–Ω–∏—Ö —Ç–∞ –∞–Ω–∞–ª—ñ—Ç–∏–∫–∏.
* `https://datalake.azure.net/`

* **media (Azure Media Services)**: –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –¥–ª—è –¥–æ—Å—Ç—É–ø—É –¥–æ Azure Media Services, —è–∫—ñ –Ω–∞–¥–∞—é—Ç—å —Ö–º–∞—Ä–Ω—ñ –ø–æ—Å–ª—É–≥–∏ –æ–±—Ä–æ–±–∫–∏ —Ç–∞ –¥–æ—Å—Ç–∞–≤–∫–∏ –º–µ–¥—ñ–∞ –¥–ª—è –≤—ñ–¥–µ–æ —Ç–∞ –∞—É–¥—ñ–æ –∫–æ–Ω—Ç–µ–Ω—Ç—É.
* `https://rest.media.azure.net`

- **ms-graph (Microsoft Graph API)**: –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –¥–ª—è –¥–æ—Å—Ç—É–ø—É –¥–æ Microsoft Graph API, —î–¥–∏–Ω–æ–≥–æ –∫—ñ–Ω—Ü–µ–≤–æ–≥–æ –ø—É–Ω–∫—Ç—É –¥–ª—è –¥–∞–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ Microsoft 365. –¶–µ –¥–æ–∑–≤–æ–ª—è—î –æ—Ç—Ä–∏–º—É–≤–∞—Ç–∏ –¥–∞–Ω—ñ —Ç–∞ —ñ–Ω—Å–∞–π—Ç–∏ –∑ —Ç–∞–∫–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤, —è–∫ Azure AD, Office 365, Enterprise Mobility —Ç–∞ Security services.
* `https://graph.microsoft.com`

* **oss-rdbms (Azure Open Source Relational Databases)**: –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –¥–ª—è –¥–æ—Å—Ç—É–ø—É –¥–æ —Å–µ—Ä–≤—ñ—Å—ñ–≤ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö Azure –¥–ª—è –≤—ñ–¥–∫—Ä–∏—Ç–∏—Ö —Ä–µ–ª—è—Ü—ñ–π–Ω–∏—Ö –±–∞–∑ –¥–∞–Ω–∏—Ö, —Ç–∞–∫–∏—Ö —è–∫ MySQL, PostgreSQL —Ç–∞ MariaDB.
* `https://ossrdbms-aad.database.windows.net`

</details>

### –û–±—Å—è–≥–∏ –¢–æ–∫–µ–Ω—ñ–≤ –î–æ—Å—Ç—É–ø—É "scp"

–û–±—Å—è–≥ —Ç–æ–∫–µ–Ω–∞ –¥–æ—Å—Ç—É–ø—É –∑–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ –∫–ª—é—á–∞ scp –≤ JWT —Ç–æ–∫–µ–Ω–∞ –¥–æ—Å—Ç—É–ø—É. –¶—ñ –æ–±—Å—è–≥–∏ –≤–∏–∑–Ω–∞—á–∞—é—Ç—å, –¥–æ —á–æ–≥–æ –º–∞—î –¥–æ—Å—Ç—É–ø —Ç–æ–∫–µ–Ω –¥–æ—Å—Ç—É–ø—É.

–Ø–∫—â–æ JWT –¥–æ–∑–≤–æ–ª–µ–Ω–æ –∫–æ–Ω—Ç–∞–∫—Ç—É–≤–∞—Ç–∏ –∑ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∏–º API, –∞–ª–µ **–Ω–µ –º–∞—î –æ–±—Å—è–≥—É** –¥–ª—è –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –∑–∞–ø–∏—Ç–∞–Ω–æ—ó –¥—ñ—ó, –≤—ñ–Ω **–Ω–µ –∑–º–æ–∂–µ –≤–∏–∫–æ–Ω–∞—Ç–∏ —Ü—é –¥—ñ—é** –∑ —Ü–∏–º JWT.

### –ü—Ä–∏–∫–ª–∞–¥ –æ—Ç—Ä–∏–º–∞–Ω–Ω—è —Ç–æ–∫–µ–Ω–∞ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è —Ç–∞ –¥–æ—Å—Ç—É–ø—É
```python
# Code example from https://github.com/secureworks/family-of-client-ids-research
import msal
import requests
import jwt
from pprint import pprint
from typing import Any, Dict, List


# LOGIN VIA CODE FLOW AUTHENTICATION
azure_cli_client = msal.PublicClientApplication(
"04b07795-8ddb-461a-bbee-02f9e1bf7b46" # ID for Azure CLI client
)
device_flow = azure_cli_client.initiate_device_flow(
scopes=["https://graph.microsoft.com/.default"]
)
print(device_flow["message"])

# Perform device code flow authentication

azure_cli_bearer_tokens_for_graph_api = azure_cli_client.acquire_token_by_device_flow(
device_flow
)
pprint(azure_cli_bearer_tokens_for_graph_api)



# DECODE JWT
def decode_jwt(base64_blob: str) -> Dict[str, Any]:
"""Decodes base64 encoded JWT blob"""
return jwt.decode(
base64_blob, options={"verify_signature": False, "verify_aud": False}
)
decoded_access_token = decode_jwt(
azure_cli_bearer_tokens_for_graph_api.get("access_token")
)
pprint(decoded_access_token)


# GET NEW ACCESS TOKEN AND REFRESH TOKEN
new_azure_cli_bearer_tokens_for_graph_api = (
# Same client as original authorization
azure_cli_client.acquire_token_by_refresh_token(
azure_cli_bearer_tokens_for_graph_api.get("refresh_token"),
# Same scopes as original authorization
scopes=["https://graph.microsoft.com/.default"],
)
)
pprint(new_azure_cli_bearer_tokens_for_graph_api)
```
## FOCI Tokens Privilege Escalation

–†–∞–Ω—ñ—à–µ –∑–≥–∞–¥—É–≤–∞–ª–æ—Å—è, —â–æ —Ç–æ–∫–µ–Ω–∏ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –ø–æ–≤–∏–Ω–Ω—ñ –±—É—Ç–∏ –ø—Ä–∏–≤'—è–∑–∞–Ω—ñ –¥–æ **–æ–±–ª–∞—Å—Ç–µ–π** (scopes), –∑ —è–∫–∏–º–∏ –≤–æ–Ω–∏ –±—É–ª–∏ –∑–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω—ñ, –¥–æ **–¥–æ–¥–∞—Ç–∫—É** —Ç–∞ **–æ—Ä–µ–Ω–¥–∞—Ä—è** (tenant), –¥–ª—è —è–∫–æ–≥–æ –≤–æ–Ω–∏ –±—É–ª–∏ –∑–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω—ñ. –Ø–∫—â–æ –±—É–¥—å-—è–∫–∞ –∑ —Ü–∏—Ö –º–µ–∂ –±—É–¥–µ –ø–æ—Ä—É—à–µ–Ω–∞, –º–æ–∂–ª–∏–≤–æ –ø—ñ–¥–≤–∏—â–∏—Ç–∏ –ø—Ä–∏–≤—ñ–ª–µ—ó, –æ—Å–∫—ñ–ª—å–∫–∏ –±—É–¥–µ –º–æ–∂–ª–∏–≤—ñ—Å—Ç—å –≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏ —Ç–æ–∫–µ–Ω–∏ –¥–æ—Å—Ç—É–ø—É –¥–æ —ñ–Ω—à–∏—Ö —Ä–µ—Å—É—Ä—Å—ñ–≤ —ñ –æ—Ä–µ–Ω–¥–∞—Ä—ñ–≤, –¥–æ —è–∫–∏—Ö –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –º–∞—î –¥–æ—Å—Ç—É–ø, —ñ –∑ –±—ñ–ª—å—à–æ—é –∫—ñ–ª—å–∫—ñ—Å—Ç—é –æ–±–ª–∞—Å—Ç–µ–π, –Ω—ñ–∂ —Ü–µ –±—É–ª–æ —Å–ø–æ—á–∞—Ç–∫—É –ø–µ—Ä–µ–¥–±–∞—á–µ–Ω–æ.

–ë—ñ–ª—å—à–µ —Ç–æ–≥–æ, **—Ü–µ –º–æ–∂–ª–∏–≤–æ –∑ —É—Å—ñ–º–∞ —Ç–æ–∫–µ–Ω–∞–º–∏ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è** –≤ [Microsoft identity platform](https://learn.microsoft.com/en-us/entra/identity-platform/) (–æ–±–ª—ñ–∫–æ–≤—ñ –∑–∞–ø–∏—Å–∏ Microsoft Entra, –æ—Å–æ–±–∏—Å—Ç—ñ –æ–±–ª—ñ–∫–æ–≤—ñ –∑–∞–ø–∏—Å–∏ Microsoft —Ç–∞ —Å–æ—Ü—ñ–∞–ª—å–Ω—ñ –æ–±–ª—ñ–∫–æ–≤—ñ –∑–∞–ø–∏—Å–∏, —Ç–∞–∫—ñ —è–∫ Facebook —ñ Google), –æ—Å–∫—ñ–ª—å–∫–∏, —è–∫ –∑–∞–∑–Ω–∞—á–µ–Ω–æ –≤ [**–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—ó**](https://learn.microsoft.com/en-us/entra/identity-platform/refresh-tokens): "–¢–æ–∫–µ–Ω–∏ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –ø—Ä–∏–≤'—è–∑–∞–Ω—ñ –¥–æ –∫–æ–º–±—ñ–Ω–∞—Ü—ñ—ó –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ —Ç–∞ –∫–ª—ñ—î–Ω—Ç–∞, –∞–ª–µ **–Ω–µ –ø—Ä–∏–≤'—è–∑–∞–Ω—ñ –¥–æ —Ä–µ—Å—É—Ä—Å—É –∞–±–æ –æ—Ä–µ–Ω–¥–∞—Ä—è**. –ö–ª—ñ—î–Ω—Ç –º–æ–∂–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ —Ç–æ–∫–µ–Ω –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –¥–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è —Ç–æ–∫–µ–Ω—ñ–≤ –¥–æ—Å—Ç—É–ø—É **–≤ –±—É–¥—å-—è–∫—ñ–π –∫–æ–º–±—ñ–Ω–∞—Ü—ñ—ó —Ä–µ—Å—É—Ä—Å—É —Ç–∞ –æ—Ä–µ–Ω–¥–∞—Ä—è**, –¥–µ –≤—ñ–Ω –º–∞—î –Ω–∞ —Ü–µ –¥–æ–∑–≤—ñ–ª. –¢–æ–∫–µ–Ω–∏ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω—ñ, —ñ –ª–∏—à–µ –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ —ñ–¥–µ–Ω—Ç–∏—á–Ω–æ—Å—Ç—ñ Microsoft –º–æ–∂–µ —ó—Ö —á–∏—Ç–∞—Ç–∏."

–ö—Ä—ñ–º —Ç–æ–≥–æ, –∑–≤–µ—Ä–Ω—ñ—Ç—å —É–≤–∞–≥—É, —â–æ FOCI –¥–æ–¥–∞—Ç–∫–∏ —î –ø—É–±–ª—ñ—á–Ω–∏–º–∏ –¥–æ–¥–∞—Ç–∫–∞–º–∏, —Ç–æ–º—É **—Å–µ–∫—Ä–µ—Ç –Ω–µ –ø–æ—Ç—Ä—ñ–±–µ–Ω** –¥–ª—è –∞–≤—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó –Ω–∞ —Å–µ—Ä–≤–µ—Ä—ñ.

–¢–æ–¥—ñ –≤—ñ–¥–æ–º—ñ –∫–ª—ñ—î–Ω—Ç–∏ FOCI, –ø—Ä–æ —è–∫—ñ –ø–æ–≤—ñ–¥–æ–º–ª—è–ª–æ—Å—è –≤ [**–æ—Ä–∏–≥—ñ–Ω–∞–ª—å–Ω–æ–º—É –¥–æ—Å–ª—ñ–¥–∂–µ–Ω–Ω—ñ**](https://github.com/secureworks/family-of-client-ids-research/tree/main), –º–æ–∂—É—Ç—å –±—É—Ç–∏ [**–∑–Ω–∞–π–¥–µ–Ω—ñ —Ç—É—Ç**](https://github.com/secureworks/family-of-client-ids-research/blob/main/known-foci-clients.csv).

### Get different scope

–ü—Ä–æ–¥–æ–≤–∂—É—é—á–∏ –∑ –ø–æ–ø–µ—Ä–µ–¥–Ω—å–æ–≥–æ –ø—Ä–∏–∫–ª–∞–¥—É –∫–æ–¥—É, —É —Ü—å–æ–º—É –∫–æ–¥—ñ –∑–∞–ø–∏—Ç—É—î—Ç—å—Å—è –Ω–æ–≤–∏–π —Ç–æ–∫–µ–Ω –¥–ª—è —ñ–Ω—à–æ—ó –æ–±–ª–∞—Å—Ç—ñ:
```python
# Code from https://github.com/secureworks/family-of-client-ids-research
azure_cli_bearer_tokens_for_outlook_api = (
# Same client as original authorization
azure_cli_client.acquire_token_by_refresh_token(
new_azure_cli_bearer_tokens_for_graph_api.get(
"refresh_token"
),
# But different scopes than original authorization
scopes=[
"https://outlook.office.com/.default"
],
)
)
pprint(azure_cli_bearer_tokens_for_outlook_api)
```
### –û—Ç—Ä–∏–º–∞—Ç–∏ —Ä—ñ–∑–Ω—ñ –∫–ª—ñ—î–Ω—Ç–∏ —Ç–∞ –æ–±–ª–∞—Å—Ç—ñ
```python
# Code from https://github.com/secureworks/family-of-client-ids-research
microsoft_office_client = msal.PublicClientApplication("d3590ed6-52b3-4102-aeff-aad2292ab01c")
microsoft_office_bearer_tokens_for_graph_api = (
# This is a different client application than we used in the previous examples
microsoft_office_client.acquire_token_by_refresh_token(
# But we can use the refresh token issued to our original client application
azure_cli_bearer_tokens_for_outlook_api.get("refresh_token"),
# And request different scopes too
scopes=["https://graph.microsoft.com/.default"],
)
)
# How is this possible?
pprint(microsoft_office_bearer_tokens_for_graph_api)
```
## –ü–æ—Å–∏–ª–∞–Ω–Ω—è

* [https://github.com/secureworks/family-of-client-ids-research](https://github.com/secureworks/family-of-client-ids-research)

{% hint style="success" %}
–í–∏–≤—á–∞–π—Ç–µ —Ç–∞ –ø—Ä–∞–∫—Ç–∏–∫—É–π—Ç–µ AWS Hacking:<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
–í–∏–≤—á–∞–π—Ç–µ —Ç–∞ –ø—Ä–∞–∫—Ç–∏–∫—É–π—Ç–µ GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>–ü—ñ–¥—Ç—Ä–∏–º–∞—Ç–∏ HackTricks</summary>

* –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ [**–ø–ª–∞–Ω–∏ –ø—ñ–¥–ø–∏—Å–∫–∏**](https://github.com/sponsors/carlospolop)!
* **–ü—Ä–∏—î–¥–Ω—É–π—Ç–µ—Å—å –¥–æ** üí¨ [**–≥—Ä—É–ø–∏ Discord**](https://discord.gg/hRep4RUj7f) –∞–±–æ [**–≥—Ä—É–ø–∏ telegram**](https://t.me/peass) –∞–±–æ **—Å–ª—ñ–¥–∫—É–π—Ç–µ** –∑–∞ –Ω–∞–º–∏ –≤ **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **–î—ñ–ª—ñ—Ç—å—Å—è —Ö–∞–∫–µ—Ä—Å—å–∫–∏–º–∏ —Ç—Ä—é–∫–∞–º–∏, –Ω–∞–¥—Å–∏–ª–∞—é—á–∏ PR –¥–æ** [**HackTricks**](https://github.com/carlospolop/hacktricks) —Ç–∞ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—ó–≤ –Ω–∞ github.

</details>
{% endhint %}
