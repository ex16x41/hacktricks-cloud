# Azure Pentesting

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* [**êµ¬ë… í”Œëœ**](https://github.com/sponsors/carlospolop)ì„ í™•ì¸í•˜ì„¸ìš”!
* **ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**telegram ê·¸ë£¹**](https://t.me/peass)ì— ê°€ì…í•˜ê±°ë‚˜ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)ì„ íŒ”ë¡œìš°í•˜ì„¸ìš”.**
* **PRì„ ì œì¶œí•˜ì—¬ í•´í‚¹ íŠ¸ë¦­ì„ ê³µìœ í•˜ì„¸ìš”:** [**HackTricks**](https://github.com/carlospolop/hacktricks) ë° [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ì €ì¥ì†Œ.

</details>
{% endhint %}

## I'M STILL BUILDING THE AZURE METHODOLOGY

## Basic Information

{% content-ref url="az-basic-information.md" %}
[az-basic-information.md](az-basic-information.md)
{% endcontent-ref %}

## Azure Pentester/Red Team Methodology

Azure í™˜ê²½ì„ ê°ì‚¬í•˜ê¸° ìœ„í•´ì„œëŠ” ì–´ë–¤ **ì„œë¹„ìŠ¤ê°€ ì‚¬ìš©ë˜ê³  ìˆëŠ”ì§€**, ë¬´ì—‡ì´ **ë…¸ì¶œë˜ê³  ìˆëŠ”ì§€**, ëˆ„ê°€ ë¬´ì—‡ì— **ì ‘ê·¼í•  ìˆ˜ ìˆëŠ”ì§€**, ë‚´ë¶€ Azure ì„œë¹„ìŠ¤ì™€ **ì™¸ë¶€ ì„œë¹„ìŠ¤**ê°€ ì–´ë–»ê²Œ ì—°ê²°ë˜ì–´ ìˆëŠ”ì§€ë¥¼ ì•„ëŠ” ê²ƒì´ ë§¤ìš° ì¤‘ìš”í•©ë‹ˆë‹¤.

Red Team ê´€ì ì—ì„œ **Azure í™˜ê²½ì„ ì¹¨í•´í•˜ëŠ” ì²« ë²ˆì§¸ ë‹¨ê³„**ëŠ” Azure ADì— ëŒ€í•œ **ìê²© ì¦ëª…**ì„ ì–»ëŠ” ê²ƒì…ë‹ˆë‹¤. ë‹¤ìŒì€ ê·¸ ë°©ë²•ì— ëŒ€í•œ ëª‡ ê°€ì§€ ì•„ì´ë””ì–´ì…ë‹ˆë‹¤:

* github (ë˜ëŠ” ìœ ì‚¬í•œ ê³³)ì—ì„œì˜ **Leaks** - OSINT
* **ì‚¬íšŒ ê³µí•™**
* **ë¹„ë°€ë²ˆí˜¸** ì¬ì‚¬ìš© (ë¹„ë°€ë²ˆí˜¸ ìœ ì¶œ)
* Azureì— í˜¸ìŠ¤íŒ…ëœ ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ì·¨ì•½ì 
* ë©”íƒ€ë°ì´í„° ì—”ë“œí¬ì¸íŠ¸ì— ì ‘ê·¼í•  ìˆ˜ ìˆëŠ” [**Server Side Request Forgery**](https://book.hacktricks.xyz/pentesting-web/ssrf-server-side-request-forgery/cloud-ssrf)
* **ë¡œì»¬ íŒŒì¼ ì½ê¸°**
* `/home/USERNAME/.azure`
* `C:\Users\USERNAME\.azure`
* `az cli` 2.30 ì´ì „ ë²„ì „ì˜ **`accessTokens.json`** íŒŒì¼ - Jan2022 - **ì•¡ì„¸ìŠ¤ í† í°ì„ í‰ë¬¸ìœ¼ë¡œ ì €ì¥**
* **`azureProfile.json`** íŒŒì¼ì—ëŠ” ë¡œê·¸ì¸í•œ ì‚¬ìš©ìì— ëŒ€í•œ **ì •ë³´**ê°€ í¬í•¨ë˜ì–´ ìˆìŠµë‹ˆë‹¤.
* **`az logout`**ì€ í† í°ì„ ì œê±°í•©ë‹ˆë‹¤.
* **`Az PowerShell`**ì˜ ì´ì „ ë²„ì „ì€ **`TokenCache.dat`**ì— **ì•¡ì„¸ìŠ¤ í† í°**ì„ **í‰ë¬¸**ìœ¼ë¡œ ì €ì¥í–ˆìŠµë‹ˆë‹¤. ë˜í•œ **`AzureRmContext.json`**ì— **ServicePrincipalSecret**ì„ **í‰ë¬¸**ìœ¼ë¡œ ì €ì¥í•©ë‹ˆë‹¤. **`Save-AzContext`** cmdletì„ ì‚¬ìš©í•˜ì—¬ **í† í°**ì„ **ì €ì¥**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\
`Disconnect-AzAccount`ë¥¼ ì‚¬ìš©í•˜ì—¬ ì´ë¥¼ ì œê±°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
* 3ì **ì¹¨í•´**
* **ë‚´ë¶€** ì§ì›
* [**ì¼ë°˜ í”¼ì‹±**](https://book.hacktricks.xyz/generic-methodologies-and-resources/phishing-methodology) (ìê²© ì¦ëª… ë˜ëŠ” Oauth ì•±)
* [Device Code Authentication Phishing](az-unauthenticated-enum-and-initial-entry/az-device-code-authentication-phishing.md)
* [Azure **Password Spraying**](az-unauthenticated-enum-and-initial-entry/az-password-spraying.md)

Azure í…Œë„ŒíŠ¸ ë‚´ë¶€ì˜ **ì‚¬ìš©ìë¥¼ ì¹¨í•´í•˜ì§€ ì•Šì•˜ë”ë¼ë„**, ì¼ë¶€ ì •ë³´ë¥¼ **ìˆ˜ì§‘**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

{% content-ref url="az-unauthenticated-enum-and-initial-entry/" %}
[az-unauthenticated-enum-and-initial-entry](az-unauthenticated-enum-and-initial-entry/)
{% endcontent-ref %}

{% hint style="info" %}
ìê²© ì¦ëª…ì„ ì–»ì€ í›„ì—ëŠ” **ê·¸ ìê²© ì¦ëª…ì´ ëˆ„êµ¬ì˜ ê²ƒì¸ì§€**, ê·¸ë¦¬ê³  **ê·¸ë“¤ì´ ë¬´ì—‡ì— ì ‘ê·¼í•  ìˆ˜ ìˆëŠ”ì§€**ë¥¼ ì•Œì•„ì•¼ í•˜ë¯€ë¡œ ê¸°ë³¸ì ì¸ ì—´ê±°ë¥¼ ìˆ˜í–‰í•´ì•¼ í•©ë‹ˆë‹¤:
{% endhint %}

## Basic Enumeration

{% hint style="info" %}
ì—´ê±°ì˜ **ê°€ì¥ ì‹œë„ëŸ¬ìš´** ë¶€ë¶„ì€ **ë¡œê·¸ì¸**ì´ì§€, ì—´ê±° ìì²´ê°€ ì•„ë‹™ë‹ˆë‹¤.
{% endhint %}

### SSRF

Azure ë‚´ë¶€ì˜ ë¨¸ì‹ ì—ì„œ SSRFë¥¼ ë°œê²¬í–ˆë‹¤ë©´ ì´ í˜ì´ì§€ì—ì„œ íŠ¸ë¦­ì„ í™•ì¸í•˜ì„¸ìš”:

{% embed url="https://book.hacktricks.xyz/pentesting-web/ssrf-server-side-request-forgery/cloud-ssrf" %}

### Bypass Login Conditions

<figure><img src="../../.gitbook/assets/image (268).png" alt=""><figcaption></figcaption></figure>

ìœ íš¨í•œ ìê²© ì¦ëª…ì´ ìˆì§€ë§Œ ë¡œê·¸ì¸í•  ìˆ˜ ì—†ëŠ” ê²½ìš°, ë‹¤ìŒê³¼ ê°™ì€ ì¼ë°˜ì ì¸ ë³´í˜¸ ì¡°ì¹˜ê°€ ìˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤:

* **IP í™”ì´íŠ¸ë¦¬ìŠ¤íŠ¸** -- ìœ íš¨í•œ IPë¥¼ ì¹¨í•´í•´ì•¼ í•©ë‹ˆë‹¤.
* **ì§€ë¦¬ì  ì œí•œ** -- ì‚¬ìš©ìê°€ ê±°ì£¼í•˜ëŠ” ê³³ì´ë‚˜ íšŒì‚¬ì˜ ì‚¬ë¬´ì‹¤ì´ ìˆëŠ” ê³³ì„ ì°¾ì•„ ë™ì¼í•œ ë„ì‹œ(ë˜ëŠ” ìµœì†Œí•œ êµ­ê°€)ì˜ IPë¥¼ ì–»ìœ¼ì„¸ìš”.
* **ë¸Œë¼ìš°ì €** -- íŠ¹ì • OS(Windows, Linux, Mac, Android, iOS)ì—ì„œë§Œ ë¸Œë¼ìš°ì €ê°€ í—ˆìš©ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤. í”¼í•´ì/íšŒì‚¬ê°€ ì‚¬ìš©í•˜ëŠ” OSë¥¼ ì°¾ì•„ë³´ì„¸ìš”.
* **Service Principal ìê²© ì¦ëª…**ì„ ì¹¨í•´í•˜ë ¤ê³  ì‹œë„í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤. ì¼ë°˜ì ìœ¼ë¡œ ì œí•œì´ ì ê³  ë¡œê·¸ì¸ ê²€í† ê°€ ëœ ì´ë£¨ì–´ì§‘ë‹ˆë‹¤.

ì´ë¥¼ ìš°íšŒí•œ í›„ì—ëŠ” ì´ˆê¸° ì„¤ì •ìœ¼ë¡œ ëŒì•„ê°€ë„ ì—¬ì „íˆ ì ‘ê·¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### Subdomain Takeover

* [https://godiego.co/posts/STO-Azure/](https://godiego.co/posts/STO-Azure/)

### Whoami

{% hint style="danger" %}
[**Az - AzureAD**](az-azuread/) ì„¹ì…˜ì—ì„œ az cli, AzureAD ë° Az PowerShellì„ **ì„¤ì¹˜í•˜ëŠ” ë°©ë²•**ì„ ë°°ìš°ì„¸ìš”.
{% endhint %}

ê°€ì¥ ë¨¼ì € ì•Œì•„ì•¼ í•  ê²ƒ ì¤‘ í•˜ë‚˜ëŠ” **ë‹¹ì‹ ì´ ëˆ„êµ¬ì¸ì§€** (ì–´ë–¤ í™˜ê²½ì— ìˆëŠ”ì§€)ì…ë‹ˆë‹¤:

{% tabs %}
{% tab title="az cli" %}
```bash
az account list
az account tenant list # Current tenant info
az account subscription list # Current subscription info
az ad signed-in-user show # Current signed-in user
az ad signed-in-user list-owned-objects # Get owned objects by current user
az account management-group list #Not allowed by default
```
{% endtab %}

{% tab title="AzureAD" %}
```powershell
#Get the current session state
Get-AzureADCurrentSessionInfo
#Get details of the current tenant
Get-AzureADTenantDetail
```
{% endtab %}

{% tab title="Az PowerShell" %}
```powershell
# Get the information about the current context (Account, Tenant, Subscription etc.)
Get-AzContext
# List all available contexts
Get-AzContext -ListAvailable
# Enumerate subscriptions accessible by the current user
Get-AzSubscription
#Get Resource group
Get-AzResourceGroup
# Enumerate all resources visible to the current user
Get-AzResource
# Enumerate all Azure RBAC role assignments
Get-AzRoleAssignment # For all users
Get-AzRoleAssignment -SignInName test@corp.onmicrosoft.com # For current user
```
{% endtab %}
{% endtabs %}

{% hint style="danger" %}
Azureë¥¼ ì—´ê±°í•˜ëŠ” ê°€ì¥ ì¤‘ìš”í•œ ëª…ë ¹ì–´ ì¤‘ í•˜ë‚˜ëŠ” Az PowerShellì˜ **`Get-AzResource`**ì…ë‹ˆë‹¤. ì´ ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•˜ë©´ **í˜„ì¬ ì‚¬ìš©ìê°€ ë³¼ ìˆ˜ ìˆëŠ” ë¦¬ì†ŒìŠ¤ë¥¼ ì•Œ ìˆ˜ ìˆìŠµë‹ˆë‹¤**.

**ì›¹ ì½˜ì†”**ì—ì„œë„ ë™ì¼í•œ ì •ë³´ë¥¼ ì–»ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. [https://portal.azure.com/#view/HubsExtension/BrowseAll](https://portal.azure.com/#view/HubsExtension/BrowseAll)ë¡œ ì´ë™í•˜ê±°ë‚˜ "All resources"ë¥¼ ê²€ìƒ‰í•˜ì„¸ìš”.
{% endhint %}

### AzureAD Enumeration

ê¸°ë³¸ì ìœ¼ë¡œ, ëª¨ë“  ì‚¬ìš©ìëŠ” ì‚¬ìš©ì, ê·¸ë£¹, ì—­í• , ì„œë¹„ìŠ¤ ì£¼ì²´ ë“±ì„ **ì—´ê±°í•  ìˆ˜ ìˆëŠ” ì¶©ë¶„í•œ ê¶Œí•œì„ ê°€ì§€ê³  ìˆì–´ì•¼ í•©ë‹ˆë‹¤** (ê¸°ë³¸ AzureAD ê¶Œí•œ í™•ì¸ [default AzureAD permissions](az-basic-information.md#default-user-permissions)).\
ì—¬ê¸°ì—ì„œ ê°€ì´ë“œë¥¼ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤:

{% content-ref url="az-azuread/" %}
[az-azuread](az-azuread/)
{% endcontent-ref %}

{% hint style="info" %}
ì´ì œ **ìê²© ì¦ëª…ì— ëŒ€í•œ ì •ë³´ë¥¼ ì–»ì—ˆìœ¼ë¯€ë¡œ** (ê·¸ë¦¬ê³  ë ˆë“œ íŒ€ì´ë¼ë©´ **íƒì§€ë˜ì§€ ì•Šì•˜ê¸°ë¥¼ ë°”ëë‹ˆë‹¤**). í™˜ê²½ì—ì„œ ì‚¬ìš© ì¤‘ì¸ ì„œë¹„ìŠ¤ë¥¼ íŒŒì•…í•  ì‹œê°„ì…ë‹ˆë‹¤.\
ë‹¤ìŒ ì„¹ì…˜ì—ì„œëŠ” **ì¼ë°˜ì ì¸ ì„œë¹„ìŠ¤ë¥¼ ì—´ê±°í•˜ëŠ” ëª‡ ê°€ì§€ ë°©ë²•**ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
{% endhint %}

## Service Principal and Access Policy

Azure ì„œë¹„ìŠ¤ëŠ” ì‹œìŠ¤í…œ ID(ì„œë¹„ìŠ¤ ìì²´) ë˜ëŠ” ì‚¬ìš©ì í• ë‹¹ ê´€ë¦¬ IDë¥¼ ê°€ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ IDëŠ” ì˜ˆë¥¼ ë“¤ì–´ KeyVaultì—ì„œ ë¹„ë°€ì„ ì½ê¸° ìœ„í•œ ì•¡ì„¸ìŠ¤ ì •ì±…ì„ ê°€ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ëŸ¬í•œ ì•¡ì„¸ìŠ¤ ì •ì±…ì€ ì œí•œë˜ì–´ì•¼ í•˜ì§€ë§Œ(ìµœì†Œ ê¶Œí•œ ì›ì¹™), í•„ìš”í•œ ê²ƒë³´ë‹¤ ë” ë§ì€ ê¶Œí•œì„ ê°€ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì¼ë°˜ì ìœ¼ë¡œ App ServiceëŠ” KeyVaultë¥¼ ì‚¬ìš©í•˜ì—¬ ë¹„ë°€ê³¼ ì¸ì¦ì„œë¥¼ ê²€ìƒ‰í•©ë‹ˆë‹¤.

ë”°ë¼ì„œ ì´ëŸ¬í•œ IDë¥¼ íƒìƒ‰í•˜ëŠ” ê²ƒì´ ìœ ìš©í•©ë‹ˆë‹¤.

## App Service SCM

App Service 'ì»¨í…Œì´ë„ˆ'ì— ë¡œê·¸ì¸í•˜ê¸° ìœ„í•œ Kudu ì½˜ì†”.

## Webshell

portal.azure.comì„ ì‚¬ìš©í•˜ì—¬ ì…¸ì„ ì„ íƒí•˜ê±°ë‚˜ shell.azure.comì„ ì‚¬ìš©í•˜ì—¬ bash ë˜ëŠ” powershellì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ ì…¸ì˜ 'ë””ìŠ¤í¬'ëŠ” storage-accountì— ì´ë¯¸ì§€ íŒŒì¼ë¡œ ì €ì¥ë©ë‹ˆë‹¤.

## Azure DevOps

Azure DevOpsëŠ” Azureì™€ ë³„ê°œì…ë‹ˆë‹¤. ì €ì¥ì†Œ, íŒŒì´í”„ë¼ì¸(yaml ë˜ëŠ” ë¦´ë¦¬ìŠ¤), ë³´ë“œ, ìœ„í‚¤ ë“±ì„ í¬í•¨í•©ë‹ˆë‹¤. Variable GroupsëŠ” ë³€ìˆ˜ ê°’ê³¼ ë¹„ë°€ì„ ì €ì¥í•˜ëŠ” ë° ì‚¬ìš©ë©ë‹ˆë‹¤.

## Automated Recon Tools

### [**ROADRecon**](https://github.com/dirkjanm/ROADtools)
```powershell
cd ROADTools
pipenv shell
roadrecon auth -u test@corp.onmicrosoft.com -p "Welcome2022!"
roadrecon gather
roadrecon gui
```
### [Monkey365](https://github.com/silverhack/monkey365)

{% code overflow="wrap" %}
```powershell
Import-Module monkey365
Get-Help Invoke-Monkey365
Get-Help Invoke-Monkey365 -Detailed
Invoke-Monkey365 -IncludeAzureActiveDirectory -ExportTo HTML -Verbose -Debug -InformationAction Continue
Invoke-Monkey365 - Instance Azure -Analysis All -ExportTo HTML
```
{% endcode %}

### [**Stormspotter**](https://github.com/Azure/Stormspotter)
```powershell
# Start Backend
cd stormspotter\backend\
pipenv shell
python ssbackend.pyz

# Start Front-end
cd stormspotter\frontend\dist\spa\
quasar.cmd serve -p 9091 --history

# Run Stormcollector
cd stormspotter\stormcollector\
pipenv shell
az login -u test@corp.onmicrosoft.com -p Welcome2022!
python stormspotter\stormcollector\sscollector.pyz cli
# This will generate a .zip file to upload in the frontend (127.0.0.1:9091)
```
### [**AzureHound**](https://github.com/BloodHoundAD/AzureHound)

AzureHoundëŠ” Azure í™˜ê²½ì—ì„œ BloodHound ë°ì´í„°ë¥¼ ìˆ˜ì§‘í•˜ëŠ” ë„êµ¬ì…ë‹ˆë‹¤. BloodHoundëŠ” ê³µê²©ìê°€ Active Directory í™˜ê²½ì—ì„œ ê¶Œí•œ ìƒìŠ¹ ê²½ë¡œë¥¼ ì°¾ëŠ” ë° ì‚¬ìš©ë˜ëŠ” ë„êµ¬ì…ë‹ˆë‹¤. AzureHoundëŠ” ì´ì™€ ìœ ì‚¬í•˜ê²Œ Azure í™˜ê²½ì—ì„œ ê¶Œí•œ ìƒìŠ¹ ê²½ë¡œë¥¼ ì°¾ëŠ” ë° ì‚¬ìš©ë©ë‹ˆë‹¤.

#### ì„¤ì¹˜ ë° ì‚¬ìš©ë²•

1. **AzureHound ì„¤ì¹˜**:
    ```bash
    git clone https://github.com/BloodHoundAD/AzureHound
    cd AzureHound
    pip install -r requirements.txt
    ```

2. **ë°ì´í„° ìˆ˜ì§‘**:
    ```bash
    python AzureHound.py -u <username> -p <password> -d <domain>
    ```

3. **BloodHoundì— ë°ì´í„° ë¡œë“œ**:
    ìˆ˜ì§‘ëœ ë°ì´í„°ë¥¼ BloodHoundì— ë¡œë“œí•˜ì—¬ ë¶„ì„í•©ë‹ˆë‹¤.

#### ì£¼ìš” ê¸°ëŠ¥

- Azure AD ì‚¬ìš©ì, ê·¸ë£¹, ì—­í• , ì• í”Œë¦¬ì¼€ì´ì…˜ ë° ì„œë¹„ìŠ¤ í”„ë¦°ì‹œí”Œì— ëŒ€í•œ ì •ë³´ë¥¼ ìˆ˜ì§‘í•©ë‹ˆë‹¤.
- ê¶Œí•œ ìƒìŠ¹ ê²½ë¡œë¥¼ ì‹œê°í™”í•˜ì—¬ ê³µê²©ìê°€ ì–´ë–¤ ê²½ë¡œë¥¼ í†µí•´ ê¶Œí•œì„ ìƒìŠ¹ì‹œí‚¬ ìˆ˜ ìˆëŠ”ì§€ ë³´ì—¬ì¤ë‹ˆë‹¤.

#### ì£¼ì˜ì‚¬í•­

- AzureHoundë¥¼ ì‚¬ìš©í•˜ê¸° ì „ì— ì ì ˆí•œ ê¶Œí•œì„ ê°€ì§€ê³  ìˆëŠ”ì§€ í™•ì¸í•´ì•¼ í•©ë‹ˆë‹¤.
- ìˆ˜ì§‘ëœ ë°ì´í„°ëŠ” ë¯¼ê°í•  ìˆ˜ ìˆìœ¼ë¯€ë¡œ ì•ˆì „í•˜ê²Œ ë³´ê´€í•´ì•¼ í•©ë‹ˆë‹¤.
```powershell
# You need to use the Az PowerShell and Azure AD modules:
$passwd = ConvertTo-SecureString "Welcome2022!" -AsPlainText -Force
$creds = New-Object System.Management.Automation.PSCredential ("test@corp.onmicrosoft.com", $passwd)
Connect-AzAccount -Credential $creds

Import-Module AzureAD\AzureAD.psd1
Connect-AzureAD -Credential $creds

# Launch AzureHound
. AzureHound\AzureHound.ps1
Invoke-AzureHound -Verbose

# Simple queries
## All Azure Users
MATCH (n:AZUser) return n.name
## All Azure Applications
MATCH (n:AZApp) return n.objectid
## All Azure Devices
MATCH (n:AZDevice) return n.name
## All Azure Groups
MATCH (n:AZGroup) return n.name
## All Azure Key Vaults
MATCH (n:AZKeyVault) return n.name
## All Azure Resource Groups
MATCH (n:AZResourceGroup) return n.name
## All Azure Service Principals
MATCH (n:AZServicePrincipal) return n.objectid
## All Azure Virtual Machines
MATCH (n:AZVM) return n.name
## All Principals with the â€˜Contributorâ€™ role
MATCH p = (n)-[r:AZContributor]->(g) RETURN p

# Advanced queries
## Get Global Admins
MATCH p =(n)-[r:AZGlobalAdmin*1..]->(m) RETURN p
## Owners of Azure Groups
MATCH p = (n)-[r:AZOwns]->(g:AZGroup) RETURN p
## All Azure Users and their Groups
MATCH p=(m:AZUser)-[r:MemberOf]->(n) WHERE NOT m.objectid CONTAINS 'S-1-5' RETURN p
## Privileged Service Principals
MATCH p = (g:AZServicePrincipal)-[r]->(n) RETURN p
## Owners of Azure Applications
MATCH p = (n)-[r:AZOwns]->(g:AZApp) RETURN p
## Paths to VMs
MATCH p = (n)-[r]->(g: AZVM) RETURN p
## Paths to KeyVault
MATCH p = (n)-[r]->(g:AZKeyVault) RETURN p
## Paths to Azure Resource Group
MATCH p = (n)-[r]->(g:AZResourceGroup) RETURN p
## On-Prem users with edges to Azure
MATCH  p=(m:User)-[r:AZResetPassword|AZOwns|AZUserAccessAdministrator|AZContributor|AZAddMembers|AZGlobalAdmin|AZVMContributor|AZOwnsAZAvereContributor]->(n) WHERE m.objectid CONTAINS 'S-1-5-21' RETURN p
## All Azure AD Groups that are synchronized with On-Premise AD
MATCH (n:Group) WHERE n.objectid CONTAINS 'S-1-5' AND n.azsyncid IS NOT NULL RETURN n
```
### [Azucar](https://github.com/nccgroup/azucar)

NCC Groupì—ì„œ ê°œë°œí•œ AzucarëŠ” Azure ì„œë¹„ìŠ¤ êµ¬ì„±ì˜ ë³´ì•ˆ ìƒíƒœë¥¼ í‰ê°€í•˜ëŠ” ë„êµ¬ì…ë‹ˆë‹¤. ì´ ë„êµ¬ëŠ” Azure êµ¬ë…ì˜ ë‹¤ì–‘í•œ ì¸¡ë©´ì„ ê²€ì‚¬í•˜ê³  ì ì¬ì ì¸ ë³´ì•ˆ ë¬¸ì œë¥¼ ì‹ë³„í•©ë‹ˆë‹¤.
```bash
# You should use an account with at least read-permission on the assets you want to access
git clone https://github.com/nccgroup/azucar.git
PS> Get-ChildItem -Recurse c:\Azucar_V10 | Unblock-File

PS> .\Azucar.ps1 -AuthMode UseCachedCredentials -Verbose -WriteLog -Debug -ExportTo PRINT
PS> .\Azucar.ps1 -ExportTo CSV,JSON,XML,EXCEL -AuthMode Certificate_Credentials -Certificate C:\AzucarTest\server.pfx -ApplicationId 00000000-0000-0000-0000-000000000000 -TenantID 00000000-0000-0000-0000-000000000000
PS> .\Azucar.ps1 -ExportTo CSV,JSON,XML,EXCEL -AuthMode Certificate_Credentials -Certificate C:\AzucarTest\server.pfx -CertFilePassword MySuperP@ssw0rd! -ApplicationId 00000000-0000-0000-0000-000000000000 -TenantID 00000000-0000-0000-0000-000000000000

# resolve the TenantID for an specific username
PS> .\Azucar.ps1 -ResolveTenantUserName user@company.com
```
### [**MicroBurst**](https://github.com/NetSPI/MicroBurst)
```
Import-Module .\MicroBurst.psm1
Import-Module .\Get-AzureDomainInfo.ps1
Get-AzureDomainInfo -folder MicroBurst -Verbose
```
### [**PowerZure**](https://github.com/hausec/PowerZure)

PowerZureëŠ” Azure í™˜ê²½ì—ì„œì˜ ê³µê²© ë° ë°©ì–´ë¥¼ ìœ„í•œ PowerShell ìŠ¤í¬ë¦½íŠ¸ ëª¨ìŒì…ë‹ˆë‹¤. ì´ ë„êµ¬ëŠ” Azure ë¦¬ì†ŒìŠ¤ì— ëŒ€í•œ ë‹¤ì–‘í•œ ì‘ì—…ì„ ìë™í™”í•˜ê³ , ë³´ì•ˆ ì·¨ì•½ì ì„ ì‹ë³„í•˜ë©°, ì ì¬ì ì¸ ê³µê²© ê²½ë¡œë¥¼ íƒìƒ‰í•˜ëŠ” ë° ìœ ìš©í•©ë‹ˆë‹¤.
```powershell
Connect-AzAccount
ipmo C:\Path\To\Powerzure.psd1
Get-AzureTarget

# Reader
$ Get-Runbook, Get-AllUsers, Get-Apps, Get-Resources, Get-WebApps, Get-WebAppDetails

# Contributor
$ Execute-Command -OS Windows -VM Win10Test -ResourceGroup Test-RG -Command "whoami"
$ Execute-MSBuild -VM Win10Test  -ResourceGroup Test-RG -File "build.xml"
$ Get-AllSecrets # AllAppSecrets, AllKeyVaultContents
$ Get-AvailableVMDisks, Get-VMDisk # Download a virtual machine's disk

# Owner
$ Set-Role -Role Contributor -User test@contoso.com -Resource Win10VMTest

# Administrator
$ Create-Backdoor, Execute-Backdoor
```
{% hint style="success" %}
AWS Hacking ë°°ìš°ê¸° ë° ì—°ìŠµí•˜ê¸°:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCP Hacking ë°°ìš°ê¸° ë° ì—°ìŠµí•˜ê¸°: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks ì§€ì›í•˜ê¸°</summary>

* [**êµ¬ë… í”Œëœ**](https://github.com/sponsors/carlospolop) í™•ì¸í•˜ê¸°!
* ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**telegram ê·¸ë£¹**](https://t.me/peass)ì— ê°€ì…í•˜ê±°ë‚˜ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)ì—ì„œ íŒ”ë¡œìš°í•˜ì„¸ìš”.
* PRì„ ì œì¶œí•˜ì—¬ [**HackTricks**](https://github.com/carlospolop/hacktricks) ë° [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ì €ì¥ì†Œì— í•´í‚¹ íŠ¸ë¦­ì„ ê³µìœ í•˜ì„¸ìš”.

</details>
{% endhint %}
