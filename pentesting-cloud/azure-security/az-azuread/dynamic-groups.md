# Az - Dinamiese Groepe Privesc

{% hint style="success" %}
Leer & oefen AWS Hacking:<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Opleiding AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Leer & oefen GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Opleiding GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Ondersteun HackTricks</summary>

* Kyk na die [**subskripsie planne**](https://github.com/sponsors/carlospolop)!
* **Sluit aan by die** üí¨ [**Discord groep**](https://discord.gg/hRep4RUj7f) of die [**telegram groep**](https://t.me/peass) of **volg** ons op **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Deel hacking truuks deur PRs in te dien na die** [**HackTricks**](https://github.com/carlospolop/hacktricks) en [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Basiese Inligting

**Dinamiese groepe** is groepe wat 'n stel **re√´ls** geconfigureer het en al die **gebruikers of toestelle** wat aan die re√´ls voldoen, word aan die groep bygevoeg. Elke keer as 'n gebruiker of toestel **attribuut** **verander** word, word dinamiese re√´ls **herkontroleer**. En wanneer 'n **nuwe re√´l** **gecre√´er** word, word al die toestelle en gebruikers **gekontroleer**.

Dinamiese groepe kan **Azure RBAC rolle** aan hulle toegeken h√™, maar dit is **nie moontlik** om **AzureAD rolle** aan dinamiese groepe toe te voeg nie.

Hierdie funksie vereis 'n Azure AD premium P1 lisensie.

## Privesc

Let daarop dat enige gebruiker standaard gaste in Azure AD kan uitnooi, so, as 'n dinamiese groep **re√´l** **toestemmings** aan gebruikers gee gebaseer op **attribuut** wat in 'n nuwe **gast** **gestel** kan word, is dit moontlik om 'n gast te **skep** met hierdie attribuut en **privilegies te eskaleer**. Dit is ook moontlik vir 'n gast om sy eie profiel te bestuur en hierdie attribuut te verander.

Kry groepe wat dinamiese lidmaatskap toelaat: `Get-AzureADMSGroup | ?{$_.GroupTypes -eq 'DynamicMembership'}`

### Voorbeeld

* **Re√´l voorbeeld**: `(user.otherMails -any (_ -contains "tester")) -and (user.userType -eq "guest")`
* **Re√´l beskrywing**: Enige Gaste gebruiker met 'n sekond√™re e-pos met die string 'tester' sal aan die groep bygevoeg word

1. Gaan na **Azure Active Directory** -> **Gebruikers** en **klik** op `Wil jy terugkeer na die ou gebruikerslys ervaring? Klik hier om die voorvertoning te verlaat`
2. Klik op **`Nuwe gas gebruiker`** en **nooi** 'n e-pos uit
3. Die **gebruiker se profiel** sal aan die Azure AD bygevoeg word sodra die uitnodiging gestuur is. Maak die gebruiker se profiel oop en **klik op (bestuur) onder Uitnodiging aanvaar**.
* ![](<../../../.gitbook/assets/image (281).png>)
4. Verander **`Herstuur uitnodiging?`** na **Ja** en jy sal 'n uitnodiging URL ontvang:
* ![](<../../../.gitbook/assets/image (205).png>)
5. Kopieer die **URL** en **maak** dit oop, **meld aan** as die uitgenooide gebruiker en **aanvaar** die uitnodiging
6. **Meld aan** in die cli as die gebruiker en stel die sekond√™re e-pos in

{% code overflow="wrap" %}
````
```powershell
# Login
$password = ConvertTo-SecureString 'password' - AsPlainText -Force
$creds = New-Object
System.Management.Automation.PSCredential('externaltester@somedomain.onmicrosoft.com', $Password)
Connect-AzureAD -Credential $creds -TenantId <tenant_id_of_attacked_domain>

# Verander OtherMails instelling
Set-AzureADUser -ObjectId <OBJECT-ID> -OtherMails <Username>@<TENANT_NAME>.onmicrosoft.com -Verbose
```
````
{% endcode %}

## Verwysings

* [https://www.mnemonic.io/resources/blog/abusing-dynamic-groups-in-azure-ad-for-privilege-escalation/](https://www.mnemonic.io/resources/blog/abusing-dynamic-groups-in-azure-ad-for-privilege-escalation/)

{% hint style="success" %}
Leer & oefen AWS Hacking:<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Opleiding AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Leer & oefen GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Opleiding GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Ondersteun HackTricks</summary>

* Kyk na die [**subskripsie planne**](https://github.com/sponsors/carlospolop)!
* **Sluit aan by die** üí¨ [**Discord groep**](https://discord.gg/hRep4RUj7f) of die [**telegram groep**](https://t.me/peass) of **volg** ons op **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Deel hacking truuks deur PRs in te dien na die** [**HackTricks**](https://github.com/carlospolop/hacktricks) en [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
