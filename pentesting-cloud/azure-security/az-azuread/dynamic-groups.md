# Az - ãƒ€ã‚¤ãƒŠãƒŸãƒƒã‚¯ã‚°ãƒ«ãƒ¼ãƒ—ã®ç‰¹æ¨©æ˜‡æ ¼

{% hint style="success" %}
AWSãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã³ã€å®Ÿè·µã™ã‚‹ï¼š<img src="../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">\
GCPãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã³ã€å®Ÿè·µã™ã‚‹ï¼š<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricksã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹</summary>

* [**ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³**](https://github.com/sponsors/carlospolop)ã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼
* **ğŸ’¬ [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã¾ãŸã¯[**Telegramã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«å‚åŠ ã™ã‚‹ã‹ã€**Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**ã‚’ãƒ•ã‚©ãƒ­ãƒ¼ã—ã¦ãã ã•ã„ã€‚**
* **ãƒãƒƒã‚­ãƒ³ã‚°ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã™ã‚‹ã«ã¯ã€[**HackTricks**](https://github.com/carlospolop/hacktricks)ãŠã‚ˆã³[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)ã®GitHubãƒªãƒã‚¸ãƒˆãƒªã«PRã‚’é€ä¿¡ã—ã¦ãã ã•ã„ã€‚**

</details>
{% endhint %}

## åŸºæœ¬æƒ…å ±

**ãƒ€ã‚¤ãƒŠãƒŸãƒƒã‚¯ã‚°ãƒ«ãƒ¼ãƒ—**ã¯ã€è¨­å®šã•ã‚ŒãŸ**ãƒ«ãƒ¼ãƒ«**ã®ã‚»ãƒƒãƒˆã‚’æŒã¤ã‚°ãƒ«ãƒ¼ãƒ—ã§ã‚ã‚Šã€ãƒ«ãƒ¼ãƒ«ã«ä¸€è‡´ã™ã‚‹ã™ã¹ã¦ã®**ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¾ãŸã¯ãƒ‡ãƒã‚¤ã‚¹**ãŒã‚°ãƒ«ãƒ¼ãƒ—ã«è¿½åŠ ã•ã‚Œã¾ã™ã€‚ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¾ãŸã¯ãƒ‡ãƒã‚¤ã‚¹ã®**å±æ€§**ãŒ**å¤‰æ›´**ã•ã‚Œã‚‹ãŸã³ã«ã€ãƒ€ã‚¤ãƒŠãƒŸãƒƒã‚¯ãƒ«ãƒ¼ãƒ«ãŒ**å†ç¢ºèª**ã•ã‚Œã¾ã™ã€‚ã¾ãŸã€**æ–°ã—ã„ãƒ«ãƒ¼ãƒ«**ãŒ**ä½œæˆ**ã•ã‚Œã‚‹ã¨ã€ã™ã¹ã¦ã®ãƒ‡ãƒã‚¤ã‚¹ã¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒ**ç¢ºèª**ã•ã‚Œã¾ã™ã€‚

ãƒ€ã‚¤ãƒŠãƒŸãƒƒã‚¯ã‚°ãƒ«ãƒ¼ãƒ—ã«ã¯**Azure RBACãƒ­ãƒ¼ãƒ«**ã‚’å‰²ã‚Šå½“ã¦ã‚‹ã“ã¨ãŒã§ãã¾ã™ãŒã€**AzureADãƒ­ãƒ¼ãƒ«**ã‚’ãƒ€ã‚¤ãƒŠãƒŸãƒƒã‚¯ã‚°ãƒ«ãƒ¼ãƒ—ã«è¿½åŠ ã™ã‚‹ã“ã¨ã¯**ã§ãã¾ã›ã‚“**ã€‚

ã“ã®æ©Ÿèƒ½ã«ã¯Azure ADãƒ—ãƒ¬ãƒŸã‚¢ãƒ P1ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ãŒå¿…è¦ã§ã™ã€‚

## ç‰¹æ¨©æ˜‡æ ¼

ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯ã€ä»»æ„ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒAzure ADã§ã‚²ã‚¹ãƒˆã‚’æ‹›å¾…ã§ãã‚‹ãŸã‚ã€ãƒ€ã‚¤ãƒŠãƒŸãƒƒã‚¯ã‚°ãƒ«ãƒ¼ãƒ—ã®**ãƒ«ãƒ¼ãƒ«**ãŒ**å±æ€§**ã«åŸºã¥ã„ã¦ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«**æ¨©é™**ã‚’ä¸ãˆã‚‹å ´åˆã€æ–°ã—ã„**ã‚²ã‚¹ãƒˆ**ã§ã“ã®å±æ€§ã‚’**è¨­å®š**ã™ã‚‹ã“ã¨ã§ã€**ã‚²ã‚¹ãƒˆã‚’ä½œæˆ**ã—ã€**ç‰¹æ¨©ã‚’æ˜‡æ ¼**ã•ã›ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚ã¾ãŸã€ã‚²ã‚¹ãƒˆã¯è‡ªåˆ†ã®ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã‚’ç®¡ç†ã—ã€ã“ã‚Œã‚‰ã®å±æ€§ã‚’å¤‰æ›´ã™ã‚‹ã“ã¨ã‚‚å¯èƒ½ã§ã™ã€‚

ãƒ€ã‚¤ãƒŠãƒŸãƒƒã‚¯ãƒ¡ãƒ³ãƒãƒ¼ã‚·ãƒƒãƒ—ã‚’è¨±å¯ã™ã‚‹ã‚°ãƒ«ãƒ¼ãƒ—ã‚’å–å¾—ã™ã‚‹ï¼š`Get-AzureADMSGroup | ?{$_.GroupTypes -eq 'DynamicMembership'}`

### ä¾‹

* **ãƒ«ãƒ¼ãƒ«ã®ä¾‹**ï¼š`(user.otherMails -any (_ -contains "tester")) -and (user.userType -eq "guest")`
* **ãƒ«ãƒ¼ãƒ«ã®èª¬æ˜**ï¼šæ–‡å­—åˆ—'tester'ã‚’å«ã‚€äºŒæ¬¡ãƒ¡ãƒ¼ãƒ«ã‚’æŒã¤ã‚²ã‚¹ãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ã‚°ãƒ«ãƒ¼ãƒ—ã«è¿½åŠ ã•ã‚Œã¾ã™ã€‚

1. **Azure Active Directory** -> **ãƒ¦ãƒ¼ã‚¶ãƒ¼**ã«ç§»å‹•ã—ã€`ãƒ¬ã‚¬ã‚·ãƒ¼ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒªã‚¹ãƒˆã®ä½“é¨“ã«æˆ»ã‚Šã¾ã™ã‹ï¼Ÿãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’çµ‚äº†ã™ã‚‹ã«ã¯ã“ã“ã‚’ã‚¯ãƒªãƒƒã‚¯`ã‚’**ã‚¯ãƒªãƒƒã‚¯**ã—ã¾ã™ã€‚
2. **`æ–°ã—ã„ã‚²ã‚¹ãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼`**ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã€ãƒ¡ãƒ¼ãƒ«ã‚’**æ‹›å¾…**ã—ã¾ã™ã€‚
3. æ‹›å¾…ãŒé€ä¿¡ã•ã‚Œã‚‹ã¨ã€**ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«**ãŒAzure ADã«**è¿½åŠ **ã•ã‚Œã¾ã™ã€‚ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã‚’é–‹ãã€**æ‹›å¾…ã‚’å—ã‘å…¥ã‚ŒãŸä¸‹ã®ï¼ˆç®¡ç†ï¼‰ã‚’ã‚¯ãƒªãƒƒã‚¯**ã—ã¾ã™ã€‚
* ![](<../../../.gitbook/assets/image (281).png>)
4. **`æ‹›å¾…ã‚’å†é€ä¿¡ã—ã¾ã™ã‹ï¼Ÿ`**ã‚’**ã¯ã„**ã«å¤‰æ›´ã™ã‚‹ã¨ã€æ‹›å¾…URLãŒå¾—ã‚‰ã‚Œã¾ã™ï¼š
* ![](<../../../.gitbook/assets/image (205).png>)
5. **URL**ã‚’ã‚³ãƒ”ãƒ¼ã—ã¦**é–‹ã**ã€æ‹›å¾…ã•ã‚ŒãŸãƒ¦ãƒ¼ã‚¶ãƒ¼ã¨ã—ã¦**ãƒ­ã‚°ã‚¤ãƒ³**ã—ã€æ‹›å¾…ã‚’**å—ã‘å…¥ã‚Œ**ã¾ã™ã€‚
6. ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¨ã—ã¦CLIã«**ãƒ­ã‚°ã‚¤ãƒ³**ã—ã€äºŒæ¬¡ãƒ¡ãƒ¼ãƒ«ã‚’è¨­å®šã—ã¾ã™ã€‚

{% code overflow="wrap" %}
````
```powershell
# ãƒ­ã‚°ã‚¤ãƒ³
$password = ConvertTo-SecureString 'password' - AsPlainText -Force
$creds = New-Object
System.Management.Automation.PSCredential('externaltester@somedomain.onmicrosoft.com', $Password)
Connect-AzureAD -Credential $creds -TenantId <tenant_id_of_attacked_domain>

# OtherMails è¨­å®šã®å¤‰æ›´
Set-AzureADUser -ObjectId <OBJECT-ID> -OtherMails <Username>@<TENANT_NAME>.onmicrosoft.com -Verbose
```
````
{% endcode %}

## å‚è€ƒæ–‡çŒ®

* [https://www.mnemonic.io/resources/blog/abusing-dynamic-groups-in-azure-ad-for-privilege-escalation/](https://www.mnemonic.io/resources/blog/abusing-dynamic-groups-in-azure-ad-for-privilege-escalation/)

{% hint style="success" %}
AWSãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã³ã€å®Ÿè·µã™ã‚‹ï¼š<img src="../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">\
GCPãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã³ã€å®Ÿè·µã™ã‚‹ï¼š<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricksã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹</summary>

* [**ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³**](https://github.com/sponsors/carlospolop)ã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼
* **ğŸ’¬ [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã¾ãŸã¯[**Telegramã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«å‚åŠ ã™ã‚‹ã‹ã€**Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**ã‚’ãƒ•ã‚©ãƒ­ãƒ¼ã—ã¦ãã ã•ã„ã€‚**
* **[**HackTricks**](https://github.com/carlospolop/hacktricks)ãŠã‚ˆã³[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)ã®GitHubãƒªãƒã‚¸ãƒˆãƒªã«PRã‚’æå‡ºã—ã¦ãƒãƒƒã‚­ãƒ³ã‚°ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã—ã¦ãã ã•ã„ã€‚**

</details>
{% endhint %}
