# Az - Dynamic Groups Privesc

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Basic Information

**Dynamic groups**ëŠ” **ê·œì¹™**ì´ ì„¤ì •ëœ ê·¸ë£¹ìœ¼ë¡œ, ê·œì¹™ì— ë§ëŠ” ëª¨ë“  **ì‚¬ìš©ì ë˜ëŠ” ì¥ì¹˜**ê°€ ê·¸ë£¹ì— ì¶”ê°€ë©ë‹ˆë‹¤. ì‚¬ìš©ìì˜ **ì†ì„±**ì´ **ë³€ê²½**ë  ë•Œë§ˆë‹¤ ë™ì  ê·œì¹™ì´ **ì¬ê²€í† **ë©ë‹ˆë‹¤. ìƒˆë¡œìš´ **ê·œì¹™**ì´ **ìƒì„±**ë  ë•Œë§ˆë‹¤ ëª¨ë“  ì¥ì¹˜ì™€ ì‚¬ìš©ìê°€ **ê²€í† **ë©ë‹ˆë‹¤.

ë™ì  ê·¸ë£¹ì—ëŠ” **Azure RBAC ì—­í• **ì„ í• ë‹¹í•  ìˆ˜ ìˆì§€ë§Œ, ë™ì  ê·¸ë£¹ì— **AzureAD ì—­í• **ì„ ì¶”ê°€í•˜ëŠ” ê²ƒì€ **ë¶ˆê°€ëŠ¥**í•©ë‹ˆë‹¤.

ì´ ê¸°ëŠ¥ì€ Azure AD í”„ë¦¬ë¯¸ì—„ P1 ë¼ì´ì„ ìŠ¤ê°€ í•„ìš”í•©ë‹ˆë‹¤.

## Privesc

ê¸°ë³¸ì ìœ¼ë¡œ ëª¨ë“  ì‚¬ìš©ìê°€ Azure ADì—ì„œ ê²ŒìŠ¤íŠ¸ë¥¼ ì´ˆëŒ€í•  ìˆ˜ ìˆìœ¼ë¯€ë¡œ, ë™ì  ê·¸ë£¹ **ê·œì¹™**ì´ **ì†ì„±**ì„ ê¸°ë°˜ìœ¼ë¡œ ì‚¬ìš©ìì—ê²Œ **ê¶Œí•œ**ì„ ë¶€ì—¬í•˜ëŠ” ê²½ìš°, ìƒˆë¡œìš´ **ê²ŒìŠ¤íŠ¸**ì—ì„œ ì´ ì†ì„±ì„ **ì„¤ì •**í•˜ì—¬ **ê¶Œí•œì„ ìƒìŠ¹**ì‹œí‚¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê²ŒìŠ¤íŠ¸ë„ ìì‹ ì˜ í”„ë¡œí•„ì„ ê´€ë¦¬í•˜ê³  ì´ëŸ¬í•œ ì†ì„±ì„ ë³€ê²½í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ë™ì  ë©¤ë²„ì‹­ì„ í—ˆìš©í•˜ëŠ” ê·¸ë£¹ ê°€ì ¸ì˜¤ê¸°: `Get-AzureADMSGroup | ?{$_.GroupTypes -eq 'DynamicMembership'}`

### Example

* **Rule example**: `(user.otherMails -any (_ -contains "tester")) -and (user.userType -eq "guest")`
* **Rule description**: ë³´ì¡° ì´ë©”ì¼ì— 'tester' ë¬¸ìì—´ì´ í¬í•¨ëœ ëª¨ë“  ê²ŒìŠ¤íŠ¸ ì‚¬ìš©ìê°€ ê·¸ë£¹ì— ì¶”ê°€ë©ë‹ˆë‹¤.

1. **Azure Active Directory** -> **Users**ë¡œ ì´ë™í•˜ì—¬ `Want to switch back to the legacy users list experience? Click here to leave the preview`ë¥¼ **í´ë¦­**
2. **`New guest user`**ë¥¼ í´ë¦­í•˜ê³  ì´ë©”ì¼ì„ **ì´ˆëŒ€**
3. ì´ˆëŒ€ê°€ ì „ì†¡ë˜ë©´ **ì‚¬ìš©ìì˜ í”„ë¡œí•„**ì´ Azure ADì— **ì¶”ê°€**ë©ë‹ˆë‹¤. ì‚¬ìš©ìì˜ í”„ë¡œí•„ì„ ì—´ê³  **Invitation accepted** ì•„ë˜ì˜ **(manage)**ë¥¼ **í´ë¦­**
* ![](<../../../.gitbook/assets/image (281).png>)
4. **`Resend invite?`**ë¥¼ **Yes**ë¡œ ë³€ê²½í•˜ë©´ ì´ˆëŒ€ URLì„ ë°›ê²Œ ë©ë‹ˆë‹¤:
* ![](<../../../.gitbook/assets/image (205).png>)
5. **URL**ì„ ë³µì‚¬í•˜ì—¬ **ì—´ê³ **, ì´ˆëŒ€ëœ ì‚¬ìš©ìë¡œ **ë¡œê·¸ì¸**í•˜ê³  ì´ˆëŒ€ë¥¼ **ìˆ˜ë½**
6. cliì—ì„œ ì‚¬ìš©ìë¡œ **ë¡œê·¸ì¸**í•˜ê³  ë³´ì¡° ì´ë©”ì¼ ì„¤ì •

{% code overflow="wrap" %}
```powershell
# Login
$password = ConvertTo-SecureString 'password' - AsPlainText -Force
$creds = New-Object
System.Management.Automation.PSCredential('externaltester@somedomain.onmicrosoft.com', $Password)
Connect-AzureAD -Credential $creds -TenantId <tenant_id_of_attacked_domain>

# Chnage OtherMails setting
Set-AzureADUser -ObjectId <OBJECT-ID> -OtherMails <Username>@<TENANT_NAME>.onmicrosoft.com -Verbose
```
{% endcode %}

## References

* [https://www.mnemonic.io/resources/blog/abusing-dynamic-groups-in-azure-ad-for-privilege-escalation/](https://www.mnemonic.io/resources/blog/abusing-dynamic-groups-in-azure-ad-for-privilege-escalation/)

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
