# Az - æ¨ªå‘ç§»åŠ¨ï¼ˆäº‘ - æœ¬åœ°ï¼‰

## Az - æ¨ªå‘ç§»åŠ¨ï¼ˆäº‘ - æœ¬åœ°ï¼‰

{% hint style="success" %}
å­¦ä¹ å¹¶ç»ƒä¹  AWS é»‘å®¢æŠ€æœ¯ï¼š<img src="../../../.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks åŸ¹è®­ AWS çº¢é˜Ÿä¸“å®¶ (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image.png" alt="" data-size="line">\
å­¦ä¹ å¹¶ç»ƒä¹  GCP é»‘å®¢æŠ€æœ¯ï¼š<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks åŸ¹è®­ GCP çº¢é˜Ÿä¸“å®¶ (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>æ”¯æŒ HackTricks</summary>

* æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**ç”µæŠ¥ç¾¤ç»„**](https://t.me/peass) æˆ– **å…³æ³¨**æˆ‘ä»¬çš„ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* é€šè¿‡å‘ [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ä»“åº“æäº¤ PR æ¥åˆ†äº«é»‘å®¢æŠ€å·§ã€‚

</details>
{% endhint %}

### æœ¬åœ°æœºå™¨è¿æ¥åˆ°äº‘

æœºå™¨è¿æ¥åˆ°äº‘çš„æ–¹å¼æœ‰æ‰€ä¸åŒï¼š

#### Azure AD åŠ å…¥

<figure><img src="../../../.gitbook/assets/image (259).png" alt=""><figcaption></figcaption></figure>

#### Workplace åŠ å…¥

<figure><img src="../../../.gitbook/assets/image (222).png" alt=""><figcaption><p><a href="https://pbs.twimg.com/media/EQZv7UHXsAArdhn?format=jpg&#x26;name=large">https://pbs.twimg.com/media/EQZv7UHXsAArdhn?format=jpg&#x26;name=large</a></p></figcaption></figure>

#### æ··åˆåŠ å…¥

<figure><img src="../../../.gitbook/assets/image (178).png" alt=""><figcaption><p><a href="https://pbs.twimg.com/media/EQZv77jXkAAC4LK?format=jpg&#x26;name=large">https://pbs.twimg.com/media/EQZv77jXkAAC4LK?format=jpg&#x26;name=large</a></p></figcaption></figure>

#### åœ¨ AADJ æˆ–æ··åˆä¸ŠåŠ å…¥ Workplace

<figure><img src="../../../.gitbook/assets/image (252).png" alt=""><figcaption><p><a href="https://pbs.twimg.com/media/EQZv8qBX0AAMWuR?format=jpg&#x26;name=large">https://pbs.twimg.com/media/EQZv8qBX0AAMWuR?format=jpg&#x26;name=large</a></p></figcaption></figure>

### ä»¤ç‰Œå’Œé™åˆ¶ <a href="#tokens-and-limitations" id="tokens-and-limitations"></a>

åœ¨ Azure AD ä¸­ï¼Œæœ‰ä¸åŒç±»å‹çš„ä»¤ç‰Œå…·æœ‰ç‰¹å®šçš„é™åˆ¶ï¼š

* **è®¿é—®ä»¤ç‰Œ**ï¼šç”¨äºè®¿é—® API å’Œèµ„æºï¼Œå¦‚ Microsoft Graphã€‚å®ƒä»¬ä¸ç‰¹å®šçš„å®¢æˆ·ç«¯å’Œèµ„æºç»‘å®šã€‚
* **åˆ·æ–°ä»¤ç‰Œ**ï¼šå‘æ”¾ç»™åº”ç”¨ç¨‹åºä»¥è·å–æ–°çš„è®¿é—®ä»¤ç‰Œã€‚å®ƒä»¬åªèƒ½è¢«å‘æ”¾ç»™çš„åº”ç”¨ç¨‹åºæˆ–ä¸€ç»„åº”ç”¨ç¨‹åºä½¿ç”¨ã€‚
* **ä¸»åˆ·æ–°ä»¤ç‰Œ (PRT)**ï¼šç”¨äº Azure AD åŠ å…¥ã€æ³¨å†Œæˆ–æ··åˆåŠ å…¥è®¾å¤‡çš„å•ç‚¹ç™»å½•ã€‚å®ƒä»¬å¯ç”¨äºæµè§ˆå™¨ç™»å½•æµç¨‹ï¼Œå¹¶ç”¨äºåœ¨è®¾å¤‡ä¸Šç™»å½•ç§»åŠ¨å’Œæ¡Œé¢åº”ç”¨ç¨‹åºã€‚
* **Windows Hello for Business å¯†é’¥ (WHFB)**ï¼šç”¨äºæ— å¯†ç èº«ä»½éªŒè¯ã€‚å®ƒç”¨äºè·å–ä¸»åˆ·æ–°ä»¤ç‰Œã€‚

æœ€æœ‰è¶£çš„ä»¤ç‰Œç±»å‹æ˜¯ä¸»åˆ·æ–°ä»¤ç‰Œï¼ˆPRTï¼‰ã€‚

{% content-ref url="az-primary-refresh-token-prt.md" %}
[az-primary-refresh-token-prt.md](az-primary-refresh-token-prt.md)
{% endcontent-ref %}

### æ¢çº½æŠ€æœ¯

ä»**å—æŸçš„æœºå™¨åˆ°äº‘**ï¼š

* [**ä¼ é€’ Cookie**](az-pass-the-cookie.md)ï¼šä»æµè§ˆå™¨çªƒå– Azure Cookie å¹¶ä½¿ç”¨å®ƒä»¬ç™»å½•
* **è½¬å‚¨è¿›ç¨‹è®¿é—®ä»¤ç‰Œ**ï¼šå¦‚[**æ­¤è§†é¢‘**](https://www.youtube.com/watch?v=OHKZkXC4Duw)ä¸­æ‰€è¿°ï¼Œä¸€äº›ä¸äº‘åŒæ­¥çš„ Microsoft è½¯ä»¶ï¼ˆå¦‚ Excelã€Teams...ï¼‰å¯èƒ½ä¼šåœ¨å†…å­˜ä¸­ä»¥æ˜æ–‡å­˜å‚¨è®¿é—®ä»¤ç‰Œã€‚å› æ­¤ï¼Œåªéœ€è½¬å‚¨è¿›ç¨‹çš„å†…å­˜å¹¶æœç´¢ JWT ä»¤ç‰Œï¼Œå¯èƒ½ä¼šä½¿æ‚¨åœ¨ç»•è¿‡ MFA çš„æƒ…å†µä¸‹è®¿é—®å—å®³è€…åœ¨äº‘ä¸­çš„å¤šä¸ªèµ„æºã€‚
* [**é’“é±¼ä¸»åˆ·æ–°ä»¤ç‰Œ**](az-phishing-primary-refresh-token-microsoft-entra.md)**ï¼š**é’“å– PRT ä»¥æ»¥ç”¨å®ƒ
* [**ä¼ é€’ PRT**](pass-the-prt.md)ï¼šçªƒå–è®¾å¤‡ PRT ä»¥å†’å……è®¿é—® Azure
* [**ä¼ é€’è¯ä¹¦**](az-pass-the-certificate.md)**ï¼š**ç”ŸæˆåŸºäº PRT çš„è¯ä¹¦ï¼Œä»ä¸€å°æœºå™¨ç™»å½•åˆ°å¦ä¸€å°æœºå™¨

ä»**AD**å—æŸåˆ°å—æŸçš„**äº‘**ï¼Œä»¥åŠä»**äº‘**å—æŸåˆ°å—æŸçš„**AD**ï¼š

* [**Azure AD Connect**](azure-ad-connect-hybrid-identity/)
* **ä»äº‘åˆ°æœ¬åœ°çš„å¦ä¸€ç§æ¢çº½æ–¹æ³•æ˜¯**[**æ»¥ç”¨ Intune**](../az-services/intune.md)

#### [Roadtx](https://github.com/dirkjanm/ROADtools)

è¯¥å·¥å…·å…è®¸æ‰§è¡Œå¤šç§æ“ä½œï¼Œå¦‚åœ¨ Azure AD ä¸­æ³¨å†Œæœºå™¨ä»¥è·å– PRTï¼Œå¹¶ä½¿ç”¨ PRTï¼ˆåˆæ³•æˆ–çªƒå–çš„ï¼‰ä»¥å¤šç§ä¸åŒæ–¹å¼è®¿é—®èµ„æºã€‚è¿™äº›ä¸æ˜¯ç›´æ¥æ”»å‡»ï¼Œä½†å®ƒç®€åŒ–äº†ä½¿ç”¨ PRT ä»¥ä¸åŒæ–¹å¼è®¿é—®èµ„æºã€‚åœ¨[https://dirkjanm.io/introducing-roadtools-token-exchange-roadtx/](https://dirkjanm.io/introducing-roadtools-token-exchange-roadtx/)ä¸­æ‰¾åˆ°æ›´å¤šä¿¡æ¯ã€‚

## å‚è€ƒèµ„æ–™

* [https://dirkjanm.io/phishing-for-microsoft-entra-primary-refresh-tokens/](https://dirkjanm.io/phishing-for-microsoft-entra-primary-refresh-tokens/) 

{% hint style="success" %}
å­¦ä¹ å¹¶ç»ƒä¹  AWS é»‘å®¢æŠ€æœ¯ï¼š<img src="../../../.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks åŸ¹è®­ AWS çº¢é˜Ÿä¸“å®¶ (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image.png" alt="" data-size="line">\
å­¦ä¹ å¹¶ç»ƒä¹  GCP é»‘å®¢æŠ€æœ¯ï¼š<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks åŸ¹è®­ GCP çº¢é˜Ÿä¸“å®¶ (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>æ”¯æŒ HackTricks</summary>

* æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**ç”µæŠ¥ç¾¤ç»„**](https://t.me/peass) æˆ– **å…³æ³¨**æˆ‘ä»¬çš„ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* é€šè¿‡å‘ [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ä»“åº“æäº¤ PR æ¥åˆ†äº«é»‘å®¢æŠ€å·§ã€‚

</details>
{% endhint %}
