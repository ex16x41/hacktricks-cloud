# Az - Lateral Movement (Cloud - On-Prem)

## Az - Lateral Movement (Cloud - On-Prem)

{% hint style="success" %}
å­¦ä¹ å’Œç»ƒä¹  AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
å­¦ä¹ å’Œç»ƒä¹  GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>æ”¯æŒ HackTricks</summary>

* æŸ¥çœ‹ [**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**telegram ç¾¤ç»„**](https://t.me/peass) æˆ– **å…³æ³¨** æˆ‘ä»¬çš„ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **é€šè¿‡æäº¤ PRs åˆ†äº«é»‘å®¢æŠ€å·§åˆ°** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ä»“åº“ã€‚

</details>
{% endhint %}

### è¿æ¥åˆ°äº‘çš„æœ¬åœ°æœºå™¨

æœºå™¨å¯ä»¥é€šè¿‡ä¸åŒæ–¹å¼è¿æ¥åˆ°äº‘ï¼š

#### Azure AD åŠ å…¥

<figure><img src="../../../.gitbook/assets/image (259).png" alt=""><figcaption></figcaption></figure>

#### Workplace åŠ å…¥

<figure><img src="../../../.gitbook/assets/image (222).png" alt=""><figcaption><p><a href="https://pbs.twimg.com/media/EQZv7UHXsAArdhn?format=jpg&#x26;name=large">https://pbs.twimg.com/media/EQZv7UHXsAArdhn?format=jpg&#x26;name=large</a></p></figcaption></figure>

#### Hybrid åŠ å…¥

<figure><img src="../../../.gitbook/assets/image (178).png" alt=""><figcaption><p><a href="https://pbs.twimg.com/media/EQZv77jXkAAC4LK?format=jpg&#x26;name=large">https://pbs.twimg.com/media/EQZv77jXkAAC4LK?format=jpg&#x26;name=large</a></p></figcaption></figure>

#### Workplace åŠ å…¥åœ¨ AADJ æˆ– Hybrid

<figure><img src="../../../.gitbook/assets/image (252).png" alt=""><figcaption><p><a href="https://pbs.twimg.com/media/EQZv8qBX0AAMWuR?format=jpg&#x26;name=large">https://pbs.twimg.com/media/EQZv8qBX0AAMWuR?format=jpg&#x26;name=large</a></p></figcaption></figure>

### ä»¤ç‰Œå’Œé™åˆ¶ <a href="#tokens-and-limitations" id="tokens-and-limitations"></a>

åœ¨ Azure AD ä¸­ï¼Œæœ‰ä¸åŒç±»å‹çš„ä»¤ç‰Œå…·æœ‰ç‰¹å®šçš„é™åˆ¶ï¼š

* **è®¿é—®ä»¤ç‰Œ**: ç”¨äºè®¿é—® API å’Œèµ„æºï¼Œå¦‚ Microsoft Graphã€‚å®ƒä»¬ä¸ç‰¹å®šçš„å®¢æˆ·ç«¯å’Œèµ„æºç»‘å®šã€‚
* **åˆ·æ–°ä»¤ç‰Œ**: é¢å‘ç»™åº”ç”¨ç¨‹åºä»¥è·å–æ–°çš„è®¿é—®ä»¤ç‰Œã€‚å®ƒä»¬åªèƒ½ç”±é¢å‘ç»™çš„åº”ç”¨ç¨‹åºæˆ–ä¸€ç»„åº”ç”¨ç¨‹åºä½¿ç”¨ã€‚
* **ä¸»è¦åˆ·æ–°ä»¤ç‰Œ (PRT)**: ç”¨äº Azure AD åŠ å…¥ã€æ³¨å†Œæˆ–æ··åˆåŠ å…¥è®¾å¤‡ä¸Šçš„å•ç‚¹ç™»å½•ã€‚å®ƒä»¬å¯ä»¥ç”¨äºæµè§ˆå™¨ç™»å½•æµç¨‹ä»¥åŠè®¾å¤‡ä¸Šçš„ç§»åŠ¨å’Œæ¡Œé¢åº”ç”¨ç¨‹åºç™»å½•ã€‚

æœ€æœ‰è¶£çš„ä»¤ç‰Œç±»å‹æ˜¯ä¸»è¦åˆ·æ–°ä»¤ç‰Œ (PRT)ã€‚

{% content-ref url="az-primary-refresh-token-prt.md" %}
[az-primary-refresh-token-prt.md](az-primary-refresh-token-prt.md)
{% endcontent-ref %}

### æ—‹è½¬æŠ€æœ¯

ä»**è¢«æ”»é™·çš„æœºå™¨åˆ°äº‘**ï¼š

* [**Pass the Cookie**](az-pass-the-cookie.md): ä»æµè§ˆå™¨ä¸­çªƒå– Azure cookies å¹¶ä½¿ç”¨å®ƒä»¬ç™»å½•
* [**Phishing Primary Refresh Token**](az-phishing-primary-refresh-token-microsoft-entra.md)**:** é’“é±¼ PRT å¹¶æ»¥ç”¨å®ƒ
* [**Pass the PRT**](pass-the-prt.md): çªƒå–è®¾å¤‡ PRT ä»¥æ¨¡æ‹Ÿè®¿é—® Azureã€‚
* [**Pass the Certificate**](az-pass-the-certificate.md)**:** åŸºäº PRT ç”Ÿæˆè¯ä¹¦ä»¥ä»ä¸€å°æœºå™¨ç™»å½•åˆ°å¦ä¸€å°æœºå™¨

ä»æ”»é™·**AD**åˆ°æ”»é™·**äº‘**ä»¥åŠä»æ”»é™·**äº‘**åˆ°æ”»é™·**AD**ï¼š

* [**Azure AD Connect**](azure-ad-connect-hybrid-identity/)
* **å¦ä¸€ç§ä»äº‘åˆ°æœ¬åœ°çš„æ—‹è½¬æ–¹å¼æ˜¯** [**æ»¥ç”¨ Intune**](../az-services/intune.md)

#### [Roadtx](https://github.com/dirkjanm/ROADtools)

æ­¤å·¥å…·å…è®¸æ‰§è¡Œå¤šç§æ“ä½œï¼Œå¦‚åœ¨ Azure AD ä¸­æ³¨å†Œæœºå™¨ä»¥è·å– PRTï¼Œå¹¶ä½¿ç”¨ PRTï¼ˆåˆæ³•æˆ–è¢«çªƒå–çš„ï¼‰ä»¥å¤šç§ä¸åŒæ–¹å¼è®¿é—®èµ„æºã€‚è¿™äº›ä¸æ˜¯ç›´æ¥æ”»å‡»ï¼Œä½†å®ƒæœ‰åŠ©äºä»¥ä¸åŒæ–¹å¼ä½¿ç”¨ PRT è®¿é—®èµ„æºã€‚æ›´å¤šä¿¡æ¯è¯·å‚è§ [https://dirkjanm.io/introducing-roadtools-token-exchange-roadtx/](https://dirkjanm.io/introducing-roadtools-token-exchange-roadtx/)

## å‚è€ƒèµ„æ–™

* [https://dirkjanm.io/phishing-for-microsoft-entra-primary-refresh-tokens/](https://dirkjanm.io/phishing-for-microsoft-entra-primary-refresh-tokens/)

{% hint style="success" %}
å­¦ä¹ å’Œç»ƒä¹  AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
å­¦ä¹ å’Œç»ƒä¹  GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>æ”¯æŒ HackTricks</summary>

* æŸ¥çœ‹ [**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**telegram ç¾¤ç»„**](https://t.me/peass) æˆ– **å…³æ³¨** æˆ‘ä»¬çš„ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **é€šè¿‡æäº¤ PRs åˆ†äº«é»‘å®¢æŠ€å·§åˆ°** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ä»“åº“ã€‚

</details>
{% endhint %}
