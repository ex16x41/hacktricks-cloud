# Az - Lateral Movement (Cloud - On-Prem)

## Az - Lateral Movement (Cloud - On-Prem)

{% hint style="success" %}
å­¦ä¹ å’Œå®è·µ AWS é»‘å®¢æŠ€æœ¯ï¼š<img src="../../../.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks åŸ¹è®­ AWS çº¢é˜Ÿä¸“å®¶ (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image.png" alt="" data-size="line">\
å­¦ä¹ å’Œå®è·µ GCP é»‘å®¢æŠ€æœ¯ï¼š<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks åŸ¹è®­ GCP çº¢é˜Ÿä¸“å®¶ (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>æ”¯æŒ HackTricks</summary>

* æŸ¥çœ‹ [**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**Telegram ç¾¤ç»„**](https://t.me/peass) æˆ– **åœ¨** **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** ä¸Šå…³æ³¨æˆ‘ä»¬ã€‚**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub ä»“åº“æäº¤ PR æ¥åˆ†äº«é»‘å®¢æŠ€å·§ã€‚

</details>
{% endhint %}

### è¿æ¥åˆ°äº‘çš„æœ¬åœ°æœºå™¨

æœºå™¨å¯ä»¥é€šè¿‡ä¸åŒæ–¹å¼è¿æ¥åˆ°äº‘ï¼š

#### Azure AD åŠ å…¥

<figure><img src="../../../.gitbook/assets/image (259).png" alt=""><figcaption></figcaption></figure>

#### Workplace åŠ å…¥

<figure><img src="../../../.gitbook/assets/image (222).png" alt=""><figcaption><p><a href="https://pbs.twimg.com/media/EQZv7UHXsAArdhn?format=jpg&#x26;name=large">https://pbs.twimg.com/media/EQZv7UHXsAArdhn?format=jpg&#x26;name=large</a></p></figcaption></figure>

#### æ··åˆåŠ å…¥

<figure><img src="../../../.gitbook/assets/image (178).png" alt=""><figcaption><p><a href="https://pbs.twimg.com/media/EQZv77jXkAAC4LK?format=jpg&#x26;name=large">https://pbs.twimg.com/media/EQZv77jXkAAC4LK?format=jpg&#x26;name=large</a></p></figcaption></figure>

#### åœ¨ AADJ æˆ–æ··åˆä¸ŠåŠ å…¥ Workplace

<figure><img src="../../../.gitbook/assets/image (252).png" alt=""><figcaption><p><a href="https://pbs.twimg.com/media/EQZv8qBX0AAMWuR?format=jpg&#x26;name=large">https://pbs.twimg.com/media/EQZv8qBX0AAMWuR?format=jpg&#x26;name=large</a></p></figcaption></figure>

### ä»¤ç‰Œå’Œé™åˆ¶ <a href="#tokens-and-limitations" id="tokens-and-limitations"></a>

åœ¨ Azure AD ä¸­ï¼Œæœ‰ä¸åŒç±»å‹çš„ä»¤ç‰Œï¼Œå…·æœ‰ç‰¹å®šçš„é™åˆ¶ï¼š

* **è®¿é—®ä»¤ç‰Œ**ï¼šç”¨äºè®¿é—® API å’Œèµ„æºï¼Œå¦‚ Microsoft Graphã€‚å®ƒä»¬ä¸ç‰¹å®šå®¢æˆ·ç«¯å’Œèµ„æºç»‘å®šã€‚
* **åˆ·æ–°ä»¤ç‰Œ**ï¼šå‘æ”¾ç»™åº”ç”¨ç¨‹åºä»¥è·å–æ–°çš„è®¿é—®ä»¤ç‰Œã€‚å®ƒä»¬åªèƒ½ç”±å‘æ”¾ç»™å®ƒä»¬çš„åº”ç”¨ç¨‹åºæˆ–ä¸€ç»„åº”ç”¨ç¨‹åºä½¿ç”¨ã€‚
* **ä¸»åˆ·æ–°ä»¤ç‰Œ (PRT)**ï¼šç”¨äº Azure AD åŠ å…¥ã€æ³¨å†Œæˆ–æ··åˆåŠ å…¥è®¾å¤‡çš„å•ç‚¹ç™»å½•ã€‚å®ƒä»¬å¯ä»¥åœ¨æµè§ˆå™¨ç™»å½•æµç¨‹ä¸­ä½¿ç”¨ï¼Œä¹Ÿå¯ä»¥ç”¨äºåœ¨è®¾å¤‡ä¸Šç™»å½•ç§»åŠ¨å’Œæ¡Œé¢åº”ç”¨ç¨‹åºã€‚
* **Windows Hello for Business å¯†é’¥ (WHFB)**ï¼šç”¨äºæ— å¯†ç èº«ä»½éªŒè¯ã€‚ç”¨äºè·å–ä¸»åˆ·æ–°ä»¤ç‰Œã€‚

æœ€æœ‰è¶£çš„ä»¤ç‰Œç±»å‹æ˜¯ä¸»åˆ·æ–°ä»¤ç‰Œ (PRT)ã€‚

{% content-ref url="az-primary-refresh-token-prt.md" %}
[az-primary-refresh-token-prt.md](az-primary-refresh-token-prt.md)
{% endcontent-ref %}

### ä¾§å‘ç§»åŠ¨æŠ€æœ¯

ä» **è¢«æ”»é™·çš„æœºå™¨åˆ°äº‘**ï¼š

* [**Pass the Cookie**](az-pass-the-cookie.md)ï¼šä»æµè§ˆå™¨çªƒå– Azure cookie å¹¶ä½¿ç”¨å®ƒä»¬ç™»å½•
* [**Dump processes access tokens**](az-processes-memory-access-token.md)ï¼šè½¬å‚¨ä¸äº‘åŒæ­¥çš„æœ¬åœ°è¿›ç¨‹çš„å†…å­˜ï¼ˆå¦‚ Excelã€Teams...ï¼‰å¹¶æ‰¾åˆ°æ˜æ–‡è®¿é—®ä»¤ç‰Œã€‚
* [**Phishing Primary Refresh Token**](az-phishing-primary-refresh-token-microsoft-entra.md)**:** é’“é±¼ PRT ä»¥æ»¥ç”¨å®ƒ
* [**Pass the PRT**](pass-the-prt.md)ï¼šçªƒå–è®¾å¤‡ PRT ä»¥è®¿é—® Azure è¿›è¡Œå†’å……ã€‚
* [**Pass the Certificate**](az-pass-the-certificate.md)**:** åŸºäº PRT ç”Ÿæˆè¯ä¹¦ä»¥ä»ä¸€å°æœºå™¨ç™»å½•åˆ°å¦ä¸€å°æœºå™¨

ä»æ”»é™· **AD** åˆ°æ”»é™· **äº‘**ï¼Œä»¥åŠä»æ”»é™· **äº‘** åˆ°æ”»é™· **AD**ï¼š

* [**Azure AD Connect**](azure-ad-connect-hybrid-identity/)
* **ä»äº‘åˆ°æœ¬åœ°çš„å¦ä¸€ç§ä¾§å‘ç§»åŠ¨æ–¹å¼æ˜¯** [**æ»¥ç”¨ Intune**](../az-services/intune.md)

#### [Roadtx](https://github.com/dirkjanm/ROADtools)

è¯¥å·¥å…·å…è®¸æ‰§è¡Œå¤šç§æ“ä½œï¼Œå¦‚åœ¨ Azure AD ä¸­æ³¨å†Œæœºå™¨ä»¥è·å– PRTï¼Œå¹¶ä½¿ç”¨ PRTï¼ˆåˆæ³•æˆ–è¢«ç›—ï¼‰ä»¥å¤šç§æ–¹å¼è®¿é—®èµ„æºã€‚è¿™äº›ä¸æ˜¯ç›´æ¥æ”»å‡»ï¼Œä½†å®ƒä¿ƒè¿›äº†ä½¿ç”¨ PRT ä»¥ä¸åŒæ–¹å¼è®¿é—®èµ„æºã€‚æ›´å¤šä¿¡æ¯è¯·è®¿é—® [https://dirkjanm.io/introducing-roadtools-token-exchange-roadtx/](https://dirkjanm.io/introducing-roadtools-token-exchange-roadtx/)

## å‚è€ƒ

* [https://dirkjanm.io/phishing-for-microsoft-entra-primary-refresh-tokens/](https://dirkjanm.io/phishing-for-microsoft-entra-primary-refresh-tokens/)

{% hint style="success" %}
å­¦ä¹ å’Œå®è·µ AWS é»‘å®¢æŠ€æœ¯ï¼š<img src="../../../.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks åŸ¹è®­ AWS çº¢é˜Ÿä¸“å®¶ (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image.png" alt="" data-size="line">\
å­¦ä¹ å’Œå®è·µ GCP é»‘å®¢æŠ€æœ¯ï¼š<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks åŸ¹è®­ GCP çº¢é˜Ÿä¸“å®¶ (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>æ”¯æŒ HackTricks</summary>

* æŸ¥çœ‹ [**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**Telegram ç¾¤ç»„**](https://t.me/peass) æˆ– **åœ¨** **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** ä¸Šå…³æ³¨æˆ‘ä»¬ã€‚**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub ä»“åº“æäº¤ PR æ¥åˆ†äº«é»‘å®¢æŠ€å·§ã€‚

</details>
{% endhint %}
