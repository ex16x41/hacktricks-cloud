# Az - Yanal Hareket (Bulut - On-Prem)

## Az - Yanal Hareket (Bulut - On-Prem)

{% hint style="success" %}
AWS Hacking'i Ã¶ÄŸrenin ve uygulayÄ±n: <img src="../../../.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks EÄŸitim AWS KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ± (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image.png" alt="" data-size="line">\
GCP Hacking'i Ã¶ÄŸrenin ve uygulayÄ±n: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks EÄŸitim GCP KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ± (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**Abonelik planlarÄ±nÄ±**](https://github.com/sponsors/carlospolop) kontrol edin!
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) katÄ±lÄ±n veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n veya bizi **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** takip edin.**
* **Hacking pÃ¼f noktalarÄ±nÄ± paylaÅŸarak** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na PR gÃ¶nderin.

</details>
{% endhint %}

### On-Prem makinelerinin buluta baÄŸlanmasÄ±

Bir makinenin buluta baÄŸlanabileceÄŸi farklÄ± yollar vardÄ±r:

#### Azure AD katÄ±lÄ±mÄ±

<figure><img src="../../../.gitbook/assets/image (259).png" alt=""><figcaption></figcaption></figure>

#### Workplace katÄ±lÄ±mÄ±

<figure><img src="../../../.gitbook/assets/image (222).png" alt=""><figcaption><p><a href="https://pbs.twimg.com/media/EQZv7UHXsAArdhn?format=jpg&#x26;name=large">https://pbs.twimg.com/media/EQZv7UHXsAArdhn?format=jpg&#x26;name=large</a></p></figcaption></figure>

#### Hibrit katÄ±lÄ±m

<figure><img src="../../../.gitbook/assets/image (178).png" alt=""><figcaption><p><a href="https://pbs.twimg.com/media/EQZv77jXkAAC4LK?format=jpg&#x26;name=large">https://pbs.twimg.com/media/EQZv77jXkAAC4LK?format=jpg&#x26;name=large</a></p></figcaption></figure>

#### AADJ veya Hibrit Ã¼zerinde Workplace katÄ±lÄ±mÄ±

<figure><img src="../../../.gitbook/assets/image (252).png" alt=""><figcaption><p><a href="https://pbs.twimg.com/media/EQZv8qBX0AAMWuR?format=jpg&#x26;name=large">https://pbs.twimg.com/media/EQZv8qBX0AAMWuR?format=jpg&#x26;name=large</a></p></figcaption></figure>

### Tokenlar ve sÄ±nÄ±rlamalar <a href="#tokens-and-limitations" id="tokens-and-limitations"></a>

Azure AD'de belirli sÄ±nÄ±rlamalara sahip farklÄ± tÃ¼rde tokenlar bulunmaktadÄ±r:

* **EriÅŸim tokenlarÄ±**: Microsoft Graph gibi API'lara ve kaynaklara eriÅŸmek iÃ§in kullanÄ±lÄ±r. Belirli bir istemci ve kaynaÄŸa baÄŸlÄ±dÄ±r.
* **Yenileme tokenlarÄ±**: Uygulamalara yeni eriÅŸim tokenlarÄ± almak iÃ§in verilir. YalnÄ±zca verildikleri uygulama veya uygulama grubu tarafÄ±ndan kullanÄ±labilirler.
* **Birincil Yenileme TokenlarÄ± (PRT)**: Azure AD'ye katÄ±lan, kayÄ±tlÄ± veya hibrit katÄ±lan cihazlarda Tek Oturum AÃ§ma iÃ§in kullanÄ±lÄ±r. TarayÄ±cÄ± oturum aÃ§ma akÄ±ÅŸlarÄ± ve cihazda mobil ve masaÃ¼stÃ¼ uygulamalara giriÅŸ yapmak iÃ§in kullanÄ±labilirler.
* **Windows Hello for Business anahtarlarÄ± (WHFB)**: Åifresiz kimlik doÄŸrulamasÄ± iÃ§in kullanÄ±lÄ±r. Birincil Yenileme TokenlarÄ± almak iÃ§in kullanÄ±lÄ±r.

En ilginÃ§ token tÃ¼rÃ¼ Birincil Yenileme Tokenu (PRT)'dir.

{% content-ref url="az-primary-refresh-token-prt.md" %}
[az-primary-refresh-token-prt.md](az-primary-refresh-token-prt.md)
{% endcontent-ref %}

### YÃ¶nlendirme Teknikleri

**Kompromize edilmiÅŸ makineden buluta**:

* [**Ã‡erez AktarÄ±mÄ±**](az-pass-the-cookie.md): Azure Ã§erezlerini tarayÄ±cÄ±dan Ã§alÄ±n ve giriÅŸ yapmak iÃ§in kullanÄ±n
* **Ä°ÅŸlem eriÅŸim tokenlarÄ±nÄ± dÃ¶kÃ¼n**: BazÄ± Microsoft yazÄ±lÄ±mlarÄ±nÄ±n (Excel, Teams...) bulutla senkronize olduÄŸu aÃ§Ä±klanan [**bu video**](https://www.youtube.com/watch?v=OHKZkXC4Duw)da, eriÅŸim tokenlarÄ±nÄ± bellekte dÃ¼z metin olarak saklayabileceÄŸini belirtir. Bu nedenle, sadece iÅŸlem belleÄŸini dÃ¶kerek ve JWT tokenlarÄ±nÄ± arayarak, MFA'yÄ± atlayarak kurbanÄ±n bulutta birÃ§ok kaynaÄŸa eriÅŸim saÄŸlayabilirsiniz.
* [**Phishing Birincil Yenileme Tokenu**](az-phishing-primary-refresh-token-microsoft-entra.md)**:** PRT'yi avlamak iÃ§in
* [**PRT AktarÄ±mÄ±**](pass-the-prt.md): Cihaz PRT'sini Ã§alarak onu taklit ederek Azure'a eriÅŸin.
* [**Sertifika AktarÄ±mÄ±**](az-pass-the-certificate.md)**:** Bir makineden diÄŸerine giriÅŸ yapmak iÃ§in PRT'ye dayalÄ± bir sertifika oluÅŸturun

**AD**'den **Bulut**'a ve **Bulut**'tan **AD**'ye kompromize etme:

* [**Azure AD Connect**](azure-ad-connect-hybrid-identity/)
* **Buluttan On-Prem'e yÃ¶nlendirmenin baÅŸka bir yolu** [**Intune'yi kÃ¶tÃ¼ye kullanmak**](../az-services/intune.md)

#### [Roadtx](https://github.com/dirkjanm/ROADtools)

Bu araÃ§, bir makineyi Azure AD'ye kaydetmek iÃ§in PRT almak ve PRT'leri (meÅŸru veya Ã§alÄ±nmÄ±ÅŸ) farklÄ± yollarla eriÅŸim saÄŸlamak iÃ§in kullanÄ±r. Bunlar doÄŸrudan saldÄ±rÄ±lar deÄŸildir, ancak PRT'lerin farklÄ± yollarla eriÅŸim saÄŸlamasÄ±nÄ± kolaylaÅŸtÄ±rÄ±r. Daha fazla bilgi iÃ§in [https://dirkjanm.io/introducing-roadtools-token-exchange-roadtx/](https://dirkjanm.io/introducing-roadtools-token-exchange-roadtx/)

## Referanslar

* [https://dirkjanm.io/phishing-for-microsoft-entra-primary-refresh-tokens/](https://dirkjanm.io/phishing-for-microsoft-entra-primary-refresh-tokens/)
