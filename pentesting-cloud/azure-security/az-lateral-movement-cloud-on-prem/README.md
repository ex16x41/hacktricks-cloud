# Az - Lateral Movement (Cloud - On-Prem)

## Az - Lateral Movement (Cloud - On-Prem)

{% hint style="success" %}
AWSãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã³ã€å®Ÿè·µã™ã‚‹ï¼š<img src="../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">\
GCPãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã³ã€å®Ÿè·µã™ã‚‹ï¼š<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricksã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹</summary>

* [**ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³**](https://github.com/sponsors/carlospolop)ã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼
* **ğŸ’¬ [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã¾ãŸã¯[**Telegramã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«å‚åŠ ã™ã‚‹ã‹ã€**Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**ã‚’ãƒ•ã‚©ãƒ­ãƒ¼ã—ã¦ãã ã•ã„ã€‚**
* **[**HackTricks**](https://github.com/carlospolop/hacktricks)ãŠã‚ˆã³[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)ã®GitHubãƒªãƒã‚¸ãƒˆãƒªã«PRã‚’æå‡ºã—ã¦ãƒãƒƒã‚­ãƒ³ã‚°ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã—ã¦ãã ã•ã„ã€‚**

</details>
{% endhint %}

### ã‚¯ãƒ©ã‚¦ãƒ‰ã«æ¥ç¶šã•ã‚ŒãŸã‚ªãƒ³ãƒ—ãƒ¬ãƒŸã‚¹ã®ãƒã‚·ãƒ³

ãƒã‚·ãƒ³ãŒã‚¯ãƒ©ã‚¦ãƒ‰ã«æ¥ç¶šã•ã‚Œã‚‹æ–¹æ³•ã¯ã„ãã¤ã‹ã‚ã‚Šã¾ã™ï¼š

#### Azure ADå‚åŠ 

<figure><img src="../../../.gitbook/assets/image (259).png" alt=""><figcaption></figcaption></figure>

#### Workplaceå‚åŠ 

<figure><img src="../../../.gitbook/assets/image (222).png" alt=""><figcaption><p><a href="https://pbs.twimg.com/media/EQZv7UHXsAArdhn?format=jpg&#x26;name=large">https://pbs.twimg.com/media/EQZv7UHXsAArdhn?format=jpg&#x26;name=large</a></p></figcaption></figure>

#### ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰å‚åŠ 

<figure><img src="../../../.gitbook/assets/image (178).png" alt=""><figcaption><p><a href="https://pbs.twimg.com/media/EQZv77jXkAAC4LK?format=jpg&#x26;name=large">https://pbs.twimg.com/media/EQZv77jXkAAC4LK?format=jpg&#x26;name=large</a></p></figcaption></figure>

#### AADJã¾ãŸã¯ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰ã§ã®Workplaceå‚åŠ 

<figure><img src="../../../.gitbook/assets/image (252).png" alt=""><figcaption><p><a href="https://pbs.twimg.com/media/EQZv8qBX0AAMWuR?format=jpg&#x26;name=large">https://pbs.twimg.com/media/EQZv8qBX0AAMWuR?format=jpg&#x26;name=large</a></p></figcaption></figure>

### ãƒˆãƒ¼ã‚¯ãƒ³ã¨åˆ¶é™ <a href="#tokens-and-limitations" id="tokens-and-limitations"></a>

Azure ADã«ã¯ã€ç‰¹å®šã®åˆ¶é™ã‚’æŒã¤ã•ã¾ã–ã¾ãªã‚¿ã‚¤ãƒ—ã®ãƒˆãƒ¼ã‚¯ãƒ³ãŒã‚ã‚Šã¾ã™ï¼š

* **ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³**ï¼šMicrosoft Graphã®ã‚ˆã†ãªAPIã‚„ãƒªã‚½ãƒ¼ã‚¹ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã•ã‚Œã¾ã™ã€‚ç‰¹å®šã®ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¨ãƒªã‚½ãƒ¼ã‚¹ã«çµã³ã¤ã„ã¦ã„ã¾ã™ã€‚
* **ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ãƒˆãƒ¼ã‚¯ãƒ³**ï¼šæ–°ã—ã„ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å–å¾—ã™ã‚‹ãŸã‚ã«ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«ç™ºè¡Œã•ã‚Œã¾ã™ã€‚ç™ºè¡Œã•ã‚ŒãŸã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¾ãŸã¯ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ã‚°ãƒ«ãƒ¼ãƒ—ã«ã‚ˆã£ã¦ã®ã¿ä½¿ç”¨ã§ãã¾ã™ã€‚
* **ãƒ—ãƒ©ã‚¤ãƒãƒªãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ãƒˆãƒ¼ã‚¯ãƒ³ï¼ˆPRTï¼‰**ï¼šAzure ADå‚åŠ ã€ç™»éŒ²ã€ã¾ãŸã¯ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰å‚åŠ ãƒ‡ãƒã‚¤ã‚¹ã§ã®ã‚·ãƒ³ã‚°ãƒ«ã‚µã‚¤ãƒ³ã‚ªãƒ³ã«ä½¿ç”¨ã•ã‚Œã¾ã™ã€‚ãƒ–ãƒ©ã‚¦ã‚¶ã®ã‚µã‚¤ãƒ³ã‚¤ãƒ³ãƒ•ãƒ­ãƒ¼ã‚„ãƒ‡ãƒã‚¤ã‚¹ä¸Šã®ãƒ¢ãƒã‚¤ãƒ«ãŠã‚ˆã³ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¸ã®ã‚µã‚¤ãƒ³ã‚¤ãƒ³ã«ä½¿ç”¨ã§ãã¾ã™ã€‚
* **Windows Hello for Businessã‚­ãƒ¼ï¼ˆWHFBï¼‰**ï¼šãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãªã—ã®èªè¨¼ã«ä½¿ç”¨ã•ã‚Œã¾ã™ã€‚ãƒ—ãƒ©ã‚¤ãƒãƒªãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å–å¾—ã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã•ã‚Œã¾ã™ã€‚

æœ€ã‚‚èˆˆå‘³æ·±ã„ã‚¿ã‚¤ãƒ—ã®ãƒˆãƒ¼ã‚¯ãƒ³ã¯ãƒ—ãƒ©ã‚¤ãƒãƒªãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ãƒˆãƒ¼ã‚¯ãƒ³ï¼ˆPRTï¼‰ã§ã™ã€‚

{% content-ref url="az-primary-refresh-token-prt.md" %}
[az-primary-refresh-token-prt.md](az-primary-refresh-token-prt.md)
{% endcontent-ref %}

### ãƒ”ãƒœãƒƒãƒ†ã‚£ãƒ³ã‚°æŠ€è¡“

**ä¾µå®³ã•ã‚ŒãŸãƒã‚·ãƒ³ã‹ã‚‰ã‚¯ãƒ©ã‚¦ãƒ‰ã¸**ï¼š

* [**Pass the Cookie**](az-pass-the-cookie.md)ï¼šãƒ–ãƒ©ã‚¦ã‚¶ã‹ã‚‰Azureã‚¯ãƒƒã‚­ãƒ¼ã‚’ç›—ã¿ã€ãã‚Œã‚’ä½¿ç”¨ã—ã¦ãƒ­ã‚°ã‚¤ãƒ³
* [**Dump processes access tokens**](az-processes-memory-access-token.md)ï¼šã‚¯ãƒ©ã‚¦ãƒ‰ã¨åŒæœŸã•ã‚ŒãŸãƒ­ãƒ¼ã‚«ãƒ«ãƒ—ãƒ­ã‚»ã‚¹ã®ãƒ¡ãƒ¢ãƒªã‚’ãƒ€ãƒ³ãƒ—ã—ï¼ˆExcelã€Teamsãªã©ï¼‰ã€ã‚¯ãƒªã‚¢ãƒ†ã‚­ã‚¹ãƒˆã®ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã‚’è¦‹ã¤ã‘ã‚‹ã€‚
* [**Phishing Primary Refresh Token**](az-phishing-primary-refresh-token-microsoft-entra.md)**:** PRTã‚’ãƒ•ã‚£ãƒƒã‚·ãƒ³ã‚°ã—ã¦æ‚ªç”¨ã™ã‚‹
* [**Pass the PRT**](pass-the-prt.md)ï¼šãƒ‡ãƒã‚¤ã‚¹ã®PRTã‚’ç›—ã‚“ã§Azureã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹
* [**Pass the Certificate**](az-pass-the-certificate.md)**:** PRTã«åŸºã¥ã„ã¦è¨¼æ˜æ›¸ã‚’ç”Ÿæˆã—ã€1å°ã®ãƒã‚·ãƒ³ã‹ã‚‰åˆ¥ã®ãƒã‚·ãƒ³ã«ãƒ­ã‚°ã‚¤ãƒ³ã™ã‚‹

**ADã‚’ä¾µå®³ã—ã¦ã‚¯ãƒ©ã‚¦ãƒ‰ã‚’ä¾µå®³ã—ã€ã‚¯ãƒ©ã‚¦ãƒ‰ã‚’ä¾µå®³ã—ã¦ADã‚’ä¾µå®³ã™ã‚‹**ï¼š

* [**Azure AD Connect**](azure-ad-connect-hybrid-identity/)
* **ã‚¯ãƒ©ã‚¦ãƒ‰ã‹ã‚‰ã‚ªãƒ³ãƒ—ãƒ¬ãƒŸã‚¹ã«ãƒ”ãƒœãƒƒãƒˆã™ã‚‹åˆ¥ã®æ–¹æ³•ã¯** [**Intuneã‚’æ‚ªç”¨ã™ã‚‹ã“ã¨**](../az-services/intune.md)ã§ã™ã€‚

#### [Roadtx](https://github.com/dirkjanm/ROADtools)

ã“ã®ãƒ„ãƒ¼ãƒ«ã¯ã€Azure ADã«ãƒã‚·ãƒ³ã‚’ç™»éŒ²ã—ã¦PRTã‚’å–å¾—ã—ã€PRTï¼ˆæ­£å½“ã¾ãŸã¯ç›—ã¾ã‚ŒãŸï¼‰ã‚’ä½¿ç”¨ã—ã¦ã•ã¾ã–ã¾ãªæ–¹æ³•ã§ãƒªã‚½ãƒ¼ã‚¹ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ãªã©ã€ã„ãã¤ã‹ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨ã‚’å¯èƒ½ã«ã—ã¾ã™ã€‚ã“ã‚Œã‚‰ã¯ç›´æ¥çš„ãªæ”»æ’ƒã§ã¯ã‚ã‚Šã¾ã›ã‚“ãŒã€PRTã‚’ä½¿ç”¨ã—ã¦ã•ã¾ã–ã¾ãªæ–¹æ³•ã§ãƒªã‚½ãƒ¼ã‚¹ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã®ã‚’å®¹æ˜“ã«ã—ã¾ã™ã€‚è©³ç´°ã¯[https://dirkjanm.io/introducing-roadtools-token-exchange-roadtx/](https://dirkjanm.io/introducing-roadtools-token-exchange-roadtx/)ã§ç¢ºèªã—ã¦ãã ã•ã„ã€‚

## å‚è€ƒæ–‡çŒ®

* [https://dirkjanm.io/phishing-for-microsoft-entra-primary-refresh-tokens/](https://dirkjanm.io/phishing-for-microsoft-entra-primary-refresh-tokens/)

{% hint style="success" %}
AWSãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã³ã€å®Ÿè·µã™ã‚‹ï¼š<img src="../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">\
GCPãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã³ã€å®Ÿè·µã™ã‚‹ï¼š<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricksã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹</summary>

* [**ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³**](https://github.com/sponsors/carlospolop)ã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼
* **ğŸ’¬ [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã¾ãŸã¯[**Telegramã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«å‚åŠ ã™ã‚‹ã‹ã€**Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**ã‚’ãƒ•ã‚©ãƒ­ãƒ¼ã—ã¦ãã ã•ã„ã€‚**
* **[**HackTricks**](https://github.com/carlospolop/hacktricks)ãŠã‚ˆã³[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)ã®GitHubãƒªãƒã‚¸ãƒˆãƒªã«PRã‚’æå‡ºã—ã¦ãƒãƒƒã‚­ãƒ³ã‚°ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã—ã¦ãã ã•ã„ã€‚**

</details>
{% endhint %}
