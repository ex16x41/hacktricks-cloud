# Az - Lateral Movement (Cloud - On-Prem)

## Az - Lateral Movement (Cloud - On-Prem)

{% hint style="success" %}
ÎœÎ¬Î¸ÎµÏ„Îµ & ÎµÎ¾Î±ÏƒÎºÎ·Î¸ÎµÎ¯Ï„Îµ ÏƒÏ„Î¿ AWS Hacking:<img src="../../../.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image.png" alt="" data-size="line">\
ÎœÎ¬Î¸ÎµÏ„Îµ & ÎµÎ¾Î±ÏƒÎºÎ·Î¸ÎµÎ¯Ï„Îµ ÏƒÏ„Î¿ GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Î¥Ï€Î¿ÏƒÏ„Î®ÏÎ¹Î¾Î· HackTricks</summary>

* Î•Î»Î­Î³Î¾Ï„Îµ Ï„Î± [**ÏƒÏ‡Î­Î´Î¹Î± ÏƒÏ…Î½Î´ÏÎ¿Î¼Î®Ï‚**](https://github.com/sponsors/carlospolop)!
* **Î•Î³Î³ÏÎ±Ï†ÎµÎ¯Ï„Îµ ÏƒÏ„Î·Î½** ğŸ’¬ [**Î¿Î¼Î¬Î´Î± Discord**](https://discord.gg/hRep4RUj7f) Î® ÏƒÏ„Î·Î½ [**Î¿Î¼Î¬Î´Î± telegram**](https://t.me/peass) Î® **Î±ÎºÎ¿Î»Î¿Ï…Î¸Î®ÏƒÏ„Îµ** Î¼Î±Ï‚ ÏƒÏ„Î¿ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **ÎœÎ¿Î¹ÏÎ±ÏƒÏ„ÎµÎ¯Ï„Îµ ÎºÏŒÎ»Ï€Î± hacking Ï…Ï€Î¿Î²Î¬Î»Î»Î¿Î½Ï„Î±Ï‚ PRs ÏƒÏ„Î±** [**HackTricks**](https://github.com/carlospolop/hacktricks) ÎºÎ±Î¹ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

### On-Prem Î¼Î·Ï‡Î±Î½Î­Ï‚ ÏƒÏ…Î½Î´ÎµÎ´ÎµÎ¼Î­Î½ÎµÏ‚ ÏƒÏ„Î¿ cloud

Î¥Ï€Î¬ÏÏ‡Î¿Ï…Î½ Î´Î¹Î¬Ï†Î¿ÏÎ¿Î¹ Ï„ÏÏŒÏ€Î¿Î¹ Î¼Îµ Ï„Î¿Ï…Ï‚ Î¿Ï€Î¿Î¯Î¿Ï…Ï‚ Î¼Î¹Î± Î¼Î·Ï‡Î±Î½Î® Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± ÎµÎ¯Î½Î±Î¹ ÏƒÏ…Î½Î´ÎµÎ´ÎµÎ¼Î­Î½Î· ÏƒÏ„Î¿ cloud:

#### Azure AD joined

<figure><img src="../../../.gitbook/assets/image (259).png" alt=""><figcaption></figcaption></figure>

#### Workplace joined

<figure><img src="../../../.gitbook/assets/image (222).png" alt=""><figcaption><p><a href="https://pbs.twimg.com/media/EQZv7UHXsAArdhn?format=jpg&#x26;name=large">https://pbs.twimg.com/media/EQZv7UHXsAArdhn?format=jpg&#x26;name=large</a></p></figcaption></figure>

#### Hybrid joined

<figure><img src="../../../.gitbook/assets/image (178).png" alt=""><figcaption><p><a href="https://pbs.twimg.com/media/EQZv77jXkAAC4LK?format=jpg&#x26;name=large">https://pbs.twimg.com/media/EQZv77jXkAAC4LK?format=jpg&#x26;name=large</a></p></figcaption></figure>

#### Workplace joined ÏƒÎµ AADJ Î® Hybrid

<figure><img src="../../../.gitbook/assets/image (252).png" alt=""><figcaption><p><a href="https://pbs.twimg.com/media/EQZv8qBX0AAMWuR?format=jpg&#x26;name=large">https://pbs.twimg.com/media/EQZv8qBX0AAMWuR?format=jpg&#x26;name=large</a></p></figcaption></figure>

### Tokens ÎºÎ±Î¹ Ï€ÎµÏÎ¹Î¿ÏÎ¹ÏƒÎ¼Î¿Î¯ <a href="#tokens-and-limitations" id="tokens-and-limitations"></a>

Î£Ï„Î¿ Azure AD, Ï…Ï€Î¬ÏÏ‡Î¿Ï…Î½ Î´Î¹Î¬Ï†Î¿ÏÎ¿Î¹ Ï„ÏÏ€Î¿Î¹ tokens Î¼Îµ ÏƒÏ…Î³ÎºÎµÎºÏÎ¹Î¼Î­Î½Î¿Ï…Ï‚ Ï€ÎµÏÎ¹Î¿ÏÎ¹ÏƒÎ¼Î¿ÏÏ‚:

* **Access tokens**: Î§ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î¿ÏÎ½Ï„Î±Î¹ Î³Î¹Î± Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ· ÏƒÎµ APIs ÎºÎ±Î¹ Ï€ÏŒÏÎ¿Ï…Ï‚ ÏŒÏ€Ï‰Ï‚ Ï„Î¿ Microsoft Graph. Î•Î¯Î½Î±Î¹ ÏƒÏ…Î½Î´ÎµÎ´ÎµÎ¼Î­Î½Î± Î¼Îµ Î­Î½Î±Î½ ÏƒÏ…Î³ÎºÎµÎºÏÎ¹Î¼Î­Î½Î¿ Ï€ÎµÎ»Î¬Ï„Î· ÎºÎ±Î¹ Ï€ÏŒÏÎ¿.
* **Refresh tokens**: Î•ÎºÎ´Î¯Î´Î¿Î½Ï„Î±Î¹ ÏƒÎµ ÎµÏ†Î±ÏÎ¼Î¿Î³Î­Ï‚ Î³Î¹Î± Î½Î± Î±Ï€Î¿ÎºÏ„Î¿ÏÎ½ Î½Î­Î± access tokens. ÎœÏ€Î¿ÏÎ¿ÏÎ½ Î½Î± Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î·Î¸Î¿ÏÎ½ Î¼ÏŒÎ½Î¿ Î±Ï€ÏŒ Ï„Î·Î½ ÎµÏ†Î±ÏÎ¼Î¿Î³Î® ÏƒÏ„Î·Î½ Î¿Ï€Î¿Î¯Î± ÎµÎºÎ´ÏŒÎ¸Î·ÎºÎ±Î½ Î® Î±Ï€ÏŒ Î¼Î¹Î± Î¿Î¼Î¬Î´Î± ÎµÏ†Î±ÏÎ¼Î¿Î³ÏÎ½.
* **Primary Refresh Tokens (PRT)**: Î§ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î¿ÏÎ½Ï„Î±Î¹ Î³Î¹Î± Single Sign-On ÏƒÎµ Azure AD joined, registered Î® hybrid joined ÏƒÏ…ÏƒÎºÎµÏ…Î­Ï‚. ÎœÏ€Î¿ÏÎ¿ÏÎ½ Î½Î± Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î·Î¸Î¿ÏÎ½ ÏƒÎµ ÏÎ¿Î­Ï‚ ÏƒÏÎ½Î´ÎµÏƒÎ·Ï‚ Î¼Î­ÏƒÏ‰ Ï€ÏÎ¿Î³ÏÎ¬Î¼Î¼Î±Ï„Î¿Ï‚ Ï€ÎµÏÎ¹Î®Î³Î·ÏƒÎ·Ï‚ ÎºÎ±Î¹ Î³Î¹Î± ÏƒÏÎ½Î´ÎµÏƒÎ· ÏƒÎµ ÎµÏ†Î±ÏÎ¼Î¿Î³Î­Ï‚ ÎºÎ¹Î½Î·Ï„ÏÎ½ ÎºÎ±Î¹ ÎµÏ€Î¹Ï„ÏÎ±Ï€Î­Î¶Î¹Ï‰Î½ Ï…Ï€Î¿Î»Î¿Î³Î¹ÏƒÏ„ÏÎ½ ÏƒÏ„Î· ÏƒÏ…ÏƒÎºÎµÏ…Î®.
* **Windows Hello for Business keys (WHFB)**: Î§ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î¿ÏÎ½Ï„Î±Î¹ Î³Î¹Î± Î±Ï…Î¸ÎµÎ½Ï„Î¹ÎºÎ¿Ï€Î¿Î¯Î·ÏƒÎ· Ï‡Ï‰ÏÎ¯Ï‚ ÎºÏ‰Î´Î¹ÎºÏŒ. Î§ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î¿ÏÎ½Ï„Î±Î¹ Î³Î¹Î± Î½Î± Î±Ï€Î¿ÎºÏ„Î®ÏƒÎ¿Ï…Î½ Primary Refresh Tokens.

ÎŸ Ï€Î¹Î¿ ÎµÎ½Î´Î¹Î±Ï†Î­ÏÎ¿Î½ Ï„ÏÏ€Î¿Ï‚ token ÎµÎ¯Î½Î±Î¹ Ï„Î¿ Primary Refresh Token (PRT).

{% content-ref url="az-primary-refresh-token-prt.md" %}
[az-primary-refresh-token-prt.md](az-primary-refresh-token-prt.md)
{% endcontent-ref %}

### Î¤ÎµÏ‡Î½Î¹ÎºÎ­Ï‚ Pivoting

Î‘Ï€ÏŒ Ï„Î· **ÏƒÏ…Î¼Î²Î¹Î²Î±ÏƒÎ¼Î­Î½Î· Î¼Î·Ï‡Î±Î½Î® ÏƒÏ„Î¿ cloud**:

* [**Pass the Cookie**](az-pass-the-cookie.md): ÎšÎ»Î­ÏˆÏ„Îµ Ï„Î± Azure cookies Î±Ï€ÏŒ Ï„Î¿Î½ Ï€ÎµÏÎ¹Î·Î³Î·Ï„Î® ÎºÎ±Î¹ Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î®ÏƒÏ„Îµ Ï„Î± Î³Î¹Î± Î½Î± ÏƒÏ…Î½Î´ÎµÎ¸ÎµÎ¯Ï„Îµ
* [**Dump processes access tokens**](az-processes-memory-access-token.md): Dump Ï„Î· Î¼Î½Î®Î¼Î· Ï„Î¿Ï€Î¹ÎºÏÎ½ Î´Î¹Î±Î´Î¹ÎºÎ±ÏƒÎ¹ÏÎ½ ÏƒÏ…Î³Ï‡ÏÎ¿Î½Î¹ÏƒÎ¼Î­Î½Ï‰Î½ Î¼Îµ Ï„Î¿ cloud (ÏŒÏ€Ï‰Ï‚ excel, Teams...) ÎºÎ±Î¹ Î²ÏÎµÎ¯Ï„Îµ access tokens ÏƒÎµ ÎºÎ±Î¸Î±ÏÏŒ ÎºÎµÎ¯Î¼ÎµÎ½Î¿.
* [**Phishing Primary Refresh Token**](az-phishing-primary-refresh-token-microsoft-entra.md)**:** Phish Ï„Î¿ PRT Î³Î¹Î± Î½Î± Ï„Î¿ ÎºÎ±Ï„Î±Ï‡ÏÎ±ÏƒÏ„ÎµÎ¯Ï„Îµ
* [**Pass the PRT**](pass-the-prt.md): ÎšÎ»Î­ÏˆÏ„Îµ Ï„Î¿ PRT Ï„Î·Ï‚ ÏƒÏ…ÏƒÎºÎµÏ…Î®Ï‚ Î³Î¹Î± Î½Î± Î±Ï€Î¿ÎºÏ„Î®ÏƒÎµÏ„Îµ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ· ÏƒÏ„Î¿ Azure Ï€ÏÎ¿ÏƒÏ€Î¿Î¹Î¿ÏÎ¼ÎµÎ½Î¿Î¹ ÏŒÏ„Î¹ ÎµÎ¯ÏƒÏ„Îµ Î±Ï…Ï„Î®.
* [**Pass the Certificate**](az-pass-the-certificate.md)**:** Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î®ÏƒÏ„Îµ Î­Î½Î± Ï€Î¹ÏƒÏ„Î¿Ï€Î¿Î¹Î·Ï„Î¹ÎºÏŒ Î²Î±ÏƒÎ¹ÏƒÎ¼Î­Î½Î¿ ÏƒÏ„Î¿ PRT Î³Î¹Î± Î½Î± ÏƒÏ…Î½Î´ÎµÎ¸ÎµÎ¯Ï„Îµ Î±Ï€ÏŒ Î¼Î¹Î± Î¼Î·Ï‡Î±Î½Î® ÏƒÎµ Î¬Î»Î»Î·

Î‘Ï€ÏŒ Ï„Î¿Î½ ÏƒÏ…Î¼Î²Î¹Î²Î±ÏƒÎ¼ÏŒ Ï„Î¿Ï… **AD** ÏƒÏ„Î¿Î½ ÏƒÏ…Î¼Î²Î¹Î²Î±ÏƒÎ¼ÏŒ Ï„Î¿Ï… **Cloud** ÎºÎ±Î¹ Î±Ï€ÏŒ Ï„Î¿Î½ ÏƒÏ…Î¼Î²Î¹Î²Î±ÏƒÎ¼ÏŒ Ï„Î¿Ï… **Cloud** ÏƒÏ„Î¿Î½ ÏƒÏ…Î¼Î²Î¹Î²Î±ÏƒÎ¼ÏŒ Ï„Î¿Ï… **AD**:

* [**Azure AD Connect**](azure-ad-connect-hybrid-identity/)
* **ÎˆÎ½Î±Ï‚ Î¬Î»Î»Î¿Ï‚ Ï„ÏÏŒÏ€Î¿Ï‚ Î³Î¹Î± Î½Î± ÎºÎ¬Î½ÎµÏ„Îµ pivot Î±Ï€ÏŒ Ï„Î¿ cloud ÏƒÏ„Î¿ On-Prem ÎµÎ¯Î½Î±Î¹** [**ÎºÎ±Ï„Î±Ï‡ÏÏÎ½Ï„Î±Ï‚ Ï„Î¿ Intune**](../az-services/intune.md)

#### [Roadtx](https://github.com/dirkjanm/ROADtools)

Î‘Ï…Ï„ÏŒ Ï„Î¿ ÎµÏÎ³Î±Î»ÎµÎ¯Î¿ ÎµÏ€Î¹Ï„ÏÎ­Ï€ÎµÎ¹ Ï„Î·Î½ ÎµÎºÏ„Î­Î»ÎµÏƒÎ· Î´Î¹Î±Ï†ÏŒÏÏ‰Î½ ÎµÎ½ÎµÏÎ³ÎµÎ¹ÏÎ½ ÏŒÏ€Ï‰Ï‚ Î· ÎµÎ³Î³ÏÎ±Ï†Î® Î¼Î¹Î±Ï‚ Î¼Î·Ï‡Î±Î½Î®Ï‚ ÏƒÏ„Î¿ Azure AD Î³Î¹Î± Î½Î± Î±Ï€Î¿ÎºÏ„Î®ÏƒÎµÎ¹ Î­Î½Î± PRT ÎºÎ±Î¹ Î· Ï‡ÏÎ®ÏƒÎ· PRTs (Î½ÏŒÎ¼Î¹Î¼Ï‰Î½ Î® ÎºÎ»ÎµÎ¼Î¼Î­Î½Ï‰Î½) Î³Î¹Î± Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ· ÏƒÎµ Ï€ÏŒÏÎ¿Ï…Ï‚ Î¼Îµ Î´Î¹Î¬Ï†Î¿ÏÎ¿Ï…Ï‚ Ï„ÏÏŒÏ€Î¿Ï…Ï‚. Î‘Ï…Ï„Î­Ï‚ Î´ÎµÎ½ ÎµÎ¯Î½Î±Î¹ Î¬Î¼ÎµÏƒÎµÏ‚ ÎµÏ€Î¹Î¸Î­ÏƒÎµÎ¹Ï‚, Î±Î»Î»Î¬ Î´Î¹ÎµÏ…ÎºÎ¿Î»ÏÎ½ÎµÎ¹ Ï„Î· Ï‡ÏÎ®ÏƒÎ· PRTs Î³Î¹Î± Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ· ÏƒÎµ Ï€ÏŒÏÎ¿Ï…Ï‚ Î¼Îµ Î´Î¹Î¬Ï†Î¿ÏÎ¿Ï…Ï‚ Ï„ÏÏŒÏ€Î¿Ï…Ï‚. Î’ÏÎµÎ¯Ï„Îµ Ï€ÎµÏÎ¹ÏƒÏƒÏŒÏ„ÎµÏÎµÏ‚ Ï€Î»Î·ÏÎ¿Ï†Î¿ÏÎ¯ÎµÏ‚ ÏƒÏ„Î¿ [https://dirkjanm.io/introducing-roadtools-token-exchange-roadtx/](https://dirkjanm.io/introducing-roadtools-token-exchange-roadtx/)

## Î‘Î½Î±Ï†Î¿ÏÎ­Ï‚

* [https://dirkjanm.io/phishing-for-microsoft-entra-primary-refresh-tokens/](https://dirkjanm.io/phishing-for-microsoft-entra-primary-refresh-tokens/)

{% hint style="success" %}
ÎœÎ¬Î¸ÎµÏ„Îµ & ÎµÎ¾Î±ÏƒÎºÎ·Î¸ÎµÎ¯Ï„Îµ ÏƒÏ„Î¿ AWS Hacking:<img src="../../../.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image.png" alt="" data-size="line">\
ÎœÎ¬Î¸ÎµÏ„Îµ & ÎµÎ¾Î±ÏƒÎºÎ·Î¸ÎµÎ¯Ï„Îµ ÏƒÏ„Î¿ GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Î¥Ï€Î¿ÏƒÏ„Î®ÏÎ¹Î¾Î· HackTricks</summary>

* Î•Î»Î­Î³Î¾Ï„Îµ Ï„Î± [**ÏƒÏ‡Î­Î´Î¹Î± ÏƒÏ…Î½Î´ÏÎ¿Î¼Î®Ï‚**](https://github.com/sponsors/carlospolop)!
* **Î•Î³Î³ÏÎ±Ï†ÎµÎ¯Ï„Îµ ÏƒÏ„Î·Î½** ğŸ’¬ [**Î¿Î¼Î¬Î´Î± Discord**](https://discord.gg/hRep4RUj7f) Î® ÏƒÏ„Î·Î½ [**Î¿Î¼Î¬Î´Î± telegram**](https://t.me/peass) Î® **Î±ÎºÎ¿Î»Î¿Ï…Î¸Î®ÏƒÏ„Îµ** Î¼Î±Ï‚ ÏƒÏ„Î¿ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **ÎœÎ¿Î¹ÏÎ±ÏƒÏ„ÎµÎ¯Ï„Îµ ÎºÏŒÎ»Ï€Î± hacking Ï…Ï€Î¿Î²Î¬Î»Î»Î¿Î½Ï„Î±Ï‚ PRs ÏƒÏ„Î±** [**HackTricks**](https://github.com/carlospolop/hacktricks) ÎºÎ±Î¹ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
