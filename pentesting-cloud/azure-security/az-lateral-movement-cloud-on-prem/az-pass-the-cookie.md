# Az - Pass the Cookie

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ЁЯТм [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ЁЯРж [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Why Cookies?

рдмреНрд░рд╛рдЙрдЬрд╝рд░ **cookies** рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдФрд░ MFA рдХреЛ **рдмрд╛рдпрдкрд╛рд╕** рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рд╢рд╛рдирджрд╛рд░ рддрдВрддреНрд░ рд╣реИрдВред рдХреНрдпреЛрдВрдХрд┐ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдкрд╣рд▓реЗ рд╣реА рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдореЗрдВ рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХрд░ рдЪреБрдХрд╛ рд╣реИ, рд╕рддреНрд░ **cookie** рдХрд╛ рдЙрдкрдпреЛрдЧ рдЙрд╕ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рд░реВрдк рдореЗрдВ **рдбреЗрдЯрд╛** рддрдХ рдкрд╣реБрдБрдЪрдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рдмрд┐рдирд╛ рдкреБрдирдГ рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдХреЗред

рдЖрдк рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ **рдмреНрд░рд╛рдЙрдЬрд╝рд░ рдХреБрдХреАрдЬрд╝ рдХрд╣рд╛рдБ рд╕реНрдерд┐рдд рд╣реИрдВ**:

{% embed url="https://book.hacktricks.xyz/generic-methodologies-and-resources/basic-forensic-methodology/specific-software-file-type-tricks/browser-artifacts?q=browse#google-chrome" %}

## Attack

рдЪреБрдиреМрддреАрдкреВрд░реНрдг рднрд╛рдЧ рдпрд╣ рд╣реИ рдХрд┐ рд╡реЗ **cookies рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛** рдХреЗ рд▓рд┐рдП Microsoft Data Protection API (**DPAPI**) рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ **рдПрдиреНрдХреНрд░рд┐рдкреНрдЯреЗрдб** рд╣реИрдВред рдпрд╣ рдПрдиреНрдХреНрд░рд┐рдкреНрдЯреЗрдб рд╣реИ [рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рд╕реЗ рдЬреБрдбрд╝реЗ рдХреНрд░рд┐рдкреНрдЯреЛрдЧреНрд░рд╛рдлрд┐рдХ рдХреБрдВрдЬрд┐рдпреЛрдВ](https://book.hacktricks.xyz/windows-hardening/windows-local-privilege-escalation/dpapi-extracting-passwords) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЬрд┐рдирдХреА рдХреБрдХреАрдЬрд╝ рд╣реИрдВред рдЗрд╕рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдЖрдк рдпрд╣рд╛рдБ рдкрд╛ рд╕рдХрддреЗ рд╣реИрдВ:

{% embed url="https://book.hacktricks.xyz/windows-hardening/windows-local-privilege-escalation/dpapi-extracting-passwords" %}

Mimikatz рдХреЗ рд╕рд╛рде, рдореИрдВ рдЗрд╕ рдХрдорд╛рдВрдб рдХреЗ рд╕рд╛рде **рдПрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреА рдХреБрдХреАрдЬрд╝** рдирд┐рдХрд╛рд▓рдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рд╣реВрдБ, рднрд▓реЗ рд╣реА рд╡реЗ рдПрдиреНрдХреНрд░рд┐рдкреНрдЯреЗрдб рд╣реЛрдВ:
```bash
mimikatz.exe privilege::debug log "dpapi::chrome /in:%localappdata%\google\chrome\USERDA~1\default\cookies /unprotect" exit
```
For Azure, рд╣рдо рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХреБрдХреАрдЬрд╝ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдзреНрдпрд╛рди рд░рдЦрддреЗ рд╣реИрдВ рдЬрд┐рдирдореЗрдВ **`ESTSAUTH`**, **`ESTSAUTHPERSISTENT`**, рдФрд░ **`ESTSAUTHLIGHT`** рд╢рд╛рдорд┐рд▓ рд╣реИрдВред рдпреЗ рд╡рд╣рд╛рдБ рд╣реИрдВ рдХреНрдпреЛрдВрдХрд┐ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рд╣рд╛рд▓ рд╣реА рдореЗрдВ Azure рдкрд░ рд╕рдХреНрд░рд┐рдп рд░рд╣рд╛ рд╣реИред

рдмрд╕ login.microsoftonline.com рдкрд░ рдЬрд╛рдПрдВ рдФрд░ рдХреБрдХреА **`ESTSAUTHPERSISTENT`** (рдЬреЛ тАЬStay Signed InтАЭ рд╡рд┐рдХрд▓реНрдк рджреНрд╡рд╛рд░рд╛ рдЙрддреНрдкрдиреНрди рд╣реЛрддреА рд╣реИ) рдпрд╛ **`ESTSAUTH`** рдЬреЛрдбрд╝реЗрдВред рдФрд░ рдЖрдк рдкреНрд░рдорд╛рдгрд┐рдд рд╣реЛ рдЬрд╛рдПрдВрдЧреЗред

## References

* [https://stealthbits.com/blog/bypassing-mfa-with-pass-the-cookie/](https://stealthbits.com/blog/bypassing-mfa-with-pass-the-cookie/)

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ЁЯТм [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ЁЯРж [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
