# Az AD Connect - Hybrid Identity

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Basic Information

Integracija izmeÄ‘u **On-premises Active Directory (AD)** i **Azure AD** se olakÅ¡ava putem **Azure AD Connect**, nudeÄ‡i razliÄite metode koje podrÅ¾avaju **Single Sign-on (SSO)**. Svaka metoda, iako korisna, predstavlja potencijalne sigurnosne ranjivosti koje bi mogle biti iskoriÅ¡Ä‡ene za kompromitovanje cloud ili on-premises okruÅ¾enja:

* **Pass-Through Authentication (PTA)**:
* MoguÄ‡a kompromitacija agenta na on-prem AD, omoguÄ‡avajuÄ‡i validaciju korisniÄkih lozinki za Azure konekcije (on-prem do Cloud).
* MoguÄ‡nost registracije novog agenta za validaciju autentifikacija na novoj lokaciji (Cloud do on-prem).

{% content-ref url="pta-pass-through-authentication.md" %}
[pta-pass-through-authentication.md](pta-pass-through-authentication.md)
{% endcontent-ref %}

* **Password Hash Sync (PHS)**:
* Potencijalno vaÄ‘enje lozinki u Äistom tekstu privilegovanih korisnika iz AD, ukljuÄujuÄ‡i akreditive visoko privilegovanog, automatski generisanog AzureAD korisnika.

{% content-ref url="phs-password-hash-sync.md" %}
[phs-password-hash-sync.md](phs-password-hash-sync.md)
{% endcontent-ref %}

* **Federation**:
* KraÄ‘a privatnog kljuÄa koriÅ¡Ä‡enog za SAML potpisivanje, omoguÄ‡avajuÄ‡i impersonaciju on-prem i cloud identiteta.

{% content-ref url="federation.md" %}
[federation.md](federation.md)
{% endcontent-ref %}

* **Seamless SSO:**
* KraÄ‘a lozinke korisnika `AZUREADSSOACC`, koriÅ¡Ä‡ene za potpisivanje Kerberos srebrnih karata, omoguÄ‡avajuÄ‡i impersonaciju bilo kog cloud korisnika.

{% content-ref url="seamless-sso.md" %}
[seamless-sso.md](seamless-sso.md)
{% endcontent-ref %}

* **Cloud Kerberos Trust**:
* MoguÄ‡nost eskalacije sa Global Admin na on-prem Domain Admin manipulacijom AzureAD korisniÄkih imena i SIDs i zahtevom za TGT-ima iz AzureAD.

{% content-ref url="az-cloud-kerberos-trust.md" %}
[az-cloud-kerberos-trust.md](az-cloud-kerberos-trust.md)
{% endcontent-ref %}

* **Default Applications**:
* Kompromitovanje naloga Administratora aplikacije ili on-premise Sync naloga omoguÄ‡ava modifikaciju postavki direktorijuma, Älanstava u grupama, korisniÄkih naloga, SharePoint sajtova i OneDrive datoteka.

{% content-ref url="az-default-applications.md" %}
[az-default-applications.md](az-default-applications.md)
{% endcontent-ref %}

Za svaku metodu integracije, vrÅ¡i se sinhronizacija korisnika, a `MSOL_<installationidentifier>` nalog se kreira u on-prem AD. VaÅ¾no je napomenuti da i **PHS** i **PTA** metode olakÅ¡avaju **Seamless SSO**, omoguÄ‡avajuÄ‡i automatsko prijavljivanje za Azure AD raÄunare pridruÅ¾ene on-prem domeni.

Da biste proverili instalaciju **Azure AD Connect**, moÅ¾e se koristiti sledeÄ‡a PowerShell komanda, koristeÄ‡i **AzureADConnectHealthSync** modul (instaliran po defaultu sa Azure AD Connect):
```powershell
Get-ADSyncConnector
```
{% hint style="success" %}
UÄite i veÅ¾bajte AWS Hacking:<img src="../../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
UÄite i veÅ¾bajte GCP Hacking: <img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>PodrÅ¡ka HackTricks</summary>

* Proverite [**planove pretplate**](https://github.com/sponsors/carlospolop)!
* **PridruÅ¾ite se** ğŸ’¬ [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili **pratite** nas na **Twitteru** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Podelite hakerske trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
{% endhint %}
