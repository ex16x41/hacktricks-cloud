# Az AD Connect - Hibridni identitet

{% hint style="success" %}
NauÄite i veÅ¾bajte hakovanje AWS-a:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
NauÄite i veÅ¾bajte hakovanje GCP-a: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>PodrÅ¾ite HackTricks</summary>

* Proverite [**planove pretplate**](https://github.com/sponsors/carlospolop)!
* **PridruÅ¾ite se** ğŸ’¬ [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitteru** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podelite hakovanje trikova slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
{% endhint %}

## Osnovne informacije

Integracija izmeÄ‘u **Lokalnog Active Directory-ja (AD)** i **Azure AD** je olakÅ¡ana pomoÄ‡u **Azure AD Connect**-a, nudeÄ‡i razliÄite metode koje podrÅ¾avaju **Single Sign-on (SSO)**. Svaka metoda, iako korisna, predstavlja potencijalne sigurnosne ranjivosti koje bi mogle biti iskoriÅ¡Ä‡ene za kompromitovanje cloud ili on-premises okruÅ¾enja:

* **ProsljeÄ‘ivanje autentikacije (PTA)**:
- MoguÄ‡nost kompromitovanja agenta na on-prem AD, omoguÄ‡avajuÄ‡i validaciju korisniÄkih lozinki za Azure konekcije (on-prem ka Cloud-u).
- Izvodljivost registrovanja novog agenta za validaciju autentikacija na novoj lokaciji (Cloud ka on-prem).

{% content-ref url="pta-pass-through-authentication.md" %}
[pta-pass-through-authentication.md](pta-pass-through-authentication.md)
{% endcontent-ref %}

* **Sinhronizacija lozinki (PHS)**:
- Potencijalno izvlaÄenje lozinki u Äistom tekstu privilegovanih korisnika iz AD-a, ukljuÄujuÄ‡i akreditive visoko privilegovanog, automatski generisanog AzureAD korisnika.

{% content-ref url="phs-password-hash-sync.md" %}
[phs-password-hash-sync.md](phs-password-hash-sync.md)
{% endcontent-ref %}

* **Federacija**:
- KraÄ‘a privatnog kljuÄa koriÅ¡Ä‡enog za SAML potpisivanje, omoguÄ‡avajuÄ‡i impersonaciju on-prem i cloud identiteta.

{% content-ref url="federation.md" %}
[federation.md](federation.md)
{% endcontent-ref %}

* **Bezbedno SSO:**
- KraÄ‘a lozinke korisnika `AZUREADSSOACC`, koriÅ¡tene za potpisivanje Kerberos srebrnih karata, omoguÄ‡avajuÄ‡i impersonaciju bilo kog cloud korisnika.

{% content-ref url="seamless-sso.md" %}
[seamless-sso.md](seamless-sso.md)
{% endcontent-ref %}

* **Cloud Kerberos Trust**:
- MoguÄ‡nost eskalacije sa Global Admin na on-prem Domain Admin manipulacijom AzureAD korisniÄkih imena i SID-ova i zahtevanjem TGT-ova od AzureAD.

{% content-ref url="az-cloud-kerberos-trust.md" %}
[az-cloud-kerberos-trust.md](az-cloud-kerberos-trust.md)
{% endcontent-ref %}

* **Podrazumevane aplikacije**:
- Kompromitovanje naloga administratora aplikacije ili naloga za sinhronizaciju na lokalu omoguÄ‡ava modifikaciju postavki direktorijuma, Älanstava u grupama, korisniÄkih naloga, SharePoint sajtova i OneDrive fajlova.

{% content-ref url="az-default-applications.md" %}
[az-default-applications.md](az-default-applications.md)
{% endcontent-ref %}

Za svaku metodu integracije, sinhronizacija korisnika se sprovodi, i nalog `MSOL_<installationidentifier>` se kreira u on-prem AD-u. VaÅ¾no je napomenuti da i **PHS** i **PTA** metode olakÅ¡avaju **Bezbedno SSO**, omoguÄ‡avajuÄ‡i automatsku prijavu za Azure AD raÄunare pridruÅ¾ene on-prem domenu.

Za proveru instalacije **Azure AD Connect**-a, moÅ¾e se koristiti sledeÄ‡a PowerShell komanda, koristeÄ‡i **AzureADConnectHealthSync** modul (instaliran podrazumevano sa Azure AD Connect-om):
```powershell
Get-ADSyncConnector
```
{% hint style="success" %}
UÄite i veÅ¾bajte hakovanje AWS-a: <img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks obuka AWS Crveni Tim Ekspert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
UÄite i veÅ¾bajte hakovanje GCP-a: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks obuka GCP Crveni Tim Ekspert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>PodrÅ¾ite HackTricks</summary>

* Proverite [**planove pretplate**](https://github.com/sponsors/carlospolop)!
* **PridruÅ¾ite se** ğŸ’¬ [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitteru** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podelite hakovanje trikova slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
{% endhint %}
