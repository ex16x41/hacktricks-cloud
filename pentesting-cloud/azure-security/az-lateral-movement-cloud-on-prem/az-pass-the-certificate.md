# Az - Pass the Certificate

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Pass the Certificate (Azure)

Azureã«å‚åŠ ã—ã¦ã„ã‚‹ãƒã‚·ãƒ³ã§ã¯ã€ä¸¡æ–¹ã®ãƒã‚·ãƒ³ãŒ**NegoEx**èªè¨¼ãƒ¡ã‚«ãƒ‹ã‚ºãƒ ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã‚‹å ´åˆã€**Azure AD CA**ã«ã‚ˆã£ã¦ç™ºè¡Œã•ã‚ŒãŸè¨¼æ˜æ›¸ã‚’ä½¿ç”¨ã—ã¦ã€ä¸€æ–¹ã®ãƒã‚·ãƒ³ã‹ã‚‰ä»–æ–¹ã®ãƒã‚·ãƒ³ã«èªè¨¼ã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ï¼ˆå¯¾è±¡ã¨ã—ã¦å¿…è¦ãªãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãŸã‚ã«ï¼‰ã€‚

è¶…ç°¡ç•¥åŒ–ã™ã‚‹ã¨ï¼š

* æ¥ç¶šã‚’é–‹å§‹ã™ã‚‹ãƒã‚·ãƒ³ï¼ˆã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆï¼‰ã¯ã€**ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãŸã‚ã«Azure ADã‹ã‚‰è¨¼æ˜æ›¸ãŒå¿…è¦**ã§ã™ã€‚
* ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¯ã€PRTã‚„ãã®ä»–ã®è©³ç´°ã‚’å«ã‚€JSON Web Tokenï¼ˆJWTï¼‰ãƒ˜ãƒƒãƒ€ãƒ¼ã‚’ä½œæˆã—ã€æ´¾ç”Ÿã‚­ãƒ¼ï¼ˆã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚­ãƒ¼ã¨ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚’ä½¿ç”¨ï¼‰ã‚’ä½¿ã£ã¦ç½²åã—ã€**Azure ADã«é€ä¿¡**ã—ã¾ã™ã€‚
* Azure ADã¯ã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚­ãƒ¼ã¨ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚’ä½¿ç”¨ã—ã¦JWTç½²åã‚’æ¤œè¨¼ã—ã€PRTã®æœ‰åŠ¹æ€§ã‚’ç¢ºèªã—ã€**è¨¼æ˜æ›¸**ã§**å¿œç­”**ã—ã¾ã™ã€‚

ã“ã®ã‚·ãƒŠãƒªã‚ªã§ã¯ã€[**Pass the PRT**](pass-the-prt.md)æ”»æ’ƒã«å¿…è¦ãªã™ã¹ã¦ã®æƒ…å ±ã‚’å–å¾—ã—ãŸå¾Œï¼š

* ãƒ¦ãƒ¼ã‚¶ãƒ¼å
* ãƒ†ãƒŠãƒ³ãƒˆID
* PRT
* ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ
* æ´¾ç”Ÿã‚­ãƒ¼

ãƒ„ãƒ¼ãƒ«[**PrtToCert**](https://github.com/morRubin/PrtToCert)ã‚’ä½¿ç”¨ã—ã¦ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãŸã‚ã«**P2Pè¨¼æ˜æ›¸**ã‚’**è¦æ±‚**ã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ï¼š

{% code overflow="wrap" %}
```bash
RequestCert.py [-h] --tenantId TENANTID --prt PRT --userName USERNAME --hexCtx HEXCTX --hexDerivedKey HEXDERIVEDKEY [--passPhrase PASSPHRASE]
```
{% endcode %}

è¨¼æ˜æ›¸ã¯PRTã¨åŒã˜æœŸé–“æœ‰åŠ¹ã§ã™ã€‚è¨¼æ˜æ›¸ã‚’ä½¿ç”¨ã™ã‚‹ã«ã¯ã€pythonãƒ„ãƒ¼ãƒ«[**AzureADJoinedMachinePTC**](https://github.com/morRubin/AzureADJoinedMachinePTC)ã‚’ä½¿ç”¨ã—ã¦ã€ãƒªãƒ¢ãƒ¼ãƒˆãƒã‚·ãƒ³ã«**èªè¨¼**ã—ã€**PSEXEC**ã‚’å®Ÿè¡Œã—ã€è¢«å®³è€…ã®ãƒã‚·ãƒ³ã§**CMD**ã‚’é–‹ãã“ã¨ãŒã§ãã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€åˆ¥ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®PRTã‚’å–å¾—ã™ã‚‹ãŸã‚ã«å†åº¦Mimikatzã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
```bash
Main.py [-h] --usercert USERCERT --certpass CERTPASS --remoteip REMOTEIP
```
## å‚è€ƒæ–‡çŒ®

* Pass the Certificate ã®ä»•çµ„ã¿ã«ã¤ã„ã¦ã®è©³ç´°ã¯ã€å…ƒã®æŠ•ç¨¿ã‚’ç¢ºèªã—ã¦ãã ã•ã„ [https://medium.com/@mor2464/azure-ad-pass-the-certificate-d0c5de624597](https://medium.com/@mor2464/azure-ad-pass-the-certificate-d0c5de624597)

{% hint style="success" %}
AWS ãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã³ã€å®Ÿè·µã™ã‚‹ï¼š<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
GCP ãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã³ã€å®Ÿè·µã™ã‚‹ï¼š<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricksã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹</summary>

* [**ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³**](https://github.com/sponsors/carlospolop)ã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼
* **ğŸ’¬ [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã¾ãŸã¯[**Telegramã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«å‚åŠ ã™ã‚‹ã‹ã€**Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**ã‚’ãƒ•ã‚©ãƒ­ãƒ¼ã—ã¦ãã ã•ã„ã€‚**
* **ãƒãƒƒã‚­ãƒ³ã‚°ã®ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã™ã‚‹ã«ã¯ã€[**HackTricks**](https://github.com/carlospolop/hacktricks)ãŠã‚ˆã³[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)ã®GitHubãƒªãƒã‚¸ãƒˆãƒªã«PRã‚’æå‡ºã—ã¦ãã ã•ã„ã€‚**

</details>
{% endhint %}
