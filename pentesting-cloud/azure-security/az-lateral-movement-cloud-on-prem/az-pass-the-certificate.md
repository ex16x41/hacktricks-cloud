# Az - è¨¼æ˜æ›¸ã‚’æ¸¡ã™

{% hint style="success" %}
AWSãƒãƒƒã‚­ãƒ³ã‚°ã®å­¦ç¿’ã¨ç·´ç¿’:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCPãƒãƒƒã‚­ãƒ³ã‚°ã®å­¦ç¿’ã¨ç·´ç¿’: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricksã‚’ã‚µãƒãƒ¼ãƒˆ</summary>

* [**ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³**](https://github.com/sponsors/carlospolop)ã‚’ãƒã‚§ãƒƒã‚¯ï¼
* ğŸ’¬ [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã«**å‚åŠ **ã¾ãŸã¯[**telegramã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«å‚åŠ ã™ã‚‹ã‹ã€**Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**ã‚’ãƒ•ã‚©ãƒ­ãƒ¼**ã—ã¦ãã ã•ã„ã€‚
* **HackTricks**ã¨**HackTricks Cloud**ã®githubãƒªãƒã‚¸ãƒˆãƒªã«PRã‚’æå‡ºã—ã¦**ãƒãƒƒã‚­ãƒ³ã‚°ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰**ã—ã¦ãã ã•ã„ã€‚

</details>
{% endhint %}

## è¨¼æ˜æ›¸ã‚’æ¸¡ã™ï¼ˆAzureï¼‰

Azureã«å‚åŠ ã—ãŸãƒã‚·ãƒ³ã§ã¯ã€**NegoEx**èªè¨¼ãƒ¡ã‚«ãƒ‹ã‚ºãƒ ã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹ä¸¡æ–¹ã®ãƒã‚·ãƒ³ã§ã€**Azure AD CAã«ã‚ˆã£ã¦ç™ºè¡Œã•ã‚ŒãŸè¨¼æ˜æ›¸**ã‚’å¿…è¦ã¨ã™ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ï¼ˆã‚µãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¨ã—ã¦ï¼‰ã‹ã‚‰åˆ¥ã®ãƒã‚·ãƒ³ã«èªè¨¼ã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚

éå¸¸ã«ç°¡ç•¥åŒ–ã•ã‚ŒãŸè¨€è‘‰ã§è¨€ã†ã¨ï¼š

* æ¥ç¶šã‚’é–‹å§‹ã™ã‚‹ãƒã‚·ãƒ³ï¼ˆã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆï¼‰ã¯ã€**Azure ADã‹ã‚‰ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è¨¼æ˜æ›¸**ã‚’å¿…è¦ã¨ã—ã¾ã™ã€‚
* ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¯ã€PRTã¨ãã®ä»–ã®è©³ç´°ã‚’å«ã‚€JSON Web Tokenï¼ˆJWTï¼‰ãƒ˜ãƒƒãƒ€ãƒ¼ã‚’ä½œæˆã—ã€Derivedã‚­ãƒ¼ã‚’ä½¿ç”¨ã—ã¦ç½²åã—ã¾ã™ï¼ˆã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚­ãƒ¼ã¨ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚’ä½¿ç”¨ï¼‰ãã—ã¦**Azure ADã«é€ä¿¡**ã—ã¾ã™ã€‚
* Azure ADã¯ã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚­ãƒ¼ã¨ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚’ä½¿ç”¨ã—ã¦JWTç½²åã‚’æ¤œè¨¼ã—ã€PRTã®æœ‰åŠ¹æ€§ã‚’ãƒã‚§ãƒƒã‚¯ã—ã€**è¨¼æ˜æ›¸**ã§**å¿œç­”**ã—ã¾ã™ã€‚

ã“ã®ã‚·ãƒŠãƒªã‚ªã§ã¯ã€[**PRTã‚’æ¸¡ã™**](pass-the-prt.md)æ”»æ’ƒã«å¿…è¦ãªã™ã¹ã¦ã®æƒ…å ±ã‚’å–å¾—ã—ãŸå¾Œï¼š

* ãƒ¦ãƒ¼ã‚¶ãƒ¼å
* ãƒ†ãƒŠãƒ³ãƒˆID
* PRT
* ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ
* Derivedã‚­ãƒ¼

ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®**P2Pè¨¼æ˜æ›¸ã‚’ãƒªã‚¯ã‚¨ã‚¹ãƒˆ**ã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚ãƒ„ãƒ¼ãƒ«[**PrtToCert**](https://github.com/morRubin/PrtToCert)**ã‚’ä½¿ç”¨ã—ã¦ï¼š**

{% code overflow="wrap" %}
```bash
RequestCert.py [-h] --tenantId TENANTID --prt PRT --userName USERNAME --hexCtx HEXCTX --hexDerivedKey HEXDERIVEDKEY [--passPhrase PASSPHRASE]
```
{% endcode %}

è¨¼æ˜æ›¸ã®æœ‰åŠ¹æœŸé™ã¯PRTã¨åŒã˜ã§ã™ã€‚è¨¼æ˜æ›¸ã‚’ä½¿ç”¨ã™ã‚‹ã«ã¯ã€ãƒªãƒ¢ãƒ¼ãƒˆãƒã‚·ãƒ³ã«**èªè¨¼**ã—ã€**PSEXEC**ã‚’å®Ÿè¡Œã—ã€è¢«å®³è€…ãƒã‚·ãƒ³ã§**CMDã‚’é–‹ã**ã“ã¨ãŒã§ãã‚‹Pythonãƒ„ãƒ¼ãƒ«[**AzureADJoinedMachinePTC**](https://github.com/morRubin/AzureADJoinedMachinePTC)ã‚’ä½¿ç”¨ã§ãã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€å†åº¦Mimikatzã‚’ä½¿ç”¨ã—ã¦åˆ¥ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®PRTã‚’å–å¾—ã§ãã¾ã™ã€‚
```bash
Main.py [-h] --usercert USERCERT --certpass CERTPASS --remoteip REMOTEIP
```
## å‚è€ƒ

* Pass the Certificateã®å‹•ä½œè©³ç´°ã«ã¤ã„ã¦ã¯ã€å…ƒã®æŠ•ç¨¿ã‚’ç¢ºèªã—ã¦ãã ã•ã„ [https://medium.com/@mor2464/azure-ad-pass-the-certificate-d0c5de624597](https://medium.com/@mor2464/azure-ad-pass-the-certificate-d0c5de624597)

{% hint style="success" %}
AWSãƒãƒƒã‚­ãƒ³ã‚°ã®å­¦ç¿’ã¨å®Ÿè·µ:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCPãƒãƒƒã‚­ãƒ³ã‚°ã®å­¦ç¿’ã¨å®Ÿè·µ: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricksã®ã‚µãƒãƒ¼ãƒˆ</summary>

* [**è³¼èª­ãƒ—ãƒ©ãƒ³**](https://github.com/sponsors/carlospolop)ã‚’ãƒã‚§ãƒƒã‚¯ï¼
* ğŸ’¬ [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã«å‚åŠ ã™ã‚‹ã‹ã€[**telegramã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«å‚åŠ ã™ã‚‹ã‹ã€**Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**ã‚’ãƒ•ã‚©ãƒ­ãƒ¼**ã—ã¦ãã ã•ã„ã€‚
* ãƒãƒƒã‚­ãƒ³ã‚°ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã™ã‚‹ãŸã‚ã«ã€[**HackTricks**](https://github.com/carlospolop/hacktricks)ã¨[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)ã®GitHubãƒªãƒã‚¸ãƒˆãƒªã«PRã‚’æå‡ºã—ã¦ãã ã•ã„ã€‚

</details>
{% endhint %}
