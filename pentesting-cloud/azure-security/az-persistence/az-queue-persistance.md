# Az - Queue Persistance

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Kolejka

For more information check:

{% content-ref url="../az-services/az-queue-enum.md" %}
[az-queue-enum.md](../az-services/az-queue-enum.md)
{% endcontent-ref %}



### Akcje: `Microsoft.Storage/storageAccounts/queueServices/queues/write`

To uprawnienie pozwala atakujÄ…cemu na tworzenie lub modyfikowanie kolejek i ich wÅ‚aÅ›ciwoÅ›ci w ramach konta magazynowego. MoÅ¼e byÄ‡ uÅ¼ywane do tworzenia nieautoryzowanych kolejek, modyfikowania metadanych lub zmiany list kontroli dostÄ™pu (ACL), aby przyznaÄ‡ lub ograniczyÄ‡ dostÄ™p. Ta zdolnoÅ›Ä‡ moÅ¼e zakÅ‚Ã³caÄ‡ przepÅ‚ywy pracy, wstrzykiwaÄ‡ zÅ‚oÅ›liwe dane, eksfiltrujÄ…c wraÅ¼liwe informacje lub manipulowaÄ‡ ustawieniami kolejki, aby umoÅ¼liwiÄ‡ dalsze ataki.

{% code overflow="wrap" %}
```bash
az storage queue create --name <new-queue-name> --account-name <storage-account>

az storage queue metadata update --name <queue-name> --metadata key1=value1 key2=value2 --account-name <storage-account>

az storage queue policy set --name <queue-name> --permissions rwd --expiry 2024-12-31T23:59:59Z --account-name <storage-account>
```
{% endcode %}

### Actions: `Microsoft.Storage/storageAccounts/queueServices/queues/setAcl/action`

DziÄ™ki temu uprawnieniu, atakujÄ…cy moÅ¼e modyfikowaÄ‡ listÄ™ kontroli dostÄ™pu (ACL) kolejki Azure Storage, ktÃ³ra moÅ¼e byÄ‡ uÅ¼ywana z podpisami dostÄ™pu wspÃ³Å‚dzielonego. UmoÅ¼liwia to atakujÄ…cemu przyznanie sobie lub innym zÅ‚oÅ›liwym uÅ¼ytkownikom trwaÅ‚ego dostÄ™pu do kolejki, nawet jeÅ›li legalne dane uwierzytelniajÄ…ce zostanÄ… uniewaÅ¼nione. UtrzymujÄ…c nieautoryzowany dostÄ™p, mogÄ… nieprzerwanie monitorowaÄ‡, manipulowaÄ‡ lub eksfiltrujÄ…c dane, zapewniajÄ…c, Å¼e ich obecnoÅ›Ä‡ pozostaje niezauwaÅ¼ona, a przepÅ‚ywy pracy sÄ… zakÅ‚Ã³cane w czasie.

{% code overflow="wrap" %}
```bash
az storage queue policy create \
--queue-name <QUEUE_NAME> \
--account-name <STORAGE_ACCOUNT_NAME> \
--account-key <STORAGE_ACCOUNT_KEY> \
--name <POLICY_NAME> \
--permission <PERMISSIONS> \
--start <START_TIME> \
--expiry <EXPIRY_TIME>
```
## References

* https://learn.microsoft.com/en-us/azure/storage/queues/storage-powershell-how-to-use-queues
* https://learn.microsoft.com/en-us/rest/api/storageservices/queue-service-rest-api
* https://learn.microsoft.com/en-us/azure/storage/queues/queues-auth-abac-attributes

* SprawdÅº [**plany subskrypcyjne**](https://github.com/sponsors/carlospolop)!
* **DoÅ‚Ä…cz do** ğŸ’¬ [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegram**](https://t.me/peass) lub **Å›ledÅº** nas na **Twitterze** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podziel siÄ™ trikami hackingowymi, przesyÅ‚ajÄ…c PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repozytoriÃ³w github.

</details>
{% endhint %}
