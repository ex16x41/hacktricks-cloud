# Az - Key Vault Post Exploitation

{% hint style="success" %}
AWSãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã³ã€å®Ÿè·µã™ã‚‹:<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
GCPãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã³ã€å®Ÿè·µã™ã‚‹: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricksã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹</summary>

* [**ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³**](https://github.com/sponsors/carlospolop)ã‚’ç¢ºèªã—ã¦ãã ã•ã„!
* **ğŸ’¬ [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã¾ãŸã¯[**Telegramã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«å‚åŠ ã™ã‚‹ã‹ã€**Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**ã‚’ãƒ•ã‚©ãƒ­ãƒ¼ã—ã¦ãã ã•ã„ã€‚**
* **ãƒãƒƒã‚­ãƒ³ã‚°ã®ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã™ã‚‹ã«ã¯ã€[**HackTricks**](https://github.com/carlospolop/hacktricks)ã¨[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)ã®GitHubãƒªãƒã‚¸ãƒˆãƒªã«PRã‚’æå‡ºã—ã¦ãã ã•ã„ã€‚**

</details>
{% endhint %}

## Azure Key Vault

ã“ã®ã‚µãƒ¼ãƒ“ã‚¹ã«é–¢ã™ã‚‹è©³ç´°æƒ…å ±ã¯ã€ä»¥ä¸‹ã‚’ç¢ºèªã—ã¦ãã ã•ã„:

{% content-ref url="../az-services/keyvault.md" %}
[keyvault.md](../az-services/keyvault.md)
{% endcontent-ref %}

### Microsoft.KeyVault/vaults/secrets/getSecret/action

ã“ã®æ¨©é™ã«ã‚ˆã‚Šã€ãƒ—ãƒªãƒ³ã‚·ãƒ‘ãƒ«ã¯ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã®å€¤ã‚’èª­ã¿å–ã‚‹ã“ã¨ãŒã§ãã¾ã™: 

{% code overflow="wrap" %}
```bash
az keyvault secret show --vault-name <vault name> --name <secret name>

# Get old version secret value
az keyvault secret show --id https://<KeyVaultName>.vault.azure.net/secrets/<KeyVaultName>/<idOldVersion>
```
{% endcode %}

### **Microsoft.KeyVault/vaults/certificates/purge/action**

ã“ã®æ¨©é™ã¯ã€ãƒ—ãƒªãƒ³ã‚·ãƒ‘ãƒ«ãŒãƒœãƒ¼ãƒ«ãƒˆã‹ã‚‰è¨¼æ˜æ›¸ã‚’æ°¸ä¹…ã«å‰Šé™¤ã™ã‚‹ã“ã¨ã‚’è¨±å¯ã—ã¾ã™ã€‚
```bash
az keyvault certificate purge --vault-name <vault name> --name <certificate name>
```
### **Microsoft.KeyVault/vaults/keys/encrypt/action**

ã“ã®æ¨©é™ã¯ã€ãƒ—ãƒªãƒ³ã‚·ãƒ‘ãƒ«ãŒãƒœãƒ¼ãƒ«ãƒˆã«ä¿å­˜ã•ã‚ŒãŸã‚­ãƒ¼ã‚’ä½¿ç”¨ã—ã¦ãƒ‡ãƒ¼ã‚¿ã‚’æš—å·åŒ–ã™ã‚‹ã“ã¨ã‚’è¨±å¯ã—ã¾ã™ã€‚

{% code overflow="wrap" %}
```bash
az keyvault key encrypt --vault-name <vault name> --name <key name> --algorithm <algorithm> --value <value>

# Example
echo "HackTricks" | base64 # SGFja1RyaWNrcwo=
az keyvault key encrypt --vault-name testing-1231234 --name testing --algorithm RSA-OAEP-256 --value SGFja1RyaWNrcwo=
```
{% endcode %}

### **Microsoft.KeyVault/vaults/keys/decrypt/action**

ã“ã®æ¨©é™ã¯ã€ãƒ—ãƒªãƒ³ã‚·ãƒ‘ãƒ«ãŒãƒœãƒ¼ãƒ«ãƒˆã«ä¿å­˜ã•ã‚ŒãŸã‚­ãƒ¼ã‚’ä½¿ç”¨ã—ã¦ãƒ‡ãƒ¼ã‚¿ã‚’å¾©å·åŒ–ã™ã‚‹ã“ã¨ã‚’è¨±å¯ã—ã¾ã™ã€‚

{% code overflow="wrap" %}
```bash
az keyvault key decrypt --vault-name <vault name> --name <key name> --algorithm <algorithm> --value <value>

# Example
az keyvault key decrypt --vault-name testing-1231234 --name testing --algorithm RSA-OAEP-256 --value "ISZ+7dNcDJXLPR5MkdjNvGbtYK3a6Rg0ph/+3g1IoUrCwXnF791xSF0O4rcdVyyBnKRu0cbucqQ/+0fk2QyAZP/aWo/gaxUH55pubS8Zjyw/tBhC5BRJiCtFX4tzUtgTjg8lv3S4SXpYUPxev9t/9UwUixUlJoqu0BgQoXQhyhP7PfgAGsxayyqxQ8EMdkx9DIR/t9jSjv+6q8GW9NFQjOh70FCjEOpYKy9pEGdLtPTrirp3fZXgkYfIIV77TXuHHdR9Z9GG/6ge7xc9XT6X9ciE7nIXNMQGGVCcu3JAn9BZolb3uL7PBCEq+k2rH4tY0jwkxinM45tg38Re2D6CEA==" # This is the result from the previous encryption
```
{% endcode %}

### **Microsoft.KeyVault/vaults/keys/purge/action**

ã“ã®æ¨©é™ã¯ã€ãƒ—ãƒªãƒ³ã‚·ãƒ‘ãƒ«ãŒãƒœãƒ¼ãƒ«ãƒˆã‹ã‚‰ã‚­ãƒ¼ã‚’æ°¸ä¹…ã«å‰Šé™¤ã™ã‚‹ã“ã¨ã‚’è¨±å¯ã—ã¾ã™ã€‚
```bash
az keyvault key purge --vault-name <vault name> --name <key name>
```
### **Microsoft.KeyVault/vaults/secrets/purge/action**

ã“ã®æ¨©é™ã¯ã€ãƒ—ãƒªãƒ³ã‚·ãƒ‘ãƒ«ãŒãƒœãƒ¼ãƒ«ãƒˆã‹ã‚‰ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚’æ°¸ä¹…ã«å‰Šé™¤ã™ã‚‹ã“ã¨ã‚’è¨±å¯ã—ã¾ã™ã€‚
```bash
az keyvault secret purge --vault-name <vault name> --name <secret name>
```
### **Microsoft.KeyVault/vaults/secrets/setSecret/action**

ã“ã®æ¨©é™ã¯ã€ãƒ—ãƒªãƒ³ã‚·ãƒ‘ãƒ«ãŒãƒœãƒ¼ãƒ«ãƒˆå†…ã®ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚’ä½œæˆã¾ãŸã¯æ›´æ–°ã™ã‚‹ã“ã¨ã‚’è¨±å¯ã—ã¾ã™ã€‚

{% code overflow="wrap" %}
```bash
az keyvault secret set --vault-name <vault name> --name <secret name> --value <secret value>
```
{% endcode %}

### **Microsoft.KeyVault/vaults/certificates/delete**

ã“ã®æ¨©é™ã¯ã€ãƒ—ãƒªãƒ³ã‚·ãƒ‘ãƒ«ãŒãƒœãƒ¼ãƒ«ãƒˆã‹ã‚‰è¨¼æ˜æ›¸ã‚’å‰Šé™¤ã™ã‚‹ã“ã¨ã‚’è¨±å¯ã—ã¾ã™ã€‚è¨¼æ˜æ›¸ã¯ã€Œã‚½ãƒ•ãƒˆå‰Šé™¤ã€çŠ¶æ…‹ã«ç§»å‹•ã•ã‚Œã€å‰Šé™¤ã•ã‚Œãªã„é™ã‚Šå¾©å…ƒå¯èƒ½ã§ã™ã€‚

{% code overflow="wrap" %}
```bash
az keyvault certificate delete --vault-name <vault name> --name <certificate name>
```
{% endcode %}

### **Microsoft.KeyVault/vaults/keys/delete**

ã“ã®æ¨©é™ã¯ã€ãƒ—ãƒªãƒ³ã‚·ãƒ‘ãƒ«ãŒãƒœãƒ¼ãƒ«ãƒˆã‹ã‚‰ã‚­ãƒ¼ã‚’å‰Šé™¤ã™ã‚‹ã“ã¨ã‚’è¨±å¯ã—ã¾ã™ã€‚ã‚­ãƒ¼ã¯ã€Œã‚½ãƒ•ãƒˆå‰Šé™¤ã€çŠ¶æ…‹ã«ç§»å‹•ã•ã‚Œã€å‰Šé™¤ã•ã‚Œãªã„é™ã‚Šå›å¾©å¯èƒ½ã§ã™ã€‚
```bash
az keyvault key delete --vault-name <vault name> --name <key name>
```
### **Microsoft.KeyVault/vaults/secrets/delete**

ã“ã®æ¨©é™ã¯ã€ãƒ—ãƒªãƒ³ã‚·ãƒ‘ãƒ«ãŒãƒœãƒ¼ãƒ«ãƒˆã‹ã‚‰ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚’å‰Šé™¤ã™ã‚‹ã“ã¨ã‚’è¨±å¯ã—ã¾ã™ã€‚ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã¯ã€Œã‚½ãƒ•ãƒˆå‰Šé™¤ã€çŠ¶æ…‹ã«ç§»å‹•ã•ã‚Œã€å‰Šé™¤ã•ã‚Œãªã„é™ã‚Šå¾©å…ƒå¯èƒ½ã§ã™ã€‚
```bash
az keyvault secret delete --vault-name <vault name> --name <secret name>
```
### Microsoft.KeyVault/vaults/secrets/restore/action

ã“ã®æ¨©é™ã¯ã€ãƒ—ãƒªãƒ³ã‚·ãƒ‘ãƒ«ãŒãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‹ã‚‰ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚’å¾©å…ƒã™ã‚‹ã“ã¨ã‚’è¨±å¯ã—ã¾ã™ã€‚
```bash
az keyvault secret restore --vault-name <vault-name> --file <backup-file-path>
```
{% hint style="success" %}
AWSãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã³ã€å®Ÿè·µã™ã‚‹ï¼š<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
GCPãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã³ã€å®Ÿè·µã™ã‚‹ï¼š<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricksã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹</summary>

* [**ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³**](https://github.com/sponsors/carlospolop)ã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼
* **ğŸ’¬ [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã¾ãŸã¯[**Telegramã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«å‚åŠ ã™ã‚‹ã‹ã€**Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**ã‚’ãƒ•ã‚©ãƒ­ãƒ¼ã—ã¦ãã ã•ã„ã€‚**
* **ãƒãƒƒã‚­ãƒ³ã‚°ã®ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã™ã‚‹ã«ã¯ã€[**HackTricks**](https://github.com/carlospolop/hacktricks)ã¨[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)ã®GitHubãƒªãƒã‚¸ãƒˆãƒªã«PRã‚’é€ä¿¡ã—ã¦ãã ã•ã„ã€‚**

</details>
{% endhint %}
