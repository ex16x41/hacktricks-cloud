# Az - Queue Post Exploitation

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Queue

Kwa maelezo zaidi angalia:

{% content-ref url="../az-services/az-queue-enum.md" %}
[az-queue-enum.md](../az-services/az-queue-enum.md)
{% endcontent-ref %}

### DataActions:  `Microsoft.Storage/storageAccounts/queueServices/queues/messages/read`

Mshambuliaji mwenye ruhusa hii anaweza kuangalia ujumbe kutoka kwa Azure Storage Queue. Hii inamruhusu mshambuliaji kuona maudhui ya ujumbe bila kuashiria kuwa umeshughulikiwa au kubadilisha hali yao. Hii inaweza kusababisha ufikiaji usioidhinishwa wa taarifa nyeti, ikiruhusu uhamasishaji wa data au kukusanya taarifa kwa mashambulizi zaidi.

{% code overflow="wrap" %}
```bash
az storage message peek --queue-name <queue_name> --account-name <storage_account>
```
{% endcode %}

**Madhara Yanayoweza Kutokea**: Ufikiaji usioidhinishwa wa foleni, kufichuliwa kwa ujumbe, au upotoshaji wa foleni na watumiaji au huduma zisizoidhinishwa.

### DataActions: `Microsoft.Storage/storageAccounts/queueServices/queues/messages/process/action`

Kwa ruhusa hii, mshambuliaji anaweza kupata na kushughulikia ujumbe kutoka kwa Azure Storage Queue. Hii inamaanisha wanaweza kusoma maudhui ya ujumbe na kuashiria kama umeshughulikiwa, kwa ufanisi wakificha kutoka kwa mifumo halali. Hii inaweza kusababisha kufichuliwa kwa data nyeti, usumbufu katika jinsi ujumbe unavyoshughulikiwa, au hata kusitisha michakato muhimu kwa kufanya ujumbe usipatikane kwa watumiaji wao waliokusudiwa.

{% code overflow="wrap" %}
```bash
az storage message get --queue-name <queue_name> --account-name <storage_account>
```
{% endcode %}

### DataActions: `Microsoft.Storage/storageAccounts/queueServices/queues/messages/add/action`

Kwa ruhusa hii, mshambuliaji anaweza kuongeza ujumbe mpya kwenye Azure Storage Queue. Hii inawaruhusu kuingiza data mbaya au isiyoidhinishwa kwenye foleni, ambayo inaweza kusababisha kuchochea vitendo visivyokusudiwa au kuharibu huduma za chini zinazoshughulikia ujumbe.

{% code overflow="wrap" %}
```bash
az storage message put --queue-name <queue-name> --content "Injected malicious message" --account-name <storage-account>
```
{% endcode %}

### DataActions: `Microsoft.Storage/storageAccounts/queueServices/queues/messages/write`

Ruhusa hii inaruhusu mshambuliaji kuongeza ujumbe mpya au kuboresha wale waliopo katika Azure Storage Queue. Kwa kutumia hii, wanaweza kuingiza maudhui mabaya au kubadilisha ujumbe waliopo, ambayo yanaweza kupelekea upotoshaji wa programu au kusababisha tabia zisizohitajika katika mifumo inayotegemea foleni.

{% code overflow="wrap" %}
```bash
az storage message put --queue-name <queue-name> --content "Injected malicious message" --account-name <storage-account>

#Update the message
az storage message update --queue-name <queue-name> \
--id <message-id> \
--pop-receipt <pop-receipt> \
--content "Updated message content" \
--visibility-timeout <timeout-in-seconds> \
--account-name <storage-account>
```
{% endcode %}

### Actions: `Microsoft.Storage/storageAccounts/queueServices/queues/delete`

Ruhusa hii inaruhusu mshambuliaji kufuta foleni ndani ya akaunti ya hifadhi. Kwa kutumia uwezo huu, mshambuliaji anaweza kuondoa kwa kudumu foleni na ujumbe wao wote waliounganishwa, na kusababisha usumbufu mkubwa katika michakato na kusababisha kupoteza data muhimu kwa programu zinazotegemea foleni zilizoathiriwa. Kitendo hiki kinaweza pia kutumika kuharibu huduma kwa kuondoa vipengele muhimu vya mfumo.

{% code overflow="wrap" %}
```bash
az storage queue delete --name <queue-name> --account-name <storage-account>
```
{% endcode %}

### DataActions: `Microsoft.Storage/storageAccounts/queueServices/queues/messages/delete`

Kwa ruhusa hii, mshambuliaji anaweza kufuta ujumbe wote kutoka kwa Azure Storage Queue. Kitendo hiki kinafuta ujumbe wote, kinaharibu mchakato wa kazi na kusababisha kupoteza data kwa mifumo inayotegemea foleni.

{% code overflow="wrap" %}
```bash
az storage message clear --queue-name <queue-name> --account-name <storage-account>
```
{% endcode %}

### Actions: `Microsoft.Storage/storageAccounts/queueServices/queues/write`

Ruhusa hii inaruhusu mshambuliaji kuunda au kubadilisha foleni na mali zao ndani ya akaunti ya hifadhi. Inaweza kutumika kuunda foleni zisizoidhinishwa, kubadilisha metadata, au kubadilisha orodha za udhibiti wa ufikiaji (ACLs) ili kutoa au kupunguza ufikiaji. Uwezo huu unaweza kuharibu michakato, kuingiza data mbaya, kuhamasisha taarifa nyeti, au kubadilisha mipangilio ya foleni ili kuwezesha mashambulizi zaidi.

{% code overflow="wrap" %}
```bash
az storage queue create --name <new-queue-name> --account-name <storage-account>

az storage queue metadata update --name <queue-name> --metadata key1=value1 key2=value2 --account-name <storage-account>

az storage queue policy set --name <queue-name> --permissions rwd --expiry 2024-12-31T23:59:59Z --account-name <storage-account>
```
{% endcode %}

## Marejeo

* https://learn.microsoft.com/en-us/azure/storage/queues/storage-powershell-how-to-use-queues
* https://learn.microsoft.com/en-us/rest/api/storageservices/queue-service-rest-api
* https://learn.microsoft.com/en-us/azure/storage/queues/queues-auth-abac-attributes

* Angalia [**mpango wa usajili**](https://github.com/sponsors/carlospolop)!
* **Jiunge na** üí¨ [**kikundi cha Discord**](https://discord.gg/hRep4RUj7f) au [**kikundi cha telegram**](https://t.me/peass) au **tufuatilie** kwenye **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Shiriki mbinu za hacking kwa kuwasilisha PRs kwa** [**HackTricks**](https://github.com/carlospolop/hacktricks) na [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repos za github.

</details>
{% endhint %}
