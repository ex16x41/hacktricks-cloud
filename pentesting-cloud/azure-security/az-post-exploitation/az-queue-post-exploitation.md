# Az - é˜Ÿåˆ—å­˜å‚¨åæœŸåˆ©ç”¨

{% hint style="success" %}
å­¦ä¹ å’Œå®è·µ AWS é»‘å®¢æŠ€æœ¯ï¼š<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks åŸ¹è®­ AWS çº¢é˜Ÿä¸“å®¶ (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
å­¦ä¹ å’Œå®è·µ GCP é»‘å®¢æŠ€æœ¯ï¼š<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks åŸ¹è®­ GCP çº¢é˜Ÿä¸“å®¶ (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>æ”¯æŒ HackTricks</summary>

* æŸ¥çœ‹ [**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**Telegram ç¾¤ç»„**](https://t.me/peass) æˆ– **å…³æ³¨** æˆ‘ä»¬çš„ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub ä»“åº“æäº¤ PR åˆ†äº«é»‘å®¢æŠ€å·§ã€‚

</details>
{% endhint %}

## é˜Ÿåˆ—

æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·æŸ¥çœ‹ï¼š

{% content-ref url="../az-services/az-queue-enum.md" %}
[az-queue-enum.md](../az-services/az-queue-enum.md)
{% endcontent-ref %}

### DataActions: `Microsoft.Storage/storageAccounts/queueServices/queues/messages/read`

æ‹¥æœ‰æ­¤æƒé™çš„æ”»å‡»è€…å¯ä»¥ä» Azure å­˜å‚¨é˜Ÿåˆ—ä¸­æŸ¥çœ‹æ¶ˆæ¯ã€‚è¿™ä½¿å¾—æ”»å‡»è€…èƒ½å¤ŸæŸ¥çœ‹æ¶ˆæ¯çš„å†…å®¹ï¼Œè€Œä¸å°†å…¶æ ‡è®°ä¸ºå·²å¤„ç†æˆ–æ›´æ”¹å…¶çŠ¶æ€ã€‚è¿™å¯èƒ½å¯¼è‡´å¯¹æ•æ„Ÿä¿¡æ¯çš„æœªç»æˆæƒè®¿é—®ï¼Œä»è€Œä½¿æ•°æ®å¤–æ³„æˆ–æ”¶é›†æƒ…æŠ¥ä»¥è¿›è¡Œè¿›ä¸€æ­¥æ”»å‡»ã€‚ 

{% code overflow="wrap" %}
```bash
az storage message peek --queue-name <queue_name> --account-name <storage_account>
```
{% endcode %}

**æ½œåœ¨å½±å“**ï¼šæœªæˆæƒè®¿é—®é˜Ÿåˆ—ã€æ¶ˆæ¯æš´éœ²æˆ–æœªæˆæƒç”¨æˆ·æˆ–æœåŠ¡å¯¹é˜Ÿåˆ—çš„æ“æ§ã€‚

### DataActions: `Microsoft.Storage/storageAccounts/queueServices/queues/messages/process/action`

æ‹¥æœ‰æ­¤æƒé™çš„æ”»å‡»è€…å¯ä»¥ä» Azure å­˜å‚¨é˜Ÿåˆ—ä¸­æ£€ç´¢å’Œå¤„ç†æ¶ˆæ¯ã€‚è¿™æ„å‘³ç€ä»–ä»¬å¯ä»¥è¯»å–æ¶ˆæ¯å†…å®¹å¹¶å°†å…¶æ ‡è®°ä¸ºå·²å¤„ç†ï¼Œä»è€Œæœ‰æ•ˆåœ°å°†å…¶éšè—äºåˆæ³•ç³»ç»Ÿä¹‹å¤–ã€‚è¿™å¯èƒ½å¯¼è‡´æ•æ„Ÿæ•°æ®è¢«æš´éœ²ã€æ¶ˆæ¯å¤„ç†æ–¹å¼çš„ä¸­æ–­ï¼Œç”šè‡³é€šè¿‡ä½¿æ¶ˆæ¯å¯¹å…¶é¢„æœŸç”¨æˆ·ä¸å¯ç”¨è€Œåœæ­¢é‡è¦å·¥ä½œæµç¨‹ã€‚

{% code overflow="wrap" %}
```bash
az storage message get --queue-name <queue_name> --account-name <storage_account>
```
{% endcode %}

### DataActions: `Microsoft.Storage/storageAccounts/queueServices/queues/messages/add/action`

é€šè¿‡æ­¤æƒé™ï¼Œæ”»å‡»è€…å¯ä»¥å‘ Azure å­˜å‚¨é˜Ÿåˆ—æ·»åŠ æ–°æ¶ˆæ¯ã€‚è¿™ä½¿ä»–ä»¬èƒ½å¤Ÿå°†æ¶æ„æˆ–æœªç»æˆæƒçš„æ•°æ®æ³¨å…¥é˜Ÿåˆ—ï¼Œå¯èƒ½è§¦å‘æ„å¤–çš„æ“ä½œæˆ–å¹²æ‰°å¤„ç†æ¶ˆæ¯çš„ä¸‹æ¸¸æœåŠ¡ã€‚

{% code overflow="wrap" %}
```bash
az storage message put --queue-name <queue-name> --content "Injected malicious message" --account-name <storage-account>
```
{% endcode %}

### DataActions: `Microsoft.Storage/storageAccounts/queueServices/queues/messages/write`

æ­¤æƒé™å…è®¸æ”»å‡»è€…åœ¨ Azure å­˜å‚¨é˜Ÿåˆ—ä¸­æ·»åŠ æ–°æ¶ˆæ¯æˆ–æ›´æ–°ç°æœ‰æ¶ˆæ¯ã€‚é€šè¿‡ä½¿ç”¨æ­¤æƒé™ï¼Œä»–ä»¬å¯ä»¥æ’å…¥æœ‰å®³å†…å®¹æˆ–æ›´æ”¹ç°æœ‰æ¶ˆæ¯ï¼Œä»è€Œå¯èƒ½è¯¯å¯¼åº”ç”¨ç¨‹åºæˆ–å¯¼è‡´ä¾èµ–äºè¯¥é˜Ÿåˆ—çš„ç³»ç»Ÿå‡ºç°ä¸è‰¯è¡Œä¸ºã€‚

{% code overflow="wrap" %}
```bash
az storage message put --queue-name <queue-name> --content "Injected malicious message" --account-name <storage-account>

#Update the message
az storage message update --queue-name <queue-name> \
--id <message-id> \
--pop-receipt <pop-receipt> \
--content "Updated message content" \
--visibility-timeout <timeout-in-seconds> \
--account-name <storage-account>
```
{% endcode %}

### Actions: `Microsoft.Storage/storageAccounts/queueServices/queues/delete`

æ­¤æƒé™å…è®¸æ”»å‡»è€…åˆ é™¤å­˜å‚¨å¸æˆ·ä¸­çš„é˜Ÿåˆ—ã€‚é€šè¿‡åˆ©ç”¨æ­¤èƒ½åŠ›ï¼Œæ”»å‡»è€…å¯ä»¥æ°¸ä¹…åˆ é™¤é˜Ÿåˆ—åŠå…¶æ‰€æœ‰ç›¸å…³æ¶ˆæ¯ï¼Œä»è€Œå¯¹å·¥ä½œæµç¨‹é€ æˆé‡å¤§å¹²æ‰°ï¼Œå¹¶å¯¼è‡´ä¾èµ–å—å½±å“é˜Ÿåˆ—çš„åº”ç”¨ç¨‹åºçš„å…³é”®æ•°æ®ä¸¢å¤±ã€‚æ­¤æ“ä½œè¿˜å¯ä»¥é€šè¿‡åˆ é™¤ç³»ç»Ÿçš„åŸºæœ¬ç»„ä»¶æ¥ç ´åæœåŠ¡ã€‚

{% code overflow="wrap" %}
```bash
az storage queue delete --name <queue-name> --account-name <storage-account>
```
{% endcode %}

### DataActions: `Microsoft.Storage/storageAccounts/queueServices/queues/messages/delete`

é€šè¿‡æ­¤æƒé™ï¼Œæ”»å‡»è€…å¯ä»¥æ¸…é™¤ Azure å­˜å‚¨é˜Ÿåˆ—ä¸­çš„æ‰€æœ‰æ¶ˆæ¯ã€‚æ­¤æ“ä½œä¼šåˆ é™¤æ‰€æœ‰æ¶ˆæ¯ï¼Œå¹²æ‰°å·¥ä½œæµç¨‹å¹¶å¯¼è‡´ä¾èµ–äºé˜Ÿåˆ—çš„ç³»ç»Ÿæ•°æ®ä¸¢å¤±ã€‚

{% code overflow="wrap" %}
```bash
az storage message clear --queue-name <queue-name> --account-name <storage-account>
```
{% endcode %}

### Actions: `Microsoft.Storage/storageAccounts/queueServices/queues/write`

æ­¤æƒé™å…è®¸æ”»å‡»è€…åœ¨å­˜å‚¨å¸æˆ·å†…åˆ›å»ºæˆ–ä¿®æ”¹é˜Ÿåˆ—åŠå…¶å±æ€§ã€‚å®ƒå¯ä»¥ç”¨äºåˆ›å»ºæœªç»æˆæƒçš„é˜Ÿåˆ—ã€ä¿®æ”¹å…ƒæ•°æ®æˆ–æ›´æ”¹è®¿é—®æ§åˆ¶åˆ—è¡¨ï¼ˆACLï¼‰ä»¥æˆäºˆæˆ–é™åˆ¶è®¿é—®ã€‚æ­¤èƒ½åŠ›å¯èƒ½ä¼šå¹²æ‰°å·¥ä½œæµç¨‹ã€æ³¨å…¥æ¶æ„æ•°æ®ã€å¤–æ³„æ•æ„Ÿä¿¡æ¯æˆ–æ“çºµé˜Ÿåˆ—è®¾ç½®ä»¥å¯ç”¨è¿›ä¸€æ­¥çš„æ”»å‡»ã€‚

{% code overflow="wrap" %}
```bash
az storage queue create --name <new-queue-name> --account-name <storage-account>

az storage queue metadata update --name <queue-name> --metadata key1=value1 key2=value2 --account-name <storage-account>

az storage queue policy set --name <queue-name> --permissions rwd --expiry 2024-12-31T23:59:59Z --account-name <storage-account>
```
{% endcode %}

## å‚è€ƒæ–‡çŒ®

* https://learn.microsoft.com/en-us/azure/storage/queues/storage-powershell-how-to-use-queues
* https://learn.microsoft.com/en-us/rest/api/storageservices/queue-service-rest-api
* https://learn.microsoft.com/en-us/azure/storage/queues/queues-auth-abac-attributes

{% hint style="success" %}
å­¦ä¹ ä¸å®è·µ AWS é»‘å®¢æŠ€æœ¯ï¼š<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks åŸ¹è®­ AWS çº¢é˜Ÿä¸“å®¶ (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
å­¦ä¹ ä¸å®è·µ GCP é»‘å®¢æŠ€æœ¯ï¼š<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks åŸ¹è®­ GCP çº¢é˜Ÿä¸“å®¶ (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>æ”¯æŒ HackTricks</summary>

* æŸ¥çœ‹ [**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**ç”µæŠ¥ç¾¤ç»„**](https://t.me/peass) æˆ– **åœ¨** **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)** ä¸Šå…³æ³¨æˆ‘ä»¬ã€‚**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ä»“åº“æäº¤ PR æ¥åˆ†äº«é»‘å®¢æŠ€å·§ã€‚

</details>
{% endhint %}
