# Az - Queue Storage Post Exploitation

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Queue

Za viÅ¡e informacija proverite:

{% content-ref url="../az-services/az-queue-enum.md" %}
[az-queue-enum.md](../az-services/az-queue-enum.md)
{% endcontent-ref %}

### DataActions: `Microsoft.Storage/storageAccounts/queueServices/queues/messages/read`

NapadaÄ sa ovom dozvolom moÅ¾e da pogleda poruke iz Azure Storage Queue. Ovo omoguÄ‡ava napadaÄu da vidi sadrÅ¾aj poruka bez oznaÄavanja kao obraÄ‘enih ili menjanja njihovog stanja. To moÅ¾e dovesti do neovlaÅ¡Ä‡enog pristupa osetljivim informacijama, omoguÄ‡avajuÄ‡i eksfiltraciju podataka ili prikupljanje obaveÅ¡tajnih podataka za dalja napada. 

{% code overflow="wrap" %}
```bash
az storage message peek --queue-name <queue_name> --account-name <storage_account>
```
{% endcode %}

**Potencijalni uticaj**: NeovlaÅ¡Ä‡en pristup redu, izlaganje poruka ili manipulacija redom od strane neovlaÅ¡Ä‡enih korisnika ili servisa.

### DataActions: `Microsoft.Storage/storageAccounts/queueServices/queues/messages/process/action`

Sa ovom dozvolom, napadaÄ moÅ¾e da preuzme i obradi poruke iz Azure Storage Queue. To znaÄi da mogu da proÄitaju sadrÅ¾aj poruke i oznaÄe je kao obraÄ‘enu, efikasno je skrivajuÄ‡i od legitimnih sistema. To moÅ¾e dovesti do izlaganja osetljivih podataka, prekida u naÄinu na koji se poruke obraÄ‘uju, ili Äak zaustavljanja vaÅ¾nih radnih tokova ÄineÄ‡i poruke nedostupnim njihovim predviÄ‘enim korisnicima.

{% code overflow="wrap" %}
```bash
az storage message get --queue-name <queue_name> --account-name <storage_account>
```
{% endcode %}

### DataActions: `Microsoft.Storage/storageAccounts/queueServices/queues/messages/add/action`

Sa ovom dozvolom, napadaÄ moÅ¾e dodati nove poruke u Azure Storage Queue. To im omoguÄ‡ava da ubace zlonamerne ili neovlaÅ¡Ä‡ene podatke u red, potencijalno pokreÄ‡uÄ‡i neÅ¾eljene akcije ili ometajuÄ‡i usluge koje obraÄ‘uju poruke.

{% code overflow="wrap" %}
```bash
az storage message put --queue-name <queue-name> --content "Injected malicious message" --account-name <storage-account>
```
{% endcode %}

### DataActions: `Microsoft.Storage/storageAccounts/queueServices/queues/messages/write`

Ova dozvola omoguÄ‡ava napadaÄu da doda nove poruke ili aÅ¾urira postojeÄ‡e u Azure Storage Queue. KoriÅ¡Ä‡enjem ove dozvole, mogli bi umetnuti Å¡tetan sadrÅ¾aj ili izmeniti postojeÄ‡e poruke, potencijalno obmanjujuÄ‡i aplikacije ili uzrokujuÄ‡i neÅ¾eljeno ponaÅ¡anje u sistemima koji se oslanjaju na red. 

{% code overflow="wrap" %}
```bash
az storage message put --queue-name <queue-name> --content "Injected malicious message" --account-name <storage-account>

#Update the message
az storage message update --queue-name <queue-name> \
--id <message-id> \
--pop-receipt <pop-receipt> \
--content "Updated message content" \
--visibility-timeout <timeout-in-seconds> \
--account-name <storage-account>
```
{% endcode %}

### Akcije: `Microsoft.Storage/storageAccounts/queueServices/queues/delete`

Ova dozvola omoguÄ‡ava napadaÄu da obriÅ¡e redove unutar naloga za skladiÅ¡tenje. KoriÅ¡Ä‡enjem ove sposobnosti, napadaÄ moÅ¾e trajno ukloniti redove i sve njihove povezane poruke, uzrokujuÄ‡i znaÄajne prekide u radnim tokovima i rezultirajuÄ‡i kritiÄnim gubitkom podataka za aplikacije koje se oslanjaju na pogoÄ‘ene redove. Ova akcija se takoÄ‘e moÅ¾e koristiti za sabotiranje usluga uklanjanjem bitnih komponenti sistema.

{% code overflow="wrap" %}
```bash
az storage queue delete --name <queue-name> --account-name <storage-account>
```
{% endcode %}

### DataActions: `Microsoft.Storage/storageAccounts/queueServices/queues/messages/delete`

Sa ovom dozvolom, napadaÄ moÅ¾e da obriÅ¡e sve poruke iz Azure Storage Queue. Ova akcija uklanja sve poruke, ometajuÄ‡i radne tokove i uzrokujuÄ‡i gubitak podataka za sisteme koji zavise od reda. 

{% code overflow="wrap" %}
```bash
az storage message clear --queue-name <queue-name> --account-name <storage-account>
```
{% endcode %}

### Akcije: `Microsoft.Storage/storageAccounts/queueServices/queues/write`

Ova dozvola omoguÄ‡ava napadaÄu da kreira ili menja redove i njihove osobine unutar naloga za skladiÅ¡tenje. MoÅ¾e se koristiti za kreiranje neovlaÅ¡Ä‡enih redova, modifikovanje metapodataka ili promenu lista kontrole pristupa (ACL) kako bi se omoguÄ‡io ili ograniÄio pristup. Ova sposobnost moÅ¾e ometati radne tokove, ubrizgati zlonamerne podatke, eksfiltrirati osetljive informacije ili manipulisati podeÅ¡avanjima reda kako bi se omoguÄ‡ili dalji napadi.

{% code overflow="wrap" %}
```bash
az storage queue create --name <new-queue-name> --account-name <storage-account>

az storage queue metadata update --name <queue-name> --metadata key1=value1 key2=value2 --account-name <storage-account>

az storage queue policy set --name <queue-name> --permissions rwd --expiry 2024-12-31T23:59:59Z --account-name <storage-account>
```
{% endcode %}

## Reference

* https://learn.microsoft.com/en-us/azure/storage/queues/storage-powershell-how-to-use-queues
* https://learn.microsoft.com/en-us/rest/api/storageservices/queue-service-rest-api
* https://learn.microsoft.com/en-us/azure/storage/queues/queues-auth-abac-attributes

{% hint style="success" %}
UÄite i veÅ¾bajte AWS Hacking:<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
UÄite i veÅ¾bajte GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>PodrÅ¾ite HackTricks</summary>

* Proverite [**planove pretplate**](https://github.com/sponsors/carlospolop)!
* **PridruÅ¾ite se** ğŸ’¬ [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili **pratite** nas na **Twitteru** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Podelite hakerske trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
{% endhint %}
