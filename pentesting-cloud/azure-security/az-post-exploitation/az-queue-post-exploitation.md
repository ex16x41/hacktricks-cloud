# Az - Queue Storage Post Exploitation

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Queue

Aby uzyskaÄ‡ wiÄ™cej informacji, sprawdÅº:

{% content-ref url="../az-services/az-queue-enum.md" %}
[az-queue-enum.md](../az-services/az-queue-enum.md)
{% endcontent-ref %}

### DataActions: `Microsoft.Storage/storageAccounts/queueServices/queues/messages/read`

AtakujÄ…cy z tym uprawnieniem moÅ¼e podglÄ…daÄ‡ wiadomoÅ›ci z Azure Storage Queue. UmoÅ¼liwia to atakujÄ…cemu przeglÄ…danie treÅ›ci wiadomoÅ›ci bez oznaczania ich jako przetworzonych lub zmieniania ich stanu. MoÅ¼e to prowadziÄ‡ do nieautoryzowanego dostÄ™pu do wraÅ¼liwych informacji, umoÅ¼liwiajÄ…c eksfiltracjÄ™ danych lub zbieranie informacji wywiadowczych do dalszych atakÃ³w.

{% code overflow="wrap" %}
```bash
az storage message peek --queue-name <queue_name> --account-name <storage_account>
```
{% endcode %}

**Potencjalny wpÅ‚yw**: Nieautoryzowany dostÄ™p do kolejki, ujawnienie wiadomoÅ›ci lub manipulacja kolejkÄ… przez nieautoryzowanych uÅ¼ytkownikÃ³w lub usÅ‚ugi.

### DataActions: `Microsoft.Storage/storageAccounts/queueServices/queues/messages/process/action`

DziÄ™ki temu uprawnieniu, atakujÄ…cy moÅ¼e pobieraÄ‡ i przetwarzaÄ‡ wiadomoÅ›ci z Azure Storage Queue. Oznacza to, Å¼e mogÄ… odczytaÄ‡ treÅ›Ä‡ wiadomoÅ›ci i oznaczyÄ‡ jÄ… jako przetworzonÄ…, skutecznie ukrywajÄ…c jÄ… przed legalnymi systemami. MoÅ¼e to prowadziÄ‡ do ujawnienia wraÅ¼liwych danych, zakÅ‚Ã³ceÅ„ w sposobie obsÅ‚ugi wiadomoÅ›ci, a nawet zatrzymania waÅ¼nych procesÃ³w, czyniÄ…c wiadomoÅ›ci niedostÄ™pnymi dla ich zamierzonych uÅ¼ytkownikÃ³w.

{% code overflow="wrap" %}
```bash
az storage message get --queue-name <queue_name> --account-name <storage_account>
```
{% endcode %}

### DataActions: `Microsoft.Storage/storageAccounts/queueServices/queues/messages/add/action`

DziÄ™ki temu uprawnieniu, atakujÄ…cy moÅ¼e dodaÄ‡ nowe wiadomoÅ›ci do kolejki Azure Storage. UmoÅ¼liwia to wstrzykiwanie zÅ‚oÅ›liwych lub nieautoryzowanych danych do kolejki, co moÅ¼e wywoÅ‚aÄ‡ niezamierzone dziaÅ‚ania lub zakÅ‚Ã³ciÄ‡ dziaÅ‚anie usÅ‚ug przetwarzajÄ…cych wiadomoÅ›ci.

{% code overflow="wrap" %}
```bash
az storage message put --queue-name <queue-name> --content "Injected malicious message" --account-name <storage-account>
```
{% endcode %}

### DataActions: `Microsoft.Storage/storageAccounts/queueServices/queues/messages/write`

To uprawnienie pozwala atakujÄ…cemu na dodawanie nowych wiadomoÅ›ci lub aktualizowanie istniejÄ…cych w Azure Storage Queue. UÅ¼ywajÄ…c tego, mogÄ… wprowadzaÄ‡ szkodliwe treÅ›ci lub zmieniaÄ‡ istniejÄ…ce wiadomoÅ›ci, co moÅ¼e wprowadzaÄ‡ w bÅ‚Ä…d aplikacje lub powodowaÄ‡ niepoÅ¼Ä…dane zachowania w systemach, ktÃ³re polegajÄ… na kolejce.

{% code overflow="wrap" %}
```bash
az storage message put --queue-name <queue-name> --content "Injected malicious message" --account-name <storage-account>

#Update the message
az storage message update --queue-name <queue-name> \
--id <message-id> \
--pop-receipt <pop-receipt> \
--content "Updated message content" \
--visibility-timeout <timeout-in-seconds> \
--account-name <storage-account>
```
{% endcode %}

### Actions: `Microsoft.Storage/storageAccounts/queueServices/queues/delete`

To uprawnienie pozwala atakujÄ…cemu na usuniÄ™cie kolejek w ramach konta magazynowego. WykorzystujÄ…c tÄ™ zdolnoÅ›Ä‡, atakujÄ…cy moÅ¼e trwale usunÄ…Ä‡ kolejki i wszystkie ich powiÄ…zane wiadomoÅ›ci, co powoduje znaczÄ…ce zakÅ‚Ã³cenia w przepÅ‚ywie pracy i prowadzi do krytycznej utraty danych dla aplikacji, ktÃ³re polegajÄ… na dotkniÄ™tych kolejkach. Ta akcja moÅ¼e byÄ‡ rÃ³wnieÅ¼ uÅ¼ywana do sabotaÅ¼u usÅ‚ug poprzez usuniÄ™cie istotnych komponentÃ³w systemu.

{% code overflow="wrap" %}
```bash
az storage queue delete --name <queue-name> --account-name <storage-account>
```
{% endcode %}

### DataActions: `Microsoft.Storage/storageAccounts/queueServices/queues/messages/delete`

DziÄ™ki temu uprawnieniu, atakujÄ…cy moÅ¼e usunÄ…Ä‡ wszystkie wiadomoÅ›ci z kolejki Azure Storage. Ta akcja usuwa wszystkie wiadomoÅ›ci, zakÅ‚Ã³cajÄ…c przepÅ‚ywy pracy i powodujÄ…c utratÄ™ danych dla systemÃ³w zaleÅ¼nych od kolejki.

{% code overflow="wrap" %}
```bash
az storage message clear --queue-name <queue-name> --account-name <storage-account>
```
{% endcode %}

### DziaÅ‚ania: `Microsoft.Storage/storageAccounts/queueServices/queues/write`

To uprawnienie pozwala atakujÄ…cemu na tworzenie lub modyfikowanie kolejek i ich wÅ‚aÅ›ciwoÅ›ci w ramach konta magazynu. MoÅ¼e byÄ‡ uÅ¼ywane do tworzenia nieautoryzowanych kolejek, modyfikowania metadanych lub zmiany list kontroli dostÄ™pu (ACL), aby przyznaÄ‡ lub ograniczyÄ‡ dostÄ™p. Ta zdolnoÅ›Ä‡ moÅ¼e zakÅ‚Ã³caÄ‡ przepÅ‚ywy pracy, wstrzykiwaÄ‡ zÅ‚oÅ›liwe dane, eksfiltrujÄ…c wraÅ¼liwe informacje lub manipulowaÄ‡ ustawieniami kolejek, aby umoÅ¼liwiÄ‡ dalsze ataki.

{% code overflow="wrap" %}
```bash
az storage queue create --name <new-queue-name> --account-name <storage-account>

az storage queue metadata update --name <queue-name> --metadata key1=value1 key2=value2 --account-name <storage-account>

az storage queue policy set --name <queue-name> --permissions rwd --expiry 2024-12-31T23:59:59Z --account-name <storage-account>
```
{% endcode %}

## Odniesienia

* https://learn.microsoft.com/en-us/azure/storage/queues/storage-powershell-how-to-use-queues
* https://learn.microsoft.com/en-us/rest/api/storageservices/queue-service-rest-api
* https://learn.microsoft.com/en-us/azure/storage/queues/queues-auth-abac-attributes

{% hint style="success" %}
Ucz siÄ™ i Ä‡wicz Hacking AWS:<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
Ucz siÄ™ i Ä‡wicz Hacking GCP: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Wsparcie HackTricks</summary>

* SprawdÅº [**plany subskrypcyjne**](https://github.com/sponsors/carlospolop)!
* **DoÅ‚Ä…cz do** ğŸ’¬ [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **Å›ledÅº** nas na **Twitterze** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Dziel siÄ™ trikami hackingowymi, przesyÅ‚ajÄ…c PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repozytoriÃ³w github.

</details>
{% endhint %}
