# Az - Blob Depolama

<details>

<summary><strong>SÄ±fÄ±rdan kahraman olmak iÃ§in AWS hackleme Ã¶ÄŸrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ±)</strong></a><strong>!</strong></summary>

HackTricks'Ä± desteklemenin diÄŸer yollarÄ±:

* **Åirketinizi HackTricks'te reklamÄ±nÄ±zÄ± gÃ¶rmek istiyorsanÄ±z** veya **HackTricks'i PDF olarak indirmek istiyorsanÄ±z** [**ABONELÄ°K PLANLARI**]'na(https://github.com/sponsors/carlospolop) gÃ¶z atÄ±n!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nleri**](https://peass.creator-spring.com) edinin
* [**PEASS Ailesi'ni**](https://opensea.io/collection/the-peass-family) keÅŸfedin, Ã¶zel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuz
* **KatÄ±lÄ±n** ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) veya bizi **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**'da takip edin.**
* **Hacking pÃ¼f noktalarÄ±nÄ±zÄ± gÃ¶ndererek HackTricks** ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks) github depolarÄ±na PR'lar gÃ¶nderin.

</details>

## Temel Bilgiler

[Belgelerden:](https://learn.microsoft.com/en-us/azure/storage/blobs/storage-blobs-overview) Azure Blob depolama, Microsoft'un bulut iÃ§in nesne **depolama Ã§Ã¶zÃ¼mÃ¼dÃ¼r**. Blob depolama, yapÄ±landÄ±rÄ±lmamÄ±ÅŸ verilerin bÃ¼yÃ¼k miktarlarda depolanmasÄ± iÃ§in optimize edilmiÅŸtir. YapÄ±landÄ±rÄ±lmamÄ±ÅŸ veriler, metin veya ikili veriler gibi belirli bir veri modeline veya tanÄ±mÄ±na uymayan verilerdir.

Blob depolama Ã¼Ã§ tÃ¼r kaynak sunar:

* **Depolama hesabÄ±** (benzersiz ad)
* Depolama hesabÄ±ndaki bir **konteyner** (klasÃ¶r)
* Bir konteynerdeki bir **blob**

<figure><img src="../../../.gitbook/assets/image (114).png" alt=""><figcaption></figcaption></figure>

### FarklÄ± depolama tÃ¼rleri

| **Blob depolama**                | <p><code>https://&#x3C;depolama-hesabÄ±>.blob.core.windows.net</code><br><br><code>https://&#x3C;stg-acc>.blob.core.windows.net/&#x3C;container-adÄ±>?restype=container&#x26;comp=list</code></p> |
| -------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| **Azure Data Lake Depolama Gen2** | `https://<depolama-hesabÄ±>.dfs.core.windows.net`                                                                                                                                                 |
| **Azure DosyalarÄ±**              | `https://<depolama-hesabÄ±>.file.core.windows.net`                                                                                                                                                |
| **Kuyruk depolama**              | `https://<depolama-hesabÄ±>.queue.core.windows.net`                                                                                                                                               |
| **Tablo depolama**               | `https://<depolama-hesabÄ±>.table.core.windows.net`                                                                                                                                               |

### Depolamaya EriÅŸim <a href="#about-blob-storage" id="about-blob-storage"></a>

* **RBAC rolleri** ile Azure AD prensiplerini kullanÄ±n.
* **EriÅŸim AnahtarlarÄ±**: Depolama hesabÄ±nÄ±n eriÅŸim anahtarlarÄ±nÄ± kullanÄ±n. Bu, depolama hesabÄ±na **tam eriÅŸim saÄŸlar.**
* **PaylaÅŸÄ±lan EriÅŸim Ä°mzasÄ±** (SAS): **Zaman** **sÄ±nÄ±rlÄ±** ve belirli izinler.
* Bir **eriÅŸim anahtarÄ±** ile SAS URL'si oluÅŸturabilirsiniz (tespit etmesi daha karmaÅŸÄ±ktÄ±r).
* SAS, eriÅŸim anahtarÄ±ndan oluÅŸturulduÄŸundan, yenilendiÄŸinde SAS Ã§alÄ±ÅŸmayÄ± durdurur.

### Kamu Maruziyeti

"EriÅŸime Ä°zin Ver Blob genel eriÅŸim" **etkinleÅŸtirilmiÅŸse** (varsayÄ±lan olarak devre dÄ±ÅŸÄ± bÄ±rakÄ±lmÄ±ÅŸ), ÅŸunlarÄ± yapabilirsiniz:

* **BloblarÄ± okumak iÃ§in genel eriÅŸim** saÄŸlayÄ±n (adlarÄ±nÄ± bilmelisiniz).
* **Konteyner bloblarÄ±nÄ± listeleyin** ve **okuyun**.

### Depolamaya BaÄŸlanma

Herhangi bir **depolama** bulursanÄ±z, baÄŸlanmak iÃ§in [**Microsoft Azure Storage Explorer**](https://azure.microsoft.com/es-es/products/storage/storage-explorer/) aracÄ±nÄ± kullanabilirsiniz.

## SAS URL'leri

[Belgelerden:](https://learn.microsoft.com/en-us/azure/storage/common/storage-sas-overview) PaylaÅŸÄ±lan eriÅŸim imzasÄ± (SAS), depolama hesabÄ±nÄ±zdaki kaynaklara gÃ¼venli yetkilendirilmiÅŸ eriÅŸim saÄŸlar. Bir SAS ile bir istemcinin verilerinize nasÄ±l eriÅŸebileceÄŸi konusunda ayrÄ±ntÄ±lÄ± kontrolÃ¼nÃ¼z olur. Ã–rneÄŸin:

* Ä°stemcinin hangi kaynaklara eriÅŸebileceÄŸi.
* Bu kaynaklara hangi izinlere sahip olduklarÄ±.
* SAS'nin ne kadar sÃ¼re geÃ§erli olduÄŸu.

Bir SAS URL'si ÅŸu ÅŸekilde gÃ¶rÃ¼nÃ¼r: **`https://<konteyner_adÄ±>.blob.core.windows.net/yenikonteyner?sp=r&st=2021-09-26T18:15:21Z&se=2021-10-27T02:14:21Z&spr=https&sv=2021-07-08&sr=c&sig=7S%2BZySOgy4aA3Dk0V1cJyTSIf1cW%2Fu3WFkhHV32%2B4PE%3D`**

Verilere eriÅŸmek iÃ§in [**Storage Explorer**](https://azure.microsoft.com/en-us/features/storage-explorer/) veya python kullanÄ±n:

{% code overflow="wrap" %}
```python
#pip3 install azure-storage-blob
from azure.storage.blob import BlobServiceClient

# List containers
conn_str="<SAS URL>"
svc = BlobServiceClient.from_connection_string(conn_str=conn_str)
for c in svc.list_containers():
print(c['name'])

# List blobs inside the containers
container = svc.get_container_client(container=c['name'])

for b in container.list_blobs():
print(b['name'])


# Download all the blobs
blob_name = b['name'].split("/")[::-1][0]
blob = svc.get_blob_client(container=c['name'],blob=b['name'])
with open(blob_name,"wb") as f:
f.write(blob.download_blob().readall())
```
{% endcode %}

### KullanÄ±cÄ± vekilliÄŸi SAS <a href="#user-delegation-sas" id="user-delegation-sas"></a>

Bir **paylaÅŸÄ±lan eriÅŸim imzasÄ± (SAS)** belirli bir Azure Depolama hizmeti olan bir konteyner, dizin veya blob'a eriÅŸim iÃ§in ya Azure Active Directory (Azure AD) **kimlik bilgileri ya da bir hesap anahtarÄ±** kullanarak gÃ¼venli hale getirebilirsiniz. Bir kullanÄ±cÄ± vekilliÄŸi SAS oluÅŸturmak iÃ§in Ã¶nce bir **kullanÄ±cÄ± vekilliÄŸi anahtarÄ±** talep etmeniz ve ardÄ±ndan SAS'Ä± imzalamak iÃ§in bu anahtarÄ± kullanmanÄ±z gerekir.

**Azure Blob Storage** ve **Azure Data Lake Storage Gen2** hem **KullanÄ±cÄ± VekilliÄŸi PaylaÅŸÄ±lan EriÅŸim Ä°mzasÄ± (SAS)** iÃ§in destek saÄŸlar. Ancak, **Saklanan EriÅŸim Ä°lke**'lerinin KullanÄ±cÄ± VekilliÄŸi SAS ile uyumlu olmadÄ±ÄŸÄ±nÄ± unutmamak Ã¶nemlidir.

KullanÄ±cÄ± vekilliÄŸi SAS'Ä±n **Azure AD kimlik bilgileri ile gÃ¼vence altÄ±na alÄ±ndÄ±ÄŸÄ±nÄ± ve depolama hesabÄ± anahtarlarÄ± yerine** kullanÄ±ldÄ±ÄŸÄ±nÄ± unutmayÄ±n. Bu, istemcilerin/uygulamalarÄ±n SAS oluÅŸturmak iÃ§in depolama anahtarlarÄ±nÄ± saklamasÄ±nÄ±/geri almasÄ±nÄ± engeller.

### Hizmet SAS

Bir hizmet SAS'Ä± **depolama hesabÄ± anahtarÄ±** ile gÃ¼vence altÄ±na alÄ±nÄ±r. Bir hizmet SAS'Ä± yalnÄ±zca bir Azure Depolama hizmetindeki bir kaynaÄŸa eriÅŸimi vekil eder: Blob depolama, Kuyruk depolama, Tablo depolama veya Azure DosyalarÄ±. Bir hizmet dÃ¼zeyinde SAS iÃ§in URI, SAS'Ä±n eriÅŸimi vekil edeceÄŸi kaynaÄŸÄ±n URI'sini ve ardÄ±ndan SAS belirtecinin bulunduÄŸu bir yapÄ±ya sahiptir.

Bir **konteyner** veya **blob** iÃ§in SAS'Ä± gÃ¼vence altÄ±na almak iÃ§in Azure Active Directory (Azure AD) kimlik bilgilerini kullanmak iÃ§in bir **kullanÄ±cÄ± vekilliÄŸi SAS**'Ä± kullanÄ±n.

### Hesap SAS

Bir hesap SAS'Ä± biri **depolama hesabÄ± anahtarlarÄ±ndan** (ikisi var) biri ile gÃ¼vence altÄ±na alÄ±nÄ±r. Bir hesap SAS'Ä± bir veya daha fazla depolama hizmetindeki kaynaklara eriÅŸimi vekil eder. Bir hizmet veya kullanÄ±cÄ± vekilliÄŸi SAS ile mevcut olan tÃ¼m iÅŸlemler, bir hesap SAS'Ä± ile de mevcuttur.

[dokÃ¼mandan:](https://learn.microsoft.com/en-us/rest/api/storageservices/create-account-sas) Bir hesap SAS'Ä± oluÅŸturarak ÅŸunlarÄ± yapabilirsiniz:

* `Get/Set Service Properties` ve `Get Service Stats` gibi ÅŸu anda hizmete Ã¶zgÃ¼ bir SAS ile mevcut olmayan hizmet dÃ¼zeyi iÅŸlemlere eriÅŸimi vekil edin.
* Bir hesap SAS'Ä± kullanarak aynÄ± anda bir depolama hesabÄ±ndaki birden fazla hizmete eriÅŸimi vekil edin. Ã–rneÄŸin, Azure Blob Storage ve Azure DosyalarÄ±'ndaki kaynaklara eriÅŸimi bir hesap SAS'Ä± kullanarak vekil edebilirsiniz.
* Bir nesneye Ã¶zgÃ¼ SAS ile mevcut olmayan konteynerler, kuyruklar, tablolar ve dosya paylaÅŸÄ±mlarÄ± iÃ§in yazma ve silme iÅŸlemlerine eriÅŸimi vekil edin.
* Kabul edilecek istekler iÃ§in bir IP adresi veya IP adreslerinin bir aralÄ±ÄŸÄ±nÄ± belirtin.
* Kabul edilecek HTTP protokolÃ¼nÃ¼ belirtin (yalnÄ±zca HTTPS veya HTTP/HTTPS). 

## NumaralandÄ±rma

{% tabs %}
{% tab title="az cli" %}
{% code overflow="wrap" %}
```bash
# Get storage accounts
az storage account list #Get the account name from here

# Get keys to authenticate
az storage account keys list --account-name <name>

# Get shares
az storage share list --account-name <name> --account-key <key>

# Get dirs/files inside the share
az storage file list --account-name <name> --share-name <share-name> --account-key <key>
## If type is "dir", you can continue enumerationg files inside of it
az storage file list --account-name <name> --share-name <prev_dir/share-name> --account-key <key>

# Download a complete share (with directories and files inside of them)
az storage file download-batch -d . --source <share-name> --account-name <name> --account-key <key>
```
{% endcode %}
{% endtab %}

{% tab title="Az PowerShell" %}
{% code overflow="wrap" %}
```powershell
# Get storage accounts
Get-AzStorageAccount | fl
# Get rules to access the storage account
Get-AzStorageAccount | select -ExpandProperty NetworkRuleSet
# Get IPs
(Get-AzStorageAccount | select -ExpandProperty NetworkRuleSet).IPRules
# Get containers of a storage account
Get-AzStorageContainer -Context (Get-AzStorageAccount -name <NAME> -ResourceGroupName <NAME>).context
# Get blobs inside container
Get-AzStorageBlob -Container epbackup-planetary -Context (Get-AzStorageAccount -name <name> -ResourceGroupName <name>).context
# Get a blob from a container
Get-AzStorageBlobContent -Container <NAME> -Context (Get-AzStorageAccount -name <NAME> -ResourceGroupName <NAME>).context -Blob <blob_name> -Destination .\Desktop\filename.txt
```
## Referanslar

* [https://learn.microsoft.com/en-us/azure/storage/blobs/storage-blobs-introduction](https://learn.microsoft.com/en-us/azure/storage/blobs/storage-blobs-introduction)
* [https://learn.microsoft.com/en-us/azure/storage/common/storage-sas-overview](https://learn.microsoft.com/en-us/azure/storage/common/storage-sas-overview)

<details>

<summary><strong>SÄ±fÄ±rdan kahraman olmaya kadar AWS hackleme Ã¶ÄŸrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

HackTricks'Ä± desteklemenin diÄŸer yollarÄ±:

* **Åirketinizi HackTricks'te reklamÄ±nÄ± gÃ¶rmek istiyorsanÄ±z** veya **HackTricks'i PDF olarak indirmek istiyorsanÄ±z** [**ABONELÄ°K PLANLARI**](https://github.com/sponsors/carlospolop)'na gÃ¶z atÄ±n!
* [**Resmi PEASS & HackTricks Ã¼rÃ¼nlerini**](https://peass.creator-spring.com) edinin
* [**The PEASS Family'yi**](https://opensea.io/collection/the-peass-family) keÅŸfedin, Ã¶zel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuz
* **ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n veya bizi **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)'da **takip edin**.
* **Hacking pÃ¼f noktalarÄ±nÄ±zÄ± paylaÅŸarak PR'ler gÃ¶ndererek** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na katkÄ±da bulunun.

</details>
