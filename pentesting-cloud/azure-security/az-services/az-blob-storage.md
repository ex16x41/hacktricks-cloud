# Az - Blob Storage

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Basic Information

[From the docs:](https://learn.microsoft.com/en-us/azure/storage/blobs/storage-blobs-overview) Î¤Î¿ Azure Blob storage ÎµÎ¯Î½Î±Î¹ Î· Î»ÏÏƒÎ· **Î±Ï€Î¿Î¸Î®ÎºÎµÏ…ÏƒÎ·Ï‚ Î±Î½Ï„Î¹ÎºÎµÎ¹Î¼Î­Î½Ï‰Î½ Ï„Î·Ï‚ Microsoft Î³Î¹Î± Ï„Î¿ cloud**. Î— Î±Ï€Î¿Î¸Î®ÎºÎµÏ…ÏƒÎ· Blob ÎµÎ¯Î½Î±Î¹ Î²ÎµÎ»Ï„Î¹ÏƒÏ„Î¿Ï€Î¿Î¹Î·Î¼Î­Î½Î· Î³Î¹Î± Ï„Î·Î½ Î±Ï€Î¿Î¸Î®ÎºÎµÏ…ÏƒÎ· Ï„ÎµÏÎ¬ÏƒÏ„Î¹Ï‰Î½ Ï€Î¿ÏƒÎ¿Ï„Î®Ï„Ï‰Î½ Î¼Î· Î´Î¿Î¼Î·Î¼Î­Î½Ï‰Î½ Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½. Î¤Î± Î¼Î· Î´Î¿Î¼Î·Î¼Î­Î½Î± Î´ÎµÎ´Î¿Î¼Î­Î½Î± ÎµÎ¯Î½Î±Î¹ Î´ÎµÎ´Î¿Î¼Î­Î½Î± Ï€Î¿Ï… Î´ÎµÎ½ Î±ÎºÎ¿Î»Î¿Ï…Î¸Î¿ÏÎ½ Î­Î½Î± ÏƒÏ…Î³ÎºÎµÎºÏÎ¹Î¼Î­Î½Î¿ Î¼Î¿Î½Ï„Î­Î»Î¿ Î® Î¿ÏÎ¹ÏƒÎ¼ÏŒ Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½, ÏŒÏ€Ï‰Ï‚ ÎºÎµÎ¯Î¼ÎµÎ½Î¿ Î® Î´Ï…Î±Î´Î¹ÎºÎ¬ Î´ÎµÎ´Î¿Î¼Î­Î½Î±.

Î— Î±Ï€Î¿Î¸Î®ÎºÎµÏ…ÏƒÎ· Blob Ï€ÏÎ¿ÏƒÏ†Î­ÏÎµÎ¹ Ï„ÏÎµÎ¹Ï‚ Ï„ÏÏ€Î¿Ï…Ï‚ Ï€ÏŒÏÏ‰Î½:

* ÎŸ **Î»Î¿Î³Î±ÏÎ¹Î±ÏƒÎ¼ÏŒÏ‚ Î±Ï€Î¿Î¸Î®ÎºÎµÏ…ÏƒÎ·Ï‚** (Î¼Î¿Î½Î±Î´Î¹ÎºÏŒ ÏŒÎ½Î¿Î¼Î±)
* ÎˆÎ½Î± **Î´Î¿Ï‡ÎµÎ¯Î¿** ÏƒÏ„Î¿Î½ Î»Î¿Î³Î±ÏÎ¹Î±ÏƒÎ¼ÏŒ Î±Ï€Î¿Î¸Î®ÎºÎµÏ…ÏƒÎ·Ï‚ (Ï†Î¬ÎºÎµÎ»Î¿Ï‚)
* ÎˆÎ½Î± **blob** ÏƒÎµ Î­Î½Î± Î´Î¿Ï‡ÎµÎ¯Î¿

<figure><img src="../../../.gitbook/assets/image (114).png" alt=""><figcaption></figcaption></figure>

### Different types of storage

| **Blob storage**                 | <p><code>https://&#x3C;storage-account>.blob.core.windows.net</code><br><br><code>https://&#x3C;stg-acc>.blob.core.windows.net/&#x3C;container-name>?restype=container&#x26;comp=list</code></p> |
| -------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| **Azure Data Lake Storage Gen2** | `https://<storage-account>.dfs.core.windows.net`                                                                                                                                                 |
| **Azure Files**                  | `https://<storage-account>.file.core.windows.net`                                                                                                                                                |
| **Queue storage**                | `https://<storage-account>.queue.core.windows.net`                                                                                                                                               |
| **Table storage**                | `https://<storage-account>.table.core.windows.net`                                                                                                                                               |

### Access to Storage <a href="#about-blob-storage" id="about-blob-storage"></a>

* Î§ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î®ÏƒÏ„Îµ Ï„Î¿Ï…Ï‚ ÎºÏÏÎ¹Î¿Ï…Ï‚ Azure AD Î¼Î­ÏƒÏ‰ **ÏÏŒÎ»Ï‰Î½ RBAC** Ï€Î¿Ï… Ï…Ï€Î¿ÏƒÏ„Î·ÏÎ¯Î¶Î¿Î½Ï„Î±Î¹.
* **Access Keys**: Î§ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î®ÏƒÏ„Îµ Ï„Î± ÎºÎ»ÎµÎ¹Î´Î¹Î¬ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ·Ï‚ Ï„Î¿Ï… Î»Î¿Î³Î±ÏÎ¹Î±ÏƒÎ¼Î¿Ï Î±Ï€Î¿Î¸Î®ÎºÎµÏ…ÏƒÎ·Ï‚. Î‘Ï…Ï„ÏŒ Ï€Î±ÏÎ­Ï‡ÎµÎ¹ **Ï€Î»Î®ÏÎ· Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ· ÏƒÏ„Î¿Î½ Î»Î¿Î³Î±ÏÎ¹Î±ÏƒÎ¼ÏŒ Î±Ï€Î¿Î¸Î®ÎºÎµÏ…ÏƒÎ·Ï‚.**
* **Shared Access Signature** (SAS): **Î ÎµÏÎ¹Î¿ÏÎ¹ÏƒÎ¼Î­Î½Î¿Ï‚** **Ï‡ÏÏŒÎ½Î¿Ï‚** ÎºÎ±Î¹ ÏƒÏ…Î³ÎºÎµÎºÏÎ¹Î¼Î­Î½ÎµÏ‚ Î¬Î´ÎµÎ¹ÎµÏ‚.
* ÎœÏ€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î®ÏƒÎµÏ„Îµ Î­Î½Î± URL SAS Î¼Îµ Î­Î½Î± **access key** (Ï€Î¹Î¿ Ï€ÎµÏÎ¯Ï€Î»Î¿ÎºÎ¿ Î½Î± Î±Î½Î¹Ï‡Î½ÎµÏ…Î¸ÎµÎ¯).
* ÎšÎ±Î¸ÏÏ‚ Ï„Î¿ SAS Î´Î·Î¼Î¹Î¿Ï…ÏÎ³ÎµÎ¯Ï„Î±Î¹ Î±Ï€ÏŒ Ï„Î¿ access key, Î±Î½ Î±Î½Î±Î½ÎµÏ‰Î¸ÎµÎ¯, Ï„Î¿ SAS ÏƒÏ„Î±Î¼Î±Ï„Î¬ Î½Î± Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³ÎµÎ¯.

### Public Exposure

Î•Î¬Î½ Î· "Î•Ï€Î¹Ï„ÏÎ­ÏˆÏ„Îµ Î´Î·Î¼ÏŒÏƒÎ¹Î± Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ· ÏƒÎµ Blob" ÎµÎ¯Î½Î±Î¹ **ÎµÎ½ÎµÏÎ³Î¿Ï€Î¿Î¹Î·Î¼Î­Î½Î·** (Î±Ï€ÎµÎ½ÎµÏÎ³Î¿Ï€Î¿Î¹Î·Î¼Î­Î½Î· Î±Ï€ÏŒ Ï€ÏÎ¿ÎµÏ€Î¹Î»Î¿Î³Î®), ÎµÎ¯Î½Î±Î¹ Î´Ï…Î½Î±Ï„ÏŒÎ½ Î½Î±:

* Î”ÏÏƒÎµÏ„Îµ **Î´Î·Î¼ÏŒÏƒÎ¹Î± Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ· Î³Î¹Î± Î±Î½Î¬Î³Î½Ï‰ÏƒÎ· blobs** (Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± Î³Î½Ï‰ÏÎ¯Î¶ÎµÏ„Îµ Ï„Î¿ ÏŒÎ½Î¿Î¼Î±).
* **Î›Î¯ÏƒÏ„Î± blobs Î´Î¿Ï‡ÎµÎ¯Î¿Ï…** ÎºÎ±Î¹ **Î½Î± Ï„Î± Î´Î¹Î±Î²Î¬ÏƒÎµÏ„Îµ**.

### Connect to Storage

Î•Î¬Î½ Î²ÏÎµÎ¯Ï„Îµ Î¿Ï€Î¿Î¹Î±Î´Î®Ï€Î¿Ï„Îµ **Î±Ï€Î¿Î¸Î®ÎºÎµÏ…ÏƒÎ·** ÏƒÏ„Î·Î½ Î¿Ï€Î¿Î¯Î± Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± ÏƒÏ…Î½Î´ÎµÎ¸ÎµÎ¯Ï„Îµ, Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î®ÏƒÎµÏ„Îµ Ï„Î¿ ÎµÏÎ³Î±Î»ÎµÎ¯Î¿ [**Microsoft Azure Storage Explorer**](https://azure.microsoft.com/es-es/products/storage/storage-explorer/) Î³Î¹Î± Î½Î± Ï„Î¿ ÎºÎ¬Î½ÎµÏ„Îµ Î±Ï…Ï„ÏŒ.

## SAS URLs

[From the docs:](https://learn.microsoft.com/en-us/azure/storage/common/storage-sas-overview) ÎœÎ¹Î± Ï…Ï€Î¿Î³ÏÎ±Ï†Î® ÎºÎ¿Î¹Î½Î®Ï‚ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ·Ï‚ (SAS) Ï€Î±ÏÎ­Ï‡ÎµÎ¹ Î±ÏƒÏ†Î±Î»Î® ÎµÎ¾Î¿Ï…ÏƒÎ¹Î¿Î´Î¿Ï„Î·Î¼Î­Î½Î· Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ· ÏƒÎµ Ï€ÏŒÏÎ¿Ï…Ï‚ ÏƒÏ„Î¿Î½ Î»Î¿Î³Î±ÏÎ¹Î±ÏƒÎ¼ÏŒ Î±Ï€Î¿Î¸Î®ÎºÎµÏ…ÏƒÎ®Ï‚ ÏƒÎ±Ï‚. ÎœÎµ Î­Î½Î± SAS, Î­Ï‡ÎµÏ„Îµ Î»ÎµÏ€Ï„Î¿Î¼ÎµÏÎ® Î­Î»ÎµÎ³Ï‡Î¿ ÏƒÏ‡ÎµÏ„Î¹ÎºÎ¬ Î¼Îµ Ï„Î¿ Ï€ÏÏ‚ Î¼Ï€Î¿ÏÎµÎ¯ Î­Î½Î±Ï‚ Ï€ÎµÎ»Î¬Ï„Î·Ï‚ Î½Î± Î­Ï‡ÎµÎ¹ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ· ÏƒÏ„Î± Î´ÎµÎ´Î¿Î¼Î­Î½Î± ÏƒÎ±Ï‚. Î“Î¹Î± Ï€Î±ÏÎ¬Î´ÎµÎ¹Î³Î¼Î±:

* Î Î¿Î¹Î¿Î¹ Ï€ÏŒÏÎ¿Î¹ Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Î­Ï‡ÎµÎ¹ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ· Î¿ Ï€ÎµÎ»Î¬Ï„Î·Ï‚.
* Î Î¿Î¹ÎµÏ‚ Î¬Î´ÎµÎ¹ÎµÏ‚ Î­Ï‡ÎµÎ¹ ÏƒÎµ Î±Ï…Ï„Î¿ÏÏ‚ Ï„Î¿Ï…Ï‚ Ï€ÏŒÏÎ¿Ï…Ï‚.
* Î ÏŒÏƒÎ¿ ÎºÎ±Î¹ÏÏŒ ÎµÎ¯Î½Î±Î¹ Î­Î³ÎºÏ…ÏÎ¿ Ï„Î¿ SAS.

ÎˆÎ½Î± URL SAS Î¼Î¿Î¹Î¬Î¶ÎµÎ¹ Î¼Îµ Î±Ï…Ï„ÏŒ: **`https://<container_name>.blob.core.windows.net/newcontainer?sp=r&st=2021-09-26T18:15:21Z&se=2021-10-27T02:14:21Z&spr=https&sv=2021-07-08&sr=c&sig=7S%2BZySOgy4aA3Dk0V1cJyTSIf1cW%2Fu3WFkhHV32%2B4PE%3D`**

Î§ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î®ÏƒÏ„Îµ [**Storage Explorer**](https://azure.microsoft.com/en-us/features/storage-explorer/) Î³Î¹Î± Î½Î± Î±Ï€Î¿ÎºÏ„Î®ÏƒÎµÏ„Îµ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ· ÏƒÏ„Î± Î´ÎµÎ´Î¿Î¼Î­Î½Î± Î® python:

{% code overflow="wrap" %}
```python
#pip3 install azure-storage-blob
from azure.storage.blob import BlobServiceClient

# List containers
conn_str="<SAS URL>"
svc = BlobServiceClient.from_connection_string(conn_str=conn_str)
for c in svc.list_containers():
print(c['name'])

# List blobs inside the containers
container = svc.get_container_client(container=c['name'])

for b in container.list_blobs():
print(b['name'])


# Download all the blobs
blob_name = b['name'].split("/")[::-1][0]
blob = svc.get_blob_client(container=c['name'],blob=b['name'])
with open(blob_name,"wb") as f:
f.write(blob.download_blob().readall())
```
{% endcode %}

### User delegation SAS <a href="#user-delegation-sas" id="user-delegation-sas"></a>

ÎœÏ€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± **Î±ÏƒÏ†Î±Î»Î¯ÏƒÎµÏ„Îµ Î­Î½Î± ÎºÎ¿Î¹Î½ÏŒÏ‡ÏÎ·ÏƒÏ„Î¿ Ï…Ï€Î¿Î³ÏÎ±Ï†Î® Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ·Ï‚ (SAS)** Î³Î¹Î± Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ· ÏƒÎµ Î­Î½Î± ÎºÎ¿Î½Ï„Î­Î¹Î½ÎµÏ, ÎºÎ±Ï„Î¬Î»Î¿Î³Î¿ Î® blob Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÏÎ½Ï„Î±Ï‚ ÎµÎ¯Ï„Îµ Ï„Î± **Î´Î¹Î±Ï€Î¹ÏƒÏ„ÎµÏ…Ï„Î®ÏÎ¹Î± Azure Active Directory (Azure AD)** ÎµÎ¯Ï„Îµ Î­Î½Î± **ÎºÎ»ÎµÎ¹Î´Î¯ Î»Î¿Î³Î±ÏÎ¹Î±ÏƒÎ¼Î¿Ï**. Î“Î¹Î± Î½Î± Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î®ÏƒÎµÏ„Îµ Î­Î½Î± user delegation SAS, Ï€ÏÎ­Ï€ÎµÎ¹ Ï€ÏÏÏ„Î± Î½Î± Î¶Î·Ï„Î®ÏƒÎµÏ„Îµ Î­Î½Î± **ÎºÎ»ÎµÎ¹Î´Î¯ ÎµÎ¾Î¿Ï…ÏƒÎ¹Î¿Î´ÏŒÏ„Î·ÏƒÎ·Ï‚ Ï‡ÏÎ®ÏƒÏ„Î·**, Ï„Î¿ Î¿Ï€Î¿Î¯Î¿ ÏƒÏ„Î· ÏƒÏ…Î½Î­Ï‡ÎµÎ¹Î± Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÎµÎ¯Ï„Îµ Î³Î¹Î± Î½Î± Ï…Ï€Î¿Î³ÏÎ¬ÏˆÎµÏ„Îµ Ï„Î¿ SAS.

Î¥Ï€Î¿ÏƒÏ„Î·ÏÎ¯Î¶ÎµÏ„Î±Î¹ Î­Î½Î± **User Delegation Shared Access Signature (SAS)** Ï„ÏŒÏƒÎ¿ ÏƒÏ„Î¿ **Azure Blob Storage** ÏŒÏƒÎ¿ ÎºÎ±Î¹ ÏƒÏ„Î¿ **Azure Data Lake Storage Gen2**. Î©ÏƒÏ„ÏŒÏƒÎ¿, ÎµÎ¯Î½Î±Î¹ ÏƒÎ·Î¼Î±Î½Ï„Î¹ÎºÏŒ Î½Î± ÏƒÎ·Î¼ÎµÎ¹Ï‰Î¸ÎµÎ¯ ÏŒÏ„Î¹ Î¿Î¹ **Î‘Ï€Î¿Î¸Î·ÎºÎµÏ…Î¼Î­Î½ÎµÏ‚ Î Î¿Î»Î¹Ï„Î¹ÎºÎ­Ï‚ Î ÏÏŒÏƒÎ²Î±ÏƒÎ·Ï‚** Î´ÎµÎ½ ÎµÎ¯Î½Î±Î¹ ÏƒÏ…Î¼Î²Î±Ï„Î­Ï‚ Î¼Îµ Î­Î½Î± User Delegation SAS.

Î£Î·Î¼ÎµÎ¹ÏÏƒÏ„Îµ ÏŒÏ„Î¹ Ï„Î¿ user delegation SAS ÎµÎ¯Î½Î±Î¹ **Î±ÏƒÏ†Î±Î»Î¹ÏƒÎ¼Î­Î½Î¿ Î¼Îµ Î´Î¹Î±Ï€Î¹ÏƒÏ„ÎµÏ…Ï„Î®ÏÎ¹Î± Azure AD Î±Î½Ï„Î¯ Î³Î¹Î± ÎºÎ»ÎµÎ¹Î´Î¹Î¬ Î»Î¿Î³Î±ÏÎ¹Î±ÏƒÎ¼Î¿Ï Î±Ï€Î¿Î¸Î®ÎºÎµÏ…ÏƒÎ·Ï‚**. Î‘Ï…Ï„ÏŒ Î±Ï€Î¿Ï„ÏÎ­Ï€ÎµÎ¹ Ï„Î¿Ï…Ï‚ Ï€ÎµÎ»Î¬Ï„ÎµÏ‚/ÎµÏ†Î±ÏÎ¼Î¿Î³Î­Ï‚ Î±Ï€ÏŒ Ï„Î¿ Î½Î± Î±Ï€Î¿Î¸Î·ÎºÎµÏÎ¿Ï…Î½/Î±Î½Î±ÎºÏ„Î¿ÏÎ½ ÎºÎ»ÎµÎ¹Î´Î¹Î¬ Î±Ï€Î¿Î¸Î®ÎºÎµÏ…ÏƒÎ·Ï‚ Î³Î¹Î± Î½Î± Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î®ÏƒÎ¿Ï…Î½ SAS.

### Service SAS

ÎˆÎ½Î± service SAS ÎµÎ¯Î½Î±Î¹ Î±ÏƒÏ†Î±Î»Î¹ÏƒÎ¼Î­Î½Î¿ Î¼Îµ Ï„Î¿ **ÎºÎ»ÎµÎ¹Î´Î¯ Î»Î¿Î³Î±ÏÎ¹Î±ÏƒÎ¼Î¿Ï Î±Ï€Î¿Î¸Î®ÎºÎµÏ…ÏƒÎ·Ï‚**. ÎˆÎ½Î± service SAS **ÎµÎ¾Î¿Ï…ÏƒÎ¹Î¿Î´Î¿Ï„ÎµÎ¯ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ· ÏƒÎµ Î­Î½Î±Î½ Ï€ÏŒÏÎ¿ Î¼ÏŒÎ½Î¿ ÏƒÎµ Î¼Î¯Î±** Î±Ï€ÏŒ Ï„Î¹Ï‚ Ï…Ï€Î·ÏÎµÏƒÎ¯ÎµÏ‚ Azure Storage: Blob storage, Queue storage, Table storage Î® Azure Files. Î¤Î¿ URI Î³Î¹Î± Î­Î½Î± service-level SAS Î±Ï€Î¿Ï„ÎµÎ»ÎµÎ¯Ï„Î±Î¹ Î±Ï€ÏŒ Ï„Î¿ URI Ï„Î¿Ï… Ï€ÏŒÏÎ¿Ï… Î³Î¹Î± Ï„Î¿Î½ Î¿Ï€Î¿Î¯Î¿ Ï„Î¿ SAS Î¸Î± ÎµÎ¾Î¿Ï…ÏƒÎ¹Î¿Î´Î¿Ï„Î®ÏƒÎµÎ¹ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ·, Î±ÎºÎ¿Î»Î¿Ï…Î¸Î¿ÏÎ¼ÎµÎ½Î¿ Î±Ï€ÏŒ Ï„Î¿ SAS token.

Î“Î¹Î± Î½Î± Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î®ÏƒÎµÏ„Îµ Ï„Î± Î´Î¹Î±Ï€Î¹ÏƒÏ„ÎµÏ…Ï„Î®ÏÎ¹Î± Azure Active Directory (Azure AD) Î³Î¹Î± Î½Î± Î±ÏƒÏ†Î±Î»Î¯ÏƒÎµÏ„Îµ Î­Î½Î± SAS Î³Î¹Î± Î­Î½Î± **ÎºÎ¿Î½Ï„Î­Î¹Î½ÎµÏ** Î® **blob**, Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î®ÏƒÏ„Îµ Î­Î½Î± **user delegation SAS**.

### Account SAS

ÎˆÎ½Î± account SAS ÎµÎ¯Î½Î±Î¹ Î±ÏƒÏ†Î±Î»Î¹ÏƒÎ¼Î­Î½Î¿ Î¼Îµ Î­Î½Î± Î±Ï€ÏŒ Ï„Î± **ÎºÎ»ÎµÎ¹Î´Î¹Î¬ Î»Î¿Î³Î±ÏÎ¹Î±ÏƒÎ¼Î¿Ï Î±Ï€Î¿Î¸Î®ÎºÎµÏ…ÏƒÎ·Ï‚** (Ï…Ï€Î¬ÏÏ‡Î¿Ï…Î½ 2). ÎˆÎ½Î± account SAS ÎµÎ¾Î¿Ï…ÏƒÎ¹Î¿Î´Î¿Ï„ÎµÎ¯ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ· ÏƒÎµ Ï€ÏŒÏÎ¿Ï…Ï‚ ÏƒÎµ Î¼Î¯Î± Î® Ï€ÎµÏÎ¹ÏƒÏƒÏŒÏ„ÎµÏÎµÏ‚ Î±Ï€ÏŒ Ï„Î¹Ï‚ Ï…Ï€Î·ÏÎµÏƒÎ¯ÎµÏ‚ Î±Ï€Î¿Î¸Î®ÎºÎµÏ…ÏƒÎ·Ï‚. ÎŒÎ»ÎµÏ‚ Î¿Î¹ Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¯ÎµÏ‚ Ï€Î¿Ï… ÎµÎ¯Î½Î±Î¹ Î´Î¹Î±Î¸Î­ÏƒÎ¹Î¼ÎµÏ‚ Î¼Î­ÏƒÏ‰ ÎµÎ½ÏŒÏ‚ service Î® user delegation SAS ÎµÎ¯Î½Î±Î¹ ÎµÏ€Î¯ÏƒÎ·Ï‚ Î´Î¹Î±Î¸Î­ÏƒÎ¹Î¼ÎµÏ‚ Î¼Î­ÏƒÏ‰ ÎµÎ½ÏŒÏ‚ account SAS.

[from the docs:](https://learn.microsoft.com/en-us/rest/api/storageservices/create-account-sas) Î”Î·Î¼Î¹Î¿Ï…ÏÎ³ÏÎ½Ï„Î±Ï‚ Î­Î½Î± account SAS, Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î±:

* Î•Î¾Î¿Ï…ÏƒÎ¹Î¿Î´Î¿Ï„Î®ÏƒÎµÏ„Îµ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ· ÏƒÎµ Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¯ÎµÏ‚ ÎµÏ€Î¹Ï€Î­Î´Î¿Ï… Ï…Ï€Î·ÏÎµÏƒÎ¯Î±Ï‚ Ï€Î¿Ï… Î´ÎµÎ½ ÎµÎ¯Î½Î±Î¹ Î´Î¹Î±Î¸Î­ÏƒÎ¹Î¼ÎµÏ‚ Î±Ï…Ï„Î® Ï„Î· ÏƒÏ„Î¹Î³Î¼Î® Î¼Îµ Î­Î½Î± service-specific SAS, ÏŒÏ€Ï‰Ï‚ Î¿Î¹ Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¯ÎµÏ‚ `Get/Set Service Properties` ÎºÎ±Î¹ `Get Service Stats`.
* Î•Î¾Î¿Ï…ÏƒÎ¹Î¿Î´Î¿Ï„Î®ÏƒÎµÏ„Îµ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ· ÏƒÎµ Ï€ÎµÏÎ¹ÏƒÏƒÏŒÏ„ÎµÏÎµÏ‚ Î±Ï€ÏŒ Î¼Î¯Î± Ï…Ï€Î·ÏÎµÏƒÎ¯ÎµÏ‚ ÏƒÎµ Î­Î½Î±Î½ Î»Î¿Î³Î±ÏÎ¹Î±ÏƒÎ¼ÏŒ Î±Ï€Î¿Î¸Î®ÎºÎµÏ…ÏƒÎ·Ï‚ Ï„Î±Ï…Ï„ÏŒÏ‡ÏÎ¿Î½Î±. Î“Î¹Î± Ï€Î±ÏÎ¬Î´ÎµÎ¹Î³Î¼Î±, Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± ÎµÎ¾Î¿Ï…ÏƒÎ¹Î¿Î´Î¿Ï„Î®ÏƒÎµÏ„Îµ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ· ÏƒÎµ Ï€ÏŒÏÎ¿Ï…Ï‚ Ï„ÏŒÏƒÎ¿ ÏƒÏ„Î¿ Azure Blob Storage ÏŒÏƒÎ¿ ÎºÎ±Î¹ ÏƒÏ„Î¿ Azure Files Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÏÎ½Ï„Î±Ï‚ Î­Î½Î± account SAS.
* Î•Î¾Î¿Ï…ÏƒÎ¹Î¿Î´Î¿Ï„Î®ÏƒÎµÏ„Îµ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ· ÏƒÎµ Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¯ÎµÏ‚ ÎµÎ³Î³ÏÎ±Ï†Î®Ï‚ ÎºÎ±Î¹ Î´Î¹Î±Î³ÏÎ±Ï†Î®Ï‚ Î³Î¹Î± ÎºÎ¿Î½Ï„Î­Î¹Î½ÎµÏ, Î¿Ï…ÏÎ­Ï‚, Ï€Î¯Î½Î±ÎºÎµÏ‚ ÎºÎ±Î¹ ÎºÎ¿Î¹Î½Î­Ï‚ Ï‡ÏÎ®ÏƒÎµÎ¹Ï‚ Î±ÏÏ‡ÎµÎ¯Ï‰Î½, Î¿Î¹ Î¿Ï€Î¿Î¯ÎµÏ‚ Î´ÎµÎ½ ÎµÎ¯Î½Î±Î¹ Î´Î¹Î±Î¸Î­ÏƒÎ¹Î¼ÎµÏ‚ Î¼Îµ Î­Î½Î± object-specific SAS.
* Î ÏÎ¿ÏƒÎ´Î¹Î¿ÏÎ¯ÏƒÎµÏ„Îµ Î¼Î¹Î± Î´Î¹ÎµÏÎ¸Ï…Î½ÏƒÎ· IP Î® Î¼Î¹Î± ÏƒÎµÎ¹ÏÎ¬ Î´Î¹ÎµÏ…Î¸ÏÎ½ÏƒÎµÏ‰Î½ IP Î±Ï€ÏŒ Ï„Î¹Ï‚ Î¿Ï€Î¿Î¯ÎµÏ‚ Î½Î± Î³Î¯Î½Î¿Î½Ï„Î±Î¹ Î±Ï€Î¿Î´ÎµÎºÏ„Î¬ Ï„Î± Î±Î¹Ï„Î®Î¼Î±Ï„Î±.
* Î ÏÎ¿ÏƒÎ´Î¹Î¿ÏÎ¯ÏƒÎµÏ„Îµ Ï„Î¿ Ï€ÏÏ‰Ï„ÏŒÎºÎ¿Î»Î»Î¿ HTTP Î±Ï€ÏŒ Ï„Î¿ Î¿Ï€Î¿Î¯Î¿ Î½Î± Î³Î¯Î½Î¿Î½Ï„Î±Î¹ Î±Ï€Î¿Î´ÎµÎºÏ„Î¬ Ï„Î± Î±Î¹Ï„Î®Î¼Î±Ï„Î± (ÎµÎ¯Ï„Îµ HTTPS ÎµÎ¯Ï„Îµ HTTP/HTTPS).

## Enumeration

{% tabs %}
{% tab title="az cli" %}
{% code overflow="wrap" %}
```bash
# Get storage accounts
az storage account list #Get the account name from here

# Get keys to authenticate
az storage account keys list --account-name <name>

# Get shares
az storage share list --account-name <name> --account-key <key>

# Get dirs/files inside the share
az storage file list --account-name <name> --share-name <share-name> --account-key <key>
## If type is "dir", you can continue enumerationg files inside of it
az storage file list --account-name <name> --share-name <prev_dir/share-name> --account-key <key>

# Download a complete share (with directories and files inside of them)
az storage file download-batch -d . --source <share-name> --account-name <name> --account-key <key>
```
{% endcode %}
{% endtab %}

{% tab title="Az PowerShell" %}
{% code overflow="wrap" %}
```powershell
# Get storage accounts
Get-AzStorageAccount | fl
# Get rules to access the storage account
Get-AzStorageAccount | select -ExpandProperty NetworkRuleSet
# Get IPs
(Get-AzStorageAccount | select -ExpandProperty NetworkRuleSet).IPRules
# Get containers of a storage account
Get-AzStorageContainer -Context (Get-AzStorageAccount -name <NAME> -ResourceGroupName <NAME>).context
# Get blobs inside container
Get-AzStorageBlob -Container epbackup-planetary -Context (Get-AzStorageAccount -name <name> -ResourceGroupName <name>).context
# Get a blob from a container
Get-AzStorageBlobContent -Container <NAME> -Context (Get-AzStorageAccount -name <NAME> -ResourceGroupName <NAME>).context -Blob <blob_name> -Destination .\Desktop\filename.txt
```
{% endcode %}
{% endtab %}
{% endtabs %}

## Î‘Î½Î±Ï†Î¿ÏÎ­Ï‚

* [https://learn.microsoft.com/en-us/azure/storage/blobs/storage-blobs-introduction](https://learn.microsoft.com/en-us/azure/storage/blobs/storage-blobs-introduction)
* [https://learn.microsoft.com/en-us/azure/storage/common/storage-sas-overview](https://learn.microsoft.com/en-us/azure/storage/common/storage-sas-overview)

{% hint style="success" %}
ÎœÎ¬Î¸ÎµÏ„Îµ & ÎµÎ¾Î±ÏƒÎºÎ·Î¸ÎµÎ¯Ï„Îµ ÏƒÏ„Î¿ AWS Hacking:<img src="../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">\
ÎœÎ¬Î¸ÎµÏ„Îµ & ÎµÎ¾Î±ÏƒÎºÎ·Î¸ÎµÎ¯Ï„Îµ ÏƒÏ„Î¿ GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Î¥Ï€Î¿ÏƒÏ„Î®ÏÎ¹Î¾Î· HackTricks</summary>

* Î•Î»Î­Î³Î¾Ï„Îµ Ï„Î± [**ÏƒÏ‡Î­Î´Î¹Î± ÏƒÏ…Î½Î´ÏÎ¿Î¼Î®Ï‚**](https://github.com/sponsors/carlospolop)!
* **Î•Î³Î³ÏÎ±Ï†ÎµÎ¯Ï„Îµ ÏƒÏ„Î·Î½** ğŸ’¬ [**Î¿Î¼Î¬Î´Î± Discord**](https://discord.gg/hRep4RUj7f) Î® ÏƒÏ„Î·Î½ [**Î¿Î¼Î¬Î´Î± telegram**](https://t.me/peass) Î® **Î±ÎºÎ¿Î»Î¿Ï…Î¸Î®ÏƒÏ„Îµ** Î¼Î±Ï‚ ÏƒÏ„Î¿ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **ÎœÎ¿Î¹ÏÎ±ÏƒÏ„ÎµÎ¯Ï„Îµ ÎºÏŒÎ»Ï€Î± hacking Ï…Ï€Î¿Î²Î¬Î»Î»Î¿Î½Ï„Î±Ï‚ PRs ÏƒÏ„Î±** [**HackTricks**](https://github.com/carlospolop/hacktricks) ÎºÎ±Î¹ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
