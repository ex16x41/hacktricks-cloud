# Az - Blob Storage

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Temel Bilgiler

[Belgelerden:](https://learn.microsoft.com/en-us/azure/storage/blobs/storage-blobs-overview) Azure Blob depolama, Microsoft'un **bulut iÃ§in nesne depolama Ã§Ã¶zÃ¼mÃ¼dÃ¼r**. Blob depolama, bÃ¼yÃ¼k miktarda yapÄ±landÄ±rÄ±lmamÄ±ÅŸ veriyi depolamak iÃ§in optimize edilmiÅŸtir. YapÄ±landÄ±rÄ±lmamÄ±ÅŸ veri, belirli bir veri modeline veya tanÄ±mÄ±na uymayan veridir; Ã¶rneÄŸin metin veya ikili veri.

Blob depolama Ã¼Ã§ tÃ¼r kaynak sunar:

* **Depolama hesabÄ±** (benzersiz ad)
* Depolama hesabÄ±ndaki bir **kapsayÄ±cÄ±** (klasÃ¶r)
* Bir kapsayÄ±cÄ±daki bir **blob**

<figure><img src="../../../.gitbook/assets/image (114).png" alt=""><figcaption></figcaption></figure>

### FarklÄ± depolama tÃ¼rleri

| **Blob depolama**                 | <p><code>https://&#x3C;storage-account>.blob.core.windows.net</code><br><br><code>https://&#x3C;stg-acc>.blob.core.windows.net/&#x3C;container-name>?restype=container&#x26;comp=list</code></p> |
| -------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| **Azure Data Lake Storage Gen2** | `https://<storage-account>.dfs.core.windows.net`                                                                                                                                                 |
| **Azure Files**                  | `https://<storage-account>.file.core.windows.net`                                                                                                                                                |
| **Queue storage**                | `https://<storage-account>.queue.core.windows.net`                                                                                                                                               |
| **Table storage**                | `https://<storage-account>.table.core.windows.net`                                                                                                                                               |

### Depolama EriÅŸimi <a href="#about-blob-storage" id="about-blob-storage"></a>

* **RBAC rolleri** aracÄ±lÄ±ÄŸÄ±yla Azure AD ilkelerini kullanÄ±n.
* **EriÅŸim AnahtarlarÄ±**: Depolama hesabÄ±nÄ±n eriÅŸim anahtarlarÄ±nÄ± kullanÄ±n. Bu, **depolama hesabÄ±na tam eriÅŸim saÄŸlar.**
* **PaylaÅŸÄ±lan EriÅŸim Ä°mzasÄ±** (SAS): **Zaman** **sÄ±nÄ±rlÄ±** ve belirli izinler.
* Bir **eriÅŸim anahtarÄ±** ile bir SAS URL'si oluÅŸturabilirsiniz (tespit edilmesi daha karmaÅŸÄ±k).
* SAS, eriÅŸim anahtarÄ±ndan oluÅŸturulduÄŸundan, eÄŸer yenilenirse SAS Ã§alÄ±ÅŸmayÄ± durdurur.

### Kamuya AÃ§Ä±klÄ±k

"Blob kamu eriÅŸimini izin ver" **etkinleÅŸtirildiÄŸinde** (varsayÄ±lan olarak devre dÄ±ÅŸÄ±), aÅŸaÄŸÄ±dakiler mÃ¼mkÃ¼ndÃ¼r:

* **Blob'larÄ± okumak iÃ§in kamu eriÅŸimi vermek** (adÄ±nÄ± bilmeniz gerekir).
* **KapsayÄ±cÄ± blob'larÄ±nÄ± listelemek** ve **okumak**.

### Depolamaya BaÄŸlanma

Herhangi bir **depolama** bulursanÄ±z, bunu yapmak iÃ§in [**Microsoft Azure Storage Explorer**](https://azure.microsoft.com/es-es/products/storage/storage-explorer/) aracÄ±nÄ± kullanabilirsiniz.

## SAS URL'leri

[Belgelerden:](https://learn.microsoft.com/en-us/azure/storage/common/storage-sas-overview) PaylaÅŸÄ±lan eriÅŸim imzasÄ± (SAS), depolama hesabÄ±nÄ±zdaki kaynaklara gÃ¼venli bir ÅŸekilde yetkilendirilmiÅŸ eriÅŸim saÄŸlar. Bir SAS ile, bir istemcinin verilerinize nasÄ±l eriÅŸebileceÄŸi Ã¼zerinde ayrÄ±ntÄ±lÄ± kontrol sahibi olursunuz. Ã–rneÄŸin:

* Ä°stemcinin eriÅŸebileceÄŸi kaynaklar.
* Bu kaynaklara sahip olduklarÄ± izinler.
* SAS'Ä±n ne kadar sÃ¼re geÃ§erli olduÄŸu.

Bir SAS URL'si ÅŸu ÅŸekilde gÃ¶rÃ¼nÃ¼r: **`https://<container_name>.blob.core.windows.net/newcontainer?sp=r&st=2021-09-26T18:15:21Z&se=2021-10-27T02:14:21Z&spr=https&sv=2021-07-08&sr=c&sig=7S%2BZySOgy4aA3Dk0V1cJyTSIf1cW%2Fu3WFkhHV32%2B4PE%3D`**

Verilere eriÅŸmek iÃ§in [**Storage Explorer**](https://azure.microsoft.com/en-us/features/storage-explorer/) veya python kullanÄ±n:

{% code overflow="wrap" %}
```python
#pip3 install azure-storage-blob
from azure.storage.blob import BlobServiceClient

# List containers
conn_str="<SAS URL>"
svc = BlobServiceClient.from_connection_string(conn_str=conn_str)
for c in svc.list_containers():
print(c['name'])

# List blobs inside the containers
container = svc.get_container_client(container=c['name'])

for b in container.list_blobs():
print(b['name'])


# Download all the blobs
blob_name = b['name'].split("/")[::-1][0]
blob = svc.get_blob_client(container=c['name'],blob=b['name'])
with open(blob_name,"wb") as f:
f.write(blob.download_blob().readall())
```
{% endcode %}

### KullanÄ±cÄ± Delegasyonu SAS <a href="#user-delegation-sas" id="user-delegation-sas"></a>

Bir konteynere, dizine veya blob'a eriÅŸim iÃ§in **paylaÅŸÄ±lan eriÅŸim imzasÄ± (SAS)** token'Ä±nÄ±, Azure Active Directory (Azure AD) **kimlik bilgileri veya bir hesap anahtarÄ±** kullanarak **gÃ¼vence altÄ±na alabilirsiniz**. Bir kullanÄ±cÄ± delegasyonu SAS oluÅŸturmak iÃ§in Ã¶nce bir **kullanÄ±cÄ± delegasyonu anahtarÄ±** talep etmelisiniz, ardÄ±ndan bu anahtarÄ± SAS'Ä± imzalamak iÃ§in kullanmalÄ±sÄ±nÄ±z.

**Azure Blob Storage** ve **Azure Data Lake Storage Gen2**'de **KullanÄ±cÄ± Delegasyonu PaylaÅŸÄ±lan EriÅŸim Ä°mzasÄ± (SAS)** desteÄŸi saÄŸlanmaktadÄ±r. Ancak, **Saklanan EriÅŸim PolitikalarÄ±**nÄ±n bir KullanÄ±cÄ± Delegasyonu SAS ile uyumlu olmadÄ±ÄŸÄ±nÄ± belirtmek Ã¶nemlidir.

KullanÄ±cÄ± delegasyonu SAS'Ä±n **depolama hesap anahtarlarÄ± yerine Azure AD kimlik bilgileri ile gÃ¼vence altÄ±na alÄ±ndÄ±ÄŸÄ±nÄ±** unutmayÄ±n. Bu, istemcilerin/uygulamalarÄ±n SAS oluÅŸturmak iÃ§in depolama anahtarlarÄ±nÄ± saklamasÄ±nÄ±/almalarÄ±nÄ± engeller.

### Servis SAS

Bir servis SAS, **depolama hesap anahtarÄ±** ile gÃ¼vence altÄ±na alÄ±nÄ±r. Bir servis SAS, Azure Depolama hizmetlerinden yalnÄ±zca birine ait bir kaynaÄŸa eriÅŸimi **delege eder**: Blob depolama, Kuyruk depolama, Tablo depolama veya Azure DosyalarÄ±. Bir servis dÃ¼zeyindeki SAS iÃ§in URI, SAS'Ä±n eriÅŸimi delege edeceÄŸi kaynaÄŸÄ±n URI'sini ve ardÄ±ndan SAS token'Ä±nÄ± iÃ§erir.

Bir **konteyner** veya **blob** iÃ§in SAS'Ä± gÃ¼vence altÄ±na almak Ã¼zere Azure Active Directory (Azure AD) kimlik bilgilerini kullanmak iÃ§in bir **kullanÄ±cÄ± delegasyonu SAS** kullanÄ±n.

### Hesap SAS

Bir hesap SAS, **depolama hesap anahtarlarÄ±ndan** biri ile gÃ¼vence altÄ±na alÄ±nÄ±r (2 tane vardÄ±r). Bir hesap SAS, bir veya daha fazla depolama hizmetindeki kaynaklara eriÅŸimi delege eder. Bir servis veya kullanÄ±cÄ± delegasyonu SAS aracÄ±lÄ±ÄŸÄ±yla mevcut olan tÃ¼m iÅŸlemler, bir hesap SAS aracÄ±lÄ±ÄŸÄ±yla da mevcuttur.

[dokÃ¼manlardan:](https://learn.microsoft.com/en-us/rest/api/storageservices/create-account-sas) Bir hesap SAS oluÅŸturarak ÅŸunlarÄ± yapabilirsiniz:

* `Get/Set Service Properties` ve `Get Service Stats` iÅŸlemleri gibi ÅŸu anda bir servis Ã¶zel SAS ile mevcut olmayan servis dÃ¼zeyindeki iÅŸlemlere eriÅŸimi delege edin.
* Bir depolama hesabÄ±ndaki birden fazla servise aynÄ± anda eriÅŸimi delege edin. Ã–rneÄŸin, bir hesap SAS kullanarak hem Azure Blob Storage hem de Azure DosyalarÄ±'ndaki kaynaklara eriÅŸimi delege edebilirsiniz.
* Nesneye Ã¶zel bir SAS ile mevcut olmayan konteynerler, kuyruklar, tablolar ve dosya paylaÅŸÄ±mlarÄ± iÃ§in yazma ve silme iÅŸlemlerine eriÅŸimi delege edin.
* Talepleri kabul etmek iÃ§in bir IP adresi veya IP adresleri aralÄ±ÄŸÄ± belirtin.
* Talepleri kabul etmek iÃ§in HTTP protokolÃ¼nÃ¼ belirtin (ya HTTPS ya da HTTP/HTTPS).

## SayÄ±m

{% tabs %}
{% tab title="az cli" %}
{% code overflow="wrap" %}
```bash
# Get storage accounts
az storage account list #Get the account name from here

# Get keys to authenticate
az storage account keys list --account-name <name>

# Get shares
az storage share list --account-name <name> --account-key <key>

# Get dirs/files inside the share
az storage file list --account-name <name> --share-name <share-name> --account-key <key>
## If type is "dir", you can continue enumerationg files inside of it
az storage file list --account-name <name> --share-name <prev_dir/share-name> --account-key <key>

# Download a complete share (with directories and files inside of them)
az storage file download-batch -d . --source <share-name> --account-name <name> --account-key <key>
```
{% endcode %}
{% endtab %}

{% tab title="Az PowerShell" %}
{% code overflow="wrap" %}
```powershell
# Get storage accounts
Get-AzStorageAccount | fl
# Get rules to access the storage account
Get-AzStorageAccount | select -ExpandProperty NetworkRuleSet
# Get IPs
(Get-AzStorageAccount | select -ExpandProperty NetworkRuleSet).IPRules
# Get containers of a storage account
Get-AzStorageContainer -Context (Get-AzStorageAccount -name <NAME> -ResourceGroupName <NAME>).context
# Get blobs inside container
Get-AzStorageBlob -Container epbackup-planetary -Context (Get-AzStorageAccount -name <name> -ResourceGroupName <name>).context
# Get a blob from a container
Get-AzStorageBlobContent -Container <NAME> -Context (Get-AzStorageAccount -name <NAME> -ResourceGroupName <NAME>).context -Blob <blob_name> -Destination .\Desktop\filename.txt
```
{% endcode %}
{% endtab %}
{% endtabs %}

## Referanslar

* [https://learn.microsoft.com/en-us/azure/storage/blobs/storage-blobs-introduction](https://learn.microsoft.com/en-us/azure/storage/blobs/storage-blobs-introduction)
* [https://learn.microsoft.com/en-us/azure/storage/common/storage-sas-overview](https://learn.microsoft.com/en-us/azure/storage/common/storage-sas-overview)

{% hint style="success" %}
AWS Hacking Ã¶ÄŸrenin ve pratik yapÄ±n:<img src="../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">\
GCP Hacking Ã¶ÄŸrenin ve pratik yapÄ±n: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**abonelik planlarÄ±nÄ±**](https://github.com/sponsors/carlospolop) kontrol edin!
* **ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n ya da **Twitter**'da **bizi takip edin** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Hacking ipuÃ§larÄ±nÄ± paylaÅŸmak iÃ§in** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna PR gÃ¶nderin.

</details>
{% endhint %}
