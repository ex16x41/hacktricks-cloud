# Az - Blob Storage

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* [**Abonelik planlarÄ±nÄ±**](https://github.com/sponsors/carlospolop) kontrol edin!
* **ğŸ’¬ Discord grubuna** [**katÄ±lÄ±n**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n ya da **Twitter'da** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live) **bizi takip edin.**
* **HackTricks'e PR gÃ¶ndererek hacking ipuÃ§larÄ±nÄ± paylaÅŸÄ±n** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na.

</details>
{% endhint %}

## Temel Bilgiler

[DokÃ¼manlardan:](https://learn.microsoft.com/en-us/azure/storage/blobs/storage-blobs-overview) Azure Blob storage, Microsoft'un **bulut iÃ§in nesne depolama Ã§Ã¶zÃ¼mÃ¼dÃ¼r**. Blob storage, bÃ¼yÃ¼k miktarda yapÄ±landÄ±rÄ±lmamÄ±ÅŸ veriyi depolamak iÃ§in optimize edilmiÅŸtir. YapÄ±landÄ±rÄ±lmamÄ±ÅŸ veri, belirli bir veri modeli veya tanÄ±mÄ±na uymayan, metin veya ikili veri gibi verilerdir.

Blob storage Ã¼Ã§ tÃ¼r kaynak sunar:

* **Depolama hesabÄ±** (benzersiz ad)
* Depolama hesabÄ±nda bir **kapsayÄ±cÄ±** (klasÃ¶r)
* Bir kapsayÄ±cÄ±da bir **blob**

<figure><img src="../../../.gitbook/assets/image (114).png" alt=""><figcaption></figcaption></figure>

### FarklÄ± depolama tÃ¼rleri

| **Blob storage**                 | <p><code>https://&#x3C;storage-account>.blob.core.windows.net</code><br><br><code>https://&#x3C;stg-acc>.blob.core.windows.net/&#x3C;container-name>?restype=container&#x26;comp=list</code></p> |
| -------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| **Azure Data Lake Storage Gen2** | `https://<storage-account>.dfs.core.windows.net`                                                                                                                                                 |
| **Azure Files**                  | `https://<storage-account>.file.core.windows.net`                                                                                                                                                |
| **Queue storage**                | `https://<storage-account>.queue.core.windows.net`                                                                                                                                               |
| **Table storage**                | `https://<storage-account>.table.core.windows.net`                                                                                                                                               |

### Depolamaya EriÅŸim <a href="#about-blob-storage" id="about-blob-storage"></a>

* **RBAC rolleri** desteklenen Azure AD ilkelerini kullanÄ±n.
* **EriÅŸim AnahtarlarÄ±**: Depolama hesabÄ±nÄ±n eriÅŸim anahtarlarÄ±nÄ± kullanÄ±n. Bu, depolama hesabÄ±na **tam eriÅŸim saÄŸlar.**
* **PaylaÅŸÄ±lan EriÅŸim Ä°mzasÄ±** (SAS): **Zaman** **sÄ±nÄ±rlÄ±** ve belirli izinler.
* Bir **eriÅŸim anahtarÄ±** ile bir SAS url'si oluÅŸturabilirsiniz (tespit edilmesi daha zor).
* SAS, eriÅŸim anahtarÄ±ndan oluÅŸturulduÄŸu iÃ§in, yenilenirse SAS Ã§alÄ±ÅŸmayÄ± durdurur.

### Genel Maruz Kalma

"Blob genel eriÅŸimine izin ver" **etkinleÅŸtirilmiÅŸse** (varsayÄ±lan olarak devre dÄ±ÅŸÄ±), ÅŸunlar mÃ¼mkÃ¼ndÃ¼r:

* **Blob'larÄ± okumak iÃ§in genel eriÅŸim** verin (adÄ±nÄ± bilmeniz gerekir).
* **KapsayÄ±cÄ± blob'larÄ±nÄ± listeleyin** ve **okuyun**.

### Depolamaya BaÄŸlanma

Herhangi bir **depolama** bulursanÄ±z, [**Microsoft Azure Storage Explorer**](https://azure.microsoft.com/es-es/products/storage/storage-explorer/) aracÄ±nÄ± kullanarak baÄŸlanabilirsiniz.

## SAS URL'leri

[DokÃ¼manlardan:](https://learn.microsoft.com/en-us/azure/storage/common/storage-sas-overview) PaylaÅŸÄ±lan eriÅŸim imzasÄ± (SAS), depolama hesabÄ±nÄ±zdaki kaynaklara gÃ¼venli, devredilmiÅŸ eriÅŸim saÄŸlar. Bir SAS ile, bir istemcinin verilerinize nasÄ±l eriÅŸebileceÄŸi Ã¼zerinde ayrÄ±ntÄ±lÄ± kontrol sahibi olursunuz. Ã–rneÄŸin:

* Ä°stemcinin hangi kaynaklara eriÅŸebileceÄŸi.
* Bu kaynaklara hangi izinlere sahip olduklarÄ±.
* SAS'in ne kadar sÃ¼re geÃ§erli olduÄŸu.

Bir SAS URL'si ÅŸu ÅŸekilde gÃ¶rÃ¼nÃ¼r: **`https://<container_name>.blob.core.windows.net/newcontainer?sp=r&st=2021-09-26T18:15:21Z&se=2021-10-27T02:14:21Z&spr=https&sv=2021-07-08&sr=c&sig=7S%2BZySOgy4aA3Dk0V1cJyTSIf1cW%2Fu3WFkhHV32%2B4PE%3D`**

Verilere eriÅŸmek iÃ§in [**Storage Explorer**](https://azure.microsoft.com/en-us/features/storage-explorer/) veya python kullanÄ±n:

{% code overflow="wrap" %}
```python
#pip3 install azure-storage-blob
from azure.storage.blob import BlobServiceClient

# List containers
conn_str="<SAS URL>"
svc = BlobServiceClient.from_connection_string(conn_str=conn_str)
for c in svc.list_containers():
print(c['name'])

# List blobs inside the containers
container = svc.get_container_client(container=c['name'])

for b in container.list_blobs():
print(b['name'])


# Download all the blobs
blob_name = b['name'].split("/")[::-1][0]
blob = svc.get_blob_client(container=c['name'],blob=b['name'])
with open(blob_name,"wb") as f:
f.write(blob.download_blob().readall())
```
{% endcode %}

### User delegation SAS <a href="#user-delegation-sas" id="user-delegation-sas"></a>

Bir konteyner, dizin veya blob'a eriÅŸim iÃ§in bir **paylaÅŸÄ±lan eriÅŸim imzasÄ± (SAS)** jetonunu, Azure Active Directory (Azure AD) **kimlik bilgileri veya bir hesap anahtarÄ±** kullanarak gÃ¼vence altÄ±na alabilirsiniz. Bir kullanÄ±cÄ± yetkilendirme SAS'Ä± oluÅŸturmak iÃ§in Ã¶nce bir **kullanÄ±cÄ± yetkilendirme anahtarÄ±** talep etmelisiniz, ardÄ±ndan bu anahtarÄ± SAS'Ä± imzalamak iÃ§in kullanÄ±rsÄ±nÄ±z.

**Azure Blob Storage** ve **Azure Data Lake Storage Gen2**'de **KullanÄ±cÄ± Yetkilendirme PaylaÅŸÄ±lan EriÅŸim Ä°mzasÄ± (SAS)** desteÄŸi saÄŸlanmaktadÄ±r. Ancak, **Depolanan EriÅŸim PolitikalarÄ±**'nÄ±n KullanÄ±cÄ± Yetkilendirme SAS ile uyumlu olmadÄ±ÄŸÄ±nÄ± belirtmek Ã¶nemlidir.

KullanÄ±cÄ± yetkilendirme SAS'Ä±n **depolama hesabÄ± anahtarlarÄ± yerine Azure AD kimlik bilgileri ile gÃ¼vence altÄ±na alÄ±ndÄ±ÄŸÄ±nÄ±** unutmayÄ±n. Bu, istemcilerin/uygulamalarÄ±n SAS oluÅŸturmak iÃ§in depolama anahtarlarÄ±nÄ± saklamasÄ±nÄ±/geri almasÄ±nÄ± engeller.

### Service SAS

Bir hizmet SAS, **depolama hesabÄ± anahtarÄ±** ile gÃ¼vence altÄ±na alÄ±nÄ±r. Bir hizmet SAS, Azure Depolama hizmetlerinden yalnÄ±zca birindeki bir kaynaÄŸa **eriÅŸimi devreder**: Blob depolama, Kuyruk depolama, Tablo depolama veya Azure DosyalarÄ±. Hizmet dÃ¼zeyinde bir SAS iÃ§in URI, SAS'Ä±n eriÅŸimi devredeceÄŸi kaynaÄŸa yÃ¶nelik URI ve ardÄ±ndan SAS jetonundan oluÅŸur.

Bir **konteyner** veya **blob** iÃ§in bir SAS'Ä± gÃ¼vence altÄ±na almak iÃ§in Azure Active Directory (Azure AD) kimlik bilgilerini kullanmak iÃ§in, bir **kullanÄ±cÄ± yetkilendirme SAS'Ä±** kullanÄ±n.

### Account SAS

Bir hesap SAS, iki **depolama hesabÄ± anahtarÄ±ndan** biri ile gÃ¼vence altÄ±na alÄ±nÄ±r. Bir hesap SAS, bir veya daha fazla depolama hizmetindeki kaynaklara eriÅŸimi devreder. Bir hizmet veya kullanÄ±cÄ± yetkilendirme SAS aracÄ±lÄ±ÄŸÄ±yla kullanÄ±labilen tÃ¼m iÅŸlemler, bir hesap SAS aracÄ±lÄ±ÄŸÄ±yla da kullanÄ±labilir.

[belgelerden:](https://learn.microsoft.com/en-us/rest/api/storageservices/create-account-sas) Bir hesap SAS oluÅŸturarak ÅŸunlarÄ± yapabilirsiniz:

* `Get/Set Service Properties` ve `Get Service Stats` iÅŸlemleri gibi ÅŸu anda hizmete Ã¶zgÃ¼ bir SAS ile mevcut olmayan hizmet dÃ¼zeyinde iÅŸlemlere eriÅŸimi devredin.
* AynÄ± anda bir depolama hesabÄ±ndaki birden fazla hizmete eriÅŸimi devredin. Ã–rneÄŸin, bir hesap SAS kullanarak hem Azure Blob Storage hem de Azure Dosyalar'daki kaynaklara eriÅŸimi devredebilirsiniz.
* Nesneye Ã¶zgÃ¼ bir SAS ile mevcut olmayan konteynerler, kuyruklar, tablolar ve dosya paylaÅŸÄ±mlarÄ± iÃ§in yazma ve silme iÅŸlemlerine eriÅŸimi devredin.
* Talepleri kabul etmek iÃ§in bir IP adresi veya bir IP adresi aralÄ±ÄŸÄ± belirtin.
* Talepleri kabul etmek iÃ§in HTTP protokolÃ¼nÃ¼ belirtin (ya HTTPS ya da HTTP/HTTPS).

## Enumeration

{% tabs %}
{% tab title="az cli" %}
{% code overflow="wrap" %}
```bash
# Get storage accounts
az storage account list #Get the account name from here

# Get keys to authenticate
az storage account keys list --account-name <name>

# Get shares
az storage share list --account-name <name> --account-key <key>

# Get dirs/files inside the share
az storage file list --account-name <name> --share-name <share-name> --account-key <key>
## If type is "dir", you can continue enumerationg files inside of it
az storage file list --account-name <name> --share-name <prev_dir/share-name> --account-key <key>

# Download a complete share (with directories and files inside of them)
az storage file download-batch -d . --source <share-name> --account-name <name> --account-key <key>
```
{% endcode %}
{% endtab %}

{% tab title="Az PowerShell" %}
{% code overflow="wrap" %}
```powershell
# Get storage accounts
Get-AzStorageAccount | fl
# Get rules to access the storage account
Get-AzStorageAccount | select -ExpandProperty NetworkRuleSet
# Get IPs
(Get-AzStorageAccount | select -ExpandProperty NetworkRuleSet).IPRules
# Get containers of a storage account
Get-AzStorageContainer -Context (Get-AzStorageAccount -name <NAME> -ResourceGroupName <NAME>).context
# Get blobs inside container
Get-AzStorageBlob -Container epbackup-planetary -Context (Get-AzStorageAccount -name <name> -ResourceGroupName <name>).context
# Get a blob from a container
Get-AzStorageBlobContent -Container <NAME> -Context (Get-AzStorageAccount -name <NAME> -ResourceGroupName <NAME>).context -Blob <blob_name> -Destination .\Desktop\filename.txt
```
{% endcode %}
{% endtab %}
{% endtabs %}

## Referanslar

* [https://learn.microsoft.com/en-us/azure/storage/blobs/storage-blobs-introduction](https://learn.microsoft.com/en-us/azure/storage/blobs/storage-blobs-introduction)
* [https://learn.microsoft.com/en-us/azure/storage/common/storage-sas-overview](https://learn.microsoft.com/en-us/azure/storage/common/storage-sas-overview)

{% hint style="success" %}
AWS Hacking Ã¶ÄŸrenin ve pratik yapÄ±n:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCP Hacking Ã¶ÄŸrenin ve pratik yapÄ±n: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**abonelik planlarÄ±nÄ±**](https://github.com/sponsors/carlospolop) kontrol edin!
* **KatÄ±lÄ±n** ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) veya **bizi takip edin** **Twitter'da** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **HackTricks** ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na PR gÃ¶ndererek hacking ipuÃ§larÄ±nÄ± paylaÅŸÄ±n.

</details>
{% endhint %}
