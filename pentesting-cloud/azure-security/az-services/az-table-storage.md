# Az - Table Storage

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** 游눫 [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** 游냕 [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Informaci칩n B치sica

**Azure Table Storage** es un almac칠n NoSQL de clave-valor dise침ado para almacenar grandes vol칰menes de datos estructurados y no relacionales. Ofrece alta disponibilidad, baja latencia y escalabilidad para manejar grandes conjuntos de datos de manera eficiente. Los datos se organizan en tablas, con cada entidad identificada por una clave de partici칩n y una clave de fila, lo que permite b칰squedas r치pidas. Soporta caracter칤sticas como cifrado en reposo, control de acceso basado en roles y firmas de acceso compartido para un almacenamiento seguro y gestionado adecuado para una amplia gama de aplicaciones.

No **hay un mecanismo de respaldo incorporado** para el almacenamiento de tablas.

### Claves

#### **PartitionKey**

* La **PartitionKey agrupa entidades en particiones l칩gicas**. Las entidades con la misma PartitionKey se almacenan juntas, lo que mejora el rendimiento de las consultas y la escalabilidad.
* Ejemplo: En una tabla que almacena datos de empleados, `PartitionKey` podr칤a representar un departamento, por ejemplo, `"HR"` o `"IT"`.

#### **RowKey**

* La **RowKey es el identificador 칰nico** para una entidad dentro de una partici칩n. Cuando se combina con la PartitionKey, asegura que cada entidad en la tabla tenga un identificador 칰nico a nivel global.
* Ejemplo: Para la partici칩n `"HR"`, `RowKey` podr칤a ser un ID de empleado, por ejemplo, `"12345"`.

#### **Otras Propiedades (Propiedades Personalizadas)**

* Adem치s de la PartitionKey y RowKey, una entidad puede tener **propiedades personalizadas adicionales para almacenar datos**. Estas son definidas por el usuario y act칰an como columnas en una base de datos tradicional.
* Las propiedades se almacenan como **pares clave-valor**.
* Ejemplo: `Name`, `Age`, `Title` podr칤an ser propiedades personalizadas para un empleado.

## Enumeraci칩n
```bash
# Get storage accounts
az storage account list

# List tables
az storage table list --account-name <name>

# Read table
az storage entity query \
--account-name <name> \
--table-name <t-name> \
--top 10

# Write table
az storage entity insert \
--account-name <STORAGE_ACCOUNT_NAME> \
--table-name <TABLE_NAME> \
--entity PartitionKey=<PARTITION_KEY> RowKey=<ROW_KEY> <PROPERTY_KEY>=<PROPERTY_VALUE>

# Write example
az storage entity insert \
--account-name mystorageaccount \
--table-name mytable \
--entity PartitionKey=HR RowKey=12345 Name="John Doe" Age=30 Title="Manager"

# Update row
az storage entity merge \
--account-name mystorageaccount \
--table-name mytable \
--entity PartitionKey=pk1 RowKey=rk1 Age=31
```
{% hint style="info" %}
Por defecto, `az` cli utilizar치 una clave de cuenta para firmar una clave y realizar la acci칩n. Para usar los privilegios del principal de Entra ID, utiliza los par치metros `--auth-mode login`.
{% endhint %}

{% hint style="success" %}
Utiliza el par치metro `--account-key` para indicar la clave de cuenta a utilizar\
Utiliza el par치metro `--sas-token` con el token SAS para acceder a trav칠s de un token SAS
{% endhint %}

## Escalamiento de Privilegios

Igual que el privesc de almacenamiento:

{% content-ref url="../az-privilege-escalation/az-storage-privesc.md" %}
[az-storage-privesc.md](../az-privilege-escalation/az-storage-privesc.md)
{% endcontent-ref %}

## Post Explotaci칩n

{% content-ref url="../az-post-exploitation/az-table-storage-post-exploitation.md" %}
[az-table-storage-post-exploitation.md](../az-post-exploitation/az-table-storage-post-exploitation.md)
{% endcontent-ref %}

## Persistencia

Igual que la persistencia de almacenamiento:

{% content-ref url="../az-persistence/az-storage-persistence.md" %}
[az-storage-persistence.md](../az-persistence/az-storage-persistence.md)
{% endcontent-ref %}

{% hint style="success" %}
Aprende y practica Hacking en AWS:<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
Aprende y practica Hacking en GCP: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Apoya a HackTricks</summary>

* Revisa los [**planes de suscripci칩n**](https://github.com/sponsors/carlospolop)!
* **칔nete al** 游눫 [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s칤guenos** en **Twitter** 游냕 [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Comparte trucos de hacking enviando PRs a los repos de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
{% endhint %}
