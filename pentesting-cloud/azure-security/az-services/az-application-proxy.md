# Az - Application Proxy

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Informa√ß√µes B√°sicas

[Do docs:](https://learn.microsoft.com/en-us/entra/identity/app-proxy/application-proxy)

O Application Proxy do Azure Active Directory fornece **acesso remoto seguro a aplica√ß√µes web locais**. Ap√≥s um **login √∫nico no Azure AD**, os usu√°rios podem acessar tanto **aplica√ß√µes em nuvem** quanto **aplica√ß√µes locais** atrav√©s de uma **URL externa** ou um portal de aplica√ß√£o interno.

Funciona assim:

<figure><img src="../../../.gitbook/assets/image (186).png" alt=""><figcaption></figcaption></figure>

1. Ap√≥s o usu√°rio acessar a aplica√ß√£o atrav√©s de um endpoint, o usu√°rio √© direcionado para a **p√°gina de login do Azure AD**.
2. Ap√≥s um **login bem-sucedido**, o Azure AD envia um **token** para o dispositivo cliente do usu√°rio.
3. O cliente envia o token para o **servi√ßo Application Proxy**, que recupera o nome principal do usu√°rio (UPN) e o nome principal de seguran√ßa (SPN) do token. **O Application Proxy ent√£o envia a solicita√ß√£o para o conector do Application Proxy**.
4. Se voc√™ configurou o login √∫nico, o conector realiza qualquer **autentica√ß√£o adicional** necess√°ria em nome do usu√°rio.
5. O conector envia a solicita√ß√£o para a **aplica√ß√£o local**.
6. A **resposta** √© enviada atrav√©s do conector e do servi√ßo Application Proxy **para o usu√°rio**.

## Enumera√ß√£o
```powershell
# Enumerate applications with application proxy configured
Get-AzureADApplication | %{try{Get-AzureADApplicationProxyApplication -ObjectId $_.ObjectID;$_.DisplayName;$_.ObjectID}catch{}}

# Get applications service principal
Get-AzureADServicePrincipal -All $true | ?{$_.DisplayName -eq "Name"}

# Use the following ps1 script from https://learn.microsoft.com/en-us/azure/active-directory/app-proxy/scripts/powershell-display-users-group-of-app
# to find users and groups assigned to the application. Pass the ObjectID of the Service Principal to it
Get-ApplicationProxyAssignedUsersAndGroups -ObjectId <object-id>
```
## Refer√™ncias

* [https://learn.microsoft.com/pt-br/azure/active-directory/app-proxy/application-proxy](https://learn.microsoft.com/pt-br/azure/active-directory/app-proxy/application-proxy)

{% hint style="success" %}
Aprenda e pratique Hacking AWS:<img src="../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">\
Aprenda e pratique Hacking GCP: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Suporte ao HackTricks</summary>

* Confira os [**planos de assinatura**](https://github.com/sponsors/carlospolop)!
* **Junte-se ao** üí¨ [**grupo do Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga**-nos no **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe truques de hacking enviando PRs para o** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) reposit√≥rios do github.

</details>
{% endhint %}
