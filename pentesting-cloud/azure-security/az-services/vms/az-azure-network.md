# Az - Azure Network

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** 💬 [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Basic Information

Azure içindeki ağlar, çeşitli Azure hizmetleri ve kaynakları arasında **bağlantı ve iletişim** sağlamak için bulut bilişim platformunun ayrılmaz bir parçası olarak işlev görür. Azure'daki ağ mimarisi, yüksek ölçeklenebilirlik, güvenlik ve özelleştirilebilirlik sağlamak üzere tasarlanmıştır.

Temelinde, Azure, kullanıcıların Azure bulutunda **izole** **ağlar** oluşturmasına olanak tanıyan bir **sanaldan ağ (VNet)** sağlar. Bu VNets içinde, sanal makineler, uygulamalar ve veritabanları gibi kaynaklar güvenli bir şekilde barındırılabilir ve yönetilebilir. Azure'daki ağ, hem bulut içindeki iletişimi (Azure hizmetleri arasında) hem de dış ağlara ve internete bağlantıyı destekler.

**Güvenlik**, Azure ağlarının kritik bir yönüdür ve verileri korumak, erişimi yönetmek ve uyumluluğu sağlamak için çeşitli araçlar ve hizmetler mevcuttur. Bu güvenlik önlemleri, trafiği ve erişimi kontrol etme konusunda yüksek bir düzey sağlamak için **güvenlik duvarları**, **ağ güvenlik grupları** ve **şifreleme** yeteneklerini içerir.

Genel olarak, Azure'ın ağ yetenekleri, kullanıcıların belirli uygulama ve iş yükü ihtiyaçlarına uygun bir ağ ortamı oluşturmasına olanak tanırken güvenlik ve güvenilirliğe güçlü bir vurgu yapacak şekilde tasarlanmıştır.

## Virtual Network (VNET) & Subnets

Azure'daki bir VNet, esasen buluttaki kendi ağınızın bir temsilidir. Bu, **abone olduğunuz Azure bulutunun mantıksal izolasyonudur**. Bir VNet, Azure'da sanal özel ağlar (VPN'ler) oluşturmanıza ve yönetmenize olanak tanır ve **birden fazla türde Azure kaynağını** barındırmak ve **yönetmek** için kullanılabilir; örneğin Sanal Makineler (VM'ler), veritabanları ve uygulama hizmetleri.

VNets, **IP adresi** aralıkları, alt ağ oluşturma, yönlendirme tabloları ve ağ geçitleri dahil olmak üzere ağ ayarlarınız üzerinde **tam kontrol** sağlar.

Bir **alt ağ**, VNet'inizdeki **IP adresleri aralığıdır**. Bir VNet'i organizasyon ve güvenlik için birden fazla alt ağa bölebilirsiniz. Bir VNet'teki her alt ağ, kaynakları ağ ve uygulama mimarinize göre izole etmek ve gruplamak için kullanılabilir.

Ayrıca, alt ağlar, VNet'inizi bir veya daha fazla alt ağa **bölmenize** olanak tanır ve kaynakların kullanabileceği bir IP adresi aralığı sağlar.

### **Example**

* Diyelim ki `MyVNet` adında bir VNet'iniz var ve IP adresi aralığı `10.0.0.0/16`. Bu VNet içinde, web sunucularınızı barındırmak için `10.0.0.0/24` IP adresi aralığına sahip `Subnet-1` adında bir alt ağ oluşturabilirsiniz. `10.0.1.0/24` aralığına sahip başka bir alt ağ, `Subnet-2`, veritabanı sunucularınız için kullanılabilir. Bu segmentasyon, ağ içinde verimli yönetim ve güvenlik kontrolleri sağlar.

### Enumeration

Azure hesabındaki tüm VNets ve alt ağları listelemek için Azure Komut Satırı Arayüzü (CLI) kullanabilirsiniz. İşte adımlar: 

{% code overflow="wrap" %}
```bash
# List VNets
az network vnet list --query "[].{name:name, location:location, addressSpace:addressSpace}" -o table

# List subnets of a VNet
az network vnet subnet list --resource-group <ResourceGroupName> --vnet-name <VNetName> --query "[].{name:name, addressPrefix:addressPrefix}" -o table
```
{% endcode %}

## Ağ Güvenlik Grupları (NSG)

Azure'da, bir **Ağ Güvenlik Grubu (NSG)**, Azure Sanal Ağı (VNet) içindeki Azure kaynaklarına giden ve gelen ağ trafiğini filtrelemenin ana işlevini yerine getirir. Ağ trafiğinin akışını titizlikle belirleyen bir dizi **güvenlik kuralı** barındırır.

NSG'nin ana yönleri şunlardır:

* **Trafik Kontrolü**: Her NSG, çeşitli Azure kaynaklarıyla ilişkili gelen ve giden ağ trafiğini ya izin verme ya da engelleme konusunda etkili olan kurallar içerir.
* **Kural Bileşenleri**: Bir NSG içindeki kurallar son derece spesifiktir ve trafiği kaynak/hedef IP adresi, port ve protokol gibi kriterlere göre filtreler. Bu spesifiklik, ağ trafiğinin ayrıntılı yönetimini sağlar.
* **Güvenlik Artışı**: Sadece yetkilendirilmiş trafiğin Azure kaynaklarınıza girmesine veya çıkmasına izin vererek, NSG'ler ağ altyapınızın güvenlik duruşunu güçlendirmede kritik bir rol oynar.

### **Örnek**

* VNet'inizde bir alt ağa veya belirli bir sanal makineye uygulanan `MyNSG` adlı bir NSG'niz olduğunu hayal edin. Aşağıdaki gibi kurallar oluşturabilirsiniz:
* Herhangi bir kaynaktan web sunucularınıza HTTP trafiğine (port 80) izin veren bir gelen kural.
* Belirli bir hedef IP adresi aralığına yalnızca SQL trafiğine (port 1433) izin veren bir giden kural.

### Sayım

{% code overflow="wrap" %}
```bash
# List NSGs
az network nsg list --query "[].{name:name, location:location}" -o table

# Get NSG rules
az network nsg rule list --nsg-name <NSGName> --resource-group <ResourceGroupName> --query "[].{name:name, priority:priority, direction:direction, access:access, protocol:protocol, sourceAddressPrefix:sourceAddressPrefix, destinationAddressPrefix:destinationAddressPrefix, sourcePortRange:sourcePortRange, destinationPortRange:destinationPortRange}" -o table
```
{% endcode %}

## Azure Firewall

Azure Firewall, **Azure Sanal Ağ kaynaklarınızı koruyan yönetilen, bulut tabanlı bir ağ güvenlik hizmetidir**. Yüksek kullanılabilirlik ve ölçeklenebilirlik özellikleri ile tamamen durum bilgisi olan bir hizmet olarak sunulan bir güvenlik duvarıdır.

Azure Firewall, **NSG'lerden daha gelişmiş** özellikler sunar; bunlar arasında **uygulama düzeyinde filtreleme**, ağ düzeyinde filtreleme, tehdit istihbaratına dayalı filtreleme ve günlükleme ve analiz için Azure Monitor ile entegrasyon bulunmaktadır.\
Çıkış, giriş, spoke-to-spoke, VPN ve ExpressRoute trafiğini filtreleyebilir. **Güvenlik duvarı kuralları FQDN (Tam Nitelikli Alan Adı), IP adresleri ve portlara dayalı olarak oluşturulabilir.**

### Azure Firewall ve NSG'ler Arasındaki Farklar

1. **Kapsam:**
* **NSG:** Alt ağ veya ağ arayüzü düzeyinde çalışır. Ağ arayüzlerinden (NIC), VM'lerden veya alt ağlardan gelen ve giden trafiğin temel filtrelemesini sağlamak için tasarlanmıştır.
* **Azure Firewall:** VNet düzeyinde çalışır ve daha geniş bir koruma kapsamı sunar. Sanal ağ kaynaklarınızı güvence altına almak ve VNet'e giren ve çıkan trafiği yönetmek için tasarlanmıştır.
2. **Yetenekler:**
* **NSG:** IP adresi, port ve protokole dayalı temel filtreleme yetenekleri sunar. Uygulama düzeyinde denetim veya tehdit istihbaratı gibi gelişmiş özellikleri desteklemez.
* **Azure Firewall:** Uygulama düzeyinde (Katman 7) trafik filtreleme, tehdit istihbaratına dayalı filtreleme, ağ trafiği filtreleme gibi gelişmiş özellikler sunar. Ayrıca birden fazla genel IP adresini destekler.
3. **Kullanım Senaryoları:**
* **NSG:** Temel ağ düzeyinde trafik filtreleme için idealdir.
* **Azure Firewall:** Uygulama düzeyinde kontrol, günlükleme ve tehdit istihbaratının gerekli olduğu daha karmaşık filtreleme senaryoları için uygundur.
4. **Yönetim ve İzleme:**
* **NSG:** Temel günlükleme ve Azure Monitor ile entegrasyon sunar.
* **Azure Firewall:** Azure Monitor aracılığıyla gelişmiş günlükleme ve analiz yetenekleri sağlar; bu, trafiğin doğasını ve desenini anlamak için gereklidir.

### Enumeration

{% code overflow="wrap" %}
```bash
# List Azure Firewalls
az network firewall list --query "[].{name:name, location:location, subnet:subnet, publicIp:publicIp}" -o table

# Get network rules of a firewall
az network firewall network-rule collection list --firewall-name <FirewallName> --resource-group <ResourceGroupName> --query "[].{name:name, rules:rules}" -o table

# Get application rules of a firewall
az network firewall application-rule collection list --firewall-name <FirewallName> --resource-group <ResourceGroupName> --query "[].{name:name, rules:rules}" -o table

# Get nat rules of a firewall
az network firewall nat-rule collection list --firewall-name <FirewallName> --resource-group <ResourceGroupName> --query "[].{name:name, rules:rules}" -o table
```
{% endcode %}

## Ağ Sanal Cihazı (NVA)

Ağ Sanal Cihazı (**NVA**) Azure'da **sanal bir ağ işlevi** gerçekleştiren bir sanal cihazdır. NVAlar genellikle Azure'da **doğal olarak mevcut olmayan** ağ işlevleri için veya daha fazla özelleştirme gerektiğinde kullanılır. Temelde, **ağ uygulamaları veya hizmetleri** çalıştıran **VM'lerdir**, örneğin güvenlik duvarları, WAN optimizasyon cihazları veya yük dengeleyiciler.

NVAlar karmaşık yönlendirme, **güvenlik** ve **ağ trafiği yönetimi** görevleri için kullanılır. Azure **Marketplace**'ten dağıtılabilirler; burada birçok üçüncü taraf satıcı, Azure ortamlarına entegrasyon için hazır cihazlarını sunar.

### **Örnek**

* Bir kuruluş, Azure'da **özel bir güvenlik duvarı çözümü** oluşturmak için bir NVA dağıtabilir. Bu NVA, **üçüncü taraf bir güvenlik duvarı yazılımı** çalıştırabilir ve saldırı tespiti, paket inceleme veya VPN bağlantısı gibi gelişmiş özellikler sunabilir. NVA, üzerinden geçen trafiği incelemek ve filtrelemek için yapılandırılabilir, böylece kuruluşun politikalarına uygun olarak geliştirilmiş güvenlik önlemlerinin uygulanmasını sağlar.

### **Sıralama**

{% code overflow="wrap" %}
```bash
# Usually NVAs are named or tagged in a way to distinguish them from other VMs
az vm list --query "[].{name:name, resourceGroup:resourceGroup, location:location}" -o table

# For a specific VM identified as an NVA, list its network interfaces
az vm nic list --vm-name <VMName> --resource-group <ResourceGroupName> --query "[].{id:id}" -o table
```
{% endcode %}

## Azure Route Tables & User Defined Routes (UDR)

**Azure Route Tables**, Microsoft Azure içinde **Azure Sanal Ağları (VNet)** içindeki ağ trafiği yönlendirmesini kontrol etme özelliğidir. Temelde, **paketlerin** VNet'ler içindeki alt ağlar arasında, VNet'ler arasında veya dış ağlara nasıl **iletileceğini** tanımlar. Her yönlendirme tablosu, paketlerin hedef IP adreslerine göre nasıl yönlendirilmesi gerektiğini belirten, yönlendirme olarak bilinen bir dizi kural içerir.

**User Defined Routes (UDR)**, Azure'da **Azure Route Tables içinde oluşturduğunuz özel yönlendirmelerdir** ve Azure Sanal Ağları (VNet) içindeki ve arasındaki ağ trafiğinin akışını kontrol etmek için kullanılır, ayrıca dış bağlantılar için de geçerlidir. UDR'ler, ağ trafiğini belirli gereksinimlerinize göre yönlendirme esnekliği sağlar ve Azure'un varsayılan yönlendirme kararlarını geçersiz kılmanıza olanak tanır.

Bu yönlendirmeler, trafiği bir sanal cihazdan geçirmek, güvenlik veya politika uyumluluğu için belirli bir yolu zorunlu kılmak veya yerel ağlarla entegrasyon sağlamak gerektiği senaryolar için özellikle faydalıdır.

### **Örnek**

* Diyelim ki, bir VNet içindeki alt ağlar arasında trafiği denetlemek için bir Ağ Sanal Cihazı (NVA) dağıttınız. Bir alt ağdan diğer bir alt ağa giden tüm trafiği NVA üzerinden yönlendiren bir UDR oluşturabilirsiniz. Bu UDR, trafiğin hedefe ulaşmadan önce güvenlik amaçları için NVA tarafından denetlenmesini sağlar.

### **Enumeration**

{% code overflow="wrap" %}
```bash
# List Route Tables
az network route-table list --query "[].{name:name, resourceGroup:resourceGroup, location:location}" -o table

# List UDRs for a table
az network route-table route list --route-table-name <RouteTableName> --resource-group <ResourceGroupName> --query "[].{name:name, addressPrefix:addressPrefix, nextHopType:nextHopType, nextHopIpAddress:nextHopIpAddress}" -o table
```
{% endcode %}

## Azure Özel Bağlantı

Azure Özel Bağlantı, **Azure hizmetlerine özel erişim sağlamayı** mümkün kılan bir hizmettir; bu, **Azure sanal ağınız (VNet) ile hizmet arasındaki trafiğin tamamen Microsoft'un Azure omurga ağı içinde seyahat etmesini sağlar**. Bu yapı, hizmeti VNet'inize getirir. Bu kurulum, verileri genel internete maruz bırakmadığı için güvenliği artırır.

Özel Bağlantı, Azure Depolama, Azure SQL Veritabanı ve Özel Bağlantı aracılığıyla paylaşılan özel hizmetler gibi çeşitli Azure hizmetleri ile kullanılabilir. Kendi VNet'inizden veya farklı Azure aboneliklerinden hizmetleri tüketmenin güvenli bir yolunu sağlar.

{% hint style="danger" %}
NSG'ler özel uç noktalara uygulanmaz, bu da bir NSG'yi Özel Bağlantıyı içeren bir alt ağa ilişkilendirmenin hiçbir etkisi olmayacağı anlamına gelir.
{% endhint %}

### **Örnek**

* **VNet'inizden güvenli bir şekilde erişmek istediğiniz bir Azure SQL Veritabanı** senaryosunu düşünün. Normalde, bu genel internet üzerinden geçiş yapmayı gerektirebilir. Özel Bağlantı ile, Azure SQL Veritabanı hizmetine doğrudan bağlanan **VNet'inizde bir özel uç nokta oluşturabilirsiniz**. Bu uç nokta, veritabanını kendi VNet'inizin bir parçasıymış gibi gösterir ve özel bir IP adresi aracılığıyla erişilebilir hale getirir, böylece güvenli ve özel erişim sağlanır.

### **Sıralama**

{% code overflow="wrap" %}
```bash
# List Private Link Services
z network private-link-service list --query "[].{name:name, location:location, resourceGroup:resourceGroup}" -o table

# List Private Endpoints
az network private-endpoint list --query "[].{name:name, location:location, resourceGroup:resourceGroup, privateLinkServiceConnections:privateLinkServiceConnections}" -o table
```
{% endcode %}

## Azure Servis Uç Noktaları

Azure Servis Uç Noktaları, sanal ağınızın özel adres alanını ve VNet'inizin kimliğini doğrudan bir bağlantı üzerinden Azure hizmetlerine genişletir. Servis uç noktalarını etkinleştirerek, **VNet'inizdeki kaynaklar Azure hizmetlerine güvenli bir şekilde bağlanabilir**, örneğin Azure Storage ve Azure SQL Database, Azure'ın omurga ağı kullanılarak. Bu, **VNet'ten Azure hizmetine giden trafiğin Azure ağı içinde kalmasını sağlar**, daha güvenli ve güvenilir bir yol sunar.

### **Örnek**

* Örneğin, bir **Azure Storage** hesabı varsayılan olarak genel internet üzerinden erişilebilir. **VNet'iniz içinde Azure Storage için bir servis uç noktası etkinleştirerek**, yalnızca VNet'inizden gelen trafiğin depolama hesabına erişmesini sağlayabilirsiniz. Depolama hesabı güvenlik duvarı, yalnızca VNet'inizden gelen trafiği kabul edecek şekilde yapılandırılabilir.

### **Sıralama**

{% code overflow="wrap" %}
```bash
# List Virtual Networks with Service Endpoints
az network vnet list --query "[].{name:name, location:location, serviceEndpoints:serviceEndpoints}" -o table

# List Subnets with Service Endpoints
az network vnet subnet list --resource-group <ResourceGroupName> --vnet-name <VNetName> --query "[].{name:name, serviceEndpoints:serviceEndpoints}" -o table
```
{% endcode %}

### Service Endpoint'leri ve Özel Bağlantılar Arasındaki Farklar

Microsoft, [**docs**](https://learn.microsoft.com/en-us/azure/virtual-network/vnet-integration-for-azure-services#compare-private-endpoints-and-service-endpoints) sayfasında Özel Bağlantıların kullanılmasını önermektedir: \\

<figure><img src="../../../../.gitbook/assets/image (25).png" alt=""><figcaption></figcaption></figure>

**Service Endpoint'leri:**

* VNet'inizden Azure hizmetine giden trafik, kamu internetini atlayarak Microsoft Azure omurga ağı üzerinden geçer.
* Endpoint, Azure hizmetine doğrudan bir bağlantıdır ve VNet içinde hizmet için özel bir IP sağlamaz.
* Hizmetin kendisi, hizmet güvenlik duvarını bu tür trafiği engelleyecek şekilde yapılandırmadığınız sürece, VNet'iniz dışından kamu endpoint'i aracılığıyla hala erişilebilir.
* Alt ağ ile Azure hizmeti arasında bire bir ilişki vardır.
* Özel Bağlantılardan daha az maliyetlidir.

**Özel Bağlantılar:**

* Özel Bağlantı, Azure hizmetlerini VNet'inize özel bir endpoint aracılığıyla haritalar; bu, VNet'iniz içinde özel bir IP adresine sahip bir ağ arayüzüdür.
* Azure hizmetine bu özel IP adresi kullanılarak erişilir, bu da onu ağınızın bir parçası gibi gösterir.
* Özel Bağlantı aracılığıyla bağlanan hizmetlere yalnızca VNet'inizden veya bağlı ağlardan erişilebilir; hizmete kamu internet erişimi yoktur.
* Azure hizmetlerine veya Azure'da barındırılan kendi hizmetlerinize güvenli bir bağlantı sağlar ve başkaları tarafından paylaşılan hizmetlere de bağlantı sunar.
* VNet'inizde özel bir endpoint aracılığıyla daha ayrıntılı erişim kontrolü sağlar; bu, service endpoint'leri ile alt ağ düzeyinde daha geniş erişim kontrolüne kıyasla daha özelleşmiş bir kontrol sunar.

Özetle, hem Service Endpoint'leri hem de Özel Bağlantılar Azure hizmetlerine güvenli bağlantı sağlarken, **Özel Bağlantılar, hizmetlerin kamu internetine maruz kalmadan özel olarak erişilmesini sağlayarak daha yüksek bir izolasyon ve güvenlik seviyesi sunar**. Öte yandan, Service Endpoint'leri, VNet içinde özel bir IP gerektirmeden Azure hizmetlerine basit ve güvenli erişim gereken genel durumlar için daha kolay bir şekilde kurulabilir.

## Azure Front Door (AFD) & AFD WAF

**Azure Front Door**, **küresel web uygulamalarınızın hızlı teslimatı** için ölçeklenebilir ve güvenli bir giriş noktasıdır. **Küresel yük dengeleme, site hızlandırma, SSL yük dengelemesi ve Web Uygulama Güvenlik Duvarı (WAF)** yetenekleri gibi çeşitli hizmetleri tek bir hizmette **birleştirir**. Azure Front Door, **kullanıcıya en yakın kenar konumuna** dayalı akıllı yönlendirme sağlar, böylece optimal performans ve güvenilirlik sunar. Ayrıca, URL tabanlı yönlendirme, çoklu site barındırma, oturum bağlılığı ve uygulama katmanı güvenliği sunar.

**Azure Front Door WAF**, **web tabanlı saldırılardan web uygulamalarını korumak** için tasarlanmıştır ve arka uç kodunda değişiklik gerektirmez. SQL enjeksiyonu, çapraz site betikleme ve diğer yaygın saldırılar gibi tehditlere karşı korumak için özel kurallar ve yönetilen kural setleri içerir.

### **Örnek**

* Dünyanın dört bir yanında kullanıcıları olan küresel bir dağıtım uygulamanız olduğunu hayal edin. Azure Front Door'u kullanarak **kullanıcı isteklerini uygulamanızı barındıran en yakın bölgesel veri merkezine yönlendirebilirsiniz**, böylece gecikmeyi azaltır, kullanıcı deneyimini iyileştirir ve **WAF yetenekleri ile web saldırılarına karşı savunursunuz**. Belirli bir bölge kesintiye uğrarsa, Azure Front Door otomatik olarak trafiği bir sonraki en iyi konuma yönlendirebilir, böylece yüksek kullanılabilirlik sağlar.

### Enumeration

{% code overflow="wrap" %}
```bash
# List Azure Front Door Instances
az network front-door list --query "[].{name:name, resourceGroup:resourceGroup, location:location}" -o table

# List Front Door WAF Policies
az network front-door waf-policy list --query "[].{name:name, resourceGroup:resourceGroup, location:location}" -o table
```
{% endcode %}

## Azure Uygulama Geçidi ve Azure Uygulama Geçidi WAF

Azure Uygulama Geçidi, **web** uygulamalarınıza trafik yönetmenizi sağlayan bir **web trafiği yük dengeleyici**dir. **Katman 7 yük dengeleme, SSL sonlandırma ve web uygulama güvenlik duvarı (WAF) yetenekleri** sunar. Ana özellikler arasında URL tabanlı yönlendirme, çerez tabanlı oturum bağlılığı ve güvenli soket katmanı (SSL) yük dengelemesi bulunur; bu özellikler, küresel yönlendirme ve yol tabanlı yönlendirme gibi karmaşık yük dengeleme yetenekleri gerektiren uygulamalar için kritik öneme sahiptir.

### Örnek

* Kullanıcı hesapları ve ödeme işlemleri gibi farklı işlevler için birden fazla alt alan içeren bir e-ticaret web siteniz olduğunu düşünün. Azure Uygulama Geçidi, **URL yolu temelinde uygun web sunucularına trafiği yönlendirebilir**. Örneğin, `example.com/accounts` adresine gelen trafik kullanıcı hesapları hizmetine yönlendirilebilir ve `example.com/pay` adresine gelen trafik ödeme işleme hizmetine yönlendirilebilir.\
Ve **WAF yeteneklerini kullanarak web sitenizi saldırılardan koruyun.**

### **Enumeration**

{% code overflow="wrap" %}
```bash
# List the Web Application Firewall configurations for your Application Gateways
az network application-gateway waf-config list --gateway-name <AppGatewayName> --resource-group <ResourceGroupName> --query "[].{name:name, firewallMode:firewallMode, ruleSetType:ruleSetType, ruleSetVersion:ruleSetVersion}" -o table
```
{% endcode %}

## Azure Hub, Spoke & VNet Peering

**VNet Peering**, Azure'da **farklı Sanal Ağların (VNet'lerin) doğrudan ve kesintisiz bir şekilde bağlanmasını sağlayan** bir ağ özelliğidir. VNet peering aracılığıyla, bir VNet'teki kaynaklar, **sanki aynı ağdaymış gibi** başka bir VNet'teki kaynaklarla özel IP adresleri kullanarak iletişim kurabilir.\
**VNet Peering, yerel ağlarla da kullanılabilir**; bir site-to-site VPN veya Azure ExpressRoute kurarak.

**Azure Hub ve Spoke**, Azure'da ağ trafiğini yönetmek ve organize etmek için kullanılan bir ağ topolojisidir. **"Hub", farklı "spokelar" arasındaki trafiği kontrol eden ve yönlendiren merkezi bir noktadır**. Hub genellikle ağ sanal cihazları (NVA'lar), Azure VPN Gateway, Azure Firewall veya Azure Bastion gibi paylaşılan hizmetleri içerir. **"Spokelar", iş yüklerini barındıran ve hub'a VNet peering kullanarak bağlanan VNNet'lerdir**, böylece hub içindeki paylaşılan hizmetlerden yararlanabilirler. Bu model, farklı VNet'ler arasında birden fazla iş yükünün kullanabileceği ortak hizmetleri merkezileştirerek karmaşıklığı azaltarak temiz bir ağ düzenini teşvik eder.

{% hint style="danger" %}
**VNET eşleştirmesi Azure'da geçişken değildir**, bu da demektir ki eğer spoke 1, spoke 2'ye bağlıysa ve spoke 2, spoke 3'e bağlıysa, spoke 1 doğrudan spoke 3 ile iletişim kuramaz.
{% endhint %}

### Örnekler

* Satış, İK ve Geliştirme gibi ayrı departmanlara sahip bir şirketi hayal edin, **her birinin kendi VNet'i (spokelar)** vardır. Bu VNNet'ler, **bir merkezi veritabanı, bir güvenlik duvarı ve bir internet geçidi gibi paylaşılan kaynaklara erişim gerektirir**, bunların hepsi **başka bir VNet'te (hub)** bulunmaktadır. Hub ve Spoke modelini kullanarak, her departman **bu paylaşılan kaynaklara hub VNet aracılığıyla güvenli bir şekilde bağlanabilir ve bu kaynakları kamu internetine açmadan** veya çok sayıda bağlantı ile karmaşık bir ağ yapısı oluşturmadan erişebilir.

### Enumeration

{% code overflow="wrap" %}
```bash
# List all VNets in your subscription
az network vnet list --query "[].{name:name, location:location, addressSpace:addressSpace}" -o table

# List VNet peering connections for a given VNet
az network vnet peering list --resource-group <ResourceGroupName> --vnet-name <VNetName> --query "[].{name:name, peeringState:peeringState, remoteVnetId:remoteVnetId}" -o table

# List Shared Resources (e.g., Azure Firewall) in the Hub
az network firewall list --query "[].{name:name, location:location, resourceGroup:resourceGroup}" -o table
```
{% endcode %}

## Site-to-Site VPN

Azure'daki Site-to-Site VPN, **yerel ağınızı Azure Sanal Ağı (VNet) ile bağlamanıza** olanak tanır ve Azure içindeki VM'ler gibi kaynakların yerel ağınızda varmış gibi görünmesini sağlar. Bu bağlantı, iki ağ arasındaki trafiği **şifreleyen bir VPN geçidi aracılığıyla** kurulur.

### **Örnek**

* New York'ta ana ofisi bulunan bir işletmenin, Azure'daki VNet'ine güvenli bir şekilde bağlanması gereken yerel bir veri merkezi vardır. **Site-to-Site VPN kurarak, şirket yerel sunucular ile Azure VM'leri arasında şifreli bir bağlantı sağlayabilir**, böylece kaynaklara her iki ortamda da sanki aynı yerel ağdaymış gibi güvenli bir şekilde erişilebilir.

### **Enumeration**

{% code overflow="wrap" %}
```bash
# List VPN Gateways
az network vnet-gateway list --query "[].{name:name, location:location, resourceGroup:resourceGroup}" -o table

# List VPN Connections
az network vpn-connection list --gateway-name <VpnGatewayName> --resource-group <ResourceGroupName> --query "[].{name:name, connectionType:connectionType, connectionStatus:connectionStatus}" -o table
```
{% endcode %}

## Azure ExpressRoute

Azure ExpressRoute, **yerel altyapınız ile Azure veri merkezleri arasında özel, ayrılmış, yüksek hızlı bir bağlantı sağlayan bir hizmettir**. Bu bağlantı, kamu internetini atlayarak bir bağlantı sağlayıcısı aracılığıyla yapılır ve tipik internet bağlantılarından daha fazla güvenilirlik, daha hızlı hızlar, daha düşük gecikmeler ve daha yüksek güvenlik sunar.

### **Örnek**

* Bir çok uluslu şirket, **yüksek veri hacmi ve yüksek veri akışı ihtiyacı nedeniyle Azure hizmetlerine tutarlı ve güvenilir bir bağlantı gerektirir**. Şirket, yerel veri merkezini doğrudan Azure'a bağlamak için Azure ExpressRoute'u tercih eder, böylece günlük yedeklemeler ve gerçek zamanlı veri analitiği gibi büyük ölçekli veri transferlerini artırılmış gizlilik ve hız ile kolaylaştırır.

### **Enumeration**

{% code overflow="wrap" %}
```bash
# List ExpressRoute Circuits
az network express-route list --query "[].{name:name, location:location, resourceGroup:resourceGroup, serviceProviderName:serviceProviderName, peeringLocation:peeringLocation}" -o table
```
{% endcode %}

{% hint style="success" %}
AWS Hacking'i öğrenin ve pratik yapın:<img src="../../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">[**HackTricks Eğitim AWS Kırmızı Takım Uzmanı (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">\
GCP Hacking'i öğrenin ve pratik yapın: <img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Eğitim GCP Kırmızı Takım Uzmanı (GRTE)**<img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**abonelik planlarını**](https://github.com/sponsors/carlospolop) kontrol edin!
* **💬 [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katılın ya da **Twitter'da** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**'i takip edin.**
* **Hacking ipuçlarını paylaşmak için** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna PR gönderin.

</details>
{% endhint %}
