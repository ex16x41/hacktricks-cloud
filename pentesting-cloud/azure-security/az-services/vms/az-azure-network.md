# Az - Azure Network

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** 游눫 [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** 游냕 [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Basic Information

Mre쬰 unutar Azure funkcioni코u kao integralni deo njegove platforme za cloud ra캜unarstvo, omogu캖avaju캖i **povezivanje i komunikaciju izme캠u razli캜itih Azure usluga i resursa**. Arhitektura mre쬰 u Azure je dizajnirana da bude visoko skalabilna, sigurna i prilagodljiva.

U svojoj su코tini, Azure pru쬬 **virtuelnu mre쬿 (VNet)** koja omogu캖ava korisnicima da kreiraju **izolovane** **mre쬰** unutar Azure cloud-a. Unutar ovih VNeta, resursi kao 코to su virtuelne ma코ine, aplikacije i baze podataka mogu biti sigurno hostovani i upravljani. Mre쬹o povezivanje u Azure podr쬬va kako komunikaciju unutar cloud-a (izme캠u Azure usluga), tako i povezivanje sa spoljnim mre쬬ma i internetom.

**Bezbednost** je kriti캜an aspekt Azure mre쬹og povezivanja, sa raznim alatima i uslugama dostupnim za za코titu podataka, upravljanje pristupom i osiguranje uskla캠enosti. Ove mere bezbednosti uklju캜uju **vatrozide**, **grupe za mre쬹u bezbednost** i **mogu캖nosti enkripcije**, omogu캖avaju캖i visok nivo kontrole nad saobra캖ajem i pristupom.

Sve u svemu, Azure-ove mre쬹e mogu캖nosti su dizajnirane da ponude fleksibilnost, omogu캖avaju캖i korisnicima da kreiraju mre쬹o okru쬰nje koje odgovara njihovim specifi캜nim potrebama aplikacija i radnog optere캖enja, dok odr쬬vaju sna쬬n naglasak na bezbednosti i pouzdanosti.

## Virtual Network (VNET) & Subnets

VNet u Azure-u je u su코tini reprezentacija va코e vlastite mre쬰 u cloud-u. To je **logi캜ka izolacija Azure cloud-a posve캖ena va코oj pretplati**. VNet vam omogu캖ava da obezbedite i upravljate virtuelnim privatnim mre쬬ma (VPN) u Azure-u i mo쬰 se koristiti za hostovanje i **upravljanje vi코e vrsta Azure resursa**, kao 코to su virtuelne ma코ine (VM), baze podataka i usluge aplikacija.

VNets vam pru쬬ju **potpunu kontrolu nad pode코avanjima va코e mre쬰**, uklju캜uju캖i **IP adrese** opsege, kreiranje podmre쬬, tabele ruta i mre쬹e prolaze.

**Podmre쬬** je **opseg IP adresa u va코em VNet-u**. Mo쬰te podeliti VNet na vi코e podmre쬬 radi organizacije i bezbednosti. Svaka podmre쬬 u VNet-u mo쬰 se koristiti za izolaciju i grupisanje resursa prema va코oj mre쬹oj i aplikacionoj arhitekturi.

Pored toga, podmre쬰 vam omogu캖avaju da **segmentirate svoj VNet u jednu ili vi코e podmre쬬**, pru쬬ju캖i opseg IP adresa koje resursi mogu koristiti.

### **Example**

* Pretpostavimo da imate VNet nazvan `MyVNet` sa opsegom IP adresa `10.0.0.0/16`. Mo쬰te kreirati podmre쬿 unutar ovog VNet-a, recimo `Subnet-1`, sa opsegom IP adresa `10.0.0.0/24` za hostovanje va코ih web servera. Druga podmre쬬, `Subnet-2` sa opsegom `10.0.1.0/24`, mogla bi se koristiti za va코e serverske baze podataka. Ova segmentacija omogu캖ava efikasno upravljanje i kontrole bezbednosti unutar mre쬰.

### Enumeration

Da biste naveli sve VNets i podmre쬰 u Azure nalogu, mo쬰te koristiti Azure Command-Line Interface (CLI). Evo koraka:

{% code overflow="wrap" %}
```bash
# List VNets
az network vnet list --query "[].{name:name, location:location, addressSpace:addressSpace}" -o table

# List subnets of a VNet
az network vnet subnet list --resource-group <ResourceGroupName> --vnet-name <VNetName> --query "[].{name:name, addressPrefix:addressPrefix}" -o table
```
{% endcode %}

## Network Security Groups (NSG)

U Azure-u, **Network Security Group (NSG)** ima primarnu funkciju filtriranja mre쬹og saobra캖aja kako prema tako i od Azure resursa unutar Azure Virtual Network (VNet). Sadr쬴 skup **bezbednosnih pravila** koja pa쬷jivo odre캠uju tok mre쬹og saobra캖aja.

Klju캜ni aspekti NSG uklju캜uju:

* **Kontrola saobra캖aja**: Svaki NSG sadr쬴 pravila koja su od su코tinskog zna캜aja za dozvoljavanje ili ometanje ulaznog i izlaznog mre쬹og saobra캖aja povezanog sa raznim Azure resursima.
* **Komponente pravila**: Pravila unutar NSG su veoma specifi캜na, filtriraju캖i saobra캖aj na osnovu kriterijuma kao 코to su izvorna/odredi코na IP adresa, port i protokol. Ova specifi캜nost omogu캖ava detaljno upravljanje mre쬹im saobra캖ajem.
* **Pove캖anje bezbednosti**: Osiguravaju캖i da samo autorizovani saobra캖aj mo쬰 u캖i ili iza캖i iz va코ih Azure resursa, NSG igra klju캜nu ulogu u ja캜anju bezbednosnog stava va코e mre쬹e infrastrukture.

### **Primer**

* Zamislite da imate NSG nazvan `MyNSG` primenjen na podmre쬿 ili specifi캜nu virtuelnu ma코inu unutar va코eg VNet-a. Mo쬰te kreirati pravila kao 코to su:
* Ulazno pravilo koje dozvoljava HTTP saobra캖aj (port 80) iz bilo kog izvora ka va코im web serverima.
* Izlazno pravilo koje dozvoljava samo SQL saobra캖aj (port 1433) ka specifi캜nom opsegu odredi코nih IP adresa.

### Enumeration

{% code overflow="wrap" %}
```bash
# List NSGs
az network nsg list --query "[].{name:name, location:location}" -o table

# Get NSG rules
az network nsg rule list --nsg-name <NSGName> --resource-group <ResourceGroupName> --query "[].{name:name, priority:priority, direction:direction, access:access, protocol:protocol, sourceAddressPrefix:sourceAddressPrefix, destinationAddressPrefix:destinationAddressPrefix, sourcePortRange:sourcePortRange, destinationPortRange:destinationPortRange}" -o table
```
{% endcode %}

## Azure Firewall

Azure Firewall je upravljana, cloud-bazirana **usluga bezbednosti mre쬰 koja 코titi va코e Azure Virtual Network resurse**. To je potpuno stanja svestan firewall kao usluga sa ugra캠enim funkcijama visoke dostupnosti i skalabilnosti.

Azure Firewall pru쬬 **naprednije** funkcije od **NSG**, uklju캜uju캖i **filtriranje na nivou aplikacije**, filtriranje na mre쬹om nivou, filtriranje zasnovano na obave코tajnim podacima o pretnjama i integraciju sa Azure Monitor za logovanje i analitiku.\
Mo쬰 filtrirati izlazni, ulazni, spoke-to-spoke, VPN i ExpressRoute saobra캖aj. **Pravila vatrozida mogu se kreirati na osnovu FQDN (Potpuno Kvalifikovano Ime Domen), IP adresa i portova**.

### Razlike izme캠u Azure Firewall i NSG

1. **Opseg:**
* **NSG:** Radi na nivou podmre쬰 ili mre쬹og interfejsa. Namenjen je za pru쬬nje osnovnog filtriranja ulaznog i izlaznog saobra캖aja sa mre쬹ih interfejsa (NIC), VM-ova ili podmre쬬.
* **Azure Firewall:** Operi코e na nivou VNet-a, pru쬬ju캖i 코iri opseg za코tite. Dizajniran je da obezbedi va코e resurse virtuelne mre쬰 i upravlja saobra캖ajem koji ulazi i izlazi iz VNet-a.
2. **Sposobnosti:**
* **NSG:** Pru쬬 osnovne mogu캖nosti filtriranja zasnovane na IP adresi, portu i protokolu. Ne podr쬬va napredne funkcije kao 코to su inspekcija na nivou aplikacije ili obave코tajni podaci o pretnjama.
* **Azure Firewall:** Nudi napredne funkcije kao 코to su filtriranje saobra캖aja na nivou aplikacije (Layer 7), filtriranje zasnovano na obave코tajnim podacima o pretnjama, filtriranje mre쬹og saobra캖aja i jo코 mnogo toga. Tako캠e podr쬬va vi코e javnih IP adresa.
3. **Slu캜ajevi kori코캖enja:**
* **NSG:** Idealno za osnovno filtriranje saobra캖aja na mre쬹om nivou.
* **Azure Firewall:** Prikladan za slo쬰nije scenarije filtriranja gde su potrebni kontrola na nivou aplikacije, logovanje i obave코tajni podaci o pretnjama.
4. **Upravljanje i nadgledanje:**
* **NSG:** Pru쬬 osnovno logovanje i integraciju sa Azure Monitor.
* **Azure Firewall:** Pru쬬 napredne mogu캖nosti logovanja i analitike putem Azure Monitor, 코to je od su코tinskog zna캜aja za razumevanje prirode i obrasca saobra캖aja.

### Enumeration

{% code overflow="wrap" %}
```bash
# List Azure Firewalls
az network firewall list --query "[].{name:name, location:location, subnet:subnet, publicIp:publicIp}" -o table

# Get network rules of a firewall
az network firewall network-rule collection list --firewall-name <FirewallName> --resource-group <ResourceGroupName> --query "[].{name:name, rules:rules}" -o table

# Get application rules of a firewall
az network firewall application-rule collection list --firewall-name <FirewallName> --resource-group <ResourceGroupName> --query "[].{name:name, rules:rules}" -o table

# Get nat rules of a firewall
az network firewall nat-rule collection list --firewall-name <FirewallName> --resource-group <ResourceGroupName> --query "[].{name:name, rules:rules}" -o table
```
{% endcode %}

## Network Virtual Appliance (NVA)

Network Virtual Appliance (**NVA**) u Azure-u je virtuelni ure캠aj koji **izvodi mre쬹e funkcije unutar virtuelne mre쬰**. NVA se obi캜no koriste za mre쬹e funkcije koje **nisu nativno dostupne** u Azure-u ili kada je potrebna ve캖a prilagodljivost. Oni su u su코tini **VM-ovi koji pokre캖u mre쬹e aplikacije ili usluge**, kao 코to su vatrozidi, WAN optimizatori ili balansatori optere캖enja.

NVA se koriste za slo쬰no usmeravanje, **bezbednost** i **upravljanje mre쬹im saobra캖ajem**. Mogu se implementirati iz Azure **Marketplace-a**, gde mnogi tre캖i dobavlja캜i nude svoje ure캠aje spremne za integraciju u Azure okru쬰nja.

### **Primer**

* Organizacija mo쬰 implementirati NVA u Azure-u kako bi kreirala **prilago캠eno re코enje za vatrozid**. Ovaj NVA mo쬰 pokretati **softver za vatrozid tre캖e strane**, pru쬬ju캖i napredne funkcije kao 코to su detekcija upada, inspekcija paketa ili VPN konektivnost. NVA se mo쬰 konfigurisati da inspekciju i filtrira saobra캖aj koji prolazi kroz njega, osiguravaju캖i da su pobolj코ane mere bezbednosti na snazi u skladu sa politikama organizacije.

### **Enumeracija**

{% code overflow="wrap" %}
```bash
# Usually NVAs are named or tagged in a way to distinguish them from other VMs
az vm list --query "[].{name:name, resourceGroup:resourceGroup, location:location}" -o table

# For a specific VM identified as an NVA, list its network interfaces
az vm nic list --vm-name <VMName> --resource-group <ResourceGroupName> --query "[].{id:id}" -o table
```
{% endcode %}

## Azure Route Tables & User Defined Routes (UDR)

**Azure Route Tables** su funkcija unutar Microsoft Azure koja omogu캖ava **kontrolu usmeravanja mre쬹og saobra캖aja unutar Azure Virtual Networks (VNets)**. Su코tinski, defini코u kako se **paketi** **prosle캠uju** izme캠u podmre쬬 unutar VNets, izme캠u VNets, ili ka spoljnim mre쬬ma. Svaka tabela ruta sadr쬴 skup pravila, poznatih kao rute, koja specificiraju kako paketi treba da se usmere na osnovu njihovih odredi코nih IP adresa.

**User Defined Routes (UDR)** u Azure su **prilago캠ene rute koje kreirate unutar Azure Route Tables** da kontroli코ete **tok mre쬹og saobra캖aja** unutar i izme캠u Azure Virtual Networks (VNets), kao i ka spoljnim konekcijama. UDR-ovi vam daju fleksibilnost da usmeravate mre쬹i saobra캖aj prema va코im specifi캜nim zahtevima, nadma코uju캖i Azure-ove podrazumevane odluke o usmeravanju.

Ove rute su posebno korisne za scenarije gde treba da **usmerite saobra캖aj kroz virtuelni ure캠aj**, nametnete specifi캜an put za bezbednost ili uskla캠enost sa politikama, ili integri코ete sa lokalnim mre쬬ma.

### **Primer**

* Pretpostavimo da ste implementirali Network Virtual Appliance (NVA) za inspekciju saobra캖aja izme캠u podmre쬬 unutar VNet-a. Mo쬰te kreirati UDR koji usmerava sav saobra캖aj iz jedne podmre쬰 u drugu podmre쬿 da ide kroz NVA. Ovaj UDR osigurava da NVA inspekciju saobra캖aja radi u svrhe bezbednosti pre nego 코to stigne do svog odredi코ta.

### **Enumeration**

{% code overflow="wrap" %}
```bash
# List Route Tables
az network route-table list --query "[].{name:name, resourceGroup:resourceGroup, location:location}" -o table

# List UDRs for a table
az network route-table route list --route-table-name <RouteTableName> --resource-group <ResourceGroupName> --query "[].{name:name, addressPrefix:addressPrefix, nextHopType:nextHopType, nextHopIpAddress:nextHopIpAddress}" -o table
```
{% endcode %}

## Azure Private Link

Azure Private Link je usluga u Azure-u koja **omogu캖ava privatni pristup Azure uslugama** osiguravaju캖i da **saobra캖aj izme캠u va코e Azure virtuelne mre쬰 (VNet) i usluge putuje potpuno unutar Microsoftove Azure backbone mre쬰**. Efikasno dovodi uslugu u va코u VNet. Ova postavka pobolj코ava bezbednost ne izla쬿캖i podatke javnom internetu.

Private Link se mo쬰 koristiti sa raznim Azure uslugama, kao 코to su Azure Storage, Azure SQL Database i prilago캠ene usluge deljene putem Private Link-a. Pru쬬 siguran na캜in za kori코캖enje usluga iz va코e vlastite VNet ili 캜ak iz razli캜itih Azure pretplata.

{% hint style="danger" %}
NSG-ovi se ne primenjuju na privatne krajnje ta캜ke, 코to jasno zna캜i da povezivanje NSG-a sa podmre쬺m koja sadr쬴 Private Link ne캖e imati efekta.
{% endhint %}

### **Primer**

* Razmotrite scenario u kojem imate **Azure SQL Database koju 쬰lite da pristupite sigurno iz va코e VNet**. Obi캜no bi to moglo uklju캜ivati prelazak preko javnog interneta. Sa Private Link-om, mo쬰te kreirati **privatnu krajnju ta캜ku u va코oj VNet** koja se direktno povezuje sa Azure SQL Database uslugom. Ova krajnja ta캜ka 캜ini da baza podataka izgleda kao da je deo va코e vlastite VNet, dostupna putem privatne IP adrese, 캜ime se osigurava siguran i privatni pristup.

### **Enumeracija**

{% code overflow="wrap" %}
```bash
# List Private Link Services
z network private-link-service list --query "[].{name:name, location:location, resourceGroup:resourceGroup}" -o table

# List Private Endpoints
az network private-endpoint list --query "[].{name:name, location:location, resourceGroup:resourceGroup, privateLinkServiceConnections:privateLinkServiceConnections}" -o table
```
{% endcode %}

## Azure Service Endpoints

Azure Service Endpoints pro코iruju privatni adresni prostor va코e virtuelne mre쬰 i identitet va코e VNet na Azure usluge preko direktne veze. Omogu캖avanjem servisnih krajnjih ta캜aka, **resursi u va코oj VNet mogu sigurno da se pove쬿 sa Azure uslugama**, kao 코to su Azure Storage i Azure SQL Database, koriste캖i Azure-ovu osnovnu mre쬿. Ovo osigurava da **saobra캖aj iz VNet-a ka Azure usluzi ostaje unutar Azure mre쬰**, pru쬬ju캖i sigurniji i pouzdaniji put.

### **Primer**

* Na primer, **Azure Storage** nalog je po defaultu dostupan preko javnog interneta. Omogu캖avanjem **servisne krajnje ta캜ke za Azure Storage unutar va코e VNet**, mo쬰te osigurati da samo saobra캖aj iz va코e VNet mo쬰 pristupiti nalogu za skladi코tenje. Zatim se mo쬰 konfigurisati vatrozid naloga za skladi코tenje da prihvata saobra캖aj samo iz va코e VNet.

### **Enumeracija**

{% code overflow="wrap" %}
```bash
# List Virtual Networks with Service Endpoints
az network vnet list --query "[].{name:name, location:location, serviceEndpoints:serviceEndpoints}" -o table

# List Subnets with Service Endpoints
az network vnet subnet list --resource-group <ResourceGroupName> --vnet-name <VNetName> --query "[].{name:name, serviceEndpoints:serviceEndpoints}" -o table
```
{% endcode %}

### Razlike izme캠u Servisnih Krajnih Ta캜aka i Privatnih Linkova

Microsoft preporu캜uje kori코캖enje Privatnih Linkova u [**docs**](https://learn.microsoft.com/en-us/azure/virtual-network/vnet-integration-for-azure-services#compare-private-endpoints-and-service-endpoints):\\

<figure><img src="../../../../.gitbook/assets/image (25).png" alt=""><figcaption></figcaption></figure>

**Servisne Krajne Ta캜ke:**

* Saobra캖aj iz va코eg VNet-a do Azure servisa putuje preko Microsoft Azure backbone mre쬰, zaobilaze캖i javni internet.
* Krajna ta캜ka je direktna veza sa Azure servisom i ne obezbe캠uje privatnu IP adresu za servis unutar VNet-a.
* Sam servis je i dalje dostupan putem svoje javne krajine ta캜ke sa spolja코nje strane va코eg VNet-a, osim ako ne konfiguri코ete vatrozid servisa da blokira takav saobra캖aj.
* To je odnos jedan na jedan izme캠u podmre쬰 i Azure servisa.
* Jeftinije je od Privatnih Linkova.

**Privatni Linkovi:**

* Privatni Link mapira Azure servise u va코 VNet putem privatne krajine ta캜ke, koja je mre쬹i interfejs sa privatnom IP adresom unutar va코eg VNet-a.
* Azure servis se pristupa koriste캖i ovu privatnu IP adresu, 캜ine캖i da izgleda kao da je deo va코e mre쬰.
* Servisi povezani putem Privatnog Linka mogu se pristupiti samo iz va코eg VNet-a ili povezanih mre쬬; nema javnog pristupa internetu do servisa.
* Omogu캖ava sigurnu vezu sa Azure servisima ili va코im sopstvenim servisima hostovanim u Azure-u, kao i vezu sa servisima koje dele drugi.
* Pru쬬 detaljniju kontrolu pristupa putem privatne krajine ta캜ke u va코em VNet-u, za razliku od 코ire kontrole pristupa na nivou podmre쬰 sa servisnim krajim ta캜kama.

Ukratko, dok i Servisne Krajne Ta캜ke i Privatni Linkovi pru쬬ju sigurnu povezanost sa Azure servisima, **Privatni Linkovi nude vi코i nivo izolacije i sigurnosti osiguravaju캖i da se servisi pristupaju privatno bez izlaganja javnom internetu**. Servisne Krajne Ta캜ke, s druge strane, lak코e se postavljaju za op코te slu캜ajeve gde je potrebna jednostavna, sigurna povezanost sa Azure servisima bez potrebe za privatnom IP adresom u VNet-u.

## Azure Front Door (AFD) & AFD WAF

**Azure Front Door** je skalabilna i sigurna ulazna ta캜ka za **brzu isporuku** va코ih globalnih web aplikacija. **Kombinuje** razli캜ite usluge kao 코to su globalno **optere캖enje balansiranje, ubrzanje sajta, SSL offloading i Web Application Firewall (WAF)** mogu캖nosti u jednu uslugu. Azure Front Door pru쬬 inteligentno usmeravanje na osnovu **najbli쬰 ivice lokacije korisniku**, osiguravaju캖i optimalne performanse i pouzdanost. Pored toga, nudi usmeravanje zasnovano na URL-u, vi코esajtno hostovanje, afinitet sesije i sigurnost na aplikacionom nivou.

**Azure Front Door WAF** je dizajniran da **코titi web aplikacije od napada zasnovanih na web-u** bez modifikacije pozadinskog koda. Uklju캜uje prilago캠ena pravila i upravljane skupove pravila za za코titu od pretnji kao 코to su SQL injekcija, cross-site scripting i drugi uobi캜ajeni napadi.

### **Primer**

* Zamislite da imate globalno distribuiranu aplikaciju sa korisnicima 코irom sveta. Mo쬰te koristiti Azure Front Door da **usmerite zahteve korisnika ka najbli쬰m regionalnom data centru** koji hostuje va코u aplikaciju, 캜ime se smanjuje latencija, pobolj코ava korisni캜ko iskustvo i **brani je od web napada sa WAF mogu캖nostima**. Ako odre캠ena regija do쬴vi prekid rada, Azure Front Door mo쬰 automatski preusmeriti saobra캖aj na slede캖u najbolju lokaciju, osiguravaju캖i visoku dostupnost.

### Enumeracija

{% code overflow="wrap" %}
```bash
# List Azure Front Door Instances
az network front-door list --query "[].{name:name, resourceGroup:resourceGroup, location:location}" -o table

# List Front Door WAF Policies
az network front-door waf-policy list --query "[].{name:name, resourceGroup:resourceGroup, location:location}" -o table
```
{% endcode %}

## Azure Application Gateway i Azure Application Gateway WAF

Azure Application Gateway je **balansir optere캖enja web saobra캖aja** koji vam omogu캖ava da upravljate saobra캖ajem ka va코im **web** aplikacijama. Pru쬬 **balansiranje optere캖enja na Layer 7, SSL terminaciju i mogu캖nosti vatrozida za web aplikacije (WAF)** u okviru usluge Application Delivery Controller (ADC). Klju캜ne karakteristike uklju캜uju usmeravanje zasnovano na URL-u, afinitet sesije zasnovan na kola캜i캖ima i preuzimanje sigurnih soketa (SSL), 코to je klju캜no za aplikacije koje zahtevaju slo쬰ne mogu캖nosti balansiranja optere캖enja kao 코to su globalno usmeravanje i usmeravanje zasnovano na putanji.

### Primer

* Razmotrite scenario u kojem imate e-commerce veb sajt koji uklju캜uje vi코e poddomena za razli캜ite funkcije, kao 코to su korisni캜ki nalozi i obrada pla캖anja. Azure Application Gateway mo쬰 **usmeriti saobra캖aj ka odgovaraju캖im web serverima na osnovu URL putanje**. Na primer, saobra캖aj ka `example.com/accounts` mogao bi biti usmeren ka servisu za korisni캜ke naloge, a saobra캖aj ka `example.com/pay` mogao bi biti usmeren ka servisu za obradu pla캖anja.\
I **za코titite va코u veb stranicu od napada koriste캖i WAF mogu캖nosti.**

### **Enumeracija**

{% code overflow="wrap" %}
```bash
# List the Web Application Firewall configurations for your Application Gateways
az network application-gateway waf-config list --gateway-name <AppGatewayName> --resource-group <ResourceGroupName> --query "[].{name:name, firewallMode:firewallMode, ruleSetType:ruleSetType, ruleSetVersion:ruleSetVersion}" -o table
```
{% endcode %}

## Azure Hub, Spoke & VNet Peering

**VNet Peering** je mre쬹a funkcija u Azure koja **omogu캖ava razli캜itim Virtuelnim Mre쬬ma (VNets) da budu direktno i neprimetno povezane**. Kroz VNet peering, resursi u jednoj VNet mogu komunicirati sa resursima u drugoj VNet koriste캖i privatne IP adrese, **kao da su u istoj mre쬴**.\
**VNet Peering se tako캠e mo쬰 koristiti sa lokalnim mre쬬ma** postavljanjem site-to-site VPN-a ili Azure ExpressRoute.

**Azure Hub i Spoke** je mre쬹a topologija koja se koristi u Azure za upravljanje i organizovanje mre쬹og saobra캖aja. **"Hub" je centralna ta캜ka koja kontroli코e i usmerava saobra캖aj izme캠u razli캜itih "spokova"**. Hub obi캜no sadr쬴 deljene usluge kao 코to su mre쬹i virtuelni ure캠aji (NVA), Azure VPN Gateway, Azure Firewall ili Azure Bastion. **"Spokovi" su VNets koje hostuju radne optere캖enja i povezuju se sa hub-om koriste캖i VNet peering**, omogu캖avaju캖i im da koriste deljene usluge unutar huba. Ovaj model promovi코e 캜ist raspored mre쬰, smanjuju캖i slo쬰nost centralizovanjem zajedni캜kih usluga koje vi코e radnih optere캖enja iz razli캜itih VNets mogu koristiti.

{% hint style="danger" %}
**VNET povezivanje nije tranzitivno u Azure**, 코to zna캜i da ako je spok 1 povezan sa spokom 2, a spok 2 je povezan sa spokom 3, tada spok 1 ne mo쬰 direktno da komunicira sa spokom 3.
{% endhint %}

### Primeri

* Zamislite kompaniju sa odvojenim odeljenjima kao 코to su Prodaja, Ljudski resursi i Razvoj, **svako sa svojom VNet (spokovi)**. Ove VNets **zahtevaju pristup deljenim resursima** kao 코to su centralna baza podataka, vatrozid i internet prolaz, koji se svi nalaze u **drugoj VNet (hub)**. Kori코캖enjem modela Hub i Spoke, svako odeljenje mo쬰 **sigurno da se pove쬰 sa deljenim resursima kroz hub VNet bez izlaganja tih resursa javnom internetu** ili kreiranja slo쬰ne mre쬹e strukture sa brojnim vezama.

### Enumeration

{% code overflow="wrap" %}
```bash
# List all VNets in your subscription
az network vnet list --query "[].{name:name, location:location, addressSpace:addressSpace}" -o table

# List VNet peering connections for a given VNet
az network vnet peering list --resource-group <ResourceGroupName> --vnet-name <VNetName> --query "[].{name:name, peeringState:peeringState, remoteVnetId:remoteVnetId}" -o table

# List Shared Resources (e.g., Azure Firewall) in the Hub
az network firewall list --query "[].{name:name, location:location, resourceGroup:resourceGroup}" -o table
```
{% endcode %}

## Site-to-Site VPN

Site-to-Site VPN u Azure-u omogu캖ava vam da **pove쬰te va코u lokalnu mre쬿 sa va코om Azure Virtual Network (VNet)**, omogu캖avaju캖i resursima kao 코to su VM-ovi unutar Azure-a da izgledaju kao da su na va코oj lokalnoj mre쬴. Ova veza se uspostavlja putem **VPN gateway-a koji enkriptuje saobra캖aj** izme캠u dve mre쬰.

### **Primer**

* Firma 캜ija se glavna kancelarija nalazi u Njujorku ima lokalni data centar koji treba da se sigurno pove쬰 sa svojom VNet u Azure-u, koja hostuje njene virtualizovane radne optere캖enja. Postavljanjem **Site-to-Site VPN-a, kompanija mo쬰 osigurati enkriptovanu povezanost izme캠u lokalnih servera i Azure VM-ova**, omogu캖avaju캖i resursima da se sigurno pristupa kroz oba okru쬰nja kao da su u istoj lokalnoj mre쬴.

### **Enumeracija**

{% code overflow="wrap" %}
```bash
# List VPN Gateways
az network vnet-gateway list --query "[].{name:name, location:location, resourceGroup:resourceGroup}" -o table

# List VPN Connections
az network vpn-connection list --gateway-name <VpnGatewayName> --resource-group <ResourceGroupName> --query "[].{name:name, connectionType:connectionType, connectionStatus:connectionStatus}" -o table
```
{% endcode %}

## Azure ExpressRoute

Azure ExpressRoute je usluga koja pru쬬 **privatnu, posve캖enu, visok brzu vezu izme캠u va코e lokalne infrastrukture i Azure data centara**. Ova veza se uspostavlja putem provajdera povezivanja, zaobilaze캖i javni internet i nude캖i ve캖u pouzdanost, br쬰 brzine, ni쬰 latencije i ve캖u sigurnost od tipi캜nih internet veza.

### **Primer**

* Multinacionalna korporacija zahteva **doslednu i pouzdanu vezu sa svojim Azure uslugama zbog velikog obima podataka** i potrebe za visokim protokom. Kompanija se odlu캜uje za Azure ExpressRoute kako bi direktno povezala svoj lokalni data centar sa Azure-om, olak코avaju캖i velike transfere podataka, kao 코to su dnevni backup-i i analitika podataka u realnom vremenu, uz pobolj코anu privatnost i brzinu.

### **Enumeracija**

{% code overflow="wrap" %}
```bash
# List ExpressRoute Circuits
az network express-route list --query "[].{name:name, location:location, resourceGroup:resourceGroup, serviceProviderName:serviceProviderName, peeringLocation:peeringLocation}" -o table
```
{% endcode %}

{% hint style="success" %}
U캜ite i ve쬭ajte AWS Hacking:<img src="../../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
U캜ite i ve쬭ajte GCP Hacking: <img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Podr쬴te HackTricks</summary>

* Proverite [**planove pretplate**](https://github.com/sponsors/carlospolop)!
* **Pridru쬴te se** 游눫 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili **pratite** nas na **Twitteru** 游냕 [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Podelite hakerske trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
{% endhint %}
