# Az - Azure Network

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the**  [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter**  [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Podstawowe Informacje

Sieci w Azure funkcjonuj jako integralna cz jego platformy chmurowej, umo偶liwiajc **poczenie i komunikacj midzy r贸偶nymi usugami i zasobami Azure**. Architektura sieci w Azure jest zaprojektowana tak, aby bya wysoce skalowalna, bezpieczna i dostosowywalna.

W swojej istocie, Azure zapewnia **wirtualn sie (VNet)**, kt贸ra pozwala u偶ytkownikom tworzy **izolowane sieci** w chmurze Azure. W ramach tych VNet贸w mo偶na bezpiecznie hostowa i zarzdza zasobami takimi jak maszyny wirtualne, aplikacje i bazy danych. Sie w Azure wspiera zar贸wno komunikacj wewntrz chmury (midzy usugami Azure), jak i poczenie z sieciami zewntrznymi oraz internetem.

**Bezpieczestwo** jest kluczowym aspektem sieci w Azure, z r贸偶nymi narzdziami i usugami dostpnymi do ochrony danych, zarzdzania dostpem i zapewnienia zgodnoci. Te rodki bezpieczestwa obejmuj **zapory ogniowe**, **grupy zabezpiecze sieciowych** i **mo偶liwoci szyfrowania**, co pozwala na wysoki poziom kontroli nad ruchem i dostpem.

Og贸lnie rzecz biorc, mo偶liwoci sieciowe Azure s zaprojektowane tak, aby oferowa elastyczno, umo偶liwiajc u偶ytkownikom tworzenie rodowiska sieciowego, kt贸re odpowiada ich specyficznym potrzebom aplikacji i obci偶enia, przy jednoczesnym utrzymaniu silnego nacisku na bezpieczestwo i niezawodno.

## Wirtualna Sie (VNET) i Podsieci

VNet w Azure to w zasadzie reprezentacja twojej wasnej sieci w chmurze. Jest to **logiczna izolacja chmury Azure dedykowana twojej subskrypcji**. VNet pozwala na tworzenie i zarzdzanie wirtualnymi sieciami prywatnymi (VPN) w Azure i mo偶e by u偶ywany do hostowania i **zarzdzania wieloma typami zasob贸w Azure**, takich jak maszyny wirtualne (VM), bazy danych i usugi aplikacyjne.

VNety zapewniaj **pen kontrol nad ustawieniami sieciowymi**, w tym **zakresami adres贸w IP**, tworzeniem podsieci, tablicami routingu i bramami sieciowymi.

**Podsie** to **zakres adres贸w IP w twoim VNet**. Mo偶esz podzieli VNet na wiele podsieci dla organizacji i bezpieczestwa. Ka偶da podsie w VNet mo偶e by u偶ywana do izolowania i grupowania zasob贸w zgodnie z twoj architektur sieciow i aplikacyjn.

Ponadto, podsieci pozwalaj na **segmentacj VNet na jedn lub wicej podsieci**, zapewniajc zakres adres贸w IP, kt贸re mog by u偶ywane przez zasoby.

### **Przykad**

* Za贸偶my, 偶e masz VNet o nazwie `MyVNet` z zakresem adres贸w IP `10.0.0.0/16`. Mo偶esz utworzy podsie w tym VNet, powiedzmy `Subnet-1`, z zakresem adres贸w IP `10.0.0.0/24` do hostowania swoich serwer贸w webowych. Inna podsie, `Subnet-2` z zakresem `10.0.1.0/24`, mogaby by u偶ywana dla twoich serwer贸w baz danych. Taka segmentacja pozwala na efektywne zarzdzanie i kontrol bezpieczestwa w sieci.

### Enumeracja

Aby wylistowa wszystkie VNety i podsieci w koncie Azure, mo偶esz u偶y Azure Command-Line Interface (CLI). Oto kroki:

{% code overflow="wrap" %}
```bash
# List VNets
az network vnet list --query "[].{name:name, location:location, addressSpace:addressSpace}" -o table

# List subnets of a VNet
az network vnet subnet list --resource-group <ResourceGroupName> --vnet-name <VNetName> --query "[].{name:name, addressPrefix:addressPrefix}" -o table
```
{% endcode %}

## Network Security Groups (NSG)

W Azure, **Network Security Group (NSG)** peni g贸wn funkcj filtrowania ruchu sieciowego zar贸wno do, jak i z zasob贸w Azure w ramach Azure Virtual Network (VNet). Zawiera zestaw **regu bezpieczestwa**, kt贸re precyzyjnie okrelaj przepyw ruchu sieciowego.

Kluczowe aspekty NSG obejmuj:

* **Kontrola Ruchu**: Ka偶dy NSG zawiera reguy, kt贸re s kluczowe w zezwalaniu lub blokowaniu ruchu sieciowego przychodzcego i wychodzcego zwizanego z r贸偶nymi zasobami Azure.
* **Komponenty Regu**: Reguy w NSG s bardzo specyficzne, filtrujc ruch na podstawie kryteri贸w takich jak adres IP 藕r贸da/destynacji, port i protok贸. Ta specyficzno pozwala na szczeg贸owe zarzdzanie ruchem sieciowym.
* **Wzmocnienie Bezpieczestwa**: Zapewniajc, 偶e tylko autoryzowany ruch mo偶e wchodzi lub wychodzi z zasob贸w Azure, NSG odgrywaj kluczow rol w umacnianiu bezpieczestwa infrastruktury sieciowej.

### **Przykad**

* Wyobra藕 sobie, 偶e masz NSG o nazwie `MyNSG` zastosowany do podsieci lub konkretnej maszyny wirtualnej w ramach VNet. Mo偶esz tworzy reguy takie jak:
* Regua przychodzca zezwalajca na ruch HTTP (port 80) z dowolnego 藕r贸da do twoich serwer贸w webowych.
* Regua wychodzca zezwalajca tylko na ruch SQL (port 1433) do okrelonego zakresu adres贸w IP.

### Enumeracja

{% code overflow="wrap" %}
```bash
# List NSGs
az network nsg list --query "[].{name:name, location:location}" -o table

# Get NSG rules
az network nsg rule list --nsg-name <NSGName> --resource-group <ResourceGroupName> --query "[].{name:name, priority:priority, direction:direction, access:access, protocol:protocol, sourceAddressPrefix:sourceAddressPrefix, destinationAddressPrefix:destinationAddressPrefix, sourcePortRange:sourcePortRange, destinationPortRange:destinationPortRange}" -o table
```
{% endcode %}

## Azure Firewall

Azure Firewall to zarzdzana, oparta na chmurze **usuga zabezpiecze sieciowych, kt贸ra chroni zasoby Twojej Azure Virtual Network**. Jest to w peni stanowy firewall jako usuga z wbudowanymi funkcjami wysokiej dostpnoci i skalowalnoci.

Azure Firewall oferuje **bardziej zaawansowane** funkcje ni偶 **NSG**, w tym **filtrowanie na poziomie aplikacji**, filtrowanie na poziomie sieci, filtrowanie oparte na inteligencji zagro偶e oraz integracj z Azure Monitor do logowania i analizy.\
Mo偶e filtrowa ruch wychodzcy, przychodzcy, spoke-to-spoke, VPN i ExpressRoute. **Zasady firewalla mog by tworzone na podstawie FQDN (Fully Qualified Domain Name), adres贸w IP i port贸w**.

### R贸偶nice midzy Azure Firewall a NSG

1. **Zakres:**
* **NSG:** Dziaa na poziomie podsieci lub interfejsu sieciowego. Ma na celu zapewnienie podstawowego filtrowania ruchu przychodzcego i wychodzcego z interfejs贸w sieciowych (NIC), VM lub podsieci.
* **Azure Firewall:** Dziaa na poziomie VNet, zapewniajc szerszy zakres ochrony. Jest zaprojektowany do zabezpieczania zasob贸w wirtualnej sieci i zarzdzania ruchem przepywajcym do i z VNet.
2. **Mo偶liwoci:**
* **NSG:** Zapewnia podstawowe mo偶liwoci filtrowania na podstawie adresu IP, portu i protokou. Nie obsuguje zaawansowanych funkcji, takich jak inspekcja na poziomie aplikacji czy inteligencja zagro偶e.
* **Azure Firewall:** Oferuje zaawansowane funkcje, takie jak filtrowanie ruchu na poziomie aplikacji (warstwa 7), filtrowanie oparte na inteligencji zagro偶e, filtrowanie ruchu sieciowego i inne. Obsuguje r贸wnie偶 wiele publicznych adres贸w IP.
3. **Zastosowania:**
* **NSG:** Idealny do podstawowego filtrowania ruchu na poziomie sieci.
* **Azure Firewall:** Odpowiedni do bardziej zo偶onych scenariuszy filtrowania, gdzie potrzebna jest kontrola na poziomie aplikacji, logowanie i inteligencja zagro偶e.
4. **Zarzdzanie i monitorowanie:**
* **NSG:** Oferuje podstawowe logowanie i integracj z Azure Monitor.
* **Azure Firewall:** Zapewnia zaawansowane mo偶liwoci logowania i analizy poprzez Azure Monitor, co jest niezbdne do zrozumienia charakteru i wzorca ruchu.

### Enumeracja

{% code overflow="wrap" %}
```bash
# List Azure Firewalls
az network firewall list --query "[].{name:name, location:location, subnet:subnet, publicIp:publicIp}" -o table

# Get network rules of a firewall
az network firewall network-rule collection list --firewall-name <FirewallName> --resource-group <ResourceGroupName> --query "[].{name:name, rules:rules}" -o table

# Get application rules of a firewall
az network firewall application-rule collection list --firewall-name <FirewallName> --resource-group <ResourceGroupName> --query "[].{name:name, rules:rules}" -o table

# Get nat rules of a firewall
az network firewall nat-rule collection list --firewall-name <FirewallName> --resource-group <ResourceGroupName> --query "[].{name:name, rules:rules}" -o table
```
{% endcode %}

## Network Virtual Appliance (NVA)

Network Virtual Appliance (**NVA**) w Azure to wirtualne urzdzenie, kt贸re **wykonuje funkcje sieciowe w ramach wirtualnej sieci**. NVAs s zazwyczaj u偶ywane do funkcji sieciowych, kt贸re **nie s natywnie dostpne** w Azure lub gdy wymagana jest wiksza personalizacja. S to zasadniczo **VMs, kt贸re uruchamiaj aplikacje lub usugi sieciowe**, takie jak zapory ogniowe, optymalizatory WAN lub load balancery.

NVAs s u偶ywane do zo偶onego routingu, **bezpieczestwa** i **zarzdzania ruchem sieciowym**. Mog by wdra偶ane z Azure **Marketplace**, gdzie wielu dostawc贸w zewntrznych oferuje swoje urzdzenia gotowe do integracji z rodowiskami Azure.

### **Przykad**

* Organizacja mo偶e wdro偶y NVA w Azure, aby stworzy **niestandardowe rozwizanie zapory ogniowej**. Ta NVA mo偶e uruchamia **oprogramowanie zapory ogniowej firmy trzeciej**, oferujc zaawansowane funkcje, takie jak wykrywanie wama, inspekcja pakiet贸w lub czno VPN. NVA mo偶e by skonfigurowana do inspekcji i filtrowania ruchu przechodzcego przez ni, zapewniajc wzmocnione rodki bezpieczestwa zgodnie z politykami organizacji.

### **Enumeracja**

{% code overflow="wrap" %}
```bash
# Usually NVAs are named or tagged in a way to distinguish them from other VMs
az vm list --query "[].{name:name, resourceGroup:resourceGroup, location:location}" -o table

# For a specific VM identified as an NVA, list its network interfaces
az vm nic list --vm-name <VMName> --resource-group <ResourceGroupName> --query "[].{id:id}" -o table
```
{% endcode %}

## Azure Route Tables & User Defined Routes (UDR)

**Azure Route Tables** to funkcja w Microsoft Azure, kt贸ra pozwala na **kontrol routingu ruchu sieciowego w ramach Azure Virtual Networks (VNets)**. Zasadniczo definiuj one, jak **pakiety** s **przekazywane** midzy podsieciami w ramach VNets, midzy VNets lub do sieci zewntrznych. Ka偶da tabela routingu zawiera zestaw regu, znanych jako trasy, kt贸re okrelaj, jak pakiety powinny by routowane na podstawie ich docelowych adres贸w IP.

**User Defined Routes (UDR)** w Azure to **niestandardowe trasy, kt贸re tworzysz w ramach Azure Route Tables**, aby kontrolowa **przepyw ruchu sieciowego** w ramach i midzy Azure Virtual Networks (VNets) oraz do pocze zewntrznych. UDRs daj elastyczno w kierowaniu ruchu sieciowego zgodnie z Twoimi specyficznymi wymaganiami, zastpujc domylne decyzje routingu Azure.

Te trasy s szczeg贸lnie przydatne w scenariuszach, w kt贸rych musisz **routowa ruch przez wirtualne urzdzenie**, wymusi okrelon cie偶k ze wzgld贸w bezpieczestwa lub zgodnoci z polityk, lub zintegrowa si z sieciami lokalnymi.

### **Przykad**

* Za贸偶my, 偶e wdro偶ye Network Virtual Appliance (NVA) do inspekcji ruchu midzy podsieciami w ramach VNet. Mo偶esz utworzy UDR, kt贸ry kieruje cay ruch z jednej podsieci do innej podsieci przez NVA. Ten UDR zapewnia, 偶e NVA inspektuje ruch ze wzgld贸w bezpieczestwa, zanim dotrze on do miejsca docelowego.

### **Enumeracja**

{% code overflow="wrap" %}
```bash
# List Route Tables
az network route-table list --query "[].{name:name, resourceGroup:resourceGroup, location:location}" -o table

# List UDRs for a table
az network route-table route list --route-table-name <RouteTableName> --resource-group <ResourceGroupName> --query "[].{name:name, addressPrefix:addressPrefix, nextHopType:nextHopType, nextHopIpAddress:nextHopIpAddress}" -o table
```
{% endcode %}

## Azure Private Link

Azure Private Link to usuga w Azure, kt贸ra **umo偶liwia prywatny dostp do usug Azure** poprzez zapewnienie, 偶e **ruch midzy Twoj wirtualn sieci Azure (VNet) a usug odbywa si cakowicie w ramach sieci szkieletowej Azure Microsoftu**. Efektywnie wprowadza usug do Twojego VNet. Takie ustawienie zwiksza bezpieczestwo, nie nara偶ajc danych na publiczny internet.

Private Link mo偶e by u偶ywany z r贸偶nymi usugami Azure, takimi jak Azure Storage, Azure SQL Database, oraz niestandardowe usugi udostpniane za porednictwem Private Link. Zapewnia bezpieczny spos贸b korzystania z usug wewntrz wasnego VNet lub nawet z r贸偶nych subskrypcji Azure.

{% hint style="danger" %}
NSG nie maj zastosowania do prywatnych punkt贸w kocowych, co wyra藕nie oznacza, 偶e skojarzenie NSG z podsieci zawierajc Private Link nie bdzie miao 偶adnego efektu.
{% endhint %}

### **Przykad**

* Rozwa偶 scenariusz, w kt贸rym masz **Azure SQL Database, do kt贸rej chcesz uzyska bezpieczny dostp z Twojego VNet**. Normalnie mogoby to wymaga przechodzenia przez publiczny internet. Dziki Private Link mo偶esz utworzy **prywatny punkt kocowy w Twoim VNet**, kt贸ry czy si bezporednio z usug Azure SQL Database. Ten punkt kocowy sprawia, 偶e baza danych wydaje si by czci Twojego wasnego VNet, dostpn za porednictwem prywatnego adresu IP, zapewniajc tym samym bezpieczny i prywatny dostp.

### **Enumeracja**

{% code overflow="wrap" %}
```bash
# List Private Link Services
z network private-link-service list --query "[].{name:name, location:location, resourceGroup:resourceGroup}" -o table

# List Private Endpoints
az network private-endpoint list --query "[].{name:name, location:location, resourceGroup:resourceGroup, privateLinkServiceConnections:privateLinkServiceConnections}" -o table
```
{% endcode %}

## Azure Service Endpoints

Azure Service Endpoints rozszerzaj prywatn przestrze adresow twojej sieci wirtualnej (VNet) oraz to偶samo twojej VNet do usug Azure przez bezporednie poczenie. Dziki wczeniu punkt贸w kocowych usug, **zasoby w twojej VNet mog bezpiecznie czy si z usugami Azure**, takimi jak Azure Storage i Azure SQL Database, korzystajc z sieci szkieletowej Azure. Zapewnia to, 偶e **ruch z VNet do usugi Azure pozostaje w sieci Azure**, co zapewnia bardziej bezpieczn i niezawodn cie偶k.

### **Przykad**

* Na przykad, konto **Azure Storage** domylnie jest dostpne przez publiczny internet. Wczajc **punkt kocowy usugi dla Azure Storage w twojej VNet**, mo偶esz zapewni, 偶e tylko ruch z twojej VNet mo偶e uzyska dostp do konta storage. Zapora konta storage mo偶e by nastpnie skonfigurowana do akceptowania ruchu tylko z twojej VNet.

### **Enumeracja**

{% code overflow="wrap" %}
```bash
# List Virtual Networks with Service Endpoints
az network vnet list --query "[].{name:name, location:location, serviceEndpoints:serviceEndpoints}" -o table

# List Subnets with Service Endpoints
az network vnet subnet list --resource-group <ResourceGroupName> --vnet-name <VNetName> --query "[].{name:name, serviceEndpoints:serviceEndpoints}" -o table
```
{% endcode %}

### R贸偶nice midzy Service Endpoints a Private Links

Microsoft zaleca u偶ywanie Private Links w [**dokumentacji**](https://learn.microsoft.com/en-us/azure/virtual-network/vnet-integration-for-azure-services#compare-private-endpoints-and-service-endpoints):\\

<figure><img src="../../../../.gitbook/assets/image (25).png" alt=""><figcaption></figcaption></figure>

**Service Endpoints:**

* Ruch z Twojego VNet do usugi Azure odbywa si przez sie szkieletow Microsoft Azure, omijajc publiczny internet.
* Endpoint to bezporednie poczenie z usug Azure i nie zapewnia prywatnego IP dla usugi w VNet.
* Usuga jest nadal dostpna przez sw贸j publiczny endpoint spoza Twojego VNet, chyba 偶e skonfigurujesz zapor usugi, aby blokowa taki ruch.
* Jest to relacja jeden do jednego midzy podsieci a usug Azure.
* Tasze ni偶 Private Links.

**Private Links:**

* Private Link mapuje usugi Azure do Twojego VNet za pomoc prywatnego endpointu, kt贸ry jest interfejsem sieciowym z prywatnym adresem IP w Twoim VNet.
* Usuga Azure jest dostpna za pomoc tego prywatnego adresu IP, co sprawia, 偶e wydaje si by czci Twojej sieci.
* Usugi poczone za pomoc Private Link mog by dostpne tylko z Twojego VNet lub poczonych sieci; nie ma dostpu do usugi przez publiczny internet.
* Umo偶liwia bezpieczne poczenie z usugami Azure lub wasnymi usugami hostowanymi w Azure, a tak偶e poczenie z usugami udostpnionymi przez innych.
* Zapewnia bardziej szczeg贸ow kontrol dostpu za pomoc prywatnego endpointu w Twoim VNet, w przeciwiestwie do szerszej kontroli dostpu na poziomie podsieci z service endpoints.

Podsumowujc, chocia偶 zar贸wno Service Endpoints, jak i Private Links zapewniaj bezpieczne poczenie z usugami Azure, **Private Links oferuj wy偶szy poziom izolacji i bezpieczestwa, zapewniajc, 偶e usugi s dostpne prywatnie bez nara偶ania ich na publiczny internet**. Service Endpoints s natomiast atwiejsze do skonfigurowania w og贸lnych przypadkach, gdy wymagany jest prosty, bezpieczny dostp do usug Azure bez potrzeby prywatnego IP w VNet.

## Azure Front Door (AFD) & AFD WAF

**Azure Front Door** to skalowalny i bezpieczny punkt wejcia dla **szybkiego dostarczania** globalnych aplikacji webowych. **czy** r贸偶ne usugi, takie jak globalne **load balancing, przyspieszenie strony, SSL offloading i Web Application Firewall (WAF)** w jedn usug. Azure Front Door zapewnia inteligentne routowanie na podstawie **najbli偶szej lokalizacji krawdziowej do u偶ytkownika**, zapewniajc optymaln wydajno i niezawodno. Dodatkowo oferuje routowanie oparte na URL, hosting wielu stron, sesyjn afinitet i bezpieczestwo na poziomie aplikacji.

**Azure Front Door WAF** jest zaprojektowany, aby **chroni aplikacje webowe przed atakami internetowymi** bez modyfikacji kodu zaplecza. Zawiera niestandardowe reguy i zarzdzane zestawy regu, aby chroni przed zagro偶eniami takimi jak SQL injection, cross-site scripting i inne powszechne ataki.

### **Przykad**

* Wyobra藕 sobie, 偶e masz globalnie rozproszon aplikacj z u偶ytkownikami na caym wiecie. Mo偶esz u偶y Azure Front Door, aby **routowa 偶dania u偶ytkownik贸w do najbli偶szego regionalnego centrum danych** hostujcego Twoj aplikacj, zmniejszajc op贸藕nienia, poprawiajc dowiadczenie u偶ytkownika i **bronic jej przed atakami internetowymi dziki mo偶liwociom WAF**. Jeli dany region dowiadczy przestoju, Azure Front Door mo偶e automatycznie przekierowa ruch do nastpnej najlepszej lokalizacji, zapewniajc wysok dostpno.

### Enumeracja

{% code overflow="wrap" %}
```bash
# List Azure Front Door Instances
az network front-door list --query "[].{name:name, resourceGroup:resourceGroup, location:location}" -o table

# List Front Door WAF Policies
az network front-door waf-policy list --query "[].{name:name, resourceGroup:resourceGroup, location:location}" -o table
```
{% endcode %}

## Azure Application Gateway i Azure Application Gateway WAF

Azure Application Gateway to **load balancer ruchu webowego**, kt贸ry umo偶liwia zarzdzanie ruchem do Twoich aplikacji **webowych**. Oferuje **r贸wnowa偶enie obci偶enia na warstwie 7, terminacj SSL oraz funkcje zapory aplikacji webowych (WAF)** w ramach Application Delivery Controller (ADC) jako usugi. Kluczowe funkcje obejmuj routing oparty na URL, sesje oparte na ciasteczkach oraz offloading SSL, kt贸re s kluczowe dla aplikacji wymagajcych zo偶onych mo偶liwoci r贸wnowa偶enia obci偶enia, takich jak globalny routing i routing oparty na cie偶kach.

### Przykad

* Rozwa偶 scenariusz, w kt贸rym masz stron e-commerce zawierajc wiele subdomen dla r贸偶nych funkcji, takich jak konta u偶ytkownik贸w i przetwarzanie patnoci. Azure Application Gateway mo偶e **kierowa ruch do odpowiednich serwer贸w webowych na podstawie cie偶ki URL**. Na przykad, ruch do `example.com/accounts` mo偶e by skierowany do usugi kont u偶ytkownik贸w, a ruch do `example.com/pay` mo偶e by skierowany do usugi przetwarzania patnoci.\
I **chroni Twoj stron przed atakami za pomoc funkcji WAF**.

### **Enumeracja**

{% code overflow="wrap" %}
```bash
# List the Web Application Firewall configurations for your Application Gateways
az network application-gateway waf-config list --gateway-name <AppGatewayName> --resource-group <ResourceGroupName> --query "[].{name:name, firewallMode:firewallMode, ruleSetType:ruleSetType, ruleSetVersion:ruleSetVersion}" -o table
```
{% endcode %}

## Azure Hub, Spoke & VNet Peering

**VNet Peering** to funkcja sieciowa w Azure, kt贸ra **umo偶liwia bezporednie i bezproblemowe poczenie r贸偶nych Virtual Networks (VNets)**. Dziki VNet peering, zasoby w jednym VNet mog komunikowa si z zasobami w innym VNet za pomoc prywatnych adres贸w IP, **jakby byy w tej samej sieci**.\
**VNet Peering mo偶e by r贸wnie偶 u偶ywany z sieciami on-prem** poprzez skonfigurowanie site-to-site VPN lub Azure ExpressRoute.

**Azure Hub and Spoke** to topologia sieciowa u偶ywana w Azure do zarzdzania i organizowania ruchu sieciowego. **"Hub" to centralny punkt, kt贸ry kontroluje i kieruje ruch midzy r贸偶nymi "spokes"**. Hub zazwyczaj zawiera wsp贸lne usugi, takie jak network virtual appliances (NVAs), Azure VPN Gateway, Azure Firewall lub Azure Bastion. **"Spokes" to VNets, kt贸re hostuj obci偶enia i cz si z hubem za pomoc VNet peering**, co pozwala im korzysta ze wsp贸lnych usug w hubie. Ten model promuje czysty ukad sieci, redukujc zo偶ono poprzez centralizacj wsp贸lnych usug, z kt贸rych mog korzysta r贸偶ne obci偶enia w r贸偶nych VNets.

{% hint style="danger" %}
**VNET pairing nie jest tranzytywne w Azure**, co oznacza, 偶e jeli spoke 1 jest poczony ze spoke 2, a spoke 2 jest poczony ze spoke 3, to spoke 1 nie mo偶e bezporednio komunikowa si ze spoke 3.
{% endhint %}

### Przykady

* Wyobra藕 sobie firm z oddzielnymi dziaami, takimi jak Sprzeda偶, HR i Rozw贸j, **ka偶dy z wasnym VNet (spokes)**. Te VNets **wymagaj dostpu do wsp贸lnych zasob贸w**, takich jak centralna baza danych, firewall i brama internetowa, kt贸re znajduj si w **innym VNet (hub)**. Korzystajc z modelu Hub and Spoke, ka偶dy dzia mo偶e **bezpiecznie czy si ze wsp贸lnymi zasobami przez hub VNet, bez nara偶ania tych zasob贸w na publiczny internet** lub tworzenia skomplikowanej struktury sieciowej z licznymi poczeniami.

### Enumeracja

{% code overflow="wrap" %}
```bash
# List all VNets in your subscription
az network vnet list --query "[].{name:name, location:location, addressSpace:addressSpace}" -o table

# List VNet peering connections for a given VNet
az network vnet peering list --resource-group <ResourceGroupName> --vnet-name <VNetName> --query "[].{name:name, peeringState:peeringState, remoteVnetId:remoteVnetId}" -o table

# List Shared Resources (e.g., Azure Firewall) in the Hub
az network firewall list --query "[].{name:name, location:location, resourceGroup:resourceGroup}" -o table
```
{% endcode %}

## Site-to-Site VPN

Site-to-Site VPN w Azure pozwala na **poczenie sieci lokalnej z Azure Virtual Network (VNet)**, umo偶liwiajc zasobom takim jak VMs w Azure, aby wyglday jakby byy w lokalnej sieci. To poczenie jest ustanawiane przez **bram VPN, kt贸ra szyfruje ruch** midzy dwiema sieciami.

### **Przykad**

* Firma z g贸wn siedzib w Nowym Jorku ma lokalne centrum danych, kt贸re musi bezpiecznie poczy si z VNet w Azure, gdzie hostowane s jej zwirtualizowane obci偶enia. Poprzez skonfigurowanie **Site-to-Site VPN, firma mo偶e zapewni szyfrowane poczenie midzy lokalnymi serwerami a Azure VMs**, umo偶liwiajc bezpieczny dostp do zasob贸w w obu rodowiskach, jakby byy w tej samej lokalnej sieci.

### **Enumeracja**

{% code overflow="wrap" %}
```bash
# List VPN Gateways
az network vnet-gateway list --query "[].{name:name, location:location, resourceGroup:resourceGroup}" -o table

# List VPN Connections
az network vpn-connection list --gateway-name <VpnGatewayName> --resource-group <ResourceGroupName> --query "[].{name:name, connectionType:connectionType, connectionStatus:connectionStatus}" -o table
```
{% endcode %}

## Azure ExpressRoute

Azure ExpressRoute to usuga, kt贸ra zapewnia **prywatne, dedykowane, szybkie poczenie midzy infrastruktur lokaln a centrami danych Azure**. To poczenie jest realizowane przez dostawc cznoci, omijajc publiczny internet i oferujc wiksz niezawodno, szybsze prdkoci, ni偶sze op贸藕nienia i wy偶sze bezpieczestwo ni偶 typowe poczenia internetowe.

### **Przykad**

* Midzynarodowa korporacja potrzebuje **staego i niezawodnego poczenia z usugami Azure ze wzgldu na du偶 ilo danych** i potrzeb wysokiej przepustowoci. Firma wybiera Azure ExpressRoute, aby bezporednio poczy swoje lokalne centrum danych z Azure, uatwiajc transfery du偶ej skali danych, takie jak codzienne kopie zapasowe i analizy danych w czasie rzeczywistym, z wiksz prywatnoci i szybkoci.

### **Enumeracja**

{% code overflow="wrap" %}
```bash
# List ExpressRoute Circuits
az network express-route list --query "[].{name:name, location:location, resourceGroup:resourceGroup, serviceProviderName:serviceProviderName, peeringLocation:peeringLocation}" -o table
```
{% endcode %}

{% hint style="success" %}
Ucz si i wicz AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Ucz si i wicz GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Wspieraj HackTricks</summary>

* Sprawd藕 [**plany subskrypcji**](https://github.com/sponsors/carlospolop)!
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegram**](https://t.me/peass) lub **led藕** nas na **Twitterze**  [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Dziel si trikami hakerskimi, przesyajc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repozytori贸w na githubie.

</details>
{% endhint %}
