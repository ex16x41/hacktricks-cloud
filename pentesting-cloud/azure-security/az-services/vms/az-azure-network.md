# Az - Azure Network

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the**  [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter**  [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Podstawowe informacje

Sieci w Azure funkcjonuj jako integralna cz jego platformy chmurowej, umo偶liwiajc **poczenie i komunikacj midzy r贸偶nymi usugami i zasobami Azure**. Architektura sieci w Azure zostaa zaprojektowana w spos贸b wysoce skalowalny, bezpieczny i dostosowywalny.

W swojej istocie Azure zapewnia **wirtualn sie (VNet)**, kt贸ra pozwala u偶ytkownikom tworzy **izolowane** **sieci** w chmurze Azure. W ramach tych VNets zasoby, takie jak maszyny wirtualne, aplikacje i bazy danych, mog by bezpiecznie hostowane i zarzdzane. Sieci w Azure wspieraj zar贸wno komunikacj wewntrz chmury (midzy usugami Azure), jak i poczenie z zewntrznymi sieciami oraz internetem.

**Bezpieczestwo** jest kluczowym aspektem sieciowania w Azure, z r贸偶nymi narzdziami i usugami dostpnymi do ochrony danych, zarzdzania dostpem i zapewnienia zgodnoci. Te rodki bezpieczestwa obejmuj **zapory**, **grupy zabezpiecze sieci** oraz **mo偶liwoci szyfrowania**, co pozwala na wysoki poziom kontroli nad ruchem i dostpem.

Og贸lnie rzecz biorc, mo偶liwoci sieciowe Azure s zaprojektowane w celu oferowania elastycznoci, pozwalajc u偶ytkownikom na stworzenie rodowiska sieciowego, kt贸re odpowiada ich specyficznym potrzebom aplikacyjnym i obci偶eniowym, jednoczenie kadc silny nacisk na bezpieczestwo i niezawodno.

## Wirtualna sie (VNET) i podsieci

VNet w Azure to w zasadzie reprezentacja twojej wasnej sieci w chmurze. Jest to **logiczne odizolowanie chmury Azure dedykowane twojej subskrypcji**. VNet pozwala na provisionowanie i zarzdzanie wirtualnymi sieciami prywatnymi (VPN) w Azure i mo偶e by u偶ywane do hostowania i **zarzdzania wieloma typami zasob贸w Azure**, takimi jak maszyny wirtualne (VM), bazy danych i usugi aplikacyjne.

VNety zapewniaj **pen kontrol nad ustawieniami sieci**, w tym **zakresami adres贸w IP**, tworzeniem podsieci, tabelami routingu i bramami sieciowymi.

**Podsie** to **zakres adres贸w IP w twoim VNet**. Mo偶esz podzieli VNet na wiele podsieci w celu organizacji i bezpieczestwa. Ka偶da podsie w VNet mo偶e by u偶ywana do izolacji i grupowania zasob贸w zgodnie z twoj architektur sieciow i aplikacyjn.

Ponadto, podsieci pozwalaj na **segmentacj twojego VNet na jedn lub wicej pod-sieci**, zapewniajc zakres adres贸w IP, kt贸re zasoby mog wykorzysta.

### **Przykad**

* Za贸偶my, 偶e masz VNet o nazwie `MyVNet` z zakresem adres贸w IP `10.0.0.0/16`. Mo偶esz stworzy podsie w ramach tego VNet, powiedzmy `Subnet-1`, z zakresem adres贸w IP `10.0.0.0/24` do hostowania swoich serwer贸w webowych. Inna podsie, `Subnet-2` z zakresem `10.0.1.0/24`, mogaby by u偶ywana dla twoich serwer贸w baz danych. Ta segmentacja pozwala na efektywne zarzdzanie i kontrole bezpieczestwa w sieci.

### Enumeracja

Aby wylistowa wszystkie VNety i podsieci w koncie Azure, mo偶esz u偶y interfejsu wiersza polece Azure (CLI). Oto kroki:

{% code overflow="wrap" %}
```bash
# List VNets
az network vnet list --query "[].{name:name, location:location, addressSpace:addressSpace}" -o table

# List subnets of a VNet
az network vnet subnet list --resource-group <ResourceGroupName> --vnet-name <VNetName> --query "[].{name:name, addressPrefix:addressPrefix}" -o table
```
{% endcode %}

## Grupy zabezpiecze sieci (NSG)

W Azure, **Grupa zabezpiecze sieci (NSG)** peni podstawow funkcj filtrowania ruchu sieciowego zar贸wno do, jak i z zasob贸w Azure w ramach Wirtualnej Sieci Azure (VNet). Zawiera zestaw **regu zabezpiecze**, kt贸re dokadnie okrelaj przepyw ruchu sieciowego.

Kluczowe aspekty NSG obejmuj:

* **Kontrola ruchu**: Ka偶da NSG zawiera reguy, kt贸re s niezbdne do zezwolenia lub zablokowania przychodzcego i wychodzcego ruchu sieciowego zwizanego z r贸偶nymi zasobami Azure.
* **Skadniki reguy**: Reguy w NSG s bardzo szczeg贸owe, filtrujc ruch na podstawie kryteri贸w takich jak adres IP 藕r贸dowy/docelowy, port i protok贸. Ta szczeg贸owo pozwala na precyzyjne zarzdzanie ruchem sieciowym.
* **Wzmocnienie zabezpiecze**: Zapewniajc, 偶e tylko autoryzowany ruch mo偶e wchodzi lub wychodzi z zasob贸w Azure, NSG odgrywaj kluczow rol w wzmacnianiu bezpieczestwa infrastruktury sieciowej.

### **Przykad**

* Wyobra藕 sobie, 偶e masz NSG o nazwie `MyNSG` zastosowan do podsieci lub konkretnej maszyny wirtualnej w ramach swojej VNet. Mo偶esz stworzy reguy takie jak:
* Regua przychodzca zezwalajca na ruch HTTP (port 80) z dowolnego 藕r贸da do twoich serwer贸w webowych.
* Regua wychodzca zezwalajca tylko na ruch SQL (port 1433) do okrelonego zakresu adres贸w IP docelowych.

### Enumeracja

{% code overflow="wrap" %}
```bash
# List NSGs
az network nsg list --query "[].{name:name, location:location}" -o table

# Get NSG rules
az network nsg rule list --nsg-name <NSGName> --resource-group <ResourceGroupName> --query "[].{name:name, priority:priority, direction:direction, access:access, protocol:protocol, sourceAddressPrefix:sourceAddressPrefix, destinationAddressPrefix:destinationAddressPrefix, sourcePortRange:sourcePortRange, destinationPortRange:destinationPortRange}" -o table
```
{% endcode %}

## Azure Firewall

Azure Firewall to zarzdzana, oparta na chmurze **usuga zabezpiecze sieciowych, kt贸ra chroni zasoby Twojej sieci wirtualnej Azure**. Jest to w peni stanowy firewall jako usuga z wbudowanymi funkcjami wysokiej dostpnoci i skalowalnoci.

Azure Firewall oferuje **bardziej zaawansowane** funkcje ni偶 **NSG**, w tym **filtrowanie na poziomie aplikacji**, filtrowanie na poziomie sieci, filtrowanie oparte na inteligencji zagro偶e oraz integracj z Azure Monitor w celu rejestrowania i analizy.\
Mo偶e filtrowa ruch wychodzcy, przychodzcy, midzy wzami, VPN i ExpressRoute. **Reguy zapory mog by tworzone na podstawie FQDN (Fully Qualified Domain Name), adres贸w IP i port贸w**.

### R贸偶nice midzy Azure Firewall a NSG

1. **Zakres:**
* **NSG:** Dziaa na poziomie podsieci lub interfejsu sieciowego. Ma na celu zapewnienie podstawowego filtrowania ruchu przychodzcego i wychodzcego z interfejs贸w sieciowych (NIC), VM lub podsieci.
* **Azure Firewall:** Dziaa na poziomie VNet, zapewniajc szerszy zakres ochrony. Jest zaprojektowany w celu zabezpieczenia zasob贸w sieci wirtualnej i zarzdzania ruchem wpywajcym i wypywajcym z VNet.
2. **Mo偶liwoci:**
* **NSG:** Oferuje podstawowe mo偶liwoci filtrowania oparte na adresie IP, porcie i protokole. Nie obsuguje zaawansowanych funkcji, takich jak inspekcja na poziomie aplikacji czy inteligencja zagro偶e.
* **Azure Firewall:** Oferuje zaawansowane funkcje, takie jak filtrowanie ruchu na poziomie aplikacji (warstwa 7), filtrowanie oparte na inteligencji zagro偶e, filtrowanie ruchu sieciowego i inne. Obsuguje r贸wnie偶 wiele publicznych adres贸w IP.
3. **Przypadki u偶ycia:**
* **NSG:** Idealne do podstawowego filtrowania ruchu na poziomie sieci.
* **Azure Firewall:** Odpowiednie do bardziej zo偶onych scenariuszy filtrowania, gdzie potrzebna jest kontrola na poziomie aplikacji, rejestrowanie i inteligencja zagro偶e.
4. **Zarzdzanie i monitorowanie:**
* **NSG:** Oferuje podstawowe rejestrowanie i integracj z Azure Monitor.
* **Azure Firewall:** Zapewnia zaawansowane mo偶liwoci rejestrowania i analizy poprzez Azure Monitor, co jest niezbdne do zrozumienia charakteru i wzorc贸w ruchu.

### Enumeracja

{% code overflow="wrap" %}
```bash
# List Azure Firewalls
az network firewall list --query "[].{name:name, location:location, subnet:subnet, publicIp:publicIp}" -o table

# Get network rules of a firewall
az network firewall network-rule collection list --firewall-name <FirewallName> --resource-group <ResourceGroupName> --query "[].{name:name, rules:rules}" -o table

# Get application rules of a firewall
az network firewall application-rule collection list --firewall-name <FirewallName> --resource-group <ResourceGroupName> --query "[].{name:name, rules:rules}" -o table

# Get nat rules of a firewall
az network firewall nat-rule collection list --firewall-name <FirewallName> --resource-group <ResourceGroupName> --query "[].{name:name, rules:rules}" -o table
```
{% endcode %}

## Network Virtual Appliance (NVA)

A Network Virtual Appliance (**NVA**) w Azure to wirtualne urzdzenie, kt贸re **wykonuje funkcje sieciowe w ramach wirtualnej sieci**. NVAs s zazwyczaj u偶ywane do funkcji sieciowych, kt贸re **nie s dostpne natywnie** w Azure lub gdy wymagana jest wiksza personalizacja. S to zasadniczo **VM-y, kt贸re uruchamiaj aplikacje lub usugi sieciowe**, takie jak zapory, optymalizatory WAN lub r贸wnowa偶niki obci偶enia.

NVAs s u偶ywane do zo偶onego routingu, **bezpieczestwa** i **zarzdzania ruchem sieciowym**. Mog by wdra偶ane z Azure **Marketplace**, gdzie wielu dostawc贸w zewntrznych oferuje swoje urzdzenia gotowe do integracji z rodowiskami Azure.

### **Przykad**

* Organizacja mo偶e wdro偶y NVA w Azure, aby stworzy **niestandardowe rozwizanie zapory**. Ta NVA mogaby uruchamia **oprogramowanie zapory od strony trzeciej**, oferujc zaawansowane funkcje, takie jak wykrywanie wama, inspekcja pakiet贸w lub czno VPN. NVA mo偶e by skonfigurowana do inspekcji i filtrowania ruchu przechodzcego przez ni, zapewniajc, 偶e wprowadzone s wzmocnione rodki bezpieczestwa zgodnie z politykami organizacji.

### **Enumeracja**

{% code overflow="wrap" %}
```bash
# Usually NVAs are named or tagged in a way to distinguish them from other VMs
az vm list --query "[].{name:name, resourceGroup:resourceGroup, location:location}" -o table

# For a specific VM identified as an NVA, list its network interfaces
az vm nic list --vm-name <VMName> --resource-group <ResourceGroupName> --query "[].{id:id}" -o table
```
{% endcode %}

## Tabele trasowania Azure i zdefiniowane przez u偶ytkownika trasy (UDR)

**Tabele trasowania Azure** to funkcja w Microsoft Azure, kt贸ra pozwala na **kontrolowanie trasowania ruchu sieciowego w ramach Wirtualnych Sieci Azure (VNets)**. Zasadniczo definiuj one, jak **pakiety** s **przekazywane** midzy podsieciami w VNets, midzy VNets lub do sieci zewntrznych. Ka偶da tabela trasowania zawiera zestaw regu, znanych jako trasy, kt贸re okrelaj, jak pakiety powinny by trasowane na podstawie ich adres贸w IP docelowych.

**Zdefiniowane przez u偶ytkownika trasy (UDR)** w Azure to **niestandardowe trasy, kt贸re tworzysz w ramach Tabel Trasowania Azure**, aby kontrolowa **przepyw ruchu sieciowego** w obrbie i midzy Wirtualnymi Sieciami Azure (VNets) oraz do pocze zewntrznych. UDR-y daj Ci elastyczno w kierowaniu ruchem sieciowym zgodnie z Twoimi specyficznymi wymaganiami, nadpisujc domylne decyzje trasowania Azure.

Te trasy s szczeg贸lnie przydatne w scenariuszach, w kt贸rych musisz **trasowa ruch przez wirtualne urzdzenie**, wymusi okrelon cie偶k dla bezpieczestwa lub zgodnoci z polityk, lub zintegrowa si z sieciami lokalnymi.

### **Przykad**

* Za贸偶my, 偶e wdro偶ye Wirtualne Urzdzenie Sieciowe (NVA) do inspekcji ruchu midzy podsieciami w VNet. Mo偶esz utworzy UDR, kt贸ry kieruje cay ruch z jednej podsieci do drugiej podsieci przez NVA. Ten UDR zapewnia, 偶e NVA inspekcjonuje ruch w celach bezpieczestwa, zanim dotrze on do swojego celu.

### **Enumeracja**

{% code overflow="wrap" %}
```bash
# List Route Tables
az network route-table list --query "[].{name:name, resourceGroup:resourceGroup, location:location}" -o table

# List UDRs for a table
az network route-table route list --route-table-name <RouteTableName> --resource-group <ResourceGroupName> --query "[].{name:name, addressPrefix:addressPrefix, nextHopType:nextHopType, nextHopIpAddress:nextHopIpAddress}" -o table
```
{% endcode %}

## Azure Private Link

Azure Private Link to usuga w Azure, kt贸ra **umo偶liwia prywatny dostp do usug Azure**, zapewniajc, 偶e **ruch midzy twoj wirtualn sieci Azure (VNet) a usug odbywa si cakowicie w ramach sieci szkieletowej Microsoftu Azure**. Efektywnie wprowadza usug do twojej VNet. Ta konfiguracja zwiksza bezpieczestwo, nie nara偶ajc danych na publiczny internet.

Private Link mo偶e by u偶ywany z r贸偶nymi usugami Azure, takimi jak Azure Storage, Azure SQL Database i niestandardowymi usugami udostpnianymi za porednictwem Private Link. Zapewnia bezpieczny spos贸b korzystania z usug z poziomu wasnej VNet lub nawet z r贸偶nych subskrypcji Azure.

{% hint style="danger" %}
NSG nie maj zastosowania do punkt贸w kocowych prywatnych, co wyra藕nie oznacza, 偶e przypisanie NSG do podsieci zawierajcej Private Link nie bdzie miao 偶adnego efektu.
{% endhint %}

### **Przykad**

* Rozwa偶 scenariusz, w kt贸rym masz **Azure SQL Database, do kt贸rej chcesz uzyska bezpieczny dostp z twojej VNet**. Zwykle mo偶e to wiza si z przechodzeniem przez publiczny internet. Dziki Private Link mo偶esz utworzy **prywatny punkt kocowy w swojej VNet**, kt贸ry czy si bezporednio z usug Azure SQL Database. Ten punkt kocowy sprawia, 偶e baza danych wydaje si by czci twojej wasnej VNet, dostpna za porednictwem prywatnego adresu IP, co zapewnia bezpieczny i prywatny dostp.

### **Enumeracja**

{% code overflow="wrap" %}
```bash
# List Private Link Services
z network private-link-service list --query "[].{name:name, location:location, resourceGroup:resourceGroup}" -o table

# List Private Endpoints
az network private-endpoint list --query "[].{name:name, location:location, resourceGroup:resourceGroup, privateLinkServiceConnections:privateLinkServiceConnections}" -o table
```
{% endcode %}

## Punkty kocowe usugi Azure

Punkty kocowe usugi Azure rozszerzaj prywatn przestrze adresow twojej sieci wirtualnej i to偶samo twojego VNet do usug Azure za porednictwem bezporedniego poczenia. Wczajc punkty kocowe usug, **zasoby w twoim VNet mog bezpiecznie czy si z usugami Azure**, takimi jak Azure Storage i Azure SQL Database, korzystajc z sieci szkieletowej Azure. Zapewnia to, 偶e **ruch z VNet do usugi Azure pozostaje w sieci Azure**, co zapewnia bardziej bezpieczn i niezawodn tras.

### **Przykad**

* Na przykad, konto **Azure Storage** domylnie jest dostpne przez publiczny internet. Wczajc **punkt kocowy usugi dla Azure Storage w swoim VNet**, mo偶esz zapewni, 偶e tylko ruch z twojego VNet mo偶e uzyska dostp do konta magazynowego. Zapora konta magazynowego mo偶e by nastpnie skonfigurowana tak, aby akceptowa ruch tylko z twojego VNet.

### **Enumeracja**

{% code overflow="wrap" %}
```bash
# List Virtual Networks with Service Endpoints
az network vnet list --query "[].{name:name, location:location, serviceEndpoints:serviceEndpoints}" -o table

# List Subnets with Service Endpoints
az network vnet subnet list --resource-group <ResourceGroupName> --vnet-name <VNetName> --query "[].{name:name, serviceEndpoints:serviceEndpoints}" -o table
```
{% endcode %}

### R贸偶nice midzy punktami kocowymi usugi a prywatnymi czami

Microsoft zaleca korzystanie z prywatnych czy w [**docs**](https://learn.microsoft.com/en-us/azure/virtual-network/vnet-integration-for-azure-services#compare-private-endpoints-and-service-endpoints):\\

<figure><img src="../../../../.gitbook/assets/image (25).png" alt=""><figcaption></figcaption></figure>

**Punkty kocowe usugi:**

* Ruch z Twojej VNet do usugi Azure podr贸偶uje przez sie szkieletow Microsoft Azure, omijajc publiczny internet.
* Punkt kocowy to bezporednie poczenie z usug Azure i nie zapewnia prywatnego adresu IP dla usugi w VNet.
* Sama usuga jest nadal dostpna za porednictwem swojego publicznego punktu kocowego z zewntrz Twojej VNet, chyba 偶e skonfigurujesz zapor usugi, aby zablokowa taki ruch.
* To relacja jeden do jednego midzy podsieci a usug Azure.
* Tasze ni偶 prywatne cza.

**Prywatne cza:**

* Prywatne cze mapuje usugi Azure do Twojej VNet za porednictwem prywatnego punktu kocowego, kt贸ry jest interfejsem sieciowym z prywatnym adresem IP w Twojej VNet.
* Usuga Azure jest dostpna za pomoc tego prywatnego adresu IP, co sprawia, 偶e wydaje si, i偶 jest czci Twojej sieci.
* Usugi poczone za porednictwem prywatnego cza mog by dostpne tylko z Twojej VNet lub poczonych sieci; nie ma dostpu do usugi z publicznego internetu.
* Umo偶liwia bezpieczne poczenie z usugami Azure lub wasnymi usugami hostowanymi w Azure, a tak偶e poczenie z usugami udostpnionymi przez innych.
* Zapewnia bardziej szczeg贸ow kontrol dostpu za porednictwem prywatnego punktu kocowego w Twojej VNet, w przeciwiestwie do szerszej kontroli dostpu na poziomie podsieci z punktami kocowymi usugi.

Podsumowujc, podczas gdy zar贸wno punkty kocowe usugi, jak i prywatne cza zapewniaj bezpieczne poczenie z usugami Azure, **prywatne cza oferuj wy偶szy poziom izolacji i bezpieczestwa, zapewniajc, 偶e usugi s dostpne prywatnie, bez nara偶ania ich na publiczny internet**. Punkty kocowe usugi, z drugiej strony, s atwiejsze do skonfigurowania w og贸lnych przypadkach, gdzie wymagany jest prosty, bezpieczny dostp do usug Azure bez potrzeby posiadania prywatnego adresu IP w VNet.

## Azure Front Door (AFD) i AFD WAF

**Azure Front Door** to skalowalny i bezpieczny punkt wejcia do **szybkiej dostawy** Twoich globalnych aplikacji internetowych. **czy** r贸偶ne usugi, takie jak globalne **r贸wnowa偶enie obci偶enia, przyspieszanie witryn, odci偶anie SSL i mo偶liwoci zapory aplikacji internetowej (WAF)** w jedn usug. Azure Front Door zapewnia inteligentne routowanie na podstawie **najbli偶szej lokalizacji brzegowej do u偶ytkownika**, zapewniajc optymaln wydajno i niezawodno. Dodatkowo oferuje routowanie oparte na URL, hosting wielu witryn, przywizanie sesji i bezpieczestwo na poziomie aplikacji.

**Azure Front Door WAF** jest zaprojektowany, aby **chroni aplikacje internetowe przed atakami opartymi na sieci** bez modyfikacji kodu zaplecza. Zawiera niestandardowe zasady i zarzdzane zestawy zasad, aby chroni przed zagro偶eniami takimi jak wstrzykiwanie SQL, skrypty midzywitrynowe i inne powszechne ataki.

### **Przykad**

* Wyobra藕 sobie, 偶e masz globalnie rozproszon aplikacj z u偶ytkownikami na caym wiecie. Mo偶esz u偶y Azure Front Door, aby **przekierowa 偶dania u偶ytkownik贸w do najbli偶szego regionalnego centrum danych** hostujcego Twoj aplikacj, co zmniejsza op贸藕nienia, poprawia dowiadczenia u偶ytkownik贸w i **broni j przed atakami internetowymi dziki mo偶liwociom WAF**. Jeli w danym regionie wystpi przest贸j, Azure Front Door mo偶e automatycznie przekierowa ruch do nastpnej najlepszej lokalizacji, zapewniajc wysok dostpno.

### Enumeracja

{% code overflow="wrap" %}
```bash
# List Azure Front Door Instances
az network front-door list --query "[].{name:name, resourceGroup:resourceGroup, location:location}" -o table

# List Front Door WAF Policies
az network front-door waf-policy list --query "[].{name:name, resourceGroup:resourceGroup, location:location}" -o table
```
{% endcode %}

## Azure Application Gateway i Azure Application Gateway WAF

Azure Application Gateway to **balanser obci偶enia ruchu sieciowego**, kt贸ry umo偶liwia zarzdzanie ruchem do Twoich **aplikacji** internetowych. Oferuje **balansowanie obci偶enia na warstwie 7, zakoczenie SSL oraz mo偶liwoci zapory aplikacji internetowej (WAF)** w ramach usugi Kontrolera Dostarczania Aplikacji (ADC). Kluczowe funkcje obejmuj routowanie oparte na URL, sesje oparte na ciasteczkach oraz odci偶anie warstwy gniazd zabezpieczonych (SSL), kt贸re s kluczowe dla aplikacji wymagajcych zo偶onych mo偶liwoci balansowania obci偶enia, takich jak globalne routowanie i routowanie oparte na cie偶kach.

### Przykad

* Rozwa偶 scenariusz, w kt贸rym masz stron internetow e-commerce, kt贸ra zawiera wiele subdomen dla r贸偶nych funkcji, takich jak konta u偶ytkownik贸w i przetwarzanie patnoci. Azure Application Gateway mo偶e **routowa ruch do odpowiednich serwer贸w internetowych na podstawie cie偶ki URL**. Na przykad, ruch do `example.com/accounts` m贸gby by kierowany do usugi kont u偶ytkownik贸w, a ruch do `example.com/pay` m贸gby by kierowany do usugi przetwarzania patnoci.\
I **chro swoj stron internetow przed atakami, korzystajc z mo偶liwoci WAF.**

### **Enumeracja**

{% code overflow="wrap" %}
```bash
# List the Web Application Firewall configurations for your Application Gateways
az network application-gateway waf-config list --gateway-name <AppGatewayName> --resource-group <ResourceGroupName> --query "[].{name:name, firewallMode:firewallMode, ruleSetType:ruleSetType, ruleSetVersion:ruleSetVersion}" -o table
```
{% endcode %}

## Azure Hub, Spoke & VNet Peering

**VNet Peering** to funkcja sieciowa w Azure, kt贸ra **pozwala na bezporednie i pynne poczenie r贸偶nych Wirtualnych Sieci (VNets)**. Dziki VNet peering, zasoby w jednej VNet mog komunikowa si z zasobami w innej VNet, u偶ywajc prywatnych adres贸w IP, **jakby znajdoway si w tej samej sieci**.\
**VNet Peering mo偶e by r贸wnie偶 u偶ywane z sieciami lokalnymi** poprzez skonfigurowanie VPN site-to-site lub Azure ExpressRoute.

**Azure Hub i Spoke** to topologia sieciowa u偶ywana w Azure do zarzdzania i organizowania ruchu sieciowego. **"Hub" to centralny punkt, kt贸ry kontroluje i kieruje ruchem midzy r贸偶nymi "spokes"**. Hub zazwyczaj zawiera usugi wsp贸lne, takie jak wirtualne urzdzenia sieciowe (NVA), Azure VPN Gateway, Azure Firewall lub Azure Bastion. **"Spokes" to VNety, kt贸re hostuj obci偶enia i cz si z hubem za pomoc VNet peering**, co pozwala im korzysta z usug wsp贸lnych w hubie. Ten model promuje czysty ukad sieci, redukujc zo偶ono poprzez centralizacj wsp贸lnych usug, z kt贸rych mog korzysta r贸偶ne obci偶enia w r贸偶nych VNetach.

{% hint style="danger" %}
**Parowanie VNET jest nieprzechodnie w Azure**, co oznacza, 偶e jeli spoke 1 jest poczony ze spoke 2, a spoke 2 jest poczony ze spoke 3, to spoke 1 nie mo偶e rozmawia bezporednio ze spoke 3.
{% endhint %}

### Przykady

* Wyobra藕 sobie firm z oddzielnymi dziaami, takimi jak Sprzeda偶, HR i Rozw贸j, **ka偶dy z wasn VNet (spokes)**. Te VNety **wymagaj dostpu do wsp贸lnych zasob贸w** takich jak centralna baza danych, zapora ogniowa i brama internetowa, kt贸re znajduj si w **innej VNet (hub)**. Korzystajc z modelu Hub i Spoke, ka偶dy dzia mo偶e **bezpiecznie poczy si z wsp贸lnymi zasobami przez VNet hub, nie nara偶ajc tych zasob贸w na publiczny internet** ani nie tworzc zo偶onej struktury sieciowej z licznymi poczeniami.

### Enumeracja

{% code overflow="wrap" %}
```bash
# List all VNets in your subscription
az network vnet list --query "[].{name:name, location:location, addressSpace:addressSpace}" -o table

# List VNet peering connections for a given VNet
az network vnet peering list --resource-group <ResourceGroupName> --vnet-name <VNetName> --query "[].{name:name, peeringState:peeringState, remoteVnetId:remoteVnetId}" -o table

# List Shared Resources (e.g., Azure Firewall) in the Hub
az network firewall list --query "[].{name:name, location:location, resourceGroup:resourceGroup}" -o table
```
{% endcode %}

## Site-to-Site VPN

Site-to-Site VPN w Azure pozwala na **poczenie lokalnej sieci z Twoj Wirtualn Sieci (VNet) w Azure**, umo偶liwiajc zasobom takim jak VM w Azure, aby wydaway si, jakby byy w Twojej lokalnej sieci. To poczenie jest ustanawiane przez **bram VPN, kt贸ra szyfruje ruch** midzy dwiema sieciami.

### **Przykad**

* Firma, kt贸rej g贸wne biuro znajduje si w Nowym Jorku, ma lokalne centrum danych, kt贸re musi bezpiecznie poczy si ze swoj VNet w Azure, kt贸ra hostuje jej wirtualizowane obci偶enia. Poprzez skonfigurowanie **Site-to-Site VPN, firma mo偶e zapewni szyfrowane poczenie midzy lokalnymi serwerami a VM w Azure**, umo偶liwiajc bezpieczny dostp do zasob贸w w obu rodowiskach, jakby byy w tej samej lokalnej sieci.

### **Enumeracja**

{% code overflow="wrap" %}
```bash
# List VPN Gateways
az network vnet-gateway list --query "[].{name:name, location:location, resourceGroup:resourceGroup}" -o table

# List VPN Connections
az network vpn-connection list --gateway-name <VpnGatewayName> --resource-group <ResourceGroupName> --query "[].{name:name, connectionType:connectionType, connectionStatus:connectionStatus}" -o table
```
{% endcode %}

## Azure ExpressRoute

Azure ExpressRoute to usuga, kt贸ra zapewnia **prywatne, dedykowane, szybkie poczenie midzy twoj infrastruktur lokaln a centrami danych Azure**. To poczenie realizowane jest przez dostawc cznoci, omijajc publiczny internet i oferujc wiksz niezawodno, szybsze prdkoci, ni偶sze op贸藕nienia oraz wy偶sze bezpieczestwo ni偶 typowe poczenia internetowe.

### **Przykad**

* Midzynarodowa korporacja wymaga **sp贸jnego i niezawodnego poczenia z usugami Azure z powodu du偶ej iloci danych** oraz potrzeby wysokiej przepustowoci. Firma decyduje si na Azure ExpressRoute, aby bezporednio poczy swoje lokalne centrum danych z Azure, uatwiajc transfery danych na du偶 skal, takie jak codzienne kopie zapasowe i analizy danych w czasie rzeczywistym, z poprawion prywatnoci i szybkoci.

### **Enumeracja**

{% code overflow="wrap" %}
```bash
# List ExpressRoute Circuits
az network express-route list --query "[].{name:name, location:location, resourceGroup:resourceGroup, serviceProviderName:serviceProviderName, peeringLocation:peeringLocation}" -o table
```
{% endcode %}

{% hint style="success" %}
Ucz si i wicz Hacking AWS:<img src="../../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
Ucz si i wicz Hacking GCP: <img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Wsparcie HackTricks</summary>

* Sprawd藕 [**plany subskrypcyjne**](https://github.com/sponsors/carlospolop)!
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **led藕** nas na **Twitterze**  [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Dziel si sztuczkami hackingowymi, przesyajc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repozytori贸w github.

</details>
{% endhint %}
