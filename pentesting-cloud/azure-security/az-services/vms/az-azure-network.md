# Az - Azure Network

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** 💬 [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Basic Information

Mreže unutar Azure funkcionišu kao integralni deo njegove platforme za cloud računarstvo, omogućavajući **povezivanje i komunikaciju između različitih Azure usluga i resursa**. Arhitektura mreže u Azure je dizajnirana da bude visoko skalabilna, sigurna i prilagodljiva.

U svojoj suštini, Azure pruža **virtuelnu mrežu (VNet)** koja omogućava korisnicima da kreiraju **izolovane** **mreže** unutar Azure cloud-a. Unutar ovih VNeta, resursi kao što su virtuelne mašine, aplikacije i baze podataka mogu biti sigurno hostovani i upravljani. Mrežno povezivanje u Azure podržava kako komunikaciju unutar cloud-a (između Azure usluga), tako i povezivanje sa spoljnim mrežama i internetom.

**Bezbednost** je kritičan aspekt Azure mrežnog povezivanja, sa raznim alatima i uslugama dostupnim za zaštitu podataka, upravljanje pristupom i osiguranje usklađenosti. Ove mere bezbednosti uključuju **vatrozide**, **grupe za mrežnu bezbednost** i **mogućnosti enkripcije**, omogućavajući visok nivo kontrole nad saobraćajem i pristupom.

Sve u svemu, Azure-ove mrežne mogućnosti su dizajnirane da ponude fleksibilnost, omogućavajući korisnicima da kreiraju mrežno okruženje koje odgovara njihovim specifičnim potrebama aplikacija i radnog opterećenja, dok održavaju snažan naglasak na bezbednosti i pouzdanosti.

## Virtual Network (VNET) & Subnets

VNet u Azure-u je u suštini reprezentacija vaše vlastite mreže u cloud-u. To je **logička izolacija Azure cloud-a posvećena vašoj pretplati**. VNet vam omogućava da obezbedite i upravljate virtuelnim privatnim mrežama (VPN) u Azure-u i može se koristiti za hostovanje i **upravljanje više vrsta Azure resursa**, kao što su virtuelne mašine (VM), baze podataka i usluge aplikacija.

VNets vam pružaju **potpunu kontrolu nad podešavanjima vaše mreže**, uključujući **IP adrese** opsege, kreiranje podmreža, tabele ruta i mrežne prolaze.

**Podmreža** je **opseg IP adresa u vašem VNet-u**. Možete podeliti VNet na više podmreža radi organizacije i bezbednosti. Svaka podmreža u VNet-u može se koristiti za izolaciju i grupisanje resursa prema vašoj mrežnoj i aplikacionoj arhitekturi.

Pored toga, podmreže vam omogućavaju da **segmentirate svoj VNet u jednu ili više podmreža**, pružajući opseg IP adresa koje resursi mogu koristiti.

### **Example**

* Pretpostavimo da imate VNet nazvan `MyVNet` sa opsegom IP adresa `10.0.0.0/16`. Možete kreirati podmrežu unutar ovog VNet-a, recimo `Subnet-1`, sa opsegom IP adresa `10.0.0.0/24` za hostovanje vaših web servera. Druga podmreža, `Subnet-2` sa opsegom `10.0.1.0/24`, mogla bi se koristiti za vaše serverske baze podataka. Ova segmentacija omogućava efikasno upravljanje i kontrole bezbednosti unutar mreže.

### Enumeration

Da biste naveli sve VNets i podmreže u Azure nalogu, možete koristiti Azure Command-Line Interface (CLI). Evo koraka:

{% code overflow="wrap" %}
```bash
# List VNets
az network vnet list --query "[].{name:name, location:location, addressSpace:addressSpace}" -o table

# List subnets of a VNet
az network vnet subnet list --resource-group <ResourceGroupName> --vnet-name <VNetName> --query "[].{name:name, addressPrefix:addressPrefix}" -o table
```
{% endcode %}

## Network Security Groups (NSG)

U Azure-u, **Network Security Group (NSG)** ima primarnu funkciju filtriranja mrežnog saobraćaja kako prema tako i od Azure resursa unutar Azure Virtual Network (VNet). Sadrži skup **bezbednosnih pravila** koja pažljivo određuju tok mrežnog saobraćaja.

Ključni aspekti NSG uključuju:

* **Kontrola saobraćaja**: Svaki NSG sadrži pravila koja su od suštinskog značaja za dozvoljavanje ili ometanje ulaznog i izlaznog mrežnog saobraćaja povezanog sa raznim Azure resursima.
* **Komponente pravila**: Pravila unutar NSG su veoma specifična, filtrirajući saobraćaj na osnovu kriterijuma kao što su izvorna/odredišna IP adresa, port i protokol. Ova specifičnost omogućava detaljno upravljanje mrežnim saobraćajem.
* **Povećanje bezbednosti**: Osiguravajući da samo autorizovani saobraćaj može ući ili izaći iz vaših Azure resursa, NSG igra ključnu ulogu u jačanju bezbednosnog stava vaše mrežne infrastrukture.

### **Primer**

* Zamislite da imate NSG nazvan `MyNSG` primenjen na podmrežu ili specifičnu virtuelnu mašinu unutar vašeg VNet-a. Možete kreirati pravila kao što su:
* Ulazno pravilo koje dozvoljava HTTP saobraćaj (port 80) iz bilo kog izvora ka vašim web serverima.
* Izlazno pravilo koje dozvoljava samo SQL saobraćaj (port 1433) ka specifičnom opsegu odredišnih IP adresa.

### Enumeration

{% code overflow="wrap" %}
```bash
# List NSGs
az network nsg list --query "[].{name:name, location:location}" -o table

# Get NSG rules
az network nsg rule list --nsg-name <NSGName> --resource-group <ResourceGroupName> --query "[].{name:name, priority:priority, direction:direction, access:access, protocol:protocol, sourceAddressPrefix:sourceAddressPrefix, destinationAddressPrefix:destinationAddressPrefix, sourcePortRange:sourcePortRange, destinationPortRange:destinationPortRange}" -o table
```
{% endcode %}

## Azure Firewall

Azure Firewall je upravljana, cloud-bazirana **usluga bezbednosti mreže koja štiti vaše Azure Virtual Network resurse**. To je potpuno stanja svestan firewall kao usluga sa ugrađenim funkcijama visoke dostupnosti i skalabilnosti.

Azure Firewall pruža **naprednije** funkcije od **NSG**, uključujući **filtriranje na nivou aplikacije**, filtriranje na mrežnom nivou, filtriranje zasnovano na obaveštajnim podacima o pretnjama i integraciju sa Azure Monitor za logovanje i analitiku.\
Može filtrirati izlazni, ulazni, spoke-to-spoke, VPN i ExpressRoute saobraćaj. **Pravila vatrozida mogu se kreirati na osnovu FQDN (Potpuno Kvalifikovano Ime Domen), IP adresa i portova**.

### Razlike između Azure Firewall i NSG

1. **Opseg:**
* **NSG:** Radi na nivou podmreže ili mrežnog interfejsa. Namenjen je za pružanje osnovnog filtriranja ulaznog i izlaznog saobraćaja sa mrežnih interfejsa (NIC), VM-ova ili podmreža.
* **Azure Firewall:** Operiše na nivou VNet-a, pružajući širi opseg zaštite. Dizajniran je da obezbedi vaše resurse virtuelne mreže i upravlja saobraćajem koji ulazi i izlazi iz VNet-a.
2. **Sposobnosti:**
* **NSG:** Pruža osnovne mogućnosti filtriranja zasnovane na IP adresi, portu i protokolu. Ne podržava napredne funkcije kao što su inspekcija na nivou aplikacije ili obaveštajni podaci o pretnjama.
* **Azure Firewall:** Nudi napredne funkcije kao što su filtriranje saobraćaja na nivou aplikacije (Layer 7), filtriranje zasnovano na obaveštajnim podacima o pretnjama, filtriranje mrežnog saobraćaja i još mnogo toga. Takođe podržava više javnih IP adresa.
3. **Slučajevi korišćenja:**
* **NSG:** Idealno za osnovno filtriranje saobraćaja na mrežnom nivou.
* **Azure Firewall:** Prikladan za složenije scenarije filtriranja gde su potrebni kontrola na nivou aplikacije, logovanje i obaveštajni podaci o pretnjama.
4. **Upravljanje i nadgledanje:**
* **NSG:** Pruža osnovno logovanje i integraciju sa Azure Monitor.
* **Azure Firewall:** Pruža napredne mogućnosti logovanja i analitike putem Azure Monitor, što je od suštinskog značaja za razumevanje prirode i obrasca saobraćaja.

### Enumeration

{% code overflow="wrap" %}
```bash
# List Azure Firewalls
az network firewall list --query "[].{name:name, location:location, subnet:subnet, publicIp:publicIp}" -o table

# Get network rules of a firewall
az network firewall network-rule collection list --firewall-name <FirewallName> --resource-group <ResourceGroupName> --query "[].{name:name, rules:rules}" -o table

# Get application rules of a firewall
az network firewall application-rule collection list --firewall-name <FirewallName> --resource-group <ResourceGroupName> --query "[].{name:name, rules:rules}" -o table

# Get nat rules of a firewall
az network firewall nat-rule collection list --firewall-name <FirewallName> --resource-group <ResourceGroupName> --query "[].{name:name, rules:rules}" -o table
```
{% endcode %}

## Network Virtual Appliance (NVA)

Network Virtual Appliance (**NVA**) u Azure-u je virtuelni uređaj koji **izvodi mrežne funkcije unutar virtuelne mreže**. NVA se obično koriste za mrežne funkcije koje **nisu nativno dostupne** u Azure-u ili kada je potrebna veća prilagodljivost. Oni su u suštini **VM-ovi koji pokreću mrežne aplikacije ili usluge**, kao što su vatrozidi, WAN optimizatori ili balansatori opterećenja.

NVA se koriste za složeno usmeravanje, **bezbednost** i **upravljanje mrežnim saobraćajem**. Mogu se implementirati iz Azure **Marketplace-a**, gde mnogi treći dobavljači nude svoje uređaje spremne za integraciju u Azure okruženja.

### **Primer**

* Organizacija može implementirati NVA u Azure-u kako bi kreirala **prilagođeno rešenje za vatrozid**. Ovaj NVA može pokretati **softver za vatrozid treće strane**, pružajući napredne funkcije kao što su detekcija upada, inspekcija paketa ili VPN konektivnost. NVA se može konfigurisati da inspekciju i filtrira saobraćaj koji prolazi kroz njega, osiguravajući da su poboljšane mere bezbednosti na snazi u skladu sa politikama organizacije.

### **Enumeracija**

{% code overflow="wrap" %}
```bash
# Usually NVAs are named or tagged in a way to distinguish them from other VMs
az vm list --query "[].{name:name, resourceGroup:resourceGroup, location:location}" -o table

# For a specific VM identified as an NVA, list its network interfaces
az vm nic list --vm-name <VMName> --resource-group <ResourceGroupName> --query "[].{id:id}" -o table
```
{% endcode %}

## Azure Route Tables & User Defined Routes (UDR)

**Azure Route Tables** su funkcija unutar Microsoft Azure koja omogućava **kontrolu usmeravanja mrežnog saobraćaja unutar Azure Virtual Networks (VNets)**. Suštinski, definišu kako se **paketi** **prosleđuju** između podmreža unutar VNets, između VNets, ili ka spoljnim mrežama. Svaka tabela ruta sadrži skup pravila, poznatih kao rute, koja specificiraju kako paketi treba da se usmere na osnovu njihovih odredišnih IP adresa.

**User Defined Routes (UDR)** u Azure su **prilagođene rute koje kreirate unutar Azure Route Tables** da kontrolišete **tok mrežnog saobraćaja** unutar i između Azure Virtual Networks (VNets), kao i ka spoljnim konekcijama. UDR-ovi vam daju fleksibilnost da usmeravate mrežni saobraćaj prema vašim specifičnim zahtevima, nadmašujući Azure-ove podrazumevane odluke o usmeravanju.

Ove rute su posebno korisne za scenarije gde treba da **usmerite saobraćaj kroz virtuelni uređaj**, nametnete specifičan put za bezbednost ili usklađenost sa politikama, ili integrišete sa lokalnim mrežama.

### **Primer**

* Pretpostavimo da ste implementirali Network Virtual Appliance (NVA) za inspekciju saobraćaja između podmreža unutar VNet-a. Možete kreirati UDR koji usmerava sav saobraćaj iz jedne podmreže u drugu podmrežu da ide kroz NVA. Ovaj UDR osigurava da NVA inspekciju saobraćaja radi u svrhe bezbednosti pre nego što stigne do svog odredišta.

### **Enumeration**

{% code overflow="wrap" %}
```bash
# List Route Tables
az network route-table list --query "[].{name:name, resourceGroup:resourceGroup, location:location}" -o table

# List UDRs for a table
az network route-table route list --route-table-name <RouteTableName> --resource-group <ResourceGroupName> --query "[].{name:name, addressPrefix:addressPrefix, nextHopType:nextHopType, nextHopIpAddress:nextHopIpAddress}" -o table
```
{% endcode %}

## Azure Private Link

Azure Private Link je usluga u Azure-u koja **omogućava privatni pristup Azure uslugama** osiguravajući da **saobraćaj između vaše Azure virtuelne mreže (VNet) i usluge putuje potpuno unutar Microsoftove Azure backbone mreže**. Efikasno dovodi uslugu u vašu VNet. Ova postavka poboljšava bezbednost ne izlažući podatke javnom internetu.

Private Link se može koristiti sa raznim Azure uslugama, kao što su Azure Storage, Azure SQL Database i prilagođene usluge deljene putem Private Link-a. Pruža siguran način za korišćenje usluga iz vaše vlastite VNet ili čak iz različitih Azure pretplata.

{% hint style="danger" %}
NSG-ovi se ne primenjuju na privatne krajnje tačke, što jasno znači da povezivanje NSG-a sa podmrežom koja sadrži Private Link neće imati efekta.
{% endhint %}

### **Primer**

* Razmotrite scenario u kojem imate **Azure SQL Database koju želite da pristupite sigurno iz vaše VNet**. Obično bi to moglo uključivati prelazak preko javnog interneta. Sa Private Link-om, možete kreirati **privatnu krajnju tačku u vašoj VNet** koja se direktno povezuje sa Azure SQL Database uslugom. Ova krajnja tačka čini da baza podataka izgleda kao da je deo vaše vlastite VNet, dostupna putem privatne IP adrese, čime se osigurava siguran i privatni pristup.

### **Enumeracija**

{% code overflow="wrap" %}
```bash
# List Private Link Services
z network private-link-service list --query "[].{name:name, location:location, resourceGroup:resourceGroup}" -o table

# List Private Endpoints
az network private-endpoint list --query "[].{name:name, location:location, resourceGroup:resourceGroup, privateLinkServiceConnections:privateLinkServiceConnections}" -o table
```
{% endcode %}

## Azure Service Endpoints

Azure Service Endpoints proširuju privatni adresni prostor vaše virtuelne mreže i identitet vaše VNet na Azure usluge preko direktne veze. Omogućavanjem servisnih krajnjih tačaka, **resursi u vašoj VNet mogu sigurno da se povežu sa Azure uslugama**, kao što su Azure Storage i Azure SQL Database, koristeći Azure-ovu osnovnu mrežu. Ovo osigurava da **saobraćaj iz VNet-a ka Azure usluzi ostaje unutar Azure mreže**, pružajući sigurniji i pouzdaniji put.

### **Primer**

* Na primer, **Azure Storage** nalog je po defaultu dostupan preko javnog interneta. Omogućavanjem **servisne krajnje tačke za Azure Storage unutar vaše VNet**, možete osigurati da samo saobraćaj iz vaše VNet može pristupiti nalogu za skladištenje. Zatim se može konfigurisati vatrozid naloga za skladištenje da prihvata saobraćaj samo iz vaše VNet.

### **Enumeracija**

{% code overflow="wrap" %}
```bash
# List Virtual Networks with Service Endpoints
az network vnet list --query "[].{name:name, location:location, serviceEndpoints:serviceEndpoints}" -o table

# List Subnets with Service Endpoints
az network vnet subnet list --resource-group <ResourceGroupName> --vnet-name <VNetName> --query "[].{name:name, serviceEndpoints:serviceEndpoints}" -o table
```
{% endcode %}

### Razlike između Servisnih Krajnih Tačaka i Privatnih Linkova

Microsoft preporučuje korišćenje Privatnih Linkova u [**docs**](https://learn.microsoft.com/en-us/azure/virtual-network/vnet-integration-for-azure-services#compare-private-endpoints-and-service-endpoints):\\

<figure><img src="../../../../.gitbook/assets/image (25).png" alt=""><figcaption></figcaption></figure>

**Servisne Krajne Tačke:**

* Saobraćaj iz vašeg VNet-a do Azure servisa putuje preko Microsoft Azure backbone mreže, zaobilazeći javni internet.
* Krajna tačka je direktna veza sa Azure servisom i ne obezbeđuje privatnu IP adresu za servis unutar VNet-a.
* Sam servis je i dalje dostupan putem svoje javne krajine tačke sa spoljašnje strane vašeg VNet-a, osim ako ne konfigurišete vatrozid servisa da blokira takav saobraćaj.
* To je odnos jedan na jedan između podmreže i Azure servisa.
* Jeftinije je od Privatnih Linkova.

**Privatni Linkovi:**

* Privatni Link mapira Azure servise u vaš VNet putem privatne krajine tačke, koja je mrežni interfejs sa privatnom IP adresom unutar vašeg VNet-a.
* Azure servis se pristupa koristeći ovu privatnu IP adresu, čineći da izgleda kao da je deo vaše mreže.
* Servisi povezani putem Privatnog Linka mogu se pristupiti samo iz vašeg VNet-a ili povezanih mreža; nema javnog pristupa internetu do servisa.
* Omogućava sigurnu vezu sa Azure servisima ili vašim sopstvenim servisima hostovanim u Azure-u, kao i vezu sa servisima koje dele drugi.
* Pruža detaljniju kontrolu pristupa putem privatne krajine tačke u vašem VNet-u, za razliku od šire kontrole pristupa na nivou podmreže sa servisnim krajim tačkama.

Ukratko, dok i Servisne Krajne Tačke i Privatni Linkovi pružaju sigurnu povezanost sa Azure servisima, **Privatni Linkovi nude viši nivo izolacije i sigurnosti osiguravajući da se servisi pristupaju privatno bez izlaganja javnom internetu**. Servisne Krajne Tačke, s druge strane, lakše se postavljaju za opšte slučajeve gde je potrebna jednostavna, sigurna povezanost sa Azure servisima bez potrebe za privatnom IP adresom u VNet-u.

## Azure Front Door (AFD) & AFD WAF

**Azure Front Door** je skalabilna i sigurna ulazna tačka za **brzu isporuku** vaših globalnih web aplikacija. **Kombinuje** različite usluge kao što su globalno **opterećenje balansiranje, ubrzanje sajta, SSL offloading i Web Application Firewall (WAF)** mogućnosti u jednu uslugu. Azure Front Door pruža inteligentno usmeravanje na osnovu **najbliže ivice lokacije korisniku**, osiguravajući optimalne performanse i pouzdanost. Pored toga, nudi usmeravanje zasnovano na URL-u, višesajtno hostovanje, afinitet sesije i sigurnost na aplikacionom nivou.

**Azure Front Door WAF** je dizajniran da **štiti web aplikacije od napada zasnovanih na web-u** bez modifikacije pozadinskog koda. Uključuje prilagođena pravila i upravljane skupove pravila za zaštitu od pretnji kao što su SQL injekcija, cross-site scripting i drugi uobičajeni napadi.

### **Primer**

* Zamislite da imate globalno distribuiranu aplikaciju sa korisnicima širom sveta. Možete koristiti Azure Front Door da **usmerite zahteve korisnika ka najbližem regionalnom data centru** koji hostuje vašu aplikaciju, čime se smanjuje latencija, poboljšava korisničko iskustvo i **brani je od web napada sa WAF mogućnostima**. Ako određena regija doživi prekid rada, Azure Front Door može automatski preusmeriti saobraćaj na sledeću najbolju lokaciju, osiguravajući visoku dostupnost.

### Enumeracija

{% code overflow="wrap" %}
```bash
# List Azure Front Door Instances
az network front-door list --query "[].{name:name, resourceGroup:resourceGroup, location:location}" -o table

# List Front Door WAF Policies
az network front-door waf-policy list --query "[].{name:name, resourceGroup:resourceGroup, location:location}" -o table
```
{% endcode %}

## Azure Application Gateway i Azure Application Gateway WAF

Azure Application Gateway je **balansir opterećenja web saobraćaja** koji vam omogućava da upravljate saobraćajem ka vašim **web** aplikacijama. Pruža **balansiranje opterećenja na Layer 7, SSL terminaciju i mogućnosti vatrozida za web aplikacije (WAF)** u okviru usluge Application Delivery Controller (ADC). Ključne karakteristike uključuju usmeravanje zasnovano na URL-u, afinitet sesije zasnovan na kolačićima i preuzimanje sigurnih soketa (SSL), što je ključno za aplikacije koje zahtevaju složene mogućnosti balansiranja opterećenja kao što su globalno usmeravanje i usmeravanje zasnovano na putanji.

### Primer

* Razmotrite scenario u kojem imate e-commerce veb sajt koji uključuje više poddomena za različite funkcije, kao što su korisnički nalozi i obrada plaćanja. Azure Application Gateway može **usmeriti saobraćaj ka odgovarajućim web serverima na osnovu URL putanje**. Na primer, saobraćaj ka `example.com/accounts` mogao bi biti usmeren ka servisu za korisničke naloge, a saobraćaj ka `example.com/pay` mogao bi biti usmeren ka servisu za obradu plaćanja.\
I **zaštitite vašu veb stranicu od napada koristeći WAF mogućnosti.**

### **Enumeracija**

{% code overflow="wrap" %}
```bash
# List the Web Application Firewall configurations for your Application Gateways
az network application-gateway waf-config list --gateway-name <AppGatewayName> --resource-group <ResourceGroupName> --query "[].{name:name, firewallMode:firewallMode, ruleSetType:ruleSetType, ruleSetVersion:ruleSetVersion}" -o table
```
{% endcode %}

## Azure Hub, Spoke & VNet Peering

**VNet Peering** je mrežna funkcija u Azure koja **omogućava različitim Virtuelnim Mrežama (VNets) da budu direktno i neprimetno povezane**. Kroz VNet peering, resursi u jednoj VNet mogu komunicirati sa resursima u drugoj VNet koristeći privatne IP adrese, **kao da su u istoj mreži**.\
**VNet Peering se takođe može koristiti sa lokalnim mrežama** postavljanjem site-to-site VPN-a ili Azure ExpressRoute.

**Azure Hub i Spoke** je mrežna topologija koja se koristi u Azure za upravljanje i organizovanje mrežnog saobraćaja. **"Hub" je centralna tačka koja kontroliše i usmerava saobraćaj između različitih "spokova"**. Hub obično sadrži deljene usluge kao što su mrežni virtuelni uređaji (NVA), Azure VPN Gateway, Azure Firewall ili Azure Bastion. **"Spokovi" su VNets koje hostuju radne opterećenja i povezuju se sa hub-om koristeći VNet peering**, omogućavajući im da koriste deljene usluge unutar huba. Ovaj model promoviše čist raspored mreže, smanjujući složenost centralizovanjem zajedničkih usluga koje više radnih opterećenja iz različitih VNets mogu koristiti.

{% hint style="danger" %}
**VNET povezivanje nije tranzitivno u Azure**, što znači da ako je spok 1 povezan sa spokom 2, a spok 2 je povezan sa spokom 3, tada spok 1 ne može direktno da komunicira sa spokom 3.
{% endhint %}

### Primeri

* Zamislite kompaniju sa odvojenim odeljenjima kao što su Prodaja, Ljudski resursi i Razvoj, **svako sa svojom VNet (spokovi)**. Ove VNets **zahtevaju pristup deljenim resursima** kao što su centralna baza podataka, vatrozid i internet prolaz, koji se svi nalaze u **drugoj VNet (hub)**. Korišćenjem modela Hub i Spoke, svako odeljenje može **sigurno da se poveže sa deljenim resursima kroz hub VNet bez izlaganja tih resursa javnom internetu** ili kreiranja složene mrežne strukture sa brojnim vezama.

### Enumeration

{% code overflow="wrap" %}
```bash
# List all VNets in your subscription
az network vnet list --query "[].{name:name, location:location, addressSpace:addressSpace}" -o table

# List VNet peering connections for a given VNet
az network vnet peering list --resource-group <ResourceGroupName> --vnet-name <VNetName> --query "[].{name:name, peeringState:peeringState, remoteVnetId:remoteVnetId}" -o table

# List Shared Resources (e.g., Azure Firewall) in the Hub
az network firewall list --query "[].{name:name, location:location, resourceGroup:resourceGroup}" -o table
```
{% endcode %}

## Site-to-Site VPN

Site-to-Site VPN u Azure-u omogućava vam da **povežete vašu lokalnu mrežu sa vašom Azure Virtual Network (VNet)**, omogućavajući resursima kao što su VM-ovi unutar Azure-a da izgledaju kao da su na vašoj lokalnoj mreži. Ova veza se uspostavlja putem **VPN gateway-a koji enkriptuje saobraćaj** između dve mreže.

### **Primer**

* Firma čija se glavna kancelarija nalazi u Njujorku ima lokalni data centar koji treba da se sigurno poveže sa svojom VNet u Azure-u, koja hostuje njene virtualizovane radne opterećenja. Postavljanjem **Site-to-Site VPN-a, kompanija može osigurati enkriptovanu povezanost između lokalnih servera i Azure VM-ova**, omogućavajući resursima da se sigurno pristupa kroz oba okruženja kao da su u istoj lokalnoj mreži.

### **Enumeracija**

{% code overflow="wrap" %}
```bash
# List VPN Gateways
az network vnet-gateway list --query "[].{name:name, location:location, resourceGroup:resourceGroup}" -o table

# List VPN Connections
az network vpn-connection list --gateway-name <VpnGatewayName> --resource-group <ResourceGroupName> --query "[].{name:name, connectionType:connectionType, connectionStatus:connectionStatus}" -o table
```
{% endcode %}

## Azure ExpressRoute

Azure ExpressRoute je usluga koja pruža **privatnu, posvećenu, visok brzu vezu između vaše lokalne infrastrukture i Azure data centara**. Ova veza se uspostavlja putem provajdera povezivanja, zaobilazeći javni internet i nudeći veću pouzdanost, brže brzine, niže latencije i veću sigurnost od tipičnih internet veza.

### **Primer**

* Multinacionalna korporacija zahteva **doslednu i pouzdanu vezu sa svojim Azure uslugama zbog velikog obima podataka** i potrebe za visokim protokom. Kompanija se odlučuje za Azure ExpressRoute kako bi direktno povezala svoj lokalni data centar sa Azure-om, olakšavajući velike transfere podataka, kao što su dnevni backup-i i analitika podataka u realnom vremenu, uz poboljšanu privatnost i brzinu.

### **Enumeracija**

{% code overflow="wrap" %}
```bash
# List ExpressRoute Circuits
az network express-route list --query "[].{name:name, location:location, resourceGroup:resourceGroup, serviceProviderName:serviceProviderName, peeringLocation:peeringLocation}" -o table
```
{% endcode %}

{% hint style="success" %}
Učite i vežbajte AWS Hacking:<img src="../../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
Učite i vežbajte GCP Hacking: <img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Podržite HackTricks</summary>

* Proverite [**planove pretplate**](https://github.com/sponsors/carlospolop)!
* **Pridružite se** 💬 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili **pratite** nas na **Twitteru** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Podelite hakerske trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
{% endhint %}
