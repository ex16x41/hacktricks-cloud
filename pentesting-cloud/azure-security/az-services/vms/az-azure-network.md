# Az - Azure Network

{% hint style="success" %}
Nau캜ite i ve쬭ajte AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Nau캜ite i ve쬭ajte GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Podr쬴te HackTricks</summary>

* Pogledajte [**planove pretplate**](https://github.com/sponsors/carlospolop)!
* **Pridru쬴te se** 游눫 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili **pratite** nas na **Twitteru** 游냕 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Delite hacking trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
{% endhint %}

## Osnovne Informacije

Mre쬰 unutar Azure funkcioni코u kao integralni deo njegove cloud computing platforme, omogu캖avaju캖i **povezivanje i komunikaciju izme캠u razli캜itih Azure servisa i resursa**. Mre쬹a arhitektura u Azure je dizajnirana da bude visoko skalabilna, sigurna i prilagodljiva.

U svojoj osnovi, Azure pru쬬 **virtualnu mre쬿 (VNet)** koja omogu캖ava korisnicima da kreiraju **izolovane** **mre쬰** unutar Azure clouda. Unutar ovih VNet-ova, resursi kao 코to su virtuelne ma코ine, aplikacije i baze podataka mogu biti sigurno hostovani i upravljani. Mre쬹a podr코ka u Azure omogu캖ava komunikaciju unutar clouda (izme캠u Azure servisa) i povezivanje sa spoljnim mre쬬ma i internetom.

**Sigurnost** je klju캜ni aspekt Azure mre쬹og sistema, sa razli캜itim alatima i servisima dostupnim za za코titu podataka, upravljanje pristupom i osiguranje uskla캠enosti. Ove mere sigurnosti uklju캜uju **firewalle**, **grupe mre쬹e sigurnosti** i **mogu캖nosti enkripcije**, omogu캖avaju캖i visok nivo kontrole nad saobra캖ajem i pristupom.

Sve u svemu, Azure-ove mre쬹e mogu캖nosti su dizajnirane da ponude fleksibilnost, omogu캖avaju캖i korisnicima da kreiraju mre쬹o okru쬰nje koje odgovara njihovim specifi캜nim potrebama aplikacija i radnih optere캖enja, uz sna쬬n naglasak na sigurnost i pouzdanost.

## Virtualna Mre쬬 (VNET) i Podmre쬰

VNet u Azure je u su코tini predstava va코e sopstvene mre쬰 u cloudu. To je **logi캜ka izolacija Azure clouda posve캖ena va코oj pretplati**. VNet vam omogu캖ava da obezbedite i upravljate virtuelnim privatnim mre쬬ma (VPN-ovima) u Azure i mo쬰 se koristiti za hostovanje i **upravljanje razli캜itim tipovima Azure resursa**, kao 코to su virtuelne ma코ine (VM-ovi), baze podataka i aplikativni servisi.

VNets vam pru쬬ju **punu kontrolu nad va코im mre쬹im postavkama**, uklju캜uju캖i **IP adrese** opsege, kreiranje podmre쬬, tabele ruta i mre쬹e prolaze.

**Podmre쬬** je **opseg IP adresa u va코em VNet-u**. Mo쬰te podeliti VNet na vi코e podmre쬬 radi organizacije i sigurnosti. Svaka podmre쬬 u VNet-u mo쬰 se koristiti za izolaciju i grupisanje resursa prema va코oj mre쬹oj i aplikativnoj arhitekturi.

맚avi코e, podmre쬰 vam omogu캖avaju da **segmentirate va코 VNet u jednu ili vi코e podmre쬬**, pru쬬ju캖i opseg IP adresa koje resursi mogu koristiti.

### **Primer**

* Pretpostavimo da imate VNet nazvan `MyVNet` sa opsegom IP adresa `10.0.0.0/16`. Mo쬰te kreirati podmre쬿 unutar ovog VNet-a, recimo `Subnet-1`, sa opsegom IP adresa `10.0.0.0/24` za hostovanje va코ih web servera. Druga podmre쬬, `Subnet-2` sa opsegom `10.0.1.0/24`, mogla bi se koristiti za va코e baze podataka. Ova segmentacija omogu캖ava efikasno upravljanje i sigurnosne kontrole unutar mre쬰.

### Enumeracija

Da biste naveli sve VNet-ove i podmre쬰 u Azure nalogu, mo쬰te koristiti Azure Command-Line Interface (CLI). Evo koraka:

{% code overflow="wrap" %}
```bash
# List VNets
az network vnet list --query "[].{name:name, location:location, addressSpace:addressSpace}" -o table

# List subnets of a VNet
az network vnet subnet list --resource-group <ResourceGroupName> --vnet-name <VNetName> --query "[].{name:name, addressPrefix:addressPrefix}" -o table
```
{% endcode %}

## Network Security Groups (NSG)

U Azure-u, **Network Security Group (NSG)** slu쬴 primarnoj funkciji filtriranja mre쬹og saobra캖aja ka i od Azure resursa unutar Azure Virtual Network (VNet). Sadr쬴 set **sigurnosnih pravila** koja pa쬷jivo diktiraju tok mre쬹og saobra캖aja.

Klju캜ni aspekti NSG uklju캜uju:

* **Kontrola Saobra캖aja**: Svaki NSG sadr쬴 pravila koja su klju캜na za dozvoljavanje ili blokiranje dolaznog i odlaznog mre쬹og saobra캖aja povezanog sa razli캜itim Azure resursima.
* **Komponente Pravila**: Pravila unutar NSG su veoma specifi캜na, filtriraju캖i saobra캖aj na osnovu kriterijuma kao 코to su izvorna/odredi코na IP adresa, port i protokol. Ova specifi캜nost omogu캖ava detaljno upravljanje mre쬹im saobra캖ajem.
* **Pobolj코anje Sigurnosti**: Osiguravanjem da samo autorizovani saobra캖aj mo쬰 u캖i ili iza캖i iz va코ih Azure resursa, NSG igra klju캜nu ulogu u ja캜anju sigurnosnog polo쬬ja va코e mre쬹e infrastrukture.

### **Primer**

* Zamislite da imate NSG nazvan `MyNSG` primenjen na podmre쬿 ili specifi캜nu virtuelnu ma코inu unutar va코eg VNet-a. Mo쬰te kreirati pravila kao 코to su:
* Dolazno pravilo koje dozvoljava HTTP saobra캖aj (port 80) sa bilo kog izvora ka va코im web serverima.
* Odlazno pravilo koje dozvoljava samo SQL saobra캖aj (port 1433) ka specifi캜nom opsegu IP adresa.

### Enumeracija

{% code overflow="wrap" %}
```bash
# List NSGs
az network nsg list --query "[].{name:name, location:location}" -o table

# Get NSG rules
az network nsg rule list --nsg-name <NSGName> --resource-group <ResourceGroupName> --query "[].{name:name, priority:priority, direction:direction, access:access, protocol:protocol, sourceAddressPrefix:sourceAddressPrefix, destinationAddressPrefix:destinationAddressPrefix, sourcePortRange:sourcePortRange, destinationPortRange:destinationPortRange}" -o table
```
{% endcode %}

## Azure Firewall

Azure Firewall je upravljana, cloud-bazirana **mre쬹a sigurnosna usluga koja 코titi va코e Azure Virtual Network resurse**. To je potpuno stateful firewall kao usluga sa ugra캠enim funkcijama visoke dostupnosti i skalabilnosti.

Azure Firewall pru쬬 **naprednije** funkcije od **NSG-ova**, uklju캜uju캖i **filtriranje na nivou aplikacije**, filtriranje na mre쬹om nivou, filtriranje zasnovano na obave코tajnim podacima o pretnjama, i integraciju sa Azure Monitor za logovanje i analitiku.\
Mo쬰 filtrirati odlazni, dolazni, spoke-to-spoke, VPN, i ExpressRoute saobra캖aj. **Pravila firewalla mogu se kreirati na osnovu FQDN (Fully Qualified Domain Name), IP adresa i portova**.

### Razlike izme캠u Azure Firewall i NSG-ova

1. **Opseg:**
* **NSG:** Radi na nivou subnet-a ili mre쬹og interfejsa. Namenjen je za osnovno filtriranje dolaznog i odlaznog saobra캖aja sa mre쬹ih interfejsa (NIC), VM-ova ili subnet-ova.
* **Azure Firewall:** Operi코e na nivou VNet-a, pru쬬ju캖i 코iri opseg za코tite. Dizajniran je da osigura va코e virtualne mre쬹e resurse i upravlja saobra캖ajem koji ulazi i izlazi iz VNet-a.
2. **Sposobnosti:**
* **NSG:** Pru쬬 osnovne mogu캖nosti filtriranja zasnovane na IP adresi, portu i protokolu. Ne podr쬬va napredne funkcije kao 코to su inspekcija na nivou aplikacije ili obave코tajni podaci o pretnjama.
* **Azure Firewall:** Nudi napredne funkcije kao 코to su filtriranje saobra캖aja na nivou aplikacije (Layer 7), filtriranje zasnovano na obave코tajnim podacima o pretnjama, filtriranje mre쬹og saobra캖aja i vi코e. Tako캠e podr쬬va vi코e javnih IP adresa.
3. **Upotreba:**
* **NSG:** Idealan za osnovno filtriranje saobra캖aja na mre쬹om nivou.
* **Azure Firewall:** Pogodan za slo쬰nije scenarije filtriranja gde je potrebna kontrola na nivou aplikacije, logovanje i obave코tajni podaci o pretnjama.
4. **Upravljanje i nadzor:**
* **NSG:** Nudi osnovno logovanje i integraciju sa Azure Monitor.
* **Azure Firewall:** Pru쬬 napredne mogu캖nosti logovanja i analitike putem Azure Monitor, 코to je klju캜no za razumevanje prirode i obrazaca saobra캖aja.

### Enumeracija

{% code overflow="wrap" %}
```bash
# List Azure Firewalls
az network firewall list --query "[].{name:name, location:location, subnet:subnet, publicIp:publicIp}" -o table

# Get network rules of a firewall
az network firewall network-rule collection list --firewall-name <FirewallName> --resource-group <ResourceGroupName> --query "[].{name:name, rules:rules}" -o table

# Get application rules of a firewall
az network firewall application-rule collection list --firewall-name <FirewallName> --resource-group <ResourceGroupName> --query "[].{name:name, rules:rules}" -o table

# Get nat rules of a firewall
az network firewall nat-rule collection list --firewall-name <FirewallName> --resource-group <ResourceGroupName> --query "[].{name:name, rules:rules}" -o table
```
{% endcode %}

## Network Virtual Appliance (NVA)

Network Virtual Appliance (**NVA**) u Azure-u je virtuelni ure캠aj koji **obavlja mre쬹e funkcije unutar virtuelne mre쬰**. NVAs se obi캜no koriste za mre쬹e funkcije koje **nisu nativno dostupne** u Azure-u ili kada je potrebna ve캖a prilago캠enost. Oni su u su코tini **VMs koji pokre캖u mre쬹e aplikacije ili usluge**, kao 코to su firewall-ovi, WAN optimizatori ili load balanceri.

NVAs se koriste za slo쬰no rutiranje, **bezbednost**, i **upravljanje mre쬹im saobra캖ajem**. Mogu se implementirati iz Azure **Marketplace**, gde mnogi tre캖i dobavlja캜i nude svoje ure캠aje spremne za integraciju u Azure okru쬰nja.

### **Primer**

* Organizacija mo쬰 implementirati NVA u Azure-u da kreira **prilago캠eno firewall re코enje**. Ovaj NVA mo쬰 pokretati **softver tre캖e strane za firewall**, pru쬬ju캖i napredne funkcije kao 코to su detekcija upada, inspekcija paketa, ili VPN konekcija. NVA se mo쬰 konfigurisati da inspektuje i filtrira saobra캖aj koji prolazi kroz njega, osiguravaju캖i pobolj코ane bezbednosne mere u skladu sa politikama organizacije.

### **Enumeracija**

{% code overflow="wrap" %}
```bash
# Usually NVAs are named or tagged in a way to distinguish them from other VMs
az vm list --query "[].{name:name, resourceGroup:resourceGroup, location:location}" -o table

# For a specific VM identified as an NVA, list its network interfaces
az vm nic list --vm-name <VMName> --resource-group <ResourceGroupName> --query "[].{id:id}" -o table
```
{% endcode %}

## Azure Route Tables & User Defined Routes (UDR)

**Azure Route Tables** su funkcija unutar Microsoft Azure koja omogu캖ava **kontrolu rutiranja mre쬹og saobra캖aja unutar Azure Virtual Networks (VNets)**. U su코tini, one defini코u kako se **paketi** **prosle캠uju** izme캠u podmre쬬 unutar VNets, izme캠u VNets, ili ka spoljnim mre쬬ma. Svaka tabela ruta sadr쬴 skup pravila, poznatih kao rute, koje specificiraju kako paketi treba da budu rutirani na osnovu njihovih odredi코nih IP adresa.

**User Defined Routes (UDR)** u Azure su **prilago캠ene rute koje kreirate unutar Azure Route Tables** kako biste kontrolisali **tok mre쬹og saobra캖aja** unutar i izme캠u Azure Virtual Networks (VNets), i ka spoljnim vezama. UDR-ovi vam daju fleksibilnost da usmeravate mre쬹i saobra캖aj prema va코im specifi캜nim zahtevima, nadja캜avaju캖i podrazumevane odluke o rutiranju koje donosi Azure.

Ove rute su posebno korisne za scenarije gde je potrebno **rutirati saobra캖aj kroz virtuelni ure캠aj**, sprovesti specifi캜an put za sigurnost ili uskla캠enost sa politikama, ili se integrisati sa lokalnim mre쬬ma.

### **Primer**

* Pretpostavimo da ste implementirali Network Virtual Appliance (NVA) za inspekciju saobra캖aja izme캠u podmre쬬 unutar VNet-a. Mo쬰te kreirati UDR koji usmerava sav saobra캖aj iz jedne podmre쬰 u drugu podmre쬿 preko NVA. Ovaj UDR osigurava da NVA pregleda saobra캖aj u sigurnosne svrhe pre nego 코to stigne na svoje odredi코te.

### **Enumeracija**

{% code overflow="wrap" %}
```bash
# List Route Tables
az network route-table list --query "[].{name:name, resourceGroup:resourceGroup, location:location}" -o table

# List UDRs for a table
az network route-table route list --route-table-name <RouteTableName> --resource-group <ResourceGroupName> --query "[].{name:name, addressPrefix:addressPrefix, nextHopType:nextHopType, nextHopIpAddress:nextHopIpAddress}" -o table
```
{% endcode %}

## Azure Private Link

Azure Private Link je usluga u Azure-u koja **omogu캖ava privatni pristup Azure uslugama** tako 코to osigurava da **saobra캖aj izme캠u va코eg Azure virtuelnog mre쬹og (VNet) i usluge putuje isklju캜ivo unutar Microsoft-ove Azure backbone mre쬰**. Efektivno dovodi uslugu u va코 VNet. Ova postavka pobolj코ava sigurnost tako 코to ne izla쬰 podatke javnom internetu.

Private Link se mo쬰 koristiti sa raznim Azure uslugama, kao 코to su Azure Storage, Azure SQL Database, i prilago캠ene usluge deljene putem Private Link-a. Pru쬬 siguran na캜in za kori코캖enje usluga unutar va코eg sopstvenog VNet-a ili 캜ak iz razli캜itih Azure pretplata.

{% hint style="danger" %}
NSG-ovi se ne primenjuju na privatne krajnje ta캜ke, 코to jasno zna캜i da povezivanje NSG-a sa podmre쬺m koja sadr쬴 Private Link ne캖e imati efekta.
{% endhint %}

### **Primer**

* Razmotrite scenario gde imate **Azure SQL Database koji 쬰lite da pristupite sigurno iz va코eg VNet-a**. Normalno, ovo bi moglo uklju캜ivati prolazak kroz javni internet. Sa Private Link-om, mo쬰te kreirati **privatnu krajnju ta캜ku u va코em VNet-u** koja se direktno povezuje sa Azure SQL Database uslugom. Ova krajnja ta캜ka 캜ini da baza podataka izgleda kao da je deo va코eg sopstvenog VNet-a, dostupna putem privatne IP adrese, 캜ime se osigurava siguran i privatan pristup.

### **Enumeracija**

{% code overflow="wrap" %}
```bash
# List Private Link Services
z network private-link-service list --query "[].{name:name, location:location, resourceGroup:resourceGroup}" -o table

# List Private Endpoints
az network private-endpoint list --query "[].{name:name, location:location, resourceGroup:resourceGroup, privateLinkServiceConnections:privateLinkServiceConnections}" -o table
```
{% endcode %}

## Azure Service Endpoints

Azure Service Endpoints pro코iruju privatni adresni prostor va코e virtuelne mre쬰 i identitet va코eg VNet-a na Azure usluge preko direktne veze. Omogu캖avanjem servisnih krajnjih ta캜aka, **resursi u va코em VNet-u mogu se sigurno povezati sa Azure uslugama**, kao 코to su Azure Storage i Azure SQL Database, koriste캖i Azure-ovu mre쬿. Ovo osigurava da **saobra캖aj iz VNet-a do Azure usluge ostaje unutar Azure mre쬰**, pru쬬ju캖i sigurniji i pouzdaniji put.

### **Primer**

* Na primer, **Azure Storage** nalog je po defaultu dostupan preko javnog interneta. Omogu캖avanjem **servisne krajnje ta캜ke za Azure Storage unutar va코eg VNet-a**, mo쬰te osigurati da samo saobra캖aj iz va코eg VNet-a mo쬰 pristupiti nalogu za skladi코tenje. Firewall naloga za skladi코tenje se zatim mo쬰 konfigurisati da prihvata saobra캖aj samo iz va코eg VNet-a.

### **Enumeracija**

{% code overflow="wrap" %}
```bash
# List Virtual Networks with Service Endpoints
az network vnet list --query "[].{name:name, location:location, serviceEndpoints:serviceEndpoints}" -o table

# List Subnets with Service Endpoints
az network vnet subnet list --resource-group <ResourceGroupName> --vnet-name <VNetName> --query "[].{name:name, serviceEndpoints:serviceEndpoints}" -o table
```
{% endcode %}

### Razlike izme캠u Service Endpoints i Private Links

Microsoft preporu캜uje kori코캖enje Private Links u [**dokumentaciji**](https://learn.microsoft.com/en-us/azure/virtual-network/vnet-integration-for-azure-services#compare-private-endpoints-and-service-endpoints):\\

<figure><img src="../../../../.gitbook/assets/image (25).png" alt=""><figcaption></figcaption></figure>

**Service Endpoints:**

* Saobra캖aj iz va코eg VNet-a ka Azure servisu putuje preko Microsoft Azure backbone mre쬰, zaobilaze캖i javni internet.
* Endpoint je direktna veza sa Azure servisom i ne obezbe캠uje privatnu IP adresu za servis unutar VNet-a.
* Sam servis je i dalje dostupan preko svog javnog endpoint-a izvan va코eg VNet-a, osim ako ne konfiguri코ete firewall servisa da blokira takav saobra캖aj.
* To je odnos jedan-na-jedan izme캠u subnet-a i Azure servisa.
* Manje je skupo od Private Links.

**Private Links:**

* Private Link mapira Azure servise u va코 VNet preko privatnog endpoint-a, koji je mre쬹i interfejs sa privatnom IP adresom unutar va코eg VNet-a.
* Azure servis se pristupa koriste캖i ovu privatnu IP adresu, 캜ine캖i da izgleda kao da je deo va코e mre쬰.
* Servisi povezani preko Private Link-a mogu se pristupiti samo iz va코eg VNet-a ili povezanih mre쬬; nema javnog internet pristupa servisu.
* Omogu캖ava sigurnu vezu sa Azure servisima ili va코im sopstvenim servisima hostovanim u Azure-u, kao i vezu sa servisima koje dele drugi.
* Pru쬬 granularniju kontrolu pristupa preko privatnog endpoint-a u va코em VNet-u, za razliku od 코ire kontrole pristupa na nivou subnet-a sa service endpoints.

Ukratko, dok i Service Endpoints i Private Links pru쬬ju sigurnu povezanost sa Azure servisima, **Private Links nude vi코i nivo izolacije i sigurnosti osiguravaju캖i da se servisima pristupa privatno bez izlaganja javnom internetu**. Service Endpoints, s druge strane, su lak코i za postavljanje za op코te slu캜ajeve gde je potrebna jednostavna, sigurna veza sa Azure servisima bez potrebe za privatnom IP adresom u VNet-u.

## Azure Front Door (AFD) & AFD WAF

**Azure Front Door** je skalabilna i sigurna ulazna ta캜ka za **brzu isporuku** va코ih globalnih web aplikacija. **Kombinuje** razli캜ite servise kao 코to su globalni **load balancing, ubrzanje sajta, SSL offloading, i Web Application Firewall (WAF)** mogu캖nosti u jedan servis. Azure Front Door pru쬬 inteligentno rutiranje bazirano na **najbli쬺j edge lokaciji korisniku**, osiguravaju캖i optimalne performanse i pouzdanost. Pored toga, nudi rutiranje bazirano na URL-u, hosting vi코e sajtova, sesijsku afinitet i sigurnost na aplikacionom sloju.

**Azure Front Door WAF** je dizajniran da **코titi web aplikacije od napada baziranih na web-u** bez modifikacije back-end koda. Uklju캜uje prilago캠ena pravila i upravljane setove pravila za za코titu od pretnji kao 코to su SQL injection, cross-site scripting, i drugi uobi캜ajeni napadi.

### **Primer**

* Zamislite da imate globalno distribuiranu aplikaciju sa korisnicima 코irom sveta. Mo쬰te koristiti Azure Front Door da **rutirate korisni캜ke zahteve ka najbli쬰m regionalnom data centru** koji hostuje va코u aplikaciju, 캜ime se smanjuje latencija, pobolj코ava korisni캜ko iskustvo i **brani od web napada sa WAF mogu캖nostima**. Ako odre캠eni region do쬴vi prekid rada, Azure Front Door mo쬰 automatski preusmeriti saobra캖aj na slede캖u najbolju lokaciju, osiguravaju캖i visoku dostupnost.

### Enumeracija

{% code overflow="wrap" %}
```bash
# List Azure Front Door Instances
az network front-door list --query "[].{name:name, resourceGroup:resourceGroup, location:location}" -o table

# List Front Door WAF Policies
az network front-door waf-policy list --query "[].{name:name, resourceGroup:resourceGroup, location:location}" -o table
```
{% endcode %}

## Azure Application Gateway i Azure Application Gateway WAF

Azure Application Gateway je **balanser optere캖enja web saobra캖aja** koji vam omogu캖ava da upravljate saobra캖ajem ka va코im **web** aplikacijama. Nudi **Layer 7 balansiranje optere캖enja, SSL terminaciju i mogu캖nosti web aplikacionog firewall-a (WAF)** u okviru Application Delivery Controller (ADC) kao usluge. Klju캜ne karakteristike uklju캜uju rutiranje zasnovano na URL-u, sesijsku afinitet zasnovanu na kola캜i캖ima i SSL offloading, 코to je klju캜no za aplikacije koje zahtevaju slo쬰ne mogu캖nosti balansiranja optere캖enja kao 코to su globalno rutiranje i rutiranje zasnovano na putanji.

### Primer

* Razmotrite scenario gde imate e-commerce sajt koji uklju캜uje vi코e poddomena za razli캜ite funkcije, kao 코to su korisni캜ki nalozi i obrada pla캖anja. Azure Application Gateway mo쬰 **rutirati saobra캖aj ka odgovaraju캖im web serverima na osnovu URL putanje**. Na primer, saobra캖aj ka `example.com/accounts` mo쬰 biti usmeren ka servisu za korisni캜ke naloge, a saobra캖aj ka `example.com/pay` mo쬰 biti usmeren ka servisu za obradu pla캖anja.\
I **za코titite va코 sajt od napada koriste캖i WAF mogu캖nosti.**

### **Enumeracija**

{% code overflow="wrap" %}
```bash
# List the Web Application Firewall configurations for your Application Gateways
az network application-gateway waf-config list --gateway-name <AppGatewayName> --resource-group <ResourceGroupName> --query "[].{name:name, firewallMode:firewallMode, ruleSetType:ruleSetType, ruleSetVersion:ruleSetVersion}" -o table
```
{% endcode %}

## Azure Hub, Spoke & VNet Peering

**VNet Peering** je mre쬹a funkcija u Azure-u koja **omogu캖ava direktno i besprekorno povezivanje razli캜itih Virtual Networks (VNets)**. Kroz VNet peering, resursi u jednom VNet-u mogu komunicirati sa resursima u drugom VNet-u koriste캖i privatne IP adrese, **kao da su u istoj mre쬴**.\
**VNet Peering se tako캠e mo쬰 koristiti sa on-prem mre쬬ma** postavljanjem site-to-site VPN-a ili Azure ExpressRoute-a.

**Azure Hub and Spoke** je mre쬹a topologija koja se koristi u Azure-u za upravljanje i organizovanje mre쬹og saobra캖aja. **"Hub" je centralna ta캜ka koja kontroli코e i usmerava saobra캖aj izme캠u razli캜itih "spokes"**. Hub obi캜no sadr쬴 zajedni캜ke servise kao 코to su network virtual appliances (NVAs), Azure VPN Gateway, Azure Firewall, ili Azure Bastion. **"Spokes" su VNets koji hostuju radna optere캖enja i povezuju se sa hub-om koriste캖i VNet peering**, omogu캖avaju캖i im da koriste zajedni캜ke servise unutar hub-a. Ovaj model promovi코e 캜ist mre쬹i raspored, smanjuju캖i kompleksnost centralizovanjem zajedni캜kih servisa koje mogu koristiti razli캜ita radna optere캖enja u razli캜itim VNet-ovima.

{% hint style="danger" %}
**VNET peering nije tranzitivan u Azure-u**, 코to zna캜i da ako je spoke 1 povezan sa spoke 2 i spoke 2 je povezan sa spoke 3, onda spoke 1 ne mo쬰 direktno komunicirati sa spoke 3.
{% endhint %}

### Primeri

* Zamislite kompaniju sa odvojenim odeljenjima kao 코to su Prodaja, HR i Razvoj, **svako sa svojim VNet-om (spokes)**. Ovi VNets **zahtevaju pristup zajedni캜kim resursima** kao 코to su centralna baza podataka, firewall i internet gateway, koji su svi locirani u **drugom VNet-u (hub)**. Kori코캖enjem Hub and Spoke modela, svako odeljenje mo쬰 **sigurno povezati se sa zajedni캜kim resursima kroz hub VNet bez izlaganja tih resursa javnom internetu** ili stvaranja kompleksne mre쬹e strukture sa brojnim vezama.

### Enumeracija

{% code overflow="wrap" %}
```bash
# List all VNets in your subscription
az network vnet list --query "[].{name:name, location:location, addressSpace:addressSpace}" -o table

# List VNet peering connections for a given VNet
az network vnet peering list --resource-group <ResourceGroupName> --vnet-name <VNetName> --query "[].{name:name, peeringState:peeringState, remoteVnetId:remoteVnetId}" -o table

# List Shared Resources (e.g., Azure Firewall) in the Hub
az network firewall list --query "[].{name:name, location:location, resourceGroup:resourceGroup}" -o table
```
{% endcode %}

## Site-to-Site VPN

Site-to-Site VPN u Azure omogu캖ava vam da **pove쬰te va코u lokalnu mre쬿 sa va코om Azure Virtual Network (VNet)**, omogu캖avaju캖i resursima kao 코to su VM-ovi unutar Azure-a da se pojavljuju kao da su na va코oj lokalnoj mre쬴. Ova veza se uspostavlja putem **VPN gateway-a koji 코ifruje saobra캖aj** izme캠u dve mre쬰.

### **Primer**

* Firma sa glavnom kancelarijom u Njujorku ima lokalni data centar koji treba sigurno da se pove쬰 sa svojim VNet-om u Azure-u, koji hostuje njene virtualizovane radne optere캖enja. Postavljanjem **Site-to-Site VPN-a, kompanija mo쬰 osigurati 코ifrovanu povezanost izme캠u lokalnih servera i Azure VM-ova**, omogu캖avaju캖i pristup resursima sigurno u oba okru쬰nja kao da su u istoj lokalnoj mre쬴.

### **Enumeracija**

{% code overflow="wrap" %}
```bash
# List VPN Gateways
az network vnet-gateway list --query "[].{name:name, location:location, resourceGroup:resourceGroup}" -o table

# List VPN Connections
az network vpn-connection list --gateway-name <VpnGatewayName> --resource-group <ResourceGroupName> --query "[].{name:name, connectionType:connectionType, connectionStatus:connectionStatus}" -o table
```
{% endcode %}

## Azure ExpressRoute

Azure ExpressRoute je usluga koja pru쬬 **privatnu, posve캖enu, visokobrzinsku vezu izme캠u va코e lokalne infrastrukture i Azure data centara**. Ova veza se ostvaruje preko provajdera konektivnosti, zaobilaze캖i javni internet i nude캖i ve캖u pouzdanost, br쬰 brzine, ni쬰 latencije i ve캖u sigurnost od tipi캜nih internet konekcija.

### **Primer**

* Multinacionalna korporacija zahteva **konzistentnu i pouzdanu vezu sa svojim Azure uslugama zbog velikog obima podataka** i potrebe za visokim protokom. Kompanija se odlu캜uje za Azure ExpressRoute kako bi direktno povezala svoj lokalni data centar sa Azure-om, olak코avaju캖i velike prenose podataka, kao 코to su dnevni bekapi i analitika podataka u realnom vremenu, sa pobolj코anom privatno코캖u i brzinom.

### **Enumeracija**

{% code overflow="wrap" %}
```bash
# List ExpressRoute Circuits
az network express-route list --query "[].{name:name, location:location, resourceGroup:resourceGroup, serviceProviderName:serviceProviderName, peeringLocation:peeringLocation}" -o table
```
{% endcode %}

{% hint style="success" %}
Nau캜ite i ve쬭ajte AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Nau캜ite i ve쬭ajte GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Podr쬴te HackTricks</summary>

* Pogledajte [**planove pretplate**](https://github.com/sponsors/carlospolop)!
* **Pridru쬴te se** 游눫 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili **pratite** nas na **Twitteru** 游냕 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Delite hacking trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
{% endhint %}
