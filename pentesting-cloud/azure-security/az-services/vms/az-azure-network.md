# Az - Azure Network

{% hint style="success" %}
Lernen & √ºben Sie AWS Hacking:<img src="../../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Lernen & √ºben Sie GCP Hacking: <img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* √úberpr√ºfen Sie die [**Abonnementpl√§ne**](https://github.com/sponsors/carlospolop)!
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teilen Sie Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repos senden.

</details>
{% endhint %}

## Grundinformationen

Netzwerke innerhalb von Azure fungieren als integraler Bestandteil seiner Cloud-Computing-Plattform und erm√∂glichen die **Verbindung und Kommunikation zwischen verschiedenen Azure-Diensten und -Ressourcen**. Die Netzwerkarchitektur in Azure ist darauf ausgelegt, hochgradig skalierbar, sicher und anpassbar zu sein.

Im Kern bietet Azure ein **virtuelles Netzwerk (VNet)**, das es Benutzern erm√∂glicht, **isolierte** **Netzwerke** innerhalb der Azure-Cloud zu erstellen. Innerhalb dieser VNets k√∂nnen Ressourcen wie virtuelle Maschinen, Anwendungen und Datenbanken sicher gehostet und verwaltet werden. Das Networking in Azure unterst√ºtzt sowohl die Kommunikation innerhalb der Cloud (zwischen Azure-Diensten) als auch die Verbindung zu externen Netzwerken und dem Internet.

**Sicherheit** ist ein kritischer Aspekt des Azure- Netzwerks, mit verschiedenen Tools und Diensten, die zum Schutz von Daten, zur Verwaltung des Zugriffs und zur Gew√§hrleistung der Compliance verf√ºgbar sind. Diese Sicherheitsma√ünahmen umfassen **Firewalls**, **Netzwerksicherheitsgruppen** und **Verschl√ºsselungs**f√§higkeiten, die ein hohes Ma√ü an Kontrolle √ºber den Datenverkehr und den Zugriff erm√∂glichen.

Insgesamt sind die Netzwerkf√§higkeiten von Azure darauf ausgelegt, Flexibilit√§t zu bieten, sodass Benutzer eine Netzwerkumgebung schaffen k√∂nnen, die ihren spezifischen Anwendungs- und Arbeitslastanforderungen entspricht, w√§hrend ein starker Fokus auf Sicherheit und Zuverl√§ssigkeit gelegt wird.

## Virtuelles Netzwerk (VNET) & Subnetze

Ein VNet in Azure ist im Wesentlichen eine Darstellung Ihres eigenen Netzwerks in der Cloud. Es ist eine **logische Isolation der Azure-Cloud, die Ihrer Abonnements** gewidmet ist. Ein VNet erm√∂glicht es Ihnen, virtuelle private Netzwerke (VPNs) in Azure bereitzustellen und zu verwalten und kann verwendet werden, um **verschiedene Arten von Azure-Ressourcen** wie virtuelle Maschinen (VMs), Datenbanken und Anwendungsdienste zu hosten und zu verwalten.

VNets bieten Ihnen **vollst√§ndige Kontrolle √ºber Ihre Netzwerkeinstellungen**, einschlie√ülich **IP-Adress**bereichen, der Erstellung von Subnetzen, Routentabellen und Netzwerk-Gateways.

Ein **Subnetz** ist ein **Bereich von IP-Adressen in Ihrem VNet**. Sie k√∂nnen ein VNet in mehrere Subnetze unterteilen, um Organisation und Sicherheit zu gew√§hrleisten. Jedes Subnetz in einem VNet kann verwendet werden, um Ressourcen gem√§√ü Ihrer Netzwerk- und Anwendungsarchitektur zu isolieren und zu gruppieren.

Dar√ºber hinaus erm√∂glichen Subnetze, dass Sie Ihr VNet in ein oder mehrere Subnetzwerke **segmentieren**, die einen Bereich von IP-Adressen bereitstellen, den Ressourcen verwenden k√∂nnen.

### **Beispiel**

* Angenommen, Sie haben ein VNet mit dem Namen `MyVNet` mit einem IP-Adressbereich von `10.0.0.0/16`. Sie k√∂nnen innerhalb dieses VNets ein Subnetz erstellen, sagen wir `Subnet-1`, mit einem IP-Adressbereich von `10.0.0.0/24` f√ºr das Hosting Ihrer Webserver. Ein weiteres Subnetz, `Subnet-2` mit einem Bereich von `10.0.1.0/24`, k√∂nnte f√ºr Ihre Datenbankserver verwendet werden. Diese Segmentierung erm√∂glicht eine effiziente Verwaltung und Sicherheitskontrollen innerhalb des Netzwerks.

### Aufz√§hlung

Um alle VNets und Subnetze in einem Azure-Konto aufzulisten, k√∂nnen Sie die Azure-Befehlszeilenschnittstelle (CLI) verwenden. Hier sind die Schritte:

{% code overflow="wrap" %}
```bash
# List VNets
az network vnet list --query "[].{name:name, location:location, addressSpace:addressSpace}" -o table

# List subnets of a VNet
az network vnet subnet list --resource-group <ResourceGroupName> --vnet-name <VNetName> --query "[].{name:name, addressPrefix:addressPrefix}" -o table
```
{% endcode %}

## Netzwerk-Sicherheitsgruppen (NSG)

In Azure dient eine **Netzwerk-Sicherheitsgruppe (NSG)** der prim√§ren Funktion, den Netzwerkverkehr sowohl zu als auch von Azure-Ressourcen innerhalb eines Azure Virtual Network (VNet) zu filtern. Sie enth√§lt eine Reihe von **Sicherheitsregeln**, die den Fluss des Netzwerkverkehrs genau vorschreiben.

Wichtige Aspekte von NSG sind:

* **Verkehrskontrolle**: Jede NSG enth√§lt Regeln, die entscheidend daf√ºr sind, eingehenden und ausgehenden Netzwerkverkehr, der mit verschiedenen Azure-Ressourcen verbunden ist, entweder zuzulassen oder zu blockieren.
* **Regelkomponenten**: Die Regeln innerhalb einer NSG sind sehr spezifisch und filtern den Verkehr basierend auf Kriterien wie Quell-/Ziel-IP-Adresse, Port und Protokoll. Diese Spezifit√§t erm√∂glicht eine granulare Verwaltung des Netzwerkverkehrs.
* **Sicherheitsverbesserung**: Indem sichergestellt wird, dass nur autorisierter Verkehr in Ihre Azure-Ressourcen ein- oder austreten kann, spielen NSGs eine entscheidende Rolle bei der St√§rkung der Sicherheitslage Ihrer Netzwerk-Infrastruktur.

### **Beispiel**

* Stellen Sie sich vor, Sie haben eine NSG mit dem Namen `MyNSG`, die auf ein Subnetz oder eine bestimmte virtuelle Maschine innerhalb Ihres VNet angewendet wird. Sie k√∂nnen Regeln erstellen wie:
* Eine eingehende Regel, die HTTP-Verkehr (Port 80) von jeder Quelle zu Ihren Webservern zul√§sst.
* Eine ausgehende Regel, die nur SQL-Verkehr (Port 1433) zu einem bestimmten Ziel-IP-Adressbereich zul√§sst.

### Aufz√§hlung

{% code overflow="wrap" %}
```bash
# List NSGs
az network nsg list --query "[].{name:name, location:location}" -o table

# Get NSG rules
az network nsg rule list --nsg-name <NSGName> --resource-group <ResourceGroupName> --query "[].{name:name, priority:priority, direction:direction, access:access, protocol:protocol, sourceAddressPrefix:sourceAddressPrefix, destinationAddressPrefix:destinationAddressPrefix, sourcePortRange:sourcePortRange, destinationPortRange:destinationPortRange}" -o table
```
{% endcode %}

## Azure Firewall

Azure Firewall ist ein verwalteter, cloudbasierter **Netzwerksicherheitsdienst, der Ihre Azure Virtual Network-Ressourcen sch√ºtzt**. Es handelt sich um eine vollst√§ndig zustandsbehaftete Firewall als Dienst mit integrierten Hochverf√ºgbarkeits- und Skalierbarkeitsfunktionen.

Azure Firewall bietet **fortschrittlichere** Funktionen als **NSGs**, einschlie√ülich **Anwendungsebene-Filterung**, netzwerkbasierter Filterung, bedrohungsintelligenzbasierter Filterung und Integration mit Azure Monitor f√ºr Protokollierung und Analytik.\
Es kann ausgehenden, eingehenden, zwischen den Standorten, VPN- und ExpressRoute-Verkehr filtern. **Firewall-Regeln k√∂nnen basierend auf FQDN (Fully Qualified Domain Name), IP-Adressen und Ports erstellt werden**.

### Unterschiede zwischen Azure Firewall und NSGs

1. **Umfang:**
* **NSG:** Funktioniert auf der Subnetz- oder Netzwerkinterface-Ebene. Es soll eine grundlegende Filterung des eingehenden und ausgehenden Verkehrs von Netzwerkinterfaces (NIC), VMs oder Subnetzen bieten.
* **Azure Firewall:** Arbeitet auf der VNet-Ebene und bietet einen breiteren Schutzumfang. Es ist darauf ausgelegt, Ihre virtuellen Netzwerkressourcen zu sichern und den Verkehr, der in das VNet hinein und heraus flie√üt, zu verwalten.
2. **F√§higkeiten:**
* **NSG:** Bietet grundlegende Filterf√§higkeiten basierend auf IP-Adresse, Port und Protokoll. Es unterst√ºtzt keine fortschrittlichen Funktionen wie die Inspektion auf Anwendungsebene oder Bedrohungsintelligenz.
* **Azure Firewall:** Bietet fortschrittliche Funktionen wie die Filterung von Verkehr auf Anwendungsebene (Layer 7), bedrohungsintelligenzbasierte Filterung, Netzwerkverkehrsfilterung und mehr. Es unterst√ºtzt auch mehrere √∂ffentliche IP-Adressen.
3. **Anwendungsf√§lle:**
* **NSG:** Ideal f√ºr grundlegende Filterung des Netzwerkverkehrs.
* **Azure Firewall:** Geeignet f√ºr komplexere Filterszenarien, in denen Kontrolle auf Anwendungsebene, Protokollierung und Bedrohungsintelligenz erforderlich sind.
4. **Verwaltung und √úberwachung:**
* **NSG:** Bietet grundlegende Protokollierung und Integration mit Azure Monitor.
* **Azure Firewall:** Bietet erweiterte Protokollierungs- und Analysef√§higkeiten √ºber Azure Monitor, die f√ºr das Verst√§ndnis der Art und des Musters des Verkehrs unerl√§sslich sind.

### Enumeration

{% code overflow="wrap" %}
```bash
# List Azure Firewalls
az network firewall list --query "[].{name:name, location:location, subnet:subnet, publicIp:publicIp}" -o table

# Get network rules of a firewall
az network firewall network-rule collection list --firewall-name <FirewallName> --resource-group <ResourceGroupName> --query "[].{name:name, rules:rules}" -o table

# Get application rules of a firewall
az network firewall application-rule collection list --firewall-name <FirewallName> --resource-group <ResourceGroupName> --query "[].{name:name, rules:rules}" -o table

# Get nat rules of a firewall
az network firewall nat-rule collection list --firewall-name <FirewallName> --resource-group <ResourceGroupName> --query "[].{name:name, rules:rules}" -o table
```
{% endcode %}

## Netzwerk-Virtual-Appliance (NVA)

Eine Netzwerk-Virtual-Appliance (**NVA**) in Azure ist eine virtuelle Appliance, die **Netzwerkfunktionen innerhalb eines virtuellen Netzwerks ausf√ºhrt**. NVAs werden typischerweise f√ºr Netzwerkfunktionen verwendet, die **nicht nativ verf√ºgbar sind** in Azure oder wenn mehr Anpassung erforderlich ist. Sie sind im Wesentlichen **VMs, die Netzwerk-Anwendungen oder -Dienste ausf√ºhren**, wie Firewalls, WAN-Optimierer oder Lastenausgleicher.

NVAs werden f√ºr komplexe Routing-, **Sicherheits-** und **Netzwerkverkehrsmanagement**-Aufgaben verwendet. Sie k√∂nnen aus dem Azure **Marketplace** bereitgestellt werden, wo viele Drittanbieter ihre Appliances zur Integration in Azure-Umgebungen anbieten.

### **Beispiel**

* Eine Organisation kann eine NVA in Azure bereitstellen, um eine **benutzerdefinierte Firewall-L√∂sung** zu erstellen. Diese NVA k√∂nnte eine **Firewall-Software eines Drittanbieters** ausf√ºhren, die erweiterte Funktionen wie Intrusion Detection, Paketinspektion oder VPN-Konnektivit√§t bietet. Die NVA kann so konfiguriert werden, dass sie den durch sie flie√üenden Verkehr inspiziert und filtert, um sicherzustellen, dass verbesserte Sicherheitsma√ünahmen gem√§√ü den Richtlinien der Organisation implementiert sind.

### **Enumeration**

{% code overflow="wrap" %}
```bash
# Usually NVAs are named or tagged in a way to distinguish them from other VMs
az vm list --query "[].{name:name, resourceGroup:resourceGroup, location:location}" -o table

# For a specific VM identified as an NVA, list its network interfaces
az vm nic list --vm-name <VMName> --resource-group <ResourceGroupName> --query "[].{id:id}" -o table
```
{% endcode %}

## Azure-Routingtabellen & Benutzerdefinierte Routen (UDR)

**Azure-Routingtabellen** sind eine Funktion innerhalb von Microsoft Azure, die die **Steuerung des Netzwerkverkehrs innerhalb von Azure Virtual Networks (VNets)** erm√∂glicht. Im Wesentlichen definieren sie, wie **Pakete** zwischen Subnetzen innerhalb von VNets, zwischen VNets oder zu externen Netzwerken **weitergeleitet** werden. Jede Routingtabelle enth√§lt eine Reihe von Regeln, die als Routen bekannt sind und angeben, wie Pakete basierend auf ihren Ziel-IP-Adressen geroutet werden sollen.

**Benutzerdefinierte Routen (UDR)** in Azure sind **benutzerdefinierte Routen, die Sie innerhalb von Azure-Routingtabellen erstellen**, um den **Fluss des Netzwerkverkehrs** innerhalb und zwischen Azure Virtual Networks (VNets) sowie zu externen Verbindungen zu steuern. UDRs geben Ihnen die Flexibilit√§t, den Netzwerkverkehr gem√§√ü Ihren spezifischen Anforderungen zu lenken und die Standardroutingentscheidungen von Azure zu √ºberschreiben.

Diese Routen sind besonders n√ºtzlich f√ºr Szenarien, in denen Sie **Verkehr durch ein virtuelles Ger√§t** leiten, einen bestimmten Pfad f√ºr Sicherheits- oder Richtlinienkonformit√§t durchsetzen oder mit lokalen Netzwerken integrieren m√ºssen.

### **Beispiel**

* Angenommen, Sie haben ein Network Virtual Appliance (NVA) bereitgestellt, um den Verkehr zwischen Subnetzen innerhalb eines VNets zu inspizieren. Sie k√∂nnen eine UDR erstellen, die den gesamten Verkehr von einem Subnetz zu einem anderen Subnetz √ºber die NVA leitet. Diese UDR stellt sicher, dass die NVA den Verkehr aus Sicherheitsgr√ºnden inspiziert, bevor er sein Ziel erreicht.

### **Enumeration**

{% code overflow="wrap" %}
```bash
# List Route Tables
az network route-table list --query "[].{name:name, resourceGroup:resourceGroup, location:location}" -o table

# List UDRs for a table
az network route-table route list --route-table-name <RouteTableName> --resource-group <ResourceGroupName> --query "[].{name:name, addressPrefix:addressPrefix, nextHopType:nextHopType, nextHopIpAddress:nextHopIpAddress}" -o table
```
{% endcode %}

## Azure Private Link

Azure Private Link ist ein Dienst in Azure, der **privaten Zugriff auf Azure-Dienste erm√∂glicht**, indem sichergestellt wird, dass **der Datenverkehr zwischen Ihrem Azure-virtuellen Netzwerk (VNet) und dem Dienst vollst√§ndig innerhalb des Backbone-Netzwerks von Microsoft Azure verl√§uft**. Es bringt den Dienst effektiv in Ihr VNet. Diese Konfiguration verbessert die Sicherheit, indem die Daten nicht dem √∂ffentlichen Internet ausgesetzt werden.

Private Link kann mit verschiedenen Azure-Diensten verwendet werden, wie Azure Storage, Azure SQL Database und benutzerdefinierten Diensten, die √ºber Private Link geteilt werden. Es bietet eine sichere M√∂glichkeit, Dienste aus Ihrem eigenen VNet oder sogar aus verschiedenen Azure-Abonnements zu konsumieren.

{% hint style="danger" %}
NSGs gelten nicht f√ºr private Endpunkte, was eindeutig bedeutet, dass die Zuordnung eines NSG zu einem Subnetz, das den Private Link enth√§lt, keine Auswirkungen hat.
{% endhint %}

### **Beispiel**

* Betrachten Sie ein Szenario, in dem Sie eine **Azure SQL-Datenbank haben, auf die Sie sicher von Ihrem VNet aus zugreifen m√∂chten**. Normalerweise k√∂nnte dies den Zugriff √ºber das √∂ffentliche Internet erfordern. Mit Private Link k√∂nnen Sie einen **privaten Endpunkt in Ihrem VNet erstellen**, der direkt mit dem Azure SQL-Datenbankdienst verbunden ist. Dieser Endpunkt l√§sst die Datenbank so erscheinen, als w√§re sie Teil Ihres eigenen VNet, zug√§nglich √ºber eine private IP-Adresse, und gew√§hrleistet so einen sicheren und privaten Zugriff.

### **Enumeration**

{% code overflow="wrap" %}
```bash
# List Private Link Services
z network private-link-service list --query "[].{name:name, location:location, resourceGroup:resourceGroup}" -o table

# List Private Endpoints
az network private-endpoint list --query "[].{name:name, location:location, resourceGroup:resourceGroup, privateLinkServiceConnections:privateLinkServiceConnections}" -o table
```
{% endcode %}

## Azure Service Endpoints

Azure Service Endpoints erweitern den privaten Adressraum Ihres virtuellen Netzwerks und die Identit√§t Ihres VNets zu Azure-Diensten √ºber eine direkte Verbindung. Durch die Aktivierung von Service-Endpunkten k√∂nnen **Ressourcen in Ihrem VNet sicher mit Azure-Diensten** wie Azure Storage und Azure SQL Database √ºber das Backbone-Netzwerk von Azure verbunden werden. Dies stellt sicher, dass der **Verkehr vom VNet zum Azure-Dienst innerhalb des Azure-Netzwerks bleibt**, was einen sichereren und zuverl√§ssigeren Pfad bietet.

### **Beispiel**

* Zum Beispiel ist ein **Azure Storage**-Konto standardm√§√üig √ºber das √∂ffentliche Internet zug√§nglich. Durch die Aktivierung eines **Service-Endpunkts f√ºr Azure Storage innerhalb Ihres VNet** k√∂nnen Sie sicherstellen, dass nur der Verkehr von Ihrem VNet auf das Speicherkonto zugreifen kann. Die Firewall des Speicherkontos kann dann so konfiguriert werden, dass sie nur Verkehr von Ihrem VNet akzeptiert.

### **Enumeration**

{% code overflow="wrap" %}
```bash
# List Virtual Networks with Service Endpoints
az network vnet list --query "[].{name:name, location:location, serviceEndpoints:serviceEndpoints}" -o table

# List Subnets with Service Endpoints
az network vnet subnet list --resource-group <ResourceGroupName> --vnet-name <VNetName> --query "[].{name:name, serviceEndpoints:serviceEndpoints}" -o table
```
{% endcode %}

### Unterschiede zwischen Service-Endpunkten und privaten Links

Microsoft empfiehlt die Verwendung von privaten Links in den [**docs**](https://learn.microsoft.com/en-us/azure/virtual-network/vnet-integration-for-azure-services#compare-private-endpoints-and-service-endpoints):\\

<figure><img src="../../../../.gitbook/assets/image (25).png" alt=""><figcaption></figcaption></figure>

**Service-Endpunkte:**

* Der Datenverkehr von Ihrem VNet zum Azure-Dienst verl√§uft √ºber das Microsoft Azure Backbone-Netzwerk und umgeht das √∂ffentliche Internet.
* Der Endpunkt ist eine direkte Verbindung zum Azure-Dienst und bietet keine private IP f√ºr den Dienst innerhalb des VNet.
* Der Dienst selbst ist weiterhin √ºber seinen √∂ffentlichen Endpunkt von au√üerhalb Ihres VNet zug√§nglich, es sei denn, Sie konfigurieren die Dienstfirewall, um solchen Datenverkehr zu blockieren.
* Es besteht eine Eins-zu-eins-Beziehung zwischen dem Subnetz und dem Azure-Dienst.
* G√ºnstiger als private Links.

**Private Links:**

* Private Link ordnet Azure-Dienste √ºber einen privaten Endpunkt in Ihr VNet zu, der eine Netzwerkschnittstelle mit einer privaten IP-Adresse innerhalb Ihres VNet ist.
* Der Azure-Dienst wird √ºber diese private IP-Adresse aufgerufen, wodurch es so aussieht, als w√§re er Teil Ihres Netzwerks.
* Dienste, die √ºber Private Link verbunden sind, k√∂nnen nur von Ihrem VNet oder verbundenen Netzwerken aus aufgerufen werden; es gibt keinen √∂ffentlichen Internetzugang zum Dienst.
* Es erm√∂glicht eine sichere Verbindung zu Azure-Diensten oder Ihren eigenen in Azure gehosteten Diensten sowie eine Verbindung zu von anderen geteilten Diensten.
* Es bietet eine granularere Zugriffskontrolle √ºber einen privaten Endpunkt in Ihrem VNet, im Gegensatz zu einer breiteren Zugriffskontrolle auf Subnetzebene mit Service-Endpunkten.

Zusammenfassend l√§sst sich sagen, dass sowohl Service-Endpunkte als auch private Links eine sichere Konnektivit√§t zu Azure-Diensten bieten, **aber private Links ein h√∂heres Ma√ü an Isolation und Sicherheit bieten, indem sie sicherstellen, dass Dienste privat ohne Exposition gegen√ºber dem √∂ffentlichen Internet aufgerufen werden**. Service-Endpunkte hingegen sind einfacher einzurichten f√ºr allgemeine F√§lle, in denen ein einfacher, sicherer Zugriff auf Azure-Dienste erforderlich ist, ohne dass eine private IP im VNet ben√∂tigt wird.

## Azure Front Door (AFD) & AFD WAF

**Azure Front Door** ist ein skalierbarer und sicherer Einstiegspunkt f√ºr die **schnelle Bereitstellung** Ihrer globalen Webanwendungen. Es **kombiniert** verschiedene Dienste wie globale **Lastverteilung, Standortbeschleunigung, SSL-Offloading und Web Application Firewall (WAF)**-Funktionen in einem einzigen Dienst. Azure Front Door bietet intelligentes Routing basierend auf dem **n√§chsten Edge-Standort zum Benutzer**, um optimale Leistung und Zuverl√§ssigkeit zu gew√§hrleisten. Dar√ºber hinaus bietet es URL-basiertes Routing, Hosting mehrerer Standorte, Sitzungsaffinit√§t und Sicherheit auf Anwendungsebene.

**Azure Front Door WAF** ist darauf ausgelegt, **Webanwendungen vor web-basierten Angriffen** zu sch√ºtzen, ohne dass √Ñnderungen am Backend-Code erforderlich sind. Es umfasst benutzerdefinierte Regeln und verwaltete Regelsets, um vor Bedrohungen wie SQL-Injection, Cross-Site-Scripting und anderen g√§ngigen Angriffen zu sch√ºtzen.

### **Beispiel**

* Stellen Sie sich vor, Sie haben eine global verteilte Anwendung mit Benutzern auf der ganzen Welt. Sie k√∂nnen Azure Front Door verwenden, um **Benutzeranfragen an das n√§chstgelegene regionale Rechenzentrum** weiterzuleiten, das Ihre Anwendung hostet, wodurch die Latenz verringert, die Benutzererfahrung verbessert und **es vor Webangriffen mit den WAF-Funktionen gesch√ºtzt wird**. Wenn eine bestimmte Region Ausfallzeiten hat, kann Azure Front Door den Datenverkehr automatisch an den n√§chstbesten Standort umleiten, um eine hohe Verf√ºgbarkeit sicherzustellen.

### Enumeration

{% code overflow="wrap" %}
```bash
# List Azure Front Door Instances
az network front-door list --query "[].{name:name, resourceGroup:resourceGroup, location:location}" -o table

# List Front Door WAF Policies
az network front-door waf-policy list --query "[].{name:name, resourceGroup:resourceGroup, location:location}" -o table
```
{% endcode %}

## Azure Application Gateway und Azure Application Gateway WAF

Azure Application Gateway ist ein **Web-Traffic-Lastenausgleich**-Dienst, der es Ihnen erm√∂glicht, den Verkehr zu Ihren **Web**-Anwendungen zu verwalten. Es bietet **Layer 7 Lastenausgleich, SSL-Terminierung und Webanwendungsfirewall (WAF)-Funktionen** im Application Delivery Controller (ADC) als Dienst. Zu den wichtigsten Funktionen geh√∂ren URL-basiertes Routing, cookie-basierten Sitzungsaffinit√§t und SSL-Offloading, die f√ºr Anwendungen, die komplexe Lastenausgleichsfunktionen wie globales Routing und pfadbasiertes Routing erfordern, entscheidend sind.

### Beispiel

* Stellen Sie sich ein Szenario vor, in dem Sie eine E-Commerce-Website haben, die mehrere Subdomains f√ºr verschiedene Funktionen umfasst, wie z. B. Benutzerkonten und Zahlungsabwicklung. Azure Application Gateway kann **den Verkehr basierend auf dem URL-Pfad an die entsprechenden Webserver weiterleiten**. Zum Beispiel k√∂nnte der Verkehr zu `example.com/accounts` an den Dienst f√ºr Benutzerkonten geleitet werden, und der Verkehr zu `example.com/pay` k√∂nnte an den Dienst f√ºr die Zahlungsabwicklung geleitet werden.\
Und **sch√ºtzen Sie Ihre Website vor Angriffen mit den WAF-Funktionen.**

### **Enumeration**

{% code overflow="wrap" %}
```bash
# List the Web Application Firewall configurations for your Application Gateways
az network application-gateway waf-config list --gateway-name <AppGatewayName> --resource-group <ResourceGroupName> --query "[].{name:name, firewallMode:firewallMode, ruleSetType:ruleSetType, ruleSetVersion:ruleSetVersion}" -o table
```
{% endcode %}

## Azure Hub, Spoke & VNet Peering

**VNet Peering** ist eine Netzwerkfunktion in Azure, die **es erm√∂glicht, verschiedene Virtuelle Netzwerke (VNets) direkt und nahtlos zu verbinden**. Durch VNet Peering k√∂nnen Ressourcen in einem VNet mit Ressourcen in einem anderen VNet √ºber private IP-Adressen kommunizieren, **als ob sie sich im selben Netzwerk bef√§nden**.\
**VNet Peering kann auch mit On-Premise-Netzwerken verwendet werden**, indem ein Site-to-Site-VPN oder Azure ExpressRoute eingerichtet wird.

**Azure Hub und Spoke** ist eine Netzwerk-Topologie, die in Azure verwendet wird, um den Netzwerkverkehr zu verwalten und zu organisieren. **Der "Hub" ist ein zentraler Punkt, der den Verkehr zwischen verschiedenen "Speichen" steuert und leitet**. Der Hub enth√§lt typischerweise gemeinsame Dienste wie Netzwerkvirtualger√§te (NVAs), Azure VPN Gateway, Azure Firewall oder Azure Bastion. Die **"Speichen" sind VNets, die Workloads hosten und √ºber VNet Peering mit dem Hub verbunden sind**, wodurch sie die gemeinsamen Dienste innerhalb des Hubs nutzen k√∂nnen. Dieses Modell f√∂rdert eine saubere Netzwerkstruktur und reduziert die Komplexit√§t, indem es gemeinsame Dienste zentralisiert, die von mehreren Workloads in verschiedenen VNets genutzt werden k√∂nnen.

{% hint style="danger" %}
**VNET-Peering ist in Azure nicht transitiv**, was bedeutet, dass, wenn Speiche 1 mit Speiche 2 verbunden ist und Speiche 2 mit Speiche 3 verbunden ist, Speiche 1 nicht direkt mit Speiche 3 kommunizieren kann.
{% endhint %}

### Beispiele

* Stellen Sie sich ein Unternehmen mit separaten Abteilungen wie Vertrieb, Personalwesen und Entwicklung vor, **jede mit ihrem eigenen VNet (den Speichen)**. Diese VNets **ben√∂tigen Zugriff auf gemeinsame Ressourcen** wie eine zentrale Datenbank, eine Firewall und ein Internet-Gateway, die sich alle in **einem anderen VNet (dem Hub)** befinden. Durch die Verwendung des Hub- und Spoke-Modells kann jede Abteilung **sicher auf die gemeinsamen Ressourcen √ºber das Hub-VNet zugreifen, ohne diese Ressourcen dem √∂ffentlichen Internet auszusetzen** oder eine komplexe Netzwerkstruktur mit zahlreichen Verbindungen zu schaffen.

### Enumeration

{% code overflow="wrap" %}
```bash
# List all VNets in your subscription
az network vnet list --query "[].{name:name, location:location, addressSpace:addressSpace}" -o table

# List VNet peering connections for a given VNet
az network vnet peering list --resource-group <ResourceGroupName> --vnet-name <VNetName> --query "[].{name:name, peeringState:peeringState, remoteVnetId:remoteVnetId}" -o table

# List Shared Resources (e.g., Azure Firewall) in the Hub
az network firewall list --query "[].{name:name, location:location, resourceGroup:resourceGroup}" -o table
```
{% endcode %}

## Site-to-Site VPN

Ein Site-to-Site VPN in Azure erm√∂glicht es Ihnen, **Ihr lokales Netzwerk mit Ihrem Azure Virtual Network (VNet) zu verbinden**, sodass Ressourcen wie VMs innerhalb von Azure so erscheinen, als w√§ren sie in Ihrem lokalen Netzwerk. Diese Verbindung wird √ºber ein **VPN-Gateway hergestellt, das den Datenverkehr zwischen den beiden Netzwerken verschl√ºsselt**.

### **Beispiel**

* Ein Unternehmen mit seinem Hauptb√ºro in New York hat ein lokales Rechenzentrum, das sicher mit seinem VNet in Azure verbunden werden muss, das seine virtualisierten Arbeitslasten hostet. Durch die Einrichtung eines **Site-to-Site VPN kann das Unternehmen eine verschl√ºsselte Verbindung zwischen den lokalen Servern und den Azure VMs sicherstellen**, sodass Ressourcen sicher √ºber beide Umgebungen hinweg zugegriffen werden kann, als w√§ren sie im selben lokalen Netzwerk.

### **Enumeration**

{% code overflow="wrap" %}
```bash
# List VPN Gateways
az network vnet-gateway list --query "[].{name:name, location:location, resourceGroup:resourceGroup}" -o table

# List VPN Connections
az network vpn-connection list --gateway-name <VpnGatewayName> --resource-group <ResourceGroupName> --query "[].{name:name, connectionType:connectionType, connectionStatus:connectionStatus}" -o table
```
{% endcode %}

## Azure ExpressRoute

Azure ExpressRoute ist ein Dienst, der eine **private, dedizierte, hochgeschwindigkeitsverbindung zwischen Ihrer lokalen Infrastruktur und den Azure-Rechenzentren** bereitstellt. Diese Verbindung erfolgt √ºber einen Konnektivit√§tsanbieter, umgeht das √∂ffentliche Internet und bietet mehr Zuverl√§ssigkeit, schnellere Geschwindigkeiten, geringere Latenzen und h√∂here Sicherheit als typische Internetverbindungen.

### **Beispiel**

* Ein multinationales Unternehmen ben√∂tigt eine **konstante und zuverl√§ssige Verbindung zu seinen Azure-Diensten aufgrund des hohen Datenvolumens** und des Bedarfs an hoher Durchsatzrate. Das Unternehmen entscheidet sich f√ºr Azure ExpressRoute, um sein lokales Rechenzentrum direkt mit Azure zu verbinden, was gro√üangelegte Daten√ºbertragungen, wie t√§gliche Backups und Echtzeitanalysen, mit verbesserter Privatsph√§re und Geschwindigkeit erleichtert.

### **Enumeration**

{% code overflow="wrap" %}
```bash
# List ExpressRoute Circuits
az network express-route list --query "[].{name:name, location:location, resourceGroup:resourceGroup, serviceProviderName:serviceProviderName, peeringLocation:peeringLocation}" -o table
```
{% endcode %}

{% hint style="success" %}
Lernen & √ºben Sie AWS Hacking:<img src="../../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Lernen & √ºben Sie GCP Hacking: <img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Unterst√ºtzen Sie HackTricks</summary>

* √úberpr√ºfen Sie die [**Abonnementpl√§ne**](https://github.com/sponsors/carlospolop)!
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teilen Sie Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repos senden.

</details>
{% endhint %}
