# Az - Azure Network

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** 💬 [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Basic Information

Τα δίκτυα μέσα στο Azure λειτουργούν ως αναπόσπαστο μέρος της πλατφόρμας υπολογιστικού νέφους, επιτρέποντας τη **σύνδεση και επικοινωνία μεταξύ διαφόρων υπηρεσιών και πόρων του Azure**. Η αρχιτεκτονική δικτύου στο Azure έχει σχεδιαστεί για να είναι εξαιρετικά κλιμακούμενη, ασφαλής και προσαρμόσιμη.

Στον πυρήνα του, το Azure παρέχει ένα **εικονικό δίκτυο (VNet)** που επιτρέπει στους χρήστες να δημιουργούν **απομονωμένα** **δίκτυα** μέσα στο νέφος του Azure. Μέσα σε αυτά τα VNets, πόροι όπως εικονικές μηχανές, εφαρμογές και βάσεις δεδομένων μπορούν να φιλοξενούνται και να διαχειρίζονται με ασφάλεια. Η δικτύωση στο Azure υποστηρίζει τόσο την επικοινωνία εντός του νέφους (μεταξύ υπηρεσιών Azure) όσο και τη σύνδεση με εξωτερικά δίκτυα και το διαδίκτυο.

**Η ασφάλεια** είναι μια κρίσιμη πτυχή της δικτύωσης του Azure, με διάφορα εργαλεία και υπηρεσίες διαθέσιμα για την προστασία των δεδομένων, τη διαχείριση της πρόσβασης και την εξασφάλιση της συμμόρφωσης. Αυτά τα μέτρα ασφαλείας περιλαμβάνουν **firewalls**, **ομάδες ασφαλείας δικτύου** και **δυνατότητες κρυπτογράφησης**, επιτρέποντας έναν υψηλό βαθμό ελέγχου της κυκλοφορίας και της πρόσβασης.

Συνολικά, οι δυνατότητες δικτύωσης του Azure έχουν σχεδιαστεί για να προσφέρουν ευελιξία, επιτρέποντας στους χρήστες να δημιουργούν ένα περιβάλλον δικτύου που να ταιριάζει στις συγκεκριμένες ανάγκες εφαρμογών και φορτίων εργασίας τους, διατηρώντας παράλληλα μια ισχυρή έμφαση στην ασφάλεια και την αξιοπιστία.

## Virtual Network (VNET) & Subnets

Ένα VNet στο Azure είναι ουσιαστικά μια αναπαράσταση του δικού σας δικτύου στο νέφος. Είναι μια **λογική απομόνωση του νέφους Azure αφιερωμένη στη συνδρομή σας**. Ένα VNet σας επιτρέπει να προμηθεύεστε και να διαχειρίζεστε εικονικά ιδιωτικά δίκτυα (VPNs) στο Azure και μπορεί να χρησιμοποιηθεί για τη φιλοξενία και **διαχείριση πολλών τύπων πόρων Azure**, όπως Εικονικές Μηχανές (VMs), βάσεις δεδομένων και υπηρεσίες εφαρμογών.

Τα VNets σας παρέχουν **πλήρη έλεγχο στις ρυθμίσεις του δικτύου σας**, συμπεριλαμβανομένων των **εύρους διευθύνσεων IP**, της δημιουργίας υποδικτύων, των πινάκων δρομολόγησης και των πύλων δικτύου.

Ένα **υποδίκτυο** είναι ένα **εύρος διευθύνσεων IP στο VNet σας**. Μπορείτε να διαιρέσετε ένα VNet σε πολλά υποδίκτυα για οργάνωση και ασφάλεια. Κάθε υποδίκτυο σε ένα VNet μπορεί να χρησιμοποιηθεί για την απομόνωση και ομαδοποίηση πόρων σύμφωνα με την αρχιτεκτονική του δικτύου και της εφαρμογής σας.

Επιπλέον, τα υποδίκτυα σας επιτρέπουν να **τμηματοποιήσετε το VNet σας σε ένα ή περισσότερα υποδίκτυα**, παρέχοντας ένα εύρος διευθύνσεων IP που μπορούν να χρησιμοποιήσουν οι πόροι.

### **Example**

* Υποθέστε ότι έχετε ένα VNet ονόματι `MyVNet` με εύρος διευθύνσεων IP `10.0.0.0/16`. Μπορείτε να δημιουργήσετε ένα υποδίκτυο μέσα σε αυτό το VNet, ας πούμε `Subnet-1`, με εύρος διευθύνσεων IP `10.0.0.0/24` για τη φιλοξενία των διακομιστών ιστού σας. Ένα άλλο υποδίκτυο, `Subnet-2` με εύρος `10.0.1.0/24`, θα μπορούσε να χρησιμοποιηθεί για τους διακομιστές βάσεων δεδομένων σας. Αυτή η τμηματοποίηση επιτρέπει την αποδοτική διαχείριση και τους ελέγχους ασφαλείας εντός του δικτύου.

### Enumeration

Για να καταγράψετε όλα τα VNets και υποδίκτυα σε έναν λογαριασμό Azure, μπορείτε να χρησιμοποιήσετε το Azure Command-Line Interface (CLI). Ακολουθούν τα βήματα:

{% code overflow="wrap" %}
```bash
# List VNets
az network vnet list --query "[].{name:name, location:location, addressSpace:addressSpace}" -o table

# List subnets of a VNet
az network vnet subnet list --resource-group <ResourceGroupName> --vnet-name <VNetName> --query "[].{name:name, addressPrefix:addressPrefix}" -o table
```
{% endcode %}

## Ομάδες Ασφαλείας Δικτύου (NSG)

Στο Azure, μια **Ομάδα Ασφαλείας Δικτύου (NSG)** έχει ως κύρια λειτουργία την φιλτράρισμα της δικτυακής κίνησης τόσο προς όσο και από τους πόρους του Azure εντός ενός Azure Virtual Network (VNet). Περιέχει ένα σύνολο **κανόνων ασφαλείας** που καθορίζουν προσεκτικά τη ροή της δικτυακής κίνησης.

Βασικά στοιχεία του NSG περιλαμβάνουν:

* **Έλεγχος Κίνησης**: Κάθε NSG περιέχει κανόνες που είναι καθοριστικοί για την έγκριση ή την απόρριψη της εισερχόμενης και εξερχόμενης δικτυακής κίνησης που σχετίζεται με διάφορους πόρους του Azure.
* **Συστατικά Κανόνων**: Οι κανόνες εντός ενός NSG είναι πολύ συγκεκριμένοι, φιλτράροντας την κίνηση με βάση κριτήρια όπως η διεύθυνση IP προέλευσης/προορισμού, η θύρα και το πρωτόκολλο. Αυτή η συγκεκριμένη προσέγγιση επιτρέπει την λεπτομερή διαχείριση της δικτυακής κίνησης.
* **Ενίσχυση Ασφαλείας**: Διασφαλίζοντας ότι μόνο η εξουσιοδοτημένη κίνηση μπορεί να εισέλθει ή να εξέλθει από τους πόρους σας στο Azure, οι NSGs παίζουν κρίσιμο ρόλο στην ενίσχυση της ασφάλειας της υποδομής δικτύου σας.

### **Παράδειγμα**

* Φανταστείτε ότι έχετε μια NSG ονόματι `MyNSG` που εφαρμόζεται σε ένα υποδίκτυο ή σε μια συγκεκριμένη εικονική μηχανή εντός του VNet σας. Μπορείτε να δημιουργήσετε κανόνες όπως:
* Ένας εισερχόμενος κανόνας που επιτρέπει την κίνηση HTTP (θύρα 80) από οποιαδήποτε πηγή στους διακομιστές ιστού σας.
* Ένας εξερχόμενος κανόνας που επιτρέπει μόνο την κίνηση SQL (θύρα 1433) σε μια συγκεκριμένη περιοχή διευθύνσεων IP προορισμού.

### Αρίθμηση

{% code overflow="wrap" %}
```bash
# List NSGs
az network nsg list --query "[].{name:name, location:location}" -o table

# Get NSG rules
az network nsg rule list --nsg-name <NSGName> --resource-group <ResourceGroupName> --query "[].{name:name, priority:priority, direction:direction, access:access, protocol:protocol, sourceAddressPrefix:sourceAddressPrefix, destinationAddressPrefix:destinationAddressPrefix, sourcePortRange:sourcePortRange, destinationPortRange:destinationPortRange}" -o table
```
{% endcode %}

## Azure Firewall

Το Azure Firewall είναι μια διαχειριζόμενη, cloud-based **υπηρεσία ασφάλειας δικτύου που προστατεύει τους πόρους του Azure Virtual Network**. Είναι ένα πλήρως stateful firewall ως υπηρεσία με ενσωματωμένα χαρακτηριστικά υψηλής διαθεσιμότητας και κλιμάκωσης.

Το Azure Firewall παρέχει **πιο προηγμένα** χαρακτηριστικά από τα **NSGs**, συμπεριλαμβανομένου του **φιλτραρίσματος σε επίπεδο εφαρμογής**, φιλτραρίσματος σε επίπεδο δικτύου, φιλτραρίσματος βάσει πληροφοριών απειλών και ενσωμάτωσης με το Azure Monitor για καταγραφή και ανάλυση.\
Μπορεί να φιλτράρει την έξοδο, την είσοδο, την κίνηση μεταξύ spoke-to-spoke, VPN και ExpressRoute. **Οι κανόνες του firewall μπορούν να δημιουργηθούν με βάση το FQDN (Fully Qualified Domain Name), διευθύνσεις IP και θύρες**.

### Διαφορές μεταξύ Azure Firewall και NSGs

1. **Πεδίο εφαρμογής:**
* **NSG:** Λειτουργεί σε επίπεδο υποδικτύου ή διεπαφής δικτύου. Σκοπός του είναι να παρέχει βασικό φιλτράρισμα της εισερχόμενης και εξερχόμενης κίνησης από διεπαφές δικτύου (NIC), VMs ή υποδίκτυα.
* **Azure Firewall:** Λειτουργεί σε επίπεδο VNet, παρέχοντας ευρύτερο πεδίο προστασίας. Είναι σχεδιασμένο να ασφαλίζει τους πόρους του εικονικού δικτύου σας και να διαχειρίζεται την κίνηση που ρέει μέσα και έξω από το VNet.
2. **Δυνατότητες:**
* **NSG:** Παρέχει βασικές δυνατότητες φιλτραρίσματος βάσει διεύθυνσης IP, θύρας και πρωτοκόλλου. Δεν υποστηρίζει προηγμένα χαρακτηριστικά όπως επιθεώρηση σε επίπεδο εφαρμογής ή πληροφορίες απειλών.
* **Azure Firewall:** Προσφέρει προηγμένα χαρακτηριστικά όπως φιλτράρισμα κίνησης σε επίπεδο εφαρμογής (Layer 7), φιλτράρισμα βάσει πληροφοριών απειλών, φιλτράρισμα δικτυακής κίνησης και άλλα. Υποστηρίζει επίσης πολλαπλές δημόσιες διευθύνσεις IP.
3. **Περίπτωσεις Χρήσης:**
* **NSG:** Ιδανικό για βασικό φιλτράρισμα κίνησης σε επίπεδο δικτύου.
* **Azure Firewall:** Κατάλληλο για πιο σύνθετα σενάρια φιλτραρίσματος όπου απαιτείται έλεγχος σε επίπεδο εφαρμογής, καταγραφή και πληροφορίες απειλών.
4. **Διαχείριση και Παρακολούθηση:**
* **NSG:** Προσφέρει βασική καταγραφή και ενσωμάτωση με το Azure Monitor.
* **Azure Firewall:** Παρέχει προηγμένες δυνατότητες καταγραφής και ανάλυσης μέσω του Azure Monitor, που είναι απαραίτητο για την κατανόηση της φύσης και του προτύπου της κίνησης.

### Enumeration

{% code overflow="wrap" %}
```bash
# List Azure Firewalls
az network firewall list --query "[].{name:name, location:location, subnet:subnet, publicIp:publicIp}" -o table

# Get network rules of a firewall
az network firewall network-rule collection list --firewall-name <FirewallName> --resource-group <ResourceGroupName> --query "[].{name:name, rules:rules}" -o table

# Get application rules of a firewall
az network firewall application-rule collection list --firewall-name <FirewallName> --resource-group <ResourceGroupName> --query "[].{name:name, rules:rules}" -o table

# Get nat rules of a firewall
az network firewall nat-rule collection list --firewall-name <FirewallName> --resource-group <ResourceGroupName> --query "[].{name:name, rules:rules}" -o table
```
{% endcode %}

## Network Virtual Appliance (NVA)

Ένα Network Virtual Appliance (**NVA**) στο Azure είναι μια εικονική συσκευή που **εκτελεί λειτουργίες δικτύου μέσα σε ένα εικονικό δίκτυο**. Τα NVAs χρησιμοποιούνται συνήθως για λειτουργίες δικτύου που **δεν είναι εγγενώς διαθέσιμες** στο Azure ή όταν απαιτείται περισσότερη προσαρμογή. Είναι ουσιαστικά **VMs που εκτελούν εφαρμογές ή υπηρεσίες δικτύου**, όπως τείχη προστασίας, βελτιστοποιητές WAN ή ισοσταθμιστές φορτίου.

Τα NVAs χρησιμοποιούνται για σύνθετες εργασίες δρομολόγησης, **ασφάλειας** και **διαχείρισης δικτυακής κίνησης**. Μπορούν να αναπτυχθούν από το Azure **Marketplace**, όπου πολλοί τρίτοι προμηθευτές προσφέρουν τις συσκευές τους έτοιμες για ενσωμάτωση σε περιβάλλοντα Azure.

### **Example**

* Μια οργάνωση μπορεί να αναπτύξει ένα NVA στο Azure για να δημιουργήσει μια **προσαρμοσμένη λύση τείχους προστασίας**. Αυτό το NVA θα μπορούσε να εκτελεί ένα **λογισμικό τείχους προστασίας τρίτου μέρους**, παρέχοντας προηγμένα χαρακτηριστικά όπως ανίχνευση εισβολών, επιθεώρηση πακέτων ή συνδεσιμότητα VPN. Το NVA μπορεί να ρυθμιστεί ώστε να επιθεωρεί και να φιλτράρει την κίνηση που περνά από αυτό, διασφαλίζοντας ότι οι ενισχυμένες μέτρα ασφαλείας είναι σε εφαρμογή σύμφωνα με τις πολιτικές της οργάνωσης.

### **Enumeration**

{% code overflow="wrap" %}
```bash
# Usually NVAs are named or tagged in a way to distinguish them from other VMs
az vm list --query "[].{name:name, resourceGroup:resourceGroup, location:location}" -o table

# For a specific VM identified as an NVA, list its network interfaces
az vm nic list --vm-name <VMName> --resource-group <ResourceGroupName> --query "[].{id:id}" -o table
```
{% endcode %}

## Azure Route Tables & User Defined Routes (UDR)

**Azure Route Tables** είναι μια δυνατότητα μέσα στο Microsoft Azure που επιτρέπει τον **έλεγχο της δρομολόγησης δικτυακής κίνησης μέσα στα Azure Virtual Networks (VNets)**. Ουσιαστικά, καθορίζουν πώς οι **πακέτες** **προωθούνται** μεταξύ υποδικτύων μέσα στα VNets, μεταξύ VNets ή σε εξωτερικά δίκτυα. Κάθε πίνακας δρομολόγησης περιέχει ένα σύνολο κανόνων, γνωστών ως δρομολόγια, που προσδιορίζουν πώς πρέπει να δρομολογούνται οι πακέτες με βάση τις διευθύνσεις IP προορισμού τους.

**User Defined Routes (UDR)** στο Azure είναι **προσαρμοσμένα δρομολόγια που δημιουργείτε μέσα στους Azure Route Tables** για να ελέγξετε τη **ροή της δικτυακής κίνησης** μέσα και μεταξύ των Azure Virtual Networks (VNets), και σε εξωτερικές συνδέσεις. Οι UDR σας δίνουν την ευελιξία να κατευθύνετε τη δικτυακή κίνηση σύμφωνα με τις συγκεκριμένες απαιτήσεις σας, παρακάμπτοντας τις προεπιλεγμένες αποφάσεις δρομολόγησης του Azure.

Αυτά τα δρομολόγια είναι ιδιαίτερα χρήσιμα για σενάρια όπου χρειάζεται να **δρομολογήσετε την κίνηση μέσω μιας εικονικής συσκευής**, να επιβάλετε μια συγκεκριμένη διαδρομή για λόγους ασφάλειας ή συμμόρφωσης πολιτικής, ή να ενσωματώσετε με τοπικά δίκτυα.

### **Example**

* Υποθέστε ότι έχετε αναπτύξει μια Network Virtual Appliance (NVA) για την επιθεώρηση της κίνησης μεταξύ υποδικτύων μέσα σε ένα VNet. Μπορείτε να δημιουργήσετε μια UDR που κατευθύνει όλη την κίνηση από ένα υποδίκτυο σε άλλο υποδίκτυο να περνάει μέσω της NVA. Αυτή η UDR διασφαλίζει ότι η NVA επιθεωρεί την κίνηση για λόγους ασφάλειας πριν φτάσει στον προορισμό της.

### **Enumeration**

{% code overflow="wrap" %}
```bash
# List Route Tables
az network route-table list --query "[].{name:name, resourceGroup:resourceGroup, location:location}" -o table

# List UDRs for a table
az network route-table route list --route-table-name <RouteTableName> --resource-group <ResourceGroupName> --query "[].{name:name, addressPrefix:addressPrefix, nextHopType:nextHopType, nextHopIpAddress:nextHopIpAddress}" -o table
```
{% endcode %}

## Azure Private Link

Azure Private Link είναι μια υπηρεσία στο Azure που **επιτρέπει ιδιωτική πρόσβαση σε υπηρεσίες Azure** διασφαλίζοντας ότι **η κίνηση μεταξύ του εικονικού δικτύου Azure (VNet) σας και της υπηρεσίας ταξιδεύει εξ ολοκλήρου εντός του δικτύου backbone της Microsoft Azure**. Ενσωματώνει αποτελεσματικά την υπηρεσία στο VNet σας. Αυτή η ρύθμιση ενισχύει την ασφάλεια, καθώς δεν εκθέτει τα δεδομένα στο δημόσιο διαδίκτυο.

Το Private Link μπορεί να χρησιμοποιηθεί με διάφορες υπηρεσίες Azure, όπως Azure Storage, Azure SQL Database και προσαρμοσμένες υπηρεσίες που μοιράζονται μέσω του Private Link. Παρέχει έναν ασφαλή τρόπο κατανάλωσης υπηρεσιών από το δικό σας VNet ή ακόμη και από διαφορετικές συνδρομές Azure.

{% hint style="danger" %}
Τα NSGs δεν ισχύουν για ιδιωτικά endpoints, που σημαίνει σαφώς ότι η συσχέτιση ενός NSG με ένα υποδίκτυο που περιέχει το Private Link δεν θα έχει καμία επίδραση.
{% endhint %}

### **Example**

* Σκεφτείτε ένα σενάριο όπου έχετε μια **Azure SQL Database που θέλετε να προσπελάσετε με ασφάλεια από το VNet σας**. Κανονικά, αυτό μπορεί να περιλαμβάνει τη διαδρομή μέσω του δημόσιου διαδικτύου. Με το Private Link, μπορείτε να δημιουργήσετε ένα **ιδιωτικό endpoint στο VNet σας** που συνδέεται απευθείας με την υπηρεσία Azure SQL Database. Αυτό το endpoint καθιστά τη βάση δεδομένων να φαίνεται ότι είναι μέρος του δικού σας VNet, προσβάσιμη μέσω μιας ιδιωτικής διεύθυνσης IP, διασφαλίζοντας έτσι ασφαλή και ιδιωτική πρόσβαση.

### **Enumeration**

{% code overflow="wrap" %}
```bash
# List Private Link Services
z network private-link-service list --query "[].{name:name, location:location, resourceGroup:resourceGroup}" -o table

# List Private Endpoints
az network private-endpoint list --query "[].{name:name, location:location, resourceGroup:resourceGroup, privateLinkServiceConnections:privateLinkServiceConnections}" -o table
```
{% endcode %}

## Azure Service Endpoints

Οι Azure Service Endpoints επεκτείνουν τον ιδιωτικό χώρο διευθύνσεων του εικονικού σας δικτύου και την ταυτότητα του VNet σας σε υπηρεσίες Azure μέσω άμεσης σύνδεσης. Ενεργοποιώντας τους service endpoints, **οι πόροι στο VNet σας μπορούν να συνδεθούν με ασφάλεια σε υπηρεσίες Azure**, όπως το Azure Storage και η Azure SQL Database, χρησιμοποιώντας το backbone δίκτυο της Azure. Αυτό διασφαλίζει ότι **η κίνηση από το VNet προς την υπηρεσία Azure παραμένει εντός του δικτύου Azure**, παρέχοντας μια πιο ασφαλή και αξιόπιστη διαδρομή.

### **Example**

* Για παράδειγμα, ένας **λογαριασμός Azure Storage** είναι προσβάσιμος από προεπιλογή μέσω του δημόσιου διαδικτύου. Ενεργοποιώντας έναν **service endpoint για το Azure Storage εντός του VNet σας**, μπορείτε να διασφαλίσετε ότι μόνο η κίνηση από το VNet σας μπορεί να έχει πρόσβαση στον λογαριασμό αποθήκευσης. Το τείχος προστασίας του λογαριασμού αποθήκευσης μπορεί στη συνέχεια να ρυθμιστεί ώστε να δέχεται κίνηση μόνο από το VNet σας.

### **Enumeration**

{% code overflow="wrap" %}
```bash
# List Virtual Networks with Service Endpoints
az network vnet list --query "[].{name:name, location:location, serviceEndpoints:serviceEndpoints}" -o table

# List Subnets with Service Endpoints
az network vnet subnet list --resource-group <ResourceGroupName> --vnet-name <VNetName> --query "[].{name:name, serviceEndpoints:serviceEndpoints}" -o table
```
{% endcode %}

### Διαφορές Μεταξύ Service Endpoints και Private Links

Η Microsoft προτείνει τη χρήση Private Links στα [**docs**](https://learn.microsoft.com/en-us/azure/virtual-network/vnet-integration-for-azure-services#compare-private-endpoints-and-service-endpoints):\\

<figure><img src="../../../../.gitbook/assets/image (25).png" alt=""><figcaption></figcaption></figure>

**Service Endpoints:**

* Η κίνηση από το VNet σας προς την υπηρεσία Azure ταξιδεύει μέσω του backbone δικτύου της Microsoft Azure, παρακάμπτοντας το δημόσιο διαδίκτυο.
* Το endpoint είναι μια άμεση σύνδεση με την υπηρεσία Azure και δεν παρέχει ιδιωτική IP για την υπηρεσία εντός του VNet.
* Η υπηρεσία είναι ακόμα προσβάσιμη μέσω του δημόσιου endpoint της από έξω από το VNet σας, εκτός αν ρυθμίσετε το firewall της υπηρεσίας να μπλοκάρει τέτοια κίνηση.
* Είναι μια σχέση ένα προς ένα μεταξύ του υποδικτύου και της υπηρεσίας Azure.
* Λιγότερο ακριβό από τα Private Links.

**Private Links:**

* Το Private Link χαρτογραφεί τις υπηρεσίες Azure στο VNet σας μέσω ενός ιδιωτικού endpoint, το οποίο είναι μια διεπαφή δικτύου με μια ιδιωτική διεύθυνση IP εντός του VNet σας.
* Η υπηρεσία Azure προσπελάζεται χρησιμοποιώντας αυτή την ιδιωτική διεύθυνση IP, κάνοντάς την να φαίνεται ότι είναι μέρος του δικτύου σας.
* Οι υπηρεσίες που συνδέονται μέσω Private Link μπορούν να προσπελαστούν μόνο από το VNet σας ή συνδεδεμένα δίκτυα; δεν υπάρχει δημόσια πρόσβαση στο διαδίκτυο για την υπηρεσία.
* Επιτρέπει μια ασφαλή σύνδεση με τις υπηρεσίες Azure ή τις δικές σας υπηρεσίες που φιλοξενούνται στην Azure, καθώς και μια σύνδεση με υπηρεσίες που μοιράζονται από άλλους.
* Παρέχει πιο λεπτομερή έλεγχο πρόσβασης μέσω ενός ιδιωτικού endpoint στο VNet σας, σε αντίθεση με τον ευρύτερο έλεγχο πρόσβασης στο επίπεδο του υποδικτύου με τα service endpoints.

Συνοψίζοντας, ενώ και τα Service Endpoints και τα Private Links παρέχουν ασφαλή συνδεσιμότητα με τις υπηρεσίες Azure, **τα Private Links προσφέρουν υψηλότερο επίπεδο απομόνωσης και ασφάλειας διασφαλίζοντας ότι οι υπηρεσίες προσπελάζονται ιδιωτικά χωρίς να εκτίθενται στο δημόσιο διαδίκτυο**. Τα Service Endpoints, από την άλλη πλευρά, είναι πιο εύκολα στην εγκατάσταση για γενικές περιπτώσεις όπου απαιτείται απλή, ασφαλής πρόσβαση στις υπηρεσίες Azure χωρίς την ανάγκη για ιδιωτική IP στο VNet.

## Azure Front Door (AFD) & AFD WAF

**Azure Front Door** είναι ένα κλιμακούμενο και ασφαλές σημείο εισόδου για **γρήγορη παράδοση** των παγκόσμιων διαδικτυακών εφαρμογών σας. Συνδυάζει διάφορες υπηρεσίες όπως παγκόσμια **φορτωτική ισορροπία, επιτάχυνση ιστότοπου, SSL offloading και δυνατότητες Web Application Firewall (WAF)** σε μία μόνο υπηρεσία. Το Azure Front Door παρέχει έξυπνη δρομολόγηση με βάση την **πλησιέστερη τοποθεσία edge στον χρήστη**, διασφαλίζοντας βέλτιστη απόδοση και αξιοπιστία. Επιπλέον, προσφέρει δρομολόγηση βάσει URL, φιλοξενία πολλών ιστότοπων, προσκόλληση συνεδρίας και ασφάλεια επιπέδου εφαρμογής.

**Azure Front Door WAF** έχει σχεδιαστεί για να **προστατεύει τις διαδικτυακές εφαρμογές από διαδικτυακές επιθέσεις** χωρίς τροποποίηση του κώδικα backend. Περιλαμβάνει προσαρμοσμένους κανόνες και διαχειριζόμενα σύνολα κανόνων για την προστασία από απειλές όπως SQL injection, cross-site scripting και άλλες κοινές επιθέσεις.

### **Παράδειγμα**

* Φανταστείτε ότι έχετε μια παγκοσμίως κατανεμημένη εφαρμογή με χρήστες σε όλο τον κόσμο. Μπορείτε να χρησιμοποιήσετε το Azure Front Door για να **δρομολογήσετε τα αιτήματα των χρηστών στο πλησιέστερο περιφερειακό κέντρο δεδομένων** που φιλοξενεί την εφαρμογή σας, μειώνοντας έτσι την καθυστέρηση, βελτιώνοντας την εμπειρία του χρήστη και **προστατεύοντάς την από διαδικτυακές επιθέσεις με τις δυνατότητες WAF**. Εάν μια συγκεκριμένη περιοχή αντιμετωπίσει διακοπή λειτουργίας, το Azure Front Door μπορεί αυτόματα να επαναδρομολογήσει την κίνηση στην επόμενη καλύτερη τοποθεσία, διασφαλίζοντας υψηλή διαθεσιμότητα.

### Enumeration

{% code overflow="wrap" %}
```bash
# List Azure Front Door Instances
az network front-door list --query "[].{name:name, resourceGroup:resourceGroup, location:location}" -o table

# List Front Door WAF Policies
az network front-door waf-policy list --query "[].{name:name, resourceGroup:resourceGroup, location:location}" -o table
```
{% endcode %}

## Azure Application Gateway και Azure Application Gateway WAF

Azure Application Gateway είναι ένας **ισοσταθμιστής φόρτου διαδικτυακής κυκλοφορίας** που σας επιτρέπει να διαχειρίζεστε την κυκλοφορία προς τις **ιστοσελίδες** σας. Προσφέρει **ισοστάθμιση φόρτου επιπέδου 7, τερματισμό SSL και δυνατότητες τείχους προστασίας εφαρμογών ιστού (WAF)** στον Ελεγκτή Παράδοσης Εφαρμογών (ADC) ως υπηρεσία. Κύρια χαρακτηριστικά περιλαμβάνουν δρομολόγηση βάσει URL, προσκόλληση συνεδρίας βάσει cookie και αποφόρτιση Secure Sockets Layer (SSL), που είναι κρίσιμα για εφαρμογές που απαιτούν σύνθετες δυνατότητες ισοστάθμισης φόρτου όπως η παγκόσμια δρομολόγηση και η δρομολόγηση βάσει διαδρομής.

### Παράδειγμα

* Σκεφτείτε ένα σενάριο όπου έχετε μια ιστοσελίδα ηλεκτρονικού εμπορίου που περιλαμβάνει πολλαπλά υποτομείς για διαφορετικές λειτουργίες, όπως λογαριασμούς χρηστών και επεξεργασία πληρωμών. Azure Application Gateway μπορεί να **δρομολογήσει την κυκλοφορία στους κατάλληλους διακομιστές ιστού με βάση τη διαδρομή URL**. Για παράδειγμα, η κυκλοφορία προς το `example.com/accounts` θα μπορούσε να κατευθυνθεί στην υπηρεσία λογαριασμών χρηστών, και η κυκλοφορία προς το `example.com/pay` θα μπορούσε να κατευθυνθεί στην υπηρεσία επεξεργασίας πληρωμών.\
Και **να προστατεύσετε την ιστοσελίδα σας από επιθέσεις χρησιμοποιώντας τις δυνατότητες WAF.**

### **Αριθμητική** 

{% code overflow="wrap" %}
```bash
# List the Web Application Firewall configurations for your Application Gateways
az network application-gateway waf-config list --gateway-name <AppGatewayName> --resource-group <ResourceGroupName> --query "[].{name:name, firewallMode:firewallMode, ruleSetType:ruleSetType, ruleSetVersion:ruleSetVersion}" -o table
```
{% endcode %}

## Azure Hub, Spoke & VNet Peering

**VNet Peering** είναι μια δυνατότητα δικτύωσης στο Azure που **επιτρέπει σε διαφορετικά Εικονικά Δίκτυα (VNets) να συνδέονται άμεσα και χωρίς προβλήματα**. Μέσω του VNet peering, οι πόροι σε ένα VNet μπορούν να επικοινωνούν με πόρους σε άλλο VNet χρησιμοποιώντας ιδιωτικές διευθύνσεις IP, **σαν να βρίσκονταν στο ίδιο δίκτυο**.\
**Το VNet Peering μπορεί επίσης να χρησιμοποιηθεί με τοπικά δίκτυα** ρυθμίζοντας ένα site-to-site VPN ή Azure ExpressRoute.

**Azure Hub and Spoke** είναι μια τοπολογία δικτύου που χρησιμοποιείται στο Azure για τη διαχείριση και οργάνωση της κυκλοφορίας δικτύου. **Ο "κόμβος" είναι ένα κεντρικό σημείο που ελέγχει και δρομολογεί την κυκλοφορία μεταξύ διαφορετικών "ακτίνων"**. Ο κόμβος περιέχει συνήθως κοινές υπηρεσίες όπως εικονικές συσκευές δικτύου (NVAs), Azure VPN Gateway, Azure Firewall ή Azure Bastion. Οι **"ακτίνες" είναι VNets που φιλοξενούν φορτία εργασίας και συνδέονται με τον κόμβο χρησιμοποιώντας VNet peering**, επιτρέποντάς τους να εκμεταλλεύονται τις κοινές υπηρεσίες εντός του κόμβου. Αυτό το μοντέλο προάγει μια καθαρή διάταξη δικτύου, μειώνοντας την πολυπλοκότητα κεντροποιώντας κοινές υπηρεσίες που μπορούν να χρησιμοποιήσουν πολλαπλά φορτία εργασίας σε διαφορετικά VNets.

{% hint style="danger" %}
**Η ζεύξη VNET είναι μη μεταβατική στο Azure**, που σημαίνει ότι αν η ακτίνα 1 είναι συνδεδεμένη με την ακτίνα 2 και η ακτίνα 2 είναι συνδεδεμένη με την ακτίνα 3, τότε η ακτίνα 1 δεν μπορεί να μιλήσει απευθείας με την ακτίνα 3.
{% endhint %}

### Παραδείγματα

* Φανταστείτε μια εταιρεία με ξεχωριστά τμήματα όπως Πωλήσεις, Ανθρώπινοι Πόροι και Ανάπτυξη, **κάθε ένα με το δικό του VNet (οι ακτίνες)**. Αυτά τα VNets **απαιτούν πρόσβαση σε κοινόχρηστους πόρους** όπως μια κεντρική βάση δεδομένων, ένα τείχος προστασίας και μια πύλη στο διαδίκτυο, οι οποίοι βρίσκονται όλοι σε **ένα άλλο VNet (ο κόμβος)**. Χρησιμοποιώντας το μοντέλο Hub and Spoke, κάθε τμήμα μπορεί να **συνδεθεί με ασφάλεια στους κοινόχρηστους πόρους μέσω του VNet του κόμβου χωρίς να εκθέτει αυτούς τους πόρους στο δημόσιο διαδίκτυο** ή να δημιουργήσει μια περίπλοκη δομή δικτύου με πολλές συνδέσεις.

### Enumeration

{% code overflow="wrap" %}
```bash
# List all VNets in your subscription
az network vnet list --query "[].{name:name, location:location, addressSpace:addressSpace}" -o table

# List VNet peering connections for a given VNet
az network vnet peering list --resource-group <ResourceGroupName> --vnet-name <VNetName> --query "[].{name:name, peeringState:peeringState, remoteVnetId:remoteVnetId}" -o table

# List Shared Resources (e.g., Azure Firewall) in the Hub
az network firewall list --query "[].{name:name, location:location, resourceGroup:resourceGroup}" -o table
```
{% endcode %}

## Site-to-Site VPN

Ένα Site-to-Site VPN στο Azure σας επιτρέπει να **συνδέσετε το τοπικό σας δίκτυο με το Azure Virtual Network (VNet)**, επιτρέποντας στους πόρους όπως οι VM εντός του Azure να φαίνονται σαν να είναι στο τοπικό σας δίκτυο. Αυτή η σύνδεση καθορίζεται μέσω ενός **VPN gateway που κρυπτογραφεί την κίνηση** μεταξύ των δύο δικτύων.

### **Example**

* Μια επιχείρηση με το κύριο γραφείο της στη Νέα Υόρκη έχει ένα τοπικό κέντρο δεδομένων που χρειάζεται να συνδεθεί με ασφάλεια στο VNet της στο Azure, το οποίο φιλοξενεί τα εικονικοποιημένα φορτία εργασίας της. Ρυθμίζοντας ένα **Site-to-Site VPN, η εταιρεία μπορεί να διασφαλίσει κρυπτογραφημένη συνδεσιμότητα μεταξύ των τοπικών διακομιστών και των Azure VM**, επιτρέποντας στους πόρους να προσπελάζονται με ασφάλεια και στις δύο περιβάλλουσες, σαν να βρίσκονταν στο ίδιο τοπικό δίκτυο.

### **Enumeration**

{% code overflow="wrap" %}
```bash
# List VPN Gateways
az network vnet-gateway list --query "[].{name:name, location:location, resourceGroup:resourceGroup}" -o table

# List VPN Connections
az network vpn-connection list --gateway-name <VpnGatewayName> --resource-group <ResourceGroupName> --query "[].{name:name, connectionType:connectionType, connectionStatus:connectionStatus}" -o table
```
{% endcode %}

## Azure ExpressRoute

Azure ExpressRoute είναι μια υπηρεσία που παρέχει μια **ιδιωτική, αφιερωμένη, υψηλής ταχύτητας σύνδεση μεταξύ της υποδομής σας στις εγκαταστάσεις και των κέντρων δεδομένων Azure**. Αυτή η σύνδεση γίνεται μέσω ενός παρόχου συνδεσιμότητας, παρακάμπτοντας το δημόσιο διαδίκτυο και προσφέροντας περισσότερη αξιοπιστία, ταχύτερες ταχύτητες, χαμηλότερες καθυστερήσεις και υψηλότερη ασφάλεια από τις τυπικές συνδέσεις στο διαδίκτυο.

### **Παράδειγμα**

* Μια πολυεθνική εταιρεία απαιτεί μια **σταθερή και αξιόπιστη σύνδεση με τις υπηρεσίες Azure λόγω του υψηλού όγκου δεδομένων** και της ανάγκης για υψηλή απόδοση. Η εταιρεία επιλέγει το Azure ExpressRoute για να συνδέσει απευθείας το κέντρο δεδομένων της στις εγκαταστάσεις με το Azure, διευκολύνοντας τις μεγάλες μεταφορές δεδομένων, όπως οι καθημερινές εφεδρικές αντιγράφες και η ανάλυση δεδομένων σε πραγματικό χρόνο, με ενισχυμένη ιδιωτικότητα και ταχύτητα.

### **Αριθμητική**

{% code overflow="wrap" %}
```bash
# List ExpressRoute Circuits
az network express-route list --query "[].{name:name, location:location, resourceGroup:resourceGroup, serviceProviderName:serviceProviderName, peeringLocation:peeringLocation}" -o table
```
{% endcode %}

{% hint style="success" %}
Μάθετε & εξασκηθείτε στο AWS Hacking:<img src="../../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Μάθετε & εξασκηθείτε στο GCP Hacking: <img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Υποστήριξη HackTricks</summary>

* Ελέγξτε τα [**σχέδια συνδρομής**](https://github.com/sponsors/carlospolop)!
* **Εγγραφείτε στην** 💬 [**ομάδα Discord**](https://discord.gg/hRep4RUj7f) ή στην [**ομάδα telegram**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Μοιραστείτε κόλπα hacking υποβάλλοντας PRs στα** [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
