# Az - Azure Network

{% hint style="success" %}
Apprenez et pratiquez AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Apprenez et pratiquez GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Soutenez HackTricks</summary>

* Consultez les [**plans d'abonnement**](https://github.com/sponsors/carlospolop)!
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez-nous** sur **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Partagez des astuces de hacking en soumettant des PRs aux d√©p√¥ts github** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
{% endhint %}

## Informations de base

Les r√©seaux au sein d'Azure fonctionnent comme une partie int√©grante de sa plateforme de cloud computing, permettant la **connexion et la communication entre divers services et ressources Azure**. L'architecture r√©seau d'Azure est con√ßue pour √™tre hautement √©volutive, s√©curis√©e et personnalisable.

Au c≈ìur d'Azure, on trouve un **r√©seau virtuel (VNet)** qui permet aux utilisateurs de cr√©er des **r√©seaux isol√©s** au sein du cloud Azure. Dans ces VNets, des ressources telles que des machines virtuelles, des applications et des bases de donn√©es peuvent √™tre h√©berg√©es et g√©r√©es en toute s√©curit√©. Le r√©seau dans Azure prend en charge √† la fois la communication au sein du cloud (entre les services Azure) et la connexion aux r√©seaux externes et √† Internet.

La **s√©curit√©** est un aspect critique du r√©seau Azure, avec divers outils et services disponibles pour prot√©ger les donn√©es, g√©rer l'acc√®s et assurer la conformit√©. Ces mesures de s√©curit√© incluent des **pare-feux**, des **groupes de s√©curit√© r√©seau** et des capacit√©s de **chiffrement**, permettant un contr√¥le √©lev√© du trafic et de l'acc√®s.

Dans l'ensemble, les capacit√©s r√©seau d'Azure sont con√ßues pour offrir de la flexibilit√©, permettant aux utilisateurs de cr√©er un environnement r√©seau adapt√© √† leurs besoins sp√©cifiques en mati√®re d'applications et de charges de travail tout en maintenant un fort accent sur la s√©curit√© et la fiabilit√©.

## R√©seau virtuel (VNET) & Sous-r√©seaux

Un VNet dans Azure est essentiellement une repr√©sentation de votre propre r√©seau dans le cloud. C'est une **isolation logique du cloud Azure d√©di√©e √† votre abonnement**. Un VNet vous permet de provisionner et de g√©rer des r√©seaux priv√©s virtuels (VPN) dans Azure et peut √™tre utilis√© pour h√©berger et **g√©rer plusieurs types de ressources Azure**, telles que des machines virtuelles (VM), des bases de donn√©es et des services d'application.

Les VNets vous offrent un **contr√¥le total sur vos param√®tres r√©seau**, y compris les plages d'adresses **IP**, la cr√©ation de sous-r√©seaux, les tables de routage et les passerelles r√©seau.

Un **sous-r√©seau** est une **plage d'adresses IP dans votre VNet**. Vous pouvez diviser un VNet en plusieurs sous-r√©seaux pour l'organisation et la s√©curit√©. Chaque sous-r√©seau dans un VNet peut √™tre utilis√© pour isoler et regrouper des ressources selon votre architecture r√©seau et applicative.

De plus, les sous-r√©seaux vous permettent de **segmenter votre VNet en un ou plusieurs sous-r√©seaux**, fournissant une plage d'adresses IP que les ressources peuvent utiliser.

### **Exemple**

* Supposons que vous ayez un VNet nomm√© `MyVNet` avec une plage d'adresses IP de `10.0.0.0/16`. Vous pouvez cr√©er un sous-r√©seau dans ce VNet, disons `Subnet-1`, avec une plage d'adresses IP de `10.0.0.0/24` pour h√©berger vos serveurs web. Un autre sous-r√©seau, `Subnet-2` avec une plage de `10.0.1.0/24`, pourrait √™tre utilis√© pour vos serveurs de bases de donn√©es. Cette segmentation permet une gestion efficace et des contr√¥les de s√©curit√© au sein du r√©seau.

### √ânum√©ration

Pour lister tous les VNets et sous-r√©seaux dans un compte Azure, vous pouvez utiliser l'interface de ligne de commande Azure (CLI). Voici les √©tapes :

{% code overflow="wrap" %}
```bash
# List VNets
az network vnet list --query "[].{name:name, location:location, addressSpace:addressSpace}" -o table

# List subnets of a VNet
az network vnet subnet list --resource-group <ResourceGroupName> --vnet-name <VNetName> --query "[].{name:name, addressPrefix:addressPrefix}" -o table
```
{% endcode %}

## Network Security Groups (NSG)

Dans Azure, un **Network Security Group (NSG)** a pour fonction principale de filtrer le trafic r√©seau √† destination et en provenance des ressources Azure au sein d'un Azure Virtual Network (VNet). Il contient un ensemble de **r√®gles de s√©curit√©** qui dictent m√©ticuleusement le flux du trafic r√©seau.

Les aspects cl√©s des NSG incluent :

* **Contr√¥le du trafic** : Chaque NSG contient des r√®gles qui sont essentielles pour permettre ou bloquer le trafic r√©seau entrant et sortant associ√© √† diverses ressources Azure.
* **Composants des r√®gles** : Les r√®gles au sein d'un NSG sont tr√®s sp√©cifiques, filtrant le trafic en fonction de crit√®res tels que l'adresse IP source/destination, le port et le protocole. Cette sp√©cificit√© permet une gestion granulaire du trafic r√©seau.
* **Am√©lioration de la s√©curit√©** : En veillant √† ce que seul le trafic autoris√© puisse entrer ou sortir de vos ressources Azure, les NSG jouent un r√¥le crucial dans le renforcement de la posture de s√©curit√© de votre infrastructure r√©seau.

### **Exemple**

* Imaginez que vous avez un NSG nomm√© `MyNSG` appliqu√© √† un sous-r√©seau ou √† une machine virtuelle sp√©cifique au sein de votre VNet. Vous pouvez cr√©er des r√®gles comme :
* Une r√®gle entrante permettant le trafic HTTP (port 80) de n'importe quelle source vers vos serveurs web.
* Une r√®gle sortante permettant uniquement le trafic SQL (port 1433) vers une plage d'adresses IP de destination sp√©cifique.

### √ânum√©ration

{% code overflow="wrap" %}
```bash
# List NSGs
az network nsg list --query "[].{name:name, location:location}" -o table

# Get NSG rules
az network nsg rule list --nsg-name <NSGName> --resource-group <ResourceGroupName> --query "[].{name:name, priority:priority, direction:direction, access:access, protocol:protocol, sourceAddressPrefix:sourceAddressPrefix, destinationAddressPrefix:destinationAddressPrefix, sourcePortRange:sourcePortRange, destinationPortRange:destinationPortRange}" -o table
```
{% endcode %}

## Azure Firewall

Azure Firewall est un **service de s√©curit√© r√©seau g√©r√© et bas√© sur le cloud qui prot√®ge vos ressources Azure Virtual Network**. C'est un pare-feu en tant que service enti√®rement stateful avec des fonctionnalit√©s de haute disponibilit√© et de scalabilit√© int√©gr√©es.

Azure Firewall fournit des fonctionnalit√©s **plus avanc√©es** que les **NSG**, y compris le **filtrage au niveau des applications**, le filtrage au niveau du r√©seau, le filtrage bas√© sur l'intelligence des menaces, et l'int√©gration avec Azure Monitor pour la journalisation et l'analyse.\
Il peut filtrer le trafic sortant, entrant, spoke-to-spoke, VPN et ExpressRoute. **Les r√®gles de pare-feu peuvent √™tre cr√©√©es en fonction de FQDN (Fully Qualified Domain Name), d'adresses IP et de ports**.

### Diff√©rences entre Azure Firewall et NSG

1. **Port√©e :**
* **NSG :** Fonctionne au niveau du sous-r√©seau ou de l'interface r√©seau. Il est destin√© √† fournir un filtrage de base du trafic entrant et sortant des interfaces r√©seau (NIC), des VMs ou des sous-r√©seaux.
* **Azure Firewall :** Op√®re au niveau du VNet, offrant une port√©e de protection plus large. Il est con√ßu pour s√©curiser vos ressources de r√©seau virtuel et g√©rer le trafic entrant et sortant du VNet.
2. **Capacit√©s :**
* **NSG :** Fournit des capacit√©s de filtrage de base bas√©es sur l'adresse IP, le port et le protocole. Il ne prend pas en charge les fonctionnalit√©s avanc√©es telles que l'inspection au niveau des applications ou l'intelligence des menaces.
* **Azure Firewall :** Offre des fonctionnalit√©s avanc√©es telles que le filtrage du trafic au niveau des applications (couche 7), le filtrage bas√© sur l'intelligence des menaces, le filtrage du trafic r√©seau, et plus encore. Il prend √©galement en charge plusieurs adresses IP publiques.
3. **Cas d'utilisation :**
* **NSG :** Id√©al pour le filtrage de trafic au niveau du r√©seau de base.
* **Azure Firewall :** Convient pour des sc√©narios de filtrage plus complexes o√π le contr√¥le au niveau des applications, la journalisation et l'intelligence des menaces sont n√©cessaires.
4. **Gestion et surveillance :**
* **NSG :** Offre une journalisation de base et une int√©gration avec Azure Monitor.
* **Azure Firewall :** Fournit des capacit√©s avanc√©es de journalisation et d'analyse via Azure Monitor, ce qui est essentiel pour comprendre la nature et le mod√®le du trafic.

### √ânum√©ration

{% code overflow="wrap" %}
```bash
# List Azure Firewalls
az network firewall list --query "[].{name:name, location:location, subnet:subnet, publicIp:publicIp}" -o table

# Get network rules of a firewall
az network firewall network-rule collection list --firewall-name <FirewallName> --resource-group <ResourceGroupName> --query "[].{name:name, rules:rules}" -o table

# Get application rules of a firewall
az network firewall application-rule collection list --firewall-name <FirewallName> --resource-group <ResourceGroupName> --query "[].{name:name, rules:rules}" -o table

# Get nat rules of a firewall
az network firewall nat-rule collection list --firewall-name <FirewallName> --resource-group <ResourceGroupName> --query "[].{name:name, rules:rules}" -o table
```
{% endcode %}

## Network Virtual Appliance (NVA)

Un Network Virtual Appliance (**NVA**) dans Azure est un appareil virtuel qui **effectue des fonctions r√©seau au sein d'un r√©seau virtuel**. Les NVAs sont g√©n√©ralement utilis√©s pour des fonctions r√©seau qui **ne sont pas disponibles nativement** dans Azure ou lorsque plus de personnalisation est requise. Ce sont essentiellement des **VMs qui ex√©cutent des applications ou services r√©seau**, tels que des pare-feux, des optimiseurs WAN ou des √©quilibreurs de charge.

Les NVAs sont utilis√©s pour des t√¢ches de routage complexe, de **s√©curit√©** et de **gestion du trafic r√©seau**. Ils peuvent √™tre d√©ploy√©s depuis Azure **Marketplace**, o√π de nombreux fournisseurs tiers proposent leurs appliances pr√™tes √† √™tre int√©gr√©es dans les environnements Azure.

### **Exemple**

* Une organisation peut d√©ployer un NVA dans Azure pour cr√©er une **solution de pare-feu personnalis√©e**. Ce NVA pourrait ex√©cuter un **logiciel de pare-feu tiers**, offrant des fonctionnalit√©s avanc√©es comme la d√©tection d'intrusion, l'inspection de paquets ou la connectivit√© VPN. Le NVA peut √™tre configur√© pour inspecter et filtrer le trafic le traversant, garantissant que des mesures de s√©curit√© renforc√©es sont en place conform√©ment aux politiques de l'organisation.

### **√ânum√©ration**

{% code overflow="wrap" %}
```bash
# Usually NVAs are named or tagged in a way to distinguish them from other VMs
az vm list --query "[].{name:name, resourceGroup:resourceGroup, location:location}" -o table

# For a specific VM identified as an NVA, list its network interfaces
az vm nic list --vm-name <VMName> --resource-group <ResourceGroupName> --query "[].{id:id}" -o table
```
{% endcode %}

## Azure Route Tables & User Defined Routes (UDR)

**Azure Route Tables** sont une fonctionnalit√© de Microsoft Azure qui permet de **contr√¥ler le routage du trafic r√©seau au sein des Azure Virtual Networks (VNets)**. Essentiellement, elles d√©finissent comment les **paquets** sont **transf√©r√©s** entre les sous-r√©seaux au sein des VNets, entre les VNets, ou vers des r√©seaux externes. Chaque table de routage contient un ensemble de r√®gles, appel√©es routes, qui sp√©cifient comment les paquets doivent √™tre rout√©s en fonction de leurs adresses IP de destination.

**User Defined Routes (UDR)** dans Azure sont des **routes personnalis√©es que vous cr√©ez au sein des Azure Route Tables** pour contr√¥ler le **flux du trafic r√©seau** au sein et entre les Azure Virtual Networks (VNets), et vers des connexions externes. Les UDR vous offrent la flexibilit√© de diriger le trafic r√©seau selon vos besoins sp√©cifiques, en rempla√ßant les d√©cisions de routage par d√©faut d'Azure.

Ces routes sont particuli√®rement utiles dans les sc√©narios o√π vous devez **router le trafic via un appareil virtuel**, imposer un chemin sp√©cifique pour des raisons de s√©curit√© ou de conformit√© aux politiques, ou int√©grer avec des r√©seaux sur site.

### **Exemple**

* Supposons que vous ayez d√©ploy√© un Network Virtual Appliance (NVA) pour inspecter le trafic entre les sous-r√©seaux au sein d'un VNet. Vous pouvez cr√©er un UDR qui dirige tout le trafic d'un sous-r√©seau √† un autre sous-r√©seau en passant par le NVA. Cet UDR garantit que le NVA inspecte le trafic √† des fins de s√©curit√© avant qu'il n'atteigne sa destination.

### **√ânum√©ration**

{% code overflow="wrap" %}
```bash
# List Route Tables
az network route-table list --query "[].{name:name, resourceGroup:resourceGroup, location:location}" -o table

# List UDRs for a table
az network route-table route list --route-table-name <RouteTableName> --resource-group <ResourceGroupName> --query "[].{name:name, addressPrefix:addressPrefix, nextHopType:nextHopType, nextHopIpAddress:nextHopIpAddress}" -o table
```
{% endcode %}

## Azure Private Link

Azure Private Link est un service dans Azure qui **permet un acc√®s priv√© aux services Azure** en garantissant que **le trafic entre votre r√©seau virtuel Azure (VNet) et le service circule enti√®rement au sein du r√©seau backbone Azure de Microsoft**. Il int√®gre effectivement le service dans votre VNet. Cette configuration am√©liore la s√©curit√© en n'exposant pas les donn√©es √† l'internet public.

Private Link peut √™tre utilis√© avec divers services Azure, comme Azure Storage, Azure SQL Database, et des services personnalis√©s partag√©s via Private Link. Il offre un moyen s√©curis√© de consommer des services depuis votre propre VNet ou m√™me depuis diff√©rentes souscriptions Azure.

{% hint style="danger" %}
Les NSG ne s'appliquent pas aux points de terminaison priv√©s, ce qui signifie clairement qu'associer un NSG √† un sous-r√©seau contenant le Private Link n'aura aucun effet.
{% endhint %}

### **Exemple**

* Consid√©rez un sc√©nario o√π vous avez une **Azure SQL Database que vous souhaitez acc√©der de mani√®re s√©curis√©e depuis votre VNet**. Normalement, cela pourrait impliquer de traverser l'internet public. Avec Private Link, vous pouvez cr√©er un **point de terminaison priv√© dans votre VNet** qui se connecte directement au service Azure SQL Database. Ce point de terminaison fait appara√Ætre la base de donn√©es comme si elle faisait partie de votre propre VNet, accessible via une adresse IP priv√©e, assurant ainsi un acc√®s s√©curis√© et priv√©.

### **√ânum√©ration**

{% code overflow="wrap" %}
```bash
# List Private Link Services
z network private-link-service list --query "[].{name:name, location:location, resourceGroup:resourceGroup}" -o table

# List Private Endpoints
az network private-endpoint list --query "[].{name:name, location:location, resourceGroup:resourceGroup, privateLinkServiceConnections:privateLinkServiceConnections}" -o table
```
{% endcode %}

## Azure Service Endpoints

Les Azure Service Endpoints √©tendent l'espace d'adressage priv√© de votre r√©seau virtuel et l'identit√© de votre VNet aux services Azure via une connexion directe. En activant les service endpoints, **les ressources de votre VNet peuvent se connecter en toute s√©curit√© aux services Azure**, comme Azure Storage et Azure SQL Database, en utilisant le r√©seau backbone d'Azure. Cela garantit que **le trafic du VNet vers le service Azure reste au sein du r√©seau Azure**, offrant un chemin plus s√©curis√© et fiable.

### **Exemple**

* Par exemple, un compte **Azure Storage** est par d√©faut accessible via Internet public. En activant un **service endpoint pour Azure Storage au sein de votre VNet**, vous pouvez vous assurer que seul le trafic de votre VNet peut acc√©der au compte de stockage. Le pare-feu du compte de stockage peut alors √™tre configur√© pour accepter uniquement le trafic provenant de votre VNet.

### **√ânum√©ration**

{% code overflow="wrap" %}
```bash
# List Virtual Networks with Service Endpoints
az network vnet list --query "[].{name:name, location:location, serviceEndpoints:serviceEndpoints}" -o table

# List Subnets with Service Endpoints
az network vnet subnet list --resource-group <ResourceGroupName> --vnet-name <VNetName> --query "[].{name:name, serviceEndpoints:serviceEndpoints}" -o table
```
{% endcode %}

### Diff√©rences entre les Service Endpoints et les Private Links

Microsoft recommande d'utiliser les Private Links dans les [**docs**](https://learn.microsoft.com/en-us/azure/virtual-network/vnet-integration-for-azure-services#compare-private-endpoints-and-service-endpoints):\\

<figure><img src="../../../../.gitbook/assets/image (25).png" alt=""><figcaption></figcaption></figure>

**Service Endpoints :**

* Le trafic de votre VNet vers le service Azure passe par le r√©seau backbone de Microsoft Azure, contournant l'internet public.
* L'endpoint est une connexion directe au service Azure et ne fournit pas d'IP priv√©e pour le service au sein du VNet.
* Le service lui-m√™me reste accessible via son endpoint public depuis l'ext√©rieur de votre VNet, sauf si vous configurez le pare-feu du service pour bloquer ce type de trafic.
* C'est une relation un-√†-un entre le sous-r√©seau et le service Azure.
* Moins cher que les Private Links.

**Private Links :**

* Private Link mappe les services Azure dans votre VNet via un endpoint priv√©, qui est une interface r√©seau avec une adresse IP priv√©e au sein de votre VNet.
* Le service Azure est accessible en utilisant cette adresse IP priv√©e, ce qui le fait appara√Ætre comme s'il faisait partie de votre r√©seau.
* Les services connect√©s via Private Link ne peuvent √™tre accessibles que depuis votre VNet ou des r√©seaux connect√©s ; il n'y a pas d'acc√®s internet public au service.
* Il permet une connexion s√©curis√©e aux services Azure ou √† vos propres services h√©berg√©s dans Azure, ainsi qu'une connexion aux services partag√©s par d'autres.
* Il offre un contr√¥le d'acc√®s plus granulaire via un endpoint priv√© dans votre VNet, contrairement au contr√¥le d'acc√®s plus large au niveau du sous-r√©seau avec les service endpoints.

En r√©sum√©, bien que les Service Endpoints et les Private Links fournissent une connectivit√© s√©curis√©e aux services Azure, **les Private Links offrent un niveau d'isolation et de s√©curit√© plus √©lev√© en garantissant que les services sont accessibles de mani√®re priv√©e sans les exposer √† l'internet public**. Les Service Endpoints, en revanche, sont plus faciles √† configurer pour des cas g√©n√©raux o√π un acc√®s simple et s√©curis√© aux services Azure est requis sans besoin d'une IP priv√©e dans le VNet.

## Azure Front Door (AFD) & AFD WAF

**Azure Front Door** est un point d'entr√©e √©volutif et s√©curis√© pour la **livraison rapide** de vos applications web globales. Il **combine** divers services comme le **load balancing global, l'acc√©l√©ration de site, le d√©chargement SSL et les capacit√©s de Web Application Firewall (WAF)** en un seul service. Azure Front Door fournit un routage intelligent bas√© sur la **localisation de bord la plus proche de l'utilisateur**, garantissant des performances et une fiabilit√© optimales. De plus, il offre un routage bas√© sur les URL, l'h√©bergement de plusieurs sites, l'affinit√© de session et la s√©curit√© de la couche application.

**Azure Front Door WAF** est con√ßu pour **prot√©ger les applications web contre les attaques bas√©es sur le web** sans modification du code back-end. Il inclut des r√®gles personnalis√©es et des ensembles de r√®gles g√©r√©es pour se prot√©ger contre des menaces telles que l'injection SQL, le cross-site scripting et d'autres attaques courantes.

### **Exemple**

* Imaginez que vous avez une application distribu√©e globalement avec des utilisateurs partout dans le monde. Vous pouvez utiliser Azure Front Door pour **router les requ√™tes des utilisateurs vers le centre de donn√©es r√©gional le plus proche** h√©bergeant votre application, r√©duisant ainsi la latence, am√©liorant l'exp√©rience utilisateur et **la d√©fendant contre les attaques web avec les capacit√©s WAF**. Si une r√©gion particuli√®re conna√Æt une panne, Azure Front Door peut automatiquement rediriger le trafic vers la meilleure localisation suivante, garantissant une haute disponibilit√©.

### √ânum√©ration

{% code overflow="wrap" %}
```bash
# List Azure Front Door Instances
az network front-door list --query "[].{name:name, resourceGroup:resourceGroup, location:location}" -o table

# List Front Door WAF Policies
az network front-door waf-policy list --query "[].{name:name, resourceGroup:resourceGroup, location:location}" -o table
```
{% endcode %}

## Azure Application Gateway et Azure Application Gateway WAF

Azure Application Gateway est un **√©quilibreur de charge de trafic web** qui vous permet de g√©rer le trafic vers vos applications **web**. Il offre des **capacit√©s d'√©quilibrage de charge de couche 7, de terminaison SSL et de pare-feu d'application web (WAF)** dans le contr√¥leur de livraison d'applications (ADC) en tant que service. Les fonctionnalit√©s cl√©s incluent le routage bas√© sur les URL, l'affinit√© de session bas√©e sur les cookies et le d√©chargement de la couche de sockets s√©curis√©e (SSL), qui sont cruciales pour les applications n√©cessitant des capacit√©s d'√©quilibrage de charge complexes comme le routage global et le routage bas√© sur les chemins.

### Exemple

* Consid√©rez un sc√©nario o√π vous avez un site e-commerce qui inclut plusieurs sous-domaines pour diff√©rentes fonctions, telles que les comptes utilisateurs et le traitement des paiements. Azure Application Gateway peut **router le trafic vers les serveurs web appropri√©s en fonction du chemin URL**. Par exemple, le trafic vers `example.com/accounts` pourrait √™tre dirig√© vers le service des comptes utilisateurs, et le trafic vers `example.com/pay` pourrait √™tre dirig√© vers le service de traitement des paiements.\
Et **prot√©gez votre site web contre les attaques en utilisant les capacit√©s WAF.**

### **√ânum√©ration**

{% code overflow="wrap" %}
```bash
# List the Web Application Firewall configurations for your Application Gateways
az network application-gateway waf-config list --gateway-name <AppGatewayName> --resource-group <ResourceGroupName> --query "[].{name:name, firewallMode:firewallMode, ruleSetType:ruleSetType, ruleSetVersion:ruleSetVersion}" -o table
```
{% endcode %}

## Azure Hub, Spoke & VNet Peering

**VNet Peering** est une fonctionnalit√© de r√©seau dans Azure qui **permet √† diff√©rents Virtual Networks (VNets) d'√™tre connect√©s directement et de mani√®re transparente**. Gr√¢ce au VNet peering, les ressources dans un VNet peuvent communiquer avec les ressources dans un autre VNet en utilisant des adresses IP priv√©es, **comme si elles √©taient dans le m√™me r√©seau**.\
**Le VNet Peering peut √©galement √™tre utilis√© avec des r√©seaux on-prem** en configurant un VPN site-√†-site ou Azure ExpressRoute.

**Azure Hub and Spoke** est une topologie de r√©seau utilis√©e dans Azure pour g√©rer et organiser le trafic r√©seau. **Le "hub" est un point central qui contr√¥le et dirige le trafic entre diff√©rents "spokes"**. Le hub contient g√©n√©ralement des services partag√©s tels que des appliances virtuelles de r√©seau (NVAs), Azure VPN Gateway, Azure Firewall ou Azure Bastion. Les **"spokes" sont des VNets qui h√©bergent des charges de travail et se connectent au hub en utilisant le VNet peering**, leur permettant de tirer parti des services partag√©s au sein du hub. Ce mod√®le favorise une disposition r√©seau propre, r√©duisant la complexit√© en centralisant les services communs que plusieurs charges de travail √† travers diff√©rents VNets peuvent utiliser.

{% hint style="danger" %}
**Le VNET peering est non transitif dans Azure**, ce qui signifie que si le spoke 1 est connect√© au spoke 2 et que le spoke 2 est connect√© au spoke 3, alors le spoke 1 ne peut pas communiquer directement avec le spoke 3.
{% endhint %}

### Exemples

* Imaginez une entreprise avec des d√©partements s√©par√©s comme les Ventes, les RH et le D√©veloppement, **chacun avec son propre VNet (les spokes)**. Ces VNets **n√©cessitent un acc√®s √† des ressources partag√©es** comme une base de donn√©es centrale, un pare-feu et une passerelle internet, qui sont tous situ√©s dans **un autre VNet (le hub)**. En utilisant le mod√®le Hub and Spoke, chaque d√©partement peut **se connecter en toute s√©curit√© aux ressources partag√©es via le hub VNet sans exposer ces ressources √† l'internet public** ou cr√©er une structure r√©seau complexe avec de nombreuses connexions.

### √ânum√©ration

{% code overflow="wrap" %}
```bash
# List all VNets in your subscription
az network vnet list --query "[].{name:name, location:location, addressSpace:addressSpace}" -o table

# List VNet peering connections for a given VNet
az network vnet peering list --resource-group <ResourceGroupName> --vnet-name <VNetName> --query "[].{name:name, peeringState:peeringState, remoteVnetId:remoteVnetId}" -o table

# List Shared Resources (e.g., Azure Firewall) in the Hub
az network firewall list --query "[].{name:name, location:location, resourceGroup:resourceGroup}" -o table
```
{% endcode %}

## Site-to-Site VPN

Un Site-to-Site VPN dans Azure vous permet de **connecter votre r√©seau local √† votre Azure Virtual Network (VNet)**, permettant aux ressources telles que les VMs dans Azure d'appara√Ætre comme si elles √©taient sur votre r√©seau local. Cette connexion est √©tablie via une **passerelle VPN qui chiffre le trafic** entre les deux r√©seaux.

### **Exemple**

* Une entreprise dont le si√®ge est situ√© √† New York dispose d'un centre de donn√©es local qui doit se connecter en toute s√©curit√© √† son VNet dans Azure, qui h√©berge ses charges de travail virtualis√©es. En configurant un **Site-to-Site VPN, l'entreprise peut garantir une connectivit√© chiffr√©e entre les serveurs locaux et les VMs Azure**, permettant aux ressources d'√™tre accessibles en toute s√©curit√© dans les deux environnements comme s'ils √©taient sur le m√™me r√©seau local.

### **√ânum√©ration**

{% code overflow="wrap" %}
```bash
# List VPN Gateways
az network vnet-gateway list --query "[].{name:name, location:location, resourceGroup:resourceGroup}" -o table

# List VPN Connections
az network vpn-connection list --gateway-name <VpnGatewayName> --resource-group <ResourceGroupName> --query "[].{name:name, connectionType:connectionType, connectionStatus:connectionStatus}" -o table
```
{% endcode %}

## Azure ExpressRoute

Azure ExpressRoute est un service qui fournit une **connexion priv√©e, d√©di√©e et √† haute vitesse entre votre infrastructure sur site et les centres de donn√©es Azure**. Cette connexion est √©tablie via un fournisseur de connectivit√©, contournant l'internet public et offrant plus de fiabilit√©, des vitesses plus rapides, des latences plus faibles et une s√©curit√© accrue par rapport aux connexions internet typiques.

### **Exemple**

* Une multinationale n√©cessite une **connexion coh√©rente et fiable √† ses services Azure en raison du volume √©lev√© de donn√©es** et du besoin de haut d√©bit. L'entreprise opte pour Azure ExpressRoute pour connecter directement son centre de donn√©es sur site √† Azure, facilitant les transferts de donn√©es √† grande √©chelle, tels que les sauvegardes quotidiennes et l'analyse de donn√©es en temps r√©el, avec une confidentialit√© et une vitesse am√©lior√©es.

### **√ânum√©ration**

{% code overflow="wrap" %}
```bash
# List ExpressRoute Circuits
az network express-route list --query "[].{name:name, location:location, resourceGroup:resourceGroup, serviceProviderName:serviceProviderName, peeringLocation:peeringLocation}" -o table
```
{% endcode %}

{% hint style="success" %}
Apprenez et pratiquez AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Apprenez et pratiquez GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Soutenez HackTricks</summary>

* Consultez les [**plans d'abonnement**](https://github.com/sponsors/carlospolop)!
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez-nous** sur **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Partagez des astuces de hacking en soumettant des PRs aux d√©p√¥ts github** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
{% endhint %}
