# Az - Azure App Service & Function Apps

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## App Service Basic Information

[From the docs:](https://learn.microsoft.com/en-us/azure/app-service/overview) _Azure App Service_ ã¯ã€ã‚¦ã‚§ãƒ–ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã€REST APIã€ãŠã‚ˆã³ãƒ¢ãƒã‚¤ãƒ«ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚’ãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚°ã™ã‚‹ãŸã‚ã®HTTPãƒ™ãƒ¼ã‚¹ã®ã‚µãƒ¼ãƒ“ã‚¹ã§ã™ã€‚ã‚ãªãŸã®å¥½ããªè¨€èªï¼ˆ.NETã€.NET Coreã€Javaã€Rubyã€Node.jsã€PHPã€ã¾ãŸã¯Pythonï¼‰ã§é–‹ç™ºã§ãã¾ã™ã€‚ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¯ã€WindowsãŠã‚ˆã³Linuxãƒ™ãƒ¼ã‚¹ã®ç’°å¢ƒã®ä¸¡æ–¹ã§ç°¡å˜ã«å®Ÿè¡ŒãŠã‚ˆã³ã‚¹ã‚±ãƒ¼ãƒ«ã—ã¾ã™ã€‚

å„ã‚¢ãƒ—ãƒªã¯ã‚µãƒ³ãƒ‰ãƒœãƒƒã‚¯ã‚¹å†…ã§å®Ÿè¡Œã•ã‚Œã¾ã™ãŒã€éš”é›¢ã¯App Serviceãƒ—ãƒ©ãƒ³ã«ä¾å­˜ã—ã¾ã™ã€‚

* ç„¡æ–™ãŠã‚ˆã³å…±æœ‰ãƒ—ãƒ©ãƒ³ã®ã‚¢ãƒ—ãƒªã¯å…±æœ‰VMä¸Šã§å®Ÿè¡Œã•ã‚Œã¾ã™ã€‚
* ã‚¹ã‚¿ãƒ³ãƒ€ãƒ¼ãƒ‰ãŠã‚ˆã³ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ãƒ—ãƒ©ãƒ³ã®ã‚¢ãƒ—ãƒªã¯å°‚ç”¨VMä¸Šã§å®Ÿè¡Œã•ã‚Œã¾ã™ã€‚

{% hint style="warning" %}
æ³¨æ„ã—ã¦ãã ã•ã„ã€**ã“ã‚Œã‚‰ã®éš”é›¢ã¯**ä»–ã®ä¸€èˆ¬çš„ãª**ã‚¦ã‚§ãƒ–è„†å¼±æ€§**ï¼ˆãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã‚„ã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ãªã©ï¼‰ã‚’**é˜²ãã“ã¨ã¯ã‚ã‚Šã¾ã›ã‚“**ã€‚ã¾ãŸã€**ç®¡ç†ã‚¢ã‚¤ãƒ‡ãƒ³ãƒ†ã‚£ãƒ†ã‚£**ãŒä½¿ç”¨ã•ã‚Œã¦ã„ã‚‹å ´åˆã€ãã®**æ¨©é™ã‚’ä¾µå®³ã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™**ã€‚
{% endhint %}

### Enumeration

{% tabs %}
{% tab title="az" %}
{% code overflow="wrap" %}
```bash
# List webapps
az webapp list

## Less information
az webapp list --query "[].{hostName: defaultHostName, state: state, name: name, resourcegroup: resourceGroup}"

# Get access restrictions
az webapp config access-restriction show --resource-group <res-group> -n <name>

# Remove access restrictions
az webapp config access-restriction remove --resource-group <res-group> -n <name> --rule-name <rule-name>

# Get snapshots
az webapp config snapshot list --resource-group <res-group> -n <name>

# Restore snapshot
az webapp config snapshot restore -g <res-group> -n <name> --time 2018-12-11T23:34:16.8388367

# Restart webapp
az webapp restart --name <name> --resource-group <res-group>
```
{% endcode %}
{% endtab %}

{% tab title="Az Powershell" %}
```powershell
# Get App Services and Function Apps
Get-AzWebApp
# Get only App Services
Get-AzWebApp | ?{$_.Kind -notmatch "functionapp"}
```
{% endtab %}

{% tab title="az get all" %}
{% code overflow="wrap" %}
```bash
#!/bin/bash

# Get all App Service and Function Apps

# Define Azure subscription ID
azure_subscription="your_subscription_id"

# Log in to Azure
az login

# Select Azure subscription
az account set --subscription $azure_subscription

# Get all App Services in the specified subscription
list_app_services=$(az appservice list --query "[].{appServiceName: name, group: resourceGroup}" -o tsv)

# Iterate over each App Service
echo "$list_app_services" | while IFS=$'\t' read -r appServiceName group; do
# Get the type of the App Service
service_type=$(az appservice show --name $appServiceName --resource-group $group --query "kind" -o tsv)

# Check if it is a Function App and print its name
if [ "$service_type" == "functionapp" ]; then
echo "Function App Name: $appServiceName"
fi
done
```
{% endcode %}
{% endtab %}
{% endtabs %}

#### è³‡æ ¼æƒ…å ±ã‚’å–å¾—ã—ã€webappã‚³ãƒ¼ãƒ‰ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹
```bash
# Get connection strings that could contain credentials (with DBs for example)
az webapp config connection-string list --name <name> --resource-group <res-group>
## Check how to use the DBs connection strings in the SQL page

# Get credentials to access the code and DB credentials if configured.
az webapp deployment list-publishing-profiles --resource-group <res-group> -n <name>


# Get git URL to access the code
az webapp deployment source config-local-git --resource-group <res-group> -n <name>

# Access/Modify the code via git
git clone 'https://<username>:<password>@name.scm.azurewebsites.net/repo-name.git'
## In my case the username was: $nameofthewebapp and the password some random chars
## If you change the code and do a push, the app is automatically redeployed
```
#### WebappçµŒç”±ã§Dockerã‚³ãƒ³ãƒ†ãƒŠã«sshã§ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹:
```bash
# Get ssh session
az webapp create-remote-connection --subscription <SUBSCRIPTION-ID> --resource-group <RG-NAME> -n <APP-SERVICE-NAME>

## If successfull you will get a message such as:
#Verifying if app is running....
#App is running. Trying to establish tunnel connection...
#Opening tunnel on port: 39895
#SSH is available { username: root, password: Docker! }

## So from that machine ssh into that port (you might need generate a new ssh session to the jump host)
ssh root@127.0.0.1 -p 39895
```
## Function Apps åŸºæœ¬æƒ…å ±

Azure Functionsã¯ã€**ã‚µãƒ¼ãƒãƒ¼ãƒ¬ã‚¹**ã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã§ã€ã‚³ãƒ¼ãƒ‰ã‚’å°‘ãªãæ›¸ãã€ã‚¤ãƒ³ãƒ•ãƒ©ã‚¹ãƒˆãƒ©ã‚¯ãƒãƒ£ã‚’å°‘ãªãç¶­æŒã—ã€ã‚³ã‚¹ãƒˆã‚’ç¯€ç´„ã§ãã¾ã™ã€‚ã‚µãƒ¼ãƒãƒ¼ã®å±•é–‹ã‚„ç¶­æŒã«ã¤ã„ã¦å¿ƒé…ã™ã‚‹ä»£ã‚ã‚Šã«ã€ã‚¯ãƒ©ã‚¦ãƒ‰ã‚¤ãƒ³ãƒ•ãƒ©ã‚¹ãƒˆãƒ©ã‚¯ãƒãƒ£ã¯ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œã™ã‚‹ãŸã‚ã«å¿…è¦ãªæœ€æ–°ã®ãƒªã‚½ãƒ¼ã‚¹ã‚’ã™ã¹ã¦æä¾›ã—ã¾ã™ã€‚

Azureãƒãƒ¼ã‚¿ãƒ«ã§ã¯ã€Azure Functionsã¨Azure API Managementã®çµ±åˆãŒä¿ƒé€²ã•ã‚Œã€**HTTPãƒˆãƒªã‚¬ãƒ¼é–¢æ•°ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’REST APIã¨ã—ã¦å…¬é–‹**ã§ãã¾ã™ã€‚ã“ã®æ–¹æ³•ã§å…¬é–‹ã•ã‚ŒãŸAPIã¯OpenAPIå®šç¾©ã‚’ä½¿ç”¨ã—ã¦è¨˜è¿°ã•ã‚Œã€RESTful APIã«å¯¾ã™ã‚‹æ¨™æº–çš„ã§è¨€èªã«ä¾å­˜ã—ãªã„ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’æä¾›ã—ã¾ã™ã€‚

**Function Appsã¯ãƒãƒãƒ¼ã‚¸ãƒ‰IDã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã¾ã™ã€‚**

ã•ã‚‰ã«ã€Function Appã«ã¯ã€Œadminã€ã‚„ã€Œanonymousã€ãªã©ã€ç‰¹å®šã®ãƒ¬ãƒ™ãƒ«ã®èªè¨¼ã‚’å¿…è¦ã¨ã™ã‚‹ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆãŒã‚ã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚\
æ”»æ’ƒè€…ã¯ã€åˆ¶é™ã‚’å›é¿ã—ã€æ©Ÿå¯†ãƒ‡ãƒ¼ã‚¿ã‚„æ©Ÿèƒ½ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ãŸã‚ã«ã€**anonymous allowed endpoints**ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã‚ˆã†ã¨ã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚

### åˆ—æŒ™
```powershell
# Get only Function Apps
Get-AzFunctionApp
```
## å‚è€ƒæ–‡çŒ®

* [https://learn.microsoft.com/en-in/azure/app-service/overview](https://learn.microsoft.com/en-in/azure/app-service/overview)
* [https://learn.microsoft.com/en-us/azure/azure-functions/functions-openapi-definition](https://learn.microsoft.com/en-us/azure/azure-functions/functions-openapi-definition)

{% hint style="success" %}
AWSãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã³ã€å®Ÿè·µã™ã‚‹ï¼š<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
GCPãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã³ã€å®Ÿè·µã™ã‚‹ï¼š<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricksã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹</summary>

* [**ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³**](https://github.com/sponsors/carlospolop)ã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼
* **ğŸ’¬ [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã¾ãŸã¯[**Telegramã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«å‚åŠ ã™ã‚‹ã‹ã€**Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**ã‚’ãƒ•ã‚©ãƒ­ãƒ¼ã—ã¦ãã ã•ã„ã€‚**
* **[**HackTricks**](https://github.com/carlospolop/hacktricks)ãŠã‚ˆã³[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)ã®GitHubãƒªãƒã‚¸ãƒˆãƒªã«PRã‚’æå‡ºã—ã¦ãƒãƒƒã‚­ãƒ³ã‚°ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã—ã¦ãã ã•ã„ã€‚**

</details>
{% endhint %}
