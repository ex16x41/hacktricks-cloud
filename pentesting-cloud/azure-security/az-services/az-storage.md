# Az - Storage

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Basic Information

Azure Storage AccountsëŠ” Microsoft Azureì˜ ê¸°ë³¸ ì„œë¹„ìŠ¤ë¡œ, ë‹¤ì–‘í•œ ë°ì´í„° ìœ í˜•ì— ëŒ€í•œ í™•ì¥ ê°€ëŠ¥í•˜ê³  ì•ˆì „í•˜ë©° ê³ ê°€ìš©ì„±ì˜ í´ë¼ìš°ë“œ **ìŠ¤í† ë¦¬ì§€ë¥¼ ì œê³µí•©ë‹ˆë‹¤**, ì—¬ê¸°ì—ëŠ” blobs(ì´ì§„ ëŒ€ìš©ëŸ‰ ê°ì²´), íŒŒì¼, í ë° í…Œì´ë¸”ì´ í¬í•¨ë©ë‹ˆë‹¤. ì´ë“¤ì€ ì´ëŸ¬í•œ ë‹¤ì–‘í•œ ìŠ¤í† ë¦¬ì§€ ì„œë¹„ìŠ¤ë¥¼ ë‹¨ì¼ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ ì•„ë˜ì—ì„œ ì‰½ê²Œ ê´€ë¦¬í•  ìˆ˜ ìˆë„ë¡ ê·¸ë£¹í™”í•˜ëŠ” ì»¨í…Œì´ë„ˆ ì—­í• ì„ í•©ë‹ˆë‹¤.

**ì£¼ìš” êµ¬ì„± ì˜µì…˜**:

* ëª¨ë“  ìŠ¤í† ë¦¬ì§€ ê³„ì •ì€ **ëª¨ë“  Azureì—ì„œ ìœ ì¼í•œ ì´ë¦„**ì„ ê°€ì ¸ì•¼ í•©ë‹ˆë‹¤.
* ëª¨ë“  ìŠ¤í† ë¦¬ì§€ ê³„ì •ì€ **ì§€ì—­** ë˜ëŠ” Azure í™•ì¥ ì˜ì—­ì— ë°°í¬ë©ë‹ˆë‹¤.
* ë” ë‚˜ì€ ì„±ëŠ¥ì„ ìœ„í•´ ìŠ¤í† ë¦¬ì§€ ê³„ì •ì˜ **í”„ë¦¬ë¯¸ì—„** ë²„ì „ì„ ì„ íƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
* ë™, ë“œë¼ì´ë¸Œ ë° ë°ì´í„° ì„¼í„° **ì¥ì• **ì— ëŒ€ë¹„í•˜ê¸° ìœ„í•´ **4ê°€ì§€ ìœ í˜•ì˜ ì¤‘ë³µì„±** ì¤‘ì—ì„œ ì„ íƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

**ë³´ì•ˆ êµ¬ì„± ì˜µì…˜**:

* **REST API ì‘ì—…ì— ëŒ€í•œ ë³´ì•ˆ ì „ì†¡ ìš”êµ¬**: ìŠ¤í† ë¦¬ì§€ì™€ì˜ ëª¨ë“  í†µì‹ ì—ì„œ TLS ìš”êµ¬
* **ê°œë³„ ì»¨í…Œì´ë„ˆì—ì„œ ìµëª… ì•¡ì„¸ìŠ¤ í™œì„±í™” í—ˆìš©**: ê·¸ë ‡ì§€ ì•Šìœ¼ë©´ í–¥í›„ ìµëª… ì•¡ì„¸ìŠ¤ë¥¼ í™œì„±í™”í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.
* **ìŠ¤í† ë¦¬ì§€ ê³„ì • í‚¤ ì•¡ì„¸ìŠ¤ í™œì„±í™”**: ê·¸ë ‡ì§€ ì•Šìœ¼ë©´ ê³µìœ  í‚¤ë¡œì˜ ì•¡ì„¸ìŠ¤ê°€ ê¸ˆì§€ë©ë‹ˆë‹¤.
* **ìµœì†Œ TLS ë²„ì „**
* **ë³µì‚¬ ì‘ì—…ì— ëŒ€í•œ í—ˆìš© ë²”ìœ„**: ëª¨ë“  ìŠ¤í† ë¦¬ì§€ ê³„ì •, ë™ì¼í•œ Entra í…Œë„ŒíŠ¸ì˜ ëª¨ë“  ìŠ¤í† ë¦¬ì§€ ê³„ì • ë˜ëŠ” ë™ì¼í•œ ê°€ìƒ ë„¤íŠ¸ì›Œí¬ì˜ ê°œì¸ ì—”ë“œí¬ì¸íŠ¸ê°€ ìˆëŠ” ìŠ¤í† ë¦¬ì§€ ê³„ì •ì—ì„œ í—ˆìš©í•©ë‹ˆë‹¤.

**Blob Storage ì˜µì…˜**:

* **í¬ë¡œìŠ¤ í…Œë„ŒíŠ¸ ë³µì œ í—ˆìš©**
* **ì•¡ì„¸ìŠ¤ ê³„ì¸µ**: í•«(ìì£¼ ì•¡ì„¸ìŠ¤ë˜ëŠ” ë°ì´í„°), ì¿¨ ë° ì½œë“œ(ë“œë¬¼ê²Œ ì•¡ì„¸ìŠ¤ë˜ëŠ” ë°ì´í„°)

**ë„¤íŠ¸ì›Œí‚¹ ì˜µì…˜**:

* **ë„¤íŠ¸ì›Œí¬ ì•¡ì„¸ìŠ¤**:
* ëª¨ë“  ë„¤íŠ¸ì›Œí¬ì—ì„œ í—ˆìš©
* ì„ íƒëœ ê°€ìƒ ë„¤íŠ¸ì›Œí¬ ë° IP ì£¼ì†Œì—ì„œ í—ˆìš©
* ê³µìš© ì•¡ì„¸ìŠ¤ë¥¼ ë¹„í™œì„±í™”í•˜ê³  ê°œì¸ ì•¡ì„¸ìŠ¤ë¥¼ ì‚¬ìš©
* **ê°œì¸ ì—”ë“œí¬ì¸íŠ¸**: ê°€ìƒ ë„¤íŠ¸ì›Œí¬ì—ì„œ ìŠ¤í† ë¦¬ì§€ ê³„ì •ìœ¼ë¡œì˜ ê°œì¸ ì—°ê²°ì„ í—ˆìš©í•©ë‹ˆë‹¤.

**ë°ì´í„° ë³´í˜¸ ì˜µì…˜**:

* **ì»¨í…Œì´ë„ˆì— ëŒ€í•œ ì‹œì  ë³µì›**: ì»¨í…Œì´ë„ˆë¥¼ ì´ì „ ìƒíƒœë¡œ ë³µì›í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
* ë²„ì „ ê´€ë¦¬, ë³€ê²½ í”¼ë“œ ë° blob ì†Œí”„íŠ¸ ì‚­ì œê°€ í™œì„±í™”ë˜ì–´ì•¼ í•©ë‹ˆë‹¤.
* **blobì— ëŒ€í•œ ì†Œí”„íŠ¸ ì‚­ì œ í™œì„±í™”**: ì‚­ì œëœ blob(ë®ì–´ì“´ ê²½ìš° í¬í•¨)ì— ëŒ€í•œ ë³´ì¡´ ê¸°ê°„ì„ ì¼ìˆ˜ë¡œ ì„¤ì •í•©ë‹ˆë‹¤.
* **ì»¨í…Œì´ë„ˆì— ëŒ€í•œ ì†Œí”„íŠ¸ ì‚­ì œ í™œì„±í™”**: ì‚­ì œëœ ì»¨í…Œì´ë„ˆì— ëŒ€í•œ ë³´ì¡´ ê¸°ê°„ì„ ì¼ìˆ˜ë¡œ ì„¤ì •í•©ë‹ˆë‹¤.
* **íŒŒì¼ ê³µìœ ì— ëŒ€í•œ ì†Œí”„íŠ¸ ì‚­ì œ í™œì„±í™”**: ì‚­ì œëœ íŒŒì¼ ê³µìœ ì— ëŒ€í•œ ë³´ì¡´ ê¸°ê°„ì„ ì¼ìˆ˜ë¡œ ì„¤ì •í•©ë‹ˆë‹¤.
* **blobì— ëŒ€í•œ ë²„ì „ ê´€ë¦¬ í™œì„±í™”**: ì´ì „ ë²„ì „ì˜ blobì„ ìœ ì§€í•©ë‹ˆë‹¤.
* **blob ë³€ê²½ í”¼ë“œ í™œì„±í™”**: blobì˜ ìƒì„±, ìˆ˜ì • ë° ì‚­ì œ ë³€ê²½ ì‚¬í•­ì„ ê¸°ë¡í•©ë‹ˆë‹¤.
* **ë²„ì „ ìˆ˜ì¤€ ë¶ˆë³€ì„± ì§€ì› í™œì„±í™”**: ëª¨ë“  blob ë²„ì „ì— ì ìš©ë˜ëŠ” ì‹œê°„ ê¸°ë°˜ ë³´ì¡´ ì •ì±…ì„ ê³„ì • ìˆ˜ì¤€ì—ì„œ ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
* ë²„ì „ ìˆ˜ì¤€ ë¶ˆë³€ì„± ì§€ì›ê³¼ ì»¨í…Œì´ë„ˆì— ëŒ€í•œ ì‹œì  ë³µì›ì€ ë™ì‹œì— í™œì„±í™”í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.

**ì•”í˜¸í™” êµ¬ì„± ì˜µì…˜**:

* **ì•”í˜¸í™” ìœ í˜•**: Microsoft ê´€ë¦¬ í‚¤(MMK) ë˜ëŠ” ê³ ê° ê´€ë¦¬ í‚¤(CMK)ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
* **ì¸í”„ë¼ ì•”í˜¸í™” í™œì„±í™”**: "ë” ë§ì€ ë³´ì•ˆì„ ìœ„í•´" ë°ì´í„°ë¥¼ ì´ì¤‘ ì•”í˜¸í™”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### Storage endpoints

<table data-header-hidden><thead><tr><th width="197">Storage Service</th><th>Endpoint</th></tr></thead><tbody><tr><td><strong>Blob storage</strong></td><td><code>https://&#x3C;storage-account>.blob.core.windows.net</code><br><br><code>https://&#x3C;stg-acc>.blob.core.windows.net/&#x3C;container-name>?restype=container&#x26;comp=list</code></td></tr><tr><td><strong>Data Lake Storage</strong></td><td><code>https://&#x3C;storage-account>.dfs.core.windows.net</code></td></tr><tr><td><strong>Azure Files</strong></td><td><code>https://&#x3C;storage-account>.file.core.windows.net</code></td></tr><tr><td><strong>Queue storage</strong></td><td><code>https://&#x3C;storage-account>.queue.core.windows.net</code></td></tr><tr><td><strong>Table storage</strong></td><td><code>https://&#x3C;storage-account>.table.core.windows.net</code></td></tr></tbody></table>

### Public Exposure

"Blob ê³µìš© ì•¡ì„¸ìŠ¤ í—ˆìš©"ì´ **í™œì„±í™”**ëœ ê²½ìš°(ê¸°ë³¸ì ìœ¼ë¡œ ë¹„í™œì„±í™”ë¨), ì»¨í…Œì´ë„ˆë¥¼ ìƒì„±í•  ë•Œ ë‹¤ìŒì„ ìˆ˜í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

* **blob ì½ê¸°**ì— ëŒ€í•œ **ê³µìš© ì•¡ì„¸ìŠ¤ ì œê³µ**(ì´ë¦„ì„ ì•Œì•„ì•¼ í•¨).
* **ì»¨í…Œì´ë„ˆ blob ë‚˜ì—´** ë° **ì½ê¸°**.
* ì™„ì „íˆ **ë¹„ê³µê°œë¡œ ë§Œë“¤ê¸°**

<figure><img src="https://lh7-rt.googleusercontent.com/slidesz/AGV_vUfoetUnYBPWQpRrWNnnlbqWpl8Rdoaeg5uBrCVlvcNDlnKwQHjZe8nUb2SfPspBgbu-lCZLmUei-hFi_Jl2eKbaxUtBGTjdUSDmkrcwr90VZkmuMjk9tyh92p75btfyzGiUTa0-=s2048?key=m8TV59TrCFPlkiNnmhYx3aZt" alt=""><figcaption></figcaption></figure>

### Connect to Storage

ì—°ê²°í•  ìˆ˜ ìˆëŠ” **ìŠ¤í† ë¦¬ì§€**ë¥¼ ì°¾ìœ¼ë©´ [**Microsoft Azure Storage Explorer**](https://azure.microsoft.com/es-es/products/storage/storage-explorer/) ë„êµ¬ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

## Access to Storage <a href="#about-blob-storage" id="about-blob-storage"></a>

### RBAC

Entra ID ì£¼ì²´ë¥¼ ì‚¬ìš©í•˜ì—¬ **RBAC ì—­í• **ë¡œ ìŠ¤í† ë¦¬ì§€ ê³„ì •ì— ì•¡ì„¸ìŠ¤í•  ìˆ˜ ìˆìœ¼ë©°, ì´ëŠ” ê¶Œì¥ë˜ëŠ” ë°©ë²•ì…ë‹ˆë‹¤.

### Access Keys

ìŠ¤í† ë¦¬ì§€ ê³„ì •ì—ëŠ” ì•¡ì„¸ìŠ¤í•  ìˆ˜ ìˆëŠ” ì•¡ì„¸ìŠ¤ í‚¤ê°€ ìˆìŠµë‹ˆë‹¤. ì´ëŠ” ìŠ¤í† ë¦¬ì§€ ê³„ì •ì— ëŒ€í•œ **ì „ì²´ ì•¡ì„¸ìŠ¤**ë¥¼ ì œê³µí•©ë‹ˆë‹¤.

<figure><img src="../../../.gitbook/assets/image.png" alt=""><figcaption></figcaption></figure>

### **Shared Keys & Lite Shared Keys**

íŠ¹ì • ë¦¬ì†ŒìŠ¤ì— ëŒ€í•œ ì•¡ì„¸ìŠ¤ë¥¼ ìŠ¹ì¸í•˜ê¸° ìœ„í•´ ì•¡ì„¸ìŠ¤ í‚¤ë¡œ ì„œëª…ëœ [**ê³µìœ  í‚¤ ìƒì„±**](https://learn.microsoft.com/en-us/rest/api/storageservices/authorize-with-shared-key)ì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

{% hint style="info" %}
`CanonicalizedResource` ë¶€ë¶„ì€ ìŠ¤í† ë¦¬ì§€ ì„œë¹„ìŠ¤ ë¦¬ì†ŒìŠ¤(URI)ë¥¼ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤. URLì˜ ì–´ë–¤ ë¶€ë¶„ì´ ì¸ì½”ë”©ëœ ê²½ìš°, `CanonicalizedResource` ë‚´ì—ì„œë„ ì¸ì½”ë”©ë˜ì–´ì•¼ í•©ë‹ˆë‹¤.
{% endhint %}

{% hint style="info" %}
ì´ëŠ” **ê¸°ë³¸ì ìœ¼ë¡œ `az` cli**ì—ì„œ ìš”ì²­ì„ ì¸ì¦í•˜ëŠ” ë° ì‚¬ìš©ë©ë‹ˆë‹¤. Entra ID ì£¼ì²´ ìê²© ì¦ëª…ì„ ì‚¬ìš©í•˜ë ¤ë©´ `--auth-mode login` ë§¤ê°œë³€ìˆ˜ë¥¼ ì§€ì •í•˜ì‹­ì‹œì˜¤.
{% endhint %}

* ë‹¤ìŒ ì •ë³´ë¥¼ ì„œëª…í•˜ì—¬ **blob, queue ë° file ì„œë¹„ìŠ¤ì— ëŒ€í•œ ê³µìœ  í‚¤**ë¥¼ ìƒì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```bash
StringToSign = VERB + "\n" +
Content-Encoding + "\n" +
Content-Language + "\n" +
Content-Length + "\n" +
Content-MD5 + "\n" +
Content-Type + "\n" +
Date + "\n" +
If-Modified-Since + "\n" +
If-Match + "\n" +
If-None-Match + "\n" +
If-Unmodified-Since + "\n" +
Range + "\n" +
CanonicalizedHeaders +
CanonicalizedResource;
```
* ë‹¤ìŒ ì •ë³´ë¥¼ ì„œëª…í•˜ì—¬ **í…Œì´ë¸” ì„œë¹„ìŠ¤ìš© ê³µìœ  í‚¤**ë¥¼ ìƒì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```bash
StringToSign = VERB + "\n" +
Content-MD5 + "\n" +
Content-Type + "\n" +
Date + "\n" +
CanonicalizedResource;
```
* ë‹¤ìŒ ì •ë³´ë¥¼ ì„œëª…í•˜ì—¬ **blob, queue ë° file ì„œë¹„ìŠ¤**ì— ëŒ€í•œ **lite shared key**ë¥¼ ìƒì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```bash
StringToSign = VERB + "\n" +
Content-MD5 + "\n" +
Content-Type + "\n" +
Date + "\n" +
CanonicalizedHeaders +
CanonicalizedResource;
```
* ë‹¤ìŒ ì •ë³´ë¥¼ ì„œëª…í•˜ì—¬ **í…Œì´ë¸” ì„œë¹„ìŠ¤ìš© ë¼ì´íŠ¸ ê³µìœ  í‚¤**ë¥¼ ìƒì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```bash
StringToSign = Date + "\n"
CanonicalizedResource
```
ê·¸ëŸ° ë‹¤ìŒ, í‚¤ë¥¼ ì‚¬ìš©í•˜ë ¤ë©´ ë‹¤ìŒ êµ¬ë¬¸ì— ë”°ë¼ Authorization í—¤ë”ì—ì„œ ìˆ˜í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```bash
Authorization="[SharedKey|SharedKeyLite] <AccountName>:<Signature>"
#e.g.
Authorization: SharedKey myaccount:ctzMq410TV3wS7upTBcunJTDLEJwMAZuFPfr0mrrA08=

PUT http://myaccount/mycontainer?restype=container&timeout=30 HTTP/1.1
x-ms-version: 2014-02-14
x-ms-date: Fri, 26 Jun 2015 23:39:12 GMT
Authorization: SharedKey myaccount:ctzMq410TV3wS7upTBcunJTDLEJwMAZuFPfr0mrrA08=
Content-Length: 0
```
### **ê³µìœ  ì•¡ì„¸ìŠ¤ ì„œëª…** (SAS)

ê³µìœ  ì•¡ì„¸ìŠ¤ ì„œëª…(SAS)ì€ Azure Storage ê³„ì •ì˜ ë¦¬ì†ŒìŠ¤ì— ëŒ€í•œ íŠ¹ì • ê¶Œí•œì„ ë¶€ì—¬í•˜ëŠ” **ì•ˆì „í•˜ê³  ì‹œê°„ ì œí•œëœ URL**ë¡œ, ê³„ì •ì˜ ì•¡ì„¸ìŠ¤ í‚¤ë¥¼ ë…¸ì¶œí•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ì•¡ì„¸ìŠ¤ í‚¤ëŠ” ëª¨ë“  ë¦¬ì†ŒìŠ¤ì— ëŒ€í•œ ì „ì²´ ê´€ë¦¬ ì•¡ì„¸ìŠ¤ë¥¼ ì œê³µí•˜ëŠ” ë°˜ë©´, SASëŠ” ê¶Œí•œ(ì½ê¸° ë˜ëŠ” ì“°ê¸°ì™€ ê°™ì€)ì„ ì§€ì •í•˜ê³  ë§Œë£Œ ì‹œê°„ì„ ì •ì˜í•˜ì—¬ ì„¸ë¶„í™”ëœ ì œì–´ë¥¼ í—ˆìš©í•©ë‹ˆë‹¤.

#### SAS ìœ í˜•

* **ì‚¬ìš©ì ìœ„ì„ SAS**: ì´ëŠ” **Entra ID ì£¼ì²´**ì—ì„œ ìƒì„±ë˜ë©°, SASì— ì„œëª…í•˜ê³  ì‚¬ìš©ìë¡œë¶€í„° SASë¡œ ê¶Œí•œì„ ìœ„ì„í•©ë‹ˆë‹¤. **Blob ë° ë°ì´í„° ë ˆì´í¬ ìŠ¤í† ë¦¬ì§€**ì™€ í•¨ê»˜ ì‚¬ìš©ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤ ([docs](https://learn.microsoft.com/en-us/rest/api/storageservices/create-user-delegation-sas)). ìƒì„±ëœ ëª¨ë“  ì‚¬ìš©ì ìœ„ì„ SASë¥¼ **ì² íšŒ**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
* ì‚¬ìš©ìê°€ ê°€ì§„ ê²ƒë³´ë‹¤ "ë” ë§ì€" ê¶Œí•œìœ¼ë¡œ ìœ„ì„ SASë¥¼ ìƒì„±í•˜ëŠ” ê²ƒì´ ê°€ëŠ¥í•˜ì§€ë§Œ, ì£¼ì²´ê°€ í•´ë‹¹ ê¶Œí•œì„ ê°€ì§€ì§€ ì•Šìœ¼ë©´ ì‘ë™í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤(ê¶Œí•œ ìƒìŠ¹ ì—†ìŒ).
* **ì„œë¹„ìŠ¤ SAS**: ì´ëŠ” ìŠ¤í† ë¦¬ì§€ ê³„ì •ì˜ **ì•¡ì„¸ìŠ¤ í‚¤** ì¤‘ í•˜ë‚˜ë¥¼ ì‚¬ìš©í•˜ì—¬ ì„œëª…ë©ë‹ˆë‹¤. ë‹¨ì¼ ìŠ¤í† ë¦¬ì§€ ì„œë¹„ìŠ¤ì˜ íŠ¹ì • ë¦¬ì†ŒìŠ¤ì— ëŒ€í•œ ì•¡ì„¸ìŠ¤ë¥¼ ë¶€ì—¬í•˜ëŠ” ë° ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. í‚¤ê°€ ê°±ì‹ ë˜ë©´ SASëŠ” ì‘ë™ì„ ë©ˆì¶¥ë‹ˆë‹¤.
* **ê³„ì • SAS**: ì´ëŠ” ìŠ¤í† ë¦¬ì§€ ê³„ì •ì˜ **ì•¡ì„¸ìŠ¤ í‚¤** ì¤‘ í•˜ë‚˜ë¡œ ì„œëª…ë©ë‹ˆë‹¤. ìŠ¤í† ë¦¬ì§€ ê³„ì • ì„œë¹„ìŠ¤(Blob, Queue, Table, File) ì „ë°˜ì— ê±¸ì³ ë¦¬ì†ŒìŠ¤ì— ëŒ€í•œ ì•¡ì„¸ìŠ¤ë¥¼ ë¶€ì—¬í•˜ë©° ì„œë¹„ìŠ¤ ìˆ˜ì¤€ ì‘ì—…ì„ í¬í•¨í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì•¡ì„¸ìŠ¤ í‚¤ë¡œ ì„œëª…ëœ SAS URLì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤:

* `https://<container_name>.blob.core.windows.net/newcontainer?sp=r&st=2021-09-26T18:15:21Z&se=2021-10-27T02:14:21Z&spr=https&sv=2021-07-08&sr=c&sig=7S%2BZySOgy4aA3Dk0V1cJyTSIf1cW%2Fu3WFkhHV32%2B4PE%3D`

ì‚¬ìš©ì ìœ„ì„ìœ¼ë¡œ ì„œëª…ëœ SAS URLì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤:

* `https://<container_name>.blob.core.windows.net/testing-container?sp=r&st=2024-11-22T15:07:40Z&se=2024-11-22T23:07:40Z&skoid=d77c71a1-96e7-483d-bd51-bd753aa66e62&sktid=fdd066e1-ee37-49bc-b08f-d0e152119b04&skt=2024-11-22T15:07:40Z&ske=2024-11-22T23:07:40Z&sks=b&skv=2022-11-02&spr=https&sv=2022-11-02&sr=c&sig=7s5dJyeE6klUNRulUj9TNL0tMj2K7mtxyRc97xbYDqs%3D`

ì¼ë¶€ **http ë§¤ê°œë³€ìˆ˜**ë¥¼ ì£¼ëª©í•˜ì‹­ì‹œì˜¤:

* **`se`** ë§¤ê°œë³€ìˆ˜ëŠ” SASì˜ **ë§Œë£Œ ë‚ ì§œ**ë¥¼ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤.
* **`sp`** ë§¤ê°œë³€ìˆ˜ëŠ” SASì˜ **ê¶Œí•œ**ì„ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤.
* **`sig`**ëŠ” SASë¥¼ ê²€ì¦í•˜ëŠ” **ì„œëª…**ì…ë‹ˆë‹¤.

#### SAS ê¶Œí•œ

SASë¥¼ ìƒì„±í•  ë•Œ ë¶€ì—¬í•´ì•¼ í•  ê¶Œí•œì„ ì§€ì •í•´ì•¼ í•©ë‹ˆë‹¤. SASê°€ ìƒì„±ë˜ëŠ” ê°ì²´ì— ë”°ë¼ í¬í•¨ë  ìˆ˜ ìˆëŠ” ë‹¤ì–‘í•œ ê¶Œí•œì´ ìˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´:

* (a)dd, (c)reate, (d)elete, (e)xecute, (f)ilter\_by\_tags, (i)set\_immutability\_policy, (l)ist, (m)ove, (r)ead, (t)ag, (w)rite, (x)delete\_previous\_version, (y)permanent\_delete

## ì—´ê±°

{% tabs %}
{% tab title="az cli" %}
{% code overflow="wrap" %}
```bash
# Get storage accounts
az storage account list #Get the account name from here

# BLOB STORAGE
## List containers
az storage container list --account-name <name>
## Check if public access is allowed
az storage container show-permission \
--account-name <acc-name> \
-n <container-name>
## Make a container public
az storage container set-permission \
--public-access container \
--account-name <acc-name> \
-n <container-name>
## List blobs in a container
az storage blob list \
--container-name <container name> \
--account-name <account name>
## Download blob
az storage blob download \
--account-name <account name> \
--container-name <container name> \
--name <blob name> \
--file </path/to/local/file>
## Create container policy
az storage container policy create \
--account-name mystorageaccount \
--container-name mycontainer \
--name fullaccesspolicy \
--permissions racwdl \
--start 2023-11-22T00:00Z \
--expiry 2024-11-22T00:00Z

# QUEUE
az storage queue list --account-name <name>
az storage message peek --account-name <name> --queue-name <queue-name>

# TABLES
az storage table list --account-name <name>

# ACCESS KEYS
az storage account keys list --account-name <name>
## Check key policies (expiration time?)
az storage account show -n <name> --query "{KeyPolicy:keyPolicy}"
## Once having the key, it's possible to use it with the argument --account-key
## Enum blobs with account key
az storage blob list \
--container-name <container name> \
--account-name <account name> \
--account-key "ZrF40pkVKvWPUr[...]v7LZw=="
## Download a file using an account key
az storage blob download \
--account-name <account name> \
--account-key "ZrF40pkVKvWPUr[...]v7LZw==" \
--container-name <container name> \
--name <blob name> \
--file </path/to/local/file>
## Upload a file using an account key
az storage blob upload \
--account-name <account name> \
--account-key "ZrF40pkVKvWPUr[...]v7LZw==" \
--container-name <container name> \
--file </path/to/local/file>

# SAS
## List access policies
az storage <container|queue|share|table> policy list \
--account-name <acc name> \
--container-name <container name>

## Generate SAS with all permissions using an access key
az storage <container|queue|share|table|blob> generate-sas \
--permissions acdefilmrtwxy \
--expiry 2024-12-31T23:59:00Z \
--account-name <acc-name> \
-n <container-name>

## Generate SAS with all permissions using via user delegation
az storage <container|queue|share|table|blob> generate-sas \
--permissions acdefilmrtwxy \
--expiry 2024-12-31T23:59:00Z \
--account-name <acc-name> \
--as-user --auth-mode login \
-n <container-name>

## Generate account SAS
az storage account generate-sas \
--expiry 2024-12-31T23:59:00Z \
--account-name <acc-name>  \
--services qt \
--resource-types sco \
--permissions acdfilrtuwxy

## Use the returned SAS key with the param --sas-token
## e.g.
az storage blob show \
--account-name <account name> \
--container-name <container name> \
--sas-token 'se=2024-12-31T23%3A59%3A00Z&sp=racwdxyltfmei&sv=2022-11-02&sr=c&sig=ym%2Bu%2BQp5qqrPotIK5/rrm7EMMxZRwF/hMWLfK1VWy6E%3D' \
--name 'asd.txt'
```
{% endcode %}
{% endtab %}

{% tab title="Az PowerShell" %}
{% code overflow="wrap" %}
```powershell
# Get storage accounts
Get-AzStorageAccount | fl
# Get rules to access the storage account
Get-AzStorageAccount | select -ExpandProperty NetworkRuleSet
# Get IPs
(Get-AzStorageAccount | select -ExpandProperty NetworkRuleSet).IPRules
# Get containers of a storage account
Get-AzStorageContainer -Context (Get-AzStorageAccount -name <NAME> -ResourceGroupName <NAME>).context
# Get blobs inside container
Get-AzStorageBlob -Container epbackup-planetary -Context (Get-AzStorageAccount -name <name> -ResourceGroupName <name>).context
# Get a blob from a container
Get-AzStorageBlobContent -Container <NAME> -Context (Get-AzStorageAccount -name <NAME> -ResourceGroupName <NAME>).context -Blob <blob_name> -Destination .\Desktop\filename.txt
```
{% endcode %}
{% endtab %}
{% endtabs %}

### íŒŒì¼ ê³µìœ 

{% content-ref url="az-file-shares.md" %}
[az-file-shares.md](az-file-shares.md)
{% endcontent-ref %}

## ê¶Œí•œ ìƒìŠ¹

{% content-ref url="../az-privilege-escalation/az-storage-privesc.md" %}
[az-storage-privesc.md](../az-privilege-escalation/az-storage-privesc.md)
{% endcontent-ref %}

## í¬ìŠ¤íŠ¸ ìµìŠ¤í”Œë¡œì‡

{% content-ref url="../az-post-exploitation/az-blob-storage-post-exploitation.md" %}
[az-blob-storage-post-exploitation.md](../az-post-exploitation/az-blob-storage-post-exploitation.md)
{% endcontent-ref %}

## ì§€ì†ì„±

{% content-ref url="../az-persistence/az-storage-persistence.md" %}
[az-storage-persistence.md](../az-persistence/az-storage-persistence.md)
{% endcontent-ref %}

## ì°¸ê³ ìë£Œ

* [https://learn.microsoft.com/en-us/azure/storage/blobs/storage-blobs-introduction](https://learn.microsoft.com/en-us/azure/storage/blobs/storage-blobs-introduction)
* [https://learn.microsoft.com/en-us/azure/storage/common/storage-sas-overview](https://learn.microsoft.com/en-us/azure/storage/common/storage-sas-overview)

{% hint style="success" %}
AWS í•´í‚¹ ë°°ìš°ê¸° ë° ì—°ìŠµí•˜ê¸°:<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
GCP í•´í‚¹ ë°°ìš°ê¸° ë° ì—°ìŠµí•˜ê¸°: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks ì§€ì›í•˜ê¸°</summary>

* [**êµ¬ë… ê³„íš**](https://github.com/sponsors/carlospolop) í™•ì¸í•˜ê¸°!
* **ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— ì°¸ì—¬í•˜ê±°ë‚˜ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**ë¥¼ íŒ”ë¡œìš°í•˜ì„¸ìš”.**
* **[**HackTricks**](https://github.com/carlospolop/hacktricks) ë° [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) ê¹ƒí—ˆë¸Œ ë¦¬í¬ì§€í† ë¦¬ì— PRì„ ì œì¶œí•˜ì—¬ í•´í‚¹ íŒì„ ê³µìœ í•˜ì„¸ìš”.**

</details>
{% endhint %}
