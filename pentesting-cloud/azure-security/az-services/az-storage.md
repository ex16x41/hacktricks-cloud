# Az - ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã¨Blob

{% hint style="success" %}
AWSãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã³ã€å®Ÿè·µã™ã‚‹ï¼š<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
GCPãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã³ã€å®Ÿè·µã™ã‚‹ï¼š<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricksã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹</summary>

* [**ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³**](https://github.com/sponsors/carlospolop)ã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼
* **ğŸ’¬ [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã¾ãŸã¯[**Telegramã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«å‚åŠ ã™ã‚‹ã‹ã€**Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**ã‚’ãƒ•ã‚©ãƒ­ãƒ¼ã—ã¦ãã ã•ã„ã€‚**
* **ãƒãƒƒã‚­ãƒ³ã‚°ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã™ã‚‹ã«ã¯ã€[**HackTricks**](https://github.com/carlospolop/hacktricks)ãŠã‚ˆã³[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)ã®GitHubãƒªãƒã‚¸ãƒˆãƒªã«PRã‚’æå‡ºã—ã¦ãã ã•ã„ã€‚**

</details>
{% endhint %}

## åŸºæœ¬æƒ…å ±

Azureã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã¯ã€Microsoft Azureã®åŸºæœ¬çš„ãªã‚µãƒ¼ãƒ“ã‚¹ã§ã‚ã‚Šã€ã‚¹ã‚±ãƒ¼ãƒ©ãƒ–ãƒ«ã§å®‰å…¨ã‹ã¤é«˜å¯ç”¨æ€§ã®ã‚¯ãƒ©ã‚¦ãƒ‰**ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚’ã•ã¾ã–ã¾ãªãƒ‡ãƒ¼ã‚¿ã‚¿ã‚¤ãƒ—**ï¼ˆBlobï¼ˆãƒã‚¤ãƒŠãƒªå¤§ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆï¼‰ã€ãƒ•ã‚¡ã‚¤ãƒ«ã€ã‚­ãƒ¥ãƒ¼ã€ãƒ†ãƒ¼ãƒ–ãƒ«ãªã©ï¼‰ã«æä¾›ã—ã¾ã™ã€‚ã“ã‚Œã‚‰ã¯ã€ç•°ãªã‚‹ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚µãƒ¼ãƒ“ã‚¹ã‚’å˜ä¸€ã®åå‰ç©ºé–“ã®ä¸‹ã§ç°¡å˜ã«ç®¡ç†ã§ãã‚‹ã‚ˆã†ã«ã‚°ãƒ«ãƒ¼ãƒ—åŒ–ã™ã‚‹ã‚³ãƒ³ãƒ†ãƒŠã¨ã—ã¦æ©Ÿèƒ½ã—ã¾ã™ã€‚

**ä¸»ãªæ§‹æˆã‚ªãƒ—ã‚·ãƒ§ãƒ³**ï¼š

* ã™ã¹ã¦ã®ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã¯ã€**Azureå…¨ä½“ã§ä¸€æ„ã®åå‰**ã‚’æŒã¤å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
* ã™ã¹ã¦ã®ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã¯ã€**ãƒªãƒ¼ã‚¸ãƒ§ãƒ³**ã¾ãŸã¯Azureæ‹¡å¼µã‚¾ãƒ¼ãƒ³ã«ãƒ‡ãƒ—ãƒ­ã‚¤ã•ã‚Œã¾ã™ã€‚
* ã‚ˆã‚Šè‰¯ã„ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã®ãŸã‚ã«ã€ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®**ãƒ—ãƒ¬ãƒŸã‚¢ãƒ **ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’é¸æŠã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
* ãƒ©ãƒƒã‚¯ã€ãƒ‰ãƒ©ã‚¤ãƒ–ã€ãƒ‡ãƒ¼ã‚¿ã‚»ãƒ³ã‚¿ãƒ¼ã®**éšœå®³**ã‹ã‚‰ä¿è­·ã™ã‚‹ãŸã‚ã«ã€**4ç¨®é¡ã®å†—é•·æ€§ã‚’é¸æŠ**ã§ãã¾ã™ã€‚

**ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ§‹æˆã‚ªãƒ—ã‚·ãƒ§ãƒ³**ï¼š

* **REST APIæ“ä½œã®ãŸã‚ã«å®‰å…¨ãªè»¢é€ã‚’è¦æ±‚**ï¼šã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã¨ã®é€šä¿¡ã«TLSã‚’è¦æ±‚ã—ã¾ã™ã€‚
* **å€‹ã€…ã®ã‚³ãƒ³ãƒ†ãƒŠã§ã®åŒ¿åã‚¢ã‚¯ã‚»ã‚¹ã‚’æœ‰åŠ¹ã«ã™ã‚‹ã“ã¨ã‚’è¨±å¯**ï¼šãã†ã§ãªã„å ´åˆã€å°†æ¥çš„ã«åŒ¿åã‚¢ã‚¯ã‚»ã‚¹ã‚’æœ‰åŠ¹ã«ã™ã‚‹ã“ã¨ã¯ã§ãã¾ã›ã‚“ã€‚
* **ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚­ãƒ¼ã‚¢ã‚¯ã‚»ã‚¹ã‚’æœ‰åŠ¹ã«ã™ã‚‹**ï¼šãã†ã§ãªã„å ´åˆã€å…±æœ‰ã‚­ãƒ¼ã«ã‚ˆã‚‹ã‚¢ã‚¯ã‚»ã‚¹ã¯ç¦ã˜ã‚‰ã‚Œã¾ã™ã€‚
* **æœ€å°TLSãƒãƒ¼ã‚¸ãƒ§ãƒ³**
* **ã‚³ãƒ”ãƒ¼æ“ä½œã®ãŸã‚ã®è¨±å¯ã•ã‚ŒãŸã‚¹ã‚³ãƒ¼ãƒ—**ï¼šä»»æ„ã®ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã€åŒã˜Entraãƒ†ãƒŠãƒ³ãƒˆã®ä»»æ„ã®ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã€ã¾ãŸã¯åŒã˜ä»®æƒ³ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯å†…ã®ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’æŒã¤ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‹ã‚‰ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’è¨±å¯ã—ã¾ã™ã€‚

**Blobã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚ªãƒ—ã‚·ãƒ§ãƒ³**ï¼š

* **ã‚¯ãƒ­ã‚¹ãƒ†ãƒŠãƒ³ãƒˆãƒ¬ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è¨±å¯**
* **ã‚¢ã‚¯ã‚»ã‚¹å±¤**ï¼šãƒ›ãƒƒãƒˆï¼ˆé »ç¹ã«ã‚¢ã‚¯ã‚»ã‚¹ã•ã‚Œã‚‹ãƒ‡ãƒ¼ã‚¿ï¼‰ã€ã‚¯ãƒ¼ãƒ«ã€ã‚³ãƒ¼ãƒ«ãƒ‰ï¼ˆã¾ã‚Œã«ã‚¢ã‚¯ã‚»ã‚¹ã•ã‚Œã‚‹ãƒ‡ãƒ¼ã‚¿ï¼‰

**ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚ªãƒ—ã‚·ãƒ§ãƒ³**ï¼š

* **ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¢ã‚¯ã‚»ã‚¹**ï¼š
* ã™ã¹ã¦ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‹ã‚‰è¨±å¯
* é¸æŠã—ãŸä»®æƒ³ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã¨IPã‚¢ãƒ‰ãƒ¬ã‚¹ã‹ã‚‰è¨±å¯
* å…¬é–‹ã‚¢ã‚¯ã‚»ã‚¹ã‚’ç„¡åŠ¹ã«ã—ã€ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆã‚¢ã‚¯ã‚»ã‚¹ã‚’ä½¿ç”¨
* **ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ**ï¼šä»®æƒ³ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‹ã‚‰ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã¸ã®ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆæ¥ç¶šã‚’è¨±å¯ã—ã¾ã™ã€‚

**ãƒ‡ãƒ¼ã‚¿ä¿è­·ã‚ªãƒ—ã‚·ãƒ§ãƒ³**ï¼š

* **ã‚³ãƒ³ãƒ†ãƒŠã®ãƒã‚¤ãƒ³ãƒˆã‚¤ãƒ³ã‚¿ã‚¤ãƒ ãƒªã‚¹ãƒˆã‚¢**ï¼šã‚³ãƒ³ãƒ†ãƒŠã‚’ä»¥å‰ã®çŠ¶æ…‹ã«å¾©å…ƒã™ã‚‹ã“ã¨ã‚’è¨±å¯ã—ã¾ã™ã€‚
* ãƒãƒ¼ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°ã€å¤‰æ›´ãƒ•ã‚£ãƒ¼ãƒ‰ã€Blobã‚½ãƒ•ãƒˆå‰Šé™¤ã‚’æœ‰åŠ¹ã«ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
* **Blobã®ã‚½ãƒ•ãƒˆå‰Šé™¤ã‚’æœ‰åŠ¹ã«ã™ã‚‹**ï¼šå‰Šé™¤ã•ã‚ŒãŸBlobï¼ˆä¸Šæ›¸ãã•ã‚ŒãŸã‚‚ã®ã‚‚å«ã‚€ï¼‰ã«å¯¾ã—ã¦æ—¥æ•°ã®ä¿æŒæœŸé–“ã‚’æœ‰åŠ¹ã«ã—ã¾ã™ã€‚
* **ã‚³ãƒ³ãƒ†ãƒŠã®ã‚½ãƒ•ãƒˆå‰Šé™¤ã‚’æœ‰åŠ¹ã«ã™ã‚‹**ï¼šå‰Šé™¤ã•ã‚ŒãŸã‚³ãƒ³ãƒ†ãƒŠã«å¯¾ã—ã¦æ—¥æ•°ã®ä¿æŒæœŸé–“ã‚’æœ‰åŠ¹ã«ã—ã¾ã™ã€‚
* **ãƒ•ã‚¡ã‚¤ãƒ«å…±æœ‰ã®ã‚½ãƒ•ãƒˆå‰Šé™¤ã‚’æœ‰åŠ¹ã«ã™ã‚‹**ï¼šå‰Šé™¤ã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«å…±æœ‰ã«å¯¾ã—ã¦æ—¥æ•°ã®ä¿æŒæœŸé–“ã‚’æœ‰åŠ¹ã«ã—ã¾ã™ã€‚
* **Blobã®ãƒãƒ¼ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°ã‚’æœ‰åŠ¹ã«ã™ã‚‹**ï¼šBlobã®ä»¥å‰ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ä¿æŒã—ã¾ã™ã€‚
* **Blobå¤‰æ›´ãƒ•ã‚£ãƒ¼ãƒ‰ã‚’æœ‰åŠ¹ã«ã™ã‚‹**ï¼šBlobã®ä½œæˆã€å¤‰æ›´ã€å‰Šé™¤ã®å¤‰æ›´ã‚’ãƒ­ã‚°ã«ä¿æŒã—ã¾ã™ã€‚
* **ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãƒ¬ãƒ™ãƒ«ã®ä¸å¤‰æ€§ã‚µãƒãƒ¼ãƒˆã‚’æœ‰åŠ¹ã«ã™ã‚‹**ï¼šã™ã¹ã¦ã®Blobãƒãƒ¼ã‚¸ãƒ§ãƒ³ã«é©ç”¨ã•ã‚Œã‚‹æ™‚é–“ãƒ™ãƒ¼ã‚¹ã®ä¿æŒãƒãƒªã‚·ãƒ¼ã‚’ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãƒ¬ãƒ™ãƒ«ã§è¨­å®šã§ãã¾ã™ã€‚
* ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãƒ¬ãƒ™ãƒ«ã®ä¸å¤‰æ€§ã‚µãƒãƒ¼ãƒˆã¨ã‚³ãƒ³ãƒ†ãƒŠã®ãƒã‚¤ãƒ³ãƒˆã‚¤ãƒ³ã‚¿ã‚¤ãƒ ãƒªã‚¹ãƒˆã‚¢ã¯åŒæ™‚ã«æœ‰åŠ¹ã«ã™ã‚‹ã“ã¨ã¯ã§ãã¾ã›ã‚“ã€‚

**æš—å·åŒ–æ§‹æˆã‚ªãƒ—ã‚·ãƒ§ãƒ³**ï¼š

* **æš—å·åŒ–ã‚¿ã‚¤ãƒ—**ï¼šMicrosoftç®¡ç†ã‚­ãƒ¼ï¼ˆMMKï¼‰ã¾ãŸã¯é¡§å®¢ç®¡ç†ã‚­ãƒ¼ï¼ˆCMKï¼‰ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
* **ã‚¤ãƒ³ãƒ•ãƒ©ã‚¹ãƒˆãƒ©ã‚¯ãƒãƒ£æš—å·åŒ–ã‚’æœ‰åŠ¹ã«ã™ã‚‹**ï¼šãƒ‡ãƒ¼ã‚¿ã‚’ã€Œã‚ˆã‚Šå®‰å…¨ã«ã€äºŒé‡æš—å·åŒ–ã™ã‚‹ã“ã¨ã‚’è¨±å¯ã—ã¾ã™ã€‚

### ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ

<table data-header-hidden><thead><tr><th width="197">ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚µãƒ¼ãƒ“ã‚¹</th><th>ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ</th></tr></thead><tbody><tr><td><strong>Blobã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸</strong></td><td><code>https://&#x3C;storage-account>.blob.core.windows.net</code><br><br><code>https://&#x3C;stg-acc>.blob.core.windows.net/&#x3C;container-name>?restype=container&#x26;comp=list</code></td></tr><tr><td><strong>ãƒ‡ãƒ¼ã‚¿ãƒ¬ã‚¤ã‚¯ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸</strong></td><td><code>https://&#x3C;storage-account>.dfs.core.windows.net</code></td></tr><tr><td><strong>Azureãƒ•ã‚¡ã‚¤ãƒ«</strong></td><td><code>https://&#x3C;storage-account>.file.core.windows.net</code></td></tr><tr><td><strong>ã‚­ãƒ¥ãƒ¼ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸</strong></td><td><code>https://&#x3C;storage-account>.queue.core.windows.net</code></td></tr><tr><td><strong>ãƒ†ãƒ¼ãƒ–ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸</strong></td><td><code>https://&#x3C;storage-account>.table.core.windows.net</code></td></tr></tbody></table>

### å…¬é–‹éœ²å‡º

ã€ŒBlobã®å…¬é–‹ã‚¢ã‚¯ã‚»ã‚¹ã‚’è¨±å¯ã€ãŒ**æœ‰åŠ¹**ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯ç„¡åŠ¹ï¼‰ã«ãªã£ã¦ã„ã‚‹å ´åˆã€ã‚³ãƒ³ãƒ†ãƒŠã‚’ä½œæˆã™ã‚‹éš›ã«æ¬¡ã®ã“ã¨ãŒå¯èƒ½ã§ã™ï¼š

* **Blobã‚’èª­ã‚€ãŸã‚ã®å…¬é–‹ã‚¢ã‚¯ã‚»ã‚¹ã‚’æä¾›**ï¼ˆåå‰ã‚’çŸ¥ã£ã¦ã„ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ï¼‰ã€‚
* **ã‚³ãƒ³ãƒ†ãƒŠã®Blobã‚’ãƒªã‚¹ãƒˆã—ã€**ãã‚Œã‚‰ã‚’**èª­ã‚€**ã€‚
* å®Œå…¨ã«**ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆ**ã«ã™ã‚‹ã€‚

<figure><img src="https://lh7-rt.googleusercontent.com/slidesz/AGV_vUfoetUnYBPWQpRrWNnnlbqWpl8Rdoaeg5uBrCVlvcNDlnKwQHjZe8nUb2SfPspBgbu-lCZLmUei-hFi_Jl2eKbaxUtBGTjdUSDmkrcwr90VZkmuMjk9tyh92p75btfyzGiUTa0-=s2048?key=m8TV59TrCFPlkiNnmhYx3aZt" alt=""><figcaption></figcaption></figure>

### ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã¸ã®æ¥ç¶š

æ¥ç¶šã§ãã‚‹**ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸**ã‚’è¦‹ã¤ã‘ãŸå ´åˆã€[**Microsoft Azure Storage Explorer**](https://azure.microsoft.com/es-es/products/storage/storage-explorer/)ãƒ„ãƒ¼ãƒ«ã‚’ä½¿ç”¨ã—ã¦æ¥ç¶šã§ãã¾ã™ã€‚

## ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ <a href="#about-blob-storage" id="about-blob-storage"></a>

### RBAC

ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ãŸã‚ã«ã€**RBACãƒ­ãƒ¼ãƒ«**ã‚’ä½¿ç”¨ã—ã¦Entra IDãƒ—ãƒªãƒ³ã‚·ãƒ‘ãƒ«ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã‚ã‚Šã€æ¨å¥¨ã•ã‚Œã‚‹æ–¹æ³•ã§ã™ã€‚

### ã‚¢ã‚¯ã‚»ã‚¹ã‚­ãƒ¼

ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã«ã¯ã€ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã§ãã‚‹ã‚¢ã‚¯ã‚»ã‚¹ã‚­ãƒ¼ãŒã‚ã‚Šã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã¸ã®**å®Œå…¨ãªã‚¢ã‚¯ã‚»ã‚¹**ãŒæä¾›ã•ã‚Œã¾ã™ã€‚

<figure><img src="../../../.gitbook/assets/image.png" alt=""><figcaption></figcaption></figure>

### **å…±æœ‰ã‚­ãƒ¼ã¨ãƒ©ã‚¤ãƒˆå…±æœ‰ã‚­ãƒ¼**

ç‰¹å®šã®ãƒªã‚½ãƒ¼ã‚¹ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’èªå¯ã™ã‚‹ãŸã‚ã«ã€ã‚¢ã‚¯ã‚»ã‚¹ã‚­ãƒ¼ã§ç½²åã•ã‚ŒãŸ[**å…±æœ‰ã‚­ãƒ¼ã‚’ç”Ÿæˆã™ã‚‹**](https://learn.microsoft.com/en-us/rest/api/storageservices/authorize-with-shared-key)ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚

{% hint style="info" %}
`CanonicalizedResource`éƒ¨åˆ†ã¯ã€ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚µãƒ¼ãƒ“ã‚¹ãƒªã‚½ãƒ¼ã‚¹ï¼ˆURIï¼‰ã‚’è¡¨ã—ã¾ã™ã€‚URLã®ä»»æ„ã®éƒ¨åˆ†ãŒã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã•ã‚Œã¦ã„ã‚‹å ´åˆã€`CanonicalizedResource`å†…ã§ã‚‚ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
{% endhint %}

{% hint style="info" %}
ã“ã‚Œã¯**ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§`az` cliã«ã‚ˆã£ã¦ä½¿ç”¨ã•ã‚Œ**ã€ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’èªè¨¼ã—ã¾ã™ã€‚Entra IDãƒ—ãƒªãƒ³ã‚·ãƒ‘ãƒ«ã®è³‡æ ¼æƒ…å ±ã‚’ä½¿ç”¨ã™ã‚‹ã«ã¯ã€ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿`--auth-mode login`ã‚’æŒ‡å®šã—ã¾ã™ã€‚
{% endhint %}

* **Blobã€ã‚­ãƒ¥ãƒ¼ã€ãƒ•ã‚¡ã‚¤ãƒ«ã‚µãƒ¼ãƒ“ã‚¹ã®ãŸã‚ã®å…±æœ‰ã‚­ãƒ¼ã‚’ç”Ÿæˆã™ã‚‹**ã“ã¨ãŒå¯èƒ½ã§ã€æ¬¡ã®æƒ…å ±ã«ç½²åã—ã¾ã™ï¼š
```bash
StringToSign = VERB + "\n" +
Content-Encoding + "\n" +
Content-Language + "\n" +
Content-Length + "\n" +
Content-MD5 + "\n" +
Content-Type + "\n" +
Date + "\n" +
If-Modified-Since + "\n" +
If-Match + "\n" +
If-None-Match + "\n" +
If-Unmodified-Since + "\n" +
Range + "\n" +
CanonicalizedHeaders +
CanonicalizedResource;
```
* ãƒ†ãƒ¼ãƒ–ãƒ«ã‚µãƒ¼ãƒ“ã‚¹ã®**å…±æœ‰ã‚­ãƒ¼**ã‚’ç”Ÿæˆã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚æ¬¡ã®æƒ…å ±ã‚’ç½²åã—ã¾ã™ï¼š
```bash
StringToSign = VERB + "\n" +
Content-MD5 + "\n" +
Content-Type + "\n" +
Date + "\n" +
CanonicalizedResource;
```
* **Blobã€ã‚­ãƒ¥ãƒ¼ã€ãŠã‚ˆã³ãƒ•ã‚¡ã‚¤ãƒ«ã‚µãƒ¼ãƒ“ã‚¹**ã®ãŸã‚ã®**ãƒ©ã‚¤ãƒˆå…±æœ‰ã‚­ãƒ¼**ã‚’ç”Ÿæˆã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã€ä»¥ä¸‹ã®æƒ…å ±ã«ç½²åã—ã¾ã™:
```bash
StringToSign = VERB + "\n" +
Content-MD5 + "\n" +
Content-Type + "\n" +
Date + "\n" +
CanonicalizedHeaders +
CanonicalizedResource;
```
* ãƒ†ãƒ¼ãƒ–ãƒ«ã‚µãƒ¼ãƒ“ã‚¹ã®ãŸã‚ã®**ãƒ©ã‚¤ãƒˆå…±æœ‰ã‚­ãƒ¼**ã‚’ç”Ÿæˆã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚æ¬¡ã®æƒ…å ±ã«ç½²åã—ã¾ã™ï¼š
```bash
StringToSign = Date + "\n"
CanonicalizedResource
```
æ¬¡ã«ã€ã‚­ãƒ¼ã‚’ä½¿ç”¨ã™ã‚‹ã«ã¯ã€æ¬¡ã®æ§‹æ–‡ã«å¾“ã£ã¦Authorizationãƒ˜ãƒƒãƒ€ãƒ¼ã«è¨˜è¿°ã§ãã¾ã™:
```bash
Authorization="[SharedKey|SharedKeyLite] <AccountName>:<Signature>"
#e.g.
Authorization: SharedKey myaccount:ctzMq410TV3wS7upTBcunJTDLEJwMAZuFPfr0mrrA08=

PUT http://myaccount/mycontainer?restype=container&timeout=30 HTTP/1.1
x-ms-version: 2014-02-14
x-ms-date: Fri, 26 Jun 2015 23:39:12 GMT
Authorization: SharedKey myaccount:ctzMq410TV3wS7upTBcunJTDLEJwMAZuFPfr0mrrA08=
Content-Length: 0
```
### **Shared Access Signature** (SAS)

Shared Access Signatures (SAS) ã¯ã€Azure Storage ã‚¢ã‚«ã‚¦ãƒ³ãƒˆå†…ã®ãƒªã‚½ãƒ¼ã‚¹ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ãŸã‚ã®ç‰¹å®šã®æ¨©é™ã‚’ä»˜ä¸ã™ã‚‹**å®‰å…¨ã§æ™‚é–“åˆ¶é™ã®ã‚ã‚‹ URL** ã§ã™ã€‚ã‚¢ã‚¯ã‚»ã‚¹ã‚­ãƒ¼ã¯ã™ã¹ã¦ã®ãƒªã‚½ãƒ¼ã‚¹ã¸ã®å®Œå…¨ãªç®¡ç†ã‚¢ã‚¯ã‚»ã‚¹ã‚’æä¾›ã—ã¾ã™ãŒã€SAS ã¯æ¨©é™ï¼ˆèª­ã¿å–ã‚Šã‚„æ›¸ãè¾¼ã¿ãªã©ï¼‰ã‚’æŒ‡å®šã—ã€æœŸé™ã‚’å®šç¾©ã™ã‚‹ã“ã¨ã§ç´°ã‹ã„åˆ¶å¾¡ã‚’å¯èƒ½ã«ã—ã¾ã™ã€‚

#### SAS ã‚¿ã‚¤ãƒ—

* **ãƒ¦ãƒ¼ã‚¶ãƒ¼å§”ä»» SAS**: ã“ã‚Œã¯ **Entra ID ãƒ—ãƒªãƒ³ã‚·ãƒ‘ãƒ«** ã‹ã‚‰ä½œæˆã•ã‚Œã€SAS ã«ç½²åã—ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‹ã‚‰ SAS ã¸ã®æ¨©é™ã‚’å§”ä»»ã—ã¾ã™ã€‚ã“ã‚Œã¯ **blob ãŠã‚ˆã³ãƒ‡ãƒ¼ã‚¿ãƒ¬ã‚¤ã‚¯ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸** ã§ã®ã¿ä½¿ç”¨ã§ãã¾ã™ ([docs](https://learn.microsoft.com/en-us/rest/api/storageservices/create-user-delegation-sas))ã€‚ç”Ÿæˆã•ã‚ŒãŸã™ã¹ã¦ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼å§”ä»» SAS ã‚’ **å–ã‚Šæ¶ˆã™** ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚
* ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæŒã£ã¦ã„ã‚‹æ¨©é™ã‚ˆã‚Šã‚‚ã€Œå¤šãã®ã€æ¨©é™ã‚’æŒã¤å§”ä»» SAS ã‚’ç”Ÿæˆã™ã‚‹ã“ã¨ã¯å¯èƒ½ã§ã™ãŒã€ãƒ—ãƒªãƒ³ã‚·ãƒ‘ãƒ«ãŒãã‚Œã‚‰ã®æ¨©é™ã‚’æŒã£ã¦ã„ãªã„å ´åˆã¯æ©Ÿèƒ½ã—ã¾ã›ã‚“ï¼ˆæ¨©é™æ˜‡æ ¼ã¯ã‚ã‚Šã¾ã›ã‚“ï¼‰ã€‚
* **ã‚µãƒ¼ãƒ“ã‚¹ SAS**: ã“ã‚Œã¯ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã® **ã‚¢ã‚¯ã‚»ã‚¹ã‚­ãƒ¼** ã®ã„ãšã‚Œã‹ã‚’ä½¿ç”¨ã—ã¦ç½²åã•ã‚Œã¾ã™ã€‚ç‰¹å®šã®ãƒªã‚½ãƒ¼ã‚¹ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’å˜ä¸€ã®ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚µãƒ¼ãƒ“ã‚¹ã«ä»˜ä¸ã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã§ãã¾ã™ã€‚ã‚­ãƒ¼ãŒæ›´æ–°ã•ã‚Œã‚‹ã¨ã€SAS ã¯æ©Ÿèƒ½ã—ãªããªã‚Šã¾ã™ã€‚
* **ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ SAS**: ã“ã‚Œã‚‚ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã® **ã‚¢ã‚¯ã‚»ã‚¹ã‚­ãƒ¼** ã®ã„ãšã‚Œã‹ã§ç½²åã•ã‚Œã¾ã™ã€‚ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚µãƒ¼ãƒ“ã‚¹ï¼ˆBlobã€Queueã€Tableã€Fileï¼‰å…¨ä½“ã®ãƒªã‚½ãƒ¼ã‚¹ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’ä»˜ä¸ã—ã€ã‚µãƒ¼ãƒ“ã‚¹ãƒ¬ãƒ™ãƒ«ã®æ“ä½œã‚’å«ã‚€ã“ã¨ãŒã§ãã¾ã™ã€‚

**ã‚¢ã‚¯ã‚»ã‚¹ã‚­ãƒ¼** ã§ç½²åã•ã‚ŒãŸ SAS URL ã¯æ¬¡ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ï¼š

* `https://<container_name>.blob.core.windows.net/newcontainer?sp=r&st=2021-09-26T18:15:21Z&se=2021-10-27T02:14:21Z&spr=https&sv=2021-07-08&sr=c&sig=7S%2BZySOgy4aA3Dk0V1cJyTSIf1cW%2Fu3WFkhHV32%2B4PE%3D`

**ãƒ¦ãƒ¼ã‚¶ãƒ¼å§”ä»»** ã¨ã—ã¦ç½²åã•ã‚ŒãŸ SAS URL ã¯æ¬¡ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ï¼š

* `https://<container_name>.blob.core.windows.net/testing-container?sp=r&st=2024-11-22T15:07:40Z&se=2024-11-22T23:07:40Z&skoid=d77c71a1-96e7-483d-bd51-bd753aa66e62&sktid=fdd066e1-ee37-49bc-b08f-d0e152119b04&skt=2024-11-22T15:07:40Z&ske=2024-11-22T23:07:40Z&sks=b&skv=2022-11-02&spr=https&sv=2022-11-02&sr=c&sig=7s5dJyeE6klUNRulUj9TNL0tMj2K7mtxyRc97xbYDqs%3D`

ã„ãã¤ã‹ã® **http ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿** ã«æ³¨æ„ã—ã¦ãã ã•ã„ï¼š

* **`se`** ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¯ SAS ã® **æœ‰åŠ¹æœŸé™** ã‚’ç¤ºã—ã¾ã™
* **`sp`** ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¯ SAS ã® **æ¨©é™** ã‚’ç¤ºã—ã¾ã™
* **`sig`** ã¯ SAS ã‚’æ¤œè¨¼ã™ã‚‹ãŸã‚ã® **ç½²å** ã§ã™

#### SAS æ¨©é™

SAS ã‚’ç”Ÿæˆã™ã‚‹éš›ã«ã¯ã€ä»˜ä¸ã™ã¹ãæ¨©é™ã‚’ç¤ºã™å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚SAS ãŒç”Ÿæˆã•ã‚Œã‚‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«ã‚ˆã£ã¦ã€ç•°ãªã‚‹æ¨©é™ãŒå«ã¾ã‚Œã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚ä¾‹ãˆã°ï¼š

* (a)dd, (c)reate, (d)elete, (e)xecute, (f)ilter\_by\_tags, (i)set\_immutability\_policy, (l)ist, (m)ove, (r)ead, (t)ag, (w)rite, (x)delete\_previous\_version, (y)permanent\_delete

## Enumeration

{% tabs %}
{% tab title="az cli" %}
{% code overflow="wrap" %}
```bash
# Get storage accounts
az storage account list #Get the account name from here

# BLOB STORAGE
## List containers
az storage container list --account-name <name>
## Check if public access is allowed
az storage container show-permission \
--account-name <acc-name> \
-n <container-name>
## Make a container public
az storage container set-permission \
--public-access container \
--account-name <acc-name> \
-n <container-name>
## List blobs in a container
az storage blob list \
--container-name <container name> \
--account-name <account name>
## Download blob
az storage blob download \
--account-name <account name> \
--container-name <container name> \
--name <blob name> \
--file </path/to/local/file>
## Create container policy
az storage container policy create \
--account-name mystorageaccount \
--container-name mycontainer \
--name fullaccesspolicy \
--permissions racwdl \
--start 2023-11-22T00:00Z \
--expiry 2024-11-22T00:00Z

# QUEUE
az storage queue list --account-name <name>
az storage message peek --account-name <name> --queue-name <queue-name>

# ACCESS KEYS
az storage account keys list --account-name <name>
## Check key policies (expiration time?)
az storage account show -n <name> --query "{KeyPolicy:keyPolicy}"
## Once having the key, it's possible to use it with the argument --account-key
## Enum blobs with account key
az storage blob list \
--container-name <container name> \
--account-name <account name> \
--account-key "ZrF40pkVKvWPUr[...]v7LZw=="
## Download a file using an account key
az storage blob download \
--account-name <account name> \
--account-key "ZrF40pkVKvWPUr[...]v7LZw==" \
--container-name <container name> \
--name <blob name> \
--file </path/to/local/file>
## Upload a file using an account key
az storage blob upload \
--account-name <account name> \
--account-key "ZrF40pkVKvWPUr[...]v7LZw==" \
--container-name <container name> \
--file </path/to/local/file>

# SAS
## List access policies
az storage <container|queue|share|table> policy list \
--account-name <acc name> \
--container-name <container name>

## Generate SAS with all permissions using an access key
az storage <container|queue|share|table|blob> generate-sas \
--permissions acdefilmrtwxy \
--expiry 2024-12-31T23:59:00Z \
--account-name <acc-name> \
-n <container-name>

## Generate SAS with all permissions using via user delegation
az storage <container|queue|share|table|blob> generate-sas \
--permissions acdefilmrtwxy \
--expiry 2024-12-31T23:59:00Z \
--account-name <acc-name> \
--as-user --auth-mode login \
-n <container-name>

## Generate account SAS
az storage account generate-sas \
--expiry 2024-12-31T23:59:00Z \
--account-name <acc-name>  \
--services qt \
--resource-types sco \
--permissions acdfilrtuwxy

## Use the returned SAS key with the param --sas-token
## e.g.
az storage blob show \
--account-name <account name> \
--container-name <container name> \
--sas-token 'se=2024-12-31T23%3A59%3A00Z&sp=racwdxyltfmei&sv=2022-11-02&sr=c&sig=ym%2Bu%2BQp5qqrPotIK5/rrm7EMMxZRwF/hMWLfK1VWy6E%3D' \
--name 'asd.txt'
```
{% endcode %}
{% endtab %}

{% tab title="Az PowerShell" %}
{% code overflow="wrap" %}
```powershell
# Get storage accounts
Get-AzStorageAccount | fl
# Get rules to access the storage account
Get-AzStorageAccount | select -ExpandProperty NetworkRuleSet
# Get IPs
(Get-AzStorageAccount | select -ExpandProperty NetworkRuleSet).IPRules
# Get containers of a storage account
Get-AzStorageContainer -Context (Get-AzStorageAccount -name <NAME> -ResourceGroupName <NAME>).context
# Get blobs inside container
Get-AzStorageBlob -Container epbackup-planetary -Context (Get-AzStorageAccount -name <name> -ResourceGroupName <name>).context
# Get a blob from a container
Get-AzStorageBlobContent -Container <NAME> -Context (Get-AzStorageAccount -name <NAME> -ResourceGroupName <NAME>).context -Blob <blob_name> -Destination .\Desktop\filename.txt
```
{% endcode %}
{% endtab %}
{% endtabs %}

### ãƒ•ã‚¡ã‚¤ãƒ«å…±æœ‰

{% content-ref url="az-file-shares.md" %}
[az-file-shares.md](az-file-shares.md)
{% endcontent-ref %}

## æ¨©é™æ˜‡æ ¼

{% content-ref url="../az-privilege-escalation/az-storage-privesc.md" %}
[az-storage-privesc.md](../az-privilege-escalation/az-storage-privesc.md)
{% endcontent-ref %}

## ãƒã‚¹ãƒˆã‚¨ã‚¯ã‚¹ãƒ—ãƒ­ã‚¤ãƒˆ

{% content-ref url="../az-post-exploitation/az-blob-storage-post-exploitation.md" %}
[az-blob-storage-post-exploitation.md](../az-post-exploitation/az-blob-storage-post-exploitation.md)
{% endcontent-ref %}

## æ°¸ç¶šæ€§

{% content-ref url="../az-persistence/az-storage-persistence.md" %}
[az-storage-persistence.md](../az-persistence/az-storage-persistence.md)
{% endcontent-ref %}

## å‚è€ƒæ–‡çŒ®

* [https://learn.microsoft.com/en-us/azure/storage/blobs/storage-blobs-introduction](https://learn.microsoft.com/en-us/azure/storage/blobs/storage-blobs-introduction)
* [https://learn.microsoft.com/en-us/azure/storage/common/storage-sas-overview](https://learn.microsoft.com/en-us/azure/storage/common/storage-sas-overview)

{% hint style="success" %}
AWSãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã³ã€å®Ÿè·µã™ã‚‹ï¼š<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
GCPãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã³ã€å®Ÿè·µã™ã‚‹ï¼š<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricksã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹</summary>

* [**ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³**](https://github.com/sponsors/carlospolop)ã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼
* **ğŸ’¬ [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã¾ãŸã¯[**ãƒ†ãƒ¬ã‚°ãƒ©ãƒ ã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«å‚åŠ ã™ã‚‹ã‹ã€**Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**ã‚’ãƒ•ã‚©ãƒ­ãƒ¼ã—ã¦ãã ã•ã„ã€‚**
* **ãƒãƒƒã‚­ãƒ³ã‚°ã®ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã™ã‚‹ã«ã¯ã€[**HackTricks**](https://github.com/carlospolop/hacktricks)ãŠã‚ˆã³[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)ã®GitHubãƒªãƒã‚¸ãƒˆãƒªã«PRã‚’æå‡ºã—ã¦ãã ã•ã„ã€‚**

</details>
{% endhint %}
