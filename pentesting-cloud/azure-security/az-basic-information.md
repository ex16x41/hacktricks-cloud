# Az - Basic Information

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Organizacija Hijerarhija

<figure><img src="../../.gitbook/assets/image (271).png" alt=""><figcaption></figcaption></figure>

### Management Groups

Ako vaÅ¡a organizacija ima **mnogo Azure pretplata**, moÅ¾da Ä‡e vam trebati naÄin da efikasno **upravljate pristupom**, politikama i usklaÄ‘enoÅ¡Ä‡u za te **pretplate**. **Management groups** pruÅ¾aju **opseg upravljanja iznad pretplata**.

Napomena da **10,000 management groups** moÅ¾e biti podrÅ¾ano u jednom direktorijumu i stablo management groups moÅ¾e podrÅ¾ati **do Å¡est nivoa dubine**.

<figure><img src="../../.gitbook/assets/image (147).png" alt=""><figcaption></figcaption></figure>

[Iz dokumentacije](https://learn.microsoft.com/en-us/azure/governance/management-groups/overview#root-management-group-for-each-directory): Svaki direktorijum dobija jednu **najviÅ¡u management group nazvanu root** management group. Root management group je ugraÄ‘ena u hijerarhiju da bi **sve management groups i pretplate bile povezane sa njom**. Ova root management group omoguÄ‡ava da se **globalne politike i Azure uloge** primenjuju na nivou direktorijuma. [Azure AD **Global Administrator** treba da se podigne](https://learn.microsoft.com/en-us/azure/role-based-access-control/elevate-access-global-admin) na **User Access Administrator ulogu ove root grupe** inicijalno. Nakon podizanja pristupa, administrator moÅ¾e **dodeliti bilo koju Azure ulogu drugim korisnicima ili grupama direktorijuma za upravljanje hijerarhijom**. Kao administrator, moÅ¾ete dodeliti **svoj nalog kao vlasnika root** management group.

Root management group **ne moÅ¾e biti premjeÅ¡tena ili obrisana**, za razliku od drugih management groups.

Management groups vam daju upravljanje na nivou preduzeÄ‡a bez obzira na vrstu pretplata koje imate. MeÄ‘utim, **sve pretplate unutar jedne management group** moraju verovati **istom Azure Active Directory (Azure AD) tenantu**.

<figure><img src="../../.gitbook/assets/image (157).png" alt=""><figcaption></figcaption></figure>

### Azure Subscriptions

U Azure-u, pretplata sluÅ¾i kao **logiÄki kontejner** za svrhu **provisioning** poslovnih ili tehniÄkih **resursa**. Ovaj kontejner odrÅ¾ava **detalje resursa** kao Å¡to su virtuelne maÅ¡ine (VMs), baze podataka, izmeÄ‘u ostalog. Prilikom kreiranja Azure resursa, kao Å¡to je VM, **pretplata povezana sa njim** je specificirana. Ova struktura olakÅ¡ava delegiranje pristupa, koristeÄ‡i mehanizme kontrole pristupa zasnovane na ulogama.

### Resource Groups

[Iz dokumentacije:](https://learn.microsoft.com/en-us/azure/azure-resource-manager/management/manage-resource-groups-python?tabs=macos#what-is-a-resource-group) Resource group je **kontejner** koji drÅ¾i **povezane resurse** za Azure reÅ¡enje. Resource group moÅ¾e ukljuÄivati sve resurse za reÅ¡enje, ili samo one **resurse koje Å¾elite da upravljate kao grupu**. Generalno, dodajte **resurse** koji dele **isti Å¾ivotni ciklus** u istu resource group kako biste ih lako mogli deploy, update i delete kao grupu.

Svi **resursi** moraju biti **unutar resource group** i mogu pripadati samo jednoj grupi, a ako se resource group obriÅ¡e, svi resursi unutar nje se takoÄ‘e briÅ¡u.

### Administrative Units

[Iz dokumentacije:](https://learn.microsoft.com/en-us/entra/identity/role-based-access-control/admin-units-manage) Administrative units vam omoguÄ‡avaju da **podelite** vaÅ¡u organizaciju na **bilo koju jedinicu** koju Å¾elite, a zatim **dodelite specifiÄne administratore** koji mogu **upravljati samo Älanovima** te jedinice. Na primer, moÅ¾ete koristiti administrative units da delegirate dozvole administratorima svake Å¡kole na velikom univerzitetu, tako da mogu kontrolisati pristup, upravljati korisnicima i postavljati politike samo u School of Engineering.

Samo **korisnici**, **grupe** i **ureÄ‘aji** mogu biti **Älanovi** administrative unit.

Dakle, **Administrative unit** Ä‡e **sadrÅ¾ati** neke **Älanove** i drugi **principals** Ä‡e biti **dodeljeni dozvolama nad tom** administrativnom **jedinicom** koje mogu koristiti za **upravljanje Älanovima** administrativne jedinice.

## Azure vs Azure AD vs Azure AD Domain Services

VaÅ¾no je napomenuti da je **Azure AD** usluga **unutar** **Azure-a**. **Azure** je Microsoftova **cloud platforma**, dok je **Azure AD** enterprise **identity** **usluga** u Azure-u.\
Å taviÅ¡e, **Azure AD nije kao Windows Active Directory**, to je identitetska usluga koja radi na potpuno drugaÄiji naÄin. Ako Å¾elite da pokrenete **Domain Controller u Azure-u** za vaÅ¡e Windows Active Directory okruÅ¾enje, morate koristiti **Azure AD Domain Services**.

## Principals

Azure podrÅ¾ava razliÄite tipove principals:

* **User**: Redovna **osoba** sa kredencijalima za pristup.
* **Group**: **Grupa principals** kojima se upravlja zajedno. **Dozvole** dodeljene grupama su **nasleÄ‘ene** od strane njenih **Älanova**.
* **Service Principal/Enterprise Applications**: To je **identitet** kreiran za **koriÅ¡Ä‡enje** sa **aplikacijama**, hostovanim uslugama i automatizovanim alatima za pristup Azure resursima. Ovaj pristup je **ograniÄen ulogama dodeljenim** service principal-u, dajuÄ‡i vam kontrolu nad **kojim resursima moÅ¾e pristupiti** i na kojem nivou. Iz sigurnosnih razloga, uvek se preporuÄuje **koristiti service principals sa automatizovanim alatima** umesto da im se dozvoli prijava sa korisniÄkim identitetom.

Kada kreirate **service principal** moÅ¾ete birati izmeÄ‘u **password authentication** ili **certificate authentication**.

* Ako izaberete **password** auth (podrazumevano), **saÄuvajte generisanu lozinku** jer neÄ‡ete moÄ‡i ponovo da joj pristupite.
* Ako izaberete certificate authentication, uverite se da Ä‡e **aplikacija imati pristup privatnom kljuÄu**.
* **Managed Identity (Metadata Creds)**: Managed identities u Azure Active Directory nude reÅ¡enje za **automatsko upravljanje identitetom** aplikacija. Ovi identiteti se koriste od strane aplikacija za svrhu **povezivanja** sa **resursima** kompatibilnim sa Azure Active Directory (**Azure AD**) autentifikacijom. KoriÅ¡Ä‡enjem managed identities, aplikacije mogu **osigurati Azure AD tokene** dok eliminiÅ¡u potrebu za direktnim rukovanjem kredencijalima. Postoje dve vrste managed identities:
* **System-assigned**. Neke Azure usluge vam omoguÄ‡avaju da **omoguÄ‡ite managed identity direktno na instance usluge**. Kada omoguÄ‡ite system-assigned managed identity, identitet se kreira u Azure AD. Identitet je vezan za **Å¾ivotni ciklus te instance usluge**. Kada se **resurs** **obriÅ¡e**, Azure automatski **briÅ¡e** **identitet** za vas. Po dizajnu, samo taj Azure resurs moÅ¾e koristiti ovaj identitet za zahtev tokene od Azure AD.
* **User-assigned**. TakoÄ‘e moÅ¾ete kreirati managed identity kao samostalni Azure resurs. MoÅ¾ete [kreirati user-assigned managed identity](https://learn.microsoft.com/en-us/azure/active-directory/managed-identities-azure-resources/how-to-manage-ua-identity-portal) i dodeliti ga jednoj ili **viÅ¡e instanci** Azure usluge (viÅ¡e resursa). Za user-assigned managed identities, **identitet se upravlja odvojeno od resursa koji ga koriste**.

## Roles & Permissions

**Roles** su **dodeljene** **principals** na **scope**: `principal -[HAS ROLE]->(scope)`

**Roles** dodeljene **grupama** su **nasleÄ‘ene** od strane svih **Älanova** grupe.

U zavisnosti od opsega na koji je uloga dodeljena, **uloga** moÅ¾e biti **nasleÄ‘ena** na **druge resurse** unutar opsega kontejnera. Na primer, ako korisnik A ima **ulogu na pretplati**, on Ä‡e imati tu **ulogu na svim resource groups** unutar pretplate i na **svim resursima** unutar resource group.

### **Classic Roles**

| **Owner**                     | <ul><li>Potpun pristup svim resursima</li><li>MoÅ¾e upravljati pristupom za druge korisnike</li></ul> | Sve vrste resursa |
| ----------------------------- | ---------------------------------------------------------------------------------------- | ------------------ |
| **Contributor**               | <ul><li>Potpun pristup svim resursima</li><li>Ne moÅ¾e upravljati pristupom</li></ul>              | Sve vrste resursa |
| **Reader**                    | â€¢ Pregled svih resursa                                                                     | Sve vrste resursa |
| **User Access Administrator** | <ul><li>Pogled svih resursa</li><li>MoÅ¾e upravljati pristupom za druge korisnike</li></ul>           | Sve vrste resursa |

### Built-In roles

[Iz dokumentacije: ](https://learn.microsoft.com/en-us/azure/role-based-access-control/built-in-roles)[Azure role-based access control (Azure RBAC)](https://learn.microsoft.com/en-us/azure/role-based-access-control/overview) ima nekoliko Azure **built-in roles** koje moÅ¾ete **dodeliti** **korisnicima, grupama, service principals i managed identities**. Dodela uloga je naÄin na koji kontroliÅ¡ete **pristup Azure resursima**. Ako built-in roles ne zadovoljavaju specifiÄne potrebe vaÅ¡e organizacije, moÅ¾ete kreirati svoje [**Azure custom roles**](https://learn.microsoft.com/en-us/azure/role-based-access-control/custom-roles)**.**

**Built-In** roles se primenjuju samo na **resurse** za koje su **namenjene**, na primer pogledajte ova 2 primera **Built-In roles za Compute** resurse:

| [Disk Backup Reader](https://learn.microsoft.com/en-us/azure/role-based-access-control/built-in-roles#disk-backup-reader)                 | PruÅ¾a dozvolu backup vault-u da izvrÅ¡i disk backup.      | 3e5e47e6-65f7-47ef-90b5-e5dd4d455f24 |
| ----------------------------------------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------- | ------------------------------------ |
| [Virtual Machine User Login](https://learn.microsoft.com/en-us/azure/role-based-access-control/built-in-roles#virtual-machine-user-login) | Pregled virtuelnih maÅ¡ina u portalu i prijava kao redovan korisnik. | fb879df8-f326-4884-b1cf-06f3ad86be52 |

Ove uloge mogu **takoÄ‘e biti dodeljene logiÄkim kontejnerima** (kao Å¡to su management groups, subscriptions i resource groups) i principals koji su pogoÄ‘eni Ä‡e ih imati **nad resursima unutar tih kontejnera**.

* PronaÄ‘ite ovde listu sa [**svim Azure built-in roles**](https://learn.microsoft.com/en-us/azure/role-based-access-control/built-in-roles).
* PronaÄ‘ite ovde listu sa [**svim Azure AD built-in roles**](https://learn.microsoft.com/en-us/azure/active-directory/roles/permissions-reference).

### Custom Roles

Azure takoÄ‘e omoguÄ‡ava kreiranje [**custom roles**](https://learn.microsoft.com/en-us/azure/role-based-access-control/custom-roles) sa dozvolama koje korisnik treba.

### Permission Denied

* Da bi **principal imao neki pristup nad resursom** potreban mu je eksplicitna uloga koja mu je dodeljena (na bilo koji naÄin) **dodeljujuÄ‡i mu tu dozvolu**.
* Eksplicitna **deny role assignment ima prednost** nad ulogom koja dodeljuje dozvolu.

<figure><img src="../../.gitbook/assets/image (191).png" alt=""><figcaption></figcaption></figure>

### Global Administrator

Korisnici sa Global Administrator ulogom imaju moguÄ‡nost da '**podignu' na User Access Administrator Azure ulogu na root management group**. To znaÄi da Ä‡e Global Administrator moÄ‡i da upravlja pristupom **svim Azure pretplatama i management groups.**\
Ovo podizanje moÅ¾e biti izvrÅ¡eno na kraju stranice: [https://portal.azure.com/#view/Microsoft\_AAD\_IAM/ActiveDirectoryMenuBlade/\~/Properties](https://portal.azure.com/#view/Microsoft\_AAD\_IAM/ActiveDirectoryMenuBlade/\~/Properties)

<figure><img src="../../.gitbook/assets/image (162).png" alt=""><figcaption></figcaption></figure>

### Azure Policies

Azure policies su skup **pravila i propisa u Microsoft Azure-u**, cloud computing usluzi, koji pomaÅ¾u u upravljanju i sprovoÄ‘enju organizacionih standarda i proceni usklaÄ‘enosti na velikoj skali. Ove politike nameÄ‡u razliÄita pravila nad vaÅ¡im **Azure resursima**, osiguravajuÄ‡i da ti resursi ostanu usklaÄ‘eni sa korporativnim standardima i ugovorima o nivou usluge.

Azure policies su kljuÄne za upravljanje cloud-om i sigurnost, pomaÅ¾uÄ‡i da se osigura da se resursi koriste pravilno i efikasno, i da su u skladu sa spoljnim propisima i internim politikama.\
Neki primeri:

1. **Osiguranje usklaÄ‘enosti sa specifiÄnim Azure regionima**: Ova politika osigurava da se svi resursi deploy-uju u specifiÄnim Azure regionima. Na primer, kompanija moÅ¾e Å¾eleti da osigura da se svi njeni podaci Äuvaju u Evropi radi usklaÄ‘enosti sa GDPR-om.
2. **SprovoÄ‘enje standarda imenovanja**: Politike mogu sprovesti konvencije imenovanja za Azure resurse. Ovo pomaÅ¾e u organizaciji i lakom identifikovanju resursa na osnovu njihovih imena, Å¡to je korisno u velikim okruÅ¾enjima.
3. **OgraniÄavanje odreÄ‘enih tipova resursa**: Ova politika moÅ¾e ograniÄiti kreiranje odreÄ‘enih tipova resursa. Na primer, politika moÅ¾e biti postavljena da spreÄi kreiranje skupih tipova resursa, kao Å¡to su odreÄ‘ene veliÄine VM-ova, radi kontrole troÅ¡kova.
4. **SprovoÄ‘enje politika oznaÄavanja**: Tagovi su parovi kljuÄ-vrednost povezani sa Azure resursima koji se koriste za upravljanje resursima. Politike mogu sprovesti da odreÄ‘eni tagovi moraju biti prisutni, ili imati specifiÄne vrednosti, za sve resurse. Ovo je korisno za praÄ‡enje troÅ¡kova, vlasniÅ¡tvo ili kategorizaciju resursa.
5. **OgraniÄavanje javnog pristupa resursima**: Politike mogu sprovesti da odreÄ‘eni resursi, kao Å¡to su storage accounts ili baze podataka, nemaju javne krajnje taÄke, osiguravajuÄ‡i da su dostupni samo unutar mreÅ¾e organizacije.
6. **Automatsko primenjivanje sigurnosnih postavki**: Politike se mogu koristiti za automatsko primenjivanje sigurnosnih postavki na resurse, kao Å¡to je primena specifiÄne mreÅ¾ne sigurnosne grupe na sve VM-ove ili osiguranje da svi storage accounts koriste enkripciju.

Napomena da se Azure Policies mogu prikaÄiti na bilo koji nivo Azure hijerarhije, ali se **obiÄno koriste u root management group** ili u drugim management groups.

### Permissions Scope

U Azure-u **dozvole se mogu dodeliti bilo kojem delu hijerarhije**. To ukljuÄuje management groups, subscriptions, resource groups i pojedinaÄne resurse. Dozvole su **nasleÄ‘ene** od strane sadrÅ¾anih **resursa** entiteta gde su dodeljene.

Ova hijerarhijska struktura omoguÄ‡ava efikasno i skalabilno upravljanje pristupnim dozvolama.

<figure><img src="../../.gitbook/assets/image (26).png" alt=""><figcaption></figcaption></figure>

### Azure RBAC vs ABAC

**RBAC** (role-based access control) je ono Å¡to smo veÄ‡ videli u prethodnim sekcijama: **Dodel
