# Az - Basiese Inligting

{% hint style="success" %}
Leer & oefen AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Leer & oefen GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Ondersteun HackTricks</summary>

* Kyk na die [**intekenplanne**](https://github.com/sponsors/carlospolop)!
* **Sluit aan by die** üí¨ [**Discord-groep**](https://discord.gg/hRep4RUj7f) of die [**telegram-groep**](https://t.me/peass) of **volg** ons op **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Deel hacking-truuks deur PR's in te dien by die** [**HackTricks**](https://github.com/carlospolop/hacktricks) en [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Organisasie Hi√´rargie

<figure><img src="../../.gitbook/assets/image (271).png" alt=""><figcaption></figcaption></figure>

### Bestuursgroepe

As jou organisasie **baie Azure-subskripsies** het, mag jy 'n manier nodig h√™ om toegang, beleide en nakoming vir daardie **subskripsies** doeltreffend te **bestuur**. **Bestuursgroepe** bied 'n **beheeromvang bo subskripsies**.

Let daarop dat **10,000 bestuursgroepe** in 'n enkele gids ondersteun kan word en 'n bestuursgroepboom kan **tot ses vlakke van diepte** ondersteun.

<figure><img src="../../.gitbook/assets/image (147).png" alt=""><figcaption></figcaption></figure>

[Van die dokumentasie](https://learn.microsoft.com/en-us/azure/governance/management-groups/overview#root-management-group-for-each-directory): Elke gids kry 'n enkele **topvlak bestuursgroep genaamd die wortel** bestuursgroep. Die wortel bestuursgroep is ingebou in die hi√´rargie om **alle bestuursgroepe en subskripsies daaronder te laat val**. Hierdie wortel bestuursgroep laat toe dat **globale beleide en Azure-roltoewysings** op die gidsvlak toegepas word. Die [Azure AD **Global Administrator** moet hulself verhoog](https://learn.microsoft.com/en-us/azure/role-based-access-control/elevate-access-global-admin) tot die **User Access Administrator rol van hierdie wortelgroep** aanvanklik. Na die verhoging van toegang, kan die administrateur **enige Azure-rol aan ander gidsgebruikers of groepe toewys om die hi√´rargie te bestuur**. As administrateur kan jy **jou eie rekening as eienaar van die wortel** bestuursgroep toewys.

Die wortel bestuursgroep **kan nie geskuif of verwyder word nie**, anders as ander bestuursgroepe.

Bestuursgroepe gee jou bestuur op ondernemingsvlak, ongeag watter tipe subskripsies jy mag h√™. Maar, **alle subskripsies binne 'n enkele bestuursgroep** moet die **selfde Azure Active Directory (Azure AD) huurkontrak** vertrou.

<figure><img src="../../.gitbook/assets/image (157).png" alt=""><figcaption></figcaption></figure>

### Azure Subskripsies

In Azure dien 'n subskripsie as 'n **logiese houer** vir die doel van **voorsiening** van besigheids- of tegniese **hulpbronne**. Hierdie houer hou die **besonderhede van hulpbronne** soos virtuele masjiene (VM's), databasisse, onder andere. By die skepping van 'n Azure-hulpbron, soos 'n VM, word die **subskripsie wat daarmee geassosieer is** gespesifiseer. Hierdie struktuur fasiliteer die delegering van toegang, deur gebruik te maak van rolgebaseerde toegangbeheermeganismes.

### Hulpbrongroepe

[Van die dokumentasie:](https://learn.microsoft.com/en-us/azure/azure-resource-manager/management/manage-resource-groups-python?tabs=macos#what-is-a-resource-group) 'n Hulpbrongroep is 'n **houer** wat **verwante hulpbronne** vir 'n Azure-oplossing hou. Die hulpbrongroep kan al die hulpbronne vir die oplossing insluit, of slegs daardie **hulpbronne wat jy as 'n groep wil bestuur**. Oor die algemeen, voeg **hulpbronne** wat dieselfde **lewensiklus** deel by dieselfde hulpbrongroep sodat jy hulle maklik as 'n groep kan ontplooi, opdateer en verwyder.

Alle **hulpbronne** moet **binne 'n hulpbrongroep wees** en kan slegs aan 'n groep behoort en as 'n hulpbrongroep verwyder word, word al die hulpbronne daarin ook verwyder.

### Administratiewe Eenhede

[Van die dokumentasie:](https://learn.microsoft.com/en-us/entra/identity/role-based-access-control/admin-units-manage) Administratiewe eenhede laat jou toe om jou organisasie in **enige eenheid** wat jy wil te **onderverdeel**, en dan **spesifieke administrateurs toe te wys** wat **slegs die lede van daardie eenheid kan bestuur**. Byvoorbeeld, jy kan administratiewe eenhede gebruik om toestemmings te delegeer aan administrateurs van elke skool by 'n groot universiteit, sodat hulle toegang kan beheer, gebruikers kan bestuur, en beleide kan stel slegs in die Skool vir Ingenieurswese.

Slegs **gebruikers**, **groepe** en **toestelle** kan **lede** van 'n **administratiewe eenheid** wees.

Daarom sal 'n **administratiewe eenheid** sommige **lede** bevat en ander **principals** sal **toestemmings oor daardie** administratiewe **eenheid h√™** wat hulle kan gebruik om die lede van die administratiewe eenheid te bestuur.

## Azure vs Azure AD vs Azure AD Domain Services

Dit is belangrik om daarop te let dat **Azure AD** 'n diens **binne** **Azure** is. **Azure** is Microsoft se **wolkplatform** terwyl **Azure AD** 'n ondernemings **identiteitsdiens** in Azure is.\
Boonop, **Azure AD is nie soos Windows Active Directory nie**, dit is 'n identiteitsdiens wat op 'n heeltemal ander manier werk. As jy 'n **Domain Controller in Azure** vir jou Windows Active Directory-omgewing wil bestuur, moet jy **Azure AD Domain Services** gebruik.

## Principals

Azure ondersteun verskillende tipes principals:

* **Gebruiker**: 'n Gewone **persoon** met geloofsbriewe om toegang te verkry.
* **Groep**: 'n **groep van principals** wat saam bestuur word. **Toestemmings** wat aan groepe gegee word, word **ge√´rf** deur sy **lede**.
*   **Service Principal/Enterprise Applications**: Dit is 'n **identiteit** wat geskep is vir **gebruik** met **toepassings**, gehoste dienste, en outomatiese gereedskap om toegang tot Azure-hulpbronne te verkry. Hierdie toegang is **beperk deur die rolle wat aan die service principal toegeken is**, wat jou beheer gee oor **watter hulpbronne toegang verkry kan word** en op watter vlak. Om veiligheidsredes word dit altyd aanbeveel om **service principals met outomatiese gereedskap te gebruik** eerder as om hulle toe te laat om met 'n gebruikersidentiteit aan te meld.

Wanneer jy 'n **service principal** skep, kan jy kies tussen **wagwoordverifikasie** of **sertifikaatverifikasie**.

* As jy **wagwoord**-verifikasie kies (standaard), **stoor die gegenereerde wagwoord** aangesien jy dit nie weer sal kan verkry nie.
* As jy sertifikaatverifikasie kies, maak seker dat die **toepassing toegang tot die privaat sleutel sal h√™**.
* **Managed Identity (Metadata Creds)**: Bestuurde identiteite in Azure Active Directory bied 'n oplossing vir **outomatiese bestuur van die identiteit** van toepassings. Hierdie identiteite word deur toepassings gebruik vir die doel van **verbinding** met **hulpbronne** wat versoenbaar is met Azure Active Directory (**Azure AD**) verifikasie. Deur bestuurde identiteite te gebruik, kan toepassings **veilige Azure AD tokens** verkry terwyl hulle die behoefte om geloofsbriewe direk te hanteer, uitskakel. Daar is twee tipes bestuurde identiteite:
* **Stelsel-toegeken**. Sommige Azure-dienste laat jou toe om **'n bestuurde identiteit direk op 'n diensinstansie te aktiveer**. Wanneer jy 'n stelsel-toegeken bestuurde identiteit aktiveer, word 'n identiteit in Azure AD geskep. Die identiteit is gekoppel aan die **lewensiklus van daardie diensinstansie**. Wanneer die **hulpbron** **verwyder** word, verwyder Azure outomaties die **identiteit** vir jou. Volgens ontwerp kan slegs daardie Azure-hulpbron hierdie identiteit gebruik om tokens van Azure AD aan te vra.
* **Gebruiker-toegeken**. Jy kan ook 'n bestuurde identiteit as 'n selfstandige Azure-hulpbron skep. Jy kan [‚Äòn gebruiker-toegeken bestuurde identiteit skep](https://learn.microsoft.com/en-us/azure/active-directory/managed-identities-azure-resources/how-to-manage-ua-identity-portal) en dit toewys aan een of **meer instansies** van 'n Azure-diens (meervoudige hulpbronne). Vir gebruiker-toegeken bestuurde identiteite, word die **identiteit apart bestuur van die hulpbronne wat dit gebruik**.

## Rolle & Toestemmings

**Rolle** word **toegeken** aan **principals** op 'n **omvang**: `principal -[HET ROL]->(omvang)`

**Rolle** wat aan **groepe** toegeken word, word **ge√´rf** deur al die **lede** van die groep.

Afhangende van die omvang waaraan die rol toegeken is, kan die **rol** **ge√´rf** word deur **ander hulpbronne** binne die omvanghouer. Byvoorbeeld, as 'n gebruiker A 'n **rol op die subskripsie** het, sal hy daardie **rol op al die hulpbrongroepe** binne die subskripsie h√™ en op **al die hulpbronne** binne die hulpbrongroep.

### **Klassieke Rolle**

| **Eienaar**                     | <ul><li>Volle toegang tot alle hulpbronne</li><li>Kan toegang vir ander gebruikers bestuur</li></ul> | Alle hulpbrontipes |
| ----------------------------- | ---------------------------------------------------------------------------------------- | ------------------ |
| **Bydraer**               | <ul><li>Volle toegang tot alle hulpbronne</li><li>Kan nie toegang bestuur nie</li></ul>              | Alle hulpbrontipes |
| **Leser**                    | ‚Ä¢ Sien alle hulpbronne                                                                     | Alle hulpbrontipes |
| **Gebruiker Toegang Administrateur** | <ul><li>Sien alle hulpbronne</li><li>Kan toegang vir ander gebruikers bestuur</li></ul>           | Alle hulpbrontipes |

### Ingeboude Rolle

[Van die dokumentasie: ](https://learn.microsoft.com/en-us/azure/role-based-access-control/built-in-roles)[Azure rolgebaseerde toegangbeheer (Azure RBAC)](https://learn.microsoft.com/en-us/azure/role-based-access-control/overview) het verskeie Azure **ingeboude rolle** wat jy kan **toewys** aan **gebruikers, groepe, service principals, en bestuurde identiteite**. Roltoewysings is die manier waarop jy **toegang tot Azure-hulpbronne beheer**. As die ingeboude rolle nie aan die spesifieke behoeftes van jou organisasie voldoen nie, kan jy jou eie [**Azure pasgemaakte rolle**](https://learn.microsoft.com/en-us/azure/role-based-access-control/custom-roles)** skep.**

**Ingeboude** rolle geld slegs vir die **hulpbronne** waarvoor hulle **bedoel** is, byvoorbeeld kyk na hierdie 2 voorbeelde van **ingeboude rolle oor Compute** hulpbronne:

| [Disk Backup Reader](https://learn.microsoft.com/en-us/azure/role-based-access-control/built-in-roles#disk-backup-reader)                 | Bied toestemming aan backup vault om skyf backup uit te voer.      | 3e5e47e6-65f7-47ef-90b5-e5dd4d455f24 |
| ----------------------------------------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------- | ------------------------------------ |
| [Virtual Machine User Login](https://learn.microsoft.com/en-us/azure/role-based-access-control/built-in-roles#virtual-machine-user-login) | Sien Virtuele Masjiene in die portaal en meld aan as 'n gewone gebruiker. | fb879df8-f326-4884-b1cf-06f3ad86be52 |

Hierdie rolle kan **ook toegeken word oor logiese houers** (soos bestuursgroepe, subskripsies en hulpbrongroepe) en die principals wat geraak word, sal hulle **oor die hulpbronne binne daardie houers h√™**.

* Vind hier 'n lys met [**al die Azure ingeboude rolle**](https://learn.microsoft.com/en-us/azure/role-based-access-control/built-in-roles).
* Vind hier 'n lys met [**al die Azure AD ingeboude rolle**](https://learn.microsoft.com/en-us/azure/active-directory/roles/permissions-reference).

### Pasgemaakte Rolle

Azure laat ook toe om [**pasgemaakte rolle**](https://learn.microsoft.com/en-us/azure/role-based-access-control/custom-roles) te skep met die toestemmings wat die gebruiker benodig.

### Toestemming Geweier

* Vir 'n **principal om toegang tot 'n hulpbron te h√™** moet hy 'n eksplisiete rol h√™ wat aan hom toegeken is (op enige manier) **wat hom daardie toestemming gee**.
* 'n Eksplisiete **ontkenning van roltoewysing het voorrang** oor die rol wat die toestemming gee.

<figure><img src="../../.gitbook/assets/image (191).png" alt=""><figcaption></figcaption></figure>

### Globale Administrateur

Gebruikers met die Globale Administrateur-rol het die vermo√´ om '**te verhoog' na die User Access Administrator Azure-rol na die wortel bestuursgroep**. Dit beteken dat 'n Globale Administrateur toegang sal kan bestuur **alle Azure-subskripsies en bestuursgroepe.**\
Hierdie verhoging kan aan die einde van die bladsy gedoen word: [https://portal.azure.com/#view/Microsoft\_AAD\_IAM/ActiveDirectoryMenuBlade/\~/Properties](https://portal.azure.com/#view/Microsoft\_AAD\_IAM/ActiveDirectoryMenuBlade/\~/Properties)

<figure><img src="../../.gitbook/assets/image (162).png" alt=""><figcaption></figcaption></figure>

### Azure Beleide

Azure-beleide is 'n stel **re√´ls en regulasies in Microsoft Azure**, 'n wolk-rekenaardiens, wat help om organisatoriese standaarde te bestuur en af te dwing en om nakoming op skaal te evalueer. Hierdie beleide dwing verskillende re√´ls oor jou **Azure-hulpbronne af**, wat verseker dat daardie hulpbronne voldoen aan korporatiewe standaarde en diensvlak-ooreenkomste.

Azure-beleide is van kardinale belang vir wolkbeheer en sekuriteit, wat help om te verseker dat hulpbronne behoorlik en doeltreffend gebruik word, en dat hulle voldoen aan eksterne regulasies en interne beleide.\
Sommige voorbeelde:

1. **Verseker Nakoming met Spesifieke Azure Streke**: Hierdie beleid verseker dat alle hulpbronne in spesifieke Azure-streke ontplooi word. Byvoorbeeld, 'n maatskappy mag wil verseker dat al sy data in Europa gestoor word vir GDPR-nakoming.
2. **Afdwing van Naamstandaarde**: Beleide kan naamkonvensies vir Azure-hulpbronne afdwing. Dit help om hulpbronne te organiseer en maklik te identifiseer op grond van hul name, wat nuttig is in groot omgewings.
3. **Beperk Sekere Hulpbrontipes**: Hierdie beleid kan die skepping van sekere tipes hulpbronne beperk. Byvoorbeeld, 'n beleid kan ingestel word om die skepping van duur hulpbrontipes, soos sekere VM-groottes, te voorkom om koste te beheer.
4. **Afdwing van Etiketteringsbeleide**: Etikette is sleutel-waarde pare wat met Azure-hulpbronne geassosieer word vir hulpbronbestuur. Beleide kan afdwing dat sekere etikette teenwoordig moet wees, of spesifieke waardes moet h√™, vir alle hulpbronne. Dit is nuttig vir kostopsporing, eienaarskap, of kategorisering van hulpbronne.
5. **Beperk Openbare Toegang tot Hulpbronne**: Beleide kan afdwing dat sekere hulpbronne, soos bergingsrekeninge of databasisse, nie openbare eindpunte het nie, wat verseker dat hulle slegs binne die organisasie se netwerk toeganklik is.
6. **Outomatiese Toepassing van Sekuriteitsinstellings**: Beleide kan gebruik word om outomaties sekuriteits
