# Az - Βασικές Πληροφορίες

{% hint style="success" %}
Μάθετε & εξασκηθείτε στο AWS Hacking:<img src="../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Μάθετε & εξασκηθείτε στο GCP Hacking: <img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Υποστήριξη HackTricks</summary>

* Ελέγξτε τα [**σχέδια συνδρομής**](https://github.com/sponsors/carlospolop)!
* **Εγγραφείτε στην** 💬 [**ομάδα Discord**](https://discord.gg/hRep4RUj7f) ή στην [**ομάδα telegram**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Μοιραστείτε κόλπα hacking υποβάλλοντας PRs στα** [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Ιεραρχία Οργάνωσης

<figure><img src="../../.gitbook/assets/image (271).png" alt=""><figcaption></figcaption></figure>

### Ομάδες Διαχείρισης

Εάν η οργάνωσή σας έχει **πολλές συνδρομές Azure**, μπορεί να χρειαστείτε έναν τρόπο για να **διαχειρίζεστε αποτελεσματικά** την πρόσβαση, τις πολιτικές και τη συμμόρφωση για αυτές τις **συνδρομές**. Οι **ομάδες διαχείρισης** παρέχουν ένα **πεδίο διακυβέρνησης πάνω από τις συνδρομές**.

Σημειώστε ότι μπορούν να υποστηριχθούν **10.000 ομάδες διαχείρισης** σε έναν μόνο κατάλογο και ένα δέντρο ομάδων διαχείρισης μπορεί να υποστηρίξει **έως έξι επίπεδα βάθους**.

<figure><img src="../../.gitbook/assets/image (147).png" alt=""><figcaption></figcaption></figure>

[Από τα έγγραφα](https://learn.microsoft.com/en-us/azure/governance/management-groups/overview#root-management-group-for-each-directory): Κάθε κατάλογος έχει μια μόνο **ομάδα διαχείρισης κορυφής που ονομάζεται ριζική** ομάδα διαχείρισης. Η ριζική ομάδα διαχείρισης είναι ενσωματωμένη στην ιεραρχία ώστε **όλες οι ομάδες διαχείρισης και οι συνδρομές να συγκλίνουν σε αυτήν**. Αυτή η ριζική ομάδα διαχείρισης επιτρέπει την εφαρμογή **παγκόσμιων πολιτικών και αναθέσεων ρόλων Azure** σε επίπεδο καταλόγου. Ο [Azure AD **Παγκόσμιος Διαχειριστής** πρέπει να αναβαθμίσει την πρόσβαση του](https://learn.microsoft.com/en-us/azure/role-based-access-control/elevate-access-global-admin) στο **ρόλο Διαχειριστή Πρόσβασης Χρηστών αυτής της ριζικής ομάδας** αρχικά. Μετά την αναβάθμιση της πρόσβασης, ο διαχειριστής μπορεί να **αναθέσει οποιονδήποτε ρόλο Azure σε άλλους χρήστες ή ομάδες του καταλόγου για να διαχειριστεί την ιεραρχία**. Ως διαχειριστής, μπορείτε να αναθέσετε **τον δικό σας λογαριασμό ως ιδιοκτήτη της ριζικής** ομάδας διαχείρισης.

Η ριζική ομάδα διαχείρισης **δεν μπορεί να μετακινηθεί ή να διαγραφεί**, σε αντίθεση με άλλες ομάδες διαχείρισης.

Οι ομάδες διαχείρισης σας παρέχουν διαχείριση επιπέδου επιχείρησης σε κλίμακα ανεξαρτήτως του τύπου των συνδρομών που μπορεί να έχετε. Ωστόσο, **όλες οι συνδρομές εντός μιας μόνο ομάδας διαχείρισης** πρέπει να εμπιστεύονται τον **ίδιο ενοικιαστή Azure Active Directory (Azure AD)**.

<figure><img src="../../.gitbook/assets/image (157).png" alt=""><figcaption></figcaption></figure>

### Συνδρομές Azure

Στο Azure, μια συνδρομή λειτουργεί ως **λογικό δοχείο** για τον σκοπό της **παροχής** επιχειρηματικών ή τεχνικών **πόρων**. Αυτό το δοχείο διατηρεί τις **λεπτομέρειες των πόρων** όπως εικονικές μηχανές (VMs), βάσεις δεδομένων, μεταξύ άλλων. Κατά τη δημιουργία ενός πόρου Azure, όπως μια VM, η **συνδρομή που σχετίζεται με αυτόν** καθορίζεται. Αυτή η δομή διευκολύνει την ανάθεση πρόσβασης, χρησιμοποιώντας μηχανισμούς ελέγχου πρόσβασης βάσει ρόλων.

### Ομάδες Πόρων

[Από τα έγγραφα:](https://learn.microsoft.com/en-us/azure/azure-resource-manager/management/manage-resource-groups-python?tabs=macos#what-is-a-resource-group) Μια ομάδα πόρων είναι ένα **δοχείο** που περιέχει **σχετικούς πόρους** για μια λύση Azure. Η ομάδα πόρων μπορεί να περιλαμβάνει όλους τους πόρους για τη λύση ή μόνο εκείνους τους **πόρους που θέλετε να διαχειριστείτε ως ομάδα**. Γενικά, προσθέστε **πόρους** που μοιράζονται τον **ίδιο κύκλο ζωής** στην ίδια ομάδα πόρων ώστε να μπορείτε να τους αναπτύσσετε, να τους ενημερώνετε και να τους διαγράφετε εύκολα ως ομάδα.

Όλοι οι **πόροι** πρέπει να είναι **μέσα σε μια ομάδα πόρων** και μπορούν να ανήκουν μόνο σε μια ομάδα και αν μια ομάδα πόρων διαγραφεί, όλοι οι πόροι μέσα σε αυτήν διαγράφονται επίσης.

### Διοικητικές Μονάδες

[Από τα έγγραφα:](https://learn.microsoft.com/en-us/entra/identity/role-based-access-control/admin-units-manage) Οι διοικητικές μονάδες σας επιτρέπουν να **υποδιαιρείτε** την οργάνωσή σας σε **οποιαδήποτε μονάδα** θέλετε και στη συνέχεια να **αναθέτετε συγκεκριμένους διαχειριστές** που μπορούν να **διαχειρίζονται μόνο τα μέλη** αυτής της μονάδας. Για παράδειγμα, θα μπορούσατε να χρησιμοποιήσετε διοικητικές μονάδες για να αναθέσετε δικαιώματα σε διαχειριστές κάθε σχολής σε ένα μεγάλο πανεπιστήμιο, ώστε να μπορούν να ελέγχουν την πρόσβαση, να διαχειρίζονται χρήστες και να θέτουν πολιτικές μόνο στη Σχολή Μηχανικών.

Μόνο **χρήστες**, **ομάδες** και **συσκευές** μπορούν να είναι **μέλη** μιας **διοικητικής μονάδας**.

Επομένως, μια **διοικητική μονάδα** θα **περιέχει** κάποια **μέλη** και άλλοι **προϊστάμενοι** θα έχουν **ανατεθεί δικαιώματα πάνω σε αυτήν** τη διοικητική **μονάδα** που μπορούν να χρησιμοποιήσουν για να **διαχειρίζονται τα μέλη** της διοικητικής μονάδας.

## Azure vs Azure AD vs Υπηρεσίες Τομέα Azure AD

Είναι σημαντικό να σημειωθεί ότι το **Azure AD** είναι μια υπηρεσία **μέσα** στο **Azure**. Το **Azure** είναι η **πλατφόρμα cloud** της Microsoft ενώ το **Azure AD** είναι η υπηρεσία **ταυτότητας** **επιχείρησης** στο Azure.\
Επιπλέον, το **Azure AD δεν είναι όπως το Windows Active Directory**, είναι μια υπηρεσία ταυτότητας που λειτουργεί με εντελώς διαφορετικό τρόπο. Εάν θέλετε να εκτελέσετε έναν **Ελεγκτή Τομέα στο Azure** για το περιβάλλον Windows Active Directory σας, πρέπει να χρησιμοποιήσετε τις **Υπηρεσίες Τομέα Azure AD**.

## Προϊστάμενοι

Το Azure υποστηρίζει διαφορετικούς τύπους προϊσταμένων:

* **Χρήστης**: Ένα κανονικό **άτομο** με διαπιστευτήρια πρόσβασης.
* **Ομάδα**: Μια **ομάδα προϊσταμένων** που διαχειρίζεται μαζί. Οι **δικαιώματα** που χορηγούνται σε ομάδες **κληρονομούνται** από τα **μέλη** της.
* **Service Principal/Επιχειρηματικές Εφαρμογές**: Είναι μια **ταυτότητα** που δημιουργείται για **χρήση** με **εφαρμογές**, φιλοξενούμενες υπηρεσίες και αυτοματοποιημένα εργαλεία για πρόσβαση σε πόρους Azure. Αυτή η πρόσβαση είναι **περιορισμένη από τους ρόλους που έχουν ανατεθεί** στο service principal, δίνοντάς σας έλεγχο πάνω σε **ποιοι πόροι μπορούν να προσπελαστούν** και σε ποιο επίπεδο. Για λόγους ασφαλείας, συνιστάται πάντα να **χρησιμοποιείτε service principals με αυτοματοποιημένα εργαλεία** αντί να τους επιτρέπετε να συνδέονται με μια ταυτότητα χρήστη.

Κατά τη δημιουργία ενός **service principal** μπορείτε να επιλέξετε μεταξύ **αυθεντικοποίησης με κωδικό πρόσβασης** ή **αυθεντικοποίησης με πιστοποιητικό**.

* Εάν επιλέξετε **αυθεντικοποίηση με κωδικό πρόσβασης** (κατά προεπιλογή), **αποθηκεύστε τον κωδικό πρόσβασης που δημιουργήθηκε** καθώς δεν θα μπορείτε να έχετε πρόσβαση σε αυτόν ξανά.
* Εάν επιλέξετε αυθεντικοποίηση με πιστοποιητικό, βεβαιωθείτε ότι η **εφαρμογή θα έχει πρόσβαση στο ιδιωτικό κλειδί**.
* **Διαχειριζόμενη Ταυτότητα (Metadata Creds)**: Οι διαχειριζόμενες ταυτότητες στο Azure Active Directory προσφέρουν μια λύση για **αυτόματη διαχείριση της ταυτότητας** των εφαρμογών. Αυτές οι ταυτότητες χρησιμοποιούνται από τις εφαρμογές για τον σκοπό της **σύνδεσης** με **πόρους** συμβατούς με την αυθεντικοποίηση Azure Active Directory (**Azure AD**). Χρησιμοποιώντας διαχειριζόμενες ταυτότητες, οι εφαρμογές μπορούν να **ασφαλίσουν τα Azure AD tokens** ενώ εξαλείφουν την ανάγκη να χειρίζονται άμεσα τα διαπιστευτήρια. Υπάρχουν δύο τύποι διαχειριζόμενων ταυτοτήτων:
* **Σύστημα-ανατεθειμένη**. Ορισμένες υπηρεσίες Azure σας επιτρέπουν να **ενεργοποιήσετε μια διαχειριζόμενη ταυτότητα απευθείας σε μια υπηρεσία**. Όταν ενεργοποιείτε μια διαχειριζόμενη ταυτότητα συστήματος, δημιουργείται μια ταυτότητα στο Azure AD. Η ταυτότητα συνδέεται με τον **κύκλο ζωής αυτής της υπηρεσίας**. Όταν ο **πόρος** **διαγραφεί**, το Azure διαγράφει αυτόματα την **ταυτότητα** για εσάς. Σχεδιασμένα, μόνο αυτός ο πόρος Azure μπορεί να χρησιμοποιήσει αυτήν την ταυτότητα για να ζητήσει tokens από το Azure AD.
* **Χρήστη-ανατεθειμένη**. Μπορείτε επίσης να δημιουργήσετε μια διαχειριζόμενη ταυτότητα ως αυτόνομο πόρο Azure. Μπορείτε να [δημιουργήσετε μια διαχειριζόμενη ταυτότητα χρήστη](https://learn.microsoft.com/en-us/azure/active-directory/managed-identities-azure-resources/how-to-manage-ua-identity-portal) και να την αναθέσετε σε μία ή **περισσότερες περιπτώσεις** μιας υπηρεσίας Azure (πολλοί πόροι). Για τις διαχειριζόμενες ταυτότητες χρήστη, η **ταυτότητα διαχειρίζεται ξεχωριστά από τους πόρους που τη χρησιμοποιούν**.

## Ρόλοι & Δικαιώματα

Οι **ρόλοι** ανατίθενται σε **προϊστάμενους** σε ένα **πεδίο**: `principal -[HAS ROLE]->(scope)`

Οι **ρόλοι** που ανατίθενται σε **ομάδες** κληρονομούνται από όλα τα **μέλη** της ομάδας.

Ανάλογα με το πεδίο στο οποίο ανατέθηκε ο ρόλος, ο **ρόλος** μπορεί να **κληρονομηθεί** σε **άλλους πόρους** μέσα στο δοχείο πεδίου. Για παράδειγμα, εάν ο χρήστης A έχει έναν **ρόλο στη συνδρομή**, θα έχει αυτόν τον **ρόλο σε όλες τις ομάδες πόρων** μέσα στη συνδρομή και σε **όλους τους πόρους** μέσα στην ομάδα πόρων.

### **Κλασικοί Ρόλοι**

| **Ιδιοκτήτης**                     | <ul><li>Πλήρης πρόσβαση σε όλους τους πόρους</li><li>Μπορεί να διαχειρίζεται την πρόσβαση για άλλους χρήστες</li></ul> | Όλοι οι τύποι πόρων |
| ----------------------------- | ---------------------------------------------------------------------------------------- | ------------------ |
| **Συνεργάτης**               | <ul><li>Πλήρης πρόσβαση σε όλους τους πόρους</li><li>Δεν μπορεί να διαχειρίζεται την πρόσβαση</li></ul>              | Όλοι οι τύποι πόρων |
| **Αναγνώστης**                    | • Προβολή όλων των πόρων                                                                     | Όλοι οι τύποι πόρων |
| **Διαχειριστής Πρόσβασης Χρηστών** | <ul><li>Προβολή όλων των πόρων</li><li>Μπορεί να διαχειρίζεται την πρόσβαση για άλλους χρήστες</li></ul>           | Όλοι οι τύποι πόρων |

### Ενσωματωμένοι ρόλοι

[Από τα έγγραφα: ](https://learn.microsoft.com/en-us/azure/role-based-access-control/built-in-roles)[Ο έλεγχος πρόσβασης βάσει ρόλων Azure (Azure RBAC)](https://learn.microsoft.com/en-us/azure/role-based-access-control/overview) έχει αρκετούς **ενσωματωμένους ρόλους** Azure που μπορείτε να **αναθέσετε** σε **χρήστες, ομάδες, service principals και διαχειριζόμενες ταυτότητες**. Οι αναθέσεις ρόλων είναι ο τρόπος που ελέγχετε την **πρόσβαση στους πόρους Azure**. Εάν οι ενσωματωμένοι ρόλοι δεν καλύπτουν τις συγκεκριμένες ανάγκες της οργάνωσής σας, μπορείτε να δημιουργήσετε τους δικούς σας [**προσαρμοσμένους ρόλους Azure**](https://learn.microsoft.com/en-us/azure/role-based-access-control/custom-roles)**.**

Οι **ενσωματωμένοι** ρόλοι ισχύουν μόνο για τους **πόρους** για τους οποίους προορίζονται, για παράδειγμα ελέγξτε αυτά τα 2 παραδείγματα **ενσωματωμένων ρόλων σε πόρους Υπολογισμού**:

| [Αναγνώστης Αντίγραφου Δίσκου](https://learn.microsoft.com/en-us/azure/role-based-access-control/built-in-roles#disk-backup-reader)                 | Παρέχει άδεια στο vault αντιγράφων για να εκτελεί αντίγραφο δίσκου.      | 3e5e47e6-65f7-47ef-90b5-e5dd4d455f24 |
| ----------------------------------------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------- | ------------------------------------ |
| [Σύνδεση Χρήστη Εικονικής Μηχανής](https://learn.microsoft.com/en-us/azure/role-based-access-control/built-in-roles#virtual-machine-user-login) | Προβολή Εικονικών Μηχανών στην πύλη και σύνδεση ως κανονικός χρήστης. | fb879df8-f326-4884-b1cf-06f3ad86be52 |

Αυτοί οι ρόλοι μπορούν **επίσης να ανατεθούν σε λογικά δοχεία** (όπως ομάδες διαχείρισης, συνδρομές και ομάδες πόρων) και οι προϊστάμενοι που επηρεάζονται θα τους έχουν **πάνω στους πόρους μέσα σε αυτά τα δοχεία**.

* Βρείτε εδώ μια λίστα με [**όλους τους ενσωματωμένους ρόλους Azure**](https://learn.microsoft.com/en-us/azure/role-based-access-control/built-in-roles).
* Βρείτε εδώ μια λίστα με [**όλους τους ενσωματωμένους ρόλους Azure AD**](https://learn.microsoft.com/en-us/azure/active-directory/roles/permissions-reference).

### Προσαρμοσμένοι Ρόλοι

Το Azure επιτρέπει επίσης τη δημιουργία [**προσαρμοσμένων ρόλων**](https://learn.microsoft.com/en-us/azure/role-based-access-control/custom-roles) με τα δικαιώματα που χρειάζεται ο χρήστης.

### Άρνηση Δικαιωμάτων

* Για να έχει ένας **προϊστάμενος κάποια πρόσβαση σε έναν πόρο**, χρειάζεται να του χορηγηθεί ρητά ένας ρόλος (οποιοσδήποτε) **χορηγώντας του αυτήν την άδεια**.
* Μια ρητή **ανάθεση ρόλου άρνησης έχει προτεραιότητα** πάνω από τον ρόλο που χορηγεί την άδεια.

<figure><img src="../../.gitbook/assets/image (191).png" alt=""><figcaption></figcaption></figure>

### Παγκόσμιος Διαχειριστής

Οι χρήστες με τον ρόλο Παγκόσμιου Διαχειριστή έχουν τη δυνατότητα να '**αναβαθμίσουν' σε ρόλο Διαχειριστή Πρόσβασης Χρηστών Azure στην ριζική ομάδα διαχείρισης**. Αυτό σημαίνει ότι ένας Παγκόσμιος Διαχειριστής θα μπορεί να διαχειρίζεται την πρόσβαση **σε όλες τις συνδρομές Azure και τις ομάδες διαχείρισης.**\
Αυτή η αναβάθμιση μπορεί να γίνει στο τέλος της σελίδας: [https://portal.azure.com/#view/Microsoft\_AAD\_IAM/ActiveDirectoryMenuBlade/\~/Properties](https://portal.azure.com/#view/Microsoft\_AAD\_IAM/ActiveDirectoryMenuBlade/\~/Properties)

<figure><img src="../../.gitbook/assets/image (162).png" alt=""><figcaption></figcaption></figure>

### Πολιτικές Azure

Οι πολιτικές Azure είναι ένα σύνολο **κανόνων και κανονισμών στο Microsoft Azure**, μια υπηρεσία υπολογιστικού νέφους, που βοηθούν στη διαχείριση και την επιβολή οργανωτικών προτύπων και στην αξιολόγηση συμμόρφωσης σε κλίμακα. Αυτές οι πολιτικές επιβάλλουν διαφορετικούς κανόνες στους **πόρους Azure**, διασφαλίζοντας ότι αυτοί οι πόροι παραμένουν συμμορφωμένοι με τα εταιρικά πρότυπα και τις συμφωνίες επιπέδου υπηρεσιών.

Οι πολιτικές Azure είναι κρίσιμες για τη διακυβέρνηση και την ασφάλεια του νέφους, βοηθώντας να διασφαλιστεί ότι οι πόροι χρησιμοποιούνται σωστά και αποτελεσματικά, και ότι συμμορφώνονται με εξωτερικούς κανονισμούς και εσωτερικές πολιτικές.\
Ορισμένα παραδείγματα:

1. **Διασφάλιση Συμμόρφωσης με Συγκεκριμένες Περιοχές Azure**: Αυτή η πολιτική διασφαλίζει ότι όλοι οι πόροι αναπτύσσονται σε συγκεκριμένες περιοχές Azure. Για παράδειγμα, μια εταιρεία μπορεί να θέλει να διασφαλίσει ότι όλα τα δεδομένα της αποθηκεύονται στην Ευρώπη για συμμόρφωση με τον GDPR.
2. **Επιβολή Προτύπων Ονοματοδοσίας**: Οι πολιτικές μπορούν να επιβάλλουν συμβάσεις ονοματοδοσίας για τους πόρους Azure. Αυτό βοηθά στην οργάνωση και την εύκολη αναγνώριση των πόρων με βάση τα ονόματά τους, κάτι που είναι χρήσιμο σε μεγάλες περιβάλλουσες.
3. **Περιορισμός Ορισμένων Τύπων Πόρων**: Αυτή η πολιτική μπορεί να περιορίσει τη δημιουργία ορισμένων τύπων πόρων. Για παράδειγμα, μια πολιτική θα μπορούσε να ρυθμιστεί για να αποτρέψει τη δημιουργία δαπανηρών τύπων πόρων, όπως ορισμένα μεγέθη VM, για τον έλεγχο του κόστους.
4. **Επιβολή Πολιτικών Ετικετών**: Οι ετικέτες είναι ζεύγη κλειδιού-τιμής που σχετίζονται με τους πόρους Azure και χρησιμοποιούνται για τη διαχείριση πόρων. Οι πολιτικές μπορούν να επιβάλλουν ότι ορισμένες ετικέτες πρέπει να είναι παρούσες ή να έχουν συγκεκριμένες τιμές για όλους τους πόρους. Αυτό είναι χρήσιμο για την παρακολούθηση κόστους, την ιδιοκτησία ή την κατηγοριοποίηση των πόρων.
5. **Περιορισμός Δημόσιας Πρόσβασης σε Πόρους**: Οι πολιτικές μπορούν να επιβάλλουν ότι ορισμένοι πόροι, όπως οι λογαριασμοί αποθήκευσης ή οι βάσεις δεδομένων, δεν έχουν δημόσιες τελικές σημεία, διασφαλίζοντας ότι είναι προσβάσιμοι μόνο εντός του δικτύου της οργάνωσης.
6. **Αυτόματη Εφαρμογή Ρυθμίσεων Ασφαλείας**: Οι πολιτικές μπορούν να χρησιμοποιηθούν για να εφαρμόσουν αυτόματα ρυθμίσεις ασφαλείας στους πόρους, όπως η εφαρμογή μιας συγκεκριμένης ομάδας ασφαλείας δικτύου σε όλες τις VM ή η διασφάλιση ότι όλοι οι λογαριασμοί αποθήκευσης χρησιμοποιούν κρυπτογράφηση.

Σημειώστε ότι οι Πολιτικές Azure μπορούν να προσαρτηθούν σε οποιοδήποτε επίπεδο της ιεραρχίας Azure, αλλά χρησιμοποιούνται **συνήθως στην ριζική ομάδα διαχείρισης** ή σε άλλες ομάδες διαχείρισης.

### Πεδίο Δικαιωμάτων

Στο Azure **τα δικαιώματα μπορούν να ανατεθούν σε οποιοδήποτε μέρος της ιεραρχίας**. Αυτό περιλαμβάνει ομάδες διαχείρισης, συνδρομές, ομάδες πόρων και μεμονωμένους πόρους. Τα δικαιώματα **κληρονομούνται** από τους περιεχόμενους **πόρους** της οντότητας στην οποία ανατέθηκαν.

Αυτή η ιεραρχική δομή επιτρέπει την αποτελεσματική και κλιμακούμενη διαχείριση των δικαιωμάτων πρόσβασης.

<figure><img src="../../.gitbook/assets/image (26).png" alt=""><figcaption></figcaption></figure>

### Azure RBAC vs ABAC

**RBAC** (έλεγχος πρόσβασης βάσει ρόλων) είναι αυτό που έχουμε δει ήδη στις προηγούμενες ενότητες: **Ανάθεση ενός ρόλου σε έναν προϊστάμενο για να του χορηγήσει πρόσβαση** σε έναν πόρο.\
Ωστόσο, σε ορισμένες περιπτώσεις μπορεί να θέλετε να παρέχετε **πιο λεπτομερή διαχείριση πρόσβασης** ή να **απλοποιήσετε** τη διαχείριση **εκατοντάδων** αναθέσεων ρόλων.

Το Azure **ABAC** (έλεγχος πρόσβασης βάσει χαρακτηριστικών) βασίζεται στο Azure RBAC προσθέτοντας **συνθήκες ανάθεσης ρόλου με βάση χαρακτηριστικά** στο πλαίσιο συγκεκριμένων ενεργειών. Μια _συνθήκη ανάθεσης ρόλου_ είναι μια **επιπλέον έλεγχο που μπορείτε προαιρετικά να προσθέσετε στην ανάθεση ρόλου σας** για να παρέχετε πιο λεπτομερή έλεγχο πρόσβασης. Μια συνθήκη φιλτράρει τα δικαιώματα που χορηγούνται ως μέρος του ορισμού ρόλου και της ανάθεσης ρόλου. Για παράδειγμα, μπορείτε να **προσθέσετε μια συνθήκη που απαιτεί ένα αντικείμενο να έχει μια συγκεκριμένη ετικέτα για να διαβάσει το αντικείμενο**.\
Δεν μπορείτε να **αρνηθείτε** ρητά την **πρόσβαση** σε συγκεκριμένους πόρους **χρησιμοποιώντας συνθήκες**.

### Προεπιλεγμένα Δικαιώματα Χρηστών

Ένας βασικός χρήστης θα έχει ορισμένα **προεπιλεγμένα δικαιώματα** για να απαριθμήσει ορισμένα μέρη του AzureAD:

* Ανάγνωση όλων των χρηστών, Ομάδων, Εφαρμογών, Συσκευών, Ρόλων, Συνδρομών και των δημόσιων ιδιοτήτων τους
* Πρόσκληση Επισκεπτών (_μπορεί να απενεργοποιηθεί_)
* Δημιουργία Ομάδων Ασφαλείας
* Ανάγνωση μη κρυφών μελών Ομάδας
* Προσθήκη επισκεπτών σε Ιδιοκτησίες ομάδων
* Δημιουργία νέας εφαρμογής (_μπορεί να απενεργοποιηθεί_)
* Προσθήκη έως 50 συσκευών στο Azure (_μπορεί να απενεργοποιηθεί_)

Μπορείτε να δείτε τη πλήρη [λίστα με τα **προεπιλεγμένα δικαιώματα χρηστών** στα έγγραφα](https://learn.microsoft.com/en-us/azure/active-directory/fundamentals/users-default-permissions). Επιπλέον, σημειώστε ότι σε αυτή τη λίστα μπορείτε επίσης να δείτε τη **λίστα προεπιλεγμένων δικαιωμάτων επισκεπτών**.

{% hint style="info" %}
Θυμηθείτε ότι για να απαριθμήσει πόρους Azure, ο χρήστης χρειάζεται μια ρητή χορήγηση της άδειας.
{% endhint %}

### Διαχείριση Προνομίων Ταυτότητας (PIM)

Η Διαχείριση Προνομίων Ταυτότητας (PIM) στο Azure είναι ένα εργαλείο που **διαχειρίζεται, ελέγχει και παρακολουθεί την προνομιακή πρόσβαση** στο Azure Active Directory και το Azure. Ενισχύει την ασφάλεια παρέχοντας **προνομιακή πρόσβαση κατά παραγγελία και περιορισμένης διάρκειας**, **επιβάλλοντας ροές έγκρισης και απαιτώντας επιπλέον αυθεντικοποίηση**. Αυτή η προσέγγιση ελαχιστοποιεί τον κίνδυνο μη εξουσιοδοτημένης πρόσβασης διασφαλίζοντας ότι οι ανυψωμένες άδειες χορηγούνται μόνο όταν είναι απαραίτητο και για συγκεκριμένη διάρκεια.

## Διαπιστευτήρια Αυθεντικοποίησης

Υπάρχουν **τρία είδη διαπιστευτηρίων** που χρησιμοποιούνται στο OIDC:

* [**Διαπιστευτήρια Πρόσβασης**](https://learn.microsoft.com/en-us/azure/active-directory/develop/access-tokens)**:** Ο πελάτης παρουσιάζει αυτό το διαπιστευτήριο στον διακομιστή πόρων για να **πρόσβαση σε πόρους**. Μπορεί να χρησιμοποιηθεί μόνο για μια συγκεκριμένη συνδυασμένη χρήση χρήστη, πελάτη και πόρου και **δεν μπορεί να ανακληθεί** μέχρι την λήξη - που είναι 1 ώρα κατά προεπιλογή. Η ανίχνευση είναι χαμηλή χρησιμοποιώντας αυτό.
* **Διαπιστευτήρια ID**: Ο πελάτης λαμβάνει αυτό το **διαπιστευτήριο από τον διακομιστή εξουσιοδότησης**. Περιέχει βασικές πληροφορίες σχετικά με τον χρήστη. Είναι **δεσμευμένο σε μια συγκεκριμένη συνδυασμένη χρήση χρήστη και πελάτη**.
* **Διαπιστευτήρια Ανανέωσης**: Παρέχονται στον πελάτη με το διαπιστευτήριο πρόσβασης. Χρησιμοποιούνται για να **λάβετε νέα διαπιστευτήρια πρόσβασης και ID**. Είναι δεσμευμένα σε μια συγκεκριμένη συνδυασμένη χρήση χρήστη και πελάτη και μπορούν να ανακληθούν. Η προεπιλεγμένη λήξη είναι **90 ημέρες** για ανενεργά διαπιστευτήρια ανανέωσης και **χωρίς λήξη για ενεργά διαπιστευτήρια**.

{% hint style="warning" %}
Οι πληροφορίες για **συνθήκες πρόσβασης** είναι **αποθηκευμένες** μέσα στο **JWT**. Έτσι, αν ζητήσετε το **διαπιστευτήριο από μια επιτρεπόμενη διεύθυνση IP**, αυτή η **IP** θα είναι **αποθηκευμένη** στο διαπιστευτήριο και στη συνέχεια μπορείτε να χρησιμοποιήσετε αυτό το διαπιστευτήριο από μια **μη επιτρεπόμενη IP για να αποκτήσετε πρόσβαση στους πόρους**.
{% endhint %}

Ελέγξτε την παρακάτω σελίδα για να μάθετε διαφορετικούς τρόπους για να **ζητήσετε διαπιστευτήρια πρόσβασης** και να συνδεθείτε με αυτά:

{% content-ref url="az-azuread/" %}
[az-azuread](az-azuread/)
{% endcontent-ref %}

Οι πιο κοινές API endpoints είναι:

* **Azure Resource Manager** (ARM): management.azure.com
* **Microsoft Graph**: graph.microsoft.com (Το Azure AD Graph που έχει αποσυρθεί είναι το graph.windows.net)

## Αναφορές

* [https://learn.microsoft.com/en-us/azure/governance/management-groups/overview](https://learn.microsoft.com/en-us/azure/governance/management-groups/overview)
* [https://learn.microsoft.com/en-us/azure/cloud-adoption-framework/ready/azure-best-practices/organize-subscriptions](https://learn.microsoft.com/en-us/azure/cloud-adoption-framework/ready/azure-best-practices/organize-subscriptions)
* [https://abouttmc.com/glossary/azure-subscription/#:\~:text=An%20Azure%20subscription%20is%20a,the%20subscription%20it%20belongs%20to.](https://abouttmc.com/glossary/azure-subscription/)
* [https://learn.microsoft.com/en-us/azure/role-based-access-control/overview#how-azure-rbac-determines-if-a-user-has-access-to-a-resource](https://learn.microsoft.com/en-us/azure/role-based-access-control/overview#how-azure-rbac-determines-if-a-user-has-access-to-a-resource)

{% hint style="success" %}
Μάθετε & εξασκηθείτε στο AWS Hacking:<img src="../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Μάθετε & εξασκηθείτε στο GCP Hacking: <img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Υποστήριξη HackTricks</summary>

* Ελέγξτε τα [**σχέδια συνδρομής**](https://github.com/sponsors/carlospolop)!
* **Εγγραφείτε στην** 💬 [**ομάδα Discord**](https://discord.gg/hRep4RUj7f) ή στην [**ομάδα telegram**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Μοιραστείτε κόλπα hacking υποβάλλοντας PRs στα** [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
