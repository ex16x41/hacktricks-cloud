# Az - Grundinformationen

{% hint style="success" %}
Lernen & √ºben Sie AWS Hacking:<img src="../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">\
Lernen & √ºben Sie GCP Hacking: <img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Unterst√ºtzen Sie HackTricks</summary>

* √úberpr√ºfen Sie die [**Abonnementpl√§ne**](https://github.com/sponsors/carlospolop)!
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teilen Sie Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repos senden.

</details>
{% endhint %}

## Organisationshierarchie

<figure><img src="https://lh7-rt.googleusercontent.com/slidesz/AGV_vUchBvhjIdWWR2ldAkWiZMdmrcEYD9Ti5UAa3zAGr9YbAnx4Q_gZNp_zvOU429vgWZ_ixoYHQKdC8bGgkhWYCy591SRIFj6RKCj4BEpVQixAGsp3T3O5sS3k7x5CTaJ-SCBNC7i5KluLyxdiXoZsH1F0ko1Gv88=s2048?key=gSyKQr3HTyhvHa28Rf7LVA" alt=""><figcaption></figcaption></figure>

### Verwaltungsguppen

* Sie kann **andere Verwaltungsguppen oder Abonnements** enthalten.
* Dies erm√∂glicht es, **Governance-Kontrollen** wie RBAC und Azure Policy einmal auf der Ebene der Verwaltungsguppe anzuwenden und sie von allen Abonnements in der Gruppe **zu erben**.
* **10.000 Verwaltungsguppen** k√∂nnen in einem einzigen Verzeichnis unterst√ºtzt werden.
* Ein Verwaltungsgruppenbaum kann **bis zu sechs Ebenen tief** sein. Dieses Limit schlie√üt die Wurzelebene oder die Abonnementebene nicht ein.
* Jede Verwaltungsguppe und jedes Abonnement kann **nur einen Elternteil** unterst√ºtzen.
* Auch wenn mehrere Verwaltungsguppen erstellt werden k√∂nnen, gibt es **nur 1 Wurzelverwaltungsguppe**.
* Die Wurzelverwaltungsguppe **enth√§lt** alle **anderen Verwaltungsguppen und Abonnements** und **kann nicht verschoben oder gel√∂scht werden**.
* Alle Abonnements innerhalb einer einzigen Verwaltungsguppe m√ºssen dem **gleichen Entra ID-Mandanten** vertrauen.

<figure><img src="../../.gitbook/assets/image (147).png" alt=""><figcaption><p><a href="https://td-mainsite-cdn.tutorialsdojo.com/wp-content/uploads/2023/02/managementgroups-768x474.png">https://td-mainsite-cdn.tutorialsdojo.com/wp-content/uploads/2023/02/managementgroups-768x474.png</a></p></figcaption></figure>

### Azure-Abonnements

* Es ist ein weiterer **logischer Container, in dem Ressourcen** (VMs, DBs‚Ä¶) ausgef√ºhrt werden k√∂nnen und abgerechnet werden.
* Sein **Elternteil** ist immer eine **Verwaltungsguppe** (und es kann die Wurzelverwaltungsguppe sein), da Abonnements keine anderen Abonnements enthalten k√∂nnen.
* Es **vertraut nur einem Entra ID**-Verzeichnis.
* **Berechtigungen**, die auf der Abonnementebene (oder einer seiner Eltern) angewendet werden, werden **auf alle Ressourcen innerhalb des Abonnements vererbt**.

### Ressourcengruppen

[Aus den Dokumenten:](https://learn.microsoft.com/en-us/azure/azure-resource-manager/management/manage-resource-groups-python?tabs=macos#what-is-a-resource-group) Eine Ressourcengruppe ist ein **Container**, der **verwandte Ressourcen** f√ºr eine Azure-L√∂sung enth√§lt. Die Ressourcengruppe kann alle Ressourcen f√ºr die L√∂sung oder nur die **Ressourcen, die Sie als Gruppe verwalten m√∂chten**, umfassen. Im Allgemeinen f√ºgen Sie **Ressourcen** hinzu, die den **gleichen Lebenszyklus** teilen, zur gleichen Ressourcengruppe hinzu, damit Sie sie einfach als Gruppe bereitstellen, aktualisieren und l√∂schen k√∂nnen.

Alle **Ressourcen** m√ºssen **innerhalb einer Ressourcengruppe** sein und k√∂nnen nur zu einer Gruppe geh√∂ren, und wenn eine Ressourcengruppe gel√∂scht wird, werden auch alle Ressourcen darin gel√∂scht.

<figure><img src="https://lh7-rt.googleusercontent.com/slidesz/AGV_vUfe8U30iP_vdZCvxX4g8nEPRLoo7v0kmCGkDn1frBPn3_GIoZ7VT2LkdsVQWCnrG_HSYNRRPM-1pSECUkbDAB-9YbUYLzpvKVLDETZS81CHWKYM4fDl3oMo5-yvTMnjdLTS2pz8U67xUTIzBhZ25MFMRkq5koKY=s2048?key=gSyKQr3HTyhvHa28Rf7LVA" alt=""><figcaption><p><a href="https://i0.wp.com/azuredays.com/wp-content/uploads/2020/05/org.png?resize=748%2C601&#x26;ssl=1">https://i0.wp.com/azuredays.com/wp-content/uploads/2020/05/org.png?resize=748%2C601&#x26;ssl=1</a></p></figcaption></figure>

### Azure-Ressourcen-IDs

Jede Ressource in Azure hat eine Azure-Ressourcen-ID, die sie identifiziert.

Das Format einer Azure-Ressourcen-ID ist wie folgt:

* `/subscriptions/{subscriptionId}/resourceGroups/{resourceGroupName}/providers/{resourceProviderNamespace}/{resourceType}/{resourceName}`

F√ºr eine virtuelle Maschine mit dem Namen myVM in einer Ressourcengruppe `myResourceGroup` unter der Abonnement-ID `12345678-1234-1234-1234-123456789012` sieht die Azure-Ressourcen-ID wie folgt aus:

* `/subscriptions/12345678-1234-1234-1234-123456789012/resourceGroups/myResourceGroup/providers/Microsoft.Compute/virtualMachines/myVM`

## Azure vs Entra ID vs Azure AD-Dom√§nendienste

### Azure

Azure ist Microsofts umfassende **Cloud-Computing-Plattform, die eine Vielzahl von Diensten** anbietet, darunter virtuelle Maschinen, Datenbanken, k√ºnstliche Intelligenz und Speicher. Es dient als Grundlage f√ºr das Hosting und die Verwaltung von Anwendungen, den Aufbau skalierbarer Infrastrukturen und das Ausf√ºhren moderner Workloads in der Cloud. Azure bietet Entwicklern und IT-Profis Werkzeuge, um Anwendungen und Dienste nahtlos zu erstellen, bereitzustellen und zu verwalten, und erf√ºllt eine Vielzahl von Bed√ºrfnissen von Startups bis hin zu gro√üen Unternehmen.

### Entra ID (ehemals Azure Active Directory)

Entra ID ist ein cloudbasierter **Identit√§ts- und Zugriffsverwaltungsdienst**, der f√ºr die Handhabung von Authentifizierung, Autorisierung und Benutzerzugriffskontrolle konzipiert ist. Er erm√∂glicht sicheren Zugriff auf Microsoft-Dienste wie Office 365, Azure und viele Drittanbieter-SaaS-Anwendungen. Mit Funktionen wie Single Sign-On (SSO), Multi-Faktor-Authentifizierung (MFA) und bedingten Zugriffsrichtlinien unter anderem.

### Entra-Dom√§nendienste (ehemals Azure AD DS)

Entra-Dom√§nendienste erweitern die Funktionen von Entra ID, indem sie **verwaltete Dom√§nendienste anbieten, die mit traditionellen Windows Active Directory-Umgebungen kompatibel sind**. Es unterst√ºtzt veraltete Protokolle wie LDAP, Kerberos und NTLM, sodass Organisationen √§ltere Anwendungen in der Cloud migrieren oder ausf√ºhren k√∂nnen, ohne lokale Dom√§nencontroller bereitzustellen. Dieser Dienst unterst√ºtzt auch Gruppenrichtlinien f√ºr die zentrale Verwaltung, was ihn f√ºr Szenarien geeignet macht, in denen veraltete oder AD-basierte Workloads mit modernen Cloud-Umgebungen koexistieren m√ºssen.

## Entra ID-Prinzipien

### Benutzer

* **Neue Benutzer**
* Geben Sie den E-Mail-Namen und die Dom√§ne des ausgew√§hlten Mandanten an
* Geben Sie den Anzeigenamen an
* Geben Sie das Passwort an
* Geben Sie Eigenschaften an (Vorname, Berufsbezeichnung, Kontaktinformationen‚Ä¶)
* Der Standardbenutzertyp ist ‚Äû**Mitglied**‚Äú
* **Externe Benutzer**
* Geben Sie die E-Mail-Adresse zum Einladen und den Anzeigenamen an (kann eine Nicht-Microsoft-E-Mail sein)
* Geben Sie Eigenschaften an
* Der Standardbenutzertyp ist ‚Äû**Gast**‚Äú

### Standardberechtigungen f√ºr Benutzer

* **Mitglieder (**[**Dokumente**](https://learn.microsoft.com/en-gb/entra/fundamentals/users-default-permissions#restrict-member-users-default-permissions)**)**
* Anwendungen registrieren: Standard **Ja**
* Einschr√§nkung nicht administrativer Benutzer bei der Erstellung von Mandanten: Standard **Nein**
* Sicherheitsgruppen erstellen: Standard **Ja**
* Zugriff auf das Microsoft Entra-Verwaltungsportal einschr√§nken: Standard **Nein**
* Dies schr√§nkt den API-Zugriff auf das Portal nicht ein (nur Web)
* Benutzern erlauben, Arbeits- oder Schulkonten mit LinkedIn zu verbinden: Standard **Ja**
* Benutzer angemeldet halten: Standard **Ja**
* Benutzern die Wiederherstellung des BitLocker-Schl√ºssels f√ºr ihre eigenen Ger√§te verweigern: Standard Nein (√úberpr√ºfung in den Ger√§teeinstellungen)
* Andere Benutzer lesen: Standard **Ja** (√ºber Microsoft Graph)
* **G√§ste**
* **Einschr√§nkungen f√ºr den Zugriff von Gastbenutzern**
* **Gastbenutzer haben den gleichen Zugriff wie Mitglieder**, gew√§hrt standardm√§√üig allen Mitgliedsbenutzern Berechtigungen f√ºr Gastbenutzer.
* **Gastbenutzer haben eingeschr√§nkten Zugriff auf Eigenschaften und Mitgliedschaften von Verzeichnisobjekten (Standard)**, schr√§nkt den Zugriff von G√§sten standardm√§√üig nur auf ihr eigenes Benutzerprofil ein. Der Zugriff auf Informationen anderer Benutzer und Gruppen ist nicht mehr erlaubt.
* **Der Zugriff von Gastbenutzern ist auf Eigenschaften und Mitgliedschaften ihrer eigenen Verzeichnisobjekte beschr√§nkt** ist die restriktivste.
* **G√§ste k√∂nnen einladen**
* **Jeder in der Organisation kann Gastbenutzer einladen, einschlie√ülich G√§ste und Nicht-Administratoren (am inklusivsten) - Standard**
* **Mitgliedsbenutzer und Benutzer, die bestimmten Administrationsrollen zugewiesen sind, k√∂nnen Gastbenutzer einladen, einschlie√ülich G√§ste mit Mitgliedsberechtigungen**
* **Nur Benutzer, die bestimmten Administrationsrollen zugewiesen sind, k√∂nnen Gastbenutzer einladen**
* **Niemand in der Organisation kann Gastbenutzer einladen, einschlie√ülich Administratoren (am restriktivsten)**
* **Externe Benutzer verlassen**: Standard **Wahr**
* Externen Benutzern erlauben, die Organisation zu verlassen

{% hint style="success" %}
Auch wenn standardm√§√üig eingeschr√§nkt, k√∂nnten Benutzer (Mitglieder und G√§ste) mit erteilten Berechtigungen die vorherigen Aktionen ausf√ºhren.
{% endhint %}

### **Dienstprinzipale**

Ein **Dienstprinzipal** ist eine **Identit√§t**, die f√ºr die **Nutzung** mit **Anwendungen**, gehosteten Diensten und automatisierten Tools zur Zugriff auf Azure-Ressourcen erstellt wurde. Dieser Zugriff ist **durch die zugewiesenen Rollen** f√ºr den Dienstprinzipal eingeschr√§nkt, was Ihnen die Kontrolle dar√ºber gibt, **auf welche Ressourcen zugegriffen werden kann** und auf welcher Ebene. Aus Sicherheitsgr√ºnden wird immer empfohlen, **Dienstprinzipale mit automatisierten Tools zu verwenden**, anstatt ihnen zu erlauben, sich mit einer Benutzeridentit√§t anzumelden.

Es ist m√∂glich, sich **direkt als Dienstprinzipal anzumelden**, indem man ihm ein **Geheimnis** (Passwort), ein **Zertifikat** oder den **f√∂derierten** Zugriff auf Drittanbieterplattformen (z. B. Github Actions) gew√§hrt.

* Wenn Sie die **Passwort**-Authentifizierung (standardm√§√üig) w√§hlen, **speichern Sie das generierte Passwort**, da Sie nicht mehr darauf zugreifen k√∂nnen.
* Wenn Sie die Zertifikatsauthentifizierung w√§hlen, stellen Sie sicher, dass die **Anwendung Zugriff auf den privaten Schl√ºssel hat**.

### App-Registrierungen

Eine **App-Registrierung** ist eine Konfiguration, die es einer Anwendung erm√∂glicht, sich mit Entra ID zu integrieren und Aktionen auszuf√ºhren.

#### Schl√ºsselkomponenten:

1. **Anwendungs-ID (Client-ID):** Eine eindeutige Kennung f√ºr Ihre App in Azure AD.
2. **Umleitungs-URIs:** URLs, an die Azure AD Authentifizierungsantworten sendet.
3. **Zertifikate, Geheimnisse & f√∂derierte Anmeldeinformationen:** Es ist m√∂glich, ein Geheimnis oder ein Zertifikat zu generieren, um sich als Dienstprinzipal der Anwendung anzumelden oder um den f√∂derierten Zugriff darauf zu gew√§hren (z. B. Github Actions).&#x20;
1. Wenn ein **Zertifikat** oder **Geheimnis** generiert wird, ist es einer Person m√∂glich, sich **als Dienstprinzipal** mit CLI-Tools anzumelden, indem sie die **Anwendungs-ID**, das **Geheimnis** oder **Zertifikat** und den **Mandanten** (Dom√§ne oder ID) kennt.
4. **API-Berechtigungen:** Gibt an, auf welche Ressourcen oder APIs die App zugreifen kann.
5. **Authentifizierungseinstellungen:** Definiert die unterst√ºtzten Authentifizierungsfl√ºsse der App (z. B. OAuth2, OpenID Connect).
6. **Dienstprinzipal**: Ein Dienstprinzipal wird erstellt, wenn eine App erstellt wird (wenn dies √ºber die Webkonsole erfolgt) oder wenn sie in einem neuen Mandanten installiert wird.
1. Der **Dienstprinzipal** erh√§lt alle angeforderten Berechtigungen, mit denen er konfiguriert wurde.

### Unternehmensanwendungen

Es ist nur eine **Tabelle in Azure, um Dienstprinzipale zu filtern** und die Anwendungen zu √ºberpr√ºfen, die zugewiesen wurden.

**Es ist kein anderer Typ von ‚ÄûAnwendung‚Äú,** es gibt kein Objekt in Azure, das eine ‚ÄûUnternehmensanwendung‚Äú ist, es ist nur eine Abstraktion, um die Dienstprinzipale, App-Registrierungen und verwalteten Identit√§ten zu √ºberpr√ºfen.

### **Verwaltete Identit√§t (Metadaten)**

Verwaltete Identit√§ten in Azure Active Directory bieten eine L√∂sung zur **automatischen Verwaltung der Identit√§t** von Anwendungen. Diese Identit√§ten werden von Anwendungen verwendet, um sich mit **Ressourcen** zu verbinden, die mit der Azure Active Directory (**Azure AD**) Authentifizierung kompatibel sind. Dies erm√∂glicht es, die Notwendigkeit zu **entfernen, Cloud-Anmeldeinformationen** im Code hart zu codieren, da die Anwendung in der Lage sein wird, den **Metadaten**-Dienst zu kontaktieren, um ein g√ºltiges Token zu **erhalten**, um Aktionen als die angegebene verwaltete Identit√§t in Azure auszuf√ºhren.

Es gibt zwei Arten von verwalteten Identit√§ten:

* **Systemzugewiesen**. Einige Azure-Dienste erm√∂glichen es Ihnen, eine verwaltete Identit√§t direkt auf einer Dienstinstanz zu **aktivieren**. Wenn Sie eine systemzugewiesene verwaltete Identit√§t aktivieren, wird ein **Dienstprinzipal** im Entra ID-Mandanten erstellt, dem das Abonnement vertraut, in dem sich die Ressource befindet. Wenn die **Ressource** **gel√∂scht** wird, l√∂scht Azure automatisch die **Identit√§t** f√ºr Sie.
* **Benutzerzugewiesen**. Es ist auch m√∂glich, dass Benutzer verwaltete Identit√§ten generieren. Diese werden innerhalb einer Ressourcengruppe innerhalb eines Abonnements erstellt und ein Dienstprinzipal wird im Entra ID erstellt, dem das Abonnement vertraut. Dann k√∂nnen Sie die verwaltete Identit√§t einer oder **mehreren Instanzen** eines Azure-Dienstes (mehrere Ressourcen) zuweisen. Bei benutzerzugewiesenen verwalteten Identit√§ten wird die **Identit√§t separat von den Ressourcen verwaltet, die sie verwenden**.

Verwaltete Identit√§ten **generieren keine ewigen Anmeldeinformationen** (wie Passw√∂rter oder Zertifikate), um auf den daran angeh√§ngten Dienstprinzipal zuzugreifen.

### Standardzustimmung Berechtigungen

**Benutzereinwilligung f√ºr Anwendungen**

* **Benutzereinwilligung nicht zulassen**
* Ein Administrator wird f√ºr alle Apps erforderlich sein.
* **Benutzereinwilligung f√ºr Apps von verifizierten Herausgebern f√ºr ausgew√§hlte Berechtigungen zulassen (Empfohlen)**
* Alle Benutzer k√∂nnen f√ºr Berechtigungen, die als "geringf√ºgig" eingestuft sind, f√ºr Apps von verifizierten Herausgebern oder Apps, die in dieser Organisation registriert sind, zustimmen.
* **Standard** geringf√ºgige Berechtigungen (obwohl Sie akzeptieren m√ºssen, um sie als geringf√ºgig hinzuzuf√ºgen):
* User.Read - anmelden und Benutzerprofil lesen
* offline\_access - Zugriff auf Daten aufrechterhalten, auf die Benutzer Zugriff gew√§hrt haben
* openid - Benutzer anmelden
* profile - grundlegendes Benutzerprofil anzeigen
* email - E-Mail-Adresse des Benutzers anzeigen
* **Benutzereinwilligung f√ºr Apps zulassen (Standard)**
* Alle Benutzer k√∂nnen f√ºr jede App zustimmen, um auf die Daten der Organisation zuzugreifen.

**Anfragen zur administrativen Zustimmung**: Standard **Nein**

* Benutzer k√∂nnen die administrative Zustimmung f√ºr Apps anfordern, f√ºr die sie nicht zustimmen k√∂nnen
* Wenn **Ja**: Es ist m√∂glich, Benutzer, Gruppen und Rollen anzugeben, die Anfragen zustimmen k√∂nnen
* Konfigurieren Sie auch, ob Benutzer E-Mail-Benachrichtigungen und Ablaufbenachrichtigungen erhalten&#x20;

### Verwaltungseinheiten

[Aus den Dokumenten:](https://learn.microsoft.com/en-us/entra/identity/role-based-access-control/admin-units-manage) Verwaltungseinheiten erm√∂glichen es Ihnen, Ihre Organisation in **jede Einheit** zu **unterteilen**, die Sie m√∂chten, und dann **spezifische Administratoren zuzuweisen**, die **nur die Mitglieder** dieser Einheit verwalten k√∂nnen. Zum Beispiel k√∂nnten Sie Verwaltungseinheiten verwenden, um Berechtigungen an Administratoren jeder Schule an einer gro√üen Universit√§t zu delegieren, damit sie den Zugriff steuern, Benutzer verwalten und Richtlinien nur in der Ingenieurwissenschaftsschule festlegen k√∂nnen.

Nur **Benutzer**, **Gruppen** und **Ger√§te** k√∂nnen **Mitglieder** einer **Verwaltungseinheit** sein.

Daher wird eine **Verwaltungseinheit** einige **Mitglieder** **enthalten** und andere **Prinzipien** werden **Berechtigungen √ºber diese** Verwaltungseinheit **zugewiesen**, die sie verwenden k√∂nnen, um die Mitglieder der Verwaltungseinheit zu **verwalten**.

## Rollen & Berechtigungen

**Rollen** werden **Prinzipien** auf einem **Bereich** zugewiesen: `principal -[HAS ROLE]->(scope)`

**Rollen**, die Gruppen zugewiesen sind, werden von allen **Mitgliedern** der Gruppe **vererbt**.

Je nach dem Bereich, dem die Rolle zugewiesen wurde, kann die **Rolle** auf **andere Ressourcen** innerhalb des Bereichscontainers **vererbt** werden. Zum Beispiel, wenn ein Benutzer A eine **Rolle im Abonnement** hat, hat er diese **Rolle in allen Ressourcengruppen** innerhalb des Abonnements und auf **allen Ressourcen** innerhalb der Ressourcengruppe.

### **Klassische Rollen**

| **Besitzer**                     | <ul><li>Vollzugriff auf alle Ressourcen</li><li>Kann den Zugriff f√ºr andere Benutzer verwalten</li></ul> | Alle Ressourcentypen |
| ----------------------------- | ---------------------------------------------------------------------------------------- | ------------------ |
| **Mitwirkender**               | <ul><li>Vollzugriff auf alle Ressourcen</li><li>Kann den Zugriff nicht verwalten</li></ul>              | Alle Ressourcentypen |
| **Leser**                    | ‚Ä¢ Alle Ressourcen anzeigen                                                                     | Alle Ressourcentypen |
| **Benutzerzugriffsadministrator** | <ul><li>Alle Ressourcen anzeigen</li><li>Kann den Zugriff f√ºr andere Benutzer verwalten</li></ul>           | Alle Ressourcentypen |

### Eingebaute Rollen

[Aus den Dokumenten: ](https://learn.microsoft.com/en-us/azure/role-based-access-control/built-in-roles)[Azure-Rollenbasierte Zugriffskontrolle (Azure RBAC)](https://learn.microsoft.com/en-us/azure/role-based-access-control/overview) hat mehrere Azure **eingebaute Rollen**, die Sie **Benutzern, Gruppen, Dienstprinzipalen und verwalteten Identit√§ten** zuweisen k√∂nnen. Rollenzuweisungen sind der Weg, wie Sie **Zugriff auf Azure-Ressourcen** steuern. Wenn die eingebauten Rollen nicht den spezifischen Bed√ºrfnissen Ihrer Organisation entsprechen, k√∂nnen Sie Ihre eigenen [**Azure benutzerdefinierten Rollen**](https://learn.microsoft.com/en-us/azure/role-based-access-control/custom-roles)** erstellen.**

**Eingebaute** Rollen gelten nur f√ºr die **Ressourcen**, f√ºr die sie **bestimmt** sind, zum Beispiel √ºberpr√ºfen Sie diese 2 Beispiele f√ºr **eingebaute Rollen √ºber Compute**-Ressourcen:

| [Disk Backup Reader](https://learn.microsoft.com/en-us/azure/role-based-access-control/built-in-roles#disk-backup-reader)                 | Berechtigt das Backup-Repository, um ein Festplattensicherung durchzuf√ºhren.      | 3e5e47e6-65f7-47ef-90b5-e5dd4d455f24 |
| ----------------------------------------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------- | ------------------------------------ |
| [Virtual Machine User Login](https://learn.microsoft.com/en-us/azure/role-based-access-control/built-in-roles#virtual-machine-user-login) | Virtuelle Maschinen im Portal anzeigen und sich als regul√§rer Benutzer anmelden. | fb879df8-f326-4884-b1cf-06f3ad86be52 |

Diese Rollen k√∂nnen **auch √ºber logische Container** (wie Verwaltungsguppen, Abonnements und Ressourcengruppen) zugewiesen werden, und die betroffenen Prinzipien haben sie **√ºber die Ressourcen innerhalb dieser Container**.

* Finden Sie hier eine Liste mit [**allen Azure eingebauten Rollen**](https://learn.microsoft.com/en-us/azure/role-based-access-control/built-in-roles).
* Finden Sie hier eine Liste mit [**allen Azure AD eingebauten Rollen**](https://learn.microsoft.com/en-us/azure/active-directory/roles/permissions-reference).

### Benutzerdefinierte Rollen

Azure erm√∂glicht auch die Erstellung von [**benutzerdefinierten Rollen**](https://learn.microsoft.com/en-us/azure/role-based-access-control/custom-roles) mit den Berechtigungen, die der Benutzer ben√∂tigt.

### Berechtigung verweigert

* Damit ein **Prinzipal Zugriff auf eine Ressource hat**, ben√∂tigt er eine explizite Rolle, die ihm (in irgendeiner Weise) **diese Berechtigung gew√§hrt**.
* Eine explizite **Verweigerungsrollenzuweisung hat Vorrang** vor der Rolle, die die Berechtigung gew√§hrt.

<figure><img src="../../.gitbook/assets/image (191).png" alt=""><figcaption></figcaption></figure>

### Globaler Administrator

Benutzer mit der Rolle des globalen Administrators haben die M√∂glichkeit, sich auf die Rolle des Benutzermanagementadministrators in der Wurzelverwaltungsguppe zu **erheben**. Das bedeutet, dass ein globaler Administrator in der Lage sein wird, den Zugriff auf **alle Azure-Abonnements und Verwaltungsguppen** zu verwalten.\
Diese Erh√∂hung kann am Ende der Seite erfolgen: [https://portal.azure.com/#view/Microsoft\_AAD\_IAM/ActiveDirectoryMenuBlade/\~/Properties](https://portal.azure.com/#view/Microsoft\_AAD\_IAM/ActiveDirectoryMenuBlade/\~/Properties)

<figure><img src="../../.gitbook/assets/image (162).png" alt=""><figcaption></figcaption></figure>

### Azure-Richtlinien

Azure-Richtlinien sind eine Reihe von **Regeln und Vorschriften in Microsoft Azure**, einem Cloud-Computing-Dienst, die helfen, organisatorische Standards zu verwalten und durchzusetzen und die Einhaltung in gro√üem Ma√üstab zu bewerten. Diese Richtlinien setzen verschiedene Regeln f√ºr Ihre **Azure-Ressourcen** durch und stellen sicher, dass diese Ressourcen den Unternehmensstandards und Service-Level-Vereinbarungen entsprechen.

Azure-Richtlinien sind entscheidend f√ºr die Cloud-Governance und -Sicherheit und helfen sicherzustellen, dass Ressourcen ordnungsgem√§√ü und effizient genutzt werden und dass sie externen Vorschriften und internen Richtlinien entsprechen.\
Einige Beispiele:

1. **Sicherstellen der Einhaltung bestimmter Azure-Regionen**: Diese Richtlinie stellt sicher, dass alle Ressourcen in bestimmten Azure-Regionen bereitgestellt werden. Zum Beispiel m√∂chte ein Unternehmen m√∂glicherweise sicherstellen, dass alle seine Daten in Europa f√ºr die Einhaltung der DSGVO gespeichert werden.
2. **Durchsetzung von Namensstandards**: Richtlinien k√∂nnen Namenskonventionen f√ºr Azure-Ressourcen durchsetzen. Dies hilft bei der Organisation und der einfachen Identifizierung von Ressourcen anhand ihrer Namen, was in gro√üen Umgebungen hilfreich ist.
3. **Einschr√§nkung bestimmter Ressourcentypen**: Diese Richtlinie kann die Erstellung bestimmter Ressourcentypen einschr√§nken. Zum Beispiel k√∂nnte eine Richtlinie festgelegt werden, um die Erstellung teurer Ressourcentypen, wie bestimmter VM-Gr√∂√üen, zur Kostenkontrolle zu verhindern.
4. **Durchsetzung von Tagging-Richtlinien**: Tags sind Schl√ºssel-Wert-Paare, die mit Azure-Ressourcen verkn√ºpft sind und f√ºr das Ressourcenmanagement verwendet werden. Richtlinien k√∂nnen durchsetzen, dass bestimmte Tags vorhanden sein m√ºssen oder spezifische Werte haben m√ºssen, f√ºr alle Ressourcen. Dies ist n√ºtzlich f√ºr die Kostenverfolgung, den Besitz oder die Kategorisierung von Ressourcen.
5. **Einschr√§nkung des √∂ffentlichen Zugriffs auf Ressourcen**: Richtlinien k√∂nnen durchsetzen, dass bestimmte Ressourcen, wie Speicherkonten oder Datenbanken, keine √∂ffentlichen Endpunkte haben, um sicherzustellen, dass sie nur innerhalb des Netzwerks der Organisation zug√§nglich sind.
6. **Automatisches Anwenden von Sicherheitseinstellungen**: Richtlinien k√∂nnen verwendet werden, um automatisch Sicherheitseinstellungen auf Ressourcen anzuwenden, wie das Anwenden einer bestimmten Netzwerksicherheitsgruppe auf alle VMs oder sicherzustellen, dass alle Speicherkonten Verschl√ºsselung verwenden.

Beachten Sie, dass Azure-Richtlinien an jeder Ebene der Azure-Hierarchie angeh√§ngt werden k√∂nnen, aber sie werden **h√§ufig in der Wurzelverwaltungsguppe** oder in anderen Verwaltungsguppen verwendet.

### Berechtigungsbereich

In Azure **k√∂nnen Berechtigungen auf jeden Teil der Hierarchie zugewiesen werden**. Dazu geh√∂ren Verwaltungsguppen, Abonnements, Ressourcengruppen und einzelne Ressourcen. Berechtigungen werden von den enthaltenen **Ressourcen** der Entit√§t, der sie zugewiesen wurden, **vererbt**.

Diese hierarchische Struktur erm√∂glicht eine effiziente und skalierbare Verwaltung von Zugriffsberechtigungen.

<figure><img src="../../.gitbook/assets/image (26).png" alt=""><figcaption></figcaption></figure>

### Azure RBAC vs ABAC

**RBAC** (rollenbasierte Zugriffskontrolle) ist das, was wir bereits in den vorherigen Abschnitten gesehen haben: **Zuweisen einer Rolle an einen Prinzipal, um ihm Zugriff** auf eine Ressource zu gew√§hren.\
In einigen F√§llen m√∂chten Sie jedoch m√∂glicherweise **feinere Zugriffskontrolle** oder die Verwaltung von **Hunderte** von Rollen **Zuweisungen** vereinfachen.

Azure **ABAC** (attributbasierte Zugriffskontrolle) baut auf Azure RBAC auf, indem es **Bedingungen f√ºr die Rollenzuweisung basierend auf Attributen** im Kontext spezifischer Aktionen hinzuf√ºgt. Eine _Bedingung f√ºr die Rollenzuweisung_ ist eine **zus√§tzliche √úberpr√ºfung, die Sie optional zu Ihrer Rollenzuweisung hinzuf√ºgen k√∂nnen**, um eine feinere Zugriffskontrolle zu bieten. Eine Bedingung filtert die Berechtigungen, die als Teil der Rollendefinition und Rollenzuweisung gew√§hrt werden. Zum Beispiel k√∂nnen Sie **eine Bedingung hinzuf√ºgen, die erfordert, dass ein Objekt ein bestimmtes Tag hat, um das Objekt zu lesen**.\
Sie **k√∂nnen** den Zugriff auf bestimmte Ressourcen **nicht explizit verweigern** **mit Bedingungen**.

### Standardbenutzerberechtigungen

Ein grundlegender Benutzer hat einige **Standardberechtigungen**, um einige Teile von AzureAD aufzulisten:

* Alle Benutzer, Gruppen, Anwendungen, Ger√§te, Rollen, Abonnements und deren √∂ffentliche Eigenschaften lesen
* G√§ste einladen (_kann deaktiviert werden_)
* Sicherheitsgruppen erstellen
* Nicht versteckte Gruppenmitgliedschaften lesen
* G√§ste zu eigenen Gruppen hinzuf√ºgen
* Neue Anwendung erstellen (_kann deaktiviert werden_)
* Bis zu 50 Ger√§te in Azure hinzuf√ºgen (_kann deaktiviert werden_)

Sie k√∂nnen die vollst√§ndige [Liste der **Standardberechtigungen von Benutzern** in den Dokumenten](https://learn.microsoft.com/en-us/azure/active-directory/fundamentals/users-default-permissions) einsehen. Dar√ºber hinaus beachten Sie, dass Sie in dieser Liste auch die **Standardberechtigungen f√ºr G√§ste** sehen k√∂nnen.

{% hint style="info" %}
Denken Sie daran, dass der Benutzer eine explizite Genehmigung der Berechtigung ben√∂tigt, um Azure-Ressourcen aufzulisten.
{% endhint %}

### Privileged Identity Management (PIM)

Privileged Identity Management (PIM) in Azure ist ein Tool, das **privilegierten Zugriff** in Azure Active Directory und Azure **verwaltet, steuert und √ºberwacht**. Es verbessert die Sicherheit, indem es **just-in-time und zeitlich begrenzten privilegierten Zugriff** bereitstellt, **Genehmigungsworkflows durchsetzt und zus√§tzliche Authentifizierung** erfordert. Dieser Ansatz minimiert das Risiko unbefugten Zugriffs, indem sichergestellt wird, dass erh√∂hte Berechtigungen nur dann gew√§hrt werden, wenn dies erforderlich ist und f√ºr einen bestimmten Zeitraum.

## Authentifizierungstoken

Es gibt **drei Arten von Token**, die in OIDC verwendet werden:

* [**Zugriffstoken**](https://learn.microsoft.com/en-us/azure/active-directory/develop/access-tokens)**:** Der Client pr√§sentiert dieses Token dem Ressourcenserver, um **auf Ressourcen** zuzugreifen. Es kann nur f√ºr eine bestimmte Kombination aus Benutzer, Client und Ressource verwendet werden und **kann nicht widerrufen** werden, bis es abl√§uft - das ist standardm√§√üig 1 Stunde. Die Erkennung ist bei Verwendung dieses Tokens gering.
* **ID-Token**: Der Client erh√§lt dieses **Token vom Autorisierungsserver**. Es enth√§lt grundlegende Informationen √ºber den Benutzer. Es ist **an eine bestimmte Kombination aus Benutzer und Client gebunden**.
* **Aktualisierungstoken**: Dem Client mit dem Zugriffstoken bereitgestellt. Wird verwendet, um **neue Zugriffs- und ID-Token** zu erhalten. Es ist an eine bestimmte Kombination aus Benutzer und Client gebunden und kann widerrufen werden. Die Standardablaufzeit betr√§gt **90 Tage** f√ºr inaktive Aktualisierungstoken und **keine Ablaufzeit f√ºr aktive Token**.

{% hint style="warning" %}
Informationen f√ºr **bedingten Zugriff** sind **innerhalb des JWT gespeichert**. Wenn Sie das **Token von einer erlaubten IP-Adresse anfordern**, wird diese **IP** im Token **gespeichert**, und dann k√∂nnen Sie dieses Token von einer **nicht erlaubten IP verwenden, um auf die Ressourcen zuzugreifen**.
{% endhint %}

√úberpr√ºfen Sie die folgende Seite, um verschiedene M√∂glichkeiten zu lernen, **Zugriffstoken anzufordern** und sich mit ihnen anzumelden:

{% content-ref url="az-azuread/" %}
[az-azuread](az-azuread/)
{% endcontent-ref %}

Die h√§ufigsten API-Endpunkte sind:

* **Azure Resource Manager** (ARM): management.azure.com
* **Microsoft Graph**: graph.microsoft.com (Azure AD Graph, das veraltet ist, ist graph.windows.net)

## Referenzen

* [https://learn.microsoft.com/en-us/azure/governance/management-groups/overview](https://learn.microsoft.com/en-us/azure/governance/management-groups/overview)
* [https://learn.microsoft.com/en-us/azure/cloud-adoption-framework/ready/azure-best-practices/organize-subscriptions](https://learn.microsoft.com/en-us/azure/cloud-adoption-framework/ready/azure-best-practices/organize-subscriptions)
* [https://abouttmc.com/glossary/azure-subscription/#:\~:text=An%20Azure%20subscription%20is%20a,the%20subscription%20it%20belongs%20to.](https://abouttmc.com/glossary/azure-subscription/)
* [https://learn.microsoft.com/en-us/azure/role-based-access-control/overview#how-azure-rbac-determines-if-a-user-has-access-to-a-resource](https://learn.microsoft.com/en-us/azure/role-based-access-control/overview#how-azure-rbac-determines-if-a-user-has-access-to-a-resource)
* [https://stackoverflow.com/questions/65922566/what-are-the-differences-between-service-principal-and-app-registration](https://stackoverflow.com/questions/65922566/what-are-the-differences-between-service-principal-and-app-registration)

{% hint style="success" %}
Lernen & √ºben Sie AWS Hacking:<img src="../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">\
Lernen & √ºben Sie GCP Hacking: <img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Unterst√ºtzen Sie HackTricks</summary>

* √úberpr√ºfen Sie die [**Abonnementpl√§ne**](https://github.com/sponsors/carlospolop)!
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teilen Sie Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repos senden.

</details>
{% endhint %}
