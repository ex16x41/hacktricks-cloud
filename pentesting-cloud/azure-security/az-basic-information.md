# Az - Temel Bilgiler

{% hint style="success" %}
AWS Hacking'i öğrenin ve pratik yapın:<img src="../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
GCP Hacking'i öğrenin ve pratik yapın: <img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**abonelik planlarını**](https://github.com/sponsors/carlospolop) kontrol edin!
* **Bize katılın** 💬 [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) veya **bizi takip edin** **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* Hacking ipuçlarını paylaşmak için [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna PR gönderin.

</details>
{% endhint %}

## Organizasyon Hiyerarşisi

<figure><img src="https://lh7-rt.googleusercontent.com/slidesz/AGV_vUchBvhjIdWWR2ldAkWiZMdmrcEYD9Ti5UAa3zAGr9YbAnx4Q_gZNp_zvOU429vgWZ_ixoYHQKdC8bGgkhWYCy591SRIFj6RKCj4BEpVQixAGsp3T3O5sS3k7x5CTaJ-SCBNC7i5KluLyxdiXoZsH1F0ko1Gv88=s2048?key=gSyKQr3HTyhvHa28Rf7LVA" alt=""><figcaption></figcaption></figure>

### Yönetim Grupları

* **Diğer yönetim gruplarını veya abonelikleri** içerebilir.
* Bu, yönetim grubu düzeyinde RBAC ve Azure Policy gibi **yönetim kontrollerinin uygulanmasına** olanak tanır ve bunların grup içindeki tüm abonelikler tarafından **devralınmasını** sağlar.
* Tek bir dizinde **10.000 yönetim** grubu desteklenebilir.
* Bir yönetim grubu ağacı **altı seviyeye kadar derinliği** destekleyebilir. Bu sınır, kök düzeyini veya abonelik düzeyini içermez.
* Her yönetim grubu ve abonelik **sadece bir ebeveyn** destekleyebilir.
* Birden fazla yönetim grubu oluşturulabilse de **sadece 1 kök yönetim grubu** vardır.
* Kök yönetim grubu **tüm** **diğer yönetim gruplarını ve abonelikleri** **içerir** ve **taşınamaz veya silinemez**.
* Tek bir yönetim grubundaki tüm abonelikler **aynı Entra ID kiracısına** güvenmelidir.

<figure><img src="../../.gitbook/assets/image (147).png" alt=""><figcaption><p><a href="https://td-mainsite-cdn.tutorialsdojo.com/wp-content/uploads/2023/02/managementgroups-768x474.png">https://td-mainsite-cdn.tutorialsdojo.com/wp-content/uploads/2023/02/managementgroups-768x474.png</a></p></figcaption></figure>

### Azure Abonelikleri

* Bu, kaynakların (VM'ler, DB'ler…) çalıştırılabileceği ve faturalandırılacağı başka bir **mantıksal konteynerdir**.
* **Ebeveyni** her zaman bir **yönetim grubudur** (ve kök yönetim grubu olabilir) çünkü abonelikler diğer abonelikleri içeremez.
* **Sadece bir Entra ID** dizisine güveniyor
* Abonelik düzeyinde (veya ebeveynlerinden herhangi birinde) uygulanan **izinler**, abonelik içindeki tüm kaynaklara **devralınır**.

### Kaynak Grupları

[Belgelerden:](https://learn.microsoft.com/en-us/azure/azure-resource-manager/management/manage-resource-groups-python?tabs=macos#what-is-a-resource-group) Bir kaynak grubu, bir Azure çözümü için **ilişkili kaynakları** tutan bir **konteynerdir**. Kaynak grubu, çözüm için tüm kaynakları veya yalnızca **bir grup olarak yönetmek istediğiniz kaynakları** içerebilir. Genel olarak, aynı yaşam döngüsünü paylaşan **kaynakları** aynı kaynak grubuna ekleyin, böylece bunları grup olarak kolayca dağıtabilir, güncelleyebilir ve silebilirsiniz.

Tüm **kaynaklar** **bir kaynak grubunun içinde** olmalı ve yalnızca bir gruba ait olabilir ve bir kaynak grubu silinirse, içindeki tüm kaynaklar da silinir.

<figure><img src="https://lh7-rt.googleusercontent.com/slidesz/AGV_vUfe8U30iP_vdZCvxX4g8nEPRLoo7v0kmCGkDn1frBPn3_GIoZ7VT2LkdsVQWCnrG_HSYNRRPM-1pSECUkbDAB-9YbUYLzpvKVLDETZS81CHWKYM4fDl3oMo5-yvTMnjdLTS2pz8U67xUTIzBhZ25MFMRkq5koKY=s2048?key=gSyKQr3HTyhvHa28Rf7LVA" alt=""><figcaption><p><a href="https://i0.wp.com/azuredays.com/wp-content/uploads/2020/05/org.png?resize=748%2C601&#x26;ssl=1">https://i0.wp.com/azuredays.com/wp-content/uploads/2020/05/org.png?resize=748%2C601&#x26;ssl=1</a></p></figcaption></figure>

### Azure Kaynak Kimlikleri

Azure'daki her kaynak, onu tanımlayan bir Azure Kaynak Kimliğine sahiptir.

Bir Azure Kaynak Kimliğinin formatı şu şekildedir:

* `/subscriptions/{subscriptionId}/resourceGroups/{resourceGroupName}/providers/{resourceProviderNamespace}/{resourceType}/{resourceName}`

`12345678-1234-1234-1234-123456789012` abonelik kimliği altında `myResourceGroup` kaynak grubunda myVM adında bir sanal makine için Azure Kaynak Kimliği şu şekilde görünür:

* `/subscriptions/12345678-1234-1234-1234-123456789012/resourceGroups/myResourceGroup/providers/Microsoft.Compute/virtualMachines/myVM`

## Azure vs Entra ID vs Azure AD Alan Hizmetleri

### Azure

Azure, Microsoft'un kapsamlı **bulut bilişim platformudur, geniş bir hizmet yelpazesi sunar**, sanal makineler, veritabanları, yapay zeka ve depolama dahil. Uygulamaları barındırmak ve yönetmek, ölçeklenebilir altyapılar oluşturmak ve bulutta modern iş yüklerini çalıştırmak için bir temel görevi görür. Azure, geliştiricilerin ve BT profesyonellerinin uygulamaları ve hizmetleri sorunsuz bir şekilde oluşturmasına, dağıtmasına ve yönetmesine olanak tanır ve ihtiyaçları olan her türlü kullanıcıya hitap eder.

### Entra ID (eski adıyla Azure Active Directory)

Entra ID, kimlik doğrulama, yetkilendirme ve kullanıcı erişim kontrolünü yönetmek için tasarlanmış bulut tabanlı bir **kimlik ve erişim yönetim hizmetidir**. Office 365, Azure ve birçok üçüncü taraf SaaS uygulaması gibi Microsoft hizmetlerine güvenli erişim sağlar. Tek oturum açma (SSO), çok faktörlü kimlik doğrulama (MFA) ve koşullu erişim politikaları gibi özellikler sunar.

### Entra Alan Hizmetleri (eski adıyla Azure AD DS)

Entra Alan Hizmetleri, Entra ID'nin yeteneklerini, **geleneksel Windows Active Directory ortamlarıyla uyumlu yönetilen alan hizmetleri** sunarak genişletir. LDAP, Kerberos ve NTLM gibi eski protokolleri destekler ve kuruluşların eski uygulamaları bulutta çalıştırmasına veya taşımalarına olanak tanır. Bu hizmet ayrıca merkezi yönetim için Grup İlkesi'ni destekler, böylece eski veya AD tabanlı iş yüklerinin modern bulut ortamlarıyla bir arada var olması gereken senaryolar için uygundur.

## Entra ID Prensipleri

### Kullanıcılar

* **Yeni kullanıcılar**
* Seçilen kiracıdan e-posta adı ve alanı belirtin
* Görünen adı belirtin
* Şifre belirtin
* Özellikleri belirtin (ad, iş unvanı, iletişim bilgileri…)
* Varsayılan kullanıcı türü “**üye**”dir
* **Dış kullanıcılar**
* Davet edilecek e-posta ve görünür adı belirtin (Microsoft dışı bir e-posta olabilir)
* Özellikleri belirtin
* Varsayılan kullanıcı türü “**Misafir**”dir

### Üyeler & Misafirlerin Varsayılan İzinleri

Bunları [https://learn.microsoft.com/en-us/entra/fundamentals/users-default-permissions](https://learn.microsoft.com/en-us/entra/fundamentals/users-default-permissions) adresinde kontrol edebilirsiniz, ancak diğer eylemler arasında bir üye şunları yapabilir:

* Tüm kullanıcıları, Grupları, Uygulamaları, Cihazları, Rolleri, Abonelikleri ve bunların genel özelliklerini okuyabilir
* Misafirleri davet edebilir (_kapalı hale getirilebilir_)
* Güvenlik grupları oluşturabilir
* Gizli olmayan Grup üyeliklerini okuyabilir
* Sahip olunan gruplara misafir ekleyebilir
* Yeni uygulama oluşturabilir (_kapalı hale getirilebilir_)
* Azure'a 50'ye kadar cihaz ekleyebilir (_kapalı hale getirilebilir_)

{% hint style="info" %}
Azure kaynaklarını listelemek için kullanıcının izinlerin açıkça verilmesi gerekir.
{% endhint %}

### Kullanıcıların Varsayılan Yapılandırılabilir İzinleri

* **Üyeler (**[**belgeler**](https://learn.microsoft.com/en-gb/entra/fundamentals/users-default-permissions#restrict-member-users-default-permissions)**)**
* Uygulamaları kaydet: Varsayılan **Evet**
* Yönetici olmayan kullanıcıların kiracı oluşturmasını kısıtla: Varsayılan **Hayır**
* Güvenlik grupları oluştur: Varsayılan **Evet**
* Microsoft Entra yönetim portalına erişimi kısıtla: Varsayılan **Hayır**
* Bu, portala API erişimini kısıtlamaz (sadece web)
* Kullanıcıların LinkedIn ile iş veya okul hesabını bağlamasına izin ver: Varsayılan **Evet**
* Kullanıcının oturumunu açık tutmasını göster: Varsayılan **Evet**
* Kullanıcıların sahip oldukları cihazlar için BitLocker anahtarını kurtarmasını kısıtla: Varsayılan Hayır (Cihaz Ayarlarında kontrol edin)
* Diğer kullanıcıları oku: Varsayılan **Evet** (Microsoft Graph aracılığıyla)
* **Misafirler**
* **Misafir kullanıcı erişim kısıtlamaları**
* **Misafir kullanıcılar, üyelerle aynı erişime sahiptir** varsayılan olarak tüm üye kullanıcı izinlerini misafir kullanıcılara verir.
* **Misafir kullanıcılar, dizin nesnelerinin özelliklerine ve üyeliklerine sınırlı erişime sahiptir (varsayılan)** varsayılan olarak misafir erişimini yalnızca kendi kullanıcı profilleriyle sınırlıdır. Diğer kullanıcılar ve grup bilgilerine erişim artık izin verilmez.
* **Misafir kullanıcı erişimi, kendi dizin nesnelerinin özelliklerine ve üyeliklerine sınırlıdır** en kısıtlayıcı olanıdır.
* **Misafirler davet edebilir**
* **Kuruluşta herhangi biri, misafir kullanıcıları davet edebilir, misafirler ve yönetici olmayanlar dahil (en kapsayıcı) - Varsayılan**
* **Üye kullanıcılar ve belirli yönetici rollerine atanmış kullanıcılar, misafir kullanıcıları davet edebilir, üyelik izinleri olan misafirler dahil**
* **Sadece belirli yönetici rollerine atanmış kullanıcılar misafir kullanıcıları davet edebilir**
* **Kuruluşta hiç kimse, yönetici dahil misafir kullanıcıları davet edemez (en kısıtlayıcı)**
* **Dış kullanıcıların ayrılması**: Varsayılan **Doğru**
* Dış kullanıcıların kuruluşu terk etmesine izin ver

{% hint style="success" %}
Varsayılan olarak kısıtlanmış olsalar bile, izin verilmiş kullanıcılar (üyeler ve misafirler) önceki eylemleri gerçekleştirebilir.
{% endhint %}

### **Gruplar**

**2 tür grup** vardır:

* **Güvenlik**: Bu tür grup, üyelere uygulamalara, kaynaklara erişim vermek ve lisans atamak için kullanılır. Kullanıcılar, cihazlar, hizmet ilkeleri ve diğer gruplar üye olabilir.
* **Microsoft 365**: Bu tür grup, işbirliği için kullanılır, üyelere paylaşılan bir posta kutusuna, takvime, dosyalara, SharePoint sitesine vb. erişim verir. Grup üyeleri yalnızca kullanıcılar olabilir.
* Bu, EntraID kiracısının alanıyla bir **e-posta adresine** sahip olacaktır.

**2 tür üyelik** vardır:

* **Atanmış**: Belirli üyeleri bir gruba manuel olarak eklemeye izin verir.
* **Dinamik üyelik**: Kuralları kullanarak üyeliği otomatik olarak yönetir, üyelerin özellikleri değiştiğinde grup dahil edilmesini günceller.

### **Hizmet İlkeleri**

Bir **Hizmet İlkesi**, **uygulamalar**, barındırılan hizmetler ve Azure kaynaklarına erişim için otomatik araçlarla **kullanım** için oluşturulmuş bir **kimliktir**. Bu erişim, hizmet ilkesine atanan rollerle **kısıtlanır**, böylece **hangi kaynakların erişilebileceği** ve hangi düzeyde erişileceği üzerinde kontrol sağlar. Güvenlik nedenleriyle, **hizmet ilkelerini otomatik araçlarla kullanmak** her zaman önerilir, kullanıcı kimliği ile giriş yapmalarına izin vermektense.

Bir hizmet ilkesine **doğrudan giriş yapmak** mümkündür, bir **gizli anahtar** (şifre), bir **sertifika** oluşturarak veya üçüncü taraf platformlara (örneğin, Github Actions) üzerinden **federasyon** erişimi vererek.

* **Şifre** kimlik doğrulamasını (varsayılan olarak) seçerseniz, **oluşturulan şifreyi kaydedin** çünkü bir daha erişemezsiniz.
* Sertifika kimlik doğrulamasını seçerseniz, **uygulamanın özel anahtara erişimi olduğundan emin olun**.

### Uygulama Kayıtları

Bir **Uygulama Kaydı**, bir uygulamanın Entra ID ile entegre olmasına ve eylemler gerçekleştirmesine olanak tanıyan bir yapılandırmadır.

#### Ana Bileşenler:

1. **Uygulama Kimliği (İstemci Kimliği):** Azure AD'deki uygulamanız için benzersiz bir tanımlayıcı.
2. **Yeniden Yönlendirme URI'leri:** Azure AD'nin kimlik doğrulama yanıtlarını gönderdiği URL'ler.
3. **Sertifikalar, Gizli Anahtarlar ve Federasyon Kimlik Bilgileri:** Uygulamanın hizmet ilkesine giriş yapmak için bir gizli anahtar veya sertifika oluşturmak veya ona federasyon erişimi vermek mümkündür (örneğin, Github Actions).&#x20;
1. Eğer bir **sertifika** veya **gizli anahtar** oluşturulursa, bir kişi **hizmet ilkesi olarak giriş yapmak için** CLI araçlarıyla **uygulama kimliğini**, **gizli anahtarı** veya **sertifikayı** ve **kiracıyı** (alan veya kimlik) bilerek giriş yapabilir.
4. **API İzinleri:** Uygulamanın erişebileceği kaynakları veya API'leri belirtir.
5. **Kimlik Doğrulama Ayarları:** Uygulamanın desteklediği kimlik doğrulama akışlarını tanımlar (örneğin, OAuth2, OpenID Connect).
6. **Hizmet İlkesi**: Bir Uygulama oluşturulduğunda (web konsolundan yapılırsa) veya yeni bir kiracıya yüklendiğinde bir hizmet ilkesi oluşturulur.
1. **Hizmet ilkesi**, yapılandırıldığı tüm istenen izinleri alır.

### Varsayılan Onay İzinleri

**Uygulamalar için kullanıcı onayı**

* **Kullanıcı onayını izin vermeyin**
* Tüm uygulamalar için bir yönetici gerekecektir.
* **Doğrulanmış yayıncılardan, seçilen izinler için uygulamalar için kullanıcı onayına izin verin (Tavsiye Edilir)**
* Tüm kullanıcılar, "düşük etki" olarak sınıflandırılan izinler için, doğrulanmış yayıncılardan veya bu kuruluşta kayıtlı uygulamalar için onay verebilir.
* **Varsayılan** düşük etki izinleri (bunları düşük olarak eklemek için kabul etmeniz gerektiğini unutmayın):
* User.Read - oturum açma ve kullanıcı profilini okuma
* offline\_access - kullanıcının erişim verdiği verilere erişimi sürdürme
* openid - kullanıcıları oturum açtırma
* profile - kullanıcının temel profilini görüntüleme
* email - kullanıcının e-posta adresini görüntüleme
* **Uygulamalar için kullanıcı onayına izin ver (Varsayılan)**
* Tüm kullanıcılar, herhangi bir uygulamanın kuruluşun verilerine erişmesi için onay verebilir.

**Yönetici onay talepleri**: Varsayılan **Hayır**

* Kullanıcılar, onay veremedikleri uygulamalar için yönetici onayı talep edebilir
* Eğer **Evet**: Onay taleplerine onay verebilecek Kullanıcılar, Gruplar ve Roller belirtilebilir
* Kullanıcıların e-posta bildirimleri ve son tarih hatırlatmaları alıp almayacaklarını da yapılandırın&#x20;

### **Yönetilen Kimlik (Meta Veriler)**

Azure Active Directory'deki yönetilen kimlikler, uygulamaların kimliğini **otomatik olarak yönetme** çözümü sunar. Bu kimlikler, uygulamaların Azure Active Directory (**Azure AD**) kimlik doğrulaması ile uyumlu **kaynaklara** **bağlanmak** amacıyla kullanılır. Bu, uygulamanın **meta veri** hizmetine erişerek Azure'daki belirtilen yönetilen kimlik olarak **hareketler** gerçekleştirmek için geçerli bir token almasına olanak tanır.

İki tür yönetilen kimlik vardır:

* **Sistem atamalı**. Bazı Azure hizmetleri, bir hizmet örneği üzerinde **yönetilen kimliği doğrudan etkinleştirmenize** olanak tanır. Sistem atamalı bir yönetilen kimlik etkinleştirildiğinde, **kaynağın bulunduğu** Entra ID kiracısında bir **hizmet ilkesi** oluşturulur. **Kaynak** **silindiğinde**, Azure otomatik olarak **kimliği** sizin için **silmiştir**.
* **Kullanıcı atamalı**. Kullanıcıların yönetilen kimlikler oluşturması da mümkündür. Bunlar, bir abonelik içindeki bir kaynak grubunun içinde oluşturulur ve EntraID tarafından güvenilen bir hizmet ilkesi oluşturulur. Daha sonra, yönetilen kimliği bir veya **daha fazla Azure hizmeti örneğine** (birden fazla kaynak) atayabilirsiniz. Kullanıcı atamalı yönetilen kimlikler için, **kimlik, onu kullanan kaynaklardan ayrı olarak yönetilir**.

Yönetilen Kimlikler, ona bağlı hizmet ilkesine erişmek için **sonsuz kimlik bilgileri** (şifreler veya sertifikalar gibi) oluşturmaz.

### Kurumsal Uygulamalar

Bu, yalnızca **hizmet ilkelerini filtrelemek ve atanan uygulamaları kontrol etmek için Azure'da bir tablodur**.

**Bu, başka bir "uygulama" türü değildir,** Azure'da "Kurumsal Uygulama" olan herhangi bir nesne yoktur, bu yalnızca Hizmet ilkelerini, Uygulama kayıtlarını ve yönetilen kimlikleri kontrol etmek için bir soyutlamadır.

### İdari Birimler

İdari birimler, **bir rol üzerinden bir organizasyonun belirli bir bölümüne izin vermeye** olanak tanır.

Örnek:

* Senaryo: Bir şirket, bölgesel BT yöneticilerinin yalnızca kendi bölgelerindeki kullanıcıları yönetmesini istiyor.
* Uygulama:
* Her bölge için İdari Birimler oluşturun (örneğin, "Kuzey Amerika AU", "Avrupa AU").
* AU'ları kendi bölgelerindeki kullanıcılarla doldurun.
* AU'lar **kullanıcıları, grupları veya cihazları** içerebilir
* AU'lar **dinamik üyelikleri** destekler
* AU'lar **AU'ları içeremez**
* Yönetici Rolleri Atayın:
* "Kullanıcı Yöneticisi" rolünü bölgesel BT personeline, kendi bölgesinin AU'suna göre verin.
* Sonuç: Bölgesel BT yöneticileri, diğer bölgeleri etkilemeden kendi bölgelerindeki kullanıcı hesaplarını yönetebilir.

### Entra ID Rolleri

* Entra ID'yi yönetmek için Entra ID prensiplerine atanabilecek bazı **yerleşik roller** vardır.
* Rolleri [https://learn.microsoft.com/en-us/entra/identity/role-based-access-control/permissions-reference](https://learn.microsoft.com/en-us/entra/identity/role-based-access-control/permissions-reference) adresinde kontrol edin.
* En yüksek ayrıcalıklı rol **Küresel Yönetici**dir.
* Rolün Tanımında, **ayrıntılı izinlerini** görebilirsiniz.

## Roller & İzinler

**Roller**, **prensiplere** bir **kapsamda** atanır: `prensip -[ROLÜ VAR]->(kapsam)`

**Gruplara** atanan **roller**, grubun tüm **üyeleri** tarafından **devralınır**.

Rolün atandığı kapsamına bağlı olarak, **rol**, kapsam konteyneri içindeki **diğer kaynaklara** **devralınabilir**. Örneğin, bir A kullanıcısının bir **abonelikte rolü** varsa, o **rolü, abonelik içindeki tüm kaynak gruplarında** ve **kaynak grubundaki tüm kaynaklarda** olacaktır.

### **Klasik Roller**

| **Sahip**                     | <ul><li>Tüm kaynaklara tam erişim</li><li>Diğer kullanıcılar için erişimi yönetebilir</li></ul> | Tüm kaynak türleri |
| ----------------------------- | ---------------------------------------------------------------------------------------- | ------------------ |
| **Katkıda Bulunan**               | <ul><li>Tüm kaynaklara tam erişim</li><li>Erişimi yönetemez</li></ul>              | Tüm kaynak türleri |
| **Okuyucu**                    | • Tüm kaynakları görüntüleyin                                                                     | Tüm kaynak türleri |
| **Kullanıcı Erişim Yöneticisi** | <ul><li>Tüm kaynakları görüntüleyin</li><li>Diğer kullanıcılar için erişimi yönetebilir</li></ul>           | Tüm kaynak türleri |

### Yerleşik roller

[Belgelerden: ](https://learn.microsoft.com/en-us/azure/role-based-access-control/built-in-roles)[Azure rol tabanlı erişim kontrolü (Azure RBAC)](https://learn.microsoft.com/en-us/azure/role-based-access-control/overview) birçok Azure **yerleşik rolü** vardır ve bunları **kullanıcılara, gruplara, hizmet ilkelerine ve yönetilen kimliklere** **atanabilir**. Rol atamaları, **Azure kaynaklarına erişimi kontrol etmenin** yoludur. Yerleşik roller, kuruluşunuzun özel ihtiyaçlarını karşılamıyorsa, kendi [**Azure özel rollerinizi**](https://learn.microsoft.com/en-us/azure/role-based-access-control/custom-roles)** oluşturabilirsiniz.**

**Yerleşik** roller yalnızca **amaçlandıkları kaynaklara** uygulanır, örneğin, **Hesaplama** kaynakları üzerindeki bu 2 yerleşik rol örneğine bakın:

| [Disk Yedekleme Okuyucusu](https://learn.microsoft.com/en-us/azure/role-based-access-control/built-in-roles#disk-backup-reader)                 | Disk yedeklemesi gerçekleştirmek için yedekleme kasasına izin verir.      | 3e5e47e6-65f7-47ef-90b5-e5dd4d455f24 |
| ----------------------------------------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------- | ------------------------------------ |
| [Sanal Makine Kullanıcı Girişi](https://learn.microsoft.com/en-us/azure/role-based-access-control/built-in-roles#virtual-machine-user-login) | Portaldaki Sanal Makineleri görüntüleyin ve normal bir kullanıcı olarak giriş yapın. | fb879df8-f326-4884-b1cf-06f3ad86be52 |

Bu roller, **mantıksal konteynerler** (yönetim grupları, abonelikler ve kaynak grupları gibi) üzerinde de **atanabilir** ve etkilenen prensipler, **bu konteynerler içindeki kaynaklar üzerinde** bu rollere sahip olacaktır.

* Burada [**tüm Azure yerleşik rollerinin**](https://learn.microsoft.com/en-us/azure/role-based-access-control/built-in-roles) bir listesini bulabilirsiniz.
* Burada [**tüm Entra ID yerleşik rollerinin**](https://learn.microsoft.com/en-us/azure/active-directory/roles/permissions-reference) bir listesini bulabilirsiniz.

### Özel Roller

* [**Özel roller**](https://learn.microsoft.com/en-us/azure/role-based-access-control/custom-roles) oluşturmak da mümkündür.
* Bunlar bir kapsam içinde oluşturulur, ancak bir rol birden fazla kapsamda (yönetim grupları, abonelikler ve kaynak grupları) olabilir.
* Özel rolün sahip olacağı tüm ayrıntılı izinleri yapılandırmak mümkündür.
* İzinleri hariç tutmak mümkündür.
* Hariç tutulan bir izne sahip bir prensip, izin başka bir yerde verilse bile onu kullanamaz.
* Joker karakterler kullanmak mümkündür.
* Kullanılan format bir JSON'dur.
* `actions`, kaynak üzerindeki kontrol eylemleri içindir.
* `dataActions`, nesne içindeki verilere yönelik izinlerdir.

Özel bir rol için izinlerin JSON örneği:
```json
{
"properties": {
"roleName": "",
"description": "",
"assignableScopes": [
"/subscriptions/9291ff6e-6afb-430e-82a4-6f04b2d05c7f"
],
"permissions": [
{
"actions": [
"Microsoft.DigitalTwins/register/action",
"Microsoft.DigitalTwins/unregister/action",
"Microsoft.DigitalTwins/operations/read",
"Microsoft.DigitalTwins/digitalTwinsInstances/read",
"Microsoft.DigitalTwins/digitalTwinsInstances/write",
"Microsoft.CostManagement/exports/*"
],
"notActions": [
"Astronomer.Astro/register/action",
"Astronomer.Astro/unregister/action",
"Astronomer.Astro/operations/read",
"Astronomer.Astro/organizations/read"
],
"dataActions": [],
"notDataActions": []
}
]
}
}
```
### İzinler sırası

* Bir **prensibin bir kaynağa erişim hakkı olması için** ona açık bir rol verilmesi gerekir (herhangi bir şekilde) **ona bu izni veren**.
* Açık bir **reddetme rol ataması, izni veren rolün önceliğine sahiptir**.

<figure><img src="../../.gitbook/assets/image (191).png" alt=""><figcaption><p><a href="https://link.springer.com/chapter/10.1007/978-1-4842-7325-8_10">https://link.springer.com/chapter/10.1007/978-1-4842-7325-8_10</a></p></figcaption></figure>

### Küresel Yöneticisi

Küresel Yöneticisi, **Entra ID kiracısı üzerinde tam kontrol** sağlayan bir Entra ID rolüdür. Ancak, varsayılan olarak Azure kaynakları üzerinde herhangi bir izin vermez.

Küresel Yöneticisi rolüne sahip kullanıcılar, **Kök Yönetim Grubunda Kullanıcı Erişim Yöneticisi Azure rolüne 'yükseltme'** yapma yeteneğine sahiptir. Bu nedenle, Küresel Yöneticiler **tüm Azure aboneliklerinde ve yönetim gruplarında erişimi yönetebilir.**\
Bu yükseltme sayfanın sonunda yapılabilir: [https://portal.azure.com/#view/Microsoft\_AAD\_IAM/ActiveDirectoryMenuBlade/\~/Properties](https://portal.azure.com/#view/Microsoft_AAD_IAM/ActiveDirectoryMenuBlade/~/Properties)

<figure><img src="../../.gitbook/assets/image (349).png" alt=""><figcaption></figcaption></figure>

### Azure Politikaları

**Azure Politikaları**, organizasyonların kaynaklarının belirli standartlara ve uyumluluk gereksinimlerine uygun olmasını sağlamalarına yardımcı olan kurallardır. Bu politikalar, **Azure'daki kaynaklar üzerinde ayarları uygulamanıza veya denetlemenize** olanak tanır. Örneğin, yetkisiz bir bölgede sanal makinelerin oluşturulmasını engelleyebilir veya tüm kaynakların izleme için belirli etiketlere sahip olmasını sağlayabilirsiniz.

Azure Politikaları **proaktiftir**: uyumsuz kaynakların oluşturulmasını veya değiştirilmesini durdurabilir. Ayrıca **reaktif** olup, mevcut uyumsuz kaynakları bulmanıza ve düzeltmenize olanak tanır.

#### **Anahtar Kavramlar**

1. **Politika Tanımı**: Ne yapılmasına izin verildiğini veya neyin gerekli olduğunu belirten, JSON formatında yazılmış bir kural.
2. **Politika Ataması**: Bir politikanın belirli bir kapsamda (örneğin, abonelik, kaynak grubu) uygulanması.
3. **İnisiyatifler**: Daha geniş bir uygulama için bir araya getirilmiş politika koleksiyonu.
4. **Etkisi**: Politika tetiklendiğinde ne olacağını belirtir (örneğin, "Reddet", "Denetle" veya "Ekle").

**Bazı örnekler:**

1. **Belirli Azure Bölgeleri ile Uyum Sağlama**: Bu politika, tüm kaynakların belirli Azure bölgelerinde dağıtılmasını sağlar. Örneğin, bir şirket tüm verilerinin GDPR uyumluluğu için Avrupa'da saklandığından emin olmak isteyebilir.
2. **İsimlendirme Standartlarını Uygulama**: Politikalar, Azure kaynakları için isimlendirme kurallarını uygulayabilir. Bu, büyük ortamlarda kaynakları isimlerine göre düzenlemeye ve kolayca tanımlamaya yardımcı olur.
3. **Belirli Kaynak Türlerini Kısıtlama**: Bu politika, belirli türde kaynakların oluşturulmasını kısıtlayabilir. Örneğin, maliyetleri kontrol etmek için belirli VM boyutları gibi pahalı kaynak türlerinin oluşturulmasını engelleyen bir politika ayarlanabilir.
4. **Etiketleme Politikalarını Uygulama**: Etiketler, kaynak yönetimi için kullanılan Azure kaynakları ile ilişkili anahtar-değer çiftleridir. Politikalar, belirli etiketlerin mevcut olmasını veya tüm kaynaklar için belirli değerlere sahip olmasını zorunlu kılabilir. Bu, maliyet takibi, sahiplik veya kaynakların kategorize edilmesi için faydalıdır.
5. **Kaynaklara Kamu Erişimini Sınırlama**: Politikalar, belirli kaynakların, örneğin depolama hesapları veya veritabanlarının, kamu uç noktalarına sahip olmamasını zorunlu kılabilir, böylece yalnızca organizasyonun ağı içinde erişilebilir olmalarını sağlar.
6. **Güvenlik Ayarlarını Otomatik Uygulama**: Politikalar, kaynaklara otomatik olarak güvenlik ayarları uygulamak için kullanılabilir; örneğin, tüm VM'lere belirli bir ağ güvenlik grubunun uygulanması veya tüm depolama hesaplarının şifreleme kullanmasını sağlamak.

Azure Politikalarının Azure hiyerarşisinin herhangi bir seviyesine eklenebileceğini unutmayın, ancak genellikle **kök yönetim grubunda** veya diğer yönetim gruplarında kullanılır.

Azure politika json örneği:
```json
{
"policyRule": {
"if": {
"field": "location",
"notIn": [
"eastus",
"westus"
]
},
"then": {
"effect": "Deny"
}
},
"parameters": {},
"displayName": "Allow resources only in East US and West US",
"description": "This policy ensures that resources can only be created in East US or West US.",
"mode": "All"
}
```
### İzin Mirası

Azure'da **izinler hiyerarşinin herhangi bir parçasına atanabilir**. Bu, yönetim gruplarını, abonelikleri, kaynak gruplarını ve bireysel kaynakları içerir. İzinler, atandıkları varlığın **içindeki kaynaklar** tarafından **miras alınır**.

Bu hiyerarşik yapı, erişim izinlerinin verimli ve ölçeklenebilir bir şekilde yönetilmesini sağlar.

<figure><img src="../../.gitbook/assets/image (26).png" alt=""><figcaption></figcaption></figure>

### Azure RBAC vs ABAC

**RBAC** (rol tabanlı erişim kontrolü), önceki bölümlerde gördüğümüz şeydir: **Bir role bir ilkeye atama yaparak ona bir kaynağa erişim verme**.\
Ancak, bazı durumlarda **daha ince ayrıntılı erişim yönetimi** sağlamak veya **yüzlerce** rol **atamasını** yönetimini **basitleştirmek** isteyebilirsiniz.

Azure **ABAC** (özellik tabanlı erişim kontrolü), belirli eylemler bağlamında **özelliklere dayalı rol atama koşulları** ekleyerek Azure RBAC üzerine inşa edilmiştir. Bir _rol atama koşulu_, **rol atamanıza isteğe bağlı olarak ekleyebileceğiniz ek bir kontrol** olup daha ince ayrıntılı erişim kontrolü sağlar. Bir koşul, rol tanımı ve rol ataması kapsamında verilen izinleri filtreler. Örneğin, **bir nesneyi okumak için nesnenin belirli bir etikete sahip olmasını gerektiren bir koşul ekleyebilirsiniz**.\
**Koşullar** kullanarak belirli kaynaklara **erişimi açıkça **reddedemezsiniz**.

### Ayrıcalıklı Kimlik Yönetimi (PIM)

Azure'daki Ayrıcalıklı Kimlik Yönetimi (PIM), Azure Active Directory ve Azure'daki **ayrıcalıklı erişimi yönetme, kontrol etme ve izleme** aracıdır. **Anlık ve zaman sınırlı ayrıcalıklı erişim**, **onay iş akışlarını zorunlu kılma ve ek kimlik doğrulama gerektirme** sağlayarak güvenliği artırır. Bu yaklaşım, yükseltilmiş izinlerin yalnızca gerektiğinde ve belirli bir süre için verilmesini sağlayarak yetkisiz erişim riskini en aza indirir.

## Kimlik Doğrulama Jetonları

OIDC'de kullanılan **üç tür jeton** vardır:

* [**Erişim Jetonları**](https://learn.microsoft.com/en-us/azure/active-directory/develop/access-tokens)**:** İstemci, bu jetonu kaynak sunucusuna **kaynaklara erişim** için sunar. Sadece belirli bir kullanıcı, istemci ve kaynak kombinasyonu için kullanılabilir ve **iptal edilemez** - varsayılan olarak 1 saat geçerlidir.
* **ID Jetonları**: İstemci, bu **jetonu yetkilendirme sunucusundan** alır. Kullanıcı hakkında temel bilgileri içerir. **Belirli bir kullanıcı ve istemci kombinasyonuna bağlıdır**.
* **Yenileme Jetonları**: Erişim jetonu ile istemciye sağlanır. **Yeni erişim ve ID jetonları almak için** kullanılır. Belirli bir kullanıcı ve istemci kombinasyonuna bağlıdır ve iptal edilebilir. Varsayılan geçerlilik süresi **90 gündür** ve **aktif jetonlar için geçerlilik süresi yoktur**.

{% hint style="warning" %}
**Koşullu erişim** bilgileri **JWT** içinde **saklanır**. Bu nedenle, **izin verilen bir IP adresinden jeton talep ederseniz**, o **IP** jetonda **saklanır** ve ardından bu jetonu **izin verilmeyen bir IP'den kaynaklara erişmek için** kullanabilirsiniz.
{% endhint %}

### Erişim Jetonları "aud"

Gerçekleştirmek istediğiniz eyleme bağlı olarak, erişim jetonunun "**aud**" değeri, iletişim kuracağınız API URL'si ile iletişim kurmak için yetkilendirilmiş olmalıdır.

`az account get-access-token --resource-type [...]` komutu aşağıdaki türleri destekler ve her biri sonuçta oluşan erişim jetonunda belirli bir "aud" ekleyecektir:

{% hint style="danger" %}
Aşağıdakilerin yalnızca `az account get-access-token` tarafından desteklenen API'ler olduğunu unutmayın, ancak daha fazlası vardır.
{% endhint %}

* **aad-graph (Azure Active Directory Graph API)**: Uygulamaların Azure Active Directory (Azure AD) içindeki dizin verilerini okumasına ve yazmasına olanak tanıyan eski Azure AD Graph API'ye (kaldırılmış) erişmek için kullanılır.
* `https://graph.windows.net/`
* **arm (Azure Resource Manager)**: Azure kaynaklarını Azure Resource Manager API'si aracılığıyla yönetmek için kullanılır. Bu, sanal makineler, depolama hesapları ve daha fazlası gibi kaynakları oluşturma, güncelleme ve silme gibi işlemleri içerir.
* `https://management.core.windows.net/ or https://management.azure.com/`
* **batch (Azure Batch Services)**: Bulutta büyük ölçekli paralel ve yüksek performanslı hesaplama uygulamalarını verimli bir şekilde etkinleştiren Azure Batch'e erişmek için kullanılır.
* `https://batch.core.windows.net/`
* **data-lake (Azure Data Lake Storage)**: Ölçeklenebilir veri depolama ve analiz hizmeti olan Azure Data Lake Storage Gen1 ile etkileşimde bulunmak için kullanılır.
* `https://datalake.azure.net/`
* **media (Azure Media Services)**: Video ve ses içeriği için bulut tabanlı medya işleme ve dağıtım hizmetleri sağlayan Azure Media Services'e erişmek için kullanılır.
* `https://rest.media.azure.net`
* **ms-graph (Microsoft Graph API)**: Microsoft 365 hizmetleri verilerine erişmek için birleşik bir uç nokta olan Microsoft Graph API'ye erişmek için kullanılır. Azure AD, Office 365, Kurumsal Mobilite ve Güvenlik hizmetleri gibi hizmetlerden veri ve içgörülere erişmenizi sağlar.
* `https://graph.microsoft.com`
* **oss-rdbms (Azure Open Source Relational Databases)**: MySQL, PostgreSQL ve MariaDB gibi açık kaynaklı ilişkisel veritabanı motorları için Azure Veritabanı hizmetlerine erişmek için kullanılır.
* `https://ossrdbms-aad.database.windows.net`

Erişim jetonlarını talep etmenin ve bunlarla giriş yapmanın farklı yollarını öğrenmek için aşağıdaki sayfayı kontrol edin:

{% content-ref url="az-azuread/" %}
[az-azuread](az-azuread/)
{% endcontent-ref %}

## Referanslar

* [https://learn.microsoft.com/en-us/azure/governance/management-groups/overview](https://learn.microsoft.com/en-us/azure/governance/management-groups/overview)
* [https://learn.microsoft.com/en-us/azure/cloud-adoption-framework/ready/azure-best-practices/organize-subscriptions](https://learn.microsoft.com/en-us/azure/cloud-adoption-framework/ready/azure-best-practices/organize-subscriptions)
* [https://abouttmc.com/glossary/azure-subscription/#:\~:text=An%20Azure%20subscription%20is%20a,the%20subscription%20it%20belongs%20to.](https://abouttmc.com/glossary/azure-subscription/)
* [https://learn.microsoft.com/en-us/azure/role-based-access-control/overview#how-azure-rbac-determines-if-a-user-has-access-to-a-resource](https://learn.microsoft.com/en-us/azure/role-based-access-control/overview#how-azure-rbac-determines-if-a-user-has-access-to-a-resource)
* [https://stackoverflow.com/questions/65922566/what-are-the-differences-between-service-principal-and-app-registration](https://stackoverflow.com/questions/65922566/what-are-the-differences-between-service-principal-and-app-registration)

{% hint style="success" %}
AWS Hacking'i öğrenin ve pratik yapın:<img src="../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
GCP Hacking'i öğrenin ve pratik yapın: <img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**abonelik planlarını**](https://github.com/sponsors/carlospolop) kontrol edin!
* **💬 [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katılın ya da **Twitter'da** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**'i takip edin.**
* **Hacking ipuçlarını paylaşmak için** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna PR gönderin.

</details>
{% endhint %}
