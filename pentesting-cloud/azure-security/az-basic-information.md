# Az - Podstawowe informacje

{% hint style="success" %}
Ucz siÄ™ i Ä‡wicz Hacking AWS:<img src="../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Ucz siÄ™ i Ä‡wicz Hacking GCP: <img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Wsparcie dla HackTricks</summary>

* SprawdÅº [**plany subskrypcyjne**](https://github.com/sponsors/carlospolop)!
* **DoÅ‚Ä…cz do** ğŸ’¬ [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegram**](https://t.me/peass) lub **Å›ledÅº** nas na **Twitterze** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podziel siÄ™ sztuczkami hackingowymi, przesyÅ‚ajÄ…c PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repozytoriÃ³w github.

</details>
{% endhint %}

## Hierarchia organizacji

<figure><img src="../../.gitbook/assets/image (271).png" alt=""><figcaption></figcaption></figure>

### Grupy zarzÄ…dzajÄ…ce

JeÅ›li Twoja organizacja ma **wiele subskrypcji Azure**, moÅ¼esz potrzebowaÄ‡ sposobu na efektywne **zarzÄ…dzanie dostÄ™pem**, politykami i zgodnoÅ›ciÄ… dla tych **subskrypcji**. **Grupy zarzÄ…dzajÄ…ce** zapewniajÄ… **zakres zarzÄ…dzania ponad subskrypcjami**.

ZauwaÅ¼, Å¼e w jednej katalogu moÅ¼na obsÅ‚ugiwaÄ‡ **10 000 grup zarzÄ…dzajÄ…cych**, a drzewo grup zarzÄ…dzajÄ…cych moÅ¼e obsÅ‚ugiwaÄ‡ **do szeÅ›ciu poziomÃ³w gÅ‚Ä™bokoÅ›ci**.

<figure><img src="../../.gitbook/assets/image (147).png" alt=""><figcaption></figcaption></figure>

[Z dokumentacji](https://learn.microsoft.com/en-us/azure/governance/management-groups/overview#root-management-group-for-each-directory): KaÅ¼demu katalogowi przypisywana jest jedna **grupa zarzÄ…dzajÄ…ca najwyÅ¼szego poziomu zwana grupÄ… gÅ‚Ã³wnÄ…**. Grupa gÅ‚Ã³wna jest wbudowana w hierarchiÄ™, aby **wszystkie grupy zarzÄ…dzajÄ…ce i subskrypcje byÅ‚y do niej przypisane**. Ta grupa gÅ‚Ã³wna umoÅ¼liwia stosowanie **globalnych polityk i przypisaÅ„ rÃ³l Azure** na poziomie katalogu. [Azure AD **Global Administrator** musi poczÄ…tkowo podnieÅ›Ä‡ swoje uprawnienia](https://learn.microsoft.com/en-us/azure/role-based-access-control/elevate-access-global-admin) do **roli Administratora dostÄ™pu uÅ¼ytkownikÃ³w tej grupy gÅ‚Ã³wnej**. Po podniesieniu dostÄ™pu, administrator moÅ¼e **przypisaÄ‡ dowolnÄ… rolÄ™ Azure innym uÅ¼ytkownikom lub grupom katalogu, aby zarzÄ…dzaÄ‡ hierarchiÄ…**. Jako administrator moÅ¼esz przypisaÄ‡ **swoje wÅ‚asne konto jako wÅ‚aÅ›ciciela grupy gÅ‚Ã³wnej**.

Grupa gÅ‚Ã³wna **nie moÅ¼e byÄ‡ przenoszona ani usuwana**, w przeciwieÅ„stwie do innych grup zarzÄ…dzajÄ…cych.

Grupy zarzÄ…dzajÄ…ce zapewniajÄ… zarzÄ…dzanie na poziomie przedsiÄ™biorstwa w skali, niezaleÅ¼nie od rodzaju subskrypcji, ktÃ³re moÅ¼esz mieÄ‡. Jednak **wszystkie subskrypcje w jednej grupie zarzÄ…dzajÄ…cej** muszÄ… ufaÄ‡ **temu samemu dzierÅ¼awcy Azure Active Directory (Azure AD)**.

<figure><img src="../../.gitbook/assets/image (157).png" alt=""><figcaption></figcaption></figure>

### Subskrypcje Azure

W Azure subskrypcja sÅ‚uÅ¼y jako **logiczny kontener** w celu **provisioning** zasobÃ³w biznesowych lub technicznych. Ten kontener utrzymuje **szczegÃ³Å‚y zasobÃ³w** takich jak maszyny wirtualne (VM), bazy danych i inne. Przy tworzeniu zasobu Azure, takiego jak VM, okreÅ›la siÄ™ **subskrypcjÄ™ z nim powiÄ…zanÄ…**. Ta struktura uÅ‚atwia delegacjÄ™ dostÄ™pu, wykorzystujÄ…c mechanizmy kontroli dostÄ™pu oparte na rolach.

### Grupy zasobÃ³w

[Z dokumentacji:](https://learn.microsoft.com/en-us/azure/azure-resource-manager/management/manage-resource-groups-python?tabs=macos#what-is-a-resource-group) Grupa zasobÃ³w to **kontener**, ktÃ³ry przechowuje **powiÄ…zane zasoby** dla rozwiÄ…zania Azure. Grupa zasobÃ³w moÅ¼e zawieraÄ‡ wszystkie zasoby dla rozwiÄ…zania lub tylko te **zasoby, ktÃ³re chcesz zarzÄ…dzaÄ‡ jako grupÄ…**. Zazwyczaj dodawaj **zasoby**, ktÃ³re majÄ… **ten sam cykl Å¼ycia** do tej samej grupy zasobÃ³w, aby Å‚atwo je wdraÅ¼aÄ‡, aktualizowaÄ‡ i usuwaÄ‡ jako grupÄ™.

Wszystkie **zasoby** muszÄ… byÄ‡ **w obrÄ™bie grupy zasobÃ³w** i mogÄ… naleÅ¼eÄ‡ tylko do jednej grupy, a jeÅ›li grupa zasobÃ³w zostanie usuniÄ™ta, wszystkie zasoby w niej rÃ³wnieÅ¼ zostanÄ… usuniÄ™te.

### Jednostki administracyjne

[Z dokumentacji:](https://learn.microsoft.com/en-us/entra/identity/role-based-access-control/admin-units-manage) Jednostki administracyjne pozwalajÄ… na **podziaÅ‚** organizacji na **dowolne jednostki**, ktÃ³re chcesz, a nastÄ™pnie **przypisanie konkretnych administratorÃ³w**, ktÃ³rzy mogÄ… **zarzÄ…dzaÄ‡ tylko czÅ‚onkami** tej jednostki. Na przykÅ‚ad, moÅ¼esz uÅ¼yÄ‡ jednostek administracyjnych do delegowania uprawnieÅ„ administratorom kaÅ¼dej szkoÅ‚y na duÅ¼ym uniwersytecie, aby mogli kontrolowaÄ‡ dostÄ™p, zarzÄ…dzaÄ‡ uÅ¼ytkownikami i ustalaÄ‡ polityki tylko w Szkole InÅ¼ynierii.

Tylko **uÅ¼ytkownicy**, **grupy** i **urzÄ…dzenia** mogÄ… byÄ‡ **czÅ‚onkami** **jednostki administracyjnej**.

Dlatego **jednostka administracyjna** bÄ™dzie **zawieraÄ‡** pewnych **czÅ‚onkÃ³w**, a inne **podmioty** bÄ™dÄ… miaÅ‚y **przypisane uprawnienia do tej** jednostki administracyjnej, ktÃ³re mogÄ… wykorzystaÄ‡ do **zarzÄ…dzania czÅ‚onkami** jednostki administracyjnej.

## Azure vs Azure AD vs Azure AD Domain Services

WaÅ¼ne jest, aby zauwaÅ¼yÄ‡, Å¼e **Azure AD** to usÅ‚uga **wewnÄ…trz** **Azure**. **Azure** to **platforma chmurowa** Microsoftu, podczas gdy **Azure AD** to usÅ‚uga **toÅ¼samoÅ›ci** **przedsiÄ™biorstwa** w Azure.\
Ponadto, **Azure AD nie jest jak Windows Active Directory**, to usÅ‚uga toÅ¼samoÅ›ci, ktÃ³ra dziaÅ‚a w zupeÅ‚nie inny sposÃ³b. JeÅ›li chcesz uruchomiÄ‡ **kontroler domeny w Azure** dla swojego Å›rodowiska Windows Active Directory, musisz uÅ¼yÄ‡ **Azure AD Domain Services**.

## Podmioty

Azure obsÅ‚uguje rÃ³Å¼ne typy podmiotÃ³w:

* **UÅ¼ytkownik**: ZwykÅ‚a **osoba** z poÅ›wiadczeniami do dostÄ™pu.
* **Grupa**: **Grupa podmiotÃ³w** zarzÄ…dzana razem. **Uprawnienia** przyznane grupom sÄ… **dziedziczone** przez jej **czÅ‚onkÃ³w**.
* **Service Principal/Enterprise Applications**: To **toÅ¼samoÅ›Ä‡** stworzona do **uÅ¼ytku** z **aplikacjami**, usÅ‚ugami hostowanymi i narzÄ™dziami automatyzacyjnymi do uzyskiwania dostÄ™pu do zasobÃ³w Azure. Ten dostÄ™p jest **ograniczony przez przypisane role**, co daje Ci kontrolÄ™ nad **ktÃ³re zasoby mogÄ… byÄ‡ dostÄ™pne** i na jakim poziomie. Z powodÃ³w bezpieczeÅ„stwa zawsze zaleca siÄ™ **uÅ¼ywanie podmiotÃ³w usÅ‚ugowych z narzÄ™dziami automatycznymi**, zamiast pozwalaÄ‡ im logowaÄ‡ siÄ™ za pomocÄ… toÅ¼samoÅ›ci uÅ¼ytkownika.

Podczas tworzenia **podmiotu usÅ‚ugowego** moÅ¼esz wybraÄ‡ miÄ™dzy **uwierzytelnianiem hasÅ‚em** a **uwierzytelnianiem certyfikatem**.

* JeÅ›li wybierzesz uwierzytelnianie **hasÅ‚em** (domyÅ›lnie), **zapisz wygenerowane hasÅ‚o**, poniewaÅ¼ nie bÄ™dziesz mÃ³gÅ‚ uzyskaÄ‡ do niego dostÄ™pu ponownie.
* JeÅ›li wybierzesz uwierzytelnianie certyfikatem, upewnij siÄ™, Å¼e **aplikacja bÄ™dzie miaÅ‚a dostÄ™p do klucza prywatnego**.
* **ZarzÄ…dzana toÅ¼samoÅ›Ä‡ (Metadane poÅ›wiadczeÅ„)**: ZarzÄ…dzane toÅ¼samoÅ›ci w Azure Active Directory oferujÄ… rozwiÄ…zanie do **automatycznego zarzÄ…dzania toÅ¼samoÅ›ciÄ…** aplikacji. Te toÅ¼samoÅ›ci sÄ… uÅ¼ywane przez aplikacje w celu **Å‚Ä…czenia siÄ™** z **zasobami** zgodnymi z uwierzytelnianiem Azure Active Directory (**Azure AD**). DziÄ™ki wykorzystaniu zarzÄ…dzanych toÅ¼samoÅ›ci aplikacje mogÄ… **zabezpieczaÄ‡ tokeny Azure AD**, eliminujÄ…c potrzebÄ™ bezpoÅ›redniego zarzÄ…dzania poÅ›wiadczeniami. IstniejÄ… dwa typy zarzÄ…dzanych toÅ¼samoÅ›ci:
* **Przypisane do systemu**. NiektÃ³re usÅ‚ugi Azure pozwalajÄ… na **wÅ‚Ä…czenie zarzÄ…dzanej toÅ¼samoÅ›ci bezpoÅ›rednio na instancji usÅ‚ugi**. Gdy wÅ‚Ä…czysz zarzÄ…dzanÄ… toÅ¼samoÅ›Ä‡ przypisanÄ… do systemu, toÅ¼samoÅ›Ä‡ jest tworzona w Azure AD. ToÅ¼samoÅ›Ä‡ jest powiÄ…zana z **cyklem Å¼ycia tej instancji usÅ‚ugi**. Gdy **zasÃ³b** jest **usuwany**, Azure automatycznie **usuwa** **toÅ¼samoÅ›Ä‡** za Ciebie. Z zaÅ‚oÅ¼enia tylko ten zasÃ³b Azure moÅ¼e uÅ¼ywaÄ‡ tej toÅ¼samoÅ›ci do Å¼Ä…dania tokenÃ³w z Azure AD.
* **Przypisane przez uÅ¼ytkownika**. MoÅ¼esz rÃ³wnieÅ¼ stworzyÄ‡ zarzÄ…dzanÄ… toÅ¼samoÅ›Ä‡ jako samodzielny zasÃ³b Azure. MoÅ¼esz [utworzyÄ‡ zarzÄ…dzanÄ… toÅ¼samoÅ›Ä‡ przypisanÄ… przez uÅ¼ytkownika](https://learn.microsoft.com/en-us/azure/active-directory/managed-identities-azure-resources/how-to-manage-ua-identity-portal) i przypisaÄ‡ jÄ… do jednej lub **wiÄ™cej instancji** usÅ‚ugi Azure (wiele zasobÃ³w). W przypadku zarzÄ…dzanych toÅ¼samoÅ›ci przypisanych przez uÅ¼ytkownika, **toÅ¼samoÅ›Ä‡ jest zarzÄ…dzana oddzielnie od zasobÃ³w, ktÃ³re jej uÅ¼ywajÄ…**.

## Role i uprawnienia

**Role** sÄ… **przypisywane** do **podmiotÃ³w** w **zakresie**: `podmiot -[MA ROLÄ˜]->(zakres)`

**Role** przypisane do **grup** sÄ… **dziedziczone** przez wszystkich **czÅ‚onkÃ³w** grupy.

W zaleÅ¼noÅ›ci od zakresu, do ktÃ³rego przypisano rolÄ™, **rola** moÅ¼e byÄ‡ **dziedziczona** przez **inne zasoby** wewnÄ…trz kontenera zakresu. Na przykÅ‚ad, jeÅ›li uÅ¼ytkownik A ma **rolÄ™ w subskrypcji**, bÄ™dzie miaÅ‚ tÄ™ **rolÄ™ we wszystkich grupach zasobÃ³w** w subskrypcji i na **wszystkich zasobach** wewnÄ…trz grupy zasobÃ³w.

### **Klasyczne role**

| **WÅ‚aÅ›ciciel**                     | <ul><li>PeÅ‚ny dostÄ™p do wszystkich zasobÃ³w</li><li>MoÅ¼e zarzÄ…dzaÄ‡ dostÄ™pem dla innych uÅ¼ytkownikÃ³w</li></ul> | Wszystkie typy zasobÃ³w |
| ----------------------------- | ---------------------------------------------------------------------------------------- | ------------------ |
| **WspÃ³Å‚twÃ³rca**               | <ul><li>PeÅ‚ny dostÄ™p do wszystkich zasobÃ³w</li><li>Nie moÅ¼e zarzÄ…dzaÄ‡ dostÄ™pem</li></ul>              | Wszystkie typy zasobÃ³w |
| **Czytelnik**                    | â€¢ WyÅ›wietlanie wszystkich zasobÃ³w                                                                     | Wszystkie typy zasobÃ³w |
| **Administrator dostÄ™pu uÅ¼ytkownikÃ³w** | <ul><li>WyÅ›wietlanie wszystkich zasobÃ³w</li><li>MoÅ¼e zarzÄ…dzaÄ‡ dostÄ™pem dla innych uÅ¼ytkownikÃ³w</li></ul>           | Wszystkie typy zasobÃ³w |

### Wbudowane role

[Z dokumentacji: ](https://learn.microsoft.com/en-us/azure/role-based-access-control/built-in-roles)[Azure role-based access control (Azure RBAC)](https://learn.microsoft.com/en-us/azure/role-based-access-control/overview) ma kilka **wbudowanych rÃ³l** Azure, ktÃ³re moÅ¼esz **przypisaÄ‡** do **uÅ¼ytkownikÃ³w, grup, podmiotÃ³w usÅ‚ugowych i zarzÄ…dzanych toÅ¼samoÅ›ci**. Przypisania rÃ³l to sposÃ³b, w jaki kontrolujesz **dostÄ™p do zasobÃ³w Azure**. JeÅ›li wbudowane role nie speÅ‚niajÄ… specyficznych potrzeb Twojej organizacji, moÅ¼esz stworzyÄ‡ wÅ‚asne [**niestandardowe role Azure**](https://learn.microsoft.com/en-us/azure/role-based-access-control/custom-roles)**.**

**Wbudowane** role majÄ… zastosowanie tylko do **zasobÃ³w**, do ktÃ³rych sÄ… **przeznaczone**, na przykÅ‚ad sprawdÅº te 2 przykÅ‚ady **wbudowanych rÃ³l dla zasobÃ³w obliczeniowych**:

| [Czytelnik kopii zapasowej dysku](https://learn.microsoft.com/en-us/azure/role-based-access-control/built-in-roles#disk-backup-reader)                 | Zapewnia uprawnienia do kopii zapasowej w celu wykonania kopii zapasowej dysku.      | 3e5e47e6-65f7-47ef-90b5-e5dd4d455f24 |
| ----------------------------------------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------- | ------------------------------------ |
| [UÅ¼ytkownik logowania do maszyny wirtualnej](https://learn.microsoft.com/en-us/azure/role-based-access-control/built-in-roles#virtual-machine-user-login) | WyÅ›wietlanie maszyn wirtualnych w portalu i logowanie jako zwykÅ‚y uÅ¼ytkownik. | fb879df8-f326-4884-b1cf-06f3ad86be52 |

Te role mogÄ… **rÃ³wnieÅ¼ byÄ‡ przypisane do kontenerÃ³w logicznych** (takich jak grupy zarzÄ…dzajÄ…ce, subskrypcje i grupy zasobÃ³w), a podmioty, ktÃ³re sÄ… nimi objÄ™te, bÄ™dÄ… miaÅ‚y je **w odniesieniu do zasobÃ³w wewnÄ…trz tych kontenerÃ³w**.

* ZnajdÅº tutaj listÄ™ z [**wszystkimi wbudowanymi rolami Azure**](https://learn.microsoft.com/en-us/azure/role-based-access-control/built-in-roles).
* ZnajdÅº tutaj listÄ™ z [**wszystkimi wbudowanymi rolami Azure AD**](https://learn.microsoft.com/en-us/azure/active-directory/roles/permissions-reference).

### Niestandardowe role

Azure pozwala rÃ³wnieÅ¼ na tworzenie [**niestandardowych rÃ³l**](https://learn.microsoft.com/en-us/azure/role-based-access-control/custom-roles) z uprawnieniami, ktÃ³rych potrzebuje uÅ¼ytkownik.

### Odrzucone uprawnienia

* Aby **podmiot miaÅ‚ dostÄ™p do zasobu**, musi mieÄ‡ mu przyznanÄ… wyraÅºnÄ… rolÄ™ (w jakikolwiek sposÃ³b) **przyznajÄ…c mu to uprawnienie**.
* WyraÅºne **przypisanie roli odrzucajÄ…cej ma pierwszeÅ„stwo** przed rolÄ… przyznajÄ…cÄ… uprawnienie.

<figure><img src="../../.gitbook/assets/image (191).png" alt=""><figcaption></figcaption></figure>

### Globalny administrator

UÅ¼ytkownicy z rolÄ… Globalnego Administratora majÄ… moÅ¼liwoÅ›Ä‡ '**podniesienia' do roli Administratora dostÄ™pu uÅ¼ytkownikÃ³w w grupie gÅ‚Ã³wnej**. Oznacza to, Å¼e Globalny Administrator bÄ™dzie mÃ³gÅ‚ zarzÄ…dzaÄ‡ dostÄ™pem **do wszystkich subskrypcji Azure i grup zarzÄ…dzajÄ…cych.**\
To podniesienie moÅ¼na wykonaÄ‡ na koÅ„cu strony: [https://portal.azure.com/#view/Microsoft\_AAD\_IAM/ActiveDirectoryMenuBlade/\~/Properties](https://portal.azure.com/#view/Microsoft\_AAD\_IAM/ActiveDirectoryMenuBlade/\~/Properties)

<figure><img src="../../.gitbook/assets/image (162).png" alt=""><figcaption></figcaption></figure>

### Polityki Azure

Polityki Azure to zestaw **reguÅ‚ i regulacji w Microsoft Azure**, usÅ‚udze chmurowej, ktÃ³re pomagajÄ… zarzÄ…dzaÄ‡ i egzekwowaÄ‡ standardy organizacyjne oraz oceniaÄ‡ zgodnoÅ›Ä‡ na duÅ¼Ä… skalÄ™. Te polityki egzekwujÄ… rÃ³Å¼ne zasady dotyczÄ…ce Twoich **zasobÃ³w Azure**, zapewniajÄ…c, Å¼e te zasoby pozostajÄ… zgodne z normami korporacyjnymi i umowami o poziomie usÅ‚ug.

Polityki Azure sÄ… kluczowe dla zarzÄ…dzania chmurÄ… i bezpieczeÅ„stwa, pomagajÄ…c zapewniÄ‡, Å¼e zasoby sÄ… uÅ¼ywane prawidÅ‚owo i efektywnie oraz Å¼e sÄ… zgodne z regulacjami zewnÄ™trznymi i wewnÄ™trznymi politykami.\
Oto kilka przykÅ‚adÃ³w:

1. **Zapewnienie zgodnoÅ›ci z okreÅ›lonymi regionami Azure**: Ta polityka zapewnia, Å¼e wszystkie zasoby sÄ… wdraÅ¼ane w okreÅ›lonych regionach Azure. Na przykÅ‚ad, firma moÅ¼e chcieÄ‡ zapewniÄ‡, Å¼e wszystkie jej dane sÄ… przechowywane w Europie w celu zgodnoÅ›ci z RODO.
2. **Egzekwowanie standardÃ³w nazewnictwa**: Polityki mogÄ… egzekwowaÄ‡ konwencje nazewnictwa dla zasobÃ³w Azure. Pomaga to w organizacji i Å‚atwym identyfikowaniu zasobÃ³w na podstawie ich nazw, co jest pomocne w duÅ¼ych Å›rodowiskach.
3. **Ograniczenie niektÃ³rych typÃ³w zasobÃ³w**: Ta polityka moÅ¼e ograniczyÄ‡ tworzenie niektÃ³rych typÃ³w zasobÃ³w. Na przykÅ‚ad, polityka moÅ¼e byÄ‡ ustawiona, aby zapobiec tworzeniu drogich typÃ³w zasobÃ³w, takich jak niektÃ³re rozmiary VM, aby kontrolowaÄ‡ koszty.
4. **Egzekwowanie polityk tagowania**: Tagi to pary klucz-wartoÅ›Ä‡ powiÄ…zane z zasobami Azure uÅ¼ywane do zarzÄ…dzania zasobami. Polityki mogÄ… egzekwowaÄ‡, Å¼e okreÅ›lone tagi muszÄ… byÄ‡ obecne lub mieÄ‡ okreÅ›lone wartoÅ›ci dla wszystkich zasobÃ³w. To jest przydatne do Å›ledzenia kosztÃ³w, wÅ‚asnoÅ›ci lub kategoryzacji zasobÃ³w.
5. **Ograniczenie publicznego dostÄ™pu do zasobÃ³w**: Polityki mogÄ… egzekwowaÄ‡, Å¼e niektÃ³re zasoby, takie jak konta magazynowe lub bazy danych, nie majÄ… publicznych punktÃ³w koÅ„cowych, zapewniajÄ…c, Å¼e sÄ… dostÄ™pne tylko w sieci organizacji.
6. **Automatyczne stosowanie ustawieÅ„ zabezpieczeÅ„**: Polityki mogÄ… byÄ‡ uÅ¼ywane do automatycznego stosowania ustawieÅ„ zabezpieczeÅ„ do zasobÃ³w, takich jak stosowanie okreÅ›lonej grupy zabezpieczeÅ„ sieciowych do wszystkich VM lub zapewnienie, Å¼e wszystkie konta magazynowe uÅ¼ywajÄ… szyfrowania.

ZauwaÅ¼, Å¼e polityki Azure mogÄ… byÄ‡ przypisane do dowolnego poziomu hierarchii Azure, ale sÄ… **najczÄ™Å›ciej uÅ¼ywane w grupie gÅ‚Ã³wnej** lub w innych grupach zarzÄ…dzajÄ…cych.

### Zakres uprawnieÅ„

W Azure **uprawnienia mogÄ… byÄ‡ przypisane do dowolnej czÄ™Å›ci hierarchii**. Obejmuje to grupy zarzÄ…dzajÄ…ce, subskrypcje, grupy zasobÃ³w i poszczegÃ³lne zasoby. Uprawnienia sÄ… **dziedziczone** przez zawarte **zasoby** podmiotu, w ktÃ³rym zostaÅ‚y przypisane.

Ta hierarchiczna struktura pozwala na efektywne i skalowalne zarzÄ…dzanie uprawnieniami dostÄ™pu.

<figure><img src="../../.gitbook/assets/image (26).png" alt=""><figcaption></figcaption></figure>

### Azure RBAC vs ABAC

**RBAC** (kontrola dostÄ™pu oparta na rolach) to to, co juÅ¼ widzieliÅ›my w poprzednich sekcjach: **Przypisanie roli do podmiotu, aby przyznaÄ‡ mu dostÄ™p** do zasobu.\
Jednak w niektÃ³rych przypadkach moÅ¼esz chcieÄ‡ zapewniÄ‡ **bardziej szczegÃ³Å‚owe zarzÄ…dzanie dostÄ™pem** lub **uproszczenie** zarzÄ…dzania **setkami** przypisaÅ„ rÃ³l.

Azure **ABAC** (kontrola dostÄ™pu oparta na atrybutach) opiera siÄ™ na Azure RBAC, dodajÄ…c **warunki przypisania rÃ³l oparte na atrybutach** w kontekÅ›cie okreÅ›lonych dziaÅ‚aÅ„. Warunek _przypisania roli_ to **dodatkowa kontrola, ktÃ³rÄ… moÅ¼esz opcjonalnie dodaÄ‡ do przypisania roli**, aby zapewniÄ‡ bardziej szczegÃ³Å‚owÄ… kontrolÄ™ dostÄ™pu. Warunek filtruje uprawnienia przyznane jako czÄ™Å›Ä‡ definicji roli i przypisania roli. Na przykÅ‚ad, moÅ¼esz **dodaÄ‡ warunek, ktÃ³ry wymaga, aby obiekt miaÅ‚ okreÅ›lony tag, aby go odczytaÄ‡**.\
Nie moÅ¼esz wyraÅºnie **odrzuciÄ‡** **dostÄ™pu** do okreÅ›lonych zasobÃ³w **za pomocÄ… warunkÃ³w**.

### DomyÅ›lne uprawnienia uÅ¼ytkownika

Podstawowy uÅ¼ytkownik bÄ™dzie miaÅ‚ pewne **domyÅ›lne uprawnienia** do enumeracji niektÃ³rych czÄ™Å›ci AzureAD:

* Odczyt wszystkich uÅ¼ytkownikÃ³w, grup, aplikacji, urzÄ…dzeÅ„, rÃ³l, subskrypcji i ich publicznych wÅ‚aÅ›ciwoÅ›ci
* Zapraszanie goÅ›ci (_moÅ¼e byÄ‡ wyÅ‚Ä…czone_)
* Tworzenie grup zabezpieczeÅ„
* Odczyt nieukrytych czÅ‚onkostw grup
* Dodawanie goÅ›ci do posiadanych grup
* Tworzenie nowej aplikacji (_moÅ¼e byÄ‡ wyÅ‚Ä…czone_)
* Dodawanie do 50 urzÄ…dzeÅ„ do Azure (_moÅ¼e byÄ‡ wyÅ‚Ä…czone_)

MoÅ¼esz zobaczyÄ‡ peÅ‚nÄ… [listÄ™ **domyÅ›lnych uprawnieÅ„ uÅ¼ytkownikÃ³w** w dokumentacji](https://learn.microsoft.com/en-us/azure/active-directory/fundamentals/users-default-permissions). Ponadto zauwaÅ¼, Å¼e na tej liÅ›cie moÅ¼esz rÃ³wnieÅ¼ zobaczyÄ‡ **listÄ™ domyÅ›lnych uprawnieÅ„ goÅ›ci**.

{% hint style="info" %}
PamiÄ™taj, Å¼e aby enumerowaÄ‡ zasoby Azure, uÅ¼ytkownik potrzebuje wyraÅºnego przyznania uprawnienia.
{% endhint %}

### ZarzÄ…dzanie toÅ¼samoÅ›ciami uprzywilejowanymi (PIM)

ZarzÄ…dzanie toÅ¼samoÅ›ciami uprzywilejowanymi (PIM) w Azure to narzÄ™dzie, ktÃ³re **zarzÄ…dza, kontroluje i monitoruje uprzywilejowany dostÄ™p** w Azure Active Directory i Azure. ZwiÄ™ksza bezpieczeÅ„stwo, zapewniajÄ…c **dostÄ™p uprzywilejowany na Å¼Ä…danie i ograniczony czasowo**, **egzekwujÄ…c procesy zatwierdzania i wymagajÄ…c dodatkowej autoryzacji**. Takie podejÅ›cie minimalizuje ryzyko nieautoryzowanego dostÄ™pu, zapewniajÄ…c, Å¼e podwyÅ¼szone uprawnienia sÄ… przyznawane tylko wtedy, gdy jest to konieczne i na okreÅ›lony czas.

## Tokeny uwierzytelniajÄ…ce

IstniejÄ… **trzy typy tokenÃ³w** uÅ¼ywanych w OIDC:

* [**Tokeny dostÄ™pu**](https://learn.microsoft.com/en-us/azure/active-directory/develop/access-tokens)**:** Klient przedstawia ten token serwerowi zasobÃ³w, aby **uzyskaÄ‡ dostÄ™p do zasobÃ³w**. MoÅ¼e byÄ‡ uÅ¼ywany tylko dla okreÅ›lonej kombinacji uÅ¼ytkownika, klienta i zasobu i **nie moÅ¼e byÄ‡ uniewaÅ¼niony** do momentu wygaÅ›niÄ™cia - co trwa 1 godzinÄ™ domyÅ›lnie. WykrywalnoÅ›Ä‡ jest niska przy uÅ¼yciu tego.
* **Tokeny ID**: Klient otrzymuje ten **token od serwera autoryzacji**. Zawiera podstawowe informacje o uÅ¼ytkowniku. Jest **powiÄ…zany z okreÅ›lonÄ… kombinacjÄ… uÅ¼ytkownika i klienta**.
* **Tokeny odÅ›wieÅ¼ania**: Przyznawane klientowi wraz z tokenem dostÄ™pu. UÅ¼ywane do **uzyskiwania nowych tokenÃ³w dostÄ™pu i ID**. Jest powiÄ…zany z okreÅ›lonÄ… kombinacjÄ… uÅ¼ytkownika i klienta i moÅ¼e byÄ‡ uniewaÅ¼niony. DomyÅ›lne wygaÅ›niÄ™cie to **90 dni** dla nieaktywnych tokenÃ³w odÅ›wieÅ¼ania i **brak wygaÅ›niÄ™cia dla aktywnych tokenÃ³w**.

{% hint style="warning" %}
Informacje o **dostÄ™pie warunkowym** sÄ… **przechowywane** wewnÄ…trz **JWT**. WiÄ™c, jeÅ›li Å¼Ä…dasz **tokena z dozwolonego adresu IP**, ten **adres IP** zostanie **przechowany** w tokenie, a nastÄ™pnie moÅ¼esz uÅ¼yÄ‡ tego tokena z **niedozwolonego adresu IP, aby uzyskaÄ‡ dostÄ™p do zasobÃ³w**.
{% endhint %}

SprawdÅº nastÄ™pujÄ…cÄ… stronÄ™, aby poznaÄ‡ rÃ³Å¼ne sposoby **Å¼Ä…dania tokenÃ³w dostÄ™pu** i logowania siÄ™ z nimi:

{% content-ref url="az-azuread/" %}
[az-azuread](az-azuread/)
{% endcontent-ref %}

NajczÄ™stsze punkty koÅ„cowe API to:

* **Azure Resource Manager** (ARM): management.azure.com
* **Microsoft Graph**: graph.microsoft.com (Azure AD Graph, ktÃ³ry jest przestarzaÅ‚y, to graph.windows.net)

## OdnoÅ›niki

* [https://learn.microsoft.com/en-us/azure/governance/management-groups/overview](https://learn.microsoft.com/en-us/azure/governance/management-groups/overview)
* [https://learn.microsoft.com/en-us/azure/cloud-adoption-framework/ready/azure-best-practices/organize-subscriptions](https://learn.microsoft.com/en-us/azure/cloud-adoption-framework/ready/azure-best-practices/organize-subscriptions)
* [https://abouttmc.com/glossary/azure-subscription/#:\~:text=An%20Azure%20subscription%20is%20a,the%20subscription%20it%20belongs%20to.](https://abouttmc.com/glossary/azure-subscription/)
* [https://learn.microsoft.com/en-us/azure/role-based-access-control/overview#how-azure-rbac-determines-if-a-user-has-access-to-a-resource](https://learn.microsoft.com/en-us/azure/role-based-access-control/overview#how-azure-rbac-determines-if-a-user-has-access-to-a-resource)

{% hint style="success" %}
Ucz siÄ™ i Ä‡wicz Hacking AWS:<img src="../../.gitbook/assets/image (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/image (1).png" alt="" data-size="line">\
Ucz siÄ™ i Ä‡wicz Hacking GCP: <img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Wsparcie dla HackTricks</summary>

* SprawdÅº [**plany subskrypcyjne**](https://github.com/sponsors/carlospolop)!
* **DoÅ‚Ä…cz do** ğŸ’¬ [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegram**](https://t.me/peass) lub **Å›ledÅº** nas na **Twitterze** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podziel siÄ™ sztuczkami hackingowymi, przesyÅ‚ajÄ…c PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repozytoriÃ³w github.

</details>
{% endhint %}
