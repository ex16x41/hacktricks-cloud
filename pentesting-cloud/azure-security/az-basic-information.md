# Az - Basic Information

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Organization Hierarchy

<figure><img src="../../.gitbook/assets/image (271).png" alt=""><figcaption></figcaption></figure>

### Management Groups

JeÅ›li Twoja organizacja ma **wiele subskrypcji Azure**, moÅ¼esz potrzebowaÄ‡ sposobu na efektywne **zarzÄ…dzanie dostÄ™pem**, politykami i zgodnoÅ›ciÄ… dla tych **subskrypcji**. **Grupy zarzÄ…dzania** zapewniajÄ… **zakres zarzÄ…dzania powyÅ¼ej subskrypcji**.

NaleÅ¼y zauwaÅ¼yÄ‡, Å¼e **10 000 grup zarzÄ…dzania** moÅ¼e byÄ‡ obsÅ‚ugiwanych w jednym katalogu, a drzewo grup zarzÄ…dzania moÅ¼e obsÅ‚ugiwaÄ‡ **do szeÅ›ciu poziomÃ³w gÅ‚Ä™bokoÅ›ci**.

<figure><img src="../../.gitbook/assets/image (147).png" alt=""><figcaption></figcaption></figure>

[Z dokumentacji](https://learn.microsoft.com/en-us/azure/governance/management-groups/overview#root-management-group-for-each-directory): KaÅ¼dy katalog otrzymuje jednÄ… **grupÄ™ zarzÄ…dzania najwyÅ¼szego poziomu, zwanÄ… grupÄ… gÅ‚Ã³wnÄ…**. Grupa gÅ‚Ã³wna jest wbudowana w hierarchiÄ™, aby **wszystkie grupy zarzÄ…dzania i subskrypcje byÅ‚y do niej przypisane**. Ta grupa gÅ‚Ã³wna umoÅ¼liwia stosowanie **globalnych polityk i przypisywanie rÃ³l Azure** na poziomie katalogu. [Azure AD **Global Administrator** musi podnieÅ›Ä‡ swoje uprawnienia](https://learn.microsoft.com/en-us/azure/role-based-access-control/elevate-access-global-admin) do roli **User Access Administrator tej grupy gÅ‚Ã³wnej** poczÄ…tkowo. Po podniesieniu uprawnieÅ„, administrator moÅ¼e **przypisywaÄ‡ dowolne role Azure innym uÅ¼ytkownikom lub grupom katalogu do zarzÄ…dzania hierarchiÄ…**. Jako administrator, moÅ¼esz przypisaÄ‡ **swoje wÅ‚asne konto jako wÅ‚aÅ›ciciela grupy gÅ‚Ã³wnej**.

Grupa gÅ‚Ã³wna **nie moÅ¼e byÄ‡ przenoszona ani usuwana**, w przeciwieÅ„stwie do innych grup zarzÄ…dzania.

Grupy zarzÄ…dzania zapewniajÄ… zarzÄ…dzanie na poziomie przedsiÄ™biorstwa, niezaleÅ¼nie od rodzaju posiadanych subskrypcji. Jednak **wszystkie subskrypcje w jednej grupie zarzÄ…dzania** muszÄ… ufaÄ‡ **temu samemu tenantowi Azure Active Directory (Azure AD)**.

<figure><img src="../../.gitbook/assets/image (157).png" alt=""><figcaption></figcaption></figure>

### Azure Subscriptions

W Azure, subskrypcja sÅ‚uÅ¼y jako **logiczny kontener** do celÃ³w **udostÄ™pniania** zasobÃ³w biznesowych lub technicznych. Ten kontener utrzymuje **szczegÃ³Å‚y zasobÃ³w** takich jak maszyny wirtualne (VM), bazy danych i inne. Przy tworzeniu zasobu Azure, takiego jak VM, okreÅ›lana jest **subskrypcja z nim zwiÄ…zana**. Ta struktura uÅ‚atwia delegowanie dostÄ™pu, wykorzystujÄ…c mechanizmy kontroli dostÄ™pu oparte na rolach.

### Resource Groups

[Z dokumentacji:](https://learn.microsoft.com/en-us/azure/azure-resource-manager/management/manage-resource-groups-python?tabs=macos#what-is-a-resource-group) Grupa zasobÃ³w to **kontener**, ktÃ³ry przechowuje **powiÄ…zane zasoby** dla rozwiÄ…zania Azure. Grupa zasobÃ³w moÅ¼e zawieraÄ‡ wszystkie zasoby dla rozwiÄ…zania lub tylko te **zasoby, ktÃ³rymi chcesz zarzÄ…dzaÄ‡ jako grupÄ…**. Zazwyczaj dodaj **zasoby**, ktÃ³re majÄ… **ten sam cykl Å¼ycia** do tej samej grupy zasobÃ³w, aby Å‚atwo je wdraÅ¼aÄ‡, aktualizowaÄ‡ i usuwaÄ‡ jako grupÄ™.

Wszystkie **zasoby** muszÄ… byÄ‡ **wewnÄ…trz grupy zasobÃ³w** i mogÄ… naleÅ¼eÄ‡ tylko do jednej grupy, a jeÅ›li grupa zasobÃ³w zostanie usuniÄ™ta, wszystkie zasoby w niej rÃ³wnieÅ¼ zostanÄ… usuniÄ™te.

### Administrative Units

[Z dokumentacji:](https://learn.microsoft.com/en-us/entra/identity/role-based-access-control/admin-units-manage) Jednostki administracyjne pozwalajÄ… **podzieliÄ‡** organizacjÄ™ na **dowolne jednostki**, ktÃ³re chcesz, a nastÄ™pnie **przypisaÄ‡ okreÅ›lonych administratorÃ³w**, ktÃ³rzy mogÄ… **zarzÄ…dzaÄ‡ tylko czÅ‚onkami** tej jednostki. Na przykÅ‚ad, moÅ¼esz uÅ¼yÄ‡ jednostek administracyjnych do delegowania uprawnieÅ„ administratorom kaÅ¼dej szkoÅ‚y na duÅ¼ym uniwersytecie, aby mogli kontrolowaÄ‡ dostÄ™p, zarzÄ…dzaÄ‡ uÅ¼ytkownikami i ustawiaÄ‡ polityki tylko w Szkole InÅ¼ynierii.

Tylko **uÅ¼ytkownicy**, **grupy** i **urzÄ…dzenia** mogÄ… byÄ‡ **czÅ‚onkami** jednostki administracyjnej.

Dlatego jednostka administracyjna bÄ™dzie **zawieraÄ‡** pewnych **czÅ‚onkÃ³w**, a inni **pryncypaÅ‚owie** bÄ™dÄ… mieli **przypisane uprawnienia do tej** jednostki administracyjnej, ktÃ³re mogÄ… wykorzystaÄ‡ do **zarzÄ…dzania czÅ‚onkami** jednostki administracyjnej.

## Azure vs Azure AD vs Azure AD Domain Services

WaÅ¼ne jest, aby zauwaÅ¼yÄ‡, Å¼e **Azure AD** to usÅ‚uga **wewnÄ…trz** **Azure**. **Azure** to platforma chmurowa Microsoftu, podczas gdy **Azure AD** to usÅ‚uga **toÅ¼samoÅ›ci** przedsiÄ™biorstwa w Azure.\
Ponadto, **Azure AD nie jest jak Windows Active Directory**, to usÅ‚uga toÅ¼samoÅ›ci, ktÃ³ra dziaÅ‚a w zupeÅ‚nie inny sposÃ³b. JeÅ›li chcesz uruchomiÄ‡ **Domain Controller w Azure** dla swojego Å›rodowiska Windows Active Directory, musisz uÅ¼yÄ‡ **Azure AD Domain Services**.

## Principals

Azure obsÅ‚uguje rÃ³Å¼ne typy pryncypaÅ‚Ã³w:

* **User**: ZwykÅ‚a **osoba** z poÅ›wiadczeniami do dostÄ™pu.
* **Group**: **Grupa pryncypaÅ‚Ã³w** zarzÄ…dzana razem. **Uprawnienia** przyznane grupom sÄ… **dziedziczone** przez jej **czÅ‚onkÃ³w**.
* **Service Principal/Enterprise Applications**: To **toÅ¼samoÅ›Ä‡** stworzona do **uÅ¼ytku** z **aplikacjami**, usÅ‚ugami hostowanymi i narzÄ™dziami automatyzacji do dostÄ™pu do zasobÃ³w Azure. Ten dostÄ™p jest **ograniczony przez role przypisane** do service principal, dajÄ…c kontrolÄ™ nad **ktÃ³re zasoby mogÄ… byÄ‡ dostÄ™pne** i na jakim poziomie. Ze wzglÄ™dÃ³w bezpieczeÅ„stwa zawsze zaleca siÄ™ **uÅ¼ywanie service principals z narzÄ™dziami automatyzacji** zamiast pozwalania im na logowanie siÄ™ za pomocÄ… toÅ¼samoÅ›ci uÅ¼ytkownika.

Podczas tworzenia **service principal** moÅ¼esz wybraÄ‡ miÄ™dzy **uwierzytelnianiem hasÅ‚em** a **uwierzytelnianiem certyfikatem**.

* JeÅ›li wybierzesz **uwierzytelnianie hasÅ‚em** (domyÅ›lnie), **zapisz wygenerowane hasÅ‚o**, poniewaÅ¼ nie bÄ™dziesz mÃ³gÅ‚ go ponownie uzyskaÄ‡.
* JeÅ›li wybierzesz uwierzytelnianie certyfikatem, upewnij siÄ™, Å¼e **aplikacja bÄ™dzie miaÅ‚a dostÄ™p do klucza prywatnego**.
* **Managed Identity (Metadata Creds)**: ZarzÄ…dzane toÅ¼samoÅ›ci w Azure Active Directory oferujÄ… rozwiÄ…zanie do **automatycznego zarzÄ…dzania toÅ¼samoÅ›ciÄ…** aplikacji. Te toÅ¼samoÅ›ci sÄ… uÅ¼ywane przez aplikacje do **Å‚Ä…czenia siÄ™** z **zasobami** zgodnymi z uwierzytelnianiem Azure Active Directory (**Azure AD**). KorzystajÄ…c z zarzÄ…dzanych toÅ¼samoÅ›ci, aplikacje mogÄ… **zabezpieczaÄ‡ tokeny Azure AD**, eliminujÄ…c potrzebÄ™ bezpoÅ›redniego zarzÄ…dzania poÅ›wiadczeniami. IstniejÄ… dwa rodzaje zarzÄ…dzanych toÅ¼samoÅ›ci:
* **System-assigned**. NiektÃ³re usÅ‚ugi Azure pozwalajÄ… na **wÅ‚Ä…czenie zarzÄ…dzanej toÅ¼samoÅ›ci bezpoÅ›rednio na instancji usÅ‚ugi**. Gdy wÅ‚Ä…czysz system-assigned managed identity, toÅ¼samoÅ›Ä‡ jest tworzona w Azure AD. ToÅ¼samoÅ›Ä‡ jest powiÄ…zana z **cyklem Å¼ycia tej instancji usÅ‚ugi**. Gdy **zasÃ³b** jest **usuwany**, Azure automatycznie **usuwa** **toÅ¼samoÅ›Ä‡** za Ciebie. Z zaÅ‚oÅ¼enia tylko ten zasÃ³b Azure moÅ¼e uÅ¼ywaÄ‡ tej toÅ¼samoÅ›ci do Å¼Ä…dania tokenÃ³w z Azure AD.
* **User-assigned**. MoÅ¼esz rÃ³wnieÅ¼ utworzyÄ‡ zarzÄ…dzanÄ… toÅ¼samoÅ›Ä‡ jako samodzielny zasÃ³b Azure. MoÅ¼esz [utworzyÄ‡ user-assigned managed identity](https://learn.microsoft.com/en-us/azure/active-directory/managed-identities-azure-resources/how-to-manage-ua-identity-portal) i przypisaÄ‡ jÄ… do jednej lub **wiÄ™cej instancji** usÅ‚ugi Azure (wiele zasobÃ³w). Dla user-assigned managed identities, **toÅ¼samoÅ›Ä‡ jest zarzÄ…dzana oddzielnie od zasobÃ³w, ktÃ³re jej uÅ¼ywajÄ…**.

## Roles & Permissions

**Role** sÄ… **przypisywane** do **pryncypaÅ‚Ã³w** na **zakresie**: `principal -[HAS ROLE]->(scope)`

**Role** przypisane do **grup** sÄ… **dziedziczone** przez wszystkich **czÅ‚onkÃ³w** grupy.

W zaleÅ¼noÅ›ci od zakresu, do ktÃ³rego przypisano rolÄ™, **rola** moÅ¼e byÄ‡ **dziedziczona** przez **inne zasoby** wewnÄ…trz kontenera zakresu. Na przykÅ‚ad, jeÅ›li uÅ¼ytkownik A ma **rolÄ™ na subskrypcji**, bÄ™dzie miaÅ‚ tÄ™ **rolÄ™ na wszystkich grupach zasobÃ³w** wewnÄ…trz subskrypcji i na **wszystkich zasobach** wewnÄ…trz grupy zasobÃ³w.

### **Classic Roles**

| **Owner**                     | <ul><li>PeÅ‚ny dostÄ™p do wszystkich zasobÃ³w</li><li>MoÅ¼e zarzÄ…dzaÄ‡ dostÄ™pem dla innych uÅ¼ytkownikÃ³w</li></ul> | Wszystkie typy zasobÃ³w |
| ----------------------------- | ---------------------------------------------------------------------------------------- | ------------------ |
| **Contributor**               | <ul><li>PeÅ‚ny dostÄ™p do wszystkich zasobÃ³w</li><li>Nie moÅ¼e zarzÄ…dzaÄ‡ dostÄ™pem</li></ul>              | Wszystkie typy zasobÃ³w |
| **Reader**                    | â€¢ PrzeglÄ…danie wszystkich zasobÃ³w                                                                     | Wszystkie typy zasobÃ³w |
| **User Access Administrator** | <ul><li>PrzeglÄ…danie wszystkich zasobÃ³w</li><li>MoÅ¼e zarzÄ…dzaÄ‡ dostÄ™pem dla innych uÅ¼ytkownikÃ³w</li></ul>           | Wszystkie typy zasobÃ³w |

### Built-In roles

[Z dokumentacji: ](https://learn.microsoft.com/en-us/azure/role-based-access-control/built-in-roles)[Azure role-based access control (Azure RBAC)](https://learn.microsoft.com/en-us/azure/role-based-access-control/overview) ma kilka **wbudowanych rÃ³l Azure**, ktÃ³re moÅ¼esz **przypisaÄ‡** do **uÅ¼ytkownikÃ³w, grup, service principals i managed identities**. Przypisania rÃ³l to sposÃ³b, w jaki kontrolujesz **dostÄ™p do zasobÃ³w Azure**. JeÅ›li wbudowane role nie speÅ‚niajÄ… specyficznych potrzeb Twojej organizacji, moÅ¼esz stworzyÄ‡ wÅ‚asne [**custom roles Azure**](https://learn.microsoft.com/en-us/azure/role-based-access-control/custom-roles)**.**

**Wbudowane** role dotyczÄ… tylko **zasobÃ³w**, do ktÃ³rych sÄ… **przeznaczone**, na przykÅ‚ad sprawdÅº te 2 przykÅ‚ady **wbudowanych rÃ³l dla zasobÃ³w Compute**:

| [Disk Backup Reader](https://learn.microsoft.com/en-us/azure/role-based-access-control/built-in-roles#disk-backup-reader)                 | Zapewnia uprawnienia do backup vault do wykonywania kopii zapasowych dyskÃ³w.      | 3e5e47e6-65f7-47ef-90b5-e5dd4d455f24 |
| ----------------------------------------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------- | ------------------------------------ |
| [Virtual Machine User Login](https://learn.microsoft.com/en-us/azure/role-based-access-control/built-in-roles#virtual-machine-user-login) | PrzeglÄ…danie maszyn wirtualnych w portalu i logowanie siÄ™ jako zwykÅ‚y uÅ¼ytkownik. | fb879df8-f326-4884-b1cf-06f3ad86be52 |

Te role mogÄ… byÄ‡ **rÃ³wnieÅ¼ przypisane do logicznych kontenerÃ³w** (takich jak grupy zarzÄ…dzania, subskrypcje i grupy zasobÃ³w), a pryncypaÅ‚owie, ktÃ³rych to dotyczy, bÄ™dÄ… mieli je **nad zasobami wewnÄ…trz tych kontenerÃ³w**.

* ZnajdÅº tutaj listÄ™ [**wszystkich wbudowanych rÃ³l Azure**](https://learn.microsoft.com/en-us/azure/role-based-access-control/built-in-roles).
* ZnajdÅº tutaj listÄ™ [**wszystkich wbudowanych rÃ³l Azure AD**](https://learn.microsoft.com/en-us/azure/active-directory/roles/permissions-reference).

### Custom Roles

Azure pozwala rÃ³wnieÅ¼ na tworzenie [**custom roles**](https://learn.microsoft.com/en-us/azure/role-based-access-control/custom-roles) z uprawnieniami, ktÃ³rych potrzebuje uÅ¼ytkownik.

### Permission Denied

* Aby **pryncypaÅ‚ miaÅ‚ dostÄ™p do zasobu**, potrzebuje wyraÅºnego przypisania roli, ktÃ³ra **przyznaje mu to uprawnienie**.
* WyraÅºne **przypisanie roli odmowy ma pierwszeÅ„stwo** przed rolÄ… przyznajÄ…cÄ… uprawnienie.

<figure><img src="../../.gitbook/assets/image (191).png" alt=""><figcaption></figcaption></figure>

### Global Administrator

UÅ¼ytkownicy z rolÄ… Global Administrator majÄ… moÅ¼liwoÅ›Ä‡ '**podniesienia' do roli User Access Administrator Azure do grupy gÅ‚Ã³wnej**. Oznacza to, Å¼e Global Administrator bÄ™dzie mÃ³gÅ‚ zarzÄ…dzaÄ‡ dostÄ™pem **do wszystkich subskrypcji Azure i grup zarzÄ…dzania.**\
To podniesienie moÅ¼na wykonaÄ‡ na koÅ„cu strony: [https://portal.azure.com/#view/Microsoft\_AAD\_IAM/ActiveDirectoryMenuBlade/\~/Properties](https://portal.azure.com/#view/Microsoft\_AAD\_IAM/ActiveDirectoryMenuBlade/\~/Properties)

<figure><img src="../../.gitbook/assets/image (162).png" alt=""><figcaption></figcaption></figure>

### Azure Policies

Polityki Azure to zestaw **zasad i regulacji w Microsoft Azure**, usÅ‚udze chmurowej, ktÃ³re pomagajÄ… zarzÄ…dzaÄ‡ i egzekwowaÄ‡ standardy organizacyjne oraz oceniaÄ‡ zgodnoÅ›Ä‡ na duÅ¼Ä… skalÄ™. Te polityki egzekwujÄ… rÃ³Å¼ne zasady nad Twoimi **zasobami Azure**, zapewniajÄ…c, Å¼e te zasoby pozostajÄ… zgodne z korporacyjnymi standardami i umowami o poziomie usÅ‚ug.

Polityki Azure sÄ… kluczowe dla zarzÄ…dzania chmurÄ… i bezpieczeÅ„stwa, pomagajÄ…c zapewniÄ‡, Å¼e zasoby sÄ… uÅ¼ywane prawidÅ‚owo i efektywnie oraz Å¼e sÄ… zgodne z zewnÄ™trznymi regulacjami i wewnÄ™trznymi politykami.\
PrzykÅ‚ady:

1. **Zapewnienie zgodnoÅ›ci z okreÅ›lonymi regionami Azure**: Ta polityka zapewnia, Å¼e wszystkie zasoby sÄ… wdraÅ¼ane w okreÅ›lonych regionach Azure. Na przykÅ‚ad firma moÅ¼e chcieÄ‡, aby wszystkie jej dane byÅ‚y przechowywane w Europie dla zgodnoÅ›ci z GDPR.
2. **Egzekwowanie standardÃ³w nazewnictwa**: Polityki mogÄ… egzekwowaÄ‡ konwencje nazewnictwa dla zasobÃ³w Azure. Pomaga to w organizacji i Å‚atwej identyfikacji zasobÃ³w na podstawie ich nazw, co jest pomocne w duÅ¼ych Å›rodowiskach.
3. **Ograniczanie okreÅ›lonych typÃ³w zasobÃ³w**: Ta polityka moÅ¼e ograniczaÄ‡ tworzenie okreÅ›lonych typÃ³w zasobÃ³w. Na przykÅ‚ad, polityka moÅ¼e byÄ‡ ustawiona, aby zapobiec tworzeniu drogich typÃ³w zasobÃ³w, takich jak okreÅ›lone rozmiary VM, w celu kontrolowania kosztÃ³w.
4. **Egzekwowanie polityk tagowania**: Tagowanie to pary klucz-wartoÅ›Ä‡ powiÄ…zane z zasobami Azure uÅ¼ywane do zarzÄ…dzania zasobami. Polityki mogÄ… egzekwowaÄ‡, Å¼e okreÅ›lone tagi muszÄ… byÄ‡ obecne lub mieÄ‡ okreÅ›lone wartoÅ›ci dla wszystkich zas
