# Az - Basiese Inligting

{% hint style="success" %}
Leer & oefen AWS Hacking:<img src="../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">[**HackTricks Opleiding AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">\
Leer & oefen GCP Hacking: <img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Opleiding GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Ondersteun HackTricks</summary>

* Kyk na die [**subskripsie planne**](https://github.com/sponsors/carlospolop)!
* **Sluit aan by die** üí¨ [**Discord groep**](https://discord.gg/hRep4RUj7f) of die [**telegram groep**](https://t.me/peass) of **volg** ons op **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Deel hacking truuks deur PRs in te dien na die** [**HackTricks**](https://github.com/carlospolop/hacktricks) en [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Organisasie Hi√´rargie

<figure><img src="https://lh7-rt.googleusercontent.com/slidesz/AGV_vUchBvhjIdWWR2ldAkWiZMdmrcEYD9Ti5UAa3zAGr9YbAnx4Q_gZNp_zvOU429vgWZ_ixoYHQKdC8bGgkhWYCy591SRIFj6RKCj4BEpVQixAGsp3T3O5sS3k7x5CTaJ-SCBNC7i5KluLyxdiXoZsH1F0ko1Gv88=s2048?key=gSyKQr3HTyhvHa28Rf7LVA" alt=""><figcaption></figcaption></figure>

### Bestuur Groepe

* Dit kan **ander bestuur groepe of subskripsies** bevat.
* Dit stel in staat om **governance kontroles** soos RBAC en Azure Beleid een keer op die bestuur groep vlak toe te pas en dit te **erf** deur al die subskripsies in die groep.
* **10,000 bestuur** groepe kan in 'n enkele gids ondersteun word.
* 'n Bestuur groep boom kan **tot ses vlakke diepte** ondersteun. Hierdie limiet sluit nie die wortelvlak of die subskripsie vlak in nie.
* Elke bestuur groep en subskripsie kan **slegs een ouer** ondersteun.
* Alhoewel verskeie bestuur groepe geskep kan word, is daar **slegs 1 wortel bestuur groep**.
* Die wortel bestuur groep **bevat** al die **ander bestuur groepe en subskripsies** en **kan nie verskuif of verwyder** word nie.
* Alle subskripsies binne 'n enkele bestuur groep moet die **dieselfde Entra ID tenant** vertrou.

<figure><img src="../../.gitbook/assets/image (147).png" alt=""><figcaption><p><a href="https://td-mainsite-cdn.tutorialsdojo.com/wp-content/uploads/2023/02/managementgroups-768x474.png">https://td-mainsite-cdn.tutorialsdojo.com/wp-content/uploads/2023/02/managementgroups-768x474.png</a></p></figcaption></figure>

### Azure Subskripsies

* Dit is 'n ander **logiese houer waar hulpbronne** (VMs, DBs‚Ä¶) gedra kan word en gefaktureer sal word.
* Sy **ouer** is altyd 'n **bestuur groep** (en dit kan die wortel bestuur groep wees) aangesien subskripsies nie ander subskripsies kan bevat nie.
* Dit **vertrou slegs een Entra ID** gids
* **Toestemmings** wat op die subskripsie vlak toegepas word (of enige van sy ouers) word **ge√´rf** na al die hulpbronne binne die subskripsie

### Hulpbron Groepe

[Uit die dokumentasie:](https://learn.microsoft.com/en-us/azure/azure-resource-manager/management/manage-resource-groups-python?tabs=macos#what-is-a-resource-group) 'n Hulpbron groep is 'n **houer** wat **verwante hulpbronne** vir 'n Azure oplossing bevat. Die hulpbron groep kan al die hulpbronne vir die oplossing insluit, of slegs daardie **hulpbronne wat jy as 'n groep wil bestuur**. Oor die algemeen, voeg **hulpbronne** wat die **selfde lewensiklus** deel by die selfde hulpbron groep sodat jy dit maklik kan ontplooi, opdateer, en verwyder as 'n groep.

Alle **hulpbronne** moet **binne 'n hulpbron groep** wees en kan slegs aan een groep behoort, en as 'n hulpbron groep verwyder word, word al die hulpbronne daarin ook verwyder.

<figure><img src="https://lh7-rt.googleusercontent.com/slidesz/AGV_vUfe8U30iP_vdZCvxX4g8nEPRLoo7v0kmCGkDn1frBPn3_GIoZ7VT2LkdsVQWCnrG_HSYNRRPM-1pSECUkbDAB-9YbUYLzpvKVLDETZS81CHWKYM4fDl3oMo5-yvTMnjdLTS2pz8U67xUTIzBhZ25MFMRkq5koKY=s2048?key=gSyKQr3HTyhvHa28Rf7LVA" alt=""><figcaption><p><a href="https://i0.wp.com/azuredays.com/wp-content/uploads/2020/05/org.png?resize=748%2C601&#x26;ssl=1">https://i0.wp.com/azuredays.com/wp-content/uploads/2020/05/org.png?resize=748%2C601&#x26;ssl=1</a></p></figcaption></figure>

### Azure Hulpbron ID's

Elke hulpbron in Azure het 'n Azure Hulpbron ID wat dit identifiseer.

Die formaat van 'n Azure Hulpbron ID is soos volg:

* `/subscriptions/{subscriptionId}/resourceGroups/{resourceGroupName}/providers/{resourceProviderNamespace}/{resourceType}/{resourceName}`

Vir 'n virtuele masjien genaamd myVM in 'n hulpbron groep `myResourceGroup` onder subskripsie ID `12345678-1234-1234-1234-123456789012`, lyk die Azure Hulpbron ID soos volg:

* `/subscriptions/12345678-1234-1234-1234-123456789012/resourceGroups/myResourceGroup/providers/Microsoft.Compute/virtualMachines/myVM`

## Azure vs Entra ID vs Azure AD Domein Dienste

### Azure

Azure is Microsoft se omvattende **cloud computing platform, wat 'n wye reeks dienste bied**, insluitend virtuele masjiene, databasisse, kunsmatige intelligensie, en stoor. Dit dien as die grondslag vir die gasheer en bestuur van toepassings, die bou van skaalbare infrastruktuur, en die uitvoering van moderne werklas in die wolk. Azure bied gereedskap vir ontwikkelaars en IT-professionals om toepassings en dienste naatloos te skep, te ontplooi, en te bestuur, wat voorsien in 'n verskeidenheid behoeftes van startups tot groot ondernemings.

### Entra ID (voorheen Azure Aktiewe Gids)

Entra ID is 'n wolk-gebaseerde **identiteit en toegang bestuur diens** wat ontwerp is om autentisering, autorisasie, en gebruikers toegang beheer te hanteer. Dit bied veilige toegang tot Microsoft dienste soos Office 365, Azure, en baie derdeparty SaaS toepassings. Met funksies soos enkel aanmelding (SSO), multi-faktor autentisering (MFA), en voorwaardelike toegang beleid onder andere.

### Entra Domein Dienste (voorheen Azure AD DS)

Entra Domein Dienste brei die vermo√´ns van Entra ID uit deur **bestuurde domein dienste aan te bied wat versoenbaar is met tradisionele Windows Aktiewe Gids omgewings**. Dit ondersteun ou protokolle soos LDAP, Kerberos, en NTLM, wat organisasies in staat stel om ouer toepassings in die wolk te migreer of te laat loop sonder om plaaslike domein kontrollers te ontplooi. Hierdie diens ondersteun ook Groep Beleid vir gesentraliseerde bestuur, wat dit geskik maak vir scenario's waar ouer of AD-gebaseerde werklas saam met moderne wolkomgewings moet bestaan.

## Entra ID Beginsels

### Gebruikers

* **Nuwe gebruikers**
* Dui e-pos naam en domein van die geselekteerde tenant aan
* Dui Vertoon naam aan
* Dui wagwoord aan
* Dui eienskappe aan (voornaam, posbeskrywing, kontak inligting‚Ä¶)
* Standaard gebruiker tipe is ‚Äú**lid**‚Äù
* **Buitelandse gebruikers**
* Dui e-pos aan om uit te nooi en vertoon naam (kan 'n nie-Microsoft e-pos wees)
* Dui eienskappe aan
* Standaard gebruiker tipe is ‚Äú**Gaste**‚Äù

### Gebruikers Standaard toestemmings

* **Lede (**[**dokumente**](https://learn.microsoft.com/en-gb/entra/fundamentals/users-default-permissions#restrict-member-users-default-permissions)**)**
* Registreer Toepassings: Standaard **Ja**
* Beperk nie-admin gebruikers van die skep van tenants: Standaard **Nee**
* Skep sekuriteitsgroepe: Standaard **Ja**
* Beperk toegang tot Microsoft Entra administrasie portaal: Standaard **Nee**
* Dit beperk nie API toegang tot die portaal nie (slegs web)
* Laat gebruikers toe om werk of skool rekening met LinkedIn te verbind: Standaard **Ja**
* Toon hou gebruiker ingelog: Standaard **Ja**
* Beperk gebruikers van die herstel van die BitLocker sleutel(s) vir hul besit toestelle: Standaard Nee (kyk in Toestel Instellings)
* Lees ander gebruikers: Standaard **Ja** (deur Microsoft Graph)
* **Gaste**
* **Gaste gebruiker toegang beperkings**
* **Gaste gebruikers het dieselfde toegang as lede** wat alle lid gebruiker toestemmings aan gaste gebruikers standaard toeken.
* **Gaste gebruikers het beperkte toegang tot eienskappe en lidmaatskappe van gids objekte (standaard)** beperk gaste toegang tot slegs hul eie gebruikersprofiel standaard. Toegang tot ander gebruikers en groep inligting is nie meer toegelaat nie.
* **Gaste gebruiker toegang is beperk tot eienskappe en lidmaatskappe van hul eie gids objekte** is die mees beperkende een.
* **Gaste kan uitnooi**
* **Enige iemand in die organisasie kan gaste gebruikers uitnooi insluitend gaste en nie-admins (mees inklusief) - Standaard**
* **Lid gebruikers en gebruikers wat aan spesifieke admin rolle toegeken is kan gaste gebruikers uitnooi insluitend gaste met lid toestemmings**
* **Slegs gebruikers wat aan spesifieke admin rolle toegeken is kan gaste gebruikers uitnooi**
* **Niemand in die organisasie kan gaste gebruikers uitnooi insluitend admins (mees beperkend)**
* **Buitelandse gebruiker verlaat**: Standaard **Waar**
* Laat buitelandse gebruikers toe om die organisasie te verlaat

{% hint style="success" %}
Alhoewel dit standaard beperk is, kan gebruikers (lede en gaste) met toegekennde toestemmings die vorige aksies uitvoer.
{% endhint %}

### **Diens Beginsels**

'n **Diens Prinsipaal** is 'n **identiteit** geskep vir **gebruik** met **toepassings**, gehoste dienste, en geoutomatiseerde gereedskap om toegang tot Azure hulpbronne te verkry. Hierdie toegang is **beperk deur die rolle wat aan die diens prinsipaal toegeken is**, wat jou beheer gee oor **watter hulpbronne toegang verkry** en op watter vlak. Om veiligheidsredes, word dit altyd aanbeveel om **diens prinsipale met geoutomatiseerde gereedskap te gebruik** eerder as om hulle toe te laat om in te log met 'n gebruikersidentiteit.

Dit is moontlik om **direk in te log as 'n diens prinsipaal** deur dit 'n **geheim** (wagwoord), 'n **sertifikaat**, of deur **federale** toegang aan derdeparty platforms (bv. Github Actions) oor dit te verleen.

* As jy **wagwoord** autentisering kies (standaard), **stoor die gegenereerde wagwoord** aangesien jy dit nie weer kan toegang nie.
* As jy sertifikaat autentisering kies, maak seker dat die **toepassing toegang sal h√™ oor die private sleutel**.

### App Registrasies

'n **App Registrasie** is 'n konfigurasie wat 'n toepassing toelaat om met Entra ID te integreer en aksies uit te voer.

#### Sleutel Komponente:

1. **Toepassing ID (Kli√´nt ID):** 'n Unieke identifiseerder vir jou app in Azure AD.
2. **Herlei URIs:** URL's waar Azure AD autentisering antwoorde stuur.
3. **Sertifikate, Geheimen & Federale Kredensiale:** Dit is moontlik om 'n geheim of 'n sertifikaat te genereer om in te log as die diens prinsipaal van die toepassing, of om federale toegang aan dit te verleen (bv. Github Actions).&#x20;
1. As 'n **sertifikaat** of **geheim** gegenereer word, is dit moontlik vir 'n persoon om **in te log as die diens prinsipaal** met CLI gereedskap deur die **toepassing ID**, die **geheim** of **sertifikaat** en die **tenant** (domein of ID) te ken.
4. **API Toestemmings:** Spesifiseer watter hulpbronne of API's die app toegang kan verkry.
5. **Autentisering Instellings:** Definieer die app se ondersteunde autentisering vloei (bv., OAuth2, OpenID Connect).
6. **Diens Prinsipaal**: 'n diens prinsipaal word geskep wanneer 'n App geskep word (as dit vanaf die web konsole gedoen word) of wanneer dit in 'n nuwe tenant ge√Ønstalleer word.
1. Die **diens prinsipaal** sal al die gevraagde toestemmings wat dit geconfigureer is met ontvang.

### Enterprise Toepassings

Dit is net 'n **tabel in Azure om diens prinsipale te filter** en die toepassings wat aan hulle toegeken is te kontroleer.

**Dit is nie 'n ander tipe "toepassing" nie,** daar is nie enige objek in Azure wat 'n "Enterprise Toepassing" is nie, dit is net 'n abstraksie om die Diens prinsipale, App registrasies en bestuurde identiteite te kontroleer.

### **Bestuurde Identiteit (Metadata)**

Bestuurde identiteite in Azure Aktiewe Gids bied 'n oplossing vir **automatiese bestuur van die identiteit** van toepassings. Hierdie identiteite word deur toepassings gebruik vir die doel van **verbinding** met **hulpbronne** wat versoenbaar is met Azure Aktiewe Gids (**Azure AD**) autentisering. Dit stel in staat om die behoefte aan hardkoding van wolk kredensiale in die kode te **verwyder** aangesien die toepassing in staat sal wees om die **metadata** diens te kontak om 'n geldige token te **verkry** om aksies uit te voer as die aangeduide bestuurde identiteit in Azure.

Daar is twee tipes bestuurde identiteite:

* **Stelsel-toegewyse**. Sommige Azure dienste laat jou toe om 'n **bestuurde identiteit direk op 'n diens instansie** in te skakel. Wanneer jy 'n stelsel-toegewyse bestuurde identiteit inskakel, word 'n **diens prinsipaal** in die Entra ID tenant geskep wat deur die subskripsie vertrou word waar die hulpbron gele√´ is. Wanneer die **hulpbron** verwyder word, verwyder Azure outomaties die **identiteit** vir jou.
* **Gebruiker-toegewyse**. Dit is ook moontlik vir gebruikers om bestuurde identiteite te genereer. Hierdie word binne 'n hulpbron groep binne 'n subskripsie geskep en 'n diens prinsipaal sal in die EntraID geskep word wat deur die subskripsie vertrou word. Dan kan jy die bestuurde identiteit aan een of **meer instansies** van 'n Azure diens toewys (meerdere hulpbronne). Vir gebruiker-toegewyse bestuurde identiteite, word die **identiteit apart bestuur van die hulpbronne wat dit gebruik**.

Bestuurde Identiteite **genereer nie ewige kredensiale** (soos wagwoorde of sertifikate) om toegang te verkry as die diens prinsipaal wat aan dit geheg is.

### Standaard Toestemming Toestemmings

**Gebruiker toestemming vir toepassings**

* **Moet nie gebruiker toestemming toelaat nie**
* 'n administrateur sal vir alle apps benodig word.
* **Laat gebruiker toestemming toe vir apps van geverifieerde uitgewers, vir geselekteerde toestemmings (Aanbeveel)**
* Alle gebruikers kan toestemming gee vir toestemmings wat as "lae impak" geklassifiseer is, vir apps van geverifieerde uitgewers of apps wat in hierdie organisasie geregistreer is.
* **Standaard** lae impak toestemmings (alhoewel jy moet aanvaar om hulle as laag by te voeg):
* User.Read - teken in en lees gebruikersprofiel
* offline\_access - hou toegang tot data wat gebruikers toegang gegee het
* openid - teken gebruikers in
* profiel - sien gebruiker se basiese profiel
* e-pos - sien gebruiker se e-pos adres
* **Laat gebruiker toestemming toe vir apps (Standaard)**
* Alle gebruikers kan toestemming gee vir enige app om toegang tot die organisasie se data te verkry.

**Admin toestemming versoeke**: Standaard **Nee**

* Gebruikers kan admin toestemming versoek vir apps waartoe hulle nie toestemming kan gee nie
* As **Ja**: Dit is moontlik om Gebruikers, Groepe en Rolle aan te dui wat toestemming versoeke kan gee
* Konfigureer ook of gebruikers e-pos kennisgewings en vervaldatums herinneringe sal ontvang&#x20;

### Administratiewe Eenhede

[Uit die dokumentasie:](https://learn.microsoft.com/en-us/entra/identity/role-based-access-control/admin-units-manage) Administratiewe eenhede laat jou toe om jou organisasie in **enige eenheid** wat jy wil te **onderverdeel**, en dan **spesifieke administrateurs toe te wys** wat slegs die lede van daardie eenheid kan **bestuur**. Byvoorbeeld, jy kan administratiewe eenhede gebruik om toestemmings aan administrateurs van elke skool aan 'n groot universiteit te delegeer, sodat hulle toegang kan beheer, gebruikers kan bestuur, en beleid slegs in die Skool van Ingenieurswese kan stel.

Slegs **gebruikers**, **groepe** en **toestelle** kan **lede** van 'n **administratiewe eenheid** wees.

Daarom, 'n **Administratiewe eenheid** sal **bevat** sommige **lede** en ander **beginsels** sal **toegewyse toestemmings oor daardie** administratiewe **eenheid** h√™ wat hulle kan gebruik om **die lede** van die administratiewe eenheid te **bestuur**.

## Rolle & Toestemmings

**Rolle** word aan **beginsels** op 'n **omvang** toegeken: `beginsel -[HEF ROL]->(omvang)`

**Rolle** wat aan **groepe** toegeken word, word **ge√´rf** deur al die **lede** van die groep.

Afhangende van die omvang waaraan die rol toegeken is, kan die **rol** ge√´rf word na **ander hulpbronne** binne die omvang houer. Byvoorbeeld, as 'n gebruiker A 'n **rol op die subskripsie** het, sal hy daardie **rol op al die hulpbron groepe** binne die subskripsie en op **al die hulpbronne** binne die hulpbron groep h√™.

### **Klassieke Rolle**

| **Eienaar**                     | <ul><li>Volledige toegang tot alle hulpbronne</li><li>Kan toegang vir ander gebruikers bestuur</li></ul> | Alle hulpbron tipes |
| ------------------------------- | ---------------------------------------------------------------------------------------- | ------------------ |
| **Bydraer**                    | <ul><li>Volledige toegang tot alle hulpbronne</li><li>Kan nie toegang bestuur nie</li></ul>              | Alle hulpbron tipes |
| **Leser**                      | ‚Ä¢ Sien alle hulpbronne                                                                     | Alle hulpbron tipes |
| **Gebruiker Toegang Administrateur** | <ul><li>Sien alle hulpbronne</li><li>Kan toegang vir ander gebruikers bestuur</li></ul>           | Alle hulpbron tipes |

### Gebou-in rolle

[Uit die dokumentasie: ](https://learn.microsoft.com/en-us/azure/role-based-access-control/built-in-roles)[Azure rol-gebaseerde toegang beheer (Azure RBAC)](https://learn.microsoft.com/en-us/azure/role-based-access-control/overview) het verskeie Azure **gebou-in rolle** wat jy kan **toekenn** aan **gebruikers, groepe, diens prinsipale, en bestuurde identiteite**. Rol toekennings is die manier waarop jy **toegang tot Azure hulpbronne** beheer. As die gebou-in rolle nie aan die spesifieke behoeftes van jou organisasie voldoen nie, kan jy jou eie [**Azure pasgemaakte rolle**](https://learn.microsoft.com/en-us/azure/role-based-access-control/custom-roles)**.**

**Gebou-in** rolle geld slegs vir die **hulpbronne** waarvoor hulle **bedoel** is, byvoorbeeld kyk na hierdie 2 voorbeelde van **Gebou-in rolle oor Compute** hulpbronne:

| [Disk Backup Reader](https://learn.microsoft.com/en-us/azure/role-based-access-control/built-in-roles#disk-backup-reader)                 | Bied toestemming aan om rugsteun kluis te laat rugsteun.      | 3e5e47e6-65f7-47ef-90b5-e5dd4d455f24 |
| ----------------------------------------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------- | ------------------------------------ |
| [Virtuele Masjien Gebruiker Aanmelding](https://learn.microsoft.com/en-us/azure/role-based-access-control/built-in-roles#virtual-machine-user-login) | Sien Virtuele Masjiene in die portaal en log in as 'n gewone gebruiker. | fb879df8-f326-4884-b1cf-06f3ad86be52 |

Hierdie rolle kan **ook oor logiese houers** (soos bestuur groepe, subskripsies en hulpbron groepe) toegeken word en die beginsels wat geraak word, sal dit **oor die hulpbronne binne daardie houers** h√™.

* Vind hier 'n lys met [**alle Azure gebou-in rolle**](https://learn.microsoft.com/en-us/azure/role-based-access-control/built-in-roles).
* Vind hier 'n lys met [**alle Azure AD gebou-in rolle**](https://learn.microsoft.com/en-us/azure/active-directory/roles/permissions-reference).

### Pasgemaakte Rolle

Azure laat ook toe om [**pasgemaakte rolle**](https://learn.microsoft.com/en-us/azure/role-based-access-control/custom-roles) met die toestemmings wat die gebruiker benodig te skep.

### Toestemming Weier

* Ten einde vir 'n **beginsel om toegang tot 'n hulpbron te h√™**, moet daar 'n eksplisiete rol aan hom toegeken word (op enige manier) **wat hom daardie toestemming gee**.
* 'n Eksplisiete **weier rol toekenning het voorrang** oor die rol wat die toestemming gee.

<figure><img src="../../.gitbook/assets/image (191).png" alt=""><figcaption></figcaption></figure>

### Globale Administrateur

Gebruikers met die Globale Administrateur rol het die vermo√´ om '**te verhoog' na Gebruiker Toegang Administrateur Azure rol na die wortel bestuur groep**. Dit beteken dat 'n Globale Administrateur in staat sal wees om toegang te bestuur **tot alle Azure subskripsies en bestuur groepe.**\
Hierdie verhoging kan aan die einde van die bladsy gedoen word: [https://portal.azure.com/#view/Microsoft\_AAD\_IAM/ActiveDirectoryMenuBlade/\~/Properties](https://portal.azure.com/#view/Microsoft\_AAD\_IAM/ActiveDirectoryMenuBlade/\~/Properties)

<figure><img src="../../.gitbook/assets/image (162).png" alt=""><figcaption></figcaption></figure>

### Azure Beleide

Azure beleide is 'n stel van **re√´ls en regulasies in Microsoft Azure**, 'n wolk rekenaar diens, wat help om organisatoriese standaarde te bestuur en af te dwing en om nakoming op skaal te evalueer. Hierdie beleide dwing verskillende re√´ls oor jou **Azure hulpbronne** af, wat verseker dat daardie hulpbronne in ooreenstemming bly met korporatiewe standaarde en diensvlak ooreenkomste.

Azure beleide is van kardinale belang vir wolk bestuur en sekuriteit, wat help om te verseker dat hulpbronne behoorlik en doeltreffend gebruik word, en dat hulle voldoen aan eksterne regulasies en interne beleide.\
Sommige voorbeelde:

1. **Verseker Nakoming met Spesifieke Azure Streke**: Hierdie beleid verseker dat alle hulpbronne in spesifieke Azure streke ontplooi word. Byvoorbeeld, 'n maatskappy mag wil verseker dat al sy data in Europa gestoor word vir GDPR nakoming.
2. **Af dwing van Naamstandaarde**: Beleide kan naam konvensies vir Azure hulpbronne afdwing. Dit help om hulpbronne te organiseer en maklik te identifiseer op grond van hul name, wat nuttig is in groot omgewings.
3. **Beperk Sekere Hulpbron Tipes**: Hierdie beleid kan die skepping van sekere tipes hulpbronne beperk. Byvoorbeeld, 'n beleid kan ingestel word om die skepping van duur hulpbron tipes, soos sekere VM groottes, te voorkom om koste te beheer.
4. **Af dwing van Etiket Beleide**: Etikette is sleutel-waarde pare wat aan Azure hulpbronne geassosieer word wat gebruik word vir hulpbron bestuur. Beleide kan afdwing dat sekere etikette teenwoordig moet wees, of spesifieke waardes moet h√™, vir alle hulpbronne. Dit is nuttig vir koste opsporing, eienaarskap, of kategorisering van hulpbronne.
5. **Beperk Publieke Toegang tot Hulpbronne**: Beleide kan afdwing dat sekere hulpbronne, soos stoor rekeninge of databasisse, nie publieke eindpunte het nie, wat verseker dat hulle slegs binne die organisasie se netwerk toeganklik is.
6. **Outomatiese Toepassing van Sekuriteitsinstellings**: Beleide kan gebruik word om outomaties sekuriteitsinstellings op hulpbronne toe te pas, soos om 'n spesifieke netwerk sekuriteitsgroep op alle VM's toe te pas of om te verseker dat alle stoor rekeninge versleuteling gebruik.

Let daarop dat Azure Beleide aan enige vlak van die Azure hi√´rargie geheg kan word, maar hulle word **gewoonlik in die wortel bestuur groep** of in ander bestuur groepe gebruik.

### Toestemmings Omvang

In Azure **kan toestemmings aan enige deel van die hi√´rargie toegeken word**. Dit sluit bestuur groepe, subskripsies, hulpbron groepe, en individuele hulpbronne in. Toestemmings word **ge√´rf** deur die ingeslote **hulpbronne** van die entiteit waar hulle toegeken is.

Hierdie hi√´rargiese struktuur stel in staat vir doeltreffende en skaalbare bestuur van toegangstoestemmings.

<figure><img src="../../.gitbook/assets/image (26).png" alt=""><figcaption></figcaption></figure>

### Azure RBAC vs ABAC

**RBAC** (rol-gebaseerde toegang beheer) is wat ons reeds in die vorige afdelings gesien het: **'n rol aan 'n beginsel toeken om hom toegang te gee** oor 'n hulpbron.\
Echter, in sommige gevalle mag jy **meer fyn-granul√™re toegang bestuur** of **die bestuur van **honderde** rol **toekennings** vereenvoudig.

Azure **ABAC** (attribuut-gebaseerde toegang beheer) bou op Azure RBAC deur **rol toekenning voorwaardes gebaseer op attribuute** in die konteks van spesifieke aksies by te voeg. 'n _rol toekenning voorwaarde_ is 'n **addisionele kontrole wat jy opsioneel kan byvoeg tot jou rol toekenning** om meer fyn-granul√™re toegang beheer te bied. 'n voorwaarde filter die toestemmings wat as deel van die rol definisie en rol toekenning gegee word. Byvoorbeeld, jy kan **'n voorwaarde byvoeg wat vereis dat 'n objek 'n spesifieke etiket moet h√™ om die objek te lees**.\
Jy **kan nie** eksplisiet **weier** **toegang** tot spesifieke hulpbronne **met behulp van voorwaardes** nie.

### Standaard Gebruiker Toestemmings

'n Basiese gebruiker sal 'n paar **standaard toestemmings** h√™ om sommige dele van AzureAD te enumerate:

* Lees alle gebruikers, Groepe, Toepassings, Toestelle, Rolle, Subskripsies, en hul publieke eienskappe
* Nooi Gaste uit (_kan afgeskakel word_)
* Skep Sekuriteitsgroepe
* Lees nie-verborgene Groep lidmaatskappe
* Voeg gaste by Besit groepe
* Skep nuwe toepassing (_kan afgeskakel word_)
* Voeg tot 50 toestelle by Azure (_kan afgeskakel word_)

Jy kan die volle [lys van **standaard toestemmings van gebruikers** in die dokumentasie](https://learn.microsoft.com/en-us/azure/active-directory/fundamentals/users-default-permissions) sien. Boonop, let daarop dat jy in daardie lys ook die **gaste standaard toestemmings lys** kan sien.

{% hint style="info" %}
Onthou dat om Azure hulpbronne te enumerate die gebruiker 'n eksplisiete grant van die toestemming benodig.
{% endhint %}

### Privilege Identiteit Bestuur (PIM)

Privilege Identiteit Bestuur (PIM) in Azure is 'n hulpmiddel wat **beheert, kontroleer, en monitor bevoorregte toegang** in Azure Aktiewe Gids en Azure. Dit verbeter sekuriteit deur **net-in-tyd en tyd-beperkte bevoorregte toegang** te bied, **goedkeurings werkvloei af te dwing, en addisionele autentisering te vereis**. Hierdie benadering minimaliseer die risiko van ongeoorloofde toegang deur te verseker dat verhoogde toestemmings slegs gegee word wanneer nodig en vir 'n spesifieke tydsduur.

## Autentisering Tokens

Daar is **drie tipes tokens** wat in OIDC gebruik word:

* [**Toegang Tokens**](https://learn.microsoft.com/en-us/azure/active-directory/develop/access-tokens)**:** Die kli√´nt bied hierdie token aan die hulpbron bediener aan om **toegang tot hulpbronne** te verkry. Dit kan slegs gebruik word vir 'n spesifieke kombinasie van gebruiker, kli√´nt, en hulpbron en **kan nie herroep** word nie totdat dit verval - dit is 1 uur per standaard. Ontdekking is laag met hierdie.
* **ID Tokens**: Die kli√´nt ontvang hierdie **token van die outorisering bediener**. Dit bevat basiese inligting oor die gebruiker. Dit is **gebind aan 'n spesifieke kombinasie van gebruiker en kli√´nt**.
* **Herlaai Tokens**: Verskaf aan die kli√´nt saam met toegang token. Gebruik om **nuwe toegang en ID tokens** te **kry**. Dit is gebind aan 'n spesifieke kombinasie van gebruiker en kli√´nt en kan herroep word. Standaard vervaldatum is **90 dae** vir inaktiewe herlaai tokens en **geen vervaldatum vir aktiewe tokens**.

{% hint style="warning" %}
Inligting vir **voorwaardelike toegang** is **gestoor** binne die **JWT**. So, as jy die **token van 'n toegelate IP adres** aan vra, sal daardie **IP** in die token **gestoor** word en dan kan jy daardie token van 'n **nie-toegelate IP gebruik om toegang tot die hulpbronne** te verkry.
{% endhint %}

Kyk na die volgende bladsy om verskillende maniere te leer om **toegang tokens aan te vra** en daarmee in te log:

{% content-ref url="az-azuread/" %}
[az-azuread](az-azuread/)
{% endcontent-ref %}

Die mees algemene API eindpunte is:

* **Azure Hulpbron Bestuurder** (ARM): management.azure.com
* **Microsoft Graph**: graph.microsoft.com (Azure AD Graph wat verouderd is, is graph.windows.net)

## Verwysings

* [https://learn.microsoft.com/en-us/azure/governance/management-groups/overview](https://learn.microsoft.com/en-us/azure/governance/management-groups/overview)
* [https://learn.microsoft.com/en-us/azure/cloud-adoption-framework/ready/azure-best-practices/organize-subscriptions](https://learn.microsoft.com/en-us/azure/cloud-adoption-framework/ready/azure-best-practices/organize-subscriptions)
* [https://abouttmc.com/glossary/azure-subscription/#:\~:text=An%20Azure%20subscription%20is%20a,the%20subscription%20it%20belongs%20to.](https://abouttmc.com/glossary/azure-subscription/)
* [https://learn.microsoft.com/en-us/azure/role-based-access-control/overview#how-azure-rbac-determines-if-a-user-has-access-to-a-resource](https://learn.microsoft.com/en-us/azure/role-based-access-control/overview#how-azure-rbac-determines-if-a-user-has-access-to-a-resource)
* [https://stackoverflow.com/questions/65922566/what-are-the-differences-between-service-principal-and-app-registration](https://stackoverflow.com/questions/65922566/what-are-the-differences-between-service-principal-and-app-registration)

{% hint style="success" %}
Leer & oefen AWS Hacking:<img src="../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">[**HackTricks Opleiding AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">\
Leer & oefen GCP Hacking: <img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Opleiding GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Ondersteun HackTricks</summary>

* Kyk na die [**subskripsie planne**](https://github.com/sponsors/carlospolop)!
* **Sluit aan by die** üí¨ [**Discord groep**](https://discord.gg/hRep4RUj7f) of die [**telegram groep**](https://t.me/peass) of **volg** ons op **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Deel hacking truuks deur PRs in te dien na die** [**HackTricks**](https://github.com/carlospolop/hacktricks) en [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
