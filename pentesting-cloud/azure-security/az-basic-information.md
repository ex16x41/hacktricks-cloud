# Az - Osnovne informacije

{% hint style="success" %}
UÄite i veÅ¾bajte AWS Hacking:<img src="../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">\
UÄite i veÅ¾bajte GCP Hacking: <img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>PodrÅ¡ka HackTricks</summary>

* Proverite [**planove pretplate**](https://github.com/sponsors/carlospolop)!
* **PridruÅ¾ite se** ğŸ’¬ [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili **pratite** nas na **Twitteru** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podelite hakerske trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
{% endhint %}

## Hijerarhija organizacije

<figure><img src="https://lh7-rt.googleusercontent.com/slidesz/AGV_vUchBvhjIdWWR2ldAkWiZMdmrcEYD9Ti5UAa3zAGr9YbAnx4Q_gZNp_zvOU429vgWZ_ixoYHQKdC8bGgkhWYCy591SRIFj6RKCj4BEpVQixAGsp3T3O5sS3k7x5CTaJ-SCBNC7i5KluLyxdiXoZsH1F0ko1Gv88=s2048?key=gSyKQr3HTyhvHa28Rf7LVA" alt=""><figcaption></figcaption></figure>

### Grupa za upravljanje

* MoÅ¾e sadrÅ¾ati **druge grupe za upravljanje ili pretplate**.
* Ovo omoguÄ‡ava **primenu kontrola upravljanja** kao Å¡to su RBAC i Azure Policy jednom na nivou grupe za upravljanje i njihovo **nasleÄ‘ivanje** od strane svih pretplata u grupi.
* **10.000 grupa za upravljanje** moÅ¾e biti podrÅ¾ano u jednoj direktoriji.
* Drvo grupa za upravljanje moÅ¾e podrÅ¾ati **do Å¡est nivoa dubine**. Ova granica ne ukljuÄuje nivo korena ili nivo pretplate.
* Svaka grupa za upravljanje i pretplata mogu podrÅ¾avati **samo jednog roditelja**.
* ÄŒak i ako se moÅ¾e kreirati nekoliko grupa za upravljanje, **postoji samo 1 korenska grupa za upravljanje**.
* Korenska grupa za upravljanje **sadrÅ¾i** sve **druge grupe za upravljanje i pretplate** i **ne moÅ¾e se premestiti ili obrisati**.
* Sve pretplate unutar jedne grupe za upravljanje moraju verovati **istom Entra ID tenant-u.**

<figure><img src="../../.gitbook/assets/image (147).png" alt=""><figcaption><p><a href="https://td-mainsite-cdn.tutorialsdojo.com/wp-content/uploads/2023/02/managementgroups-768x474.png">https://td-mainsite-cdn.tutorialsdojo.com/wp-content/uploads/2023/02/managementgroups-768x474.png</a></p></figcaption></figure>

### Azure pretplate

* To je joÅ¡ jedan **logiÄki kontejner u kojem se mogu pokretati resursi** (VM-ovi, DB-oviâ€¦) i za koji Ä‡e se naplaÄ‡ivati.
* Njegov **roditelj** je uvek **grupa za upravljanje** (i moÅ¾e biti korenska grupa za upravljanje) jer pretplate ne mogu sadrÅ¾ati druge pretplate.
* **Veruje samo jednoj Entra ID** direktoriji.
* **Dozvole** primenjene na nivou pretplate (ili bilo kojem od njegovih roditelja) se **nasleÄ‘uju** svim resursima unutar pretplate.

### Grupe resursa

[Iz dokumenata:](https://learn.microsoft.com/en-us/azure/azure-resource-manager/management/manage-resource-groups-python?tabs=macos#what-is-a-resource-group) Grupa resursa je **kontejner** koji sadrÅ¾i **povezane resurse** za Azure reÅ¡enje. Grupa resursa moÅ¾e ukljuÄivati sve resurse za reÅ¡enje, ili samo one **resurse koje Å¾elite da upravljate kao grupu**. Generalno, dodajte **resurse** koji dele **isti Å¾ivotni ciklus** u istu grupu resursa kako biste ih lako implementirali, aÅ¾urirali i obrisali kao grupu.

Svi **resursi** moraju biti **unutar grupe resursa** i mogu pripadati samo jednoj grupi, a ako se grupa resursa obriÅ¡e, svi resursi unutar nje se takoÄ‘e briÅ¡u.

<figure><img src="https://lh7-rt.googleusercontent.com/slidesz/AGV_vUfe8U30iP_vdZCvxX4g8nEPRLoo7v0kmCGkDn1frBPn3_GIoZ7VT2LkdsVQWCnrG_HSYNRRPM-1pSECUkbDAB-9YbUYLzpvKVLDETZS81CHWKYM4fDl3oMo5-yvTMnjdLTS2pz8U67xUTIzBhZ25MFMRkq5koKY=s2048?key=gSyKQr3HTyhvHa28Rf7LVA" alt=""><figcaption><p><a href="https://i0.wp.com/azuredays.com/wp-content/uploads/2020/05/org.png?resize=748%2C601&#x26;ssl=1">https://i0.wp.com/azuredays.com/wp-content/uploads/2020/05/org.png?resize=748%2C601&#x26;ssl=1</a></p></figcaption></figure>

### Azure Resource IDs

Svaki resurs u Azure-u ima Azure Resource ID koji ga identifikuje.

Format Azure Resource ID-a je sledeÄ‡i:

* `/subscriptions/{subscriptionId}/resourceGroups/{resourceGroupName}/providers/{resourceProviderNamespace}/{resourceType}/{resourceName}`

Za virtuelnu maÅ¡inu nazvanu myVM u grupi resursa `myResourceGroup` pod ID-jem pretplate `12345678-1234-1234-1234-123456789012`, Azure Resource ID izgleda ovako:

* `/subscriptions/12345678-1234-1234-1234-123456789012/resourceGroups/myResourceGroup/providers/Microsoft.Compute/virtualMachines/myVM`

## Azure vs Entra ID vs Azure AD Domain Services

### Azure

Azure je Microsoftova sveobuhvatna **platforma za cloud raÄunarstvo, koja nudi Å¡irok spektar usluga**, ukljuÄujuÄ‡i virtuelne maÅ¡ine, baze podataka, veÅ¡taÄku inteligenciju i skladiÅ¡tenje. Ona sluÅ¾i kao osnova za hostovanje i upravljanje aplikacijama, izgradnju skalabilnih infrastruktura i pokretanje modernih radnih optereÄ‡enja u oblaku. Azure pruÅ¾a alate za programere i IT profesionalce da kreiraju, implementiraju i upravljaju aplikacijama i uslugama bez problema, zadovoljavajuÄ‡i razliÄite potrebe od startapa do velikih preduzeÄ‡a.

### Entra ID (ranije Azure Active Directory)

Entra ID je usluga za upravljanje **identitetom i pristupom u oblaku** dizajnirana da se bavi autentifikacijom, autorizacijom i kontrolom pristupa korisnika. Ona omoguÄ‡ava siguran pristup Microsoftovim uslugama kao Å¡to su Office 365, Azure i mnoge treÄ‡e strane SaaS aplikacije. Sa funkcijama kao Å¡to su jedinstveno prijavljivanje (SSO), viÅ¡efaktorska autentifikacija (MFA) i politike uslovnog pristupa, izmeÄ‘u ostalog.

### Entra Domain Services (ranije Azure AD DS)

Entra Domain Services proÅ¡iruje moguÄ‡nosti Entra ID-a nudeÄ‡i **upravljane usluge domena kompatibilne sa tradicionalnim Windows Active Directory okruÅ¾enjima**. PodrÅ¾ava nasleÄ‘ene protokole kao Å¡to su LDAP, Kerberos i NTLM, omoguÄ‡avajuÄ‡i organizacijama da migriraju ili pokreÄ‡u starije aplikacije u oblaku bez implementacije lokalnih kontrolera domena. Ova usluga takoÄ‘e podrÅ¾ava grupne politike za centralizovano upravljanje, Å¡to je Äini pogodnom za scenarije u kojima nasleÄ‘ena ili AD-bazirana radna optereÄ‡enja treba da koegzistiraju sa modernim cloud okruÅ¾enjima.

## Entra ID Principali

### Korisnici

* **Novi korisnici**
* NaznaÄite ime i domen e-poÅ¡te iz odabranog tenant-a
* NaznaÄite prikazano ime
* NaznaÄite lozinku
* NaznaÄite svojstva (ime, radno mesto, kontakt informacijeâ€¦)
* Podrazumevani tip korisnika je â€œ**Älan**â€
* **Spoljni korisnici**
* NaznaÄite e-poÅ¡tu za poziv i prikazano ime (moÅ¾e biti e-poÅ¡ta koja nije Microsoft)
* NaznaÄite svojstva
* Podrazumevani tip korisnika je â€œ**Gost**â€

### Podrazumevane dozvole korisnika

* **ÄŒlanovi (**[**dokumenti**](https://learn.microsoft.com/en-gb/entra/fundamentals/users-default-permissions#restrict-member-users-default-permissions)**)**
* Registrujte aplikacije: Podrazumevano **Da**
* OgraniÄite ne-administrativne korisnike da kreiraju tenant-e: Podrazumevano **Ne**
* Kreirajte sigurnosne grupe: Podrazumevano **Da**
* OgraniÄite pristup Microsoft Entra administrativnom portalu: Podrazumevano **Ne**
* Ovo ne ograniÄava API pristup portalu (samo web)
* Dozvolite korisnicima da poveÅ¾u radni ili Å¡kolski nalog sa LinkedIn-om: Podrazumevano **Da**
* PrikaÅ¾i zadrÅ¾i korisnika prijavljenim: Podrazumevano **Da**
* OgraniÄite korisnike da povrate BitLocker kljuÄ(eve) za svoje ureÄ‘aje: Podrazumevano Ne (proverite u podeÅ¡avanjima ureÄ‘aja)
* ÄŒitajte druge korisnike: Podrazumevano **Da** (putem Microsoft Graph-a)
* **Gosti**
* **OgraniÄenja pristupa gostujuÄ‡im korisnicima**
* **Gosti imaju isti pristup kao Älanovi** dodeljuju sve dozvole Älanovima korisnicima gostujuÄ‡im korisnicima podrazumevano.
* **Gosti imaju ograniÄen pristup svojstvima i Älanstvima objekata direktorijuma (podrazumevano)** ograniÄava pristup gostiju samo na njihov profil korisnika podrazumevano. Pristup informacijama o drugim korisnicima i grupama viÅ¡e nije dozvoljen.
* **Pristup gostujuÄ‡im korisnicima je ograniÄen na svojstva i Älanstva njihovih vlastitih objekata direktorijuma** je najrestriktivniji.
* **Gosti mogu pozvati**
* **Svako u organizaciji moÅ¾e pozvati gostujuÄ‡e korisnike ukljuÄujuÄ‡i goste i ne-administratore (najinkluzivnije) - Podrazumevano**
* **Korisnici Älanovi i korisnici dodeljeni specifiÄnim administrativnim ulogama mogu pozvati gostujuÄ‡e korisnike ukljuÄujuÄ‡i goste sa Älanovskim dozvolama**
* **Samo korisnici dodeljeni specifiÄnim administrativnim ulogama mogu pozvati gostujuÄ‡e korisnike**
* **Niko u organizaciji ne moÅ¾e pozvati gostujuÄ‡e korisnike ukljuÄujuÄ‡i administratore (najrestriktivnije)**
* **Spoljni korisnici mogu napustiti**: Podrazumevano **TaÄno**
* Dozvolite spoljnim korisnicima da napuste organizaciju

{% hint style="success" %}
ÄŒak i ako su podrazumevano ograniÄeni, korisnici (Älanovi i gosti) sa dodeljenim dozvolama mogli bi izvrÅ¡iti prethodne radnje.
{% endhint %}

### **Servisni principi**

**Servisni princip** je **identitet** kreiran za **upotrebu** sa **aplikacijama**, hostovanim uslugama i automatizovanim alatima za pristup Azure resursima. Ovaj pristup je **ograniÄen ulogama dodeljenim** servisnom principu, dajuÄ‡i vam kontrolu nad **koji resursi mogu biti pristupljeni** i na kojem nivou. Iz bezbednosnih razloga, uvek se preporuÄuje da se **koriste servisni principi sa automatizovanim alatima** umesto da im se dozvoli prijavljivanje sa identitetom korisnika.

MoguÄ‡e je **direktno se prijaviti kao servisni princip** generisanjem **tajne** (lozinke), **sertifikata**, ili dodeljivanjem **federisanog** pristupa treÄ‡im platformama (npr. Github Actions) preko njega.

* Ako izaberete **lozinku** za autentifikaciju (podrazumevano), **saÄuvajte generisanu lozinku** jer je neÄ‡ete moÄ‡i ponovo pristupiti.
* Ako izaberete autentifikaciju sertifikatom, uverite se da Ä‡e **aplikacija imati pristup privatnom kljuÄu**.

### Registracije aplikacija

**Registracija aplikacije** je konfiguracija koja omoguÄ‡ava aplikaciji da se integriÅ¡e sa Entra ID i da izvrÅ¡ava radnje.

#### KljuÄne komponente:

1. **ID aplikacije (Client ID):** Jedinstveni identifikator za vaÅ¡u aplikaciju u Azure AD.
2. **Redirect URIs:** URL-ovi na koje Azure AD Å¡alje odgovore na autentifikaciju.
3. **Sertifikati, tajne i federisani kredencijali:** MoguÄ‡e je generisati tajnu ili sertifikat za prijavu kao servisni princip aplikacije, ili dodeliti federisani pristup (npr. Github Actions).&#x20;
1. Ako je **sertifikat** ili **tajna** generisana, moguÄ‡e je da osoba **prijavi kao servisni princip** koristeÄ‡i CLI alate znajuÄ‡i **ID aplikacije**, **tajnu** ili **sertifikat** i **tenant** (domen ili ID).
4. **API dozvole:** Specifikuje koje resurse ili API-je aplikacija moÅ¾e pristupiti.
5. **PodeÅ¡avanja autentifikacije:** DefiniÅ¡e podrÅ¾ane tokove autentifikacije aplikacije (npr., OAuth2, OpenID Connect).
6. **Servisni princip**: Servisni princip se kreira kada se aplikacija kreira (ako se to uradi iz web konzole) ili kada se instalira u novom tenant-u.
1. **Servisni princip** Ä‡e dobiti sve traÅ¾ene dozvole sa kojima je konfigurisan.

### PreduzeÄ‡a aplikacije

To je samo **tabela u Azure-u za filtriranje servisnih principa** i proveru aplikacija koje su dodeljene.

**To nije joÅ¡ jedan tip â€œaplikacijeâ€,** ne postoji nijedan objekat u Azure-u koji je â€œPreduzeÄ‡e aplikacijaâ€, to je samo apstrakcija za proveru servisnih principa, registracija aplikacija i upravljanih identiteta.

### **Upravljani identitet (metapodaci)**

Upravljani identiteti u Azure Active Directory nude reÅ¡enje za **automatsko upravljanje identitetom** aplikacija. Ovi identiteti se koriste od strane aplikacija u svrhu **povezivanja** sa **resursima** kompatibilnim sa autentifikacijom Azure Active Directory (**Azure AD**). Ovo omoguÄ‡ava **uklanjanje potrebe za hardkodiranjem cloud kredencijala** u kodu jer Ä‡e aplikacija moÄ‡i da kontaktira **metapodatkovnu** uslugu kako bi dobila vaÅ¾eÄ‡i token za **izvrÅ¡avanje radnji** kao naznaÄeni upravljani identitet u Azure-u.

Postoje dva tipa upravljanih identiteta:

* **Sistemom dodeljeni**. Neke Azure usluge omoguÄ‡avaju da **omoguÄ‡ite upravljani identitet direktno na instanci usluge**. Kada omoguÄ‡ite sistemom dodeljeni upravljani identitet, **servisni princip** se kreira u Entra ID tenant-u kojem veruje pretplata u kojoj se resurs nalazi. Kada se **resurs** **obriÅ¡e**, Azure automatski **briÅ¡e** **identitet** za vas.
* **Korisnikom dodeljeni**. TakoÄ‘e je moguÄ‡e da korisnici generiÅ¡u upravljane identitete. Ovi se kreiraju unutar grupe resursa unutar pretplate i servisni princip Ä‡e biti kreiran u Entra ID-u kojem veruje pretplata. Zatim, moÅ¾ete dodeliti upravljeni identitet jednoj ili **viÅ¡e instanci** Azure usluge (viÅ¡e resursa). Za korisnikom dodeljene upravljane identitete, **identitet se upravlja odvojeno od resursa koji ga koriste**.

Upravljani identiteti **ne generiÅ¡u veÄne kredencijale** (kao Å¡to su lozinke ili sertifikati) za pristup kao servisni princip koji je povezan sa njim.

### Podrazumevane dozvole pristanka

**KorisniÄki pristanak za aplikacije**

* **Ne dozvoljavajte korisniÄki pristanak**
* Administrator Ä‡e biti potreban za sve aplikacije.
* **Dozvolite korisniÄki pristanak za aplikacije od verifikovanih izdavaÄa, za odabrane dozvole (preporuÄeno)**
* Svi korisnici mogu pristati na dozvole klasifikovane kao "niskog uticaja", za aplikacije od verifikovanih izdavaÄa ili aplikacije registrovane u ovoj organizaciji.
* **Podrazumevane** dozvole niskog uticaja (iako ih morate prihvatiti da ih dodate kao niske):
* User.Read - prijavite se i proÄitajte korisniÄki profil
* offline\_access - odrÅ¾ava pristup podacima kojima su korisnici dali pristup
* openid - prijavite korisnike
* profile - pogledajte osnovni profil korisnika
* email - pogledajte adresu e-poÅ¡te korisnika
* **Dozvolite korisniÄki pristanak za aplikacije (podrazumevano)**
* Svi korisnici mogu pristati na bilo koju aplikaciju da pristupi podacima organizacije.

**Zahtevi za pristanak administratora**: Podrazumevano **Ne**

* Korisnici mogu zatraÅ¾iti pristanak administratora za aplikacije na koje ne mogu pristati
* Ako **Da**: MoguÄ‡e je naznaÄiti korisnike, grupe i uloge koje mogu pristati na zahteve
* TakoÄ‘e konfiguriÅ¡ite da li Ä‡e korisnici primati obaveÅ¡tenja putem e-poÅ¡te i podsetnike o isteku&#x20;

### Administrativne jedinice

[Iz dokumenata:](https://learn.microsoft.com/en-us/entra/identity/role-based-access-control/admin-units-manage) Administrativne jedinice vam omoguÄ‡avaju da **podelite** svoju organizaciju na **bilo koju jedinicu** koju Å¾elite, a zatim **dodelite specifiÄne administratore** koji mogu **upravljati samo Älanovima** te jedinice. Na primer, mogli biste koristiti administrativne jedinice da delegirate dozvole administratorima svake Å¡kole na velikom univerzitetu, tako da mogu kontrolisati pristup, upravljati korisnicima i postavljati politike samo u Å koli inÅ¾enjerstva.

Samo **korisnici**, **grupe** i **ureÄ‘aji** mogu biti **Älanovi** **administrativne jedinice**.

Stoga, **administrativna jedinica** Ä‡e **sadrÅ¾ati** neke **Älanove** i druge **principale** Ä‡e imati **dodeljene dozvole nad tom** administrativnom **jedinicom** koje mogu koristiti za **upravljanje Älanovima** administrativne jedinice.

## Uloge i dozvole

**Uloge** se **dodeljuju** **principalima** na **opsegu**: `principal -[HAS ROLE]->(scope)`

**Uloge** dodeljene **grupama** se **nasleÄ‘uju** od strane svih **Älanova** grupe.

U zavisnosti od opsega na koji je uloga dodeljena, **uloga** se moÅ¾e **naslediti** na **druge resurse** unutar kontejnera opsega. Na primer, ako korisnik A ima **ulogu na pretplati**, on Ä‡e imati tu **ulogu na svim grupama resursa** unutar pretplate i na **svim resursima** unutar grupe resursa.

### **KlasiÄne uloge**

| **Vlasnik**                  | <ul><li>Puni pristup svim resursima</li><li>MoÅ¾e upravljati pristupom za druge korisnike</li></ul> | Svi tipovi resursa |
| ----------------------------- | ---------------------------------------------------------------------------------------- | ------------------ |
| **Doprinosilac**             | <ul><li>Puni pristup svim resursima</li><li>Ne moÅ¾e upravljati pristupom</li></ul>              | Svi tipovi resursa |
| **ÄŒitaÄ**                    | â€¢ Pregled svih resursa                                                                     | Svi tipovi resursa |
| **Administrator pristupa korisnicima** | <ul><li>Pregled svih resursa</li><li>MoÅ¾e upravljati pristupom za druge korisnike</li></ul>           | Svi tipovi resursa |

### Uloge ugraÄ‘ene

[Iz dokumenata: ](https://learn.microsoft.com/en-us/azure/role-based-access-control/built-in-roles)[Azure kontrola pristupa zasnovana na ulogama (Azure RBAC)](https://learn.microsoft.com/en-us/azure/role-based-access-control/overview) ima nekoliko **ugraÄ‘enih uloga** koje moÅ¾ete **dodeliti** **korisnicima, grupama, servisnim principima i upravljanim identitetima**. Dodeljivanje uloga je naÄin na koji kontroliÅ¡ete **pristup Azure resursima**. Ako ugraÄ‘ene uloge ne zadovoljavaju specifiÄne potrebe vaÅ¡e organizacije, moÅ¾ete kreirati svoje [**Azure prilagoÄ‘ene uloge**](https://learn.microsoft.com/en-us/azure/role-based-access-control/custom-roles)**.**

**UgraÄ‘ene** uloge se primenjuju samo na **resurse** za koje su **namenjene**, na primer, proverite ova 2 primera **ugraÄ‘enih uloga** nad resursima **RaÄunanja**:

| [Disk Backup Reader](https://learn.microsoft.com/en-us/azure/role-based-access-control/built-in-roles#disk-backup-reader)                 | PruÅ¾a dozvolu za backup vault za izvoÄ‘enje backup-a diska.      | 3e5e47e6-65f7-47ef-90b5-e5dd4d455f24 |
| ----------------------------------------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------- | ------------------------------------ |
| [Virtual Machine User Login](https://learn.microsoft.com/en-us/azure/role-based-access-control/built-in-roles#virtual-machine-user-login) | Pregledajte virtuelne maÅ¡ine u portalu i prijavite se kao obiÄan korisnik. | fb879df8-f326-4884-b1cf-06f3ad86be52 |

Ove uloge se **takoÄ‘e mogu dodeliti nad logiÄkim kontejnerima** (kao Å¡to su grupe za upravljanje, pretplate i grupe resursa) i principi na koje se to odnosi Ä‡e ih imati **nad resursima unutar tih kontejnera**.

* PronaÄ‘ite ovde listu sa [**svim ugraÄ‘enim ulogama Azure-a**](https://learn.microsoft.com/en-us/azure/role-based-access-control/built-in-roles).
* PronaÄ‘ite ovde listu sa [**svim ugraÄ‘enim ulogama Azure AD**](https://learn.microsoft.com/en-us/azure/active-directory/roles/permissions-reference).

### PrilagoÄ‘ene uloge

Azure takoÄ‘e omoguÄ‡ava kreiranje [**prilagoÄ‘enih uloga**](https://learn.microsoft.com/en-us/azure/role-based-access-control/custom-roles) sa dozvolama koje korisnik treba.

### Odbijena dozvola

* Da bi **principal imao neki pristup resursu**, potrebna mu je eksplicitna uloga koja mu se dodeljuje (na bilo koji naÄin) **dodeljujuÄ‡i mu tu dozvolu**.
* Eksplicitna **dodela odbijene uloge ima prioritet** nad ulogom koja dodeljuje dozvolu.

<figure><img src="../../.gitbook/assets/image (191).png" alt=""><figcaption></figcaption></figure>

### Globalni administrator

Korisnici sa ulogom Globalnog administratora imaju moguÄ‡nost da '**poveÄ‡aju' ulogu Administratora pristupa korisnicima Azure-a na korensku grupu za upravljanje**. To znaÄi da Ä‡e Globalni administrator moÄ‡i da upravlja pristupom **svim Azure pretplatama i grupama za upravljanje.**\
Ovo poveÄ‡anje moÅ¾e se izvrÅ¡iti na kraju stranice: [https://portal.azure.com/#view/Microsoft\_AAD\_IAM/ActiveDirectoryMenuBlade/\~/Properties](https://portal.azure.com/#view/Microsoft\_AAD\_IAM/ActiveDirectoryMenuBlade/\~/Properties)

<figure><img src="../../.gitbook/assets/image (162).png" alt=""><figcaption></figcaption></figure>

### Azure politike

Azure politike su skup **pravila i propisa u Microsoft Azure-u**, cloud raÄunarstvu, koji pomaÅ¾u u upravljanju i sprovoÄ‘enju organizacionih standarda i proceni usklaÄ‘enosti na velikoj skali. Ove politike sprovode razliÄita pravila nad vaÅ¡im **Azure resursima**, osiguravajuÄ‡i da ti resursi ostanu usklaÄ‘eni sa korporativnim standardima i ugovorima o nivou usluge.

Azure politike su kljuÄne za upravljanje cloud-om i bezbednost, pomaÅ¾uÄ‡i da se osigura da se resursi koriste pravilno i efikasno, i da se pridrÅ¾avaju spoljaÅ¡njih propisa i unutraÅ¡njih politika.\
Neki primeri:

1. **Osiguranje usklaÄ‘enosti sa specifiÄnim Azure regionima**: Ova politika osigurava da se svi resursi implementiraju u specifiÄnim Azure regionima. Na primer, kompanija moÅ¾e Å¾eleti da osigura da su svi njeni podaci pohranjeni u Evropi radi usklaÄ‘enosti sa GDPR-om.
2. **SprovoÄ‘enje standarda imenovanja**: Politike mogu sprovoditi konvencije imenovanja za Azure resurse. Ovo pomaÅ¾e u organizaciji i lakom identifikovanju resursa na osnovu njihovih imena, Å¡to je korisno u velikim okruÅ¾enjima.
3. **OgraniÄavanje odreÄ‘enih tipova resursa**: Ova politika moÅ¾e ograniÄiti kreiranje odreÄ‘enih tipova resursa. Na primer, politika moÅ¾e biti postavljena da spreÄi kreiranje skupih tipova resursa, kao Å¡to su odreÄ‘ene veliÄine VM-a, kako bi se kontrolisali troÅ¡kovi.
4. **SprovoÄ‘enje politika oznaÄavanja**: Oznake su parovi kljuÄ-vrednost povezani sa Azure resursima koji se koriste za upravljanje resursima. Politike mogu sprovoditi da odreÄ‘ene oznake moraju biti prisutne, ili imati specifiÄne vrednosti, za sve resurse. Ovo je korisno za praÄ‡enje troÅ¡kova, vlasniÅ¡tva ili kategorizaciju resursa.
5. **OgraniÄavanje javnog pristupa resursima**: Politike mogu sprovoditi da odreÄ‘eni resursi, kao Å¡to su skladiÅ¡ni nalozi ili baze podataka, nemaju javne krajnje taÄke, osiguravajuÄ‡i da su dostupni samo unutar mreÅ¾e organizacije.
6. **Automatsko primenjivanje bezbednosnih podeÅ¡avanja**: Politike se mogu koristiti za automatsko primenjivanje bezbednosnih podeÅ¡avanja na resurse, kao Å¡to je primena specifiÄne mreÅ¾ne sigurnosne grupe na sve VM-ove ili osiguranje da svi skladiÅ¡ni nalozi koriste enkripciju.

Napomena da se Azure politike mogu prikaÄiti na bilo koji nivo Azure hijerarhije, ali se **najÄeÅ¡Ä‡e koriste u korenskoj grupi za upravljanje** ili u drugim grupama za upravljanje.

### Opseg dozvola

U Azure-u **dozvole se mogu dodeliti bilo kojem delu hijerarhije**. To ukljuÄuje grupe za upravljanje, pretplate, grupe resursa i pojedinaÄne resurse. Dozvole se **nasleÄ‘uju** od sadrÅ¾anih **resursa** entiteta na kojem su dodeljene.

Ova hijerarhijska struktura omoguÄ‡ava efikasno i skalabilno upravljanje pristupnim dozvolama.

<figure><img src="../../.gitbook/assets/image (26).png" alt=""><figcaption></figcaption></figure>

### Azure RBAC vs ABAC

**RBAC** (kontrola pristupa zasnovana na ulogama) je ono Å¡to smo veÄ‡ videli u prethodnim odeljcima: **Dodeljivanje uloge principalu kako bi mu se omoguÄ‡io pristup** nad resursom.\
MeÄ‘utim, u nekim sluÄajevima moÅ¾da Ä‡ete Å¾eleti da obezbedite **fino podeÅ¡eno upravljanje pristupom** ili **pojednostavite** upravljanje **stotinama** dodela uloga.

Azure **ABAC** (kontrola pristupa zasnovana na atributima) se oslanja na Azure RBAC dodajuÄ‡i **uslove dodeljivanja uloga zasnovane na atributima** u kontekstu specifiÄnih radnji. _Uslov dodeljivanja uloge_ je **dodatna provera koju moÅ¾ete opcionalno dodati svojoj dodeli uloge** kako biste obezbedili finije upravljanje pristupom. Uslov filtrira dozvole dodeljene kao deo definicije uloge i dodele uloge. Na primer, moÅ¾ete **dodati uslov koji zahteva da objekat ima specifiÄnu oznaku da bi ga proÄitali**.\
Ne moÅ¾ete eksplicitno **odbiti** **pristup** specifiÄnim resursima **koristeÄ‡i uslove**.

### Podrazumevane dozvole korisnika

Osnovni korisnik Ä‡e imati neke **podrazumevane dozvole** za enumeraciju nekih delova AzureAD:

* ÄŒitajte sve korisnike, grupe, aplikacije, ureÄ‘aje, uloge, pretplate i njihove javne osobine
* Pozovite goste (_moÅ¾e se iskljuÄiti_)
* Kreirajte sigurnosne grupe
* ÄŒitajte ne-skrivene Älanstva grupa
* Dodajte goste u vlasniÄke grupe
* Kreirajte nove aplikacije (_moÅ¾e se iskljuÄiti_)
* Dodajte do 50 ureÄ‘aja u Azure (_moÅ¾e se iskljuÄiti_)

MoÅ¾ete videti punu [listu **podrazumevanih dozvola korisnika** u dokumentima](https://learn.microsoft.com/en-us/azure/active-directory/fundamentals/users-default-permissions). Pored toga, napomenite da u toj listi moÅ¾ete takoÄ‘e videti **listu podrazumevanih dozvola gostiju**.

{% hint style="info" %}
Zapamtite da da biste enumerisali Azure resurse, korisnik treba eksplicitnu dodelu dozvole.
{% endhint %}

### Upravljanje privilegovanim identitetima (PIM)

Upravljanje privilegovanim identitetima (PIM) u Azure-u je alat koji **upravlja, kontroliÅ¡e i prati privilegovani pristup** u Azure Active Directory i Azure-u. PoveÄ‡ava bezbednost pruÅ¾ajuÄ‡i **privilegovani pristup na zahtev i vremenski ograniÄen**, **sprovodeÄ‡i radne tokove odobravanja i zahtevajuÄ‡i dodatnu autentifikaciju**. Ovaj pristup minimizira rizik od neovlaÅ¡Ä‡enog pristupa osiguravajuÄ‡i da se poviÅ¡ene dozvole dodeljuju samo kada je to neophodno i na odreÄ‘eni vremenski period.

## Autentifikacijski tokeni

Postoje **tri tipa tokena** koji se koriste u OIDC:

* [**Pristupni tokeni**](https://learn.microsoft.com/en-us/azure/active-directory/develop/access-tokens)**:** Klijent predstavlja ovaj token serveru resursa da bi **pristupio resursima**. MoÅ¾e se koristiti samo za specifiÄnu kombinaciju korisnika, klijenta i resursa i **ne moÅ¾e biti opozvan** do isteka - Å¡to je podrazumevano 1 sat. Detekcija je niska koristeÄ‡i ovo.
* **ID tokeni**: Klijent prima ovaj **token od autorizacionog servera**. SadrÅ¾i osnovne informacije o korisniku. **Povezan je sa specifiÄnom kombinacijom korisnika i klijenta**.
* **Refresh tokeni**: Dodeljuju se klijentu sa pristupnim tokenom. Koriste se za **dobijanje novih pristupnih i ID tokena**. Povezan je sa specifiÄnom kombinacijom korisnika i klijenta i moÅ¾e biti opozvan. Podrazumevani isteka je **90 dana** za neaktivne refresh tokene i **nema isteka za aktivne tokene**.

{% hint style="warning" %}
Informacije za **uslovni pristup** su **smeÅ¡tene** unutar **JWT**. Dakle, ako zatraÅ¾ite **token sa dozvoljene IP adrese**, ta **IP** Ä‡e biti **smeÅ¡tena** u tokenu i tada moÅ¾ete koristiti taj token sa **ne-dozvoljene IP adrese za pristup resursima**.
{% endhint %}

Proverite sledeÄ‡u stranicu da biste saznali razliÄite naÄine za **zahtev za pristupnim tokenima** i prijavu sa njima:

{% content-ref url="az-azuread/" %}
[az-azuread](az-azuread/)
{% endcontent-ref %}

NajÄeÅ¡Ä‡i API krajnji taÄke su:

* **Azure Resource Manager** (ARM): management.azure.com
* **Microsoft Graph**: graph.microsoft.com (Azure AD Graph koji je zastareo je graph.windows.net)

## Reference

* [https://learn.microsoft.com/en-us/azure/governance/management-groups/overview](https://learn.microsoft.com/en-us/azure/governance/management-groups/overview)
* [https://learn.microsoft.com/en-us/azure/cloud-adoption-framework/ready/azure-best-practices/organize-subscriptions](https://learn.microsoft.com/en-us/azure/cloud-adoption-framework/ready/azure-best-practices/organize-subscriptions)
* [https://abouttmc.com/glossary/azure-subscription/#:\~:text=An%20Azure%20subscription%20is%20a,the%20subscription%20it%20belongs%20to.](https://abouttmc.com/glossary/azure-subscription/)
* [https://learn.microsoft.com/en-us/azure/role-based-access-control/overview#how-azure-rbac-determines-if-a-user-has-access-to-a-resource](https://learn.microsoft.com/en-us/azure/role-based-access-control/overview#how-azure-rbac-determines-if-a-user-has-access-to-a-resource)
* [https://stackoverflow.com/questions/65922566/what-are-the-differences-between-service-principal-and-app-registration](https://stackoverflow.com/questions/65922566/what-are-the-differences-between-service-principal-and-app-registration)

{% hint style="success" %}
UÄite i veÅ¾bajte AWS Hacking:<img src="../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">\
UÄite i veÅ¾bajte GCP Hacking: <img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>PodrÅ¡ka HackTricks</summary>

* Proverite [**planove pretplate**](https://github.com/sponsors/carlospolop)!
* **PridruÅ¾ite se** ğŸ’¬ [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili **pratite** nas na **Twitteru** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podelite hakerske trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
{% endhint %}
