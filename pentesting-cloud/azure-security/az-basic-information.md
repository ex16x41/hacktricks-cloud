# Az - Temel Bilgiler

{% hint style="success" %}
AWS Hacking'i öğrenin ve pratik yapın:<img src="../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">[**HackTricks Eğitim AWS Kırmızı Takım Uzmanı (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">\
GCP Hacking'i öğrenin ve pratik yapın: <img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Eğitim GCP Kırmızı Takım Uzmanı (GRTE)**<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**abonelik planlarını**](https://github.com/sponsors/carlospolop) kontrol edin!
* **Bize katılın** 💬 [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) veya **bizi takip edin** **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **HackTricks** ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna PR göndererek hacking ipuçlarını paylaşın.

</details>
{% endhint %}

## Organizasyon Hiyerarşisi

<figure><img src="https://lh7-rt.googleusercontent.com/slidesz/AGV_vUchBvhjIdWWR2ldAkWiZMdmrcEYD9Ti5UAa3zAGr9YbAnx4Q_gZNp_zvOU429vgWZ_ixoYHQKdC8bGgkhWYCy591SRIFj6RKCj4BEpVQixAGsp3T3O5sS3k7x5CTaJ-SCBNC7i5KluLyxdiXoZsH1F0ko1Gv88=s2048?key=gSyKQr3HTyhvHa28Rf7LVA" alt=""><figcaption></figcaption></figure>

### Yönetim Grupları

* **Diğer yönetim gruplarını veya abonelikleri** içerebilir.
* Bu, yönetim grubu düzeyinde RBAC ve Azure Policy gibi **yönetim kontrollerinin uygulanmasına** olanak tanır ve bunların grup içindeki tüm abonelikler tarafından **devralınmasını** sağlar.
* Tek bir dizinde **10.000 yönetim** grubu desteklenebilir.
* Bir yönetim grubu ağacı **altı seviyeye kadar derinliği** destekleyebilir. Bu sınır, kök düzeyini veya abonelik düzeyini içermez.
* Her yönetim grubu ve abonelik **sadece bir ebeveyn** destekleyebilir.
* Birden fazla yönetim grubu oluşturulabilse de **sadece 1 kök yönetim grubu** vardır.
* Kök yönetim grubu **tüm** **diğer yönetim gruplarını ve abonelikleri** **içerir** ve **taşınamaz veya silinemez**.
* Tek bir yönetim grubundaki tüm abonelikler **aynı Entra ID kiracısına** güvenmelidir.

<figure><img src="../../.gitbook/assets/image (147).png" alt=""><figcaption><p><a href="https://td-mainsite-cdn.tutorialsdojo.com/wp-content/uploads/2023/02/managementgroups-768x474.png">https://td-mainsite-cdn.tutorialsdojo.com/wp-content/uploads/2023/02/managementgroups-768x474.png</a></p></figcaption></figure>

### Azure Abonelikleri

* Bu, **kaynakların** (VM'ler, DB'ler…) çalıştırılabileceği ve faturalandırılacağı başka bir **mantıksal konteynerdir**.
* **Ebeveyni** her zaman bir **yönetim grubudur** (ve kök yönetim grubu olabilir) çünkü abonelikler diğer abonelikleri içeremez.
* **Sadece bir Entra ID** dizinine güvenmektedir.
* Abonelik düzeyinde (veya ebeveynlerinden herhangi birinde) uygulanan **izinler**, abonelik içindeki tüm kaynaklara **devralınır**.

### Kaynak Grupları

[Belgelerden:](https://learn.microsoft.com/en-us/azure/azure-resource-manager/management/manage-resource-groups-python?tabs=macos#what-is-a-resource-group) Bir kaynak grubu, bir Azure çözümü için **ilişkili kaynakları** tutan bir **konteynerdir**. Kaynak grubu, çözüm için tüm kaynakları veya yalnızca **bir grup olarak yönetmek istediğiniz kaynakları** içerebilir. Genel olarak, aynı **yaşam döngüsüne** sahip **kaynakları** aynı kaynak grubuna ekleyin, böylece bunları grup olarak kolayca dağıtabilir, güncelleyebilir ve silebilirsiniz.

Tüm **kaynaklar** **bir kaynak grubunun içinde** olmalı ve yalnızca bir gruba ait olabilir ve bir kaynak grubu silinirse, içindeki tüm kaynaklar da silinir.

<figure><img src="https://lh7-rt.googleusercontent.com/slidesz/AGV_vUfe8U30iP_vdZCvxX4g8nEPRLoo7v0kmCGkDn1frBPn3_GIoZ7VT2LkdsVQWCnrG_HSYNRRPM-1pSECUkbDAB-9YbUYLzpvKVLDETZS81CHWKYM4fDl3oMo5-yvTMnjdLTS2pz8U67xUTIzBhZ25MFMRkq5koKY=s2048?key=gSyKQr3HTyhvHa28Rf7LVA" alt=""><figcaption><p><a href="https://i0.wp.com/azuredays.com/wp-content/uploads/2020/05/org.png?resize=748%2C601&#x26;ssl=1">https://i0.wp.com/azuredays.com/wp-content/uploads/2020/05/org.png?resize=748%2C601&#x26;ssl=1</a></p></figcaption></figure>

### Azure Kaynak Kimlikleri

Azure'daki her kaynak, onu tanımlayan bir Azure Kaynak Kimliğine sahiptir.

Bir Azure Kaynak Kimliğinin formatı şu şekildedir:

* `/subscriptions/{subscriptionId}/resourceGroups/{resourceGroupName}/providers/{resourceProviderNamespace}/{resourceType}/{resourceName}`

`myResourceGroup` kaynak grubunda `myVM` adında bir sanal makine için, Azure Kaynak Kimliği şu şekilde görünür:

* `/subscriptions/12345678-1234-1234-1234-123456789012/resourceGroups/myResourceGroup/providers/Microsoft.Compute/virtualMachines/myVM`

## Azure vs Entra ID vs Azure AD Alan Hizmetleri

### Azure

Azure, Microsoft'un kapsamlı **bulut bilişim platformudur, geniş bir hizmet yelpazesi sunar**, sanal makineler, veritabanları, yapay zeka ve depolama dahil. Uygulamaları barındırmak ve yönetmek, ölçeklenebilir altyapılar oluşturmak ve bulutta modern iş yüklerini çalıştırmak için temel işlevi görür. Azure, geliştiricilerin ve BT profesyonellerinin uygulamaları ve hizmetleri sorunsuz bir şekilde oluşturmasına, dağıtmasına ve yönetmesine olanak tanır ve başlangıçlardan büyük işletmelere kadar çeşitli ihtiyaçlara hitap eder.

### Entra ID (eski adıyla Azure Active Directory)

Entra ID, kimlik doğrulama, yetkilendirme ve kullanıcı erişim kontrolünü yönetmek için tasarlanmış bulut tabanlı bir **kimlik ve erişim yönetim hizmetidir**. Office 365, Azure ve birçok üçüncü taraf SaaS uygulaması gibi Microsoft hizmetlerine güvenli erişim sağlar. Tek oturum açma (SSO), çok faktörlü kimlik doğrulama (MFA) ve koşullu erişim politikaları gibi özellikler sunar.

### Entra Alan Hizmetleri (eski adıyla Azure AD DS)

Entra Alan Hizmetleri, Entra ID'nin yeteneklerini, **geleneksel Windows Active Directory ortamlarıyla uyumlu yönetilen alan hizmetleri** sunarak genişletir. LDAP, Kerberos ve NTLM gibi eski protokolleri destekler, böylece kuruluşlar, yerel alan denetleyicileri dağıtmadan bulutta eski uygulamaları taşımak veya çalıştırmak için geçiş yapabilir. Bu hizmet ayrıca merkezi yönetim için Grup İlkesi'ni destekler, bu da eski veya AD tabanlı iş yüklerinin modern bulut ortamlarıyla bir arada var olması gereken senaryolar için uygundur.

## Entra ID Prensipleri

### Kullanıcılar

* **Yeni kullanıcılar**
* Seçilen kiracıdan e-posta adı ve alanı belirtin
* Görüntüleme adını belirtin
* Şifreyi belirtin
* Özellikleri belirtin (isim, iş unvanı, iletişim bilgileri…)
* Varsayılan kullanıcı türü “**üye**”dir.
* **Dış kullanıcılar**
* Davet edilecek e-posta ve görüntüleme adını belirtin (Microsoft dışı bir e-posta olabilir)
* Özellikleri belirtin
* Varsayılan kullanıcı türü “**Misafir**”dir.

### Kullanıcıların Varsayılan İzinleri

* **Üyeler (**[**belgeler**](https://learn.microsoft.com/en-gb/entra/fundamentals/users-default-permissions#restrict-member-users-default-permissions)**)**
* Uygulama Kaydı: Varsayılan **Evet**
* Yönetici olmayan kullanıcıların kiracı oluşturmasını kısıtla: Varsayılan **Hayır**
* Güvenlik grupları oluştur: Varsayılan **Evet**
* Microsoft Entra yönetim portalına erişimi kısıtla: Varsayılan **Hayır**
* Bu, portala API erişimini kısıtlamaz (sadece web)
* Kullanıcıların LinkedIn ile iş veya okul hesabını bağlamasına izin ver: Varsayılan **Evet**
* Kullanıcının oturumunu açık tutmasını göster: Varsayılan **Evet**
* Kullanıcıların sahip oldukları cihazlar için BitLocker anahtarını kurtarmasını kısıtla: Varsayılan Hayır (Cihaz Ayarları'nda kontrol edin)
* Diğer kullanıcıları oku: Varsayılan **Evet** (Microsoft Graph aracılığıyla)
* **Misafirler**
* **Misafir kullanıcı erişim kısıtlamaları**
* **Misafir kullanıcılar, üyelerle aynı erişime sahiptir** varsayılan olarak tüm üye kullanıcı izinlerini misafir kullanıcılara verir.
* **Misafir kullanıcılar, dizin nesnelerinin özelliklerine ve üyeliklerine sınırlı erişime sahiptir (varsayılan)** varsayılan olarak misafir erişimini yalnızca kendi kullanıcı profillerine kısıtlar. Diğer kullanıcılar ve grup bilgilerine erişim artık izin verilmez.
* **Misafir kullanıcı erişimi, kendi dizin nesnelerinin özelliklerine ve üyeliklerine kısıtlanmıştır** en kısıtlayıcı olanıdır.
* **Misafirler davet edebilir**
* **Kuruluşta herhangi biri, misafir kullanıcıları davet edebilir, misafirler ve yönetici olmayanlar dahil (en kapsayıcı) - Varsayılan**
* **Üye kullanıcılar ve belirli yönetici rollerine atanmış kullanıcılar, misafir izinleri olan misafir kullanıcıları davet edebilir**
* **Sadece belirli yönetici rollerine atanmış kullanıcılar misafir kullanıcıları davet edebilir**
* **Kuruluşta hiç kimse, yönetici dahil misafir kullanıcıları davet edemez (en kısıtlayıcı)**
* **Dış kullanıcı ayrılabilir**: Varsayılan **Doğru**
* Dış kullanıcıların kuruluşu terk etmesine izin verin

{% hint style="success" %}
Varsayılan olarak kısıtlanmış olsalar da, izin verilen kullanıcılar (üyeler ve misafirler) önceki eylemleri gerçekleştirebilir.
{% endhint %}

### **Hizmet Prensipleri**

Bir **Hizmet Prensibi**, **uygulamalar**, barındırılan hizmetler ve Azure kaynaklarına erişim için otomatik araçlarla **kullanım** için oluşturulmuş bir **kimliktir**. Bu erişim, hizmet prensibine atanan rollerle **kısıtlanır**, böylece **hangi kaynakların erişilebileceği** ve hangi düzeyde erişileceği üzerinde kontrol sağlanır. Güvenlik nedenleriyle, **hizmet prensiplerini otomatik araçlarla kullanmak** her zaman önerilir, kullanıcı kimliği ile giriş yapmalarına izin vermektense.

Bir hizmet prensibi olarak doğrudan giriş yapmak mümkündür; bunun için bir **gizli anahtar** (şifre), bir **sertifika** oluşturabilir veya üçüncü taraf platformlara (örneğin, Github Actions) **federasyon** erişimi verebilirsiniz.

* **Şifre** kimlik doğrulamasını (varsayılan olarak) seçerseniz, **oluşturulan şifreyi kaydedin** çünkü bir daha erişemezsiniz.
* Sertifika kimlik doğrulamasını seçerseniz, **uygulamanın özel anahtara erişimi olmasını** sağladığınızdan emin olun.

### Uygulama Kayıtları

Bir **Uygulama Kaydı**, bir uygulamanın Entra ID ile entegre olmasına ve eylemler gerçekleştirmesine olanak tanıyan bir yapılandırmadır.

#### Ana Bileşenler:

1. **Uygulama Kimliği (İstemci Kimliği):** Azure AD'deki uygulamanız için benzersiz bir tanımlayıcı.
2. **Yeniden Yönlendirme URI'leri:** Azure AD'nin kimlik doğrulama yanıtlarını gönderdiği URL'ler.
3. **Sertifikalar, Gizli Anahtarlar ve Federasyon Kimlik Bilgileri:** Uygulamanın hizmet prensibi olarak giriş yapması için bir gizli anahtar veya sertifika oluşturmak veya ona federasyon erişimi vermek mümkündür (örneğin, Github Actions).&#x20;
1. Eğer bir **sertifika** veya **gizli anahtar** oluşturulursa, bir kişi **hizmet prensibi olarak giriş yapabilir** CLI araçlarıyla **uygulama kimliğini**, **gizli anahtarı** veya **sertifikayı** ve **kiracıyı** (alan veya kimlik) bilerek.
4. **API İzinleri:** Uygulamanın erişebileceği kaynakları veya API'leri belirtir.
5. **Kimlik Doğrulama Ayarları:** Uygulamanın desteklediği kimlik doğrulama akışlarını tanımlar (örneğin, OAuth2, OpenID Connect).
6. **Hizmet Prensibi**: Bir Uygulama oluşturulduğunda (web konsolundan yapılırsa) veya yeni bir kiracıya yüklendiğinde bir hizmet prensibi oluşturulur.
1. **Hizmet prensibi**, yapılandırıldığı tüm istenen izinleri alır.

### Kurumsal Uygulamalar

Bu, yalnızca **hizmet prensiplerini filtrelemek ve atanan uygulamaları kontrol etmek için Azure'da bir tablodur.**

**Başka bir “uygulama” türü değildir,** Azure'da “Kurumsal Uygulama” olan herhangi bir nesne yoktur, bu sadece Hizmet prensiplerini, Uygulama kayıtlarını ve yönetilen kimlikleri kontrol etmek için bir soyutlamadır.

### **Yönetilen Kimlik (Meta Veriler)**

Azure Active Directory'deki yönetilen kimlikler, uygulamaların kimliğini **otomatik olarak yönetme** çözümü sunar. Bu kimlikler, uygulamalar tarafından Azure Active Directory (**Azure AD**) kimlik doğrulaması ile uyumlu **kaynaklara** **bağlanmak** amacıyla kullanılır. Bu, uygulamanın **meta veri** hizmeti ile iletişim kurarak Azure'daki belirtilen yönetilen kimlik olarak **hareket etmek** için geçerli bir token almasını sağlar, böylece bulut kimlik bilgilerini kodda sabit kodlama ihtiyacını **ortadan kaldırır**.

İki tür yönetilen kimlik vardır:

* **Sistem atanan**. Bazı Azure hizmetleri, bir hizmet örneği üzerinde **yönetilen bir kimliği doğrudan etkinleştirmenize** olanak tanır. Sistem atanan bir yönetilen kimlik etkinleştirildiğinde, **hizmet prensibi**, kaynağın bulunduğu abonluğa güvenilen Entra ID kiracısında oluşturulur. **Kaynak** silindiğinde, Azure otomatik olarak **kimliği** sizin için **silmiştir**.
* **Kullanıcı atanan**. Kullanıcıların yönetilen kimlikler oluşturması da mümkündür. Bunlar, bir abonelik içindeki bir kaynak grubunun içinde oluşturulur ve EntraID'ye güvenilen bir hizmet prensibi oluşturulacaktır. Daha sonra, yönetilen kimliği bir veya **daha fazla örneğe** atayabilirsiniz (birden fazla kaynak). Kullanıcı atanan yönetilen kimlikler için, **kimlik, onu kullanan kaynaklardan ayrı olarak yönetilir**.

Yönetilen Kimlikler, ona bağlı hizmet prensibine erişim sağlamak için **sonsuz kimlik bilgileri** (şifreler veya sertifikalar gibi) oluşturmaz.

### Varsayılan Onay İzinleri

**Uygulamalar için kullanıcı onayı**

* **Kullanıcı onayını izin vermeyin**
* Tüm uygulamalar için bir yönetici gerekecektir.
* **Doğrulanmış yayıncılardan, seçilen izinler için uygulamalar için kullanıcı onayına izin verin (Tavsiye Edilir)**
* Tüm kullanıcılar, "düşük etki" olarak sınıflandırılan izinler için, doğrulanmış yayıncılardan veya bu kuruluşta kayıtlı uygulamalar için onay verebilir.
* **Varsayılan** düşük etki izinleri (bunları düşük olarak eklemek için kabul etmeniz gerekir):
* User.Read - oturum açma ve kullanıcı profilini okuma
* offline\_access - kullanıcının erişim verdiği verilere erişimi sürdürme
* openid - kullanıcıları oturum açtırma
* profile - kullanıcının temel profilini görüntüleme
* email - kullanıcının e-posta adresini görüntüleme
* **Uygulamalar için kullanıcı onayına izin ver (Varsayılan)**
* Tüm kullanıcılar, herhangi bir uygulamanın kuruluşun verilerine erişmesi için onay verebilir.

**Yönetici onay talepleri**: Varsayılan **Hayır**

* Kullanıcılar, onay veremedikleri uygulamalar için yönetici onayı talep edebilir
* Eğer **Evet**: Onay taleplerine onay verebilecek Kullanıcılar, Gruplar ve Roller belirtilebilir
* Kullanıcıların e-posta bildirimleri ve son tarih hatırlatmaları alıp almayacağını da yapılandırın&#x20;

### İdari Birimler

[Belgelerden:](https://learn.microsoft.com/en-us/entra/identity/role-based-access-control/admin-units-manage) İdari birimler, kuruluşunuzu istediğiniz **herhangi bir birime** **alt bölümlere ayırmanıza** ve ardından yalnızca o birimin **üyelerini yönetebilecek belirli yöneticiler atamanıza** olanak tanır. Örneğin, büyük bir üniversitedeki her okulun yöneticilerine izinleri devretmek için idari birimleri kullanabilirsiniz, böylece erişimi kontrol edebilir, kullanıcıları yönetebilir ve yalnızca Mühendislik Fakültesi'nde politikalar belirleyebilirler.

Sadece **kullanıcılar**, **gruplar** ve **cihazlar** bir **idari birimin** **üyeleri** olabilir.

Bu nedenle, bir **İdari birim**, bazı **üyeleri** **içerecek** ve diğer **prensiplere** o idari **birim üzerinde izinler atanacaktır**; bu izinleri kullanarak idari birimin üyelerini **yönetebilirler**.

## Roller ve İzinler

**Roller**, **prensiplere** bir **kapsamda** **atanır**: `prensip -[ROLÜ VAR]->(kapsam)`

**Gruplara** atanan **roller**, grubun tüm **üyeleri** tarafından **devralınır**.

Rolün atandığı kapsama bağlı olarak, **rol** kapsama dahil **diğer kaynaklara** **devralınabilir**. Örneğin, bir kullanıcı A'nın bir **abonelikte rolü** varsa, o **rolü, abonelik içindeki tüm kaynak gruplarında** ve **kaynak grubundaki tüm kaynaklarda** olacaktır.

### **Klasik Roller**

| **Sahip**                     | <ul><li>Tüm kaynaklara tam erişim</li><li>Diğer kullanıcılar için erişimi yönetebilir</li></ul> | Tüm kaynak türleri |
| ----------------------------- | ---------------------------------------------------------------------------------------- | ------------------ |
| **Katkıda Bulunan**               | <ul><li>Tüm kaynaklara tam erişim</li><li>Erişimi yönetemez</li></ul>              | Tüm kaynak türleri |
| **Okuyucu**                    | • Tüm kaynakları görüntüle                                                                     | Tüm kaynak türleri |
| **Kullanıcı Erişim Yöneticisi** | <ul><li>Tüm kaynakları görüntüle</li><li>Diğer kullanıcılar için erişimi yönetebilir</li></ul>           | Tüm kaynak türleri |

### Yerleşik Roller

[Belgelerden: ](https://learn.microsoft.com/en-us/azure/role-based-access-control/built-in-roles)[Azure rol tabanlı erişim kontrolü (Azure RBAC)](https://learn.microsoft.com/en-us/azure/role-based-access-control/overview) kullanıcılar, gruplar, hizmet prensipleri ve yönetilen kimlikler için **atanabilecek** birkaç Azure **yerleşik rolü** vardır. Rol atamaları, **Azure kaynaklarına erişimi kontrol etmenin** yoludur. Yerleşik roller, kuruluşunuzun özel ihtiyaçlarını karşılamıyorsa, kendi [**Azure özel rollerinizi**](https://learn.microsoft.com/en-us/azure/role-based-access-control/custom-roles)** oluşturabilirsiniz.**

**Yerleşik** roller yalnızca **amaçlandıkları kaynaklara** **uygulanır**, örneğin, **Hesaplama** kaynakları üzerindeki bu 2 yerleşik rol örneğine bakın:

| [Disk Yedekleme Okuyucusu](https://learn.microsoft.com/en-us/azure/role-based-access-control/built-in-roles#disk-backup-reader)                 | Disk yedeklemesi gerçekleştirmek için yedekleme kasasına izin verir.      | 3e5e47e6-65f7-47ef-90b5-e5dd4d455f24 |
| ----------------------------------------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------- | ------------------------------------ |
| [Sanal Makine Kullanıcı Girişi](https://learn.microsoft.com/en-us/azure/role-based-access-control/built-in-roles#virtual-machine-user-login) | Portaldaki Sanal Makineleri görüntüleyin ve normal bir kullanıcı olarak oturum açın. | fb879df8-f326-4884-b1cf-06f3ad86be52 |

Bu roller, **mantıksal konteynerler** (yönetim grupları, abonelikler ve kaynak grupları gibi) üzerinde de **atanabilir** ve etkilenen prensipler, **bu konteynerlerin içindeki kaynaklar üzerinde** bu rollere sahip olacaktır.

* Burada [**tüm Azure yerleşik rollerinin**](https://learn.microsoft.com/en-us/azure/role-based-access-control/built-in-roles) bir listesini bulabilirsiniz.
* Burada [**tüm Azure AD yerleşik rollerinin**](https://learn.microsoft.com/en-us/azure/active-directory/roles/permissions-reference) bir listesini bulabilirsiniz.

### Özel Roller

Azure, kullanıcıların ihtiyaç duyduğu izinlerle [**özel roller**](https://learn.microsoft.com/en-us/azure/role-based-access-control/custom-roles) oluşturmasına da olanak tanır.

### İzin Reddedildi

* Bir **prensibin bir kaynağa erişimi olması için**, ona açık bir rol verilmesi gerekir (herhangi bir şekilde) **ona o izni vermek**.
* Açık bir **reddetme rolü ataması**, izni veren rolün önceliğine sahiptir.

<figure><img src="../../.gitbook/assets/image (191).png" alt=""><figcaption></figcaption></figure>

### Küresel Yönetici

Küresel Yönetici rolüne sahip kullanıcılar, **kök yönetim grubuna Kullanıcı Erişim Yöneticisi Azure rolüne 'yükseltme'** yeteneğine sahiptir. Bu, bir Küresel Yöneticinin **tüm Azure aboneliklerini ve yönetim gruplarını** yönetebileceği anlamına gelir.\
Bu yükseltme, sayfanın sonunda yapılabilir: [https://portal.azure.com/#view/Microsoft\_AAD\_IAM/ActiveDirectoryMenuBlade/\~/Properties](https://portal.azure.com/#view/Microsoft\_AAD\_IAM/ActiveDirectoryMenuBlade/\~/Properties)

<figure><img src="../../.gitbook/assets/image (162).png" alt=""><figcaption></figcaption></figure>

### Azure Politikaları

Azure politikaları, Microsoft Azure'da **kurumsal standartları yönetmeye ve uygulamaya yardımcı olan bir dizi kural ve düzenlemedir**, bulut bilişim hizmeti olarak, ve ölçekli uyumluluğu değerlendirmek için. Bu politikalar, **Azure kaynaklarınız** üzerinde farklı kurallar uygular, bu kaynakların kurumsal standartlara ve hizmet düzeyi anlaşmalarına uyumlu kalmasını sağlar.

Azure politikaları, bulut yönetimi ve güvenliği için kritik öneme sahiptir, kaynakların düzgün ve verimli bir şekilde kullanılmasını sağlamaya yardımcı olur ve dış düzenlemelere ve iç politikalara uyumlu olmasını sağlar.\
Bazı örnekler:

1. **Belirli Azure Bölgeleri ile Uyum Sağlama**: Bu politika, tüm kaynakların belirli Azure bölgelerinde dağıtılmasını sağlar. Örneğin, bir şirket, tüm verilerinin GDPR uyumluluğu için Avrupa'da saklandığından emin olmak isteyebilir.
2. **İsimlendirme Standartlarını Zorunlu Kılma**: Politikalar, Azure kaynakları için isimlendirme kurallarını zorunlu kılabilir. Bu, büyük ortamlarda kaynakları isimlerine göre düzenlemeye ve kolayca tanımlamaya yardımcı olur.
3. **Belirli Kaynak Türlerini Kısıtlama**: Bu politika, belirli türde kaynakların oluşturulmasını kısıtlayabilir. Örneğin, maliyetleri kontrol etmek için belirli VM boyutları gibi pahalı kaynak türlerinin oluşturulmasını önlemek için bir politika belirlenebilir.
4. **Etiketleme Politikalarını Zorunlu Kılma**: Etiketler, Azure kaynaklarıyla ilişkilendirilen anahtar-değer çiftleridir ve kaynak yönetimi için kullanılır. Politikalar, belirli etiketlerin mevcut olmasını veya tüm kaynaklar için belirli değerlere sahip olmasını zorunlu kılabilir. Bu, maliyet takibi, sahiplik veya kaynakların kategorize edilmesi için faydalıdır.
5. **Kaynaklara Kamu Erişimini Sınırlama**: Politikalar, belirli kaynakların, depolama hesapları veya veritabanları gibi, kamu uç noktalarına sahip olmamasını zorunlu kılabilir, böylece yalnızca kuruluşun ağı içinde erişilebilir olmalarını sağlar.
6. **Güvenlik Ayarlarını Otomatik Olarak Uygulama**: Politikalar, tüm VM'lere belirli bir ağ güvenlik grubunu uygulamak veya tüm depolama hesaplarının şifreleme kullanmasını sağlamak gibi kaynaklara güvenlik ayarlarını otomatik olarak uygulamak için kullanılabilir.

Azure Politikalarının, Azure hiyerarşisinin herhangi bir seviyesine eklenebileceğini unutmayın, ancak genellikle **kök yönetim grubunda** veya diğer yönetim gruplarında **kullanılır**.

### İzin Kapsamı

Azure'da **izinler, hiyerarşinin herhangi bir parçasına atanabilir**. Bu, yönetim gruplarını, abonelikleri, kaynak gruplarını ve bireysel kaynakları içerir. İzinler, atandıkları varlığın **içindeki kaynaklar** tarafından **devralınır**.

Bu hiyerarşik yapı, erişim izinlerinin verimli ve ölçeklenebilir bir şekilde yönetilmesine olanak tanır.

<figure><img src="../../.gitbook/assets/image (26).png" alt=""><figcaption></figcaption></figure>

### Azure RBAC vs ABAC

**RBAC** (rol tabanlı erişim kontrolü), önceki bölümlerde gördüğümüz şeydir: **Bir prensibe bir rol atamak ve ona bir kaynağa erişim vermek**.\
Ancak, bazı durumlarda **daha ince ayrıntılı erişim yönetimi** sağlamak veya **yüzlerce** rol **atanımını** yönetimini **basitleştirmek** isteyebilirsiniz.

Azure **ABAC** (özellik tabanlı erişim kontrolü), belirli eylemler bağlamında **özelliklere dayalı rol atama koşulları** ekleyerek Azure RBAC'yi geliştirir. Bir _rol atama koşulu_, rol atamanıza ek olarak isteğe bağlı olarak ekleyebileceğiniz bir **ek kontrol**'dür ve daha ince ayrıntılı erişim kontrolü sağlar. Bir koşul, rol tanımının ve rol atamasının bir parçası olarak verilen izinleri filtreler. Örneğin, bir nesneyi okumak için nesnenin belirli bir etikete sahip olmasını **gerektiren** bir koşul ekleyebilirsiniz.\
Belirli kaynaklara erişimi **açıkça reddedemezsiniz** **koşullar** kullanarak.

### Varsayılan Kullanıcı İzinleri

Temel bir kullanıcı, AzureAD'nin bazı bölümlerini listelemek için bazı **varsayılan izinlere** sahip olacaktır:

* Tüm kullanıcıları, Grupları, Uygulamaları, Cihazları, Rolleri, Abonelikleri ve bunların genel özelliklerini okuma
* Misafirleri davet etme (_kapalı hale getirilebilir_)
* Güvenlik grupları oluşturma
* Gizli olmayan Grup üyeliklerini okuma
* Sahip olunan gruplara misafir ekleme
* Yeni uygulama oluşturma (_kapalı hale getirilebilir_)
* Azure'a kadar 50 cihaza kadar ekleme (_kapalı hale getirilebilir_)

Tam [**kullanıcıların varsayılan izinleri**](https://learn.microsoft.com/en-us/azure/active-directory/fundamentals/users-default-permissions) listesini belgelerde görebilirsiniz. Ayrıca, o listede **misafirlerin varsayılan izinler listesini** de görebilirsiniz.

{% hint style="info" %}
Azure kaynaklarını listelemek için kullanıcının iznin açıkça verilmesi gerektiğini unutmayın.
{% endhint %}

### Ayrıcalıklı Kimlik Yönetimi (PIM)

Azure'daki Ayrıcalıklı Kimlik Yönetimi (PIM), Azure Active Directory ve Azure'daki ayrıcalıklı erişimi **yönetmek, kontrol etmek ve izlemek** için bir araçtır. **Anlık ve zaman sınırlı ayrıcalıklı erişim** sağlayarak, **onay iş akışlarını zorunlu kılarak ve ek kimlik doğrulama gerektirerek** güvenliği artırır. Bu yaklaşım, yükseltilmiş izinlerin yalnızca gerektiğinde ve belirli bir süre için verilmesini sağlayarak yetkisiz erişim riskini en aza indirir.

## Kimlik Doğrulama Tokenları

OIDC'de kullanılan **üç tür token** vardır:

* [**Erişim Tokenları**](https://learn.microsoft.com/en-us/azure/active-directory/develop/access-tokens)**:** İstemci, bu tokenı kaynak sunucusuna **kaynaklara erişmek** için sunar. Sadece belirli bir kullanıcı, istemci ve kaynak kombinasyonu için kullanılabilir ve **iptal edilemez**; bu, varsayılan olarak 1 saat süresidir. Kullanım algısı düşüktür.
* **ID Tokenları**: İstemci, bu **tokenı yetkilendirme sunucusundan** alır. Kullanıcı hakkında temel bilgileri içerir. **Belirli bir kullanıcı ve istemci kombinasyonuna** bağlıdır.
* **Yenileme Tokenları**: İstemciye erişim tokenı ile sağlanır. **Yeni erişim ve ID tokenları almak için** kullanılır. Belirli bir kullanıcı ve istemci kombinasyonuna bağlıdır ve iptal edilebilir. Varsayılan süresi, **hareketsiz yenileme tokenları için 90 gündür** ve **aktif tokenlar için süresizdir**.

{% hint style="warning" %}
**Koşullu erişim** bilgileri **JWT** içinde **saklanır**. Bu nedenle, **izin verilen bir IP adresinden token talep ederseniz**, o **IP** token içinde **saklanır** ve ardından o tokenı **izin verilmeyen bir IP'den kaynaklara erişmek için** kullanabilirsiniz.
{% endhint %}

Erişim tokenlarını talep etmenin ve bunlarla giriş yapmanın farklı yollarını öğrenmek için aşağıdaki sayfayı kontrol edin:

{% content-ref url="az-azuread/" %}
[az-azuread](az-azuread/)
{% endcontent-ref %}

En yaygın API uç noktaları şunlardır:

* **Azure Kaynak Yöneticisi** (ARM): management.azure.com
* **Microsoft Graph**: graph.microsoft.com (artık kullanılmayan Azure AD Graph, graph.windows.net'dir)

## Referanslar

* [https://learn.microsoft.com/en-us/azure/governance/management-groups/overview](https://learn.microsoft.com/en-us/azure/governance/management-groups/overview)
* [https://learn.microsoft.com/en-us/azure/cloud-adoption-framework/ready/azure-best-practices/organize-subscriptions](https://learn.microsoft.com/en-us/azure/cloud-adoption-framework/ready/azure-best-practices/organize-subscriptions)
* [https://abouttmc.com/glossary/azure-subscription/#:\~:text=An%20Azure%20subscription%20is%20a,the%20subscription%20it%20belongs%20to.](https://abouttmc.com/glossary/azure-subscription/)
* [https://learn.microsoft.com/en-us/azure/role-based-access-control/overview#how-azure-rbac-determines-if-a-user-has-access-to-a-resource](https://learn.microsoft.com/en-us/azure/role-based-access-control/overview#how-azure-rbac-determines-if-a-user-has-access-to-a-resource)
* [https://stackoverflow.com/questions/65922566/what-are-the-differences-between-service-principal-and-app-registration](https://stackoverflow.com/questions/65922566/what-are-the-differences-between-service-principal-and-app-registration)

{% hint style="success" %}
AWS Hacking'i öğrenin ve pratik yapın:<img src="../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">[**HackTricks Eğitim AWS Kırmızı Takım Uzmanı (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">\
GCP Hacking'i öğrenin ve pratik yapın: <img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Eğitim GCP Kırmızı Takım Uzmanı (GRTE)**<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**abonelik planlarını**](https://github.com/sponsors/carlospolop) kontrol edin!
* **Bize katılın** 💬 [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) veya **bizi takip edin** **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **HackTricks** ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna PR göndererek hacking ipuçlarını paylaşın.

</details>
{% endhint %}
