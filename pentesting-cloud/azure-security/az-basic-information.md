# Az - Basiese Inligting

{% hint style="success" %}
Leer & oefen AWS Hacking:<img src="../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
Leer & oefen GCP Hacking: <img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Ondersteun HackTricks</summary>

* Kyk na die [**subskripsie planne**](https://github.com/sponsors/carlospolop)!
* **Sluit aan by die** üí¨ [**Discord groep**](https://discord.gg/hRep4RUj7f) of die [**telegram groep**](https://t.me/peass) of **volg** ons op **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Deel hacking truuks deur PRs in te dien na die** [**HackTricks**](https://github.com/carlospolop/hacktricks) en [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Organisasie Hi√´rargie

<figure><img src="https://lh7-rt.googleusercontent.com/slidesz/AGV_vUchBvhjIdWWR2ldAkWiZMdmrcEYD9Ti5UAa3zAGr9YbAnx4Q_gZNp_zvOU429vgWZ_ixoYHQKdC8bGgkhWYCy591SRIFj6RKCj4BEpVQixAGsp3T3O5sS3k7x5CTaJ-SCBNC7i5KluLyxdiXoZsH1F0ko1Gv88=s2048?key=gSyKQr3HTyhvHa28Rf7LVA" alt=""><figcaption></figcaption></figure>

### Bestuursgroepe

* Dit kan **ander bestuursgroepe of subskripsies** bevat.
* Dit stel in staat om **governance kontroles** soos RBAC en Azure Beleid een keer op die bestuursgroep vlak toe te pas en dit te **erf** deur al die subskripsies in die groep.
* **10,000 bestuurs** groepe kan in 'n enkele gids ondersteun word.
* 'n bestuursgroep boom kan **tot ses vlakke diepte** ondersteun. Hierdie limiet sluit nie die wortelvlak of die subskripsievlak in nie.
* Elke bestuursgroep en subskripsie kan **slegs een ouer** ondersteun.
* Alhoewel verskeie bestuursgroepe geskep kan word, is daar **slegs 1 wortel bestuursgroep**.
* Die wortel bestuursgroep **bevat** al die **ander bestuursgroepe en subskripsies** en **kan nie verskuif of verwyder** word nie.
* Alle subskripsies binne 'n enkele bestuursgroep moet die **dieselfde Entra ID tenant** vertrou.

<figure><img src="../../.gitbook/assets/image (147).png" alt=""><figcaption><p><a href="https://td-mainsite-cdn.tutorialsdojo.com/wp-content/uploads/2023/02/managementgroups-768x474.png">https://td-mainsite-cdn.tutorialsdojo.com/wp-content/uploads/2023/02/managementgroups-768x474.png</a></p></figcaption></figure>

### Azure Subskripsies

* Dit is 'n ander **logiese houer waar hulpbronne** (VMs, DBs‚Ä¶) gedra kan word en gefaktureer sal word.
* Sy **ouer** is altyd 'n **bestuursgroep** (en dit kan die wortel bestuursgroep wees) aangesien subskripsies nie ander subskripsies kan bevat nie.
* Dit **vertrou slegs een Entra ID** gids
* **Toestemmings** toegepas op die subskripsievlak (of enige van sy ouers) word **erf** na al die hulpbronne binne die subskripsie

### Hulpbron Groepe

[Uit die dokumentasie:](https://learn.microsoft.com/en-us/azure/azure-resource-manager/management/manage-resource-groups-python?tabs=macos#what-is-a-resource-group) 'n Hulpbron groep is 'n **houer** wat **verwante hulpbronne** vir 'n Azure oplossing bevat. Die hulpbron groep kan al die hulpbronne vir die oplossing insluit, of slegs daardie **hulpbronne wat jy as 'n groep wil bestuur**. Oor die algemeen, voeg **hulpbronne** wat die **selfde lewensiklus** deel by die selfde hulpbron groep sodat jy dit maklik kan ontplooi, opdateer, en verwyder as 'n groep.

Alle **hulpbronne** moet **binne 'n hulpbron groep** wees en kan slegs aan een groep behoort, en as 'n hulpbron groep verwyder word, word al die hulpbronne daarin ook verwyder.

<figure><img src="https://lh7-rt.googleusercontent.com/slidesz/AGV_vUfe8U30iP_vdZCvxX4g8nEPRLoo7v0kmCGkDn1frBPn3_GIoZ7VT2LkdsVQWCnrG_HSYNRRPM-1pSECUkbDAB-9YbUYLzpvKVLDETZS81CHWKYM4fDl3oMo5-yvTMnjdLTS2pz8U67xUTIzBhZ25MFMRkq5koKY=s2048?key=gSyKQr3HTyhvHa28Rf7LVA" alt=""><figcaption><p><a href="https://i0.wp.com/azuredays.com/wp-content/uploads/2020/05/org.png?resize=748%2C601&#x26;ssl=1">https://i0.wp.com/azuredays.com/wp-content/uploads/2020/05/org.png?resize=748%2C601&#x26;ssl=1</a></p></figcaption></figure>

### Azure Hulpbron ID's

Elke hulpbron in Azure het 'n Azure Hulpbron ID wat dit identifiseer.

Die formaat van 'n Azure Hulpbron ID is soos volg:

* `/subscriptions/{subscriptionId}/resourceGroups/{resourceGroupName}/providers/{resourceProviderNamespace}/{resourceType}/{resourceName}`

Vir 'n virtuele masjien genaamd myVM in 'n hulpbron groep `myResourceGroup` onder subskripsie ID `12345678-1234-1234-1234-123456789012`, lyk die Azure Hulpbron ID soos volg:

* `/subscriptions/12345678-1234-1234-1234-123456789012/resourceGroups/myResourceGroup/providers/Microsoft.Compute/virtualMachines/myVM`

## Azure vs Entra ID vs Azure AD Domein Dienste

### Azure

Azure is Microsoft se omvattende **cloud computing platform, wat 'n wye reeks dienste bied**, insluitend virtuele masjiene, databasisse, kunsmatige intelligensie, en stoor. Dit dien as die grondslag vir die gasheer en bestuur van toepassings, die bou van skaalbare infrastruktuur, en die uitvoering van moderne werklas in die wolk. Azure bied gereedskap vir ontwikkelaars en IT-professionals om toepassings en dienste naatloos te skep, te ontplooi, en te bestuur, wat voorsien in 'n verskeidenheid behoeftes van startups tot groot ondernemings.

### Entra ID (voorheen Azure Active Directory)

Entra ID is 'n wolk-gebaseerde **identiteit en toegang bestuur diens** wat ontwerp is om autentisering, autorisasie, en gebruikers toegang beheer te hanteer. Dit bied veilige toegang tot Microsoft dienste soos Office 365, Azure, en baie derdeparty SaaS toepassings. Met funksies soos enkel teken-in (SSO), multi-faktor autentisering (MFA), en voorwaardelike toegang beleide onder andere.

### Entra Domein Dienste (voorheen Azure AD DS)

Entra Domein Dienste brei die vermo√´ns van Entra ID uit deur **bestuurde domein dienste aan te bied wat versoenbaar is met tradisionele Windows Active Directory omgewings**. Dit ondersteun ou protokolle soos LDAP, Kerberos, en NTLM, wat organisasies in staat stel om ou toepassings in die wolk te migreer of te laat loop sonder om plaaslike domein kontrollers te ontplooi. Hierdie diens ondersteun ook Groep Beleid vir gesentraliseerde bestuur, wat dit geskik maak vir scenario's waar ou of AD-gebaseerde werklas saam met moderne wolkomgewings moet bestaan.

## Entra ID Principals

### Gebruikers

* **Nuwe gebruikers**
* Dui e-pos naam en domein van die geselekteerde tenant aan
* Dui Vertoon naam aan
* Dui wagwoord aan
* Dui eienskappe aan (voornaam, posbeskrywing, kontak inligting‚Ä¶)
* Standaard gebruiker tipe is ‚Äú**lid**‚Äù
* **Buitelandse gebruikers**
* Dui e-pos aan om uit te nooi en vertoon naam (kan 'n nie-Microsoft e-pos wees)
* Dui eienskappe aan
* Standaard gebruiker tipe is ‚Äú**Gaste**‚Äù

### Lede & Gaste Standaard Toestemmings

Jy kan dit nagaan in [https://learn.microsoft.com/en-us/entra/fundamentals/users-default-permissions](https://learn.microsoft.com/en-us/entra/fundamentals/users-default-permissions) maar onder andere aksies sal 'n lid in staat wees om:

* Lees alle gebruikers, Groepe, Toepassings, Toestelle, Rolle, Subskripsies, en hul publieke eienskappe
* Nooi Gaste (_kan afgeskakel word_)
* Skep Sekuriteits groepe
* Lees nie-verborgene Groep lidmaatskappe
* Voeg gaste by Besit groepe
* Skep nuwe toepassing (_kan afgeskakel word_)
* Voeg tot 50 toestelle by Azure (_kan afgeskakel word_)

{% hint style="info" %}
Onthou dat om Azure hulpbronne te enumerate, die gebruiker 'n eksplisiete toekenning van die toestemming benodig.
{% endhint %}

### Gebruikers Standaard Konfigureerbare Toestemmings

* **Lede (**[**dokumentasie**](https://learn.microsoft.com/en-gb/entra/fundamentals/users-default-permissions#restrict-member-users-default-permissions)**)**
* Registreer Toepassings: Standaard **Ja**
* Beperk nie-admin gebruikers van die skep van tenants: Standaard **Nee**
* Skep sekuriteits groepe: Standaard **Ja**
* Beperk toegang tot Microsoft Entra administrasie portaal: Standaard **Nee**
* Dit beperk nie API toegang tot die portaal (slegs web)
* Laat gebruikers toe om werk of skool rekening met LinkedIn te verbind: Standaard **Ja**
* Toon hou gebruiker ingelog: Standaard **Ja**
* Beperk gebruikers van die herstel van die BitLocker sleutel(s) vir hul besit toestelle: Standaard Nee (kyk in Toestel Instellings)
* Lees ander gebruikers: Standaard **Ja** (deur Microsoft Graph)
* **Gaste**
* **Gaste gebruiker toegang beperkings**
* **Gaste gebruikers het dieselfde toegang as lede** gee alle lid gebruiker toestemmings aan gaste gebruikers per standaard.
* **Gaste gebruikers het beperkte toegang tot eienskappe en lidmaatskappe van gids objekte (standaard)** beperk gaste toegang tot slegs hul eie gebruikersprofiel per standaard. Toegang tot ander gebruikers en groep inligting is nie meer toegelaat nie.
* **Gaste gebruiker toegang is beperk tot eienskappe en lidmaatskappe van hul eie gids objekte** is die mees beperkende een.
* **Gaste kan uitnooi**
* **Enige iemand in die organisasie kan gaste gebruikers uitnooi insluitend gaste en nie-admins (mees inklusief) - Standaard**
* **Lid gebruikers en gebruikers wat aan spesifieke admin rolle toegeken is kan gaste gebruikers uitnooi insluitend gaste met lid toestemmings**
* **Slegs gebruikers wat aan spesifieke admin rolle toegeken is kan gaste gebruikers uitnooi**
* **Niemand in die organisasie kan gaste gebruikers uitnooi insluitend admins (mees beperkend)**
* **Buitelandse gebruiker verlaat**: Standaard **Waar**
* Laat buitelandse gebruikers toe om die organisasie te verlaat

{% hint style="success" %}
Alhoewel dit per standaard beperk is, kan gebruikers (lede en gaste) met toegekenne toestemmings die vorige aksies uitvoer.
{% endhint %}

### **Groepe**

Daar is **2 tipes groepe**:

* **Sekuriteit**: Hierdie tipe groep word gebruik om lede toegang te gee tot toepassings, hulpbronne en om lisensies toe te ken. Gebruikers, toestelle, diens principals en ander groepe kan lede wees.
* **Microsoft 365**: Hierdie tipe groep word gebruik vir samewerking, wat lede toegang gee tot 'n gedeelde posbus, kalender, l√™ers, SharePoint webwerf, ensovoorts. Groep lede kan slegs gebruikers wees.
* Dit sal 'n **e-pos adres** h√™ met die domein van die EntraID tenant.

Daar is **2 tipes lidmaatskappe**:

* **Toegewyse**: Laat toe om spesifieke lede handmatig aan 'n groep toe te voeg.
* **Dinamiese lidmaatskap**: Bestuur lidmaatskap outomaties met behulp van re√´ls, wat groep insluiting opdateer wanneer lede se eienskappe verander.

### **Diens Principals**

'n **Diens Principal** is 'n **identiteit** geskep vir **gebruik** met **toepassings**, gehoste dienste, en outomatiese gereedskap om toegang tot Azure hulpbronne te verkry. Hierdie toegang is **beperk deur die rolle wat aan die diens principal toegeken is**, wat jou beheer gee oor **watter hulpbronne toegang verkry kan word** en op watter vlak. Om veiligheidsredes, word dit altyd aanbeveel om **diens principals met outomatiese gereedskap te gebruik** eerder as om hulle toe te laat om in te log met 'n gebruikersidentiteit.

Dit is moontlik om **direk in te log as 'n diens principal** deur 'n **geheim** (wagwoord), 'n **sertifikaat**, of deur **federale** toegang aan derdeparty platforms (bv. Github Actions) oor dit te verleen.

* As jy **wagwoord** autentisering kies (per standaard), **stoor die gegenereerde wagwoord** aangesien jy dit nie weer kan toegang nie.
* As jy sertifikaat autentisering kies, maak seker dat die **toepassing toegang sal h√™ oor die private sleutel**.

### App Registrasies

'n **App Registrasie** is 'n konfigurasie wat 'n toepassing toelaat om met Entra ID te integreer en aksies uit te voer.

#### Sleuteldelers:

1. **Toepassing ID (Kli√´nt ID):** 'n Unieke identifiseerder vir jou app in Azure AD.
2. **Herlei URIs:** URL's waar Azure AD autentisering antwoorde stuur.
3. **Sertifikate, Geheimen & Federale Krediete:** Dit is moontlik om 'n geheim of 'n sertifikaat te genereer om in te log as die diens principal van die toepassing, of om federale toegang aan dit te verleen (bv. Github Actions).&#x20;
1. As 'n **sertifikaat** of **geheim** gegenereer word, is dit moontlik vir 'n persoon om **in te log as die diens principal** met CLI gereedskap deur die **toepassing ID**, die **geheim** of **sertifikaat** en die **tenant** (domein of ID) te ken.
4. **API Toestemmings:** Spesifiseer watter hulpbronne of API's die app toegang kan verkry.
5. **Autentisering Instellings:** Definieer die app se ondersteunde autentisering vloei (bv., OAuth2, OpenID Connect).
6. **Diens Principal**: 'n diens principal word geskep wanneer 'n App geskep word (as dit vanaf die webkonsol gedoen word) of wanneer dit in 'n nuwe tenant ge√Ønstalleer word.
1. Die **diens principal** sal al die gevraagde toestemmings wat dit geconfigureer is met ontvang.

### Standaard Toestemming Toestemmings

**Gebruiker toestemming vir toepassings**

* **Moet nie gebruiker toestemming toelaat nie**
* 'n administrateur sal vereis word vir alle apps.
* **Laat gebruiker toestemming toe vir apps van geverifieerde uitgewers, vir geselekteerde toestemmings (Aanbeveel)**
* Alle gebruikers kan toestemming gee vir toestemmings wat as "lae impak" geklassifiseer is, vir apps van geverifieerde uitgewers of apps geregistreer in hierdie organisasie.
* **Standaard** lae impak toestemmings (alhoewel jy moet aanvaar om hulle as laag by te voeg):
* User.Read - teken in en lees gebruikersprofiel
* offline\_access - hou toegang tot data wat gebruikers toegang gegee het
* openid - teken gebruikers in
* profiel - sien gebruiker se basiese profiel
* e-pos - sien gebruiker se e-pos adres
* **Laat gebruiker toestemming toe vir apps (Standaard)**
* Alle gebruikers kan toestemming gee vir enige app om toegang tot die organisasie se data te verkry.

**Admin toestemming versoeke**: Standaard **Nee**

* Gebruikers kan admin toestemming versoek vir apps waartoe hulle nie toestemming kan gee nie
* As **Ja**: Dit is moontlik om Gebruikers, Groepe en Rolle aan te dui wat toestemming versoeke kan gee
* Konfigureer ook of gebruikers e-pos kennisgewings en vervaldatums herinneringe sal ontvang&#x20;

### **Bestuurde Identiteit (Metadata)**

Bestuurde identiteite in Azure Active Directory bied 'n oplossing vir **outomatiese bestuur van die identiteit** van toepassings. Hierdie identiteite word deur toepassings gebruik met die doel om **verbinding te maak** met **hulpbronne** wat versoenbaar is met Azure Active Directory (**Azure AD**) autentisering. Dit stel in staat om **die behoefte aan hardkoding van wolk akrediteer** in die kode te verwyder aangesien die toepassing in staat sal wees om die **metadata** diens te kontak om 'n geldige token te verkry om **aksies** uit te voer as die aangeduide bestuurde identiteit in Azure.

Daar is twee tipes bestuurde identiteite:

* **Stelsel-toegewyse**. Sommige Azure dienste laat jou toe om 'n **bestuurde identiteit direk op 'n diens instansie** in te skakel. Wanneer jy 'n stelsel-toegewyse bestuurde identiteit inskakel, word 'n **diens principal** geskep in die Entra ID tenant wat deur die subskripsie vertrou word waar die hulpbron gele√´ is. Wanneer die **hulpbron** verwyder word, verwyder Azure outomaties die **identiteit** vir jou.
* **Gebruiker-toegewyse**. Dit is ook moontlik vir gebruikers om bestuurde identiteite te genereer. Hierdie word binne 'n hulpbron groep binne 'n subskripsie geskep en 'n diens principal sal geskep word in die EntraID wat deur die subskripsie vertrou word. Dan kan jy die bestuurde identiteit aan een of **meer instansies** van 'n Azure diens toewys (meerdere hulpbronne). Vir gebruiker-toegewyse bestuurde identiteite, word die **identiteit apart van die hulpbronne wat dit gebruik bestuur**.

Bestuurde Identiteite **genereer nie ewige akrediteer nie** (soos wagwoorde of sertifikate) om toegang te verkry as die diens principal wat aan dit geheg is.

### Enterprise Toepassings

Dit is net 'n **tafel in Azure om diens principals te filter** en die toepassings wat aan hulle toegeken is te kontroleer.

**Dit is nie 'n ander tipe "toepassing" nie,** daar is geen objek in Azure wat 'n "Enterprise Toepassing" is nie, dit is net 'n abstraksie om die Diens principals, App registrasies en bestuurde identiteite te kontroleer.

### Administratiewe Eenhede

Administratiewe eenhede laat toe om **toestemmings van 'n rol oor 'n spesifieke gedeelte van 'n organisasie te gee**.

Voorbeeld:

* Scenario: 'n maatskappy wil regionale IT admins toelaat om slegs die gebruikers in hul eie streek te bestuur.
* Implementering:
* Skep Administratiewe Eenhede vir elke streek (bv., "Noord-Amerika AU", "Europa AU").
* Vul AU's met gebruikers van hul onderskeie streke.
* AU's kan **gebruikers, groepe, of toestelle** bevat
* AU's ondersteun **dinamiese lidmaatskappe**
* AU's **kan nie AU's bevat nie**
* Ken Admin Rolle toe:
* Gee die "Gebruiker Administrateur" rol aan regionale IT personeel, geskaal na hul streek se AU.
* Uitkoms: Regionale IT admins kan gebruikersrekeninge binne hul streek bestuur sonder om ander streke te be√Ønvloed.

### Entra ID Rolle

* Ten einde Entra ID te bestuur, is daar 'n paar **ingeboude rolle** wat aan Entra ID principals toegeken kan word om Entra ID te bestuur
* Kyk na die rolle in [https://learn.microsoft.com/en-us/entra/identity/role-based-access-control/permissions-reference](https://learn.microsoft.com/en-us/entra/identity/role-based-access-control/permissions-reference)
* Die mees bevoorregte rol is **Globale Administrateur**
* In die Beskrywing van die rol is dit moontlik om sy **fynere toestemmings** te sien

## Rolle & Toestemmings

**Rolle** word **toegeken** aan **principals** op 'n **skaal**: `principal -[HAS ROLE]->(scope)`

**Rolle** toegeken aan **groepe** word **erf** deur al die **lede** van die groep.

Afhangende van die skaal waaraan die rol toegeken is, kan die **rol** **erf** na **ander hulpbronne** binne die skaal houer. Byvoorbeeld, as 'n gebruiker A 'n **rol op die subskripsie** het, sal hy daardie **rol op al die hulpbron groepe** binne die subskripsie h√™ en op **alle hulpbronne** binne die hulpbron groep.

### **Klassieke Rolle**

| **Eienaar**                     | <ul><li>Volledige toegang tot alle hulpbronne</li><li>Kan toegang vir ander gebruikers bestuur</li></ul> | Alle hulpbron tipes |
| ------------------------------- | ---------------------------------------------------------------------------------------- | ------------------ |
| **Bydraer**                     | <ul><li>Volledige toegang tot alle hulpbronne</li><li>Kan nie toegang bestuur nie</li></ul>              | Alle hulpbron tipes |
| **Leser**                       | ‚Ä¢ Sien alle hulpbronne                                                                     | Alle hulpbron tipes |
| **Gebruiker Toegang Administrateur** | <ul><li>Sien alle hulpbronne</li><li>Kan toegang vir ander gebruikers bestuur</li></ul>           | Alle hulpbron tipes |

### Gebou-in rolle

[Uit die dokumentasie: ](https://learn.microsoft.com/en-us/azure/role-based-access-control/built-in-roles)[Azure rol-gebaseerde toegangbeheer (Azure RBAC)](https://learn.microsoft.com/en-us/azure/role-based-access-control/overview) het verskeie Azure **gebou-in rolle** wat jy kan **toekenn** aan **gebruikers, groepe, diens principals, en bestuurde identiteite**. Rol toekennings is die manier waarop jy **toegang tot Azure hulpbronne** beheer. As die gebou-in rolle nie aan die spesifieke behoeftes van jou organisasie voldoen nie, kan jy jou eie [**Azure pasgemaakte rolle**](https://learn.microsoft.com/en-us/azure/role-based-access-control/custom-roles)**.**

**Gebou-in** rolle geld slegs vir die **hulpbronne** waarvoor hulle **bedoel** is, byvoorbeeld kyk na hierdie 2 voorbeelde van **Gebou-in rolle oor Compute** hulpbronne:

| [Disk Backup Reader](https://learn.microsoft.com/en-us/azure/role-based-access-control/built-in-roles#disk-backup-reader)                 | Bied toestemming aan om rugsteun kluise te gebruik om disk rugsteun te doen.      | 3e5e47e6-65f7-47ef-90b5-e5dd4d455f24 |
| ----------------------------------------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------- | ------------------------------------ |
| [Virtuele Masjien Gebruiker Login](https://learn.microsoft.com/en-us/azure/role-based-access-control/built-in-roles#virtual-machine-user-login) | Sien Virtuele Masjiene in die portaal en log in as 'n gewone gebruiker. | fb879df8-f326-4884-b1cf-06f3ad86be52 |

Hierdie rolle kan **ook toegeken word oor logiese houers** (soos bestuursgroepe, subskripsies en hulpbron groepe) en die principals wat geraak word sal dit **oor die hulpbronne binne daardie houers** h√™.

* Vind hier 'n lys met [**alle Azure gebou-in rolle**](https://learn.microsoft.com/en-us/azure/role-based-access-control/built-in-roles).
* Vind hier 'n lys met [**alle Entra ID gebou-in rolle**](https://learn.microsoft.com/en-us/azure/active-directory/roles/permissions-reference).

### Pasgemaakte Rolle

* Dit is ook moontlik om [**pasgemaakte rolle**](https://learn.microsoft.com/en-us/azure/role-based-access-control/custom-roles) te skep
* Hulle word binne 'n skaal geskep, alhoewel 'n rol in verskeie skale kan wees (bestuursgroepe, subskripsie en hulpbron groepe)
* Dit is moontlik om al die fynere toestemmings wat die pasgemaakte rol sal h√™ te konfigureer
* Dit is moontlik om toestemmings uit te sluit
* 'n principal met 'n uitgeslote toestemming sal nie in staat wees om dit te gebruik nie, selfs al word die toestemming elders toegeken
* Dit is moontlik om wildcard te gebruik
* Die gebruikte formaat is 'n JSON
* `actions` is vir kontrole aksies oor die hulpbron
* `dataActions` is toestemmings oor die data binne die objek

Voorbeeld van toestemmings JSON vir 'n pasgemaakte rol:
```json
{
"properties": {
"roleName": "",
"description": "",
"assignableScopes": [
"/subscriptions/9291ff6e-6afb-430e-82a4-6f04b2d05c7f"
],
"permissions": [
{
"actions": [
"Microsoft.DigitalTwins/register/action",
"Microsoft.DigitalTwins/unregister/action",
"Microsoft.DigitalTwins/operations/read",
"Microsoft.DigitalTwins/digitalTwinsInstances/read",
"Microsoft.DigitalTwins/digitalTwinsInstances/write",
"Microsoft.CostManagement/exports/*"
],
"notActions": [
"Astronomer.Astro/register/action",
"Astronomer.Astro/unregister/action",
"Astronomer.Astro/operations/read",
"Astronomer.Astro/organizations/read"
],
"dataActions": [],
"notDataActions": []
}
]
}
}
```
### Permissies volgorde

* Om 'n **hoofpersoon toegang tot 'n hulpbron te h√™**, moet daar 'n eksplisiete rol aan hom toegeken word (op enige manier) **wat hom daardie toestemming gee**.
* 'n Eksplisiete **weier roltoewysing het voorrang** bo die rol wat die toestemming gee.

<figure><img src="../../.gitbook/assets/image (191).png" alt=""><figcaption><p><a href="https://link.springer.com/chapter/10.1007/978-1-4842-7325-8_10">https://link.springer.com/chapter/10.1007/978-1-4842-7325-8_10</a></p></figcaption></figure>

### Globale Administrateur

Globale Administrateur is 'n rol van Entra ID wat **volledige beheer oor die Entra ID huurder** gee. Dit gee egter nie standaard enige toestemmings oor Azure hulpbronne nie.

Gebruikers met die Globale Administrateur rol het die vermo√´ om '**te verhoog' na die Gebruikerstoegang Administrateur Azure rol in die Wortelbestuursgroep**. So kan Globale Administrateurs toegang in **alle Azure subskripsies en bestuursgroepe bestuur.**\
Hierdie verhoging kan aan die einde van die bladsy gedoen word: [https://portal.azure.com/#view/Microsoft\_AAD\_IAM/ActiveDirectoryMenuBlade/\~/Properties](https://portal.azure.com/#view/Microsoft_AAD_IAM/ActiveDirectoryMenuBlade/~/Properties)

<figure><img src="../../.gitbook/assets/image (349).png" alt=""><figcaption></figcaption></figure>

### Azure Beleide

**Azure Beleide** is re√´ls wat organisasies help om te verseker dat hul hulpbronne aan spesifieke standaarde en nakomingsvereistes voldoen. Hulle stel jou in staat om **instellings op hulpbronne in Azure af te dwing of te oudit**. Byvoorbeeld, jy kan die skepping van virtuele masjiene in 'n nie-geautoriseerde streek voorkom of verseker dat alle hulpbronne spesifieke etikette het vir opsporing.

Azure Beleide is **proaktief**: hulle kan nie-nakomende hulpbronne keer om geskep of verander te word. Hulle is ook **reaktief**, wat jou toelaat om bestaande nie-nakomende hulpbronne te vind en reg te stel.

#### **Belangrike Konsepte**

1. **Beleid Definisie**: 'n Re√´l, geskryf in JSON, wat spesifiseer wat toegelaat of vereis word.
2. **Beleid Toewysing**: Die toepassing van 'n beleid op 'n spesifieke omvang (bv. subskripsie, hulpbron groep).
3. **Inisiatiewe**: 'n Versameling van beleide wat saamgegroepeer is vir bre√´r afdwinging.
4. **Effek**: Spesifiseer wat gebeur wanneer die beleid geaktiveer word (bv. "Weier," "Oudit," of "Voeg by").

**Sommige voorbeelde:**

1. **Verseker Nakoming met Spesifieke Azure Streke**: Hierdie beleid verseker dat alle hulpbronne in spesifieke Azure streke ontplooi word. Byvoorbeeld, 'n maatskappy mag wil verseker dat al sy data in Europa gestoor word vir GDPR-nakoming.
2. **Afgedwonge Naamstandaarde**: Beleide kan naamkonvensies vir Azure hulpbronne afdwing. Dit help om hulpbronne te organiseer en maklik te identifiseer op grond van hul name, wat nuttig is in groot omgewings.
3. **Beperking van Sekere Hulpbron Tipes**: Hierdie beleid kan die skepping van sekere tipes hulpbronne beperk. Byvoorbeeld, 'n beleid kan ingestel word om die skepping van duur hulpbron tipes, soos sekere VM-groottes, te voorkom om koste te beheer.
4. **Afgedwonge Etikettering Beleide**: Etikette is sleutel-waarde pare wat met Azure hulpbronne geassosieer word en gebruik word vir hulpbronbestuur. Beleide kan afdwing dat sekere etikette teenwoordig moet wees, of spesifieke waardes moet h√™, vir alle hulpbronne. Dit is nuttig vir kostebestuur, eienaarskap, of kategorisering van hulpbronne.
5. **Beperking van Publieke Toegang tot Hulpbronne**: Beleide kan afdwing dat sekere hulpbronne, soos stoor rekeninge of databasisse, nie publieke eindpunte het nie, wat verseker dat hulle slegs binne die organisasie se netwerk toeganklik is.
6. **Outomatiese Toepassing van Sekuriteitsinstellings**: Beleide kan gebruik word om outomaties sekuriteitsinstellings op hulpbronne toe te pas, soos om 'n spesifieke netwerk sekuriteitsgroep op alle VM's toe te pas of te verseker dat alle stoor rekeninge versleuteling gebruik.

Let daarop dat Azure Beleide aan enige vlak van die Azure hi√´rargie geheg kan word, maar hulle word **gewoonlik in die wortelbestuursgroep** of in ander bestuursgroepe gebruik.

Azure beleid json voorbeeld:
```json
{
"policyRule": {
"if": {
"field": "location",
"notIn": [
"eastus",
"westus"
]
},
"then": {
"effect": "Deny"
}
},
"parameters": {},
"displayName": "Allow resources only in East US and West US",
"description": "This policy ensures that resources can only be created in East US or West US.",
"mode": "All"
}
```
### Toestemmings Erf

In Azure **kan toestemmings aan enige deel van die hi√´rargie toegeken word**. Dit sluit bestuursgroepe, subskripsies, hulpbron groepe, en individuele hulpbronne in. Toestemmings word **ge√´rf** deur die ingeslote **hulpbronne** van die entiteit waar hulle toegeken is.

Hierdie hi√´rargiese struktuur stel in staat tot doeltreffende en skaalbare bestuur van toegangstoestemmings.

<figure><img src="../../.gitbook/assets/image (26).png" alt=""><figcaption></figcaption></figure>

### Azure RBAC vs ABAC

**RBAC** (rolgebaseerde toegangbeheer) is wat ons reeds in die vorige afdelings gesien het: **'n rol aan 'n prinsiep toe te ken om hom toegang te gee** oor 'n hulpbron.\
E however, in sommige gevalle wil jy dalk **meer fyn-gegradeerde toegangsbewaking** of **vereenvoudig** die bestuur van **honderde** rol **toekennings**.

Azure **ABAC** (attribuut-gebaseerde toegangbeheer) bou op Azure RBAC deur **roltoekenningsvoorwaardes gebaseer op attribuute** in die konteks van spesifieke aksies by te voeg. 'n _roltoekenningsvoorwaarde_ is 'n **addisionele kontrole wat jy opsioneel aan jou roltoekenning kan voeg** om meer fyn-gegradeerde toegangbeheer te bied. 'n Voorwaarde filter die toestemmings wat as deel van die roldefinisie en roltoekenning toegeken word. Byvoorbeeld, jy kan **'n voorwaarde byvoeg wat vereis dat 'n objek 'n spesifieke etiket moet h√™ om die objek te lees**.\
Jy **kan nie** eksplisiet **toegang** tot spesifieke hulpbronne **weier nie** **met behulp van voorwaardes**.

### Bevoorregte Identiteitsbestuur (PIM)

Bevoorregte Identiteitsbestuur (PIM) in Azure is 'n hulpmiddel wat **bevoorregte toegang bestuur, beheer en monitor** in Azure Active Directory en Azure. Dit verbeter sekuriteit deur **net-in-tyd en tyd-beperkte bevoorregte toegang** te bied, **goedkeuringswerkvloei af te dwing, en addisionele verifikasie te vereis**. Hierdie benadering minimaliseer die risiko van ongemagtigde toegang deur te verseker dat verhoogde toestemmings slegs gegee word wanneer nodig en vir 'n spesifieke tydsduur.

## Verifikasietokens

Daar is **drie tipes tokens** wat in OIDC gebruik word:

* [**Toegangstokens**](https://learn.microsoft.com/en-us/azure/active-directory/develop/access-tokens)**:** Die kli√´nt bied hierdie token aan die hulpbronbediener aan om **toegang tot hulpbronne** te verkry. Dit kan slegs gebruik word vir 'n spesifieke kombinasie van gebruiker, kli√´nt, en hulpbron en **kan nie herroep** word tot vervaldatum nie - dit is 1 uur per standaard.
* **ID Tokens**: Die kli√´nt ontvang hierdie **token van die outoriseringbediener**. Dit bevat basiese inligting oor die gebruiker. Dit is **gebind aan 'n spesifieke kombinasie van gebruiker en kli√´nt**.
* **Herfris Tokens**: Verskaf aan die kli√´nt saam met toegangstoken. Gebruik om **nuwe toegang en ID tokens te verkry**. Dit is gebind aan 'n spesifieke kombinasie van gebruiker en kli√´nt en kan herroep word. Standaard vervaldatum is **90 dae** vir inaktiewe herfris tokens en **geen vervaldatum vir aktiewe tokens**.

{% hint style="warning" %}
Inligting vir **voorwaardelike toegang** is **gestoor** binne die **JWT**. So, as jy die **token van 'n toegelate IP-adres** aan vra, sal daardie **IP** in die token **gestoor** word en dan kan jy daardie token van 'n **nie-toegelate IP gebruik om toegang tot die hulpbronne** te verkry.
{% endhint %}

### Toegangstokens "aud"

Afhangende van die aksie wat jy wil uitvoer, moet die "**aud**" van die toegangstoken geoutoriseer wees om die API-URL te kontak wat jy gaan kontak.

Die opdrag `az account get-access-token --resource-type [...]` ondersteun die volgende tipes en elkeen van hulle sal 'n spesifieke "aud" in die resulterende toegangstoken byvoeg:

{% hint style="danger" %}
Let daarop dat die volgende net die API's is wat deur `az account get-access-token` ondersteun word, maar daar is meer.
{% endhint %}

* **aad-graph (Azure Active Directory Graph API)**: Gebruik om toegang te verkry tot die verouderde Azure AD Graph API (afgeskaf), wat toepassings toelaat om gidsdata in Azure Active Directory (Azure AD) te lees en te skryf.
* `https://graph.windows.net/`
* **arm (Azure Resource Manager)**: Gebruik om Azure-hulpbronne deur die Azure Resource Manager API te bestuur. Dit sluit operasies in soos die skep, opdateer, en verwyder van hulpbronne soos virtuele masjiene, stoor rekeninge, en meer.
* `https://management.core.windows.net/ of https://management.azure.com/`
* **batch (Azure Batch Services)**: Gebruik om toegang te verkry tot Azure Batch, 'n diens wat grootmaat parallelle en ho√´-prestasie rekenaar toepassings doeltreffend in die wolk moontlik maak.
* `https://batch.core.windows.net/`
* **data-lake (Azure Data Lake Storage)**: Gebruik om te kommunikeer met Azure Data Lake Storage Gen1, wat 'n skaalbare data berging en analise diens is.
* `https://datalake.azure.net/`
* **media (Azure Media Services)**: Gebruik om toegang te verkry tot Azure Media Services, wat wolk-gebaseerde media verwerking en aflewering dienste vir video en klank inhoud bied.
* `https://rest.media.azure.net`
* **ms-graph (Microsoft Graph API)**: Gebruik om toegang te verkry tot die Microsoft Graph API, die verenigde eindpunt vir Microsoft 365 dienste data. Dit laat jou toe om toegang te verkry tot data en insigte van dienste soos Azure AD, Office 365, Enterprise Mobility, en Sekuriteitsdienste.
* `https://graph.microsoft.com`
* **oss-rdbms (Azure Open Source Relational Databases)**: Gebruik om toegang te verkry tot Azure Databasis dienste vir oop-bron relationele databasis enjin soos MySQL, PostgreSQL, en MariaDB.
* `https://ossrdbms-aad.database.windows.net`

Kyk na die volgende bladsy om verskillende maniere te leer om **toegangstokens aan te vra** en daarmee in te log:

{% content-ref url="az-azuread/" %}
[az-azuread](az-azuread/)
{% endcontent-ref %}

## Verwysings

* [https://learn.microsoft.com/en-us/azure/governance/management-groups/overview](https://learn.microsoft.com/en-us/azure/governance/management-groups/overview)
* [https://learn.microsoft.com/en-us/azure/cloud-adoption-framework/ready/azure-best-practices/organize-subscriptions](https://learn.microsoft.com/en-us/azure/cloud-adoption-framework/ready/azure-best-practices/organize-subscriptions)
* [https://abouttmc.com/glossary/azure-subscription/#:\~:text=An%20Azure%20subscription%20is%20a,the%20subscription%20it%20belongs%20to.](https://abouttmc.com/glossary/azure-subscription/)
* [https://learn.microsoft.com/en-us/azure/role-based-access-control/overview#how-azure-rbac-determines-if-a-user-has-access-to-a-resource](https://learn.microsoft.com/en-us/azure/role-based-access-control/overview#how-azure-rbac-determines-if-a-user-has-access-to-a-resource)
* [https://stackoverflow.com/questions/65922566/what-are-the-differences-between-service-principal-and-app-registration](https://stackoverflow.com/questions/65922566/what-are-the-differences-between-service-principal-and-app-registration)

{% hint style="success" %}
Leer & oefen AWS Hacking:<img src="../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
Leer & oefen GCP Hacking: <img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Ondersteun HackTricks</summary>

* Kyk na die [**subskripsie planne**](https://github.com/sponsors/carlospolop)!
* **Sluit aan by die** üí¨ [**Discord groep**](https://discord.gg/hRep4RUj7f) of die [**telegram groep**](https://t.me/peass) of **volg** ons op **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Deel hacking truuks deur PRs in te dien na die** [**HackTricks**](https://github.com/carlospolop/hacktricks) en [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
