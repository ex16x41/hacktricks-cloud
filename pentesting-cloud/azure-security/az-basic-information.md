# Az - Osnovne informacije

{% hint style="success" %}
Učite i vežbajte AWS Hacking:<img src="../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">\
Učite i vežbajte GCP Hacking: <img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Podrška HackTricks</summary>

* Proverite [**planove pretplate**](https://github.com/sponsors/carlospolop)!
* **Pridružite se** 💬 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili **pratite** nas na **Twitteru** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podelite hakerske trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
{% endhint %}

## Hijerarhija organizacije

<figure><img src="https://lh7-rt.googleusercontent.com/slidesz/AGV_vUchBvhjIdWWR2ldAkWiZMdmrcEYD9Ti5UAa3zAGr9YbAnx4Q_gZNp_zvOU429vgWZ_ixoYHQKdC8bGgkhWYCy591SRIFj6RKCj4BEpVQixAGsp3T3O5sS3k7x5CTaJ-SCBNC7i5KluLyxdiXoZsH1F0ko1Gv88=s2048?key=gSyKQr3HTyhvHa28Rf7LVA" alt=""><figcaption></figcaption></figure>

### Grupa za upravljanje

* Može sadržati **druge grupe za upravljanje ili pretplate**.
* Ovo omogućava **primenu kontrola upravljanja** kao što su RBAC i Azure Policy jednom na nivou grupe za upravljanje i njihovo **nasleđivanje** od strane svih pretplata u grupi.
* **10.000 grupa za upravljanje** može biti podržano u jednoj direktoriji.
* Drvo grupa za upravljanje može podržati **do šest nivoa dubine**. Ova granica ne uključuje nivo korena ili nivo pretplate.
* Svaka grupa za upravljanje i pretplata mogu podržavati **samo jednog roditelja**.
* Čak i ako se može kreirati nekoliko grupa za upravljanje, **postoji samo 1 korenska grupa za upravljanje**.
* Korenska grupa za upravljanje **sadrži** sve **druge grupe za upravljanje i pretplate** i **ne može se premestiti ili obrisati**.
* Sve pretplate unutar jedne grupe za upravljanje moraju verovati **istom Entra ID tenant-u.**

<figure><img src="../../.gitbook/assets/image (147).png" alt=""><figcaption><p><a href="https://td-mainsite-cdn.tutorialsdojo.com/wp-content/uploads/2023/02/managementgroups-768x474.png">https://td-mainsite-cdn.tutorialsdojo.com/wp-content/uploads/2023/02/managementgroups-768x474.png</a></p></figcaption></figure>

### Azure pretplate

* To je još jedan **logički kontejner u kojem se mogu pokretati resursi** (VM-ovi, DB-ovi…) i za koji će se naplaćivati.
* Njegov **roditelj** je uvek **grupa za upravljanje** (i može biti korenska grupa za upravljanje) jer pretplate ne mogu sadržati druge pretplate.
* **Veruje samo jednoj Entra ID** direktoriji.
* **Dozvole** primenjene na nivou pretplate (ili bilo kojem od njegovih roditelja) se **nasleđuju** svim resursima unutar pretplate.

### Grupe resursa

[Iz dokumenata:](https://learn.microsoft.com/en-us/azure/azure-resource-manager/management/manage-resource-groups-python?tabs=macos#what-is-a-resource-group) Grupa resursa je **kontejner** koji sadrži **povezane resurse** za Azure rešenje. Grupa resursa može uključivati sve resurse za rešenje, ili samo one **resurse koje želite da upravljate kao grupu**. Generalno, dodajte **resurse** koji dele **isti životni ciklus** u istu grupu resursa kako biste ih lako implementirali, ažurirali i obrisali kao grupu.

Svi **resursi** moraju biti **unutar grupe resursa** i mogu pripadati samo jednoj grupi, a ako se grupa resursa obriše, svi resursi unutar nje se takođe brišu.

<figure><img src="https://lh7-rt.googleusercontent.com/slidesz/AGV_vUfe8U30iP_vdZCvxX4g8nEPRLoo7v0kmCGkDn1frBPn3_GIoZ7VT2LkdsVQWCnrG_HSYNRRPM-1pSECUkbDAB-9YbUYLzpvKVLDETZS81CHWKYM4fDl3oMo5-yvTMnjdLTS2pz8U67xUTIzBhZ25MFMRkq5koKY=s2048?key=gSyKQr3HTyhvHa28Rf7LVA" alt=""><figcaption><p><a href="https://i0.wp.com/azuredays.com/wp-content/uploads/2020/05/org.png?resize=748%2C601&#x26;ssl=1">https://i0.wp.com/azuredays.com/wp-content/uploads/2020/05/org.png?resize=748%2C601&#x26;ssl=1</a></p></figcaption></figure>

### Azure Resource IDs

Svaki resurs u Azure-u ima Azure Resource ID koji ga identifikuje.

Format Azure Resource ID-a je sledeći:

* `/subscriptions/{subscriptionId}/resourceGroups/{resourceGroupName}/providers/{resourceProviderNamespace}/{resourceType}/{resourceName}`

Za virtuelnu mašinu nazvanu myVM u grupi resursa `myResourceGroup` pod ID-jem pretplate `12345678-1234-1234-1234-123456789012`, Azure Resource ID izgleda ovako:

* `/subscriptions/12345678-1234-1234-1234-123456789012/resourceGroups/myResourceGroup/providers/Microsoft.Compute/virtualMachines/myVM`

## Azure vs Entra ID vs Azure AD Domain Services

### Azure

Azure je Microsoftova sveobuhvatna **platforma za cloud računarstvo, koja nudi širok spektar usluga**, uključujući virtuelne mašine, baze podataka, veštačku inteligenciju i skladištenje. Ona služi kao osnova za hostovanje i upravljanje aplikacijama, izgradnju skalabilnih infrastruktura i pokretanje modernih radnih opterećenja u oblaku. Azure pruža alate za programere i IT profesionalce da kreiraju, implementiraju i upravljaju aplikacijama i uslugama bez problema, zadovoljavajući različite potrebe od startapa do velikih preduzeća.

### Entra ID (ranije Azure Active Directory)

Entra ID je usluga za upravljanje **identitetom i pristupom u oblaku** dizajnirana da se bavi autentifikacijom, autorizacijom i kontrolom pristupa korisnika. Ona omogućava siguran pristup Microsoftovim uslugama kao što su Office 365, Azure i mnoge treće strane SaaS aplikacije. Sa funkcijama kao što su jedinstveno prijavljivanje (SSO), višefaktorska autentifikacija (MFA) i politike uslovnog pristupa, između ostalog.

### Entra Domain Services (ranije Azure AD DS)

Entra Domain Services proširuje mogućnosti Entra ID-a nudeći **upravljane usluge domena kompatibilne sa tradicionalnim Windows Active Directory okruženjima**. Podržava nasleđene protokole kao što su LDAP, Kerberos i NTLM, omogućavajući organizacijama da migriraju ili pokreću starije aplikacije u oblaku bez implementacije lokalnih kontrolera domena. Ova usluga takođe podržava grupne politike za centralizovano upravljanje, što je čini pogodnom za scenarije u kojima nasleđena ili AD-bazirana radna opterećenja treba da koegzistiraju sa modernim cloud okruženjima.

## Entra ID Principali

### Korisnici

* **Novi korisnici**
* Naznačite ime i domen e-pošte iz odabranog tenant-a
* Naznačite prikazano ime
* Naznačite lozinku
* Naznačite svojstva (ime, radno mesto, kontakt informacije…)
* Podrazumevani tip korisnika je “**član**”
* **Spoljni korisnici**
* Naznačite e-poštu za poziv i prikazano ime (može biti e-pošta koja nije Microsoft)
* Naznačite svojstva
* Podrazumevani tip korisnika je “**Gost**”

### Podrazumevane dozvole korisnika

* **Članovi (**[**dokumenti**](https://learn.microsoft.com/en-gb/entra/fundamentals/users-default-permissions#restrict-member-users-default-permissions)**)**
* Registrujte aplikacije: Podrazumevano **Da**
* Ograničite ne-administrativne korisnike da kreiraju tenant-e: Podrazumevano **Ne**
* Kreirajte sigurnosne grupe: Podrazumevano **Da**
* Ograničite pristup Microsoft Entra administrativnom portalu: Podrazumevano **Ne**
* Ovo ne ograničava API pristup portalu (samo web)
* Dozvolite korisnicima da povežu radni ili školski nalog sa LinkedIn-om: Podrazumevano **Da**
* Prikaži zadrži korisnika prijavljenim: Podrazumevano **Da**
* Ograničite korisnike da povrate BitLocker ključ(eve) za svoje uređaje: Podrazumevano Ne (proverite u podešavanjima uređaja)
* Čitajte druge korisnike: Podrazumevano **Da** (putem Microsoft Graph-a)
* **Gosti**
* **Ograničenja pristupa gostujućim korisnicima**
* **Gosti imaju isti pristup kao članovi** dodeljuju sve dozvole članovima korisnicima gostujućim korisnicima podrazumevano.
* **Gosti imaju ograničen pristup svojstvima i članstvima objekata direktorijuma (podrazumevano)** ograničava pristup gostiju samo na njihov profil korisnika podrazumevano. Pristup informacijama o drugim korisnicima i grupama više nije dozvoljen.
* **Pristup gostujućim korisnicima je ograničen na svojstva i članstva njihovih vlastitih objekata direktorijuma** je najrestriktivniji.
* **Gosti mogu pozvati**
* **Svako u organizaciji može pozvati gostujuće korisnike uključujući goste i ne-administratore (najinkluzivnije) - Podrazumevano**
* **Korisnici članovi i korisnici dodeljeni specifičnim administrativnim ulogama mogu pozvati gostujuće korisnike uključujući goste sa članovskim dozvolama**
* **Samo korisnici dodeljeni specifičnim administrativnim ulogama mogu pozvati gostujuće korisnike**
* **Niko u organizaciji ne može pozvati gostujuće korisnike uključujući administratore (najrestriktivnije)**
* **Spoljni korisnici mogu napustiti**: Podrazumevano **Tačno**
* Dozvolite spoljnim korisnicima da napuste organizaciju

{% hint style="success" %}
Čak i ako su podrazumevano ograničeni, korisnici (članovi i gosti) sa dodeljenim dozvolama mogli bi izvršiti prethodne radnje.
{% endhint %}

### **Servisni principi**

**Servisni princip** je **identitet** kreiran za **upotrebu** sa **aplikacijama**, hostovanim uslugama i automatizovanim alatima za pristup Azure resursima. Ovaj pristup je **ograničen ulogama dodeljenim** servisnom principu, dajući vam kontrolu nad **koji resursi mogu biti pristupljeni** i na kojem nivou. Iz bezbednosnih razloga, uvek se preporučuje da se **koriste servisni principi sa automatizovanim alatima** umesto da im se dozvoli prijavljivanje sa identitetom korisnika.

Moguće je **direktno se prijaviti kao servisni princip** generisanjem **tajne** (lozinke), **sertifikata**, ili dodeljivanjem **federisanog** pristupa trećim platformama (npr. Github Actions) preko njega.

* Ako izaberete **lozinku** za autentifikaciju (podrazumevano), **sačuvajte generisanu lozinku** jer je nećete moći ponovo pristupiti.
* Ako izaberete autentifikaciju sertifikatom, uverite se da će **aplikacija imati pristup privatnom ključu**.

### Registracije aplikacija

**Registracija aplikacije** je konfiguracija koja omogućava aplikaciji da se integriše sa Entra ID i da izvršava radnje.

#### Ključne komponente:

1. **ID aplikacije (Client ID):** Jedinstveni identifikator za vašu aplikaciju u Azure AD.
2. **Redirect URIs:** URL-ovi na koje Azure AD šalje odgovore na autentifikaciju.
3. **Sertifikati, tajne i federisani kredencijali:** Moguće je generisati tajnu ili sertifikat za prijavu kao servisni princip aplikacije, ili dodeliti federisani pristup (npr. Github Actions).&#x20;
1. Ako je **sertifikat** ili **tajna** generisana, moguće je da osoba **prijavi kao servisni princip** koristeći CLI alate znajući **ID aplikacije**, **tajnu** ili **sertifikat** i **tenant** (domen ili ID).
4. **API dozvole:** Specifikuje koje resurse ili API-je aplikacija može pristupiti.
5. **Podešavanja autentifikacije:** Definiše podržane tokove autentifikacije aplikacije (npr., OAuth2, OpenID Connect).
6. **Servisni princip**: Servisni princip se kreira kada se aplikacija kreira (ako se to uradi iz web konzole) ili kada se instalira u novom tenant-u.
1. **Servisni princip** će dobiti sve tražene dozvole sa kojima je konfigurisan.

### Preduzeća aplikacije

To je samo **tabela u Azure-u za filtriranje servisnih principa** i proveru aplikacija koje su dodeljene.

**To nije još jedan tip “aplikacije”,** ne postoji nijedan objekat u Azure-u koji je “Preduzeće aplikacija”, to je samo apstrakcija za proveru servisnih principa, registracija aplikacija i upravljanih identiteta.

### **Upravljani identitet (metapodaci)**

Upravljani identiteti u Azure Active Directory nude rešenje za **automatsko upravljanje identitetom** aplikacija. Ovi identiteti se koriste od strane aplikacija u svrhu **povezivanja** sa **resursima** kompatibilnim sa autentifikacijom Azure Active Directory (**Azure AD**). Ovo omogućava **uklanjanje potrebe za hardkodiranjem cloud kredencijala** u kodu jer će aplikacija moći da kontaktira **metapodatkovnu** uslugu kako bi dobila važeći token za **izvršavanje radnji** kao naznačeni upravljani identitet u Azure-u.

Postoje dva tipa upravljanih identiteta:

* **Sistemom dodeljeni**. Neke Azure usluge omogućavaju da **omogućite upravljani identitet direktno na instanci usluge**. Kada omogućite sistemom dodeljeni upravljani identitet, **servisni princip** se kreira u Entra ID tenant-u kojem veruje pretplata u kojoj se resurs nalazi. Kada se **resurs** **obriše**, Azure automatski **briše** **identitet** za vas.
* **Korisnikom dodeljeni**. Takođe je moguće da korisnici generišu upravljane identitete. Ovi se kreiraju unutar grupe resursa unutar pretplate i servisni princip će biti kreiran u Entra ID-u kojem veruje pretplata. Zatim, možete dodeliti upravljeni identitet jednoj ili **više instanci** Azure usluge (više resursa). Za korisnikom dodeljene upravljane identitete, **identitet se upravlja odvojeno od resursa koji ga koriste**.

Upravljani identiteti **ne generišu večne kredencijale** (kao što su lozinke ili sertifikati) za pristup kao servisni princip koji je povezan sa njim.

### Podrazumevane dozvole pristanka

**Korisnički pristanak za aplikacije**

* **Ne dozvoljavajte korisnički pristanak**
* Administrator će biti potreban za sve aplikacije.
* **Dozvolite korisnički pristanak za aplikacije od verifikovanih izdavača, za odabrane dozvole (preporučeno)**
* Svi korisnici mogu pristati na dozvole klasifikovane kao "niskog uticaja", za aplikacije od verifikovanih izdavača ili aplikacije registrovane u ovoj organizaciji.
* **Podrazumevane** dozvole niskog uticaja (iako ih morate prihvatiti da ih dodate kao niske):
* User.Read - prijavite se i pročitajte korisnički profil
* offline\_access - održava pristup podacima kojima su korisnici dali pristup
* openid - prijavite korisnike
* profile - pogledajte osnovni profil korisnika
* email - pogledajte adresu e-pošte korisnika
* **Dozvolite korisnički pristanak za aplikacije (podrazumevano)**
* Svi korisnici mogu pristati na bilo koju aplikaciju da pristupi podacima organizacije.

**Zahtevi za pristanak administratora**: Podrazumevano **Ne**

* Korisnici mogu zatražiti pristanak administratora za aplikacije na koje ne mogu pristati
* Ako **Da**: Moguće je naznačiti korisnike, grupe i uloge koje mogu pristati na zahteve
* Takođe konfigurišite da li će korisnici primati obaveštenja putem e-pošte i podsetnike o isteku&#x20;

### Administrativne jedinice

[Iz dokumenata:](https://learn.microsoft.com/en-us/entra/identity/role-based-access-control/admin-units-manage) Administrativne jedinice vam omogućavaju da **podelite** svoju organizaciju na **bilo koju jedinicu** koju želite, a zatim **dodelite specifične administratore** koji mogu **upravljati samo članovima** te jedinice. Na primer, mogli biste koristiti administrativne jedinice da delegirate dozvole administratorima svake škole na velikom univerzitetu, tako da mogu kontrolisati pristup, upravljati korisnicima i postavljati politike samo u Školi inženjerstva.

Samo **korisnici**, **grupe** i **uređaji** mogu biti **članovi** **administrativne jedinice**.

Stoga, **administrativna jedinica** će **sadržati** neke **članove** i druge **principale** će imati **dodeljene dozvole nad tom** administrativnom **jedinicom** koje mogu koristiti za **upravljanje članovima** administrativne jedinice.

## Uloge i dozvole

**Uloge** se **dodeljuju** **principalima** na **opsegu**: `principal -[HAS ROLE]->(scope)`

**Uloge** dodeljene **grupama** se **nasleđuju** od strane svih **članova** grupe.

U zavisnosti od opsega na koji je uloga dodeljena, **uloga** se može **naslediti** na **druge resurse** unutar kontejnera opsega. Na primer, ako korisnik A ima **ulogu na pretplati**, on će imati tu **ulogu na svim grupama resursa** unutar pretplate i na **svim resursima** unutar grupe resursa.

### **Klasične uloge**

| **Vlasnik**                  | <ul><li>Puni pristup svim resursima</li><li>Može upravljati pristupom za druge korisnike</li></ul> | Svi tipovi resursa |
| ----------------------------- | ---------------------------------------------------------------------------------------- | ------------------ |
| **Doprinosilac**             | <ul><li>Puni pristup svim resursima</li><li>Ne može upravljati pristupom</li></ul>              | Svi tipovi resursa |
| **Čitač**                    | • Pregled svih resursa                                                                     | Svi tipovi resursa |
| **Administrator pristupa korisnicima** | <ul><li>Pregled svih resursa</li><li>Može upravljati pristupom za druge korisnike</li></ul>           | Svi tipovi resursa |

### Uloge ugrađene

[Iz dokumenata: ](https://learn.microsoft.com/en-us/azure/role-based-access-control/built-in-roles)[Azure kontrola pristupa zasnovana na ulogama (Azure RBAC)](https://learn.microsoft.com/en-us/azure/role-based-access-control/overview) ima nekoliko **ugrađenih uloga** koje možete **dodeliti** **korisnicima, grupama, servisnim principima i upravljanim identitetima**. Dodeljivanje uloga je način na koji kontrolišete **pristup Azure resursima**. Ako ugrađene uloge ne zadovoljavaju specifične potrebe vaše organizacije, možete kreirati svoje [**Azure prilagođene uloge**](https://learn.microsoft.com/en-us/azure/role-based-access-control/custom-roles)**.**

**Ugrađene** uloge se primenjuju samo na **resurse** za koje su **namenjene**, na primer, proverite ova 2 primera **ugrađenih uloga** nad resursima **Računanja**:

| [Disk Backup Reader](https://learn.microsoft.com/en-us/azure/role-based-access-control/built-in-roles#disk-backup-reader)                 | Pruža dozvolu za backup vault za izvođenje backup-a diska.      | 3e5e47e6-65f7-47ef-90b5-e5dd4d455f24 |
| ----------------------------------------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------- | ------------------------------------ |
| [Virtual Machine User Login](https://learn.microsoft.com/en-us/azure/role-based-access-control/built-in-roles#virtual-machine-user-login) | Pregledajte virtuelne mašine u portalu i prijavite se kao običan korisnik. | fb879df8-f326-4884-b1cf-06f3ad86be52 |

Ove uloge se **takođe mogu dodeliti nad logičkim kontejnerima** (kao što su grupe za upravljanje, pretplate i grupe resursa) i principi na koje se to odnosi će ih imati **nad resursima unutar tih kontejnera**.

* Pronađite ovde listu sa [**svim ugrađenim ulogama Azure-a**](https://learn.microsoft.com/en-us/azure/role-based-access-control/built-in-roles).
* Pronađite ovde listu sa [**svim ugrađenim ulogama Azure AD**](https://learn.microsoft.com/en-us/azure/active-directory/roles/permissions-reference).

### Prilagođene uloge

Azure takođe omogućava kreiranje [**prilagođenih uloga**](https://learn.microsoft.com/en-us/azure/role-based-access-control/custom-roles) sa dozvolama koje korisnik treba.

### Odbijena dozvola

* Da bi **principal imao neki pristup resursu**, potrebna mu je eksplicitna uloga koja mu se dodeljuje (na bilo koji način) **dodeljujući mu tu dozvolu**.
* Eksplicitna **dodela odbijene uloge ima prioritet** nad ulogom koja dodeljuje dozvolu.

<figure><img src="../../.gitbook/assets/image (191).png" alt=""><figcaption></figcaption></figure>

### Globalni administrator

Korisnici sa ulogom Globalnog administratora imaju mogućnost da '**povećaju' ulogu Administratora pristupa korisnicima Azure-a na korensku grupu za upravljanje**. To znači da će Globalni administrator moći da upravlja pristupom **svim Azure pretplatama i grupama za upravljanje.**\
Ovo povećanje može se izvršiti na kraju stranice: [https://portal.azure.com/#view/Microsoft\_AAD\_IAM/ActiveDirectoryMenuBlade/\~/Properties](https://portal.azure.com/#view/Microsoft\_AAD\_IAM/ActiveDirectoryMenuBlade/\~/Properties)

<figure><img src="../../.gitbook/assets/image (162).png" alt=""><figcaption></figcaption></figure>

### Azure politike

Azure politike su skup **pravila i propisa u Microsoft Azure-u**, cloud računarstvu, koji pomažu u upravljanju i sprovođenju organizacionih standarda i proceni usklađenosti na velikoj skali. Ove politike sprovode različita pravila nad vašim **Azure resursima**, osiguravajući da ti resursi ostanu usklađeni sa korporativnim standardima i ugovorima o nivou usluge.

Azure politike su ključne za upravljanje cloud-om i bezbednost, pomažući da se osigura da se resursi koriste pravilno i efikasno, i da se pridržavaju spoljašnjih propisa i unutrašnjih politika.\
Neki primeri:

1. **Osiguranje usklađenosti sa specifičnim Azure regionima**: Ova politika osigurava da se svi resursi implementiraju u specifičnim Azure regionima. Na primer, kompanija može želeti da osigura da su svi njeni podaci pohranjeni u Evropi radi usklađenosti sa GDPR-om.
2. **Sprovođenje standarda imenovanja**: Politike mogu sprovoditi konvencije imenovanja za Azure resurse. Ovo pomaže u organizaciji i lakom identifikovanju resursa na osnovu njihovih imena, što je korisno u velikim okruženjima.
3. **Ograničavanje određenih tipova resursa**: Ova politika može ograničiti kreiranje određenih tipova resursa. Na primer, politika može biti postavljena da spreči kreiranje skupih tipova resursa, kao što su određene veličine VM-a, kako bi se kontrolisali troškovi.
4. **Sprovođenje politika označavanja**: Oznake su parovi ključ-vrednost povezani sa Azure resursima koji se koriste za upravljanje resursima. Politike mogu sprovoditi da određene oznake moraju biti prisutne, ili imati specifične vrednosti, za sve resurse. Ovo je korisno za praćenje troškova, vlasništva ili kategorizaciju resursa.
5. **Ograničavanje javnog pristupa resursima**: Politike mogu sprovoditi da određeni resursi, kao što su skladišni nalozi ili baze podataka, nemaju javne krajnje tačke, osiguravajući da su dostupni samo unutar mreže organizacije.
6. **Automatsko primenjivanje bezbednosnih podešavanja**: Politike se mogu koristiti za automatsko primenjivanje bezbednosnih podešavanja na resurse, kao što je primena specifične mrežne sigurnosne grupe na sve VM-ove ili osiguranje da svi skladišni nalozi koriste enkripciju.

Napomena da se Azure politike mogu prikačiti na bilo koji nivo Azure hijerarhije, ali se **najčešće koriste u korenskoj grupi za upravljanje** ili u drugim grupama za upravljanje.

### Opseg dozvola

U Azure-u **dozvole se mogu dodeliti bilo kojem delu hijerarhije**. To uključuje grupe za upravljanje, pretplate, grupe resursa i pojedinačne resurse. Dozvole se **nasleđuju** od sadržanih **resursa** entiteta na kojem su dodeljene.

Ova hijerarhijska struktura omogućava efikasno i skalabilno upravljanje pristupnim dozvolama.

<figure><img src="../../.gitbook/assets/image (26).png" alt=""><figcaption></figcaption></figure>

### Azure RBAC vs ABAC

**RBAC** (kontrola pristupa zasnovana na ulogama) je ono što smo već videli u prethodnim odeljcima: **Dodeljivanje uloge principalu kako bi mu se omogućio pristup** nad resursom.\
Međutim, u nekim slučajevima možda ćete želeti da obezbedite **fino podešeno upravljanje pristupom** ili **pojednostavite** upravljanje **stotinama** dodela uloga.

Azure **ABAC** (kontrola pristupa zasnovana na atributima) se oslanja na Azure RBAC dodajući **uslove dodeljivanja uloga zasnovane na atributima** u kontekstu specifičnih radnji. _Uslov dodeljivanja uloge_ je **dodatna provera koju možete opcionalno dodati svojoj dodeli uloge** kako biste obezbedili finije upravljanje pristupom. Uslov filtrira dozvole dodeljene kao deo definicije uloge i dodele uloge. Na primer, možete **dodati uslov koji zahteva da objekat ima specifičnu oznaku da bi ga pročitali**.\
Ne možete eksplicitno **odbiti** **pristup** specifičnim resursima **koristeći uslove**.

### Podrazumevane dozvole korisnika

Osnovni korisnik će imati neke **podrazumevane dozvole** za enumeraciju nekih delova AzureAD:

* Čitajte sve korisnike, grupe, aplikacije, uređaje, uloge, pretplate i njihove javne osobine
* Pozovite goste (_može se isključiti_)
* Kreirajte sigurnosne grupe
* Čitajte ne-skrivene članstva grupa
* Dodajte goste u vlasničke grupe
* Kreirajte nove aplikacije (_može se isključiti_)
* Dodajte do 50 uređaja u Azure (_može se isključiti_)

Možete videti punu [listu **podrazumevanih dozvola korisnika** u dokumentima](https://learn.microsoft.com/en-us/azure/active-directory/fundamentals/users-default-permissions). Pored toga, napomenite da u toj listi možete takođe videti **listu podrazumevanih dozvola gostiju**.

{% hint style="info" %}
Zapamtite da da biste enumerisali Azure resurse, korisnik treba eksplicitnu dodelu dozvole.
{% endhint %}

### Upravljanje privilegovanim identitetima (PIM)

Upravljanje privilegovanim identitetima (PIM) u Azure-u je alat koji **upravlja, kontroliše i prati privilegovani pristup** u Azure Active Directory i Azure-u. Povećava bezbednost pružajući **privilegovani pristup na zahtev i vremenski ograničen**, **sprovodeći radne tokove odobravanja i zahtevajući dodatnu autentifikaciju**. Ovaj pristup minimizira rizik od neovlašćenog pristupa osiguravajući da se povišene dozvole dodeljuju samo kada je to neophodno i na određeni vremenski period.

## Autentifikacijski tokeni

Postoje **tri tipa tokena** koji se koriste u OIDC:

* [**Pristupni tokeni**](https://learn.microsoft.com/en-us/azure/active-directory/develop/access-tokens)**:** Klijent predstavlja ovaj token serveru resursa da bi **pristupio resursima**. Može se koristiti samo za specifičnu kombinaciju korisnika, klijenta i resursa i **ne može biti opozvan** do isteka - što je podrazumevano 1 sat. Detekcija je niska koristeći ovo.
* **ID tokeni**: Klijent prima ovaj **token od autorizacionog servera**. Sadrži osnovne informacije o korisniku. **Povezan je sa specifičnom kombinacijom korisnika i klijenta**.
* **Refresh tokeni**: Dodeljuju se klijentu sa pristupnim tokenom. Koriste se za **dobijanje novih pristupnih i ID tokena**. Povezan je sa specifičnom kombinacijom korisnika i klijenta i može biti opozvan. Podrazumevani isteka je **90 dana** za neaktivne refresh tokene i **nema isteka za aktivne tokene**.

{% hint style="warning" %}
Informacije za **uslovni pristup** su **smeštene** unutar **JWT**. Dakle, ako zatražite **token sa dozvoljene IP adrese**, ta **IP** će biti **smeštena** u tokenu i tada možete koristiti taj token sa **ne-dozvoljene IP adrese za pristup resursima**.
{% endhint %}

Proverite sledeću stranicu da biste saznali različite načine za **zahtev za pristupnim tokenima** i prijavu sa njima:

{% content-ref url="az-azuread/" %}
[az-azuread](az-azuread/)
{% endcontent-ref %}

Najčešći API krajnji tačke su:

* **Azure Resource Manager** (ARM): management.azure.com
* **Microsoft Graph**: graph.microsoft.com (Azure AD Graph koji je zastareo je graph.windows.net)

## Reference

* [https://learn.microsoft.com/en-us/azure/governance/management-groups/overview](https://learn.microsoft.com/en-us/azure/governance/management-groups/overview)
* [https://learn.microsoft.com/en-us/azure/cloud-adoption-framework/ready/azure-best-practices/organize-subscriptions](https://learn.microsoft.com/en-us/azure/cloud-adoption-framework/ready/azure-best-practices/organize-subscriptions)
* [https://abouttmc.com/glossary/azure-subscription/#:\~:text=An%20Azure%20subscription%20is%20a,the%20subscription%20it%20belongs%20to.](https://abouttmc.com/glossary/azure-subscription/)
* [https://learn.microsoft.com/en-us/azure/role-based-access-control/overview#how-azure-rbac-determines-if-a-user-has-access-to-a-resource](https://learn.microsoft.com/en-us/azure/role-based-access-control/overview#how-azure-rbac-determines-if-a-user-has-access-to-a-resource)
* [https://stackoverflow.com/questions/65922566/what-are-the-differences-between-service-principal-and-app-registration](https://stackoverflow.com/questions/65922566/what-are-the-differences-between-service-principal-and-app-registration)

{% hint style="success" %}
Učite i vežbajte AWS Hacking:<img src="../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">\
Učite i vežbajte GCP Hacking: <img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Podrška HackTricks</summary>

* Proverite [**planove pretplate**](https://github.com/sponsors/carlospolop)!
* **Pridružite se** 💬 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili **pratite** nas na **Twitteru** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podelite hakerske trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
{% endhint %}
