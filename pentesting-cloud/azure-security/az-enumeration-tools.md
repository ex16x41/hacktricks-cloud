# Az - Ferramentas de Enumera√ß√£o

{% hint style="success" %}
Aprenda e pratique Hacking AWS:<img src="../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">\
Aprenda e pratique Hacking GCP: <img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Suporte ao HackTricks</summary>

* Confira os [**planos de assinatura**](https://github.com/sponsors/carlospolop)!
* **Junte-se ao** üí¨ [**grupo do Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga**-nos no **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe truques de hacking enviando PRs para os reposit√≥rios do** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
{% endhint %}

## Instalar PowerShell no Linux

{% hint style="success" %}
No linux, voc√™ precisar√° instalar o PowerShell Core:
```bash
sudo apt-get update
sudo apt-get install -y wget apt-transport-https software-properties-common

# Ubuntu 20.04
wget -q https://packages.microsoft.com/config/ubuntu/20.04/packages-microsoft-prod.deb

# Update repos
sudo apt-get update
sudo add-apt-repository universe

# Install & start powershell
sudo apt-get install -y powershell
pwsh

# Az cli
curl -sL https://aka.ms/InstallAzureCLIDeb | sudo bash
```
{% endhint %}

## Instalar PowerShell no MacOS

Instru√ß√µes da [**documenta√ß√£o**](https://learn.microsoft.com/en-us/powershell/scripting/install/installing-powershell-on-macos?view=powershell-7.4):

1. Instale `brew` se ainda n√£o estiver instalado:
```bash
/bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
```
2. Instale a vers√£o est√°vel mais recente do PowerShell:
```sh
brew install powershell/tap/powershell
```
3. Execute o PowerShell:
```sh
pwsh
```
4. Atualiza√ß√£o:
```sh
brew update
brew upgrade powershell
```
## Ferramentas Principais de Enumera√ß√£o

### az cli

[**Interface de Linha de Comando do Azure (CLI)**](https://learn.microsoft.com/en-us/cli/azure/install-azure-cli) √© uma ferramenta multiplataforma escrita em Python para gerenciar e administrar (a maioria) dos recursos do Azure e do Entra ID. Ela se conecta ao Azure e executa comandos administrativos via linha de comando ou scripts.

Siga este link para as [**instru√ß√µes de instala√ß√£o¬°**](https://learn.microsoft.com/en-us/cli/azure/install-azure-cli#install).

Os comandos na Azure CLI s√£o estruturados usando um padr√£o de: `az <servi√ßo> <a√ß√£o> <par√¢metros>`

#### Debug | MitM az cli

Usando o par√¢metro **`--debug`** √© poss√≠vel ver todas as requisi√ß√µes que a ferramenta **`az`** est√° enviando:
```bash
az account management-group list --output table --debug
```
Para fazer um **MitM** na ferramenta e **verificar todas as requisi√ß√µes** que ela est√° enviando manualmente, voc√™ pode fazer:

{% tabs %}
{% tab title="Bash" %}
```bash
export ADAL_PYTHON_SSL_NO_VERIFY=1
export AZURE_CLI_DISABLE_CONNECTION_VERIFICATION=1
export HTTPS_PROXY="http://127.0.0.1:8080"
export HTTP_PROXY="http://127.0.0.1:8080"

# If this is not enough
# Download the certificate from Burp and convert it into .pem format
# And export the following env variable
openssl x509 -in ~/Downloads/cacert.der -inform DER -out ~/Downloads/cacert.pem -outform PEM
export REQUESTS_CA_BUNDLE=/Users/user/Downloads/cacert.pem
```
{% endtab %}

{% tab title="PS" %}
```bash
$env:ADAL_PYTHON_SSL_NO_VERIFY=1
$env:AZURE_CLI_DISABLE_CONNECTION_VERIFICATION=1
$env:HTTPS_PROXY="http://127.0.0.1:8080"
$env:HTTP_PROXY="http://127.0.0.1:8080"
```
{% endtab %}
{% endtabs %}

### Az PowerShell

Azure PowerShell √© um m√≥dulo com cmdlets para gerenciar recursos do Azure diretamente da linha de comando do PowerShell.

Siga este link para as [**instru√ß√µes de instala√ß√£o**](https://learn.microsoft.com/en-us/powershell/azure/install-azure-powershell).

Os comandos no M√≥dulo AZ do Azure PowerShell s√£o estruturados como: `<A√ß√£o>-Az<Service> <par√¢metros>`

#### Debug | MitM Az PowerShell

Usando o par√¢metro **`-Debug`** √© poss√≠vel ver todas as requisi√ß√µes que a ferramenta est√° enviando:
```bash
Get-AzResourceGroup -Debug
```
Para fazer um **MitM** na ferramenta e **verificar todas as requisi√ß√µes** que ela est√° enviando manualmente, voc√™ pode definir as vari√°veis de ambiente `HTTPS_PROXY` e `HTTP_PROXY` de acordo com a [**docs**](https://learn.microsoft.com/en-us/powershell/azure/az-powershell-proxy).

### Microsoft Graph PowerShell

Microsoft Graph PowerShell √© um SDK multiplataforma que permite o acesso a todas as APIs do Microsoft Graph, incluindo servi√ßos como SharePoint, Exchange e Outlook, usando um √∫nico endpoint. Ele suporta PowerShell 7+, autentica√ß√£o moderna via MSAL, identidades externas e consultas avan√ßadas. Com foco no acesso de menor privil√©gio, garante opera√ß√µes seguras e recebe atualiza√ß√µes regulares para alinhar-se com os √∫ltimos recursos da API do Microsoft Graph.

Siga este link para as [**instru√ß√µes de instala√ß√£o**](https://learn.microsoft.com/en-us/powershell/microsoftgraph/installation).

Os comandos no Microsoft Graph PowerShell s√£o estruturados como: `<Action>-Mg<Service> <parameters>`

#### Depurar Microsoft Graph PowerShell

Usando o par√¢metro **`-Debug`**, √© poss√≠vel ver todas as requisi√ß√µes que a ferramenta est√° enviando:
```bash
Get-MgUser -Debug
```
### ~~**AzureAD Powershell**~~

O m√≥dulo Azure Active Directory (AD), agora **obsoleto**, √© parte do Azure PowerShell para gerenciar recursos do Azure AD. Ele fornece cmdlets para tarefas como gerenciar usu√°rios, grupos e registros de aplicativos no Entra ID.

{% hint style="success" %}
Isso √© substitu√≠do pelo Microsoft Graph PowerShell
{% endhint %}

Siga este link para as [**instru√ß√µes de instala√ß√£o**](https://www.powershellgallery.com/packages/AzureAD).
