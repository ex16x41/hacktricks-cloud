# Az - Enumeration Tools

{% hint style="success" %}
AWSãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã³ã€å®Ÿè·µã™ã‚‹ï¼š<img src="../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
GCPãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã³ã€å®Ÿè·µã™ã‚‹ï¼š<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricksã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹</summary>

* [**ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³**](https://github.com/sponsors/carlospolop)ã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼
* **ğŸ’¬ [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã¾ãŸã¯[**Telegramã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«å‚åŠ ã™ã‚‹ã‹ã€**Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**ã‚’ãƒ•ã‚©ãƒ­ãƒ¼ã—ã¦ãã ã•ã„ã€‚**
* **ãƒãƒƒã‚­ãƒ³ã‚°ã®ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã™ã‚‹ã«ã¯ã€[**HackTricks**](https://github.com/carlospolop/hacktricks)ãŠã‚ˆã³[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)ã®GitHubãƒªãƒã‚¸ãƒˆãƒªã«PRã‚’æå‡ºã—ã¦ãã ã•ã„ã€‚**

</details>
{% endhint %}

## Linuxã«PowerShellã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹

{% hint style="success" %}
Linuxã§ã¯PowerShell Coreã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ï¼š
```bash
sudo apt-get update
sudo apt-get install -y wget apt-transport-https software-properties-common

# Ubuntu 20.04
wget -q https://packages.microsoft.com/config/ubuntu/20.04/packages-microsoft-prod.deb

# Update repos
sudo apt-get update
sudo add-apt-repository universe

# Install & start powershell
sudo apt-get install -y powershell
pwsh

# Az cli
curl -sL https://aka.ms/InstallAzureCLIDeb | sudo bash
```
{% endhint %}

## MacOSã«PowerShellã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹

[**ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ**](https://learn.microsoft.com/en-us/powershell/scripting/install/installing-powershell-on-macos?view=powershell-7.4)ã‹ã‚‰ã®æŒ‡ç¤ºï¼š

1. ã¾ã ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ã„ãªã„å ´åˆã¯`brew`ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ï¼š
```bash
/bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
```
2. æœ€æ–°ã®å®‰å®šç‰ˆPowerShellã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™:
```sh
brew install powershell/tap/powershell
```
3. PowerShellã‚’å®Ÿè¡Œã™ã‚‹:
```sh
pwsh
```
4. æ›´æ–°:
```sh
brew update
brew upgrade powershell
```
## ä¸»ãªåˆ—æŒ™ãƒ„ãƒ¼ãƒ«

### az cli

[**Azure ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ã‚¤ã‚¹ (CLI)**](https://learn.microsoft.com/en-us/cli/azure/install-azure-cli) ã¯ã€Azure ãŠã‚ˆã³ Entra ID ãƒªã‚½ãƒ¼ã‚¹ã®ç®¡ç†ã¨é‹ç”¨ã®ãŸã‚ã« Python ã§æ›¸ã‹ã‚ŒãŸã‚¯ãƒ­ã‚¹ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚Azure ã«æ¥ç¶šã—ã€ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ã¾ãŸã¯ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ä»‹ã—ã¦ç®¡ç†ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚

[**ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ‰‹é †ã¯ã“ã¡ã‚‰ï¼**](https://learn.microsoft.com/en-us/cli/azure/install-azure-cli#install) ã‚’ã”è¦§ãã ã•ã„ã€‚

Azure CLI ã®ã‚³ãƒãƒ³ãƒ‰ã¯ã€æ¬¡ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã§æ§‹æˆã•ã‚Œã¦ã„ã¾ã™: `az <service> <action> <parameters>`

#### ãƒ‡ãƒãƒƒã‚° | MitM az cli

ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ **`--debug`** ã‚’ä½¿ç”¨ã™ã‚‹ã¨ã€ãƒ„ãƒ¼ãƒ« **`az`** ãŒé€ä¿¡ã—ã¦ã„ã‚‹ã™ã¹ã¦ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’è¦‹ã‚‹ã“ã¨ãŒã§ãã¾ã™:
```bash
az account management-group list --output table --debug
```
MitMæ”»æ’ƒã‚’ãƒ„ãƒ¼ãƒ«ã«å¯¾ã—ã¦è¡Œã„ã€æ‰‹å‹•ã§é€ä¿¡ã•ã‚Œã‚‹ã™ã¹ã¦ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ç¢ºèªã™ã‚‹ã«ã¯ã€æ¬¡ã®ã‚ˆã†ã«ã—ã¾ã™ï¼š

{% tabs %}
{% tab title="Bash" %}
```bash
export ADAL_PYTHON_SSL_NO_VERIFY=1
export AZURE_CLI_DISABLE_CONNECTION_VERIFICATION=1
export HTTPS_PROXY="http://127.0.0.1:8080"
export HTTP_PROXY="http://127.0.0.1:8080"

# If this is not enough
# Download the certificate from Burp and convert it into .pem format
# And export the following env variable
openssl x509 -in ~/Downloads/cacert.der -inform DER -out ~/Downloads/cacert.pem -outform PEM
export REQUESTS_CA_BUNDLE=/Users/user/Downloads/cacert.pem
```
{% endtab %}

{% tab title="PS" %}
```bash
$env:ADAL_PYTHON_SSL_NO_VERIFY=1
$env:AZURE_CLI_DISABLE_CONNECTION_VERIFICATION=1
$env:HTTPS_PROXY="http://127.0.0.1:8080"
$env:HTTP_PROXY="http://127.0.0.1:8080"
```
{% endtab %}
{% endtabs %}

### Az PowerShell

Azure PowerShellã¯ã€PowerShellã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ã‹ã‚‰ç›´æ¥Azureãƒªã‚½ãƒ¼ã‚¹ã‚’ç®¡ç†ã™ã‚‹ãŸã‚ã®cmdletã‚’å«ã‚€ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã§ã™ã€‚

[**ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ‰‹é †**](https://learn.microsoft.com/en-us/powershell/azure/install-azure-powershell)ã®ãƒªãƒ³ã‚¯ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

Azure PowerShell AZãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®ã‚³ãƒãƒ³ãƒ‰ã¯ã€æ¬¡ã®ã‚ˆã†ã«æ§‹æˆã•ã‚Œã¦ã„ã¾ã™ï¼š`<Action>-Az<Service> <parameters>`

#### Debug | MitM Az PowerShell

ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿**`-Debug`**ã‚’ä½¿ç”¨ã™ã‚‹ã¨ã€ãƒ„ãƒ¼ãƒ«ãŒé€ä¿¡ã—ã¦ã„ã‚‹ã™ã¹ã¦ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’è¦‹ã‚‹ã“ã¨ãŒã§ãã¾ã™ï¼š
```bash
Get-AzResourceGroup -Debug
```
MitMã‚’ãƒ„ãƒ¼ãƒ«ã«å¯¾ã—ã¦è¡Œã„ã€æ‰‹å‹•ã§é€ä¿¡ã—ã¦ã„ã‚‹**ã™ã¹ã¦ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆ**ã‚’ç¢ºèªã™ã‚‹ã«ã¯ã€[**ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ**](https://learn.microsoft.com/en-us/powershell/azure/az-powershell-proxy)ã«å¾“ã£ã¦ç’°å¢ƒå¤‰æ•°`HTTPS_PROXY`ã¨`HTTP_PROXY`ã‚’è¨­å®šã§ãã¾ã™ã€‚

### Microsoft Graph PowerShell

Microsoft Graph PowerShellã¯ã€å˜ä¸€ã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’ä½¿ç”¨ã—ã¦SharePointã€Exchangeã€Outlookãªã©ã®ã‚µãƒ¼ãƒ“ã‚¹ã‚’å«ã‚€ã™ã¹ã¦ã®Microsoft Graph APIã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’å¯èƒ½ã«ã™ã‚‹ã‚¯ãƒ­ã‚¹ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ SDKã§ã™ã€‚PowerShell 7+ã€MSALã«ã‚ˆã‚‹ãƒ¢ãƒ€ãƒ³èªè¨¼ã€å¤–éƒ¨IDã€ãŠã‚ˆã³é«˜åº¦ãªã‚¯ã‚¨ãƒªã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã¾ã™ã€‚æœ€å°ç‰¹æ¨©ã‚¢ã‚¯ã‚»ã‚¹ã«é‡ç‚¹ã‚’ç½®ãã€å®‰å…¨ãªæ“ä½œã‚’ä¿è¨¼ã—ã€æœ€æ–°ã®Microsoft Graph APIæ©Ÿèƒ½ã«åˆã‚ã›ã¦å®šæœŸçš„ã«æ›´æ–°ã‚’å—ã‘ã¾ã™ã€‚

[**ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ‰‹é †**](https://learn.microsoft.com/en-us/powershell/microsoftgraph/installation)ã«ã¤ã„ã¦ã¯ã€ã“ã®ãƒªãƒ³ã‚¯ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

Microsoft Graph PowerShellã®ã‚³ãƒãƒ³ãƒ‰ã¯æ¬¡ã®ã‚ˆã†ã«æ§‹æˆã•ã‚Œã¦ã„ã¾ã™ï¼š`<Action>-Mg<Service> <parameters>`

#### Microsoft Graph PowerShellã®ãƒ‡ãƒãƒƒã‚°

ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿**`-Debug`**ã‚’ä½¿ç”¨ã™ã‚‹ã¨ã€ãƒ„ãƒ¼ãƒ«ãŒé€ä¿¡ã—ã¦ã„ã‚‹ã™ã¹ã¦ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’è¦‹ã‚‹ã“ã¨ãŒã§ãã¾ã™ï¼š
```bash
Get-MgUser -Debug
```
### ~~**AzureAD Powershell**~~

Azure Active Directory (AD) ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã¯ã€ç¾åœ¨ **éæ¨å¥¨** ã§ã‚ã‚Šã€Azure AD ãƒªã‚½ãƒ¼ã‚¹ã‚’ç®¡ç†ã™ã‚‹ãŸã‚ã® Azure PowerShell ã®ä¸€éƒ¨ã§ã™ã€‚ã“ã‚Œã¯ã€Entra ID ã§ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã€ã‚°ãƒ«ãƒ¼ãƒ—ã€ãŠã‚ˆã³ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ç™»éŒ²ã®ç®¡ç†ãªã©ã®ã‚¿ã‚¹ã‚¯ã®ãŸã‚ã® cmdlet ã‚’æä¾›ã—ã¾ã™ã€‚

{% hint style="success" %}
ã“ã‚Œã¯ Microsoft Graph PowerShell ã«ç½®ãæ›ãˆã‚‰ã‚Œã¾ã—ãŸ
{% endhint %}

[**ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ‰‹é †**](https://www.powershellgallery.com/packages/AzureAD) ã®ãƒªãƒ³ã‚¯ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚
