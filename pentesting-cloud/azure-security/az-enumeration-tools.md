# Az - Narzdzia do enumeracji

{% hint style="success" %}
Ucz si i wicz Hacking AWS:<img src="../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
Ucz si i wicz Hacking GCP: <img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Wsparcie dla HackTricks</summary>

* Sprawd藕 [**plany subskrypcyjne**](https://github.com/sponsors/carlospolop)!
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **led藕** nas na **Twitterze**  [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Dziel si trikami hackingowymi, przesyajc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repozytori贸w github.

</details>
{% endhint %}

## Zainstaluj PowerShell w Linuxie

{% hint style="success" %}
W Linuxie bdziesz musia zainstalowa PowerShell Core:
```bash
sudo apt-get update
sudo apt-get install -y wget apt-transport-https software-properties-common

# Ubuntu 20.04
wget -q https://packages.microsoft.com/config/ubuntu/20.04/packages-microsoft-prod.deb

# Update repos
sudo apt-get update
sudo add-apt-repository universe

# Install & start powershell
sudo apt-get install -y powershell
pwsh

# Az cli
curl -sL https://aka.ms/InstallAzureCLIDeb | sudo bash
```
{% endhint %}

## Zainstaluj PowerShell w MacOS

Instrukcje z [**dokumentacji**](https://learn.microsoft.com/en-us/powershell/scripting/install/installing-powershell-on-macos?view=powershell-7.4):

1. Zainstaluj `brew`, jeli jeszcze nie jest zainstalowany:
```bash
/bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
```
2. Zainstaluj najnowsz stabiln wersj PowerShell:
```sh
brew install powershell/tap/powershell
```
3. Uruchom PowerShell:
```sh
pwsh
```
4. Aktualizacja:
```sh
brew update
brew upgrade powershell
```
## G贸wne narzdzia do enumeracji

### az cli

[**Azure Command-Line Interface (CLI)**](https://learn.microsoft.com/en-us/cli/azure/install-azure-cli) to narzdzie wieloplatformowe napisane w Pythonie do zarzdzania i administracji (wikszoci) zasob贸w Azure i Entra ID. czy si z Azure i wykonuje polecenia administracyjne za pomoc wiersza polece lub skrypt贸w.

Postpuj zgodnie z tym linkiem, aby uzyska [**instrukcje instalacji隆**](https://learn.microsoft.com/en-us/cli/azure/install-azure-cli#install).

Polecenia w Azure CLI s zbudowane wedug wzoru: `az <usuga> <akcja> <parametry>`

#### Debug | MitM az cli

U偶ywajc parametru **`--debug`**, mo偶na zobaczy wszystkie 偶dania, kt贸re narzdzie **`az`** wysya:
```bash
az account management-group list --output table --debug
```
Aby przeprowadzi **MitM** na narzdziu i **rcznie sprawdzi wszystkie 偶dania**, kt贸re wysya, mo偶esz zrobi:

{% tabs %}
{% tab title="Bash" %}
```bash
export ADAL_PYTHON_SSL_NO_VERIFY=1
export AZURE_CLI_DISABLE_CONNECTION_VERIFICATION=1
export HTTPS_PROXY="http://127.0.0.1:8080"
export HTTP_PROXY="http://127.0.0.1:8080"

# If this is not enough
# Download the certificate from Burp and convert it into .pem format
# And export the following env variable
openssl x509 -in ~/Downloads/cacert.der -inform DER -out ~/Downloads/cacert.pem -outform PEM
export REQUESTS_CA_BUNDLE=/Users/user/Downloads/cacert.pem
```
{% endtab %}

{% tab title="PS" %}
```bash
$env:ADAL_PYTHON_SSL_NO_VERIFY=1
$env:AZURE_CLI_DISABLE_CONNECTION_VERIFICATION=1
$env:HTTPS_PROXY="http://127.0.0.1:8080"
$env:HTTP_PROXY="http://127.0.0.1:8080"
```
{% endtab %}
{% endtabs %}

### Az PowerShell

Azure PowerShell to modu z cmdletami do zarzdzania zasobami Azure bezporednio z linii polece PowerShell.

Postpuj zgodnie z tym linkiem, aby uzyska [**instrukcje instalacji**](https://learn.microsoft.com/en-us/powershell/azure/install-azure-powershell).

Polecenia w module Azure PowerShell AZ s zbudowane w nastpujcy spos贸b: `<Action>-Az<Service> <parameters>`

#### Debug | MitM Az PowerShell

U偶ywajc parametru **`-Debug`**, mo偶na zobaczy wszystkie 偶dania, kt贸re narzdzie wysya:
```bash
Get-AzResourceGroup -Debug
```
Aby przeprowadzi **MitM** na narzdziu i **rcznie sprawdzi wszystkie 偶dania**, kt贸re wysya, mo偶esz ustawi zmienne rodowiskowe `HTTPS_PROXY` i `HTTP_PROXY` zgodnie z [**dokumentacj**](https://learn.microsoft.com/en-us/powershell/azure/az-powershell-proxy).

### Microsoft Graph PowerShell

Microsoft Graph PowerShell to wieloplatformowe SDK, kt贸re umo偶liwia dostp do wszystkich interfejs贸w API Microsoft Graph, w tym usug takich jak SharePoint, Exchange i Outlook, za pomoc jednego punktu kocowego. Obsuguje PowerShell 7+, nowoczesne uwierzytelnianie za pomoc MSAL, to偶samoci zewntrzne i zaawansowane zapytania. Skupiajc si na dostpie z minimalnymi uprawnieniami, zapewnia bezpieczne operacje i regularnie otrzymuje aktualizacje, aby dostosowa si do najnowszych funkcji interfejsu API Microsoft Graph.

Postpuj zgodnie z tym linkiem, aby uzyska [**instrukcje instalacji**](https://learn.microsoft.com/en-us/powershell/microsoftgraph/installation).

Polecenia w Microsoft Graph PowerShell s zbudowane w nastpujcy spos贸b: `<Action>-Mg<Service> <parameters>`

#### Debugowanie Microsoft Graph PowerShell

U偶ywajc parametru **`-Debug`**, mo偶liwe jest zobaczenie wszystkich 偶da, kt贸re narzdzie wysya:
```bash
Get-MgUser -Debug
```
### ~~**AzureAD Powershell**~~

Modu Azure Active Directory (AD), obecnie **wycofany**, jest czci Azure PowerShell do zarzdzania zasobami Azure AD. Oferuje cmdlety do zada takich jak zarzdzanie u偶ytkownikami, grupami i rejestracjami aplikacji w Entra ID.

{% hint style="success" %}
Zosta zastpiony przez Microsoft Graph PowerShell
{% endhint %}

Postpuj zgodnie z tym linkiem, aby uzyska [**instrukcje instalacji**](https://www.powershellgallery.com/packages/AzureAD).
