# Az - Outils d'√©num√©ration

{% hint style="success" %}
Apprenez et pratiquez le hacking AWS :<img src="../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">[**Formation HackTricks AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">\
Apprenez et pratiquez le hacking GCP : <img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">[**Formation HackTricks GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Soutenir HackTricks</summary>

* V√©rifiez les [**plans d'abonnement**](https://github.com/sponsors/carlospolop) !
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez** nous sur **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Partagez des astuces de hacking en soumettant des PRs aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) d√©p√¥ts github.

</details>
{% endhint %}

## Installer PowerShell sur Linux

{% hint style="success" %}
Sur Linux, vous devrez installer PowerShell Core :
```bash
sudo apt-get update
sudo apt-get install -y wget apt-transport-https software-properties-common

# Ubuntu 20.04
wget -q https://packages.microsoft.com/config/ubuntu/20.04/packages-microsoft-prod.deb

# Update repos
sudo apt-get update
sudo add-apt-repository universe

# Install & start powershell
sudo apt-get install -y powershell
pwsh

# Az cli
curl -sL https://aka.ms/InstallAzureCLIDeb | sudo bash
```
{% endhint %}

## Installer PowerShell sur MacOS

Instructions de la [**documentation**](https://learn.microsoft.com/en-us/powershell/scripting/install/installing-powershell-on-macos?view=powershell-7.4) :

1. Installez `brew` si ce n'est pas encore fait :
```bash
/bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
```
2. Installez la derni√®re version stable de PowerShell :
```sh
brew install powershell/tap/powershell
```
3. Ex√©cutez PowerShell :
```sh
pwsh
```
4. Mise √† jour :
```sh
brew update
brew upgrade powershell
```
## Outils d'√©num√©ration principaux

### az cli

[**Interface de ligne de commande Azure (CLI)**](https://learn.microsoft.com/en-us/cli/azure/install-azure-cli) est un outil multiplateforme √©crit en Python pour g√©rer et administrer (la plupart des) ressources Azure et Entra ID. Il se connecte √† Azure et ex√©cute des commandes administratives via la ligne de commande ou des scripts.

Suivez ce lien pour les [**instructions d'installation¬°**](https://learn.microsoft.com/en-us/cli/azure/install-azure-cli#install).

Les commandes dans Azure CLI sont structur√©es selon un mod√®le de : `az <service> <action> <parameters>`

#### D√©boguer | MitM az cli

En utilisant le param√®tre **`--debug`**, il est possible de voir toutes les requ√™tes que l'outil **`az`** envoie :
```bash
az account management-group list --output table --debug
```
Pour effectuer un **MitM** sur l'outil et **v√©rifier toutes les requ√™tes** qu'il envoie manuellement, vous pouvez faire :

{% tabs %}
{% tab title="Bash" %}
```bash
export ADAL_PYTHON_SSL_NO_VERIFY=1
export AZURE_CLI_DISABLE_CONNECTION_VERIFICATION=1
export HTTPS_PROXY="http://127.0.0.1:8080"
export HTTP_PROXY="http://127.0.0.1:8080"

# If this is not enough
# Download the certificate from Burp and convert it into .pem format
# And export the following env variable
openssl x509 -in ~/Downloads/cacert.der -inform DER -out ~/Downloads/cacert.pem -outform PEM
export REQUESTS_CA_BUNDLE=/Users/user/Downloads/cacert.pem
```
{% endtab %}

{% tab title="PS" %}
```bash
$env:ADAL_PYTHON_SSL_NO_VERIFY=1
$env:AZURE_CLI_DISABLE_CONNECTION_VERIFICATION=1
$env:HTTPS_PROXY="http://127.0.0.1:8080"
$env:HTTP_PROXY="http://127.0.0.1:8080"
```
{% endtab %}
{% endtabs %}

### Az PowerShell

Azure PowerShell est un module avec des cmdlets pour g√©rer les ressources Azure directement depuis la ligne de commande PowerShell.

Suivez ce lien pour les [**instructions d'installation**](https://learn.microsoft.com/en-us/powershell/azure/install-azure-powershell).

Les commandes dans le module Azure PowerShell AZ sont structur√©es comme : `<Action>-Az<Service> <parameters>`

#### Debug | MitM Az PowerShell

En utilisant le param√®tre **`-Debug`**, il est possible de voir toutes les requ√™tes que l'outil envoie :
```bash
Get-AzResourceGroup -Debug
```
Pour effectuer un **MitM** sur l'outil et **v√©rifier toutes les requ√™tes** qu'il envoie manuellement, vous pouvez d√©finir les variables d'environnement `HTTPS_PROXY` et `HTTP_PROXY` selon la [**documentation**](https://learn.microsoft.com/en-us/powershell/azure/az-powershell-proxy).

### Microsoft Graph PowerShell

Microsoft Graph PowerShell est un SDK multiplateforme qui permet d'acc√©der √† toutes les API Microsoft Graph, y compris des services comme SharePoint, Exchange et Outlook, en utilisant un seul point de terminaison. Il prend en charge PowerShell 7+, l'authentification moderne via MSAL, les identit√©s externes et les requ√™tes avanc√©es. Avec un accent sur l'acc√®s avec le moindre privil√®ge, il garantit des op√©rations s√©curis√©es et re√ßoit des mises √† jour r√©guli√®res pour s'aligner sur les derni√®res fonctionnalit√©s de l'API Microsoft Graph.

Suivez ce lien pour les [**instructions d'installation**](https://learn.microsoft.com/en-us/powershell/microsoftgraph/installation).

Les commandes dans Microsoft Graph PowerShell sont structur√©es comme suit : `<Action>-Mg<Service> <parameters>`

#### D√©boguer Microsoft Graph PowerShell

En utilisant le param√®tre **`-Debug`**, il est possible de voir toutes les requ√™tes que l'outil envoie :
```bash
Get-MgUser -Debug
```
### ~~**AzureAD Powershell**~~

Le module Azure Active Directory (AD), maintenant **d√©pr√©ci√©**, fait partie d'Azure PowerShell pour g√©rer les ressources Azure AD. Il fournit des cmdlets pour des t√¢ches telles que la gestion des utilisateurs, des groupes et des enregistrements d'applications dans Entra ID.

{% hint style="success" %}
Ceci est remplac√© par Microsoft Graph PowerShell
{% endhint %}

Suivez ce lien pour les [**instructions d'installation**](https://www.powershellgallery.com/packages/AzureAD).
