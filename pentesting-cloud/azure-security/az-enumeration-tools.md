# Az - Enumeration Tools

{% hint style="success" %}
AWS í•´í‚¹ ë°°ìš°ê¸° ë° ì—°ìŠµí•˜ê¸°:<img src="../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
GCP í•´í‚¹ ë°°ìš°ê¸° ë° ì—°ìŠµí•˜ê¸°: <img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks ì§€ì›í•˜ê¸°</summary>

* [**êµ¬ë… ê³„íš**](https://github.com/sponsors/carlospolop) í™•ì¸í•˜ê¸°!
* **ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— ì°¸ì—¬í•˜ê±°ë‚˜ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**ë¥¼ íŒ”ë¡œìš°í•˜ì„¸ìš”.**
* **[**HackTricks**](https://github.com/carlospolop/hacktricks) ë° [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) ê¹ƒí—ˆë¸Œ ë¦¬í¬ì§€í† ë¦¬ì— PRì„ ì œì¶œí•˜ì—¬ í•´í‚¹ íŒì„ ê³µìœ í•˜ì„¸ìš”.**

</details>
{% endhint %}

## ë¦¬ëˆ…ìŠ¤ì— PowerShell ì„¤ì¹˜í•˜ê¸°

{% hint style="success" %}
ë¦¬ëˆ…ìŠ¤ì—ì„œëŠ” PowerShell Coreë¥¼ ì„¤ì¹˜í•´ì•¼ í•©ë‹ˆë‹¤:
```bash
sudo apt-get update
sudo apt-get install -y wget apt-transport-https software-properties-common

# Ubuntu 20.04
wget -q https://packages.microsoft.com/config/ubuntu/20.04/packages-microsoft-prod.deb

# Update repos
sudo apt-get update
sudo add-apt-repository universe

# Install & start powershell
sudo apt-get install -y powershell
pwsh

# Az cli
curl -sL https://aka.ms/InstallAzureCLIDeb | sudo bash
```
{% endhint %}

## MacOSì— PowerShell ì„¤ì¹˜í•˜ê¸°

[**ë¬¸ì„œ**](https://learn.microsoft.com/en-us/powershell/scripting/install/installing-powershell-on-macos?view=powershell-7.4)ì—ì„œì˜ ì§€ì¹¨:

1. ì•„ì§ ì„¤ì¹˜í•˜ì§€ ì•Šì•˜ë‹¤ë©´ `brew`ë¥¼ ì„¤ì¹˜í•©ë‹ˆë‹¤:
```bash
/bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
```
2. ìµœì‹  ì•ˆì • ë²„ì „ì˜ PowerShellì„ ì„¤ì¹˜í•©ë‹ˆë‹¤:
```sh
brew install powershell/tap/powershell
```
3. PowerShell ì‹¤í–‰:
```sh
pwsh
```
4. ì—…ë°ì´íŠ¸:
```sh
brew update
brew upgrade powershell
```
## ì£¼ìš” ì—´ê±° ë„êµ¬

### az cli

[**Azure Command-Line Interface (CLI)**](https://learn.microsoft.com/en-us/cli/azure/install-azure-cli)ëŠ” Azure ë° Entra ID ë¦¬ì†ŒìŠ¤ë¥¼ ê´€ë¦¬í•˜ê³  ìš´ì˜í•˜ê¸° ìœ„í•´ Pythonìœ¼ë¡œ ì‘ì„±ëœ í¬ë¡œìŠ¤ í”Œë«í¼ ë„êµ¬ì…ë‹ˆë‹¤. Azureì— ì—°ê²°í•˜ì—¬ ëª…ë ¹ì¤„ ë˜ëŠ” ìŠ¤í¬ë¦½íŠ¸ë¥¼ í†µí•´ ê´€ë¦¬ ëª…ë ¹ì„ ì‹¤í–‰í•©ë‹ˆë‹¤.

[**ì„¤ì¹˜ ì§€ì¹¨ì„ ë³´ë ¤ë©´ ì´ ë§í¬ë¥¼ ë”°ë¥´ì„¸ìš”Â¡**](https://learn.microsoft.com/en-us/cli/azure/install-azure-cli#install).

Azure CLIì˜ ëª…ë ¹ì€ ë‹¤ìŒ íŒ¨í„´ì„ ì‚¬ìš©í•˜ì—¬ êµ¬ì¡°í™”ë©ë‹ˆë‹¤: `az <service> <action> <parameters>`

#### ë””ë²„ê·¸ | MitM az cli

ë§¤ê°œë³€ìˆ˜ **`--debug`**ë¥¼ ì‚¬ìš©í•˜ë©´ ë„êµ¬ **`az`**ê°€ ë³´ë‚´ëŠ” ëª¨ë“  ìš”ì²­ì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```bash
az account management-group list --output table --debug
```
**MitM** ê³µê²©ì„ ë„êµ¬ì— ìˆ˜í–‰í•˜ê³  ìˆ˜ë™ìœ¼ë¡œ ì „ì†¡í•˜ëŠ” **ëª¨ë“  ìš”ì²­**ì„ í™•ì¸í•˜ë ¤ë©´ ë‹¤ìŒì„ ìˆ˜í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

{% tabs %}
{% tab title="Bash" %}
```bash
export ADAL_PYTHON_SSL_NO_VERIFY=1
export AZURE_CLI_DISABLE_CONNECTION_VERIFICATION=1
export HTTPS_PROXY="http://127.0.0.1:8080"
export HTTP_PROXY="http://127.0.0.1:8080"

# If this is not enough
# Download the certificate from Burp and convert it into .pem format
# And export the following env variable
openssl x509 -in ~/Downloads/cacert.der -inform DER -out ~/Downloads/cacert.pem -outform PEM
export REQUESTS_CA_BUNDLE=/Users/user/Downloads/cacert.pem
```
{% endtab %}

{% tab title="PS" %}
```bash
$env:ADAL_PYTHON_SSL_NO_VERIFY=1
$env:AZURE_CLI_DISABLE_CONNECTION_VERIFICATION=1
$env:HTTPS_PROXY="http://127.0.0.1:8080"
$env:HTTP_PROXY="http://127.0.0.1:8080"
```
{% endtab %}
{% endtabs %}

### Az PowerShell

Azure PowerShellì€ PowerShell ëª…ë ¹ì¤„ì—ì„œ Azure ë¦¬ì†ŒìŠ¤ë¥¼ ì§ì ‘ ê´€ë¦¬í•˜ê¸° ìœ„í•œ cmdletì´ í¬í•¨ëœ ëª¨ë“ˆì…ë‹ˆë‹¤.

[**ì„¤ì¹˜ ì§€ì¹¨**](https://learn.microsoft.com/en-us/powershell/azure/install-azure-powershell) ë§í¬ë¥¼ ë”°ë¼ê°€ì„¸ìš”.

Azure PowerShell AZ ëª¨ë“ˆì˜ ëª…ë ¹ì€ ë‹¤ìŒê³¼ ê°™ì´ êµ¬ì¡°í™”ë©ë‹ˆë‹¤: `<Action>-Az<Service> <parameters>`

#### Debug | MitM Az PowerShell

ë§¤ê°œë³€ìˆ˜ **`-Debug`**ë¥¼ ì‚¬ìš©í•˜ë©´ ë„êµ¬ê°€ ë³´ë‚´ëŠ” ëª¨ë“  ìš”ì²­ì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```bash
Get-AzResourceGroup -Debug
```
MitM ê³µê²©ì„ ë„êµ¬ì— ìˆ˜í–‰í•˜ê³  ìˆ˜ë™ìœ¼ë¡œ ì „ì†¡í•˜ëŠ” ëª¨ë“  ìš”ì²­ì„ í™•ì¸í•˜ë ¤ë©´ [**ë¬¸ì„œ**](https://learn.microsoft.com/en-us/powershell/azure/az-powershell-proxy)ì— ë”°ë¼ í™˜ê²½ ë³€ìˆ˜ë¥¼ `HTTPS_PROXY` ë° `HTTP_PROXY`ë¡œ ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### Microsoft Graph PowerShell

Microsoft Graph PowerShellì€ ë‹¨ì¼ ì—”ë“œí¬ì¸íŠ¸ë¥¼ ì‚¬ìš©í•˜ì—¬ SharePoint, Exchange ë° Outlookê³¼ ê°™ì€ ì„œë¹„ìŠ¤ì— ëŒ€í•œ ëª¨ë“  Microsoft Graph APIì— ì ‘ê·¼í•  ìˆ˜ ìˆëŠ” í¬ë¡œìŠ¤ í”Œë«í¼ SDKì…ë‹ˆë‹¤. PowerShell 7+ë¥¼ ì§€ì›í•˜ë©°, MSALì„ í†µí•œ í˜„ëŒ€ ì¸ì¦, ì™¸ë¶€ ID ë° ê³ ê¸‰ ì¿¼ë¦¬ë¥¼ ì§€ì›í•©ë‹ˆë‹¤. ìµœì†Œ ê¶Œí•œ ì•¡ì„¸ìŠ¤ì— ì¤‘ì ì„ ë‘ì–´ ë³´ì•ˆ ì‘ì—…ì„ ë³´ì¥í•˜ë©°, ìµœì‹  Microsoft Graph API ê¸°ëŠ¥ì— ë§ì¶° ì •ê¸°ì ìœ¼ë¡œ ì—…ë°ì´íŠ¸ë¥¼ ë°›ìŠµë‹ˆë‹¤.

[**ì„¤ì¹˜ ì§€ì¹¨**](https://learn.microsoft.com/en-us/powershell/microsoftgraph/installation)ì„ ë³´ë ¤ë©´ ì´ ë§í¬ë¥¼ ë”°ë¥´ì„¸ìš”.

Microsoft Graph PowerShellì˜ ëª…ë ¹ì€ ë‹¤ìŒê³¼ ê°™ì´ êµ¬ì¡°í™”ë©ë‹ˆë‹¤: `<Action>-Mg<Service> <parameters>`

#### Microsoft Graph PowerShell ë””ë²„ê·¸

**`-Debug`** ë§¤ê°œë³€ìˆ˜ë¥¼ ì‚¬ìš©í•˜ë©´ ë„êµ¬ê°€ ì „ì†¡í•˜ëŠ” ëª¨ë“  ìš”ì²­ì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```bash
Get-MgUser -Debug
```
### ~~**AzureAD Powershell**~~

Azure Active Directory (AD) ëª¨ë“ˆì€ í˜„ì¬ **ì‚¬ìš© ì¤‘ë‹¨**ë˜ì—ˆìœ¼ë©°, Azure AD ë¦¬ì†ŒìŠ¤ë¥¼ ê´€ë¦¬í•˜ê¸° ìœ„í•œ Azure PowerShellì˜ ì¼ë¶€ì…ë‹ˆë‹¤. Entra IDì—ì„œ ì‚¬ìš©ì, ê·¸ë£¹ ë° ì• í”Œë¦¬ì¼€ì´ì…˜ ë“±ë¡ì„ ê´€ë¦¬í•˜ëŠ” ì‘ì—…ì„ ìœ„í•œ cmdletì„ ì œê³µí•©ë‹ˆë‹¤.

{% hint style="success" %}
ì´ê²ƒì€ Microsoft Graph PowerShellë¡œ ëŒ€ì²´ë˜ì—ˆìŠµë‹ˆë‹¤.
{% endhint %}

[**ì„¤ì¹˜ ì§€ì¹¨**](https://www.powershellgallery.com/packages/AzureAD)ì„ ë³´ë ¤ë©´ ì´ ë§í¬ë¥¼ ë”°ë¥´ì„¸ìš”.
