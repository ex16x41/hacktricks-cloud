# Az - Herramientas de Enumeraci칩n

{% hint style="success" %}
Aprende y practica Hacking en AWS:<img src="../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
Aprende y practica Hacking en GCP: <img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Apoya a HackTricks</summary>

* Revisa los [**planes de suscripci칩n**](https://github.com/sponsors/carlospolop)!
* **칔nete al** 游눫 [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s칤guenos** en **Twitter** 游냕 [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Comparte trucos de hacking enviando PRs a los** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repositorios de github.

</details>
{% endhint %}

## Instalar PowerShell en Linux

{% hint style="success" %}
En Linux necesitar치s instalar PowerShell Core:
```bash
sudo apt-get update
sudo apt-get install -y wget apt-transport-https software-properties-common

# Ubuntu 20.04
wget -q https://packages.microsoft.com/config/ubuntu/20.04/packages-microsoft-prod.deb

# Update repos
sudo apt-get update
sudo add-apt-repository universe

# Install & start powershell
sudo apt-get install -y powershell
pwsh

# Az cli
curl -sL https://aka.ms/InstallAzureCLIDeb | sudo bash
```
{% endhint %}

## Instalar PowerShell en MacOS

Instrucciones de la [**documentaci칩n**](https://learn.microsoft.com/en-us/powershell/scripting/install/installing-powershell-on-macos?view=powershell-7.4):

1. Instala `brew` si a칰n no est치 instalado:
```bash
/bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
```
2. Instale la 칰ltima versi칩n estable de PowerShell:
```sh
brew install powershell/tap/powershell
```
3. Ejecutar PowerShell:
```sh
pwsh
```
4. Actualizaci칩n:
```sh
brew update
brew upgrade powershell
```
## Herramientas Principales de Enumeraci칩n

### az cli

[**Interfaz de L칤nea de Comando de Azure (CLI)**](https://learn.microsoft.com/en-us/cli/azure/install-azure-cli) es una herramienta multiplataforma escrita en Python para gestionar y administrar (la mayor칤a de) los recursos de Azure y Entra ID. Se conecta a Azure y ejecuta comandos administrativos a trav칠s de la l칤nea de comandos o scripts.

Sigue este enlace para las [**instrucciones de instalaci칩n춰**](https://learn.microsoft.com/en-us/cli/azure/install-azure-cli#install).

Los comandos en Azure CLI est치n estructurados utilizando un patr칩n de: `az <servicio> <acci칩n> <par치metros>`

#### Depurar | MitM az cli

Usando el par치metro **`--debug`** es posible ver todas las solicitudes que la herramienta **`az`** est치 enviando:
```bash
az account management-group list --output table --debug
```
Para realizar un **MitM** a la herramienta y **verificar todas las solicitudes** que est치 enviando manualmente, puedes hacer:

{% tabs %}
{% tab title="Bash" %}
```bash
export ADAL_PYTHON_SSL_NO_VERIFY=1
export AZURE_CLI_DISABLE_CONNECTION_VERIFICATION=1
export HTTPS_PROXY="http://127.0.0.1:8080"
export HTTP_PROXY="http://127.0.0.1:8080"

# If this is not enough
# Download the certificate from Burp and convert it into .pem format
# And export the following env variable
openssl x509 -in ~/Downloads/cacert.der -inform DER -out ~/Downloads/cacert.pem -outform PEM
export REQUESTS_CA_BUNDLE=/Users/user/Downloads/cacert.pem
```
{% endtab %}

{% tab title="PS" %}
```bash
$env:ADAL_PYTHON_SSL_NO_VERIFY=1
$env:AZURE_CLI_DISABLE_CONNECTION_VERIFICATION=1
$env:HTTPS_PROXY="http://127.0.0.1:8080"
$env:HTTP_PROXY="http://127.0.0.1:8080"
```
{% endtab %}
{% endtabs %}

### Az PowerShell

Azure PowerShell es un m칩dulo con cmdlets para gestionar recursos de Azure directamente desde la l칤nea de comandos de PowerShell.

Sigue este enlace para las [**instrucciones de instalaci칩n**](https://learn.microsoft.com/en-us/powershell/azure/install-azure-powershell).

Los comandos en el M칩dulo AZ de Azure PowerShell est치n estructurados como: `<Action>-Az<Service> <parameters>`

#### Debug | MitM Az PowerShell

Usando el par치metro **`-Debug`** es posible ver todas las solicitudes que la herramienta est치 enviando:
```bash
Get-AzResourceGroup -Debug
```
Para realizar un **MitM** a la herramienta y **ver todas las solicitudes** que est치 enviando manualmente, puedes establecer las variables de entorno `HTTPS_PROXY` y `HTTP_PROXY` de acuerdo con la [**documentaci칩n**](https://learn.microsoft.com/en-us/powershell/azure/az-powershell-proxy).

### Microsoft Graph PowerShell

Microsoft Graph PowerShell es un SDK multiplataforma que permite el acceso a todas las API de Microsoft Graph, incluidos servicios como SharePoint, Exchange y Outlook, utilizando un 칰nico punto final. Soporta PowerShell 7+, autenticaci칩n moderna a trav칠s de MSAL, identidades externas y consultas avanzadas. Con un enfoque en el acceso de menor privilegio, garantiza operaciones seguras y recibe actualizaciones regulares para alinearse con las 칰ltimas caracter칤sticas de la API de Microsoft Graph.

Sigue este enlace para las [**instrucciones de instalaci칩n**](https://learn.microsoft.com/en-us/powershell/microsoftgraph/installation).

Los comandos en Microsoft Graph PowerShell est치n estructurados como: `<Action>-Mg<Service> <parameters>`

#### Depurar Microsoft Graph PowerShell

Usando el par치metro **`-Debug`** es posible ver todas las solicitudes que la herramienta est치 enviando:
```bash
Get-MgUser -Debug
```
### ~~**AzureAD Powershell**~~

El m칩dulo de Azure Active Directory (AD), ahora **obsoleto**, es parte de Azure PowerShell para gestionar recursos de Azure AD. Proporciona cmdlets para tareas como gestionar usuarios, grupos y registros de aplicaciones en Entra ID.

{% hint style="success" %}
Esto es reemplazado por Microsoft Graph PowerShell
{% endhint %}

Sigue este enlace para las [**instrucciones de instalaci칩n**](https://www.powershellgallery.com/packages/AzureAD).
