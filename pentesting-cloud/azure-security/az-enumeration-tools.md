# Az - Enumeration Tools

{% hint style="success" %}
AWS 해킹 배우기 및 연습하기:<img src="../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
GCP 해킹 배우기 및 연습하기: <img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks 지원하기</summary>

* [**구독 계획**](https://github.com/sponsors/carlospolop) 확인하기!
* **💬 [**Discord 그룹**](https://discord.gg/hRep4RUj7f) 또는 [**텔레그램 그룹**](https://t.me/peass)에 참여하거나 **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**를 팔로우하세요.**
* **[**HackTricks**](https://github.com/carlospolop/hacktricks) 및 [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) 깃허브 리포지토리에 PR을 제출하여 해킹 팁을 공유하세요.**

</details>
{% endhint %}

## 리눅스에 PowerShell 설치하기

{% hint style="success" %}
리눅스에서는 PowerShell Core를 설치해야 합니다:
```bash
sudo apt-get update
sudo apt-get install -y wget apt-transport-https software-properties-common

# Ubuntu 20.04
wget -q https://packages.microsoft.com/config/ubuntu/20.04/packages-microsoft-prod.deb

# Update repos
sudo apt-get update
sudo add-apt-repository universe

# Install & start powershell
sudo apt-get install -y powershell
pwsh

# Az cli
curl -sL https://aka.ms/InstallAzureCLIDeb | sudo bash
```
{% endhint %}

## MacOS에 PowerShell 설치하기

[**문서**](https://learn.microsoft.com/en-us/powershell/scripting/install/installing-powershell-on-macos?view=powershell-7.4)에서의 지침:

1. 아직 설치하지 않았다면 `brew`를 설치합니다:
```bash
/bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
```
2. 최신 안정 버전의 PowerShell을 설치합니다:
```sh
brew install powershell/tap/powershell
```
3. PowerShell 실행:
```sh
pwsh
```
4. 업데이트:
```sh
brew update
brew upgrade powershell
```
## 주요 열거 도구

### az cli

[**Azure Command-Line Interface (CLI)**](https://learn.microsoft.com/en-us/cli/azure/install-azure-cli)는 Azure 및 Entra ID 리소스를 관리하고 운영하기 위해 Python으로 작성된 크로스 플랫폼 도구입니다. Azure에 연결하여 명령줄 또는 스크립트를 통해 관리 명령을 실행합니다.

[**설치 지침을 보려면 이 링크를 따르세요¡**](https://learn.microsoft.com/en-us/cli/azure/install-azure-cli#install).

Azure CLI의 명령은 다음 패턴을 사용하여 구조화됩니다: `az <service> <action> <parameters>`

#### 디버그 | MitM az cli

매개변수 **`--debug`**를 사용하면 도구 **`az`**가 보내는 모든 요청을 볼 수 있습니다:
```bash
az account management-group list --output table --debug
```
**MitM** 공격을 도구에 수행하고 수동으로 전송하는 **모든 요청**을 확인하려면 다음을 수행할 수 있습니다:

{% tabs %}
{% tab title="Bash" %}
```bash
export ADAL_PYTHON_SSL_NO_VERIFY=1
export AZURE_CLI_DISABLE_CONNECTION_VERIFICATION=1
export HTTPS_PROXY="http://127.0.0.1:8080"
export HTTP_PROXY="http://127.0.0.1:8080"

# If this is not enough
# Download the certificate from Burp and convert it into .pem format
# And export the following env variable
openssl x509 -in ~/Downloads/cacert.der -inform DER -out ~/Downloads/cacert.pem -outform PEM
export REQUESTS_CA_BUNDLE=/Users/user/Downloads/cacert.pem
```
{% endtab %}

{% tab title="PS" %}
```bash
$env:ADAL_PYTHON_SSL_NO_VERIFY=1
$env:AZURE_CLI_DISABLE_CONNECTION_VERIFICATION=1
$env:HTTPS_PROXY="http://127.0.0.1:8080"
$env:HTTP_PROXY="http://127.0.0.1:8080"
```
{% endtab %}
{% endtabs %}

### Az PowerShell

Azure PowerShell은 PowerShell 명령줄에서 Azure 리소스를 직접 관리하기 위한 cmdlet이 포함된 모듈입니다.

[**설치 지침**](https://learn.microsoft.com/en-us/powershell/azure/install-azure-powershell) 링크를 따라가세요.

Azure PowerShell AZ 모듈의 명령은 다음과 같이 구조화됩니다: `<Action>-Az<Service> <parameters>`

#### Debug | MitM Az PowerShell

매개변수 **`-Debug`**를 사용하면 도구가 보내는 모든 요청을 볼 수 있습니다:
```bash
Get-AzResourceGroup -Debug
```
MitM 공격을 도구에 수행하고 수동으로 전송하는 모든 요청을 확인하려면 [**문서**](https://learn.microsoft.com/en-us/powershell/azure/az-powershell-proxy)에 따라 환경 변수를 `HTTPS_PROXY` 및 `HTTP_PROXY`로 설정할 수 있습니다.

### Microsoft Graph PowerShell

Microsoft Graph PowerShell은 단일 엔드포인트를 사용하여 SharePoint, Exchange 및 Outlook과 같은 서비스에 대한 모든 Microsoft Graph API에 접근할 수 있는 크로스 플랫폼 SDK입니다. PowerShell 7+를 지원하며, MSAL을 통한 현대 인증, 외부 ID 및 고급 쿼리를 지원합니다. 최소 권한 액세스에 중점을 두어 보안 작업을 보장하며, 최신 Microsoft Graph API 기능에 맞춰 정기적으로 업데이트를 받습니다.

[**설치 지침**](https://learn.microsoft.com/en-us/powershell/microsoftgraph/installation)을 보려면 이 링크를 따르세요.

Microsoft Graph PowerShell의 명령은 다음과 같이 구조화됩니다: `<Action>-Mg<Service> <parameters>`

#### Microsoft Graph PowerShell 디버그

**`-Debug`** 매개변수를 사용하면 도구가 전송하는 모든 요청을 볼 수 있습니다:
```bash
Get-MgUser -Debug
```
### ~~**AzureAD Powershell**~~

Azure Active Directory (AD) 모듈은 현재 **사용 중단**되었으며, Azure AD 리소스를 관리하기 위한 Azure PowerShell의 일부입니다. Entra ID에서 사용자, 그룹 및 애플리케이션 등록을 관리하는 작업을 위한 cmdlet을 제공합니다.

{% hint style="success" %}
이것은 Microsoft Graph PowerShell로 대체되었습니다.
{% endhint %}

[**설치 지침**](https://www.powershellgallery.com/packages/AzureAD)을 보려면 이 링크를 따르세요.
