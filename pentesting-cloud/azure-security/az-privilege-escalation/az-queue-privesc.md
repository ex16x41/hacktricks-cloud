# Az - Queue Storage Privesc

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Queue

Pour plus d'informations, consultez :

{% content-ref url="../az-services/az-queue-enum.md" %}
[az-queue-enum.md](../az-services/az-queue-enum.md)
{% endcontent-ref %}

### DataActions: `Microsoft.Storage/storageAccounts/queueServices/queues/messages/read`

Un attaquant avec cette permission peut consulter les messages d'une Azure Storage Queue. Cela permet √† l'attaquant de voir le contenu des messages sans les marquer comme trait√©s ou modifier leur √©tat. Cela pourrait conduire √† un acc√®s non autoris√© √† des informations sensibles, permettant l'exfiltration de donn√©es ou la collecte de renseignements pour de futures attaques.

{% code overflow="wrap" %}
```bash
az storage message peek --queue-name <queue_name> --account-name <storage_account>
```
{% endcode %}

**Impact potentiel** : Acc√®s non autoris√© √† la file d'attente, exposition de messages ou manipulation de la file d'attente par des utilisateurs ou services non autoris√©s.

### DataActions : `Microsoft.Storage/storageAccounts/queueServices/queues/messages/process/action`

Avec cette autorisation, un attaquant peut r√©cup√©rer et traiter des messages d'une Azure Storage Queue. Cela signifie qu'il peut lire le contenu des messages et les marquer comme trait√©s, les cachant ainsi des syst√®mes l√©gitimes. Cela pourrait entra√Æner l'exposition de donn√©es sensibles, des perturbations dans la gestion des messages, ou m√™me l'arr√™t de flux de travail importants en rendant les messages indisponibles pour leurs utilisateurs pr√©vus.

{% code overflow="wrap" %}
```bash
az storage message get --queue-name <queue_name> --account-name <storage_account>
```
{% endcode %}

### DataActions : `Microsoft.Storage/storageAccounts/queueServices/queues/messages/add/action`

Avec cette autorisation, un attaquant peut ajouter de nouveaux messages √† une Azure Storage Queue. Cela leur permet d'injecter des donn√©es malveillantes ou non autoris√©es dans la file d'attente, ce qui peut d√©clencher des actions non intentionnelles ou perturber les services en aval qui traitent les messages.

{% code overflow="wrap" %}
```bash
az storage message put --queue-name <queue-name> --content "Injected malicious message" --account-name <storage-account>
```
{% endcode %}

### DataActions: `Microsoft.Storage/storageAccounts/queueServices/queues/messages/write`

Cette autorisation permet √† un attaquant d'ajouter de nouveaux messages ou de mettre √† jour ceux existants dans une Azure Storage Queue. En utilisant cela, ils pourraient ins√©rer du contenu nuisible ou modifier des messages existants, induisant potentiellement en erreur des applications ou provoquant des comportements ind√©sirables dans les syst√®mes qui d√©pendent de la queue.

{% code overflow="wrap" %}
```bash
az storage message put --queue-name <queue-name> --content "Injected malicious message" --account-name <storage-account>

#Update the message
az storage message update --queue-name <queue-name> \
--id <message-id> \
--pop-receipt <pop-receipt> \
--content "Updated message content" \
--visibility-timeout <timeout-in-seconds> \
--account-name <storage-account>
```
{% endcode %}

### Action: `Microsoft.Storage/storageAccounts/queueServices/queues/write`

Cette autorisation permet √† un attaquant de cr√©er ou de modifier des files d'attente et leurs propri√©t√©s au sein du compte de stockage. Elle peut √™tre utilis√©e pour cr√©er des files d'attente non autoris√©es, modifier des m√©tadonn√©es ou changer des listes de contr√¥le d'acc√®s (ACL) pour accorder ou restreindre l'acc√®s. Cette capacit√© pourrait perturber les flux de travail, injecter des donn√©es malveillantes, exfiltrer des informations sensibles ou manipuler les param√®tres de la file d'attente pour permettre d'autres attaques.

{% code overflow="wrap" %}
```bash
az storage queue create --name <new-queue-name> --account-name <storage-account>

az storage queue metadata update --name <queue-name> --metadata key1=value1 key2=value2 --account-name <storage-account>

az storage queue policy set --name <queue-name> --permissions rwd --expiry 2024-12-31T23:59:59Z --account-name <storage-account>
```
{% endcode %}

## R√©f√©rences

* https://learn.microsoft.com/en-us/azure/storage/queues/storage-powershell-how-to-use-queues
* https://learn.microsoft.com/en-us/rest/api/storageservices/queue-service-rest-api
* https://learn.microsoft.com/en-us/azure/storage/queues/queues-auth-abac-attributes

{% hint style="success" %}
Apprenez et pratiquez le hacking AWS :<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1) (1).png" alt="" data-size="line">\
Apprenez et pratiquez le hacking GCP : <img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Soutenir HackTricks</summary>

* Consultez les [**plans d'abonnement**](https://github.com/sponsors/carlospolop) !
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez** nous sur **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Partagez des astuces de hacking en soumettant des PRs aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) d√©p√¥ts github.

</details>
{% endhint %}
