# Az - èªè¨¼ãªã—ã®åˆ—æŒ™ã¨åˆæœŸã‚¨ãƒ³ãƒˆãƒª

{% hint style="success" %}
AWSãƒãƒƒã‚­ãƒ³ã‚°ã®å­¦ç¿’ã¨ç·´ç¿’:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCPãƒãƒƒã‚­ãƒ³ã‚°ã®å­¦ç¿’ã¨ç·´ç¿’: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricksã®ã‚µãƒãƒ¼ãƒˆ</summary>

* [**ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³**](https://github.com/sponsors/carlospolop)ã‚’ãƒã‚§ãƒƒã‚¯ï¼
* ğŸ’¬ [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã«å‚åŠ ã™ã‚‹ã‹ã€[**telegramã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«å‚åŠ ã™ã‚‹ã‹ã€**Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**ã‚’ãƒ•ã‚©ãƒ­ãƒ¼**ã—ã¦ãã ã•ã„ã€‚
* **ãƒãƒƒã‚­ãƒ³ã‚°ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã™ã‚‹ãŸã‚ã«ã€** [**HackTricks**](https://github.com/carlospolop/hacktricks)ã¨[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)ã®GitHubãƒªãƒã‚¸ãƒˆãƒªã«PRã‚’æå‡ºã—ã¦ãã ã•ã„ã€‚

</details>
{% endhint %}

## Azureãƒ†ãƒŠãƒ³ãƒˆ

### ãƒ†ãƒŠãƒ³ãƒˆã®åˆ—æŒ™

**ãƒ†ãƒŠãƒ³ãƒˆã®ãƒ‰ãƒ¡ã‚¤ãƒ³**ã‚’çŸ¥ã£ã¦ã„ã‚‹ã ã‘ã§ã€æ”»æ’ƒè€…ã¯ã‚ˆã‚Šå¤šãã®æƒ…å ±ã‚’åé›†ã™ã‚‹ãŸã‚ã«ã‚¯ã‚¨ãƒªã§ãã‚‹**ä¸€éƒ¨ã®å…¬é–‹Azure API**ãŒã‚ã‚Šã¾ã™ã€‚\
APIã‚’ç›´æ¥ã‚¯ã‚¨ãƒªã™ã‚‹ã‹ã€PowerShellãƒ©ã‚¤ãƒ–ãƒ©ãƒª[**AADInternals**](https://github.com/Gerenios)ã‚’ä½¿ç”¨ã§ãã¾ã™:

| API                                                                  | æƒ…å ±                                                                                                                                                                                                                                           | AADInternalsã®æ©Ÿèƒ½                             |
| -------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------- |
| login.microsoftonline.com/\<domain>/.well-known/openid-configuration | ãƒ†ãƒŠãƒ³ãƒˆIDã‚’å«ã‚€**ãƒ­ã‚°ã‚¤ãƒ³æƒ…å ±**                                                                                                                                                                                                            | `Get-AADIntTenantID -Domain <domain>`             |
| autodiscover-s.outlook.com/autodiscover/autodiscover.svc             | ãƒ†ãƒŠãƒ³ãƒˆã®**ã™ã¹ã¦ã®ãƒ‰ãƒ¡ã‚¤ãƒ³**                                                                                                                                                                                                               | `Get-AADIntTenantDomains -Domain <domain>`        |
| login.microsoftonline.com/GetUserRealm.srf?login=\<UserName>         | <p>ãƒ†ãƒŠãƒ³ãƒˆã®**ãƒ­ã‚°ã‚¤ãƒ³æƒ…å ±**ã€ãƒ†ãƒŠãƒ³ãƒˆåãŠã‚ˆã³ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’å«ã‚€<strong>èªè¨¼ã‚¿ã‚¤ãƒ—</strong>ã€‚<br>If <code>NameSpaceType</code>ãŒ<strong><code>Managed</code></strong>ã§ã‚ã‚‹å ´åˆã€<strong>AzureAD</strong>ãŒä½¿ç”¨ã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’æ„å‘³ã—ã¾ã™ã€‚</p> | `Get-AADIntLoginInformation -UserName <UserName>` |
| login.microsoftonline.com/common/GetCredentialType                   | **ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—SSOæƒ…å ±**ã‚’å«ã‚€ãƒ­ã‚°ã‚¤ãƒ³æƒ…å ±                                                                                                                                                                                              | `Get-AADIntLoginInformation -UserName <UserName>` |

**AADInternals**ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®**1ã¤ã®ã‚³ãƒãƒ³ãƒ‰**ã§Azureãƒ†ãƒŠãƒ³ãƒˆã®ã™ã¹ã¦ã®æƒ…å ±ã‚’ã‚¯ã‚¨ãƒªã§ãã¾ã™:
```powershell
Invoke-AADIntReconAsOutsider -DomainName corp.onmicrosoft.com | Format-Table
```
Azure ãƒ†ãƒŠãƒ³ãƒˆæƒ…å ±ã®å‡ºåŠ›ä¾‹:
```
Tenant brand:       Company Ltd
Tenant name:        company
Tenant id:          1937e3ab-38de-a735-a830-3075ea7e5b39
DesktopSSO enabled: True

Name                           DNS   MX    SPF  Type      STS
----                           ---   --    ---  ----      ---
company.com                   True  True  True  Federated sts.company.com
company.mail.onmicrosoft.com  True  True  True  Managed
company.onmicrosoft.com       True  True  True  Managed
int.company.com              False False False  Managed
```
ãƒ†ãƒŠãƒ³ãƒˆã®åå‰ã€IDã€ãŠã‚ˆã³ã€Œãƒ–ãƒ©ãƒ³ãƒ‰ã€åã®è©³ç´°ã‚’è¦³å¯Ÿã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚ã•ã‚‰ã«ã€ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ã‚·ãƒ³ã‚°ãƒ«ã‚µã‚¤ãƒ³ã‚ªãƒ³ï¼ˆSSOï¼‰ã®çŠ¶æ…‹ã€åˆ¥å[**Seamless SSO**](https://docs.microsoft.com/en-us/azure/active-directory/hybrid/how-to-connect-sso)ã‚‚è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚ã“ã®æ©Ÿèƒ½ãŒæœ‰åŠ¹ã«ãªã£ã¦ã„ã‚‹å ´åˆã€ç‰¹å®šã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒå¯¾è±¡çµ„ç¹”å†…ã«å­˜åœ¨ã™ã‚‹ã‹ã©ã†ã‹ã‚’ç‰¹å®šã™ã‚‹ã®ã‚’å®¹æ˜“ã«ã—ã¾ã™ã€‚

ã•ã‚‰ã«ã€å‡ºåŠ›ã«ã¯ã€å¯¾è±¡ãƒ†ãƒŠãƒ³ãƒˆã«é–¢é€£ä»˜ã‘ã‚‰ã‚ŒãŸã™ã¹ã¦ã®æ¤œè¨¼æ¸ˆã¿ãƒ‰ãƒ¡ã‚¤ãƒ³ã®åå‰ã¨ãã‚Œãã‚Œã®è­˜åˆ¥ã‚¿ã‚¤ãƒ—ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚ãƒ•ã‚§ãƒ‡ãƒ¬ãƒ¼ãƒ†ãƒƒãƒ‰ãƒ‰ãƒ¡ã‚¤ãƒ³ã®å ´åˆã€ä½¿ç”¨ã•ã‚Œã¦ã„ã‚‹è­˜åˆ¥ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ï¼ˆé€šå¸¸ã¯ADFSã‚µãƒ¼ãƒãƒ¼ï¼‰ã®å®Œå…¨ä¿®é£¾ãƒ‰ãƒ¡ã‚¤ãƒ³åï¼ˆFQDNï¼‰ã‚‚é–‹ç¤ºã•ã‚Œã¾ã™ã€‚"MX"åˆ—ã¯ã€ãƒ¡ãƒ¼ãƒ«ãŒExchange Onlineã«ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã•ã‚Œã¦ã„ã‚‹ã‹ã©ã†ã‹ã‚’æŒ‡å®šã—ã€"SPF"åˆ—ã¯Exchange OnlineãŒãƒ¡ãƒ¼ãƒ«é€ä¿¡è€…ã¨ã—ã¦ãƒªã‚¹ãƒˆã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¤ºã—ã¾ã™ã€‚ç¾åœ¨ã®åµå¯Ÿæ©Ÿèƒ½ã¯ã€SPFãƒ¬ã‚³ãƒ¼ãƒ‰å†…ã®ã€Œincludeã€ã‚¹ãƒ†ãƒ¼ãƒˆãƒ¡ãƒ³ãƒˆã‚’è§£æã—ãªã„ãŸã‚ã€èª¤æ¤œå‡ºãŒç™ºç”Ÿã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ã“ã¨ã«æ³¨æ„ã™ã‚‹ã“ã¨ãŒé‡è¦ã§ã™ã€‚

### ãƒ¦ãƒ¼ã‚¶ãƒ¼åˆ—æŒ™

ãƒ†ãƒŠãƒ³ãƒˆå†…ã«ãƒ¦ãƒ¼ã‚¶ãƒ¼åãŒå­˜åœ¨ã™ã‚‹ã‹ã©ã†ã‹ã‚’**ãƒã‚§ãƒƒã‚¯**ã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚ã“ã‚Œã«ã¯ã€**ã‚²ã‚¹ãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼**ã‚‚å«ã¾ã‚Œã¾ã™ã€‚ã‚²ã‚¹ãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼åã¯æ¬¡ã®å½¢å¼ã§ã™ï¼š
```
<email>#EXT#@<tenant name>.onmicrosoft.com
```
ä»¥ä¸‹ã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã§ã€ã€Œ@ã€ãŒã‚¢ãƒ³ãƒ€ãƒ¼ã‚¹ã‚³ã‚¢ã€Œ\_ã€ã«ç½®ãæ›ãˆã‚‰ã‚Œã¦ã„ã¾ã™ã€‚

[**AADInternals**](https://github.com/Gerenios/AADInternals)ã‚’ä½¿ç”¨ã—ã¦ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒå­˜åœ¨ã™ã‚‹ã‹ã©ã†ã‹ã‚’ç°¡å˜ã«ç¢ºèªã§ãã¾ã™ã€‚
```powershell
# Check does the user exist
Invoke-AADIntUserEnumerationAsOutsider -UserName "user@company.com"
```
## Unauthenticated Enumeration and Initial Entry

### Introduction

In this section, we will cover the techniques used to perform unauthenticated enumeration and gain initial access to Azure environments. Unauthenticated enumeration involves gathering information from publicly available sources without the need for valid credentials. This information can then be used to identify potential entry points into the target Azure environment.

### Tools and Techniques

#### 1. **Enumerating Azure Subdomains**

One common technique is to use tools like `Sublist3r` or `Amass` to discover subdomains associated with the target Azure environment. By identifying subdomains, an attacker can potentially find services or applications that may be vulnerable to exploitation.

#### 2. **Identifying Azure Storage Accounts**

Another important aspect of unauthenticated enumeration is identifying Azure storage accounts. Tools like `Azure Storage Explorer` or manual inspection of DNS records can help in discovering storage accounts that may contain sensitive data.

#### 3. **Exploring Azure Blob Containers**

Once storage accounts are identified, attackers can explore Azure Blob containers within these accounts. This can lead to the discovery of exposed data such as configuration files, backups, or other critical information.

### Conclusion

Unauthenticated enumeration is a crucial step in the reconnaissance phase of a penetration test. By leveraging publicly available information, attackers can gather valuable insights that may assist in gaining initial access to Azure environments.
```
UserName         Exists
--------         ------
user@company.com True
```
æ¬¡ã®ã‚ˆã†ãª1è¡Œã«1ã¤ã®é›»å­ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ãŒè¨˜è¼‰ã•ã‚ŒãŸãƒ†ã‚­ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™:
```
user@company.com
user2@company.com
admin@company.com
admin2@company.com
external.user_gmail.com#EXT#@company.onmicrosoft.com
external.user_outlook.com#EXT#@company.onmicrosoft.com
```

```powershell
# Invoke user enumeration
Get-Content .\users.txt | Invoke-AADIntUserEnumerationAsOutsider -Method Normal
```
ä»¥ä¸‹ã¯**3ã¤ã®ç•°ãªã‚‹åˆ—æŒ™æ–¹æ³•**ã‹ã‚‰é¸æŠã§ãã¾ã™ï¼š

| æ–¹æ³•      | èª¬æ˜                                                                                                                                                                                             |
| --------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| é€šå¸¸      | ã“ã‚Œã¯ä¸Šè¨˜ã§è¨€åŠã•ã‚ŒãŸGetCredentialType APIã‚’æŒ‡ã—ã¾ã™ã€‚ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®æ–¹æ³•ã§ã™ã€‚                                                                                                                           |
| ãƒ­ã‚°ã‚¤ãƒ³   | <p>ã“ã®æ–¹æ³•ã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¨ã—ã¦ãƒ­ã‚°ã‚¤ãƒ³ã—ã‚ˆã†ã¨ã—ã¾ã™ã€‚<br><strong>æ³¨æ„:</strong> ã‚¯ã‚¨ãƒªã¯ã‚µã‚¤ãƒ³ã‚¤ãƒ³ãƒ­ã‚°ã«è¨˜éŒ²ã•ã‚Œã¾ã™ã€‚</p>                                                                                       |
| è‡ªå‹•ãƒ­ã‚°ã‚ªãƒ³ | <p>ã“ã®æ–¹æ³•ã¯è‡ªå‹•ãƒ­ã‚°ã‚ªãƒ³ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’ä»‹ã—ã¦ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¨ã—ã¦ãƒ­ã‚°ã‚¤ãƒ³ã—ã‚ˆã†ã¨ã—ã¾ã™ã€‚<br><strong>ã‚¯ã‚¨ãƒªã¯ã‚µã‚¤ãƒ³ã‚¤ãƒ³ãƒ­ã‚°ã«ã¯è¨˜éŒ²ã•ã‚Œã¾ã›ã‚“</strong>ï¼ãã®ãŸã‚ã€ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚¹ãƒ—ãƒ¬ãƒ¼ãŠã‚ˆã³ãƒ–ãƒ«ãƒ¼ãƒˆãƒ•ã‚©ãƒ¼ã‚¹æ”»æ’ƒã«ã‚‚é©ã—ã¦ã„ã¾ã™ã€‚</p> |

æœ‰åŠ¹ãªãƒ¦ãƒ¼ã‚¶ãƒ¼åã‚’ç™ºè¦‹ã—ãŸå¾Œã€**ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«é–¢ã™ã‚‹æƒ…å ±**ã‚’å–å¾—ã§ãã¾ã™ã€‚
```powershell
Get-AADIntLoginInformation -UserName root@corp.onmicrosoft.com
```
ã‚¹ã‚¯ãƒªãƒ—ãƒˆ[o365creeper](https://github.com/LMGsec/o365creeper)ã¯ã€**ãƒ¡ãƒ¼ãƒ«ãŒæœ‰åŠ¹ã‹ã©ã†ã‹**ã‚’ç‰¹å®šã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ã€‚
```powershell
# Put in emails.txt emails such as:
# - root@corp.onmicrosoft.com
python.exe .\o365creeper\o365creeper.py -f .\emails.txt -o validemails.txt
```
**Microsoft Teamsã‚’ä»‹ã—ãŸãƒ¦ãƒ¼ã‚¶ãƒ¼åˆ—æŒ™**

ã‚‚ã†1ã¤ã®æƒ…å ±æºã¯Microsoft Teamsã§ã™ã€‚

Microsoft Teamsã®APIã‚’ä½¿ç”¨ã™ã‚‹ã¨ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’æ¤œç´¢ã§ãã¾ã™ã€‚ç‰¹ã«ã€ã€Œexternalsearchv3ã€ã¨ã€ŒsearchUsersã€ã¨ã„ã†ã€Œãƒ¦ãƒ¼ã‚¶ãƒ¼æ¤œç´¢ã€ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’ä½¿ç”¨ã—ã¦ã€Teamsã«ç™»éŒ²ã•ã‚ŒãŸãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã«é–¢ã™ã‚‹ä¸€èˆ¬æƒ…å ±ã‚’ãƒªã‚¯ã‚¨ã‚¹ãƒˆã§ãã¾ã™ã€‚

APIã®å¿œç­”ã«å¿œã˜ã¦ã€å­˜åœ¨ã—ãªã„ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¨æœ‰åŠ¹ãªTeamsã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ã‚’æŒã¤æ—¢å­˜ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¨ã‚’åŒºåˆ¥ã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚

ã‚¹ã‚¯ãƒªãƒ—ãƒˆ[**TeamsEnum**](https://github.com/sse-secure-systems/TeamsEnum)ã‚’ä½¿ç”¨ã—ã¦ã€æŒ‡å®šã•ã‚ŒãŸãƒ¦ãƒ¼ã‚¶ãƒ¼åã®ã‚»ãƒƒãƒˆã‚’Teams APIã«å¯¾ã—ã¦æ¤œè¨¼ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
```bash
python3 TeamsEnum.py -a password -u <username> -f inputlist.txt -o teamsenum-output.json
```
## Unauthenticated Enumeration and Initial Entry

### Introduction

In this section, we will cover the techniques used to perform unauthenticated enumeration and gain initial access to Azure environments. Unauthenticated enumeration involves gathering information from publicly available sources without the need for valid credentials. This information can then be used to identify potential entry points into the target Azure environment.

### Tools and Techniques

#### Azure Resource Manager (ARM) APIs

Azure Resource Manager (ARM) APIs can be leveraged to gather information about Azure resources without authentication. By querying these APIs, an attacker can discover valuable information such as resource types, configurations, and dependencies.

#### DNS Enumeration

Performing DNS enumeration can provide insights into the Azure environment's infrastructure, including subdomains, IP addresses, and services in use. This information can be crucial for identifying potential targets for further exploitation.

#### Web Scraping

Web scraping techniques can be used to extract information from publicly accessible Azure web portals and applications. This information may include sensitive data or configuration details that can aid in gaining unauthorized access.

### Recommendations

To mitigate the risks associated with unauthenticated enumeration and initial entry, it is essential to follow these best practices:

- Implement strong access controls and authentication mechanisms to prevent unauthorized access to Azure resources.
- Regularly monitor and review publicly exposed information to identify and address any potential security vulnerabilities.
- Conduct regular security assessments and penetration testing to proactively identify and address security weaknesses in Azure environments.
```
[-] user1@domain - Target user not found. Either the user does not exist, is not Teams-enrolled or is configured to not appear in search results (personal accounts only)
[+] user2@domain - User2 | Company (Away, Mobile)
[+] user3@domain - User3 | Company (Available, Desktop)
```
ã•ã‚‰ã«ã€æ¬¡ã®ã‚ˆã†ãªæ—¢å­˜ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®åˆ©ç”¨çŠ¶æ³æƒ…å ±ã‚’åˆ—æŒ™ã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ï¼š

- åˆ©ç”¨å¯èƒ½
- é›¢å¸­ä¸­
- é‚ªé­”ã—ãªã„ã§
- äºˆå®šã‚ã‚Š
- ã‚ªãƒ•ãƒ©ã‚¤ãƒ³

**ã‚ªãƒ•ã‚£ã‚¹å¤–ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸**ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹å ´åˆã€TeamsEnumã‚’ä½¿ç”¨ã—ã¦ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å–å¾—ã™ã‚‹ã“ã¨ã‚‚å¯èƒ½ã§ã™ã€‚å‡ºåŠ›ãƒ•ã‚¡ã‚¤ãƒ«ãŒæŒ‡å®šã•ã‚Œã¦ã„ã‚‹å ´åˆã€ã‚ªãƒ•ã‚£ã‚¹å¤–ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¯è‡ªå‹•çš„ã«JSONãƒ•ã‚¡ã‚¤ãƒ«å†…ã«ä¿å­˜ã•ã‚Œã¾ã™ã€‚
```
jq . teamsenum-output.json
```
## Unauthenticated Enumeration and Initial Entry

### Introduction

In this section, we will cover the techniques used to perform unauthenticated enumeration and gain initial access to Azure environments. Unauthenticated enumeration involves gathering information from publicly available sources without the need for authentication. This information can then be used to identify potential entry points into the target Azure environment.

### Tools and Techniques

#### 1. **DNS Enumeration**

DNS enumeration can reveal valuable information about the target Azure environment, such as subdomains and associated IP addresses. Tools like `dnsrecon` and `dnsenum` can be used to perform DNS enumeration.

#### 2. **Subdomain Enumeration**

Subdomain enumeration involves identifying subdomains associated with the target Azure environment. Tools like `Sublist3r` and `Amass` can be used to discover subdomains.

#### 3. **Cloud Storage Enumeration**

Publicly accessible cloud storage buckets can sometimes reveal sensitive information. Tools like `Bucket Finder` and `CloudEnum` can be used to identify open storage buckets.

#### 4. **Service Enumeration**

Identifying exposed services in the Azure environment can provide insight into potential vulnerabilities. Tools like `Nmap` and `Masscan` can be used to scan for open ports and services.

### Initial Entry

Once potential entry points have been identified through unauthenticated enumeration, the next step is to attempt to gain initial access to the Azure environment. This can involve exploiting misconfigurations, weak credentials, or known vulnerabilities to establish a foothold in the target environment.
```json
{
"email": "user2@domain",
"exists": true,
"info": [
{
"tenantId": "[REDACTED]",
"isShortProfile": false,
"accountEnabled": true,
"featureSettings": {
"coExistenceMode": "TeamsOnly"
},
"userPrincipalName": "user2@domain",
"givenName": "user2@domain",
"surname": "",
"email": "user2@domain",
"tenantName": "Company",
"displayName": "User2",
"type": "Federated",
"mri": "8:orgid:[REDACTED]",
"objectId": "[REDACTED]"
}
],
"presence": [
{
"mri": "8:orgid:[REDACTED]",
"presence": {
"sourceNetwork": "Federated",
"calendarData": {
"outOfOfficeNote": {
"message": "Dear sender. I am out of the office until March 23rd with limited access to my email. I will respond after my return.Kind regards, User2",
"publishTime": "2023-03-15T21:44:42.0649385Z",
"expiry": "2023-04-05T14:00:00Z"
},
"isOutOfOffice": true
},
"capabilities": [
"Audio",
"Video"
],
"availability": "Away",
"activity": "Away",
"deviceType": "Mobile"
},
"etagMatch": false,
"etag": "[REDACTED]",
"status": 20000
}
]
}
```
## Azureã‚µãƒ¼ãƒ“ã‚¹

Azureãƒ†ãƒŠãƒ³ãƒˆãŒä½¿ç”¨ã—ã¦ã„ã‚‹**ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’çŸ¥ã£ã¦ã„ã‚‹**ã®ã§ã€**å…¬é–‹ã•ã‚Œã¦ã„ã‚‹Azureã‚µãƒ¼ãƒ“ã‚¹ã‚’è¦‹ã¤ã‘ã¦ã¿ã‚‹**æ™‚ãŒæ¥ã¾ã—ãŸã€‚

ã“ã®ç›®æ¨™ã‚’é”æˆã™ã‚‹ãŸã‚ã«ã€[**MicroBust**](https://github.com/NetSPI/MicroBurst)ã‹ã‚‰ã®ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä½¿ç”¨ã§ãã¾ã™ã€‚ã“ã®æ©Ÿèƒ½ã¯ã€ã„ãã¤ã‹ã®**Azureã‚µãƒ¼ãƒ“ã‚¹ãƒ‰ãƒ¡ã‚¤ãƒ³**ã§ãƒ™ãƒ¼ã‚¹ãƒ‰ãƒ¡ã‚¤ãƒ³åï¼ˆãŠã‚ˆã³ã„ãã¤ã‹ã®é †åˆ—ï¼‰ã‚’æ¤œç´¢ã—ã¾ã™ã€‚
```powershell
Import-Module .\MicroBurst\MicroBurst.psm1 -Verbose
Invoke-EnumerateAzureSubDomains -Base corp -Verbose
```
## ã‚ªãƒ¼ãƒ—ãƒ³ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸

[**InvokeEnumerateAzureBlobs.ps1**](https://github.com/NetSPI/MicroBurst/blob/master/Misc/Invoke-EnumerateAzureBlobs.ps1)ãªã©ã®ãƒ„ãƒ¼ãƒ«ã‚’ä½¿ç”¨ã—ã¦ã‚ªãƒ¼ãƒ—ãƒ³ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚’ç™ºè¦‹ã§ãã¾ã™ã€‚ã“ã®ãƒ„ãƒ¼ãƒ«ã¯ã€**`Microburst/Misc/permitations.txt`**ã¨ã„ã†ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½¿ç”¨ã—ã¦ãƒ‘ãƒ¼ãƒŸãƒ¥ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆéå¸¸ã«å˜ç´”ãªã‚‚ã®ï¼‰ã‚’ç”Ÿæˆã—ã€**ã‚ªãƒ¼ãƒ—ãƒ³ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’è¦‹ã¤ã‘ã‚ˆã†ã¨ã—ã¾ã™**ã€‚
```powershell
Import-Module .\MicroBurst\MicroBurst.psm1
Invoke-EnumerateAzureBlobs -Base corp
[...]
https://corpcommon.blob.core.windows.net/secrets?restype=container&comp=list
[...]

# Access https://corpcommon.blob.core.windows.net/secrets?restype=container&comp=list
# Check: <Name>ssh_info.json</Name>
# Access then https://corpcommon.blob.core.windows.net/secrets/ssh_info.json
```
### SAS URLs

_**å…±æœ‰ã‚¢ã‚¯ã‚»ã‚¹ç½²å**_ (SAS) URL ã¯ã€ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®ç‰¹å®šã®éƒ¨åˆ† (ãƒ•ãƒ«ã‚³ãƒ³ãƒ†ãƒŠã€ãƒ•ã‚¡ã‚¤ãƒ«ãªã©) ã«å¯¾ã™ã‚‹ã‚¢ã‚¯ã‚»ã‚¹æ¨©ã‚’æä¾›ã™ã‚‹ URL ã§ã‚ã‚Šã€ãƒªã‚½ãƒ¼ã‚¹ã«å¯¾ã™ã‚‹ç‰¹å®šã®æ¨©é™ (èª­ã¿å–ã‚Šã€æ›¸ãè¾¼ã¿ãªã©) ã‚’æŒã£ã¦ã„ã¾ã™ã€‚ã‚‚ã—æ¼æ´©ã—ã¦ã„ã‚‹ã‚‚ã®ã‚’è¦‹ã¤ã‘ãŸå ´åˆã€æ©Ÿå¯†æƒ…å ±ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚ä»¥ä¸‹ã¯ãã®ä¾‹ã§ã™ (ã“ã‚Œã¯ã‚³ãƒ³ãƒ†ãƒŠã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ãŸã‚ã®ã‚‚ã®ã§ã€ãƒ•ã‚¡ã‚¤ãƒ«ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹æ¨©ã‚’ä¸ãˆã‚‹å ´åˆã€URL ã®ãƒ‘ã‚¹ã«ã‚‚ãã®ãƒ•ã‚¡ã‚¤ãƒ«ãŒå«ã¾ã‚Œã¾ã™):

`https://<storage_account_name>.blob.core.windows.net/newcontainer?sp=r&st=2021-09-26T18:15:21Z&se=2021-10-27T02:14:21Z&spr=https&sv=2021-07-08&sr=c&sig=7S%2BZySOgy4aA3Dk0V1cJyTSIf1cW%2Fu3WFkhHV32%2B4PE%3D`

[**Storage Explorer**](https://azure.microsoft.com/en-us/features/storage-explorer/) ã‚’ä½¿ç”¨ã—ã¦ãƒ‡ãƒ¼ã‚¿ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¾ã™

## è³‡æ ¼æƒ…å ±ã®ä¾µå®³

### ãƒ•ã‚£ãƒƒã‚·ãƒ³ã‚°

* [**ä¸€èˆ¬çš„ãªãƒ•ã‚£ãƒƒã‚·ãƒ³ã‚°**](https://book.hacktricks.xyz/generic-methodologies-and-resources/phishing-methodology) (è³‡æ ¼æƒ…å ±ã¾ãŸã¯ OAuth ã‚¢ãƒ—ãƒª -[ä¸æ­£ãªåŒæ„ä»˜ä¸æ”»æ’ƒ](az-illicit-consent-grant.md)-)
* [**ãƒ‡ãƒã‚¤ã‚¹ã‚³ãƒ¼ãƒ‰èªè¨¼** ãƒ•ã‚£ãƒƒã‚·ãƒ³ã‚°](az-device-code-authentication-phishing.md)

### ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚¹ãƒ—ãƒ¬ãƒ¼ / ãƒ–ãƒ«ãƒ¼ãƒˆãƒ•ã‚©ãƒ¼ã‚¹

{% content-ref url="az-password-spraying.md" %}
[az-password-spraying.md](az-password-spraying.md)
{% endcontent-ref %}

## å‚è€ƒæ–‡çŒ®

* [https://aadinternals.com/post/just-looking/](https://aadinternals.com/post/just-looking/)
* [https://www.securesystems.de/blog/a-fresh-look-at-user-enumeration-in-microsoft-teams/](https://www.securesystems.de/blog/a-fresh-look-at-user-enumeration-in-microsoft-teams/)

{% hint style="success" %}
AWS ãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã³ã€å®Ÿè·µ:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCP ãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã³ã€å®Ÿè·µ: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks ã®ã‚µãƒãƒ¼ãƒˆ</summary>

* [**è³¼èª­ãƒ—ãƒ©ãƒ³**](https://github.com/sponsors/carlospolop) ã‚’ãƒã‚§ãƒƒã‚¯ï¼
* ğŸ’¬ [**Discord ã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f) ã«å‚åŠ ã™ã‚‹ã‹ã€[**telegram ã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass) ã«å‚åŠ ã™ã‚‹ã‹ã€**Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** ã‚’ãƒ•ã‚©ãƒ­ãƒ¼ã—ã¦ãã ã•ã„ã€‚**
* ãƒãƒƒã‚­ãƒ³ã‚°ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã™ã‚‹ãŸã‚ã«ã€[**HackTricks**](https://github.com/carlospolop/hacktricks) ã¨ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) ã® GitHub ãƒªãƒã‚¸ãƒˆãƒªã« PR ã‚’æå‡ºã—ã¦ãã ã•ã„ã€‚

</details>
{% endhint %}
