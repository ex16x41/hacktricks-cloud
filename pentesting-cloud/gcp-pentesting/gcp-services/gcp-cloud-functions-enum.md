# GCP - äº‘å‡½æ•°æšä¸¾

{% hint style="success" %}
å­¦ä¹ å¹¶ç»ƒä¹ AWSé»‘å®¢æŠ€æœ¯ï¼š<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricksåŸ¹è®­AWSçº¢é˜Ÿä¸“å®¶ï¼ˆARTEï¼‰**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
å­¦ä¹ å¹¶ç»ƒä¹ GCPé»‘å®¢æŠ€æœ¯ï¼š<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricksåŸ¹è®­GCPçº¢é˜Ÿä¸“å®¶ï¼ˆGRTEï¼‰**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>æ”¯æŒHackTricks</summary>

* æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**ç”µæŠ¥ç¾¤ç»„**](https://t.me/peass) æˆ– **å…³æ³¨**æˆ‘ä»¬çš„**Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* é€šè¿‡å‘[**HackTricks**](https://github.com/carlospolop/hacktricks)å’Œ[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) githubä»“åº“æäº¤PRæ¥åˆ†äº«é»‘å®¢æŠ€å·§ã€‚

</details>
{% endhint %}

## äº‘å‡½æ•° <a href="#reviewing-cloud-functions" id="reviewing-cloud-functions"></a>

[Google Cloud Functions](https://cloud.google.com/functions/)æ—¨åœ¨æ‰˜ç®¡æ‚¨çš„ä»£ç ï¼Œ**ä»¥å“åº”äº‹ä»¶æ‰§è¡Œ**ï¼Œæ— éœ€ç®¡ç†ä¸»æœºæ“ä½œç³»ç»Ÿã€‚æ­¤å¤–ï¼Œè¿™äº›å‡½æ•°æ”¯æŒå­˜å‚¨ç¯å¢ƒå˜é‡ï¼Œä¾›ä»£ç ä½¿ç”¨ã€‚

### å­˜å‚¨

äº‘å‡½æ•°çš„**ä»£ç å­˜å‚¨åœ¨GCPå­˜å‚¨ä¸­**ã€‚å› æ­¤ï¼Œä»»ä½•åœ¨GCPä¸Šå…·æœ‰**å­˜å‚¨æ¡¶è¯»å–æƒé™**çš„äººéƒ½å¯ä»¥**è¯»å–äº‘å‡½æ•°ä»£ç **ã€‚\
ä»£ç å­˜å‚¨åœ¨ç±»ä¼¼ä»¥ä¸‹çš„å­˜å‚¨æ¡¶ä¸­ï¼š

`gcf-sources-<number>-<region>/<function-name>-<uuid>/version-<n>/function-source.zip`\
ä¾‹å¦‚ï¼š\
`gcf-sources-645468741258-us-central1/function-1-003dcbdf-32e1-430f-a5ff-785a6e238c76/version-4/function-source.zip`

{% hint style="warning" %}
ä»»ä½•å…·æœ‰**å­˜å‚¨äº‘å‡½æ•°çš„å­˜å‚¨æ¡¶çš„å†™å…¥æƒé™**çš„ç”¨æˆ·éƒ½å¯ä»¥**è¦†ç›–æ‰§è¡Œçš„ä»£ç **ã€‚
{% endhint %}

### SA

å¦‚æœæœªæŒ‡å®šï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œ**å°†é™„åŠ App Engineé»˜è®¤æœåŠ¡å¸æˆ·**ï¼Œè¯¥å¸æˆ·å…·æœ‰å¯¹é¡¹ç›®çš„**ç¼–è¾‘æƒé™**ï¼Œåˆ°äº‘å‡½æ•°ã€‚

### è§¦å‘å™¨ã€URLå’Œèº«ä»½éªŒè¯

åˆ›å»ºäº‘å‡½æ•°æ—¶éœ€è¦æŒ‡å®š**è§¦å‘å™¨**ã€‚ä¸€ä¸ªå¸¸è§çš„è§¦å‘å™¨æ˜¯**HTTPS**ï¼Œè¿™å°†**åˆ›å»ºä¸€ä¸ªURLï¼Œé€šè¿‡Webæµè§ˆå™¨è§¦å‘å‡½æ•°**ã€‚\
å…¶ä»–è§¦å‘å™¨åŒ…æ‹¬pub/subã€Storageã€Filestore...

URLæ ¼å¼ä¸º**`https://<region>-<project-gcp-name>.cloudfunctions.net/<func_name>`**

å½“ä½¿ç”¨HTTPSè§¦å‘å™¨æ—¶ï¼Œè¿˜ä¼šæŒ‡ç¤º**è°ƒç”¨è€…æ˜¯å¦éœ€è¦å…·æœ‰IAMæˆæƒ**æ¥è°ƒç”¨å‡½æ•°ï¼Œæˆ–è€…**æ¯ä¸ªäºº**éƒ½å¯ä»¥è°ƒç”¨å®ƒï¼š

<figure><img src="../../../.gitbook/assets/image (3) (1) (1).png" alt=""><figcaption></figcaption></figure>

### äº‘å‡½æ•°å†…éƒ¨

ä»£ç **ä¸‹è½½åˆ°**æ–‡ä»¶å¤¹**`/workspace`**ä¸­ï¼Œæ–‡ä»¶åä¸äº‘å‡½æ•°ä¸­çš„æ–‡ä»¶åç›¸åŒï¼Œå¹¶ä½¿ç”¨ç”¨æˆ·`www-data`æ‰§è¡Œã€‚\
ç£ç›˜**æœªæŒ‚è½½ä¸ºåªè¯»ã€‚**

### æšä¸¾
```bash
# List functions
gcloud functions list
gcloud functions describe <func_name> # Check triggers to see how is this function invoked
gcloud functions get-iam-policy <func_name>

# Get logs of previous runs. By default, limits to 10 lines
gcloud functions logs read <func_name> --limit [NUMBER]

# Call a function
curl https://<region>-<project>.cloudfunctions.net/<func_name>
gcloud functions call <func_name> --data='{"message": "Hello World!"}'

# If you know the name of projects you could try to BF cloud functions names

# Get events that could be used to trigger a cloud function
gcloud functions event-types list

# Access function with authentication
curl -X POST https://<region>-<project>.cloudfunctions.net/<func_name> \
-H "Authorization: bearer $(gcloud auth print-identity-token)" \
-H "Content-Type: application/json" \
-d '{}'
```
### ææƒ

åœ¨ä»¥ä¸‹é¡µé¢ä¸­ï¼Œæ‚¨å¯ä»¥æŸ¥çœ‹å¦‚ä½•**æ»¥ç”¨äº‘å‡½æ•°æƒé™ä»¥æå‡ç‰¹æƒ**ï¼š

{% content-ref url="../../gcp-security/gcp-privilege-escalation/gcp-cloudfunctions-privesc.md" %}
[gcp-cloudfunctions-privesc.md](../../gcp-security/gcp-privilege-escalation/gcp-cloudfunctions-privesc.md)
{% endcontent-ref %}

### æœªç»èº«ä»½éªŒè¯çš„è®¿é—®

{% content-ref url="../../gcp-security/gcp-unaunthenticated-enum-and-access/gcp-cloud-functions-unauthenticated-enum.md" %}
[gcp-cloud-functions-unauthenticated-enum.md](../../gcp-security/gcp-unaunthenticated-enum-and-access/gcp-cloud-functions-unauthenticated-enum.md)
{% endcontent-ref %}

### åæ¸—é€

{% content-ref url="../../gcp-security/gcp-post-exploitation/gcp-cloud-functions-post-exploitation.md" %}
[gcp-cloud-functions-post-exploitation.md](../../gcp-security/gcp-post-exploitation/gcp-cloud-functions-post-exploitation.md)
{% endcontent-ref %}

### æŒä¹…æ€§

{% content-ref url="../../gcp-security/gcp-persistence/gcp-cloud-functions-persistence.md" %}
[gcp-cloud-functions-persistence.md](../../gcp-security/gcp-persistence/gcp-cloud-functions-persistence.md)
{% endcontent-ref %}

## å‚è€ƒèµ„æ–™

* [https://about.gitlab.com/blog/2020/02/12/plundering-gcp-escalating-privileges-in-google-cloud-platform/#reviewing-stackdriver-logging](https://about.gitlab.com/blog/2020/02/12/plundering-gcp-escalating-privileges-in-google-cloud-platform/#reviewing-stackdriver-logging)

{% hint style="success" %}
å­¦ä¹ å¹¶ç»ƒä¹  AWS é»‘å®¢æŠ€æœ¯ï¼š<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks åŸ¹è®­ AWS çº¢é˜Ÿä¸“å®¶ (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
å­¦ä¹ å¹¶ç»ƒä¹  GCP é»‘å®¢æŠ€æœ¯ï¼š<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks åŸ¹è®­ GCP çº¢é˜Ÿä¸“å®¶ (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>æ”¯æŒ HackTricks</summary>

* æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**ç”µæŠ¥ç¾¤ç»„**](https://t.me/peass) æˆ– **å…³æ³¨**æˆ‘ä»¬çš„ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* é€šè¿‡å‘ [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ä»“åº“æäº¤ PR æ¥åˆ†äº«é»‘å®¢æŠ€å·§ã€‚

</details>
{% endhint %}
