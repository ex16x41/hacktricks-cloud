# GCP - Cloud Run æšä¸¾

{% hint style="success" %}
å­¦ä¹ å¹¶ç»ƒä¹  AWS é»‘å®¢æŠ€æœ¯ï¼š<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks åŸ¹è®­ AWS çº¢é˜Ÿä¸“å®¶ (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
å­¦ä¹ å¹¶ç»ƒä¹  GCP é»‘å®¢æŠ€æœ¯ï¼š<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks åŸ¹è®­ GCP çº¢é˜Ÿä¸“å®¶ (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>æ”¯æŒ HackTricks</summary>

* æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**ç”µæŠ¥ç¾¤ç»„**](https://t.me/peass) æˆ– **å…³æ³¨**æˆ‘ä»¬çš„ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* é€šè¿‡å‘ [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github ä»“åº“æäº¤ PR æ¥åˆ†äº«é»‘å®¢æŠ€å·§ã€‚

</details>
{% endhint %}

## Cloud Run <a href="#reviewing-cloud-run-configurations" id="reviewing-cloud-run-configurations"></a>

Cloud Run æ˜¯ä¸€ä¸ªæ— æœåŠ¡å™¨æ‰˜ç®¡è®¡ç®—å¹³å°ï¼Œå…è®¸æ‚¨ç›´æ¥åœ¨ Google çš„å¯æ‰©å±•åŸºç¡€è®¾æ–½ä¸Šè¿è¡Œå®¹å™¨ã€‚

æ‚¨å¯ä»¥è¿è¡Œæ‚¨çš„å®¹å™¨ï¼Œæˆ–è€…å¦‚æœæ‚¨ä½¿ç”¨ Goã€Node.jsã€Pythonã€Javaã€.NET Core æˆ– Rubyï¼Œæ‚¨å¯ä»¥ä½¿ç”¨[åŸºäºæºä»£ç éƒ¨ç½²](https://cloud.google.com/run/docs/deploying-source-code)é€‰é¡¹ï¼Œè¯¥é€‰é¡¹ä¼šä¸ºæ‚¨**æ„å»ºå®¹å™¨**ã€‚

Google å·²ç»æ„å»ºäº† Cloud Runï¼Œä»¥ä¾¿ä¸ Google Cloud ä¸Šçš„å…¶ä»–æœåŠ¡**è‰¯å¥½é…åˆ**ï¼Œå› æ­¤æ‚¨å¯ä»¥æ„å»ºåŠŸèƒ½é½å…¨çš„åº”ç”¨ç¨‹åºã€‚

### æœåŠ¡å’Œä½œä¸š <a href="#services-and-jobs" id="services-and-jobs"></a>

åœ¨ Cloud Run ä¸Šï¼Œæ‚¨çš„ä»£ç å¯ä»¥ä½œä¸º**æœåŠ¡**æˆ–**ä½œä¸š**è¿ç»­è¿è¡Œã€‚æœåŠ¡å’Œä½œä¸šéƒ½åœ¨ç›¸åŒçš„ç¯å¢ƒä¸­è¿è¡Œï¼Œå¹¶ä¸”å¯ä»¥ä¸ Google Cloud ä¸Šçš„å…¶ä»–æœåŠ¡è¿›è¡Œç›¸åŒçš„é›†æˆã€‚

* **Cloud Run æœåŠ¡ã€‚** ç”¨äºè¿è¡Œå“åº” web è¯·æ±‚æˆ–äº‹ä»¶çš„ä»£ç ã€‚
* **Cloud Run ä½œä¸šã€‚** ç”¨äºè¿è¡Œæ‰§è¡Œå·¥ä½œï¼ˆä½œä¸šï¼‰å¹¶åœ¨å·¥ä½œå®Œæˆæ—¶é€€å‡ºçš„ä»£ç ã€‚

## Cloud Run æœåŠ¡

Google [Cloud Run](https://cloud.google.com/run) æ˜¯å¦ä¸€ä¸ªæ— æœåŠ¡å™¨æä¾›ï¼Œæ‚¨å¯ä»¥åœ¨å…¶ä¸­æœç´¢ç¯å¢ƒå˜é‡ã€‚Cloud Run åˆ›å»ºä¸€ä¸ªå°å‹ Web æœåŠ¡å™¨ï¼Œé»˜è®¤æƒ…å†µä¸‹åœ¨å®¹å™¨å†…çš„ç«¯å£ 8080 ä¸Šè¿è¡Œï¼Œç­‰å¾… HTTP GET è¯·æ±‚ã€‚å½“æ”¶åˆ°è¯·æ±‚æ—¶ï¼Œä¼šæ‰§è¡Œä½œä¸šï¼Œå¹¶é€šè¿‡ HTTP å“åº”è¾“å‡ºä½œä¸šæ—¥å¿—ã€‚

### ç›¸å…³ç»†èŠ‚

* **é»˜è®¤æƒ…å†µä¸‹**ï¼Œå¯¹ Web æœåŠ¡å™¨çš„**è®¿é—®**æ˜¯**å…¬å¼€**çš„ï¼Œä½†ä¹Ÿå¯ä»¥**é™åˆ¶ä¸ºå†…éƒ¨æµé‡**ï¼ˆVPC...ï¼‰\
æ­¤å¤–ï¼Œè”ç³» Web æœåŠ¡å™¨çš„**èº«ä»½éªŒè¯**å¯ä»¥æ˜¯**å…è®¸æ‰€æœ‰**æˆ–**éœ€è¦é€šè¿‡ IAM è¿›è¡Œèº«ä»½éªŒè¯**ã€‚
* é»˜è®¤æƒ…å†µä¸‹ï¼Œ**åŠ å¯†**ä½¿ç”¨**Google ç®¡ç†çš„å¯†é’¥**ï¼Œä½†ä¹Ÿå¯ä»¥é€‰æ‹©æ¥è‡ª **KMS** çš„ **CMEK**ï¼ˆå®¢æˆ·ç®¡ç†çš„åŠ å¯†å¯†é’¥ï¼‰ã€‚
* é»˜è®¤æƒ…å†µä¸‹ï¼Œä½¿ç”¨çš„**æœåŠ¡å¸å·**æ˜¯å…·æœ‰å¯¹é¡¹ç›®çš„**ç¼–è¾‘å™¨**è®¿é—®æƒé™å¹¶å…·æœ‰**`cloud-platform`**èŒƒå›´çš„**Compute Engine é»˜è®¤å¸å·**ã€‚
* å¯ä»¥ä¸ºæ‰§è¡Œå®šä¹‰**æ˜æ–‡ç¯å¢ƒå˜é‡**ï¼Œç”šè‡³**æŒ‚è½½äº‘ç§˜å¯†**æˆ–**å°†äº‘ç§˜å¯†æ·»åŠ åˆ°ç¯å¢ƒå˜é‡**ã€‚
* è¿˜å¯ä»¥**ä¸ Cloud SQL å»ºç«‹è¿æ¥**å’Œ**æŒ‚è½½æ–‡ä»¶ç³»ç»Ÿ**ã€‚
* éƒ¨ç½²çš„æœåŠ¡çš„**URL**ç±»ä¼¼äº**`https://<svc-name>-<random>.a.run.app`**
* Run æœåŠ¡å¯ä»¥æœ‰**å¤šä¸ªç‰ˆæœ¬æˆ–ä¿®è®¢ç‰ˆ**ï¼Œå¹¶ä¸”å¯ä»¥åœ¨å¤šä¸ªä¿®è®¢ç‰ˆä¹‹é—´**åˆ†é…æµé‡**ã€‚

### æšä¸¾
```bash
# List services
gcloud run services list
gcloud run services list --platform=managed
gcloud run services list --platform=gke

# Get info of a service
gcloud run services describe --region <region> <svc-name>

# Get info of all the services together
gcloud run services list --format=yaml
gcloud run services list --platform=managed --format=json
gcloud run services list --platform=gke --format=json

# Get policy
gcloud run services get-iam-policy --region <region> <svc-name>

# Get revisions
gcloud run revisions list --region <region>
gcloud run revisions describe --region <region> <revision>

# Get domains
gcloud run domain-mappings list
gcloud run domain-mappings describe <name>

# Attempt to trigger a job unauthenticated
curl <url>

# Attempt to trigger a job with your current gcloud authorization
curl -H "Authorization: Bearer $(gcloud auth print-identity-token)" <url>
```
## Cloud Run ä½œä¸š

Cloud Run ä½œä¸šæ›´é€‚åˆäº**è¿è¡Œå®Œæ¯•ä¸”ä¸æä¾›è¯·æ±‚æœåŠ¡çš„å®¹å™¨**ã€‚ä½œä¸šæ— æ³•æä¾›è¯·æ±‚æœåŠ¡æˆ–ç›‘å¬ç«¯å£ã€‚è¿™æ„å‘³ç€ä¸ Cloud Run æœåŠ¡ä¸åŒï¼Œä½œä¸šä¸åº”è¯¥æ†ç»‘ç½‘ç»œæœåŠ¡å™¨ã€‚ç›¸åï¼Œä½œä¸šå®¹å™¨åº”åœ¨å®Œæˆä»»åŠ¡åé€€å‡ºã€‚

### æšä¸¾
```bash
gcloud beta run jobs list
gcloud beta run jobs describe --region <region> <job-name>
gcloud beta run jobs get-iam-policy --region <region> <job-name>
```
## ææƒ

åœ¨ä»¥ä¸‹é¡µé¢ä¸­ï¼Œæ‚¨å¯ä»¥æŸ¥çœ‹å¦‚ä½•**æ»¥ç”¨äº‘è¿è¡Œæƒé™ä»¥æå‡ç‰¹æƒ**ï¼š

{% content-ref url="../../gcp-security/gcp-privilege-escalation/gcp-run-privesc.md" %}
[gcp-run-privesc.md](../../gcp-security/gcp-privilege-escalation/gcp-run-privesc.md)
{% endcontent-ref %}

## æœªç»èº«ä»½éªŒè¯è®¿é—®

{% content-ref url="../../gcp-security/gcp-unaunthenticated-enum-and-access/gcp-cloud-run-unauthenticated-enum.md" %}
[gcp-cloud-run-unauthenticated-enum.md](../../gcp-security/gcp-unaunthenticated-enum-and-access/gcp-cloud-run-unauthenticated-enum.md)
{% endcontent-ref %}

## åæ¸—é€

{% content-ref url="../../gcp-security/gcp-post-exploitation/gcp-cloud-run-post-exploitation.md" %}
[gcp-cloud-run-post-exploitation.md](../../gcp-security/gcp-post-exploitation/gcp-cloud-run-post-exploitation.md)
{% endcontent-ref %}

## æŒä¹…æ€§

{% content-ref url="../../gcp-security/gcp-persistence/gcp-cloud-run-persistence.md" %}
[gcp-cloud-run-persistence.md](../../gcp-security/gcp-persistence/gcp-cloud-run-persistence.md)
{% endcontent-ref %}

## å‚è€ƒ

* [https://cloud.google.com/run/docs/overview/what-is-cloud-run](https://cloud.google.com/run/docs/overview/what-is-cloud-run)

{% hint style="success" %}
å­¦ä¹ å¹¶ç»ƒä¹ AWSé»‘å®¢æŠ€æœ¯ï¼š<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricksåŸ¹è®­AWSçº¢é˜Ÿä¸“å®¶ï¼ˆARTEï¼‰**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
å­¦ä¹ å¹¶ç»ƒä¹ GCPé»‘å®¢æŠ€æœ¯ï¼š<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricksåŸ¹è®­GCPçº¢é˜Ÿä¸“å®¶ï¼ˆGRTEï¼‰**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>æ”¯æŒHackTricks</summary>

* æŸ¥çœ‹[**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* **åŠ å…¥** ğŸ’¬ [**Discordç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**ç”µæŠ¥ç¾¤ç»„**](https://t.me/peass) æˆ– **å…³æ³¨**æˆ‘ä»¬çš„**Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* é€šè¿‡å‘[**HackTricks**](https://github.com/carlospolop/hacktricks)å’Œ[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) githubä»“åº“æäº¤PRæ¥åˆ†äº«é»‘å®¢æŠ€å·§ã€‚

</details>
{% endhint %}
