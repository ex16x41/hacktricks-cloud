# GCP - Cloud Run Enum

{% hint style="success" %}
Ucz si i praktykuj Hacking AWS:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Ucz si i praktykuj Hacking GCP: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Wesprzyj HackTricks</summary>

* Sprawd藕 [**plany subskrypcyjne**](https://github.com/sponsors/carlospolop)!
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **led藕** nas na **Twitterze**  [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Dziel si trikami hakerskimi, przesyajc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Cloud Run <a href="#reviewing-cloud-run-configurations" id="reviewing-cloud-run-configurations"></a>

Cloud Run to zarzdzana platforma obliczeniowa typu serverless, kt贸ra pozwala **uruchamia kontenery** bezporednio na skalowalnej infrastrukturze Google.

Mo偶esz uruchamia sw贸j kontener lub jeli korzystasz z Go, Node.js, Python, Java, .NET Core lub Ruby, mo偶esz skorzysta z opcji [wdro偶enia opartego na 藕r贸dle](https://cloud.google.com/run/docs/deploying-source-code), kt贸ra **buduje kontener za Ciebie.**

Google stworzy Cloud Run tak, aby **dobrze wsp贸pracowa z innymi usugami w Google Cloud**, dziki czemu mo偶esz budowa penowymiarowe aplikacje.

### Usugi i zadania <a href="#services-and-jobs" id="services-and-jobs"></a>

Na Cloud Run, Tw贸j kod mo偶e dziaa albo cigle jako _**usuga**_, albo jako _**zadanie**_. Zar贸wno usugi, jak i zadania dziaaj w tym samym rodowisku i mog korzysta z tych samych integracji z innymi usugami w Google Cloud.

* **Usugi Cloud Run.** Su偶 do uruchamiania kodu reagujcego na 偶dania sieciowe lub zdarzenia.
* **Zadania Cloud Run.** Su偶 do uruchamiania kodu wykonujcego prac (zadanie) i kocz si po zakoczeniu pracy.

## Usuga Cloud Run

Google [Cloud Run](https://cloud.google.com/run) to kolejna oferowana usuga typu serverless, w kt贸rej mo偶na szuka zmiennych rodowiskowych. Cloud Run tworzy may serwer WWW, domylnie dziaajcy na porcie 8080 wewntrz kontenera, kt贸ry czeka na 偶danie HTTP GET. Gdy 偶danie zostanie odebrane, uruchamiane jest zadanie, a dziennik zadania jest wyprowadzany poprzez odpowied藕 HTTP.

### Istotne szczeg贸y

* Domylnie **dostp** do serwera WWW jest **publiczny**, ale mo偶na go r贸wnie偶 **ograniczy do ruchu wewntrznego** (VPC...)\
Ponadto **uwierzytelnienie** w celu skontaktowania si z serwerem WWW mo偶e by **zezwala na wszystkich** lub **wymaga uwierzytelnienia za pomoc IAM**.
* Domylnie **szyfrowanie** korzysta z **zarzdzanego przez Google klucza**, ale mo偶na r贸wnie偶 wybra **CMEK** (Customer Managed Encryption Key) z **KMS**.
* Domylnie u偶ywane jest **konto usugi** Compute Engine domylne, kt贸re ma dostp **Edytora** do projektu i ma zakres `cloud-platform`.
* Mo偶na zdefiniowa **zmienne rodowiskowe w postaci tekstu jawnego** dla wykonania, a nawet **zamontowa tajne klucze chmury** lub **doda tajne klucze chmury do zmiennych rodowiskowych.**
* Mo偶liwe jest r贸wnie偶 **dodanie pocze z Cloud SQL** i **zamontowanie systemu plik贸w.**
* **Adresy URL** wdro偶onych usug s podobne do **`https://<nazwa-usugi>-<losowy>.a.run.app`**
* Usuga Run mo偶e mie **wicej ni偶 1 wersj lub rewizj**, i **rozdziela ruch** midzy kilkoma rewizjami.

### Wyliczenie
```bash
# List services
gcloud run services list
gcloud run services list --platform=managed
gcloud run services list --platform=gke

# Get info of a service
gcloud run services describe --region <region> <svc-name>

# Get info of all the services together
gcloud run services list --format=yaml
gcloud run services list --platform=managed --format=json
gcloud run services list --platform=gke --format=json

# Get policy
gcloud run services get-iam-policy --region <region> <svc-name>

# Get revisions
gcloud run revisions list --region <region>
gcloud run revisions describe --region <region> <revision>

# Get domains
gcloud run domain-mappings list
gcloud run domain-mappings describe <name>

# Attempt to trigger a job unauthenticated
curl <url>

# Attempt to trigger a job with your current gcloud authorization
curl -H "Authorization: Bearer $(gcloud auth print-identity-token)" <url>
```
## Zadania Cloud Run

Zadania Cloud Run s lepszym rozwizaniem dla **kontener贸w, kt贸re dziaaj do zakoczenia i nie obsuguj 偶da**. Zadania nie maj mo偶liwoci obsugi 偶da ani nasuchiwania na porcie. Oznacza to, 偶e w przeciwiestwie do usug Cloud Run, zadania nie powinny zawiera serwera sieciowego. Zamiast tego kontenery z zadaniami powinny zakoczy dziaanie po zakoczeniu pracy.

### Wyliczanie
```bash
gcloud beta run jobs list
gcloud beta run jobs describe --region <region> <job-name>
gcloud beta run jobs get-iam-policy --region <region> <job-name>
```
## Eskalacja uprawnie

Na nastpnej stronie mo偶esz sprawdzi, jak **nadu偶y uprawnienia chmury Run do eskalacji uprawnie**:

{% content-ref url="../../gcp-security/gcp-privilege-escalation/gcp-run-privesc.md" %}
[gcp-run-privesc.md](../../gcp-security/gcp-privilege-escalation/gcp-run-privesc.md)
{% endcontent-ref %}

## Nieuwierzytelniony dostp

{% content-ref url="../../gcp-security/gcp-unaunthenticated-enum-and-access/gcp-cloud-run-unauthenticated-enum.md" %}
[gcp-cloud-run-unauthenticated-enum.md](../../gcp-security/gcp-unaunthenticated-enum-and-access/gcp-cloud-run-unauthenticated-enum.md)
{% endcontent-ref %}

## Po wykorzystaniu

{% content-ref url="../../gcp-security/gcp-post-exploitation/gcp-cloud-run-post-exploitation.md" %}
[gcp-cloud-run-post-exploitation.md](../../gcp-security/gcp-post-exploitation/gcp-cloud-run-post-exploitation.md)
{% endcontent-ref %}

## Trwao

{% content-ref url="../../gcp-security/gcp-persistence/gcp-cloud-run-persistence.md" %}
[gcp-cloud-run-persistence.md](../../gcp-security/gcp-persistence/gcp-cloud-run-persistence.md)
{% endcontent-ref %}

## Odnoniki

* [https://cloud.google.com/run/docs/overview/what-is-cloud-run](https://cloud.google.com/run/docs/overview/what-is-cloud-run)
