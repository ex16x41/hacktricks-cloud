# GCP - RaÄunarski instanci

{% hint style="success" %}
NauÄite i veÅ¾bajte hakovanje AWS-a:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Obuka AWS Crveni Tim StruÄnjak (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
NauÄite i veÅ¾bajte hakovanje GCP-a: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Obuka GCP Crveni Tim StruÄnjak (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>PodrÅ¾ite HackTricks</summary>

* Proverite [**planove pretplate**](https://github.com/sponsors/carlospolop)!
* **PridruÅ¾ite se** ğŸ’¬ [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitteru** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podelite hakovanje trikova slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
{% endhint %}

## Osnovne informacije

Google Cloud raÄunarske instance su **prilagodljive virtuelne maÅ¡ine na Google-ovoj cloud infrastrukturi**, koje pruÅ¾aju skalabilnu i na zahtev raÄunarsku snagu za Å¡irok spektar aplikacija. PruÅ¾aju moguÄ‡nosti kao Å¡to su globalno razmeÅ¡tanje, trajno skladiÅ¡tenje, fleksibilan izbor operativnih sistema i snaÅ¾ne integracije mreÅ¾e i sigurnosti, ÄineÄ‡i ih svestranim izborom za hostovanje veb sajtova, obradu podataka i efikasno pokretanje aplikacija u oblaku.

### Poverljiva VM

Poverljive VM koriste **bezbednosne funkcije zasnovane na hardveru** koje nude najnovije generacije AMD EPYC procesora, ukljuÄujuÄ‡i enkripciju memorije i sigurnu enkriptovanu virtualizaciju. Ove funkcije omoguÄ‡avaju VM-u da zaÅ¡titi podatke koji se obraÄ‘uju i skladiÅ¡te unutar njega Äak i od operativnog sistema domaÄ‡ina i hipervizora.

Za pokretanje Poverljive VM moÅ¾e biti potrebno **promeniti** stvari poput **tipa** maÅ¡ine, mreÅ¾nog **interfejsa**, **slike pokretnog diska**.

### Disk i enkripcija diska

MoguÄ‡e je **izabrati disk** koji Ä‡e se koristiti ili **napraviti novi**. Ako izaberete novi, moÅ¾ete:

* Izabrati **veliÄinu** diska
* Izabrati **OS**
* OznaÄiti da li Å¾elite **obrisati disk kada se instanca obriÅ¡e**
* **Enkripcija**: Podrazumevano Ä‡e se koristiti **Google upravljani kljuÄ**, ali moÅ¾ete takoÄ‘e **izabrati kljuÄ iz KMS-a** ili naznaÄiti **sirovi kljuÄ za koriÅ¡Ä‡enje**.

### Implementacija kontejnera

MoguÄ‡e je implementirati **kontejner** unutar virtuelne maÅ¡ine.\
MoguÄ‡e je konfigurisati **sliku** za koriÅ¡Ä‡enje, postaviti **komandu** za pokretanje unutar, **argumente**, montirati **volume** i **env promenljive** (osetljive informacije?) i konfigurisati nekoliko opcija za ovaj kontejner kao izvrÅ¡avanje kao **privilegovani**, stdin i pseudo TTY.

### Servisni nalog

Podrazumevano Ä‡e se koristiti **Servisni nalog podrazumevane Compute Engine**. Email ovog SN je poput: `<proj-br>-compute@developer.gserviceaccount.com`\
Ovaj servisni nalog ima **UredniÄku ulogu nad celim projektom (visoki privilegije).**

I **podrazumevani pristupni opsezi** su sledeÄ‡i:

* **https://www.googleapis.com/auth/devstorage.read\_only** -- Pristup za Äitanje kofa :)
* https://www.googleapis.com/auth/logging.write
* https://www.googleapis.com/auth/monitoring.write
* https://www.googleapis.com/auth/servicecontrol
* https://www.googleapis.com/auth/service.management.readonly
* https://www.googleapis.com/auth/trace.append

MeÄ‘utim, moguÄ‡e je **dodeliti mu `cloud-platform` jednim klikom** ili specificirati **prilagoÄ‘ene**.

<figure><img src="../../../../.gitbook/assets/image (138).png" alt=""><figcaption></figcaption></figure>

### Firewall

MoguÄ‡e je dozvoliti HTTP i HTTPS saobraÄ‡aj.

<figure><img src="../../../../.gitbook/assets/image (137).png" alt=""><figcaption></figcaption></figure>

### MreÅ¾a

* **ProsleÄ‘ivanje IP adrese**: MoguÄ‡e je **omoguÄ‡iti prosleÄ‘ivanje IP adrese** prilikom kreiranja instance.
* **Hostname**: MoguÄ‡e je dati instanci stalni hostname.
* **Interfejs**: MoguÄ‡e je dodati mreÅ¾ni interfejs

### Dodatna sigurnost

Ove opcije Ä‡e **poveÄ‡ati sigurnost** VM-a i preporuÄuju se:

* **Sigurno podizanje sistema:** Sigurno podizanje sistema pomaÅ¾e u zaÅ¡titi vaÅ¡ih VM instanci od malvera na nivou podizanja sistema i jezgra.
* **OmoguÄ‡i vTPM:** Virtuelni povereni platformski modul (vTPM) validira pre-boot i boot integritet vaÅ¡e gostujuÄ‡e VM i nudi generisanje i zaÅ¡titu kljuÄeva.
* **Nadzor integriteta:** Nadzor integriteta omoguÄ‡ava vam praÄ‡enje i proveru integriteta pokretanja vaÅ¡ih zaÅ¡tiÄ‡enih VM instanci koristeÄ‡i izveÅ¡taje Stackdriver-a. Zahteva omoguÄ‡en vTPM.

### Pristup VM-u

UobiÄajeni naÄin omoguÄ‡avanja pristupa VM-u je **dozvoljavanje odreÄ‘enih SSH javnih kljuÄeva** za pristup VM-u.\
MeÄ‘utim, moguÄ‡e je takoÄ‘e **omoguÄ‡iti pristup VM-u putem `os-config` servisa koriÅ¡Ä‡enjem IAM-a**. TakoÄ‘e, moguÄ‡e je omoguÄ‡iti 2FA za pristup VM-u koriÅ¡Ä‡enjem ovog servisa.\
Kada je ovaj **servis** **omoguÄ‡en**, pristup putem **SSH kljuÄeva je onemoguÄ‡en.**

<figure><img src="../../../../.gitbook/assets/image (139).png" alt=""><figcaption></figcaption></figure>

### Metapodaci

MoguÄ‡e je definisati **automatizaciju** (userdata u AWS) koja su **shell komande** koje Ä‡e se izvrÅ¡iti svaki put kada se maÅ¡ina ukljuÄi ili restartuje.

TakoÄ‘e je moguÄ‡e **dodati dodatne metapodatke kljuÄ-vrednost** koji Ä‡e biti dostupni sa metapodataka endpointa. Ove informacije se obiÄno koriste za promenljive okruÅ¾enja i skripte za pokretanje/zaustavljanje. Ovo se moÅ¾e dobiti koriÅ¡Ä‡enjem **`describe` metode** iz komande u delu za enumeraciju, ali se takoÄ‘e moÅ¾e dobiti iznutra instance pristupajuÄ‡i metapodataka endpointu.
```bash
# view project metadata
curl "http://metadata.google.internal/computeMetadata/v1/project/attributes/?recursive=true&alt=text" \
-H "Metadata-Flavor: Google"

# view instance metadata
curl "http://metadata.google.internal/computeMetadata/v1/instance/attributes/?recursive=true&alt=text" \
-H "Metadata-Flavor: Google"
```
Osim toga, **autentiÄni token za pridruÅ¾eni servisni nalog** i **opÅ¡te informacije** o instanci, mreÅ¾i i projektu takoÄ‘e Ä‡e biti dostupne sa **metadata endpointa**. Za viÅ¡e informacija pogledajte:

{% embed url="https://book.hacktricks.xyz/pentesting-web/ssrf-server-side-request-forgery/cloud-ssrf#6440" %}

### Å ifrovanje

Podrazumevani kljuÄ za Å¡ifrovanje upravlja Google-om, ali korisniÄki upravljani kljuÄ za Å¡ifrovanje (CMEK) moÅ¾e biti konfigurisan. TakoÄ‘e moÅ¾ete konfigurisati Å¡ta uraditi kada se koriÅ¡Ä‡eni CMEF povuÄe: NiÅ¡ta ili iskljuÄiti virtuelnu maÅ¡inu.

<figure><img src="../../../../.gitbook/assets/image (140).png" alt=""><figcaption></figcaption></figure>

{% hint style="success" %}
NauÄite i veÅ¾bajte hakovanje AWS-a:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
NauÄite i veÅ¾bajte hakovanje GCP-a: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>PodrÅ¾ite HackTricks</summary>

* Proverite [**planove pretplate**](https://github.com/sponsors/carlospolop)!
* **PridruÅ¾ite se** ğŸ’¬ [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitteru** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podelite hakovanje trikova slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
{% endhint %}
