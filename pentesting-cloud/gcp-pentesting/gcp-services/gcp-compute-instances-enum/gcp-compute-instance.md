# GCP - Instancias de C贸mputo

{% hint style="success" %}
Aprende y practica Hacking en AWS:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Aprende y practica Hacking en GCP: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Apoya a HackTricks</summary>

* 隆Revisa los [**planes de suscripci贸n**](https://github.com/sponsors/carlospolop)!
* **nete al**  [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s铆guenos** en **Twitter**  [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Comparte trucos de hacking enviando PRs a los** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repositorios de github.

</details>
{% endhint %}

## Informaci贸n B谩sica

Las Instancias de C贸mputo de Google Cloud son **m谩quinas virtuales personalizables en la infraestructura en la nube de Google**, que ofrecen potencia de c贸mputo escalable y bajo demanda para una amplia gama de aplicaciones. Proporcionan caracter铆sticas como implementaci贸n global, almacenamiento persistente, opciones flexibles de sistema operativo e integraciones s贸lidas de redes y seguridad, lo que las convierte en una opci贸n vers谩til para alojar sitios web, procesar datos y ejecutar aplicaciones de manera eficiente en la nube.

### VM Confidencial

Las VM Confidenciales utilizan **caracter铆sticas de seguridad basadas en hardware** ofrecidas por la 煤ltima generaci贸n de procesadores AMD EPYC, que incluyen cifrado de memoria y virtualizaci贸n cifrada segura. Estas caracter铆sticas permiten que la VM proteja los datos procesados y almacenados en ella incluso del sistema operativo host y del hipervisor.

Para ejecutar una VM Confidencial, es posible que sea necesario **cambiar** cosas como el **tipo** de la **m谩quina**, la **interfaz de red**, la **imagen del disco de arranque**.

### Disco y Cifrado de Disco

Es posible **seleccionar el disco** a utilizar o **crear uno nuevo**. Si seleccionas uno nuevo, puedes:

* Seleccionar el **tama帽o** del disco
* Seleccionar el **SO**
* Indicar si deseas **eliminar el disco cuando se elimine la instancia**
* **Cifrado**: Por **defecto** se utilizar谩 una **clave gestionada por Google**, pero tambi茅n puedes **seleccionar una clave de KMS** o indicar una **clave en bruto para usar**.

### Desplegar Contenedor

Es posible desplegar un **contenedor** dentro de la m谩quina virtual.\
Es posible configurar la **imagen** a utilizar, establecer el **comando** a ejecutar en su interior, **argumentos**, montar un **volumen** y **variables de entorno** (驴informaci贸n sensible?) y configurar varias opciones para este contenedor como ejecutarlo como **privilegiado**, stdin y pseudo TTY.

### Cuenta de Servicio

Por defecto, se utilizar谩 la **cuenta de servicio predeterminada de Compute Engine**. El correo electr贸nico de esta CS es como: `<n煤m-proy>-compute@developer.gserviceaccount.com`\
Esta cuenta de servicio tiene el rol de **Editor sobre todo el proyecto (altos privilegios).**

Y los **alcances de acceso predeterminados** son los siguientes:

* **https://www.googleapis.com/auth/devstorage.read\_only** -- 隆Acceso de lectura a los buckets! :)
* https://www.googleapis.com/auth/logging.write
* https://www.googleapis.com/auth/monitoring.write
* https://www.googleapis.com/auth/servicecontrol
* https://www.googleapis.com/auth/service.management.readonly
* https://www.googleapis.com/auth/trace.append

Sin embargo, es posible **concederle `cloud-platform` con un clic** o especificar **personalizados**.

<figure><img src="../../../../.gitbook/assets/image (138).png" alt=""><figcaption></figcaption></figure>

### Firewall

Es posible permitir el tr谩fico HTTP y HTTPS.

<figure><img src="../../../../.gitbook/assets/image (137).png" alt=""><figcaption></figcaption></figure>

### Redes

* **Reenv铆o de IP**: Es posible **habilitar el reenv铆o de IP** desde la creaci贸n de la instancia.
* **Nombre de host**: Es posible asignar un nombre de host permanente a la instancia.
* **Interfaz**: Es posible agregar una interfaz de red.

### Seguridad Adicional

Estas opciones **aumentar谩n la seguridad** de la VM y se recomiendan:

* **Arranque seguro:** El arranque seguro ayuda a proteger tus instancias de VM contra malware a nivel de arranque y rootkits a nivel de kernel.
* **Habilitar vTPM:** El M贸dulo de Plataforma de Confianza Virtual (vTPM) valida la integridad de arranque previo y de arranque de tu VM invitada, y ofrece generaci贸n y protecci贸n de claves.
* **Supervisi贸n de integridad:** La supervisi贸n de integridad te permite monitorear y verificar la integridad de arranque en tiempo de ejecuci贸n de tus instancias de VM protegidas mediante informes de Stackdriver. Requiere que vTPM est茅 habilitado.

### Acceso a la VM

La forma com煤n de habilitar el acceso a la VM es **permitiendo ciertas claves p煤blicas SSH** para acceder a la VM.\
Sin embargo, tambi茅n es posible **habilitar el acceso a la VM a trav茅s del servicio `os-config` utilizando IAM**. Adem谩s, es posible habilitar la autenticaci贸n de dos factores para acceder a la VM utilizando este servicio.\
Cuando este **servicio** est谩 **habilitado**, el acceso a trav茅s de **claves SSH se desactiva**.

<figure><img src="../../../../.gitbook/assets/image (139).png" alt=""><figcaption></figcaption></figure>

### Metadatos

Es posible definir **automatizaciones** (userdata en AWS) que son **comandos de shell** que se ejecutar谩n cada vez que la m谩quina se encienda o reinicie.

Tambi茅n es posible **agregar valores clave de metadatos adicionales** que ser谩n accesibles desde el punto final de metadatos. Esta informaci贸n se utiliza com煤nmente para variables de entorno y scripts de inicio/apagado. Esto se puede obtener utilizando el **m茅todo `describe`** desde un comando en la secci贸n de enumeraci贸n, pero tambi茅n se puede recuperar desde el interior de la instancia accediendo al punto final de metadatos.
```bash
# view project metadata
curl "http://metadata.google.internal/computeMetadata/v1/project/attributes/?recursive=true&alt=text" \
-H "Metadata-Flavor: Google"

# view instance metadata
curl "http://metadata.google.internal/computeMetadata/v1/instance/attributes/?recursive=true&alt=text" \
-H "Metadata-Flavor: Google"
```
Adem谩s, el **token de autenticaci贸n para la cuenta de servicio adjunta** y **informaci贸n general** sobre la instancia, la red y el proyecto tambi茅n estar谩n disponibles desde el **punto final de metadatos**. Para obtener m谩s informaci贸n, consulta:

{% embed url="https://book.hacktricks.xyz/pentesting-web/ssrf-server-side-request-forgery/cloud-ssrf#6440" %}

### Encriptaci贸n

Por defecto se utiliza una clave de encriptaci贸n gestionada por Google, pero se puede configurar una Clave de encriptaci贸n gestionada por el cliente (CMEK). Tambi茅n puedes configurar qu茅 hacer cuando se revoque la CMEF utilizada: Nada o apagar la VM.

<figure><img src="../../../../.gitbook/assets/image (140).png" alt=""><figcaption></figcaption></figure>

{% hint style="success" %}
Aprende y practica Hacking en AWS:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Aprende y practica Hacking en GCP: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Apoya a HackTricks</summary>

* 隆Consulta los [**planes de suscripci贸n**](https://github.com/sponsors/carlospolop)!
* **nete al**  [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s铆guenos** en **Twitter**  [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Comparte trucos de hacking enviando PRs a los repositorios de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
{% endhint %}
