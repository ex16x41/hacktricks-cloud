# GCP - Hesap Makineleri

{% hint style="success" %}
AWS Hacking'i Ã¶ÄŸrenin ve uygulayÄ±n:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks EÄŸitim AWS KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ± (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
GCP Hacking'i Ã¶ÄŸrenin ve uygulayÄ±n: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks EÄŸitim GCP KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ± (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**Abonelik planlarÄ±nÄ±**](https://github.com/sponsors/carlospolop) kontrol edin!
* ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) katÄ±lÄ±n veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n veya bizi **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** takip edin.**
* Hacking pÃ¼f noktalarÄ±nÄ± paylaÅŸarak PR'ler gÃ¶ndererek **HackTricks** ve **HackTricks Cloud** github depolarÄ±na katkÄ±da bulunun.

</details>
{% endhint %}

## Temel Bilgiler

Google Cloud Hesap Makineleri, **Google'Ä±n bulut altyapÄ±sÄ±nda Ã¶lÃ§eklenebilir ve talep Ã¼zerine hesaplama gÃ¼cÃ¼ sunan Ã¶zelleÅŸtirilebilir sanal makinelerdir**. KÃ¼resel daÄŸÄ±tÄ±m, kalÄ±cÄ± depolama, esnek iÅŸletim sistemi seÃ§enekleri ve gÃ¼Ã§lÃ¼ aÄŸ ve gÃ¼venlik entegrasyonlarÄ± gibi Ã¶zellikler sunarak, web sitelerini barÄ±ndÄ±rmak, veri iÅŸlemek ve bulutta uygulamalarÄ± verimli bir ÅŸekilde Ã§alÄ±ÅŸtÄ±rmak iÃ§in Ã§ok yÃ¶nlÃ¼ bir seÃ§enek sunarlar.

### Gizli VM

Gizli VM'ler, **AMD EPYC iÅŸlemcilerin en son nesli tarafÄ±ndan sunulan donanÄ±m tabanlÄ± gÃ¼venlik Ã¶zelliklerini** kullanÄ±r. Bu Ã¶zellikler, VM'nin iÅŸlenen ve depolanan verilerini ana iÅŸletim sistemi ve hipervizÃ¶rden bile korumasÄ±nÄ± saÄŸlar.

Gizli bir VM Ã§alÄ±ÅŸtÄ±rmak iÃ§in **makine tÃ¼rÃ¼**, aÄŸ **arayÃ¼zÃ¼**, **Ã¶nyÃ¼kleme diski gÃ¶rÃ¼ntÃ¼sÃ¼** gibi ÅŸeyleri **deÄŸiÅŸtirmek** gerekebilir.

### Disk ve Disk Åifreleme

KullanÄ±lacak diski **seÃ§mek veya yeni bir tane oluÅŸturmak** mÃ¼mkÃ¼ndÃ¼r. Yeni bir tane seÃ§erseniz:

* Diskin **boyutunu seÃ§ebilirsiniz**
* **Ä°ÅŸletim Sistemini** seÃ§ebilirsiniz
* **Ã–rneÄŸin silindiÄŸinde diski silmek isteyip istemediÄŸinizi** belirtebilirsiniz
* **Åifreleme**: **VarsayÄ±lan olarak** bir **Google yÃ¶netilen anahtar** kullanÄ±lacaktÄ±r, ancak ayrÄ±ca **KMS'den bir anahtar seÃ§ebilir** veya kullanÄ±lacak **ham anahtarÄ± belirtebilirsiniz**.

### Konteyner DaÄŸÄ±tÄ±mÄ±

Sanal makine iÃ§inde bir **konteyner** daÄŸÄ±tmak mÃ¼mkÃ¼ndÃ¼r.\
KullanÄ±lacak **gÃ¶rÃ¼ntÃ¼yÃ¼ yapÄ±landÄ±rabilir**, iÃ§inde Ã§alÄ±ÅŸtÄ±rÄ±lacak **komutu belirleyebilir**, **argÃ¼manlarÄ±**, bir **birim baÄŸlayabilir** ve bu konteyner iÃ§in **Ã§eÅŸitli seÃ§enekler** yapÄ±landÄ±rabilirsiniz, Ã¶rneÄŸin **ayrÄ±calÄ±klÄ± olarak Ã§alÄ±ÅŸtÄ±rma**, stdin ve yalancÄ± TTY.

### Hizmet HesabÄ±

VarsayÄ±lan olarak, **Hesap Makinesi varsayÄ±lan hizmet hesabÄ±** kullanÄ±lacaktÄ±r. Bu SA'nÄ±n e-posta adresi ÅŸuna benzer: `<proj-num>-compute@developer.gserviceaccount.com`\
Bu hizmet hesabÄ±, projenin **tÃ¼mÃ¼ Ã¼zerinde EditÃ¶r rolÃ¼ne (yÃ¼ksek ayrÄ±calÄ±klar) sahiptir.**

Ve **varsayÄ±lan eriÅŸim kapsamlarÄ±** ÅŸunlardÄ±r:

* **https://www.googleapis.com/auth/devstorage.read\_only** -- Kovalara okuma eriÅŸimi :)
* https://www.googleapis.com/auth/logging.write
* https://www.googleapis.com/auth/monitoring.write
* https://www.googleapis.com/auth/servicecontrol
* https://www.googleapis.com/auth/service.management.readonly
* https://www.googleapis.com/auth/trace.append

Ancak, **bir tÄ±klama ile `cloud-platform` izni vermek** veya **Ã¶zel olanlarÄ± belirtmek** mÃ¼mkÃ¼ndÃ¼r.

<figure><img src="../../../../.gitbook/assets/image (138).png" alt=""><figcaption></figcaption></figure>

### GÃ¼venlik DuvarÄ±

HTTP ve HTTPS trafiÄŸine izin vermek mÃ¼mkÃ¼ndÃ¼r.

<figure><img src="../../../../.gitbook/assets/image (137).png" alt=""><figcaption></figcaption></figure>

### AÄŸ

* **IP YÃ¶nlendirme**: Ã–rneÄŸin oluÅŸturulduÄŸunda **IP yÃ¶nlendirmeyi etkinleÅŸtirmek** mÃ¼mkÃ¼ndÃ¼r.
* **Ana Bilgisayar AdÄ±**: Ã–rneÄŸe kalÄ±cÄ± bir ana bilgisayar adÄ± verebilirsiniz.
* **ArayÃ¼z**: Bir aÄŸ arayÃ¼zÃ¼ eklemek mÃ¼mkÃ¼ndÃ¼r

### Ek GÃ¼venlik

Bu seÃ§enekler VM'nin gÃ¼venliÄŸini **artÄ±rÄ±r** ve Ã¶nerilir:

* **GÃ¼venli Ã¶nyÃ¼kleme:** GÃ¼venli Ã¶nyÃ¼kleme, VM Ã¶rneklerinizi Ã¶nyÃ¼kleme dÃ¼zeyi ve Ã§ekirdek dÃ¼zeyi kÃ¶tÃ¼ amaÃ§lÄ± yazÄ±lÄ±mlara ve kÃ¶k kitlerine karÅŸÄ± korumaya yardÄ±mcÄ± olur.
* **vTPM'yi EtkinleÅŸtir:** Sanal GÃ¼venilir Platform ModÃ¼lÃ¼ (vTPM), konuk VM'nizin Ã¶nyÃ¼kleme ve Ã¶nyÃ¼kleme bÃ¼tÃ¼nlÃ¼ÄŸÃ¼nÃ¼ doÄŸrular ve anahtar oluÅŸturma ve koruma sunar.
* **BÃ¼tÃ¼nlÃ¼k denetimi:** BÃ¼tÃ¼nlÃ¼k izleme, kalkanlÄ± VM Ã¶rneklerinizin Ã§alÄ±ÅŸma zamanÄ± Ã¶nyÃ¼kleme bÃ¼tÃ¼nlÃ¼ÄŸÃ¼nÃ¼ Stackdriver raporlarÄ± kullanarak izlemenizi ve doÄŸrulamanÄ±zÄ± saÄŸlar. vTPM'nin etkinleÅŸtirilmesi gerekmektedir.

### VM EriÅŸimi

VM'ye eriÅŸimi etkinleÅŸtirmenin yaygÄ±n yolu, VM'ye eriÅŸim izni vermek iÃ§in **belirli SSH genel anahtarlarÄ±nÄ± izin vermek**tir.\
Ancak, VM'ye eriÅŸimi **IAM kullanarak `os-config` hizmetini kullanarak etkinleÅŸtirmek** de mÃ¼mkÃ¼ndÃ¼r. DahasÄ±, bu hizmeti kullanarak VM'ye eriÅŸim iÃ§in 2FA'yÄ± etkinleÅŸtirmek de mÃ¼mkÃ¼ndÃ¼r.\
Bu **hizmet** etkinleÅŸtirildiÄŸinde, **SSH anahtarlarÄ± aracÄ±lÄ±ÄŸÄ±yla eriÅŸim devre dÄ±ÅŸÄ± bÄ±rakÄ±lÄ±r.**

<figure><img src="../../../../.gitbook/assets/image (139).png" alt=""><figcaption></figcaption></figure>

### Meta Veri

Her seferinde makine aÃ§Ä±ldÄ±ÄŸÄ±nda veya yeniden baÅŸlatÄ±ldÄ±ÄŸÄ±nda **Ã§alÄ±ÅŸtÄ±rÄ±lacak kabuk komutlarÄ±** olan **otomasyonu** (AWS'de userdata) tanÄ±mlamak mÃ¼mkÃ¼ndÃ¼r.

AyrÄ±ca, metadata uÃ§ noktasÄ±ndan eriÅŸilebilecek **ekstra meta veri anahtar-deÄŸer deÄŸerlerini eklemek** de mÃ¼mkÃ¼ndÃ¼r. Bu bilgi genellikle Ã§evresel deÄŸiÅŸkenler ve baÅŸlatma/durdurma komutlarÄ± iÃ§in kullanÄ±lÄ±r. Bu, **aÃ§Ä±klama yÃ¶ntemi** kullanÄ±larak bir komutla elde edilebilir, ancak ayrÄ±ca meta veri uÃ§ noktasÄ±na eriÅŸerek Ã¶rneÄŸin iÃ§inden de alÄ±nabilir.
```bash
# view project metadata
curl "http://metadata.google.internal/computeMetadata/v1/project/attributes/?recursive=true&alt=text" \
-H "Metadata-Flavor: Google"

# view instance metadata
curl "http://metadata.google.internal/computeMetadata/v1/instance/attributes/?recursive=true&alt=text" \
-H "Metadata-Flavor: Google"
```
AyrÄ±ca, **baÄŸlÄ± hizmet hesabÄ± iÃ§in kimlik belirteci** ve **Ã¶rnek, aÄŸ ve proje hakkÄ±nda genel bilgiler** de **metadata uÃ§ noktasÄ±ndan** alÄ±nabilecektir. Daha fazla bilgi iÃ§in ÅŸuraya bakÄ±n:

{% embed url="https://book.hacktricks.xyz/pentesting-web/ssrf-server-side-request-forgery/cloud-ssrf#6440" %}

### Åifreleme

VarsayÄ±lan olarak bir Google tarafÄ±ndan yÃ¶netilen ÅŸifreleme anahtarÄ± kullanÄ±lÄ±r ancak MÃ¼ÅŸteri tarafÄ±ndan yÃ¶netilen ÅŸifreleme anahtarÄ± (CMEK) yapÄ±landÄ±rÄ±labilir. KullanÄ±lan CMEF iptal edildiÄŸinde ne yapÄ±lacaÄŸÄ±nÄ± da yapÄ±landÄ±rabilirsiniz: HiÃ§bir ÅŸey yapma veya sanal makineyi kapatma.
