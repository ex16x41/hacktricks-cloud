# GCP - Escalada de privilegios en AppEngine

{% hint style="success" %}
Aprende y practica Hacking en AWS: <img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Aprende y practica Hacking en GCP: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Apoya a HackTricks</summary>

* 隆Consulta los [**planes de suscripci贸n**](https://github.com/sponsors/carlospolop)!
* **nete al**  [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s铆guenos** en **Twitter**  [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Comparte trucos de hacking enviando PRs a los repositorios de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
{% endhint %}

## App Engine

Para obtener m谩s informaci贸n sobre App Engine, consulta:

{% content-ref url="../gcp-services/gcp-app-engine-enum.md" %}
[gcp-app-engine-enum.md](../gcp-services/gcp-app-engine-enum.md)
{% endcontent-ref %}

### `appengine.applications.get`, `appengine.instances.get`, `appengine.instances.list`, `appengine.operations.get`, `appengine.operations.list`, `appengine.services.get`, `appengine.services.list`, `appengine.versions.create`, `appengine.versions.get`, `appengine.versions.list`, `cloudbuild.builds.get`,`iam.serviceAccounts.actAs`, `resourcemanager.projects.get`, `storage.objects.create`, `storage.objects.list`

Estos son los permisos necesarios para **implementar una aplicaci贸n usando la interfaz de l铆nea de comandos `gcloud`**. Tal vez los permisos de **`get`** y **`list`** se puedan **evitar**.

Puedes encontrar ejemplos de c贸digo en Python en [https://github.com/GoogleCloudPlatform/python-docs-samples/tree/main/appengine](https://github.com/GoogleCloudPlatform/python-docs-samples/tree/main/appengine)

Por defecto, el nombre del servicio de la aplicaci贸n ser谩 **`default`**, y solo puede haber 1 instancia con el mismo nombre.\
Para cambiarlo y crear una segunda aplicaci贸n, en **`app.yaml`**, cambia el valor de la clave ra铆z a algo como **`service: my-second-app`**
```bash
cd python-docs-samples/appengine/flexible/hello_world
gcloud app deploy #Upload and start application inside the folder
```
Dale al menos 10-15 minutos, si no funciona llama **desplegar otra vez varias veces** y espera unos minutos.

{% hint style="info" %}
Es **posible indicar la Cuenta de Servicio a utilizar** pero por defecto se usa la Cuenta de Servicio predeterminada de App Engine.
{% endhint %}

La URL de la aplicaci贸n es algo como `https://<nombre-proyecto>.oa.r.appspot.com/` o `https://<nombre-servicio>-dot-<nombre-proyecto>.oa.r.appspot.com`

### `appengine.instances.enableDebug`, `appengine.instances.get`, `appengine.instances.list`, `appengine.operations.get`, `appengine.services.get`, `appengine.services.list`, `appengine.versions.get`, `appengine.versions.list`, `compute.projects.get`

Con estos permisos, es posible **iniciar sesi贸n a trav茅s de ssh en las instancias de App Engine** de tipo **flexible** (no est谩ndar). Algunos de los permisos de **`list`** y **`get`** **podr铆an no ser realmente necesarios**.
```bash
gcloud app instances ssh --service <app-name> --version <version-id> <ID>
```
### `appengine.applications.update`, `appengine.operations.get`

Creo que esto simplemente cambia el SA de fondo que Google utilizar谩 para configurar las aplicaciones, por lo que no creo que puedas abusar de esto para robar la cuenta de servicio.

{% code overflow="wrap" %}
```bash
gcloud app update --service-account=<sa_email>
```
{% endcode %}

### `appengine.versions.getFileContents`, `appengine.versions.update`

No estoy seguro de c贸mo utilizar estos permisos o si son 煤tiles (ten en cuenta que al cambiar el c贸digo se crea una nueva versi贸n, as铆 que no s茅 si puedes simplemente actualizar el c贸digo o el rol IAM de uno, pero supongo que deber铆as poder hacerlo, 驴tal vez cambiando el c贸digo dentro del bucket??).

### Acceso de escritura sobre los buckets

Incluso con acceso de escritura sobre los buckets donde se encuentra el c贸digo fuente **NO fue posible ejecutar c贸digo arbitrario modificando el c贸digo fuente y el `manifest.json`**.\
Quiz谩s si est谩s monitoreando el bucket y detectas el momento en que se crea una nueva versi贸n y se carga el c贸digo fuente y el manifiesto, podr铆a ser posible cambiarlos para que la nueva versi贸n use los modificados con puerta trasera??

Tambi茅n parece que las capas de contenedores se almacenan en el bucket, 驴cambiando esas?

{% hint style="success" %}
Aprende y practica Hacking en AWS:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Aprende y practica Hacking en GCP: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Apoya a HackTricks</summary>

* 隆Consulta los [**planes de suscripci贸n**](https://github.com/sponsors/carlospolop)!
* **nete al**  [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s铆guenos** en **Twitter**  [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Comparte trucos de hacking enviando PRs a los repositorios de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
{% endhint %}
